<!DOCTYPE HTML>


<html lang="en-GB-hixie">
 <head>
  <title>HTML 5</title>
  <link href="/style/specification" type="text/css" rel="stylesheet">
  <link href="/images/icon" rel="icon">

  <style type="text/css">
   h4 + .element { margin-top: -2.5em; padding-top: 2em; }
   h4 + p + .element { margin-top: -5em; padding-top: 4em; }
   .element { background: #EEFFEE; color: black; margin: 0 0 1em -1em; padding: 0 1em 0.25em 0.75em; border-left: solid #99FF99 0.25em; -padding: 0; /* that last decl is for IE6. Try removing it, it's hilarious! */ }
   .proposal { border: blue solid; padding: 1em; }
   table.matrix, table.matrix td { border: none; text-align: right; }
   table.matrix { margin-left: 2em; }
  </style>

 <link href="section-the-default0.html#nav-bar" rel="prev" title="4.2. The default view"><link href="index.html#contents" rel="index" title="Table of contents"><link href="section-user-prompts.html#nav-bar" rel="next" title="4.4. User prompts"></head><body class="cfc">
  <style scoped>
   * { color: gray ! important; background: none ! important; border-color: silver ! important; }
   img, object, iframe { filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); -webkit-filter: grayscale(100%); }
   .obsolete { border: double thick red ! important; background: yellow ! important; margin: 4em auto 0 auto; max-width: 50em; width: 70%; text-align: center; position: fixed;  z-index: 10000; top: 0; left: 0; right: 0; }
   .obsolete a { color: blue ! important; }
   .obsolete p { font: 900 2em sans-serif; color: red ! important; margin: 1em 1.5em ! important; }
  </style>
  <div class=obsolete>
   <p>This is a snapshot of an early working draft and has therefore
   been superseded by the <a href="http://whatwg.org/html">HTML
   standard</a>.</p>
   <p>This document will not be further updated.</p>
  </div>
<div class="head">
   <p><a href="http://www.whatwg.org/" class="logo" rel="home"><img src="/images/logo" alt="WHATWG"></a></p>

   <h1 id="html-5">HTML 5</h1>

   <h2 id="working" class="no-num no-toc">Call For Comments — 27 October 2007</h2></div><nav id="nav-bar"><a href="section-the-default0.html#nav-bar">&lt; 4.2. The default view</a> – <a href="index.html#contents">Table of contents</a> – <a href="section-user-prompts.html#nav-bar">4.4. User prompts &gt;</a></nav><h3 id="scripting"><span class="secno">4.3. </span>Scripting</h3>

  <h4 id="running"><span class="secno">4.3.1. </span>Running executable code</h4>

  <p>Various mechanisms can cause author-provided executable code to run in
   the context of a document. These mechanisms include, but are probably not
   limited to:

  </p><ul>
   <li>Processing of <code><a href="section-scripting0.html#script0">script</a></code> elements.

   </li><li>Processing of inline <code title="javascript protocol"><a href="#the-javascript">javascript:</a></code> URIs (e.g. the <code title="attr-img-src"><a href="section-embedded.html#src">src</a></code> attribute of <code><a href="section-embedded.html#img">img</a></code> elements, or an <code title="">@import</code>
    rule in a CSS <code><a href="section-document.html#style">style</a></code> element block).

   </li><li>Event handlers, whether registered through the DOM using <code title="">addEventListener()</code>, by explicit <a href="#event2">event
    handler content attributes</a>, by <a href="#event3">event handler DOM
    attributes</a>, or otherwise.

   </li><li>Processing of technologies like XBL or SVG that have their own
    scripting features.
  </li></ul>

  <p>User agents may provide a mechanism to enable or disable the execution
   of author-provided code. When the user agent is configured such that
   author-provided code does not execute, or if the user agent is implemented
   so as to never execute author-provided code, it is said that <dfn id="scripting1">scripting is disabled</dfn>. When author-provided code
   <em>does</em> execute, <dfn id="scripting2">scripting is enabled</dfn>. A
   user agent with scripting disabled is a <a href="section-conformance.html#non-scripted" title="User agents with no scripting support">user agent with no scripting
   support</a> for the purposes of conformance.

  </p><h4 id="origin"><span class="secno">4.3.2. </span>Origin</h4>
  <!-- Hallowed are the Ori -->
  <!--
    https://bugzilla.mozilla.org/show_bug.cgi?id=346659
    https://bugzilla.mozilla.org/show_bug.cgi?id=344495
  -->

  <p>Access to certain APIs is granted or denied to scripts based on the <dfn id="origin0">origin</dfn> of the script and the API being accessed.

  </p><p>The origin of a script depends on the context of that script:

  </p><dl>
   <dt>If a script is in a <code><a href="section-scripting0.html#script0">script</a></code> element

   </dt><dd>The origin of the script is the origin of the <code>Document</code> to
    which the <code><a href="section-scripting0.html#script0">script</a></code> element belongs.

   </dd><dt>If a script is a function or other code reference created by another
    script

   </dt><dd>The origin of the script is the origin of the script that created it.

   </dd><dt>If a script is a <a href="#the-javascript" title="javascript
    protocol"><code title="">javascript:</code> URI</a> in an attribute

   </dt><dd>The origin is the origin of the <code>Document</code> of the element
    on which the attribute is found.

   </dd><dt>If a script is a <a href="#the-javascript" title="javascript
    protocol"><code title="">javascript:</code> URI</a> in a style sheet

   </dt><dd>The origin is the origin of the <code>Document</code> to which the
    style sheet applies.

   </dd><dt>If a script is a <a href="#the-javascript" title="javascript
    protocol"><code title="">javascript:</code> URI</a> to which a <a href="section-windows.html#browsing0">browsing context</a> is being <a href="section-navigating.html#navigate" title="navigate">navigated</a>, the URI having been provided by the user
    (e.g. by using a <i>bookmarklet</i>)

   </dt><dd>The origin is the origin of the <code>Document</code> of the <a href="section-windows.html#browsing0">browsing context</a>'s <a href="section-windows.html#active">active
    document</a>.

   </dd><dt>If a script is a <a href="#the-javascript" title="javascript
    protocol"><code title="">javascript:</code> URI</a> to which a <a href="section-windows.html#browsing0">browsing context</a> is being <a href="section-navigating.html#navigate" title="navigate">navigated</a>, the URI having been declared in markup

   </dt><dd>The origin is the origin of the <code>Document</code> of the element
    (e.g. an <code><a href="section-phrase.html#a">a</a></code> or <code><a href="section-the-canvas.html#area">area</a></code> element) that declared the URI.

   </dd><dt>If a script is a <a href="#the-javascript" title="javascript
    protocol"><code title="">javascript:</code> URI</a> to which a <a href="section-windows.html#browsing0">browsing context</a> is being <a href="section-navigating.html#navigate" title="navigate">navigated</a>, the URI having been provided by script

   </dt><dd>The origin is the origin of the script that provided the URI.</dd>
   <!-- ... -->
  </dl>

  <p>The origin of scripts thus comes down to finding the origin of
   <code>Document</code> objects.

  </p><p>The origin of a <code>Document</code> or image that was served over the
   network and whose address uses a URI scheme with a server-based naming
   authority is the tuple consisting of the &lt;scheme&gt;,
   &lt;host&gt;/&lt;ihost&gt;, and &lt;port&gt; parts of the
   <code>Document</code>'s full URI. <a href="#refsRFC3986">[RFC3986]</a> <a href="#refsRFC3987">[RFC3987]</a>

  </p><p>The origin of a <code>Document</code> or image that was generated from a
   <code>data:</code> URI found in another <code>Document</code> or in a
   script is the origin of the <code>Document</code> or script.

  </p><p>The origin of a <code>Document</code> or image that was generated from a
   <code>data:</code> URI from another source is a globally unique identifier
   assigned when the document is created.

  </p><p>The origin of a <code>Document</code> or image that was generated from a
   <a href="#the-javascript" title="javascript
   protocol"><code>javascript:</code> URI</a> is the same as the origin of
   that <code>javascript:</code> URI.

  </p><p><dfn id="the-string">The string representing the script's domain in IDNA
   format</dfn> is obtained as follows: take the domain part of the script's
   <a href="#origin0">origin</a> tuple and apply the IDNA ToASCII algorithm
   and then the IDNA ToUnicode algorithm to each component of the domain name
   (with both the AllowUnassigned and UseSTD3ASCIIRules flags set both
   times). <a href="#refsRFC3490">[RFC3490]</a>

  </p><p>If ToASCII fails to convert one of the components of the string, e.g.
   because it is too long or because it contains invalid characters, or if
   the origin of the script has no domain part, then the string representing
   the script's domain in IDNA format cannot be obtained. (ToUnicode is
   defined to never fail.)

  </p><p class="big-issue">It's been suggested that we should put IP addresses into
   the origin tuple, to mitigate DNS rebinding attacks. However that would
   kill multi-homed systems like GMail. Should we do something like have a
   DNS record say whether or not to include the IP in the origin for a host?

  </p><h4 id="unscripted"><span class="secno">4.3.3. </span>Unscripted same-origin
   checks</h4>

  <p>When two URIs are to be compared to determine if they have the <dfn id="same-schemehostport">same scheme/host/port</dfn>, it means that the
   following algorithm must be invoked, where <var title="">uri<sub title="">1</sub></var> and <var title="">uri<sub title="">2</sub></var>
   are the two URIs.

  </p><ol>
   <li>
    <p>First, both <var title="">uri<sub title="">1</sub></var> and <var title="">uri<sub title="">2</sub></var> must be normalized to obtain the
     two tuples (<var title="">scheme<sub title="">1</sub></var>, <var title="">host<sub title="">1</sub></var>, <var title="">port<sub title="">1</sub></var>) and (<var title="">scheme<sub title="">2</sub></var>, <var title="">host<sub title="">2</sub></var>,
     <var title="">port<sub title="">2</sub></var>), by applying the
     following subalgorithm to each URI:</p>

    <ol>
     <li>
      <p>Let <var title="">uri</var> be the URI being normalized.

     </p></li><li>
      <p>Parse <var title="">uri</var> according to the rules described in
       RFC 3986 and RFC 3987. <a href="#refsRFC3986">[RFC3986]</a> <a href="#refsRFC3987">[RFC3987]</a>

     </p></li><li>
      <p>If <var title="">uri</var> does not use a server-based naming
       authority, then fail the overall algorithm — the two URIs do not
       have the same scheme/host/port.

     </p></li><li>
      <p>Let <var title="">scheme</var> be the &lt;scheme&gt; component of
       the URI. If the UA doesn't support the given protocol, then fail the
       overall algorithm — the two URIs do not have the same
       scheme/host/port<!-- (this should not be
     possible, since this algorithm is only invoked with URIs that
     have been actually fetched) -->.

     </p></li><li>
      <p>Let <var title="">host</var> be the &lt;host&gt;/&lt;ihost&gt;
       component of the URI.

     </p></li><li>
      <p>Apply the IDNA ToASCII algorithm to <var title="">host</var>, with
       both the AllowUnassigned and UseSTD3ASCIIRules flags set. Let <var title="">host</var> be the result of the ToASCII algorithm.</p>

      <p>If ToASCII fails to convert one of the components of the string,
       e.g. because it is too long or because it contains invalid characters,
       then fail the overall algorithm — the two URIs do not have the
       same scheme/host/port. <a href="#refsRFC3490">[RFC3490]</a></p>

     </li><li>
      <p>If no port is explicitly listed, then let <var title="">port</var>
       be the default port for the protocol given by <var title="">scheme</var>. Otherwise, let <var title="">port</var> be the
       &lt;port&gt; component of the URI.

     </p></li><li>
      <p>Return the tuple (<var title="">scheme</var>, <var title="">host</var>, <var title="">port</var>).
    </p></li></ol>

   </li><li>
    <p>If <var title="">scheme<sub title="">1</sub></var> is not
     case-insensitively<!-- XXX ascii case matching --> identical to <var title="">scheme<sub title="">2</sub></var>, or if <var title="">host<sub title="">1</sub></var> is not
     case-insensitively<!-- XXX ascii case matching --> identical to <var title="">host<sub title="">2</sub></var>, or if <var title="">port<sub title="">1</sub></var> is not identical to <var title="">port<sub title="">2</sub></var>, then fail the overall algorithm — the two
     URIs do not have the same scheme/host/port.

   </p></li><li>
    <p>Otherwise, the two URIs do have the same scheme/host/port.
  </p></li></ol>

  <h4 id="security2"><span class="secno">4.3.4. </span>Security exceptions</h4>

  <p class="big-issue">Define <dfn id="security8">security exception</dfn>.

  </p><h4 id="javascript-protocol"><span class="secno">4.3.5. </span><dfn id="the-javascript" title="javascript protocol">The <code title="">javascript:</code> protocol</dfn></h4>

  <p>A URI using the <code title="">javascript:</code> protocol must, if
   evaluated, be evaluated using the in-context evaluation operation defined
   for <code title="">javascript:</code> URIs. <a href="#refsJSURI">[JSURI]</a></p>
  <!--
JSURI: http://ietfreport.isoc.org/all-ids/draft-hoehrmann-javascript-scheme-00.txt and
       http://www.websitedev.de/ietf/draft-hoehrmann-javascript-scheme-00.txt should be as stable as it gets,
       http://ietfreport.isoc.org/idref/draft-hoehrmann-javascript-scheme/ for the latest version
-->

  <p>When a browsing context is <a href="section-navigating.html#navigate" title="navigate">navigated</a> to a <code>javascript:</code> URI, and the <a href="section-windows.html#active">active document</a> of that browsing context has the same
   <a href="#origin0">origin</a> as the URI, the dereference context must be
   the <a href="section-windows.html#browsing0">browsing context</a> being navigated.

  </p><p>When a browsing context is <a href="section-navigating.html#navigate" title="navigate">navigated</a> to a <code>javascript:</code> URI, and the <a href="section-windows.html#active">active document</a> of that browsing context has a
   <em>different</em> <a href="#origin0">origin</a> than the URI, the
   dereference context must be an empty object.

  </p><p>Otherwise, the dereference context must the <a href="section-windows.html#browsing0">browsing context</a> of the <code>Document</code> to
   which belongs the element for which the URI is being dereferenced, or to
   which the style sheet for which the URI is being dereferenced applies,
   whichever is appropriate.

  </p><p>URIs using the <code title="">javascript:</code> protocol should be
   evaluated when the resource for that URI is needed, unless <a href="#scripting1">scripting is disabled</a> or the <code>Document</code>
   corresponding to the dereference context (as defined above), if any, has
   <code title="dom-document-designMode"><a href="section-contenteditable.html#designMode">designMode</a></code> enabled.

  </p><p>If the dereference by-product is void (there is no return value), then
   the URI must be treated in a manner equivalent to an HTTP resource with an
   HTTP 204 No Content response.

  </p><p>Otherwise, the URI must be treated in a manner equivalent to an HTTP
   resource with a 200 OK response whose <a href="section-content-type-sniffing.html#content-type8" title="Content-Type">Content-Type metadata</a> is <code title="">text/html</code> and whose response body is the dereference
   by-product, converted to a string value.

  </p><p class="note">Certain contexts, in particular <code><a href="section-embedded.html#img">img</a></code> elements, ignore the <a href="section-content-type-sniffing.html#content-type8" title="Content-Type">Content-Type metadata</a>.

  </p><div class="example">
   <p>So for example a <code title="">javascript:</code> URI for a <code title="attr-img-src"><a href="section-embedded.html#src">src</a></code> attribute of an <code><a href="section-embedded.html#img">img</a></code> element would be evaluated in the context of
    the page as soon as the attribute is set; it would then be sniffed to
    determine the image type and decoded as an image.</p>

   <p>A <code title="">javascript:</code> URI in an <code title="attr-a-href">href</code> attribute of an <code><a href="section-phrase.html#a">a</a></code> element would only be evaluated when the link was
    <a href="section-links.html#following0" title="following hyperlinks">followed</a>.</p>

   <p>The <code title="attr-iframe-src"><a href="section-embedded.html#src1">src</a></code>
    attribute of an <code><a href="section-embedded.html#iframe">iframe</a></code> element would
    be evaluated in the context of the <code><a href="section-embedded.html#iframe">iframe</a></code>'s own <a href="section-windows.html#browsing0">browsing
    context</a>; once evaluated, its return value (if it was not void) would
    replace that <a href="section-windows.html#browsing0">browsing context</a>'s document, thus
    changing the variables visible in that <a href="section-windows.html#browsing0">browsing
    context</a>.</p>
  </div>

  <h4 id="events"><span class="secno">4.3.6. </span>Events</h4>

  <p class="big-issue">We need to define how to handle events that are to be
   fired on a Document that is no longer the active document of its browsing
   context, and for Documents that have no browsing context. Do the events
   fire? Do the handlers in that document not fire? Do we just define
   scripting to be disabled when the document isn't active, with events still
   running as is? See also the <code><a href="section-scripting0.html#script0">script</a></code>
   element section, which says scripts don't run when the document isn't
   active.

  </p><h5 id="event-handler-attributes"><span class="secno">4.3.6.1. </span>Event
   handler attributes</h5>

  <p><a href="section-terminology.html#html-elements">HTML elements</a> can have <dfn id="event1">event
   handler attributes</dfn> specified. These act as bubbling event listeners
   for the element on which they are specified.

  </p><p>Each event handler attribute has two parts, an <a href="#event2" title="event handler content attributes">event handler content
   attribute</a> and an <a href="#event3" title="event handler DOM
   attributes">event handler DOM attribute</a>. Event handler attributes must
   initially be set to null. When their value changes (through the changing
   of their event handler content attribute or their event handler DOM
   attribute), they will either be null, or have an
   <code>EventListener</code> object assigned to them.

  </p><p>Objects other than <code>Element</code> objects, in particular <code><a href="section-the-default0.html#window">Window</a></code>, only have <a href="#event3" title="event
   handler DOM attributes">event handler DOM attribute</a> (since they have
   no content attributes).

  </p><p><dfn id="event2">Event handler content attributes</dfn>, when specified,
   must contain valid ECMAScript code matching the ECMAScript <code title="">FunctionBody</code> production. <a href="#refsECMA262">[ECMA262]</a>

  </p><p>When an event handler content attribute is set, its new value must be
   interpreted as the body of an anonymous function with a single argument
   called <code>event</code>, with the new function's scope chain being
   linked from the activation object of the handler, to the element, to the
   element's <code>form</code> element if it is a form control, to the
   <code>Document</code> object, to the <a href="section-windows.html#browsing0">browsing
   context</a> of that <code>Document</code>. The function's
   <code>this</code> parameter must be the <code>Element</code> object
   representing the element. The resulting function must then be set as the
   value of the corresponding event handler attribute, and the new value must
   be set as the value of the content attribute. If the given function body
   fails to compile, then the corresponding event handler attribute must be
   set to null instead (the content attribute must still be updated to the
   new value, though).

  </p><p class="note">See ECMA262 Edition 3, sections 10.1.6 and 10.2.3, for more
   details on activation objects. <a href="#refsECMA262">[ECMA262]</a>

  </p><p class="issue">How do we allow non-JS event handlers?

  </p><p><dfn id="event3">Event handler DOM attributes</dfn>, on setting, must set
   the corresponding event handler attribute to their new value, and on
   getting, must return whatever the current value of the corresponding event
   handler attribute is (possibly null).

  </p><p>The following are the event handler attributes that must be supported by
   all <a href="section-terminology.html#html-elements">HTML elements</a>, as both content attributes
   and DOM attributes, and on <code><a href="section-the-default0.html#window">Window</a></code>
   objects, as DOM attributes:

  </p><dl><!-- XXX should change 'the element' below to 'the object' or something -->

   <dt><dfn id="onabort" title="handler-onabort"><code>onabort</code></dfn>

   </dt><dd>
    <p>Must be invoked whenever an <code title="event-abort"><a href="section-video.html#abort">abort</a></code> event is targeted at or bubbles through
     the element.
   </p></dd>
   <!--
   <dt><dfn title="handler-onbeforecopy"><code>onbeforecopy</code></dfn></dt> -->
   <!-- widely used -->
   <!--

   <dd><p>Must be invoked whenever a <code
   title="event-beforecopy">beforecopy</code> event is targeted at or bubbles
   through the element.</p></dd>
-->

   <dt><dfn id="onbeforeunload" title="handler-onbeforeunload"><code>onbeforeunload</code></dfn>

   </dt><dd>
    <p>Must be invoked whenever a <code title="event-beforeunload">beforeunload</code> event is targeted at or
     bubbles through the element.

   </p></dd><dt><dfn id="onblur" title="handler-onblur"><code>onblur</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-blur">blur</code> event is
     targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onchange" title="handler-onchange"><code>onchange</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-change">change</code>
     event is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onclick" title="handler-onclick"><code>onclick</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-click">click</code> event
     is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="oncontextmenu" title="handler-oncontextmenu"><code>oncontextmenu</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-contextmenu">contextmenu</code> event is targeted at or
     bubbles through the element.
   </p></dd>
   <!--
   <dt><dfn title="handler-oncopy"><code>oncopy</code></dfn></dt> -->
   <!-- widely used -->
   <!--

   <dd><p>Must be invoked whenever a <code
   title="event-copy">copy</code> event is targeted at or bubbles
   through the element.</p></dd>
-->

   <dt><dfn id="ondblclick" title="handler-ondblclick"><code>ondblclick</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-dblclick">dblclick</code>
     event is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="ondrag" title="handler-ondrag"><code>ondrag</code></dfn>

   </dt><dd>
    <p>Must be invoked whenever a <code title="event-drag"><a href="section-dnd.html#drag">drag</a></code> event is targeted at or bubbles through the
     element.

   </p></dd><dt><dfn id="ondragend" title="handler-ondragend"><code>ondragend</code></dfn>

   </dt><dd>
    <p>Must be invoked whenever a <code title="event-dragend"><a href="section-dnd.html#dragend">dragend</a></code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="ondragenter" title="handler-ondragenter"><code>ondragenter</code></dfn>

   </dt><dd>
    <p>Must be invoked whenever a <code title="event-dragenter"><a href="section-dnd.html#dragenter">dragenter</a></code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="ondragleave" title="handler-ondragleave"><code>ondragleave</code></dfn>

   </dt><dd>
    <p>Must be invoked whenever a <code title="event-dragleave"><a href="section-dnd.html#dragleave">dragleave</a></code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="ondragover" title="handler-ondragover"><code>ondragover</code></dfn>

   </dt><dd>
    <p>Must be invoked whenever a <code title="event-dragover"><a href="section-dnd.html#dragover">dragover</a></code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="ondragstart" title="handler-ondragstart"><code>ondragstart</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-dragstart"><a href="section-dnd.html#dragstart">dragstart</a></code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="ondrop" title="handler-ondrop"><code>ondrop</code></dfn>

   </dt><dd>
    <p>Must be invoked whenever a <code title="event-drop"><a href="section-dnd.html#drop">drop</a></code> event is targeted at or bubbles through the
     element.

   </p></dd><dt><dfn id="onerror" title="handler-onerror"><code>onerror</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever an <code title="event-error"><a href="section-video.html#error1">error</a></code> event is targeted at or bubbles through
     the element.</p>

    <p class="note">The <code title="handler-onerror"><a href="#onerror">onerror</a></code> handler is also used for <a href="#runtime-script-errors">reporting script errors</a>.

   </p></dd><dt><dfn id="onfocus" title="handler-onfocus"><code>onfocus</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-focus">focus</code> event
     is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onkeydown" title="handler-onkeydown"><code>onkeydown</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-keydown">keydown</code>
     event is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onkeypress" title="handler-onkeypress"><code>onkeypress</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-keypress">keypress</code>
     event is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onkeyup" title="handler-onkeyup"><code>onkeyup</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-keyup">keyup</code> event
     is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onload" title="handler-onload"><code>onload</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-load"><a href="section-video.html#load0">load</a></code> event is targeted at or bubbles through
     the element.

   </p></dd><dt><dfn id="onmessage" title="handler-onmessage"><code>onmessage</code></dfn></dt>
   <!-- introduced for <event-source> -->

   <dd>
    <p>Must be invoked whenever a <code title="event-message"><a href="section-event0.html#message0">message</a></code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="onmousedown" title="handler-onmousedown"><code>onmousedown</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-mousedown">mousedown</code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="onmousemove" title="handler-onmousemove"><code>onmousemove</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-mousemove">mousemove</code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="onmouseout" title="handler-onmouseout"><code>onmouseout</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-mouseout">mouseout</code>
     event is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onmouseover" title="handler-onmouseover"><code>onmouseover</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-mouseover">mouseover</code> event is targeted at or bubbles
     through the element.

   </p></dd><dt><dfn id="onmouseup" title="handler-onmouseup"><code>onmouseup</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-mouseup">mouseup</code>
     event is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onmousewheel" title="handler-onmousewheel"><code>onmousewheel</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-mousewheel">mousewheel</code> event is targeted at or bubbles
     through the element.
   </p></dd>
   <!--
   <dt><dfn title="handler-onpaste"><code>onpaste</code></dfn></dt> -->
   <!-- widely used -->
   <!--

   <dd><p>Must be invoked whenever a <code
   title="event-paste">paste</code> event is targeted at or bubbles
   through the element.</p></dd>
-->

   <dt><dfn id="onresize" title="handler-onresize"><code>onresize</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-resize">resize</code>
     event is targeted at or bubbles through the element.
   </p></dd>
   <!-- XXX should define when it fires -->

   <dt><dfn id="onscroll" title="handler-onscroll"><code>onscroll</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-scroll">scroll</code>
     event is targeted at or bubbles through the element.
   </p></dd>
   <!-- XXX should define when it fires -->

   <dt><dfn id="onselect" title="handler-onselect"><code>onselect</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-select"><a href="section-interactive-elements.html#select">select</a></code> event is targeted at or bubbles through
     the element.
   </p></dd>
   <!-- XXX should define when it fires -->
   <!--XXX
   <dt><dfn title="handler-onselectstart"><code>onselectstart</code></dfn></dt> -->
   <!-- widely used -->
   <!--

   <dd><p>Must be invoked whenever a <code
   title="event-selectstart">selectstart</code> event is targeted at or bubbles
   through the element.</p></dd>
-->
   <!-- XXX should define when it fires -->

   <dt><dfn id="onsubmit" title="handler-onsubmit"><code>onsubmit</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever a <code title="event-submit">submit</code>
     event is targeted at or bubbles through the element.

   </p></dd><dt><dfn id="onunload" title="handler-onunload"><code>onunload</code></dfn></dt>
   <!-- widely used -->

   <dd>
    <p>Must be invoked whenever an <code title="event-unload">unload</code>
     event is targeted at or bubbles through the element.
   </p></dd>
   <!-- XXX need to fire this -->
  </dl>

  <p>When an event handler attribute is invoked, its argument must be set to
   the <code>Event</code> object of the event in question. If the function
   returns the exact boolean value false, the event's
   <code>preventDefault()</code> method must then invoked. Exception: for
   historical reasons, for the HTML <code>mouseover</code> event, the
   <code>preventDefault()</code> method must be called when the function
   returns true instead.</p>
  <!-- IE actually uncancels the event if the function returns true -->

  <p>When <a href="#scripting1">scripting is disabled</a>, event handler
   attributes must do nothing.

  </p><p>When <a href="#scripting2">scripting is enabled</a>, all event handler
   attributes on an element, whether set to null or to a function, must be
   registered as event listeners on the element, as if the <code title="dom-EventTarget-addEventListenerNS">addEventListenerNS()</code>
   method on the <code>Element</code> object's <code>EventTarget</code>
   interface had been invoked when the element was created, with the event
   type (<code title="dom-event-type">type</code> argument) equal to the type
   described for the event handler attribute in the list above, the namespace
   (<code title="dom-event-namespaceURI">namespaceURI</code> argument) set to
   null, the listener set to be a target and bubbling phase listener (<code title="dom-event-useCapture">useCapture</code> argument set to false), the
   event group set to the default group (<code title="dom-event-evtGroup">evtGroup</code> argument set to null), and the
   event listener itself (<code title="dom-event-listener">listener</code>
   argument) set to do nothing while the event handler attribute is null, and
   set to invoke the function associated with the event handler attribute
   otherwise.

  </p><h5 id="event"><span class="secno">4.3.6.2. </span>Event firing</h5>

  <p class="big-issue">maybe this should be moved higher up (terminology?
   conformance? DOM?) Also, the whole terminology thing should be changed so
   that we don't define any specific events here, we only define 'simple
   event', 'progress event', 'mouse event', 'key event', and the like, and
   have the actual dispatch use those generic terms when firing events.

  </p><p>Certain operations and methods are defined as firing events on elements.
   For example, the <code title="dom-click"><a href="section-interaction.html#click">click()</a></code>
   method on the <code><a href="section-elements.html#htmlelement">HTMLElement</a></code>
   interface is defined as firing a <code title="event-click">click</code>
   event on the element. <a href="#refsDOM3EVENTS">[DOM3EVENTS]</a>

  </p><p><dfn id="firing" title="fire a click event">Firing a <code title="event-click">click</code> event</dfn> means that a <a href="http://www.w3.org/TR/DOM-Level-3-Events/events.html#event-click"><code>click</code></a>
   event with no namespace, which bubbles and is cancelable, and which uses
   the <code>MouseEvent</code> interface, must be dispatched at the given
   element. The event object must have its <code title="">screenX</code>,
   <code title="">screenY</code>, <code title="">clientX</code>, <code title="">clientY</code>, and <code title="">button</code> attributes set
   to 0, its <code title="">ctrlKey</code>, <code title="">shiftKey</code>,
   <code title="">altKey</code>, and <code title="">metaKey</code> attributes
   set according to the current state of the key input device, if any (false
   for any keys that are not available), its <code title="">detail</code>
   attribute set to 1, and its <code title="">relatedTarget</code> attribute
   set to null. The <code title="">getModifierState()</code> method on the
   object must return values appropriately describing the state of the key
   input device at the time the event is created.

  </p><p><dfn id="firing0" title="fire a change event">Firing a <code title="event-change">change</code> event</dfn> means that a <a href="http://www.w3.org/TR/DOM-Level-3-Events/events.html#event-change"><code>change</code></a>
   event with no namespace, which bubbles but is not cancelable, and which
   uses the <code>Event</code> interface, must be dispatched at the given
   element. The event object must have its <code title="">detail</code>
   attribute set to 0.

  </p><p><dfn id="firing1" title="fire a contextmenu event">Firing a <code title="event-contextmenu">contextmenu</code> event</dfn> means that a <code title="event-contextmenu">contextmenu</code> event with no namespace, which
   bubbles and is cancelable, and which uses the <code>Event</code>
   interface, must be dispatched at the given element. The event object must
   have its <code title="">detail</code> attribute set to 0.

  </p><p><dfn id="firing2" title="fire a simple event">Firing a simple event called
   <var title="">e</var></dfn> means that an event with the name <var title="">e</var>, with no namespace, which does not bubble but is
   cancelable, and which uses the <code>Event</code> interface, must be
   dispatched at the given element.

  </p><p><dfn id="firing3" title="fire a show event">Firing a <code title="event-show">show</code> event</dfn> means <a href="#firing2" title="fire a simple event">firing a simple event called <code title="event-show">show</code></a>. <span title="issue">Actually this should
   fire an event that has modifier information (shift/ctrl etc).</span>

  </p><p><dfn id="firing4" title="fire a load event">Firing a <code title="event-load">load</code> event</dfn> means <a href="#firing2" title="fire a simple event">firing a simple event called <code title="event-load">load</code></a>. <!--<dfn title="fire a
  DOMContentLoaded event">Firing a <code
  title="event-DOMContentLoaded">DOMContentLoaded</code> event</dfn>
  means <span title="fire a simple event">firing a simple event called
  <code
  title="event-DOMContentLoaded">DOMContentLoaded</code></span>.-->
   <dfn id="firing5" title="fire an error event">Firing an <code title="event-error">error</code> event</dfn> means <a href="#firing2" title="fire a simple event">firing a simple event called <code title="event-error">error</code></a>.</p>
  <!-- XXX need to define the dispatching of DOMActivate -->

  <p class="big-issue"><dfn id="firing6" title="fire a progress event">Firing a
   progress event called <var title="">e</var></dfn> means something that
   hasn't yet been defined, in the <a href="#refsPROGRESS">[PROGRESS]</a>
   spec.

  </p><p>The default action of these event is to do nothing unless otherwise
   stated.

  </p><p class="big-issue">If you dispatch a custom &quot;click&quot; event at an element
   that would normally have default actions, should they get triggered? If
   so, we need to go through the entire spec and make sure that any default
   actions are defined in terms of <em>any</em> event of the right type on
   that element, not those that are dispatched in expected ways.

  </p><h5 id="events0"><span class="secno">4.3.6.3. </span>Events and the <code><a href="section-the-default0.html#window">Window</a></code> object</h5>

  <p>When an event is dispatched at a DOM node in a <code>Document</code> in
   a <a href="section-windows.html#browsing0">browsing context</a>, if the event is not a <code title="event-load"><a href="section-video.html#load0">load</a></code> event, the user agent
   must also dispatch the event to the <code><a href="section-the-default0.html#window">Window</a></code>, as follows:

  </p><ol>
   <li>In the capture phase, the event must be dispatched to the <code><a href="section-the-default0.html#window">Window</a></code> object before being dispatched to any of
    the nodes.

   </li><li>In the bubble phase, the event must be dispatched to the <code><a href="section-the-default0.html#window">Window</a></code> object at the end of the phase, unless
    bubbling has been prevented.
  </li></ol>

  <h5 id="runtime-script-errors"><span class="secno">4.3.6.4. </span>Runtime
   script errors</h5>

  <p><em>This section only applies to user agents that support scripting in
   general and ECMAScript in particular.</em>

  </p><p>Whenever a runtime script error occurs in one of the scripts associated
   with the document, the value of the <code title="handler-onerror"><a href="#onerror">onerror</a></code> <span>event handler DOM
   attribute</span> of the <code><a href="section-the-default0.html#window">Window</a></code> object
   must be processed, as follows:

  </p><dl class="switch">
   <dt>If the value is a function

   </dt><dd>
    <p>The function referenced by the <code title="handler-onerror"><a href="#onerror">onerror</a></code> attribute must be invoked with three
     arguments, before notifying the user of the error.</p>

    <p>The three arguments passed to the function are all
     <code>DOMString</code>s; the first must give the message that the UA is
     considering reporting, the second must give the URI to the resource in
     which the error occured, and the third must give the line number in that
     resource on which the error occured.</p>

    <p>If the function returns false, then the error should not be reported
     to the user. Otherwise, if the function returns another value (or does
     not return at all), the error should be reported to the user.</p>

    <p>Any exceptions thrown or errors caused by this function must be
     reported to the user immediately after the error that the function was
     called for, without calling the function again.</p>

   </dd><dt>If the value is <code>null</code>

   </dt><dd>
    <p>The error should not reported to the user.</p>

   </dd><dt>If the value is anything else

   </dt><dd>
    <p>The error should be reported to the user.</p>
  </dd></dl>

  <p>The initial value of <code title="handler-onerror"><a href="#onerror">onerror</a></code> must be <code>undefined</code>.

  </p><script src="http://status.whatwg.org/annotate-web-apps.js" type="text/javascript"></script></body></html>
