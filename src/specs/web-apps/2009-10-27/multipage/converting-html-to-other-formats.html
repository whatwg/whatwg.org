<!DOCTYPE html>
<!DOCTYPE html><html class="split chapter" lang="en-US-x-hixie"><title>5.4 Converting HTML to other formats &mdash; HTML5</title><link href="/style/specification" rel="stylesheet"><link href="/images/icon" rel="icon"><style>
   .proposal { border: blue solid; padding: 1em; }
   .bad, .bad *:not(.XXX) { color: gray; border-color: gray; background: transparent; }
   #updatesStatus { display: none; }
   #updatesStatus.relevant { display: block; position: fixed; right: 1em; top: 1em; padding: 0.5em; font: bold small sans-serif; min-width: 25em; width: 30%; max-width: 40em; height: auto; border: ridge 4px gray; background: #EEEEEE; color: black; }
   div.head .logo { width: 11em; margin-bottom: 20em; }
   #configUI { position: absolute; z-index: 20; top: 10em; right: 1em; width: 11em; font-size: small; }
   #configUI p { margin: 0.5em 0; padding: 0.3em; background: #EEEEEE; color: black; border: inset thin; }
   #configUI p label { display: block; }
   #configUI #updateUI, #configUI .loginUI { text-align: center; }
   #configUI input[type=button] { display: block; margin: auto; }
   #reviewer { position: fixed; bottom: 0; right: 0; white-space: nowrap; border: thin; border-style: inset none none inset; background: #EEEEEE; color: black; overflow: hidden; z-index: 30; }
   #reviewer * { font-size: small; }
   #reviewer.off > :not(:first-child) { display: none; }
   @media print { #configUI { display: none; } }
   .rfc2119 { font-variant: small-caps; text-shadow: 0 0 0.5em yellow; position: static; }
   .rfc2119::after { position: absolute; left: 0; width: 25px; text-align: center; color: yellow; text-shadow: 0.075em 0.075em 0.2em black; }
   .rfc2119.m\ust::after { content: '\2605'; }
   .rfc2119.s\hould::after { content: '\2606'; }
   [hidden] { display: none; }
  </style><style type="text/css">

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies tbody th { whitespace: nowrap; }
   .applies td { text-align: center; }
   .applies .yes { background: yellow; }

   .matrix, .matrix td { border: none; text-align: right; }
   .matrix { margin-left: 2em; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

  </style><link href="data:text/css," id="complete" rel="stylesheet" title="Complete specification"><link href="data:text/css,.impl%20{%20display:%20none;%20}" id="author" rel="alternate stylesheet" title="Author documentation only"><link href="data:text/css,.impl%20{%20background:%20%23FFEEEE;%20}" id="highlight" rel="alternate stylesheet" title="Highlight implementation requirements"><script>
   var loadTimer = new Date();
   var current_revision = "r" + "$Revision: 4372 $".substr(11);
   current_revision = current_revision.substr(0, current_revision.length - 2);
   var last_known_revision = current_revision;
   function getCookie(name) {
     var params = location.search.substr(1).split("&");
     for (var index = 0; index < params.length; index++) {
       if (params[index] == name)
         return "1";
       var data = params[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     var cookies = document.cookie.split("; ");
     for (var index = 0; index < cookies.length; index++) {
       var data = cookies[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     return null;
   }
   function load(script) {
     var e = document.createElement('script');
     e.setAttribute('src', script);
     document.body.appendChild(e);
   }
   function init() {
     if (location.search == '?slow-browser')
       return;
     var configUI = document.createElement('div');
     configUI.id = 'configUI';
     document.body.appendChild(configUI);
     if (document.documentElement.className == "" || document.documentElement.className == "split index")
       load('toc.js');
     load('styler.js');
     if (document.documentElement.className == "")
       load('dfn.js');
     if (getCookie('profile') == '1')
       document.getElementsByTagName('h2')[0].textContent += '; load: ' + (new Date() - loadTimer) + 'ms';
   }
  </script>
  <script src="link-fixup.js"></script>
  <link href="microdata.html" rel="prev" title="5 Microdata">
  <link href="index.html#contents" rel="index" title="Table of contents">
  <link href="browsers.html" rel="next" title="6 Web browsers">
  <body class="cfc" onload="fixBrokenLink(); init()">
  <style scoped>
   * { color: gray ! important; background: none ! important; border-color: silver ! important; }
   img, object, iframe { filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); -webkit-filter: grayscale(100%); }
   .obsolete { border: double thick red ! important; background: yellow ! important; margin: 4em auto 0 auto; max-width: 50em; width: 70%; text-align: center; position: fixed;  z-index: 10000; top: 0; left: 0; right: 0; }
   .obsolete a { color: blue ! important; }
   .obsolete p { font: 900 2em sans-serif; color: red ! important; margin: 1em 1.5em ! important; }
  </style>
  <div class=obsolete>
   <p>This is a snapshot of an early working draft and has therefore
   been superseded by the <a href="http://whatwg.org/html">HTML
   standard</a>.</p>
   <p>This document will not be further updated.</p>
  </div>
<header class="head"><p><a class="logo" href="http://www.whatwg.org/" rel="home"><img alt="WHATWG" src="/images/logo"></a></p>
   <hgroup><h1>HTML5</h1>
    <h2 class="no-num no-toc">Draft Standard &mdash; Call For Comments &mdash; 27 October 2009</h2>
   </hgroup></header><nav>
   <a href="microdata.html">&larr; 5 Microdata</a> &ndash;
   <a href="index.html#contents">Table of contents</a> &ndash;
   <a href="browsers.html">6 Web browsers &rarr;</a>
  <ol class="toc"><li><ol><li><a href="converting-html-to-other-formats.html#converting-html-to-other-formats"><span class="secno">5.4 </span>Converting HTML to other formats</a>
    <ol><li><a href="converting-html-to-other-formats.html#json"><span class="secno">5.4.1 </span>JSON</a><li><a href="converting-html-to-other-formats.html#rdf"><span class="secno">5.4.2 </span>RDF</a><li><a href="converting-html-to-other-formats.html#atom"><span class="secno">5.4.3 </span>Atom</a></ol></ol></ol></nav>

  <div class="impl">

  <h3 id="converting-html-to-other-formats"><span class="secno">5.4 </span>Converting HTML to other formats</h3>

  <h4 id="json"><span class="secno">5.4.1 </span>JSON</h4>

  <p>Given a list of nodes <var title="">nodes</var> in a
  <code>Document</code>, a user agent must run the following algorithm
  to <dfn id="extracting-json" title="extracting JSON">extract the microdata from those
  nodes into a JSON form</dfn>:</p>

  <ol><li><p>Let <var title="">result</var> be an empty object.</li>

   <li><p>Let <var title="">items</var> be an empty array.</li>

   <li><p>For each <var title="">node</var> in <var title="">nodes</var>, check if the element is a <a href="microdata.html#top-level-microdata-items" title="top-level microdata items">top-level microdata item</a>,
   and if it is then <a href="#get-the-object">get the object</a> for that element and
   add it to <var title="">items</var>.</li>

   <li><p>Add an entry to <var title="">result</var> called "<code title="">items</code>" whose value is the array <var title="">items</var>.</li>

   <li><p>Return the result of serializing <var title="">result</var>
   to JSON.</li>

  </ol><p>When the user agent is to <dfn id="get-the-object">get the object</dfn> for an item
  <var title="">item</var>, it must run the following substeps:</p>

  <ol><li><p>Let <var title="">result</var> be an empty object.</li>

   <li><p>If the <var title="">item</var> has an <a href="microdata.html#item-type">item
   type</a>, add an entry to <var title="">result</var> called
   "<code title="">type</code>" whose value is the <a href="microdata.html#item-type">item
   type</a> of <var title="">item</var>.</li>

   <li><p>If the <var title="">item</var> has an <a href="microdata.html#global-identifier">global
   identifier</a>, add an entry to <var title="">result</var>
   called "<code title="">id</code>" whose value is the <a href="microdata.html#global-identifier">global
   identifier</a> of <var title="">item</var>.</li>

   <li><p>Let <var title="">properties</var> be an empty
   object.</li>

   <li>

    <p>For each element <var title="">element</var> that has one or
    more <a href="microdata.html#property-names">property names</a> and is one of <a href="microdata.html#the-properties-of-an-item" title="the
    properties of an item">the properties of the item</a> <var title="">item</var>, in the order those elements are given by the
    algorithm that returns <a href="microdata.html#the-properties-of-an-item">the properties of an item</a>, run
    the following substeps:</p>

    <ol><li><p>Let <var title="">value</var> be the <a href="microdata.html#concept-property-value" title="concept-property-value">property value</a> of <var title="">element</var>.</li>

     <li><p>If <var title="">value</var> is an <a href="microdata.html#concept-item" title="concept-item">item</a>, then <a href="#get-the-object">get the
     object</a> for <var title="">value</var>, and then replace
     <var title="">value</var> with the object returned from those
     steps.</li>

     <li>

      <p>For each name <var title="">name</var> in <var title="">element</var>'s <a href="microdata.html#property-names">property names</a>, run the
      following substeps:</p>

      <ol><li><p>If there is no entry named <var title="">name</var> in
       <var title="">properties</var>, then add an entry named <var title="">name</var> to <var title="">properties</var> whose
       value is an empty array.</li>

       <li><p>Append <var title="">value</var> to the entry named <var title="">name</var> in <var title="">properties</var>.</li>

      </ol></li>

    </ol></li>

   <li><p>Add an entry to <var title="">result</var> called "<code title="">properties</code>" whose value is the object <var title="">properties</var>.</li>

   <li><p>Return <var title="">result</var>.</li>

  </ol><h4 id="rdf"><span class="secno">5.4.2 </span>RDF</h4>

  <p>To convert a <code>Document</code> to RDF, a user agent must run
  the following algorithm:</p>

  <ol><li>

    <p>If <a href="dom.html#the-title-element">the <code>title</code> element</a> is not null,
    then generate the following triple:</p>

    <dl class="triple"><dt>subject   <dd> <a href="dom.html#the-document's-current-address">the document's current address</a>
     <dt>predicate <dd> <code title="">http://purl.org/dc/terms/title</code>
     <dt>object    <dd> the concatenation of the data of all the child <a href="infrastructure.html#text-node" title="text node">text nodes</a> of <a href="dom.html#the-title-element">the <code>title</code> element</a>, in <a href="infrastructure.html#tree-order">tree order</a>, as a plain literal, with the language information set from the <a href="elements.html#language">language</a> of <a href="dom.html#the-title-element">the <code>title</code> element</a>, if it is not unknown.

    </dl></li>

   <li>

    <p>For each <code><a href="text-level-semantics.html#the-a-element">a</a></code>, <code><a href="the-map-element.html#the-area-element">area</a></code>, and
    <code><a href="semantics.html#the-link-element">link</a></code> element in the <code>Document</code>, run these
    substeps:</p>

    <ol><li><p>If the element does not have a <code title="">rel</code>
     attribute, then skip this element.</li>

     <li><p>If the element does not have an <code title="">href</code>
     attribute, then skip this element.</li>

     <li><p>If <a href="urls.html#resolve-a-url" title="resolve a URL">resolving</a> the
     element's <code title="">href</code> attribute relative to the
     element is not successful, then skip this element.</li>

     <li><p>Otherwise, <a href="common-microsyntaxes.html#split-a-string-on-spaces" title="split a string on spaces">split
     the value of the element's <code title="">rel</code> attribute on
     spaces</a>, obtaining <var title="">list of tokens</var>.</li>

     <li><p><a href="infrastructure.html#converted-to-ascii-lowercase" title="converted to ASCII lowercase">Convert each token in
     <var title="">list of tokens</var> to ASCII lowercase</a>.</li>

     <li><p>If <var title="">list of tokens</var> contains more than
     one instance of the token <code title="rel-up"><a href="links.html#link-type-up">up</a></code>, then
     remove all such tokens.</li>

     <li><p>Coalesce duplicate tokens in <var title="">list of
     tokens</var>.</li>

     <li><p>If <var title="">list of tokens</var> contains both the
     tokens <code title="rel-alternate"><a href="links.html#link-type-alternate">alternate</a></code> and <code title="rel-stylesheet"><a href="links.html#link-type-stylesheet">stylesheet</a></code>, then remove them both
     and replace them with the single (uppercase) token <code title="">ALTERNATE-STYLESHEET</code>.</li>

     <li>

      <p>For each token <var title="">token</var> in <var title="">list of tokens</var> that contains no U+003A COLON
      characters (:), generate the following triple:</p>

      <dl class="triple"><dt>subject   <dd> <a href="dom.html#the-document's-current-address">the document's current address</a>
       <dt>predicate <dd> the concatenation of the string "<code title="">http://www.w3.org/1999/xhtml/vocab#</code>" and <var title="">token</var>, with any characters in <var title="">token</var> that are not valid in the &lt;ifragment&gt; production of the IRI syntax being %-escaped <a href="references.html#refsRFC3987">[RFC3987]</a>
       <dt>object    <dd> the <a href="urls.html#absolute-url">absolute URL</a> that results from <a href="urls.html#resolve-a-url" title="resolve a URL">resolving</a> the value of the element's <code title="">href</code> attribute relative to the element
      </dl><p>For each token <var title="">token</var> in <var title="">list of tokens</var> that is an <a href="urls.html#absolute-url">absolute
      URL</a>, generate the following triple:</p>

      <dl class="triple"><dt>subject   <dd> <a href="dom.html#the-document's-current-address">the document's current address</a>
       <dt>predicate <dd> <var title="">token</var>
       <dt>object    <dd> the <a href="urls.html#absolute-url">absolute URL</a> that results from <a href="urls.html#resolve-a-url" title="resolve a URL">resolving</a> the value of the element's <code title="">href</code> attribute relative to the element
      </dl></li>

    </ol></li>

   <li>

    <p>For each <code><a href="semantics.html#meta">meta</a></code> element in the <code>Document</code>
    that has a <code title="attr-meta-name"><a href="semantics.html#attr-meta-name">name</a></code> attribute and
    a <code title="attr-meta-content"><a href="semantics.html#attr-meta-content">content</a></code> attribute, if the
    value of the <code title="attr-meta-name"><a href="semantics.html#attr-meta-name">name</a></code> attribute
    contains no U+003A COLON characters (:), generate the following
    triple:</p>

    <dl class="triple"><dt>subject   <dd> <a href="dom.html#the-document's-current-address">the document's current address</a>
     <dt>predicate <dd> the concatenation of the string "<code title="">http://www.w3.org/1999/xhtml/vocab#</code>" and the value of the element's <code title="attr-meta-name"><a href="semantics.html#attr-meta-name">name</a></code> attribute, <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII lowercase</a>, with any characters in the value that are not valid in the &lt;ifragment&gt; production of the IRI syntax being %-escaped <a href="references.html#refsRFC3987">[RFC3987]</a>
     <dt>object    <dd> the value of the element's <code title="attr-meta-content"><a href="semantics.html#attr-meta-content">content</a></code> attribute, as a plain literal, with the language information set from the <a href="elements.html#language">language</a> of the element, if it is not unknown
    </dl><p>For each <code><a href="semantics.html#meta">meta</a></code> element in the <code>Document</code>
    that has a <code title="attr-meta-name"><a href="semantics.html#attr-meta-name">name</a></code> attribute and
    a <code title="attr-meta-content"><a href="semantics.html#attr-meta-content">content</a></code> attribute, if the
    value of the <code title="attr-meta-name"><a href="semantics.html#attr-meta-name">name</a></code> attribute is
    an <a href="urls.html#absolute-url">absolute URL</a>, generate the following triple:</p>

    <dl class="triple"><dt>subject   <dd> <a href="dom.html#the-document's-current-address">the document's current address</a>
     <dt>predicate <dd> the value of the element's <code title="attr-meta-name"><a href="semantics.html#attr-meta-name">name</a></code> attribute
     <dt>object    <dd> the value of the element's <code title="attr-meta-content"><a href="semantics.html#attr-meta-content">content</a></code> attribute, as a plain literal, with the language information set from the <a href="elements.html#language">language</a> of the element, if it is not unknown
    </dl></li>

   <li>

    <p>For each <code><a href="grouping-content.html#the-blockquote-element">blockquote</a></code> and <code><a href="text-level-semantics.html#the-q-element">q</a></code> element in
    the <code>Document</code> that has a <code title="">cite</code>
    attribute that <a href="urls.html#resolve-a-url" title="resolve a url">resolves</a>
    successfully relative to the element, generate the following
    triple:</p>

    <dl class="triple"><dt>subject   <dd> <a href="dom.html#the-document's-current-address">the document's current address</a>
     <dt>predicate <dd> <code title="">http://purl.org/dc/terms/source</code>
     <dt>object    <dd> the <a href="urls.html#absolute-url">absolute URL</a> that results from <a href="urls.html#resolve-a-url" title="resolve a URL">resolving</a> the value of the element's <code title="">cite</code> attribute relative to the element
    </dl></li>

   <li>

    <p>For each element that is also a <a href="microdata.html#top-level-microdata-items" title="top-level
    microdata items">top-level microdata item</a>, run the
    following steps:</p>

    <ol><li>

      <p><a href="#generate-the-triples-for-an-item" title="generate the triples for an item">Generate the
      triples for the item</a>. Let <var title="">item</var> be the
      subject returned.</p>

     </li>

     <li>

      <p>Generate the following triple:</p>

      <dl class="triple"><dt>subject   <dd> <a href="dom.html#the-document's-current-address">the document's current address</a>
       <dt>predicate <dd> <code title="">http://www.w3.org/1999/xhtml/microdata#item</code>
       <dt>object    <dd> <var title="">item</var>
      </dl></li>

    </ol></li>

  </ol><p>When the user agent is to <dfn id="generate-the-triples-for-an-item">generate the triples for an
  item</dfn> <var title="">item</var>, it must follow the following
  steps:</p>

  <ol><li><p>If <var title="">item</var> has a <a href="microdata.html#global-identifier">global
   identifier</a> and that <a href="microdata.html#global-identifier">global identifier</a> is an
   <a href="urls.html#absolute-url">absolute URL</a>, let <var title="">subject</var> be that
   <a href="microdata.html#global-identifier">global identifier</a>. Otherwise, let <var title="">subject</var> be a new blank node.</li>

   <li><p>If <var title="">item</var> has an <a href="microdata.html#item-type">item type</a>
   and that <a href="microdata.html#item-type">item type</a> is an <a href="urls.html#absolute-url">absolute URL</a>,
   let <var title="">type</var> be that <a href="microdata.html#item-type">item
   type</a>. Otherwise, let <var title="">type</var> be the empty
   string.</li>

   <li>

    <p>If <var title="">type</var> is not the empty string, generate
    the following triple:</p>

    <dl class="triple"><dt>subject   <dd> <var title="">subject</var>
     <dt>predicate <dd> <code title="">http://www.w3.org/1999/02/22-rdf-syntax-ns#type</code>
     <dt>object    <dd> <var title="">type</var>
    </dl></li>

   <li>

    <p>For each element <var title="">element</var> that has one or
    more <a href="microdata.html#property-names">property names</a> and is one of <a href="microdata.html#the-properties-of-an-item" title="the
    properties of an item">the properties of the item</a> <var title="">item</var>, in the order those elements are given by the
    algorithm that returns <a href="microdata.html#the-properties-of-an-item">the properties of an item</a>, run
    the following substeps:</p>

    <ol><li><p>Let <var title="">value</var> be the <a href="microdata.html#concept-property-value" title="concept-property-value">property value</a> of <var title="">element</var>.</li>

     <li><p>If <var title="">value</var> is an <a href="microdata.html#concept-item" title="concept-item">item</a>, then <a href="#generate-the-triples-for-an-item" title="generate the
     triples for an item">generate the triples</a> for <var title="">value</var>, and then replace <var title="">value</var>
     with the subject returned from those steps.</li>

     <!-- could support <time> here somehow, though we'd have to
     reserialise it, check if the <time> was valid, check if it had a
     date, a time, a timezone, etc. -->

     <li><p>Otherwise, if <var title="">element</var> is not one of
     the <a href="microdata.html#url-property-elements">URL property elements</a>, let <var title="">value</var> be a plain literal, with the language
     information set from the <a href="elements.html#language">language</a> of the element, if
     it is not unknown.</li>

     <li>

      <p>For each name <var title="">name</var> in <var title="">element</var>'s <a href="microdata.html#property-names">property names</a>, run the
      appropriate substeps from the following list:</p>

      <dl><dt>If <var title="">name</var> is an <a href="urls.html#absolute-url">absolute
       URL</a></dt>

       <dd>

        <p>Generate the following triple:</p>

        <dl class="triple"><dt>subject   <dd> <var title="">subject</var>
         <dt>predicate <dd> <var title="">name</var>
         <dt>object    <dd> <var title="">value</var>
        </dl></dd>

       <dt>If <var title="">name</var> contains no U+003A COLON
       character (:)</dt>

       <dd>

        <ol><li><p>If <var title="">type</var> is the empty string, then
         abort these substeps.</li>

         <li><p>Let <var title="">predicate</var> have the same value
         as <var title="">type</var>.</li>

         <li><p>If <var title="">predicate</var> does not contain a
         U+0023 NUMBER SIGN character (#), then append a U+0023 NUMBER
         SIGN character (#) to <var title="">predicate</var>.</li>

         <li><p>Append a U+003A COLON character (:) to <var title="">predicate</var>.</li> <!-- has to be something
         not in /name/, so ":", so that a different type/name
         combination couldn't generate the same string -->

         <li><p>Append the value of <var title="">name</var> to <var title="">predicate</var>, with any characters in <var title="">name</var> that are not valid in the &lt;ifragment&gt;
         production of the IRI syntax being %-escaped.</li>

         <li>

          <p>Generate the following triple:</p>

          <dl class="triple"><dt>subject   <dd> <var title="">subject</var>
           <dt>predicate <dd> the concatenation of the string "<code title="">http://www.w3.org/1999/xhtml/microdata#</code>" and <var title="">predicate</var>, with any characters in <var title="">predicate</var> that are not valid in the &lt;ifragment&gt; production of the IRI syntax being %-escaped <a href="references.html#refsRFC3987">[RFC3987]</a>
           <dt>object    <dd> <var title="">value</var>
          </dl></li>

        </ol></dd>

      </dl></li>

    </ol></li>

   <li><p>Return <var title="">subject</var>.</li>

  </ol><h4 id="atom"><span class="secno">5.4.3 </span>Atom</h4>

  <p>Given a <code>Document</code> <var title="">source</var>, a user
  agent must run the following algorithm to <dfn id="extracting-atom" title="extracting
  Atom">extract an Atom feed</dfn>:</p>

  <ol><li><p>If the <code>Document</code> <var title="">source</var> does
   not contain any <code><a href="sections.html#the-article-element">article</a></code> elements, then return nothing
   and abort these steps. This algorithm can only be used with
   documents that contain distinct articles.</p>

   <li><p>Let <var title="">R</var> be an empty <a href="dom.html#xml-documents" title="XML
   documents">XML</a> <code>Document</code> object whose <a href="dom.html#the-document's-address" title="the document's address">address</a> is user-agent
   defined.</li>

   <li><p>Append a <code title="">feed</code> element in the
   <a href="#atom-namespace">Atom namespace</a> to <var title="">R</var>.</li>

   <li>

    <p>For each <code><a href="semantics.html#meta">meta</a></code> element with a <code title="attr-meta-name"><a href="semantics.html#attr-meta-name">name</a></code> attribute and a <code title="attr-meta-content"><a href="semantics.html#attr-meta-content">content</a></code> attribute and whose <code title="attr-meta-name"><a href="semantics.html#attr-meta-name">name</a></code> attribute's value is <code title="meta-author"><a href="semantics.html#meta-author">author</a></code>, run the following substeps:</p>

    <ol><li><p>Append an <code title="">author</code> element in the
     <a href="#atom-namespace">Atom namespace</a> to the root element of <var title="">R</var>.</li>

     <li><p>Append a <code title="">name</code> element in the
     <a href="#atom-namespace">Atom namespace</a> to the element created in the
     previous step.</p>

     <li><p>Append a text node whose data is the value of the
     <code><a href="semantics.html#meta">meta</a></code> element's <code title="attr-meta-content"><a href="semantics.html#attr-meta-content">content</a></code> attribute to the element
     created in the previous step.</li>

    </ol><!-- could use vCards instead, and get <atom:email> and <atom:uri>
    elements out of this instead of just <atom:name> --></li>

   <li>

    <p>If there is a <code><a href="semantics.html#the-link-element">link</a></code> element whose <code title="attr-link-rel"><a href="semantics.html#attr-link-rel">rel</a></code> attribute's value includes the
    keyword <code title="rel-icon"><a href="links.html#rel-icon">icon</a></code>, and that element also
    has an <code title="attr-link-href"><a href="semantics.html#attr-link-href">href</a></code> attribute whose
    value successfully <a href="urls.html#resolve-a-url" title="resolve a url">resolves</a>
    relative to the <code><a href="semantics.html#the-link-element">link</a></code> element, then append an <code title="">icon</code> element in the <a href="#atom-namespace">Atom namespace</a> to
    the root element of <var title="">R</var> whose contents is a text
    node with its data set to the <a href="urls.html#absolute-url">absolute URL</a> resulting
    from <a href="urls.html#resolve-a-url" title="resolve a url">resolving</a> the value of the
    <code title="attr-link-href"><a href="semantics.html#attr-link-href">href</a></code> attribute.</p>

    <!-- could check ratio, could check type... -->

   </li>

   <li>

    <p>Append an <code title="">id</code> element in the <a href="#atom-namespace">Atom
    namespace</a> to the root element of <var title="">R</var>
    whose contents is a text node with its data set to <a href="dom.html#the-document's-current-address">the
    document's current address</a>.</p>

   </li>

   <li>

    <p>Optionally: Let <var title="">x</var> be a <code title="">link</code> element in the <a href="#atom-namespace">Atom
    namespace</a>. Add a <code title="">rel</code> attribute whose
    value is the string "<code title="">self</code>" to <var title="">x</var>. Append a text node with its data set to the
    (user-agent-defined) <a href="dom.html#the-document's-address" title="the document's
    address">address</a> of <var title="">R</var> to <var title="">x</var>. Append <var title="">x</var> to the root element
    of <var title="">R</var>.</p>

    <p class="note">This step would be skipped when the document <var title="">R</var> has no convenient <a href="dom.html#the-document's-address" title="the document's
    address">address</a>. The presence of the <code title="">rel="self"</code> link is a "should"-level requirement in
    the Atom specification.</p>

   </li>

   <li>

    <p>Let <var title="">x</var> be a <code title="">link</code>
    element in the <a href="#atom-namespace">Atom namespace</a>. Add a <code title="">rel</code> attribute whose value is the string "<code title="">alternate</code>" to <var title="">x</var>. If the
    document being converted is an <a href="dom.html#html-documents" title="HTML documents">HTML
    document</a>, add a <code title="">type</code> attribute whose
    value is the string "<code><a href="iana.html#text/html">text/html</a></code>" to <var title="">x</var>. Otherwise, the document being converted is an
    <a href="dom.html#xml-documents" title="XML documents">XML document</a>; add a <code title="">type</code> attribute whose value is the string
    "<code><a href="iana.html#application/xhtml+xml">application/xhtml+xml</a></code>" to <var title="">x</var>. Append a text node with its data set to
    <a href="dom.html#the-document's-current-address">the document's current address</a> to <var title="">x</var>. Append <var title="">x</var> to the root element
    of <var title="">R</var>.</p>

   </li>

   <li><p>Let <var title="">subheading text</var> be the empty
   string.</li>

   <li><p>Let <var title="">heading</var> be the first element of
   <a href="content-models.html#heading-content">heading content</a> whose nearest ancestor of
   <a href="content-models.html#sectioning-content">sectioning content</a> is the <a href="dom.html#the-body-element">the body
   element</a>, if any, or null if there is none.</li>

   <li>

    <p>Take the appropriate action from the following list, as
    determined by the type of the <var title="">heading</var>
    element:</p>

    <dl><dt>If <var title="">heading</var> is null</dt>

     <dd>

      <p>Let <var title="">heading text</var> be the
      <code>textContent</code> of <a href="dom.html#the-title-element">the <code>title</code>
      element</a>, if there is one, or the empty string
      otherwise.</p>

     </dd>

     <dt>If <var title="">heading</var> is a <code><a href="sections.html#the-hgroup-element">hgroup</a></code> element</dt>

     <dd>

      <p>If <var title="">heading</var> contains no child
      <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>&ndash;<code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h6</a></code> elements, let <var title="">heading text</var> be the empty string.</p>

      <p>Otherwise, let <var title="">headings list</var> be a list of
      all the <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>&ndash;<code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h6</a></code> element children
      of <var title="">heading</var>, sorted first by descending
      <a href="sections.html#rank">rank</a> and then in <a href="infrastructure.html#tree-order">tree order</a> (so
      <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>s first, then <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h2</a></code>s, etc, with each
      group in the order they appear in the document). Then, let <var title="">heading text</var> be the <code>textContent</code> of
      the first entry in <var title="">headings list</var>, and if
      there are multiple entries, let <var title="">subheading
      text</var> be the <code>textContent</code> of the second entry
      in <var title="">headings list</var>.</p>

     </dd>

     <dt>If <var title="">heading</var> is an <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>&ndash;<code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h6</a></code> element</dt>

     <dd>

      <p>Let <var title="">heading text</var> be the
      <code>textContent</code> of <var title="">heading</var>.</p>

     </dd>

    </dl></li>

   <li>

    <p>Append a <code title="">title</code> element in the <a href="#atom-namespace">Atom
    namespace</a> to the root element of <var title="">R</var>
    whose contents is a text node with its data set to <var title="">heading text</var>.</p>

   </li>

   <li>

    <p>If <var title="">subheading text</var> is not the empty string,
    append a <code title="">subtitle</code> element in the <a href="#atom-namespace">Atom
    namespace</a> to the root element of <var title="">R</var>
    whose contents is a text node with its data set to <var title="">subheading text</var>.</p>

   </li>

   <li><p>Let <var title="">global update date</var> have no
   value.</li>

   <li>

    <p>For each <code><a href="sections.html#the-article-element">article</a></code> element <var title="">article</var> that does not have an ancestor
    <code><a href="sections.html#the-article-element">article</a></code> element, run the following steps:</p>

    <ol><li><p>Let <var title="">E</var> be an <code title="">entry</code> element in the <a href="#atom-namespace">Atom namespace</a>,
     and append <var title="">E</var> to the root element of <var title="">R</var>.</li>

     <li><p>Let <var title="">heading</var> be the first element of
     <a href="content-models.html#heading-content">heading content</a> whose nearest ancestor of
     <a href="content-models.html#sectioning-content">sectioning content</a> is <var title="">article</var>,
     if any, or null if there is none.</li>

     <li>

      <p>Take the appropriate action from the following list, as
      determined by the type of the <var title="">heading</var>
      element:</p>

      <dl><dt>If <var title="">heading</var> is null</dt>

       <dd>

        <p>Let <var title="">heading text</var> be the empty
        string.</p>

       </dd>

       <dt>If <var title="">heading</var> is a <code><a href="sections.html#the-hgroup-element">hgroup</a></code> element</dt>

       <dd>

        <p>If <var title="">heading</var> contains no child
        <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>&ndash;<code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h6</a></code> elements, let <var title="">heading text</var> be the empty string.</p>

        <p>Otherwise, let <var title="">headings list</var> be a list
        of all the <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>&ndash;<code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h6</a></code> element
        children of <var title="">heading</var>, sorted first by
        descending <a href="sections.html#rank">rank</a> and then in <a href="infrastructure.html#tree-order">tree
        order</a> (so <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>s first, then
        <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h2</a></code>s, etc, with each group in the order they
        appear in the document). Then, let <var title="">heading
        text</var> be the <code>textContent</code> of the first entry
        in <var title="">headings list</var>.</p>

       </dd>

       <dt>If <var title="">heading</var> is an <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>&ndash;<code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h6</a></code> element</dt>

       <dd>

        <p>Let <var title="">heading text</var> be the
        <code>textContent</code> of <var title="">heading</var>.</p>

       </dd>

      </dl></li>

     <li>

      <p>Append a <code title="">title</code> element in the
      <a href="#atom-namespace">Atom namespace</a> to <var title="">E</var> whose
      contents is a text node with its data set to <var title="">heading text</var>.</p>

     </li>

     <!-- <atom:author> is required either at the feed level (above)
     or the entry level (here) but we don't provide it -->

     <li>

      <p>Clone <var title="">article</var> and its descendants into an
      environment that has <a href="origin-0.html#concept-bc-noscript" title="concept-bc-noscript">scripting
      disabled</a>, has no <a href="infrastructure.html#plugin" title="plugin">plugins</a>, and
      fails any attempt to <a href="urls.html#fetch" title="fetch">fetch</a> any
      resources. Let <var title="">cloned article</var> be the
      resulting clone <code><a href="sections.html#the-article-element">article</a></code> element.</p>

     </li>

     <li>

      <p>Remove from the subtree rooted at <var title="">cloned
      article</var> any <code><a href="sections.html#the-article-element">article</a></code> elements other than the
      <var title="">cloned article</var> itself, any
      <code><a href="sections.html#the-header-element">header</a></code>, <code><a href="sections.html#the-footer-element">footer</a></code>, or <code><a href="sections.html#the-nav-element">nav</a></code>
      elements whose nearest ancestor of <a href="content-models.html#sectioning-content">sectioning
      content</a> is the <var title="">cloned article</var>, and
      the first element of <a href="content-models.html#heading-content">heading content</a> whose nearest
      ancestor of <a href="content-models.html#sectioning-content">sectioning content</a> is the <var title="">cloned article</var>, if any.</p>

     </li>

     <li>

      <p>If <var title="">cloned article</var> contains any
      <code><a href="edits.html#the-ins-element">ins</a></code> or <code><a href="edits.html#the-del-element">del</a></code> elements with <code title="attr-mod-datetime"><a href="edits.html#attr-mod-datetime">datetime</a></code> attributes whose
      values <a href="common-microsyntaxes.html#parse-a-global-date-and-time-string" title="parse a global date and time string">parse
      as global date and time strings</a> without errors, then let
      <var title="">update date</var> be the value of the <code title="attr-mod-datetime"><a href="edits.html#attr-mod-datetime">datetime</a></code> attribute that parses
      to the newest <a href="common-microsyntaxes.html#concept-datetime" title="concept-datetime">global date and
      time</a>.</p>

      <p>Otherwise, let <var title="">update date</var> have no
      value.</p>

      <p class="note">This value is used below; it is calculated here
      because in certain cases the next step mutates the <var title="">cloned article</var>.</p>

     </li>

     <li>

      <p>If the document being converted is an <a href="dom.html#html-documents" title="HTML
      documents">HTML document</a>, then: Let <var title="">x</var>
      be a <code title="">content</code> element in the <a href="#atom-namespace">Atom
      namespace</a>. Add a <code title="">type</code> attribute
      whose value is the string "<code title="">html</code>" to <var title="">x</var>. Append a text node with its data set to the
      result of running the <a href="the-end.html#html-fragment-serialization-algorithm">HTML fragment serialization
      algorithm</a> on <var title="">cloned article</var> to <var title="">x</var>. Append <var title="">x</var> to <var title="">E</var>.</p>

      <p>Otherwise, the document being converted is an <a href="dom.html#xml-documents" title="XML documents">XML document</a>: Let <var title="">x</var> be a <code title="">content</code> element in
      the <a href="#atom-namespace">Atom namespace</a>. Add a <code title="">type</code> attribute whose value is the string "<code title="">xml</code>" to <var title="">x</var>. Append a
      <code><a href="grouping-content.html#the-div-element">div</a></code> element to <var title="">x</var>. Move all the
      child nodes of the <var title="">cloned article</var> node to
      that <code><a href="grouping-content.html#the-div-element">div</a></code> element, preserving their relative
      order. Append <var title="">x</var> to <var title="">E</var>.</p>

     </li>

     <li>

      <p>Establish the value of <var title="">id</var> and <var title="">has-alternate</var> from the first of the following to
      apply:</p>

      <dl><dt>If the <var title="">article</var> node has a descendant
       <code><a href="text-level-semantics.html#the-a-element">a</a></code> or <code><a href="the-map-element.html#the-area-element">area</a></code> element with an <code title="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code> attribute that
       successfully <a href="urls.html#resolve-a-url" title="resolve a url">resolves</a>
       relative to that descendant and a <code title="attr-a-rel">rel</code> attribute whose value includes
       the <code title="rel-bookmark"><a href="links.html#link-type-bookmark">bookmark</a></code> keyword</dt>

       <dd>Let <var title="">id</var> be the <a href="urls.html#absolute-url">absolute URL</a>
       resulting from <a href="urls.html#resolve-a-url" title="resolve a url">resolving</a> the
       value of the <code title="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code>
       attribute of the first such <code><a href="text-level-semantics.html#the-a-element">a</a></code> or <code><a href="the-map-element.html#the-area-element">area</a></code>
       element, relative to the element. Let <var title="">has-alternate</var> be true.</dd>

       <dt>If the <var title="">article</var> node has an <code title="attr-id"><a href="elements.html#the-id-attribute">id</a></code> attribute</dt>

       <dd>Let <var title="">id</var> be <a href="dom.html#the-document's-current-address">the document's current
       address</a>, with the fragment identifier (if any) removed,
       and with a new fragment identifier specified, consisting of the
       value of the <var title="">article</var> element's <code title="attr-id"><a href="elements.html#the-id-attribute">id</a></code> attribute. Let <var title="">has-alternate</var> be false.</dd>

       <dt>Otherwise</dt>

       <dd>Let <var title="">id</var> be a user-agent-defined
       undereferenceable yet globally unique <a href="urls.html#valid-url" title="valid
       URL">valid</a> <a href="urls.html#absolute-url">absolute URL</a>. The same
       <a href="urls.html#absolute-url">absolute URL</a> should be generated for each run of
       this algorithm when given the same input. Let <var title="">has-alternate</var> be false.</dd>

      </dl></li>

     <li>

      <p>Append an <code title="">id</code> element in the <a href="#atom-namespace">Atom
      namespace</a> to <var title="">E</var> whose contents is a
      text node with its data set to <var title="">id</var>.</p>

     </li>

     <li>

      <p>If <var title="">has-alternate</var> is true: Let <var title="">x</var> be a <code title="">link</code> element in the
      <a href="#atom-namespace">Atom namespace</a>. Add a <code title="">rel</code>
      attribute whose value is the string "<code title="">alternate</code>" to <var title="">x</var>. Append a
      text node with its data set to <var title="">id</var> to <var title="">x</var>. Append <var title="">x</var> to <var title="">E</var>.</p>

     </li>

     <li>

      <p>If <var title="">article</var> has a <code><a href="text-level-semantics.html#the-time-element">time</a></code>
      element descendant that has a <code title="attr-time-pubdate"><a href="text-level-semantics.html#attr-time-pubdate">pubdate</a></code> attribute and whose
      nearest ancestor <code><a href="sections.html#the-article-element">article</a></code> element is <var title="">article</var>, and the first such element's <a href="text-level-semantics.html#concept-time-date" title="concept-time-date">date</a> is not unknown, then run
      the following substeps, with <var title="">e</var> being the
      first such element:</p>

      <ol><li><p>Let <var title="">datetime</var> be a <a href="common-microsyntaxes.html#concept-datetime" title="concept-datetime">global date and time</a> whose date
       component is the <a href="text-level-semantics.html#concept-time-date" title="concept-time-date">date</a> of
       <var title="">e</var>.</li>

       <li><p>If <var title="">e</var>'s <a href="text-level-semantics.html#concept-time-time" title="concept-time-time">time</a> and <a href="text-level-semantics.html#concept-time-timezone" title="concept-time-timezone">time-zone offset</a> are not
       unknown, then let <var title="">datetime</var>'s time and
       time-zone offset components be the <a href="text-level-semantics.html#concept-time-time" title="concept-time-time">time</a> and <a href="text-level-semantics.html#concept-time-timezone" title="concept-time-timezone">time-zone offset</a> of <var title="">e</var>. Otherwise, let them be midnight and no offset
       respectively ("<code title="">00:00Z</code>").</li>

       <li><p>Let <var title="">publication date</var> be the
       <a href="common-microsyntaxes.html#best-representation-of-the-global-date-and-time-string">best representation of the global date and time
       string</a> <var title="">datetime</var>.</li>

      </ol><p>Otherwise, let <var title="">publication date</var> have no
      value.</p>

     </li>

     <li>

      <p>If <var title="">update date</var> has no value but <var title="">publication date</var> does, then let <var title="">update date</var> have the value of <var title="">publication date</var>.</p>

      <p>Otherwise, if <var title="">publication date</var> has no
      value but <var title="">update date</var> does, then let <var title="">publication date</var> have the value of <var title="">update date</var>.</p>

     </li>

     <li>

      <p>If <var title="">update date</var> has a value, and <var title="">global update date</var> has no value or is less recent
      than <var title="">update date</var>, then let <var title="">global update date</var> have the value of <var title="">update date</var>.</p>

     </li>

     <li>

      <p>If <var title="">publication date</var> and <var title="">update date</var> both still have no value, then let
      them both value a value that is a <a href="common-microsyntaxes.html#valid-global-date-and-time-string">valid global date and
      time string</a> representing the <a href="common-microsyntaxes.html#concept-datetime" title="concept-datetime">global date and time</a> of the
      moment that this algorithm was invoked.</p>

     </li>

     <li>

      <p>Append an <code title="">published</code> element in the
      <a href="#atom-namespace">Atom namespace</a> to <var title="">E</var> whose
      contents is a text node with its data set to <var title="">publication date</var>.</p>

     </li>

     <li>

      <p>Append an <code title="">updated</code> element in the
      <a href="#atom-namespace">Atom namespace</a> to <var title="">E</var> whose
      contents is a text node with its data set to <var title="">update date</var>.</p>

     </li>

    </ol></li>

   <li>

    <p>If <var title="">global update date</var> has no value, then
    let it have a value that is a <a href="common-microsyntaxes.html#valid-global-date-and-time-string">valid global date and time
    string</a> representing the <a href="common-microsyntaxes.html#concept-datetime" title="concept-datetime">global date and time</a> of the date
    and time of the <code>Document</code>'s source file's last
    modification, if it is known, or else of the moment that this
    algorithm was invoked.</p>

   </li>

   <li>

    <p>Insert an <code title="">updated</code> element in the
    <a href="#atom-namespace">Atom namespace</a> into the root element of <var title="">R</var> before the first <code title="">entry</code> in
    the <a href="#atom-namespace">Atom namespace</a> whose contents is a text node with
    its data set to <var title="">global update date</var>.</p>

   </li>

   <li><p>Return the Atom document <var title="">R</var>.</li>

  </ol><p>The <dfn id="atom-namespace">Atom namespace</dfn> is: <code>http://www.w3.org/2005/Atom</code></p>

  </div>




  
