<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r8717 - [e] (0) Reword the menu item builder to make more	sense Affected topics: HTML
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r8717%20-%20%5Be%5D%20%280%29%20Reword%20the%20menu%20item%20builder%20to%20make%20more%0A%09sense%20Affected%20topics%3A%20HTML&In-Reply-To=%3C20140826204428.5221A20237E12A%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023320.html">
   <LINK REL="Next"  HREF="023322.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r8717 - [e] (0) Reword the menu item builder to make more	sense Affected topics: HTML</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r8717%20-%20%5Be%5D%20%280%29%20Reword%20the%20menu%20item%20builder%20to%20make%20more%0A%09sense%20Affected%20topics%3A%20HTML&In-Reply-To=%3C20140826204428.5221A20237E12A%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r8717 - [e] (0) Reword the menu item builder to make more	sense Affected topics: HTML">whatwg at whatwg.org
       </A><BR>
    <I>Tue Aug 26 13:44:28 PDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="023320.html">[html5] r8716 - [giow] (1) Define &lt;video&gt;.srcObject Fixing	https://www.w3.org/Bugs/Public/show_b [...]
</A></li>
        <LI>Next message: <A HREF="023322.html">[html5] r8718 - [giow] (2) Make sure reset() can't fire a popup	Fixing https://www.w3.org/Bugs/P [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23321">[ date ]</a>
              <a href="thread.html#23321">[ thread ]</a>
              <a href="subject.html#23321">[ subject ]</a>
              <a href="author.html#23321">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2014-08-26 13:44:24 -0700 (Tue, 26 Aug 2014)
New Revision: 8717

Modified:
   complete.html
   index
   source
Log:
[e] (0) Reword the menu item builder to make more sense
Affected topics: HTML

Modified: complete.html
===================================================================
--- complete.html	2014-08-26 18:59:17 UTC (rev 8716)
+++ complete.html	2014-08-26 20:44:24 UTC (rev 8717)
@@ -37278,7 +37278,7 @@
      active&lt;/a&gt;, abort these steps.&lt;li&gt;&lt;p&gt;Let &lt;var&gt;menu&lt;/var&gt; be the element's &lt;a href=#designated-pop-up-menu id=the-button-element:designated-pop-up-menu-2&gt;designated pop-up menu&lt;/a&gt;, if
      any. If there isn't one, then abort these steps.&lt;li&gt;&lt;p&gt;&lt;a href=#concept-event-fire id=the-button-element:concept-event-fire&gt;Fire&lt;/a&gt; a &lt;a href=#concept-events-trusted id=the-button-element:concept-events-trusted&gt;trusted&lt;/a&gt; event with the name &lt;code id=the-button-element:event-show&gt;&lt;a href=#event-show&gt;show&lt;/a&gt;&lt;/code&gt; at &lt;var&gt;menu&lt;/var&gt;, using the &lt;code id=the-button-element:relatedevent&gt;&lt;a href=#relatedevent&gt;RelatedEvent&lt;/a&gt;&lt;/code&gt;
      interface, with the &lt;code id=the-button-element:dom-relatedevent-relatedtarget&gt;&lt;a href=#dom-relatedevent-relatedtarget&gt;relatedTarget&lt;/a&gt;&lt;/code&gt; attribute
-     initialised to the &lt;code id=the-button-element:the-button-element-6&gt;&lt;a href=#the-button-element&gt;button&lt;/a&gt;&lt;/code&gt; element. The event must be cancelable. &lt;li&gt;&lt;p&gt;If the event is not canceled, then &lt;a href=#construct-and-show-a-menu id=the-button-element:construct-and-show-a-menu&gt;construct and
+     initialised to the &lt;code id=the-button-element:the-button-element-6&gt;&lt;a href=#the-button-element&gt;button&lt;/a&gt;&lt;/code&gt; element. The event must be cancelable. &lt;li&gt;&lt;p&gt;If the event is not canceled, then &lt;a href=#build-and-show-a-menu id=the-button-element:build-and-show-a-menu&gt;build and
      show&lt;/a&gt; the menu for &lt;var&gt;menu&lt;/var&gt;, with the &lt;code id=the-button-element:the-button-element-7&gt;&lt;a href=#the-button-element&gt;button&lt;/a&gt;&lt;/code&gt; element as the
      subject.&lt;/ol&gt;
 
@@ -42830,50 +42830,54 @@
 
   &lt;hr&gt;
 
-  &lt;p&gt;A pop-up menu consists of a list of zero or more menu items, which can be any of:&lt;/p&gt;
+  &lt;p&gt;A &lt;dfn id=menu-construct&gt;menu construct&lt;/dfn&gt; consists of an ordered list of zero or more &lt;dfn id=menu-item-construct&gt;menu item constructs&lt;/dfn&gt;, which can be any of:&lt;/p&gt;
 
-  &lt;ul class=brief&gt;&lt;li&gt;&lt;a href=#concept-command id=the-menu-element:concept-command&gt;Commands&lt;/a&gt;, which can be marked as default commands (&lt;code id=the-menu-element:the-menuitem-element-2&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt;)&lt;li&gt;Separators (&lt;code id=the-menu-element:the-hr-element-2&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt;)&lt;li&gt;Other menus, which allows the list to be nested (&lt;code id=the-menu-element:the-menu-element-10&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt;)&lt;/ul&gt;
+  &lt;ul class=brief&gt;&lt;li&gt;&lt;a href=#concept-command id=the-menu-element:concept-command&gt;Commands&lt;/a&gt;, which can be marked as &lt;dfn id=default-command&gt;default commands&lt;/dfn&gt; (&lt;code id=the-menu-element:the-menuitem-element-2&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt;)&lt;li&gt;&lt;dfn id=concept-separator&gt;Separators&lt;/dfn&gt; (&lt;code id=the-menu-element:the-hr-element-2&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt;)&lt;li&gt;Other &lt;a href=#menu-construct id=the-menu-element:menu-construct&gt;menu constructs&lt;/a&gt;, each with an associated &lt;dfn id=submenu-label&gt;submenu label&lt;/dfn&gt;, which allows the list to be nested (&lt;code id=the-menu-element:the-menu-element-10&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt;)&lt;/ul&gt;
 
-  &lt;p&gt;To &lt;dfn id=construct-and-show-a-menu&gt;construct and show a menu&lt;/dfn&gt; for a particular &lt;code id=the-menu-element:the-menu-element-11&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element and with a
-  particular element as a subject, the user agent must run the following steps:&lt;/p&gt;
+  &lt;p&gt;To &lt;dfn id=build-and-show-a-menu&gt;build and show a menu&lt;/dfn&gt; for a particular &lt;code id=the-menu-element:the-menu-element-11&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element
+  &lt;var&gt;source&lt;/var&gt; and with a particular element &lt;var&gt;subject&lt;/var&gt; as a subject, the user agent
+  must run the following steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let the menu be an empty list of the type described above.&lt;li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var&gt;pop-up menu&lt;/var&gt; be the &lt;a href=#menu-construct id=the-menu-element:menu-construct-2&gt;menu construct&lt;/a&gt; created by the &lt;a href=#build-a-menu-construct id=the-menu-element:build-a-menu-construct&gt;build a
+   menu construct&lt;/a&gt; algorithm when passed the &lt;var&gt;source&lt;/var&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;Run the &lt;a href=#menu-builder id=the-menu-element:menu-builder&gt;menu builder&lt;/a&gt; steps for the &lt;code id=the-menu-element:the-menu-element-12&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using the menu
-    prepared in the previous list as the output.&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;The &lt;dfn id=menu-builder&gt;menu builder&lt;/dfn&gt; steps for a &lt;code id=the-menu-element:the-menu-element-13&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using a specific menu as
-    output are as follows: For each child node of the &lt;code id=the-menu-element:the-menu-element-14&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; in &lt;a href=#tree-order id=the-menu-element:tree-order&gt;tree order&lt;/a&gt;,
-    run the appropriate steps from the following list:&lt;/p&gt;
+    &lt;p&gt;Display &lt;var&gt;pop-up menu&lt;/var&gt; to the user, and let the algorithm that invoked this one continue.&lt;/p&gt;
 
-    &lt;dl class=switch&gt;&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menuitem-element-3&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt; element that &lt;a href=#concept-command id=the-menu-element:concept-command-2&gt;defines
-     a command&lt;/a&gt;&lt;dd&gt;Append the command to the menu, respecting its &lt;a href=#concept-facet id=the-menu-element:concept-facet&gt;facets&lt;/a&gt;. If the &lt;code id=the-menu-element:the-menuitem-element-4&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt; element has a &lt;code id=the-menu-element:attr-menuitem-default&gt;&lt;a href=#attr-menuitem-default&gt;default&lt;/a&gt;&lt;/code&gt; attribute, mark the command as being a default
-     command.&lt;dt&gt;If the child is an &lt;code id=the-menu-element:the-hr-element-3&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt; element&lt;dd&gt;Append a separator to the menu.&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menu-element-15&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element with no &lt;code id=the-menu-element:attr-menu-label-4&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute&lt;dd&gt;Append a separator to the menu, then run the &lt;a href=#menu-builder id=the-menu-element:menu-builder-2&gt;menu builder&lt;/a&gt; steps using this
-     child &lt;code id=the-menu-element:the-menu-element-16&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element for the same menu, then append another separator to the
-     menu.&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menu-element-17&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element with a &lt;code id=the-menu-element:attr-menu-label-5&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute&lt;dd&gt;Create a new submenu as an empty list of the type described above, and construct it by
-     running the &lt;a href=#menu-builder id=the-menu-element:menu-builder-3&gt;menu builder&lt;/a&gt; steps for the child &lt;code id=the-menu-element:the-menu-element-18&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using the
-     new submenu as the output. Then, append the submenu to the menu, using the value of the child
-     &lt;code id=the-menu-element:the-menu-element-19&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element's &lt;code id=the-menu-element:attr-menu-label-6&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute as the label
-     of the submenu.&lt;dt&gt;Otherwise&lt;dd&gt;&lt;a href=#ignore id=the-menu-element:ignore&gt;Ignore&lt;/a&gt; the child node.&lt;/dl&gt;
-
-   &lt;li&gt;&lt;p&gt;Remove any submenu with no label, or whose label is the empty string, in the menu or any
-   submenus.&lt;li&gt;&lt;p&gt;Remove any menu item with no label, or whose label is the empty string, in the menu or any
-   submenus.&lt;li&gt;&lt;p&gt;Collapse all sequences of two or more adjacent separators in the menu or any submenus to a
-   single separator.&lt;li&gt;&lt;p&gt;Remove all separators at the start or end of the menu and any submenus.&lt;li&gt;
-
-    &lt;p&gt;Display the menu to the user, and let the algorithm that invoked this one continue.&lt;/p&gt;
-
-    &lt;p&gt;If the user selects a menu item that corresponds to an element that still represents a &lt;a href=#concept-command id=the-menu-element:concept-command-3&gt;command&lt;/a&gt; when the user selects it, then the UA must invoke that
+    &lt;p&gt;If the user selects a &lt;a href=#menu-item-construct id=the-menu-element:menu-item-construct&gt;menu item construct&lt;/a&gt; that corresponds to an element that still represents a &lt;a href=#concept-command id=the-menu-element:concept-command-2&gt;command&lt;/a&gt; when the user selects it, then the UA must invoke that
     command's &lt;a href=#command-facet-action id=the-menu-element:command-facet-action&gt;Action&lt;/a&gt;. If the command's &lt;a href=#command-facet-action id=the-menu-element:command-facet-action-2&gt;Action&lt;/a&gt; is defined as &lt;a href=#fire-a-click-event id=the-menu-element:fire-a-click-event&gt;firing
     a &lt;code&gt;click&lt;/code&gt; event&lt;/a&gt;, either directly or via the &lt;a href=#run-synthetic-click-activation-steps id=the-menu-element:run-synthetic-click-activation-steps&gt;run
-    synthetic click activation steps&lt;/a&gt; algorithm, then the &lt;code id=the-menu-element:dom-mouseevent-relatedtarget&gt;&lt;a href=#dom-mouseevent-relatedtarget&gt;relatedTarget&lt;/a&gt;&lt;/code&gt; attribute of that &lt;code id=the-menu-element:event-click&gt;&lt;a href=#event-click&gt;click&lt;/a&gt;&lt;/code&gt; event must be initialised to the subject passed to this
-    &lt;a href=#construct-and-show-a-menu id=the-menu-element:construct-and-show-a-menu&gt;construct and show a menu&lt;/a&gt; algorithm.&lt;/p&gt;
+    synthetic click activation steps&lt;/a&gt; algorithm, then the &lt;code id=the-menu-element:dom-mouseevent-relatedtarget&gt;&lt;a href=#dom-mouseevent-relatedtarget&gt;relatedTarget&lt;/a&gt;&lt;/code&gt; attribute of that &lt;code id=the-menu-element:event-click&gt;&lt;a href=#event-click&gt;click&lt;/a&gt;&lt;/code&gt; event must be initialised to &lt;var&gt;subject&lt;/var&gt;.&lt;/p&gt;
 
     &lt;p&gt;Pop-up menus must not, while being shown, reflect changes in the DOM. The menu is constructed
     from the DOM before being shown, and is then immutable.&lt;/p&gt;
 
    &lt;/ol&gt;
 
+  &lt;p&gt;To &lt;dfn id=build-a-menu-construct&gt;build a menu construct&lt;/dfn&gt; for an element &lt;var&gt;source&lt;/var&gt;, the user agent must run
+  the following steps, which return a &lt;a href=#menu-construct id=the-menu-element:menu-construct-3&gt;menu construct&lt;/a&gt;:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var&gt;generated menu&lt;/var&gt; be an empty &lt;a href=#menu-construct id=the-menu-element:menu-construct-4&gt;menu construct&lt;/a&gt;.&lt;li&gt;
+
+    &lt;p&gt;Run the &lt;a href=#menu-item-generator id=the-menu-element:menu-item-generator&gt;menu item generator&lt;/a&gt; steps for the &lt;code id=the-menu-element:the-menu-element-12&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using &lt;var&gt;generated menu&lt;/var&gt;
+    as the output.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;dfn id=menu-item-generator&gt;menu item generator&lt;/dfn&gt; steps for a &lt;code id=the-menu-element:the-menu-element-13&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using a specific &lt;a href=#menu-construct id=the-menu-element:menu-construct-5&gt;menu construct&lt;/a&gt; &lt;var&gt;output&lt;/var&gt; as
+    output are as follows: For each child node of the &lt;code id=the-menu-element:the-menu-element-14&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; in &lt;a href=#tree-order id=the-menu-element:tree-order&gt;tree order&lt;/a&gt;,
+    run the appropriate steps from the following list:&lt;/p&gt;
+
+    &lt;dl class=switch&gt;&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menuitem-element-3&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt; element that &lt;a href=#concept-command id=the-menu-element:concept-command-3&gt;defines
+     a command&lt;/a&gt;&lt;dd&gt;Append the &lt;a href=#concept-command id=the-menu-element:concept-command-4&gt;command&lt;/a&gt; to &lt;var&gt;output&lt;/var&gt;, respecting the command's &lt;a href=#concept-facet id=the-menu-element:concept-facet&gt;facets&lt;/a&gt;. If the &lt;code id=the-menu-element:the-menuitem-element-4&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt; element has a &lt;code id=the-menu-element:attr-menuitem-default&gt;&lt;a href=#attr-menuitem-default&gt;default&lt;/a&gt;&lt;/code&gt; attribute, mark the &lt;span&gt;command&lt;/span&gt; as being a &lt;a href=#default-command id=the-menu-element:default-command&gt;default
+     command&lt;/a&gt;.&lt;dt&gt;If the child is an &lt;code id=the-menu-element:the-hr-element-3&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt; element&lt;dd&gt;Append a &lt;a href=#concept-separator id=the-menu-element:concept-separator&gt;separator&lt;/a&gt; to &lt;var&gt;output&lt;/var&gt;.&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menu-element-15&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element with no &lt;code id=the-menu-element:attr-menu-label-4&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute&lt;dd&gt;Append a &lt;a href=#concept-separator id=the-menu-element:concept-separator-2&gt;separator&lt;/a&gt; to &lt;var&gt;output&lt;/var&gt;, then run
+     the &lt;a href=#menu-item-generator id=the-menu-element:menu-item-generator-2&gt;menu item generator&lt;/a&gt; steps for this child &lt;code id=the-menu-element:the-menu-element-16&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element, using
+     &lt;var&gt;output&lt;/var&gt; as the output, then append another &lt;a href=#concept-separator id=the-menu-element:concept-separator-3&gt;separator&lt;/a&gt; to &lt;var&gt;output&lt;/var&gt;.&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menu-element-17&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element with a &lt;code id=the-menu-element:attr-menu-label-5&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute&lt;dd&gt;Let &lt;var&gt;submenu&lt;/var&gt; be the result of running the &lt;a href=#build-a-menu-construct id=the-menu-element:build-a-menu-construct-2&gt;build a menu construct&lt;/a&gt; steps for the child &lt;code id=the-menu-element:the-menu-element-18&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element. Then, append &lt;var&gt;submenu&lt;/var&gt; to &lt;var&gt;output&lt;/var&gt;, using the value of the child
+     &lt;code id=the-menu-element:the-menu-element-19&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element's &lt;code id=the-menu-element:attr-menu-label-6&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute as the &lt;a href=#submenu-label id=the-menu-element:submenu-label&gt;submenu label&lt;/a&gt;.&lt;dt&gt;Otherwise&lt;dd&gt;&lt;a href=#ignore id=the-menu-element:ignore&gt;Ignore&lt;/a&gt; the child node.&lt;/dl&gt;
+
+   &lt;li&gt;&lt;p&gt;Remove from &lt;var&gt;output&lt;/var&gt; any &lt;a href=#menu-construct id=the-menu-element:menu-construct-6&gt;menu construct&lt;/a&gt; whose &lt;a href=#submenu-label id=the-menu-element:submenu-label-2&gt;submenu
+   label&lt;/a&gt; is the empty string.&lt;li&gt;&lt;p&gt;Remove from &lt;var&gt;output&lt;/var&gt; any &lt;a href=#menu-item-construct id=the-menu-element:menu-item-construct-2&gt;menu item construct&lt;/a&gt; representing a &lt;a href=#concept-command id=the-menu-element:concept-command-5&gt;command&lt;/a&gt; whose &lt;a href=#command-facet-label id=the-menu-element:command-facet-label&gt;Label&lt;/a&gt; is
+   the empty string.&lt;li&gt;&lt;p&gt;Collapse all sequences of two or more adjacent &lt;a href=#concept-separator id=the-menu-element:concept-separator-4&gt;separators&lt;/a&gt; in &lt;var&gt;output&lt;/var&gt; to a single &lt;a href=#concept-separator id=the-menu-element:concept-separator-5&gt;separator&lt;/a&gt;.&lt;li&gt;&lt;p&gt;If the first &lt;a href=#menu-item-construct id=the-menu-element:menu-item-construct-3&gt;menu item construct&lt;/a&gt; in &lt;var&gt;output&lt;/var&gt; is a &lt;a href=#concept-separator id=the-menu-element:concept-separator-6&gt;separator&lt;/a&gt;, then remove it.&lt;li&gt;&lt;p&gt;If the last &lt;a href=#menu-item-construct id=the-menu-element:menu-item-construct-4&gt;menu item construct&lt;/a&gt; in &lt;var&gt;output&lt;/var&gt; is a &lt;a href=#concept-separator id=the-menu-element:concept-separator-7&gt;separator&lt;/a&gt;, then remove it.&lt;li&gt;&lt;p&gt;Return &lt;var&gt;output&lt;/var&gt;.&lt;/ol&gt;
+
   &lt;hr&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-menu-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt; IDL attribute must &lt;a href=#reflect id=the-menu-element:reflect&gt;reflect&lt;/a&gt;
@@ -43197,7 +43201,7 @@
   to &lt;var&gt;subject&lt;/var&gt;. The event must be cancelable. &lt;/p&gt;
 
   &lt;p&gt;If &lt;em&gt;this&lt;/em&gt; event (the &lt;code id=processing-model-5:event-show-2&gt;&lt;a href=#event-show&gt;show&lt;/a&gt;&lt;/code&gt; event) is not canceled, then
-  the user agent must &lt;a href=#construct-and-show-a-menu id=processing-model-5:construct-and-show-a-menu&gt;construct and show&lt;/a&gt; the menu for
+  the user agent must &lt;a href=#build-and-show-a-menu id=processing-model-5:build-and-show-a-menu&gt;build and show&lt;/a&gt; the menu for
   &lt;var&gt;menu&lt;/var&gt; with &lt;var&gt;subject&lt;/var&gt; as the subject.&lt;/p&gt;
 
   &lt;p&gt;The user agent may also provide access to its default context menu, if any, with the context

Modified: index
===================================================================
--- index	2014-08-26 18:59:17 UTC (rev 8716)
+++ index	2014-08-26 20:44:24 UTC (rev 8717)
@@ -37278,7 +37278,7 @@
      active&lt;/a&gt;, abort these steps.&lt;li&gt;&lt;p&gt;Let &lt;var&gt;menu&lt;/var&gt; be the element's &lt;a href=#designated-pop-up-menu id=the-button-element:designated-pop-up-menu-2&gt;designated pop-up menu&lt;/a&gt;, if
      any. If there isn't one, then abort these steps.&lt;li&gt;&lt;p&gt;&lt;a href=#concept-event-fire id=the-button-element:concept-event-fire&gt;Fire&lt;/a&gt; a &lt;a href=#concept-events-trusted id=the-button-element:concept-events-trusted&gt;trusted&lt;/a&gt; event with the name &lt;code id=the-button-element:event-show&gt;&lt;a href=#event-show&gt;show&lt;/a&gt;&lt;/code&gt; at &lt;var&gt;menu&lt;/var&gt;, using the &lt;code id=the-button-element:relatedevent&gt;&lt;a href=#relatedevent&gt;RelatedEvent&lt;/a&gt;&lt;/code&gt;
      interface, with the &lt;code id=the-button-element:dom-relatedevent-relatedtarget&gt;&lt;a href=#dom-relatedevent-relatedtarget&gt;relatedTarget&lt;/a&gt;&lt;/code&gt; attribute
-     initialised to the &lt;code id=the-button-element:the-button-element-6&gt;&lt;a href=#the-button-element&gt;button&lt;/a&gt;&lt;/code&gt; element. The event must be cancelable. &lt;li&gt;&lt;p&gt;If the event is not canceled, then &lt;a href=#construct-and-show-a-menu id=the-button-element:construct-and-show-a-menu&gt;construct and
+     initialised to the &lt;code id=the-button-element:the-button-element-6&gt;&lt;a href=#the-button-element&gt;button&lt;/a&gt;&lt;/code&gt; element. The event must be cancelable. &lt;li&gt;&lt;p&gt;If the event is not canceled, then &lt;a href=#build-and-show-a-menu id=the-button-element:build-and-show-a-menu&gt;build and
      show&lt;/a&gt; the menu for &lt;var&gt;menu&lt;/var&gt;, with the &lt;code id=the-button-element:the-button-element-7&gt;&lt;a href=#the-button-element&gt;button&lt;/a&gt;&lt;/code&gt; element as the
      subject.&lt;/ol&gt;
 
@@ -42830,50 +42830,54 @@
 
   &lt;hr&gt;
 
-  &lt;p&gt;A pop-up menu consists of a list of zero or more menu items, which can be any of:&lt;/p&gt;
+  &lt;p&gt;A &lt;dfn id=menu-construct&gt;menu construct&lt;/dfn&gt; consists of an ordered list of zero or more &lt;dfn id=menu-item-construct&gt;menu item constructs&lt;/dfn&gt;, which can be any of:&lt;/p&gt;
 
-  &lt;ul class=brief&gt;&lt;li&gt;&lt;a href=#concept-command id=the-menu-element:concept-command&gt;Commands&lt;/a&gt;, which can be marked as default commands (&lt;code id=the-menu-element:the-menuitem-element-2&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt;)&lt;li&gt;Separators (&lt;code id=the-menu-element:the-hr-element-2&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt;)&lt;li&gt;Other menus, which allows the list to be nested (&lt;code id=the-menu-element:the-menu-element-10&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt;)&lt;/ul&gt;
+  &lt;ul class=brief&gt;&lt;li&gt;&lt;a href=#concept-command id=the-menu-element:concept-command&gt;Commands&lt;/a&gt;, which can be marked as &lt;dfn id=default-command&gt;default commands&lt;/dfn&gt; (&lt;code id=the-menu-element:the-menuitem-element-2&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt;)&lt;li&gt;&lt;dfn id=concept-separator&gt;Separators&lt;/dfn&gt; (&lt;code id=the-menu-element:the-hr-element-2&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt;)&lt;li&gt;Other &lt;a href=#menu-construct id=the-menu-element:menu-construct&gt;menu constructs&lt;/a&gt;, each with an associated &lt;dfn id=submenu-label&gt;submenu label&lt;/dfn&gt;, which allows the list to be nested (&lt;code id=the-menu-element:the-menu-element-10&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt;)&lt;/ul&gt;
 
-  &lt;p&gt;To &lt;dfn id=construct-and-show-a-menu&gt;construct and show a menu&lt;/dfn&gt; for a particular &lt;code id=the-menu-element:the-menu-element-11&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element and with a
-  particular element as a subject, the user agent must run the following steps:&lt;/p&gt;
+  &lt;p&gt;To &lt;dfn id=build-and-show-a-menu&gt;build and show a menu&lt;/dfn&gt; for a particular &lt;code id=the-menu-element:the-menu-element-11&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element
+  &lt;var&gt;source&lt;/var&gt; and with a particular element &lt;var&gt;subject&lt;/var&gt; as a subject, the user agent
+  must run the following steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let the menu be an empty list of the type described above.&lt;li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var&gt;pop-up menu&lt;/var&gt; be the &lt;a href=#menu-construct id=the-menu-element:menu-construct-2&gt;menu construct&lt;/a&gt; created by the &lt;a href=#build-a-menu-construct id=the-menu-element:build-a-menu-construct&gt;build a
+   menu construct&lt;/a&gt; algorithm when passed the &lt;var&gt;source&lt;/var&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;Run the &lt;a href=#menu-builder id=the-menu-element:menu-builder&gt;menu builder&lt;/a&gt; steps for the &lt;code id=the-menu-element:the-menu-element-12&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using the menu
-    prepared in the previous list as the output.&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;The &lt;dfn id=menu-builder&gt;menu builder&lt;/dfn&gt; steps for a &lt;code id=the-menu-element:the-menu-element-13&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using a specific menu as
-    output are as follows: For each child node of the &lt;code id=the-menu-element:the-menu-element-14&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; in &lt;a href=#tree-order id=the-menu-element:tree-order&gt;tree order&lt;/a&gt;,
-    run the appropriate steps from the following list:&lt;/p&gt;
+    &lt;p&gt;Display &lt;var&gt;pop-up menu&lt;/var&gt; to the user, and let the algorithm that invoked this one continue.&lt;/p&gt;
 
-    &lt;dl class=switch&gt;&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menuitem-element-3&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt; element that &lt;a href=#concept-command id=the-menu-element:concept-command-2&gt;defines
-     a command&lt;/a&gt;&lt;dd&gt;Append the command to the menu, respecting its &lt;a href=#concept-facet id=the-menu-element:concept-facet&gt;facets&lt;/a&gt;. If the &lt;code id=the-menu-element:the-menuitem-element-4&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt; element has a &lt;code id=the-menu-element:attr-menuitem-default&gt;&lt;a href=#attr-menuitem-default&gt;default&lt;/a&gt;&lt;/code&gt; attribute, mark the command as being a default
-     command.&lt;dt&gt;If the child is an &lt;code id=the-menu-element:the-hr-element-3&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt; element&lt;dd&gt;Append a separator to the menu.&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menu-element-15&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element with no &lt;code id=the-menu-element:attr-menu-label-4&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute&lt;dd&gt;Append a separator to the menu, then run the &lt;a href=#menu-builder id=the-menu-element:menu-builder-2&gt;menu builder&lt;/a&gt; steps using this
-     child &lt;code id=the-menu-element:the-menu-element-16&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element for the same menu, then append another separator to the
-     menu.&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menu-element-17&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element with a &lt;code id=the-menu-element:attr-menu-label-5&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute&lt;dd&gt;Create a new submenu as an empty list of the type described above, and construct it by
-     running the &lt;a href=#menu-builder id=the-menu-element:menu-builder-3&gt;menu builder&lt;/a&gt; steps for the child &lt;code id=the-menu-element:the-menu-element-18&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using the
-     new submenu as the output. Then, append the submenu to the menu, using the value of the child
-     &lt;code id=the-menu-element:the-menu-element-19&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element's &lt;code id=the-menu-element:attr-menu-label-6&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute as the label
-     of the submenu.&lt;dt&gt;Otherwise&lt;dd&gt;&lt;a href=#ignore id=the-menu-element:ignore&gt;Ignore&lt;/a&gt; the child node.&lt;/dl&gt;
-
-   &lt;li&gt;&lt;p&gt;Remove any submenu with no label, or whose label is the empty string, in the menu or any
-   submenus.&lt;li&gt;&lt;p&gt;Remove any menu item with no label, or whose label is the empty string, in the menu or any
-   submenus.&lt;li&gt;&lt;p&gt;Collapse all sequences of two or more adjacent separators in the menu or any submenus to a
-   single separator.&lt;li&gt;&lt;p&gt;Remove all separators at the start or end of the menu and any submenus.&lt;li&gt;
-
-    &lt;p&gt;Display the menu to the user, and let the algorithm that invoked this one continue.&lt;/p&gt;
-
-    &lt;p&gt;If the user selects a menu item that corresponds to an element that still represents a &lt;a href=#concept-command id=the-menu-element:concept-command-3&gt;command&lt;/a&gt; when the user selects it, then the UA must invoke that
+    &lt;p&gt;If the user selects a &lt;a href=#menu-item-construct id=the-menu-element:menu-item-construct&gt;menu item construct&lt;/a&gt; that corresponds to an element that still represents a &lt;a href=#concept-command id=the-menu-element:concept-command-2&gt;command&lt;/a&gt; when the user selects it, then the UA must invoke that
     command's &lt;a href=#command-facet-action id=the-menu-element:command-facet-action&gt;Action&lt;/a&gt;. If the command's &lt;a href=#command-facet-action id=the-menu-element:command-facet-action-2&gt;Action&lt;/a&gt; is defined as &lt;a href=#fire-a-click-event id=the-menu-element:fire-a-click-event&gt;firing
     a &lt;code&gt;click&lt;/code&gt; event&lt;/a&gt;, either directly or via the &lt;a href=#run-synthetic-click-activation-steps id=the-menu-element:run-synthetic-click-activation-steps&gt;run
-    synthetic click activation steps&lt;/a&gt; algorithm, then the &lt;code id=the-menu-element:dom-mouseevent-relatedtarget&gt;&lt;a href=#dom-mouseevent-relatedtarget&gt;relatedTarget&lt;/a&gt;&lt;/code&gt; attribute of that &lt;code id=the-menu-element:event-click&gt;&lt;a href=#event-click&gt;click&lt;/a&gt;&lt;/code&gt; event must be initialised to the subject passed to this
-    &lt;a href=#construct-and-show-a-menu id=the-menu-element:construct-and-show-a-menu&gt;construct and show a menu&lt;/a&gt; algorithm.&lt;/p&gt;
+    synthetic click activation steps&lt;/a&gt; algorithm, then the &lt;code id=the-menu-element:dom-mouseevent-relatedtarget&gt;&lt;a href=#dom-mouseevent-relatedtarget&gt;relatedTarget&lt;/a&gt;&lt;/code&gt; attribute of that &lt;code id=the-menu-element:event-click&gt;&lt;a href=#event-click&gt;click&lt;/a&gt;&lt;/code&gt; event must be initialised to &lt;var&gt;subject&lt;/var&gt;.&lt;/p&gt;
 
     &lt;p&gt;Pop-up menus must not, while being shown, reflect changes in the DOM. The menu is constructed
     from the DOM before being shown, and is then immutable.&lt;/p&gt;
 
    &lt;/ol&gt;
 
+  &lt;p&gt;To &lt;dfn id=build-a-menu-construct&gt;build a menu construct&lt;/dfn&gt; for an element &lt;var&gt;source&lt;/var&gt;, the user agent must run
+  the following steps, which return a &lt;a href=#menu-construct id=the-menu-element:menu-construct-3&gt;menu construct&lt;/a&gt;:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var&gt;generated menu&lt;/var&gt; be an empty &lt;a href=#menu-construct id=the-menu-element:menu-construct-4&gt;menu construct&lt;/a&gt;.&lt;li&gt;
+
+    &lt;p&gt;Run the &lt;a href=#menu-item-generator id=the-menu-element:menu-item-generator&gt;menu item generator&lt;/a&gt; steps for the &lt;code id=the-menu-element:the-menu-element-12&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using &lt;var&gt;generated menu&lt;/var&gt;
+    as the output.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;dfn id=menu-item-generator&gt;menu item generator&lt;/dfn&gt; steps for a &lt;code id=the-menu-element:the-menu-element-13&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element using a specific &lt;a href=#menu-construct id=the-menu-element:menu-construct-5&gt;menu construct&lt;/a&gt; &lt;var&gt;output&lt;/var&gt; as
+    output are as follows: For each child node of the &lt;code id=the-menu-element:the-menu-element-14&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; in &lt;a href=#tree-order id=the-menu-element:tree-order&gt;tree order&lt;/a&gt;,
+    run the appropriate steps from the following list:&lt;/p&gt;
+
+    &lt;dl class=switch&gt;&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menuitem-element-3&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt; element that &lt;a href=#concept-command id=the-menu-element:concept-command-3&gt;defines
+     a command&lt;/a&gt;&lt;dd&gt;Append the &lt;a href=#concept-command id=the-menu-element:concept-command-4&gt;command&lt;/a&gt; to &lt;var&gt;output&lt;/var&gt;, respecting the command's &lt;a href=#concept-facet id=the-menu-element:concept-facet&gt;facets&lt;/a&gt;. If the &lt;code id=the-menu-element:the-menuitem-element-4&gt;&lt;a href=#the-menuitem-element&gt;menuitem&lt;/a&gt;&lt;/code&gt; element has a &lt;code id=the-menu-element:attr-menuitem-default&gt;&lt;a href=#attr-menuitem-default&gt;default&lt;/a&gt;&lt;/code&gt; attribute, mark the &lt;span&gt;command&lt;/span&gt; as being a &lt;a href=#default-command id=the-menu-element:default-command&gt;default
+     command&lt;/a&gt;.&lt;dt&gt;If the child is an &lt;code id=the-menu-element:the-hr-element-3&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt; element&lt;dd&gt;Append a &lt;a href=#concept-separator id=the-menu-element:concept-separator&gt;separator&lt;/a&gt; to &lt;var&gt;output&lt;/var&gt;.&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menu-element-15&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element with no &lt;code id=the-menu-element:attr-menu-label-4&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute&lt;dd&gt;Append a &lt;a href=#concept-separator id=the-menu-element:concept-separator-2&gt;separator&lt;/a&gt; to &lt;var&gt;output&lt;/var&gt;, then run
+     the &lt;a href=#menu-item-generator id=the-menu-element:menu-item-generator-2&gt;menu item generator&lt;/a&gt; steps for this child &lt;code id=the-menu-element:the-menu-element-16&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element, using
+     &lt;var&gt;output&lt;/var&gt; as the output, then append another &lt;a href=#concept-separator id=the-menu-element:concept-separator-3&gt;separator&lt;/a&gt; to &lt;var&gt;output&lt;/var&gt;.&lt;dt&gt;If the child is a &lt;code id=the-menu-element:the-menu-element-17&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element with a &lt;code id=the-menu-element:attr-menu-label-5&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute&lt;dd&gt;Let &lt;var&gt;submenu&lt;/var&gt; be the result of running the &lt;a href=#build-a-menu-construct id=the-menu-element:build-a-menu-construct-2&gt;build a menu construct&lt;/a&gt; steps for the child &lt;code id=the-menu-element:the-menu-element-18&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element. Then, append &lt;var&gt;submenu&lt;/var&gt; to &lt;var&gt;output&lt;/var&gt;, using the value of the child
+     &lt;code id=the-menu-element:the-menu-element-19&gt;&lt;a href=#the-menu-element&gt;menu&lt;/a&gt;&lt;/code&gt; element's &lt;code id=the-menu-element:attr-menu-label-6&gt;&lt;a href=#attr-menu-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute as the &lt;a href=#submenu-label id=the-menu-element:submenu-label&gt;submenu label&lt;/a&gt;.&lt;dt&gt;Otherwise&lt;dd&gt;&lt;a href=#ignore id=the-menu-element:ignore&gt;Ignore&lt;/a&gt; the child node.&lt;/dl&gt;
+
+   &lt;li&gt;&lt;p&gt;Remove from &lt;var&gt;output&lt;/var&gt; any &lt;a href=#menu-construct id=the-menu-element:menu-construct-6&gt;menu construct&lt;/a&gt; whose &lt;a href=#submenu-label id=the-menu-element:submenu-label-2&gt;submenu
+   label&lt;/a&gt; is the empty string.&lt;li&gt;&lt;p&gt;Remove from &lt;var&gt;output&lt;/var&gt; any &lt;a href=#menu-item-construct id=the-menu-element:menu-item-construct-2&gt;menu item construct&lt;/a&gt; representing a &lt;a href=#concept-command id=the-menu-element:concept-command-5&gt;command&lt;/a&gt; whose &lt;a href=#command-facet-label id=the-menu-element:command-facet-label&gt;Label&lt;/a&gt; is
+   the empty string.&lt;li&gt;&lt;p&gt;Collapse all sequences of two or more adjacent &lt;a href=#concept-separator id=the-menu-element:concept-separator-4&gt;separators&lt;/a&gt; in &lt;var&gt;output&lt;/var&gt; to a single &lt;a href=#concept-separator id=the-menu-element:concept-separator-5&gt;separator&lt;/a&gt;.&lt;li&gt;&lt;p&gt;If the first &lt;a href=#menu-item-construct id=the-menu-element:menu-item-construct-3&gt;menu item construct&lt;/a&gt; in &lt;var&gt;output&lt;/var&gt; is a &lt;a href=#concept-separator id=the-menu-element:concept-separator-6&gt;separator&lt;/a&gt;, then remove it.&lt;li&gt;&lt;p&gt;If the last &lt;a href=#menu-item-construct id=the-menu-element:menu-item-construct-4&gt;menu item construct&lt;/a&gt; in &lt;var&gt;output&lt;/var&gt; is a &lt;a href=#concept-separator id=the-menu-element:concept-separator-7&gt;separator&lt;/a&gt;, then remove it.&lt;li&gt;&lt;p&gt;Return &lt;var&gt;output&lt;/var&gt;.&lt;/ol&gt;
+
   &lt;hr&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-menu-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt; IDL attribute must &lt;a href=#reflect id=the-menu-element:reflect&gt;reflect&lt;/a&gt;
@@ -43197,7 +43201,7 @@
   to &lt;var&gt;subject&lt;/var&gt;. The event must be cancelable. &lt;/p&gt;
 
   &lt;p&gt;If &lt;em&gt;this&lt;/em&gt; event (the &lt;code id=processing-model-5:event-show-2&gt;&lt;a href=#event-show&gt;show&lt;/a&gt;&lt;/code&gt; event) is not canceled, then
-  the user agent must &lt;a href=#construct-and-show-a-menu id=processing-model-5:construct-and-show-a-menu&gt;construct and show&lt;/a&gt; the menu for
+  the user agent must &lt;a href=#build-and-show-a-menu id=processing-model-5:build-and-show-a-menu&gt;build and show&lt;/a&gt; the menu for
   &lt;var&gt;menu&lt;/var&gt; with &lt;var&gt;subject&lt;/var&gt; as the subject.&lt;/p&gt;
 
   &lt;p&gt;The user agent may also provide access to its default context menu, if any, with the context

Modified: source
===================================================================
--- source	2014-08-26 18:59:17 UTC (rev 8716)
+++ source	2014-08-26 20:44:24 UTC (rev 8717)
@@ -47892,7 +47892,7 @@
      initialised to the &lt;code&gt;button&lt;/code&gt; element. The event must be cancelable. &lt;!-- v2: include
      modifier key information --&gt;&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If the event is not canceled, then &lt;span data-x=&quot;construct and show a menu&quot;&gt;construct and
+     &lt;li&gt;&lt;p&gt;If the event is not canceled, then &lt;span data-x=&quot;build and show a menu&quot;&gt;build and
      show&lt;/span&gt; the menu for &lt;var&gt;menu&lt;/var&gt;, with the &lt;code&gt;button&lt;/code&gt; element as the
      subject.&lt;/p&gt;&lt;/li&gt;
 
@@ -55508,27 +55508,56 @@
 
   &lt;hr&gt;
 
-  &lt;p&gt;A pop-up menu consists of a list of zero or more menu items, which can be any of:&lt;/p&gt;
+  &lt;p&gt;A &lt;dfn&gt;menu construct&lt;/dfn&gt; consists of an ordered list of zero or more &lt;dfn data-x=&quot;menu item construct&quot;&gt;menu item constructs&lt;/dfn&gt;, which can be any of:&lt;/p&gt;
 
   &lt;ul class=&quot;brief&quot;&gt;
-   &lt;li&gt;&lt;span data-x=&quot;concept-command&quot;&gt;Commands&lt;/span&gt;, which can be marked as default commands (&lt;code&gt;menuitem&lt;/code&gt;)&lt;/li&gt;
-   &lt;li&gt;Separators (&lt;code&gt;hr&lt;/code&gt;)&lt;/li&gt;
-   &lt;li&gt;Other menus, which allows the list to be nested (&lt;code&gt;menu&lt;/code&gt;)&lt;/li&gt;
+   &lt;li&gt;&lt;span data-x=&quot;concept-command&quot;&gt;Commands&lt;/span&gt;, which can be marked as &lt;dfn data-x=&quot;default command&quot;&gt;default commands&lt;/dfn&gt; (&lt;code&gt;menuitem&lt;/code&gt;)&lt;/li&gt;
+   &lt;li&gt;&lt;dfn data-x=&quot;concept-separator&quot;&gt;Separators&lt;/dfn&gt; (&lt;code&gt;hr&lt;/code&gt;)&lt;/li&gt;
+   &lt;li&gt;Other &lt;span data-x=&quot;menu construct&quot;&gt;menu constructs&lt;/span&gt;, each with an associated &lt;dfn&gt;submenu label&lt;/dfn&gt;, which allows the list to be nested (&lt;code&gt;menu&lt;/code&gt;)&lt;/li&gt;
   &lt;/ul&gt;
 
-  &lt;p&gt;To &lt;dfn&gt;construct and show a menu&lt;/dfn&gt; for a particular &lt;code&gt;menu&lt;/code&gt; element and with a
-  particular element as a subject, the user agent must run the following steps:&lt;/p&gt;
+  &lt;p&gt;To &lt;dfn&gt;build and show a menu&lt;/dfn&gt; for a particular &lt;code&gt;menu&lt;/code&gt; element
+  &lt;var&gt;source&lt;/var&gt; and with a particular element &lt;var&gt;subject&lt;/var&gt; as a subject, the user agent
+  must run the following steps:&lt;/p&gt;
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;Let the menu be an empty list of the type described above.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var&gt;pop-up menu&lt;/var&gt; be the &lt;span&gt;menu construct&lt;/span&gt; created by the &lt;span&gt;build a
+   menu construct&lt;/span&gt; algorithm when passed the &lt;var&gt;source&lt;/var&gt; element.&lt;/p&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Run the &lt;span&gt;menu builder&lt;/span&gt; steps for the &lt;code&gt;menu&lt;/code&gt; element using the menu
-    prepared in the previous list as the output.&lt;/p&gt;
+    &lt;p&gt;Display &lt;var&gt;pop-up menu&lt;/var&gt; to the user, and let the algorithm that invoked this one continue.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;dfn&gt;menu builder&lt;/dfn&gt; steps for a &lt;code&gt;menu&lt;/code&gt; element using a specific menu as
+    &lt;p&gt;If the user selects a &lt;span&gt;menu item construct&lt;/span&gt; that corresponds to an element that still represents a &lt;span
+    data-x=&quot;concept-command&quot;&gt;command&lt;/span&gt; when the user selects it, then the UA must invoke that
+    command's &lt;span data-x=&quot;command-facet-Action&quot;&gt;Action&lt;/span&gt;. If the command's &lt;span
+    data-x=&quot;command-facet-Action&quot;&gt;Action&lt;/span&gt; is defined as &lt;span data-x=&quot;fire a click event&quot;&gt;firing
+    a &lt;code data-x=&quot;event-click&quot;&gt;click&lt;/code&gt; event&lt;/span&gt;, either directly or via the &lt;span&gt;run
+    synthetic click activation steps&lt;/span&gt; algorithm, then the &lt;code
+    data-x=&quot;dom-MouseEvent-relatedTarget&quot;&gt;relatedTarget&lt;/code&gt; attribute of that &lt;code
+    data-x=&quot;event-click&quot;&gt;click&lt;/code&gt; event must be initialised to &lt;var&gt;subject&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Pop-up menus must not, while being shown, reflect changes in the DOM. The menu is constructed
+    from the DOM before being shown, and is then immutable.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;To &lt;dfn&gt;build a menu construct&lt;/dfn&gt; for an element &lt;var&gt;source&lt;/var&gt;, the user agent must run
+  the following steps, which return a &lt;span&gt;menu construct&lt;/span&gt;:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var&gt;generated menu&lt;/var&gt; be an empty &lt;span&gt;menu construct&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Run the &lt;span&gt;menu item generator&lt;/span&gt; steps for the &lt;code&gt;menu&lt;/code&gt; element using &lt;var&gt;generated menu&lt;/var&gt;
+    as the output.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;dfn&gt;menu item generator&lt;/dfn&gt; steps for a &lt;code&gt;menu&lt;/code&gt; element using a specific &lt;span&gt;menu construct&lt;/span&gt; &lt;var&gt;output&lt;/var&gt; as
     output are as follows: For each child node of the &lt;code&gt;menu&lt;/code&gt; in &lt;span&gt;tree order&lt;/span&gt;,
     run the appropriate steps from the following list:&lt;/p&gt;
 
@@ -55537,7 +55566,7 @@
      &lt;dt&gt;If the child is a &lt;code&gt;menuitem&lt;/code&gt; element that &lt;span data-x=&quot;concept-command&quot;&gt;defines
      a command&lt;/span&gt;&lt;/dt&gt;
 
-     &lt;dd&gt;Append the command to the menu, respecting its &lt;span
+     &lt;dd&gt;Append the &lt;span data-x=&quot;concept-command&quot;&gt;command&lt;/span&gt; to &lt;var&gt;output&lt;/var&gt;, respecting the command's &lt;span
      data-x=&quot;concept-facet&quot;&gt;facets&lt;/span&gt;&lt;!-- we might need to be explicit about what this means for
      each facet, if testing shows this isn't well-implemented. e.g.: If there's an Icon facet for
      the command, it should be &lt;span data-x=&quot;fetch&quot;&gt;fetched&lt;/span&gt;&lt;!- -FETCH- -&gt; (this would be
@@ -55545,29 +55574,27 @@
      that each command only has its image fetched once, to prevent changes to the base URL from
      having effects after the image has been fetched once. (no need to resolve the Icon facet, it's
      an absolute URL) --&gt;. If the &lt;code&gt;menuitem&lt;/code&gt; element has a &lt;code
-     data-x=&quot;attr-menuitem-default&quot;&gt;default&lt;/code&gt; attribute, mark the command as being a default
-     command.&lt;/dd&gt;
+     data-x=&quot;attr-menuitem-default&quot;&gt;default&lt;/code&gt; attribute, mark the &lt;span&gt;command&lt;/span&gt; as being a &lt;span&gt;default
+     command&lt;/span&gt;.&lt;/dd&gt;
 
 
      &lt;dt&gt;If the child is an &lt;code&gt;hr&lt;/code&gt; element&lt;/dt&gt;
 
-     &lt;dd&gt;Append a separator to the menu.&lt;/dd&gt;
+     &lt;dd&gt;Append a &lt;span data-x=&quot;concept-separator&quot;&gt;separator&lt;/span&gt; to &lt;var&gt;output&lt;/var&gt;.&lt;/dd&gt;
 
 
      &lt;dt&gt;If the child is a &lt;code&gt;menu&lt;/code&gt; element with no &lt;code data-x=&quot;attr-menu-label&quot;&gt;label&lt;/code&gt; attribute&lt;/dt&gt;
 
-     &lt;dd&gt;Append a separator to the menu, then run the &lt;span&gt;menu builder&lt;/span&gt; steps using this
-     child &lt;code&gt;menu&lt;/code&gt; element for the same menu, then append another separator to the
-     menu.&lt;/dd&gt;
+     &lt;dd&gt;Append a &lt;span data-x=&quot;concept-separator&quot;&gt;separator&lt;/span&gt; to &lt;var&gt;output&lt;/var&gt;, then run
+     the &lt;span&gt;menu item generator&lt;/span&gt; steps for this child &lt;code&gt;menu&lt;/code&gt; element, using
+     &lt;var&gt;output&lt;/var&gt; as the output, then append another &lt;span
+     data-x=&quot;concept-separator&quot;&gt;separator&lt;/span&gt; to &lt;var&gt;output&lt;/var&gt;.&lt;/dd&gt;
 
 
      &lt;dt&gt;If the child is a &lt;code&gt;menu&lt;/code&gt; element with a &lt;code data-x=&quot;attr-menu-label&quot;&gt;label&lt;/code&gt; attribute&lt;/dt&gt;
 
-     &lt;dd&gt;Create a new submenu as an empty list of the type described above, and construct it by
-     running the &lt;span&gt;menu builder&lt;/span&gt; steps for the child &lt;code&gt;menu&lt;/code&gt; element using the
-     new submenu as the output. Then, append the submenu to the menu, using the value of the child
-     &lt;code&gt;menu&lt;/code&gt; element's &lt;code data-x=&quot;attr-menu-label&quot;&gt;label&lt;/code&gt; attribute as the label
-     of the submenu.&lt;/dd&gt;
+     &lt;dd&gt;Let &lt;var&gt;submenu&lt;/var&gt; be the result of running the &lt;span&gt;build a menu construct&lt;/span&gt; steps for the child &lt;code&gt;menu&lt;/code&gt; element. Then, append &lt;var&gt;submenu&lt;/var&gt; to &lt;var&gt;output&lt;/var&gt;, using the value of the child
+     &lt;code&gt;menu&lt;/code&gt; element's &lt;code data-x=&quot;attr-menu-label&quot;&gt;label&lt;/code&gt; attribute as the &lt;span&gt;submenu label&lt;/span&gt;.&lt;/dd&gt;
 
 
      &lt;dt&gt;Otherwise&lt;/dt&gt;
@@ -55578,36 +55605,25 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Remove any submenu with no label, or whose label is the empty string, in the menu or any
-   submenus.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Remove from &lt;var&gt;output&lt;/var&gt; any &lt;span&gt;menu construct&lt;/span&gt; whose &lt;span&gt;submenu
+   label&lt;/span&gt; is the empty string.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Remove any menu item with no label, or whose label is the empty string, in the menu or any
-   submenus.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Remove from &lt;var&gt;output&lt;/var&gt; any &lt;span&gt;menu item construct&lt;/span&gt; representing a &lt;span
+   data-x=&quot;concept-command&quot;&gt;command&lt;/span&gt; whose &lt;span data-x=&quot;command-facet-label&quot;&gt;Label&lt;/span&gt; is
+   the empty string.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Collapse all sequences of two or more adjacent separators in the menu or any submenus to a
-   single separator.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Collapse all sequences of two or more adjacent &lt;span
+   data-x=&quot;concept-separator&quot;&gt;separators&lt;/span&gt; in &lt;var&gt;output&lt;/var&gt; to a single &lt;span
+   data-x=&quot;concept-separator&quot;&gt;separator&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Remove all separators at the start or end of the menu and any submenus.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the first &lt;span&gt;menu item construct&lt;/span&gt; in &lt;var&gt;output&lt;/var&gt; is a &lt;span
+   data-x=&quot;concept-separator&quot;&gt;separator&lt;/span&gt;, then remove it.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If the last &lt;span&gt;menu item construct&lt;/span&gt; in &lt;var&gt;output&lt;/var&gt; is a &lt;span
+   data-x=&quot;concept-separator&quot;&gt;separator&lt;/span&gt;, then remove it.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;Display the menu to the user, and let the algorithm that invoked this one continue.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;If the user selects a menu item that corresponds to an element that still represents a &lt;span
-    data-x=&quot;concept-command&quot;&gt;command&lt;/span&gt; when the user selects it, then the UA must invoke that
-    command's &lt;span data-x=&quot;command-facet-Action&quot;&gt;Action&lt;/span&gt;. If the command's &lt;span
-    data-x=&quot;command-facet-Action&quot;&gt;Action&lt;/span&gt; is defined as &lt;span data-x=&quot;fire a click event&quot;&gt;firing
-    a &lt;code data-x=&quot;event-click&quot;&gt;click&lt;/code&gt; event&lt;/span&gt;, either directly or via the &lt;span&gt;run
-    synthetic click activation steps&lt;/span&gt; algorithm, then the &lt;code
-    data-x=&quot;dom-MouseEvent-relatedTarget&quot;&gt;relatedTarget&lt;/code&gt; attribute of that &lt;code
-    data-x=&quot;event-click&quot;&gt;click&lt;/code&gt; event must be initialised to the subject passed to this
-    &lt;span&gt;construct and show a menu&lt;/span&gt; algorithm.&lt;/p&gt;
-
-    &lt;p&gt;Pop-up menus must not, while being shown, reflect changes in the DOM. The menu is constructed
-    from the DOM before being shown, and is then immutable.&lt;/p&gt;
-
-   &lt;/li&gt;
-
   &lt;/ol&gt;
 
   &lt;hr&gt;
@@ -56036,7 +56052,7 @@
   --&gt;&lt;/p&gt;
 
   &lt;p&gt;If &lt;em&gt;this&lt;/em&gt; event (the &lt;code data-x=&quot;event-show&quot;&gt;show&lt;/code&gt; event) is not canceled, then
-  the user agent must &lt;span data-x=&quot;construct and show a menu&quot;&gt;construct and show&lt;/span&gt; the menu for
+  the user agent must &lt;span data-x=&quot;build and show a menu&quot;&gt;build and show&lt;/span&gt; the menu for
   &lt;var&gt;menu&lt;/var&gt; with &lt;var&gt;subject&lt;/var&gt; as the subject.&lt;/p&gt;
 
   &lt;p&gt;The user agent may also provide access to its default context menu, if any, with the context

</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023320.html">[html5] r8716 - [giow] (1) Define &lt;video&gt;.srcObject Fixing	https://www.w3.org/Bugs/Public/show_b [...]
</A></li>
	<LI>Next message: <A HREF="023322.html">[html5] r8718 - [giow] (2) Make sure reset() can't fire a popup	Fixing https://www.w3.org/Bugs/P [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23321">[ date ]</a>
              <a href="thread.html#23321">[ thread ]</a>
              <a href="subject.html#23321">[ subject ]</a>
              <a href="author.html#23321">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
