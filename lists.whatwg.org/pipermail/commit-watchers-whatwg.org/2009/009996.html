<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r3115 - [giw] (2) Fix how drag and drop exports data.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r3115%20-%20%5Bgiw%5D%20%282%29%20Fix%20how%20drag%20and%20drop%20exports%20data.&In-Reply-To=%3C20090519011151.19EE61389F2%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009995.html">
   <LINK REL="Next"  HREF="009997.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r3115 - [giw] (2) Fix how drag and drop exports data.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r3115%20-%20%5Bgiw%5D%20%282%29%20Fix%20how%20drag%20and%20drop%20exports%20data.&In-Reply-To=%3C20090519011151.19EE61389F2%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r3115 - [giw] (2) Fix how drag and drop exports data.">whatwg at whatwg.org
       </A><BR>
    <I>Mon May 18 18:11:51 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009995.html">[html5] r3114 - [] (0) Include microdata when dragging-and-dropping	or copying-and-pasting.
</A></li>
        <LI>Next message: <A HREF="009997.html">[html5] r3116 - [act] (0) How to extract an Atom feed from an HTML5	document
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9996">[ date ]</a>
              <a href="thread.html#9996">[ thread ]</a>
              <a href="subject.html#9996">[ subject ]</a>
              <a href="author.html#9996">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-05-18 18:11:49 -0700 (Mon, 18 May 2009)
New Revision: 3115

Modified:
   index
   source
Log:
[giw] (2) Fix how drag and drop exports data.

Modified: index
===================================================================
--- index	2009-05-18 08:23:17 UTC (rev 3114)
+++ index	2009-05-19 01:11:49 UTC (rev 3115)
@@ -39,7 +39,7 @@
   &lt;div class=head&gt;
    &lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;h1&gt;HTML 5&lt;/h1&gt;
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 18 May 2009&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 19 May 2009&lt;/h2&gt;
    &lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;dl&gt;&lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -43941,22 +43941,17 @@
 
    &lt;li&gt;&lt;p&gt;Add an entry to &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; called &quot;&lt;code title=&quot;&quot;&gt;items&lt;/code&gt;&quot; whose value is the array &lt;var title=&quot;&quot;&gt;items&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current node&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;citations&lt;/var&gt; be an empty
+   array.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; be null.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;For each &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; that is &lt;a href=#sectioning-content-0&gt;sectioning content&lt;/a&gt;, check
+   if there are any &lt;code&gt;&lt;a href=#the-footer-element&gt;footer&lt;/a&gt;&lt;/code&gt; elements that &lt;a href=#applyToSection&gt;apply&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; and
+   that contain any elements that are &lt;a href=#top-level-microdata-items title=&quot;top-level microdata
+   items&quot;&gt;top-level microdata items&lt;/a&gt; with the type &lt;code title=md-bibtex&gt;&lt;a href=#md-bibtex&gt;bibtex&lt;/a&gt;&lt;/code&gt;, and if so, then &lt;a href=#get-the-object&gt;get the
+   object&lt;/a&gt; for each such element and add them to &lt;var title=&quot;&quot;&gt;citations&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Citation search:&lt;/i&gt; If &lt;var title=&quot;&quot;&gt;current node&lt;/var&gt;
-   has a descendant element that is a &lt;a href=#top-level-microdata-items title=&quot;top-level microdata
-   items&quot;&gt;top-level microdata item&lt;/a&gt; with the type &lt;code title=md-bibtex&gt;&lt;a href=#md-bibtex&gt;bibtex&lt;/a&gt;&lt;/code&gt;, then &lt;a href=#get-the-object&gt;get the object&lt;/a&gt;
-   for the first such element in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; and let &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; be that object.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Add an entry to &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; called &quot;&lt;code title=&quot;&quot;&gt;citations&lt;/code&gt;&quot; whose value is the array &lt;var title=&quot;&quot;&gt;citations&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; is null and &lt;var title=&quot;&quot;&gt;current node&lt;/var&gt; has a parent node, let &lt;var title=&quot;&quot;&gt;current node&lt;/var&gt; be its parent node and jump back to the
-   step labeled &lt;i&gt;citation search&lt;/i&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; is not null, add an entry to
-   &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; called &quot;&lt;code title=&quot;&quot;&gt;citation&lt;/code&gt;&quot;
-   whose value is the &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; object.&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Return the result of serializing &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;
    to JSON.&lt;/li&gt;
 
@@ -44216,24 +44211,16 @@
 
   &lt;/ol&gt;&lt;h4 id=vcard-0&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;vCard&lt;/h4&gt;
 
-  &lt;p&gt;Given a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in a &lt;code&gt;Document&lt;/code&gt;,
-  a user agent must run the following algorithm to &lt;dfn id=extracting-a-vcard title=&quot;extracting a vCard&quot;&gt;extract any &lt;code title=md-vcard&gt;vcard&lt;/code&gt; data represented by that
-  node&lt;/dfn&gt;:&lt;/p&gt;
+  &lt;p&gt;Given a list of nodes &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; in a
+  &lt;code&gt;Document&lt;/code&gt;, a user agent must run the following algorithm
+  to &lt;dfn id=extracting-a-vcard title=&quot;extracting a vCard&quot;&gt;extract any &lt;code title=md-vcard&gt;vcard&lt;/code&gt; data represented by those nodes&lt;/dfn&gt;
+  (only the first vCard is returned):&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If none of the nodes in &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; are &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; with the type &lt;code title=md-vcard&gt;&lt;a href=#md-vcard&gt;vcard&lt;/a&gt;&lt;/code&gt;, then there is no vCard. Abort the
+   algorithm, returning nothing.&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not an element that is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; with the type &lt;code title=md-vcard&gt;&lt;a href=#md-vcard&gt;vcard&lt;/a&gt;&lt;/code&gt;, then run these substeps:&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be the first node in &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; that is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; with the type &lt;code title=md-vcard&gt;&lt;a href=#md-vcard&gt;vcard&lt;/a&gt;&lt;/code&gt;.&lt;/li&gt;
 
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has no parent, then there is
-     no vCard. Abort the algorithm, returning nothing.&lt;/li&gt;
-
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;'s
-     parent.&lt;/li&gt;
-
-     &lt;li&gt;&lt;p&gt;Restart the entire algorithm with the new value of &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;a href=#add-a-vcard-line&gt;Add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;BEGIN&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot;
@@ -44740,25 +44727,14 @@
 
   &lt;h4 id=icalendar&gt;&lt;span class=secno&gt;5.5.4 &lt;/span&gt;iCalendar&lt;/h4&gt;
 
-  &lt;p&gt;Given a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in a &lt;code&gt;Document&lt;/code&gt;,
-  a user agent must run the following algorithm to &lt;dfn id=extracting-a-vevent title=&quot;extracting a vEvent&quot;&gt;extract any &lt;code title=md-vevent&gt;vevent&lt;/code&gt; data represented by that
-  node&lt;/dfn&gt;:&lt;/p&gt;
+  &lt;p&gt;Given a list of nodes &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; in a
+  &lt;code&gt;Document&lt;/code&gt;, a user agent must run the following algorithm
+  to &lt;dfn id=extracting-vevent-data title=&quot;extracting vEvent data&quot;&gt;extract any &lt;code title=md-vevent&gt;vevent&lt;/code&gt; data represented by those
+  nodes&lt;/dfn&gt;:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If none of the nodes in &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; are &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; with the type &lt;code title=md-vevent&gt;&lt;a href=#md-vevent&gt;vevent&lt;/a&gt;&lt;/code&gt;, then there is no vEvent
+   data. Abort the algorithm, returning nothing.&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not an element that is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; with the type &lt;code title=md-vevent&gt;&lt;a href=#md-vevent&gt;vevent&lt;/a&gt;&lt;/code&gt;, then run these substeps:&lt;/p&gt;
-
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has no parent, then there is
-     no event to output. Abort the algorithm, returning
-     nothing.&lt;/li&gt;
-
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;'s
-     parent.&lt;/li&gt;
-
-     &lt;li&gt;&lt;p&gt;Restart the entire algorithm with the new value of &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;BEGIN&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCALENDAR&lt;/code&gt;&quot;
@@ -44770,79 +44746,85 @@
    &lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;VERSION&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;2.0&lt;/code&gt;&quot;
    to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;BEGIN&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VEVENT&lt;/code&gt;&quot;
-   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;DTSTAMP&lt;/code&gt;&quot; and a value consisting of an iCalendar
-   DATE-TIME string representing the current date and time, with the
-   annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE-TIME&lt;/code&gt;&quot;, to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.  &lt;a href=#refsRFC2445&gt;[RFC2445]&lt;/a&gt;&lt;/li&gt;
+    &lt;p&gt;For each node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; that is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; with the type &lt;code title=md-vevent&gt;&lt;a href=#md-vevent&gt;vevent&lt;/a&gt;&lt;/code&gt;, run the following steps:&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;If there is a property named &lt;code title=md-about&gt;&lt;a href=#md-about&gt;about&lt;/a&gt;&lt;/code&gt; whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
-   &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; and the element of the first such property
-   is a &lt;a href=#url-property-elements title=&quot;URL property elements&quot;&gt;URL property
-   element&lt;/a&gt; and has a &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; that is not an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, &lt;a href=#add-an-icalendar-line&gt;add an iCalendar line&lt;/a&gt;
-   with the type &quot;&lt;code title=&quot;&quot;&gt;UID&lt;/code&gt;&quot; and that property's
-   &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; as the value to
-   &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;BEGIN&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VEVENT&lt;/code&gt;&quot;
+     to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;DTSTAMP&lt;/code&gt;&quot; and a value consisting of an iCalendar
+     DATE-TIME string representing the current date and time, with the
+     annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE-TIME&lt;/code&gt;&quot;, to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.  &lt;a href=#refsRFC2445&gt;[RFC2445]&lt;/a&gt;&lt;/li&gt;
 
-    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
-    more &lt;a href=#property-names&gt;property names&lt;/a&gt; and whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
-    &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;: for each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
-    in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;a href=#property-names&gt;property names&lt;/a&gt;, run
-    the appropriate set of substeps from the following list:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;If there is a property named &lt;code title=md-about&gt;&lt;a href=#md-about&gt;about&lt;/a&gt;&lt;/code&gt; whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; and the element of the first such property
+     is a &lt;a href=#url-property-elements title=&quot;URL property elements&quot;&gt;URL property
+     element&lt;/a&gt; and has a &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; that is not an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, &lt;a href=#add-an-icalendar-line&gt;add an iCalendar line&lt;/a&gt;
+     with the type &quot;&lt;code title=&quot;&quot;&gt;UID&lt;/code&gt;&quot; and that property's
+     &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; as the value to
+     &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
 
-    &lt;dl&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is equal to the string &quot;&lt;code title=md-about&gt;&lt;a href=#md-about&gt;about&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
+     &lt;li&gt;
 
-     &lt;dt&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;&lt;/dt&gt;
+      &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
+      more &lt;a href=#property-names&gt;property names&lt;/a&gt; and whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
+      &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;: for each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
+      in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;a href=#property-names&gt;property names&lt;/a&gt;, run
+      the appropriate set of substeps from the following list:&lt;/p&gt;
 
-     &lt;dd&gt;
+      &lt;dl&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is equal to the string &quot;&lt;code title=md-about&gt;&lt;a href=#md-about&gt;about&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
 
-      &lt;p&gt;Skip the property.&lt;/p&gt;
+       &lt;dt&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;&lt;/dt&gt;
 
-     &lt;/dd&gt;
+       &lt;dd&gt;
 
+        &lt;p&gt;Skip the property.&lt;/p&gt;
 
-     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is a &lt;code&gt;&lt;a href=#the-time-element&gt;time&lt;/a&gt;&lt;/code&gt;
-     element&lt;/dt&gt;
+       &lt;/dd&gt;
 
-     &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the result of stripping
-      all U+002D HYPHEN-MINUS (-) and U+003A COLON (:) characters
-      from the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt;.&lt;/p&gt;
+       &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is a &lt;code&gt;&lt;a href=#the-time-element&gt;time&lt;/a&gt;&lt;/code&gt;
+       element&lt;/dt&gt;
 
-      &lt;p&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is a &lt;a href=#valid-date-string&gt;valid
-      date string&lt;/a&gt; then &lt;a href=#add-an-icalendar-line&gt;add an iCalendar line&lt;/a&gt;
-      with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, with the
-      annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE&lt;/code&gt;&quot;.&lt;/p&gt;
+       &lt;dd&gt;
 
-      &lt;p&gt;Otherwise, if the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is a &lt;a href=#valid-global-date-and-time-string&gt;valid
-      global date and time string&lt;/a&gt; then &lt;a href=#add-an-icalendar-line&gt;add an iCalendar
-      line&lt;/a&gt; with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the
-      value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;,
-      with the annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE-TIME&lt;/code&gt;&quot;.&lt;/p&gt;
+        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the result of stripping
+        all U+002D HYPHEN-MINUS (-) and U+003A COLON (:) characters
+        from the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt;.&lt;/p&gt;
 
-      &lt;p&gt;Otherwise skip the property.&lt;/p&gt;
+        &lt;p&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is a &lt;a href=#valid-date-string&gt;valid
+        date string&lt;/a&gt; then &lt;a href=#add-an-icalendar-line&gt;add an iCalendar line&lt;/a&gt;
+        with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, with the
+        annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE&lt;/code&gt;&quot;.&lt;/p&gt;
 
-     &lt;/dd&gt;
+        &lt;p&gt;Otherwise, if the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is a &lt;a href=#valid-global-date-and-time-string&gt;valid
+        global date and time string&lt;/a&gt; then &lt;a href=#add-an-icalendar-line&gt;add an iCalendar
+        line&lt;/a&gt; with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the
+        value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;,
+        with the annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE-TIME&lt;/code&gt;&quot;.&lt;/p&gt;
 
+        &lt;p&gt;Otherwise skip the property.&lt;/p&gt;
 
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
+       &lt;/dd&gt;
 
-     &lt;dd&gt;
 
-      &lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to
-      &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
+       &lt;dt&gt;Otherwise&lt;/dt&gt;
 
-     &lt;/dd&gt;
+       &lt;dd&gt;
 
-    &lt;/dl&gt;&lt;/li&gt;
+        &lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to
+        &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;END&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VEVENT&lt;/code&gt;&quot;
-   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+       &lt;/dd&gt;
 
+      &lt;/dl&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;END&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VEVENT&lt;/code&gt;&quot;
+     to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;&lt;a href=#add-an-icalendar-line&gt;Add an iCalendar line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;END&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCALENDAR&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the above algorithm says that the user agent is to &lt;dfn id=add-an-icalendar-line&gt;add
@@ -55324,6 +55306,14 @@
   &lt;p&gt;Multiple events are fired on the &lt;a href=#source-node&gt;source node&lt;/a&gt; during
   the course of the drag-and-drop operation.&lt;/p&gt;
 
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=list-of-dragged-nodes&gt;list of dragged nodes&lt;/dfn&gt; also depends on the kind of
+  drag. If it is a selection that is being dragged, then the
+  &lt;a href=#list-of-dragged-nodes&gt;list of dragged nodes&lt;/a&gt; contains, in &lt;a href=#tree-order&gt;tree
+  order&lt;/a&gt;, every node that is partially or completely included in
+  the selection (including all their ancestors). Otherwise, the
+  &lt;a href=#list-of-dragged-nodes&gt;list of dragged nodes&lt;/a&gt; contains only the &lt;a href=#source-node&gt;source
+  node&lt;/a&gt;.&lt;/p&gt;
+
   &lt;hr&gt;&lt;p&gt;If it is a selection that is being dragged, the &lt;code title=dom-DragEvent-dataTransfer&gt;&lt;a href=#dom-dragevent-datatransfer&gt;dataTransfer&lt;/a&gt;&lt;/code&gt; member of the event
   must be created with no nodes. Otherwise, it must be created
   containing just the &lt;a href=#source-node&gt;source node&lt;/a&gt;. Script can use the
@@ -55331,56 +55321,101 @@
   to add further elements to the list of what is being dragged.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code title=dom-DragEvent-dataTransfer&gt;&lt;a href=#dom-dragevent-datatransfer&gt;dataTransfer&lt;/a&gt;&lt;/code&gt;
-  member of the event must have added to it the following:&lt;/p&gt;
+  member of the event also has data added to it, as follows:&lt;/p&gt;
 
-  &lt;ul&gt;&lt;li&gt;If it is a selection that is being dragged, the text of the
-   selection, associated with the &lt;code title=&quot;&quot;&gt;text/plain&lt;/code&gt;
-   format.&lt;/li&gt;
+  &lt;ul&gt;&lt;li&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, then the string
-   resulting from making a list of every node that is partially or
-   completely included in the selection and &lt;a href=#extracting-json title=&quot;extracting
-   JSON&quot;&gt;extracting the microdata from those nodes into a JSON
-   form&lt;/a&gt;, associated with the &lt;code title=&quot;&quot;&gt;application/microdata+json&lt;/code&gt; format.&lt;/li&gt; &lt;!-- XXX
-   register --&gt;
+    &lt;p&gt;If it is a selection that is being dragged, then the user agent
+    must add the text of the selection to the &lt;code title=dom-DragEvent-dataTransfer&gt;&lt;a href=#dom-dragevent-datatransfer&gt;dataTransfer&lt;/a&gt;&lt;/code&gt; member,
+    associated with the &lt;code title=&quot;&quot;&gt;text/plain&lt;/code&gt; format.&lt;/p&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, then the string
-   resulting from making a list of every node that is partially or
-   completely included in the selection and &lt;a href=#extracting-a-vcard title=&quot;extracting a
-   vCard&quot;&gt;extracting the vCard data&lt;/a&gt; from the first node in that
-   list that is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; with the
-   type &lt;code title=md-vcard&gt;&lt;a href=#md-vcard&gt;vcard&lt;/a&gt;&lt;/code&gt;, if any, associated with
-   the &lt;code title=&quot;&quot;&gt;text/directory;profile=vcard&lt;/code&gt; format.&lt;/li&gt;
-   &lt;!-- v2 more than one? --&gt;
+   &lt;/li&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, then the string
-   resulting from making a list of every node that is partially or
-   completely included in the selection and &lt;a href=#extracting-a-vevent title=&quot;extracting a
-   vEvent&quot;&gt;extracting the vEvent data&lt;/a&gt; from the first node in
-   that list that is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; with
-   the type &lt;code title=md-vevent&gt;&lt;a href=#md-vevent&gt;vevent&lt;/a&gt;&lt;/code&gt;, if any, associated
-   with the &lt;code title=&quot;&quot;&gt;text/calendar;component=vevent&lt;/code&gt;
-   format.&lt;/li&gt; &lt;!-- v2 more than one? --&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, then the string
-   resulting from making a list of every node that is partially or
-   completely included in the selection and concatenating the strings
-   obtained from &lt;a href=#extracting-bibtex title=&quot;extracting BibTeX&quot;&gt;extracting BibTeX
-   data&lt;/a&gt; from all the nodes in that list that are &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; with the type &lt;code title=md-bibtex&gt;&lt;a href=#md-bibtex&gt;bibtex&lt;/a&gt;&lt;/code&gt;, if any, associated with the &lt;code title=&quot;&quot;&gt;application/microdata+bibtex&lt;/code&gt; format.&lt;/li&gt; &lt;!-- XXX
+    &lt;p&gt;The user agent must take the &lt;a href=#list-of-dragged-nodes&gt;list of dragged nodes&lt;/a&gt;
+    and &lt;a href=#extracting-json title=&quot;extracting JSON&quot;&gt;extract the microdata from those
+    nodes into a JSON form&lt;/a&gt;, and then must add the resulting
+    string to the &lt;code title=dom-DragEvent-dataTransfer&gt;&lt;a href=#dom-dragevent-datatransfer&gt;dataTransfer&lt;/a&gt;&lt;/code&gt; member,
+    associated with the &lt;code title=&quot;&quot;&gt;application/microdata+json&lt;/code&gt; format.&lt;/li&gt; &lt;!-- XXX
+    register --&gt;
+
+   &lt;li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;The user agent must take the &lt;a href=#list-of-dragged-nodes&gt;list of dragged nodes&lt;/a&gt;
+    and &lt;a href=#extracting-a-vcard title=&quot;extracting a vCard&quot;&gt;extract the vCard data from
+    those nodes&lt;/a&gt;, and then must add the resulting string to the
+    &lt;code title=dom-DragEvent-dataTransfer&gt;&lt;a href=#dom-dragevent-datatransfer&gt;dataTransfer&lt;/a&gt;&lt;/code&gt;
+    member, associated with the &lt;code title=&quot;&quot;&gt;text/directory;profile=vcard&lt;/code&gt; format.&lt;/p&gt;
+    &lt;!-- v2: deal with multiple vCards --&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;The user agent must take the &lt;a href=#list-of-dragged-nodes&gt;list of dragged nodes&lt;/a&gt;
+    and &lt;a href=#extracting-vevent-data title=&quot;extracting vEvent data&quot;&gt;extract the vEvent data
+    from those nodes&lt;/a&gt;, and then must add the resulting string to
+    the &lt;code title=dom-DragEvent-dataTransfer&gt;&lt;a href=#dom-dragevent-datatransfer&gt;dataTransfer&lt;/a&gt;&lt;/code&gt;
+    member, associated with the &lt;code title=&quot;&quot;&gt;text/calendar;component=vevent&lt;/code&gt; format.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; that is
+   &lt;a href=#sectioning-content-0&gt;sectioning content&lt;/a&gt; in the &lt;a href=#list-of-dragged-nodes&gt;list of dragged
+   nodes&lt;/a&gt;, the user agent must check if there are any
+   &lt;code&gt;&lt;a href=#the-footer-element&gt;footer&lt;/a&gt;&lt;/code&gt; elements that &lt;a href=#applyToSection&gt;apply&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; and
+   that contain any elements that are &lt;a href=#top-level-microdata-items title=&quot;top-level microdata
+   items&quot;&gt;top-level microdata items&lt;/a&gt; with the type &lt;code title=md-bibtex&gt;&lt;a href=#md-bibtex&gt;bibtex&lt;/a&gt;&lt;/code&gt;, and if so, then the user agent
+   must concatenate the strings obtained from &lt;a href=#extracting-bibtex title=&quot;extracting
+   BibTeX&quot;&gt;extracting BibTeX data&lt;/a&gt; from all such nodes, and then
+   must add the resulting string to the &lt;code title=dom-DragEvent-dataTransfer&gt;&lt;a href=#dom-dragevent-datatransfer&gt;dataTransfer&lt;/a&gt;&lt;/code&gt; member,
+   associated with the &lt;code title=&quot;&quot;&gt;application/microdata+bibtex&lt;/code&gt; format.&lt;/li&gt; &lt;!-- XXX
    register --&gt;
 
    &lt;li&gt;&lt;p class=XXX&gt;text/html fragment&lt;/p&gt;
 
-   &lt;li&gt;If it is an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element being dragged, the value
-   of the element's &lt;code title=dom-img-src&gt;&lt;a href=#dom-img-src&gt;src&lt;/a&gt;&lt;/code&gt; DOM
-   attribute, associated with the &lt;code title=&quot;&quot;&gt;text/uri-list&lt;/code&gt;
-   format.&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;If it is an &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; element being dragged, the value of
-   the element's &lt;code title=dom-a-href&gt;&lt;a href=#dom-a-href&gt;href&lt;/a&gt;&lt;/code&gt; DOM attribute,
-   associated with the &lt;code title=&quot;&quot;&gt;text/uri-list&lt;/code&gt; format.&lt;/li&gt;
+    &lt;p&gt;The user agent must run the following steps:&lt;/p&gt;
 
-  &lt;/ul&gt;&lt;p&gt;If the event is canceled, then the drag-and-drop operation must
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; be an empty list of &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;For each &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt;:&lt;/p&gt;
+
+      &lt;dl&gt;&lt;dt&gt;If the node is an &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; element with an &lt;code title=attr-a-href&gt;href&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;Add to &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; the result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the element's &lt;code title=attr-a-href&gt;href&lt;/code&gt; content attribute relative to
+       the element.&lt;/dd&gt;
+
+       &lt;dt&gt;If the node is an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element with an &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;Add to &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; the result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the element's &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; content attribute relative to the
+       element.&lt;/dd&gt;
+
+       &lt;!-- XXX others --&gt;
+
+      &lt;/dl&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; is still empty, abort these
+     steps.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url string&lt;/var&gt; be the result of
+     concatenating the strings in &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt;, in the
+     order they were added, separated by a U+000D CARRIAGE RETURN
+     U+000A LINE FEED character pair (CRLF).&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;url string&lt;/var&gt; to the &lt;code title=dom-DragEvent-dataTransfer&gt;&lt;a href=#dom-dragevent-datatransfer&gt;dataTransfer&lt;/a&gt;&lt;/code&gt; member,
+     associated with the &lt;code title=&quot;&quot;&gt;text/uri-list&lt;/code&gt;
+     format.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+  &lt;/ul&gt;&lt;hr&gt;&lt;p&gt;If the event is canceled, then the drag-and-drop operation must
   not occur; the user agent must not continue with this algorithm.&lt;/p&gt;
 
   &lt;p&gt;If it is not canceled, then the drag-and-drop operation must be

Modified: source
===================================================================
--- source	2009-05-18 08:23:17 UTC (rev 3114)
+++ source	2009-05-19 01:11:49 UTC (rev 3115)
@@ -49729,27 +49729,23 @@
    title=&quot;&quot;&gt;items&lt;/code&gt;&quot; whose value is the array &lt;var
    title=&quot;&quot;&gt;items&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current node&lt;/var&gt; be &lt;var
-   title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;citations&lt;/var&gt; be an empty
+   array.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; be null.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;For each &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in &lt;var
+   title=&quot;&quot;&gt;nodes&lt;/var&gt; that is &lt;span&gt;sectioning content&lt;/span&gt;, check
+   if there are any &lt;code&gt;footer&lt;/code&gt; elements that &lt;a
+   href=&quot;#applyToSection&quot;&gt;apply&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; and
+   that contain any elements that are &lt;span title=&quot;top-level microdata
+   items&quot;&gt;top-level microdata items&lt;/span&gt; with the type &lt;code
+   title=&quot;md-bibtex&quot;&gt;bibtex&lt;/code&gt;, and if so, then &lt;span&gt;get the
+   object&lt;/span&gt; for each such element and add them to &lt;var
+   title=&quot;&quot;&gt;citations&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Citation search:&lt;/i&gt; If &lt;var title=&quot;&quot;&gt;current node&lt;/var&gt;
-   has a descendant element that is a &lt;span title=&quot;top-level microdata
-   items&quot;&gt;top-level microdata item&lt;/span&gt; with the type &lt;code
-   title=&quot;md-bibtex&quot;&gt;bibtex&lt;/code&gt;, then &lt;span&gt;get the object&lt;/span&gt;
-   for the first such element in &lt;span&gt;tree order&lt;/span&gt; and let &lt;var
-   title=&quot;&quot;&gt;citation&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Add an entry to &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; called &quot;&lt;code
+   title=&quot;&quot;&gt;citations&lt;/code&gt;&quot; whose value is the array &lt;var
+   title=&quot;&quot;&gt;citations&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; is null and &lt;var
-   title=&quot;&quot;&gt;current node&lt;/var&gt; has a parent node, let &lt;var
-   title=&quot;&quot;&gt;current node&lt;/var&gt; be its parent node and jump back to the
-   step labeled &lt;i&gt;citation search&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; is not null, add an entry to
-   &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; called &quot;&lt;code title=&quot;&quot;&gt;citation&lt;/code&gt;&quot;
-   whose value is the &lt;var title=&quot;&quot;&gt;citation&lt;/var&gt; object.&lt;/p&gt;&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Return the result of serializing &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;
    to JSON.&lt;/p&gt;&lt;/li&gt;
 
@@ -50112,35 +50108,24 @@
 
   &lt;h4&gt;vCard&lt;/h4&gt;
 
-  &lt;p&gt;Given a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in a &lt;code&gt;Document&lt;/code&gt;,
-  a user agent must run the following algorithm to &lt;dfn
-  title=&quot;extracting a vCard&quot;&gt;extract any &lt;code
-  title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt; data represented by that
-  node&lt;/dfn&gt;:&lt;/p&gt;
+  &lt;p&gt;Given a list of nodes &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; in a
+  &lt;code&gt;Document&lt;/code&gt;, a user agent must run the following algorithm
+  to &lt;dfn title=&quot;extracting a vCard&quot;&gt;extract any &lt;code
+  title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt; data represented by those nodes&lt;/dfn&gt;
+  (only the first vCard is returned):&lt;/p&gt;
 
   &lt;ol&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If none of the nodes in &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; are &lt;span
+   title=&quot;concept-item&quot;&gt;items&lt;/span&gt; with the type &lt;code
+   title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt;, then there is no vCard. Abort the
+   algorithm, returning nothing.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not an element that is an &lt;span
-    title=&quot;concept-item&quot;&gt;item&lt;/span&gt; with the type &lt;code
-    title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt;, then run these substeps:&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be the first node in &lt;var
+   title=&quot;&quot;&gt;nodes&lt;/var&gt; that is an &lt;span
+   title=&quot;concept-item&quot;&gt;item&lt;/span&gt; with the type &lt;code
+   title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt;.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;ol&gt;
-
-     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has no parent, then there is
-     no vCard. Abort the algorithm, returning nothing.&lt;/p&gt;&lt;/li&gt;
-
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;'s
-     parent.&lt;/p&gt;&lt;/li&gt;
-
-     &lt;li&gt;&lt;p&gt;Restart the entire algorithm with the new value of &lt;var
-     title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-   &lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;span&gt;Add a vCard line&lt;/span&gt; with the type &quot;&lt;code
@@ -50860,36 +50845,19 @@
 
   &lt;h4&gt;iCalendar&lt;/h4&gt;
 
-  &lt;p&gt;Given a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in a &lt;code&gt;Document&lt;/code&gt;,
-  a user agent must run the following algorithm to &lt;dfn
-  title=&quot;extracting a vEvent&quot;&gt;extract any &lt;code
-  title=&quot;md-vevent&quot;&gt;vevent&lt;/code&gt; data represented by that
-  node&lt;/dfn&gt;:&lt;/p&gt;
+  &lt;p&gt;Given a list of nodes &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; in a
+  &lt;code&gt;Document&lt;/code&gt;, a user agent must run the following algorithm
+  to &lt;dfn title=&quot;extracting vEvent data&quot;&gt;extract any &lt;code
+  title=&quot;md-vevent&quot;&gt;vevent&lt;/code&gt; data represented by those
+  nodes&lt;/dfn&gt;:&lt;/p&gt;
 
   &lt;ol&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If none of the nodes in &lt;var title=&quot;&quot;&gt;nodes&lt;/var&gt; are &lt;span
+   title=&quot;concept-item&quot;&gt;items&lt;/span&gt; with the type &lt;code
+   title=&quot;md-vevent&quot;&gt;vevent&lt;/code&gt;, then there is no vEvent
+   data. Abort the algorithm, returning nothing.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not an element that is an &lt;span
-    title=&quot;concept-item&quot;&gt;item&lt;/span&gt; with the type &lt;code
-    title=&quot;md-vevent&quot;&gt;vevent&lt;/code&gt;, then run these substeps:&lt;/p&gt;
-
-    &lt;ol&gt;
-
-     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has no parent, then there is
-     no event to output. Abort the algorithm, returning
-     nothing.&lt;/p&gt;&lt;/li&gt;
-
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;'s
-     parent.&lt;/p&gt;&lt;/li&gt;
-
-     &lt;li&gt;&lt;p&gt;Restart the entire algorithm with the new value of &lt;var
-     title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-   &lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &quot;&lt;code
@@ -50905,103 +50873,116 @@
    title=&quot;&quot;&gt;VERSION&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;2.0&lt;/code&gt;&quot;
    to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &quot;&lt;code
-   title=&quot;&quot;&gt;BEGIN&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VEVENT&lt;/code&gt;&quot;
-   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &quot;&lt;code
-   title=&quot;&quot;&gt;DTSTAMP&lt;/code&gt;&quot; and a value consisting of an iCalendar
-   DATE-TIME string representing the current date and time, with the
-   annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE-TIME&lt;/code&gt;&quot;, to &lt;var
-   title=&quot;&quot;&gt;output&lt;/var&gt;.  &lt;a
-   href=&quot;#refsRFC2445&quot;&gt;[RFC2445]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+    &lt;p&gt;For each node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in &lt;var
+    title=&quot;&quot;&gt;nodes&lt;/var&gt; that is an &lt;span
+    title=&quot;concept-item&quot;&gt;item&lt;/span&gt; with the type &lt;code
+    title=&quot;md-vevent&quot;&gt;vevent&lt;/code&gt;, run the following steps:&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;If there is a property named &lt;code
-   title=&quot;md-about&quot;&gt;about&lt;/code&gt; whose &lt;span
-   title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
-   &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; and the element of the first such property
-   is a &lt;span title=&quot;URL property elements&quot;&gt;URL property
-   element&lt;/span&gt; and has a &lt;span
-   title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; that is not an &lt;span
-   title=&quot;concept-item&quot;&gt;item&lt;/span&gt;, &lt;span&gt;add an iCalendar line&lt;/span&gt;
-   with the type &quot;&lt;code title=&quot;&quot;&gt;UID&lt;/code&gt;&quot; and that property's
-   &lt;span title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; as the value to
-   &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+    &lt;ol&gt;
 
-   &lt;li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &quot;&lt;code
+     title=&quot;&quot;&gt;BEGIN&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VEVENT&lt;/code&gt;&quot;
+     to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
-    more &lt;span&gt;property names&lt;/span&gt; and whose &lt;span
-    title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
-    &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;: for each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
-    in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;span&gt;property names&lt;/span&gt;, run
-    the appropriate set of substeps from the following list:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &quot;&lt;code
+     title=&quot;&quot;&gt;DTSTAMP&lt;/code&gt;&quot; and a value consisting of an iCalendar
+     DATE-TIME string representing the current date and time, with the
+     annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE-TIME&lt;/code&gt;&quot;, to &lt;var
+     title=&quot;&quot;&gt;output&lt;/var&gt;.  &lt;a
+     href=&quot;#refsRFC2445&quot;&gt;[RFC2445]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
-    &lt;dl&gt;
+     &lt;li&gt;&lt;p&gt;If there is a property named &lt;code
+     title=&quot;md-about&quot;&gt;about&lt;/code&gt; whose &lt;span
+     title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; and the element of the first such property
+     is a &lt;span title=&quot;URL property elements&quot;&gt;URL property
+     element&lt;/span&gt; and has a &lt;span
+     title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; that is not an &lt;span
+     title=&quot;concept-item&quot;&gt;item&lt;/span&gt;, &lt;span&gt;add an iCalendar line&lt;/span&gt;
+     with the type &quot;&lt;code title=&quot;&quot;&gt;UID&lt;/code&gt;&quot; and that property's
+     &lt;span title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; as the value to
+     &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is equal to the string &quot;&lt;code
-     title=&quot;md-about&quot;&gt;about&lt;/code&gt;&quot;&lt;/dt&gt;
+     &lt;li&gt;
 
-     &lt;dt&gt;If the property's &lt;span
-     title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is an &lt;span
-     title=&quot;concept-item&quot;&gt;item&lt;/span&gt;&lt;/dt&gt;
+      &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
+      more &lt;span&gt;property names&lt;/span&gt; and whose &lt;span
+      title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
+      &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;: for each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
+      in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;span&gt;property names&lt;/span&gt;, run
+      the appropriate set of substeps from the following list:&lt;/p&gt;
 
-     &lt;dd&gt;
+      &lt;dl&gt;
 
-      &lt;p&gt;Skip the property.&lt;/p&gt;
+       &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is equal to the string &quot;&lt;code
+       title=&quot;md-about&quot;&gt;about&lt;/code&gt;&quot;&lt;/dt&gt;
 
-     &lt;/dd&gt;
+       &lt;dt&gt;If the property's &lt;span
+       title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is an &lt;span
+       title=&quot;concept-item&quot;&gt;item&lt;/span&gt;&lt;/dt&gt;
 
+       &lt;dd&gt;
 
-     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is a &lt;code&gt;time&lt;/code&gt;
-     element&lt;/dt&gt;
+        &lt;p&gt;Skip the property.&lt;/p&gt;
 
-     &lt;dd&gt;
+       &lt;/dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the result of stripping
-      all U+002D HYPHEN-MINUS (-) and U+003A COLON (:) characters
-      from the property's &lt;span
-      title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt;.&lt;/p&gt;
 
-      &lt;p&gt;If the property's &lt;span
-      title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is a &lt;span&gt;valid
-      date string&lt;/span&gt; then &lt;span&gt;add an iCalendar line&lt;/span&gt;
-      with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the value &lt;var
-      title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, with the
-      annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE&lt;/code&gt;&quot;.&lt;/p&gt;
+       &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is a &lt;code&gt;time&lt;/code&gt;
+       element&lt;/dt&gt;
 
-      &lt;p&gt;Otherwise, if the property's &lt;span
-      title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is a &lt;span&gt;valid
-      global date and time string&lt;/span&gt; then &lt;span&gt;add an iCalendar
-      line&lt;/span&gt; with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the
-      value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;,
-      with the annotation &quot;&lt;code
-      title=&quot;&quot;&gt;VALUE=DATE-TIME&lt;/code&gt;&quot;.&lt;/p&gt;
+       &lt;dd&gt;
 
-      &lt;p&gt;Otherwise skip the property.&lt;/p&gt;
+        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the result of stripping
+        all U+002D HYPHEN-MINUS (-) and U+003A COLON (:) characters
+        from the property's &lt;span
+        title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt;.&lt;/p&gt;
 
-     &lt;/dd&gt;
+        &lt;p&gt;If the property's &lt;span
+        title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is a &lt;span&gt;valid
+        date string&lt;/span&gt; then &lt;span&gt;add an iCalendar line&lt;/span&gt;
+        with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the value &lt;var
+        title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, with the
+        annotation &quot;&lt;code title=&quot;&quot;&gt;VALUE=DATE&lt;/code&gt;&quot;.&lt;/p&gt;
 
+        &lt;p&gt;Otherwise, if the property's &lt;span
+        title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is a &lt;span&gt;valid
+        global date and time string&lt;/span&gt; then &lt;span&gt;add an iCalendar
+        line&lt;/span&gt; with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and the
+        value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;,
+        with the annotation &quot;&lt;code
+        title=&quot;&quot;&gt;VALUE=DATE-TIME&lt;/code&gt;&quot;.&lt;/p&gt;
 
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
+        &lt;p&gt;Otherwise skip the property.&lt;/p&gt;
 
-     &lt;dd&gt;
+       &lt;/dd&gt;
 
-      &lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &lt;var
-      title=&quot;&quot;&gt;name&lt;/var&gt; and the value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to
-      &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
 
-     &lt;/dd&gt;
+       &lt;dt&gt;Otherwise&lt;/dt&gt;
 
-    &lt;/dl&gt;
+       &lt;dd&gt;
 
+        &lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &lt;var
+        title=&quot;&quot;&gt;name&lt;/var&gt; and the value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to
+        &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
+
+       &lt;/dd&gt;
+
+      &lt;/dl&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &quot;&lt;code
+     title=&quot;&quot;&gt;END&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VEVENT&lt;/code&gt;&quot;
+     to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &quot;&lt;code
-   title=&quot;&quot;&gt;END&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VEVENT&lt;/code&gt;&quot;
-   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Add an iCalendar line&lt;/span&gt; with the type &quot;&lt;code
    title=&quot;&quot;&gt;END&lt;/code&gt;&quot; and the value &quot;&lt;code
    title=&quot;&quot;&gt;VCALENDAR&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
@@ -64842,6 +64823,16 @@
 
   &lt;hr&gt;
 
+  &lt;p&gt;The &lt;dfn&gt;list of dragged nodes&lt;/dfn&gt; also depends on the kind of
+  drag. If it is a selection that is being dragged, then the
+  &lt;span&gt;list of dragged nodes&lt;/span&gt; contains, in &lt;span&gt;tree
+  order&lt;/span&gt;, every node that is partially or completely included in
+  the selection (including all their ancestors). Otherwise, the
+  &lt;span&gt;list of dragged nodes&lt;/span&gt; contains only the &lt;span&gt;source
+  node&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;
+
   &lt;p&gt;If it is a selection that is being dragged, the &lt;code
   title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt; member of the event
   must be created with no nodes. Otherwise, it must be created
@@ -64850,63 +64841,132 @@
   to add further elements to the list of what is being dragged.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
-  member of the event must have added to it the following:&lt;/p&gt;
+  member of the event also has data added to it, as follows:&lt;/p&gt;
 
   &lt;ul&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, the text of the
-   selection, associated with the &lt;code title=&quot;&quot;&gt;text/plain&lt;/code&gt;
-   format.&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, then the string
-   resulting from making a list of every node that is partially or
-   completely included in the selection and &lt;span title=&quot;extracting
-   JSON&quot;&gt;extracting the microdata from those nodes into a JSON
-   form&lt;/span&gt;, associated with the &lt;code
-   title=&quot;&quot;&gt;application/microdata+json&lt;/code&gt; format.&lt;/li&gt; &lt;!-- XXX
-   register --&gt;
+    &lt;p&gt;If it is a selection that is being dragged, then the user agent
+    must add the text of the selection to the &lt;code
+    title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt; member,
+    associated with the &lt;code title=&quot;&quot;&gt;text/plain&lt;/code&gt; format.&lt;/p&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, then the string
-   resulting from making a list of every node that is partially or
-   completely included in the selection and &lt;span title=&quot;extracting a
-   vCard&quot;&gt;extracting the vCard data&lt;/span&gt; from the first node in that
-   list that is an &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; with the
-   type &lt;code title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt;, if any, associated with
-   the &lt;code title=&quot;&quot;&gt;text/directory;profile=vcard&lt;/code&gt; format.&lt;/li&gt;
-   &lt;!-- v2 more than one? --&gt;
+   &lt;/li&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, then the string
-   resulting from making a list of every node that is partially or
-   completely included in the selection and &lt;span title=&quot;extracting a
-   vEvent&quot;&gt;extracting the vEvent data&lt;/span&gt; from the first node in
-   that list that is an &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; with
-   the type &lt;code title=&quot;md-vevent&quot;&gt;vevent&lt;/code&gt;, if any, associated
-   with the &lt;code title=&quot;&quot;&gt;text/calendar;component=vevent&lt;/code&gt;
-   format.&lt;/li&gt; &lt;!-- v2 more than one? --&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;If it is a selection that is being dragged, then the string
-   resulting from making a list of every node that is partially or
-   completely included in the selection and concatenating the strings
-   obtained from &lt;span title=&quot;extracting BibTeX&quot;&gt;extracting BibTeX
-   data&lt;/span&gt; from all the nodes in that list that are &lt;span
-   title=&quot;concept-item&quot;&gt;items&lt;/span&gt; with the type &lt;code
-   title=&quot;md-bibtex&quot;&gt;bibtex&lt;/code&gt;, if any, associated with the &lt;code
+    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
+    and &lt;span title=&quot;extracting JSON&quot;&gt;extract the microdata from those
+    nodes into a JSON form&lt;/span&gt;, and then must add the resulting
+    string to the &lt;code
+    title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt; member,
+    associated with the &lt;code
+    title=&quot;&quot;&gt;application/microdata+json&lt;/code&gt; format.&lt;/li&gt; &lt;!-- XXX
+    register --&gt;
+
+   &lt;li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
+    and &lt;span title=&quot;extracting a vCard&quot;&gt;extract the vCard data from
+    those nodes&lt;/span&gt;, and then must add the resulting string to the
+    &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
+    member, associated with the &lt;code
+    title=&quot;&quot;&gt;text/directory;profile=vcard&lt;/code&gt; format.&lt;/p&gt;
+    &lt;!-- v2: deal with multiple vCards --&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
+    and &lt;span title=&quot;extracting vEvent data&quot;&gt;extract the vEvent data
+    from those nodes&lt;/span&gt;, and then must add the resulting string to
+    the &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
+    member, associated with the &lt;code
+    title=&quot;&quot;&gt;text/calendar;component=vevent&lt;/code&gt; format.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; that is
+   &lt;span&gt;sectioning content&lt;/span&gt; in the &lt;span&gt;list of dragged
+   nodes&lt;/span&gt;, the user agent must check if there are any
+   &lt;code&gt;footer&lt;/code&gt; elements that &lt;a
+   href=&quot;#applyToSection&quot;&gt;apply&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; and
+   that contain any elements that are &lt;span title=&quot;top-level microdata
+   items&quot;&gt;top-level microdata items&lt;/span&gt; with the type &lt;code
+   title=&quot;md-bibtex&quot;&gt;bibtex&lt;/code&gt;, and if so, then the user agent
+   must concatenate the strings obtained from &lt;span title=&quot;extracting
+   BibTeX&quot;&gt;extracting BibTeX data&lt;/span&gt; from all such nodes, and then
+   must add the resulting string to the &lt;code
+   title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt; member,
+   associated with the &lt;code
    title=&quot;&quot;&gt;application/microdata+bibtex&lt;/code&gt; format.&lt;/li&gt; &lt;!-- XXX
    register --&gt;
 
    &lt;li&gt;&lt;p class=&quot;XXX&quot;&gt;text/html fragment&lt;/p&gt;
 
-   &lt;li&gt;If it is an &lt;code&gt;img&lt;/code&gt; element being dragged, the value
-   of the element's &lt;code title=&quot;dom-img-src&quot;&gt;src&lt;/code&gt; DOM
-   attribute, associated with the &lt;code title=&quot;&quot;&gt;text/uri-list&lt;/code&gt;
-   format.&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;If it is an &lt;code&gt;a&lt;/code&gt; element being dragged, the value of
-   the element's &lt;code title=&quot;dom-a-href&quot;&gt;href&lt;/code&gt; DOM attribute,
-   associated with the &lt;code title=&quot;&quot;&gt;text/uri-list&lt;/code&gt; format.&lt;/li&gt;
+    &lt;p&gt;The user agent must run the following steps:&lt;/p&gt;
 
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; be an empty list of &lt;span
+     title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;For each &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in &lt;var
+      title=&quot;&quot;&gt;nodes&lt;/var&gt;:&lt;/p&gt;
+
+      &lt;dl&gt;
+
+       &lt;dt&gt;If the node is an &lt;code&gt;a&lt;/code&gt; element with an &lt;code
+       title=&quot;attr-a-href&quot;&gt;href&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;Add to &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; the result of &lt;span
+       title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the element's &lt;code
+       title=&quot;attr-a-href&quot;&gt;href&lt;/code&gt; content attribute relative to
+       the element.&lt;/dd&gt;
+
+       &lt;dt&gt;If the node is an &lt;code&gt;img&lt;/code&gt; element with an &lt;code
+       title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;Add to &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; the result of &lt;span
+       title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the element's &lt;code
+       title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; content attribute relative to the
+       element.&lt;/dd&gt;
+
+       &lt;!-- XXX others --&gt;
+
+      &lt;/dl&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; is still empty, abort these
+     steps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url string&lt;/var&gt; be the result of
+     concatenating the strings in &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt;, in the
+     order they were added, separated by a U+000D CARRIAGE RETURN
+     U+000A LINE FEED character pair (CRLF).&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;url string&lt;/var&gt; to the &lt;code
+     title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt; member,
+     associated with the &lt;code title=&quot;&quot;&gt;text/uri-list&lt;/code&gt;
+     format.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
   &lt;/ul&gt;
 
+  &lt;hr&gt;
+
   &lt;p&gt;If the event is canceled, then the drag-and-drop operation must
   not occur; the user agent must not continue with this algorithm.&lt;/p&gt;
 


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009995.html">[html5] r3114 - [] (0) Include microdata when dragging-and-dropping	or copying-and-pasting.
</A></li>
	<LI>Next message: <A HREF="009997.html">[html5] r3116 - [act] (0) How to extract an Atom feed from an HTML5	document
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9996">[ date ]</a>
              <a href="thread.html#9996">[ thread ]</a>
              <a href="subject.html#9996">[ subject ]</a>
              <a href="author.html#9996">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
