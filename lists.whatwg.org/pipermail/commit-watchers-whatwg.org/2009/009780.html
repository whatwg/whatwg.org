<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r2898 - [] (0) Define the storage mutex. Will be used in	the next few checkins.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2898%20-%20%5B%5D%20%280%29%20Define%20the%20storage%20mutex.%20Will%20be%20used%20in%0A%09the%20next%20few%20checkins.&In-Reply-To=%3C20090324074202.5ED5B150BB3%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009779.html">
   <LINK REL="Next"  HREF="009781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r2898 - [] (0) Define the storage mutex. Will be used in	the next few checkins.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2898%20-%20%5B%5D%20%280%29%20Define%20the%20storage%20mutex.%20Will%20be%20used%20in%0A%09the%20next%20few%20checkins.&In-Reply-To=%3C20090324074202.5ED5B150BB3%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r2898 - [] (0) Define the storage mutex. Will be used in	the next few checkins.">whatwg at whatwg.org
       </A><BR>
    <I>Tue Mar 24 00:42:02 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009779.html">[html5] r2897 - [e] (0) note for later about websocket security	issue
</A></li>
        <LI>Next message: <A HREF="009781.html">[html5] r2899 - [giow] (2) Block concurrent access to .cookie and	.localStorage using the storag [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9780">[ date ]</a>
              <a href="thread.html#9780">[ thread ]</a>
              <a href="subject.html#9780">[ subject ]</a>
              <a href="author.html#9780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-03-24 00:42:01 -0700 (Tue, 24 Mar 2009)
New Revision: 2898

Modified:
   index
   source
Log:
[] (0) Define the storage mutex. Will be used in the next few checkins.

Modified: index
===================================================================
--- index	2009-03-24 02:28:29 UTC (rev 2897)
+++ index	2009-03-24 07:42:01 UTC (rev 2898)
@@ -689,7 +689,9 @@
        &lt;li&gt;&lt;a href=#killing-scripts&gt;&lt;span class=secno&gt;5.5.3.4 &lt;/span&gt;Killing scripts&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#event-loops&gt;&lt;span class=secno&gt;5.5.4 &lt;/span&gt;Event loops&lt;/a&gt;
       &lt;ol&gt;
-       &lt;li&gt;&lt;a href=#generic-task-sources&gt;&lt;span class=secno&gt;5.5.4.1 &lt;/span&gt;Generic task sources&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#definitions-1&gt;&lt;span class=secno&gt;5.5.4.1 &lt;/span&gt;Definitions&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#processing-model-2&gt;&lt;span class=secno&gt;5.5.4.2 &lt;/span&gt;Processing model&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#generic-task-sources&gt;&lt;span class=secno&gt;5.5.4.3 &lt;/span&gt;Generic task sources&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#javascript-protocol&gt;&lt;span class=secno&gt;5.5.5 &lt;/span&gt;The &lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt; protocol&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#events&gt;&lt;span class=secno&gt;5.5.6 &lt;/span&gt;Events&lt;/a&gt;
       &lt;ol&gt;
@@ -828,7 +830,7 @@
    &lt;li&gt;&lt;a href=#undo&gt;&lt;span class=secno&gt;6.10 &lt;/span&gt;Undo history&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#introduction-4&gt;&lt;span class=secno&gt;6.10.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#definitions-1&gt;&lt;span class=secno&gt;6.10.2 &lt;/span&gt;Definitions&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#definitions-2&gt;&lt;span class=secno&gt;6.10.2 &lt;/span&gt;Definitions&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-undomanager-interface&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;The &lt;code&gt;UndoManager&lt;/code&gt; interface&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#undo:-moving-back-in-the-undo-transaction-history&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;Undo: moving back in the undo transaction history&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#redo:-moving-forward-in-the-undo-transaction-history&gt;&lt;span class=secno&gt;6.10.5 &lt;/span&gt;Redo: moving forward in the undo transaction history&lt;/a&gt;&lt;/li&gt;
@@ -1400,15 +1402,7 @@
   imply a visual medium; they must be considered to apply to other
   media in equivalent ways.&lt;/p&gt;
 
-  &lt;p class=impl&gt;Some of the algorithms in this specification, for
-  historical reasons, require the user agent to &lt;dfn id=pause&gt;pause&lt;/dfn&gt; until
-  some condition has been met. While a user agent is paused, it must
-  ensure that no scripts execute (e.g. no event handlers, no timers,
-  etc). User agents should remain responsive to user input while
-  paused, however, albeit without letting the user interact with Web
-  pages where that would involve invoking any &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;.&lt;/p&gt;
 
-
   &lt;h4 id=xml&gt;&lt;span class=secno&gt;2.1.1 &lt;/span&gt;XML&lt;/h4&gt;
 
   &lt;p id=html-namespace&gt;To ease migration from HTML to XHTML, UAs
@@ -40125,6 +40119,8 @@
 
   &lt;h4 id=event-loops&gt;&lt;span class=secno&gt;5.5.4 &lt;/span&gt;Event loops&lt;/h4&gt;
 
+  &lt;h5 id=definitions-1&gt;&lt;span class=secno&gt;5.5.4.1 &lt;/span&gt;Definitions&lt;/h5&gt;
+
   &lt;p&gt;To coordinate events, user interaction, scripts, rendering,
   networking, and so forth, user agents must use &lt;dfn id=event-loop title=&quot;event
   loop&quot;&gt;event loops&lt;/dfn&gt; as described in this section.&lt;/p&gt;
@@ -40214,15 +40210,27 @@
   processing events from any one &lt;a href=#task-source&gt;task source&lt;/a&gt; out of
   order.&lt;/p&gt;
 
+  &lt;p&gt;A user agent is required to have one &lt;dfn id=storage-mutex&gt;storage
+  mutex&lt;/dfn&gt;. This mutex is used to control access to shared state
+  like cookies. At any one point, the &lt;a href=#storage-mutex&gt;storage mutex&lt;/a&gt; is
+  either free, or owned by a particular &lt;a href=#event-loop&gt;event loop&lt;/a&gt;.&lt;/p&gt;
+
+
+  &lt;h5 id=processing-model-2&gt;&lt;span class=secno&gt;5.5.4.2 &lt;/span&gt;Processing model&lt;/h5&gt;
+
   &lt;p&gt;An &lt;a href=#event-loop&gt;event loop&lt;/a&gt; must continually run through the
   following steps for as long as it exists:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Run the oldest task on one of the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;'s
-   &lt;a href=#task-queue title=&quot;task queue&quot;&gt;task queues&lt;/a&gt;, ignoring tasks whose
-   associated &lt;code&gt;Document&lt;/code&gt;s are not &lt;a href=#fully-active&gt;fully
-   active&lt;/a&gt;. The user agent may pick any &lt;a href=#task-queue&gt;task
-   queue&lt;/a&gt;.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Run the oldest &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; on one
+   of the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;'s &lt;a href=#task-queue title=&quot;task queue&quot;&gt;task
+   queues&lt;/a&gt;, ignoring tasks whose associated
+   &lt;code&gt;Document&lt;/code&gt;s are not &lt;a href=#fully-active&gt;fully active&lt;/a&gt;. The user
+   agent may pick any &lt;a href=#task-queue&gt;task queue&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;a href=#storage-mutex&gt;storage mutex&lt;/a&gt; is now owned by the
+   &lt;a href=#event-loop&gt;event loop&lt;/a&gt;, release it so that it is once again
+   free.&lt;/p&gt;
+
    &lt;li&gt;&lt;p&gt;Remove that task from its &lt;a href=#task-queue&gt;task queue&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If necessary, update the rendering or user interface of any
@@ -40232,12 +40240,35 @@
    &lt;li&gt;&lt;p&gt;Return to the first step of the &lt;a href=#event-loop&gt;event
    loop&lt;/a&gt;.&lt;/li&gt;
 
+  &lt;/ol&gt;&lt;hr&gt;&lt;p class=impl&gt;Some of the algorithms in this specification, for
+  historical reasons, require the user agent to &lt;dfn id=pause&gt;pause&lt;/dfn&gt; while
+  running a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; until some
+  condition has been met. While a user agent has a paused &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt;, the corresponding &lt;a href=#event-loop&gt;event
+  loop&lt;/a&gt; must not run further &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt;, and any script in the currently
+  running &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; must block. User
+  agents should remain responsive to user input while paused, however,
+  albeit in a reduced capacity since the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; will
+  not be doing anything.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;When a user agent is to &lt;dfn id=obtain-the-storage-mutex&gt;obtain the storage mutex&lt;/dfn&gt; as
+  part of running a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt;, it must
+  run through the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;a href=#storage-mutex&gt;storage mutex&lt;/a&gt; is already owned by this
+   &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt;'s &lt;a href=#event-loop&gt;event loop&lt;/a&gt;,
+   then abort these steps.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Otherwise, &lt;a href=#pause&gt;pause&lt;/a&gt; until the &lt;a href=#storage-mutex&gt;storage
+   mutex&lt;/a&gt; can be taken by the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Take ownership of the &lt;a href=#storage-mutex&gt;storage mutex&lt;/a&gt;.&lt;/li&gt;
+
   &lt;/ol&gt;&lt;/div&gt;
 
 
   &lt;div class=impl&gt;
 
-  &lt;h5 id=generic-task-sources&gt;&lt;span class=secno&gt;5.5.4.1 &lt;/span&gt;Generic task sources&lt;/h5&gt;
+  &lt;h5 id=generic-task-sources&gt;&lt;span class=secno&gt;5.5.4.3 &lt;/span&gt;Generic task sources&lt;/h5&gt;
 
   &lt;p&gt;The following &lt;a href=#task-source title=&quot;task source&quot;&gt;task sources&lt;/a&gt; are
   used by a number of mostly unrelated features in this and other
@@ -48713,7 +48744,7 @@
 
   &lt;div class=impl&gt;
 
-  &lt;h4 id=definitions-1&gt;&lt;span class=secno&gt;6.10.2 &lt;/span&gt;Definitions&lt;/h4&gt;
+  &lt;h4 id=definitions-2&gt;&lt;span class=secno&gt;6.10.2 &lt;/span&gt;Definitions&lt;/h4&gt;
 
   &lt;p&gt;The user agent must associate an &lt;dfn id=undo-transaction-history&gt;undo transaction
   history&lt;/dfn&gt; with each &lt;code&gt;&lt;a href=#htmldocument&gt;HTMLDocument&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;

Modified: source
===================================================================
--- source	2009-03-24 02:28:29 UTC (rev 2897)
+++ source	2009-03-24 07:42:01 UTC (rev 2898)
@@ -404,16 +404,7 @@
   imply a visual medium; they must be considered to apply to other
   media in equivalent ways.&lt;/p&gt;
 
-  &lt;p class=&quot;impl&quot;&gt;Some of the algorithms in this specification, for
-  historical reasons, require the user agent to &lt;dfn&gt;pause&lt;/dfn&gt; until
-  some condition has been met. While a user agent is paused, it must
-  ensure that no scripts execute (e.g. no event handlers, no timers,
-  etc). User agents should remain responsive to user input while
-  paused, however, albeit without letting the user interact with Web
-  pages where that would involve invoking any &lt;span
-  title=&quot;concept-script&quot;&gt;script&lt;/span&gt;.&lt;/p&gt;
 
-
   &lt;h4&gt;XML&lt;/h4&gt;
 
   &lt;p id=&quot;html-namespace&quot;&gt;To ease migration from HTML to XHTML, UAs
@@ -45526,6 +45517,8 @@
 
   &lt;h4&gt;Event loops&lt;/h4&gt;
 
+  &lt;h5&gt;Definitions&lt;/h5&gt;
+
   &lt;p&gt;To coordinate events, user interaction, scripts, rendering,
   networking, and so forth, user agents must use &lt;dfn title=&quot;event
   loop&quot;&gt;event loops&lt;/dfn&gt; as described in this section.&lt;/p&gt;
@@ -45621,17 +45614,29 @@
   processing events from any one &lt;span&gt;task source&lt;/span&gt; out of
   order.&lt;/p&gt;
 
+  &lt;p&gt;A user agent is required to have one &lt;dfn&gt;storage
+  mutex&lt;/dfn&gt;. This mutex is used to control access to shared state
+  like cookies. At any one point, the &lt;span&gt;storage mutex&lt;/span&gt; is
+  either free, or owned by a particular &lt;span&gt;event loop&lt;/span&gt;.&lt;/p&gt;
+
+
+  &lt;h5&gt;Processing model&lt;/h5&gt;
+
   &lt;p&gt;An &lt;span&gt;event loop&lt;/span&gt; must continually run through the
   following steps for as long as it exists:&lt;/p&gt;
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;Run the oldest task on one of the &lt;span&gt;event loop&lt;/span&gt;'s
-   &lt;span title=&quot;task queue&quot;&gt;task queues&lt;/span&gt;, ignoring tasks whose
-   associated &lt;code&gt;Document&lt;/code&gt;s are not &lt;span&gt;fully
-   active&lt;/span&gt;. The user agent may pick any &lt;span&gt;task
-   queue&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Run the oldest &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; on one
+   of the &lt;span&gt;event loop&lt;/span&gt;'s &lt;span title=&quot;task queue&quot;&gt;task
+   queues&lt;/span&gt;, ignoring tasks whose associated
+   &lt;code&gt;Document&lt;/code&gt;s are not &lt;span&gt;fully active&lt;/span&gt;. The user
+   agent may pick any &lt;span&gt;task queue&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;storage mutex&lt;/span&gt; is now owned by the
+   &lt;span&gt;event loop&lt;/span&gt;, release it so that it is once again
+   free.&lt;/p&gt;
+
    &lt;li&gt;&lt;p&gt;Remove that task from its &lt;span&gt;task queue&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If necessary, update the rendering or user interface of any
@@ -45643,6 +45648,39 @@
 
   &lt;/ol&gt;
 
+  &lt;hr&gt;
+
+  &lt;p class=&quot;impl&quot;&gt;Some of the algorithms in this specification, for
+  historical reasons, require the user agent to &lt;dfn&gt;pause&lt;/dfn&gt; while
+  running a &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; until some
+  condition has been met. While a user agent has a paused &lt;span
+  title=&quot;concept-task&quot;&gt;task&lt;/span&gt;, the corresponding &lt;span&gt;event
+  loop&lt;/span&gt; must not run further &lt;span
+  title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt;, and any script in the currently
+  running &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; must block. User
+  agents should remain responsive to user input while paused, however,
+  albeit in a reduced capacity since the &lt;span&gt;event loop&lt;/span&gt; will
+  not be doing anything.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When a user agent is to &lt;dfn&gt;obtain the storage mutex&lt;/dfn&gt; as
+  part of running a &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt;, it must
+  run through the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;storage mutex&lt;/span&gt; is already owned by this
+   &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt;'s &lt;span&gt;event loop&lt;/span&gt;,
+   then abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Otherwise, &lt;span&gt;pause&lt;/span&gt; until the &lt;span&gt;storage
+   mutex&lt;/span&gt; can be taken by the &lt;span&gt;event loop&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Take ownership of the &lt;span&gt;storage mutex&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
   &lt;/div&gt;
 
 


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009779.html">[html5] r2897 - [e] (0) note for later about websocket security	issue
</A></li>
	<LI>Next message: <A HREF="009781.html">[html5] r2899 - [giow] (2) Block concurrent access to .cookie and	.localStorage using the storag [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9780">[ date ]</a>
              <a href="thread.html#9780">[ thread ]</a>
              <a href="subject.html#9780">[ subject ]</a>
              <a href="author.html#9780">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
