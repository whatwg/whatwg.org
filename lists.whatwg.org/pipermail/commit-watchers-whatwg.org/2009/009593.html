<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r2709 - [] (0) Abstract out the determination of the base	URL from the resolving-a-relat [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2709%20-%20%5B%5D%20%280%29%20Abstract%20out%20the%20determination%20of%20the%20base%0A%09URL%20from%20the%20resolving-a-relat%20%5B...%5D&In-Reply-To=%3C20090127023958.1421C38DFBF%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009592.html">
   <LINK REL="Next"  HREF="009594.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r2709 - [] (0) Abstract out the determination of the base	URL from the resolving-a-relat [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2709%20-%20%5B%5D%20%280%29%20Abstract%20out%20the%20determination%20of%20the%20base%0A%09URL%20from%20the%20resolving-a-relat%20%5B...%5D&In-Reply-To=%3C20090127023958.1421C38DFBF%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r2709 - [] (0) Abstract out the determination of the base	URL from the resolving-a-relat [...]">whatwg at whatwg.org
       </A><BR>
    <I>Mon Jan 26 18:39:58 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009592.html">[html5] r2708 - [c] (0) I missed a few non-characters. Not sure how	I missed these. (credit: w)
</A></li>
        <LI>Next message: <A HREF="009594.html">[html5] r2710 - [] (0) Change the document's address when	document.open() is invoked to match th [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9593">[ date ]</a>
              <a href="thread.html#9593">[ thread ]</a>
              <a href="subject.html#9593">[ subject ]</a>
              <a href="author.html#9593">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-01-26 18:39:57 -0800 (Mon, 26 Jan 2009)
New Revision: 2709

Modified:
   header-whatwg
   index
   source
Log:
[] (0) Abstract out the determination of the base URL from the resolving-a-relative-URL section; remove the resolving step from the navigating and fetching algorithms; make the base URI used for relative URL resolution by scripts be set by the first script that is running, not the last.

Modified: header-whatwg
===================================================================
--- header-whatwg	2009-01-24 05:07:17 UTC (rev 2708)
+++ header-whatwg	2009-01-27 02:39:57 UTC (rev 2709)
@@ -25,11 +25,20 @@
    [hidden] { display: none; }
   &lt;/style&gt;
   &lt;link rel=&quot;stylesheet&quot; href=&quot;status.css&quot;&gt;
-  &lt;script src=&quot;status.js&quot;&gt;&lt;/script&gt;
-  &lt;script src=&quot;dfn.js&quot;&gt;&lt;/script&gt;
-  &lt;script src=&quot;toc.js&quot;&gt;&lt;/script&gt;
+  &lt;script&gt;
+   function load(script) {
+     var e = document.createElement('script');
+     e.setAttribute('src', script);
+     document.body.appendChild(e);
+   }
+   function init() {
+     load('status.js');
+     load('dfn.js');
+     load('toc.js');
+   }
+  &lt;/script&gt;
  &lt;/head&gt;
- &lt;body class=&quot;draft&quot; onload=&quot;initAnnotations()&quot;&gt;
+ &lt;body class=&quot;draft&quot; onload=&quot;init()&quot;&gt;
 
   &lt;div class=&quot;head&quot;&gt;
    &lt;p&gt;&lt;a rel=&quot;home&quot; href=&quot;<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&quot; class=&quot;logo&quot;&gt;&lt;img alt=&quot;WHATWG&quot; src=&quot;/images/logo&quot;&gt;&lt;/a&gt;&lt;/p&gt;

Modified: index
===================================================================
--- index	2009-01-24 05:07:17 UTC (rev 2708)
+++ index	2009-01-27 02:39:57 UTC (rev 2709)
@@ -17,12 +17,23 @@
    .rfc2119.m\ust::after { content: '\2605'; }
    .rfc2119.s\hould::after { content: '\2606'; }
    [hidden] { display: none; }
-  &lt;/style&gt;&lt;link href=status.css rel=stylesheet&gt;&lt;script src=status.js&gt;&lt;/script&gt;&lt;script src=dfn.js&gt;&lt;/script&gt;&lt;script src=toc.js&gt;&lt;/script&gt;&lt;body class=draft onload=initAnnotations()&gt;
+  &lt;/style&gt;&lt;link href=status.css rel=stylesheet&gt;&lt;script&gt;
+   function load(script) {
+     var e = document.createElement('script');
+     e.setAttribute('src', script);
+     document.body.appendChild(e);
+   }
+   function init() {
+     load('status.js');
+     load('dfn.js');
+     load('toc.js');
+   }
+  &lt;/script&gt;&lt;body class=draft onload=init()&gt;
 
   &lt;div class=head&gt;
    &lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;h1&gt;HTML 5&lt;/h1&gt;
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 24 January 2009&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 27 January 2009&lt;/h2&gt;
    &lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;dl&gt;&lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -3999,21 +4010,28 @@
   it's not clear RFC3986 does a good job of defining that anymore
   (earlier URI specs did) --&gt;&lt;h4 id=resolving-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
 
-  &lt;p&gt;Relative URLs are resolved relative to a base URL. The &lt;dfn id=base-url&gt;base
-  URL&lt;/dfn&gt; of a &lt;a href=#url&gt;URL&lt;/a&gt; is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
-  obtained as follows:&lt;/p&gt;
+  &lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
+  relative to either another &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; or an element,
+  the user agent must use the following steps. Resolving a URL can
+  result in an error, in which case the URL is not resolvable.&lt;/p&gt;
 
-  &lt;dl class=switch&gt;&lt;dt&gt;If the URL to be resolved was passed to an API&lt;/dt&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;a href=#url&gt;URL&lt;/a&gt; being
+   resolved.&lt;/li&gt;
 
-   &lt;dd&gt;&lt;p&gt;The base URL is the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt;.&lt;/dd&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be the &lt;a href=#url-character-encoding&gt;URL character
+   encoding&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;dt&gt;If the URL to be resolved is from the value of a content
-   attribute&lt;/dt&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is UTF-16, then change it to
+   UTF-8.&lt;/li&gt;
 
-   &lt;dd&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;The base URL is the &lt;i&gt;base URI of the element&lt;/i&gt; that the
-    attribute is on, as defined by the XML Base specification, with
+    &lt;p&gt;If the algorithm was invoked with an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
+    to use as the base URL, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be that
+    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;i&gt;base URI of
+    the element&lt;/i&gt;, as defined by the XML Base specification, with
     &lt;i&gt;the base URI of the document entity&lt;/i&gt; being defined as the
     &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the &lt;code&gt;Document&lt;/code&gt; that
     owns the element.&lt;/p&gt;
@@ -4028,52 +4046,30 @@
     however, as &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes
     are not allowed in &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt;.)&lt;/p&gt;
 
-   &lt;/dd&gt;
+    &lt;p&gt;The &lt;dfn id=document-base-url&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; is
+    the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained by running these
+    substeps:&lt;/p&gt;
 
-   &lt;dt&gt;If the URL to be resolved was found in an offline application
-   cache manifest&lt;/dt&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; element that is both a
+     child of &lt;a href=#the-head-element-0&gt;the &lt;code&gt;head&lt;/code&gt; element&lt;/a&gt; and has an
+     &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute, then the
+     &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is &lt;a href=&quot;#the-document's-address&quot;&gt;the document's
+     address&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;dd&gt;&lt;p&gt;The base URL is the URL of the &lt;a href=#application-cache&gt;application
-   cache&lt;/a&gt; &lt;a href=#concept-appcache-manifest title=concept-appcache-manifest&gt;manifest&lt;/a&gt;.&lt;/dd&gt;
+     &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the
+     &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute of the first such
+     element.&lt;/li&gt;
 
-  &lt;/dl&gt;&lt;p&gt;The &lt;dfn id=document-base-url&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; is
-  the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained by running these steps:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;a href=&quot;#the-document's-address&quot;&gt;the document's
+     address&lt;/a&gt; (thus, the &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute isn't affected by
+     &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes).&lt;/li&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; element that is both a
-   child of &lt;a href=#the-head-element-0&gt;the &lt;code&gt;head&lt;/code&gt; element&lt;/a&gt; and has an
-   &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute, then the
-   &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is &lt;a href=&quot;#the-document's-address&quot;&gt;the document's
-   address&lt;/a&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;The &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is the result of the
+     previous step if it was successful; otherwise it is &lt;a href=&quot;#the-document's-address&quot;&gt;the
+     document's address&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the
-   &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute of the first such
-   element.&lt;/li&gt;
+    &lt;/ol&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; URL, using &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt;
-   as the &lt;a href=#base-url&gt;base URL&lt;/a&gt; (thus, the &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute isn't affected by
-   &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes).&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is the result of the
-   previous step if it was successful; otherwise it is &lt;a href=&quot;#the-document's-address&quot;&gt;the
-   document's address&lt;/a&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; the
-  user agent must use the following steps. Resolving a URL can result
-  in an error, in which case the URL is not resolvable.&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;a href=#url&gt;URL&lt;/a&gt; being
-   resolved.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be the &lt;a href=#url-character-encoding&gt;URL character
-   encoding&lt;/a&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is UTF-16, then change it to
-   UTF-8.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;a href=#base-url&gt;base URL&lt;/a&gt;
-   for &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. (This is an &lt;a href=#absolute-url&gt;absolute
-   URL&lt;/a&gt;.)&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;&lt;a href=#parse-a-url title=&quot;parse a URL&quot;&gt;Parse&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/li&gt;
 
    &lt;li&gt;
@@ -4204,8 +4200,8 @@
 
     &lt;p&gt;If the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; identified by the hyperlink is
     being shown to the user, or if any data derived from that URL is
-    affecting the display, then the &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute should be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;reresolved&lt;/a&gt; and the UI updated
-    appropriately.&lt;/p&gt;
+    affecting the display, then the &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute should be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;reresolved&lt;/a&gt; relative to the element
+    and the UI updated appropriately.&lt;/p&gt;
 
     &lt;p class=example&gt;For example, the CSS &lt;code title=&quot;&quot;&gt;:link&lt;/code&gt;/&lt;code title=&quot;&quot;&gt;:visited&lt;/code&gt;
     pseudo-classes might have been affected.&lt;/p&gt;
@@ -4213,7 +4209,8 @@
     &lt;p&gt;If the hyperlink has a &lt;code title=attr-hyperlink-ping&gt;&lt;a href=#ping&gt;ping&lt;/a&gt;&lt;/code&gt; attribute and its &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute URL(s)&lt;/a&gt; are being shown to the
     user, then the &lt;code title=attr-hyperlink-ping&gt;&lt;a href=#ping&gt;ping&lt;/a&gt;&lt;/code&gt;
     attribute's tokens should be &lt;a href=#resolve-a-url title=&quot;resolve a
-    url&quot;&gt;reresolved&lt;/a&gt; and the UI updated appropriately.&lt;/p&gt;
+    url&quot;&gt;reresolved&lt;/a&gt; relative to the element and the UI updated
+    appropriately.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -4225,7 +4222,8 @@
     &lt;p&gt;If the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; identified by the &lt;code title=&quot;&quot;&gt;cite&lt;/code&gt; attribute is being shown to the user, or if
     any data derived from that URL is affecting the display, then the
     &lt;a href=#url&gt;URL&lt;/a&gt; should be &lt;a href=#resolve-a-url title=&quot;resolve a
-    url&quot;&gt;reresolved&lt;/a&gt; and the UI updated appropriately.&lt;/p&gt;
+    url&quot;&gt;reresolved&lt;/a&gt; relative to the element and the UI updated
+    appropriately.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -4397,11 +4395,7 @@
   &lt;p&gt;When a user agent is to &lt;dfn id=fetch&gt;fetch&lt;/dfn&gt; a resource, the
   following steps must be run:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the resource is identified by a &lt;a href=#url&gt;URL&lt;/a&gt;, then
-   immediately &lt;a href=#resolve-a-url title=&quot;resolve a URL&quot;&gt;resolve that
-   URL&lt;/a&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the resource is identified by the &lt;a href=#url&gt;URL&lt;/a&gt;
    &lt;dfn id=about:blank&gt;&lt;code&gt;about:blank&lt;/code&gt;&lt;/dfn&gt;, then return the empty string
    and abort these steps.&lt;/li&gt;
 
@@ -4409,22 +4403,22 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the resource identified by the resulting &lt;a href=#absolute-url&gt;absolute
-    URL&lt;/a&gt; is already being downloaded for other reasons
-    (e.g. another invocation of this algorithm), and the resource is
-    to be obtained using a idempotent action (such as an HTTP GET
-    &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt;),
-    and the user agent is configured such that it is to reuse the data
-    from the existing download instead of initiating a new one, then
-    use the results of the existing download instead of starting a new
+    &lt;p&gt;If the resource is identified by an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;,
+    and the resource is to be obtained using a idempotent action (such
+    as an HTTP GET &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or
+    equivalent&lt;/a&gt;), and it is already being downloaded for other
+    reasons (e.g. another invocation of this algorithm), and the user
+    agent is configured such that it is to reuse the data from the
+    existing download instead of initiating a new one, then use the
+    results of the existing download instead of starting a new
     one.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, at a time convenient to the user and the user agent,
-    download the resource, applying the semantics of the relevant
-    specifications (e.g. performing an HTTP GET or POST operation, or
-    reading the file from disk, following redirects, &lt;a href=#concept-js-deref title=concept-js-deref&gt;dereferencing &lt;span title=&quot;javascript
-    protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt; URLs&lt;/span&gt;&lt;/a&gt;,
-    etc).&lt;/p&gt;
+    download (or otherwise obtain) the resource, applying the
+    semantics of the relevant specifications (e.g. performing an HTTP
+    GET or POST operation, or reading the file from disk, following
+    redirects, &lt;a href=#concept-js-deref title=concept-js-deref&gt;dereferencing &lt;span title=&quot;javascript protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt;
+    URLs&lt;/span&gt;&lt;/a&gt;, etc).&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -5148,24 +5142,25 @@
   &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt;
   attribute whose content attribute is defined to contain a
   &lt;a href=#url&gt;URL&lt;/a&gt;, then on getting, the DOM attribute must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the value of the content
-  attribute and return the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; if that
-  was successful, or the empty string otherwise; and on setting, must
-  set the content attribute to the specified literal value. If the
-  content attribute is absent, the DOM attribute must return the
-  default value, if the content attribute has one, or else the empty
-  string.&lt;/p&gt;
+  attribute relative to the element and return the resulting
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; if that was successful, or the empty
+  string otherwise; and on setting, must set the content attribute to
+  the specified literal value. If the content attribute is absent, the
+  DOM attribute must return the default value, if the content
+  attribute has one, or else the empty string.&lt;/p&gt;
 
   &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt;
   attribute whose content attribute is defined to contain one or more
   &lt;a href=#url title=URL&gt;URLs&lt;/a&gt;, then on getting, the DOM attribute
   must &lt;a href=#split-a-string-on-spaces title=&quot;split a string on spaces&quot;&gt;split the content
   attribute on spaces&lt;/a&gt; and return the concatenation of &lt;a href=#resolve-a-url title=&quot;resolve a URL&quot;&gt;resolving&lt;/a&gt; each token URL to an
-  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, with a single U+0020 SPACE character
-  between each URL, ignoring any tokens that did not resolve
-  successfully. If the content attribute is absent, the DOM attribute
-  must return the default value, if the content attribute has one, or
-  else the empty string. On setting, the DOM attribute must set the
-  content attribute to the specified literal value.&lt;/p&gt;
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; relative to the element, with a single
+  U+0020 SPACE character between each URL, ignoring any tokens that
+  did not resolve successfully. If the content attribute is absent,
+  the DOM attribute must return the default value, if the content
+  attribute has one, or else the empty string. On setting, the DOM
+  attribute must set the content attribute to the specified literal
+  value.&lt;/p&gt;
 
   &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; whose
   content attribute is an &lt;a href=#enumerated-attribute&gt;enumerated attribute&lt;/a&gt;, and the
@@ -6980,10 +6975,10 @@
   its value treated as the body (the part inside the curly brackets)
   of a declaration block in a rule whose selector matches just the
   element on which the attribute is set. All &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; in the value must be &lt;a href=#resolve-a-url title=&quot;resolve a
-  url&quot;&gt;resolved&lt;/a&gt; when the attribute is parsed.&lt;!-- so dynamic
-  changes to the base URL don't affect the CSS --&gt; For the purposes of
-  the CSS cascade, the attribute must be considered to be a 'style'
-  attribute at the author level. &lt;/p&gt;
+  url&quot;&gt;resolved&lt;/a&gt; relative to the element when the attribute is
+  parsed.&lt;!-- so dynamic changes to the base URL don't affect the CSS
+  --&gt; For the purposes of the CSS cascade, the attribute must be
+  considered to be a 'style' attribute at the author level. &lt;/p&gt;
 
   &lt;p&gt;Documents that use &lt;code title=attr-style&gt;&lt;a href=#the-style-attribute&gt;style&lt;/a&gt;&lt;/code&gt;
   attributes on any of their elements must still be comprehensible and
@@ -8468,9 +8463,8 @@
   dynamically thus has no effect (and thus, no DOM API is provided for
   this attribute).&lt;/p&gt;
 
-  &lt;p class=note&gt;Later &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; elements don't affect the
-  &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving of relative URLs&lt;/a&gt; in
-  &lt;code title=attr-html-manifest&gt;&lt;a href=#attr-html-manifest&gt;manifest&lt;/a&gt;&lt;/code&gt; attributes, as the
+  &lt;p class=note&gt;For the purposes of &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection&lt;/a&gt;,
+  later &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; elements cannot affect the &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving of relative URLs&lt;/a&gt; in &lt;code title=attr-html-manifest&gt;&lt;a href=#attr-html-manifest&gt;manifest&lt;/a&gt;&lt;/code&gt; attributes, as the
   attributes are processed before those elements are seen.&lt;/p&gt;
 
 
@@ -8677,9 +8671,13 @@
   applied (as defined below). For external resources that are
   represented in the DOM (for example, style sheets), the DOM
   representation must be made available even if the resource is not
-  applied. (However, user agents may opt to only &lt;a href=#fetch&gt;fetch&lt;/a&gt;
-  such resources when they are needed, instead of pro-actively &lt;a href=#fetch title=fetch&gt;fetching&lt;/a&gt; all the external resources that are
-  not applied.)&lt;/p&gt;
+  applied. To obtain the resource, the user agent must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt; given by
+  the &lt;code title=attr-link-href&gt;&lt;a href=#attr-link-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute, relative to
+  the element, and then &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resulting
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;. User agents may opt to only
+  &lt;a href=#fetch&gt;fetch&lt;/a&gt; such resources when they are needed, instead of
+  pro-actively &lt;a href=#fetch title=fetch&gt;fetching&lt;/a&gt; all the external
+  resources that are not applied.&lt;/p&gt;
 
   &lt;p&gt;The semantics of the protocol used (e.g. HTTP) must be followed
   when fetching external resources. (For example, redirects must be
@@ -9306,9 +9304,8 @@
      &lt;li&gt;&lt;p&gt;Strip any U+0009 CHARACTER TABULATION, U+000A LINE FEED
      (LF), and U+000D CARRIAGE RETURN (CR) characters from &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; value to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;. (For
-     the purposes of determining the &lt;a href=#base-url&gt;base URL&lt;/a&gt;, the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; value comes from the value of a content
-     attribute of the &lt;code&gt;&lt;a href=#meta&gt;meta&lt;/a&gt;&lt;/code&gt; element.) If this fails, abort
+     &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; value to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;,
+     relative to the &lt;code&gt;&lt;a href=#meta&gt;meta&lt;/a&gt;&lt;/code&gt; element. If this fails, abort
      these steps.&lt;/li&gt;
 
      &lt;li&gt;
@@ -9548,9 +9545,10 @@
   nodes of the &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt; element to the style system.&lt;/p&gt;
 
   &lt;p&gt;All &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; found by the styling language's
-  processor must be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; when
-  it is invoked.&lt;!-- so dynamic changes to the base URL don't affect
-  the CSS --&gt;&lt;/p&gt;
+  processor must be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt;,
+  relative to the element (or as defined by the styling language),
+  when the processor is invoked.&lt;!-- so dynamic changes to the base
+  URL don't affect the CSS --&gt;&lt;/p&gt;
 
   &lt;p class=note&gt;This specification does not specify a style system,
   but CSS is expected to be supported by most Web browsers. &lt;a href=#refsCSS21&gt;[CSS21]&lt;/a&gt;&lt;/p&gt;
@@ -9600,10 +9598,11 @@
 
    &lt;dd&gt;&lt;p&gt;For &lt;code&gt;&lt;a href=#the-link-element&gt;link&lt;/a&gt;&lt;/code&gt; elements, the location must be the
    result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the
-   &lt;a href=#url&gt;URL&lt;/a&gt; given by the element's &lt;code title=attr-link-href&gt;&lt;a href=#attr-link-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute, or the empty
-   string if that fails. For &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt; elements, there is no
-   location.&lt;/dd&gt; &lt;!-- note that this might not match the style
-   sheet URL, if the base URL has changed for instance --&gt;
+   &lt;a href=#url&gt;URL&lt;/a&gt; given by the element's &lt;code title=attr-link-href&gt;&lt;a href=#attr-link-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute, relative to
+   the element, or the empty string if that fails. For
+   &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt; elements, there is no location.&lt;/dd&gt; &lt;!--
+   note that this might not match the style sheet URL, if the base URL
+   has changed for instance --&gt;
 
    &lt;dt&gt;The intended destination media for style information (&lt;code title=dom-stylesheet-media&gt;media&lt;/code&gt; DOM attribute)&lt;/dt&gt;
 
@@ -9861,7 +9860,8 @@
    &lt;li&gt;
 
     &lt;p&gt;If the element has a &lt;code title=attr-script-src&gt;&lt;a href=#attr-script-src&gt;src&lt;/a&gt;&lt;/code&gt;
-    attribute, then the specified resource must be &lt;a href=#fetch title=fetch&gt;fetched&lt;/a&gt;.&lt;/p&gt;
+    attribute, then the value of that attribute must be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; relative to the element, and
+    if that is successful, the specified resource must then be &lt;a href=#fetch title=fetch&gt;fetched&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;For historical reasons, if the &lt;a href=#url&gt;URL&lt;/a&gt; is a &lt;a href=#javascript-protocol title=&quot;javascript protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt;
     URL&lt;/a&gt;, then the user agent must not, despite the requirements
@@ -9891,8 +9891,9 @@
     document&quot;&gt;inserted into the document&lt;/a&gt;, the load must have
     started. If the UA performs such prefetching, but the element is
     never inserted in the document, or the &lt;code title=attr-script-src&gt;&lt;a href=#attr-script-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute is dynamically
-    changed, then the user agent will not execute the script, and the
-    fetching process will have been effectively wasted.&lt;/p&gt;
+    changed,&lt;!-- or the base URL is dynamically changed,--&gt; then the
+    user agent will not execute the script, and the fetching process
+    will have been effectively wasted.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -10434,14 +10435,15 @@
   follows:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt;
-   specified by the &lt;code&gt;&lt;a href=#the-eventsource-element&gt;eventsource&lt;/a&gt;&lt;/code&gt; element's &lt;code title=attr-eventsource-src&gt;&lt;a href=#attr-eventsource-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute.&lt;/li&gt;
+   specified by the &lt;code&gt;&lt;a href=#the-eventsource-element&gt;eventsource&lt;/a&gt;&lt;/code&gt; element's &lt;code title=attr-eventsource-src&gt;&lt;a href=#attr-eventsource-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute, relative to the
+   element.&lt;/li&gt;
 
    &lt;li&gt;If that fails, then set the element's &lt;i&gt;current declared event
    source&lt;/i&gt; to &quot;undefined&quot; and abort these steps.&lt;/li&gt;
 
-   &lt;li&gt;Otherwise, act as if the &lt;code title=dom-remoteEventTarget-addEventSource&gt;&lt;a href=#dom-remoteeventtarget-addeventsource&gt;addEventSource()&lt;/a&gt;&lt;/code&gt;
-   method on the &lt;code&gt;&lt;a href=#the-eventsource-element&gt;eventsource&lt;/a&gt;&lt;/code&gt; element had been invoked
-   with the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;Otherwise, add the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to the
+   &lt;a href=#concept-eventsource-list title=concept-eventsource-list&gt;list of event sources&lt;/a&gt;
+   for the element.&lt;/li&gt;
 
    &lt;li&gt;Let the element's &lt;i&gt;current declared event source&lt;/i&gt; be that
    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
@@ -10452,9 +10454,9 @@
   &lt;ol&gt;&lt;li&gt;If the element's &lt;i&gt;current declared event source&lt;/i&gt; is
    &quot;undefined&quot;, abort these steps.&lt;/li&gt;
 
-   &lt;li&gt;Otherwise, act as if the &lt;code title=dom-remoteEventTarget-removeEventSource&gt;&lt;a href=#dom-remoteeventtarget-removeeventsource&gt;removeEventSource()&lt;/a&gt;&lt;/code&gt;
-   method on the &lt;code&gt;&lt;a href=#the-eventsource-element&gt;eventsource&lt;/a&gt;&lt;/code&gt; element had been invoked
-   with the element's &lt;i&gt;current declared event source&lt;/i&gt;.&lt;/li&gt;
+   &lt;li&gt;Otherwise, remove the element's &lt;i&gt;current declared event
+   source&lt;/i&gt; from the &lt;a href=#concept-eventsource-list title=concept-eventsource-list&gt;list of
+   event sources&lt;/a&gt; for the element.&lt;/li&gt;
 
    &lt;li&gt;Let the element's &lt;i&gt;current declared event source&lt;/i&gt; be
    &quot;undefined&quot;.&lt;/li&gt;
@@ -10465,8 +10467,7 @@
   number of simultaneous connections that a user agent can open per
   server.&lt;/p&gt;
 
-  &lt;!-- XXX should we make 'load', 'error', 'abort' events fire on this
-  element? --&gt;
+  &lt;!-- v2: make 'load', 'error', 'abort' events fire on this element --&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-eventsource-src title=dom-eventsource-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt; DOM
   attribute must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the content attribute of the
@@ -11754,11 +11755,14 @@
   attribute.&lt;/p&gt;
 
   &lt;p&gt;If the &lt;code title=attr-blockquote-cite&gt;&lt;a href=#attr-blockquote-cite&gt;cite&lt;/a&gt;&lt;/code&gt; attribute
-  is present, it must be a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;. User agents should
-  allow users to follow such citation links.&lt;/p&gt;
+  is present, it must be a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;. To obtain the
+  corresponding citation link, the value of the attribute must be
+  &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; relative to the
+  element. User agents should allow users to follow such citation
+  links.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-quote-cite title=dom-quote-cite&gt;&lt;code&gt;cite&lt;/code&gt;&lt;/dfn&gt; DOM
-  attribute must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the element's &lt;code title=&quot;&quot;&gt;cite&lt;/code&gt; content attribute.
+  attribute must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the element's &lt;code title=&quot;&quot;&gt;cite&lt;/code&gt; content attribute.&lt;/p&gt;
 
   &lt;p class=note&gt;The best way to represent a conversation is not with
   the &lt;code&gt;&lt;a href=#the-cite-element&gt;cite&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a href=#the-blockquote-element&gt;blockquote&lt;/a&gt;&lt;/code&gt; elements, but with
@@ -12486,8 +12490,11 @@
   screenplay.&lt;/p&gt;
 
   &lt;p&gt;If the &lt;code title=attr-q-cite&gt;&lt;a href=#attr-q-cite&gt;cite&lt;/a&gt;&lt;/code&gt; attribute is
-  present, it must be a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;. User agents should
-  allow users to follow such citation links.&lt;/p&gt;
+  present, it must be a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;. To obtain the
+  corresponding citation link, the value of the attribute must be
+  &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; relative to the
+  element. User agents should allow users to follow such citation
+  links.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#the-q-element&gt;q&lt;/a&gt;&lt;/code&gt; element must not be used in place of quotation
   marks that do not represent quotes; for example, it is inappropriate
@@ -14707,8 +14714,10 @@
 
   &lt;p&gt;If the &lt;code title=attr-mod-cite&gt;&lt;a href=#attr-mod-cite&gt;cite&lt;/a&gt;&lt;/code&gt; attribute is
   present, it must be a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt; that explains the
-  change. User agents should allow users to follow such citation
-  links.&lt;/p&gt;
+  change. To obtain the corresponding citation link, the value of the
+  attribute must be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt;
+  relative to the element. User agents should allow users to follow
+  such citation links.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=attr-mod-datetime title=attr-mod-datetime&gt;&lt;code&gt;datetime&lt;/code&gt;&lt;/dfn&gt;
   attribute may be used to specify the time and date of the change.&lt;/p&gt;
@@ -15046,24 +15055,25 @@
   attribute's value are described &lt;a href=#alt&gt;in the next
   section&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;p class=XXX&gt;There has been some suggestion that the &lt;code title=&quot;&quot;&gt;longdesc&lt;/code&gt; attribute from HTML4, or some other
-  mechanism that is more powerful than &lt;code title=&quot;&quot;&gt;alt=&quot;&quot;&lt;/code&gt;,
-  should be included. This has been considered and rejected in the
-  past, but may be considered again in the future.&lt;/p&gt;
+  &lt;p class=XXX&gt;There has been some suggestion that the &lt;code title=&quot;&quot;&gt;longdesc&lt;/code&gt; attribute from HTML4 should be
+  included. This has been considered and rejected in the past, but if
+  new evidence is found showing the attribute to actually help users
+  rather than harm them, it may be reconsidered.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; must not be used as a layout tool. In
   particular, &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; elements should not be used to display
   fully transparent images, as they rarely convey meaning and rarely
   add anything useful to the document.&lt;/p&gt;
 
-  &lt;hr&gt;&lt;p&gt;When an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; is created with a &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute, and whenever the &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute is set subsequently, the
-  user agent must &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resource specifed by the
-  &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute's value, unless the
-  user agent cannot support images, or its support for images has been
-  disabled, or the user agent only fetches elements on demand, or the
-  element's &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute has a
-  value that is an &lt;i&gt;ignored self-reference&lt;/i&gt;.&lt;/p&gt; &lt;!-- Note how
-  this does NOT happen when the base URL changes. --&gt;
+  &lt;hr&gt;&lt;p&gt;Unless the user agent cannot support images, or its support for
+  images has been disabled, or the user agent only fetches elements on
+  demand, or the element's &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt;
+  attribute has a value that is an &lt;i&gt;ignored self-reference&lt;/i&gt;,
+  then, when an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; is created with a &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute, and whenever the &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute is set subsequently, the
+  user agent must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the value
+  of that attribute, relative to the element, and if that is
+  successful must then &lt;a href=#fetch&gt;fetch&lt;/a&gt; that resource.&lt;/p&gt; &lt;!-- Note
+  how this does NOT happen when the base URL changes. --&gt;
 
   &lt;p&gt;The &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute's value is an
   &lt;i&gt;ignored self-reference&lt;/i&gt; if its value is the empty string, and
@@ -16273,24 +16283,30 @@
   gives the address of a page that the nested &lt;a href=#browsing-context&gt;browsing
   context&lt;/a&gt; is to contain. The attribute, if present, must be a
   &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;. When the browsing context is created, if the
-  attribute is present, the user agent must &lt;a href=#navigate&gt;navigate&lt;/a&gt; the
-  element's browsing context to the given &lt;a href=#url&gt;URL&lt;/a&gt;, with
-  &lt;a href=#replacement-enabled&gt;replacement enabled&lt;/a&gt;, and with the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;
-  element's document's &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; as the
-  &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;. If the user &lt;a href=#navigate title=navigate&gt;navigates&lt;/a&gt; away from this page, the
-  &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;'s corresponding &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object will
-  reference new &lt;code&gt;Document&lt;/code&gt; objects, but the &lt;code title=attr-iframe-src&gt;&lt;a href=#attr-iframe-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute will not change.&lt;/p&gt;
+  attribute is present, the user agent must &lt;a href=#resolve-a-url title=&quot;resolve a
+  url&quot;&gt;resolve&lt;/a&gt; the value of that attribute, relative to the
+  element, and if that is successful, must then &lt;a href=#navigate&gt;navigate&lt;/a&gt;
+  the element's browsing context to the resulting &lt;a href=#absolute-url&gt;absolute
+  URL&lt;/a&gt;, with &lt;a href=#replacement-enabled&gt;replacement enabled&lt;/a&gt;, and with the
+  &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's document's &lt;a href=#browsing-context&gt;browsing
+  context&lt;/a&gt; as the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;. If the
+  user &lt;a href=#navigate title=navigate&gt;navigates&lt;/a&gt; away from this page,
+  the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;'s corresponding &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object
+  will reference new &lt;code&gt;Document&lt;/code&gt; objects, but the &lt;code title=attr-iframe-src&gt;&lt;a href=#attr-iframe-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute will not change.&lt;/p&gt;
 
   &lt;p&gt;Whenever the &lt;code title=attr-iframe-src&gt;&lt;a href=#attr-iframe-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute
-  is set, the nested &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; must be &lt;a href=#navigate title=navigate&gt;navigated&lt;/a&gt; to the &lt;a href=#url&gt;URL&lt;/a&gt; given by
-  that attribute's value, with the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's
-  document's &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; as the &lt;a href=#source-browsing-context&gt;source
-  browsing context&lt;/a&gt;.&lt;/p&gt; &lt;!-- It doesn't happen when the base
-  URL is changed, though. --&gt;
+  is set, the user agent must &lt;a href=#resolve-a-url title=&quot;resolve a
+  url&quot;&gt;resolve&lt;/a&gt; the value of that attribute, relative to the
+  element, and if that is successful, the nested &lt;a href=#browsing-context&gt;browsing
+  context&lt;/a&gt; must be &lt;a href=#navigate title=navigate&gt;navigated&lt;/a&gt; to
+  the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, with the
+  &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's document's &lt;a href=#browsing-context&gt;browsing
+  context&lt;/a&gt; as the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;.&lt;/p&gt; &lt;!--
+  It doesn't happen when the base URL is changed, though. --&gt;
 
   &lt;p&gt;If the &lt;code title=attr-iframe-src&gt;&lt;a href=#attr-iframe-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute is not
-  set when the element is created, the browsing context will remain at
-  the initial &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt; page.&lt;/p&gt;
+  set when the element is created, or if its value cannot be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt;, the browsing context will
+  remain at the initial &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt; page.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=attr-iframe-name title=attr-iframe-name&gt;&lt;code&gt;name&lt;/code&gt;&lt;/dfn&gt;
   attribute, if present, must be a &lt;a href=#valid-browsing-context-name&gt;valid browsing context
@@ -16718,9 +16734,10 @@
   &lt;p&gt;When the element is created with a &lt;code title=attr-embed-src&gt;&lt;a href=#attr-embed-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute, and whenever the &lt;code title=attr-embed-src&gt;&lt;a href=#attr-embed-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute is subsequently set, and
   whenever the &lt;code title=attr-embed-type&gt;&lt;a href=#attr-embed-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute is
   set or removed while the element has a &lt;code title=attr-embed-src&gt;&lt;a href=#attr-embed-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute, if the element is not
-  in a sandboxed browsing context, user agents should
-  &lt;a href=#fetch&gt;fetch&lt;/a&gt; the specified resource, find and instantiate an
-  appropriate &lt;a href=#plugin&gt;plugin&lt;/a&gt; based on the &lt;a href=#concept-embed-type title=concept-embed-type&gt;content's type&lt;/a&gt;, and hand that
+  in a sandboxed browsing context, user agents must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the value of the attribute,
+  relative to the element, and if that is successful, should
+  &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, find and
+  instantiate an appropriate &lt;a href=#plugin&gt;plugin&lt;/a&gt; based on the &lt;a href=#concept-embed-type title=concept-embed-type&gt;content's type&lt;/a&gt;, and hand that
   &lt;a href=#plugin&gt;plugin&lt;/a&gt; the content of the resource, replacing any
   previously instantiated plugin for the element. &lt;!-- Note that this
   doesn't happen when the base URL changes. --&gt;&lt;/p&gt;
@@ -16928,8 +16945,13 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;&lt;a href=#fetch&gt;Fetch&lt;/a&gt; the resource specified by the &lt;code title=attr-object-data&gt;&lt;a href=#attr-object-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
+      &lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the
+      &lt;a href=#url&gt;URL&lt;/a&gt; specified by the &lt;code title=attr-object-data&gt;&lt;a href=#attr-object-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute, relative to the
+      element.&lt;/p&gt;
 
+      &lt;p&gt;If that is successful, &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resulting
+      &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/p&gt;
+
       &lt;p&gt;The fetching of the resource must &lt;a href=#delay-the-load-event&gt;delay the &lt;code title=event-load&gt;load&lt;/code&gt; event&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/li&gt;
@@ -16943,10 +16965,11 @@
      agents may opt to consider a resource &quot;available&quot; whenever enough
      data has been obtained to begin processing the resource.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If the load failed (e.g. an HTTP 404 error, a DNS error),
-     &lt;a href=#fire-an-error-event&gt;fire an &lt;code title=event-error&gt;error&lt;/code&gt; event&lt;/a&gt;
-     at the element, then jump to the last step in the overall set of
-     steps (fallback).&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;If the load failed (e.g. the &lt;a href=#url&gt;URL&lt;/a&gt; could not be
+     &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt;, there was an HTTP
+     404 error, there was a DNS error), &lt;a href=#fire-an-error-event&gt;fire an &lt;code title=event-error&gt;error&lt;/code&gt; event&lt;/a&gt; at the element,
+     then jump to the last step in the overall set of steps
+     (fallback).&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Determine the &lt;var title=&quot;&quot;&gt;resource type&lt;/var&gt;, as follows:&lt;/p&gt;
 
@@ -17037,7 +17060,8 @@
 
         &lt;p class=XXX&gt;navigation might end up treating it as
         something else, because it can do sniffing. how should we
-        handle that?&lt;/p&gt;
+        handle that? it could also refetch the resource entirely,
+        maybe from another application cache.&lt;/p&gt;
 
         &lt;!-- note that malformed XML files don't cause fallback --&gt;
 
@@ -17301,11 +17325,13 @@
   attribute gives the address of an image file that the user agent can
   show while no video data is available. The attribute, if present,
   must contain a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;. If the specified resource is
-  to be used, it must be &lt;a href=#fetch title=fetch&gt;fetched&lt;/a&gt; when the
-  element is created or when the &lt;code title=attr-video-poster&gt;&lt;a href=#attr-video-poster&gt;poster&lt;/a&gt;&lt;/code&gt; attribute is set. The
+  to be used, then, when the element is created or when the &lt;code title=attr-video-poster&gt;&lt;a href=#attr-video-poster&gt;poster&lt;/a&gt;&lt;/code&gt; attribute is set, its value
+  must be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; relative to the
+  element, and if that is successful, the resulting &lt;a href=#absolute-url&gt;absolute
+  URL&lt;/a&gt; must be &lt;a href=#fetch title=fetch&gt;fetched&lt;/a&gt;. The
   &lt;dfn id=poster-frame&gt;poster frame&lt;/dfn&gt; is then the image obtained from that
-  resource, if any.&lt;/p&gt; &lt;!-- So that it is unaffected by changes to
-  the base URL.  --&gt;
+  resource, if any.&lt;/p&gt; &lt;!-- thus it is unaffected by changes to the
+  base URL. --&gt;
 
   &lt;p class=note&gt;The image given by the &lt;code title=attr-video-poster&gt;&lt;a href=#attr-video-poster&gt;poster&lt;/a&gt;&lt;/code&gt; attribute, the &lt;i&gt;&lt;a href=#poster-frame&gt;poster
   frame&lt;/a&gt;&lt;/i&gt;, is intended to be a representative frame of the video
@@ -17899,7 +17925,8 @@
     substeps:&lt;/p&gt;
 
     &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the
-     &lt;a href=#url&gt;URL&lt;/a&gt; given in that attribute.&lt;/p&gt;
+     &lt;a href=#url&gt;URL&lt;/a&gt; given in that attribute, relative to the
+     &lt;a href=#media-element&gt;media element&lt;/a&gt;.&lt;/p&gt;
 
      &lt;li&gt;&lt;p&gt;If that is successful, then return a list consisting of
      only one entry, the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; as the
@@ -17934,8 +17961,8 @@
 
      &lt;li&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolving&lt;/a&gt; the
      &lt;a href=#url&gt;URL&lt;/a&gt; given by the &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;
-     element's &lt;code title=attr-source-src&gt;&lt;a href=#attr-source-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute does
-     not fail.&lt;/li&gt;
+     element's &lt;code title=attr-source-src&gt;&lt;a href=#attr-source-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute
+     relative to &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; does not fail.&lt;/li&gt;
 
      &lt;li&gt;The &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; element either has no &lt;code title=attr-source-type&gt;&lt;a href=#attr-source-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute, or its &lt;code title=attr-source-type&gt;&lt;a href=#attr-source-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute's value, when
      parsed as a MIME type (including any codecs described by the
@@ -17949,7 +17976,8 @@
 
     &lt;/ul&gt;&lt;p&gt;...then append the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; resulting from
     &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt;
-    given in that &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; element's &lt;code title=attr-source-src&gt;&lt;a href=#attr-source-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute to the &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; list.&lt;/p&gt;
+    given in that &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; element's &lt;code title=attr-source-src&gt;&lt;a href=#attr-source-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute relative to &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;
+    list.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -27276,11 +27304,14 @@
   optionally animated, image resource that is neither paged nor
   scripted.&lt;/p&gt;
 
-  &lt;p&gt;When any of the following events occur, the user agent must
-  &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resource specifed by the &lt;code title=attr-input-src&gt;&lt;a href=#attr-input-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute's value, unless the user
-  agent cannot support images, or its support for images has been
-  disabled, or the user agent only fetches elements on demand:&lt;/p&gt;
-  &lt;!-- Note how this does NOT happen when the base URL changes. --&gt;
+  &lt;p&gt;When any of the following events occur, unless the user agent
+  cannot support images, or its support for images has been disabled,
+  or the user agent only fetches elements on demand, the user agent
+  must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the value of the
+  &lt;code title=attr-input-src&gt;&lt;a href=#attr-input-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute, relative to the
+  element, and if that is successful, must &lt;a href=#fetch&gt;fetch&lt;/a&gt; the
+  resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;:&lt;/p&gt; &lt;!-- Note how this does NOT
+  happen when the base URL changes. --&gt;
 
   &lt;ul&gt;&lt;li&gt;The &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element's &lt;code title=attr-input-type&gt;&lt;a href=#attr-input-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute is first set to the
    &lt;a href=#image-button-state title=attr-input-type-image&gt;Image Button&lt;/a&gt; state
@@ -29903,8 +29934,9 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the
-   &lt;a href=#url&gt;URL&lt;/a&gt; &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;. If this fails, abort
-   these steps.&lt;/li&gt;
+   &lt;a href=#url&gt;URL&lt;/a&gt; &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;, relative to the &lt;var title=&quot;&quot;&gt;submitter&lt;/var&gt; element. If this fails, abort these
+   steps. Otherwise, let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be the resulting
+   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; of the resulting
    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
@@ -31018,11 +31050,11 @@
     &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getRowImage&gt;&lt;a href=#dom-provider-getrowimage&gt;getRowImage(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;: The &lt;a href=#url&gt;URL&lt;/a&gt; of the
     row's image is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained by &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the value of the &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute of the first
     &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element child of the row's first cell's element,
-    if there is one and resolving its attribute is
-    successful. Otherwise, the &lt;a href=#url&gt;URL&lt;/a&gt; of the row's image is
-    the empty string.&lt;/p&gt; &lt;!-- note that if the base URL has changed,
-    this URL can be different than the one that the &lt;img&gt; element
-    fetched when it was created --&gt;
+    relative to that element, if there is one and resolving its
+    attribute is successful. Otherwise, the &lt;a href=#url&gt;URL&lt;/a&gt; of the
+    row's image is the empty string.&lt;/p&gt; &lt;!-- note that if the base
+    URL has changed, this URL can be different than the one that the
+    &lt;img&gt; element fetched when it was created --&gt;
 
     &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getRowMenu&gt;&lt;a href=#dom-provider-getrowmenu&gt;getRowMenu(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;: If the row's first cell's
     element has a &lt;code&gt;&lt;a href=#menus&gt;menu&lt;/a&gt;&lt;/code&gt; element child, then the row's menu
@@ -31233,11 +31265,11 @@
     the first &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element descendant (in the real DOM) of
     the row's element, that is not also a descendant of another
     element in the filtered view that is a descendant of the row's
-    element, if such an element exists and resolving its attribute is
-    successful. Otherwise, it must return the empty string.&lt;/p&gt; &lt;!--
-    note that if the base URL has changed, this URL can be different
-    than the one that the &lt;img&gt; element fetched when it was created
-    --&gt;
+    element, if such an element exists and resolving its attribute
+    relative to the element itself, is successful. Otherwise, it must
+    return the empty string.&lt;/p&gt; &lt;!-- note that if the base URL has
+    changed, this URL can be different than the one that the &lt;img&gt;
+    element fetched when it was created --&gt;
 
     &lt;div class=example&gt;
 
@@ -31680,12 +31712,12 @@
 
    &lt;dd&gt;Invoke the &lt;code title=dom-provider-getRowImage&gt;&lt;a href=#dom-provider-getrowimage&gt;getRowImage()&lt;/a&gt;&lt;/code&gt; method with a
    &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing the row in
-   question. The return value is a &lt;a href=#url&gt;URL&lt;/a&gt;. Immediately &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; that URL as if it came from an
-   attribute of the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element to obtain an
-   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; identifying the image that represents the
-   row. If the method returns the empty string, null, or if the method
-   is not defined, then the row has no associated image.&lt;/dd&gt; &lt;!--
-   changing the base URL doesn't change the image used later --&gt;
+   question. The return value is a &lt;a href=#url&gt;URL&lt;/a&gt;. Immediately &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; that URL, relative to the
+   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element, to obtain an &lt;a href=#absolute-url&gt;absolute
+   URL&lt;/a&gt; identifying the image that represents the row. If the
+   method returns the empty string, null, or if the method is not
+   defined, then the row has no associated image.&lt;/dd&gt; &lt;!-- changing
+   the base URL doesn't change the image used later --&gt;
 
    &lt;dt&gt;To obtain a context menu appropriate for a particular row&lt;/dt&gt;
 
@@ -32167,7 +32199,12 @@
   &lt;p&gt;The &lt;dfn id=attr-command-icon title=attr-command-icon&gt;&lt;code&gt;icon&lt;/code&gt;&lt;/dfn&gt;
   attribute gives a picture that represents the command. If the
   attribute is specified, the attribute's value must contain a
-  &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;.&lt;/p&gt;
+  &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;. To obtain the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
+  the icon, the attribute's value must be &lt;a href=#resolve-a-url title=&quot;resolve a
+  url&quot;&gt;resolved&lt;/a&gt; relative to the element.&lt;/p&gt; &lt;!-- this is
+  affected by the base URL being changed, so users of this should
+  cache the image once they've fetched it once, at least until the
+  relative url changes again --&gt;
 
   &lt;p&gt;The &lt;dfn id=attr-command-disabled title=attr-command-disabled&gt;&lt;code&gt;disabled&lt;/code&gt;&lt;/dfn&gt; attribute
   is a &lt;a href=#boolean-attribute&gt;boolean attribute&lt;/a&gt; that, if present, indicates that
@@ -32614,11 +32651,12 @@
    this means for each facet --&gt;. If the element is a
    &lt;code&gt;&lt;a href=#the-command&gt;command&lt;/a&gt;&lt;/code&gt; element with a &lt;code title=attr-command-default&gt;&lt;a href=#attr-command-default&gt;default&lt;/a&gt;&lt;/code&gt; attribute, mark the
    command as being a default command.&lt;/dd&gt; &lt;!-- XXX if there's an
-   Icon URL for the command, it should be &lt;span
+   Icon facet for the command, it should be &lt;span
    title=&quot;fetch&quot;&gt;fetched&lt;/span&gt;, and then that image should be
    associated with the command, such that each command only has its
    image fetched once, to prevent changes to the base URL from having
-   effects after the image has been fetched once. --&gt;
+   effects after the image has been fetched once. (no need to resolve
+   the Icon facet, it's an absolute URL) --&gt;
 
 
    &lt;dt&gt;An &lt;code&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt; element&lt;/dt&gt;
@@ -32951,10 +32989,9 @@
   &lt;p&gt;The &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; of the command
   is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained from &lt;a href=#resolve-a-url title=&quot;resolve
   a url&quot;&gt;resolving&lt;/a&gt; the value of the &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute of the first
-  &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element descendant of the element, if there is such
-  an element and resolving its attribute is successful. Otherwise,
-  there is no &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; for the
-  command.&lt;/p&gt;
+  &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element descendant of the element, relative to that
+  element, if there is such an element and resolving its attribute is
+  successful. Otherwise, there is no &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; for the command.&lt;/p&gt;
 
   &lt;p&gt;The &lt;a href=#command-facet-hiddenstate title=command-facet-HiddenState&gt;Hidden State&lt;/a&gt;
   of the command is true (hidden) if the element has a &lt;code title=attr-hidden&gt;&lt;a href=#the-hidden-attribute&gt;hidden&lt;/a&gt;&lt;/code&gt; attribute, and false
@@ -33117,9 +33154,9 @@
 
   &lt;p&gt;The &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; for the command
   is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained from &lt;a href=#resolve-a-url title=&quot;resolve
-  a url&quot;&gt;resolving&lt;/a&gt; the value of the element's &lt;code title=attr-command-icon&gt;&lt;a href=#attr-command-icon&gt;icon&lt;/a&gt;&lt;/code&gt; attribute, if it has such an
-  attribute and resolving it is successful. Otherwise, there is no
-  &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; for the command.&lt;/p&gt;
+  a url&quot;&gt;resolving&lt;/a&gt; the value of the element's &lt;code title=attr-command-icon&gt;&lt;a href=#attr-command-icon&gt;icon&lt;/a&gt;&lt;/code&gt; attribute, relative to the
+  element, if it has such an attribute and resolving it is
+  successful. Otherwise, there is no &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; for the command.&lt;/p&gt;
 
   &lt;p&gt;The &lt;a href=#command-facet-hiddenstate title=command-facet-HiddenState&gt;Hidden State&lt;/a&gt;
   of the command is true (hidden) if the element has a &lt;code title=attr-hidden&gt;&lt;a href=#the-hidden-attribute&gt;hidden&lt;/a&gt;&lt;/code&gt; attribute, and false
@@ -33166,10 +33203,10 @@
   &lt;p&gt;The &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; of the command
   is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained from &lt;a href=#resolve-a-url title=&quot;resolve
   a url&quot;&gt;resolving&lt;/a&gt; the value of the &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute of the first
-  &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element descendant of the element, if there is such
-  an element and resolving its attribute is successful. Otherwise, the
-  &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; is a user-agent-defined
-  image appropriate for the &lt;code&gt;&lt;a href=#the-bb-element&gt;bb&lt;/a&gt;&lt;/code&gt; element's &lt;code title=attr-bb-type&gt;&lt;a href=#attr-bb-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute's state.&lt;/p&gt;
+  &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element descendant of the element, relative to that
+  element, if there is such an element and resolving its attribute is
+  successful. Otherwise, the &lt;a href=#command-facet-icon title=command-facet-Icon&gt;Icon&lt;/a&gt; is a user-agent-defined image
+  appropriate for the &lt;code&gt;&lt;a href=#the-bb-element&gt;bb&lt;/a&gt;&lt;/code&gt; element's &lt;code title=attr-bb-type&gt;&lt;a href=#attr-bb-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute's state.&lt;/p&gt;
 
   &lt;p&gt;The &lt;a href=#command-facet-hiddenstate title=command-facet-HiddenState&gt;Hidden State&lt;/a&gt;
   facet of the command is true (hidden) if the &lt;code&gt;&lt;a href=#the-bb-element&gt;bb&lt;/a&gt;&lt;/code&gt;
@@ -33534,8 +33571,13 @@
   be made the same as members of any other group. Each such group is a
   &lt;dfn id=unit-of-related-similar-origin-browsing-contexts&gt;unit of related similar-origin browsing contexts&lt;/dfn&gt;.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;a href=#unit-of-related-similar-origin-browsing-contexts&gt;unit of related similar-origin browsing
+  contexts&lt;/a&gt; has a &lt;dfn id=current-script-base-url&gt;current script base URL&lt;/dfn&gt; which is
+  used to &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; relative &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; used in scripts running in that &lt;a href=#unit-of-related-similar-origin-browsing-contexts&gt;unit
+  of related similar-origin browsing contexts&lt;/a&gt;.&lt;/p&gt;
 
 
+
   &lt;h4 id=browsing-context-names&gt;&lt;span class=secno&gt;5.1.6 &lt;/span&gt;Browsing context names&lt;/h4&gt;
 
   &lt;p&gt;Browsing contexts can have a &lt;dfn id=browsing-context-name&gt;browsing context name&lt;/dfn&gt;. By
@@ -33798,7 +33840,8 @@
   context. If no arguments are provided, or if the first argument is
   the empty string, then the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument defaults
   to &quot;&lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;&quot;. The argument must be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; to an &lt;a href=#absolute-url&gt;absolute
-  URL&lt;/a&gt; (or an error) when the method is invoked.&lt;/p&gt;
+  URL&lt;/a&gt; (or an error), relative to the &lt;a href=#current-script-base-url&gt;current script base
+  URL&lt;/a&gt;, when the method is invoked.&lt;/p&gt;
 
   &lt;p&gt;The second argument, &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;, specifies the
   &lt;a href=#browsing-context-name title=&quot;browsing context name&quot;&gt;name&lt;/a&gt; of the browsing
@@ -33838,14 +33881,14 @@
   &lt;p&gt;Then, the user agent must &lt;a href=#navigate&gt;navigate&lt;/a&gt; the selected
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; (or
   error) obtained from &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt;
-  &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. If the &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt; is true,
-  then &lt;a href=#replacement-enabled title=&quot;replacement enabled&quot;&gt;replacement must be
+  &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; earlier. If the &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt;
+  is true, then &lt;a href=#replacement-enabled title=&quot;replacement enabled&quot;&gt;replacement must be
   enabled&lt;/a&gt;; otherwise, it must not be enabled unless the
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; was just created as part of the
   &lt;a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name&gt;the rules for choosing a browsing context given a browsing
   context name&lt;/a&gt;. The navigation must be done with the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing context&lt;/a&gt; of the
-  &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method as the &lt;a href=#source-browsing-context&gt;source browsing
-  context&lt;/a&gt;.&lt;/p&gt;
+  &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method
+  as the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;The method must return the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the
   default view of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; that was
@@ -34692,38 +34735,45 @@
   &lt;/dl&gt;&lt;h5 id=calling-scripts&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Calling scripts&lt;/h5&gt;
 
   &lt;p&gt;When a user agent is to &lt;dfn id=jump-to-a-code-entry-point&gt;jump to a code entry-point&lt;/dfn&gt; for
-  a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;, if &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting is disabled&lt;/a&gt; in the
-  &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, or if the script's
-  &lt;a href=#script-group&gt;script group&lt;/a&gt; is &lt;i&gt;frozen&lt;/i&gt;, then the user agent must
-  throw an &lt;code&gt;&lt;a href=#unavailable_script_err&gt;UNAVAILABLE_SCRIPT_ERR&lt;/a&gt;&lt;/code&gt; exception. Otherwise,
-  the &lt;a href=#script-execution-environment title=&quot;script execution environment&quot;&gt;script execution
-  environment&lt;/a&gt; for the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; must execute the code for the
-  given code entry-point.&lt;/p&gt;
+  a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;, for example because
+  one &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; has called another,
+  or because the user agent is to invoke a callback defined in that
+  &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;, the user agent must run
+  the following steps:&lt;/p&gt;
 
-  &lt;p&gt;When executable code from a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; in one &lt;a href=#script-group&gt;script
-  group&lt;/a&gt; makes a call to a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; in another &lt;a href=#script-group&gt;script
-  group&lt;/a&gt;, the user agent must &lt;a href=#jump-to-a-code-entry-point title=&quot;jump to a code
-  entry-point&quot;&gt;jump&lt;/a&gt; to the corresponding code entry-point in
-  that second script using the steps above.&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;
 
-  &lt;p&gt;When executable code from a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; makes a call to a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; in the same &lt;a href=#script-group&gt;script
-  group&lt;/a&gt;, the &lt;a href=#script-execution-environment title=&quot;script execution environment&quot;&gt;script
-  execution environment&lt;/a&gt; for the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; must execute the code for the
-  given code entry-point without checking if the &lt;a href=#script-group&gt;script
-  group&lt;/a&gt; is frozen.&lt;/p&gt;
+    &lt;p&gt;If executable code from a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; is making a call to a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; in the same &lt;a href=#script-group&gt;script
+    group&lt;/a&gt;, then skip this step.&lt;/p&gt;
 
-  &lt;p class=note&gt;In particular, this means that scripts in a
+    &lt;p&gt;Otherwise, if &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting is
+    disabled&lt;/a&gt; in the &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, or
+    if the script's &lt;a href=#script-group&gt;script group&lt;/a&gt; is &lt;i&gt;frozen&lt;/i&gt;, then
+    the user agent must throw an &lt;code&gt;&lt;a href=#unavailable_script_err&gt;UNAVAILABLE_SCRIPT_ERR&lt;/a&gt;&lt;/code&gt;
+    exception and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-script-base-url&gt;current script base URL&lt;/a&gt; has no value,
+   then set it to the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Make the &lt;a href=#script-execution-environment title=&quot;script execution environment&quot;&gt;script
+   execution environment&lt;/a&gt; for the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; execute the code for the given
+   code entry-point.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-script-base-url&gt;current script base URL&lt;/a&gt; was set in the
+   earlier step for this invocation of the algorithm, then set it back
+   to having no value.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;In particular, this means that scripts in a
   &lt;i&gt;frozen&lt;/i&gt; &lt;a href=#script-group&gt;script group&lt;/a&gt; can keep on executing so
   long as they don't call code in another &lt;a href=#script-group&gt;script
   group&lt;/a&gt;. This is why a script doesn't immediately terminate
   after calling &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt;
   on its own &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Any time the user agent to invoke a callback defined in a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;, the user agent must &lt;a href=#jump-to-a-code-entry-point title=&quot;jump to a code entry-point&quot;&gt;jump&lt;/a&gt; to the corresponding
-  code entry-point in that second script.&lt;/p&gt;
 
 
-
   &lt;h5 id=creating-scripts&gt;&lt;span class=secno&gt;5.4.3.3 &lt;/span&gt;Creating scripts&lt;/h5&gt;
 
   &lt;p&gt;When the specification says that a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; is to be &lt;dfn id=create-a-script title=&quot;create a
@@ -35774,6 +35824,14 @@
 
   &lt;ol&gt;&lt;li&gt;
 
+    &lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to the &lt;a href=#current-script-base-url&gt;current script base
+    URL&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If this fails, then throw a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception
+    and abort these steps.&lt;/p&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;If the user agent is configured such that this invocation of
     &lt;code title=dom-showModalDialog&gt;&lt;a href=#dom-showmodaldialog&gt;showModalDialog()&lt;/a&gt;&lt;/code&gt; is
     somehow disabled, then the method returns the empty string; abort
@@ -35852,10 +35910,11 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;a href=#navigate&gt;Navigate&lt;/a&gt; the new browsing context to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, with &lt;a href=#replacement-enabled&gt;replacement enabled&lt;/a&gt;, and
-    with the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing
-    context&lt;/a&gt; of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method as the
-    &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#navigate&gt;Navigate&lt;/a&gt; the new &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to
+    the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that resulted from &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+    earlier, with &lt;a href=#replacement-enabled&gt;replacement enabled&lt;/a&gt;, and with the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing context&lt;/a&gt; of the
+    &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method
+    as the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -36247,7 +36306,8 @@
   &lt;p&gt;There is &lt;a href=#sample-handler-impl&gt;an example of how these
   methods could be presented to the user&lt;/a&gt; below.&lt;/p&gt;
 
-  &lt;p&gt;The arguments to the methods have the following meanings:&lt;/p&gt;
+  &lt;p&gt;The arguments to the methods have the following meanings and
+  corresponding implementaion requirements:&lt;/p&gt;
 
   &lt;dl&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; (&lt;code title=dom-navigator-registerProtocolHandler&gt;&lt;a href=#dom-navigator-registerprotocolhandler&gt;registerProtocolHandler()&lt;/a&gt;&lt;/code&gt; only)&lt;/dt&gt;
 
@@ -36290,23 +36350,24 @@
    &lt;dd&gt;
 
     &lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; of the page that will handle the
-    requests. When the user agent uses this URL, it must replace the
-    first occurrence of the exact literal string &quot;&lt;code&gt;%s&lt;/code&gt;&quot;
-    with an escaped version of the URL of the content in question (as
-    defined below), then &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt;
-    the resulting URL (using the &lt;a href=&quot;#script's-base-url&quot; title=&quot;script's base URL&quot;&gt;base
-    URL&lt;/a&gt; of the script that originally invoked the &lt;code title=dom-navigator-registerContentHandler&gt;&lt;a href=#dom-navigator-registercontenthandler&gt;registerContentHandler()&lt;/a&gt;&lt;/code&gt;
+    requests.&lt;/p&gt;
+
+    &lt;p&gt;When the user agent uses this URL, it must replace the first
+    occurrence of the exact literal string &quot;&lt;code title=&quot;&quot;&gt;%s&lt;/code&gt;&quot;
+    with an escaped version of the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of the
+    content in question (as defined below), then &lt;a href=#resolve-a-url title=&quot;resolve
+    a url&quot;&gt;resolve&lt;/a&gt; the resulting URL, relative to the
+    &lt;a href=#current-script-base-url&gt;current script base URL&lt;/a&gt; at the time the &lt;code title=dom-navigator-registerContentHandler&gt;&lt;a href=#dom-navigator-registercontenthandler&gt;registerContentHandler()&lt;/a&gt;&lt;/code&gt;
     or &lt;code title=dom-navigator-registerProtocolHandler&gt;&lt;a href=#dom-navigator-registerprotocolhandler&gt;registerProtocolHandler()&lt;/a&gt;&lt;/code&gt;
-    method), and then &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resulting URL using the
-    GET method (&lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or
-    equivalent&lt;/a&gt; for non-HTTP URLs).&lt;/p&gt;
+    methods were invoked, and then &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resulting
+    URL using the GET method (&lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt; for
+    non-HTTP URLs).&lt;/p&gt;
 
-    &lt;p&gt;To get the escaped version of the URL of the content in
-    question, the user agent must &lt;a href=#resolve-a-url title=&quot;resolve a
-    URL&quot;&gt;resolve&lt;/a&gt; the URL, and then every character in the URL
-    that doesn't match the &lt;query&gt; production defined in RFC
-    3986 must be replaced by the percent-encoded form of the
-    character. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;To get the escaped version of the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
+    the content in question, the user agent must replace every
+    character in that &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that doesn't match the
+    &lt;query&gt; production defined in RFC 3986 by the
+    percent-encoded form of that character. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
 
     &lt;div class=example&gt;
 
@@ -36351,7 +36412,9 @@
 
   &lt;p&gt;User agents must raise a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception if the
   &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument passed to one of these methods does
-  not contain the exact literal string &quot;&lt;code&gt;%s&lt;/code&gt;&quot;.&lt;/p&gt;
+  not contain the exact literal string &quot;&lt;code&gt;%s&lt;/code&gt;&quot;, or if &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+  argument with the first occurance of the string &quot;&lt;code title=&quot;&quot;&gt;%s&lt;/code&gt;&quot; removed, relative to the &lt;a href=#current-script-base-url&gt;current script
+  base URL&lt;/a&gt;, is not successful.&lt;/p&gt;
 
   &lt;p&gt;User agents must not raise any other exceptions (other than
   binding-specific exceptions, such as for an incorrect number of
@@ -36822,6 +36885,9 @@
    testable since neither U+0000 nor U+FFFD are valid anywhere in the
    syntax and thus both will be treated the same anyway)--&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; be the &lt;a href=#absolute-url&gt;absolute
+   URL&lt;/a&gt; representing the manifest.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; be an initially empty
    list of &lt;a href=#concept-appcache-explicit title=concept-appcache-explicit&gt;explicit
    entries&lt;/a&gt;.&lt;/li&gt;
@@ -36940,7 +37006,8 @@
      &lt;dd&gt;
 
       &lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the first item in
-      &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;; ignore the rest.&lt;/p&gt;
+      &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;, relative to &lt;var title=&quot;&quot;&gt;base
+      URL&lt;/var&gt;; ignore the rest.&lt;/p&gt;
 
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
@@ -36967,7 +37034,7 @@
       the second token in &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;.&lt;/p&gt;
 
       &lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; &lt;var title=&quot;&quot;&gt;part
-      one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
+      one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;, relative to &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt;.&lt;/p&gt;
 
       &lt;p&gt;If either fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
@@ -36996,7 +37063,8 @@
      &lt;dd&gt;
 
       &lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the first item in
-      &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;; ignore the rest.&lt;/p&gt;
+      &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;, relative to &lt;var title=&quot;&quot;&gt;base
+      URL&lt;/var&gt;; ignore the rest.&lt;/p&gt;
 
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
@@ -38211,7 +38279,8 @@
     &lt;p&gt;If a third argument is specified, run these substeps:&lt;/p&gt;
 
     &lt;ol&gt;&lt;li&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the value of the
-     third argument.&lt;/li&gt;
+     third argument, relative to the &lt;a href=#current-script-base-url&gt;current script base
+     URL&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;If that fails, raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception and
      abort the &lt;code title=dom-history-pushState&gt;&lt;a href=#dom-history-pushstate&gt;pushState()&lt;/a&gt;&lt;/code&gt;
@@ -38394,7 +38463,9 @@
   well, so we don't have two levels of indirection --&gt;
 
   &lt;p&gt;When the &lt;dfn id=dom-location-assign title=dom-location-assign&gt;&lt;code&gt;assign(&lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, the UA must
-  &lt;a href=#navigate&gt;navigate&lt;/a&gt; the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to the
+  &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the argument, relative to
+  the &lt;a href=#current-script-base-url&gt;current script base URL&lt;/a&gt;, and if that is successful,
+  must &lt;a href=#navigate&gt;navigate&lt;/a&gt; the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to the
   specified &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt; &lt;!-- XXX browsers seem to
   treat this as having &lt;span&gt;replacement enabled&lt;/span&gt; if the
   browsing context has only one entry and that entry is about:blank.
@@ -38402,6 +38473,8 @@
   virgin DOM; Safari doesn't check that. --&gt;
 
   &lt;p&gt;When the &lt;dfn id=dom-location-replace title=dom-location-replace&gt;&lt;code&gt;replace(&lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, the UA must
+  &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the argument, relative to
+  the &lt;a href=#current-script-base-url&gt;current script base URL&lt;/a&gt;, and if that is successful,
   &lt;a href=#navigate&gt;navigate&lt;/a&gt; the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to the
   specified &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with &lt;a href=#replacement-enabled&gt;replacement
   enabled&lt;/a&gt;.&lt;/p&gt;
@@ -38411,6 +38484,11 @@
   context&lt;/a&gt; of the script that invoked the method as the
   &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p&gt;If the &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; step of the
+  the &lt;code title=dom-location-assign&gt;&lt;a href=#dom-location-assign&gt;assign()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-location-replace&gt;&lt;a href=#dom-location-replace&gt;replace()&lt;/a&gt;&lt;/code&gt; methods is not
+  successful, then the user agent must instead throw a
+  &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/p&gt;
+
 &lt;!--XXX
   &lt;dfn title=&quot;dom-location-reload&quot;&gt;&lt;code&gt;reload()&lt;/code&gt;&lt;/dfn&gt;
   reload during resize event:
@@ -38434,10 +38512,10 @@
   value.&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-location-resolveurl title=dom-location-resolveURL&gt;&lt;code&gt;resolveURL(&lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must &lt;a href=#resolve-a-url title=&quot;resolve a
-  url&quot;&gt;resolve&lt;/a&gt; its &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, and if
-  that succeeds, return the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;. If it
-  fails, it must throw a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception
-  instead.&lt;/p&gt;
+  url&quot;&gt;resolve&lt;/a&gt; its &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, relative
+  to the &lt;a href=#current-script-base-url&gt;current script base URL&lt;/a&gt;, and if that succeeds,
+  return the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;. If it fails, it must
+  throw a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception instead.&lt;/p&gt;
 
 
   &lt;h5 id=security-3&gt;&lt;span class=secno&gt;5.8.4.1 &lt;/span&gt;Security&lt;/h5&gt;
@@ -38499,7 +38577,7 @@
   &lt;h4 id=navigating-across-documents&gt;&lt;span class=secno&gt;5.9.1 &lt;/span&gt;Navigating across documents&lt;/h4&gt;
 
   &lt;p&gt;Certain actions cause the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to
-  &lt;dfn id=navigate&gt;navigate&lt;/dfn&gt; to a new resource. Navigation always involves
+  &lt;i&gt;&lt;a href=#navigate&gt;navigate&lt;/a&gt;&lt;/i&gt; to a new resource. Navigation always involves
   &lt;dfn id=source-browsing-context&gt;source browsing context&lt;/dfn&gt;, which is the browsing context
   which was responsible for starting the navigation.&lt;/p&gt;
 
@@ -38511,8 +38589,8 @@
   cause a browsing context to navigate, in addition to those defined
   in this specification.&lt;/p&gt;
 
-  &lt;p&gt;When a browsing context is navigated to a new resource, the user
-  agent must run the following steps:&lt;/p&gt;
+  &lt;p&gt;When a browsing context is &lt;dfn id=navigate title=navigate&gt;navigated&lt;/dfn&gt;
+  to a new resource, the user agent must run the following steps:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li id=sandboxLinks&gt;&lt;p&gt;If the &lt;a href=#source-browsing-context&gt;source browsing
    context&lt;/a&gt; is not the same as the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;
@@ -38542,13 +38620,6 @@
    &lt;li&gt;&lt;p&gt;Cancel any preexisting attempt to navigate the
    &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt;
-   of the new resource. If that fails, the user agent may abort these
-   steps, or may treat the URL as identifying some sort of user-agent
-   defined error resource, which could display some sort of inline
-   content, or could be handled using a mechanism that does not affect
-   the browsing context.&lt;/li&gt;
-
    &lt;li id=navigate-fragid-step&gt;&lt;p&gt;&lt;i&gt;Fragment identifiers&lt;/i&gt;: If
    the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of the new resource is the same as
    the &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; of the
@@ -38595,11 +38666,12 @@
     application cache at all; the submission will be made to the
     network.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;a href=#fetch&gt;fetch&lt;/a&gt; the new resource. If the resource
-    is being fetched using HTTP, and the method is not GET&lt;!-- or HEAD
-    (but that can't happen) --&gt;, then the user agent must include an
-    &lt;code title=http-origin&gt;XXX-Origin&lt;/code&gt; header whose value is
-    determined as follows:&lt;/p&gt;
+    &lt;p&gt;Otherwise, &lt;a href=#fetch&gt;fetch&lt;/a&gt; the new resource, if it has not
+    already been obtained&lt;!-- it's obtained by &lt;object&gt;, for instance
+    --&gt;. If the resource is being fetched using HTTP, and the method
+    is not GET&lt;!-- or HEAD (but that can't happen) --&gt;, then the user
+    agent must include an &lt;code title=http-origin&gt;XXX-Origin&lt;/code&gt;
+    header whose value is determined as follows:&lt;/p&gt;
 
     &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#navigate title=navigate&gt;navigation&lt;/a&gt; algorithm has
      so far contacted more than one &lt;a href=#origin-0&gt;origin&lt;/a&gt;&lt;/dt&gt;
@@ -38889,8 +38961,8 @@
   element with an attribute &lt;code title=attr-html-manifest&gt;&lt;a href=#attr-html-manifest&gt;manifest&lt;/a&gt;&lt;/code&gt;, then, as soon as the
   element is &lt;a href=#insert-an-element-into-a-document title=&quot;insert an element into a document&quot;&gt;inserted
   into the document&lt;/a&gt;, the user agent must &lt;a href=#resolve-a-url title=&quot;resolve a
-  url&quot;&gt;resolve&lt;/a&gt; the value of that attribute, and if that is
-  successful, must run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
+  url&quot;&gt;resolve&lt;/a&gt; the value of that attribute relative to that
+  element, and if that is successful, must run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
   algorithm&lt;/a&gt; with the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; as the
   manifest URL, and passing in the newly-created
   &lt;code&gt;Document&lt;/code&gt;. Otherwise, if the attribute is absent or
@@ -40576,12 +40648,19 @@
   &lt;h4 id=following-hyperlinks&gt;&lt;span class=secno&gt;5.11.2 &lt;/span&gt;&lt;dfn&gt;Following hyperlinks&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When a user &lt;em&gt;follows a hyperlink&lt;/em&gt;, the user agent must
-  &lt;a href=#navigate&gt;navigate&lt;/a&gt; a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to the
-  &lt;a href=#url&gt;URL&lt;/a&gt; given by the &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute of that
-  hyperlink. In the case of server-side image maps, the URL of the
-  hyperlink must further have its &lt;var&gt;&lt;a href=#hyperlink-suffix&gt;hyperlink suffix&lt;/a&gt;&lt;/var&gt; appended
-  to it.&lt;/p&gt;
+  &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt;
+  given by the &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute
+  of that hyperlink, relative to the hyperlink element, and if that is
+  successful, must &lt;a href=#navigate&gt;navigate&lt;/a&gt; a &lt;a href=#browsing-context&gt;browsing
+  context&lt;/a&gt; to the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;. In the
+  case of server-side image maps, the URL of the hyperlink must
+  further have its &lt;var&gt;&lt;a href=#hyperlink-suffix&gt;hyperlink suffix&lt;/a&gt;&lt;/var&gt; appended to it.&lt;/p&gt;
 
+  &lt;p&gt;If &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the
+  &lt;a href=#url&gt;URL&lt;/a&gt; fails, the user agent may report the error to the
+  user in a user-agent-specific manner, may navigate to an error page
+  to report the error, or may ignore the error and do nothing.&lt;/p&gt;
+
   &lt;p&gt;If the user indicated a specific &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;
   when following the hyperlink, or if the user agent is configured to
   follow hyperlinks by navigating a particular browsing context, then
@@ -40629,14 +40708,15 @@
   &lt;p&gt;If an &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; hyperlink element has a
   &lt;code title=attr-hyperlink-ping&gt;&lt;a href=#ping&gt;ping&lt;/a&gt;&lt;/code&gt; attribute, and the
   user follows the hyperlink, and the hyperlink's &lt;a href=#url&gt;URL&lt;/a&gt; can
-  be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; without failure, the
-  user agent must take the &lt;code title=attr-hyperlink-ping&gt;&lt;a href=#ping&gt;ping&lt;/a&gt;&lt;/code&gt; attribute's value, &lt;a href=#split-a-string-on-spaces title=&quot;split a string on spaces&quot;&gt;split that string on
+  be &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt;, relative to the
+  hyperlink element, without failure, then the user agent must take
+  the &lt;code title=attr-hyperlink-ping&gt;&lt;a href=#ping&gt;ping&lt;/a&gt;&lt;/code&gt; attribute's value,
+  &lt;a href=#split-a-string-on-spaces title=&quot;split a string on spaces&quot;&gt;split that string on
   spaces&lt;/a&gt;, &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; each
-  resulting token, and then should send a request (as described below)
-  to each of the resulting &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute
-  URLs&lt;/a&gt;. (Tokens that fail to resolve are ignored.) This may be
-  done in parallel with the primary request, and is independent of the
-  result of that request.&lt;/p&gt;
+  resulting token relative to the hyperlink element, and then should
+  send a request (as described below) to each of the resulting &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/a&gt;. (Tokens that fail to
+  resolve are ignored.) This may be done in parallel with the primary
+  request, and is independent of the result of that request.&lt;/p&gt;
 
   &lt;p&gt;User agents should allow the user to adjust this behavior, for
   example in conjunction with a setting that disables the sending of
@@ -44249,17 +44329,19 @@
 
   &lt;p&gt;When the &lt;dfn id=dom-remoteeventtarget-addeventsource title=dom-RemoteEventTarget-addEventSource&gt;&lt;code&gt;addEventSource(&lt;var title=&quot;&quot;&gt;src&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, the user agent
   must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt;
-  specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, and if that succeeds, add the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
-  to the &lt;a href=#concept-eventsource-list title=concept-eventsource-list&gt;list of event
-  sources&lt;/a&gt; for that object. The same URL can be registered
-  multiple times. If the URL fails to resolve, then the user agent
-  must raise a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/p&gt;
+  specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, relative to the &lt;a href=#current-script-base-url&gt;current
+  script base URL&lt;/a&gt;, and if that succeeds, add the resulting
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to the &lt;a href=#concept-eventsource-list title=concept-eventsource-list&gt;list of event sources&lt;/a&gt; for
+  that object. The same URL can be registered multiple times. If the
+  URL fails to resolve, then the user agent must raise a
+  &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/p&gt;
 
   &lt;p&gt;When the &lt;dfn id=dom-remoteeventtarget-removeeventsource title=dom-RemoteEventTarget-removeEventSource&gt;&lt;code&gt;removeEventSource(&lt;var title=&quot;&quot;&gt;src&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, the user agent
   must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt;
-  specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, and if that succeeds, remove
-  the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; from the &lt;a href=#concept-eventsource-list title=concept-eventsource-list&gt;list of event sources&lt;/a&gt; for
-  that object.  If the same URL has been registered multiple times,
+  specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, relative to the &lt;a href=#current-script-base-url&gt;current
+  script base URL&lt;/a&gt;, and if that succeeds, remove the resulting
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; from the &lt;a href=#concept-eventsource-list title=concept-eventsource-list&gt;list of event sources&lt;/a&gt; for
+  that object. If the same URL has been registered multiple times,
   removing it must remove only one instance of that URL for each
   invocation of the &lt;code title=removeEventSource&gt;removeEventSource()&lt;/code&gt; method. If the
   URL fails to resolve, the user agent does nothing.&lt;/p&gt;
@@ -45725,8 +45807,8 @@
   &lt;ol&gt;&lt;li&gt;
 
     &lt;p&gt;If the value of the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument
-    is not a single U+002A ASTERISK character (&quot;*&quot;), and either &lt;a href=#parse-a-url title=&quot;parse a url&quot;&gt;parsing&lt;/a&gt; it as a &lt;a href=#url&gt;URL&lt;/a&gt; fails,
-    or &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; it results in a
+    is not a single U+002A ASTERISK character (&quot;*&quot;), and &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; it relative to the
+    &lt;a href=#current-script-base-url&gt;current script base URL&lt;/a&gt; either fails or results in a
     &lt;a href=#url&gt;URL&lt;/a&gt; with a &lt;code title=url-host-specific&gt;&lt;a href=#url-host-specific&gt;&lt;host-specific&gt;&lt;/a&gt;&lt;/code&gt; component
     that is neither empty nor a single U+002F SOLIDUS character (/),
     then throw a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception and abort the
@@ -45798,8 +45880,8 @@
   &lt;ol&gt;&lt;!-- EXCEPT WHERE NOTED, THESE STEPS ARE IDENTICAL TO THE PREVIOUS SECTION --&gt;&lt;!-- one exception is the use of -3 instead of -2 in the xrefs --&gt;&lt;li&gt;
 
     &lt;p&gt;If the value of the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument
-    is not a single U+002A ASTERISK character (&quot;*&quot;), and either &lt;a href=#parse-a-url title=&quot;parse a url&quot;&gt;parsing&lt;/a&gt; it as a &lt;a href=#url&gt;URL&lt;/a&gt; fails,
-    or &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; it results in a
+    is not a single U+002A ASTERISK character (&quot;*&quot;), and &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; it relative to the
+    &lt;a href=#current-script-base-url&gt;current script base URL&lt;/a&gt; either fails or results in a
     &lt;a href=#url&gt;URL&lt;/a&gt; with a &lt;code title=url-host-specific&gt;&lt;a href=#url-host-specific&gt;&lt;host-specific&gt;&lt;/a&gt;&lt;/code&gt; component
     that is neither empty nor a single U+002F SOLIDUS character (/),
     then throw a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception and abort the
@@ -49863,10 +49945,11 @@
 
     &lt;p id=parser-appcache&gt;If the &lt;code&gt;Document&lt;/code&gt; is being
     loaded as part of &lt;a href=#navigate title=navigate&gt;navigation&lt;/a&gt; of a
-    &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, then: if the token has an attribute
-    &quot;manifest&quot;, then &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the
-    value of that attribute to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, and if
-    that is successful, run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
+    &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, then: if the newly created element
+    has a &lt;code title=attr-html-manifest&gt;&lt;a href=#attr-html-manifest&gt;manifest&lt;/a&gt;&lt;/code&gt; attribute,
+    then &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the value of that
+    attribute to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, relative to the newly
+    created element, and if that is successful, run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
     algorithm&lt;/a&gt; with the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;;
     otherwise, if there is no such attribute or resolving it fails,
     run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache

Modified: source
===================================================================
--- source	2009-01-24 05:07:17 UTC (rev 2708)
+++ source	2009-01-27 02:39:57 UTC (rev 2709)
@@ -3564,25 +3564,33 @@
   (earlier URI specs did) --&gt;
 
 
+
   &lt;h4&gt;Resolving URLs&lt;/h4&gt;
 
-  &lt;p&gt;Relative URLs are resolved relative to a base URL. The &lt;dfn&gt;base
-  URL&lt;/dfn&gt; of a &lt;span&gt;URL&lt;/span&gt; is the &lt;span&gt;absolute URL&lt;/span&gt;
-  obtained as follows:&lt;/p&gt;
+  &lt;p&gt;To &lt;dfn&gt;resolve a URL&lt;/dfn&gt; to an &lt;span&gt;absolute URL&lt;/span&gt;
+  relative to either another &lt;span&gt;absolute URL&lt;/span&gt; or an element,
+  the user agent must use the following steps. Resolving a URL can
+  result in an error, in which case the URL is not resolvable.&lt;/p&gt;
 
-  &lt;dl class=&quot;switch&quot;&gt;
+  &lt;ol&gt;
 
-   &lt;dt&gt;If the URL to be resolved was passed to an API&lt;/dt&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;span&gt;URL&lt;/span&gt; being
+   resolved.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dd&gt;&lt;p&gt;The base URL is the &lt;span&gt;script's base URL&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be the &lt;span&gt;URL character
+   encoding&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dt&gt;If the URL to be resolved is from the value of a content
-   attribute&lt;/dt&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is UTF-16, then change it to
+   UTF-8.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dd&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;The base URL is the &lt;i&gt;base URI of the element&lt;/i&gt; that the
-    attribute is on, as defined by the XML Base specification, with
+    &lt;p&gt;If the algorithm was invoked with an &lt;span&gt;absolute URL&lt;/span&gt;
+    to use as the base URL, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be that
+    &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;i&gt;base URI of
+    the element&lt;/i&gt;, as defined by the XML Base specification, with
     &lt;i&gt;the base URI of the document entity&lt;/i&gt; being defined as the
     &lt;span&gt;document base URL&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt; that
     owns the element.&lt;/p&gt;
@@ -3598,63 +3606,36 @@
     however, as &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes
     are not allowed in &lt;span&gt;HTML documents&lt;/span&gt;.)&lt;/p&gt;
 
-   &lt;/dd&gt;
+    &lt;p&gt;The &lt;dfn&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; is
+    the &lt;span&gt;absolute URL&lt;/span&gt; obtained by running these
+    substeps:&lt;/p&gt;
 
-   &lt;dt&gt;If the URL to be resolved was found in an offline application
-   cache manifest&lt;/dt&gt;
+    &lt;ol&gt;
 
-   &lt;dd&gt;&lt;p&gt;The base URL is the URL of the &lt;span&gt;application
-   cache&lt;/span&gt; &lt;span
-   title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+     &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;base&lt;/code&gt; element that is both a
+     child of &lt;span&gt;the &lt;code&gt;head&lt;/code&gt; element&lt;/span&gt; and has an
+     &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute, then the
+     &lt;span&gt;document base URL&lt;/span&gt; is &lt;span&gt;the document's
+     address&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;/dl&gt;
+     &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the
+     &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute of the first such
+     element.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;The &lt;dfn&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; is
-  the &lt;span&gt;absolute URL&lt;/span&gt; obtained by running these steps:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a URL&quot;&gt;Resolve&lt;/span&gt; &lt;var
+     title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;span&gt;the document's
+     address&lt;/span&gt; (thus, the &lt;code&gt;base&lt;/code&gt; &lt;code
+     title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute isn't affected by
+     &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes).&lt;/p&gt;&lt;/li&gt;
 
-  &lt;ol&gt;
+     &lt;li&gt;&lt;p&gt;The &lt;span&gt;document base URL&lt;/span&gt; is the result of the
+     previous step if it was successful; otherwise it is &lt;span&gt;the
+     document's address&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;base&lt;/code&gt; element that is both a
-   child of &lt;span&gt;the &lt;code&gt;head&lt;/code&gt; element&lt;/span&gt; and has an
-   &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute, then the
-   &lt;span&gt;document base URL&lt;/span&gt; is &lt;span&gt;the document's
-   address&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+    &lt;/ol&gt;
 
-   &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the
-   &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute of the first such
-   element.&lt;/p&gt;&lt;/li&gt;
+   &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a URL&quot;&gt;Resolve&lt;/span&gt; the &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt; URL, using &lt;span&gt;the document's address&lt;/span&gt;
-   as the &lt;span&gt;base URL&lt;/span&gt; (thus, the &lt;code&gt;base&lt;/code&gt; &lt;code
-   title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute isn't affected by
-   &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes).&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;document base URL&lt;/span&gt; is the result of the
-   previous step if it was successful; otherwise it is &lt;span&gt;the
-   document's address&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;To &lt;dfn&gt;resolve a URL&lt;/dfn&gt; to an &lt;span&gt;absolute URL&lt;/span&gt; the
-  user agent must use the following steps. Resolving a URL can result
-  in an error, in which case the URL is not resolvable.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;span&gt;URL&lt;/span&gt; being
-   resolved.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be the &lt;span&gt;URL character
-   encoding&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is UTF-16, then change it to
-   UTF-8.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;span&gt;base URL&lt;/span&gt;
-   for &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. (This is an &lt;span&gt;absolute
-   URL&lt;/span&gt;.)&lt;/p&gt;&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;&lt;span title=&quot;parse a URL&quot;&gt;Parse&lt;/span&gt; &lt;var
    title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/p&gt;&lt;/li&gt;
 
@@ -3812,8 +3793,8 @@
     being shown to the user, or if any data derived from that URL is
     affecting the display, then the &lt;code
     title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute should be &lt;span
-    title=&quot;resolve a url&quot;&gt;reresolved&lt;/span&gt; and the UI updated
-    appropriately.&lt;/p&gt;
+    title=&quot;resolve a url&quot;&gt;reresolved&lt;/span&gt; relative to the element
+    and the UI updated appropriately.&lt;/p&gt;
 
     &lt;p class=&quot;example&quot;&gt;For example, the CSS &lt;code
     title=&quot;&quot;&gt;:link&lt;/code&gt;/&lt;code title=&quot;&quot;&gt;:visited&lt;/code&gt;
@@ -3824,7 +3805,8 @@
     title=&quot;absolute URL&quot;&gt;absolute URL(s)&lt;/span&gt; are being shown to the
     user, then the &lt;code title=&quot;attr-hyperlink-ping&quot;&gt;ping&lt;/code&gt;
     attribute's tokens should be &lt;span title=&quot;resolve a
-    url&quot;&gt;reresolved&lt;/span&gt; and the UI updated appropriately.&lt;/p&gt;
+    url&quot;&gt;reresolved&lt;/span&gt; relative to the element and the UI updated
+    appropriately.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -3838,7 +3820,8 @@
     title=&quot;&quot;&gt;cite&lt;/code&gt; attribute is being shown to the user, or if
     any data derived from that URL is affecting the display, then the
     &lt;span&gt;URL&lt;/span&gt; should be &lt;span title=&quot;resolve a
-    url&quot;&gt;reresolved&lt;/span&gt; and the UI updated appropriately.&lt;/p&gt;
+    url&quot;&gt;reresolved&lt;/span&gt; relative to the element and the UI updated
+    appropriately.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -4050,11 +4033,7 @@
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;If the resource is identified by a &lt;span&gt;URL&lt;/span&gt;, then
-   immediately &lt;span title=&quot;resolve a URL&quot;&gt;resolve that
-   URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the resulting &lt;span&gt;absolute URL&lt;/span&gt; is
+   &lt;li&gt;&lt;p&gt;If the resource is identified by the &lt;span&gt;URL&lt;/span&gt;
    &lt;dfn&gt;&lt;code&gt;about:blank&lt;/code&gt;&lt;/dfn&gt;, then return the empty string
    and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
@@ -4062,23 +4041,23 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the resource identified by the resulting &lt;span&gt;absolute
-    URL&lt;/span&gt; is already being downloaded for other reasons
-    (e.g. another invocation of this algorithm), and the resource is
-    to be obtained using a idempotent action (such as an HTTP GET
-    &lt;span title=&quot;concept-http-equivalent-get&quot;&gt;or equivalent&lt;/span&gt;),
-    and the user agent is configured such that it is to reuse the data
-    from the existing download instead of initiating a new one, then
-    use the results of the existing download instead of starting a new
+    &lt;p&gt;If the resource is identified by an &lt;span&gt;absolute URL&lt;/span&gt;,
+    and the resource is to be obtained using a idempotent action (such
+    as an HTTP GET &lt;span title=&quot;concept-http-equivalent-get&quot;&gt;or
+    equivalent&lt;/span&gt;), and it is already being downloaded for other
+    reasons (e.g. another invocation of this algorithm), and the user
+    agent is configured such that it is to reuse the data from the
+    existing download instead of initiating a new one, then use the
+    results of the existing download instead of starting a new
     one.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, at a time convenient to the user and the user agent,
-    download the resource, applying the semantics of the relevant
-    specifications (e.g. performing an HTTP GET or POST operation, or
-    reading the file from disk, following redirects, &lt;span
-    title=&quot;concept-js-deref&quot;&gt;dereferencing &lt;span title=&quot;javascript
-    protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt; URLs&lt;/span&gt;&lt;/span&gt;,
-    etc).&lt;/p&gt;
+    download (or otherwise obtain) the resource, applying the
+    semantics of the relevant specifications (e.g. performing an HTTP
+    GET or POST operation, or reading the file from disk, following
+    redirects, &lt;span title=&quot;concept-js-deref&quot;&gt;dereferencing &lt;span
+    title=&quot;javascript protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt;
+    URLs&lt;/span&gt;&lt;/span&gt;, etc).&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -4967,12 +4946,12 @@
   attribute whose content attribute is defined to contain a
   &lt;span&gt;URL&lt;/span&gt;, then on getting, the DOM attribute must &lt;span
   title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the value of the content
-  attribute and return the resulting &lt;span&gt;absolute URL&lt;/span&gt; if that
-  was successful, or the empty string otherwise; and on setting, must
-  set the content attribute to the specified literal value. If the
-  content attribute is absent, the DOM attribute must return the
-  default value, if the content attribute has one, or else the empty
-  string.&lt;/p&gt;
+  attribute relative to the element and return the resulting
+  &lt;span&gt;absolute URL&lt;/span&gt; if that was successful, or the empty
+  string otherwise; and on setting, must set the content attribute to
+  the specified literal value. If the content attribute is absent, the
+  DOM attribute must return the default value, if the content
+  attribute has one, or else the empty string.&lt;/p&gt;
 
   &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt;
   attribute whose content attribute is defined to contain one or more
@@ -4980,12 +4959,13 @@
   must &lt;span title=&quot;split a string on spaces&quot;&gt;split the content
   attribute on spaces&lt;/span&gt; and return the concatenation of &lt;span
   title=&quot;resolve a URL&quot;&gt;resolving&lt;/span&gt; each token URL to an
-  &lt;span&gt;absolute URL&lt;/span&gt;, with a single U+0020 SPACE character
-  between each URL, ignoring any tokens that did not resolve
-  successfully. If the content attribute is absent, the DOM attribute
-  must return the default value, if the content attribute has one, or
-  else the empty string. On setting, the DOM attribute must set the
-  content attribute to the specified literal value.&lt;/p&gt;
+  &lt;span&gt;absolute URL&lt;/span&gt; relative to the element, with a single
+  U+0020 SPACE character between each URL, ignoring any tokens that
+  did not resolve successfully. If the content attribute is absent,
+  the DOM attribute must return the default value, if the content
+  attribute has one, or else the empty string. On setting, the DOM
+  attribute must set the content attribute to the specified literal
+  value.&lt;/p&gt;
 
   &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; whose
   content attribute is an &lt;span&gt;enumerated attribute&lt;/span&gt;, and the
@@ -7090,10 +7070,10 @@
   of a declaration block in a rule whose selector matches just the
   element on which the attribute is set. All &lt;span
   title=&quot;URL&quot;&gt;URLs&lt;/span&gt; in the value must be &lt;span title=&quot;resolve a
-  url&quot;&gt;resolved&lt;/span&gt; when the attribute is parsed.&lt;!-- so dynamic
-  changes to the base URL don't affect the CSS --&gt; For the purposes of
-  the CSS cascade, the attribute must be considered to be a 'style'
-  attribute at the author level. &lt;/p&gt;
+  url&quot;&gt;resolved&lt;/span&gt; relative to the element when the attribute is
+  parsed.&lt;!-- so dynamic changes to the base URL don't affect the CSS
+  --&gt; For the purposes of the CSS cascade, the attribute must be
+  considered to be a 'style' attribute at the author level. &lt;/p&gt;
 
   &lt;p&gt;Documents that use &lt;code title=&quot;attr-style&quot;&gt;style&lt;/code&gt;
   attributes on any of their elements must still be comprehensible and
@@ -8784,9 +8764,11 @@
   dynamically thus has no effect (and thus, no DOM API is provided for
   this attribute).&lt;/p&gt;
 
-  &lt;p class=&quot;note&quot;&gt;Later &lt;code&gt;base&lt;/code&gt; elements don't affect the
-  &lt;span title=&quot;resolve a url&quot;&gt;resolving of relative URLs&lt;/span&gt; in
-  &lt;code title=&quot;attr-html-manifest&quot;&gt;manifest&lt;/code&gt; attributes, as the
+  &lt;p class=&quot;note&quot;&gt;For the purposes of &lt;span
+  title=&quot;concept-appcache-init&quot;&gt;application cache selection&lt;/span&gt;,
+  later &lt;code&gt;base&lt;/code&gt; elements cannot affect the &lt;span
+  title=&quot;resolve a url&quot;&gt;resolving of relative URLs&lt;/span&gt; in &lt;code
+  title=&quot;attr-html-manifest&quot;&gt;manifest&lt;/code&gt; attributes, as the
   attributes are processed before those elements are seen.&lt;/p&gt;
 
 
@@ -9017,10 +8999,14 @@
   applied (as defined below). For external resources that are
   represented in the DOM (for example, style sheets), the DOM
   representation must be made available even if the resource is not
-  applied. (However, user agents may opt to only &lt;span&gt;fetch&lt;/span&gt;
-  such resources when they are needed, instead of pro-actively &lt;span
-  title=&quot;fetch&quot;&gt;fetching&lt;/span&gt; all the external resources that are
-  not applied.)&lt;/p&gt;
+  applied. To obtain the resource, the user agent must &lt;span
+  title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the &lt;span&gt;URL&lt;/span&gt; given by
+  the &lt;code title=&quot;attr-link-href&quot;&gt;href&lt;/code&gt; attribute, relative to
+  the element, and then &lt;span&gt;fetch&lt;/span&gt; the resulting
+  &lt;span&gt;absolute URL&lt;/span&gt;. User agents may opt to only
+  &lt;span&gt;fetch&lt;/span&gt; such resources when they are needed, instead of
+  pro-actively &lt;span title=&quot;fetch&quot;&gt;fetching&lt;/span&gt; all the external
+  resources that are not applied.&lt;/p&gt;
 
   &lt;p&gt;The semantics of the protocol used (e.g. HTTP) must be followed
   when fetching external resources. (For example, redirects must be
@@ -9754,10 +9740,8 @@
      title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the &lt;var
-     title=&quot;&quot;&gt;url&lt;/var&gt; value to an &lt;span&gt;absolute URL&lt;/span&gt;. (For
-     the purposes of determining the &lt;span&gt;base URL&lt;/span&gt;, the &lt;var
-     title=&quot;&quot;&gt;url&lt;/var&gt; value comes from the value of a content
-     attribute of the &lt;code&gt;meta&lt;/code&gt; element.) If this fails, abort
+     title=&quot;&quot;&gt;url&lt;/var&gt; value to an &lt;span&gt;absolute URL&lt;/span&gt;,
+     relative to the &lt;code&gt;meta&lt;/code&gt; element. If this fails, abort
      these steps.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;
@@ -10039,9 +10023,10 @@
   nodes of the &lt;code&gt;style&lt;/code&gt; element to the style system.&lt;/p&gt;
 
   &lt;p&gt;All &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt; found by the styling language's
-  processor must be &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; when
-  it is invoked.&lt;!-- so dynamic changes to the base URL don't affect
-  the CSS --&gt;&lt;/p&gt;
+  processor must be &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt;,
+  relative to the element (or as defined by the styling language),
+  when the processor is invoked.&lt;!-- so dynamic changes to the base
+  URL don't affect the CSS --&gt;&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;This specification does not specify a style system,
   but CSS is expected to be supported by most Web browsers. &lt;a
@@ -10106,10 +10091,11 @@
    &lt;dd&gt;&lt;p&gt;For &lt;code&gt;link&lt;/code&gt; elements, the location must be the
    result of &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the
    &lt;span&gt;URL&lt;/span&gt; given by the element's &lt;code
-   title=&quot;attr-link-href&quot;&gt;href&lt;/code&gt; content attribute, or the empty
-   string if that fails. For &lt;code&gt;style&lt;/code&gt; elements, there is no
-   location.&lt;/p&gt;&lt;/dd&gt; &lt;!-- note that this might not match the style
-   sheet URL, if the base URL has changed for instance --&gt;
+   title=&quot;attr-link-href&quot;&gt;href&lt;/code&gt; content attribute, relative to
+   the element, or the empty string if that fails. For
+   &lt;code&gt;style&lt;/code&gt; elements, there is no location.&lt;/p&gt;&lt;/dd&gt; &lt;!--
+   note that this might not match the style sheet URL, if the base URL
+   has changed for instance --&gt;
 
    &lt;dt&gt;The intended destination media for style information (&lt;code title=&quot;dom-stylesheet-media&quot;&gt;media&lt;/code&gt; DOM attribute)&lt;/dt&gt;
 
@@ -10412,7 +10398,9 @@
    &lt;li&gt;
 
     &lt;p&gt;If the element has a &lt;code title=&quot;attr-script-src&quot;&gt;src&lt;/code&gt;
-    attribute, then the specified resource must be &lt;span
+    attribute, then the value of that attribute must be &lt;span
+    title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; relative to the element, and
+    if that is successful, the specified resource must then be &lt;span
     title=&quot;fetch&quot;&gt;fetched&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p&gt;For historical reasons, if the &lt;span&gt;URL&lt;/span&gt; is a &lt;span
@@ -10445,8 +10433,9 @@
     started. If the UA performs such prefetching, but the element is
     never inserted in the document, or the &lt;code
     title=&quot;attr-script-src&quot;&gt;src&lt;/code&gt; attribute is dynamically
-    changed, then the user agent will not execute the script, and the
-    fetching process will have been effectively wasted.&lt;/p&gt;
+    changed,&lt;!-- or the base URL is dynamically changed,--&gt; then the
+    user agent will not execute the script, and the fetching process
+    will have been effectively wasted.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -11078,15 +11067,15 @@
 
    &lt;li&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the &lt;span&gt;URL&lt;/span&gt;
    specified by the &lt;code&gt;eventsource&lt;/code&gt; element's &lt;code
-   title=&quot;attr-eventsource-src&quot;&gt;src&lt;/code&gt; attribute.&lt;/li&gt;
+   title=&quot;attr-eventsource-src&quot;&gt;src&lt;/code&gt; attribute, relative to the
+   element.&lt;/li&gt;
 
    &lt;li&gt;If that fails, then set the element's &lt;i&gt;current declared event
    source&lt;/i&gt; to &quot;undefined&quot; and abort these steps.&lt;/li&gt;
 
-   &lt;li&gt;Otherwise, act as if the &lt;code
-   title=&quot;dom-remoteEventTarget-addEventSource&quot;&gt;addEventSource()&lt;/code&gt;
-   method on the &lt;code&gt;eventsource&lt;/code&gt; element had been invoked
-   with the resulting &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/li&gt;
+   &lt;li&gt;Otherwise, add the resulting &lt;span&gt;absolute URL&lt;/span&gt; to the
+   &lt;span title=&quot;concept-eventsource-list&quot;&gt;list of event sources&lt;/span&gt;
+   for the element.&lt;/li&gt;
 
    &lt;li&gt;Let the element's &lt;i&gt;current declared event source&lt;/i&gt; be that
    &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/li&gt;
@@ -11101,10 +11090,9 @@
    &lt;li&gt;If the element's &lt;i&gt;current declared event source&lt;/i&gt; is
    &quot;undefined&quot;, abort these steps.&lt;/li&gt;
 
-   &lt;li&gt;Otherwise, act as if the &lt;code
-   title=&quot;dom-remoteEventTarget-removeEventSource&quot;&gt;removeEventSource()&lt;/code&gt;
-   method on the &lt;code&gt;eventsource&lt;/code&gt; element had been invoked
-   with the element's &lt;i&gt;current declared event source&lt;/i&gt;.&lt;/li&gt;
+   &lt;li&gt;Otherwise, remove the element's &lt;i&gt;current declared event
+   source&lt;/i&gt; from the &lt;span title=&quot;concept-eventsource-list&quot;&gt;list of
+   event sources&lt;/span&gt; for the element.&lt;/li&gt;
 
    &lt;li&gt;Let the element's &lt;i&gt;current declared event source&lt;/i&gt; be
    &quot;undefined&quot;.&lt;/li&gt;
@@ -11117,8 +11105,7 @@
   number of simultaneous connections that a user agent can open per
   server.&lt;/p&gt;
 
-  &lt;!-- XXX should we make 'load', 'error', 'abort' events fire on this
-  element? --&gt;
+  &lt;!-- v2: make 'load', 'error', 'abort' events fire on this element --&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-eventsource-src&quot;&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt; DOM
   attribute must &lt;span&gt;reflect&lt;/span&gt; the content attribute of the
@@ -12519,12 +12506,15 @@
   attribute.&lt;/p&gt;
 
   &lt;p&gt;If the &lt;code title=&quot;attr-blockquote-cite&quot;&gt;cite&lt;/code&gt; attribute
-  is present, it must be a &lt;span&gt;valid URL&lt;/span&gt;. User agents should
-  allow users to follow such citation links.&lt;/p&gt;
+  is present, it must be a &lt;span&gt;valid URL&lt;/span&gt;. To obtain the
+  corresponding citation link, the value of the attribute must be
+  &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; relative to the
+  element. User agents should allow users to follow such citation
+  links.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-quote-cite&quot;&gt;&lt;code&gt;cite&lt;/code&gt;&lt;/dfn&gt; DOM
   attribute must &lt;span&gt;reflect&lt;/span&gt; the element's &lt;code
-  title=&quot;&quot;&gt;cite&lt;/code&gt; content attribute.
+  title=&quot;&quot;&gt;cite&lt;/code&gt; content attribute.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;The best way to represent a conversation is not with
   the &lt;code&gt;cite&lt;/code&gt; and &lt;code&gt;blockquote&lt;/code&gt; elements, but with
@@ -13324,8 +13314,11 @@
   screenplay.&lt;/p&gt;
 
   &lt;p&gt;If the &lt;code title=&quot;attr-q-cite&quot;&gt;cite&lt;/code&gt; attribute is
-  present, it must be a &lt;span&gt;valid URL&lt;/span&gt;. User agents should
-  allow users to follow such citation links.&lt;/p&gt;
+  present, it must be a &lt;span&gt;valid URL&lt;/span&gt;. To obtain the
+  corresponding citation link, the value of the attribute must be
+  &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; relative to the
+  element. User agents should allow users to follow such citation
+  links.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code&gt;q&lt;/code&gt; element must not be used in place of quotation
   marks that do not represent quotes; for example, it is inappropriate
@@ -15730,8 +15723,10 @@
 
   &lt;p&gt;If the &lt;code title=&quot;attr-mod-cite&quot;&gt;cite&lt;/code&gt; attribute is
   present, it must be a &lt;span&gt;valid URL&lt;/span&gt; that explains the
-  change. User agents should allow users to follow such citation
-  links.&lt;/p&gt;
+  change. To obtain the corresponding citation link, the value of the
+  attribute must be &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt;
+  relative to the element. User agents should allow users to follow
+  such citation links.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;attr-mod-datetime&quot;&gt;&lt;code&gt;datetime&lt;/code&gt;&lt;/dfn&gt;
   attribute may be used to specify the time and date of the change.&lt;/p&gt;
@@ -16087,10 +16082,10 @@
   section&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p class=&quot;XXX&quot;&gt;There has been some suggestion that the &lt;code
-  title=&quot;&quot;&gt;longdesc&lt;/code&gt; attribute from HTML4, or some other
-  mechanism that is more powerful than &lt;code title=&quot;&quot;&gt;alt=&quot;&quot;&lt;/code&gt;,
-  should be included. This has been considered and rejected in the
-  past, but may be considered again in the future.&lt;/p&gt;
+  title=&quot;&quot;&gt;longdesc&lt;/code&gt; attribute from HTML4 should be
+  included. This has been considered and rejected in the past, but if
+  new evidence is found showing the attribute to actually help users
+  rather than harm them, it may be reconsidered.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code&gt;img&lt;/code&gt; must not be used as a layout tool. In
   particular, &lt;code&gt;img&lt;/code&gt; elements should not be used to display
@@ -16099,16 +16094,17 @@
 
   &lt;hr&gt;
 
-  &lt;p&gt;When an &lt;code&gt;img&lt;/code&gt; is created with a &lt;code
+  &lt;p&gt;Unless the user agent cannot support images, or its support for
+  images has been disabled, or the user agent only fetches elements on
+  demand, or the element's &lt;code title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt;
+  attribute has a value that is an &lt;i&gt;ignored self-reference&lt;/i&gt;,
+  then, when an &lt;code&gt;img&lt;/code&gt; is created with a &lt;code
   title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute, and whenever the &lt;code
   title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute is set subsequently, the
-  user agent must &lt;span&gt;fetch&lt;/span&gt; the resource specifed by the
-  &lt;code title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute's value, unless the
-  user agent cannot support images, or its support for images has been
-  disabled, or the user agent only fetches elements on demand, or the
-  element's &lt;code title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute has a
-  value that is an &lt;i&gt;ignored self-reference&lt;/i&gt;.&lt;/p&gt; &lt;!-- Note how
-  this does NOT happen when the base URL changes. --&gt;
+  user agent must &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the value
+  of that attribute, relative to the element, and if that is
+  successful must then &lt;span&gt;fetch&lt;/span&gt; that resource.&lt;/p&gt; &lt;!-- Note
+  how this does NOT happen when the base URL changes. --&gt;
 
   &lt;p&gt;The &lt;code title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute's value is an
   &lt;i&gt;ignored self-reference&lt;/i&gt; if its value is the empty string, and
@@ -17396,27 +17392,32 @@
   gives the address of a page that the nested &lt;span&gt;browsing
   context&lt;/span&gt; is to contain. The attribute, if present, must be a
   &lt;span&gt;valid URL&lt;/span&gt;. When the browsing context is created, if the
-  attribute is present, the user agent must &lt;span&gt;navigate&lt;/span&gt; the
-  element's browsing context to the given &lt;span&gt;URL&lt;/span&gt;, with
-  &lt;span&gt;replacement enabled&lt;/span&gt;, and with the &lt;code&gt;iframe&lt;/code&gt;
-  element's document's &lt;span&gt;browsing context&lt;/span&gt; as the
-  &lt;span&gt;source browsing context&lt;/span&gt;. If the user &lt;span
-  title=&quot;navigate&quot;&gt;navigates&lt;/span&gt; away from this page, the
-  &lt;code&gt;iframe&lt;/code&gt;'s corresponding &lt;code&gt;Window&lt;/code&gt; object will
-  reference new &lt;code&gt;Document&lt;/code&gt; objects, but the &lt;code
+  attribute is present, the user agent must &lt;span title=&quot;resolve a
+  url&quot;&gt;resolve&lt;/span&gt; the value of that attribute, relative to the
+  element, and if that is successful, must then &lt;span&gt;navigate&lt;/span&gt;
+  the element's browsing context to the resulting &lt;span&gt;absolute
+  URL&lt;/span&gt;, with &lt;span&gt;replacement enabled&lt;/span&gt;, and with the
+  &lt;code&gt;iframe&lt;/code&gt; element's document's &lt;span&gt;browsing
+  context&lt;/span&gt; as the &lt;span&gt;source browsing context&lt;/span&gt;. If the
+  user &lt;span title=&quot;navigate&quot;&gt;navigates&lt;/span&gt; away from this page,
+  the &lt;code&gt;iframe&lt;/code&gt;'s corresponding &lt;code&gt;Window&lt;/code&gt; object
+  will reference new &lt;code&gt;Document&lt;/code&gt; objects, but the &lt;code
   title=&quot;attr-iframe-src&quot;&gt;src&lt;/code&gt; attribute will not change.&lt;/p&gt;
 
   &lt;p&gt;Whenever the &lt;code title=&quot;attr-iframe-src&quot;&gt;src&lt;/code&gt; attribute
-  is set, the nested &lt;span&gt;browsing context&lt;/span&gt; must be &lt;span
-  title=&quot;navigate&quot;&gt;navigated&lt;/span&gt; to the &lt;span&gt;URL&lt;/span&gt; given by
-  that attribute's value, with the &lt;code&gt;iframe&lt;/code&gt; element's
-  document's &lt;span&gt;browsing context&lt;/span&gt; as the &lt;span&gt;source
-  browsing context&lt;/span&gt;.&lt;/p&gt; &lt;!-- It doesn't happen when the base
-  URL is changed, though. --&gt;
+  is set, the user agent must &lt;span title=&quot;resolve a
+  url&quot;&gt;resolve&lt;/span&gt; the value of that attribute, relative to the
+  element, and if that is successful, the nested &lt;span&gt;browsing
+  context&lt;/span&gt; must be &lt;span title=&quot;navigate&quot;&gt;navigated&lt;/span&gt; to
+  the resulting &lt;span&gt;absolute URL&lt;/span&gt;, with the
+  &lt;code&gt;iframe&lt;/code&gt; element's document's &lt;span&gt;browsing
+  context&lt;/span&gt; as the &lt;span&gt;source browsing context&lt;/span&gt;.&lt;/p&gt; &lt;!--
+  It doesn't happen when the base URL is changed, though. --&gt;
 
   &lt;p&gt;If the &lt;code title=&quot;attr-iframe-src&quot;&gt;src&lt;/code&gt; attribute is not
-  set when the element is created, the browsing context will remain at
-  the initial &lt;code&gt;about:blank&lt;/code&gt; page.&lt;/p&gt;
+  set when the element is created, or if its value cannot be &lt;span
+  title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt;, the browsing context will
+  remain at the initial &lt;code&gt;about:blank&lt;/code&gt; page.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;attr-iframe-name&quot;&gt;&lt;code&gt;name&lt;/code&gt;&lt;/dfn&gt;
   attribute, if present, must be a &lt;span&gt;valid browsing context
@@ -17904,9 +17905,11 @@
   whenever the &lt;code title=&quot;attr-embed-type&quot;&gt;type&lt;/code&gt; attribute is
   set or removed while the element has a &lt;code
   title=&quot;attr-embed-src&quot;&gt;src&lt;/code&gt; attribute, if the element is not
-  in a sandboxed browsing context, user agents should
-  &lt;span&gt;fetch&lt;/span&gt; the specified resource, find and instantiate an
-  appropriate &lt;span&gt;plugin&lt;/span&gt; based on the &lt;span
+  in a sandboxed browsing context, user agents must &lt;span
+  title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the value of the attribute,
+  relative to the element, and if that is successful, should
+  &lt;span&gt;fetch&lt;/span&gt; the resulting &lt;span&gt;absolute URL&lt;/span&gt;, find and
+  instantiate an appropriate &lt;span&gt;plugin&lt;/span&gt; based on the &lt;span
   title=&quot;concept-embed-type&quot;&gt;content's type&lt;/span&gt;, and hand that
   &lt;span&gt;plugin&lt;/span&gt; the content of the resource, replacing any
   previously instantiated plugin for the element. &lt;!-- Note that this
@@ -18145,9 +18148,14 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;&lt;span&gt;Fetch&lt;/span&gt; the resource specified by the &lt;code
-      title=&quot;attr-object-data&quot;&gt;data&lt;/code&gt; attribute.&lt;/p&gt;
+      &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the
+      &lt;span&gt;URL&lt;/span&gt; specified by the &lt;code
+      title=&quot;attr-object-data&quot;&gt;data&lt;/code&gt; attribute, relative to the
+      element.&lt;/p&gt;
 
+      &lt;p&gt;If that is successful, &lt;span&gt;fetch&lt;/span&gt; the resulting
+      &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;
+
       &lt;p&gt;The fetching of the resource must &lt;span&gt;delay the &lt;code
       title=&quot;event-load&quot;&gt;load&lt;/code&gt; event&lt;/span&gt;.&lt;/p&gt;
 
@@ -18162,10 +18170,12 @@
      agents may opt to consider a resource &quot;available&quot; whenever enough
      data has been obtained to begin processing the resource.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If the load failed (e.g. an HTTP 404 error, a DNS error),
-     &lt;span&gt;fire an &lt;code title=&quot;event-error&quot;&gt;error&lt;/code&gt; event&lt;/span&gt;
-     at the element, then jump to the last step in the overall set of
-     steps (fallback).&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;If the load failed (e.g. the &lt;span&gt;URL&lt;/span&gt; could not be
+     &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt;, there was an HTTP
+     404 error, there was a DNS error), &lt;span&gt;fire an &lt;code
+     title=&quot;event-error&quot;&gt;error&lt;/code&gt; event&lt;/span&gt; at the element,
+     then jump to the last step in the overall set of steps
+     (fallback).&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Determine the &lt;var title=&quot;&quot;&gt;resource type&lt;/var&gt;, as follows:&lt;/p&gt;
 
@@ -18268,7 +18278,8 @@
 
         &lt;p class=&quot;XXX&quot;&gt;navigation might end up treating it as
         something else, because it can do sniffing. how should we
-        handle that?&lt;/p&gt;
+        handle that? it could also refetch the resource entirely,
+        maybe from another application cache.&lt;/p&gt;
 
         &lt;!-- note that malformed XML files don't cause fallback --&gt;
 
@@ -18557,12 +18568,14 @@
   attribute gives the address of an image file that the user agent can
   show while no video data is available. The attribute, if present,
   must contain a &lt;span&gt;valid URL&lt;/span&gt;. If the specified resource is
-  to be used, it must be &lt;span title=&quot;fetch&quot;&gt;fetched&lt;/span&gt; when the
-  element is created or when the &lt;code
-  title=&quot;attr-video-poster&quot;&gt;poster&lt;/code&gt; attribute is set. The
+  to be used, then, when the element is created or when the &lt;code
+  title=&quot;attr-video-poster&quot;&gt;poster&lt;/code&gt; attribute is set, its value
+  must be &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; relative to the
+  element, and if that is successful, the resulting &lt;span&gt;absolute
+  URL&lt;/span&gt; must be &lt;span title=&quot;fetch&quot;&gt;fetched&lt;/span&gt;. The
   &lt;dfn&gt;poster frame&lt;/dfn&gt; is then the image obtained from that
-  resource, if any.&lt;/p&gt; &lt;!-- So that it is unaffected by changes to
-  the base URL.  --&gt;
+  resource, if any.&lt;/p&gt; &lt;!-- thus it is unaffected by changes to the
+  base URL. --&gt;
 
   &lt;p class=&quot;note&quot;&gt;The image given by the &lt;code
   title=&quot;attr-video-poster&quot;&gt;poster&lt;/code&gt; attribute, the &lt;i&gt;poster
@@ -19232,7 +19245,8 @@
     &lt;ol&gt;
 
      &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the
-     &lt;span&gt;URL&lt;/span&gt; given in that attribute.&lt;/p&gt;
+     &lt;span&gt;URL&lt;/span&gt; given in that attribute, relative to the
+     &lt;span&gt;media element&lt;/span&gt;.&lt;/p&gt;
 
      &lt;li&gt;&lt;p&gt;If that is successful, then return a list consisting of
      only one entry, the resulting &lt;span&gt;absolute URL&lt;/span&gt; as the
@@ -19272,8 +19286,8 @@
 
      &lt;li&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolving&lt;/span&gt; the
      &lt;span&gt;URL&lt;/span&gt; given by the &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;
-     element's &lt;code title=&quot;attr-source-src&quot;&gt;src&lt;/code&gt; attribute does
-     not fail.&lt;/li&gt;
+     element's &lt;code title=&quot;attr-source-src&quot;&gt;src&lt;/code&gt; attribute
+     relative to &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; does not fail.&lt;/li&gt;
 
      &lt;li&gt;The &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; element either has no &lt;code
      title=&quot;attr-source-type&quot;&gt;type&lt;/code&gt; attribute, or its &lt;code
@@ -19295,8 +19309,9 @@
     &lt;p&gt;...then append the &lt;span&gt;absolute URL&lt;/span&gt; resulting from
     &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the &lt;span&gt;URL&lt;/span&gt;
     given in that &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; element's &lt;code
-    title=&quot;attr-source-src&quot;&gt;src&lt;/code&gt; attribute to the &lt;var
-    title=&quot;&quot;&gt;result&lt;/var&gt; list.&lt;/p&gt;
+    title=&quot;attr-source-src&quot;&gt;src&lt;/code&gt; attribute relative to &lt;var
+    title=&quot;&quot;&gt;candidate&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;
+    list.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -30442,12 +30457,14 @@
   optionally animated, image resource that is neither paged nor
   scripted.&lt;/p&gt;
 
-  &lt;p&gt;When any of the following events occur, the user agent must
-  &lt;span&gt;fetch&lt;/span&gt; the resource specifed by the &lt;code
-  title=&quot;attr-input-src&quot;&gt;src&lt;/code&gt; attribute's value, unless the user
-  agent cannot support images, or its support for images has been
-  disabled, or the user agent only fetches elements on demand:&lt;/p&gt;
-  &lt;!-- Note how this does NOT happen when the base URL changes. --&gt;
+  &lt;p&gt;When any of the following events occur, unless the user agent
+  cannot support images, or its support for images has been disabled,
+  or the user agent only fetches elements on demand, the user agent
+  must &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the value of the
+  &lt;code title=&quot;attr-input-src&quot;&gt;src&lt;/code&gt; attribute, relative to the
+  element, and if that is successful, must &lt;span&gt;fetch&lt;/span&gt; the
+  resulting &lt;span&gt;absolute URL&lt;/span&gt;:&lt;/p&gt; &lt;!-- Note how this does NOT
+  happen when the base URL changes. --&gt;
 
   &lt;ul&gt;
 
@@ -33711,8 +33728,10 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the
-   &lt;span&gt;URL&lt;/span&gt; &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;. If this fails, abort
-   these steps.&lt;/p&gt;&lt;/li&gt;
+   &lt;span&gt;URL&lt;/span&gt; &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;, relative to the &lt;var
+   title=&quot;&quot;&gt;submitter&lt;/var&gt; element. If this fails, abort these
+   steps. Otherwise, let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be the resulting
+   &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;span
    title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; of the resulting
@@ -35105,11 +35124,11 @@
     title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the value of the &lt;code
     title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute of the first
     &lt;code&gt;img&lt;/code&gt; element child of the row's first cell's element,
-    if there is one and resolving its attribute is
-    successful. Otherwise, the &lt;span&gt;URL&lt;/span&gt; of the row's image is
-    the empty string.&lt;/p&gt; &lt;!-- note that if the base URL has changed,
-    this URL can be different than the one that the &lt;img&gt; element
-    fetched when it was created --&gt;
+    relative to that element, if there is one and resolving its
+    attribute is successful. Otherwise, the &lt;span&gt;URL&lt;/span&gt; of the
+    row's image is the empty string.&lt;/p&gt; &lt;!-- note that if the base
+    URL has changed, this URL can be different than the one that the
+    &lt;img&gt; element fetched when it was created --&gt;
 
     &lt;p&gt;&lt;strong&gt;&lt;code title=&quot;dom-provider-getRowMenu&quot;&gt;getRowMenu(&lt;var
     title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;: If the row's first cell's
@@ -35366,11 +35385,11 @@
     the first &lt;code&gt;img&lt;/code&gt; element descendant (in the real DOM) of
     the row's element, that is not also a descendant of another
     element in the filtered view that is a descendant of the row's
-    element, if such an element exists and resolving its attribute is
-    successful. Otherwise, it must return the empty string.&lt;/p&gt; &lt;!--
-    note that if the base URL has changed, this URL can be different
-    than the one that the &lt;img&gt; element fetched when it was created
-    --&gt;
+    element, if such an element exists and resolving its attribute
+    relative to the element itself, is successful. Otherwise, it must
+    return the empty string.&lt;/p&gt; &lt;!-- note that if the base URL has
+    changed, this URL can be different than the one that the &lt;img&gt;
+    element fetched when it was created --&gt;
 
     &lt;div class=&quot;example&quot;&gt;
 
@@ -35912,12 +35931,12 @@
    title=&quot;dom-provider-getRowImage&quot;&gt;getRowImage()&lt;/code&gt; method with a
    &lt;code&gt;RowSpecification&lt;/code&gt; object representing the row in
    question. The return value is a &lt;span&gt;URL&lt;/span&gt;. Immediately &lt;span
-   title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; that URL as if it came from an
-   attribute of the &lt;code&gt;datagrid&lt;/code&gt; element to obtain an
-   &lt;span&gt;absolute URL&lt;/span&gt; identifying the image that represents the
-   row. If the method returns the empty string, null, or if the method
-   is not defined, then the row has no associated image.&lt;/dd&gt; &lt;!--
-   changing the base URL doesn't change the image used later --&gt;
+   title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; that URL, relative to the
+   &lt;code&gt;datagrid&lt;/code&gt; element, to obtain an &lt;span&gt;absolute
+   URL&lt;/span&gt; identifying the image that represents the row. If the
+   method returns the empty string, null, or if the method is not
+   defined, then the row has no associated image.&lt;/dd&gt; &lt;!-- changing
+   the base URL doesn't change the image used later --&gt;
 
    &lt;dt&gt;To obtain a context menu appropriate for a particular row&lt;/dt&gt;
 
@@ -36490,7 +36509,12 @@
   &lt;p&gt;The &lt;dfn title=&quot;attr-command-icon&quot;&gt;&lt;code&gt;icon&lt;/code&gt;&lt;/dfn&gt;
   attribute gives a picture that represents the command. If the
   attribute is specified, the attribute's value must contain a
-  &lt;span&gt;valid URL&lt;/span&gt;.&lt;/p&gt;
+  &lt;span&gt;valid URL&lt;/span&gt;. To obtain the &lt;span&gt;absolute URL&lt;/span&gt; of
+  the icon, the attribute's value must be &lt;span title=&quot;resolve a
+  url&quot;&gt;resolved&lt;/span&gt; relative to the element.&lt;/p&gt; &lt;!-- this is
+  affected by the base URL being changed, so users of this should
+  cache the image once they've fetched it once, at least until the
+  relative url changes again --&gt;
 
   &lt;p&gt;The &lt;dfn
   title=&quot;attr-command-disabled&quot;&gt;&lt;code&gt;disabled&lt;/code&gt;&lt;/dfn&gt; attribute
@@ -37006,11 +37030,12 @@
    &lt;code&gt;command&lt;/code&gt; element with a &lt;code
    title=&quot;attr-command-default&quot;&gt;default&lt;/code&gt; attribute, mark the
    command as being a default command.&lt;/dd&gt; &lt;!-- XXX if there's an
-   Icon URL for the command, it should be &lt;span
+   Icon facet for the command, it should be &lt;span
    title=&quot;fetch&quot;&gt;fetched&lt;/span&gt;, and then that image should be
    associated with the command, such that each command only has its
    image fetched once, to prevent changes to the base URL from having
-   effects after the image has been fetched once. --&gt;
+   effects after the image has been fetched once. (no need to resolve
+   the Icon facet, it's an absolute URL) --&gt;
 
 
    &lt;dt&gt;An &lt;code&gt;hr&lt;/code&gt; element&lt;/dt&gt;
@@ -37403,10 +37428,10 @@
   is the &lt;span&gt;absolute URL&lt;/span&gt; obtained from &lt;span title=&quot;resolve
   a url&quot;&gt;resolving&lt;/span&gt; the value of the &lt;code
   title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute of the first
-  &lt;code&gt;img&lt;/code&gt; element descendant of the element, if there is such
-  an element and resolving its attribute is successful. Otherwise,
-  there is no &lt;span title=&quot;command-facet-Icon&quot;&gt;Icon&lt;/span&gt; for the
-  command.&lt;/p&gt;
+  &lt;code&gt;img&lt;/code&gt; element descendant of the element, relative to that
+  element, if there is such an element and resolving its attribute is
+  successful. Otherwise, there is no &lt;span
+  title=&quot;command-facet-Icon&quot;&gt;Icon&lt;/span&gt; for the command.&lt;/p&gt;
 
   &lt;p&gt;The &lt;span title=&quot;command-facet-HiddenState&quot;&gt;Hidden State&lt;/span&gt;
   of the command is true (hidden) if the element has a &lt;code
@@ -37616,9 +37641,10 @@
   &lt;p&gt;The &lt;span title=&quot;command-facet-Icon&quot;&gt;Icon&lt;/span&gt; for the command
   is the &lt;span&gt;absolute URL&lt;/span&gt; obtained from &lt;span title=&quot;resolve
   a url&quot;&gt;resolving&lt;/span&gt; the value of the element's &lt;code
-  title=&quot;attr-command-icon&quot;&gt;icon&lt;/code&gt; attribute, if it has such an
-  attribute and resolving it is successful. Otherwise, there is no
-  &lt;span title=&quot;command-facet-Icon&quot;&gt;Icon&lt;/span&gt; for the command.&lt;/p&gt;
+  title=&quot;attr-command-icon&quot;&gt;icon&lt;/code&gt; attribute, relative to the
+  element, if it has such an attribute and resolving it is
+  successful. Otherwise, there is no &lt;span
+  title=&quot;command-facet-Icon&quot;&gt;Icon&lt;/span&gt; for the command.&lt;/p&gt;
 
   &lt;p&gt;The &lt;span title=&quot;command-facet-HiddenState&quot;&gt;Hidden State&lt;/span&gt;
   of the command is true (hidden) if the element has a &lt;code
@@ -37672,10 +37698,11 @@
   is the &lt;span&gt;absolute URL&lt;/span&gt; obtained from &lt;span title=&quot;resolve
   a url&quot;&gt;resolving&lt;/span&gt; the value of the &lt;code
   title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute of the first
-  &lt;code&gt;img&lt;/code&gt; element descendant of the element, if there is such
-  an element and resolving its attribute is successful. Otherwise, the
-  &lt;span title=&quot;command-facet-Icon&quot;&gt;Icon&lt;/span&gt; is a user-agent-defined
-  image appropriate for the &lt;code&gt;bb&lt;/code&gt; element's &lt;code
+  &lt;code&gt;img&lt;/code&gt; element descendant of the element, relative to that
+  element, if there is such an element and resolving its attribute is
+  successful. Otherwise, the &lt;span
+  title=&quot;command-facet-Icon&quot;&gt;Icon&lt;/span&gt; is a user-agent-defined image
+  appropriate for the &lt;code&gt;bb&lt;/code&gt; element's &lt;code
   title=&quot;attr-bb-type&quot;&gt;type&lt;/code&gt; attribute's state.&lt;/p&gt;
 
   &lt;p&gt;The &lt;span title=&quot;command-facet-HiddenState&quot;&gt;Hidden State&lt;/span&gt;
@@ -38091,8 +38118,14 @@
   be made the same as members of any other group. Each such group is a
   &lt;dfn&gt;unit of related similar-origin browsing contexts&lt;/dfn&gt;.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;span&gt;unit of related similar-origin browsing
+  contexts&lt;/span&gt; has a &lt;dfn&gt;current script base URL&lt;/dfn&gt; which is
+  used to &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; relative &lt;span
+  title=&quot;URL&quot;&gt;URLs&lt;/span&gt; used in scripts running in that &lt;span&gt;unit
+  of related similar-origin browsing contexts&lt;/span&gt;.&lt;/p&gt;
 
 
+
   &lt;h4&gt;Browsing context names&lt;/h4&gt;
 
   &lt;p&gt;Browsing contexts can have a &lt;dfn&gt;browsing context name&lt;/dfn&gt;. By
@@ -38387,7 +38420,8 @@
   the empty string, then the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument defaults
   to &quot;&lt;code&gt;about:blank&lt;/code&gt;&quot;. The argument must be &lt;span
   title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; to an &lt;span&gt;absolute
-  URL&lt;/span&gt; (or an error) when the method is invoked.&lt;/p&gt;
+  URL&lt;/span&gt; (or an error), relative to the &lt;span&gt;current script base
+  URL&lt;/span&gt;, when the method is invoked.&lt;/p&gt;
 
   &lt;p&gt;The second argument, &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;, specifies the
   &lt;span title=&quot;browsing context name&quot;&gt;name&lt;/span&gt; of the browsing
@@ -38429,15 +38463,15 @@
   &lt;p&gt;Then, the user agent must &lt;span&gt;navigate&lt;/span&gt; the selected
   &lt;span&gt;browsing context&lt;/span&gt; to the &lt;span&gt;absolute URL&lt;/span&gt; (or
   error) obtained from &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt;
-  &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. If the &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt; is true,
-  then &lt;span title=&quot;replacement enabled&quot;&gt;replacement must be
+  &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; earlier. If the &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt;
+  is true, then &lt;span title=&quot;replacement enabled&quot;&gt;replacement must be
   enabled&lt;/span&gt;; otherwise, it must not be enabled unless the
   &lt;span&gt;browsing context&lt;/span&gt; was just created as part of the
   &lt;span&gt;the rules for choosing a browsing context given a browsing
   context name&lt;/span&gt;. The navigation must be done with the &lt;span
   title=&quot;script's browsing context&quot;&gt;browsing context&lt;/span&gt; of the
-  &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that invoked the method as the &lt;span&gt;source browsing
-  context&lt;/span&gt;.&lt;/p&gt;
+  &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that invoked the method
+  as the &lt;span&gt;source browsing context&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;The method must return the &lt;code&gt;Window&lt;/code&gt; object of the
   default view of the &lt;span&gt;browsing context&lt;/span&gt; that was
@@ -39424,33 +39458,43 @@
   &lt;h5&gt;Calling scripts&lt;/h5&gt;
 
   &lt;p&gt;When a user agent is to &lt;dfn&gt;jump to a code entry-point&lt;/dfn&gt; for
-  a &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt;, if &lt;span
-  title=&quot;concept-bc-noscript&quot;&gt;scripting is disabled&lt;/span&gt; in the
-  &lt;span&gt;script's browsing context&lt;/span&gt;, or if the script's
-  &lt;span&gt;script group&lt;/span&gt; is &lt;i&gt;frozen&lt;/i&gt;, then the user agent must
-  throw an &lt;code&gt;UNAVAILABLE_SCRIPT_ERR&lt;/code&gt; exception. Otherwise,
-  the &lt;span title=&quot;script execution environment&quot;&gt;script execution
-  environment&lt;/span&gt; for the &lt;span
-  title=&quot;concept-script&quot;&gt;script&lt;/span&gt; must execute the code for the
-  given code entry-point.&lt;/p&gt;
+  a &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt;, for example because
+  one &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; has called another,
+  or because the user agent is to invoke a callback defined in that
+  &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt;, the user agent must run
+  the following steps:&lt;/p&gt;
 
-  &lt;p&gt;When executable code from a &lt;span
-  title=&quot;concept-script&quot;&gt;script&lt;/span&gt; in one &lt;span&gt;script
-  group&lt;/span&gt; makes a call to a &lt;span
-  title=&quot;concept-script&quot;&gt;script&lt;/span&gt; in another &lt;span&gt;script
-  group&lt;/span&gt;, the user agent must &lt;span title=&quot;jump to a code
-  entry-point&quot;&gt;jump&lt;/span&gt; to the corresponding code entry-point in
-  that second script using the steps above.&lt;/p&gt;
+  &lt;ol&gt;
 
-  &lt;p&gt;When executable code from a &lt;span
-  title=&quot;concept-script&quot;&gt;script&lt;/span&gt; makes a call to a &lt;span
-  title=&quot;concept-script&quot;&gt;script&lt;/span&gt; in the same &lt;span&gt;script
-  group&lt;/span&gt;, the &lt;span title=&quot;script execution environment&quot;&gt;script
-  execution environment&lt;/span&gt; for the &lt;span
-  title=&quot;concept-script&quot;&gt;script&lt;/span&gt; must execute the code for the
-  given code entry-point without checking if the &lt;span&gt;script
-  group&lt;/span&gt; is frozen.&lt;/p&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;If executable code from a &lt;span
+    title=&quot;concept-script&quot;&gt;script&lt;/span&gt; is making a call to a &lt;span
+    title=&quot;concept-script&quot;&gt;script&lt;/span&gt; in the same &lt;span&gt;script
+    group&lt;/span&gt;, then skip this step.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, if &lt;span title=&quot;concept-bc-noscript&quot;&gt;scripting is
+    disabled&lt;/span&gt; in the &lt;span&gt;script's browsing context&lt;/span&gt;, or
+    if the script's &lt;span&gt;script group&lt;/span&gt; is &lt;i&gt;frozen&lt;/i&gt;, then
+    the user agent must throw an &lt;code&gt;UNAVAILABLE_SCRIPT_ERR&lt;/code&gt;
+    exception and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;current script base URL&lt;/span&gt; has no value,
+   then set it to the &lt;span&gt;script's base URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Make the &lt;span title=&quot;script execution environment&quot;&gt;script
+   execution environment&lt;/span&gt; for the &lt;span
+   title=&quot;concept-script&quot;&gt;script&lt;/span&gt; execute the code for the given
+   code entry-point.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;current script base URL&lt;/span&gt; was set in the
+   earlier step for this invocation of the algorithm, then set it back
+   to having no value.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
   &lt;p class=&quot;note&quot;&gt;In particular, this means that scripts in a
   &lt;i&gt;frozen&lt;/i&gt; &lt;span&gt;script group&lt;/span&gt; can keep on executing so
   long as they don't call code in another &lt;span&gt;script
@@ -39458,15 +39502,10 @@
   after calling &lt;code title=&quot;dom-document-open&quot;&gt;document.open()&lt;/code&gt;
   on its own &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Any time the user agent to invoke a callback defined in a &lt;span
-  title=&quot;concept-script&quot;&gt;script&lt;/span&gt;, the user agent must &lt;span
-  title=&quot;jump to a code entry-point&quot;&gt;jump&lt;/span&gt; to the corresponding
-  code entry-point in that second script.&lt;/p&gt;
 
 
+  &lt;h5 id=&quot;creating-scripts&quot;&gt;Creating scripts&lt;/h5&gt;
 
-  &lt;h5&gt;Creating scripts&lt;/h5&gt;
-
   &lt;p&gt;When the specification says that a &lt;span
   title=&quot;concept-script&quot;&gt;script&lt;/span&gt; is to be &lt;dfn title=&quot;create a
   script&quot;&gt;created&lt;/dfn&gt;, given some script source, its scripting
@@ -40730,6 +40769,15 @@
 
    &lt;li&gt;
 
+    &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; &lt;var
+    title=&quot;&quot;&gt;url&lt;/var&gt; relative to the &lt;span&gt;current script base
+    URL&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If this fails, then throw a &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception
+    and abort these steps.&lt;/p&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;If the user agent is configured such that this invocation of
     &lt;code title=&quot;dom-showModalDialog&quot;&gt;showModalDialog()&lt;/code&gt; is
     somehow disabled, then the method returns the empty string; abort
@@ -40759,7 +40807,8 @@
 
      &lt;li&gt;have an &lt;span&gt;active document&lt;/span&gt; whose
      &lt;span&gt;origin&lt;/span&gt; is the &lt;span title=&quot;same origin&quot;&gt;same&lt;/span&gt;
-     as the &lt;span&gt;origin&lt;/span&gt; of the &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that called the &lt;code
+     as the &lt;span&gt;origin&lt;/span&gt; of the &lt;span
+     title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that called the &lt;code
      title=&quot;dom-showModalDialog&quot;&gt;showModalDialog()&lt;/code&gt; method at
      the time the method was called,&lt;/li&gt; &lt;!-- Note that changing
      document.domain to talk to another domain doesn't make you able
@@ -40809,18 +40858,21 @@
    &lt;li&gt;
 
     &lt;p&gt;Let the &lt;span&gt;dialog arguments' origin&lt;/span&gt; be the
-    &lt;span&gt;origin&lt;/span&gt; of the &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that called the &lt;code
+    &lt;span&gt;origin&lt;/span&gt; of the &lt;span
+    title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that called the &lt;code
     title=&quot;dom-showModalDialog&quot;&gt;showModalDialog()&lt;/code&gt; method.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;span&gt;Navigate&lt;/span&gt; the new browsing context to &lt;var
-    title=&quot;&quot;&gt;url&lt;/var&gt;, with &lt;span&gt;replacement enabled&lt;/span&gt;, and
-    with the &lt;span title=&quot;script's browsing context&quot;&gt;browsing
-    context&lt;/span&gt; of the &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that invoked the method as the
-    &lt;span&gt;source browsing context&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Navigate&lt;/span&gt; the new &lt;span&gt;browsing context&lt;/span&gt; to
+    the &lt;span&gt;absolute URL&lt;/span&gt; that resulted from &lt;span
+    title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+    earlier, with &lt;span&gt;replacement enabled&lt;/span&gt;, and with the &lt;span
+    title=&quot;script's browsing context&quot;&gt;browsing context&lt;/span&gt; of the
+    &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that invoked the method
+    as the &lt;span&gt;source browsing context&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -41232,7 +41284,8 @@
   &lt;p&gt;There is &lt;a href=&quot;#sample-handler-impl&quot;&gt;an example of how these
   methods could be presented to the user&lt;/a&gt; below.&lt;/p&gt;
 
-  &lt;p&gt;The arguments to the methods have the following meanings:&lt;/p&gt;
+  &lt;p&gt;The arguments to the methods have the following meanings and
+  corresponding implementaion requirements:&lt;/p&gt;
 
   &lt;dl&gt;
 
@@ -41277,25 +41330,28 @@
    &lt;dd&gt;
 
     &lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; of the page that will handle the
-    requests. When the user agent uses this URL, it must replace the
-    first occurrence of the exact literal string &quot;&lt;code&gt;%s&lt;/code&gt;&quot;
-    with an escaped version of the URL of the content in question (as
-    defined below), then &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt;
-    the resulting URL (using the &lt;span title=&quot;script's base URL&quot;&gt;base
-    URL&lt;/span&gt; of the script that originally invoked the &lt;code
+    requests.&lt;/p&gt;
+
+    &lt;p&gt;When the user agent uses this URL, it must replace the first
+    occurrence of the exact literal string &quot;&lt;code title=&quot;&quot;&gt;%s&lt;/code&gt;&quot;
+    with an escaped version of the &lt;span&gt;absolute URL&lt;/span&gt; of the
+    content in question (as defined below), then &lt;span title=&quot;resolve
+    a url&quot;&gt;resolve&lt;/span&gt; the resulting URL, relative to the
+    &lt;span&gt;current script base URL&lt;/span&gt; at the time the &lt;code
     title=&quot;dom-navigator-registerContentHandler&quot;&gt;registerContentHandler()&lt;/code&gt;
     or &lt;code
     title=&quot;dom-navigator-registerProtocolHandler&quot;&gt;registerProtocolHandler()&lt;/code&gt;
-    method), and then &lt;span&gt;fetch&lt;/span&gt; the resulting URL using the
-    GET method (&lt;span title=&quot;concept-http-equivalent-get&quot;&gt;or
-    equivalent&lt;/span&gt; for non-HTTP URLs).&lt;/p&gt;
+    methods were invoked, and then &lt;span&gt;fetch&lt;/span&gt; the resulting
+    URL using the GET method (&lt;span
+    title=&quot;concept-http-equivalent-get&quot;&gt;or equivalent&lt;/span&gt; for
+    non-HTTP URLs).&lt;/p&gt;
 
-    &lt;p&gt;To get the escaped version of the URL of the content in
-    question, the user agent must &lt;span title=&quot;resolve a
-    URL&quot;&gt;resolve&lt;/span&gt; the URL, and then every character in the URL
-    that doesn't match the &lt;query&gt; production defined in RFC
-    3986 must be replaced by the percent-encoded form of the
-    character. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;To get the escaped version of the &lt;span&gt;absolute URL&lt;/span&gt; of
+    the content in question, the user agent must replace every
+    character in that &lt;span&gt;absolute URL&lt;/span&gt; that doesn't match the
+    &lt;query&gt; production defined in RFC 3986 by the
+    percent-encoded form of that character. &lt;a
+    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
 
     &lt;div class=&quot;example&quot;&gt;
 
@@ -41345,7 +41401,11 @@
 
   &lt;p&gt;User agents must raise a &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception if the
   &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument passed to one of these methods does
-  not contain the exact literal string &quot;&lt;code&gt;%s&lt;/code&gt;&quot;.&lt;/p&gt;
+  not contain the exact literal string &quot;&lt;code&gt;%s&lt;/code&gt;&quot;, or if &lt;span
+  title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+  argument with the first occurance of the string &quot;&lt;code
+  title=&quot;&quot;&gt;%s&lt;/code&gt;&quot; removed, relative to the &lt;span&gt;current script
+  base URL&lt;/span&gt;, is not successful.&lt;/p&gt;
 
   &lt;p&gt;User agents must not raise any other exceptions (other than
   binding-specific exceptions, such as for an incorrect number of
@@ -41884,6 +41944,9 @@
    testable since neither U+0000 nor U+FFFD are valid anywhere in the
    syntax and thus both will be treated the same anyway)--&gt;&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; be the &lt;span&gt;absolute
+   URL&lt;/span&gt; representing the manifest.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; be an initially empty
    list of &lt;span title=&quot;concept-appcache-explicit&quot;&gt;explicit
    entries&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -42026,7 +42089,8 @@
      &lt;dd&gt;
 
       &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the first item in
-      &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;; ignore the rest.&lt;/p&gt;
+      &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;, relative to &lt;var title=&quot;&quot;&gt;base
+      URL&lt;/var&gt;; ignore the rest.&lt;/p&gt;
 
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
@@ -42055,7 +42119,8 @@
       the second token in &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;.&lt;/p&gt;
 
       &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part
-      one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
+      one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;, relative to &lt;var
+      title=&quot;&quot;&gt;base URL&lt;/var&gt;.&lt;/p&gt;
 
       &lt;p&gt;If either fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
@@ -42091,7 +42156,8 @@
      &lt;dd&gt;
 
       &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the first item in
-      &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;; ignore the rest.&lt;/p&gt;
+      &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt;, relative to &lt;var title=&quot;&quot;&gt;base
+      URL&lt;/var&gt;; ignore the rest.&lt;/p&gt;
 
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
@@ -43535,7 +43601,8 @@
     &lt;ol&gt;
 
      &lt;li&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the value of the
-     third argument.&lt;/li&gt;
+     third argument, relative to the &lt;span&gt;current script base
+     URL&lt;/span&gt;.&lt;/li&gt;
 
      &lt;li&gt;If that fails, raise a &lt;code&gt;SECURITY_ERR&lt;/code&gt; exception and
      abort the &lt;code title=&quot;dom-history-pushState&quot;&gt;pushState()&lt;/code&gt;
@@ -43750,7 +43817,9 @@
 
   &lt;p&gt;When the &lt;dfn title=&quot;dom-location-assign&quot;&gt;&lt;code&gt;assign(&lt;var
   title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, the UA must
-  &lt;span&gt;navigate&lt;/span&gt; the &lt;span&gt;browsing context&lt;/span&gt; to the
+  &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the argument, relative to
+  the &lt;span&gt;current script base URL&lt;/span&gt;, and if that is successful,
+  must &lt;span&gt;navigate&lt;/span&gt; the &lt;span&gt;browsing context&lt;/span&gt; to the
   specified &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt; &lt;!-- XXX browsers seem to
   treat this as having &lt;span&gt;replacement enabled&lt;/span&gt; if the
   browsing context has only one entry and that entry is about:blank.
@@ -43759,6 +43828,8 @@
 
   &lt;p&gt;When the &lt;dfn title=&quot;dom-location-replace&quot;&gt;&lt;code&gt;replace(&lt;var
   title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, the UA must
+  &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the argument, relative to
+  the &lt;span&gt;current script base URL&lt;/span&gt;, and if that is successful,
   &lt;span&gt;navigate&lt;/span&gt; the &lt;span&gt;browsing context&lt;/span&gt; to the
   specified &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with &lt;span&gt;replacement
   enabled&lt;/span&gt;.&lt;/p&gt;
@@ -43770,6 +43841,12 @@
   context&lt;/span&gt; of the script that invoked the method as the
   &lt;span&gt;source browsing context&lt;/span&gt;.&lt;/p&gt;
 
+  &lt;p&gt;If the &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; step of the
+  the &lt;code title=&quot;dom-location-assign&quot;&gt;assign()&lt;/code&gt; and &lt;code
+  title=&quot;dom-location-replace&quot;&gt;replace()&lt;/code&gt; methods is not
+  successful, then the user agent must instead throw a
+  &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception.&lt;/p&gt;
+
 &lt;!--XXX
   &lt;dfn title=&quot;dom-location-reload&quot;&gt;&lt;code&gt;reload()&lt;/code&gt;&lt;/dfn&gt;
   reload during resize event:
@@ -43805,10 +43882,10 @@
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-location-resolveURL&quot;&gt;&lt;code&gt;resolveURL(&lt;var
   title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must &lt;span title=&quot;resolve a
-  url&quot;&gt;resolve&lt;/span&gt; its &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, and if
-  that succeeds, return the resulting &lt;span&gt;absolute URL&lt;/span&gt;. If it
-  fails, it must throw a &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception
-  instead.&lt;/p&gt;
+  url&quot;&gt;resolve&lt;/span&gt; its &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, relative
+  to the &lt;span&gt;current script base URL&lt;/span&gt;, and if that succeeds,
+  return the resulting &lt;span&gt;absolute URL&lt;/span&gt;. If it fails, it must
+  throw a &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception instead.&lt;/p&gt;
 
 
   &lt;h5&gt;Security&lt;/h5&gt;
@@ -43878,7 +43955,7 @@
   &lt;h4&gt;Navigating across documents&lt;/h4&gt;
 
   &lt;p&gt;Certain actions cause the &lt;span&gt;browsing context&lt;/span&gt; to
-  &lt;dfn&gt;navigate&lt;/dfn&gt; to a new resource. Navigation always involves
+  &lt;i&gt;navigate&lt;/i&gt; to a new resource. Navigation always involves
   &lt;dfn&gt;source browsing context&lt;/dfn&gt;, which is the browsing context
   which was responsible for starting the navigation.&lt;/p&gt;
 
@@ -43893,8 +43970,8 @@
   cause a browsing context to navigate, in addition to those defined
   in this specification.&lt;/p&gt;
 
-  &lt;p&gt;When a browsing context is navigated to a new resource, the user
-  agent must run the following steps:&lt;/p&gt;
+  &lt;p&gt;When a browsing context is &lt;dfn title=&quot;navigate&quot;&gt;navigated&lt;/dfn&gt;
+  to a new resource, the user agent must run the following steps:&lt;/p&gt;
 
   &lt;ol&gt;
 
@@ -43926,13 +44003,6 @@
    &lt;li&gt;&lt;p&gt;Cancel any preexisting attempt to navigate the
    &lt;span&gt;browsing context&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the &lt;span&gt;URL&lt;/span&gt;
-   of the new resource. If that fails, the user agent may abort these
-   steps, or may treat the URL as identifying some sort of user-agent
-   defined error resource, which could display some sort of inline
-   content, or could be handled using a mechanism that does not affect
-   the browsing context.&lt;/li&gt;
-
    &lt;li id=&quot;navigate-fragid-step&quot;&gt;&lt;p&gt;&lt;i&gt;Fragment identifiers&lt;/i&gt;: If
    the &lt;span&gt;absolute URL&lt;/span&gt; of the new resource is the same as
    the &lt;span title=&quot;the document's address&quot;&gt;address&lt;/span&gt; of the
@@ -43985,11 +44055,12 @@
     application cache at all; the submission will be made to the
     network.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;span&gt;fetch&lt;/span&gt; the new resource. If the resource
-    is being fetched using HTTP, and the method is not GET&lt;!-- or HEAD
-    (but that can't happen) --&gt;, then the user agent must include an
-    &lt;code title=&quot;http-origin&quot;&gt;XXX-Origin&lt;/code&gt; header whose value is
-    determined as follows:&lt;/p&gt;
+    &lt;p&gt;Otherwise, &lt;span&gt;fetch&lt;/span&gt; the new resource, if it has not
+    already been obtained&lt;!-- it's obtained by &lt;object&gt;, for instance
+    --&gt;. If the resource is being fetched using HTTP, and the method
+    is not GET&lt;!-- or HEAD (but that can't happen) --&gt;, then the user
+    agent must include an &lt;code title=&quot;http-origin&quot;&gt;XXX-Origin&lt;/code&gt;
+    header whose value is determined as follows:&lt;/p&gt;
 
     &lt;dl class=&quot;switch&quot;&gt;
 
@@ -44331,8 +44402,8 @@
   title=&quot;attr-html-manifest&quot;&gt;manifest&lt;/code&gt;, then, as soon as the
   element is &lt;span title=&quot;insert an element into a document&quot;&gt;inserted
   into the document&lt;/span&gt;, the user agent must &lt;span title=&quot;resolve a
-  url&quot;&gt;resolve&lt;/span&gt; the value of that attribute, and if that is
-  successful, must run the &lt;span
+  url&quot;&gt;resolve&lt;/span&gt; the value of that attribute relative to that
+  element, and if that is successful, must run the &lt;span
   title=&quot;concept-appcache-init&quot;&gt;application cache selection
   algorithm&lt;/span&gt; with the resulting &lt;span&gt;absolute URL&lt;/span&gt; as the
   manifest URL, and passing in the newly-created
@@ -46206,13 +46277,19 @@
   &lt;h4&gt;&lt;dfn&gt;Following hyperlinks&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When a user &lt;em&gt;follows a hyperlink&lt;/em&gt;, the user agent must
-  &lt;span&gt;navigate&lt;/span&gt; a &lt;span&gt;browsing context&lt;/span&gt; to the
-  &lt;span&gt;URL&lt;/span&gt; given by the &lt;code
-  title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute of that
-  hyperlink. In the case of server-side image maps, the URL of the
-  hyperlink must further have its &lt;var&gt;hyperlink suffix&lt;/var&gt; appended
-  to it.&lt;/p&gt;
+  &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the &lt;span&gt;URL&lt;/span&gt;
+  given by the &lt;code title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute
+  of that hyperlink, relative to the hyperlink element, and if that is
+  successful, must &lt;span&gt;navigate&lt;/span&gt; a &lt;span&gt;browsing
+  context&lt;/span&gt; to the resulting &lt;span&gt;absolute URL&lt;/span&gt;. In the
+  case of server-side image maps, the URL of the hyperlink must
+  further have its &lt;var&gt;hyperlink suffix&lt;/var&gt; appended to it.&lt;/p&gt;
 
+  &lt;p&gt;If &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the
+  &lt;span&gt;URL&lt;/span&gt; fails, the user agent may report the error to the
+  user in a user-agent-specific manner, may navigate to an error page
+  to report the error, or may ignore the error and do nothing.&lt;/p&gt;
+
   &lt;p&gt;If the user indicated a specific &lt;span&gt;browsing context&lt;/span&gt;
   when following the hyperlink, or if the user agent is configured to
   follow hyperlinks by navigating a particular browsing context, then
@@ -46265,16 +46342,16 @@
   &lt;p&gt;If an &lt;code&gt;a&lt;/code&gt; or &lt;code&gt;area&lt;/code&gt; hyperlink element has a
   &lt;code title=&quot;attr-hyperlink-ping&quot;&gt;ping&lt;/code&gt; attribute, and the
   user follows the hyperlink, and the hyperlink's &lt;span&gt;URL&lt;/span&gt; can
-  be &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; without failure, the
-  user agent must take the &lt;code
-  title=&quot;attr-hyperlink-ping&quot;&gt;ping&lt;/code&gt; attribute's value, &lt;span
-  title=&quot;split a string on spaces&quot;&gt;split that string on
+  be &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt;, relative to the
+  hyperlink element, without failure, then the user agent must take
+  the &lt;code title=&quot;attr-hyperlink-ping&quot;&gt;ping&lt;/code&gt; attribute's value,
+  &lt;span title=&quot;split a string on spaces&quot;&gt;split that string on
   spaces&lt;/span&gt;, &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; each
-  resulting token, and then should send a request (as described below)
-  to each of the resulting &lt;span title=&quot;absolute URL&quot;&gt;absolute
-  URLs&lt;/span&gt;. (Tokens that fail to resolve are ignored.) This may be
-  done in parallel with the primary request, and is independent of the
-  result of that request.&lt;/p&gt;
+  resulting token relative to the hyperlink element, and then should
+  send a request (as described below) to each of the resulting &lt;span
+  title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/span&gt;. (Tokens that fail to
+  resolve are ignored.) This may be done in parallel with the primary
+  request, and is independent of the result of that request.&lt;/p&gt;
 
   &lt;p&gt;User agents should allow the user to adjust this behavior, for
   example in conjunction with a setting that disables the sending of
@@ -50526,20 +50603,23 @@
   title=&quot;dom-RemoteEventTarget-addEventSource&quot;&gt;&lt;code&gt;addEventSource(&lt;var
   title=&quot;&quot;&gt;src&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, the user agent
   must &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the &lt;span&gt;URL&lt;/span&gt;
-  specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, and if that succeeds, add the resulting &lt;span&gt;absolute URL&lt;/span&gt;
-  to the &lt;span title=&quot;concept-eventsource-list&quot;&gt;list of event
-  sources&lt;/span&gt; for that object. The same URL can be registered
-  multiple times. If the URL fails to resolve, then the user agent
-  must raise a &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception.&lt;/p&gt;
+  specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, relative to the &lt;span&gt;current
+  script base URL&lt;/span&gt;, and if that succeeds, add the resulting
+  &lt;span&gt;absolute URL&lt;/span&gt; to the &lt;span
+  title=&quot;concept-eventsource-list&quot;&gt;list of event sources&lt;/span&gt; for
+  that object. The same URL can be registered multiple times. If the
+  URL fails to resolve, then the user agent must raise a
+  &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception.&lt;/p&gt;
 
   &lt;p&gt;When the &lt;dfn
   title=&quot;dom-RemoteEventTarget-removeEventSource&quot;&gt;&lt;code&gt;removeEventSource(&lt;var
   title=&quot;&quot;&gt;src&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, the user agent
   must &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the &lt;span&gt;URL&lt;/span&gt;
-  specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, and if that succeeds, remove
-  the resulting &lt;span&gt;absolute URL&lt;/span&gt; from the &lt;span
+  specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, relative to the &lt;span&gt;current
+  script base URL&lt;/span&gt;, and if that succeeds, remove the resulting
+  &lt;span&gt;absolute URL&lt;/span&gt; from the &lt;span
   title=&quot;concept-eventsource-list&quot;&gt;list of event sources&lt;/span&gt; for
-  that object.  If the same URL has been registered multiple times,
+  that object. If the same URL has been registered multiple times,
   removing it must remove only one instance of that URL for each
   invocation of the &lt;code
   title=&quot;removeEventSource&quot;&gt;removeEventSource()&lt;/code&gt; method. If the
@@ -52226,9 +52306,9 @@
    &lt;li&gt;
 
     &lt;p&gt;If the value of the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument
-    is not a single U+002A ASTERISK character (&quot;*&quot;), and either &lt;span
-    title=&quot;parse a url&quot;&gt;parsing&lt;/span&gt; it as a &lt;span&gt;URL&lt;/span&gt; fails,
-    or &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; it results in a
+    is not a single U+002A ASTERISK character (&quot;*&quot;), and &lt;span
+    title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; it relative to the
+    &lt;span&gt;current script base URL&lt;/span&gt; either fails or results in a
     &lt;span&gt;URL&lt;/span&gt; with a &lt;code
     title=&quot;url-host-specific&quot;&gt;&lt;host-specific&gt;&lt;/code&gt; component
     that is neither empty nor a single U+002F SOLIDUS character (/),
@@ -52319,9 +52399,9 @@
    &lt;li&gt;
 
     &lt;p&gt;If the value of the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument
-    is not a single U+002A ASTERISK character (&quot;*&quot;), and either &lt;span
-    title=&quot;parse a url&quot;&gt;parsing&lt;/span&gt; it as a &lt;span&gt;URL&lt;/span&gt; fails,
-    or &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; it results in a
+    is not a single U+002A ASTERISK character (&quot;*&quot;), and &lt;span
+    title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; it relative to the
+    &lt;span&gt;current script base URL&lt;/span&gt; either fails or results in a
     &lt;span&gt;URL&lt;/span&gt; with a &lt;code
     title=&quot;url-host-specific&quot;&gt;&lt;host-specific&gt;&lt;/code&gt; component
     that is neither empty nor a single U+002F SOLIDUS character (/),
@@ -56940,10 +57020,11 @@
 
     &lt;p id=&quot;parser-appcache&quot;&gt;If the &lt;code&gt;Document&lt;/code&gt; is being
     loaded as part of &lt;span title=&quot;navigate&quot;&gt;navigation&lt;/span&gt; of a
-    &lt;span&gt;browsing context&lt;/span&gt;, then: if the token has an attribute
-    &quot;manifest&quot;, then &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the
-    value of that attribute to an &lt;span&gt;absolute URL&lt;/span&gt;, and if
-    that is successful, run the &lt;span
+    &lt;span&gt;browsing context&lt;/span&gt;, then: if the newly created element
+    has a &lt;code title=&quot;attr-html-manifest&quot;&gt;manifest&lt;/code&gt; attribute,
+    then &lt;span title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the value of that
+    attribute to an &lt;span&gt;absolute URL&lt;/span&gt;, relative to the newly
+    created element, and if that is successful, run the &lt;span
     title=&quot;concept-appcache-init&quot;&gt;application cache selection
     algorithm&lt;/span&gt; with the resulting &lt;span&gt;absolute URL&lt;/span&gt;;
     otherwise, if there is no such attribute or resolving it fails,


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009592.html">[html5] r2708 - [c] (0) I missed a few non-characters. Not sure how	I missed these. (credit: w)
</A></li>
	<LI>Next message: <A HREF="009594.html">[html5] r2710 - [] (0) Change the document's address when	document.open() is invoked to match th [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9593">[ date ]</a>
              <a href="thread.html#9593">[ thread ]</a>
              <a href="subject.html#9593">[ subject ]</a>
              <a href="author.html#9593">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
