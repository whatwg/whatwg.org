<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r2962 - [] (0) &lt;datagrid&gt; mark II, first draft
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2962%20-%20%5B%5D%20%280%29%20%3Cdatagrid%3E%20mark%20II%2C%20first%20draft&In-Reply-To=%3C20090418011653.3877A138AB5%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009843.html">
   <LINK REL="Next"  HREF="009845.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r2962 - [] (0) &lt;datagrid&gt; mark II, first draft</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2962%20-%20%5B%5D%20%280%29%20%3Cdatagrid%3E%20mark%20II%2C%20first%20draft&In-Reply-To=%3C20090418011653.3877A138AB5%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r2962 - [] (0) &lt;datagrid&gt; mark II, first draft">whatwg at whatwg.org
       </A><BR>
    <I>Fri Apr 17 18:16:53 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009843.html">[html5] r2961 - [e] (0) Add keygen to the void element list;	make those element lists alphabetic [...]
</A></li>
        <LI>Next message: <A HREF="009845.html">[html5] r2963 - [e] (0) Typos: round 1.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9844">[ date ]</a>
              <a href="thread.html#9844">[ thread ]</a>
              <a href="subject.html#9844">[ subject ]</a>
              <a href="author.html#9844">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-04-17 18:16:51 -0700 (Fri, 17 Apr 2009)
New Revision: 2962

Modified:
   index
   source
Log:
[] (0) &lt;datagrid&gt; mark II, first draft

Modified: index
===================================================================
--- index	2009-04-08 06:11:13 UTC (rev 2961)
+++ index	2009-04-18 01:16:51 UTC (rev 2962)
@@ -39,7 +39,7 @@
   &lt;div class=head&gt;
    &lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;h1&gt;HTML 5&lt;/h1&gt;
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 8 April 2009&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 18 April 2009&lt;/h2&gt;
    &lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;dl&gt;&lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -615,18 +615,18 @@
      &lt;li&gt;&lt;a href=#the-details-element&gt;&lt;span class=secno&gt;4.11.1 &lt;/span&gt;The &lt;code&gt;details&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#datagrid&gt;&lt;span class=secno&gt;4.11.2 &lt;/span&gt;The &lt;code&gt;datagrid&lt;/code&gt; element&lt;/a&gt;
       &lt;ol&gt;
-       &lt;li&gt;&lt;a href=#the-datagrid-data-model&gt;&lt;span class=secno&gt;4.11.2.1 &lt;/span&gt;The &lt;code&gt;datagrid&lt;/code&gt; data model&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#how-rows-are-identified&gt;&lt;span class=secno&gt;4.11.2.2 &lt;/span&gt;How rows are identified&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#the-data-provider-interface&gt;&lt;span class=secno&gt;4.11.2.3 &lt;/span&gt;The data provider interface&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#the-default-data-provider&gt;&lt;span class=secno&gt;4.11.2.4 &lt;/span&gt;The default data provider&lt;/a&gt;
+       &lt;li&gt;&lt;a href=#introduction-1&gt;&lt;span class=secno&gt;4.11.2.1 &lt;/span&gt;Introduction&lt;/a&gt;
         &lt;ol&gt;
-         &lt;li&gt;&lt;a href=#commonDefaultDataGridMethodDefinitions&gt;&lt;span class=secno&gt;4.11.2.4.1 &lt;/span&gt;Common default data
-  provider method definitions for cells&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#populating-the-datagrid-element&gt;&lt;span class=secno&gt;4.11.2.5 &lt;/span&gt;Populating the &lt;code&gt;datagrid&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#updating-the-datagrid&gt;&lt;span class=secno&gt;4.11.2.6 &lt;/span&gt;Updating the &lt;code&gt;datagrid&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#requirements-for-interactive-user-agents&gt;&lt;span class=secno&gt;4.11.2.7 &lt;/span&gt;Requirements for interactive user agents&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#the-selection&gt;&lt;span class=secno&gt;4.11.2.8 &lt;/span&gt;The selection&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#columns-and-captions&gt;&lt;span class=secno&gt;4.11.2.9 &lt;/span&gt;Columns and captions&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#example:-a-datagrid-backed-by-a-static-table-element&gt;&lt;span class=secno&gt;4.11.2.1.1 &lt;/span&gt;Example: a &lt;code&gt;datagrid&lt;/code&gt; backed by a static &lt;code&gt;table&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#example:-a-datagrid-backed-by-nested-ol-elements&gt;&lt;span class=secno&gt;4.11.2.1.2 &lt;/span&gt;Example: a &lt;code&gt;datagrid&lt;/code&gt; backed by nested &lt;code&gt;ol&lt;/code&gt; elements&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#example:-a-datagrid-backed-by-a-server&gt;&lt;span class=secno&gt;4.11.2.1.3 &lt;/span&gt;Example: a &lt;code&gt;datagrid&lt;/code&gt; backed by a server&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#populating-the-datagrid&gt;&lt;span class=secno&gt;4.11.2.2 &lt;/span&gt;Populating the &lt;code&gt;datagrid&lt;/code&gt;&lt;/a&gt;
+        &lt;ol&gt;
+         &lt;li&gt;&lt;a href=#the-listener&gt;&lt;span class=secno&gt;4.11.2.2.1 &lt;/span&gt;The listener&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#the-columns&gt;&lt;span class=secno&gt;4.11.2.2.2 &lt;/span&gt;The columns&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#the-rows&gt;&lt;span class=secno&gt;4.11.2.2.3 &lt;/span&gt;The rows&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#the-cells&gt;&lt;span class=secno&gt;4.11.2.2.4 &lt;/span&gt;The cells&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#listening-to-notifications-from-the-datagrid&gt;&lt;span class=secno&gt;4.11.2.3 &lt;/span&gt;Listening to notifications from the &lt;code&gt;datagrid&lt;/code&gt;&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-command&gt;&lt;span class=secno&gt;4.11.3 &lt;/span&gt;The &lt;code&gt;command&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-bb-element&gt;&lt;span class=secno&gt;4.11.4 &lt;/span&gt;The &lt;code&gt;bb&lt;/code&gt; element&lt;/a&gt;
       &lt;ol&gt;
@@ -681,7 +681,7 @@
      &lt;li&gt;&lt;a href=#relaxing-the-same-origin-restriction&gt;&lt;span class=secno&gt;5.4.1 &lt;/span&gt;Relaxing the same-origin restriction&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#scripting&gt;&lt;span class=secno&gt;5.5 &lt;/span&gt;Scripting&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-1&gt;&lt;span class=secno&gt;5.5.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-2&gt;&lt;span class=secno&gt;5.5.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#enabling-and-disabling-scripting&gt;&lt;span class=secno&gt;5.5.2 &lt;/span&gt;Enabling and disabling scripting&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#processing-model-1&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Processing model&lt;/a&gt;
       &lt;ol&gt;
@@ -717,7 +717,7 @@
      &lt;li&gt;&lt;a href=#manually-releasing-the-storage-mutex&gt;&lt;span class=secno&gt;5.7.3 &lt;/span&gt;Manually releasing the storage mutex&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#offline&gt;&lt;span class=secno&gt;5.8 &lt;/span&gt;Offline Web applications&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-2&gt;&lt;span class=secno&gt;5.8.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-3&gt;&lt;span class=secno&gt;5.8.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#appcache&gt;&lt;span class=secno&gt;5.8.2 &lt;/span&gt;Application caches&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#manifests&gt;&lt;span class=secno&gt;5.8.3 &lt;/span&gt;The cache manifest syntax&lt;/a&gt;
       &lt;ol&gt;
@@ -812,7 +812,7 @@
    &lt;li&gt;&lt;a href=#spelling-and-grammar-checking&gt;&lt;span class=secno&gt;6.8 &lt;/span&gt;Spelling and grammar checking&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#dnd&gt;&lt;span class=secno&gt;6.9 &lt;/span&gt;Drag and drop&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-3&gt;&lt;span class=secno&gt;6.9.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-4&gt;&lt;span class=secno&gt;6.9.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-dragevent-and-datatransfer-interfaces&gt;&lt;span class=secno&gt;6.9.2 &lt;/span&gt;The &lt;code&gt;DragEvent&lt;/code&gt; and &lt;code&gt;DataTransfer&lt;/code&gt; interfaces&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#events-fired-during-a-drag-and-drop-action&gt;&lt;span class=secno&gt;6.9.3 &lt;/span&gt;Events fired during a drag-and-drop action&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#drag-and-drop-processing-model&gt;&lt;span class=secno&gt;6.9.4 &lt;/span&gt;Drag-and-drop processing model&lt;/a&gt;
@@ -831,7 +831,7 @@
      &lt;li&gt;&lt;a href=#security-risks-in-the-drag-and-drop-model&gt;&lt;span class=secno&gt;6.9.7 &lt;/span&gt;Security risks in the drag-and-drop model&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#undo&gt;&lt;span class=secno&gt;6.10 &lt;/span&gt;Undo history&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-4&gt;&lt;span class=secno&gt;6.10.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-5&gt;&lt;span class=secno&gt;6.10.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#definitions-2&gt;&lt;span class=secno&gt;6.10.2 &lt;/span&gt;Definitions&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-undomanager-interface&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;The &lt;code&gt;UndoManager&lt;/code&gt; interface&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#undo:-moving-back-in-the-undo-transaction-history&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;Undo: moving back in the undo transaction history&lt;/a&gt;&lt;/li&gt;
@@ -844,7 +844,7 @@
    &lt;li&gt;&lt;a href=#event-definitions&gt;&lt;span class=secno&gt;7.1 &lt;/span&gt;Event definitions&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#crossDocumentMessages&gt;&lt;span class=secno&gt;7.2 &lt;/span&gt;Cross-document messaging&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-5&gt;&lt;span class=secno&gt;7.2.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-6&gt;&lt;span class=secno&gt;7.2.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#security-4&gt;&lt;span class=secno&gt;7.2.2 &lt;/span&gt;Security&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#authors&gt;&lt;span class=secno&gt;7.2.2.1 &lt;/span&gt;Authors&lt;/a&gt;&lt;/li&gt;
@@ -853,7 +853,7 @@
      &lt;li&gt;&lt;a href=#posting-messages-with-message-ports&gt;&lt;span class=secno&gt;7.2.4 &lt;/span&gt;Posting messages with message ports&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#channel-messaging&gt;&lt;span class=secno&gt;7.3 &lt;/span&gt;Channel messaging&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-6&gt;&lt;span class=secno&gt;7.3.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-7&gt;&lt;span class=secno&gt;7.3.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#message-channels&gt;&lt;span class=secno&gt;7.3.2 &lt;/span&gt;Message channels&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#message-ports&gt;&lt;span class=secno&gt;7.3.3 &lt;/span&gt;Message ports&lt;/a&gt;
       &lt;ol&gt;
@@ -972,10 +972,10 @@
    &lt;li&gt;&lt;a href=#parsing-xhtml-fragments&gt;&lt;span class=secno&gt;9.4 &lt;/span&gt;Parsing XHTML fragments&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#rendering&gt;&lt;span class=secno&gt;10 &lt;/span&gt;Rendering&lt;/a&gt;
   &lt;ol&gt;
-   &lt;li&gt;&lt;a href=#introduction-7&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#introduction-8&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#the-css-user-agent-style-sheet-and-presentational-hints&gt;&lt;span class=secno&gt;10.2 &lt;/span&gt;The CSS user agent style sheet and presentational hints&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-8&gt;&lt;span class=secno&gt;10.2.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-9&gt;&lt;span class=secno&gt;10.2.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#display-types&gt;&lt;span class=secno&gt;10.2.2 &lt;/span&gt;Display types&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#margins-and-padding&gt;&lt;span class=secno&gt;10.2.3 &lt;/span&gt;Margins and padding&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#alignment&gt;&lt;span class=secno&gt;10.2.4 &lt;/span&gt;Alignment&lt;/a&gt;&lt;/li&gt;
@@ -993,7 +993,7 @@
      &lt;li&gt;&lt;a href=#tool-bars-0&gt;&lt;span class=secno&gt;10.3.5 &lt;/span&gt;Tool bars&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#bindings&gt;&lt;span class=secno&gt;10.4 &lt;/span&gt;Bindings&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-9&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-10&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-bb-element-0&gt;&lt;span class=secno&gt;10.4.2 &lt;/span&gt;The &lt;code&gt;bb&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-button-element-0&gt;&lt;span class=secno&gt;10.4.3 &lt;/span&gt;The &lt;code&gt;button&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-datagrid-element&gt;&lt;span class=secno&gt;10.4.4 &lt;/span&gt;The &lt;code&gt;datagrid&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
@@ -6253,13 +6253,6 @@
   to an underlying string that consists of an &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;unordered set of
   unique space-separated tokens&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Which string underlies a particular &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt;
-  object is defined when the object is created. It might be a content
-  attribute (e.g. the string that underlies the &lt;code title=dom-classList&gt;&lt;a href=#dom-classlist&gt;classList&lt;/a&gt;&lt;/code&gt; object is the &lt;code title=attr-class&gt;&lt;a href=#classes&gt;class&lt;/a&gt;&lt;/code&gt; attribute), or it might be an
-  anonymous string (e.g. when a &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object is
-  passed to an author-implemented callback in the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; APIs).&lt;/p&gt;
-
   &lt;pre class=idl&gt;[&lt;a href=#dom-tokenlist-tostring title=dom-tokenlist-toString&gt;Stringifies&lt;/a&gt;] interface &lt;dfn id=domtokenlist-0&gt;DOMTokenList&lt;/dfn&gt; {
   readonly attribute unsigned long &lt;a href=#dom-tokenlist-length title=dom-tokenlist-length&gt;length&lt;/a&gt;;
   [IndexGetter] DOMString &lt;a href=#dom-tokenlist-item title=dom-tokenlist-item&gt;item&lt;/a&gt;(in unsigned long index);
@@ -6669,7 +6662,7 @@
    &lt;li value=20&gt;&lt;dfn id=abort_err&gt;&lt;code&gt;ABORT_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually in XHR for now --&gt;
    &lt;li value=21&gt;&lt;dfn id=url_mismatch_err&gt;&lt;code&gt;URL_MISMATCH_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually in workers for now --&gt;
    &lt;li value=22&gt;&lt;dfn id=quota_exceeded_err&gt;&lt;code&gt;QUOTA_EXCEEDED_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined right here for now --&gt;
-   &lt;li value=23&gt;&lt;dfn id=unavailable_script_err&gt;&lt;code&gt;UNAVAILABLE_SCRIPT_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined right here for now --&gt;
+   &lt;li value=23&gt;&lt;dfn id=datagrid_model_err&gt;&lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined right here for now --&gt;
    &lt;li value=81&gt;&lt;dfn id=parse_err&gt;&lt;code&gt;PARSE_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined in dom3ls --&gt;
    &lt;li value=82&gt;&lt;dfn id=serialise_err&gt;&lt;code&gt;SERIALISE_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined in dom3ls --&gt;
   &lt;/ol&gt;&lt;div class=impl&gt;
@@ -15342,7 +15335,7 @@
   &lt;ul class=brief&gt;&lt;li&gt;minimum value &le; actual value &le; maximum value&lt;/li&gt;
    &lt;li&gt;minimum value &le; low boundary &le; high boundary &le; maximum value&lt;/li&gt;
    &lt;li&gt;minimum value &le; optimum point &le; maximum value&lt;/li&gt;
-  &lt;/ul&gt;&lt;p&gt;&lt;strong&gt;UA requirements for regions of the gauge&lt;/strong&gt;: If the
+  &lt;/ul&gt;&lt;!-- next two paragraphs are duplicated in the &lt;datagrid&gt; section --&gt;&lt;p&gt;&lt;strong&gt;UA requirements for regions of the gauge&lt;/strong&gt;: If the
   optimum point is equal to the low boundary or the high boundary, or
   anywhere in between them, then the region between the low and high
   boundaries of the gauge must be treated as the optimum region, and
@@ -16624,7 +16617,7 @@
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; must not be used as a layout tool. In
   particular, &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; elements should not be used to display
-  fully transparent images, as they rarely convey meaning and rarely
+   transparent images, as they rarely convey meaning and rarely
   add anything useful to the document.&lt;/p&gt;
 
   &lt;div class=impl&gt;
@@ -26191,15 +26184,15 @@
   have explicit keywords:&lt;/p&gt;
 
   &lt;dl&gt;&lt;dt&gt;The &lt;dfn id=attr-th-scope-row title=attr-th-scope-row&gt;&lt;code&gt;row&lt;/code&gt;&lt;/dfn&gt;
-   keyword, which maps to the &lt;i&gt;row&lt;/i&gt; state&lt;/dt&gt;
+   keyword, which maps to the &lt;i&gt;&lt;a href=#row&gt;row&lt;/a&gt;&lt;/i&gt; state&lt;/dt&gt;
 
-   &lt;dd&gt;The &lt;i&gt;row&lt;/i&gt; state means the header cell applies to some of
+   &lt;dd&gt;The &lt;i&gt;&lt;a href=#row&gt;row&lt;/a&gt;&lt;/i&gt; state means the header cell applies to some of
    the subsequent cells in the same row(s).&lt;/dd&gt;
 
    &lt;dt&gt;The &lt;dfn id=attr-th-scope-col title=attr-th-scope-col&gt;&lt;code&gt;col&lt;/code&gt;&lt;/dfn&gt;
-   keyword, which maps to the &lt;i&gt;column&lt;/i&gt; state&lt;/dt&gt;
+   keyword, which maps to the &lt;i&gt;&lt;a href=#column&gt;column&lt;/a&gt;&lt;/i&gt; state&lt;/dt&gt;
 
-   &lt;dd&gt;The &lt;i&gt;column&lt;/i&gt; state means the header cell applies to some
+   &lt;dd&gt;The &lt;i&gt;&lt;a href=#column&gt;column&lt;/a&gt;&lt;/i&gt; state means the header cell applies to some
    of the subsequent cells in the same column(s).&lt;/dd&gt;
 
    &lt;dt&gt;The &lt;dfn id=attr-th-scope-rowgroup title=attr-th-scope-rowgroup&gt;&lt;code&gt;rowgroup&lt;/code&gt;&lt;/dfn&gt; keyword,
@@ -31816,25 +31809,22 @@
   &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element, then there is no &lt;a href=#concept-input-list title=concept-input-list&gt;suggestions source element&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;If there is a &lt;a href=#concept-input-list title=concept-input-list&gt;suggestions source
-  element&lt;/a&gt;, then each &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element that is a
-  descendant of the &lt;a href=#concept-input-list title=concept-input-list&gt;suggestions
-  source element&lt;/a&gt;, that is not &lt;a href=#concept-option-disabled title=concept-option-disabled&gt;disabled&lt;/a&gt;, and whose &lt;a href=#concept-option-value title=concept-option-value&gt;value&lt;/a&gt; is a string that isn't the
-  empty string and that the user would be allowed to enter as the
-  &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#concept-fe-value title=concept-fe-value&gt;value&lt;/a&gt;, represents a suggestion. Each
-  suggestion has a &lt;a href=#concept-option-value title=concept-option-value&gt;value&lt;/a&gt; and
-  a &lt;a href=#concept-option-label title=concept-option-label&gt;label&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When the user agent is allowing the user to edit the
-  &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#concept-fe-value title=concept-fe-value&gt;value&lt;/a&gt;, the user agent should offer
-  the suggestions to the user in a manner suitable for the type of
-  control used. The user agent may use the suggestion's &lt;a href=#concept-option-label title=concept-option-label&gt;label&lt;/a&gt; to identify the suggestion
+  element&lt;/a&gt;, then, when the user agent is allowing the user to
+  edit the &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#concept-fe-value title=concept-fe-value&gt;value&lt;/a&gt;, the user agent should offer
+  the suggestions represented by the &lt;a href=#concept-input-list title=concept-input-list&gt;suggestions source element&lt;/a&gt; to the
+  user in a manner suitable for the type of control used. The user
+  agent may use the suggestion's &lt;a href=#concept-option-label title=concept-option-label&gt;label&lt;/a&gt; to identify the suggestion
   if appropriate. If the user selects a suggestion, then the
   &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#concept-fe-value title=concept-fe-value&gt;value&lt;/a&gt; must be set to the selected
   suggestion's &lt;a href=#concept-option-value title=concept-option-value&gt;value&lt;/a&gt;, as if
   the user had written that value himself.&lt;/p&gt;
 
-  &lt;p&gt;User agents should filter the suggestions to hide suggestions
-  that would cause the element to not &lt;a href=#concept-fv-valid title=concept-fv-valid&gt;satisfy its constraints&lt;/a&gt;.&lt;/p&gt;
+  &lt;p&gt;User agents must filter the suggestions to hide suggestiosn that
+  the user would not be allowed to enter as the &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt;
+  element's &lt;a href=#concept-fe-value title=concept-fe-value&gt;value&lt;/a&gt;, and should
+  filter the suggestions to hide suggestions that would cause the
+  element to not &lt;a href=#concept-fv-valid title=concept-fv-valid&gt;satisfy its
+  constraints&lt;/a&gt;.&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;If the &lt;code title=attr-input-list&gt;&lt;a href=#attr-input-list&gt;list&lt;/a&gt;&lt;/code&gt; attribute does
   not apply, there is no &lt;a href=#concept-input-list title=concept-input-list&gt;suggestions
@@ -33001,8 +32991,14 @@
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element is hooked up to an
   &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element using the &lt;code title=attr-input-list&gt;&lt;a href=#attr-input-list&gt;list&lt;/a&gt;&lt;/code&gt; attribute on the
-  &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+  &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element. The &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element can
+  also be used with a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element, as the source of
+  autocompletion hints for &lt;code title=datagrid-type-editable&gt;&lt;a href=#datagrid-type-editable&gt;editable&lt;/a&gt;&lt;/code&gt; cells.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element that is a descendant of the
+  &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element, that is not &lt;a href=#concept-option-disabled title=concept-option-disabled&gt;disabled&lt;/a&gt;, and whose &lt;a href=#concept-option-value title=concept-option-value&gt;value&lt;/a&gt; is a string that isn't the
+  empty string, represents a suggestion. Each suggestion has a &lt;a href=#concept-option-value title=concept-option-value&gt;value&lt;/a&gt; and a &lt;a href=#concept-option-label title=concept-option-label&gt;label&lt;/a&gt;.
+
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;datalist&lt;/var&gt; . &lt;code title=dom-datalist-options&gt;&lt;a href=#dom-datalist-options&gt;options&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -35617,11 +35613,8 @@
 
 
 
-&lt;div class=bad&gt;
   &lt;h4 id=datagrid&gt;&lt;span class=secno&gt;4.11.2 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;datagrid&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
-&lt;p class=XXX&gt;The API here needs rewriting. Don't implement this right now.&lt;/p&gt;
-
   &lt;dl class=element&gt;&lt;dt&gt;Categories&lt;/dt&gt;
    &lt;dd&gt;&lt;a href=#flow-content-0&gt;Flow content&lt;/a&gt;.&lt;/dd&gt;
    &lt;dd&gt;&lt;a href=#interactive-content-0&gt;Interactive content&lt;/a&gt;.&lt;/dd&gt;
@@ -35636,55 +35629,102 @@
    &lt;dd&gt;Or: A single &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element.&lt;/dd&gt;
    &lt;dt&gt;Content attributes:&lt;/dt&gt;
    &lt;dd&gt;&lt;a href=#global-attributes&gt;Global attributes&lt;/a&gt;&lt;/dd&gt;
-   &lt;dd&gt;&lt;code title=attr-datagrid-multiple&gt;&lt;a href=#attr-datagrid-multiple&gt;multiple&lt;/a&gt;&lt;/code&gt;&lt;/dd&gt;
+&lt;!--v2DGS:
+   &lt;dd&gt;&lt;code title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt;&lt;/dd&gt;
+--&gt;
    &lt;dd&gt;&lt;code title=attr-datagrid-disabled&gt;&lt;a href=#attr-datagrid-disabled&gt;disabled&lt;/a&gt;&lt;/code&gt;&lt;/dd&gt;
    &lt;dt&gt;DOM interface:&lt;/dt&gt;
    &lt;dd&gt;
 &lt;pre class=idl&gt;interface &lt;dfn id=htmldatagridelement&gt;HTMLDataGridElement&lt;/dfn&gt; : &lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt; {
-           attribute &lt;a href=#datagriddataprovider&gt;DataGridDataProvider&lt;/a&gt; &lt;a href=#dom-datagrid-data title=dom-datagrid-data&gt;data&lt;/a&gt;;
-  readonly attribute &lt;a href=#datagridselection&gt;DataGridSelection&lt;/a&gt; &lt;a href=#dom-datagrid-selection title=dom-datagrid-selection&gt;selection&lt;/a&gt;;
            attribute boolean &lt;a href=#dom-datagrid-multiple title=dom-datagrid-multiple&gt;multiple&lt;/a&gt;;
            attribute boolean &lt;a href=#dom-datagrid-disabled title=dom-datagrid-disabled&gt;disabled&lt;/a&gt;;
-  void &lt;a href=#dom-datagrid-updateeverything title=dom-datagrid-updateEverything&gt;updateEverything&lt;/a&gt;();
-  void &lt;a href=#dom-datagrid-updaterowschanged title=dom-datagrid-updateRowsChanged&gt;updateRowsChanged&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long count);
-  void &lt;a href=#dom-datagrid-updaterowsinserted title=dom-datagrid-updateRowsInserted&gt;updateRowsInserted&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long count);
-  void &lt;a href=#dom-datagrid-updaterowsremoved title=dom-datagrid-updateRowsRemoved&gt;updateRowsRemoved&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long count);
-  void &lt;a href=#dom-datagrid-updaterowchanged title=dom-datagrid-updateRowChanged&gt;updateRowChanged&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row);
-  void &lt;a href=#dom-datagrid-updatecolumnchanged title=dom-datagrid-updateColumnChanged&gt;updateColumnChanged&lt;/a&gt;(in unsigned long column);
-  void &lt;a href=#dom-datagrid-updatecellchanged title=dom-datagrid-updateCellChanged&gt;updateCellChanged&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long column);
+           attribute &lt;a href=#datagridlistener&gt;DataGridListener&lt;/a&gt; &lt;a href=#dom-datagrid-listener title=dom-datagrid-listener&gt;listener&lt;/a&gt;;
+&lt;!-- v2DGS:
+  readonly attribute &lt;span&gt;DataGridSelection&lt;/span&gt; &lt;span title=&quot;dom-datagrid-selection&quot;&gt;selection&lt;/span&gt;;
+--&gt;
+  // columns
+  void &lt;a href=#dom-datagrid-addcolumn title=dom-datagrid-addColumn&gt;addColumn&lt;/a&gt;(in &lt;a href=#column&gt;Column&lt;/a&gt; id, in DOMString label, in DOMString type, [Optional] in HTMLImageElement icon, [Optional] in boolean sortable, [Optional] in boolean visible);
+           attribute DOMString &lt;a href=#dom-datagrid-sortcolumn title=dom-datagrid-sortColumn&gt;sortColumn&lt;/a&gt;;
+           attribute boolean &lt;a href=#dom-datagrid-sortascending title=dom-datagrid-sortAscending&gt;sortAscending&lt;/a&gt;;
+  void &lt;a href=#dom-datagrid-clearcolumns title=dom-datagrid-clearColumns&gt;clearColumns&lt;/a&gt;();
+
+  // rows
+  void &lt;a href=#dom-datagrid-renotify title=dom-datagrid-renotify&gt;renotify&lt;/a&gt;();
+  void &lt;a href=#dom-datagrid-setrowcount title=dom-datagrid-setRowCount&gt;setRowCount&lt;/a&gt;(in long childCount, in long rowCount);
+  void &lt;a href=#dom-datagrid-setrows title=dom-datagrid-setRows&gt;setRows&lt;/a&gt;(in &lt;a href=#rowlist&gt;RowList&lt;/a&gt; rows);
+  void &lt;a href=#dom-datagrid-insertrows title=dom-datagrid-insertRows&gt;insertRows&lt;/a&gt;(in &lt;a href=#rowlist&gt;RowList&lt;/a&gt; rows);
+  void &lt;a href=#dom-datagrid-deleterows title=dom-datagrid-deleteRows&gt;deleteRows&lt;/a&gt;(in &lt;a href=#rowidlist&gt;RowIDList&lt;/a&gt; rows);
+  void &lt;a href=#dom-datagrid-repaint title=dom-datagrid-repaint&gt;repaint&lt;/a&gt;(in &lt;a href=#rowid&gt;RowID&lt;/a&gt; row, in DOMString column);
+  void &lt;a href=#dom-datagrid-clearrows title=dom-datagrid-clearRows&gt;clearRows&lt;/a&gt;();
+&lt;!--
+ v2: opening and closing a row
+     moving a row's actual ID
+      - imagine new mail moving a thread up; you just want to add the new mail to the thread and move the thread's first mail to the top
+      - though actually that should probably just be done using display sorting
+--&gt;
+};
+
+typedef DOMString &lt;dfn id=column&gt;Column&lt;/dfn&gt;;
+typedef sequence&lt;&lt;a href=#column&gt;Column&lt;/a&gt;&gt; &lt;dfn id=columnlist&gt;ColumnList&lt;/dfn&gt;;
+typedef sequence&lt;any&gt; &lt;dfn id=cell&gt;Cell&lt;/dfn&gt;; // &lt;a href=#column&gt;Column&lt;/a&gt;, [Variadic] any (exact types expected depend on the column type)
+typedef sequence&lt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&gt; &lt;dfn id=celllist&gt;CellList&lt;/dfn&gt;;
+typedef sequence&lt;any&gt; &lt;dfn id=row&gt;Row&lt;/dfn&gt;; // &lt;a href=#rowid&gt;RowID&lt;/a&gt;, long, long, &lt;a href=#celllist&gt;CellList&lt;/a&gt;, [Optional] boolean, [Optional] long
+typedef sequence&lt;&lt;a href=#row&gt;Row&lt;/a&gt;&gt; &lt;dfn id=rowlist&gt;RowList&lt;/dfn&gt;;
+typedef sequence&lt;unsigned long&gt; &lt;dfn id=rowid&gt;RowID&lt;/dfn&gt;;
+typedef sequence&lt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&gt; &lt;dfn id=rowidlist&gt;RowIDList&lt;/dfn&gt;;
+
+[Callback=FunctionOnly, NoInterfaceObject]
+interface &lt;dfn id=renderingcontext2dcallback&gt;RenderingContext2DCallback&lt;/dfn&gt; {
+  DOMString &lt;span title=dom-Rendering2DContextCallback-handleEvent&gt;handleEvent&lt;/span&gt;(in &lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt; context, in unsigned long width, in unsigned long height);
 };&lt;/pre&gt;
    &lt;/dd&gt;
-  &lt;/dl&gt;&lt;p class=XXX&gt;One possible thing to be added is a way to
-  detect when a row/selection has been deleted, activated, etc, by the
-  user (delete key, enter key, etc).&lt;/p&gt; &lt;!-- XXXPA --&gt;
+  &lt;/dl&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element &lt;a href=#represents&gt;represents&lt;/a&gt; an
+  interactive representation of tree, list, or tabular data.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element &lt;a href=#represents&gt;represents&lt;/a&gt; an interactive
-  representation of tree, list, or tabular data.&lt;/p&gt;
+  &lt;p&gt;The data being presented is provided by script using the methods
+  described in the following sections.&lt;/p&gt;
 
-  &lt;p&gt;The data being presented can come either from the content, as
-  elements given as children of the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element, or
-  from a scripted data provider given by the &lt;code title=dom-datagrid-data&gt;&lt;a href=#dom-datagrid-data&gt;data&lt;/a&gt;&lt;/code&gt; DOM attribute.&lt;/p&gt;
+&lt;!--v2DGS:
+  &lt;p&gt;The &lt;dfn
+  title=&quot;attr-datagrid-multiple&quot;&gt;&lt;code&gt;multiple&lt;/code&gt;&lt;/dfn&gt; attribute
+  is a &lt;span&gt;boolean attribute&lt;/span&gt;. When set, it indicates that the
+  user can select more than one row at a time.&lt;/p&gt;
+--&gt;
 
-  &lt;p&gt;The &lt;code title=attr-datagrid-multiple&gt;&lt;a href=#attr-datagrid-multiple&gt;multiple&lt;/a&gt;&lt;/code&gt; and
-  &lt;code title=attr-datagrid-disabled&gt;&lt;a href=#attr-datagrid-disabled&gt;disabled&lt;/a&gt;&lt;/code&gt; attributes are
-  &lt;a href=#boolean-attribute title=&quot;boolean attribute&quot;&gt;boolean attributes&lt;/a&gt;. Their
-  effects are described in the processing model sections below.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=attr-datagrid-disabled title=attr-datagrid-disabled&gt;&lt;code&gt;disabled&lt;/code&gt;&lt;/dfn&gt; attribute
+  is a &lt;a href=#boolean-attribute&gt;boolean attribute&lt;/a&gt; used to disable the
+  control. &lt;span class=impl&gt;When the attribute is set, the user
+  agent must disable the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, preventing the user
+  from interacting with it. The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element should
+  still continue to update itself when the underlying data changes,
+  though, as described in the next few sections. However, conformance
+  requirements stating that &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; elements must react
+  to users in particular ways do not apply when one is
+  disabled.&lt;/span&gt;&lt;/p&gt;
 
+  &lt;div class=impl&gt;
+
   &lt;p&gt;The &lt;dfn id=dom-datagrid-multiple title=dom-datagrid-multiple&gt;&lt;code&gt;multiple&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn id=dom-datagrid-disabled title=dom-datagrid-disabled&gt;&lt;code&gt;disabled&lt;/code&gt;&lt;/dfn&gt; DOM
-  attributes must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-datagrid-multiple&gt;&lt;a href=#attr-datagrid-multiple&gt;multiple&lt;/a&gt;&lt;/code&gt; and &lt;code title=attr-datagrid-disabled&gt;&lt;a href=#attr-datagrid-disabled&gt;disabled&lt;/a&gt;&lt;/code&gt; content attributes
+  attributes must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-datagrid-multiple&gt;multiple&lt;/code&gt; and &lt;code title=attr-datagrid-disabled&gt;&lt;a href=#attr-datagrid-disabled&gt;disabled&lt;/a&gt;&lt;/code&gt; content attributes
   respectively.&lt;/p&gt;
 
+  &lt;/div&gt;
 
-  &lt;h5 id=the-datagrid-data-model&gt;&lt;span class=secno&gt;4.11.2.1 &lt;/span&gt;The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; data model&lt;/h5&gt;
+  &lt;!-- v2DGPA: One possible thing to be added is a way to detect when a
+  row/selection has been deleted, activated, etc, by the user (delete
+  key, enter key, etc). (v2DGPA = &lt;datagrid&gt; Perform Action) --&gt;
 
+
+  &lt;h5 id=introduction-1&gt;&lt;span class=secno&gt;4.11.2.1 &lt;/span&gt;Introduction&lt;/h5&gt;
+
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
 
   &lt;p&gt;In the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; data model, data is structured as a
   set of rows representing a tree, each row being split into a number
   of columns. The columns are always present in the data model,
-  although individual columns may be hidden in the presentation.&lt;/p&gt;
+  although individual columns might be hidden in the presentation.&lt;/p&gt;
 
-  &lt;p&gt;Each row can have child rows. Child rows may be hidden or
+  &lt;hr&gt;&lt;p&gt;Each row can have child rows. Child rows may be hidden or
   shown, by closing or opening (respectively) the parent row.&lt;/p&gt;
 
   &lt;p&gt;Rows are referred to by the path along the tree that one would
@@ -35694,1540 +35734,2177 @@
   is row &quot;0,1&quot;; the fourth child of the seventh child of the third
   child of the tenth row is &quot;9,2,6,3&quot;, etc.&lt;/p&gt;
 
-  &lt;p&gt;The columns can have captions. Those captions are not considered
-  a row in their own right, they are obtained separately.&lt;/p&gt;
+  &lt;p&gt;The chains of numbers that give a row's path, or identifier, are
+  represented by arrays of positions, represented in IDL by the
+  &lt;a href=#rowid&gt;RowID&lt;/a&gt; interface.&lt;/p&gt;
 
-  &lt;p&gt;Selection of data in a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; operates at the row
-  level. If the &lt;code title=attr-datagrid-multiple&gt;&lt;a href=#attr-datagrid-multiple&gt;multiple&lt;/a&gt;&lt;/code&gt;
+  &lt;p&gt;The root of the tree is represented by an empty array.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;Each column has a string that is used to identify it in the API,
+  a label that is shown to users interacting with the column, a type,
+  and optionally an icon.&lt;/p&gt;
+
+  &lt;p&gt;The possible types are as follows:&lt;/p&gt;
+
+  &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;td&gt;Keyword
+     &lt;td&gt;Description
+   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;code title=datagrid-type-text&gt;&lt;a href=#datagrid-type-text&gt;text&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt;Simple text.
+    &lt;tr&gt;&lt;td&gt;&lt;code title=datagrid-type-editable&gt;&lt;a href=#datagrid-type-editable&gt;editable&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt;Editable text.
+    &lt;tr&gt;&lt;td&gt;&lt;code title=datagrid-type-checkable&gt;&lt;a href=#datagrid-type-checkable&gt;checkable&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt;Text with a check box.
+    &lt;tr&gt;&lt;td&gt;&lt;code title=datagrid-type-list&gt;&lt;a href=#datagrid-type-list&gt;list&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt;A list of values that the user can switch between.
+    &lt;tr&gt;&lt;td&gt;&lt;code title=datagrid-type-progress&gt;&lt;a href=#datagrid-type-progress&gt;progress&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt;A progress bar.
+    &lt;tr&gt;&lt;td&gt;&lt;code title=datagrid-type-meter&gt;&lt;a href=#datagrid-type-meter&gt;meter&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt;A gauge.
+    &lt;tr&gt;&lt;td&gt;&lt;code title=datagrid-type-custom&gt;&lt;a href=#datagrid-type-custom&gt;custom&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt;A canvas onto which arbitrary content can be drawn.
+  &lt;/table&gt;&lt;p&gt;Each column can be flagged as sortable, in which case the user
+  will be able to sort the view using that column.&lt;/p&gt;
+
+  &lt;p&gt;Columns are not necessarily visible. A column can be created
+  invisible by default. The user can select which columns are to be
+  shown.&lt;/p&gt;
+
+  &lt;p&gt;When no columns have been added to the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, a
+  column with no name, whose identifier is the empty string, whose
+  type is &lt;code title=datagrid-type-text&gt;&lt;a href=#datagrid-type-text&gt;text&lt;/a&gt;&lt;/code&gt;, and which is
+  not sortable, is implied. This column is removed if any explicit
+  columns are declared.&lt;/p&gt;
+
+  &lt;p&gt;Each cell uses the type given for its column, so all cells in a
+  column present the same type of information.&lt;/p&gt;
+
+&lt;!--v2DGS:
+  &lt;p&gt;Selection of data in a &lt;code&gt;datagrid&lt;/code&gt; operates at the row
+  level. If the &lt;code title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt;
   attribute is present, multiple rows can be selected at once,
   otherwise the user can only select one row at a time.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element can be disabled entirely by
-  setting the &lt;code title=attr-datagrid-disabled&gt;&lt;a href=#attr-datagrid-disabled&gt;disabled&lt;/a&gt;&lt;/code&gt;
-  attribute.&lt;/p&gt;
-&lt;!--XXXDND
-  &lt;p class=&quot;XXX&quot;&gt;selection draggable [normative definitions are
-  in the interactive part below]&lt;/p&gt;
 --&gt;
 
-  &lt;p&gt;Columns, rows, and cells can each have specific flags, known as
-  classes, applied to them by the data provider. These classes &lt;a href=#datagridClassSummary&gt;affect the functionality&lt;/a&gt; of the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element, and are also &lt;a href=#datagridPseudos&gt;passed to the style system&lt;/a&gt;. They are
-  similar in concept to the &lt;code title=attr-class&gt;&lt;a href=#classes&gt;class&lt;/a&gt;&lt;/code&gt;
-  attribute, except that they are not specified on elements but are
-  given by scripted data providers.&lt;/p&gt; &lt;!-- XXX check xrefs --&gt;
+  &lt;!-- v2DGDND: selection should draggable to and from datagrids --&gt;
 
 
-  &lt;h5 id=how-rows-are-identified&gt;&lt;span class=secno&gt;4.11.2.2 &lt;/span&gt;How rows are identified&lt;/h5&gt;
+  &lt;h6 id=example:-a-datagrid-backed-by-a-static-table-element&gt;&lt;span class=secno&gt;4.11.2.1.1 &lt;/span&gt;Example: a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; backed by a static &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element&lt;/h6&gt;
 
-  &lt;p&gt;The chains of numbers that give a row's path, or identifier, are
-  represented by objects that implement the
-  &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; interface.&lt;/p&gt;
+  &lt;p class=XXX&gt;...&lt;/p&gt;
 
-  &lt;pre class=idl&gt;[NoInterfaceObject] interface &lt;dfn id=rowspecification&gt;RowSpecification&lt;/dfn&gt; {
-  // binding-specific interface
-};&lt;/pre&gt;
 
-  &lt;p&gt;In JavaScript, two classes of objects are said to implement this
-  interface: Numbers representing non-negative integers, and
-  homogeneous arrays of Numbers representing non-negative
-  integers. Thus, &lt;code&gt;[1,0,9]&lt;/code&gt; is a
-  &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;, as is &lt;code&gt;1&lt;/code&gt; on its
-  own. However, &lt;code&gt;[1,0.2,9]&lt;/code&gt; is not a
-  &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; object, since its second value is not
-  an integer.&lt;/p&gt;
+  &lt;h6 id=example:-a-datagrid-backed-by-nested-ol-elements&gt;&lt;span class=secno&gt;4.11.2.1.2 &lt;/span&gt;Example: a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; backed by nested &lt;code&gt;&lt;a href=#the-ol-element&gt;ol&lt;/a&gt;&lt;/code&gt; elements&lt;/h6&gt;
 
-  &lt;p&gt;User agents must always represent &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt;s
-  in JavaScript by using arrays, even if the path only has one
-  number.&lt;/p&gt;
+  &lt;p class=XXX&gt;...&lt;/p&gt;
 
-  &lt;p&gt;The root of the tree is represented by the empty path; in
-  JavaScript, this is the empty array (&lt;code&gt;[]&lt;/code&gt;). Only the
-  &lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount()&lt;/a&gt;&lt;/code&gt; and
-  &lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;GetChildAtPosition()&lt;/a&gt;&lt;/code&gt;
-  methods ever get called with the empty path.&lt;/p&gt;
 
+  &lt;h6 id=example:-a-datagrid-backed-by-a-server&gt;&lt;span class=secno&gt;4.11.2.1.3 &lt;/span&gt;Example: a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; backed by a server&lt;/h6&gt;
 
-  &lt;h5 id=the-data-provider-interface&gt;&lt;span class=secno&gt;4.11.2.3 &lt;/span&gt;The data provider interface&lt;/h5&gt;
+  &lt;p class=XXX&gt;...&lt;/p&gt;
 
-  &lt;p&gt;&lt;em&gt;The conformance criteria in this section apply to any
-  implementation of the &lt;code&gt;&lt;a href=#datagriddataprovider&gt;DataGridDataProvider&lt;/a&gt;&lt;/code&gt;, including
-  (and most commonly) the content author's implementation(s).&lt;/em&gt;&lt;/p&gt;
 
-&lt;p class=XXX&gt;The API here needs rewriting. Don't implement this right now.&lt;/p&gt;
+  &lt;h5 id=populating-the-datagrid&gt;&lt;span class=secno&gt;4.11.2.2 &lt;/span&gt;Populating the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;&lt;/h5&gt;
 
-  &lt;pre class=idl&gt;// To be implemented by Web authors as a JS object
-[NoInterfaceObject] interface &lt;dfn id=datagriddataprovider&gt;DataGridDataProvider&lt;/dfn&gt; {
-  void &lt;a href=#dom-provider-initialize title=dom-provider-initialize&gt;initialize&lt;/a&gt;(in &lt;a href=#htmldatagridelement&gt;HTMLDataGridElement&lt;/a&gt; datagrid);
-  unsigned long &lt;a href=#dom-provider-getrowcount title=dom-provider-getRowCount&gt;getRowCount&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row);
-  unsigned long &lt;a href=#dom-provider-getchildatposition title=dom-provider-getChildAtPosition&gt;getChildAtPosition&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; parentRow, in unsigned long position);
-  unsigned long &lt;a href=#dom-provider-getcolumncount title=dom-provider-getColumnCount&gt;getColumnCount&lt;/a&gt;();
-  DOMString &lt;a href=#dom-provider-getcaptiontext title=dom-provider-getCaptionText&gt;getCaptionText&lt;/a&gt;(in unsigned long column);
-  void &lt;a href=#dom-provider-getcaptionclasses title=dom-provider-getCaptionClasses&gt;getCaptionClasses&lt;/a&gt;(in unsigned long column, in DOMTokenList classes);
-  DOMString &lt;a href=#dom-provider-getrowimage title=dom-provider-getRowImage&gt;getRowImage&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row);
-  &lt;a href=#htmlmenuelement&gt;HTMLMenuElement&lt;/a&gt; &lt;a href=#dom-provider-getrowmenu title=dom-provider-getRowMenu&gt;getRowMenu&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row);
-  void &lt;a href=#dom-provider-getrowclasses title=dom-provider-getRowClasses&gt;getRowClasses&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in DOMTokenList classes);
-  DOMString &lt;a href=#dom-provider-getcelldata title=dom-provider-getCellData&gt;getCellData&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long column);
-  void &lt;a href=#dom-provider-getcellclasses title=dom-provider-getCellClasses&gt;getCellClasses&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long column, in DOMTokenList classes);
-&lt;!--XXXDND
-  boolean &lt;span title=&quot;dom-provider-canDrop&quot;&gt;canDrop&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in &lt;span&gt;RowSpecification&lt;/span&gt; position, data);
-  boolean &lt;span title=&quot;dom-provider-dropped&quot;&gt;dropped&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in &lt;span&gt;RowSpecification&lt;/span&gt; position, data);
---&gt;  void &lt;a href=#dom-provider-togglecolumnsortstate title=dom-provider-toggleColumnSortState&gt;toggleColumnSortState&lt;/a&gt;(in unsigned long column);
-  void &lt;a href=#dom-provider-setcellcheckedstate title=dom-provider-setCellCheckedState&gt;setCellCheckedState&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long column, in long state);
-  void &lt;a href=#dom-provider-cyclecell title=dom-provider-cycleCell&gt;cycleCell&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long column);
-  void &lt;a href=#dom-provider-editcell title=dom-provider-editCell&gt;editCell&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in unsigned long column, in DOMString data);
-&lt;!--XXXPA
-  void &lt;span title=&quot;dom-provider-performAction&quot;&gt;performAction&lt;/span&gt;(in DOMString action); // required if .performAction() is ever invoked on the datagrid
-  void &lt;span title=&quot;dom-provider-performActionOnRow&quot;&gt;performActionOnRow&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in DOMString action); // required if getRowClasses ever includes 'deletable' or if &lt;span title=&quot;dom-provider-.performActionOnRow&quot;&gt;.performActionOnRow&lt;/span&gt;() is ever invoked on the datagrid
-  void &lt;span title=&quot;dom-provider-performActionOnCell&quot;&gt;performActionOnCell&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column, in DOMString action); // required if .performActionOnCell() is ever invoked on the datagrid
---&gt;};&lt;/pre&gt;
-&lt;!-- based on <A HREF="http://lxr.mozilla.org/seamonkey/source/layout/xul/base/src/tree/public/nsITreeView.idl">http://lxr.mozilla.org/seamonkey/source/layout/xul/base/src/tree/public/nsITreeView.idl</A> --&gt;
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
+   &lt;dd&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#datagriddataprovider&gt;DataGridDataProvider&lt;/a&gt;&lt;/code&gt; interface represents the
-  interface that objects must implement to be used as custom data
-  views for &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
+    &lt;p&gt;Return the current object that is configured as the
+    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; listener, if any. Returns null if there is
+    none.&lt;/p&gt;
 
-  &lt;p&gt;Not all the methods are required. The minimum number of methods
-  that must be implemented in a useful view is two: the &lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData()&lt;/a&gt;&lt;/code&gt; methods.&lt;/p&gt;
+    &lt;p&gt;The listener is an object provided by the script author that
+    receives notifications when the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; needs row
+    data to render itself, when the user opens and closes rows with
+    children, when the user edits a cell, and when the user invokes a
+    row's context menu. (The &lt;code&gt;&lt;a href=#datagridlistener&gt;DataGridListener&lt;/a&gt;&lt;/code&gt; interface
+    used for this purpose is described in the next section.)&lt;/p&gt;
 
-  &lt;p&gt;Once the object is written, it must be hooked up to the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; using the &lt;dfn id=dom-datagrid-data title=dom-datagrid-data&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt; DOM attribute.&lt;/p&gt;
+    &lt;p&gt;Can be set, to change the current listener.&lt;/p&gt;
 
-  &lt;p&gt;The following methods may be usefully implemented:&lt;/p&gt;
+   &lt;/dd&gt;
 
-  &lt;dl&gt;&lt;dt&gt;&lt;dfn id=dom-provider-initialize title=dom-provider-initialize&gt;&lt;code&gt;initialize(&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element (the one given by
-   the &lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; argument) after it has first
-   populated itself. This would typically be used to set the initial
-   selection of the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element when it is first
-   loaded. The data provider could also use this method call to
-   register a &lt;code title=event-select&gt;&lt;a href=#event-select&gt;select&lt;/a&gt;&lt;/code&gt; event handler
-   on the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; in order to monitor selection
-   changes.&lt;/dd&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-renotify&gt;&lt;a href=#dom-datagrid-renotify&gt;renotify&lt;/a&gt;&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getrowcount title=dom-provider-getRowCount&gt;&lt;code&gt;getRowCount(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Causes the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; to resend notifications to the
+    listener (if any) for any rows or cells that the
+    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; does not yet have information for.&lt;/p&gt;
 
-   &lt;dd&gt;Must return the number of rows that are children of the
-   specified &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, including rows that are
-   off-screen. If &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is empty, then the number of
-   rows at the top level must be returned. If the value that this
-   method would return for a given &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; changes,
-   the relevant update methods on the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must be
-   called first. Otherwise, this method must always return the same
-   number. For a list (as opposed to a tree), this method must return
-   0 whenever it is called with a &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; identifier
-   that is not empty.&lt;/dd&gt;
+    &lt;!-- useful, e.g., if there is a server error and the script loses
+    track of what rows it's supposed to be reporting. --&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getchildatposition title=dom-provider-getChildAtPosition&gt;&lt;code&gt;getChildAtPosition(&lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;/dd&gt;
 
-   &lt;dd&gt;Must return the index of the row that is a child of &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt; and that is to be positioned as the &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;th row under &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;
-   when rendering the children of &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;. If
-   &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt; is empty, then &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; refers to the &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;th row at the top level of the data
-   grid. May be omitted if the rows are always to be sorted in the
-   natural order. (The natural order is the one where the method
-   always returns &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;.) For a given &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;, this method must never return the same
-   value for different values of &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;. The
-   returned value &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; must be in the range
-   0&nbsp;&le;&nbsp;&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;var title=&quot;&quot;&gt;n&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is the value returned
-   by &lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount(&lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;.&lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getcolumncount title=dom-provider-getColumnCount&gt;&lt;code&gt;getColumnCount()&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-addColumn&gt;&lt;a href=#dom-datagrid-addcolumn&gt;addColumn&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;id&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;label&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;icon&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;sortable&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;visible&lt;/var&gt; ] ] ] )&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dd&gt;Must return the number of columns currently in the data model
-   (including columns that might be hidden). May be omitted if there
-   is only one column. If the value that this method would return
-   changes, the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s &lt;code title=dom-datagrid-updateEverything&gt;&lt;a href=#dom-datagrid-updateeverything&gt;updateEverything()&lt;/a&gt;&lt;/code&gt;
-   method must be called.&lt;/dd&gt;
+    &lt;p&gt;Adds a column to the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getcaptiontext title=dom-provider-getCaptionText&gt;&lt;code&gt;getCaptionText(&lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;If a column with the given identifier has already been added,
+    it just replaces the information for that column.&lt;/p&gt;
 
-   &lt;dd&gt;Must return the caption, or label, for column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. May be omitted if the columns have no
-   captions. If the value that this method would return changes, the
-   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s &lt;code title=dom-datagrid-updateColumnChanged&gt;&lt;a href=#dom-datagrid-updatecolumnchanged&gt;updateColumnChanged()&lt;/a&gt;&lt;/code&gt;
-   method must be called with the appropriate column index.&lt;/dd&gt;
+    &lt;p&gt;The possible types are enumerated in the previous section.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getcaptionclasses title=dom-provider-getCaptionClasses&gt;&lt;code&gt;getCaptionClasses(&lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;/dd&gt;
 
-   &lt;dd&gt;Must add the classes that apply to column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt; object.
-   May be omitted if the columns have no special classes. If the
-   classes that this method would add changes, the
-   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s &lt;code title=dom-datagrid-updateColumnChanged&gt;&lt;a href=#dom-datagrid-updatecolumnchanged&gt;updateColumnChanged()&lt;/a&gt;&lt;/code&gt;
-   method must be called with the appropriate column index. Some
-   classes have &lt;a href=#datagridClassSummary&gt;predefined
-   meanings&lt;/a&gt;.&lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getrowimage title=dom-provider-getRowImage&gt;&lt;code&gt;getRowImage(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-sortColumn&gt;&lt;a href=#dom-datagrid-sortcolumn&gt;sortColumn&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dd&gt;Must return a &lt;a href=#url&gt;URL&lt;/a&gt; giving the address of an image
-   that represents row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, or the empty string if
-   there is no applicable image. May be omitted if no rows have
-   associated images. If the value that this method would return
-   changes, the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s update methods must be called
-   to update the row in question.&lt;/dd&gt;
+    &lt;p&gt;Returns the identifier of the column by which the data is to be
+    sorted.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getrowmenu title=dom-provider-getRowMenu&gt;&lt;code&gt;getRowMenu(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Can be set, to indicate that the sort order has changed. This
+    will cause the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; to clear its position
+    information for rows, so &lt;code title=dom-datagrid-setRows&gt;&lt;a href=#dom-datagrid-setrows&gt;setRows()&lt;/a&gt;&lt;/code&gt; will have to be
+    called again with the new sort order.&lt;/p&gt;
 
-   &lt;dd&gt;Must return an &lt;code&gt;&lt;a href=#htmlmenuelement&gt;HTMLMenuElement&lt;/a&gt;&lt;/code&gt; object that is to
-   be used as a context menu for row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, or null
-   if there is no particular context menu. May be omitted if none of
-   the rows have a special context menu. As this method is called
-   immediately before showing the menu in question, no precautions
-   need to be taken if the return value of this method changes.&lt;/dd&gt;
+    &lt;p&gt;The columns are not actually sorted by the
+    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;; the data has to be sorted by the script
+    that adds the rows to the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getrowclasses title=dom-provider-getRowClasses&gt;&lt;code&gt;getRowClasses(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;/dd&gt;
 
-   &lt;dd&gt;Must add the classes that apply to row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;
-   to the &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt; object. May be omitted if the
-   rows have no special classes. If the classes that this method would
-   add changes, the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s update methods must be
-   called to update the row in question. Some classes have &lt;a href=#datagridClassSummary&gt;predefined meanings&lt;/a&gt;.&lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getcelldata title=dom-provider-getCellData&gt;&lt;code&gt;getCellData(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-sortAscending&gt;&lt;a href=#dom-datagrid-sortascending&gt;sortAscending&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dd&gt;Must return the value of the cell on row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; in column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. For text
-   cells, this must be the text to show for that cell. For &lt;a href=#datagrid-cell-class-progress title=datagrid-cell-class-progress&gt;progress bar cells&lt;/a&gt;,
-   this must be either a floating point number in the range 0.0 to 1.0
-   (converted to a string representation&lt;!-- XXX this isn't
-   technically enough to define what the author must be doing here,
-   but let's let that slide until someone notices --&gt;), indicating the
-   fraction of the progress bar to show as full (1.0 meaning
-   complete), or the empty string, indicating an indeterminate
-   progress bar. If the value that this method would return changes,
-   the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s update methods must be called to update
-   the rows that changed. If only one cell changed, the &lt;code title=dom-datagrid-updateCellChanged&gt;&lt;a href=#dom-datagrid-updatecellchanged&gt;updateCellChanged()&lt;/a&gt;&lt;/code&gt;
-   method may be used.&lt;/dd&gt;
+    &lt;p&gt;Returns true if the data is to be sorted with small values
+    first; otherwise, returns false, indicating that bigger values are
+    to be put first.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-getcellclasses title=dom-provider-getCellClasses&gt;&lt;code&gt;getCellClasses(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Can be set, to indicate that the order is about to change.&lt;/p&gt;
 
-   &lt;dd&gt;Must add the classes that apply to the cell on row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; in column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt; object. May be omitted if the cells have no
-   special classes. If the classes that this method would add changes,
-   the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s update methods must be called to update
-   the rows or cells in question. Some classes have &lt;a href=#datagridClassSummary&gt;predefined meanings&lt;/a&gt;.&lt;/dd&gt;
+   &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-togglecolumnsortstate title=dom-provider-toggleColumnSortState&gt;&lt;code&gt;toggleColumnSortState(&lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; when the user tries to sort
-   the data using a particular column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. The
-   data provider must update its state so that the &lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;GetChildAtPosition()&lt;/a&gt;&lt;/code&gt;
-   method returns the new order, and the classes of the columns
-   returned by &lt;code title=dom-provider-getCaptionClasses&gt;&lt;a href=#dom-provider-getcaptionclasses&gt;getCaptionClasses()&lt;/a&gt;&lt;/code&gt;
-   represent the new sort status. There is no need to tell the
-   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; that it the data has changed, as the
-   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; automatically assumes that the entire data
-   model will need updating.&lt;/dd&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-clearColumns&gt;&lt;a href=#dom-datagrid-clearcolumns&gt;clearColumns&lt;/a&gt;&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-setcellcheckedstate title=dom-provider-setCellCheckedState&gt;&lt;code&gt;setCellCheckedState(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Removes all the columns in the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;,
+    reinstating the implied column.&lt;/p&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; when the user changes the
-   state of a checkbox cell on row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, column
-   &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. The checkbox should be toggled to the
-   state given by &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;, which is a positive
-   integer (1) if the checkbox is to be checked, zero (0) if it is to
-   be unchecked, and a negative number (&minus;1) if it is to be set to the
-   indeterminate state. There is no need to tell the
-   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; that the cell has changed, as the
-   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; automatically assumes that the given cell
-   will need updating.&lt;/dd&gt;
+   &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-cyclecell title=dom-provider-cycleCell&gt;&lt;code&gt;cycleCell(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; when the user changes the
-   state of a cyclable cell on row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, column
-   &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. The data provider should change the
-   state of the cell to the new state, as appropriate. There is no
-   need to tell the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; that the cell has
-   changed, as the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; automatically assumes that
-   the given cell will need updating.&lt;/dd&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-setRowCount&gt;&lt;a href=#dom-datagrid-setrowcount&gt;setRowCount&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;childCount&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dt&gt;&lt;dfn id=dom-provider-editcell title=dom-provider-editCell&gt;&lt;code&gt;editCell(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Sets the numbers of rows in the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;,
+    excluding rows that are descendants of rows that are closed.&lt;/p&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; when the user edits the
-   cell on row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. The new value of the cell is given by &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;. The data provider should update the cell
-   accordingly. There is no need to tell the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;
-   that the cell has changed, as the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;
-   automatically assumes that the given cell will need updating.&lt;/dd&gt;
+    &lt;p&gt;Throws a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception if the
+    arguments contradict each other or previously declared information
+    (e.g. declaring that the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; has three rows when
+    the 12th row has been declared).&lt;/p&gt;
 
-&lt;!--XXXPA
-  void performAction(in DOMString action); // required if .performAction() is ever invoked on the datagrid
-  void performActionOnRow(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in DOMString action); // required if getRowClasses ever includes 'deletable' or if .performActionOnRow() is ever invoked on the datagrid
-  void performActionOnCell(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column, in DOMString action); // required if .performActionOnCell() is ever invoked on the datagrid
---&gt;
+   &lt;/dd&gt;
 
-  &lt;/dl&gt;&lt;p&gt;The following classes (for rows, columns, and cells) may be
-  usefully used in conjunction with this interface:&lt;/p&gt;
 
-  &lt;table id=datagridClassSummary&gt;&lt;tr&gt;&lt;th&gt;Class name&lt;/th&gt;
-    &lt;th&gt;Applies to&lt;/th&gt;
-    &lt;th&gt;Description&lt;/th&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--checked--&gt;&lt;dfn id=datagrid-cell-class-checked title=datagrid-cell-class-checked&gt;&lt;code&gt;checked&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell has a checkbox and it is checked. (The &lt;code title=datagrid-cell-class-cyclable&gt;&lt;a href=#datagrid-cell-class-cyclable&gt;cyclable&lt;/a&gt;&lt;/code&gt; and &lt;code title=datagrid-cell-class-progress&gt;&lt;a href=#datagrid-cell-class-progress&gt;progress&lt;/a&gt;&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--cyclable--&gt;&lt;dfn id=datagrid-cell-class-cyclable title=datagrid-cell-class-cyclable&gt;&lt;code&gt;cyclable&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell can be cycled through multiple values. (The &lt;code title=datagrid-cell-class-progress&gt;&lt;a href=#datagrid-cell-class-progress&gt;progress&lt;/a&gt;&lt;/code&gt; class
-    overrides this, though.)&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--editable--&gt;&lt;dfn id=datagrid-cell-class-editable title=datagrid-cell-class-editable&gt;&lt;code&gt;editable&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell can be edited. (The &lt;code title=datagrid-cell-class-cyclable&gt;&lt;a href=#datagrid-cell-class-cyclable&gt;cyclable&lt;/a&gt;&lt;/code&gt;, &lt;code title=datagrid-cell-class-progress&gt;&lt;a href=#datagrid-cell-class-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;checked&lt;/a&gt;&lt;/code&gt;, &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;unchecked&lt;/a&gt;&lt;/code&gt; and &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;indeterminate&lt;/a&gt;&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--header--&gt;&lt;dfn id=datagrid-row-class-header title=datagrid-row-class-header&gt;&lt;code&gt;header&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row is a heading, not a data row.&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--indeterminate--&gt;&lt;dfn id=datagrid-cell-class-indeterminate title=datagrid-cell-class-indeterminate&gt;&lt;code&gt;indeterminate&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell has a checkbox, and it can be set to an indeterminate
-    state. If neither the &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;checked&lt;/a&gt;&lt;/code&gt; nor &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;unchecked&lt;/a&gt;&lt;/code&gt; classes are
-    present, then the checkbox is in that state, too. (The &lt;code title=datagrid-cell-class-cyclable&gt;&lt;a href=#datagrid-cell-class-cyclable&gt;cyclable&lt;/a&gt;&lt;/code&gt; and &lt;code title=datagrid-cell-class-progress&gt;&lt;a href=#datagrid-cell-class-progress&gt;progress&lt;/a&gt;&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--initially-hidden--&gt;&lt;dfn id=datagrid-column-class-initially-hidden title=datagrid-column-class-initially-hidden&gt;&lt;code&gt;initially-hidden&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Columns&lt;/td&gt;
-    &lt;td&gt;The column will not be shown when the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is
-    initially rendered. If this class is not present on the column
-    when the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is initially rendered, the column
-    will be visible if space allows.&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--initially-closed--&gt;&lt;dfn id=datagrid-row-class-initially-closed title=datagrid-row-class-initially-closed&gt;&lt;code&gt;initially-closed&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row will be closed when the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is
-    initially rendered. If neither this class nor the &lt;code title=datagrid-row-class-initially-open&gt;&lt;a href=#datagrid-row-class-initially-open&gt;initially-open&lt;/a&gt;&lt;/code&gt;
-    class is present on the row when the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is
-    initially rendered, the initial state will depend on platform
-    conventions.&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--initially-open--&gt;&lt;dfn id=datagrid-row-class-initially-open title=datagrid-row-class-initially-open&gt;&lt;code&gt;initially-open&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row will be opened when the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is
-    initially rendered. If neither this class nor the &lt;code title=datagrid-row-class-initially-closed&gt;&lt;a href=#datagrid-row-class-initially-closed&gt;initially-closed&lt;/a&gt;&lt;/code&gt;
-    class is present on the row when the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is
-    initially rendered, the initial state will depend on platform
-    conventions.&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--progress--&gt;&lt;dfn id=datagrid-cell-class-progress title=datagrid-cell-class-progress&gt;&lt;code&gt;progress&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell is a progress bar.&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--reversed--&gt;&lt;dfn id=datagrid-column-class-reversed title=datagrid-column-class-reversed&gt;&lt;code&gt;reversed&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Columns&lt;/td&gt;
-    &lt;td&gt;If the cell is sorted, the sort direction is descending,
-    instead of ascending.&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--selectable-separator--&gt;&lt;dfn id=datagrid-row-class-selectable-separator title=datagrid-row-class-selectable-separator&gt;&lt;code&gt;selectable-separator&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row is a normal, selectable, data row, except that instead
-    of having data, it only has a separator. (The &lt;code title=datagrid-row-class-header&gt;&lt;a href=#datagrid-row-class-header&gt;header&lt;/a&gt;&lt;/code&gt; and &lt;code title=datagrid-row-class-separator&gt;&lt;a href=#datagrid-row-class-separator&gt;separator&lt;/a&gt;&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--separator--&gt;&lt;dfn id=datagrid-row-class-separator title=datagrid-row-class-separator&gt;&lt;code&gt;separator&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row is a separator row, not a data row. (The &lt;code title=datagrid-row-class-header&gt;&lt;a href=#datagrid-row-class-header&gt;header&lt;/a&gt;&lt;/code&gt; class
-    overrides this, though.)&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--sortable--&gt;&lt;dfn id=datagrid-column-class-sortable title=datagrid-column-class-sortable&gt;&lt;code&gt;sortable&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Columns&lt;/td&gt;
-    &lt;td&gt;The data can be sorted by this column.&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--sorted--&gt;&lt;dfn id=datagrid-column-class-sorted title=datagrid-column-class-sorted&gt;&lt;code&gt;sorted&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Columns&lt;/td&gt;
-    &lt;td&gt;The data is sorted by this column. Unless the &lt;code title=datagrid-column-class-reversed&gt;&lt;a href=#datagrid-column-class-reversed&gt;reversed&lt;/a&gt;&lt;/code&gt; class is
-    also present, the sort direction is ascending.&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;!--unchecked--&gt;&lt;dfn id=datagrid-cell-class-unchecked title=datagrid-cell-class-unchecked&gt;&lt;code&gt;unchecked&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell has a checkbox and, unless the &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;checked&lt;/a&gt;&lt;/code&gt; class is
-    present as well, it is unchecked. (The &lt;code title=datagrid-cell-class-cyclable&gt;&lt;a href=#datagrid-cell-class-cyclable&gt;cyclable&lt;/a&gt;&lt;/code&gt; and &lt;code title=datagrid-cell-class-progress&gt;&lt;a href=#datagrid-cell-class-progress&gt;progress&lt;/a&gt;&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;/tr&gt;&lt;!--XXXPA
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!- -deletable- -&gt;&lt;dfn title=&quot;datagrid-row-class-deletable&quot;&gt;&lt;code&gt;deletable&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;&lt;/td&gt;
-   &lt;/tr&gt;
---&gt;&lt;/table&gt;&lt;h5 id=the-default-data-provider&gt;&lt;span class=secno&gt;4.11.2.4 &lt;/span&gt;The default data provider&lt;/h5&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-setRows&gt;&lt;a href=#dom-datagrid-setrows&gt;setRows&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
 
-  &lt;p&gt;The user agent must supply a default data provider for the case
-  where the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s &lt;code title=dom-datagrid-data&gt;&lt;a href=#dom-datagrid-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute is null. It must act
-  as described in this section.&lt;/p&gt;
+    &lt;p&gt;Updates data for rows in the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, or fills in
+    data for rows previously implied by a call to &lt;code title=dom-datagrid-setRowCount&gt;&lt;a href=#dom-datagrid-setrowcount&gt;setRowCount()&lt;/a&gt;&lt;/code&gt; but not
+    previously declared.&lt;/p&gt;
 
-  &lt;p&gt;The behavior of the default data provider depends on the nature
-  of the first element child of the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument is an array of rows, each
+    represented by a further array consisting of:&lt;/p&gt;
 
-  &lt;dl class=switch&gt;&lt;!-- XXX some of these entries say &quot;the method must return&quot; and
-   other say &quot;the characteristic must be&quot;; this should be rationalized
-   --&gt;&lt;dt&gt;While the first element child is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element&lt;/dt&gt;
+    &lt;ol class=brief&gt;&lt;li&gt;A &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object identifying the row.&lt;/li&gt;
 
-   &lt;dd&gt;
+     &lt;li&gt;An integer giving the position of the row in its parent,
+     given the current sort order, or &minus;1 to set other row data
+     without setting a position or changing a previously declared
+     position.&lt;/li&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;:
-    The number of rows returned by the default data provider for the
-    root of the tree (when &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is empty) must be the total number of &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; elements
-    that are children of &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; elements that are children
-    of the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;, if there are any such child
-    &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; elements. If there are no such
-    &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; elements then the number of rows returned for
-    the root must be the number of &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; elements that are
-    children of the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+     &lt;li&gt;An integer giving the number of children of the row, or 0 if
+     the row has no children, or &minus;1 if the row has children but
+     the count is currently unknown. If the number of children has
+     already been set to 0 or a positive integer, then passing
+     &minus;1 leaves the previous count unchanged.&lt;/li&gt;
 
-    &lt;p&gt;When &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is not empty, the number of rows
-    returned must be zero.&lt;/p&gt;
+     &lt;li&gt;An array giving the data for zero or more cells in the row,
+     as described below.&lt;/li&gt;
 
-    &lt;p class=note&gt;The &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;-based default data provider
-    cannot represent a tree.&lt;/p&gt;
+     &lt;li&gt;A boolean declaring whether the row is open or not. This
+     entry, if omitted, is assumed to be false (closed), unless the
+     row has already been declared as open.&lt;/li&gt;
 
-    &lt;p class=note&gt;Rows in &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt; elements do not
-    contribute to the number of rows returned, although they do affect
-    the columns and column captions. Rows in &lt;code&gt;&lt;a href=#the-tfoot-element&gt;tfoot&lt;/a&gt;&lt;/code&gt;
-    elements are &lt;a href=#ignore title=ignore&gt;ignored&lt;/a&gt; completely by
-    this algorithm.&lt;/p&gt;
+     &lt;li&gt;An integer giving the number of rows that are descendants of
+     this row, excluding those that are descendants of descendants of
+     this row that are closed. This entry can be omitted if the row is
+     closed or if it has already been declared.&lt;/li&gt;
 
-    &lt;p id=defaultDataProviderTableMapper&gt;&lt;strong&gt;&lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;getChildAtPosition(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;: The
-    default data provider must return the mapping appropriate to the
-    &lt;a href=#defaultDataProviderTableSort&gt;current sort
-    order&lt;/a&gt;.&lt;/p&gt;
+    &lt;/ol&gt;&lt;p&gt;The array giving the data for the cells in the row consists of
+    a further set of arrays, one per cell. The first item of each of
+    these arrays is the column's identifier; the subsequent values
+    vary based on the type of the column, as follows:&lt;/p&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getColumnCount&gt;&lt;a href=#dom-provider-getcolumncount&gt;getColumnCount()&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;:
-    The number of columns returned must be the number of
-    &lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt; element children in the first &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt;
-    element child of the first &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; element child of the
-    &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;, if there are any such &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;
-    elements. If there are no such &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; elements, then
-    it must be the number of &lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt; element children in the
-    first &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element child of the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;, if
-    any, or otherwise 1. If the number that would be returned by these
-    rules is 0, then 1 must be returned instead.&lt;/p&gt;
+    &lt;dl&gt;&lt;dt&gt;&lt;code title=datagrid-type-text&gt;&lt;a href=#datagrid-type-text&gt;text&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=brief&gt;&lt;li&gt;A string giving the cell's value.
+       &lt;li&gt;Optionally, an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element giving an icon for the cell.
+      &lt;/ol&gt;&lt;/dd&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getCaptionText&gt;&lt;a href=#dom-provider-getcaptiontext&gt;getCaptionText(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;: If the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; has
-    no &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt; element child, or if its first
-    &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt; element child has no &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element
-    child, the default data provider must return the empty string for
-    all captions. Otherwise, the value of the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt;
-    attribute of the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th &lt;code&gt;&lt;a href=#the-th-element&gt;th&lt;/a&gt;&lt;/code&gt; element
-    child of the first &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element child of the first
-    &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt; element child of the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element
-    must be returned. If there is no such &lt;code&gt;&lt;a href=#the-th-element&gt;th&lt;/a&gt;&lt;/code&gt; element, the
-    empty string must be returned.&lt;/p&gt;
+     &lt;dt&gt;&lt;code title=datagrid-type-editable&gt;&lt;a href=#datagrid-type-editable&gt;editable&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=brief&gt;&lt;li&gt;A string giving the cell's value.
+       &lt;li&gt;Optionally, a &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element giving a set of predefined options.
+       &lt;li&gt;Optionally, an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element giving an icon for the cell.
+      &lt;/ol&gt;&lt;/dd&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getCaptionClasses&gt;&lt;a href=#dom-provider-getcaptionclasses&gt;getCaptionClasses(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;: If
-    the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; has no &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt; element child, or
-    if its first &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt; element child has no
-    &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element child, the default data provider must not
-    add any classes for any of the captions. Otherwise, each class
-    in the &lt;code title=attr-class&gt;&lt;a href=#classes&gt;class&lt;/a&gt;&lt;/code&gt; attribute of the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th &lt;code&gt;&lt;a href=#the-th-element&gt;th&lt;/a&gt;&lt;/code&gt; element child of the first
-    &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element child of the first &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt;
-    element child of the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element must be added to
-    the &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;. If there is no such
-    &lt;code&gt;&lt;a href=#the-th-element&gt;th&lt;/a&gt;&lt;/code&gt; element, no classes must be added. The user agent
-    must then:&lt;/p&gt;
+     &lt;dt&gt;&lt;code title=datagrid-type-checkable&gt;&lt;a href=#datagrid-type-checkable&gt;checkable&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=brief&gt;&lt;li&gt;A string giving the cell's value.
+       &lt;li&gt;A boolean, indicating whether the cell is checked (true) or not (false).
+       &lt;li&gt;Optionally, a boolean indicating whether the value of the cell is obscured as indeterminate (true), or not (false).
+       &lt;li&gt;Optionally, an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element giving an icon for the cell.
+      &lt;/ol&gt;&lt;/dd&gt;
 
-    &lt;ol&gt;&lt;li&gt;Remove the &lt;code title=datagrid-column-class-sorted&gt;&lt;a href=#datagrid-column-class-sorted&gt;sorted&lt;/a&gt;&lt;/code&gt; and &lt;code title=datagrid-column-class-reversed&gt;&lt;a href=#datagrid-column-class-reversed&gt;reversed&lt;/a&gt;&lt;/code&gt;
-     classes.&lt;/li&gt;
+     &lt;dt&gt;&lt;code title=datagrid-type-list&gt;&lt;a href=#datagrid-type-list&gt;list&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=brief&gt;&lt;li&gt;A string giving the cell's current value.
+       &lt;li&gt;A &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt; element giving the &lt;a href=#concept-select-option-list title=concept-select-option-list&gt;list of options&lt;/a&gt;.
+       &lt;li&gt;Optionally, an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element giving an icon for the cell.
+      &lt;/ol&gt;&lt;/dd&gt;
 
-     &lt;li&gt;If the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element has a &lt;code title=attr-class&gt;&lt;a href=#classes&gt;class&lt;/a&gt;&lt;/code&gt; attribute that includes the &lt;code title=&quot;&quot;&gt;sortable&lt;/code&gt; class, add the &lt;code title=datagrid-column-class-sortable&gt;&lt;a href=#datagrid-column-class-sortable&gt;sortable&lt;/a&gt;&lt;/code&gt;
-     class.&lt;/li&gt;
+     &lt;dt&gt;&lt;code title=datagrid-type-progress&gt;&lt;a href=#datagrid-type-progress&gt;progress&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=brief&gt;&lt;li&gt;A value in the range 0.0 (no progress) to 1.0 (task complete).
+      &lt;/ol&gt;&lt;/dd&gt;
 
-     &lt;li&gt;If the column is the one currently being used to
-     sort the data, add the &lt;code title=datagrid-column-class-sorted&gt;&lt;a href=#datagrid-column-class-sorted&gt;sorted&lt;/a&gt;&lt;/code&gt; class.&lt;/li&gt;
+     &lt;dt&gt;&lt;code title=datagrid-type-meter&gt;&lt;a href=#datagrid-type-meter&gt;meter&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=brief&gt;&lt;li&gt;A number giving the cell's value.
+       &lt;li&gt;Optionally, a number giving the maximum value, if it's not 1.
+       &lt;li&gt;Optionally, a number giving the minimum value, if it's not 0.
+       &lt;li&gt;Optionally, a number giving the highest value that is considered &quot;low&quot;.
+       &lt;li&gt;Optionally, a number giving the lowest value that is considered &quot;high&quot;.
+       &lt;li&gt;Optionally, a number giving the value that is considered optimal.
+      &lt;/ol&gt;&lt;/dd&gt;
 
-     &lt;li&gt;If the column is the one currently being used to sort the
-     data, and it is sorted in descending order, add the &lt;code title=datagrid-column-class-reversed&gt;&lt;a href=#datagrid-column-class-reversed&gt;reversed&lt;/a&gt;&lt;/code&gt; class as
-     well.&lt;/li&gt;
+     &lt;dt&gt;&lt;code title=datagrid-type-custom&gt;&lt;a href=#datagrid-type-custom&gt;custom&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=brief&gt;&lt;li&gt;A number giving the minimum width of the cell, in CSS pixels, that is desired.
+       &lt;li&gt;A number giving the minimum height of the cell, in CSS pixels, that is desired.
+       &lt;li&gt;A function that is passed a &lt;code&gt;&lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt; object, along with the width and height (in CSS pixels) of the cell that the context will draw on.
+      &lt;/ol&gt;&lt;/dd&gt;
 
-    &lt;/ol&gt;&lt;p&gt;The various row- and cell- related methods operate relative to
-    a particular element, the element of the row or cell specified by
-    their arguments.&lt;/p&gt;
+    &lt;/dl&gt;&lt;p&gt;While the rows in a single call to the &lt;code title=dom-datagrid-setRows&gt;&lt;a href=#dom-datagrid-setrows&gt;setRows()&lt;/a&gt;&lt;/code&gt; method can be in any
+    order, for each row, it is important that all its ancestor rows
+    and all its open previous siblings are also declared, either in
+    the same call or in an earlier one.&lt;/p&gt;
 
-    &lt;p&gt;&lt;strong&gt;For rows&lt;/strong&gt;: Since the default data provider for
-    a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; always returns 0 as the number of children
-    for any row other than the root, the path to the row passed to
-    these methods will always consist of a single number. In the prose
-    below, this number is referred to as &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Throws a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception if the
+    arguments contradict each other or previously declared information
+    (e.g. saying that a row's position is 5 when the parent row only
+    has 3 children, or naming a column that doesn't exist, or
+    declaring a row without declaring its parent, or changing the
+    number of children that a row has while that row and its ancestors
+    are all open).&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; has &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; element
-    children, the element for the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th row is the
-    &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element that is a child of
-    a &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; element that is a child of the
-    &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element. If the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; does not
-    have &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; element children, then the element for the
-    &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th real row is the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th
-    &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element that is a child of the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;
-    element.&lt;/p&gt;
+   &lt;/dd&gt;
 
-    &lt;p&gt;&lt;strong&gt;For cells&lt;/strong&gt;: Given a row and its element, the
-    row's &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th cell's element is the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th &lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt; element child of the row
-    element.&lt;/p&gt;
 
-    &lt;p class=note&gt;The &lt;code&gt;colspan&lt;/code&gt; and &lt;code&gt;rowspan&lt;/code&gt;
-    attributes are &lt;a href=#ignore title=ignore&gt;ignored&lt;/a&gt; by this
-    algorithm.&lt;/p&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-insertRows&gt;&lt;a href=#dom-datagrid-insertrows&gt;insertRows&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getRowImage&gt;&lt;a href=#dom-provider-getrowimage&gt;getRowImage(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;: The &lt;a href=#url&gt;URL&lt;/a&gt; of the
-    row's image is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained by &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the value of the &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute of the first
-    &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element child of the row's first cell's element,
-    relative to that element, if there is one and resolving its
-    attribute is successful. Otherwise, the &lt;a href=#url&gt;URL&lt;/a&gt; of the
-    row's image is the empty string.&lt;/p&gt; &lt;!-- note that if the base
-    URL has changed, this URL can be different than the one that the
-    &lt;img&gt; element fetched when it was created --&gt;
+    &lt;p&gt;Inserts the given rows into the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;,
+    increasing the numbers of rows that the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;
+    assumes are present.&lt;/p&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getRowMenu&gt;&lt;a href=#dom-provider-getrowmenu&gt;getRowMenu(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;: If the row's first cell's
-    element has a &lt;code&gt;&lt;a href=#menus&gt;menu&lt;/a&gt;&lt;/code&gt; element child, then the row's menu
-    is the first &lt;code&gt;&lt;a href=#menus&gt;menu&lt;/a&gt;&lt;/code&gt; element child of the row's first
-    cell's element. Otherwise, the row has no menu.&lt;/p&gt;
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument is an array of rows in
+    the same structure as the argument to the &lt;code title=dom-datagrid-setRows&gt;&lt;a href=#dom-datagrid-setrows&gt;setRows()&lt;/a&gt;&lt;/code&gt; method described
+    above, with the same expectations of consistency (a given row's
+    ancestors and earlier open siblings being listed either earlier or
+    in the same call as a given row). However, unlike with the &lt;code title=dom-datagrid-setRows&gt;&lt;a href=#dom-datagrid-setrows&gt;setRows()&lt;/a&gt;&lt;/code&gt; method, if a row is
+    inserted along with its child, the child is not included in the
+    child and row counts of the parent row; every row in the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument will increase its parent's counts
+    automatically.&lt;/p&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getRowClasses&gt;&lt;a href=#dom-provider-getrowclasses&gt;getRowClasses(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;:
-    The default data provider must never add a class to the row's
-    classes.&lt;/p&gt;
+    &lt;p&gt;Throws a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception if the
+    arguments contradict each other or previously declared
+    information.&lt;/p&gt;
 
-    &lt;p id=defaultDataProviderTableSort&gt;&lt;strong&gt;&lt;code title=dom-provider-toggleColumnSortState&gt;&lt;a href=#dom-provider-togglecolumnsortstate&gt;toggleColumnSortState(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;: If the data is already being
-    sorted on the given column, then the user agent must change the
-    current sort mapping to be the inverse of the current sort
-    mapping; if the sort order was ascending before, it is now
-    descending, otherwise it is now ascending. Otherwise, if the
-    current sort column is another column, or the data model is
-    currently not sorted, the user agent must create a new mapping,
-    which maps rows in the data model to rows in the DOM so that the
-    rows in the data model are sorted by the specified column, in
-    ascending order. (Which sort comparison operator to use is left up
-    to the UA to decide.)&lt;/p&gt;
+   &lt;/dd&gt;
 
-    &lt;p&gt;When the sort mapping is changed, the values returned by the
-    &lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;getChildAtPosition()&lt;/a&gt;&lt;/code&gt;
-    method for the default data provider &lt;a href=#defaultDataProviderTableMapper&gt;will change
-    appropriately&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;, &lt;code title=dom-provider-getCellClasses&gt;&lt;a href=#dom-provider-getcellclasses&gt;getCellClasses(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;, &lt;code title=dom-provider-setCellCheckedState&gt;&lt;a href=#dom-provider-setcellcheckedstate&gt;getCellCheckedState(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;, &lt;code title=dom-provider-cycleCell&gt;&lt;a href=#dom-provider-cyclecell&gt;cycleCell(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;,
-    &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;, and &lt;code title=dom-provider-editCell&gt;&lt;a href=#dom-provider-editcell&gt;editCell(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;,
-    &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/strong&gt;:
-    See &lt;a href=#commonDefaultDataGridMethodDefinitions&gt;the common
-    definitions below&lt;/a&gt;.&lt;/p&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-deleteRows&gt;&lt;a href=#dom-datagrid-deleterows&gt;deleteRows&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
 
-    &lt;p&gt;The data provider must call the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s update
-    methods appropriately whenever the descendants of the
-    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; mutate. For example, if a &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; is
-    removed, then the &lt;code title=dom-datagrid-updateRowsRemoved&gt;&lt;a href=#dom-datagrid-updaterowsremoved&gt;updateRowsRemoved()&lt;/a&gt;&lt;/code&gt;
-    methods would probably need to be invoked, and any change to a
-    cell or its descendants must cause the cell to be updated. If the
-    &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element stops being the first child of the
-    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, then the data provider must call the &lt;code title=dom-datagrid-updateEverything&gt;&lt;a href=#dom-datagrid-updateeverything&gt;updateEverything()&lt;/a&gt;&lt;/code&gt;
-    method on the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;. Any change to a cell that is
-    in the column that the data provider is currently using as its
-    sort column must also cause the sort to be reperformed, with a
-    call to &lt;code title=dom-datagrid-updateEverything&gt;&lt;a href=#dom-datagrid-updateeverything&gt;updateEverything()&lt;/a&gt;&lt;/code&gt; if
-    the change did affect the sort order.&lt;/p&gt;
+    &lt;p&gt;Removes the given rows from the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, and
+    updates the number of rows known to be in the
+    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; accordingly. The argument is an array of
+    &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; objects identifying the rows to remove.&lt;/p&gt;
 
+    &lt;p&gt;Throws a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception if the argument
+    includes a row the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; doesn't know about.&lt;/p&gt;
+    &lt;!-- since otherwise behaviour might depend on where the user
+    scrolled! --&gt;
+
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;While the first element child is a &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-repaint&gt;&lt;a href=#dom-datagrid-repaint&gt;repaint&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
 
+    &lt;p&gt;If the given column's type is &lt;code title=datagrid-type-custom&gt;&lt;a href=#datagrid-type-custom&gt;custom&lt;/a&gt;&lt;/code&gt;, then causes the
+    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; to reinvoke the function that obtains the
+    desired rendering.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=dom-datagrid-clearRows&gt;&lt;a href=#dom-datagrid-clearrows&gt;clearRows&lt;/a&gt;&lt;/code&gt;()&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;The default data provider must return 1 for the column count,
-    the empty string for the column's caption, and must not add any
-    classes to the column's classes.&lt;/p&gt;
+    &lt;p&gt;Clears the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; of all row data, resetting it
+    to empty&lt;!-- v2DGS:, and clears the selection--&gt;.&lt;/p&gt;
 
-    &lt;p&gt;For the rows, assume the existence of a node filter view of the
-    descendants of the first element child of the
-    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element (the &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt; or
-    &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element), that skips all nodes other than
-    &lt;code&gt;&lt;a href=#the-optgroup-element&gt;optgroup&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; elements, as well as
-    any descendants of any &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
+   &lt;/dd&gt;
 
-    &lt;p&gt;Given a path &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, the corresponding element
-    is the one obtained by drilling into the view, taking the child
-    given by the path each time.&lt;/p&gt;
+  &lt;/dl&gt;&lt;div class=impl&gt;
 
-    &lt;div class=example&gt;
+  &lt;h6 id=the-listener&gt;&lt;span class=secno&gt;4.11.2.2.1 &lt;/span&gt;The listener&lt;/h6&gt;
 
-     &lt;p&gt;Given the following XML markup:&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=dom-datagrid-listener title=dom-datagrid-listener&gt;&lt;code&gt;listener&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute allows authors to specify an object that will receive all
+  the notifications from the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;. Initially, its
+  value must be null. On getting, it must return its value. On
+  setting, its value must be set to the new value, and then the user
+  agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to call the &lt;code title=dom-listener-initialize&gt;&lt;a href=#dom-listener-initialize&gt;initalize()&lt;/a&gt;&lt;/code&gt; method with the
+  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element as its only argument.&lt;/p&gt;
 
-     &lt;pre&gt;&lt;datagrid&gt;
- &lt;select&gt;
-  &lt;!-- the options and optgroups have had their labels and values removed
-       to make the underlying structure clearer --&gt;
-  &lt;optgroup&gt;
-   &lt;option/&gt;
-   &lt;option/&gt;
-  &lt;/optgroup&gt;
-  &lt;optgroup&gt;
-   &lt;option/&gt;
-   &lt;optgroup id=&quot;a&quot;&gt;
-    &lt;option/&gt;
-    &lt;option/&gt;
-    &lt;bogus/&gt;
-    &lt;option id=&quot;b&quot;/&gt;
-   &lt;/optgroup&gt;
-   &lt;option/&gt;
-  &lt;/optgroup&gt;
- &lt;/select&gt;
-&lt;/datagrid&gt;&lt;/pre&gt;
 
-     &lt;p&gt;The path &quot;1,1,2&quot; would select the element with ID &quot;b&quot;. In the
-     filtered view, the text nodes, comment nodes, and bogus elements
-     are ignored; so for instance, the element with ID &quot;a&quot; (path
-     &quot;1,1&quot;) has only 3 child nodes in the view.&lt;/p&gt;
+  &lt;h6 id=the-columns&gt;&lt;span class=secno&gt;4.11.2.2.2 &lt;/span&gt;The columns&lt;/h6&gt;
 
-    &lt;/div&gt;
+  &lt;p&gt;The columns are represented by the &lt;dfn id=column-list&gt;column list&lt;/dfn&gt;, an
+  ordered list of entries for columns, each of which consists of:&lt;/p&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must drill through the view to find the
-    element corresponding to the method's argument, and return the
-    number of child nodes in the filtered view that the corresponding
-    element has. (If the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is empty, the
-    corresponding element is the &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt; element at the
-    root of the filtered view.)&lt;/p&gt;
+  &lt;dl&gt;&lt;dt&gt;An identifier&lt;/dt&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;getChildAtPosition(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must
-    return &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;. (The
-    &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt;/&lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; default data provider
-    does not support sorting the data grid.)&lt;/p&gt;
+   &lt;dd&gt;A string used to identify the column in the API.&lt;/dd&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getRowImage&gt;&lt;a href=#dom-provider-getrowimage&gt;getRowImage(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must return the empty string, &lt;code title=dom-provider-getRowMenu&gt;&lt;a href=#dom-provider-getrowmenu&gt;getRowMenu(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must return null.&lt;/p&gt;
+   &lt;dt&gt;A label&lt;/dt&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getRowClasses&gt;&lt;a href=#dom-provider-getrowclasses&gt;getRowClasses(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must add the
-    classes from the following list to &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;
-    when their condition is met:&lt;/p&gt;
+   &lt;dd&gt;A string used in the user interface.&lt;/dd&gt;
 
-    &lt;ul&gt;&lt;li&gt;If the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element is an
-     &lt;code&gt;&lt;a href=#the-optgroup-element&gt;optgroup&lt;/a&gt;&lt;/code&gt; element: &lt;code title=datagrid-row-class-header&gt;&lt;a href=#datagrid-row-class-header&gt;header&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+   &lt;dt&gt;A type&lt;/dt&gt;
 
-     &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element
-     contains other elements that are also in the view, and the
-     element's &lt;code title=attr-class&gt;&lt;a href=#classes&gt;class&lt;/a&gt;&lt;/code&gt; attribute
-     contains the &lt;code title=&quot;&quot;&gt;closed&lt;/code&gt; class: &lt;code title=datagrid-row-class-initially-closed&gt;&lt;a href=#datagrid-row-class-initially-closed&gt;initially-closed&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+   &lt;dd&gt;One of the types described below.&lt;/dd&gt;
 
-     &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element
-     contains other elements that are also in the view, and the
-     element's &lt;code title=attr-class&gt;&lt;a href=#classes&gt;class&lt;/a&gt;&lt;/code&gt; attribute
-     contains the &lt;code title=&quot;&quot;&gt;open&lt;/code&gt; class: &lt;code title=datagrid-row-class-initially-open&gt;&lt;a href=#datagrid-row-class-initially-open&gt;initially-open&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+   &lt;dt&gt;An icon&lt;/dt&gt;
 
-    &lt;/ul&gt;&lt;p&gt;The &lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;cell&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; method must
-    return the value of the &lt;code title=attr-optgroup-label&gt;&lt;a href=#attr-optgroup-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute if the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element is an
-    &lt;code&gt;&lt;a href=#the-optgroup-element&gt;optgroup&lt;/a&gt;&lt;/code&gt; element, otherwise, if the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element is an
-    &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt;element, its &lt;code title=attr-option-label&gt;&lt;a href=#attr-option-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute if it has one,
-    otherwise the value of its &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; DOM
-    attribute.&lt;/p&gt;
+   &lt;dd&gt;An image, copied from an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element when the
+   column was declared.&lt;/dd&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellClasses&gt;&lt;a href=#dom-provider-getcellclasses&gt;getCellClasses(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;cell&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; method must add no classes.&lt;/p&gt;
+   &lt;dt&gt;Whether the column is sortable&lt;/dt&gt;
 
-    &lt;p class=XXX&gt;&lt;!-- select-provider-selection
-    XXX--&gt;autoselect some rows when initialized, reflect the selection
-    in the select, reflect the multiple attribute somehow.&lt;/p&gt;
+   &lt;dd&gt;A boolean indicating whether the user can request that the data
+   be sorted by this column (true), or not (false).&lt;/dd&gt;
 
-    &lt;p&gt;The data provider must call the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s update
-    methods appropriately whenever the descendants of the
-    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; mutate.&lt;/p&gt;
+   &lt;dt&gt;Whether the column is visible&lt;/dt&gt;
 
-   &lt;/dd&gt;
+   &lt;dd&gt;A boolean indicating whether the column is part of the
+   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s rendering.&lt;/dd&gt;
 
+  &lt;/dl&gt;&lt;p&gt;Initially, the &lt;a href=#column-list&gt;column list&lt;/a&gt; must have a single
+  column, the &lt;dfn id=default-column&gt;default column&lt;/dfn&gt;, whose identifier is the empty
+  string, whose label is the empty string, whose type is &lt;code title=datagrid-type-text&gt;&lt;a href=#datagrid-type-text&gt;text&lt;/a&gt;&lt;/code&gt;, with no icon, which is not
+  sortable, and which &lt;em&gt;is&lt;/em&gt; visible.&lt;/p&gt;
 
-   &lt;dt&gt;While the first element child is another element&lt;/dt&gt;
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-addcolumn title=dom-datagrid-addColumn&gt;&lt;code&gt;addColumn(&lt;var title=&quot;&quot;&gt;id&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;label&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;icon&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sortable&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;visible&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
+  method must run the following steps:&lt;/p&gt;
 
-   &lt;dd&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is already an entry in &lt;a href=#column-list&gt;column list&lt;/a&gt;,
+   other than the &lt;a href=#default-column&gt;default column&lt;/a&gt;, whose identifier is
+   &lt;var title=&quot;&quot;&gt;id&lt;/var&gt;, throw a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt;
+   exception and abort these steps.&lt;/li&gt;
 
-    &lt;p&gt;The default data provider must return 1 for the column count,
-    the empty string for the column's caption, and must not add any
-    classes to the column's classes.&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;For the rows, assume the existence of a node filter view of the
-    descendants of the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; that skips all nodes
-    other than &lt;code&gt;&lt;a href=#the-li-element&gt;li&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt;, and
-    &lt;code&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt; elements, and skips any descendants of
-    &lt;code&gt;&lt;a href=#menus&gt;menu&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not a string equal to one of the
+    &lt;a href=#allowed-datagrid-column-types&gt;allowed &lt;code&gt;datagrid&lt;/code&gt; column types&lt;/a&gt;, then
+    throw a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception and abort these
+    steps.&lt;/p&gt;
 
-    &lt;p&gt;Given this view, each element in the view represents a row in
-    the data model. The element corresponding to a path &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is the one obtained by drilling into the view,
-    taking the child given by the path each time. The element of the
-    row of a particular method call is the element given by drilling
-    into the view along the path given by the method's arguments.&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must return the number of child
-    elements in this view for the given row, or the number of elements
-    at the root of the view if the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is
-    empty.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;icon&lt;/var&gt; argument is present and not
+   null, and the given &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element's &lt;code title=dom-img-complete&gt;&lt;a href=#dom-img-complete&gt;complete&lt;/a&gt;&lt;/code&gt; attribute is false, then
+   throw an &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception and abort these
+   steps.&lt;/li&gt;
 
-    &lt;div class=example&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;icon&lt;/var&gt; argument is present and not
+   null, then copy the image data from that &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element,
+   and let &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; be the copy of that image
+   data. Otherwise, let &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; be nothing.&lt;/li&gt;
 
-     &lt;p&gt;In the following example, the elements are identified by the
-     paths given by their child text nodes:&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Append a new entry to the &lt;a href=#column-list&gt;column list&lt;/a&gt;, with
+   &lt;var title=&quot;&quot;&gt;id&lt;/var&gt; as its identifier, &lt;var title=&quot;&quot;&gt;label&lt;/var&gt;
+   as its label, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; as its type, and &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; as its icon. Let the column be sortable if the
+   &lt;var title=&quot;&quot;&gt;sortable&lt;/var&gt; argument is present and true, and make
+   it visible if the &lt;var title=&quot;&quot;&gt;visible&lt;/var&gt; argument is absent or
+   true.&lt;/li&gt;
 
-     &lt;pre&gt;&lt;datagrid&gt;
- &lt;ol&gt;
-  &lt;li&gt; row 0 &lt;/li&gt;
-  &lt;li&gt; row 1
-   &lt;ol&gt;
-    &lt;li&gt; row 1,0 &lt;/li&gt;
-   &lt;/ol&gt;
-  &lt;/li&gt;
-  &lt;li&gt; row 2 &lt;/li&gt;
- &lt;/ol&gt;
-&lt;/datagrid&gt;&lt;/pre&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;a href=#column-list&gt;column list&lt;/a&gt; contains the &lt;a href=#default-column&gt;default
+   column&lt;/a&gt;, then remove the &lt;a href=#default-column&gt;default column&lt;/a&gt; from the
+   &lt;a href=#column-list&gt;column list&lt;/a&gt;, discard any data for cells in that column
+   in any rows in the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, set &lt;code title=dom-datagrid-sortColumn&gt;&lt;a href=#dom-datagrid-sortcolumn&gt;sortColumn&lt;/a&gt;&lt;/code&gt; to &lt;var title=&quot;&quot;&gt;id&lt;/var&gt;, set &lt;code title=dom-datagrid-sortAscending&gt;&lt;a href=#dom-datagrid-sortascending&gt;sortAscending&lt;/a&gt;&lt;/code&gt; to true,
+   and run the &lt;a href=#datagrid-resort-steps&gt;&lt;code&gt;datagrid&lt;/code&gt; resort
+   steps&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;p&gt;In this example, only the &lt;code&gt;&lt;a href=#the-li-element&gt;li&lt;/a&gt;&lt;/code&gt; elements actually
-     appear in the data grid; the &lt;code&gt;&lt;a href=#the-ol-element&gt;ol&lt;/a&gt;&lt;/code&gt; element does not
-     affect the data grid's processing model.&lt;/p&gt;
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-sortcolumn title=dom-datagrid-sortColumn&gt;&lt;code&gt;sortColumn&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute gives the current column used for sorting.  Initially, its
+  value must be the empty string. On getting, it must return its
+  current value. On setting, if the new value doesn't match the
+  identifier of one of the columns in the &lt;a href=#column-list&gt;column list&lt;/a&gt;,
+  then the user agent must throw a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt;
+  exception. Otherwise, if the new value is not the same as its
+  current value, then the user agent must set the attribute to the new
+  value, and then run the &lt;a href=#datagrid-resort-steps&gt;&lt;code&gt;datagrid&lt;/code&gt; resort
+  steps&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;/div&gt;
+  &lt;p&gt;The &lt;dfn id=dom-datagrid-sortascending title=dom-datagrid-sortAscending&gt;&lt;code&gt;sortAscending&lt;/code&gt;&lt;/dfn&gt;
+  DOM attribute specifies the direction that the tree is sorted in,
+  ascending (true) or descending (false). Initially, its value must be
+  true (ascending). On getting, it must return its current value. On
+  setting, if the new value is not the same as its current value, then
+  the user agent must set the attribute to the new value, and then run
+  the &lt;a href=#datagrid-resort-steps&gt;&lt;code&gt;datagrid&lt;/code&gt; resort steps&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;getChildAtPosition(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must
-    return &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;. (The generic default data
-    provider does not support sorting the data grid.)&lt;/p&gt;
+  &lt;p&gt;When a column is marked as being sortable, the user agent should
+  allow the user to select that column to be the column used for
+  sorting, and should allow the user to chose whether the sort order
+  is ascending or descending.&lt;/p&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getRowImage&gt;&lt;a href=#dom-provider-getrowimage&gt;getRowImage(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must return the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
-    obtained from &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the
-    value of the &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute of
-    the first &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element descendant (in the real DOM) of
-    the row's element, that is not also a descendant of another
-    element in the filtered view that is a descendant of the row's
-    element, if such an element exists and resolving its attribute
-    relative to the element itself, is successful. Otherwise, it must
-    return the empty string.&lt;/p&gt; &lt;!-- note that if the base URL has
-    changed, this URL can be different than the one that the &lt;img&gt;
-    element fetched when it was created --&gt;
+  &lt;p&gt;When the user changes the sort order in this manner, the user
+  agent must update the &lt;code title=dom-datagrid-sortColumn&gt;&lt;a href=#dom-datagrid-sortcolumn&gt;sortColumn&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-datagrid-sortAscending&gt;&lt;a href=#dom-datagrid-sortascending&gt;sortAscending&lt;/a&gt;&lt;/code&gt; attributes
+  appropriately, and then run the &lt;a href=#datagrid-resort-steps&gt;&lt;code&gt;datagrid&lt;/code&gt; resort
+  steps&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;div class=example&gt;
+  &lt;p class=note&gt;The &lt;a href=#datagrid-resort-steps&gt;&lt;code&gt;datagrid&lt;/code&gt; resort steps&lt;/a&gt;
+  are described in the next section.&lt;/p&gt;
 
-     &lt;p&gt;In the following example, the row with path &quot;1,0&quot; returns
-     &quot;<A HREF="http://example.com/a">http://example.com/a</A>&quot; as its image URL, and the other rows
-     (including the row with path &quot;1&quot;) return the empty string:&lt;/p&gt;
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-clearcolumns title=dom-datagrid-clearColumns&gt;&lt;code&gt;clearColumns()&lt;/code&gt;&lt;/dfn&gt;
+  method, if the &lt;a href=#column-list&gt;column list&lt;/a&gt; doesn't contain the
+  &lt;a href=#default-column&gt;default column&lt;/a&gt;, must empty the &lt;a href=#column-list&gt;column
+  list&lt;/a&gt;, append the &lt;a href=#default-column&gt;default column&lt;/a&gt; to the now empty
+  &lt;a href=#column-list&gt;column list&lt;/a&gt;, discard any data for cells in all rows in
+  the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, set &lt;code title=dom-datagrid-sortColumn&gt;&lt;a href=#dom-datagrid-sortcolumn&gt;sortColumn&lt;/a&gt;&lt;/code&gt; to the empty
+  string, set &lt;code title=dom-datagrid-sortAscending&gt;&lt;a href=#dom-datagrid-sortascending&gt;sortAscending&lt;/a&gt;&lt;/code&gt; to true, and
+  run the &lt;a href=#datagrid-resort-steps&gt;&lt;code&gt;datagrid&lt;/code&gt; resort steps&lt;/a&gt;. (If the
+  &lt;a href=#column-list&gt;column list&lt;/a&gt; is already just the &lt;a href=#default-column&gt;default
+  column&lt;/a&gt;, then the method does nothing.)&lt;/p&gt;
 
-     &lt;pre&gt;&lt;datagrid&gt;
- &lt;ol&gt;
-  &lt;li&gt; row 0 &lt;/li&gt;
-  &lt;li&gt; row 1
-   &lt;ol&gt;
-    &lt;li&gt; row 1,0 &lt;img src=&quot;<A HREF="http://example.com/a">http://example.com/a</A>&quot; alt=&quot;&quot;&gt; &lt;/li&gt;
-   &lt;/ol&gt;
-  &lt;/li&gt;
-  &lt;li&gt; row 2 &lt;/li&gt;
- &lt;/ol&gt;
-&lt;/datagrid&gt;&lt;/pre&gt;
 
-    &lt;/div&gt;
+  &lt;h6 id=the-rows&gt;&lt;span class=secno&gt;4.11.2.2.3 &lt;/span&gt;The rows&lt;/h6&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getRowMenu&gt;&lt;a href=#dom-provider-getrowmenu&gt;getRowMenu(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must return the first &lt;code&gt;&lt;a href=#menus&gt;menu&lt;/a&gt;&lt;/code&gt;
-    element descendant (in the real DOM) of the row's element, that is
-    not also a descendant of another element in the filtered view that
-    is a descendant of the row's element. (This is analogous to the
-    image case above.)&lt;/p&gt;
+  &lt;p&gt;A &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element is intended to show a
+  representation of a tree, where typically the user only sees a
+  small part of the tree at a time.&lt;/p&gt;
 
-    &lt;p&gt;&lt;code title=dom-provider-getRowClasses&gt;&lt;a href=#dom-provider-getrowclasses&gt;getRowClasses(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; must add the
-    classes from the following list to &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;
-    when their condition is met:&lt;/p&gt;
+  &lt;p&gt;To make this efficent, the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element
+  &lt;em&gt;actually&lt;/em&gt; shows a small part of a &lt;em&gt;sparse&lt;/em&gt; tree, so
+  that only relevant parts of the data structure need be loaded at any
+  time. Specifically, the model requires only that all the ancestor
+  rows of the displayed rows be loaded, as well as any open earlier
+  siblings (in the displayed sort order) of the displayed rows.&lt;/p&gt;
 
-    &lt;ul&gt;&lt;li&gt;If the row's element contains other elements that are also in
-     the view, and the element's &lt;code title=attr-class&gt;&lt;a href=#classes&gt;class&lt;/a&gt;&lt;/code&gt;
-     attribute contains the &lt;code title=&quot;&quot;&gt;closed&lt;/code&gt; class: &lt;code title=datagrid-row-class-initially-closed&gt;&lt;a href=#datagrid-row-class-initially-closed&gt;initially-closed&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+  &lt;p&gt;Conceptually, therefore, a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; has a number of
+  related sparse data structures backing it.&lt;/p&gt;
 
-     &lt;li&gt;If the row's element contains other elements that are also in
-     the view, and the element's &lt;code title=attr-class&gt;&lt;a href=#classes&gt;class&lt;/a&gt;&lt;/code&gt;
-     attribute contains the &lt;code title=&quot;&quot;&gt;open&lt;/code&gt; class: &lt;code title=datagrid-row-class-initially-open&gt;&lt;a href=#datagrid-row-class-initially-open&gt;initially-open&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+  &lt;p&gt;The first is the &lt;dfn id=natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/dfn&gt;. This
+  is the structure in which rows are entered as they are declared, in
+  their natural order. This can differ from the order actually
+  displayed to the user. It consists of nested sparse lists of
+  rows. In the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt;, a row will
+  always have all its parents already declared. Once a row is added to
+  this structure, it can only be removed by the &lt;code title=dom-datagrid-deleteRows&gt;&lt;a href=#dom-datagrid-deleterows&gt;deleteRows()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-datagrid-clearRows&gt;&lt;a href=#dom-datagrid-clearrows&gt;clearRows()&lt;/a&gt;&lt;/code&gt; methods. The order of
+  nodes in this tree never changes; to move a node in this tree, it
+  has to be removed and then another row (with the same data)
+  reinserted elsewhere.&lt;/p&gt;
 
-     &lt;li&gt;If the row's element is an &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt;
-     element: &lt;code title=datagrid-row-class-header&gt;&lt;a href=#datagrid-row-class-header&gt;header&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+  &lt;p&gt;The second structure is the &lt;dfn id=display-order-sparse-data-tree&gt;display order sparse data
+  tree&lt;/dfn&gt;. This is a similar structure that contains a subset of
+  the rows in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt;, ordered
+  in the order given by the &lt;code title=dom-datagrid-sortAscending&gt;&lt;a href=#dom-datagrid-sortascending&gt;sortAscending&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-datagrid-sortColumn&gt;&lt;a href=#dom-datagrid-sortcolumn&gt;sortColumn&lt;/a&gt;&lt;/code&gt; attributes, and
+  excluding rows with one or more ancestors that are closed. This tree
+  is cleared whenever the &lt;code title=dom-datagrid-sortAscending&gt;&lt;a href=#dom-datagrid-sortascending&gt;sortAscending&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-datagrid-sortColumn&gt;&lt;a href=#dom-datagrid-sortcolumn&gt;sortColumn&lt;/a&gt;&lt;/code&gt; attributes
+  change.&lt;/p&gt;
 
-     &lt;li&gt;If the row's element is an &lt;code&gt;&lt;a href=#the-hr-element&gt;hr&lt;/a&gt;&lt;/code&gt; element: &lt;code title=datagrid-row-class-separator&gt;&lt;a href=#datagrid-row-class-separator&gt;separator&lt;/a&gt;&lt;/code&gt;&lt;/li&gt; &lt;!--
-     XXX no way to get selectable-separator --&gt;
+  &lt;p&gt;The third structure is the &lt;dfn id=display-order-sparse-data-list&gt;display order sparse data
+  list&lt;/dfn&gt;. This structure is a flattened representation of the
+  &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data tree&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;/ul&gt;&lt;p&gt;The &lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;, &lt;code title=dom-provider-getCellClasses&gt;&lt;a href=#dom-provider-getcellclasses&gt;getCellClasses(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;, &lt;code title=dom-provider-setCellCheckedState&gt;&lt;a href=#dom-provider-setcellcheckedstate&gt;getCellCheckedState(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;, &lt;code title=dom-provider-cycleCell&gt;&lt;a href=#dom-provider-cyclecell&gt;cycleCell(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;,
-    &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;, and &lt;code title=dom-provider-editCell&gt;&lt;a href=#dom-provider-editcell&gt;editCell(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt; methods must
-    act as described in &lt;a href=#commonDefaultDataGridMethodDefinitions&gt;the common
-    definitions below&lt;/a&gt;, treating the row's element as being the
-    cell's element.&lt;/p&gt;
+  &lt;p&gt;At any time, a number of consecutive rows in the &lt;a href=#display-order-sparse-data-list&gt;display
+  order sparse data list&lt;/a&gt; are physically visible to the
+  user. The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; fires notifications to a &lt;a href=#dom-datagrid-listener title=dom-datagrid-listener&gt;listener&lt;/a&gt; (provided by script),
+  and the listener, or other some script, is expected to feed the
+  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; with the information needed to render the
+  control.&lt;/p&gt;
 
-    &lt;p class=XXX id=generic-provider-selection&gt;selection
-    handling?&lt;/p&gt;
+  &lt;p&gt;A &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; has a &lt;dfn id=pending-datagrid-rows-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt;
+  rows list&lt;/dfn&gt;, which is a list of rows in the &lt;a href=#display-order-sparse-data-list&gt;display order
+  sparse data list&lt;/a&gt; for which the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; has sent
+  notifications requesting information but not yet received
+  information about.&lt;/p&gt;
 
-    &lt;p&gt;The data provider must call the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s update
-    methods appropriately whenever the descendants of the
-    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; mutate.&lt;/p&gt;
+  &lt;p&gt;A &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; also has a &lt;dfn id=pending-datagrid-cells-list&gt;pending
+  &lt;code&gt;datagrid&lt;/code&gt; &lt;em&gt;cells&lt;/em&gt; list&lt;/dfn&gt;, which is a list of
+  row/column pairs (cells) for which the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; has
+  sent notifications requesting information but not yet received
+  information about.&lt;/p&gt;
 
-   &lt;/dd&gt;
+  &lt;p&gt;User agents may discard information about rows that are not
+  displayed and that are not ancestors or open earlier siblings of
+  rows or ancestors of rows that are displayed.&lt;/p&gt;
 
+  &lt;hr&gt;&lt;p&gt;These structures are different views of the collection of rows
+  that form the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;. Each row has the following
+  information associated with it:&lt;/p&gt;
 
-   &lt;dt&gt;Otherwise, while there is no element child&lt;/dt&gt;
+  &lt;dl&gt;&lt;dt&gt;A parent&lt;/dt&gt;
 
+   &lt;dd&gt;&lt;p&gt;Either another row, or the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; itself. This
+   is the parent of the row in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data
+   tree&lt;/a&gt; and the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data tree&lt;/a&gt;
+   for the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/dd&gt;
+
+   &lt;dt&gt;A natural order position relative to the other rows with the
+   same parent&lt;/dt&gt;
+
    &lt;dd&gt;
 
-    &lt;p&gt;The data provider must return 0 for the number of rows, 1 for
-    the number of columns, the empty string for the first column's
-    caption, and must add no classes when asked for that column's
-    classes. If the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s child list changes such
-    that there is a first element child, then the data provider must
-    call the &lt;code title=dom-datagrid-updateEverything&gt;&lt;a href=#dom-datagrid-updateeverything&gt;updateEverything()&lt;/a&gt;&lt;/code&gt;
-    method on the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+    &lt;p&gt;This is the number of rows that precede this row under the same
+    parent in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt;. This
+    number can't be changed relative to other rows in the same parent;
+    to change the relative natural order of data in the
+    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, the original rows have to be removed and
+    new rows (with the same data but different natural positions)
+    inserted in their place. (The exact number of a row can change, as
+    new rows can be inserted above it.)&lt;/p&gt;
 
+    &lt;p&gt;A row can be identified by a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object. This is
+    an array of numbers, consisting of the natural order positions of
+    each ancestor row and the row itself, starting from the furthest
+    ancestor. Thus, for instance, the fourth child row of the first
+    child row of the second row in a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; would be
+    identified by a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object whose value is &lt;code title=&quot;&quot;&gt;[1, 0, 3]&lt;/code&gt;. A row's identifier changes if rows are
+    &lt;a href=#dom-datagrid-insertrows title=dom-datagrid-insertRows&gt;inserted before it&lt;/a&gt; in
+    the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-  &lt;/dl&gt;&lt;h6 id=commonDefaultDataGridMethodDefinitions&gt;&lt;span class=secno&gt;4.11.2.4.1 &lt;/span&gt;Common default data
-  provider method definitions for cells&lt;/h6&gt;
+   &lt;dt&gt;A display order position relative to the other rows with
+   the same parent&lt;/dt&gt;
 
-  &lt;p&gt;These definitions are used for the cell-specific methods of the
-  default data providers (other than in the
-  &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt;/&lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; case).  How they behave is
-  based on the contents of an element that represents the cell given
-  by their first two arguments. Which element that is is defined in
-  the previous section.&lt;/p&gt;
+   &lt;dd&gt;&lt;p&gt;This is the number of rows that precede this row under the
+   same parent in the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data
+   tree&lt;/a&gt;. This number can be unknown. If the sort order
+   changes, then this information is lost (as the &lt;a href=#display-order-sparse-data-tree&gt;display order
+   sparse data tree&lt;/a&gt; is cleared).&lt;/dd&gt;
 
-  &lt;dl&gt;&lt;dt&gt;Cyclable cells&lt;/dt&gt;
+   &lt;dt&gt;A child count&lt;/dt&gt;
 
+   &lt;dd&gt;&lt;p&gt;The number of rows that have this row as a parent. If this is
+   zero, the row cannot be opened. If this is &minus;1, then the
+   child count is unknown but the row can be opened. This value can be
+   changed by the &lt;code title=dom-datagrid-setRows&gt;&lt;a href=#dom-datagrid-setrows&gt;setRows()&lt;/a&gt;&lt;/code&gt;
+   method only if the current value is &minus;1 or if the row or one
+   of its ancestors is closed. Otherwise, it can only be changed
+   indirectly using the &lt;code title=dom-datagrid-insertRows&gt;&lt;a href=#dom-datagrid-insertrows&gt;insertRows()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-datagrid-deleteRows&gt;&lt;a href=#dom-datagrid-deleterows&gt;deleteRows()&lt;/a&gt;&lt;/code&gt; methods.&lt;/dd&gt;
+
+   &lt;dt&gt;An open flag&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;A boolean indicating whether the row is open (true) or
+   closed (false). Once set, can only be changed by the user or if one
+   of the row's ancestors is itself closed. A row can also be in a
+   third state, &quot;opening&quot;, which is treated as closed for all purposes
+   except that the user agent may indicate that the row is in this
+   special state, and except that when the row is updated to have a
+   row count, the row will switch to being open.&lt;/dd&gt;
+
+   &lt;dt&gt;A row count&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The number of rows that have this row as a parent or
+   ancestor, and that do not have an ancestor that is a descendant of
+   this row that is itself closed. If this is &minus;1, then the row
+   count is unknown. This value can be changed by the &lt;code title=dom-datagrid-setRows&gt;&lt;a href=#dom-datagrid-setrows&gt;setRows()&lt;/a&gt;&lt;/code&gt; method only if the
+   row or one of its ancestors is closed (or opening, but not
+   open). Otherwise, it can only be changed indirectly using the &lt;code title=dom-datagrid-insertRows&gt;&lt;a href=#dom-datagrid-insertrows&gt;insertRows()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-datagrid-deleteRows&gt;&lt;a href=#dom-datagrid-deleterows&gt;deleteRows()&lt;/a&gt;&lt;/code&gt;
+   methods.&lt;/dd&gt;
+
+   &lt;dt&gt;Cells&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The data that applies to this row. Cell data is discussed in
+   more detail below.&lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; itself also has a &lt;dfn id=datagrid-child-count title=&quot;datagrid
+  child count&quot;&gt;child count&lt;/dfn&gt; and a &lt;dfn id=datagrid-row-count title=&quot;datagrid row
+  count&quot;&gt;row count&lt;/dfn&gt;, which are analogous to the child counts and
+  row counts for rows. Initially these must be zero.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=datagrid-resort-steps&gt;&lt;code&gt;datagrid&lt;/code&gt; resort steps&lt;/dfn&gt;, which are
+  invoked when the sort order changes as described in the previous
+  section, are as follows:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;Clear the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data tree&lt;/a&gt;
+    (i.e. mark the display order position of all the rows in the
+    &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; as unknown).&lt;/p&gt;
+
+    &lt;p&gt;User agents may cache the position information of rows for
+    various values of &lt;code title=dom-datagrid-sortColumn&gt;&lt;a href=#dom-datagrid-sortcolumn&gt;sortColumn&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-datagrid-sortAscending&gt;&lt;a href=#dom-datagrid-sortascending&gt;sortAscending&lt;/a&gt;&lt;/code&gt;, instead
+    of discarding the information altogether. If the user agent caches
+    this information, and has information that applies to the current
+    values of &lt;code title=dom-datagrid-sortColumn&gt;&lt;a href=#dom-datagrid-sortcolumn&gt;sortColumn&lt;/a&gt;&lt;/code&gt;
+    and &lt;code title=dom-datagrid-sortAscending&gt;&lt;a href=#dom-datagrid-sortascending&gt;sortAscending&lt;/a&gt;&lt;/code&gt;,
+    then the user agent may repopulate the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse
+    data tree&lt;/a&gt; from this information.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Clear the &lt;a href=#pending-datagrid-rows-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/a&gt;
+    and the &lt;a href=#pending-datagrid-cells-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;a href=#datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;!-- v2: queue a task to fire an event, or tell the listener the
+   sort order changed, or something --&gt;
+
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-renotify title=dom-datagrid-renotify&gt;&lt;code&gt;renotify()&lt;/code&gt;&lt;/dfn&gt; method
+  must empty the &lt;a href=#pending-datagrid-rows-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/a&gt;
+  and the &lt;a href=#pending-datagrid-cells-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/a&gt;, and
+  invoke the &lt;a href=#datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+  algorithm&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-setrowcount title=dom-datagrid-setRowCount&gt;&lt;code&gt;setRowCount(&lt;var title=&quot;&quot;&gt;childCount&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;Set the &lt;a href=#datagrid-child-count&gt;&lt;code&gt;datagrid&lt;/code&gt; child count&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;childCount&lt;/var&gt;, the &lt;a href=#datagrid-row-count&gt;&lt;code&gt;datagrid&lt;/code&gt; row
+    count&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;a href=#audit-the-datagrid&gt;Audit the &lt;code&gt;datagrid&lt;/code&gt;&lt;/a&gt;. If this fails,
+    then revert the changes made in the previous step, throw a
+    &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception, and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;a href=#datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-setrows title=dom-datagrid-setRows&gt;&lt;code&gt;setRows(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;&lt;a href=#type-check-a-rowlist-object title=&quot;type-check a RowList object&quot;&gt;Type-check the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument&lt;/a&gt;. If this fails, throw a
+    &lt;code&gt;TypeError&lt;/code&gt; exception, and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;a href=#partially-sort-a-rowlist-object title=&quot;partially sort a RowList object&quot;&gt;Partially sort
+    the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object in the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument, in order, perform the appropriate
+    steps from the list below.&lt;/p&gt;
+
+    &lt;p class=note&gt;The changes made to the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s
+    data structures in this step get reverted (as required below) if
+    any consistency errors are detected either in this step or the
+    next.&lt;/p&gt;
+
+    &lt;dl&gt;&lt;dt&gt;If there already exists a row in the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s
+     &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt; with the same
+     identifier as given by the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's
+     &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object, and that row and all its ancestors are
+     open&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If one of the following conditions is true, then revert all
+      the changes done in this step, throw a
+      &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception, and abort these
+      steps:&lt;/p&gt;
+
+      &lt;ul&gt;&lt;li&gt;The value of the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's second entry is
+       neither &minus;1 nor equal to the child count of the
+       preexisting row.&lt;/li&gt;
+
+       &lt;li&gt;The &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object has fewer than five entries, or
+       its fifth entry is false.&lt;/li&gt;
+
+       &lt;li&gt;The &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object has fewer than six entries, or
+       its sixth entry is not equal to the row count of the
+       preexisting row.&lt;/li&gt;
+
+      &lt;/ul&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;If there already exists a row in the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s
+     &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt; with the same
+     identifier as given by the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's
+     &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object, but either that row or one of its
+     ancestors is closed&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;Set the preexisting row's child count to the value of the
+      &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's second entry.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object has five or more entries, and
+      either its fifth entry is true and the preexisting row is closed
+      but not opening, or its fifth entry is false and the preexisting
+      row is open, then: if the preexisting row has no ancestor row
+      that is closed, then revert all the changes done in this step,
+      throw a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception, and abort
+      these steps; otherwise, if the fifth entry is false, then close
+      the row; otherwise, open the row.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object has six entries, set the
+      preexisting row's row count to the value of the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt;
+      object's sixth entry.&lt;/p&gt;
+
+      &lt;p&gt;If the preexisting row is opening, then: increase the
+      &lt;a href=#datagrid-row-count&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/a&gt; and the row counts
+      of any ancestor rows by the number of rows that the preexisting
+      row now has in its row count, then open the row.&lt;/p&gt; &lt;!-- we
+      should also &quot;update the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows
+      list&lt;/span&gt; and the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells
+      list&lt;/span&gt; accordingly&quot; --&gt;
+
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;There does not exist a row in the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s
+     &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt; with the same
+     identifier as given by the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's
+     &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object has a length greater than 1,
+      then verify that there is a row identified by the
+      &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; consisting of all but the last number in the
+      &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;. If there is no
+      such row present in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data
+      tree&lt;/a&gt;, then revert all the changes done in this step,
+      throw a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception, and abort
+      these steps.&lt;/p&gt;
+
+      &lt;p&gt;Create a row and insert it into the &lt;a href=#natural-order-sparse-data-tree&gt;natural order
+      sparse data tree&lt;/a&gt;, such that its parent is the row
+      identified by the &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; consisting of all but the
+      last number in the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;,
+      or the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; if the lenght of the
+      &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; is 1; with its
+      natural order position being the last number of the
+      &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;; with the child
+      count being the value of the third entry of the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt;
+      object; with the row being marked closed unless the
+      &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object has five or more entries and its fifth
+      entry is true, in which case the row is open; and with its row
+      count being &minus;1 unless the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object has six
+      entries, in which case the row count is equal to the value of
+      the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's sixth entry.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;a href=#audit-the-datagrid&gt;Audit the &lt;code&gt;datagrid&lt;/code&gt;&lt;/a&gt;. If this fails,
+    then revert the changes made in the previous step, throw a
+    &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception, and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object in the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument, in order, &lt;a href=#apply-a-row-object title=&quot;apply a Row
+    object&quot;&gt;apply the &lt;code&gt;Row&lt;/code&gt; object&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;a href=#datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-insertrows title=dom-datagrid-insertRows&gt;&lt;code&gt;insertRows(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;&lt;a href=#type-check-a-rowlist-object title=&quot;type-check a RowList object&quot;&gt;Type-check the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument&lt;/a&gt;. If this fails, throw a
+    &lt;code&gt;TypeError&lt;/code&gt; exception, and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;a href=#partially-sort-a-rowlist-object title=&quot;partially sort a RowList object&quot;&gt;Partially sort
+    the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object in the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument, in order, run the following
+    steps:&lt;/p&gt;
+
+    &lt;p class=note&gt;The changes made to the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s
+    data structures in this step get reverted (as required below) if
+    any consistency errors are detected either in this step or the
+    next.&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; be the row identified by the
+      &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; consisting of all but the last number in the
+      &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;, or the
+      &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; itself it the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's
+      &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; has length 0.&lt;/p&gt;
+
+      &lt;p&gt;If there is no such row present in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order
+      sparse data tree&lt;/a&gt;, then revert all the changes done in
+      this algorithm, throw a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt;
+      exception, and abort these steps.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Increment by one the natural order position of all rows whose
+      parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; and whose natural order
+      position is equal to or greater than the last number of the
+      &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the value of the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's second entry is
+      not &minus;1, then increment by one the display order position
+      of all rows whose parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; and whose
+      display order position is equal to or greater than the value of
+      the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's second entry.&lt;/p&gt;
+
+     &lt;!--(Not sure how to really say this.)
+      &lt;p&gt;Update the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows
+      list&lt;/span&gt; and the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells
+      list&lt;/span&gt; accordingly.&lt;/p&gt;
+     --&gt;
+
+     &lt;/li&gt;
+ 
+     &lt;li&gt;
+
+      &lt;p&gt;Create a row and insert it into the &lt;a href=#natural-order-sparse-data-tree&gt;natural order
+      sparse data tree&lt;/a&gt;, such that its parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt;; with its natural order position being the
+      last number of the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;;
+      with the child count being the value of the third entry of the
+      &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object; with the row being marked closed unless
+      the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object has five or more entries and its
+      fifth entry is true, in which case the row is open; and with its
+      row count being &minus;1 unless the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object has
+      six entries, in which case the row count is equal to the value
+      of the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's sixth entry.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object in the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument, in order, &lt;a href=#apply-a-row-object title=&quot;apply a Row
+    object&quot;&gt;apply the &lt;code&gt;Row&lt;/code&gt; object&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;a href=#datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;When an algorithm requires the user agent to &lt;dfn id=type-check-a-rowlist-object&gt;type-check a
+  &lt;code&gt;RowList&lt;/code&gt; object&lt;/dfn&gt; (an array), each entry in the
+  object must be checked against the following requirements. If any
+  are false, then the type-check fails, otherwise it passes.&lt;/p&gt;
+
+  &lt;ul&gt;&lt;li&gt;&lt;p&gt;The entry is a &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object (an
+   array).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The first value in the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; is a
+   &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object (also an array), whose length is at least
+   1, and whose values are all integers greater than or equal to
+   zero.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The numbers in the &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object do not exactly
+   match any of the other entries in the &lt;code&gt;&lt;a href=#rowlist&gt;RowList&lt;/a&gt;&lt;/code&gt; object
+   (i.e. no two &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; objects have the same
+   identifier).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The second value in the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; is an integer that
+   is either &minus;1, zero, or a positive integer.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The third value in the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; is an integer that
+   is either &minus;1, zero, or a positive integer.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The fourth value in the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; is a
+   &lt;code&gt;&lt;a href=#celllist&gt;CellList&lt;/a&gt;&lt;/code&gt; object (yet another array).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Each entry in the &lt;a href=#celllist&gt;CellList&lt;/a&gt; object is a
+   &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object (again, an array).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Each &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object in the &lt;a href=#celllist&gt;CellList&lt;/a&gt;
+   object has as its first value a &lt;code&gt;&lt;a href=#column&gt;Column&lt;/a&gt;&lt;/code&gt; object (a
+   string), and its value is the identifier of one of the columns in
+   the &lt;a href=#column-list&gt;column list&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Each &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object in the &lt;a href=#celllist&gt;CellList&lt;/a&gt;
+    object has as its second and subsequent entries values that match
+    the following requirements, as determined by the type of the
+    column identified by the first entry:&lt;/p&gt;
+
+    &lt;dl&gt;&lt;dt&gt;If the column's type is &lt;code title=datagrid-type-text&gt;&lt;a href=#datagrid-type-text&gt;text&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+
+      &lt;p&gt;The second entry's value is a string, and either there are
+      only two entries, or there are three, and the third entry is
+      an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+
+      &lt;p&gt;If there is an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element specified, its &lt;code title=dom-img-complete&gt;&lt;a href=#dom-img-complete&gt;complete&lt;/a&gt;&lt;/code&gt; attribute is true.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-editable&gt;&lt;a href=#datagrid-type-editable&gt;editable&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+
+      &lt;p&gt;The second entry's value is a string, and either there are
+      only two entries, or the third entry is a
+      &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element, and either there are only three
+      entries, or there are four, and the fourth entry is an
+      &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+
+      &lt;p&gt;If there is an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element specified, its &lt;code title=dom-img-complete&gt;&lt;a href=#dom-img-complete&gt;complete&lt;/a&gt;&lt;/code&gt; attribute is true.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-checkable&gt;&lt;a href=#datagrid-type-checkable&gt;checkable&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+
+      &lt;p&gt;The second entry's value is a string, the third entry is a
+      boolean, and either there are only three entries, or the
+      fourth entry is also a boolean, and either there are only four
+      entries, or there are five, and the fifth entry is an
+      &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+
+      &lt;p&gt;If there is an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element specified, its &lt;code title=dom-img-complete&gt;&lt;a href=#dom-img-complete&gt;complete&lt;/a&gt;&lt;/code&gt; attribute is true.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-list&gt;&lt;a href=#datagrid-type-list&gt;list&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+
+      &lt;p&gt;The second entry's value is a string, the third entry is a
+      &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt; element, and either there are only three
+      entries, or there are four, and the fourth entry is an
+      &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+
+      &lt;p&gt;If there is an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element specified, its &lt;code title=dom-img-complete&gt;&lt;a href=#dom-img-complete&gt;complete&lt;/a&gt;&lt;/code&gt; attribute is true.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-progress&gt;&lt;a href=#datagrid-type-progress&gt;progress&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+
+      &lt;p&gt;There are only two entries, the second entry's value is a
+      number, and the number's value is between 0.0 and 1.0
+      inclusive.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-meter&gt;&lt;a href=#datagrid-type-meter&gt;meter&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+
+      &lt;p&gt;There are at least two, but possibly up to seven, entries,
+      all entries but the first one are numbers, and the following
+      relationships hold:&lt;/p&gt;
+
+      &lt;ul class=brief&gt;&lt;li&gt;The second entry is less than the third, or less than 1.0
+       if the third is absent.&lt;/li&gt;
+
+       &lt;li&gt;The second entry is greater than the fourth, or greater
+       than 0.0 if the fourth is absent.&lt;/li&gt;
+
+       &lt;li&gt;If there are at least three entries, the third entry is
+       greater than the fourth, or greater than zero if the fourth
+       is absent.&lt;/li&gt;
+
+       &lt;li&gt;If there are at least five entries, the fifth is not
+       greater than the third and not less than the fourth.&lt;/li&gt;
+
+       &lt;li&gt;If there are at least six entries, the sixth is not
+       greater than the third and not less than the fifth.&lt;/li&gt;
+
+       &lt;li&gt;If there are at least seven entries, the fifth is not
+       greater than the third and not less than the fourth.&lt;/li&gt;
+
+      &lt;/ul&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-custom&gt;&lt;a href=#datagrid-type-custom&gt;custom&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+
+      &lt;p&gt;There are four entries, the second and third are numbers
+      that are integers greater than zero, and the fourth is a
+      &lt;code&gt;Rendering2DContextCallback&lt;/code&gt; object (a
+      function).&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Either there are only four values in the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt;,
+   or the fifth value in the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; is a boolean.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Either there are only four or five values in the
+   &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt;, or there are six, and the sixth value in the
+   &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; an integer that is greater than or equal to
+   zero.&lt;/li&gt;
+
+  &lt;/ul&gt;&lt;p&gt;Where the above requirements say that a value is to be a string,
+  the user agent must apply the ToString() conversion operator to the
+  value, assume that the value was indeed a string, and use the result
+  in the rest of the algorithm as if it had that had been the value
+  passed to the method. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;Where the above requirements say that a value is to be a number,
+  the user agent must first apply the ToNumber() conversion operator
+  to the value, and then verify that the result is neither the
+  not-a-number NaN value nor an infinite value. If this result is
+  indeed acceptable (i.e. finite), the user agent must use the result
+  in the rest of the algorithm as if it had that had been the value
+  passed to the method. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;Where the above requirements say that a value is to be an
+  integer, the user agent must first apply the ToNumber() conversion
+  operator to the value, and then verify that the result is a finite
+  integer. If so, the user agent must use the result in the rest of
+  the algorithm as if it had that had been the value passed to the
+  method. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;Where the above requirements say that a value is to be a boolean,
+  the user agent must apply the ToBoolean() conversion operator to the
+  value, assume that the value was indeed a boolean, and use the
+  result in the rest of the algorithm as if it had that had been the
+  value passed to the method. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;When an algorithm requires the user agent to &lt;dfn id=audit-the-datagrid&gt;audit the
+  &lt;code&gt;datagrid&lt;/code&gt;&lt;/dfn&gt;, the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must be
+  checked against the following requirements. If any are false, then
+  the audit fails, otherwise it passes.&lt;/p&gt;
+
+  &lt;ul&gt;&lt;li&gt;There is no row whose natural order position is greater than or
+   equal to the child count of its parent row in the &lt;a href=#natural-order-sparse-data-tree&gt;natural
+   order sparse data tree&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;There is no row whose display order position is greater than or
+   equal to the child count of its parent row in the &lt;a href=#display-order-sparse-data-tree&gt;display
+   order sparse data tree&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;There is no row such that the sum of that row's child count and
+   the row counts all the open rows that are direct children of that
+   row in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt; is less than
+   that row's row count.&lt;/li&gt;
+
+   &lt;li&gt;Of the rows whose child count is equal to the number of rows
+   that are direct children of that row in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order
+   sparse data tree&lt;/a&gt;, there is none such that the sum of that
+   row's child count and the row counts of all the open rows that are
+   direct children of that row in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data
+   tree&lt;/a&gt; is greater than that row's row count.&lt;/li&gt;
+
+  &lt;/ul&gt;&lt;p&gt;For the purposes of this audit, the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must be
+  treated as the parent row of all the rows that are direct children
+  of the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; in the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data
+  tree&lt;/a&gt; and the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data tree&lt;/a&gt;. The
+  child count of this implied row is the &lt;a href=#datagrid-child-count&gt;&lt;code&gt;datagrid&lt;/code&gt;
+  child count&lt;/a&gt;, and the row count of this implied row is the
+  &lt;a href=#datagrid-row-count&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;When an algorithm requires the user agent to &lt;dfn id=partially-sort-a-rowlist-object&gt;partially sort
+  a &lt;code&gt;RowList&lt;/code&gt; object&lt;/dfn&gt; (an array), the entries in the
+  object must be resorted such that &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; objects are
+  listed after any of their ancestors and after any of their earlier
+  siblings. In other words, for any two &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; objects &lt;var title=&quot;&quot;&gt;a&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;b&lt;/var&gt; in the
+  &lt;code&gt;&lt;a href=#rowlist&gt;RowList&lt;/a&gt;&lt;/code&gt;, where &lt;var title=&quot;&quot;&gt;a&lt;/var&gt; is before &lt;var title=&quot;&quot;&gt;b&lt;/var&gt; after the sort, the following conditions must
+  hold:&lt;/p&gt;
+
+  &lt;ul&gt;&lt;li&gt;&lt;p&gt;If their &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; objects are the same length and
+   have values that are equal except for the last value, then the last
+   value of &lt;var title=&quot;&quot;&gt;a&lt;/var&gt;'s &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;'s last value
+   must be less than &lt;var title=&quot;&quot;&gt;b&lt;/var&gt;'s &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;'s last
+   value (i.e. earlier siblings must come before their later
+   siblings).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If their &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; objects are not the same length,
+   but the values in the shorter of the two are the same as the first
+   few values in the longer one, then &lt;var title=&quot;&quot;&gt;a&lt;/var&gt;'s
+   &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; must be the shorter one (i.e. ancestors must
+   come before their descendants).&lt;/li&gt;
+
+  &lt;/ul&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-deleterows title=dom-datagrid-deleteRows&gt;&lt;code&gt;deleteRows(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;If any of the entries in &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; are not
+    &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; objects consisting of one or more entries whose
+    values are all integers that are greater than or equal to zero,
+    then throw a &lt;code&gt;TypeError&lt;/code&gt; exception and abort these
+    steps.&lt;/p&gt;
+
+    &lt;p&gt;To check if a value is an integer, the user agent must first
+    apply the ToNumber() conversion operator to the value, and then
+    verify that the result is a finite integer. If so, the user agent
+    must use the result in the rest of the algorithm as if it had that
+    had been the value passed to the method. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If any of the &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; objects in the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument identify a row that isn't present in
+    the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt;, then throw a
+    &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If any row is listed twice in the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;
+    argument, then throw a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception
+    and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Sort the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument such that the
+    entries are given in the same order as the rows they identify
+    would be visited in a pre-order, depth first traversal of the
+    &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each row identified by entries in &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;,
+    &lt;em&gt;in reverse order&lt;/em&gt;, run the following steps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;
+
+      &lt;p&gt;Decrement the child count of the row's parent row, if that
+      child count is greater than zero. If the row has no parent,
+      decrement the &lt;a href=#datagrid-child-count&gt;&lt;code&gt;datagrid&lt;/code&gt; child
+      count&lt;/a&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If the row has a parent row, and its child count is now zero,
+      then close that row.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be one more than the row's row
+      count if the row is open and its row count is greater than zero;
+      otherwise, let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be one.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt; be the row.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;&lt;i&gt;Row count loop:&lt;/i&gt; Let &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt; be
+      &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt;'s parent row, if any, or null if it
+      has none.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt; is null, then decrement the
+      &lt;a href=#datagrid-row-count&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/a&gt; by &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;. Otherwise, if &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt;
+      is open, then decrement its row count by &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt; is not null, then jump back
+      to the step labeled &lt;i&gt;row count loop&lt;/i&gt; above.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; be the row's parent, or the
+      &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; if the row has no parent.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Decrement by one the natural order position of all rows whose
+      parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; and whose natural order
+      position is equal to or greater than the row's own natural order
+      position.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the row is in the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data
+      tree&lt;/a&gt;, then decrement by one the display order position of
+      all rows whose parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; and whose
+      display order position is equal to or greater than the row's own
+      display order position.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Clear the row and its descendants from the
+      &lt;code&gt;&lt;a href=#datagrid&gt;Datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;a href=#datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-clearrows title=dom-datagrid-clearRows&gt;&lt;code&gt;clearRows()&lt;/code&gt;&lt;/dfn&gt; method
+  must empty the &lt;a href=#natural-order-sparse-data-tree&gt;natural order sparse data tree&lt;/a&gt;, reset
+  both the &lt;a href=#datagrid-child-count&gt;&lt;code&gt;datagrid&lt;/code&gt; child count&lt;/a&gt; and the
+  &lt;a href=#datagrid-row-count&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/a&gt; to zero, and invoke the
+  &lt;a href=#datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt; update display algorithm&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-datagrid-repaint title=dom-datagrid-repaint&gt;&lt;code&gt;repaint(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
+  must cause the user agent to clear its cache for the cell specified
+  by the identifier &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; and the column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, if that column's type is &lt;code title=datagrid-type-custom&gt;&lt;a href=#datagrid-type-custom&gt;custom&lt;/a&gt;&lt;/code&gt;. If the given column has
+  not been declared, or its type is not &lt;code title=datagrid-type-custom&gt;&lt;a href=#datagrid-type-custom&gt;custom&lt;/a&gt;&lt;/code&gt;, then the user agent must
+  throw a &lt;code&gt;&lt;a href=#datagrid_model_err&gt;DATAGRID_MODEL_ERR&lt;/a&gt;&lt;/code&gt; exception. If the given row
+  is not known, then the method must do nothing. If the cell is indeed
+  cleared, the user agent must reinvoke the previously registered
+  &lt;code&gt;&lt;a href=#renderingcontext2dcallback&gt;RenderingContext2DCallback&lt;/a&gt;&lt;/code&gt; callback when it needs to
+  repaint that row.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;If a row has a child count that isn't zero, then the user agent
+  should offer to the user the option of opening and closing the
+  row.&lt;/p&gt;
+
+  &lt;p&gt;When a row is opened, if the row's row count is greater than
+  zero, then the user agent must increase the
+  &lt;a href=#datagrid-row-count&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/a&gt; and the row counts of
+  any ancestor rows by the number of rows that the newly opened row
+  has in its row count&lt;!-- we should also &quot;update the &lt;span&gt;pending
+  &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/span&gt; and the &lt;span&gt;pending
+  &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/span&gt; accordingly&quot; --&gt;, then must
+  mark the row as open, then may fill in the &lt;a href=#display-order-sparse-data-tree&gt;display order
+  sparse data tree&lt;/a&gt; with any information that the user agent has
+  cached about the display order positions of descendants of the newly
+  opened row, and then must invoke the &lt;code title=dom-listener-rowOpened&gt;&lt;a href=#dom-listener-rowopened&gt;rowOpened()&lt;/a&gt;&lt;/code&gt; method on the
+  current &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt; with as
+  its first argument a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object identifying the row
+  that was opened and as its second argument the boolean false, and
+  then must invoke the &lt;a href=#datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+  algorithm&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;On the other hand, when a row is opened and the row's row count
+  is &minus;1, then the user agent must mark the row as opening, and
+  then must invoke the &lt;code title=dom-listener-rowOpened&gt;&lt;a href=#dom-listener-rowopened&gt;rowOpened()&lt;/a&gt;&lt;/code&gt; method on the
+  current &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt; with as
+  its first argument a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object identifying the row
+  that was opened and as its second argument the boolean true.&lt;/p&gt;
+
+  &lt;p&gt;When a row is closed, the user agent must decrease the
+  &lt;a href=#datagrid-row-count&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/a&gt; and the row counts of
+  any ancestor rows by the number of rows that the newly closed row
+  has in its row count, and then must invoke the &lt;code title=dom-listener-rowOpened&gt;&lt;a href=#dom-listener-rowopened&gt;rowOpened()&lt;/a&gt;&lt;/code&gt; method on the
+  current &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt; with as
+  its first and only argument a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object identifying
+  the row that was opened.&lt;/p&gt;
+
+
+
+  &lt;h6 id=the-cells&gt;&lt;span class=secno&gt;4.11.2.2.4 &lt;/span&gt;The cells&lt;/h6&gt;
+
+  &lt;p&gt;Each row has one cell per column. Each cell has the same type as
+  its column. The &lt;dfn id=allowed-datagrid-column-types&gt;allowed &lt;code&gt;datagrid&lt;/code&gt; column
+  types&lt;/dfn&gt;, what they represent, and the requirements for when the
+  user interacts with them, are as follows:&lt;/p&gt;
+
+  &lt;dl&gt;&lt;dt&gt;&lt;dfn id=datagrid-type-text title=datagrid-type-text&gt;&lt;code&gt;text&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the first element child of a cell's element is a
-    &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt; element that has a no &lt;code title=attr-select-multiple&gt;&lt;a href=#attr-select-multiple&gt;multiple&lt;/a&gt;&lt;/code&gt; attribute and has at
-    least one &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element descendant, then the cell
-    acts as a cyclable cell.&lt;/p&gt;
+    &lt;p&gt;The cell represents some text and an optional image.&lt;/p&gt;
 
-    &lt;p&gt;The &quot;current&quot; &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element is the selected
-    &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element, or the first &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt;
-    element if none is selected.&lt;/p&gt;
+   &lt;/dd&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData()&lt;/a&gt;&lt;/code&gt;
-    method must return the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of the current
-    &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element (the &lt;code title=attr-option-label&gt;&lt;a href=#attr-option-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute is &lt;a href=#ignore title=ignore&gt;ignored&lt;/a&gt; in this context as the
-    &lt;code&gt;&lt;a href=#the-optgroup-element&gt;optgroup&lt;/a&gt;&lt;/code&gt;s are not displayed).&lt;/p&gt;
+   &lt;dt&gt;&lt;dfn id=datagrid-type-editable title=datagrid-type-editable&gt;&lt;code&gt;editable&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dd&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellClasses&gt;&lt;a href=#dom-provider-getcellclasses&gt;getCellClasses()&lt;/a&gt;&lt;/code&gt; method
-    must add the &lt;code title=datagrid-cell-class-cyclable&gt;&lt;a href=#datagrid-cell-class-cyclable&gt;cyclable&lt;/a&gt;&lt;/code&gt; class and
-    then all the classes of the current &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt;
-    element.&lt;/p&gt;
+    &lt;p&gt;The cells represents some editable text, an optional
+    &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; giving autocompletion hints, and an
+    optional image.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-cycleCell&gt;&lt;a href=#dom-provider-cyclecell&gt;cycleCell()&lt;/a&gt;&lt;/code&gt;
-    method must change the selection of the &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt;
-    element such that the next &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element after the
-    current &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element is the only one that is
-    selected (in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;). If the current &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt;
-    element is the last &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element descendant of the
-    &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt;, then the first &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; element
-    descendant must be selected instead.&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element, the user agent
+    should offer the suggestions represented by that element to the
+    user. The user agent may use the suggestion's &lt;a href=#concept-option-label title=concept-option-label&gt;label&lt;/a&gt; to identify the
+    suggestion. If the user selects a suggestion, then the editable
+    text must be set to the selected suggestion's &lt;a href=#concept-option-value title=concept-option-value&gt;value&lt;/a&gt;, as if the user had
+    written that value himself.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-setCellCheckedState&gt;&lt;a href=#dom-provider-setcellcheckedstate&gt;setCellCheckedState()&lt;/a&gt;&lt;/code&gt;
-    and &lt;code title=dom-provider-editCell&gt;&lt;a href=#dom-provider-editcell&gt;editCell()&lt;/a&gt;&lt;/code&gt; methods
-    must do nothing.&lt;/p&gt;
+    &lt;p&gt;When the user edits the value, either directly or using the
+    &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt;, the user agent must invoke the &lt;code title=dom-listener-cellChanged&gt;&lt;a href=#dom-listener-cellchanged&gt;cellChanged()&lt;/a&gt;&lt;/code&gt; method on
+    the current &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt;
+    with as its first argument a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; identifying the
+    cell's row, as its second argument the identifier of the cell's
+    column, as its third argument the new value, and as its fourth
+    argument the previous value.&lt;/p&gt;
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;Progress bar cells&lt;/dt&gt;
+   &lt;dt&gt;&lt;dfn id=datagrid-type-checkable title=datagrid-type-checkable&gt;&lt;code&gt;checkable&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dd&gt;
 
+    &lt;p&gt;The cell represents some text, a check box that optionally has
+    its value obscured as indeterminate, and an optional image.&lt;/p&gt;
+
+    &lt;p&gt;When the user checks or unchecks the check box, the user agent
+    must change the check box's state appropriately and stop obscuring
+    the check box as indeterminate (if it is obscuring it), and then
+    must invoke the &lt;code title=dom-listener-cellChanged&gt;&lt;a href=#dom-listener-cellchanged&gt;cellChanged()&lt;/a&gt;&lt;/code&gt; method on
+    the current &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt;
+    with as its first argument a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; identifying the
+    cell's row, as its second argument the identifier of the cell's
+    column, as its third argument true if the check box is now checked
+    and false otherwise, and as its fourth argument true if the check
+    box was previously checked and false otherwise.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=datagrid-type-list title=datagrid-type-list&gt;&lt;code&gt;list&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the first element child of a cell's element is a
-    &lt;code&gt;&lt;a href=#the-progress-element&gt;progress&lt;/a&gt;&lt;/code&gt; element, then the cell acts as a progress
-    bar cell.&lt;/p&gt;
+    &lt;p&gt;The cell represents some text giving the current value selected
+    from a dropdown list of options, a &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt; element
+    giving the list of options, and an optional image.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData()&lt;/a&gt;&lt;/code&gt;
-    method must return the value returned by the &lt;code&gt;&lt;a href=#the-progress-element&gt;progress&lt;/a&gt;&lt;/code&gt;
-    element's &lt;code title=dom-progress-position&gt;&lt;a href=#dom-progress-position&gt;position&lt;/a&gt;&lt;/code&gt; DOM
-    attribute.&lt;/p&gt;
+    &lt;p&gt;The user agent should allow the user to change the value of the
+    cell from its current value to one of the &lt;a href=#concept-option-value title=concept-option-value&gt;values&lt;/a&gt; given by
+    &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; elements in the &lt;a href=#concept-select-option-list title=concept-select-option-list&gt;list of options&lt;/a&gt; (if
+    any). The user agent may use the &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; elements'
+    &lt;a href=#concept-option-label title=concept-option-label&gt;labels&lt;/a&gt; to annotate each
+    option.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellClasses&gt;&lt;a href=#dom-provider-getcellclasses&gt;getCellClasses()&lt;/a&gt;&lt;/code&gt; method
-    must add the &lt;code title=datagrid-cell-class-progress&gt;&lt;a href=#datagrid-cell-class-progress&gt;progress&lt;/a&gt;&lt;/code&gt; class.&lt;/p&gt;
+    &lt;p&gt;When the user selects a new value from the &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt;
+    element's &lt;a href=#concept-select-option-list title=concept-select-option-list&gt;list of
+    options&lt;/a&gt;, the user agent must invoke the &lt;code title=dom-listener-cellChanged&gt;&lt;a href=#dom-listener-cellchanged&gt;cellChanged()&lt;/a&gt;&lt;/code&gt; method on
+    the current &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt;
+    with as its first argument a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; identifying the
+    cell's row, as its second argument the identifier of the cell's
+    column, as its third argument the new value, and as its fourth
+    argument the previous value.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-setCellCheckedState&gt;&lt;a href=#dom-provider-setcellcheckedstate&gt;setCellCheckedState()&lt;/a&gt;&lt;/code&gt;,
-    &lt;code title=dom-provider-cycleCell&gt;&lt;a href=#dom-provider-cyclecell&gt;cycleCell()&lt;/a&gt;&lt;/code&gt;, and
-    &lt;code title=dom-provider-editCell&gt;&lt;a href=#dom-provider-editcell&gt;editCell()&lt;/a&gt;&lt;/code&gt; methods must
-    do nothing.&lt;/p&gt;
+   &lt;/dd&gt;
 
+   &lt;dt&gt;&lt;dfn id=datagrid-type-progress title=datagrid-type-progress&gt;&lt;code&gt;progress&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;The cell represents a (determinate) progress bar whose value is
+    between 0.0, indicating no progress, and 1.0, indicating the task
+    is complete.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;Checkbox cells&lt;/dt&gt;
-
+   &lt;dt&gt;&lt;dfn id=datagrid-type-meter title=datagrid-type-meter&gt;&lt;code&gt;meter&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the first element child of a cell's element is an
-    &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element that has a &lt;code title=attr-input-type&gt;&lt;a href=#attr-input-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute with the value &lt;code title=&quot;&quot;&gt;checkbox&lt;/code&gt;, then the cell acts as a check box
-    cell.&lt;/p&gt;
+    &lt;p&gt;The cell represents a gauge, described by one to six
+    numbers.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData()&lt;/a&gt;&lt;/code&gt;
-    method must return the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of the cell
-    element.&lt;/p&gt;
+    &lt;p&gt;The gauge's actual value is given by the first number.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellClasses&gt;&lt;a href=#dom-provider-getcellclasses&gt;getCellClasses()&lt;/a&gt;&lt;/code&gt; method
-    must add the &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;checked&lt;/a&gt;&lt;/code&gt; class if the
-    &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#concept-fe-checked title=concept-fe-checked&gt;checkedness&lt;/a&gt; is true, and the
-    &lt;code title=datagrid-cell-class-unchecked&gt;&lt;a href=#datagrid-cell-class-unchecked&gt;unchecked&lt;/a&gt;&lt;/code&gt; class
-    otherwise.&lt;/p&gt;
+    &lt;p&gt;If there is a second number, then that number is the maximum
+    value. Otherwise, the maximum value is 1.0.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-setCellCheckedState&gt;&lt;a href=#dom-provider-setcellcheckedstate&gt;setCellCheckedState()&lt;/a&gt;&lt;/code&gt;
-    method must set the &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element's checkbox &lt;a href=#concept-fe-checked title=concept-fe-checked&gt;checkedness&lt;/a&gt; to true if the
-    method's third argument is 1, and to false otherwise.&lt;/p&gt;
+    &lt;p&gt;If there is a third number, then that number is the minimum
+    value. Otherwise, the minimum value is 1.0.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-cycleCell&gt;&lt;a href=#dom-provider-cyclecell&gt;cycleCell()&lt;/a&gt;&lt;/code&gt; and
-    &lt;code title=dom-provider-editCell&gt;&lt;a href=#dom-provider-editcell&gt;editCell()&lt;/a&gt;&lt;/code&gt; methods must
-    do nothing.&lt;/p&gt;
+    &lt;p&gt;If there is a fourth number, then that number is the low
+    boundary. Otherwise, the low boundary is the minimum value.&lt;/p&gt;
 
+    &lt;p&gt;If there is a fifth number, then that number is the high
+    boundary. Otherwise, the high boundary is the maximum value.&lt;/p&gt;
+
+    &lt;p&gt;If there is a sixth number, then the optimal point is the sixth
+    number. Otherwise, the optimum point is the midpoint between the
+    minimum value and the maximum value.&lt;/p&gt;
+
+    &lt;!-- next two paragraphs copied from &lt;meter&gt;: --&gt;
+
+    &lt;p&gt;If the optimum point is equal to the low boundary or the high
+    boundary, or anywhere in between them, then the region between the
+    low and high boundaries of the gauge must be treated as the
+    optimum region, and the low and high parts, if any, must be
+    treated as suboptimal. Otherwise, if the optimum point is less
+    than the low boundary, then the region between the minimum value
+    and the low boundary must be treated as the optimum region, the
+    region between the low boundary and the high boundary must be
+    treated as a suboptimal region, and the region between the high
+    boundary and the maximum value must be treated as an even less
+    good region. Finally, if the optimum point is higher than the high
+    boundary, then the situation is reversed; the region between the
+    high boundary and the maximum value must be treated as the optimum
+    region, the region between the high boundary and the low boundary
+    must be treated as a suboptimal region, and the remaining region
+    between the low boundary and the minimum value must be treated as
+    an even less good region.&lt;/p&gt;
+
+    &lt;p&gt;User agents should indicate the relative position of the actual
+    actual to the minimum and maximum values, and the relationship
+    between the actual value and the three regions of the gauge.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;Editable cells&lt;/dt&gt;
-
+   &lt;dt&gt;&lt;dfn id=datagrid-type-custom title=datagrid-type-custom&gt;&lt;code&gt;custom&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the first element child of a cell's element is an
-    &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element that has a &lt;code title=attr-input-type&gt;&lt;a href=#attr-input-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute with the value &lt;code title=&quot;&quot;&gt;text&lt;/code&gt; or that has no &lt;code title=attr-input-type&gt;&lt;a href=#attr-input-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute at all, then the
-    cell acts as an editable cell.&lt;/p&gt;
+    &lt;p&gt;The cell represents a dynamically generated graphical image.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData()&lt;/a&gt;&lt;/code&gt;
-    method must return the &lt;code title=dom-input-value&gt;&lt;a href=#dom-input-value&gt;value&lt;/a&gt;&lt;/code&gt;
-    of the &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+    &lt;p&gt;The cell will have minimum dimensions (specified in CSS
+    pixels), and a callback (in the form of a
+    &lt;code&gt;&lt;a href=#renderingcontext2dcallback&gt;RenderingContext2DCallback&lt;/a&gt;&lt;/code&gt; object) to get a rendering
+    for the cell.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-getCellClasses&gt;&lt;a href=#dom-provider-getcellclasses&gt;getCellClasses()&lt;/a&gt;&lt;/code&gt; method
-    must add the &lt;code title=datagrid-cell-class-editable&gt;&lt;a href=#datagrid-cell-class-editable&gt;editable&lt;/a&gt;&lt;/code&gt; class.&lt;/p&gt;
+    &lt;p&gt;The user agent should not allow the cell to be rendered with
+    dimensions less than the given minimum width and height.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-editCell&gt;&lt;a href=#dom-provider-editcell&gt;editCell()&lt;/a&gt;&lt;/code&gt;
-    method must set the &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element's &lt;code title=dom-input-value&gt;&lt;a href=#dom-input-value&gt;value&lt;/a&gt;&lt;/code&gt; DOM attribute to the value of
-    the third argument to the method.&lt;/p&gt;
+    &lt;p&gt;When the user agent needs to render the cell, the user agent
+    must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to invoke the
+    &lt;a href=#renderingcontext2dcallback&gt;RenderingContext2DCallback&lt;/a&gt; callback, passing it a
+    newly created &lt;code&gt;&lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt; object whose
+    &lt;code title=dom-context-2d-canvas&gt;&lt;a href=#dom-context-2d-canvas&gt;canvas&lt;/a&gt;&lt;/code&gt; DOM attribute is
+    null as the first argument, the actual cell width in CSS pixels as
+    the second argument, and the actual cell height in CSS pixels as
+    the third argument.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=dom-provider-setCellCheckedState&gt;&lt;a href=#dom-provider-setcellcheckedstate&gt;setCellCheckedState()&lt;/a&gt;&lt;/code&gt;
-    and &lt;code title=dom-provider-cycleCell&gt;&lt;a href=#dom-provider-cyclecell&gt;cycleCell()&lt;/a&gt;&lt;/code&gt;
-    methods must do nothing.&lt;/p&gt;
+    &lt;p&gt;If the user agent is able to render graphics, then it must
+    render the graphics commands that the callback executed on the
+    provided &lt;code&gt;&lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt; object onto the
+    cell once the callback returns. The image must be clipped to the
+    dimensions of the cell. The coordinate space of the cell must be
+    aligned with that used by the 2D context such that the top left
+    corner of the cell is the 0,0 origin, with the coordinate space
+    increasing its &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; dimension towards the right
+    of the cell and its &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; axis towards the bottom
+    of the cell, and with the image not scaled (so that one CSS pixel
+    on the final rendering matches one CSS pixel in the coordinate
+    space usd by the 2D context).&lt;/p&gt;
 
+    &lt;p&gt;The user agent must then decouple the
+    &lt;code&gt;&lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt; object and any objects that
+    it created (such as &lt;code&gt;&lt;a href=#canvaspattern&gt;CanvasPattern&lt;/a&gt;&lt;/code&gt; objects or
+    &lt;code&gt;&lt;a href=#imagedata&gt;ImageData&lt;/a&gt;&lt;/code&gt; objects) from any real drawing surface.&lt;/p&gt;
+
+    &lt;p&gt;If the user agent is unable to render graphics, then it must
+    render the text string returned by the callback instead.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-  &lt;/dl&gt;&lt;!-- XXX Calculated cells, like in spreadsheets? --&gt;&lt;h5 id=populating-the-datagrid-element&gt;&lt;span class=secno&gt;4.11.2.5 &lt;/span&gt;Populating the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element&lt;/h5&gt;
+  &lt;/dl&gt;&lt;hr&gt;&lt;p&gt;When an algorithm requires the user agent to &lt;dfn id=apply-a-row-object&gt;apply a
+  &lt;code&gt;Row&lt;/code&gt; object&lt;/dfn&gt;, the user agent must run the following
+  steps:&lt;/p&gt;
 
-  &lt;p&gt;A &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must be disabled until its end tag has
-  been parsed&lt;!-- XXX do we define that? what if the end tag is never
-  seen, but the element is popped off the stack?--&gt; (in the case of a
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element in the original document markup) or
-  until it has been &lt;a href=#insert-an-element-into-a-document title=&quot;insert an element into a
-  document&quot;&gt;inserted into the document&lt;/a&gt; (in the case of a
-  dynamically created element). After that point, the element must
-  fire a single &lt;code title=event-load&gt;&lt;a href=#event-load&gt;load&lt;/a&gt;&lt;/code&gt; event at itself,
-  which doesn't bubble and cannot be canceled.&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;
 
-  &lt;p class=XXX&gt;The end-tag parsing thing should be moved to
-  the parsing section.&lt;/p&gt;
+    &lt;p&gt;If the value of the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's second entry is
+    not &minus;1, then run these substeps:&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must then populate itself using the
-  data provided by the data provider assigned to the &lt;code title=dom-datagrid-data&gt;&lt;a href=#dom-datagrid-data&gt;data&lt;/a&gt;&lt;/code&gt; DOM attribute. After the view
-  is populated (using the methods described below), the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must invoke the &lt;code title=dom-provider-initialize&gt;&lt;a href=#dom-provider-initialize&gt;initialize()&lt;/a&gt;&lt;/code&gt; method on the
-  data provider specified by the &lt;code title=dom-datagrid-data&gt;&lt;a href=#dom-datagrid-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute, passing itself (the
-  &lt;code&gt;&lt;a href=#htmldatagridelement&gt;HTMLDataGridElement&lt;/a&gt;&lt;/code&gt; object) as the only argument.&lt;/p&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is a row with the same parent as the row
+     specified by the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt;
+     object, whose display order position is currently the same as the
+     value of the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's second entry, then remove
+     that row from the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data
+     tree&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;p&gt;When the &lt;code title=dom-datagrid-data&gt;&lt;a href=#dom-datagrid-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute is
-  null, the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must use the default data provider
-  described in the previous section.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;Set the display order position of the row specified by the
+     &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; to the value of the
+     &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object's second entry, updating its position in
+     the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data tree&lt;/a&gt;
+     accordingly.&lt;/li&gt;
 
-  &lt;p&gt;To obtain data from the data provider, the element must invoke
-  methods on the data provider object in the following ways:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;If the row is in the the &lt;a href=#pending-datagrid-rows-list&gt;pending
+     &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/a&gt;, remove it.&lt;/li&gt;
 
-  &lt;dl&gt;&lt;dt&gt;To determine the total number of columns&lt;/dt&gt;
+    &lt;/ol&gt;&lt;/li&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getColumnCount&gt;&lt;a href=#dom-provider-getcolumncount&gt;getColumnCount()&lt;/a&gt;&lt;/code&gt; method
-   with no arguments. The return value is the number of columns. If
-   the return value is zero or negative, not an integer, or simply not
-   a numeric type, or if the method is not defined, then 1 must be
-   used instead.&lt;/dd&gt;
+   &lt;li&gt;
 
-   &lt;dt&gt;To get the captions to use for the columns&lt;/dt&gt;
+    &lt;p&gt;If the fourth entry in the &lt;code&gt;&lt;a href=#row&gt;Row&lt;/a&gt;&lt;/code&gt; object (a
+    &lt;code&gt;&lt;a href=#celllist&gt;CellList&lt;/a&gt;&lt;/code&gt; object, an array) is not empty, then for
+    each &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object in that array update the cell that
+    corresponds to the column identified by the value of the first
+    entry of the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object, by using the appropriate
+    set of steps given below as determined by the type of the
+    column. Then, if the cell is in the the &lt;a href=#pending-datagrid-cells-list&gt;pending
+    &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/a&gt;, remove it.&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getCaptionText&gt;&lt;a href=#dom-provider-getcaptiontext&gt;getCaptionText()&lt;/a&gt;&lt;/code&gt; method
-   with the index of the column in question. The index &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; must be in the range 0 &le; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;
-   &lt; &lt;var title=&quot;&quot;&gt;N&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;N&lt;/var&gt; is the
-   total number of columns. The return value is the string to use when
-   referring to that column. If the method returns null or the empty
-   string, the column has no caption. If the method is not defined,
-   then none of the columns have any captions.&lt;/dd&gt;
+    &lt;dl&gt;&lt;dt&gt;If the column's type is &lt;code title=datagrid-type-text&gt;&lt;a href=#datagrid-type-text&gt;text&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt&gt;To establish what classes apply to a column&lt;/dt&gt;
+      &lt;p&gt;Update the cell's text to the value given in the
+      &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getCaptionClasses&gt;&lt;a href=#dom-provider-getcaptionclasses&gt;getCaptionClasses()&lt;/a&gt;&lt;/code&gt;
-   method with the index of the column in question, and an object
-   implementing the &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; interface, associated
-   with an anonymous empty string. The index &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;
-   must be in the range 0 &le; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; &lt; &lt;var title=&quot;&quot;&gt;N&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;N&lt;/var&gt; is the total number
-   of columns. The tokens contained in the string underlying
-   &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object when the method returns represent
-   the classes that apply to the given column. If the method is not
-   defined, no classes apply to the column.&lt;/dd&gt;
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object has three entries, then copy
+      the image data from the &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element given in the
+      third entry, and let the cell's image be given by that image
+      data. Otherwise, update the cell to have no image.&lt;/p&gt;
 
-   &lt;dt&gt;To establish whether a column should be initially included in
-   the visible columns&lt;/dt&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;Check whether the &lt;code title=datagrid-column-class-initially-hidden&gt;&lt;a href=#datagrid-column-class-initially-hidden&gt;initially-hidden&lt;/a&gt;&lt;/code&gt;
-   class applies to the column. If it does, then the column should not
-   be initially included; if it does not, then the column should be
-   initially included.&lt;/dd&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-editable&gt;&lt;a href=#datagrid-type-editable&gt;editable&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt id=columnType2&gt;To establish whether the data can be sorted
-   relative to a particular column&lt;/dt&gt;
+      &lt;p&gt;Update the cell's text to the value given in the
+      &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-   &lt;dd&gt;Check whether the &lt;code title=datagrid-column-class-sortable&gt;&lt;a href=#datagrid-column-class-sortable&gt;sortable&lt;/a&gt;&lt;/code&gt; class
-   applies to the column. If it does, then the user agent should offer
-   the user the option to have the data displayed sorted by that
-   column; if it does not, then the user agent must not allow the user
-   to ask for the data to be sorted by that column.&lt;/dd&gt;
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object has three entries, then let
+      the &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element given in the third entry be
+      the &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element giving autocompletion
+      hints. Otherwise, update the cell to have no
+      &lt;code&gt;&lt;a href=#the-datalist-element&gt;datalist&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
 
-   &lt;dt&gt;To establish if a column is a sorted column&lt;/dt&gt;
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object has four entries, then copy
+      the image data from the &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element given in the
+      fourth entry, and let the cell's image be given by that image
+      data. Otherwise, update the cell to have no image.&lt;/p&gt;
 
-   &lt;dd&gt;If the user agent can handle multiple columns being marked as
-   sorted simultaneously: Check whether the &lt;code title=datagrid-column-class-sorted&gt;&lt;a href=#datagrid-column-class-sorted&gt;sorted&lt;/a&gt;&lt;/code&gt; class applies to
-   the column. If it does, then that column is the sorted column,
-   otherwise it is not.&lt;/dd&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;If the user agent can only handle one column being marked as
-   sorted at a time: Check each column in turn, starting with the
-   first one, to see whether the &lt;code title=datagrid-column-class-sorted&gt;&lt;a href=#datagrid-column-class-sorted&gt;sorted&lt;/a&gt;&lt;/code&gt; class applies to
-   that column. The first column that has that class, if any, is the
-   sorted column. If none of the columns have that class, there is no
-   sorted column.&lt;/dd&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-checkable&gt;&lt;a href=#datagrid-type-checkable&gt;checkable&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt&gt;To establish the sort direction of a sorted column&lt;/dt&gt;
+      &lt;p&gt;Update the cell's text to the value given in the
+      &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-   &lt;dd&gt;Check whether the &lt;code title=datagrid-column-class-reversed&gt;&lt;a href=#datagrid-column-class-reversed&gt;reversed&lt;/a&gt;&lt;/code&gt; class
-   applies to the column. If it does, then the sort direction is
-   descending (down; first rows have the highest values), otherwise it
-   is ascending (up; first rows have the lowest values).&lt;/dd&gt;
+      &lt;p&gt;Update the cell's checked state to match the value of the
+      third entry: checked if true, unchecked otherwise.&lt;/p&gt;
 
-   &lt;dt&gt;To determine the total number of rows&lt;/dt&gt;
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object has four entries and the
+      fourth entry is true, then update the cell to be obscured as
+      indeterminate. Otherwise, the cell's state is not obscured.&lt;/p&gt;
 
-   &lt;dd&gt;Determine the number of rows for the root of the data grid, and
-   determine the number of child rows for each open row. The total
-   number of rows is the sum of all these numbers.&lt;/dd&gt;
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object has five entries, then copy
+      the image data from the &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element given in the
+      fifth entry, and let the cell's image be given by that image
+      data. Otherwise, update the cell to have no image.&lt;/p&gt;
 
-   &lt;dt&gt;To determine the number of rows for the root of the data grid&lt;/dt&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount()&lt;/a&gt;&lt;/code&gt; method with a
-   &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing the empty path as
-   its only argument. The return value is the number of rows at the
-   top level of the data grid. If the return value of the method is
-   negative, not an integer, or simply not a numeric type, or if the
-   method is not defined, then zero must be used instead.&lt;/dd&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-list&gt;&lt;a href=#datagrid-type-list&gt;list&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt&gt;To determine the number of child rows for a row&lt;/dt&gt;
+      &lt;p&gt;Update the cell's text to the value given in the
+      &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's second entry, and the
+      &lt;code&gt;&lt;a href=#the-select-element&gt;select&lt;/a&gt;&lt;/code&gt; element to be the one given in the
+      &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's third entry&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount()&lt;/a&gt;&lt;/code&gt; method with a
-   &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing the path to the
-   row in question. The return value is the number of child rows for
-   the given row. If the return value of the method is negative, not
-   an integer, or simply not a numeric type, or if the method is not
-   defined, then zero must be used instead.&lt;/dd&gt;
+      &lt;p&gt;If the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object has four entries, then copy
+      the image data from the &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element given in the
+      fourth entry, and let the cell's image be given by that image
+      data. Otherwise, update the cell to have no image.&lt;/p&gt;
 
-   &lt;dt&gt;To determine what order to render rows in&lt;/dt&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-progress&gt;&lt;a href=#datagrid-type-progress&gt;progress&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-    &lt;p&gt;Invoke the &lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;getChildAtPosition()&lt;/a&gt;&lt;/code&gt;
-    method with a &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing
-    the path to the parent of the rows that are being rendered as the
-    first argument, and the position that is being rendered as the
-    second argument. The return value is the index of the row to
-    render in that position.&lt;/p&gt;
+      &lt;p&gt;Update the cell to be a progress bar whose progress, on the
+      scale of 0.0 (no progress) to 1.0 (task complete) is given by
+      the value in the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-    &lt;div class=example&gt;
+     &lt;/dd&gt;
 
-     &lt;p&gt;If the rows are:&lt;/p&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-meter&gt;&lt;a href=#datagrid-type-meter&gt;meter&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-     &lt;ol&gt;&lt;li&gt; Row &quot;0&quot;
-       &lt;ol&gt;&lt;li&gt; Row &quot;0,0&quot;
-        &lt;li&gt; Row &quot;0,1&quot;
-       &lt;/ol&gt;&lt;/li&gt;
-      &lt;li&gt; Row &quot;1&quot;
-       &lt;ol&gt;&lt;li&gt; Row &quot;1,0&quot;
-        &lt;li&gt; Row &quot;1,1&quot;
-       &lt;/ol&gt;&lt;/li&gt;
-     &lt;/ol&gt;&lt;p&gt;...and the &lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;getChildAtPosition()&lt;/a&gt;&lt;/code&gt;
-    method is implemented as follows:&lt;/p&gt;
+      &lt;p&gt;Update the cell to be a gauge configured with the numbers
+      given by the second and subsequent entries of the
+      &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
-    &lt;pre&gt;function getChildAtPosition(parent, child) {
-  // always return the reverse order
-  return getRowCount(parent)-child-1;
-}&lt;/pre&gt;
+     &lt;/dd&gt;
 
-     &lt;p&gt;...then the rendering would actually be:&lt;/p&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=datagrid-type-custom&gt;&lt;a href=#datagrid-type-custom&gt;custom&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-     &lt;ol&gt;&lt;li&gt; Row &quot;1&quot;
-       &lt;ol&gt;&lt;li&gt; Row &quot;1,1&quot;
-        &lt;li&gt; Row &quot;1,0&quot;
-       &lt;/ol&gt;&lt;/li&gt;
-      &lt;li&gt; Row &quot;0&quot;
-       &lt;ol&gt;&lt;li&gt; Row &quot;0,1&quot;
-        &lt;li&gt; Row &quot;0,0&quot;
-       &lt;/ol&gt;&lt;/li&gt;
-     &lt;/ol&gt;&lt;/div&gt;
+      &lt;p&gt;Update the cell's minimum width to be the length in CSS
+      pixels given by the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-    &lt;p&gt;If the return value of the method is negative, larger than the
-    number of rows that the &lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount()&lt;/a&gt;&lt;/code&gt; method
-    reported for that parent, not an integer, or simply not a numeric
-    type, then the entire data grid should be disabled. Similarly, if
-    the method returns the same value for two or more different values
-    for the second argument (with the same first argument, and
-    assuming that the data grid hasn't had relevant update methods
-    invoked in the meantime), then the data grid should be
-    disabled. Instead of disabling the data grid, the user agent may
-    act as if the &lt;code title=dom-provider-getChildAtPosition&gt;&lt;a href=#dom-provider-getchildatposition&gt;getChildAtPosition()&lt;/a&gt;&lt;/code&gt;
-    method was not defined on the data provider (thus disabling
-    sorting for that data grid, but still letting the user interact
-    with the data). If the method is not defined, then the return
-    value must be assumed to be the same as the second argument (an
-    identity transform; the data is rendered in its natural
-    order).&lt;/p&gt;
+      &lt;p&gt;Update the cell's minimum height to be the length in CSS
+      pixels given by the &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's third entry.&lt;/p&gt;
 
-   &lt;/dd&gt;
+      &lt;p&gt;Update the cell's callback to be the
+      &lt;code&gt;&lt;a href=#renderingcontext2dcallback&gt;RenderingContext2DCallback&lt;/a&gt;&lt;/code&gt; object given by the
+      &lt;code&gt;&lt;a href=#cell&gt;Cell&lt;/a&gt;&lt;/code&gt; object's fourth entry.&lt;/p&gt;
 
-   &lt;dt&gt;To establish what classes apply to a row&lt;/dt&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getRowClasses&gt;&lt;a href=#dom-provider-getrowclasses&gt;getRowClasses()&lt;/a&gt;&lt;/code&gt; method
-   with a &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing the row in
-   question, and a &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; associated with an empty
-   string. The tokens contained in the &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt;
-   object's underlying string when the method returns represent the
-   classes that apply to the row in question. If the method is not
-   defined, no classes apply to the row.&lt;/dd&gt;
+    &lt;/dl&gt;&lt;/li&gt;
 
-   &lt;dt&gt;To establish whether a row is a data row or a special row&lt;/dt&gt;
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;When the user agent is to run the &lt;dfn id=datagrid-update-display-algorithm&gt;&lt;code&gt;datagrid&lt;/code&gt;
+  update display algorithm&lt;/dfn&gt;, the user agent must invoke the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt; methods on the
+  current &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt; such
+  that all the current visible rows in the &lt;a href=#display-order-sparse-data-list&gt;display order sparse
+  data list&lt;/a&gt;, and all the cells in the currently visible columns
+  on all the currently visible rows, have been covered.&lt;/p&gt;
 
-   &lt;dd&gt;Examine the classes that apply to the row. If the &lt;code title=datagrid-row-class-header&gt;&lt;a href=#datagrid-row-class-header&gt;header&lt;/a&gt;&lt;/code&gt; class applies to
-   the row, then it is not a data row, it is a subheading. The data
-   from the first cell of the row is the text of the subheading, the
-   rest of the cells must be ignored. Otherwise, if the &lt;code title=datagrid-row-class-separator&gt;&lt;a href=#datagrid-row-class-separator&gt;separator&lt;/a&gt;&lt;/code&gt; class applies
-   to the row, then in the place of the row, a separator should be
-   shown. Otherwise, if the &lt;code title=datagrid-row-class-selectable-separator&gt;&lt;a href=#datagrid-row-class-selectable-separator&gt;selectable-separator&lt;/a&gt;&lt;/code&gt;
-   class applies to the row, then the row should be a data row, but
-   represented as a separator. (The difference between a &lt;code title=datagrid-row-class-separator&gt;&lt;a href=#datagrid-row-class-separator&gt;separator&lt;/a&gt;&lt;/code&gt; and a &lt;code title=datagrid-row-class-selectable-separator&gt;&lt;a href=#datagrid-row-class-selectable-separator&gt;selectable-separator&lt;/a&gt;&lt;/code&gt;
-   is that the former is not an item that can be actually selected,
-   whereas the second can be selected and thus has a context menu that
-   applies to it, and so forth.) For both kinds of separator rows, the
-   data of the rows' cells must all be ignored. If none of those three
-   classes apply then the row is a simple data row.&lt;/dd&gt;
+  &lt;p&gt;A row is considered covered if it is present in the &lt;a href=#pending-datagrid-rows-list&gt;pending
+  &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/a&gt;, or if the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt; method is invoked with
+  a range that includes the row in question.&lt;/p&gt;
 
-   &lt;dt id=rowType1&gt;To establish whether a row is openable&lt;/dt&gt;
+  &lt;p&gt;A cell is considered covered if it is present in the
+  &lt;a href=#pending-datagrid-cells-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/a&gt;, or if the
+  &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt; method is
+  invoked with a range that includes the row in question and a list of
+  columns that includes the cell's column, or if the &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt; method is invoked
+  with a list of rows and columns that intersects the cell in
+  question. However, the &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt; method can only be
+  used if the row is already present in the &lt;a href=#display-order-sparse-data-list&gt;display order sparse
+  data list&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;dd&gt;Determine the number of child rows for that row. If there are
-   one or more child rows, then the row is openable.&lt;/dd&gt;
+  &lt;p&gt;The &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt; method,
+  if used, must be invoked with five arguments. The first argument
+  must be the index in the &lt;a href=#display-order-sparse-data-list&gt;display order sparse data list&lt;/a&gt;
+  to the first row that the the user agent is requesting, known as the
+  &lt;i&gt;anchor row&lt;/i&gt;. The second argument must be the number of
+  consecutive cells for which the user agent is requesting
+  information. The third argument must be the &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; of
+  the row that is the nearest ancestor in the &lt;a href=#display-order-sparse-data-tree&gt;display order
+  sparse data &lt;em&gt;tree&lt;/em&gt;&lt;/a&gt; of the anchor row. If this is the
+  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, then the &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object must be an
+  empty array. The fourth argument must be the display order position
+  of the anchor row in the &lt;a href=#display-order-sparse-data-tree&gt;display order sparse data
+  tree&lt;/a&gt;, assuming that the row identified in the third argument
+  is indeed the anchor row's parent row. The fifth and final argument
+  must be an array of the identifiers of the columns for which the
+  user agent is requesting information, in the order they were added
+  to the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
 
-   &lt;dt&gt;To establish whether a row should be initially open or closed&lt;/dt&gt;
+  &lt;p&gt;As the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt; method
+  is invoked, the &lt;a href=#pending-datagrid-rows-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/a&gt;
+  must be updated to include the rows for which information has been
+  requested, excluding rows for which information is already
+  available; and the &lt;a href=#pending-datagrid-cells-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells
+  list&lt;/a&gt; must be updated to include the cells for which
+  information has been requested on those rows.&lt;/p&gt;
 
-   &lt;dd&gt;If &lt;a href=#rowType1&gt;the row is openable&lt;/a&gt;, examine the
-   classes that apply to the row. If the &lt;code title=datagrid-row-class-initially-open&gt;&lt;a href=#datagrid-row-class-initially-open&gt;initially-open&lt;/a&gt;&lt;/code&gt;
-   class applies to the row, then it should be initially
-   open. Otherwise, if the &lt;code title=datagrid-row-class-initially-closed&gt;&lt;a href=#datagrid-row-class-initially-closed&gt;initially-closed&lt;/a&gt;&lt;/code&gt;
-   class applies to the row, then it must be initially
-   closed. Otherwise, if neither class applies to the row, or if the
-   row is not openable, then the initial state of the row should be
-   based on platform conventions.&lt;/dd&gt;
+  &lt;p&gt;The &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt; method,
+  if used, must be invoked with two arguments. The first argument must
+  be an array of &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; objects identifying the rows for
+  which information is being requested. The second argument must be an
+  array of the identifiers of the columns for which the user agent is
+  requesting information, in the order they were added to the
+  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
 
-&lt;!-- XXXPA
-   &lt;dt&gt;To establish whether a row is deletable&lt;/dt&gt;
+  &lt;p&gt;As the &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt;
+  method is invoked, the &lt;a href=#pending-datagrid-cells-list&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells
+  list&lt;/a&gt; must be updated to include the cells for which
+  information has been requested.&lt;/p&gt;
 
-   &lt;dd&gt;Check whether the &lt;code
-   title=&quot;datagrid-row-class-deletable&quot;&gt;deletable&lt;/code&gt; class applies
-   to the row. If it does, the row is deletable, and interactive user
-   agents should provide a way for the user to request that the row be
-   deleted. (See the &lt;code
-   title=&quot;dom-provider-performActionOnRow&quot;&gt;performActionOnRow()&lt;/code&gt;
-   method for more details.) Otherwise, the user agent should not
-   provide the user with a method for requesting that the row be
-   deleted.&lt;/dd&gt;
---&gt;
+  &lt;p&gt;Calls to these methods should be batched so that the rows and
+  cells to be covered are handled by the fewest number of calls to
+  these methods as possible. To this end, user agents may invoke the
+  &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt; method for a set
+  of rows that includes some rows that are already in the
+  &lt;a href=#display-order-sparse-data-list&gt;display order sparse data list&lt;/a&gt;, and similarly may
+  invoke the &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt;
+  method with row/column combinations that cover some cells for which
+  data is already known. Generally, however, user agents should avoid
+  invoking these methods with arguments that cause information to be
+  requested when it has already been requested or is already
+  known.&lt;/p&gt;
 
-   &lt;dt&gt;To obtain a &lt;a href=#url&gt;URL&lt;/a&gt; identifying an image representing a row&lt;/dt&gt;
+  &lt;div class=example&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getRowImage&gt;&lt;a href=#dom-provider-getrowimage&gt;getRowImage()&lt;/a&gt;&lt;/code&gt; method with a
-   &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing the row in
-   question. The return value is a &lt;a href=#url&gt;URL&lt;/a&gt;. Immediately &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; that URL, relative to the
-   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element, to obtain an &lt;a href=#absolute-url&gt;absolute
-   URL&lt;/a&gt; identifying the image that represents the row. If the
-   method returns the empty string, null, or if the method is not
-   defined, then the row has no associated image.&lt;/dd&gt; &lt;!-- changing
-   the base URL doesn't change the image used later --&gt;
+   &lt;p&gt;For example, consider a case represented by the following table,
+   where the cells marked &quot;Yes&quot; indicate that the data has already
+   been obtained, the cells marked &quot;Pending&quot; indicate that the data
+   has been previously requested but not yet obtained, and the cells
+   with just a dash indicate that no information has ever been
+   obtained, or any information that had been obtained has now been
+   discarded.&lt;/p&gt;
 
-   &lt;dt&gt;To obtain a context menu appropriate for a particular row&lt;/dt&gt;
+   &lt;table&gt;&lt;tr&gt;&lt;td&gt;        &lt;th&gt; Row   &lt;th&gt; Column A  &lt;th&gt; Column B
+    &lt;tr&gt;&lt;th&gt; Row 1  &lt;td&gt; -     &lt;td&gt; -         &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 2  &lt;td&gt; Yes   &lt;td&gt; Yes       &lt;td&gt; Yes
+    &lt;tr&gt;&lt;th&gt; Row 3  &lt;td&gt; Yes   &lt;td&gt; Yes       &lt;td&gt; Yes
+    &lt;tr&gt;&lt;th&gt; Row 4  &lt;td&gt; Yes   &lt;td&gt; Yes       &lt;td&gt; Yes
+    &lt;tr&gt;&lt;th&gt; Row 5  &lt;td&gt; -     &lt;td&gt; -         &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 6  &lt;td&gt; -     &lt;td&gt; -         &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 7  &lt;td&gt; Yes   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 8  &lt;td&gt; Yes   &lt;td&gt; Pending   &lt;td&gt; Pending
+   &lt;/table&gt;&lt;p&gt;Thus, rows 2, 3, 4, 7, and 8 are already covered, as are the
+   cells from those rows except for the cell in column B of row 7.&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getRowMenu&gt;&lt;a href=#dom-provider-getrowmenu&gt;getRowMenu()&lt;/a&gt;&lt;/code&gt; method with a
-   &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing the row in
-   question. The return value is a reference to an object implementing
-   the &lt;code&gt;&lt;a href=#htmlmenuelement&gt;HTMLMenuElement&lt;/a&gt;&lt;/code&gt; interface, i.e. a
-   &lt;code&gt;&lt;a href=#menus&gt;menu&lt;/a&gt;&lt;/code&gt; element DOM node. (This element must then be
-   interpreted as described in the section on context menus to obtain
-   the actual context menu to use.&lt;!-- XXX update once menu section
-   works; with xrefs --&gt;) If the method returns something that is not
-   an &lt;code&gt;&lt;a href=#htmlmenuelement&gt;HTMLMenuElement&lt;/a&gt;&lt;/code&gt;, or if the method is not defined,
-   then the row has no associated context menu. User agents may
-   provide their own default context menu, and may add items to the
-   author-provided context menu. For example, such a menu could allow
-   the user to change the presentation of the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;
-   element.&lt;/dd&gt;
+   &lt;p&gt;Now consider what happens if all of these rows become visible at
+   once. The user agent has several choices, including (but not
+   limited to) the following:&lt;/p&gt;
 
-   &lt;dt&gt;To establish the value of a particular cell&lt;/dt&gt;
+   &lt;ul&gt;&lt;li&gt;Fire the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt;
+    method for rows 1 through 8 and columns A and B all at once.&lt;/li&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getCellData&gt;&lt;a href=#dom-provider-getcelldata&gt;getCellData()&lt;/a&gt;&lt;/code&gt; method with
-   the first argument being a &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object
-   representing the row of the cell in question and the second
-   argument being the index of the cell's column. The second argument
-   must be a non-negative integer less than the total number of
-   columns. The return value is the value of the cell. If the return
-   value is null or the empty string, or if the method is not defined,
-   then the cell has no data. (For progress bar cells, the cell's
-   value must be further interpreted, as described below.)&lt;/dd&gt;
+    &lt;li&gt;Fire the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt;
+    method for row 1, then fire it again for rows 5 through 7.&lt;/li&gt;
 
-   &lt;dt&gt;To establish what classes apply to a cell&lt;/dt&gt;
+    &lt;li&gt;Fire the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt;
+    method for row 1, then fire it again for rows 5 and 6, and then
+    fire the &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt;
+    method for row 7 column B.&lt;/li&gt;
 
-   &lt;dd&gt;Invoke the &lt;code title=dom-provider-getCellClasses&gt;&lt;a href=#dom-provider-getcellclasses&gt;getCellClasses()&lt;/a&gt;&lt;/code&gt; method
-   with the first argument being a &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt;
-   object representing the row of the cell in question, the second
-   argument being the index of the cell's column, and the third being
-   an object implementing the &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; interface,
-   associated with an empty string. The second argument must be a
-   non-negative integer less than the total number of columns. The
-   tokens contained in the &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
-   underlying string when the method returns represent the classes
-   that apply to that cell. If the method is not defined, no classes
-   apply to the cell.&lt;/dd&gt;
+   &lt;/ul&gt;&lt;p&gt;All three options are allowed, but the latter two are preferable
+   to the former, as they minimise the amount of redundant information
+   requested.&lt;/p&gt;
 
-   &lt;dt id=cellType1&gt;To establish the type of a cell&lt;/dt&gt;
+   &lt;p&gt;In any case, the data model now looks like this:&lt;/p&gt;
 
-   &lt;dd&gt;Examine the classes that apply to the cell. If the &lt;code title=datagrid-cell-class-progress&gt;&lt;a href=#datagrid-cell-class-progress&gt;progress&lt;/a&gt;&lt;/code&gt; class applies
-   to the cell, it is a progress bar. Otherwise, if the &lt;code title=datagrid-cell-class-cyclable&gt;&lt;a href=#datagrid-cell-class-cyclable&gt;cyclable&lt;/a&gt;&lt;/code&gt; class applies
-   to the cell, it is a cycling cell whose value can be cycled between
-   multiple states. Otherwise, none of these classes apply, and the
-   cell is a simple text cell.&lt;/dd&gt;
+   &lt;table&gt;&lt;tr&gt;&lt;td&gt;        &lt;th&gt; Row     &lt;th&gt; Column A  &lt;th&gt; Column B  &lt;th&gt; Column C
+    &lt;tr&gt;&lt;th&gt; Row 1  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 2  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 3  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 4  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 5  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 6  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 7  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt;&lt;th&gt; Row 8  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+   &lt;/table&gt;&lt;p&gt;Now consider the case where a third column, column C, is added
+   to the data model. The user agent once again has several choices,
+   including (but not limited to) the following:&lt;/p&gt;
 
-   &lt;dt&gt;To establish the value of a progress bar cell&lt;/dt&gt;
+   &lt;ul&gt;&lt;li&gt;Fire the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt;
+    method for rows 1 through 8 again, this time listing just column
+    C.&lt;/li&gt;
 
-   &lt;dd&gt;If the value &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; of the cell is a string that
-   can be &lt;a href=#rules-for-parsing-floating-point-number-values title=&quot;rules for parsing floating point number
-   values&quot;&gt;converted to a floating-point number&lt;/a&gt; in the range
-   0.0&nbsp;&le;&nbsp;&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;&nbsp;&le;&nbsp;1.0, then
-   the progress bar has that value (0.0 means no progress, 1.0 means
-   complete). Otherwise, the progress bar is an indeterminate progress
-   bar.&lt;/dd&gt;
+    &lt;li&gt;Fire the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getRows()&lt;/a&gt;&lt;/code&gt;
+    method for row 1, then fire it again for rows 5 and 6, and then
+    fire the &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt;
+    method for the other rows (in all three cases, listing just column
+    C).&lt;/li&gt;
 
-   &lt;dt id=cellType2&gt;To establish how a simple text cell should be presented&lt;/dt&gt;
+   &lt;/ul&gt;&lt;p&gt;The two options here are as bad as each other; the former
+   involves a lot of overlap, but the latter involves a lot of method
+   calls. Unfortunately the user agent can't do the obvious thing,
+   namely just to invoke the &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt; method for all the
+   rows listing just column C, because it doesn't have the row
+   information for all the rows yet (rows 1, 5 and 6 are still
+   pending).&lt;/p&gt;
 
-   &lt;dd&gt;Check whether one of the &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;checked&lt;/a&gt;&lt;/code&gt;, &lt;code title=datagrid-cell-class-unchecked&gt;&lt;a href=#datagrid-cell-class-unchecked&gt;unchecked&lt;/a&gt;&lt;/code&gt;, or &lt;code title=datagrid-cell-class-indeterminate&gt;&lt;a href=#datagrid-cell-class-indeterminate&gt;indeterminate&lt;/a&gt;&lt;/code&gt;
-   classes applies to the cell. If any of these are present, then the
-   cell has a checkbox, otherwise none are present and the cell does
-   not have a checkbox. If the cell has no checkbox, check whether the
-   &lt;code title=datagrid-cell-class-editable&gt;&lt;a href=#datagrid-cell-class-editable&gt;editable&lt;/a&gt;&lt;/code&gt; class
-   applies to the cell. If it does, then the cell value is editable,
-   otherwise the cell value is static.&lt;/dd&gt;
+   &lt;p&gt;In any case, the data model now looks like this:&lt;/p&gt;
 
-   &lt;dt&gt;To establish the state of a cell's checkbox, if it has one&lt;/dt&gt;
+   &lt;table&gt;&lt;tr&gt;&lt;td&gt;        &lt;th&gt; Row     &lt;th&gt; Column A  &lt;th&gt; Column B  &lt;th&gt; Column C
+    &lt;tr&gt;&lt;th&gt; Row 1  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 2  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 3  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 4  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 5  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 6  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 7  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 8  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+   &lt;/table&gt;&lt;p&gt;If at this point the user scrolls around anywhere within this
+   &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, the user agent won't fire the &lt;code title=dom-listener-getRos&gt;getRos()&lt;/code&gt; and &lt;code title=dom-listener-getCells&gt;&lt;a href=#dom-listener-getcells&gt;getCells()&lt;/a&gt;&lt;/code&gt; methods, because
+   all of the rows and cells are covered.&lt;/p&gt;
 
-   &lt;dd&gt;Check whether the &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;checked&lt;/a&gt;&lt;/code&gt; class applies to
-   the cell. If it does, the cell is checked. Otherwise, check whether
-   the &lt;code title=datagrid-cell-class-unchecked&gt;&lt;a href=#datagrid-cell-class-unchecked&gt;unchecked&lt;/a&gt;&lt;/code&gt;
-   class applies to the cell. If it does, the cell is unchecked.
-   Otherwise, the &lt;code title=datagrid-cell-class-indeterminate&gt;&lt;a href=#datagrid-cell-class-indeterminate&gt;indeterminate&lt;/a&gt;&lt;/code&gt;
-   class applies to the cell and the cell's checkbox is in an
-   indeterminate state. When the &lt;code title=datagrid-cell-class-indeterminate&gt;&lt;a href=#datagrid-cell-class-indeterminate&gt;indeterminate&lt;/a&gt;&lt;/code&gt;
-   class applies to the cell, the checkbox is a tristate checkbox,
-   and the user can set it to the indeterminate state. Otherwise, only
-   the &lt;code title=datagrid-cell-class-checked&gt;&lt;a href=#datagrid-cell-class-checked&gt;checked&lt;/a&gt;&lt;/code&gt; and/or
-   &lt;code title=datagrid-cell-class-unchecked&gt;&lt;a href=#datagrid-cell-class-unchecked&gt;unchecked&lt;/a&gt;&lt;/code&gt;
-   classes apply to the cell, and the cell can only be toggled between
-   those two states.&lt;/dd&gt;
+   &lt;p&gt;Now consider the case where the user agent receives row
+   information, but no cell information, for rows 1, 5, and 6:&lt;/p&gt;
 
-  &lt;/dl&gt;&lt;p&gt;If the data provider ever raises an exception while the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is invoking one of its methods, the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must act, for the purposes of that particular
-  method call, as if the relevant method had not been defined.&lt;/p&gt;
+   &lt;table&gt;&lt;tr&gt;&lt;td&gt;        &lt;th&gt; Row     &lt;th&gt; Column A  &lt;th&gt; Column B  &lt;th&gt; Column C
+    &lt;tr&gt;&lt;th&gt; Row 1  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 2  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 3  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 4  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 5  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 6  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 7  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt;&lt;th&gt; Row 8  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+   &lt;/table&gt;&lt;p&gt;The user agent still won't fire any methods when the user
+   scrolls, because the data is still covered. But if the script then
+   calls the &lt;code title=dom-datagrid-renotify&gt;&lt;a href=#dom-datagrid-renotify&gt;renotify()&lt;/a&gt;&lt;/code&gt;
+   method, the &quot;Pending&quot; flags would get reset, and the model would
+   now look like this:&lt;/p&gt;
 
-  &lt;p&gt;A &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;p&lt;/var&gt; with
-  &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; path components passed to a method of the data
-  provider must fulfill the constraint &lt;span&gt;0&nbsp;&le;&nbsp;&lt;var title=&quot;&quot;&gt;p&lt;sub title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;&lt;/sub&gt;&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;var title=&quot;&quot;&gt;m&lt;/var&gt;-1&lt;/span&gt; for all integer values of &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; in the range &lt;span&gt;0&nbsp;&le;&nbsp;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;var title=&quot;&quot;&gt;n&lt;/var&gt;-1&lt;/span&gt;,
-  where &lt;var title=&quot;&quot;&gt;m&lt;/var&gt; is the value that was last returned by
-  the &lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount()&lt;/a&gt;&lt;/code&gt;
-  method when it was passed the &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object
-  &lt;var title=&quot;&quot;&gt;q&lt;/var&gt; with &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;-1&lt;/span&gt;
-  items, where &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;p&lt;sub title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;&lt;/sub&gt;&lt;/var&gt;&nbsp;=&nbsp;&lt;var title=&quot;&quot;&gt;q&lt;sub title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;&lt;/sub&gt;&lt;/var&gt;&lt;/span&gt; for all integer
-  values of &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; in the range
-  &lt;span&gt;0&nbsp;&le;&nbsp;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;var title=&quot;&quot;&gt;n&lt;/var&gt;-1&lt;/span&gt;, with any changes implied by the update
-  methods taken into account.&lt;/p&gt;
+   &lt;table&gt;&lt;tr&gt;&lt;td&gt;        &lt;th&gt; Row     &lt;th&gt; Column A  &lt;th&gt; Column B  &lt;th&gt; Column C
+    &lt;tr&gt;&lt;th&gt; Row 1  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+    &lt;tr&gt;&lt;th&gt; Row 2  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -      
+    &lt;tr&gt;&lt;th&gt; Row 3  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -      
+    &lt;tr&gt;&lt;th&gt; Row 4  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -      
+    &lt;tr&gt;&lt;th&gt; Row 5  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+    &lt;tr&gt;&lt;th&gt; Row 6  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+    &lt;tr&gt;&lt;th&gt; Row 7  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+    &lt;tr&gt;&lt;th&gt; Row 8  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+   &lt;/table&gt;&lt;p&gt;Now, assuming that all eight rows and all three columns are
+   still visible, the user agent has the following choices (amongst
+   others):&lt;/p&gt;
 
-  &lt;p id=inconsistentDataProvider&gt;The data model is considered
-  stable: user agents may assume that subsequent calls to the data
-  provider methods will return the same data, until one of the update
-  methods is called on the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element. If a user
-  agent is returned inconsistent data, for example if the number of
-  rows returned by &lt;code title=dom-provider-getRowCount&gt;&lt;a href=#dom-provider-getrowcount&gt;getRowCount()&lt;/a&gt;&lt;/code&gt; varies in ways
-  that do not match the calls made to the update methods, the user
-  agent may disable the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;. User agents that do not
-  disable the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; in inconsistent cases must honor
-  the most recently returned values.&lt;/p&gt;
+   &lt;ul&gt;&lt;li&gt;Fire the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getCells()&lt;/a&gt;&lt;/code&gt;
+    method for rows 1 through 8, listing all three columns.&lt;/li&gt;
 
-  &lt;p&gt;User agents may cache returned values so that the data provider
-  is never asked for data that could contradict earlier data. User
-  agents must not cache the return value of the &lt;code title=dom-provider-getRowMenu&gt;&lt;a href=#dom-provider-getrowmenu&gt;getRowMenu&lt;/a&gt;&lt;/code&gt; method.&lt;/p&gt;
+    &lt;li&gt;Fire the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getCells()&lt;/a&gt;&lt;/code&gt;
+    method for rows 1 and 5 through 8, listing all three columns, and
+    then fire the method for rows 2 through 4, listing just column
+    C.&lt;/li&gt;
 
-  &lt;p&gt;The exact algorithm used to populate the data grid is not defined
-  here, since it will differ based on the presentation used. However,
-  the behavior of user agents must be consistent with the
-  descriptions above. For example, it would be non-conformant for a
-  user agent to make cells have both a checkbox and be editable, as
-  the descriptions above state that cells that have a checkbox cannot
-  be edited.&lt;/p&gt; &lt;!-- XXX speaking of which, do we actually want that
-  limitation? --&gt;
+    &lt;li&gt;Fire the &lt;code title=dom-listener-getRows&gt;&lt;a href=#dom-listener-getrows&gt;getCells()&lt;/a&gt;&lt;/code&gt;
+    method for rows 1 and 5 through 8, listing just columns A abd B,
+    and then fire the method for rows 1 through 8, listing just column
+    C.&lt;/li&gt;
 
+   &lt;/ul&gt;&lt;p&gt;Here the latter two are preferable because they result in less
+   overlap than the first.&lt;/p&gt;
 
-  &lt;h5 id=updating-the-datagrid&gt;&lt;span class=secno&gt;4.11.2.6 &lt;/span&gt;Updating the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;&lt;/h5&gt;
+  &lt;/div&gt;
 
-  &lt;p&gt;Whenever the &lt;code title=dom-datagrid-data&gt;&lt;a href=#dom-datagrid-data&gt;data&lt;/a&gt;&lt;/code&gt;
-  attribute is set to a new value, the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must
-  clear the current selection, remove all the displayed rows, and plan
-  to repopulate itself using the information from the new data
-  provider at the earliest opportunity.&lt;/p&gt;
+  &lt;hr&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for tasks queued on behalf of a
+  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is the &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task
+  source&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;p&gt;There are a number of update methods that can be invoked on the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element to cause it to refresh itself in
-  slightly less drastic ways:&lt;/p&gt;
+  &lt;/div&gt;
 
-  &lt;p&gt;When the &lt;dfn id=dom-datagrid-updateeverything title=dom-datagrid-updateEverything&gt;&lt;code&gt;updateEverything()&lt;/code&gt;&lt;/dfn&gt;
-  method is called, the user agent must repopulate the entire
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;. If the number of rows decreased, the
-  selection must be updated appropriately. If the number of rows
-  increased, the new rows should be left unselected.&lt;/p&gt;
 
-  &lt;p&gt;When the &lt;dfn id=dom-datagrid-updaterowschanged title=dom-datagrid-updateRowsChanged&gt;&lt;code&gt;updateRowsChanged(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  is called, the user agent must refresh the rendering of the rows
-  starting from the row specified by &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, and
-  including the &lt;var title=&quot;&quot;&gt;count&lt;/var&gt; next siblings of the row (or
-  as many next siblings as it has, if that is less than &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;), including all descendant rows.&lt;/p&gt;
+  &lt;h5 id=listening-to-notifications-from-the-datagrid&gt;&lt;span class=secno&gt;4.11.2.3 &lt;/span&gt;Listening to notifications from the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;&lt;/h5&gt;
 
-  &lt;p&gt;When the &lt;dfn id=dom-datagrid-updaterowsinserted title=dom-datagrid-updateRowsInserted&gt;&lt;code&gt;updateRowsInserted(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  is called, the user agent must assume that &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;
-  new rows have been inserted, such that the first new row is
-  identified by &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;. The user agent must update
-  its rendering and the selection accordingly. The new rows should not
-  be selected.&lt;/p&gt;
+  &lt;p&gt;&lt;em&gt;The conformance criteria in this section apply to any
+  implementation of the &lt;code&gt;&lt;a href=#datagridlistener&gt;DataGridListener&lt;/a&gt;&lt;/code&gt; interface,
+  including (and most commonly) the content author's
+  implementation(s).&lt;/em&gt;&lt;/p&gt;
 
-  &lt;p&gt;When the &lt;dfn id=dom-datagrid-updaterowsremoved title=dom-datagrid-updateRowsRemoved&gt;&lt;code&gt;updateRowsRemoved(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  is called, the user agent must assume that &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;
-  rows have been removed starting from the row that used to be
-  identifier by &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;.  The user agent must update
-  its rendering and the selection accordingly.&lt;/p&gt;
+  &lt;pre class=idl&gt;// To be implemented by Web authors as a JS object
+[NoInterfaceObject] interface &lt;dfn id=datagridlistener&gt;DataGridListener&lt;/dfn&gt; {
+  void &lt;a href=#dom-listener-initialize title=dom-listener-initialize&gt;initialize&lt;/a&gt;(in &lt;a href=#htmldatagridelement&gt;HTMLDataGridElement&lt;/a&gt; datagrid);
 
-  &lt;p&gt;The &lt;dfn id=dom-datagrid-updaterowchanged title=dom-datagrid-updateRowChanged&gt;&lt;code&gt;updateRowChanged(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must be exactly equivalent
-  to calling &lt;code title=dom-datagrid-updateRowsChanged&gt;&lt;a href=#dom-datagrid-updaterowschanged&gt;updateRowsChanged(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, 1)&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+  void &lt;a href=#dom-listener-getrows title=dom-listener-getRows&gt;getRows&lt;/a&gt;(in unsigned long rowIndex, in unsigned long rowCount, in &lt;a href=#rowid&gt;RowID&lt;/a&gt; parentRow, in unsigned long position, in &lt;a href=#columnlist&gt;ColumnList&lt;/a&gt; columns);
+  void &lt;a href=#dom-listener-getcells title=dom-listener-getCells&gt;getCells&lt;/a&gt;(in &lt;a href=#rowidlist&gt;RowIDList&lt;/a&gt; rows, in &lt;a href=#columnlist&gt;ColumnList&lt;/a&gt; columns);
+  void &lt;a href=#dom-listener-rowopened title=dom-listener-rowOpened&gt;rowOpened&lt;/a&gt;(in &lt;a href=#rowid&gt;RowID&lt;/a&gt; row, in boolean rowCountNeeded);
+  void &lt;a href=#dom-listener-rowclosed title=dom-listener-rowClosed&gt;rowClosed&lt;/a&gt;(in &lt;a href=#rowid&gt;RowID&lt;/a&gt; row);
 
-  &lt;p&gt;When the &lt;dfn id=dom-datagrid-updatecolumnchanged title=dom-datagrid-updateColumnChanged&gt;&lt;code&gt;updateColumnChanged(&lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is called, the user agent
-  must refresh the rendering of the specified column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, for all rows.&lt;/p&gt;
+  void &lt;a href=#dom-listener-cellchanged title=dom-listener-cellChanged&gt;cellChanged&lt;/a&gt;(in &lt;a href=#rowid&gt;RowID&lt;/a&gt; row, in &lt;a href=#column&gt;Column&lt;/a&gt; column, in any newValue, in any prevValue);
+  &lt;a href=#htmlmenuelement&gt;HTMLMenuElement&lt;/a&gt; &lt;a href=#dom-listener-getrowmenu title=dom-listener-getRowMenu&gt;getRowMenu&lt;/a&gt;(in &lt;a href=#rowid&gt;RowID&lt;/a&gt; row);
+&lt;!--vsDGDND
+  boolean &lt;span title=&quot;dom-listener-canDrop&quot;&gt;canDrop&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in &lt;span&gt;RowID&lt;/span&gt; position, data);
+  boolean &lt;span title=&quot;dom-listener-dropped&quot;&gt;dropped&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in &lt;span&gt;RowID&lt;/span&gt; position, data);
+--&gt;&lt;!--v2DGPA
+  void &lt;span title=&quot;dom-listener-performAction&quot;&gt;performAction&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in DOMString action);
+--&gt;};&lt;/pre&gt;
 
-  &lt;p&gt;When the &lt;dfn id=dom-datagrid-updatecellchanged title=dom-datagrid-updateCellChanged&gt;&lt;code&gt;updateCellChanged(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  is called, the user agent must refresh the rendering of the cell on
-  row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, in column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;.&lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;DataGridDataProvider&lt;/code&gt; interface, once implemented
+  by an object in a script and hooked up to a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;
+  using the &lt;dfn id=dom-datagrid-data title=dom-datagrid-data&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute, receives notifications when the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;
+  needs information (such as which rows exist) for display.&lt;/p&gt;
 
-  &lt;p&gt;Any effects the update methods have on the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s selection is not considered a change to the
-  selection, and must therefore not fire the &lt;code title=event-select&gt;&lt;a href=#event-select&gt;select&lt;/a&gt;&lt;/code&gt; event.&lt;/p&gt;
+  &lt;p&gt;The following methods may be usefully implemented:&lt;/p&gt;
 
-  &lt;p&gt;These update methods should be called only by the data provider,
-  or code acting on behalf of the data provider. In particular,
-  calling the &lt;code title=dom-datagrid-updateRowsInserted&gt;&lt;a href=#dom-datagrid-updaterowsinserted&gt;updateRowsInserted()&lt;/a&gt;&lt;/code&gt;
-  and &lt;code title=dom-datagrid-updateRowsRemoved&gt;&lt;a href=#dom-datagrid-updaterowsremoved&gt;updateRowsRemoved()&lt;/a&gt;&lt;/code&gt;
-  methods without actually inserting or removing rows from the data
-  provider is &lt;a href=#inconsistentDataProvider&gt;likely to result in
-  inconsistent renderings&lt;/a&gt;, and the user agent is likely to disable
-  the data grid.&lt;/p&gt;
+  &lt;dl&gt;&lt;dt&gt;&lt;dfn id=dom-listener-initialize title=dom-listener-initialize&gt;&lt;code&gt;initialize(&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
+   &lt;dd&gt;
 
-  &lt;h5 id=requirements-for-interactive-user-agents&gt;&lt;span class=secno&gt;4.11.2.7 &lt;/span&gt;Requirements for interactive user agents&lt;/h5&gt;
+    &lt;p&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element (the one given by
+    the &lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; argument) when the &lt;code title=dom-datagrid-listener&gt;&lt;a href=#dom-datagrid-listener&gt;listener&lt;/a&gt;&lt;/code&gt; attribute is
+    set.&lt;/p&gt;
 
-  &lt;p&gt;&lt;em&gt;This section only applies to interactive user agents.&lt;/em&gt;&lt;/p&gt;
+   &lt;/dd&gt;
 
-  &lt;p&gt;If the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element has a &lt;dfn id=attr-datagrid-disabled title=attr-datagrid-disabled&gt;&lt;code&gt;disabled&lt;/code&gt;&lt;/dfn&gt;
-  attribute, then the user agent must disable the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;, preventing the user from interacting with it.
-  The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element should still continue to update
-  itself when the data provider signals changes to the data, though.
-  Obviously, conformance requirements stating that
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; elements must react to users in particular
-  ways do not apply when one is disabled.&lt;/p&gt;
+   &lt;dt&gt;&lt;dfn id=dom-listener-getrows title=dom-listener-getRows&gt;&lt;code&gt;getRows(&lt;var title=&quot;&quot;&gt;rowIndex&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;columns&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-  &lt;p&gt;If &lt;a href=#rowType1&gt;a row is openable&lt;/a&gt;, then the user agent
-  should offer to the user the option of toggling the row's
-  open/closed state. When a row's open/closed state changes, the user
-  agent must update the rendering to match the new state.&lt;/p&gt;
+   &lt;dd&gt;
 
-  &lt;p&gt;If a cell is a cell whose value &lt;a href=#cellType1&gt;can be
-  cycled between multiple states&lt;/a&gt;, then the user agent should allow
-  the user to activate the cell to cycle its value. When the user
-  activates this &quot;cycling&quot; behavior of a cell, then the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must invoke the data provider's &lt;code title=dom-provider-cycleCell&gt;&lt;a href=#dom-provider-cyclecell&gt;cycleCell()&lt;/a&gt;&lt;/code&gt; method, with a
-  &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing the cell's row as
-  the first argument and the cell's column index as the second. The
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must then act as if the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s &lt;code title=dom-datagrid-updateCellChanged&gt;&lt;a href=#dom-datagrid-updatecellchanged&gt;updateCellChanged()&lt;/a&gt;&lt;/code&gt;
-  method had been invoked with those same arguments.&lt;/p&gt;
+    &lt;p&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element when the user agent
+    finds itself needing to render rows for which it is lacking
+    information.&lt;/p&gt;
 
-  &lt;p&gt;When a cell &lt;a href=#cellType2&gt;has a checkbox&lt;/a&gt;, the user
-  agent should allow the user to set the checkbox's state. When the
-  user changes the state of a checkbox in such a cell, the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must invoke the data provider's &lt;code title=dom-provider-setCellCheckedState&gt;&lt;a href=#dom-provider-setcellcheckedstate&gt;setCellCheckedState()&lt;/a&gt;&lt;/code&gt;
-  method, with a &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt; object representing the
-  cell's row as the first argument, the cell's column index as the
-  second, and the checkbox's new state as the third. The state should
-  be represented by the number 1 if the new state is checked, 0 if the
-  new state is unchecked, and &minus;1 if the new state is
-  indeterminate (which must be possible only if the cell has the &lt;code title=datagrid-cell-class-indeterminate&gt;&lt;a href=#datagrid-cell-class-indeterminate&gt;indeterminate&lt;/a&gt;&lt;/code&gt; class
-  set). The &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must then act as if the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s &lt;code title=dom-datagrid-updateCellChanged&gt;&lt;a href=#dom-datagrid-updatecellchanged&gt;updateCellChanged()&lt;/a&gt;&lt;/code&gt;
-  method had been invoked, specifying the same cell.&lt;/p&gt;
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rowIndex&lt;/var&gt; argument gives the flattened
+    index of the first row for which it needs information, ignoring
+    the tree structure of the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; model, where zero
+    is the first row of the entire tree.&lt;/p&gt;
 
-  &lt;p&gt;If a cell &lt;a href=#cellType2&gt;is editable&lt;/a&gt;, the user agent
-  should allow the user to edit the data for that cell, and doing so
-  must cause the user agent to invoke the &lt;code title=dom-provider-editCell&gt;&lt;a href=#dom-provider-editcell&gt;editCell()&lt;/a&gt;&lt;/code&gt; method of the data
-  provider with three arguments: a &lt;code&gt;&lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt;&lt;/code&gt;
-  object representing the cell's row, the cell's column's index, and
-  the new text entered by the user. The user agent must then act as if
-  the &lt;code title=dom-datagrid-updateCellChanged&gt;&lt;a href=#dom-datagrid-updatecellchanged&gt;updateCellChanged()&lt;/a&gt;&lt;/code&gt;
-  method had been invoked, with the same row and column specified.&lt;/p&gt;
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt; argument gives the number of
+    rows for which the user agent would like information.&lt;/p&gt;
 
-  &lt;!-- XXXPA &lt;p class=&quot;XXX&quot;&gt;define actions (performAction(), etc)&lt;/p&gt; --&gt;
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt; argument gives the
+    &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object identifying the nearest ancestor of the
+    first row that the user agent is aware of. After the sort order
+    has changed, this will typically be the root of the tree
+    (identified by a &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object consisting of an empty
+    array).
 
-  &lt;h5 id=the-selection&gt;&lt;span class=secno&gt;4.11.2.8 &lt;/span&gt;The selection&lt;/h5&gt;
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;columns&lt;/var&gt; argument gives the columns for
+    which the user agent is lacking information, as an array of column
+    identifiers (as passed to &lt;code title=dom-datagrid-addColumn&gt;&lt;a href=#dom-datagrid-addcolumn&gt;addColumn()&lt;/a&gt;&lt;/code&gt;).&lt;/p&gt;
 
-  &lt;p&gt;&lt;em&gt;This section only applies to interactive user agents. For
-  other user agents, the &lt;code title=dom-datagrid-selection&gt;&lt;a href=#dom-datagrid-selection&gt;selection&lt;/a&gt;&lt;/code&gt; attribute must
-  return null.&lt;/em&gt;&lt;/p&gt;
+   &lt;/dd&gt;
 
-  &lt;pre class=idl&gt;interface &lt;dfn id=datagridselection&gt;DataGridSelection&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;span title=dom-DataGridSelection-count&gt;length&lt;/span&gt;;
-  [IndexGetter] &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; &lt;a href=#dom-datagridselection-item title=dom-DataGridSelection-item&gt;item&lt;/a&gt;(in unsigned long index);
-  boolean &lt;a href=#dom-datagridselection-isselected title=dom-DataGridSelection-isSelected&gt;isSelected&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row);
-  void &lt;a href=#dom-datagridselection-setselected title=dom-DataGridSelection-setSelected&gt;setSelected&lt;/a&gt;(in &lt;a href=#rowspecification&gt;RowSpecification&lt;/a&gt; row, in boolean selected);
-&lt;!--  void &lt;span title=&quot;dom-DataGridSelection-addRange&quot;&gt;addRange&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; first, in &lt;span&gt;RowSpecification&lt;/span&gt; last);
-  void &lt;span title=&quot;dom-DataGridSelection-removeRange&quot;&gt;removeRange&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; first, in &lt;span&gt;RowSpecification&lt;/span&gt; last);
-XXX selection ranges --&gt;
-  void &lt;a href=#dom-datagridselection-selectall title=dom-DataGridSelection-selectAll&gt;selectAll&lt;/a&gt;();
-  void &lt;a href=#dom-datagridselection-invert title=dom-DataGridSelection-invert&gt;invert&lt;/a&gt;();
-  void &lt;a href=#dom-datagridselection-clear title=dom-DataGridSelection-clear&gt;clear&lt;/a&gt;();
+   &lt;dt&gt;&lt;dfn id=dom-listener-getcells title=dom-listener-getCells&gt;&lt;code&gt;getCells(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;columns&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element when the user agent
+    finds itself needing to render cells for which it is lacking
+    information in rows that it does know about.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument gives an array of
+    &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; objects identifying the various rows for which
+    the user agent is lacking information.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;columns&lt;/var&gt; argument gives the columns for
+    which the user agent is lacking information, as an array of column
+    identifiers (as passed to &lt;code title=dom-datagrid-addColumn&gt;&lt;a href=#dom-datagrid-addcolumn&gt;addColumn()&lt;/a&gt;&lt;/code&gt;).&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-listener-rowopened title=dom-listener-rowOpened&gt;&lt;code&gt;rowOpened(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;rowCountNeeded&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element when the user has
+    opened a row.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; argument gives an
+    &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object identifying the row that was opened.&lt;/p&gt;
+
+    &lt;p&gt;If the user agent also knows how many children that row has,
+    then the &lt;var title=&quot;&quot;&gt;rowCountNeeded&lt;/var&gt; argument will be
+    false. Otherwise, the argument will be true, and the row will
+    remain closed until the &lt;code title=dom-datagrid-setRows&gt;&lt;a href=#dom-datagrid-setrows&gt;setRows()&lt;/a&gt;&lt;/code&gt; method is called
+    with an accurate row count.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-listener-rowclosed title=dom-listener-rowClosed&gt;&lt;code&gt;rowClosed(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element when the user has
+    opened a row.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; argument gives an
+    &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object identifying the row that was closed.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-listener-cellchanged title=dom-listener-cellChanged&gt;&lt;code&gt;cellChanged(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;newValue&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;prevValue&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element when the user has
+    edited a cell or checked a check box in a cell.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; argument gives an
+    &lt;code&gt;&lt;a href=#rowid&gt;RowID&lt;/a&gt;&lt;/code&gt; object identifying the row of the cell, and the
+    &lt;var title=&quot;&quot;&gt;column&lt;/var&gt; argument gives the identifier of the
+    cell's column.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;newValue&lt;/var&gt; argument gives the new value,
+    and the &lt;var title=&quot;&quot;&gt;prevValue&lt;/var&gt; argument gives the previous
+    value.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-listener-getrowmenu title=dom-listener-getRowMenu&gt;&lt;code&gt;getRowMenu(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;Must return an &lt;code&gt;&lt;a href=#htmlmenuelement&gt;HTMLMenuElement&lt;/a&gt;&lt;/code&gt; object that is to
+   be used as a context menu for row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, or null
+   if there is no particular context menu. May be omitted if none of
+   the rows have a special context menu. As this method is called
+   immediately before showing the menu in question, no precautions
+   need to be taken if the return value of this method changes.&lt;/dd&gt;
+
+   &lt;!--v2DGDND, v2DFPA--&gt;
+
+  &lt;/dl&gt;&lt;div class=impl&gt;
+
+  &lt;p&gt;Objects that implement the &lt;code&gt;&lt;a href=#datagridlistener&gt;DataGridListener&lt;/a&gt;&lt;/code&gt;
+  interface may omit any or all of the methods. When a method is
+  omitted, a user agent intending to call that method must instead
+  skip the method call, and must assume that the method's return value
+  is null.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+
+
+&lt;!-- v2DGS: &lt;datagrid&gt; selection (search for the bits marked &quot;...&quot; to see what needs filling in, at a minimum)
+
+  &lt;h5&gt;The selection&lt;/h5&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;DataGridSelection&lt;/dfn&gt; {
+  readonly attribute unsigned long &lt;span title=&quot;dom-DataGridSelection-length&quot;&gt;length&lt;/span&gt;;
+  [IndexGetter] &lt;span&gt;RowID&lt;/span&gt; &lt;span title=&quot;dom-DataGridSelection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
+  boolean &lt;span title=&quot;dom-DataGridSelection-isSelected&quot;&gt;isSelected&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row);
+  void &lt;span title=&quot;dom-DataGridSelection-setSelected&quot;&gt;setSelected&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in boolean selected);
+  void &lt;span title=&quot;dom-DataGridSelection-selectAll&quot;&gt;selectAll&lt;/span&gt;();
+  void &lt;span title=&quot;dom-DataGridSelection-clear&quot;&gt;clear&lt;/span&gt;();
 };&lt;/pre&gt;
 
-  &lt;p&gt;Each &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element must keep track of which rows
+  &lt;dl class=&quot;domintro&quot;&gt;
+
+   ...
+
+  &lt;/dl&gt;
+
+  &lt;div class=&quot;impl&quot;&gt;
+
+  &lt;p&gt;Each &lt;code&gt;datagrid&lt;/code&gt; element must keep track of which rows
   are currently selected. Initially no rows are selected, but this can
-  be changed via the methods described in this section. &lt;!--XXX
-  select-provider-selection The default data provider, for instance,
-  changes which rows are selected when it is first initialized.--&gt;&lt;/p&gt;
+  be changed via the methods described in this section.&lt;/p&gt;
 
-  &lt;p&gt;The selection of a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; is represented by its
-  &lt;dfn id=dom-datagrid-selection title=dom-datagrid-selection&gt;&lt;code&gt;selection&lt;/code&gt;&lt;/dfn&gt; DOM
-  attribute, which must be a &lt;code&gt;&lt;a href=#datagridselection&gt;DataGridSelection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+  &lt;p&gt;The selection of a &lt;code&gt;datagrid&lt;/code&gt; is represented by its
+  &lt;dfn title=&quot;dom-datagrid-selection&quot;&gt;&lt;code&gt;selection&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute, which must be a &lt;code&gt;DataGridSelection&lt;/code&gt; object.&lt;/p&gt;
 
-  &lt;p&gt;&lt;code&gt;&lt;a href=#datagridselection&gt;DataGridSelection&lt;/a&gt;&lt;/code&gt; objects represent the rows in the
-  selection. In the selection the rows must be ordered in the natural
-  order of the data provider (and not, e.g., the rendered order). Rows
-  that are not rendered because one of their ancestors is closed must
-  share the same selection state as their nearest rendered
-  ancestor. Such rows are not considered part of the selection for the
-  purposes of iterating over the selection.&lt;/p&gt;
+  &lt;p&gt;&lt;code&gt;DataGridSelection&lt;/code&gt; objects represent the rows in the
+  selection. In the selection the rows must be ordered in their
+  natural order (and not, e.g., the display order). A row with an
+  ancestor that is closed cannot be selected.&lt;/p&gt;
 
-  &lt;p class=note&gt;This selection API doesn't allow for hidden rows to
-  be selected because it is trivial to create a data provider that has
-  infinite depth, which would then require the selection to be
-  infinite if every row, including every hidden row, was selected.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-datagridselection-length title=dom-DataGridSelection-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataGridSelection-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
   attribute must return the number of rows currently present in the
-  selection. This is the &lt;var title=dom-DataGridSelection-length&gt;&lt;a href=#dom-datagridselection-length&gt;length&lt;/a&gt;&lt;/var&gt;.&lt;/p&gt;
+  selection. This is the &lt;var
+  title=&quot;dom-DataGridSelection-length&quot;&gt;length&lt;/var&gt;.&lt;/p&gt;
 
   &lt;p&gt;The object's &lt;span&gt;indices of the supported indexed
-  properties&lt;/span&gt; are the numbers in the range zero to &lt;span title=&quot;&quot;&gt;&lt;var title=dom-DataGridSelection-length&gt;&lt;a href=#dom-datagridselection-length&gt;length&lt;/a&gt;&lt;/var&gt;-1&lt;/span&gt;, unless
-  the &lt;var title=dom-DataGridSelection-length&gt;&lt;a href=#dom-datagridselection-length&gt;length&lt;/a&gt;&lt;/var&gt; is zero,
+  properties&lt;/span&gt; are the numbers in the range zero to &lt;span title=&quot;&quot;&gt;&lt;var
+  title=&quot;dom-DataGridSelection-length&quot;&gt;length&lt;/var&gt;-1&lt;/span&gt;, unless
+  the &lt;var title=&quot;dom-DataGridSelection-length&quot;&gt;length&lt;/var&gt; is zero,
   in which case there are no &lt;span&gt;supported indexed
   properties&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-datagridselection-item title=dom-DataGridSelection-item&gt;&lt;code&gt;item(&lt;var title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th row in the selection. If the argument is out
+  &lt;p&gt;The &lt;dfn title=&quot;dom-DataGridSelection-item&quot;&gt;&lt;code&gt;item(&lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return a
+  &lt;code&gt;RowID&lt;/code&gt; object identifying the &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;th row in the selection. If the argument is out
   of range (less than zero or greater than the number of selected rows
-  minus one), then it must raise an &lt;code&gt;&lt;a href=#index_size_err&gt;INDEX_SIZE_ERR&lt;/a&gt;&lt;/code&gt;
-  exception. &lt;a href=#refsDOM3CORE&gt;[DOM3CORE]&lt;/a&gt;&lt;/p&gt;
+  minus one), then it must raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt;
+  exception. &lt;a href=&quot;#refsDOM3CORE&quot;&gt;[DOM3CORE]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-datagridselection-isselected title=dom-DataGridSelection-isSelected&gt;&lt;code&gt;isSelected()&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataGridSelection-isSelected&quot;&gt;&lt;code&gt;isSelected()&lt;/code&gt;&lt;/dfn&gt;
   method must return the selected state of the row specified by its
-  argument. If the specified row exists and is selected, it must
-  return true, otherwise it must return false.&lt;/p&gt;
+  argument. If the specified row is in the &lt;span&gt;natural order sparse
+  data tree&lt;/span&gt; and is selected, the method must return true,
+  otherwise it must return false.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-datagridselection-setselected title=dom-DataGridSelection-setSelected&gt;&lt;code&gt;setSelected()&lt;/code&gt;&lt;/dfn&gt;
-  method takes two arguments, &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;selected&lt;/var&gt;. When invoked, it must set the selection
-  state of row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; to selected if &lt;var title=&quot;&quot;&gt;selected&lt;/var&gt; is true, and unselected if it is false. If
-  &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is not a row in the data grid, the method
-  must raise an &lt;code&gt;&lt;a href=#index_size_err&gt;INDEX_SIZE_ERR&lt;/a&gt;&lt;/code&gt; exception. If the
-  specified row is not rendered because one of its ancestors is
-  closed, the method must do nothing.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataGridSelection-setSelected&quot;&gt;&lt;code&gt;setSelected()&lt;/code&gt;&lt;/dfn&gt;
+  method takes two arguments, &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; and &lt;var
+  title=&quot;&quot;&gt;selected&lt;/var&gt;. When invoked, it must set the selection
+  state of row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; to selected if &lt;var
+  title=&quot;&quot;&gt;selected&lt;/var&gt; is true, and unselected if it is false. If
+  &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; does not specify a row in the &lt;span&gt;natural
+  order sparse data tree&lt;/span&gt; ...
 
-  &lt;p&gt;The &lt;dfn id=dom-datagridselection-selectall title=dom-DataGridSelection-selectAll&gt;&lt;code&gt;selectAll()&lt;/code&gt;&lt;/dfn&gt;
-  method must mark all the rows in the data grid as selected. After a
-  call to &lt;code title=dom-DataGridSelection-selectAll&gt;&lt;a href=#dom-datagridselection-selectall&gt;selectAll()&lt;/a&gt;&lt;/code&gt;, the
-  &lt;code title=dom-DataGridSelection-length&gt;&lt;a href=#dom-datagridselection-length&gt;length&lt;/a&gt;&lt;/code&gt; attribute
-  will return the number of rows in the data grid, not counting
-  children of closed rows.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataGridSelection-selectAll&quot;&gt;&lt;code&gt;selectAll()&lt;/code&gt;&lt;/dfn&gt;
+  method must ...
 
-  &lt;p&gt;The &lt;dfn id=dom-datagridselection-invert title=dom-DataGridSelection-invert&gt;&lt;code&gt;invert()&lt;/code&gt;&lt;/dfn&gt;
-  method must cause all the rows in the selection that were marked as
-  selected to now be marked as not selected, and vice versa.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-datagridselection-clear title=dom-DataGridSelection-clear&gt;&lt;code&gt;clear()&lt;/code&gt;&lt;/dfn&gt;
-  method must mark all the rows in the data grid to be marked as not
-  selected.  After a call to &lt;code title=dom-DataGridSelection-clear&gt;&lt;a href=#dom-datagridselection-clear&gt;clear()&lt;/a&gt;&lt;/code&gt;, the &lt;code title=dom-DataGridSelection-length&gt;&lt;a href=#dom-datagridselection-length&gt;length&lt;/a&gt;&lt;/code&gt; attribute will
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataGridSelection-clear&quot;&gt;&lt;code&gt;clear()&lt;/code&gt;&lt;/dfn&gt;
+  method must mark all the rows in the &lt;code&gt;datagrid&lt;/code&gt; as not
+  selected. After a call to &lt;code
+  title=&quot;dom-DataGridSelection-clear&quot;&gt;clear()&lt;/code&gt;, the &lt;code
+  title=&quot;dom-DataGridSelection-length&quot;&gt;length&lt;/code&gt; attribute will
   return zero.&lt;/p&gt;
 
-  &lt;p&gt;If the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element has a &lt;dfn id=attr-datagrid-multiple title=attr-datagrid-multiple&gt;&lt;code&gt;multiple&lt;/code&gt;&lt;/dfn&gt;
-  attribute, then the user agent should allow the user to select any
-  number of rows (zero or more). If the attribute is not present, then
-  the user agent must not allow the user to select more than a single
-  row at a time, and selecting another one must unselect all the other
-  rows.&lt;/p&gt;
+  &lt;p&gt;If the &lt;code&gt;datagrid&lt;/code&gt; element has a &lt;code
+  title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt; attribute, then the
+  user agent should allow the user to select any number of rows (zero
+  or more). If the attribute is not present, then the user agent
+  should allow the user to select a row, and must not allow the user
+  to select more than a single row at a time; selecting another one
+  must unselect all the other rows.&lt;/p&gt;
 
-  &lt;p class=note&gt;This only applies to the user. Scripts can select
-  multiple rows even when the &lt;code title=attr-datagrid-multiple&gt;&lt;a href=#attr-datagrid-multiple&gt;multiple&lt;/a&gt;&lt;/code&gt; attribute is
+  &lt;p class=&quot;note&quot;&gt;This only applies to the user. Scripts can select
+  multiple rows even when the &lt;code
+  title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt; attribute is
   absent.&lt;/p&gt;
 
-  &lt;p&gt;Whenever the selection of a &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; changes,
-  whether due to the user interacting with the element, or as a result
-  of calls to methods of the &lt;code title=dom-datagrid-selection&gt;&lt;a href=#dom-datagrid-selection&gt;selection&lt;/a&gt;&lt;/code&gt; object, a &lt;dfn id=event-select title=event-select&gt;&lt;code&gt;select&lt;/code&gt;&lt;/dfn&gt;&lt;!-- XXX check if we
-  really should be DFNing this here. It's a DOM3 Core event. What's
-  our story going to be regarding events and defining them? --&gt; event
-  that bubbles but is not cancelable must be fired on the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element. If changes are made to the selection
-  via calls to the object's methods during the execution of a
-  script&lt;!-- XXX should xref to a better explanation --&gt;, then the
-  &lt;code title=event-select&gt;&lt;a href=#event-select&gt;select&lt;/a&gt;&lt;/code&gt; events must be coalesced
-  into one, which must then be fired&lt;!--XXX xref again--&gt; when the
-  script execution has completed&lt;!-- XXX xref --&gt;.&lt;/p&gt;
+  ...event on selection change?...
 
-  &lt;p class=note&gt;The &lt;code&gt;&lt;a href=#datagridselection&gt;DataGridSelection&lt;/a&gt;&lt;/code&gt; interface has no
-  relation to the &lt;code&gt;&lt;a href=#selection-0&gt;Selection&lt;/a&gt;&lt;/code&gt; interface.&lt;/p&gt;
+  &lt;/div&gt;
 
+  &lt;p class=&quot;note&quot;&gt;The &lt;code&gt;DataGridSelection&lt;/code&gt; interface has no
+  relation to the &lt;code&gt;Selection&lt;/code&gt; interface.&lt;/p&gt;
 
-  &lt;h5 id=columns-and-captions&gt;&lt;span class=secno&gt;4.11.2.9 &lt;/span&gt;Columns and captions&lt;/h5&gt;
+--&gt;
 
-  &lt;p&gt;&lt;em&gt;This section only applies to interactive user agents.&lt;/em&gt;&lt;/p&gt;
 
-  &lt;p&gt;Each &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; element must keep track of which
-  columns are currently being rendered. User agents should initially
-  show all the columns except those with the &lt;code title=datagrid-column-class-initially-hidden&gt;&lt;a href=#datagrid-column-class-initially-hidden&gt;initially-hidden&lt;/a&gt;&lt;/code&gt;
-  class, but may allow users to hide or show columns. User agents
-  should initially display the columns in the order given by the data
-  provider, but may allow this order to be changed by the user.&lt;/p&gt;
-
-  &lt;p&gt;If columns are not being used, as might be the case if the data
-  grid is being presented in an icon view, or if an overview of data
-  is being read in an aural context, then the text of the first column
-  of each row should be used to represent the row.&lt;/p&gt;
-
-  &lt;p&gt;If none of the columns have any captions (i.e. if the data
-  provider does not provide a &lt;code title=dom-provider-getCaptionText&gt;&lt;a href=#dom-provider-getcaptiontext&gt;getCaptionText()&lt;/a&gt;&lt;/code&gt; method),
-  then user agents may avoid showing the column headers at all. This
-  may prevent the user from performing actions on the columns (such as
-  reordering them, changing the sort column, and so on).&lt;/p&gt;
-
-  &lt;p class=note&gt;Whatever the order used for rendering, and
-  irrespective of what columns are being shown or hidden, the &quot;first
-  column&quot; as referred to in this specification is always the column
-  with index zero, and the &quot;last column&quot; is always the column with the
-  index one less than the value returned by the &lt;code title=dom-provider-getcolumnCount&gt;&lt;a href=#dom-provider-getcolumncount&gt;getColumnCount()&lt;/a&gt;&lt;/code&gt; method
-  of the data provider.&lt;/p&gt;
-
-  &lt;p&gt;If &lt;a href=#columnType2&gt;a column is sortable&lt;/a&gt;, then the user
-  agent should allow the user to request that the data be sorted using
-  that column. When the user does so, then the &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;
-  must invoke the data provider's &lt;code title=dom-provider-toggleColumnSortState&gt;&lt;a href=#dom-provider-togglecolumnsortstate&gt;toggleColumnSortState()&lt;/a&gt;&lt;/code&gt;
-  method, with the column's index as the only argument. The
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt; must &lt;em&gt;then&lt;/em&gt; act as if the
-  &lt;code&gt;&lt;a href=#datagrid&gt;datagrid&lt;/a&gt;&lt;/code&gt;'s &lt;code title=dom-datagrid-updateEverything&gt;&lt;a href=#dom-datagrid-updateeverything&gt;updateEverything()&lt;/a&gt;&lt;/code&gt;
-  method had been invoked.&lt;/p&gt;
-
-&lt;!--XXXDND
+&lt;!--vsDGDND
   &lt;h5&gt;Drag and drop in &lt;code&gt;datagrid&lt;/code&gt;s&lt;/h5&gt;
 
   &lt;p&gt;&lt;em&gt;This section only applies to interactive user agents.&lt;/em&gt;&lt;/p&gt;
 
-  &lt;p class=&quot;XXX&quot;&gt;define drag and drop in datagrids; selectiondraggable, etc.&lt;/p&gt;
+  ...define drag and drop in datagrids; selectiondraggable...
 --&gt;
-&lt;/div&gt;
 
 
   &lt;h4 id=the-command&gt;&lt;span class=secno&gt;4.11.3 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;command&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
@@ -40410,7 +41087,7 @@
 
   &lt;h3 id=scripting&gt;&lt;span class=secno&gt;5.5 &lt;/span&gt;Scripting&lt;/h3&gt;
 
-  &lt;h4 id=introduction-1&gt;&lt;span class=secno&gt;5.5.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-2&gt;&lt;span class=secno&gt;5.5.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;Various mechanisms can cause author-provided executable code to
   run in the context of a document. These mechanisms include, but are
@@ -41269,7 +41946,7 @@
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-onmousewheel title=handler-onmousewheel&gt;&lt;code&gt;onmousewheel&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-mousewheel&gt;mousewheel&lt;/code&gt; &lt;!-- widely used --&gt;
 &lt;!--&lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-onpaste&quot;&gt;&lt;code&gt;onpaste&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-paste&quot;&gt;paste&lt;/code&gt;--&gt; &lt;!-- widely used --&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-onscroll title=handler-onscroll&gt;&lt;code&gt;onscroll&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-scroll&gt;scroll&lt;/code&gt; &lt;!-- widely used --&gt; &lt;!-- XXX should define when it fires --&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-onselect title=handler-onselect&gt;&lt;code&gt;onselect&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-select&gt;&lt;a href=#event-select&gt;select&lt;/a&gt;&lt;/code&gt; &lt;!-- widely used --&gt; &lt;!-- XXX should define when it fires --&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-onselect title=handler-onselect&gt;&lt;code&gt;onselect&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-select&gt;select&lt;/code&gt; &lt;!-- widely used --&gt; &lt;!-- XXX should define when it fires --&gt;
 &lt;!--&lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-onselectstart&quot;&gt;&lt;code&gt;onselectstart&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-selectstart&quot;&gt;selectstart&lt;/code&gt;--&gt; &lt;!-- widely used --&gt; &lt;!-- XXX should define when it fires --&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-onsubmit title=handler-onsubmit&gt;&lt;code&gt;onsubmit&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-submit&gt;submit&lt;/code&gt; &lt;!-- widely used --&gt;
   &lt;/table&gt;&lt;hr&gt;&lt;p&gt;The following are the &lt;a href=#event-handler-attributes-0&gt;event handler attributes&lt;/a&gt; (and their corresponding &lt;a href=#event-handler-event-type title=&quot;event handler event type&quot;&gt;event handler event types&lt;/a&gt;)
@@ -42359,7 +43036,7 @@
 
   &lt;h3 id=offline&gt;&lt;span class=secno&gt;5.8 &lt;/span&gt;Offline Web applications&lt;/h3&gt;
 
-  &lt;h4 id=introduction-2&gt;&lt;span class=secno&gt;5.8.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-3&gt;&lt;span class=secno&gt;5.8.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
 
@@ -47197,7 +47874,7 @@
 
   &lt;h3 id=selection&gt;&lt;span class=secno&gt;6.6 &lt;/span&gt;The text selection APIs&lt;/h3&gt;
 
-  &lt;p&gt;Every &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; has &lt;dfn id=the-selection-0 title=&quot;the
+  &lt;p&gt;Every &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; has &lt;dfn id=the-selection title=&quot;the
   selection&quot;&gt;a selection&lt;/dfn&gt;. The selection can be empty, and the
   selection can have more than one range (a disjointed selection). The
   user agent should allow the user to change the selection. User
@@ -47232,7 +47909,7 @@
   &lt;/div&gt;
 
   &lt;p&gt;Mostly for historical reasons, in addition to the &lt;a href=#browsing-context&gt;browsing
-  context&lt;/a&gt;'s &lt;a href=#the-selection-0 title=&quot;the selection&quot;&gt;selection&lt;/a&gt;, each
+  context&lt;/a&gt;'s &lt;a href=#the-selection title=&quot;the selection&quot;&gt;selection&lt;/a&gt;, each
   &lt;code&gt;&lt;a href=#the-textarea-element&gt;textarea&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element has an
   independent selection. These are the &lt;dfn id=text-field-selection title=&quot;text field
   selection&quot;&gt;text field selections&lt;/dfn&gt;.&lt;/p&gt;
@@ -47279,7 +47956,7 @@
 
   &lt;p&gt;The &lt;dfn id=dom-getselection title=dom-getSelection&gt;&lt;code&gt;getSelection()&lt;/code&gt;&lt;/dfn&gt; method on
   the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; interface must return the
-  &lt;code&gt;&lt;a href=#selection-0&gt;Selection&lt;/a&gt;&lt;/code&gt; object representing &lt;a href=#the-selection-0&gt;the
+  &lt;code&gt;&lt;a href=#selection-0&gt;Selection&lt;/a&gt;&lt;/code&gt; object representing &lt;a href=#the-selection&gt;the
   selection&lt;/a&gt; of that &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object's
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;.
 
@@ -47578,7 +48255,7 @@
   &lt;/div&gt;
 
   &lt;p class=note&gt;The &lt;code&gt;&lt;a href=#selection-0&gt;Selection&lt;/a&gt;&lt;/code&gt; interface has no relation
-  to the &lt;code&gt;&lt;a href=#datagridselection&gt;DataGridSelection&lt;/a&gt;&lt;/code&gt; interface.&lt;/p&gt;
+  to the &lt;code&gt;DataGridSelection&lt;/code&gt; interface.&lt;/p&gt;
 
 
   &lt;h4 id=textFieldSelection&gt;&lt;span class=secno&gt;6.6.2 &lt;/span&gt;APIs for the text field selections&lt;/h4&gt;
@@ -47797,7 +48474,7 @@
 
   &lt;p&gt;When an editing host has focus, it must have a &lt;dfn id=caret-position&gt;caret
   position&lt;/dfn&gt; that specifies where the current editing position
-  is. It may also have a &lt;a href=#the-selection-0 title=&quot;the
+  is. It may also have a &lt;a href=#the-selection title=&quot;the
   selection&quot;&gt;selection&lt;/a&gt;.&lt;/p&gt; &lt;!-- XXX xref to later section --&gt;
 
   &lt;p class=note&gt;How the caret and selection are represented depends
@@ -47832,7 +48509,7 @@
 
    &lt;dt&gt;Change the selection&lt;/dt&gt;
 
-   &lt;dd&gt;&lt;p&gt;User agents must allow users to change &lt;a href=#the-selection-0&gt;the
+   &lt;dd&gt;&lt;p&gt;User agents must allow users to change &lt;a href=#the-selection&gt;the
    selection&lt;/a&gt; within an editing host, even into nested editable
    elements. User agents may prevent selections from being made in
    ways that cross from editable elements into non-editable elements
@@ -47918,7 +48595,7 @@
    element, backspacing when the caret is immediately after an
    element, forward-deleting at the end of an element,
    forward-deleting when the caret is immediately before an element,
-   and deleting a &lt;a href=#the-selection-0 title=&quot;the selection&quot;&gt;selection&lt;/a&gt; whose
+   and deleting a &lt;a href=#the-selection title=&quot;the selection&quot;&gt;selection&lt;/a&gt; whose
    start and end points do not share a common parent node.&lt;/p&gt;
 
    &lt;p&gt;In any case, the exact behavior is UA-dependent, but user
@@ -47989,7 +48666,7 @@
   &lt;/dl&gt;&lt;!-- XXX each action performed should be added to the undo history --&gt;&lt;p&gt;User agents may perform several commands per user request; for
   example if the user selects a block of text and hits
   &lt;kbd&gt;&lt;kbd&gt;Enter&lt;/kbd&gt;&lt;/kbd&gt;, the UA might interpret that as a
-  request to delete the content of &lt;a href=#the-selection-0&gt;the selection&lt;/a&gt; followed
+  request to delete the content of &lt;a href=#the-selection&gt;the selection&lt;/a&gt; followed
   by a request to break the paragraph at that position.&lt;/p&gt;
 
   &lt;p&gt;All of the actions defined above, whether triggered by the user
@@ -48276,7 +48953,7 @@
 
   &lt;p&gt;However it is implemented, drag-and-drop operations must have a
   starting point (e.g. where the mouse was clicked, or the start of
-  &lt;a href=#the-selection-0&gt;the selection&lt;/a&gt; or element that was selected for the
+  &lt;a href=#the-selection&gt;the selection&lt;/a&gt; or element that was selected for the
   drag), may have any number of intermediate steps (elements that the
   mouse moves over during a drag, or elements that the user picks as
   possible drop points as he cycles through possibilities), and must
@@ -48290,7 +48967,7 @@
   &lt;/div&gt;
 
 
-  &lt;h4 id=introduction-3&gt;&lt;span class=secno&gt;6.9.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-4&gt;&lt;span class=secno&gt;6.9.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
 
@@ -49221,7 +49898,7 @@
   &lt;p class=XXX&gt;There has got to be a better way of doing this, surely.&lt;/p&gt;
 
 
-  &lt;h4 id=introduction-4&gt;&lt;span class=secno&gt;6.10.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-5&gt;&lt;span class=secno&gt;6.10.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p class=XXX&gt;...&lt;/p&gt;
 
@@ -49665,7 +50342,7 @@
 
   &lt;p&gt;The &lt;dfn id=execCommand title=dom-document-execCommand&gt;&lt;code&gt;execCommand(&lt;var title=&quot;&quot;&gt;commandId&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;showUI&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method on the
   &lt;code&gt;&lt;a href=#htmldocument&gt;HTMLDocument&lt;/a&gt;&lt;/code&gt; interface allows scripts to perform
-  actions on the &lt;a href=#the-selection-0 title=&quot;the selection&quot;&gt;current selection&lt;/a&gt;
+  actions on the &lt;a href=#the-selection title=&quot;the selection&quot;&gt;current selection&lt;/a&gt;
   or at the current caret position. Generally, these commands would be
   used to implement editor UI, for example having a &quot;delete&quot; button on
   a toolbar.&lt;/p&gt;
@@ -50199,7 +50876,7 @@
   &lt;/div&gt;
 
 
-  &lt;h4 id=introduction-5&gt;&lt;span class=secno&gt;7.2.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-6&gt;&lt;span class=secno&gt;7.2.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
 
@@ -50500,7 +51177,7 @@
 
   &lt;h3 id=channel-messaging&gt;&lt;span class=secno&gt;7.3 &lt;/span&gt;&lt;dfn&gt;Channel messaging&lt;/dfn&gt;&lt;/h3&gt;
 
-  &lt;h4 id=introduction-6&gt;&lt;span class=secno&gt;7.3.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-7&gt;&lt;span class=secno&gt;7.3.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
 
@@ -60436,7 +61113,7 @@
   lead to this experience.&lt;/em&gt;&lt;/p&gt;
 
 
-  &lt;h3 id=introduction-7&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Introduction&lt;/h3&gt;
+  &lt;h3 id=introduction-8&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Introduction&lt;/h3&gt;
 
   &lt;p&gt;In general, user agents are expected to support CSS, and many of
   the suggestions in this section are expressed in CSS terms. User
@@ -60458,7 +61135,7 @@
 
   &lt;h3 id=the-css-user-agent-style-sheet-and-presentational-hints&gt;&lt;span class=secno&gt;10.2 &lt;/span&gt;The CSS user agent style sheet and presentational hints&lt;/h3&gt;
 
-  &lt;h4 id=introduction-8&gt;&lt;span class=secno&gt;10.2.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-9&gt;&lt;span class=secno&gt;10.2.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;The CSS rules given in these subsections are, unless otherwise
   specified, expected to be used as part of the user-agent level style
@@ -61626,7 +62303,7 @@
 
   &lt;h3 id=bindings&gt;&lt;span class=secno&gt;10.4 &lt;/span&gt;Bindings&lt;/h3&gt;
 
-  &lt;h4 id=introduction-9&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-10&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;A number of elements have their rendering defined in terms of the
   'binding' property. &lt;a href=#refsBECSS&gt;[BECSS]&lt;/a&gt;&lt;/p&gt;
@@ -63535,6 +64212,7 @@
  XXX * should check all cases of 'active document' and change the
        relevant ones to 'fully active document'.
  XXX * use &lt;code&gt;Document&lt;/code&gt; consistently instead of 'document'.
+ XXX * s/raise/throw/g
 --&gt;
 
  

Modified: source
===================================================================
--- source	2009-04-08 06:11:13 UTC (rev 2961)
+++ source	2009-04-18 01:16:51 UTC (rev 2962)
@@ -6256,15 +6256,6 @@
   to an underlying string that consists of an &lt;span&gt;unordered set of
   unique space-separated tokens&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Which string underlies a particular &lt;code&gt;DOMTokenList&lt;/code&gt;
-  object is defined when the object is created. It might be a content
-  attribute (e.g. the string that underlies the &lt;code
-  title=&quot;dom-classList&quot;&gt;classList&lt;/code&gt; object is the &lt;code
-  title=&quot;attr-class&quot;&gt;class&lt;/code&gt; attribute), or it might be an
-  anonymous string (e.g. when a &lt;code&gt;DOMTokenList&lt;/code&gt; object is
-  passed to an author-implemented callback in the
-  &lt;code&gt;datagrid&lt;/code&gt; APIs).&lt;/p&gt;
-
   &lt;pre class=&quot;idl&quot;&gt;[&lt;span title=&quot;dom-tokenlist-toString&quot;&gt;Stringifies&lt;/span&gt;] interface &lt;dfn&gt;DOMTokenList&lt;/dfn&gt; {
   readonly attribute unsigned long &lt;span title=&quot;dom-tokenlist-length&quot;&gt;length&lt;/span&gt;;
   [IndexGetter] DOMString &lt;span title=&quot;dom-tokenlist-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
@@ -6737,7 +6728,7 @@
    &lt;li value=&quot;20&quot;&gt;&lt;dfn&gt;&lt;code&gt;ABORT_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually in XHR for now --&gt;
    &lt;li value=&quot;21&quot;&gt;&lt;dfn&gt;&lt;code&gt;URL_MISMATCH_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually in workers for now --&gt;
    &lt;li value=&quot;22&quot;&gt;&lt;dfn&gt;&lt;code&gt;QUOTA_EXCEEDED_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined right here for now --&gt;
-   &lt;li value=&quot;23&quot;&gt;&lt;dfn&gt;&lt;code&gt;UNAVAILABLE_SCRIPT_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined right here for now --&gt;
+   &lt;li value=&quot;23&quot;&gt;&lt;dfn&gt;&lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined right here for now --&gt;
    &lt;li value=&quot;81&quot;&gt;&lt;dfn&gt;&lt;code&gt;PARSE_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined in dom3ls --&gt;
    &lt;li value=&quot;82&quot;&gt;&lt;dfn&gt;&lt;code&gt;SERIALISE_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined in dom3ls --&gt;
   &lt;/ol&gt;
@@ -16471,6 +16462,8 @@
    &lt;li&gt;minimum value &le; optimum point &le; maximum value&lt;/li&gt;
   &lt;/ul&gt;
 
+  &lt;!-- next two paragraphs are duplicated in the &lt;datagrid&gt; section --&gt;
+
   &lt;p&gt;&lt;strong&gt;UA requirements for regions of the gauge&lt;/strong&gt;: If the
   optimum point is equal to the low boundary or the high boundary, or
   anywhere in between them, then the region between the low and high
@@ -17834,7 +17827,7 @@
 
   &lt;p&gt;The &lt;code&gt;img&lt;/code&gt; must not be used as a layout tool. In
   particular, &lt;code&gt;img&lt;/code&gt; elements should not be used to display
-  fully transparent images, as they rarely convey meaning and rarely
+   transparent images, as they rarely convey meaning and rarely
   add anything useful to the document.&lt;/p&gt;
 
   &lt;div class=&quot;impl&quot;&gt;
@@ -35508,22 +35501,13 @@
   title=&quot;concept-input-list&quot;&gt;suggestions source element&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;If there is a &lt;span title=&quot;concept-input-list&quot;&gt;suggestions source
-  element&lt;/span&gt;, then each &lt;code&gt;option&lt;/code&gt; element that is a
-  descendant of the &lt;span title=&quot;concept-input-list&quot;&gt;suggestions
-  source element&lt;/span&gt;, that is not &lt;span
-  title=&quot;concept-option-disabled&quot;&gt;disabled&lt;/span&gt;, and whose &lt;span
-  title=&quot;concept-option-value&quot;&gt;value&lt;/span&gt; is a string that isn't the
-  empty string and that the user would be allowed to enter as the
-  &lt;code&gt;input&lt;/code&gt; element's &lt;span
-  title=&quot;concept-fe-value&quot;&gt;value&lt;/span&gt;, represents a suggestion. Each
-  suggestion has a &lt;span title=&quot;concept-option-value&quot;&gt;value&lt;/span&gt; and
-  a &lt;span title=&quot;concept-option-label&quot;&gt;label&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When the user agent is allowing the user to edit the
-  &lt;code&gt;input&lt;/code&gt; element's &lt;span
+  element&lt;/span&gt;, then, when the user agent is allowing the user to
+  edit the &lt;code&gt;input&lt;/code&gt; element's &lt;span
   title=&quot;concept-fe-value&quot;&gt;value&lt;/span&gt;, the user agent should offer
-  the suggestions to the user in a manner suitable for the type of
-  control used. The user agent may use the suggestion's &lt;span
+  the suggestions represented by the &lt;span
+  title=&quot;concept-input-list&quot;&gt;suggestions source element&lt;/span&gt; to the
+  user in a manner suitable for the type of control used. The user
+  agent may use the suggestion's &lt;span
   title=&quot;concept-option-label&quot;&gt;label&lt;/span&gt; to identify the suggestion
   if appropriate. If the user selects a suggestion, then the
   &lt;code&gt;input&lt;/code&gt; element's &lt;span
@@ -35531,9 +35515,12 @@
   suggestion's &lt;span title=&quot;concept-option-value&quot;&gt;value&lt;/span&gt;, as if
   the user had written that value himself.&lt;/p&gt;
 
-  &lt;p&gt;User agents should filter the suggestions to hide suggestions
-  that would cause the element to not &lt;span
-  title=&quot;concept-fv-valid&quot;&gt;satisfy its constraints&lt;/span&gt;.&lt;/p&gt;
+  &lt;p&gt;User agents must filter the suggestions to hide suggestiosn that
+  the user would not be allowed to enter as the &lt;code&gt;input&lt;/code&gt;
+  element's &lt;span title=&quot;concept-fe-value&quot;&gt;value&lt;/span&gt;, and should
+  filter the suggestions to hide suggestions that would cause the
+  element to not &lt;span title=&quot;concept-fv-valid&quot;&gt;satisfy its
+  constraints&lt;/span&gt;.&lt;/p&gt;
 
   &lt;hr&gt;
 
@@ -36974,8 +36961,19 @@
   &lt;p&gt;The &lt;code&gt;datalist&lt;/code&gt; element is hooked up to an
   &lt;code&gt;input&lt;/code&gt; element using the &lt;code
   title=&quot;attr-input-list&quot;&gt;list&lt;/code&gt; attribute on the
-  &lt;code&gt;input&lt;/code&gt; element.&lt;/p&gt;
+  &lt;code&gt;input&lt;/code&gt; element. The &lt;code&gt;datalist&lt;/code&gt; element can
+  also be used with a &lt;code&gt;datagrid&lt;/code&gt; element, as the source of
+  autocompletion hints for &lt;code
+  title=&quot;datagrid-type-editable&quot;&gt;editable&lt;/code&gt; cells.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;code&gt;option&lt;/code&gt; element that is a descendant of the
+  &lt;code&gt;datalist&lt;/code&gt; element, that is not &lt;span
+  title=&quot;concept-option-disabled&quot;&gt;disabled&lt;/span&gt;, and whose &lt;span
+  title=&quot;concept-option-value&quot;&gt;value&lt;/span&gt; is a string that isn't the
+  empty string, represents a suggestion. Each suggestion has a &lt;span
+  title=&quot;concept-option-value&quot;&gt;value&lt;/span&gt; and a &lt;span
+  title=&quot;concept-option-label&quot;&gt;label&lt;/span&gt;.
+
   &lt;dl class=&quot;domintro&quot;&gt;
 
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datalist&lt;/var&gt; . &lt;code title=&quot;dom-datalist-options&quot;&gt;options&lt;/code&gt;&lt;/dt&gt;
@@ -40147,11 +40145,8 @@
 
 
 
-&lt;div class=&quot;bad&quot;&gt;
   &lt;h4 id=&quot;datagrid&quot;&gt;The &lt;dfn&gt;&lt;code&gt;datagrid&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
-&lt;p class=&quot;XXX&quot;&gt;The API here needs rewriting. Don't implement this right now.&lt;/p&gt;
-
   &lt;dl class=&quot;element&quot;&gt;
    &lt;dt&gt;Categories&lt;/dt&gt;
    &lt;dd&gt;&lt;span&gt;Flow content&lt;/span&gt;.&lt;/dd&gt;
@@ -40167,43 +40162,84 @@
    &lt;dd&gt;Or: A single &lt;code&gt;datalist&lt;/code&gt; element.&lt;/dd&gt;
    &lt;dt&gt;Content attributes:&lt;/dt&gt;
    &lt;dd&gt;&lt;span&gt;Global attributes&lt;/span&gt;&lt;/dd&gt;
+&lt;!--v2DGS:
    &lt;dd&gt;&lt;code title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt;&lt;/dd&gt;
+--&gt;
    &lt;dd&gt;&lt;code title=&quot;attr-datagrid-disabled&quot;&gt;disabled&lt;/code&gt;&lt;/dd&gt;
    &lt;dt&gt;DOM interface:&lt;/dt&gt;
    &lt;dd&gt;
 &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLDataGridElement&lt;/dfn&gt; : &lt;span&gt;HTMLElement&lt;/span&gt; {
-           attribute &lt;span&gt;DataGridDataProvider&lt;/span&gt; &lt;span title=&quot;dom-datagrid-data&quot;&gt;data&lt;/span&gt;;
-  readonly attribute &lt;span&gt;DataGridSelection&lt;/span&gt; &lt;span title=&quot;dom-datagrid-selection&quot;&gt;selection&lt;/span&gt;;
            attribute boolean &lt;span title=&quot;dom-datagrid-multiple&quot;&gt;multiple&lt;/span&gt;;
            attribute boolean &lt;span title=&quot;dom-datagrid-disabled&quot;&gt;disabled&lt;/span&gt;;
-  void &lt;span title=&quot;dom-datagrid-updateEverything&quot;&gt;updateEverything&lt;/span&gt;();
-  void &lt;span title=&quot;dom-datagrid-updateRowsChanged&quot;&gt;updateRowsChanged&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long count);
-  void &lt;span title=&quot;dom-datagrid-updateRowsInserted&quot;&gt;updateRowsInserted&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long count);
-  void &lt;span title=&quot;dom-datagrid-updateRowsRemoved&quot;&gt;updateRowsRemoved&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long count);
-  void &lt;span title=&quot;dom-datagrid-updateRowChanged&quot;&gt;updateRowChanged&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row);
-  void &lt;span title=&quot;dom-datagrid-updateColumnChanged&quot;&gt;updateColumnChanged&lt;/span&gt;(in unsigned long column);
-  void &lt;span title=&quot;dom-datagrid-updateCellChanged&quot;&gt;updateCellChanged&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column);
+           attribute &lt;span&gt;DataGridListener&lt;/span&gt; &lt;span title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/span&gt;;
+&lt;!-- v2DGS:
+  readonly attribute &lt;span&gt;DataGridSelection&lt;/span&gt; &lt;span title=&quot;dom-datagrid-selection&quot;&gt;selection&lt;/span&gt;;
+--&gt;
+  // columns
+  void &lt;span title=&quot;dom-datagrid-addColumn&quot;&gt;addColumn&lt;/span&gt;(in &lt;span&gt;Column&lt;/span&gt; id, in DOMString label, in DOMString type, [Optional] in HTMLImageElement icon, [Optional] in boolean sortable, [Optional] in boolean visible);
+           attribute DOMString &lt;span title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/span&gt;;
+           attribute boolean &lt;span title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/span&gt;;
+  void &lt;span title=&quot;dom-datagrid-clearColumns&quot;&gt;clearColumns&lt;/span&gt;();
+
+  // rows
+  void &lt;span title=&quot;dom-datagrid-renotify&quot;&gt;renotify&lt;/span&gt;();
+  void &lt;span title=&quot;dom-datagrid-setRowCount&quot;&gt;setRowCount&lt;/span&gt;(in long childCount, in long rowCount);
+  void &lt;span title=&quot;dom-datagrid-setRows&quot;&gt;setRows&lt;/span&gt;(in &lt;span&gt;RowList&lt;/span&gt; rows);
+  void &lt;span title=&quot;dom-datagrid-insertRows&quot;&gt;insertRows&lt;/span&gt;(in &lt;span&gt;RowList&lt;/span&gt; rows);
+  void &lt;span title=&quot;dom-datagrid-deleteRows&quot;&gt;deleteRows&lt;/span&gt;(in &lt;span&gt;RowIDList&lt;/span&gt; rows);
+  void &lt;span title=&quot;dom-datagrid-repaint&quot;&gt;repaint&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in DOMString column);
+  void &lt;span title=&quot;dom-datagrid-clearRows&quot;&gt;clearRows&lt;/span&gt;();
+&lt;!--
+ v2: opening and closing a row
+     moving a row's actual ID
+      - imagine new mail moving a thread up; you just want to add the new mail to the thread and move the thread's first mail to the top
+      - though actually that should probably just be done using display sorting
+--&gt;
+};
+
+typedef DOMString &lt;dfn&gt;Column&lt;/dfn&gt;;
+typedef sequence&lt;&lt;span&gt;Column&lt;/span&gt;&gt; &lt;dfn&gt;ColumnList&lt;/dfn&gt;;
+typedef sequence&lt;any&gt; &lt;dfn&gt;Cell&lt;/dfn&gt;; // &lt;span&gt;Column&lt;/span&gt;, [Variadic] any (exact types expected depend on the column type)
+typedef sequence&lt;&lt;span&gt;Cell&lt;/span&gt;&gt; &lt;dfn&gt;CellList&lt;/dfn&gt;;
+typedef sequence&lt;any&gt; &lt;dfn&gt;Row&lt;/dfn&gt;; // &lt;span&gt;RowID&lt;/span&gt;, long, long, &lt;span&gt;CellList&lt;/span&gt;, [Optional] boolean, [Optional] long
+typedef sequence&lt;&lt;span&gt;Row&lt;/span&gt;&gt; &lt;dfn&gt;RowList&lt;/dfn&gt;;
+typedef sequence&lt;unsigned long&gt; &lt;dfn&gt;RowID&lt;/dfn&gt;;
+typedef sequence&lt;&lt;span&gt;RowID&lt;/span&gt;&gt; &lt;dfn&gt;RowIDList&lt;/dfn&gt;;
+
+[Callback=FunctionOnly, NoInterfaceObject]
+interface &lt;dfn&gt;RenderingContext2DCallback&lt;/dfn&gt; {
+  DOMString &lt;span title=&quot;dom-Rendering2DContextCallback-handleEvent&quot;&gt;handleEvent&lt;/span&gt;(in &lt;span&gt;CanvasRenderingContext2D&lt;/span&gt; context, in unsigned long width, in unsigned long height);
 };&lt;/pre&gt;
    &lt;/dd&gt;
   &lt;/dl&gt;
 
-  &lt;p class=&quot;XXX&quot;&gt;One possible thing to be added is a way to
-  detect when a row/selection has been deleted, activated, etc, by the
-  user (delete key, enter key, etc).&lt;/p&gt; &lt;!-- XXXPA --&gt;
+  &lt;p&gt;The &lt;code&gt;datagrid&lt;/code&gt; element &lt;span&gt;represents&lt;/span&gt; an
+  interactive representation of tree, list, or tabular data.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;datagrid&lt;/code&gt; element &lt;span&gt;represents&lt;/span&gt; an interactive
-  representation of tree, list, or tabular data.&lt;/p&gt;
+  &lt;p&gt;The data being presented is provided by script using the methods
+  described in the following sections.&lt;/p&gt;
 
-  &lt;p&gt;The data being presented can come either from the content, as
-  elements given as children of the &lt;code&gt;datagrid&lt;/code&gt; element, or
-  from a scripted data provider given by the &lt;code
-  title=&quot;dom-datagrid-data&quot;&gt;data&lt;/code&gt; DOM attribute.&lt;/p&gt;
+&lt;!--v2DGS:
+  &lt;p&gt;The &lt;dfn
+  title=&quot;attr-datagrid-multiple&quot;&gt;&lt;code&gt;multiple&lt;/code&gt;&lt;/dfn&gt; attribute
+  is a &lt;span&gt;boolean attribute&lt;/span&gt;. When set, it indicates that the
+  user can select more than one row at a time.&lt;/p&gt;
+--&gt;
 
-  &lt;p&gt;The &lt;code title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt; and
-  &lt;code title=&quot;attr-datagrid-disabled&quot;&gt;disabled&lt;/code&gt; attributes are
-  &lt;span title=&quot;boolean attribute&quot;&gt;boolean attributes&lt;/span&gt;. Their
-  effects are described in the processing model sections below.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn
+  title=&quot;attr-datagrid-disabled&quot;&gt;&lt;code&gt;disabled&lt;/code&gt;&lt;/dfn&gt; attribute
+  is a &lt;span&gt;boolean attribute&lt;/span&gt; used to disable the
+  control. &lt;span class=&quot;impl&quot;&gt;When the attribute is set, the user
+  agent must disable the &lt;code&gt;datagrid&lt;/code&gt;, preventing the user
+  from interacting with it. The &lt;code&gt;datagrid&lt;/code&gt; element should
+  still continue to update itself when the underlying data changes,
+  though, as described in the next few sections. However, conformance
+  requirements stating that &lt;code&gt;datagrid&lt;/code&gt; elements must react
+  to users in particular ways do not apply when one is
+  disabled.&lt;/span&gt;&lt;/p&gt;
 
+  &lt;div class=&quot;impl&quot;&gt;
+
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-datagrid-multiple&quot;&gt;&lt;code&gt;multiple&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn
   title=&quot;dom-datagrid-disabled&quot;&gt;&lt;code&gt;disabled&lt;/code&gt;&lt;/dfn&gt; DOM
@@ -40212,16 +40248,24 @@
   title=&quot;attr-datagrid-disabled&quot;&gt;disabled&lt;/code&gt; content attributes
   respectively.&lt;/p&gt;
 
+  &lt;/div&gt;
 
-  &lt;h5&gt;The &lt;code&gt;datagrid&lt;/code&gt; data model&lt;/h5&gt;
+  &lt;!-- v2DGPA: One possible thing to be added is a way to detect when a
+  row/selection has been deleted, activated, etc, by the user (delete
+  key, enter key, etc). (v2DGPA = &lt;datagrid&gt; Perform Action) --&gt;
 
+
+  &lt;h5&gt;Introduction&lt;/h5&gt;
+
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
 
   &lt;p&gt;In the &lt;code&gt;datagrid&lt;/code&gt; data model, data is structured as a
   set of rows representing a tree, each row being split into a number
   of columns. The columns are always present in the data model,
-  although individual columns may be hidden in the presentation.&lt;/p&gt;
+  although individual columns might be hidden in the presentation.&lt;/p&gt;
 
+  &lt;hr&gt;
+
   &lt;p&gt;Each row can have child rows. Child rows may be hidden or
   shown, by closing or opening (respectively) the parent row.&lt;/p&gt;
 
@@ -40232,1757 +40276,2384 @@
   is row &quot;0,1&quot;; the fourth child of the seventh child of the third
   child of the tenth row is &quot;9,2,6,3&quot;, etc.&lt;/p&gt;
 
-  &lt;p&gt;The columns can have captions. Those captions are not considered
-  a row in their own right, they are obtained separately.&lt;/p&gt;
+  &lt;p&gt;The chains of numbers that give a row's path, or identifier, are
+  represented by arrays of positions, represented in IDL by the
+  &lt;span&gt;RowID&lt;/span&gt; interface.&lt;/p&gt;
 
+  &lt;p&gt;The root of the tree is represented by an empty array.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;Each column has a string that is used to identify it in the API,
+  a label that is shown to users interacting with the column, a type,
+  and optionally an icon.&lt;/p&gt;
+
+  &lt;p&gt;The possible types are as follows:&lt;/p&gt;
+
+  &lt;table&gt;
+   &lt;thead&gt;
+    &lt;tr&gt;
+     &lt;td&gt;Keyword
+     &lt;td&gt;Description
+   &lt;tbody&gt;
+    &lt;tr&gt;
+     &lt;td&gt;&lt;code title=&quot;datagrid-type-text&quot;&gt;text&lt;/code&gt;
+     &lt;td&gt;Simple text.
+    &lt;tr&gt;
+     &lt;td&gt;&lt;code title=&quot;datagrid-type-editable&quot;&gt;editable&lt;/code&gt;
+     &lt;td&gt;Editable text.
+    &lt;tr&gt;
+     &lt;td&gt;&lt;code title=&quot;datagrid-type-checkable&quot;&gt;checkable&lt;/code&gt;
+     &lt;td&gt;Text with a check box.
+    &lt;tr&gt;
+     &lt;td&gt;&lt;code title=&quot;datagrid-type-list&quot;&gt;list&lt;/code&gt;
+     &lt;td&gt;A list of values that the user can switch between.
+    &lt;tr&gt;
+     &lt;td&gt;&lt;code title=&quot;datagrid-type-progress&quot;&gt;progress&lt;/code&gt;
+     &lt;td&gt;A progress bar.
+    &lt;tr&gt;
+     &lt;td&gt;&lt;code title=&quot;datagrid-type-meter&quot;&gt;meter&lt;/code&gt;
+     &lt;td&gt;A gauge.
+    &lt;tr&gt;
+     &lt;td&gt;&lt;code title=&quot;datagrid-type-custom&quot;&gt;custom&lt;/code&gt;
+     &lt;td&gt;A canvas onto which arbitrary content can be drawn.
+  &lt;/table&gt;
+
+  &lt;p&gt;Each column can be flagged as sortable, in which case the user
+  will be able to sort the view using that column.&lt;/p&gt;
+
+  &lt;p&gt;Columns are not necessarily visible. A column can be created
+  invisible by default. The user can select which columns are to be
+  shown.&lt;/p&gt;
+
+  &lt;p&gt;When no columns have been added to the &lt;code&gt;datagrid&lt;/code&gt;, a
+  column with no name, whose identifier is the empty string, whose
+  type is &lt;code title=&quot;datagrid-type-text&quot;&gt;text&lt;/code&gt;, and which is
+  not sortable, is implied. This column is removed if any explicit
+  columns are declared.&lt;/p&gt;
+
+  &lt;p&gt;Each cell uses the type given for its column, so all cells in a
+  column present the same type of information.&lt;/p&gt;
+
+&lt;!--v2DGS:
   &lt;p&gt;Selection of data in a &lt;code&gt;datagrid&lt;/code&gt; operates at the row
   level. If the &lt;code title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt;
   attribute is present, multiple rows can be selected at once,
   otherwise the user can only select one row at a time.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;code&gt;datagrid&lt;/code&gt; element can be disabled entirely by
-  setting the &lt;code title=&quot;attr-datagrid-disabled&quot;&gt;disabled&lt;/code&gt;
-  attribute.&lt;/p&gt;
-&lt;!--XXXDND
-  &lt;p class=&quot;XXX&quot;&gt;selection draggable [normative definitions are
-  in the interactive part below]&lt;/p&gt;
 --&gt;
 
-  &lt;p&gt;Columns, rows, and cells can each have specific flags, known as
-  classes, applied to them by the data provider. These classes &lt;a
-  href=&quot;#datagridClassSummary&quot;&gt;affect the functionality&lt;/a&gt; of the
-  &lt;code&gt;datagrid&lt;/code&gt; element, and are also &lt;a
-  href=&quot;#datagridPseudos&quot;&gt;passed to the style system&lt;/a&gt;. They are
-  similar in concept to the &lt;code title=&quot;attr-class&quot;&gt;class&lt;/code&gt;
-  attribute, except that they are not specified on elements but are
-  given by scripted data providers.&lt;/p&gt; &lt;!-- XXX check xrefs --&gt;
+  &lt;!-- v2DGDND: selection should draggable to and from datagrids --&gt;
 
 
-  &lt;h5&gt;How rows are identified&lt;/h5&gt;
+  &lt;h6&gt;Example: a &lt;code&gt;datagrid&lt;/code&gt; backed by a static &lt;code&gt;table&lt;/code&gt; element&lt;/h6&gt;
 
-  &lt;p&gt;The chains of numbers that give a row's path, or identifier, are
-  represented by objects that implement the
-  &lt;span&gt;RowSpecification&lt;/span&gt; interface.&lt;/p&gt;
+  &lt;p class=&quot;XXX&quot;&gt;...&lt;/p&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;[NoInterfaceObject] interface &lt;dfn&gt;RowSpecification&lt;/dfn&gt; {
-  // binding-specific interface
-};&lt;/pre&gt;
 
-  &lt;p&gt;In JavaScript, two classes of objects are said to implement this
-  interface: Numbers representing non-negative integers, and
-  homogeneous arrays of Numbers representing non-negative
-  integers. Thus, &lt;code&gt;[1,0,9]&lt;/code&gt; is a
-  &lt;span&gt;RowSpecification&lt;/span&gt;, as is &lt;code&gt;1&lt;/code&gt; on its
-  own. However, &lt;code&gt;[1,0.2,9]&lt;/code&gt; is not a
-  &lt;span&gt;RowSpecification&lt;/span&gt; object, since its second value is not
-  an integer.&lt;/p&gt;
+  &lt;h6&gt;Example: a &lt;code&gt;datagrid&lt;/code&gt; backed by nested &lt;code&gt;ol&lt;/code&gt; elements&lt;/h6&gt;
 
-  &lt;p&gt;User agents must always represent &lt;code&gt;RowSpecification&lt;/code&gt;s
-  in JavaScript by using arrays, even if the path only has one
-  number.&lt;/p&gt;
+  &lt;p class=&quot;XXX&quot;&gt;...&lt;/p&gt;
 
-  &lt;p&gt;The root of the tree is represented by the empty path; in
-  JavaScript, this is the empty array (&lt;code&gt;[]&lt;/code&gt;). Only the
-  &lt;code title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount()&lt;/code&gt; and
-  &lt;code
-  title=&quot;dom-provider-getChildAtPosition&quot;&gt;GetChildAtPosition()&lt;/code&gt;
-  methods ever get called with the empty path.&lt;/p&gt;
 
+  &lt;h6&gt;Example: a &lt;code&gt;datagrid&lt;/code&gt; backed by a server&lt;/h6&gt;
 
-  &lt;h5&gt;The data provider interface&lt;/h5&gt;
+  &lt;p class=&quot;XXX&quot;&gt;...&lt;/p&gt;
 
-  &lt;p&gt;&lt;em&gt;The conformance criteria in this section apply to any
-  implementation of the &lt;code&gt;DataGridDataProvider&lt;/code&gt;, including
-  (and most commonly) the content author's implementation(s).&lt;/em&gt;&lt;/p&gt;
 
-&lt;p class=&quot;XXX&quot;&gt;The API here needs rewriting. Don't implement this right now.&lt;/p&gt;
+  &lt;h5&gt;Populating the &lt;code&gt;datagrid&lt;/code&gt;&lt;/h5&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;// To be implemented by Web authors as a JS object
-[NoInterfaceObject] interface &lt;dfn&gt;DataGridDataProvider&lt;/dfn&gt; {
-  void &lt;span title=&quot;dom-provider-initialize&quot;&gt;initialize&lt;/span&gt;(in &lt;span&gt;HTMLDataGridElement&lt;/span&gt; datagrid);
-  unsigned long &lt;span title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row);
-  unsigned long &lt;span title=&quot;dom-provider-getChildAtPosition&quot;&gt;getChildAtPosition&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; parentRow, in unsigned long position);
-  unsigned long &lt;span title=&quot;dom-provider-getColumnCount&quot;&gt;getColumnCount&lt;/span&gt;();
-  DOMString &lt;span title=&quot;dom-provider-getCaptionText&quot;&gt;getCaptionText&lt;/span&gt;(in unsigned long column);
-  void &lt;span title=&quot;dom-provider-getCaptionClasses&quot;&gt;getCaptionClasses&lt;/span&gt;(in unsigned long column, in DOMTokenList classes);
-  DOMString &lt;span title=&quot;dom-provider-getRowImage&quot;&gt;getRowImage&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row);
-  &lt;span&gt;HTMLMenuElement&lt;/span&gt; &lt;span title=&quot;dom-provider-getRowMenu&quot;&gt;getRowMenu&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row);
-  void &lt;span title=&quot;dom-provider-getRowClasses&quot;&gt;getRowClasses&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in DOMTokenList classes);
-  DOMString &lt;span title=&quot;dom-provider-getCellData&quot;&gt;getCellData&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column);
-  void &lt;span title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column, in DOMTokenList classes);
-&lt;!--XXXDND
-  boolean &lt;span title=&quot;dom-provider-canDrop&quot;&gt;canDrop&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in &lt;span&gt;RowSpecification&lt;/span&gt; position, data);
-  boolean &lt;span title=&quot;dom-provider-dropped&quot;&gt;dropped&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in &lt;span&gt;RowSpecification&lt;/span&gt; position, data);
---&gt;  void &lt;span title=&quot;dom-provider-toggleColumnSortState&quot;&gt;toggleColumnSortState&lt;/span&gt;(in unsigned long column);
-  void &lt;span title=&quot;dom-provider-setCellCheckedState&quot;&gt;setCellCheckedState&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column, in long state);
-  void &lt;span title=&quot;dom-provider-cycleCell&quot;&gt;cycleCell&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column);
-  void &lt;span title=&quot;dom-provider-editCell&quot;&gt;editCell&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column, in DOMString data);
-&lt;!--XXXPA
-  void &lt;span title=&quot;dom-provider-performAction&quot;&gt;performAction&lt;/span&gt;(in DOMString action); // required if .performAction() is ever invoked on the datagrid
-  void &lt;span title=&quot;dom-provider-performActionOnRow&quot;&gt;performActionOnRow&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in DOMString action); // required if getRowClasses ever includes 'deletable' or if &lt;span title=&quot;dom-provider-.performActionOnRow&quot;&gt;.performActionOnRow&lt;/span&gt;() is ever invoked on the datagrid
-  void &lt;span title=&quot;dom-provider-performActionOnCell&quot;&gt;performActionOnCell&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column, in DOMString action); // required if .performActionOnCell() is ever invoked on the datagrid
---&gt;};&lt;/pre&gt;
-&lt;!-- based on <A HREF="http://lxr.mozilla.org/seamonkey/source/layout/xul/base/src/tree/public/nsITreeView.idl">http://lxr.mozilla.org/seamonkey/source/layout/xul/base/src/tree/public/nsITreeView.idl</A> --&gt;
+  &lt;dl class=&quot;domintro&quot;&gt;
 
-  &lt;p&gt;The &lt;code&gt;DataGridDataProvider&lt;/code&gt; interface represents the
-  interface that objects must implement to be used as custom data
-  views for &lt;code&gt;datagrid&lt;/code&gt; elements.&lt;/p&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
+   &lt;dd&gt;
 
-  &lt;p&gt;Not all the methods are required. The minimum number of methods
-  that must be implemented in a useful view is two: the &lt;code
-  title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount()&lt;/code&gt; and &lt;code
-  title=&quot;dom-provider-getCellData&quot;&gt;getCellData()&lt;/code&gt; methods.&lt;/p&gt;
+    &lt;p&gt;Return the current object that is configured as the
+    &lt;code&gt;datagrid&lt;/code&gt; listener, if any. Returns null if there is
+    none.&lt;/p&gt;
 
-  &lt;p&gt;Once the object is written, it must be hooked up to the
-  &lt;code&gt;datagrid&lt;/code&gt; using the &lt;dfn
-  title=&quot;dom-datagrid-data&quot;&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt; DOM attribute.&lt;/p&gt;
+    &lt;p&gt;The listener is an object provided by the script author that
+    receives notifications when the &lt;code&gt;datagrid&lt;/code&gt; needs row
+    data to render itself, when the user opens and closes rows with
+    children, when the user edits a cell, and when the user invokes a
+    row's context menu. (The &lt;code&gt;DataGridListener&lt;/code&gt; interface
+    used for this purpose is described in the next section.)&lt;/p&gt;
 
-  &lt;p&gt;The following methods may be usefully implemented:&lt;/p&gt;
+    &lt;p&gt;Can be set, to change the current listener.&lt;/p&gt;
 
-  &lt;dl&gt;
+   &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-initialize&quot;&gt;&lt;code&gt;initialize(&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; element (the one given by
-   the &lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; argument) after it has first
-   populated itself. This would typically be used to set the initial
-   selection of the &lt;code&gt;datagrid&lt;/code&gt; element when it is first
-   loaded. The data provider could also use this method call to
-   register a &lt;code title=&quot;event-select&quot;&gt;select&lt;/code&gt; event handler
-   on the &lt;code&gt;datagrid&lt;/code&gt; in order to monitor selection
-   changes.&lt;/dd&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-renotify&quot;&gt;renotify&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getRowCount&quot;&gt;&lt;code&gt;getRowCount(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Causes the &lt;code&gt;datagrid&lt;/code&gt; to resend notifications to the
+    listener (if any) for any rows or cells that the
+    &lt;code&gt;datagrid&lt;/code&gt; does not yet have information for.&lt;/p&gt;
 
-   &lt;dd&gt;Must return the number of rows that are children of the
-   specified &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, including rows that are
-   off-screen. If &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is empty, then the number of
-   rows at the top level must be returned. If the value that this
-   method would return for a given &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; changes,
-   the relevant update methods on the &lt;code&gt;datagrid&lt;/code&gt; must be
-   called first. Otherwise, this method must always return the same
-   number. For a list (as opposed to a tree), this method must return
-   0 whenever it is called with a &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; identifier
-   that is not empty.&lt;/dd&gt;
+    &lt;!-- useful, e.g., if there is a server error and the script loses
+    track of what rows it's supposed to be reporting. --&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getChildAtPosition&quot;&gt;&lt;code&gt;getChildAtPosition(&lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;/dd&gt;
 
-   &lt;dd&gt;Must return the index of the row that is a child of &lt;var
-   title=&quot;&quot;&gt;parentRow&lt;/var&gt; and that is to be positioned as the &lt;var
-   title=&quot;&quot;&gt;position&lt;/var&gt;th row under &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;
-   when rendering the children of &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;. If
-   &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt; is empty, then &lt;var
-   title=&quot;&quot;&gt;position&lt;/var&gt; refers to the &lt;var
-   title=&quot;&quot;&gt;position&lt;/var&gt;th row at the top level of the data
-   grid. May be omitted if the rows are always to be sorted in the
-   natural order. (The natural order is the one where the method
-   always returns &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;.) For a given &lt;var
-   title=&quot;&quot;&gt;parentRow&lt;/var&gt;, this method must never return the same
-   value for different values of &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;. The
-   returned value &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; must be in the range
-   0&nbsp;&le;&nbsp;&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;var
-   title=&quot;&quot;&gt;n&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is the value returned
-   by &lt;code title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount(&lt;var
-   title=&quot;&quot;&gt;parentRow&lt;/var&gt;)&lt;/code&gt;.&lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getColumnCount&quot;&gt;&lt;code&gt;getColumnCount()&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-addColumn&quot;&gt;addColumn&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;id&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;label&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;icon&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;sortable&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;visible&lt;/var&gt; ] ] ] )&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dd&gt;Must return the number of columns currently in the data model
-   (including columns that might be hidden). May be omitted if there
-   is only one column. If the value that this method would return
-   changes, the &lt;code&gt;datagrid&lt;/code&gt;'s &lt;code
-   title=&quot;dom-datagrid-updateEverything&quot;&gt;updateEverything()&lt;/code&gt;
-   method must be called.&lt;/dd&gt;
+    &lt;p&gt;Adds a column to the &lt;code&gt;datagrid&lt;/code&gt;.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getCaptionText&quot;&gt;&lt;code&gt;getCaptionText(&lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;If a column with the given identifier has already been added,
+    it just replaces the information for that column.&lt;/p&gt;
 
-   &lt;dd&gt;Must return the caption, or label, for column &lt;var
-   title=&quot;&quot;&gt;column&lt;/var&gt;. May be omitted if the columns have no
-   captions. If the value that this method would return changes, the
-   &lt;code&gt;datagrid&lt;/code&gt;'s &lt;code
-   title=&quot;dom-datagrid-updateColumnChanged&quot;&gt;updateColumnChanged()&lt;/code&gt;
-   method must be called with the appropriate column index.&lt;/dd&gt;
+    &lt;p&gt;The possible types are enumerated in the previous section.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getCaptionClasses&quot;&gt;&lt;code&gt;getCaptionClasses(&lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;/dd&gt;
 
-   &lt;dd&gt;Must add the classes that apply to column &lt;var
-   title=&quot;&quot;&gt;column&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt; object.
-   May be omitted if the columns have no special classes. If the
-   classes that this method would add changes, the
-   &lt;code&gt;datagrid&lt;/code&gt;'s &lt;code
-   title=&quot;dom-datagrid-updateColumnChanged&quot;&gt;updateColumnChanged()&lt;/code&gt;
-   method must be called with the appropriate column index. Some
-   classes have &lt;a href=&quot;#datagridClassSummary&quot;&gt;predefined
-   meanings&lt;/a&gt;.&lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getRowImage&quot;&gt;&lt;code&gt;getRowImage(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dd&gt;Must return a &lt;span&gt;URL&lt;/span&gt; giving the address of an image
-   that represents row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, or the empty string if
-   there is no applicable image. May be omitted if no rows have
-   associated images. If the value that this method would return
-   changes, the &lt;code&gt;datagrid&lt;/code&gt;'s update methods must be called
-   to update the row in question.&lt;/dd&gt;
+    &lt;p&gt;Returns the identifier of the column by which the data is to be
+    sorted.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getRowMenu&quot;&gt;&lt;code&gt;getRowMenu(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Can be set, to indicate that the sort order has changed. This
+    will cause the &lt;code&gt;datagrid&lt;/code&gt; to clear its position
+    information for rows, so &lt;code
+    title=&quot;dom-datagrid-setRows&quot;&gt;setRows()&lt;/code&gt; will have to be
+    called again with the new sort order.&lt;/p&gt;
 
-   &lt;dd&gt;Must return an &lt;code&gt;HTMLMenuElement&lt;/code&gt; object that is to
-   be used as a context menu for row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, or null
-   if there is no particular context menu. May be omitted if none of
-   the rows have a special context menu. As this method is called
-   immediately before showing the menu in question, no precautions
-   need to be taken if the return value of this method changes.&lt;/dd&gt;
+    &lt;p&gt;The columns are not actually sorted by the
+    &lt;code&gt;datagrid&lt;/code&gt;; the data has to be sorted by the script
+    that adds the rows to the &lt;code&gt;datagrid&lt;/code&gt;.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getRowClasses&quot;&gt;&lt;code&gt;getRowClasses(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;/dd&gt;
 
-   &lt;dd&gt;Must add the classes that apply to row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;
-   to the &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt; object. May be omitted if the
-   rows have no special classes. If the classes that this method would
-   add changes, the &lt;code&gt;datagrid&lt;/code&gt;'s update methods must be
-   called to update the row in question. Some classes have &lt;a
-   href=&quot;#datagridClassSummary&quot;&gt;predefined meanings&lt;/a&gt;.&lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getCellData&quot;&gt;&lt;code&gt;getCellData(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dd&gt;Must return the value of the cell on row &lt;var
-   title=&quot;&quot;&gt;row&lt;/var&gt; in column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. For text
-   cells, this must be the text to show for that cell. For &lt;span
-   title=&quot;datagrid-cell-class-progress&quot;&gt;progress bar cells&lt;/span&gt;,
-   this must be either a floating point number in the range 0.0 to 1.0
-   (converted to a string representation&lt;!-- XXX this isn't
-   technically enough to define what the author must be doing here,
-   but let's let that slide until someone notices --&gt;), indicating the
-   fraction of the progress bar to show as full (1.0 meaning
-   complete), or the empty string, indicating an indeterminate
-   progress bar. If the value that this method would return changes,
-   the &lt;code&gt;datagrid&lt;/code&gt;'s update methods must be called to update
-   the rows that changed. If only one cell changed, the &lt;code
-   title=&quot;dom-datagrid-updateCellChanged&quot;&gt;updateCellChanged()&lt;/code&gt;
-   method may be used.&lt;/dd&gt;
+    &lt;p&gt;Returns true if the data is to be sorted with small values
+    first; otherwise, returns false, indicating that bigger values are
+    to be put first.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-getCellClasses&quot;&gt;&lt;code&gt;getCellClasses(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Can be set, to indicate that the order is about to change.&lt;/p&gt;
 
-   &lt;dd&gt;Must add the classes that apply to the cell on row &lt;var
-   title=&quot;&quot;&gt;row&lt;/var&gt; in column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt; to the &lt;var
-   title=&quot;&quot;&gt;classes&lt;/var&gt; object. May be omitted if the cells have no
-   special classes. If the classes that this method would add changes,
-   the &lt;code&gt;datagrid&lt;/code&gt;'s update methods must be called to update
-   the rows or cells in question. Some classes have &lt;a
-   href=&quot;#datagridClassSummary&quot;&gt;predefined meanings&lt;/a&gt;.&lt;/dd&gt;
+   &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-toggleColumnSortState&quot;&gt;&lt;code&gt;toggleColumnSortState(&lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; when the user tries to sort
-   the data using a particular column &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. The
-   data provider must update its state so that the &lt;code
-   title=&quot;dom-provider-getChildAtPosition&quot;&gt;GetChildAtPosition()&lt;/code&gt;
-   method returns the new order, and the classes of the columns
-   returned by &lt;code
-   title=&quot;dom-provider-getCaptionClasses&quot;&gt;getCaptionClasses()&lt;/code&gt;
-   represent the new sort status. There is no need to tell the
-   &lt;code&gt;datagrid&lt;/code&gt; that it the data has changed, as the
-   &lt;code&gt;datagrid&lt;/code&gt; automatically assumes that the entire data
-   model will need updating.&lt;/dd&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-clearColumns&quot;&gt;clearColumns&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-setCellCheckedState&quot;&gt;&lt;code&gt;setCellCheckedState(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Removes all the columns in the &lt;code&gt;datagrid&lt;/code&gt;,
+    reinstating the implied column.&lt;/p&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; when the user changes the
-   state of a checkbox cell on row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, column
-   &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. The checkbox should be toggled to the
-   state given by &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;, which is a positive
-   integer (1) if the checkbox is to be checked, zero (0) if it is to
-   be unchecked, and a negative number (&amp;#x2212;1) if it is to be set to the
-   indeterminate state. There is no need to tell the
-   &lt;code&gt;datagrid&lt;/code&gt; that the cell has changed, as the
-   &lt;code&gt;datagrid&lt;/code&gt; automatically assumes that the given cell
-   will need updating.&lt;/dd&gt;
+   &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-cycleCell&quot;&gt;&lt;code&gt;cycleCell(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; when the user changes the
-   state of a cyclable cell on row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, column
-   &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;. The data provider should change the
-   state of the cell to the new state, as appropriate. There is no
-   need to tell the &lt;code&gt;datagrid&lt;/code&gt; that the cell has
-   changed, as the &lt;code&gt;datagrid&lt;/code&gt; automatically assumes that
-   the given cell will need updating.&lt;/dd&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-setRowCount&quot;&gt;setRowCount&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;childCount&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
 
-   &lt;dt&gt;&lt;dfn title=&quot;dom-provider-editCell&quot;&gt;&lt;code&gt;editCell(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;p&gt;Sets the numbers of rows in the &lt;code&gt;datagrid&lt;/code&gt;,
+    excluding rows that are descendants of rows that are closed.&lt;/p&gt;
 
-   &lt;dd&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; when the user edits the
-   cell on row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, column &lt;var
-   title=&quot;&quot;&gt;column&lt;/var&gt;. The new value of the cell is given by &lt;var
-   title=&quot;&quot;&gt;data&lt;/var&gt;. The data provider should update the cell
-   accordingly. There is no need to tell the &lt;code&gt;datagrid&lt;/code&gt;
-   that the cell has changed, as the &lt;code&gt;datagrid&lt;/code&gt;
-   automatically assumes that the given cell will need updating.&lt;/dd&gt;
+    &lt;p&gt;Throws a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception if the
+    arguments contradict each other or previously declared information
+    (e.g. declaring that the &lt;code&gt;datagrid&lt;/code&gt; has three rows when
+    the 12th row has been declared).&lt;/p&gt;
 
-&lt;!--XXXPA
-  void performAction(in DOMString action); // required if .performAction() is ever invoked on the datagrid
-  void performActionOnRow(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in DOMString action); // required if getRowClasses ever includes 'deletable' or if .performActionOnRow() is ever invoked on the datagrid
-  void performActionOnCell(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in unsigned long column, in DOMString action); // required if .performActionOnCell() is ever invoked on the datagrid
---&gt;
+   &lt;/dd&gt;
 
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-setRows&quot;&gt;setRows&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Updates data for rows in the &lt;code&gt;datagrid&lt;/code&gt;, or fills in
+    data for rows previously implied by a call to &lt;code
+    title=&quot;dom-datagrid-setRowCount&quot;&gt;setRowCount()&lt;/code&gt; but not
+    previously declared.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument is an array of rows, each
+    represented by a further array consisting of:&lt;/p&gt;
+
+    &lt;ol class=&quot;brief&quot;&gt;
+
+     &lt;li&gt;A &lt;code&gt;RowID&lt;/code&gt; object identifying the row.&lt;/li&gt;
+
+     &lt;li&gt;An integer giving the position of the row in its parent,
+     given the current sort order, or &amp;#x2212;1 to set other row data
+     without setting a position or changing a previously declared
+     position.&lt;/li&gt;
+
+     &lt;li&gt;An integer giving the number of children of the row, or 0 if
+     the row has no children, or &amp;#x2212;1 if the row has children but
+     the count is currently unknown. If the number of children has
+     already been set to 0 or a positive integer, then passing
+     &amp;#x2212;1 leaves the previous count unchanged.&lt;/li&gt;
+
+     &lt;li&gt;An array giving the data for zero or more cells in the row,
+     as described below.&lt;/li&gt;
+
+     &lt;li&gt;A boolean declaring whether the row is open or not. This
+     entry, if omitted, is assumed to be false (closed), unless the
+     row has already been declared as open.&lt;/li&gt;
+
+     &lt;li&gt;An integer giving the number of rows that are descendants of
+     this row, excluding those that are descendants of descendants of
+     this row that are closed. This entry can be omitted if the row is
+     closed or if it has already been declared.&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+    &lt;p&gt;The array giving the data for the cells in the row consists of
+    a further set of arrays, one per cell. The first item of each of
+    these arrays is the column's identifier; the subsequent values
+    vary based on the type of the column, as follows:&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;datagrid-type-text&quot;&gt;text&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;A string giving the cell's value.
+       &lt;li&gt;Optionally, an &lt;code&gt;img&lt;/code&gt; element giving an icon for the cell.
+      &lt;/ol&gt;
+     &lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;datagrid-type-editable&quot;&gt;editable&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;A string giving the cell's value.
+       &lt;li&gt;Optionally, a &lt;code&gt;datalist&lt;/code&gt; element giving a set of predefined options.
+       &lt;li&gt;Optionally, an &lt;code&gt;img&lt;/code&gt; element giving an icon for the cell.
+      &lt;/ol&gt;
+     &lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;datagrid-type-checkable&quot;&gt;checkable&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;A string giving the cell's value.
+       &lt;li&gt;A boolean, indicating whether the cell is checked (true) or not (false).
+       &lt;li&gt;Optionally, a boolean indicating whether the value of the cell is obscured as indeterminate (true), or not (false).
+       &lt;li&gt;Optionally, an &lt;code&gt;img&lt;/code&gt; element giving an icon for the cell.
+      &lt;/ol&gt;
+     &lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;datagrid-type-list&quot;&gt;list&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;A string giving the cell's current value.
+       &lt;li&gt;A &lt;code&gt;select&lt;/code&gt; element giving the &lt;span title=&quot;concept-select-option-list&quot;&gt;list of options&lt;/span&gt;.
+       &lt;li&gt;Optionally, an &lt;code&gt;img&lt;/code&gt; element giving an icon for the cell.
+      &lt;/ol&gt;
+     &lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;datagrid-type-progress&quot;&gt;progress&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;A value in the range 0.0 (no progress) to 1.0 (task complete).
+      &lt;/ol&gt;
+     &lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;datagrid-type-meter&quot;&gt;meter&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;A number giving the cell's value.
+       &lt;li&gt;Optionally, a number giving the maximum value, if it's not 1.
+       &lt;li&gt;Optionally, a number giving the minimum value, if it's not 0.
+       &lt;li&gt;Optionally, a number giving the highest value that is considered &quot;low&quot;.
+       &lt;li&gt;Optionally, a number giving the lowest value that is considered &quot;high&quot;.
+       &lt;li&gt;Optionally, a number giving the value that is considered optimal.
+      &lt;/ol&gt;
+     &lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;datagrid-type-custom&quot;&gt;custom&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;A number giving the minimum width of the cell, in CSS pixels, that is desired.
+       &lt;li&gt;A number giving the minimum height of the cell, in CSS pixels, that is desired.
+       &lt;li&gt;A function that is passed a &lt;code&gt;CanvasRenderingContext2D&lt;/code&gt; object, along with the width and height (in CSS pixels) of the cell that the context will draw on.
+      &lt;/ol&gt;
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+    &lt;p&gt;While the rows in a single call to the &lt;code
+    title=&quot;dom-datagrid-setRows&quot;&gt;setRows()&lt;/code&gt; method can be in any
+    order, for each row, it is important that all its ancestor rows
+    and all its open previous siblings are also declared, either in
+    the same call or in an earlier one.&lt;/p&gt;
+
+    &lt;p&gt;Throws a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception if the
+    arguments contradict each other or previously declared information
+    (e.g. saying that a row's position is 5 when the parent row only
+    has 3 children, or naming a column that doesn't exist, or
+    declaring a row without declaring its parent, or changing the
+    number of children that a row has while that row and its ancestors
+    are all open).&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-insertRows&quot;&gt;insertRows&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Inserts the given rows into the &lt;code&gt;datagrid&lt;/code&gt;,
+    increasing the numbers of rows that the &lt;code&gt;datagrid&lt;/code&gt;
+    assumes are present.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument is an array of rows in
+    the same structure as the argument to the &lt;code
+    title=&quot;dom-datagrid-setRows&quot;&gt;setRows()&lt;/code&gt; method described
+    above, with the same expectations of consistency (a given row's
+    ancestors and earlier open siblings being listed either earlier or
+    in the same call as a given row). However, unlike with the &lt;code
+    title=&quot;dom-datagrid-setRows&quot;&gt;setRows()&lt;/code&gt; method, if a row is
+    inserted along with its child, the child is not included in the
+    child and row counts of the parent row; every row in the &lt;var
+    title=&quot;&quot;&gt;rows&lt;/var&gt; argument will increase its parent's counts
+    automatically.&lt;/p&gt;
+
+    &lt;p&gt;Throws a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception if the
+    arguments contradict each other or previously declared
+    information.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-deleteRows&quot;&gt;deleteRows&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Removes the given rows from the &lt;code&gt;datagrid&lt;/code&gt;, and
+    updates the number of rows known to be in the
+    &lt;code&gt;datagrid&lt;/code&gt; accordingly. The argument is an array of
+    &lt;code&gt;RowID&lt;/code&gt; objects identifying the rows to remove.&lt;/p&gt;
+
+    &lt;p&gt;Throws a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception if the argument
+    includes a row the &lt;code&gt;datagrid&lt;/code&gt; doesn't know about.&lt;/p&gt;
+    &lt;!-- since otherwise behaviour might depend on where the user
+    scrolled! --&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-repaint&quot;&gt;repaint&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;If the given column's type is &lt;code
+    title=&quot;datagrid-type-custom&quot;&gt;custom&lt;/code&gt;, then causes the
+    &lt;code&gt;datagrid&lt;/code&gt; to reinvoke the function that obtains the
+    desired rendering.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; . &lt;code title=&quot;dom-datagrid-clearRows&quot;&gt;clearRows&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Clears the &lt;code&gt;datagrid&lt;/code&gt; of all row data, resetting it
+    to empty&lt;!-- v2DGS:, and clears the selection--&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
   &lt;/dl&gt;
 
-  &lt;p&gt;The following classes (for rows, columns, and cells) may be
-  usefully used in conjunction with this interface:&lt;/p&gt;
 
-  &lt;table id=&quot;datagridClassSummary&quot;&gt;
-   &lt;tr&gt;
-    &lt;th&gt;Class name&lt;/th&gt;
-    &lt;th&gt;Applies to&lt;/th&gt;
-    &lt;th&gt;Description&lt;/th&gt;
-   &lt;/tr&gt;
+  &lt;div class=&quot;impl&quot;&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--checked--&gt;&lt;dfn title=&quot;datagrid-cell-class-checked&quot;&gt;&lt;code&gt;checked&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell has a checkbox and it is checked. (The &lt;code
-    title=&quot;datagrid-cell-class-cyclable&quot;&gt;cyclable&lt;/code&gt; and &lt;code
-    title=&quot;datagrid-cell-class-progress&quot;&gt;progress&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;/tr&gt;
+  &lt;h6&gt;The listener&lt;/h6&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--cyclable--&gt;&lt;dfn title=&quot;datagrid-cell-class-cyclable&quot;&gt;&lt;code&gt;cyclable&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell can be cycled through multiple values. (The &lt;code
-    title=&quot;datagrid-cell-class-progress&quot;&gt;progress&lt;/code&gt; class
-    overrides this, though.)&lt;/td&gt;
-   &lt;/tr&gt;
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-datagrid-listener&quot;&gt;&lt;code&gt;listener&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute allows authors to specify an object that will receive all
+  the notifications from the &lt;code&gt;datagrid&lt;/code&gt;. Initially, its
+  value must be null. On getting, it must return its value. On
+  setting, its value must be set to the new value, and then the user
+  agent must &lt;span&gt;queue a task&lt;/span&gt; to call the &lt;code
+  title=&quot;dom-listener-initialize&quot;&gt;initalize()&lt;/code&gt; method with the
+  &lt;code&gt;datagrid&lt;/code&gt; element as its only argument.&lt;/p&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--editable--&gt;&lt;dfn title=&quot;datagrid-cell-class-editable&quot;&gt;&lt;code&gt;editable&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell can be edited. (The &lt;code
-    title=&quot;datagrid-cell-class-cyclable&quot;&gt;cyclable&lt;/code&gt;, &lt;code
-    title=&quot;datagrid-cell-class-progress&quot;&gt;progress&lt;/code&gt;, &lt;code
-    title=&quot;datagrid-cell-class-checked&quot;&gt;checked&lt;/code&gt;, &lt;code
-    title=&quot;datagrid-cell-class-checked&quot;&gt;unchecked&lt;/code&gt; and &lt;code
-    title=&quot;datagrid-cell-class-checked&quot;&gt;indeterminate&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;/tr&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--header--&gt;&lt;dfn title=&quot;datagrid-row-class-header&quot;&gt;&lt;code&gt;header&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row is a heading, not a data row.&lt;/td&gt;
-   &lt;/tr&gt;
+  &lt;h6&gt;The columns&lt;/h6&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--indeterminate--&gt;&lt;dfn title=&quot;datagrid-cell-class-indeterminate&quot;&gt;&lt;code&gt;indeterminate&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell has a checkbox, and it can be set to an indeterminate
-    state. If neither the &lt;code
-    title=&quot;datagrid-cell-class-checked&quot;&gt;checked&lt;/code&gt; nor &lt;code
-    title=&quot;datagrid-cell-class-checked&quot;&gt;unchecked&lt;/code&gt; classes are
-    present, then the checkbox is in that state, too. (The &lt;code
-    title=&quot;datagrid-cell-class-cyclable&quot;&gt;cyclable&lt;/code&gt; and &lt;code
-    title=&quot;datagrid-cell-class-progress&quot;&gt;progress&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;/tr&gt;
+  &lt;p&gt;The columns are represented by the &lt;dfn&gt;column list&lt;/dfn&gt;, an
+  ordered list of entries for columns, each of which consists of:&lt;/p&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--initially-hidden--&gt;&lt;dfn title=&quot;datagrid-column-class-initially-hidden&quot;&gt;&lt;code&gt;initially-hidden&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Columns&lt;/td&gt;
-    &lt;td&gt;The column will not be shown when the &lt;code&gt;datagrid&lt;/code&gt; is
-    initially rendered. If this class is not present on the column
-    when the &lt;code&gt;datagrid&lt;/code&gt; is initially rendered, the column
-    will be visible if space allows.&lt;/td&gt;
-   &lt;/tr&gt;
+  &lt;dl&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--initially-closed--&gt;&lt;dfn title=&quot;datagrid-row-class-initially-closed&quot;&gt;&lt;code&gt;initially-closed&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row will be closed when the &lt;code&gt;datagrid&lt;/code&gt; is
-    initially rendered. If neither this class nor the &lt;code
-    title=&quot;datagrid-row-class-initially-open&quot;&gt;initially-open&lt;/code&gt;
-    class is present on the row when the &lt;code&gt;datagrid&lt;/code&gt; is
-    initially rendered, the initial state will depend on platform
-    conventions.&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dt&gt;An identifier&lt;/dt&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--initially-open--&gt;&lt;dfn title=&quot;datagrid-row-class-initially-open&quot;&gt;&lt;code&gt;initially-open&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row will be opened when the &lt;code&gt;datagrid&lt;/code&gt; is
-    initially rendered. If neither this class nor the &lt;code
-    title=&quot;datagrid-row-class-initially-closed&quot;&gt;initially-closed&lt;/code&gt;
-    class is present on the row when the &lt;code&gt;datagrid&lt;/code&gt; is
-    initially rendered, the initial state will depend on platform
-    conventions.&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dd&gt;A string used to identify the column in the API.&lt;/dd&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--progress--&gt;&lt;dfn title=&quot;datagrid-cell-class-progress&quot;&gt;&lt;code&gt;progress&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell is a progress bar.&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dt&gt;A label&lt;/dt&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--reversed--&gt;&lt;dfn title=&quot;datagrid-column-class-reversed&quot;&gt;&lt;code&gt;reversed&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Columns&lt;/td&gt;
-    &lt;td&gt;If the cell is sorted, the sort direction is descending,
-    instead of ascending.&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dd&gt;A string used in the user interface.&lt;/dd&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--selectable-separator--&gt;&lt;dfn title=&quot;datagrid-row-class-selectable-separator&quot;&gt;&lt;code&gt;selectable-separator&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row is a normal, selectable, data row, except that instead
-    of having data, it only has a separator. (The &lt;code
-    title=&quot;datagrid-row-class-header&quot;&gt;header&lt;/code&gt; and &lt;code
-    title=&quot;datagrid-row-class-separator&quot;&gt;separator&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dt&gt;A type&lt;/dt&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--separator--&gt;&lt;dfn title=&quot;datagrid-row-class-separator&quot;&gt;&lt;code&gt;separator&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;The row is a separator row, not a data row. (The &lt;code
-    title=&quot;datagrid-row-class-header&quot;&gt;header&lt;/code&gt; class
-    overrides this, though.)&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dd&gt;One of the types described below.&lt;/dd&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--sortable--&gt;&lt;dfn title=&quot;datagrid-column-class-sortable&quot;&gt;&lt;code&gt;sortable&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Columns&lt;/td&gt;
-    &lt;td&gt;The data can be sorted by this column.&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dt&gt;An icon&lt;/dt&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--sorted--&gt;&lt;dfn title=&quot;datagrid-column-class-sorted&quot;&gt;&lt;code&gt;sorted&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Columns&lt;/td&gt;
-    &lt;td&gt;The data is sorted by this column. Unless the &lt;code
-    title=&quot;datagrid-column-class-reversed&quot;&gt;reversed&lt;/code&gt; class is
-    also present, the sort direction is ascending.&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dd&gt;An image, copied from an &lt;code&gt;img&lt;/code&gt; element when the
+   column was declared.&lt;/dd&gt;
 
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!--unchecked--&gt;&lt;dfn title=&quot;datagrid-cell-class-unchecked&quot;&gt;&lt;code&gt;unchecked&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Cells&lt;/td&gt;
-    &lt;td&gt;The cell has a checkbox and, unless the &lt;code
-    title=&quot;datagrid-cell-class-checked&quot;&gt;checked&lt;/code&gt; class is
-    present as well, it is unchecked. (The &lt;code
-    title=&quot;datagrid-cell-class-cyclable&quot;&gt;cyclable&lt;/code&gt; and &lt;code
-    title=&quot;datagrid-cell-class-progress&quot;&gt;progress&lt;/code&gt; classes
-    override this, though.)&lt;/td&gt;
-   &lt;/tr&gt;
+   &lt;dt&gt;Whether the column is sortable&lt;/dt&gt;
 
-&lt;!--XXXPA
-   &lt;tr&gt;
-    &lt;td&gt;&lt;!- -deletable- -&gt;&lt;dfn title=&quot;datagrid-row-class-deletable&quot;&gt;&lt;code&gt;deletable&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Rows&lt;/td&gt;
-    &lt;td&gt;&lt;/td&gt;
-   &lt;/tr&gt;
---&gt;
+   &lt;dd&gt;A boolean indicating whether the user can request that the data
+   be sorted by this column (true), or not (false).&lt;/dd&gt;
 
-  &lt;/table&gt;
+   &lt;dt&gt;Whether the column is visible&lt;/dt&gt;
 
+   &lt;dd&gt;A boolean indicating whether the column is part of the
+   &lt;code&gt;datagrid&lt;/code&gt;'s rendering.&lt;/dd&gt;
 
-  &lt;h5&gt;The default data provider&lt;/h5&gt;
+  &lt;/dl&gt;
 
-  &lt;p&gt;The user agent must supply a default data provider for the case
-  where the &lt;code&gt;datagrid&lt;/code&gt;'s &lt;code
-  title=&quot;dom-datagrid-data&quot;&gt;data&lt;/code&gt; attribute is null. It must act
-  as described in this section.&lt;/p&gt;
+  &lt;p&gt;Initially, the &lt;span&gt;column list&lt;/span&gt; must have a single
+  column, the &lt;dfn&gt;default column&lt;/dfn&gt;, whose identifier is the empty
+  string, whose label is the empty string, whose type is &lt;code
+  title=&quot;datagrid-type-text&quot;&gt;text&lt;/code&gt;, with no icon, which is not
+  sortable, and which &lt;em&gt;is&lt;/em&gt; visible.&lt;/p&gt;
 
-  &lt;p&gt;The behavior of the default data provider depends on the nature
-  of the first element child of the &lt;code&gt;datagrid&lt;/code&gt;.&lt;/p&gt;
+  &lt;hr&gt;
 
-  &lt;dl class=&quot;switch&quot;&gt;
+  &lt;p&gt;The &lt;dfn title=&quot;dom-datagrid-addColumn&quot;&gt;&lt;code&gt;addColumn(&lt;var
+  title=&quot;&quot;&gt;id&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;label&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;type&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;icon&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;sortable&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;visible&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
+  method must run the following steps:&lt;/p&gt;
 
-   &lt;!-- XXX some of these entries say &quot;the method must return&quot; and
-   other say &quot;the characteristic must be&quot;; this should be rationalized
-   --&gt;
+  &lt;ol&gt;
 
-   &lt;dt&gt;While the first element child is a &lt;code&gt;table&lt;/code&gt; element&lt;/dt&gt;
+   &lt;li&gt;&lt;p&gt;If there is already an entry in &lt;span&gt;column list&lt;/span&gt;,
+   other than the &lt;span&gt;default column&lt;/span&gt;, whose identifier is
+   &lt;var title=&quot;&quot;&gt;id&lt;/var&gt;, throw a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt;
+   exception and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not a string equal to one of the
+    &lt;span&gt;allowed &lt;code&gt;datagrid&lt;/code&gt; column types&lt;/span&gt;, then
+    throw a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;icon&lt;/var&gt; argument is present and not
+   null, and the given &lt;code&gt;img&lt;/code&gt; element's &lt;code
+   title=&quot;dom-img-complete&quot;&gt;complete&lt;/code&gt; attribute is false, then
+   throw an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these
+   steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;icon&lt;/var&gt; argument is present and not
+   null, then copy the image data from that &lt;code&gt;img&lt;/code&gt; element,
+   and let &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; be the copy of that image
+   data. Otherwise, let &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; be nothing.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append a new entry to the &lt;span&gt;column list&lt;/span&gt;, with
+   &lt;var title=&quot;&quot;&gt;id&lt;/var&gt; as its identifier, &lt;var title=&quot;&quot;&gt;label&lt;/var&gt;
+   as its label, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; as its type, and &lt;var
+   title=&quot;&quot;&gt;image&lt;/var&gt; as its icon. Let the column be sortable if the
+   &lt;var title=&quot;&quot;&gt;sortable&lt;/var&gt; argument is present and true, and make
+   it visible if the &lt;var title=&quot;&quot;&gt;visible&lt;/var&gt; argument is absent or
+   true.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;column list&lt;/span&gt; contains the &lt;span&gt;default
+   column&lt;/span&gt;, then remove the &lt;span&gt;default column&lt;/span&gt; from the
+   &lt;span&gt;column list&lt;/span&gt;, discard any data for cells in that column
+   in any rows in the &lt;code&gt;datagrid&lt;/code&gt;, set &lt;code
+   title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/code&gt; to &lt;var
+   title=&quot;&quot;&gt;id&lt;/var&gt;, set &lt;code
+   title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/code&gt; to true,
+   and run the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; resort
+   steps&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-datagrid-sortColumn&quot;&gt;&lt;code&gt;sortColumn&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute gives the current column used for sorting.  Initially, its
+  value must be the empty string. On getting, it must return its
+  current value. On setting, if the new value doesn't match the
+  identifier of one of the columns in the &lt;span&gt;column list&lt;/span&gt;,
+  then the user agent must throw a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt;
+  exception. Otherwise, if the new value is not the same as its
+  current value, then the user agent must set the attribute to the new
+  value, and then run the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; resort
+  steps&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-datagrid-sortAscending&quot;&gt;&lt;code&gt;sortAscending&lt;/code&gt;&lt;/dfn&gt;
+  DOM attribute specifies the direction that the tree is sorted in,
+  ascending (true) or descending (false). Initially, its value must be
+  true (ascending). On getting, it must return its current value. On
+  setting, if the new value is not the same as its current value, then
+  the user agent must set the attribute to the new value, and then run
+  the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; resort steps&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;When a column is marked as being sortable, the user agent should
+  allow the user to select that column to be the column used for
+  sorting, and should allow the user to chose whether the sort order
+  is ascending or descending.&lt;/p&gt;
+
+  &lt;p&gt;When the user changes the sort order in this manner, the user
+  agent must update the &lt;code
+  title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/code&gt; and &lt;code
+  title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/code&gt; attributes
+  appropriately, and then run the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; resort
+  steps&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;The &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; resort steps&lt;/span&gt;
+  are described in the next section.&lt;/p&gt;
+
+  &lt;hr&gt;
+  
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-datagrid-clearColumns&quot;&gt;&lt;code&gt;clearColumns()&lt;/code&gt;&lt;/dfn&gt;
+  method, if the &lt;span&gt;column list&lt;/span&gt; doesn't contain the
+  &lt;span&gt;default column&lt;/span&gt;, must empty the &lt;span&gt;column
+  list&lt;/span&gt;, append the &lt;span&gt;default column&lt;/span&gt; to the now empty
+  &lt;span&gt;column list&lt;/span&gt;, discard any data for cells in all rows in
+  the &lt;code&gt;datagrid&lt;/code&gt;, set &lt;code
+  title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/code&gt; to the empty
+  string, set &lt;code
+  title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/code&gt; to true, and
+  run the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; resort steps&lt;/span&gt;. (If the
+  &lt;span&gt;column list&lt;/span&gt; is already just the &lt;span&gt;default
+  column&lt;/span&gt;, then the method does nothing.)&lt;/p&gt;
+
+
+  &lt;h6&gt;The rows&lt;/h6&gt;
+
+  &lt;p&gt;A &lt;code&gt;datagrid&lt;/code&gt; element is intended to show a
+  representation of a tree, where typically the user only sees a
+  small part of the tree at a time.&lt;/p&gt;
+
+  &lt;p&gt;To make this efficent, the &lt;code&gt;datagrid&lt;/code&gt; element
+  &lt;em&gt;actually&lt;/em&gt; shows a small part of a &lt;em&gt;sparse&lt;/em&gt; tree, so
+  that only relevant parts of the data structure need be loaded at any
+  time. Specifically, the model requires only that all the ancestor
+  rows of the displayed rows be loaded, as well as any open earlier
+  siblings (in the displayed sort order) of the displayed rows.&lt;/p&gt;
+
+  &lt;p&gt;Conceptually, therefore, a &lt;code&gt;datagrid&lt;/code&gt; has a number of
+  related sparse data structures backing it.&lt;/p&gt;
+
+  &lt;p&gt;The first is the &lt;dfn&gt;natural order sparse data tree&lt;/dfn&gt;. This
+  is the structure in which rows are entered as they are declared, in
+  their natural order. This can differ from the order actually
+  displayed to the user. It consists of nested sparse lists of
+  rows. In the &lt;span&gt;natural order sparse data tree&lt;/span&gt;, a row will
+  always have all its parents already declared. Once a row is added to
+  this structure, it can only be removed by the &lt;code
+  title=&quot;dom-datagrid-deleteRows&quot;&gt;deleteRows()&lt;/code&gt; and &lt;code
+  title=&quot;dom-datagrid-clearRows&quot;&gt;clearRows()&lt;/code&gt; methods. The order of
+  nodes in this tree never changes; to move a node in this tree, it
+  has to be removed and then another row (with the same data)
+  reinserted elsewhere.&lt;/p&gt;
+
+  &lt;p&gt;The second structure is the &lt;dfn&gt;display order sparse data
+  tree&lt;/dfn&gt;. This is a similar structure that contains a subset of
+  the rows in the &lt;span&gt;natural order sparse data tree&lt;/span&gt;, ordered
+  in the order given by the &lt;code
+  title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/code&gt; and &lt;code
+  title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/code&gt; attributes, and
+  excluding rows with one or more ancestors that are closed. This tree
+  is cleared whenever the &lt;code
+  title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/code&gt; and &lt;code
+  title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/code&gt; attributes
+  change.&lt;/p&gt;
+
+  &lt;p&gt;The third structure is the &lt;dfn&gt;display order sparse data
+  list&lt;/dfn&gt;. This structure is a flattened representation of the
+  &lt;span&gt;display order sparse data tree&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;At any time, a number of consecutive rows in the &lt;span&gt;display
+  order sparse data list&lt;/span&gt; are physically visible to the
+  user. The &lt;code&gt;datagrid&lt;/code&gt; fires notifications to a &lt;span
+  title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/span&gt; (provided by script),
+  and the listener, or other some script, is expected to feed the
+  &lt;code&gt;datagrid&lt;/code&gt; with the information needed to render the
+  control.&lt;/p&gt;
+
+  &lt;p&gt;A &lt;code&gt;datagrid&lt;/code&gt; has a &lt;dfn&gt;pending &lt;code&gt;datagrid&lt;/code&gt;
+  rows list&lt;/dfn&gt;, which is a list of rows in the &lt;span&gt;display order
+  sparse data list&lt;/span&gt; for which the &lt;code&gt;datagrid&lt;/code&gt; has sent
+  notifications requesting information but not yet received
+  information about.&lt;/p&gt;
+
+  &lt;p&gt;A &lt;code&gt;datagrid&lt;/code&gt; also has a &lt;dfn&gt;pending
+  &lt;code&gt;datagrid&lt;/code&gt; &lt;em&gt;cells&lt;/em&gt; list&lt;/dfn&gt;, which is a list of
+  row/column pairs (cells) for which the &lt;code&gt;datagrid&lt;/code&gt; has
+  sent notifications requesting information but not yet received
+  information about.&lt;/p&gt;
+
+  &lt;p&gt;User agents may discard information about rows that are not
+  displayed and that are not ancestors or open earlier siblings of
+  rows or ancestors of rows that are displayed.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;These structures are different views of the collection of rows
+  that form the &lt;code&gt;datagrid&lt;/code&gt;. Each row has the following
+  information associated with it:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;A parent&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Either another row, or the &lt;code&gt;datagrid&lt;/code&gt; itself. This
+   is the parent of the row in the &lt;span&gt;natural order sparse data
+   tree&lt;/span&gt; and the &lt;span&gt;display order sparse data tree&lt;/span&gt;
+   for the &lt;code&gt;datagrid&lt;/code&gt;.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;A natural order position relative to the other rows with the
+   same parent&lt;/dt&gt;
+
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code
-    title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;:
-    The number of rows returned by the default data provider for the
-    root of the tree (when &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is empty) must be the total number of &lt;code&gt;tr&lt;/code&gt; elements
-    that are children of &lt;code&gt;tbody&lt;/code&gt; elements that are children
-    of the &lt;code&gt;table&lt;/code&gt;, if there are any such child
-    &lt;code&gt;tbody&lt;/code&gt; elements. If there are no such
-    &lt;code&gt;tbody&lt;/code&gt; elements then the number of rows returned for
-    the root must be the number of &lt;code&gt;tr&lt;/code&gt; elements that are
-    children of the &lt;code&gt;table&lt;/code&gt;.&lt;/p&gt;
+    &lt;p&gt;This is the number of rows that precede this row under the same
+    parent in the &lt;span&gt;natural order sparse data tree&lt;/span&gt;. This
+    number can't be changed relative to other rows in the same parent;
+    to change the relative natural order of data in the
+    &lt;code&gt;datagrid&lt;/code&gt;, the original rows have to be removed and
+    new rows (with the same data but different natural positions)
+    inserted in their place. (The exact number of a row can change, as
+    new rows can be inserted above it.)&lt;/p&gt;
 
-    &lt;p&gt;When &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is not empty, the number of rows
-    returned must be zero.&lt;/p&gt;
+    &lt;p&gt;A row can be identified by a &lt;code&gt;RowID&lt;/code&gt; object. This is
+    an array of numbers, consisting of the natural order positions of
+    each ancestor row and the row itself, starting from the furthest
+    ancestor. Thus, for instance, the fourth child row of the first
+    child row of the second row in a &lt;code&gt;datagrid&lt;/code&gt; would be
+    identified by a &lt;code&gt;RowID&lt;/code&gt; object whose value is &lt;code
+    title=&quot;&quot;&gt;[1, 0, 3]&lt;/code&gt;. A row's identifier changes if rows are
+    &lt;span title=&quot;dom-datagrid-insertRows&quot;&gt;inserted before it&lt;/span&gt; in
+    the &lt;code&gt;datagrid&lt;/code&gt;.&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The &lt;code&gt;table&lt;/code&gt;-based default data provider
-    cannot represent a tree.&lt;/p&gt;
+   &lt;/dd&gt;
 
-    &lt;p class=&quot;note&quot;&gt;Rows in &lt;code&gt;thead&lt;/code&gt; elements do not
-    contribute to the number of rows returned, although they do affect
-    the columns and column captions. Rows in &lt;code&gt;tfoot&lt;/code&gt;
-    elements are &lt;span title=&quot;ignore&quot;&gt;ignored&lt;/span&gt; completely by
-    this algorithm.&lt;/p&gt;
+   &lt;dt&gt;A display order position relative to the other rows with
+   the same parent&lt;/dt&gt;
 
-    &lt;p id=&quot;defaultDataProviderTableMapper&quot;&gt;&lt;strong&gt;&lt;code
-    title=&quot;dom-provider-getChildAtPosition&quot;&gt;getChildAtPosition(&lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;: The
-    default data provider must return the mapping appropriate to the
-    &lt;a href=&quot;#defaultDataProviderTableSort&quot;&gt;current sort
-    order&lt;/a&gt;.&lt;/p&gt;
+   &lt;dd&gt;&lt;p&gt;This is the number of rows that precede this row under the
+   same parent in the &lt;span&gt;display order sparse data
+   tree&lt;/span&gt;. This number can be unknown. If the sort order
+   changes, then this information is lost (as the &lt;span&gt;display order
+   sparse data tree&lt;/span&gt; is cleared).&lt;/p&gt;&lt;/dd&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code
-    title=&quot;dom-provider-getColumnCount&quot;&gt;getColumnCount()&lt;/code&gt;&lt;/strong&gt;:
-    The number of columns returned must be the number of
-    &lt;code&gt;td&lt;/code&gt; element children in the first &lt;code&gt;tr&lt;/code&gt;
-    element child of the first &lt;code&gt;tbody&lt;/code&gt; element child of the
-    &lt;code&gt;table&lt;/code&gt;, if there are any such &lt;code&gt;tbody&lt;/code&gt;
-    elements. If there are no such &lt;code&gt;tbody&lt;/code&gt; elements, then
-    it must be the number of &lt;code&gt;td&lt;/code&gt; element children in the
-    first &lt;code&gt;tr&lt;/code&gt; element child of the &lt;code&gt;table&lt;/code&gt;, if
-    any, or otherwise 1. If the number that would be returned by these
-    rules is 0, then 1 must be returned instead.&lt;/p&gt;
+   &lt;dt&gt;A child count&lt;/dt&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code
-    title=&quot;dom-provider-getCaptionText&quot;&gt;getCaptionText(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;: If the &lt;code&gt;table&lt;/code&gt; has
-    no &lt;code&gt;thead&lt;/code&gt; element child, or if its first
-    &lt;code&gt;thead&lt;/code&gt; element child has no &lt;code&gt;tr&lt;/code&gt; element
-    child, the default data provider must return the empty string for
-    all captions. Otherwise, the value of the &lt;code&gt;textContent&lt;/code&gt;
-    attribute of the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th &lt;code&gt;th&lt;/code&gt; element
-    child of the first &lt;code&gt;tr&lt;/code&gt; element child of the first
-    &lt;code&gt;thead&lt;/code&gt; element child of the &lt;code&gt;table&lt;/code&gt; element
-    must be returned. If there is no such &lt;code&gt;th&lt;/code&gt; element, the
-    empty string must be returned.&lt;/p&gt;
+   &lt;dd&gt;&lt;p&gt;The number of rows that have this row as a parent. If this is
+   zero, the row cannot be opened. If this is &amp;#x2212;1, then the
+   child count is unknown but the row can be opened. This value can be
+   changed by the &lt;code title=&quot;dom-datagrid-setRows&quot;&gt;setRows()&lt;/code&gt;
+   method only if the current value is &amp;#x2212;1 or if the row or one
+   of its ancestors is closed. Otherwise, it can only be changed
+   indirectly using the &lt;code
+   title=&quot;dom-datagrid-insertRows&quot;&gt;insertRows()&lt;/code&gt; and &lt;code
+   title=&quot;dom-datagrid-deleteRows&quot;&gt;deleteRows()&lt;/code&gt; methods.&lt;/p&gt;&lt;/dd&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code
-    title=&quot;dom-provider-getCaptionClasses&quot;&gt;getCaptionClasses(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;: If
-    the &lt;code&gt;table&lt;/code&gt; has no &lt;code&gt;thead&lt;/code&gt; element child, or
-    if its first &lt;code&gt;thead&lt;/code&gt; element child has no
-    &lt;code&gt;tr&lt;/code&gt; element child, the default data provider must not
-    add any classes for any of the captions. Otherwise, each class
-    in the &lt;code title=&quot;attr-class&quot;&gt;class&lt;/code&gt; attribute of the &lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;th &lt;code&gt;th&lt;/code&gt; element child of the first
-    &lt;code&gt;tr&lt;/code&gt; element child of the first &lt;code&gt;thead&lt;/code&gt;
-    element child of the &lt;code&gt;table&lt;/code&gt; element must be added to
-    the &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;. If there is no such
-    &lt;code&gt;th&lt;/code&gt; element, no classes must be added. The user agent
-    must then:&lt;/p&gt;
+   &lt;dt&gt;An open flag&lt;/dt&gt;
 
+   &lt;dd&gt;&lt;p&gt;A boolean indicating whether the row is open (true) or
+   closed (false). Once set, can only be changed by the user or if one
+   of the row's ancestors is itself closed. A row can also be in a
+   third state, &quot;opening&quot;, which is treated as closed for all purposes
+   except that the user agent may indicate that the row is in this
+   special state, and except that when the row is updated to have a
+   row count, the row will switch to being open.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;A row count&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The number of rows that have this row as a parent or
+   ancestor, and that do not have an ancestor that is a descendant of
+   this row that is itself closed. If this is &amp;#x2212;1, then the row
+   count is unknown. This value can be changed by the &lt;code
+   title=&quot;dom-datagrid-setRows&quot;&gt;setRows()&lt;/code&gt; method only if the
+   row or one of its ancestors is closed (or opening, but not
+   open). Otherwise, it can only be changed indirectly using the &lt;code
+   title=&quot;dom-datagrid-insertRows&quot;&gt;insertRows()&lt;/code&gt; and &lt;code
+   title=&quot;dom-datagrid-deleteRows&quot;&gt;deleteRows()&lt;/code&gt;
+   methods.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;Cells&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The data that applies to this row. Cell data is discussed in
+   more detail below.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;p&gt;The &lt;code&gt;datagrid&lt;/code&gt; itself also has a &lt;dfn title=&quot;datagrid
+  child count&quot;&gt;child count&lt;/dfn&gt; and a &lt;dfn title=&quot;datagrid row
+  count&quot;&gt;row count&lt;/dfn&gt;, which are analogous to the child counts and
+  row counts for rows. Initially these must be zero.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn&gt;&lt;code&gt;datagrid&lt;/code&gt; resort steps&lt;/dfn&gt;, which are
+  invoked when the sort order changes as described in the previous
+  section, are as follows:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Clear the &lt;span&gt;display order sparse data tree&lt;/span&gt;
+    (i.e. mark the display order position of all the rows in the
+    &lt;code&gt;datagrid&lt;/code&gt; as unknown).&lt;/p&gt;
+
+    &lt;p&gt;User agents may cache the position information of rows for
+    various values of &lt;code
+    title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/code&gt; and &lt;code
+    title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/code&gt;, instead
+    of discarding the information altogether. If the user agent caches
+    this information, and has information that applies to the current
+    values of &lt;code title=&quot;dom-datagrid-sortColumn&quot;&gt;sortColumn&lt;/code&gt;
+    and &lt;code title=&quot;dom-datagrid-sortAscending&quot;&gt;sortAscending&lt;/code&gt;,
+    then the user agent may repopulate the &lt;span&gt;display order sparse
+    data tree&lt;/span&gt; from this information.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Clear the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/span&gt;
+    and the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;!-- v2: queue a task to fire an event, or tell the listener the
+   sort order changed, or something --&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-datagrid-renotify&quot;&gt;&lt;code&gt;renotify()&lt;/code&gt;&lt;/dfn&gt; method
+  must empty the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/span&gt;
+  and the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/span&gt;, and
+  invoke the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+  algorithm&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-datagrid-setRowCount&quot;&gt;&lt;code&gt;setRowCount(&lt;var
+  title=&quot;&quot;&gt;childCount&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;rowCount&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Set the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; child count&lt;/span&gt; to &lt;var
+    title=&quot;&quot;&gt;childCount&lt;/var&gt;, the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; row
+    count&lt;/span&gt; to &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span&gt;Audit the &lt;code&gt;datagrid&lt;/code&gt;&lt;/span&gt;. If this fails,
+    then revert the changes made in the previous step, throw a
+    &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception, and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-datagrid-setRows&quot;&gt;&lt;code&gt;setRows(&lt;var
+  title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span title=&quot;type-check a RowList object&quot;&gt;Type-check the &lt;var
+    title=&quot;&quot;&gt;rows&lt;/var&gt; argument&lt;/span&gt;. If this fails, throw a
+    &lt;code&gt;TypeError&lt;/code&gt; exception, and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span title=&quot;partially sort a RowList object&quot;&gt;Partially sort
+    the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each &lt;code&gt;Row&lt;/code&gt; object in the &lt;var
+    title=&quot;&quot;&gt;rows&lt;/var&gt; argument, in order, perform the appropriate
+    steps from the list below.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;The changes made to the &lt;code&gt;datagrid&lt;/code&gt;'s
+    data structures in this step get reverted (as required below) if
+    any consistency errors are detected either in this step or the
+    next.&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt;If there already exists a row in the &lt;code&gt;datagrid&lt;/code&gt;'s
+     &lt;span&gt;natural order sparse data tree&lt;/span&gt; with the same
+     identifier as given by the &lt;code&gt;Row&lt;/code&gt; object's
+     &lt;code&gt;RowID&lt;/code&gt; object, and that row and all its ancestors are
+     open&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If one of the following conditions is true, then revert all
+      the changes done in this step, throw a
+      &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception, and abort these
+      steps:&lt;/p&gt;
+
+      &lt;ul&gt;
+
+       &lt;li&gt;The value of the &lt;code&gt;Row&lt;/code&gt; object's second entry is
+       neither &amp;#x2212;1 nor equal to the child count of the
+       preexisting row.&lt;/li&gt;
+
+       &lt;li&gt;The &lt;code&gt;Row&lt;/code&gt; object has fewer than five entries, or
+       its fifth entry is false.&lt;/li&gt;
+
+       &lt;li&gt;The &lt;code&gt;Row&lt;/code&gt; object has fewer than six entries, or
+       its sixth entry is not equal to the row count of the
+       preexisting row.&lt;/li&gt;
+
+      &lt;/ul&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;If there already exists a row in the &lt;code&gt;datagrid&lt;/code&gt;'s
+     &lt;span&gt;natural order sparse data tree&lt;/span&gt; with the same
+     identifier as given by the &lt;code&gt;Row&lt;/code&gt; object's
+     &lt;code&gt;RowID&lt;/code&gt; object, but either that row or one of its
+     ancestors is closed&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;Set the preexisting row's child count to the value of the
+      &lt;code&gt;Row&lt;/code&gt; object's second entry.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;code&gt;Row&lt;/code&gt; object has five or more entries, and
+      either its fifth entry is true and the preexisting row is closed
+      but not opening, or its fifth entry is false and the preexisting
+      row is open, then: if the preexisting row has no ancestor row
+      that is closed, then revert all the changes done in this step,
+      throw a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception, and abort
+      these steps; otherwise, if the fifth entry is false, then close
+      the row; otherwise, open the row.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;code&gt;Row&lt;/code&gt; object has six entries, set the
+      preexisting row's row count to the value of the &lt;code&gt;Row&lt;/code&gt;
+      object's sixth entry.&lt;/p&gt;
+
+      &lt;p&gt;If the preexisting row is opening, then: increase the
+      &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/span&gt; and the row counts
+      of any ancestor rows by the number of rows that the preexisting
+      row now has in its row count, then open the row.&lt;/p&gt; &lt;!-- we
+      should also &quot;update the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows
+      list&lt;/span&gt; and the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells
+      list&lt;/span&gt; accordingly&quot; --&gt;
+
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;There does not exist a row in the &lt;code&gt;datagrid&lt;/code&gt;'s
+     &lt;span&gt;natural order sparse data tree&lt;/span&gt; with the same
+     identifier as given by the &lt;code&gt;Row&lt;/code&gt; object's
+     &lt;code&gt;RowID&lt;/code&gt; object&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If the &lt;code&gt;RowID&lt;/code&gt; object has a length greater than 1,
+      then verify that there is a row identified by the
+      &lt;code&gt;RowID&lt;/code&gt; consisting of all but the last number in the
+      &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt;. If there is no
+      such row present in the &lt;span&gt;natural order sparse data
+      tree&lt;/span&gt;, then revert all the changes done in this step,
+      throw a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception, and abort
+      these steps.&lt;/p&gt;
+
+      &lt;p&gt;Create a row and insert it into the &lt;span&gt;natural order
+      sparse data tree&lt;/span&gt;, such that its parent is the row
+      identified by the &lt;code&gt;RowID&lt;/code&gt; consisting of all but the
+      last number in the &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt;,
+      or the &lt;code&gt;datagrid&lt;/code&gt; if the lenght of the
+      &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt; is 1; with its
+      natural order position being the last number of the
+      &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt;; with the child
+      count being the value of the third entry of the &lt;code&gt;Row&lt;/code&gt;
+      object; with the row being marked closed unless the
+      &lt;code&gt;Row&lt;/code&gt; object has five or more entries and its fifth
+      entry is true, in which case the row is open; and with its row
+      count being &amp;#x2212;1 unless the &lt;code&gt;Row&lt;/code&gt; object has six
+      entries, in which case the row count is equal to the value of
+      the &lt;code&gt;Row&lt;/code&gt; object's sixth entry.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span&gt;Audit the &lt;code&gt;datagrid&lt;/code&gt;&lt;/span&gt;. If this fails,
+    then revert the changes made in the previous step, throw a
+    &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception, and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each &lt;code&gt;Row&lt;/code&gt; object in the &lt;var
+    title=&quot;&quot;&gt;rows&lt;/var&gt; argument, in order, &lt;span title=&quot;apply a Row
+    object&quot;&gt;apply the &lt;code&gt;Row&lt;/code&gt; object&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-datagrid-insertRows&quot;&gt;&lt;code&gt;insertRows(&lt;var
+  title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span title=&quot;type-check a RowList object&quot;&gt;Type-check the &lt;var
+    title=&quot;&quot;&gt;rows&lt;/var&gt; argument&lt;/span&gt;. If this fails, throw a
+    &lt;code&gt;TypeError&lt;/code&gt; exception, and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span title=&quot;partially sort a RowList object&quot;&gt;Partially sort
+    the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each &lt;code&gt;Row&lt;/code&gt; object in the &lt;var
+    title=&quot;&quot;&gt;rows&lt;/var&gt; argument, in order, run the following
+    steps:&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;The changes made to the &lt;code&gt;datagrid&lt;/code&gt;'s
+    data structures in this step get reverted (as required below) if
+    any consistency errors are detected either in this step or the
+    next.&lt;/p&gt;
+
     &lt;ol&gt;
 
-     &lt;li&gt;Remove the &lt;code
-     title=&quot;datagrid-column-class-sorted&quot;&gt;sorted&lt;/code&gt; and &lt;code
-     title=&quot;datagrid-column-class-reversed&quot;&gt;reversed&lt;/code&gt;
-     classes.&lt;/li&gt;
+     &lt;li&gt;
 
-     &lt;li&gt;If the &lt;code&gt;table&lt;/code&gt; element has a &lt;code
-     title=&quot;attr-class&quot;&gt;class&lt;/code&gt; attribute that includes the &lt;code
-     title=&quot;&quot;&gt;sortable&lt;/code&gt; class, add the &lt;code
-     title=&quot;datagrid-column-class-sortable&quot;&gt;sortable&lt;/code&gt;
-     class.&lt;/li&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; be the row identified by the
+      &lt;code&gt;RowID&lt;/code&gt; consisting of all but the last number in the
+      &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt;, or the
+      &lt;code&gt;datagrid&lt;/code&gt; itself it the &lt;code&gt;Row&lt;/code&gt; object's
+      &lt;code&gt;RowID&lt;/code&gt; has length 0.&lt;/p&gt;
 
-     &lt;li&gt;If the column is the one currently being used to
-     sort the data, add the &lt;code
-     title=&quot;datagrid-column-class-sorted&quot;&gt;sorted&lt;/code&gt; class.&lt;/li&gt;
+      &lt;p&gt;If there is no such row present in the &lt;span&gt;natural order
+      sparse data tree&lt;/span&gt;, then revert all the changes done in
+      this algorithm, throw a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt;
+      exception, and abort these steps.&lt;/p&gt;
 
-     &lt;li&gt;If the column is the one currently being used to sort the
-     data, and it is sorted in descending order, add the &lt;code
-     title=&quot;datagrid-column-class-reversed&quot;&gt;reversed&lt;/code&gt; class as
-     well.&lt;/li&gt;
+     &lt;/li&gt;
 
+     &lt;li&gt;
+
+      &lt;p&gt;Increment by one the natural order position of all rows whose
+      parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; and whose natural order
+      position is equal to or greater than the last number of the
+      &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the value of the &lt;code&gt;Row&lt;/code&gt; object's second entry is
+      not &amp;#x2212;1, then increment by one the display order position
+      of all rows whose parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; and whose
+      display order position is equal to or greater than the value of
+      the &lt;code&gt;Row&lt;/code&gt; object's second entry.&lt;/p&gt;
+
+     &lt;!--(Not sure how to really say this.)
+      &lt;p&gt;Update the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows
+      list&lt;/span&gt; and the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells
+      list&lt;/span&gt; accordingly.&lt;/p&gt;
+     --&gt;
+
+     &lt;/li&gt;
+ 
+     &lt;li&gt;
+
+      &lt;p&gt;Create a row and insert it into the &lt;span&gt;natural order
+      sparse data tree&lt;/span&gt;, such that its parent is &lt;var
+      title=&quot;&quot;&gt;parent&lt;/var&gt;; with its natural order position being the
+      last number of the &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt;;
+      with the child count being the value of the third entry of the
+      &lt;code&gt;Row&lt;/code&gt; object; with the row being marked closed unless
+      the &lt;code&gt;Row&lt;/code&gt; object has five or more entries and its
+      fifth entry is true, in which case the row is open; and with its
+      row count being &amp;#x2212;1 unless the &lt;code&gt;Row&lt;/code&gt; object has
+      six entries, in which case the row count is equal to the value
+      of the &lt;code&gt;Row&lt;/code&gt; object's sixth entry.&lt;/p&gt;
+
+     &lt;/li&gt;
+
     &lt;/ol&gt;
 
-    &lt;p&gt;The various row- and cell- related methods operate relative to
-    a particular element, the element of the row or cell specified by
-    their arguments.&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;&lt;strong&gt;For rows&lt;/strong&gt;: Since the default data provider for
-    a &lt;code&gt;table&lt;/code&gt; always returns 0 as the number of children
-    for any row other than the root, the path to the row passed to
-    these methods will always consist of a single number. In the prose
-    below, this number is referred to as &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;.&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;If the &lt;code&gt;table&lt;/code&gt; has &lt;code&gt;tbody&lt;/code&gt; element
-    children, the element for the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th row is the
-    &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th &lt;code&gt;tr&lt;/code&gt; element that is a child of
-    a &lt;code&gt;tbody&lt;/code&gt; element that is a child of the
-    &lt;code&gt;table&lt;/code&gt; element. If the &lt;code&gt;table&lt;/code&gt; does not
-    have &lt;code&gt;tbody&lt;/code&gt; element children, then the element for the
-    &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th real row is the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th
-    &lt;code&gt;tr&lt;/code&gt; element that is a child of the &lt;code&gt;table&lt;/code&gt;
-    element.&lt;/p&gt;
+    &lt;p&gt;For each &lt;code&gt;Row&lt;/code&gt; object in the &lt;var
+    title=&quot;&quot;&gt;rows&lt;/var&gt; argument, in order, &lt;span title=&quot;apply a Row
+    object&quot;&gt;apply the &lt;code&gt;Row&lt;/code&gt; object&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;strong&gt;For cells&lt;/strong&gt;: Given a row and its element, the
-    row's &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th cell's element is the &lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;th &lt;code&gt;td&lt;/code&gt; element child of the row
-    element.&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The &lt;code&gt;colspan&lt;/code&gt; and &lt;code&gt;rowspan&lt;/code&gt;
-    attributes are &lt;span title=&quot;ignore&quot;&gt;ignored&lt;/span&gt; by this
-    algorithm.&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=&quot;dom-provider-getRowImage&quot;&gt;getRowImage(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;: The &lt;span&gt;URL&lt;/span&gt; of the
-    row's image is the &lt;span&gt;absolute URL&lt;/span&gt; obtained by &lt;span
-    title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the value of the &lt;code
-    title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute of the first
-    &lt;code&gt;img&lt;/code&gt; element child of the row's first cell's element,
-    relative to that element, if there is one and resolving its
-    attribute is successful. Otherwise, the &lt;span&gt;URL&lt;/span&gt; of the
-    row's image is the empty string.&lt;/p&gt; &lt;!-- note that if the base
-    URL has changed, this URL can be different than the one that the
-    &lt;img&gt; element fetched when it was created --&gt;
+    &lt;p&gt;Invoke the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=&quot;dom-provider-getRowMenu&quot;&gt;getRowMenu(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;: If the row's first cell's
-    element has a &lt;code&gt;menu&lt;/code&gt; element child, then the row's menu
-    is the first &lt;code&gt;menu&lt;/code&gt; element child of the row's first
-    cell's element. Otherwise, the row has no menu.&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code
-    title=&quot;dom-provider-getRowClasses&quot;&gt;getRowClasses(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;:
-    The default data provider must never add a class to the row's
-    classes.&lt;/p&gt;
+  &lt;/ol&gt;
 
-    &lt;p id=&quot;defaultDataProviderTableSort&quot;&gt;&lt;strong&gt;&lt;code
-    title=&quot;dom-provider-toggleColumnSortState&quot;&gt;toggleColumnSortState(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;: If the data is already being
-    sorted on the given column, then the user agent must change the
-    current sort mapping to be the inverse of the current sort
-    mapping; if the sort order was ascending before, it is now
-    descending, otherwise it is now ascending. Otherwise, if the
-    current sort column is another column, or the data model is
-    currently not sorted, the user agent must create a new mapping,
-    which maps rows in the data model to rows in the DOM so that the
-    rows in the data model are sorted by the specified column, in
-    ascending order. (Which sort comparison operator to use is left up
-    to the UA to decide.)&lt;/p&gt;
+  &lt;hr&gt;
 
-    &lt;p&gt;When the sort mapping is changed, the values returned by the
-    &lt;code
-    title=&quot;dom-provider-getChildAtPosition&quot;&gt;getChildAtPosition()&lt;/code&gt;
-    method for the default data provider &lt;a
-    href=&quot;#defaultDataProviderTableMapper&quot;&gt;will change
-    appropriately&lt;/a&gt;.&lt;/p&gt;
+  &lt;p&gt;When an algorithm requires the user agent to &lt;dfn&gt;type-check a
+  &lt;code&gt;RowList&lt;/code&gt; object&lt;/dfn&gt; (an array), each entry in the
+  object must be checked against the following requirements. If any
+  are false, then the type-check fails, otherwise it passes.&lt;/p&gt;
 
-    &lt;p&gt;&lt;strong&gt;&lt;code title=&quot;dom-provider-getCellData&quot;&gt;getCellData(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;)&lt;/code&gt;, &lt;code
-    title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;, &lt;code
-    title=&quot;dom-provider-setCellCheckedState&quot;&gt;getCellCheckedState(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;state&lt;/var&gt;)&lt;/code&gt;, &lt;code
-    title=&quot;dom-provider-cycleCell&quot;&gt;cycleCell(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;,
-    &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;)&lt;/code&gt;, and &lt;code
-    title=&quot;dom-provider-editCell&quot;&gt;editCell(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;,
-    &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/code&gt;&lt;/strong&gt;:
-    See &lt;a href=&quot;#commonDefaultDataGridMethodDefinitions&quot;&gt;the common
-    definitions below&lt;/a&gt;.&lt;/p&gt;
+  &lt;ul&gt;
 
-    &lt;p&gt;The data provider must call the &lt;code&gt;datagrid&lt;/code&gt;'s update
-    methods appropriately whenever the descendants of the
-    &lt;code&gt;datagrid&lt;/code&gt; mutate. For example, if a &lt;code&gt;tr&lt;/code&gt; is
-    removed, then the &lt;code
-    title=&quot;dom-datagrid-updateRowsRemoved&quot;&gt;updateRowsRemoved()&lt;/code&gt;
-    methods would probably need to be invoked, and any change to a
-    cell or its descendants must cause the cell to be updated. If the
-    &lt;code&gt;table&lt;/code&gt; element stops being the first child of the
-    &lt;code&gt;datagrid&lt;/code&gt;, then the data provider must call the &lt;code
-    title=&quot;dom-datagrid-updateEverything&quot;&gt;updateEverything()&lt;/code&gt;
-    method on the &lt;code&gt;datagrid&lt;/code&gt;. Any change to a cell that is
-    in the column that the data provider is currently using as its
-    sort column must also cause the sort to be reperformed, with a
-    call to &lt;code
-    title=&quot;dom-datagrid-updateEverything&quot;&gt;updateEverything()&lt;/code&gt; if
-    the change did affect the sort order.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;The entry is a &lt;code&gt;Row&lt;/code&gt; object (an
+   array).&lt;/p&gt;&lt;/li&gt;
 
-   &lt;/dd&gt;
+   &lt;li&gt;&lt;p&gt;The first value in the &lt;code&gt;Row&lt;/code&gt; is a
+   &lt;code&gt;RowID&lt;/code&gt; object (also an array), whose length is at least
+   1, and whose values are all integers greater than or equal to
+   zero.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;The numbers in the &lt;code&gt;RowID&lt;/code&gt; object do not exactly
+   match any of the other entries in the &lt;code&gt;RowList&lt;/code&gt; object
+   (i.e. no two &lt;code&gt;Row&lt;/code&gt; objects have the same
+   identifier).&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dt&gt;While the first element child is a &lt;code&gt;select&lt;/code&gt; or &lt;code&gt;datalist&lt;/code&gt; element&lt;/dt&gt;
+   &lt;li&gt;&lt;p&gt;The second value in the &lt;code&gt;Row&lt;/code&gt; is an integer that
+   is either &amp;#x2212;1, zero, or a positive integer.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dd&gt;
+   &lt;li&gt;&lt;p&gt;The third value in the &lt;code&gt;Row&lt;/code&gt; is an integer that
+   is either &amp;#x2212;1, zero, or a positive integer.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;The default data provider must return 1 for the column count,
-    the empty string for the column's caption, and must not add any
-    classes to the column's classes.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;The fourth value in the &lt;code&gt;Row&lt;/code&gt; is a
+   &lt;code&gt;CellList&lt;/code&gt; object (yet another array).&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;For the rows, assume the existence of a node filter view of the
-    descendants of the first element child of the
-    &lt;code&gt;datagrid&lt;/code&gt; element (the &lt;code&gt;select&lt;/code&gt; or
-    &lt;code&gt;datalist&lt;/code&gt; element), that skips all nodes other than
-    &lt;code&gt;optgroup&lt;/code&gt; and &lt;code&gt;option&lt;/code&gt; elements, as well as
-    any descendants of any &lt;code&gt;option&lt;/code&gt; elements.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Each entry in the &lt;span&gt;CellList&lt;/span&gt; object is a
+   &lt;code&gt;Cell&lt;/code&gt; object (again, an array).&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;Given a path &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, the corresponding element
-    is the one obtained by drilling into the view, taking the child
-    given by the path each time.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Each &lt;code&gt;Cell&lt;/code&gt; object in the &lt;span&gt;CellList&lt;/span&gt;
+   object has as its first value a &lt;code&gt;Column&lt;/code&gt; object (a
+   string), and its value is the identifier of one of the columns in
+   the &lt;span&gt;column list&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;div class=&quot;example&quot;&gt;
+   &lt;li&gt;
 
-     &lt;p&gt;Given the following XML markup:&lt;/p&gt;
+    &lt;p&gt;Each &lt;code&gt;Cell&lt;/code&gt; object in the &lt;span&gt;CellList&lt;/span&gt;
+    object has as its second and subsequent entries values that match
+    the following requirements, as determined by the type of the
+    column identified by the first entry:&lt;/p&gt;
 
-     &lt;pre&gt;&lt;datagrid&gt;
- &lt;select&gt;
-  &lt;!-- the options and optgroups have had their labels and values removed
-       to make the underlying structure clearer --&gt;
-  &lt;optgroup&gt;
-   &lt;option/&gt;
-   &lt;option/&gt;
-  &lt;/optgroup&gt;
-  &lt;optgroup&gt;
-   &lt;option/&gt;
-   &lt;optgroup id=&quot;a&quot;&gt;
-    &lt;option/&gt;
-    &lt;option/&gt;
-    &lt;bogus/&gt;
-    &lt;option id=&quot;b&quot;/&gt;
-   &lt;/optgroup&gt;
-   &lt;option/&gt;
-  &lt;/optgroup&gt;
- &lt;/select&gt;
-&lt;/datagrid&gt;&lt;/pre&gt;
+    &lt;dl&gt;
 
-     &lt;p&gt;The path &quot;1,1,2&quot; would select the element with ID &quot;b&quot;. In the
-     filtered view, the text nodes, comment nodes, and bogus elements
-     are ignored; so for instance, the element with ID &quot;a&quot; (path
-     &quot;1,1&quot;) has only 3 child nodes in the view.&lt;/p&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-text&quot;&gt;text&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-    &lt;/div&gt;
+      &lt;p&gt;The second entry's value is a string, and either there are
+      only two entries, or there are three, and the third entry is
+      an &lt;code&gt;img&lt;/code&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;&lt;code title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount(&lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt; must drill through the view to find the
-    element corresponding to the method's argument, and return the
-    number of child nodes in the filtered view that the corresponding
-    element has. (If the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is empty, the
-    corresponding element is the &lt;code&gt;select&lt;/code&gt; element at the
-    root of the filtered view.)&lt;/p&gt;
+      &lt;p&gt;If there is an &lt;code&gt;img&lt;/code&gt; element specified, its &lt;code
+      title=&quot;dom-img-complete&quot;&gt;complete&lt;/code&gt; attribute is true.&lt;/p&gt;
 
-    &lt;p&gt;&lt;code
-    title=&quot;dom-provider-getChildAtPosition&quot;&gt;getChildAtPosition(&lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;)&lt;/code&gt; must
-    return &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;. (The
-    &lt;code&gt;select&lt;/code&gt;/&lt;code&gt;datalist&lt;/code&gt; default data provider
-    does not support sorting the data grid.)&lt;/p&gt;
+     &lt;/dd&gt;
 
-    &lt;p&gt;&lt;code title=&quot;dom-provider-getRowImage&quot;&gt;getRowImage(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt; must return the empty string, &lt;code
-    title=&quot;dom-provider-getRowMenu&quot;&gt;getRowMenu(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt; must return null.&lt;/p&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-editable&quot;&gt;editable&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-    &lt;p&gt;&lt;code title=&quot;dom-provider-getRowClasses&quot;&gt;getRowClasses(&lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt; must add the
-    classes from the following list to &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;
-    when their condition is met:&lt;/p&gt;
+      &lt;p&gt;The second entry's value is a string, and either there are
+      only two entries, or the third entry is a
+      &lt;code&gt;datalist&lt;/code&gt; element, and either there are only three
+      entries, or there are four, and the fourth entry is an
+      &lt;code&gt;img&lt;/code&gt; element.&lt;/p&gt;
 
-    &lt;ul&gt;
+      &lt;p&gt;If there is an &lt;code&gt;img&lt;/code&gt; element specified, its &lt;code
+      title=&quot;dom-img-complete&quot;&gt;complete&lt;/code&gt; attribute is true.&lt;/p&gt;
 
-     &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element is an
-     &lt;code&gt;optgroup&lt;/code&gt; element: &lt;code
-     title=&quot;datagrid-row-class-header&quot;&gt;header&lt;/code&gt;&lt;/li&gt;
+     &lt;/dd&gt;
 
-     &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element
-     contains other elements that are also in the view, and the
-     element's &lt;code title=&quot;attr-class&quot;&gt;class&lt;/code&gt; attribute
-     contains the &lt;code title=&quot;&quot;&gt;closed&lt;/code&gt; class: &lt;code
-     title=&quot;datagrid-row-class-initially-closed&quot;&gt;initially-closed&lt;/code&gt;&lt;/li&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-checkable&quot;&gt;checkable&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-     &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element
-     contains other elements that are also in the view, and the
-     element's &lt;code title=&quot;attr-class&quot;&gt;class&lt;/code&gt; attribute
-     contains the &lt;code title=&quot;&quot;&gt;open&lt;/code&gt; class: &lt;code
-     title=&quot;datagrid-row-class-initially-open&quot;&gt;initially-open&lt;/code&gt;&lt;/li&gt;
+      &lt;p&gt;The second entry's value is a string, the third entry is a
+      boolean, and either there are only three entries, or the
+      fourth entry is also a boolean, and either there are only four
+      entries, or there are five, and the fifth entry is an
+      &lt;code&gt;img&lt;/code&gt; element.&lt;/p&gt;
 
-    &lt;/ul&gt;
+      &lt;p&gt;If there is an &lt;code&gt;img&lt;/code&gt; element specified, its &lt;code
+      title=&quot;dom-img-complete&quot;&gt;complete&lt;/code&gt; attribute is true.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-getCellData&quot;&gt;getCellData(&lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;cell&lt;/var&gt;)&lt;/code&gt; method must
-    return the value of the &lt;code
-    title=&quot;attr-optgroup-label&quot;&gt;label&lt;/code&gt; attribute if the &lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element is an
-    &lt;code&gt;optgroup&lt;/code&gt; element, otherwise, if the &lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;'s corresponding element is an
-    &lt;code&gt;option&lt;/code&gt;element, its &lt;code
-    title=&quot;attr-option-label&quot;&gt;label&lt;/code&gt; attribute if it has one,
-    otherwise the value of its &lt;code&gt;textContent&lt;/code&gt; DOM
-    attribute.&lt;/p&gt;
+     &lt;/dd&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses(&lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;cell&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt; method must add no classes.&lt;/p&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-list&quot;&gt;list&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-    &lt;p class=&quot;XXX&quot;&gt;&lt;!-- select-provider-selection
-    XXX--&gt;autoselect some rows when initialized, reflect the selection
-    in the select, reflect the multiple attribute somehow.&lt;/p&gt;
+      &lt;p&gt;The second entry's value is a string, the third entry is a
+      &lt;code&gt;select&lt;/code&gt; element, and either there are only three
+      entries, or there are four, and the fourth entry is an
+      &lt;code&gt;img&lt;/code&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;The data provider must call the &lt;code&gt;datagrid&lt;/code&gt;'s update
-    methods appropriately whenever the descendants of the
-    &lt;code&gt;datagrid&lt;/code&gt; mutate.&lt;/p&gt;
+      &lt;p&gt;If there is an &lt;code&gt;img&lt;/code&gt; element specified, its &lt;code
+      title=&quot;dom-img-complete&quot;&gt;complete&lt;/code&gt; attribute is true.&lt;/p&gt;
 
-   &lt;/dd&gt;
+     &lt;/dd&gt;
 
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-progress&quot;&gt;progress&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt&gt;While the first element child is another element&lt;/dt&gt;
+      &lt;p&gt;There are only two entries, the second entry's value is a
+      number, and the number's value is between 0.0 and 1.0
+      inclusive.&lt;/p&gt;
 
-   &lt;dd&gt;
+     &lt;/dd&gt;
 
-    &lt;p&gt;The default data provider must return 1 for the column count,
-    the empty string for the column's caption, and must not add any
-    classes to the column's classes.&lt;/p&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-meter&quot;&gt;meter&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-    &lt;p&gt;For the rows, assume the existence of a node filter view of the
-    descendants of the &lt;code&gt;datagrid&lt;/code&gt; that skips all nodes
-    other than &lt;code&gt;li&lt;/code&gt;, &lt;code&gt;h1&lt;/code&gt;&ndash;&lt;code&gt;h6&lt;/code&gt;, and
-    &lt;code&gt;hr&lt;/code&gt; elements, and skips any descendants of
-    &lt;code&gt;menu&lt;/code&gt; elements.&lt;/p&gt;
+      &lt;p&gt;There are at least two, but possibly up to seven, entries,
+      all entries but the first one are numbers, and the following
+      relationships hold:&lt;/p&gt;
 
-    &lt;p&gt;Given this view, each element in the view represents a row in
-    the data model. The element corresponding to a path &lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt; is the one obtained by drilling into the view,
-    taking the child given by the path each time. The element of the
-    row of a particular method call is the element given by drilling
-    into the view along the path given by the method's arguments.&lt;/p&gt;
+      &lt;ul class=&quot;brief&quot;&gt;
 
-    &lt;p&gt;&lt;code title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount(&lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt; must return the number of child
-    elements in this view for the given row, or the number of elements
-    at the root of the view if the &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is
-    empty.&lt;/p&gt;
+       &lt;li&gt;The second entry is less than the third, or less than 1.0
+       if the third is absent.&lt;/li&gt;
 
-    &lt;div class=&quot;example&quot;&gt;
+       &lt;li&gt;The second entry is greater than the fourth, or greater
+       than 0.0 if the fourth is absent.&lt;/li&gt;
 
-     &lt;p&gt;In the following example, the elements are identified by the
-     paths given by their child text nodes:&lt;/p&gt;
+       &lt;li&gt;If there are at least three entries, the third entry is
+       greater than the fourth, or greater than zero if the fourth
+       is absent.&lt;/li&gt;
 
-     &lt;pre&gt;&lt;datagrid&gt;
- &lt;ol&gt;
-  &lt;li&gt; row 0 &lt;/li&gt;
-  &lt;li&gt; row 1
-   &lt;ol&gt;
-    &lt;li&gt; row 1,0 &lt;/li&gt;
-   &lt;/ol&gt;
-  &lt;/li&gt;
-  &lt;li&gt; row 2 &lt;/li&gt;
- &lt;/ol&gt;
-&lt;/datagrid&gt;&lt;/pre&gt;
+       &lt;li&gt;If there are at least five entries, the fifth is not
+       greater than the third and not less than the fourth.&lt;/li&gt;
 
-     &lt;p&gt;In this example, only the &lt;code&gt;li&lt;/code&gt; elements actually
-     appear in the data grid; the &lt;code&gt;ol&lt;/code&gt; element does not
-     affect the data grid's processing model.&lt;/p&gt;
+       &lt;li&gt;If there are at least six entries, the sixth is not
+       greater than the third and not less than the fifth.&lt;/li&gt;
 
-    &lt;/div&gt;
+       &lt;li&gt;If there are at least seven entries, the fifth is not
+       greater than the third and not less than the fourth.&lt;/li&gt;
 
-    &lt;p&gt;&lt;code
-    title=&quot;dom-provider-getChildAtPosition&quot;&gt;getChildAtPosition(&lt;var
-    title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;)&lt;/code&gt; must
-    return &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;. (The generic default data
-    provider does not support sorting the data grid.)&lt;/p&gt;
+      &lt;/ul&gt;
 
-    &lt;p&gt;&lt;code title=&quot;dom-provider-getRowImage&quot;&gt;getRowImage(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt; must return the &lt;span&gt;absolute URL&lt;/span&gt;
-    obtained from &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the
-    value of the &lt;code title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; attribute of
-    the first &lt;code&gt;img&lt;/code&gt; element descendant (in the real DOM) of
-    the row's element, that is not also a descendant of another
-    element in the filtered view that is a descendant of the row's
-    element, if such an element exists and resolving its attribute
-    relative to the element itself, is successful. Otherwise, it must
-    return the empty string.&lt;/p&gt; &lt;!-- note that if the base URL has
-    changed, this URL can be different than the one that the &lt;img&gt;
-    element fetched when it was created --&gt;
+     &lt;/dd&gt;
 
-    &lt;div class=&quot;example&quot;&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-custom&quot;&gt;custom&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-     &lt;p&gt;In the following example, the row with path &quot;1,0&quot; returns
-     &quot;<A HREF="http://example.com/a">http://example.com/a</A>&quot; as its image URL, and the other rows
-     (including the row with path &quot;1&quot;) return the empty string:&lt;/p&gt;
+      &lt;p&gt;There are four entries, the second and third are numbers
+      that are integers greater than zero, and the fourth is a
+      &lt;code&gt;Rendering2DContextCallback&lt;/code&gt; object (a
+      function).&lt;/p&gt;
 
-     &lt;pre&gt;&lt;datagrid&gt;
- &lt;ol&gt;
-  &lt;li&gt; row 0 &lt;/li&gt;
-  &lt;li&gt; row 1
-   &lt;ol&gt;
-    &lt;li&gt; row 1,0 &lt;img src=&quot;<A HREF="http://example.com/a">http://example.com/a</A>&quot; alt=&quot;&quot;&gt; &lt;/li&gt;
-   &lt;/ol&gt;
-  &lt;/li&gt;
-  &lt;li&gt; row 2 &lt;/li&gt;
- &lt;/ol&gt;
-&lt;/datagrid&gt;&lt;/pre&gt;
+     &lt;/dd&gt;
 
-    &lt;/div&gt;
+    &lt;/dl&gt;
 
-    &lt;p&gt;&lt;code title=&quot;dom-provider-getRowMenu&quot;&gt;getRowMenu(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;)&lt;/code&gt; must return the first &lt;code&gt;menu&lt;/code&gt;
-    element descendant (in the real DOM) of the row's element, that is
-    not also a descendant of another element in the filtered view that
-    is a descendant of the row's element. (This is analogous to the
-    image case above.)&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;&lt;code title=&quot;dom-provider-getRowClasses&quot;&gt;getRowClasses(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt; must add the
-    classes from the following list to &lt;var title=&quot;&quot;&gt;classes&lt;/var&gt;
-    when their condition is met:&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Either there are only four values in the &lt;code&gt;Row&lt;/code&gt;,
+   or the fifth value in the &lt;code&gt;Row&lt;/code&gt; is a boolean.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;ul&gt;
+   &lt;li&gt;&lt;p&gt;Either there are only four or five values in the
+   &lt;code&gt;Row&lt;/code&gt;, or there are six, and the sixth value in the
+   &lt;code&gt;Row&lt;/code&gt; an integer that is greater than or equal to
+   zero.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;If the row's element contains other elements that are also in
-     the view, and the element's &lt;code title=&quot;attr-class&quot;&gt;class&lt;/code&gt;
-     attribute contains the &lt;code title=&quot;&quot;&gt;closed&lt;/code&gt; class: &lt;code
-     title=&quot;datagrid-row-class-initially-closed&quot;&gt;initially-closed&lt;/code&gt;&lt;/li&gt;
+  &lt;/ul&gt;
 
-     &lt;li&gt;If the row's element contains other elements that are also in
-     the view, and the element's &lt;code title=&quot;attr-class&quot;&gt;class&lt;/code&gt;
-     attribute contains the &lt;code title=&quot;&quot;&gt;open&lt;/code&gt; class: &lt;code
-     title=&quot;datagrid-row-class-initially-open&quot;&gt;initially-open&lt;/code&gt;&lt;/li&gt;
+  &lt;p&gt;Where the above requirements say that a value is to be a string,
+  the user agent must apply the ToString() conversion operator to the
+  value, assume that the value was indeed a string, and use the result
+  in the rest of the algorithm as if it had that had been the value
+  passed to the method. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
 
-     &lt;li&gt;If the row's element is an &lt;code&gt;h1&lt;/code&gt;&ndash;&lt;code&gt;h6&lt;/code&gt;
-     element: &lt;code
-     title=&quot;datagrid-row-class-header&quot;&gt;header&lt;/code&gt;&lt;/li&gt;
+  &lt;p&gt;Where the above requirements say that a value is to be a number,
+  the user agent must first apply the ToNumber() conversion operator
+  to the value, and then verify that the result is neither the
+  not-a-number NaN value nor an infinite value. If this result is
+  indeed acceptable (i.e. finite), the user agent must use the result
+  in the rest of the algorithm as if it had that had been the value
+  passed to the method. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
 
-     &lt;li&gt;If the row's element is an &lt;code&gt;hr&lt;/code&gt; element: &lt;code
-     title=&quot;datagrid-row-class-separator&quot;&gt;separator&lt;/code&gt;&lt;/li&gt; &lt;!--
-     XXX no way to get selectable-separator --&gt;
+  &lt;p&gt;Where the above requirements say that a value is to be an
+  integer, the user agent must first apply the ToNumber() conversion
+  operator to the value, and then verify that the result is a finite
+  integer. If so, the user agent must use the result in the rest of
+  the algorithm as if it had that had been the value passed to the
+  method. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;/ul&gt;
+  &lt;p&gt;Where the above requirements say that a value is to be a boolean,
+  the user agent must apply the ToBoolean() conversion operator to the
+  value, assume that the value was indeed a boolean, and use the
+  result in the rest of the algorithm as if it had that had been the
+  value passed to the method. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-getCellData&quot;&gt;getCellData(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;)&lt;/code&gt;, &lt;code
-    title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;classes&lt;/var&gt;)&lt;/code&gt;, &lt;code
-    title=&quot;dom-provider-setCellCheckedState&quot;&gt;getCellCheckedState(&lt;var
-    title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;state&lt;/var&gt;)&lt;/code&gt;, &lt;code
-    title=&quot;dom-provider-cycleCell&quot;&gt;cycleCell(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;,
-    &lt;var title=&quot;&quot;&gt;j&lt;/var&gt;)&lt;/code&gt;, and &lt;code
-    title=&quot;dom-provider-editCell&quot;&gt;editCell(&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;j&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/code&gt; methods must
-    act as described in &lt;a
-    href=&quot;#commonDefaultDataGridMethodDefinitions&quot;&gt;the common
-    definitions below&lt;/a&gt;, treating the row's element as being the
-    cell's element.&lt;/p&gt;
+  &lt;hr&gt;
 
-    &lt;p class=&quot;XXX&quot; id=&quot;generic-provider-selection&quot;&gt;selection
-    handling?&lt;/p&gt;
+  &lt;p&gt;When an algorithm requires the user agent to &lt;dfn&gt;audit the
+  &lt;code&gt;datagrid&lt;/code&gt;&lt;/dfn&gt;, the &lt;code&gt;datagrid&lt;/code&gt; must be
+  checked against the following requirements. If any are false, then
+  the audit fails, otherwise it passes.&lt;/p&gt;
 
-    &lt;p&gt;The data provider must call the &lt;code&gt;datagrid&lt;/code&gt;'s update
-    methods appropriately whenever the descendants of the
-    &lt;code&gt;datagrid&lt;/code&gt; mutate.&lt;/p&gt;
+  &lt;ul&gt;
 
-   &lt;/dd&gt;
+   &lt;li&gt;There is no row whose natural order position is greater than or
+   equal to the child count of its parent row in the &lt;span&gt;natural
+   order sparse data tree&lt;/span&gt;.&lt;/li&gt;
 
+   &lt;li&gt;There is no row whose display order position is greater than or
+   equal to the child count of its parent row in the &lt;span&gt;display
+   order sparse data tree&lt;/span&gt;.&lt;/li&gt;
 
-   &lt;dt&gt;Otherwise, while there is no element child&lt;/dt&gt;
+   &lt;li&gt;There is no row such that the sum of that row's child count and
+   the row counts all the open rows that are direct children of that
+   row in the &lt;span&gt;natural order sparse data tree&lt;/span&gt; is less than
+   that row's row count.&lt;/li&gt;
 
-   &lt;dd&gt;
+   &lt;li&gt;Of the rows whose child count is equal to the number of rows
+   that are direct children of that row in the &lt;span&gt;natural order
+   sparse data tree&lt;/span&gt;, there is none such that the sum of that
+   row's child count and the row counts of all the open rows that are
+   direct children of that row in the &lt;span&gt;natural order sparse data
+   tree&lt;/span&gt; is greater than that row's row count.&lt;/li&gt;
 
-    &lt;p&gt;The data provider must return 0 for the number of rows, 1 for
-    the number of columns, the empty string for the first column's
-    caption, and must add no classes when asked for that column's
-    classes. If the &lt;code&gt;datagrid&lt;/code&gt;'s child list changes such
-    that there is a first element child, then the data provider must
-    call the &lt;code
-    title=&quot;dom-datagrid-updateEverything&quot;&gt;updateEverything()&lt;/code&gt;
-    method on the &lt;code&gt;datagrid&lt;/code&gt;.&lt;/p&gt;
+  &lt;/ul&gt;
 
-   &lt;/dd&gt;
+  &lt;p&gt;For the purposes of this audit, the &lt;code&gt;datagrid&lt;/code&gt; must be
+  treated as the parent row of all the rows that are direct children
+  of the &lt;code&gt;datagrid&lt;/code&gt; in the &lt;span&gt;natural order sparse data
+  tree&lt;/span&gt; and the &lt;span&gt;display order sparse data tree&lt;/span&gt;. The
+  child count of this implied row is the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt;
+  child count&lt;/span&gt;, and the row count of this implied row is the
+  &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;/dl&gt;
+  &lt;hr&gt;
 
-  &lt;h6 id=&quot;commonDefaultDataGridMethodDefinitions&quot;&gt;Common default data
-  provider method definitions for cells&lt;/h6&gt;
+  &lt;p&gt;When an algorithm requires the user agent to &lt;dfn&gt;partially sort
+  a &lt;code&gt;RowList&lt;/code&gt; object&lt;/dfn&gt; (an array), the entries in the
+  object must be resorted such that &lt;code&gt;Row&lt;/code&gt; objects are
+  listed after any of their ancestors and after any of their earlier
+  siblings. In other words, for any two &lt;code&gt;Row&lt;/code&gt; objects &lt;var
+  title=&quot;&quot;&gt;a&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;b&lt;/var&gt; in the
+  &lt;code&gt;RowList&lt;/code&gt;, where &lt;var title=&quot;&quot;&gt;a&lt;/var&gt; is before &lt;var
+  title=&quot;&quot;&gt;b&lt;/var&gt; after the sort, the following conditions must
+  hold:&lt;/p&gt;
 
-  &lt;p&gt;These definitions are used for the cell-specific methods of the
-  default data providers (other than in the
-  &lt;code&gt;select&lt;/code&gt;/&lt;code&gt;datalist&lt;/code&gt; case).  How they behave is
-  based on the contents of an element that represents the cell given
-  by their first two arguments. Which element that is is defined in
-  the previous section.&lt;/p&gt;
+  &lt;ul&gt;
 
+   &lt;li&gt;&lt;p&gt;If their &lt;code&gt;RowID&lt;/code&gt; objects are the same length and
+   have values that are equal except for the last value, then the last
+   value of &lt;var title=&quot;&quot;&gt;a&lt;/var&gt;'s &lt;code&gt;RowID&lt;/code&gt;'s last value
+   must be less than &lt;var title=&quot;&quot;&gt;b&lt;/var&gt;'s &lt;code&gt;RowID&lt;/code&gt;'s last
+   value (i.e. earlier siblings must come before their later
+   siblings).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If their &lt;code&gt;RowID&lt;/code&gt; objects are not the same length,
+   but the values in the shorter of the two are the same as the first
+   few values in the longer one, then &lt;var title=&quot;&quot;&gt;a&lt;/var&gt;'s
+   &lt;code&gt;RowID&lt;/code&gt; must be the shorter one (i.e. ancestors must
+   come before their descendants).&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-datagrid-deleteRows&quot;&gt;&lt;code&gt;deleteRows(&lt;var
+  title=&quot;&quot;&gt;rows&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If any of the entries in &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; are not
+    &lt;code&gt;RowID&lt;/code&gt; objects consisting of one or more entries whose
+    values are all integers that are greater than or equal to zero,
+    then throw a &lt;code&gt;TypeError&lt;/code&gt; exception and abort these
+    steps.&lt;/p&gt;
+
+    &lt;p&gt;To check if a value is an integer, the user agent must first
+    apply the ToNumber() conversion operator to the value, and then
+    verify that the result is a finite integer. If so, the user agent
+    must use the result in the rest of the algorithm as if it had that
+    had been the value passed to the method. &lt;a
+    href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If any of the &lt;code&gt;RowID&lt;/code&gt; objects in the &lt;var
+    title=&quot;&quot;&gt;rows&lt;/var&gt; argument identify a row that isn't present in
+    the &lt;span&gt;natural order sparse data tree&lt;/span&gt;, then throw a
+    &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If any row is listed twice in the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;
+    argument, then throw a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception
+    and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Sort the &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument such that the
+    entries are given in the same order as the rows they identify
+    would be visited in a pre-order, depth first traversal of the
+    &lt;span&gt;natural order sparse data tree&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each row identified by entries in &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;,
+    &lt;em&gt;in reverse order&lt;/em&gt;, run the following steps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Decrement the child count of the row's parent row, if that
+      child count is greater than zero. If the row has no parent,
+      decrement the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; child
+      count&lt;/span&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If the row has a parent row, and its child count is now zero,
+      then close that row.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be one more than the row's row
+      count if the row is open and its row count is greater than zero;
+      otherwise, let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be one.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt; be the row.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;&lt;i&gt;Row count loop:&lt;/i&gt; Let &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt; be
+      &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt;'s parent row, if any, or null if it
+      has none.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt; is null, then decrement the
+      &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/span&gt; by &lt;var
+      title=&quot;&quot;&gt;delta&lt;/var&gt;. Otherwise, if &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt;
+      is open, then decrement its row count by &lt;var
+      title=&quot;&quot;&gt;delta&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;ancestor&lt;/var&gt; is not null, then jump back
+      to the step labeled &lt;i&gt;row count loop&lt;/i&gt; above.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; be the row's parent, or the
+      &lt;code&gt;datagrid&lt;/code&gt; if the row has no parent.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Decrement by one the natural order position of all rows whose
+      parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; and whose natural order
+      position is equal to or greater than the row's own natural order
+      position.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the row is in the &lt;span&gt;display order sparse data
+      tree&lt;/span&gt;, then decrement by one the display order position of
+      all rows whose parent is &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; and whose
+      display order position is equal to or greater than the row's own
+      display order position.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Clear the row and its descendants from the
+      &lt;code&gt;Datagrid&lt;/code&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Invoke the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+    algorithm&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-datagrid-clearRows&quot;&gt;&lt;code&gt;clearRows()&lt;/code&gt;&lt;/dfn&gt; method
+  must empty the &lt;span&gt;natural order sparse data tree&lt;/span&gt;, reset
+  both the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; child count&lt;/span&gt; and the
+  &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/span&gt; to zero, and invoke the
+  &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; update display algorithm&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-datagrid-repaint&quot;&gt;&lt;code&gt;repaint(&lt;var
+  title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
+  must cause the user agent to clear its cache for the cell specified
+  by the identifier &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; and the column &lt;var
+  title=&quot;&quot;&gt;column&lt;/var&gt;, if that column's type is &lt;code
+  title=&quot;datagrid-type-custom&quot;&gt;custom&lt;/code&gt;. If the given column has
+  not been declared, or its type is not &lt;code
+  title=&quot;datagrid-type-custom&quot;&gt;custom&lt;/code&gt;, then the user agent must
+  throw a &lt;code&gt;DATAGRID_MODEL_ERR&lt;/code&gt; exception. If the given row
+  is not known, then the method must do nothing. If the cell is indeed
+  cleared, the user agent must reinvoke the previously registered
+  &lt;code&gt;RenderingContext2DCallback&lt;/code&gt; callback when it needs to
+  repaint that row.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;If a row has a child count that isn't zero, then the user agent
+  should offer to the user the option of opening and closing the
+  row.&lt;/p&gt;
+
+  &lt;p&gt;When a row is opened, if the row's row count is greater than
+  zero, then the user agent must increase the
+  &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/span&gt; and the row counts of
+  any ancestor rows by the number of rows that the newly opened row
+  has in its row count&lt;!-- we should also &quot;update the &lt;span&gt;pending
+  &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/span&gt; and the &lt;span&gt;pending
+  &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/span&gt; accordingly&quot; --&gt;, then must
+  mark the row as open, then may fill in the &lt;span&gt;display order
+  sparse data tree&lt;/span&gt; with any information that the user agent has
+  cached about the display order positions of descendants of the newly
+  opened row, and then must invoke the &lt;code
+  title=&quot;dom-listener-rowOpened&quot;&gt;rowOpened()&lt;/code&gt; method on the
+  current &lt;code title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt; with as
+  its first argument a &lt;code&gt;RowID&lt;/code&gt; object identifying the row
+  that was opened and as its second argument the boolean false, and
+  then must invoke the &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; update display
+  algorithm&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;On the other hand, when a row is opened and the row's row count
+  is &amp;#x2212;1, then the user agent must mark the row as opening, and
+  then must invoke the &lt;code
+  title=&quot;dom-listener-rowOpened&quot;&gt;rowOpened()&lt;/code&gt; method on the
+  current &lt;code title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt; with as
+  its first argument a &lt;code&gt;RowID&lt;/code&gt; object identifying the row
+  that was opened and as its second argument the boolean true.&lt;/p&gt;
+
+  &lt;p&gt;When a row is closed, the user agent must decrease the
+  &lt;span&gt;&lt;code&gt;datagrid&lt;/code&gt; row count&lt;/span&gt; and the row counts of
+  any ancestor rows by the number of rows that the newly closed row
+  has in its row count, and then must invoke the &lt;code
+  title=&quot;dom-listener-rowOpened&quot;&gt;rowOpened()&lt;/code&gt; method on the
+  current &lt;code title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt; with as
+  its first and only argument a &lt;code&gt;RowID&lt;/code&gt; object identifying
+  the row that was opened.&lt;/p&gt;
+
+
+
+  &lt;h6&gt;The cells&lt;/h6&gt;
+
+  &lt;p&gt;Each row has one cell per column. Each cell has the same type as
+  its column. The &lt;dfn&gt;allowed &lt;code&gt;datagrid&lt;/code&gt; column
+  types&lt;/dfn&gt;, what they represent, and the requirements for when the
+  user interacts with them, are as follows:&lt;/p&gt;
+
   &lt;dl&gt;
 
-   &lt;dt&gt;Cyclable cells&lt;/dt&gt;
+   &lt;dt&gt;&lt;dfn title=&quot;datagrid-type-text&quot;&gt;&lt;code&gt;text&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dd&gt;
 
+    &lt;p&gt;The cell represents some text and an optional image.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;datagrid-type-editable&quot;&gt;&lt;code&gt;editable&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the first element child of a cell's element is a
-    &lt;code&gt;select&lt;/code&gt; element that has a no &lt;code
-    title=&quot;attr-select-multiple&quot;&gt;multiple&lt;/code&gt; attribute and has at
-    least one &lt;code&gt;option&lt;/code&gt; element descendant, then the cell
-    acts as a cyclable cell.&lt;/p&gt;
+    &lt;p&gt;The cells represents some editable text, an optional
+    &lt;code&gt;datalist&lt;/code&gt; giving autocompletion hints, and an
+    optional image.&lt;/p&gt;
 
-    &lt;p&gt;The &quot;current&quot; &lt;code&gt;option&lt;/code&gt; element is the selected
-    &lt;code&gt;option&lt;/code&gt; element, or the first &lt;code&gt;option&lt;/code&gt;
-    element if none is selected.&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;code&gt;datalist&lt;/code&gt; element, the user agent
+    should offer the suggestions represented by that element to the
+    user. The user agent may use the suggestion's &lt;span
+    title=&quot;concept-option-label&quot;&gt;label&lt;/span&gt; to identify the
+    suggestion. If the user selects a suggestion, then the editable
+    text must be set to the selected suggestion's &lt;span
+    title=&quot;concept-option-value&quot;&gt;value&lt;/span&gt;, as if the user had
+    written that value himself.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-getCellData&quot;&gt;getCellData()&lt;/code&gt;
-    method must return the &lt;code&gt;textContent&lt;/code&gt; of the current
-    &lt;code&gt;option&lt;/code&gt; element (the &lt;code
-    title=&quot;attr-option-label&quot;&gt;label&lt;/code&gt; attribute is &lt;span
-    title=&quot;ignore&quot;&gt;ignored&lt;/span&gt; in this context as the
-    &lt;code&gt;optgroup&lt;/code&gt;s are not displayed).&lt;/p&gt;
+    &lt;p&gt;When the user edits the value, either directly or using the
+    &lt;code&gt;datalist&lt;/code&gt;, the user agent must invoke the &lt;code
+    title=&quot;dom-listener-cellChanged&quot;&gt;cellChanged()&lt;/code&gt; method on
+    the current &lt;code title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt;
+    with as its first argument a &lt;code&gt;RowID&lt;/code&gt; identifying the
+    cell's row, as its second argument the identifier of the cell's
+    column, as its third argument the new value, and as its fourth
+    argument the previous value.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses()&lt;/code&gt; method
-    must add the &lt;code
-    title=&quot;datagrid-cell-class-cyclable&quot;&gt;cyclable&lt;/code&gt; class and
-    then all the classes of the current &lt;code&gt;option&lt;/code&gt;
-    element.&lt;/p&gt;
+   &lt;/dd&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-cycleCell&quot;&gt;cycleCell()&lt;/code&gt;
-    method must change the selection of the &lt;code&gt;select&lt;/code&gt;
-    element such that the next &lt;code&gt;option&lt;/code&gt; element after the
-    current &lt;code&gt;option&lt;/code&gt; element is the only one that is
-    selected (in &lt;span&gt;tree order&lt;/span&gt;). If the current &lt;code&gt;option&lt;/code&gt;
-    element is the last &lt;code&gt;option&lt;/code&gt; element descendant of the
-    &lt;code&gt;select&lt;/code&gt;, then the first &lt;code&gt;option&lt;/code&gt; element
-    descendant must be selected instead.&lt;/p&gt;
+   &lt;dt&gt;&lt;dfn title=&quot;datagrid-type-checkable&quot;&gt;&lt;code&gt;checkable&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dd&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-setCellCheckedState&quot;&gt;setCellCheckedState()&lt;/code&gt;
-    and &lt;code title=&quot;dom-provider-editCell&quot;&gt;editCell()&lt;/code&gt; methods
-    must do nothing.&lt;/p&gt;
+    &lt;p&gt;The cell represents some text, a check box that optionally has
+    its value obscured as indeterminate, and an optional image.&lt;/p&gt;
 
+    &lt;p&gt;When the user checks or unchecks the check box, the user agent
+    must change the check box's state appropriately and stop obscuring
+    the check box as indeterminate (if it is obscuring it), and then
+    must invoke the &lt;code
+    title=&quot;dom-listener-cellChanged&quot;&gt;cellChanged()&lt;/code&gt; method on
+    the current &lt;code title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt;
+    with as its first argument a &lt;code&gt;RowID&lt;/code&gt; identifying the
+    cell's row, as its second argument the identifier of the cell's
+    column, as its third argument true if the check box is now checked
+    and false otherwise, and as its fourth argument true if the check
+    box was previously checked and false otherwise.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;Progress bar cells&lt;/dt&gt;
-
+   &lt;dt&gt;&lt;dfn title=&quot;datagrid-type-list&quot;&gt;&lt;code&gt;list&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the first element child of a cell's element is a
-    &lt;code&gt;progress&lt;/code&gt; element, then the cell acts as a progress
-    bar cell.&lt;/p&gt;
+    &lt;p&gt;The cell represents some text giving the current value selected
+    from a dropdown list of options, a &lt;code&gt;select&lt;/code&gt; element
+    giving the list of options, and an optional image.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-getCellData&quot;&gt;getCellData()&lt;/code&gt;
-    method must return the value returned by the &lt;code&gt;progress&lt;/code&gt;
-    element's &lt;code title=&quot;dom-progress-position&quot;&gt;position&lt;/code&gt; DOM
-    attribute.&lt;/p&gt;
+    &lt;p&gt;The user agent should allow the user to change the value of the
+    cell from its current value to one of the &lt;span
+    title=&quot;concept-option-value&quot;&gt;values&lt;/span&gt; given by
+    &lt;code&gt;option&lt;/code&gt; elements in the &lt;span
+    title=&quot;concept-select-option-list&quot;&gt;list of options&lt;/span&gt; (if
+    any). The user agent may use the &lt;code&gt;option&lt;/code&gt; elements'
+    &lt;span title=&quot;concept-option-label&quot;&gt;labels&lt;/span&gt; to annotate each
+    option.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses()&lt;/code&gt; method
-    must add the &lt;code
-    title=&quot;datagrid-cell-class-progress&quot;&gt;progress&lt;/code&gt; class.&lt;/p&gt;
+    &lt;p&gt;When the user selects a new value from the &lt;code&gt;select&lt;/code&gt;
+    element's &lt;span title=&quot;concept-select-option-list&quot;&gt;list of
+    options&lt;/span&gt;, the user agent must invoke the &lt;code
+    title=&quot;dom-listener-cellChanged&quot;&gt;cellChanged()&lt;/code&gt; method on
+    the current &lt;code title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt;
+    with as its first argument a &lt;code&gt;RowID&lt;/code&gt; identifying the
+    cell's row, as its second argument the identifier of the cell's
+    column, as its third argument the new value, and as its fourth
+    argument the previous value.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-setCellCheckedState&quot;&gt;setCellCheckedState()&lt;/code&gt;,
-    &lt;code title=&quot;dom-provider-cycleCell&quot;&gt;cycleCell()&lt;/code&gt;, and
-    &lt;code title=&quot;dom-provider-editCell&quot;&gt;editCell()&lt;/code&gt; methods must
-    do nothing.&lt;/p&gt;
+   &lt;/dd&gt;
 
+   &lt;dt&gt;&lt;dfn title=&quot;datagrid-type-progress&quot;&gt;&lt;code&gt;progress&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;The cell represents a (determinate) progress bar whose value is
+    between 0.0, indicating no progress, and 1.0, indicating the task
+    is complete.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;Checkbox cells&lt;/dt&gt;
-
+   &lt;dt&gt;&lt;dfn title=&quot;datagrid-type-meter&quot;&gt;&lt;code&gt;meter&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the first element child of a cell's element is an
-    &lt;code&gt;input&lt;/code&gt; element that has a &lt;code
-    title=&quot;attr-input-type&quot;&gt;type&lt;/code&gt; attribute with the value &lt;code
-    title=&quot;&quot;&gt;checkbox&lt;/code&gt;, then the cell acts as a check box
-    cell.&lt;/p&gt;
+    &lt;p&gt;The cell represents a gauge, described by one to six
+    numbers.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-getCellData&quot;&gt;getCellData()&lt;/code&gt;
-    method must return the &lt;code&gt;textContent&lt;/code&gt; of the cell
-    element.&lt;/p&gt;
+    &lt;p&gt;The gauge's actual value is given by the first number.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses()&lt;/code&gt; method
-    must add the &lt;code
-    title=&quot;datagrid-cell-class-checked&quot;&gt;checked&lt;/code&gt; class if the
-    &lt;code&gt;input&lt;/code&gt; element's &lt;span
-    title=&quot;concept-fe-checked&quot;&gt;checkedness&lt;/span&gt; is true, and the
-    &lt;code title=&quot;datagrid-cell-class-unchecked&quot;&gt;unchecked&lt;/code&gt; class
-    otherwise.&lt;/p&gt;
+    &lt;p&gt;If there is a second number, then that number is the maximum
+    value. Otherwise, the maximum value is 1.0.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-setCellCheckedState&quot;&gt;setCellCheckedState()&lt;/code&gt;
-    method must set the &lt;code&gt;input&lt;/code&gt; element's checkbox &lt;span
-    title=&quot;concept-fe-checked&quot;&gt;checkedness&lt;/span&gt; to true if the
-    method's third argument is 1, and to false otherwise.&lt;/p&gt;
+    &lt;p&gt;If there is a third number, then that number is the minimum
+    value. Otherwise, the minimum value is 1.0.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-cycleCell&quot;&gt;cycleCell()&lt;/code&gt; and
-    &lt;code title=&quot;dom-provider-editCell&quot;&gt;editCell()&lt;/code&gt; methods must
-    do nothing.&lt;/p&gt;
+    &lt;p&gt;If there is a fourth number, then that number is the low
+    boundary. Otherwise, the low boundary is the minimum value.&lt;/p&gt;
 
+    &lt;p&gt;If there is a fifth number, then that number is the high
+    boundary. Otherwise, the high boundary is the maximum value.&lt;/p&gt;
+
+    &lt;p&gt;If there is a sixth number, then the optimal point is the sixth
+    number. Otherwise, the optimum point is the midpoint between the
+    minimum value and the maximum value.&lt;/p&gt;
+
+    &lt;!-- next two paragraphs copied from &lt;meter&gt;: --&gt;
+
+    &lt;p&gt;If the optimum point is equal to the low boundary or the high
+    boundary, or anywhere in between them, then the region between the
+    low and high boundaries of the gauge must be treated as the
+    optimum region, and the low and high parts, if any, must be
+    treated as suboptimal. Otherwise, if the optimum point is less
+    than the low boundary, then the region between the minimum value
+    and the low boundary must be treated as the optimum region, the
+    region between the low boundary and the high boundary must be
+    treated as a suboptimal region, and the region between the high
+    boundary and the maximum value must be treated as an even less
+    good region. Finally, if the optimum point is higher than the high
+    boundary, then the situation is reversed; the region between the
+    high boundary and the maximum value must be treated as the optimum
+    region, the region between the high boundary and the low boundary
+    must be treated as a suboptimal region, and the remaining region
+    between the low boundary and the minimum value must be treated as
+    an even less good region.&lt;/p&gt;
+
+    &lt;p&gt;User agents should indicate the relative position of the actual
+    actual to the minimum and maximum values, and the relationship
+    between the actual value and the three regions of the gauge.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;Editable cells&lt;/dt&gt;
-
+   &lt;dt&gt;&lt;dfn title=&quot;datagrid-type-custom&quot;&gt;&lt;code&gt;custom&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the first element child of a cell's element is an
-    &lt;code&gt;input&lt;/code&gt; element that has a &lt;code
-    title=&quot;attr-input-type&quot;&gt;type&lt;/code&gt; attribute with the value &lt;code
-    title=&quot;&quot;&gt;text&lt;/code&gt; or that has no &lt;code
-    title=&quot;attr-input-type&quot;&gt;type&lt;/code&gt; attribute at all, then the
-    cell acts as an editable cell.&lt;/p&gt;
+    &lt;p&gt;The cell represents a dynamically generated graphical image.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-getCellData&quot;&gt;getCellData()&lt;/code&gt;
-    method must return the &lt;code title=&quot;dom-input-value&quot;&gt;value&lt;/code&gt;
-    of the &lt;code&gt;input&lt;/code&gt; element.&lt;/p&gt;
+    &lt;p&gt;The cell will have minimum dimensions (specified in CSS
+    pixels), and a callback (in the form of a
+    &lt;code&gt;RenderingContext2DCallback&lt;/code&gt; object) to get a rendering
+    for the cell.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses()&lt;/code&gt; method
-    must add the &lt;code
-    title=&quot;datagrid-cell-class-editable&quot;&gt;editable&lt;/code&gt; class.&lt;/p&gt;
+    &lt;p&gt;The user agent should not allow the cell to be rendered with
+    dimensions less than the given minimum width and height.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code title=&quot;dom-provider-editCell&quot;&gt;editCell()&lt;/code&gt;
-    method must set the &lt;code&gt;input&lt;/code&gt; element's &lt;code
-    title=&quot;dom-input-value&quot;&gt;value&lt;/code&gt; DOM attribute to the value of
-    the third argument to the method.&lt;/p&gt;
+    &lt;p&gt;When the user agent needs to render the cell, the user agent
+    must &lt;span&gt;queue a task&lt;/span&gt; to invoke the
+    &lt;span&gt;RenderingContext2DCallback&lt;/span&gt; callback, passing it a
+    newly created &lt;code&gt;CanvasRenderingContext2D&lt;/code&gt; object whose
+    &lt;code title=&quot;dom-context-2d-canvas&quot;&gt;canvas&lt;/code&gt; DOM attribute is
+    null as the first argument, the actual cell width in CSS pixels as
+    the second argument, and the actual cell height in CSS pixels as
+    the third argument.&lt;/p&gt;
 
-    &lt;p&gt;The &lt;code
-    title=&quot;dom-provider-setCellCheckedState&quot;&gt;setCellCheckedState()&lt;/code&gt;
-    and &lt;code title=&quot;dom-provider-cycleCell&quot;&gt;cycleCell()&lt;/code&gt;
-    methods must do nothing.&lt;/p&gt;
+    &lt;p&gt;If the user agent is able to render graphics, then it must
+    render the graphics commands that the callback executed on the
+    provided &lt;code&gt;CanvasRenderingContext2D&lt;/code&gt; object onto the
+    cell once the callback returns. The image must be clipped to the
+    dimensions of the cell. The coordinate space of the cell must be
+    aligned with that used by the 2D context such that the top left
+    corner of the cell is the 0,0 origin, with the coordinate space
+    increasing its &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; dimension towards the right
+    of the cell and its &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; axis towards the bottom
+    of the cell, and with the image not scaled (so that one CSS pixel
+    on the final rendering matches one CSS pixel in the coordinate
+    space usd by the 2D context).&lt;/p&gt;
 
+    &lt;p&gt;The user agent must then decouple the
+    &lt;code&gt;CanvasRenderingContext2D&lt;/code&gt; object and any objects that
+    it created (such as &lt;code&gt;CanvasPattern&lt;/code&gt; objects or
+    &lt;code&gt;ImageData&lt;/code&gt; objects) from any real drawing surface.&lt;/p&gt;
+
+    &lt;p&gt;If the user agent is unable to render graphics, then it must
+    render the text string returned by the callback instead.&lt;/p&gt;
+
    &lt;/dd&gt;
 
   &lt;/dl&gt;
 
-  &lt;!-- XXX Calculated cells, like in spreadsheets? --&gt;
+  &lt;hr&gt;
 
+  &lt;p&gt;When an algorithm requires the user agent to &lt;dfn&gt;apply a
+  &lt;code&gt;Row&lt;/code&gt; object&lt;/dfn&gt;, the user agent must run the following
+  steps:&lt;/p&gt;
 
-  &lt;h5&gt;Populating the &lt;code&gt;datagrid&lt;/code&gt; element&lt;/h5&gt;
+  &lt;ol&gt;
 
-  &lt;p&gt;A &lt;code&gt;datagrid&lt;/code&gt; must be disabled until its end tag has
-  been parsed&lt;!-- XXX do we define that? what if the end tag is never
-  seen, but the element is popped off the stack?--&gt; (in the case of a
-  &lt;code&gt;datagrid&lt;/code&gt; element in the original document markup) or
-  until it has been &lt;span title=&quot;insert an element into a
-  document&quot;&gt;inserted into the document&lt;/span&gt; (in the case of a
-  dynamically created element). After that point, the element must
-  fire a single &lt;code title=&quot;event-load&quot;&gt;load&lt;/code&gt; event at itself,
-  which doesn't bubble and cannot be canceled.&lt;/p&gt;
+   &lt;li&gt;
 
-  &lt;p class=&quot;XXX&quot;&gt;The end-tag parsing thing should be moved to
-  the parsing section.&lt;/p&gt;
+    &lt;p&gt;If the value of the &lt;code&gt;Row&lt;/code&gt; object's second entry is
+    not &amp;#x2212;1, then run these substeps:&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;datagrid&lt;/code&gt; must then populate itself using the
-  data provided by the data provider assigned to the &lt;code
-  title=&quot;dom-datagrid-data&quot;&gt;data&lt;/code&gt; DOM attribute. After the view
-  is populated (using the methods described below), the
-  &lt;code&gt;datagrid&lt;/code&gt; must invoke the &lt;code
-  title=&quot;dom-provider-initialize&quot;&gt;initialize()&lt;/code&gt; method on the
-  data provider specified by the &lt;code
-  title=&quot;dom-datagrid-data&quot;&gt;data&lt;/code&gt; attribute, passing itself (the
-  &lt;code&gt;HTMLDataGridElement&lt;/code&gt; object) as the only argument.&lt;/p&gt;
+    &lt;ol&gt;
 
-  &lt;p&gt;When the &lt;code title=&quot;dom-datagrid-data&quot;&gt;data&lt;/code&gt; attribute is
-  null, the &lt;code&gt;datagrid&lt;/code&gt; must use the default data provider
-  described in the previous section.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;If there is a row with the same parent as the row
+     specified by the &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt;
+     object, whose display order position is currently the same as the
+     value of the &lt;code&gt;Row&lt;/code&gt; object's second entry, then remove
+     that row from the &lt;span&gt;display order sparse data
+     tree&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;To obtain data from the data provider, the element must invoke
-  methods on the data provider object in the following ways:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;Set the display order position of the row specified by the
+     &lt;code&gt;Row&lt;/code&gt; object's &lt;code&gt;RowID&lt;/code&gt; to the value of the
+     &lt;code&gt;Row&lt;/code&gt; object's second entry, updating its position in
+     the &lt;span&gt;display order sparse data tree&lt;/span&gt;
+     accordingly.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;dl&gt;
+     &lt;li&gt;&lt;p&gt;If the row is in the the &lt;span&gt;pending
+     &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/span&gt;, remove it.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dt&gt;To determine the total number of columns&lt;/dt&gt;
+    &lt;/ol&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getColumnCount&quot;&gt;getColumnCount()&lt;/code&gt; method
-   with no arguments. The return value is the number of columns. If
-   the return value is zero or negative, not an integer, or simply not
-   a numeric type, or if the method is not defined, then 1 must be
-   used instead.&lt;/dd&gt;
+   &lt;/li&gt;
 
-   &lt;dt&gt;To get the captions to use for the columns&lt;/dt&gt;
+   &lt;li&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getCaptionText&quot;&gt;getCaptionText()&lt;/code&gt; method
-   with the index of the column in question. The index &lt;var
-   title=&quot;&quot;&gt;i&lt;/var&gt; must be in the range 0 &le; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;
-   &lt; &lt;var title=&quot;&quot;&gt;N&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;N&lt;/var&gt; is the
-   total number of columns. The return value is the string to use when
-   referring to that column. If the method returns null or the empty
-   string, the column has no caption. If the method is not defined,
-   then none of the columns have any captions.&lt;/dd&gt;
+    &lt;p&gt;If the fourth entry in the &lt;code&gt;Row&lt;/code&gt; object (a
+    &lt;code&gt;CellList&lt;/code&gt; object, an array) is not empty, then for
+    each &lt;code&gt;Cell&lt;/code&gt; object in that array update the cell that
+    corresponds to the column identified by the value of the first
+    entry of the &lt;code&gt;Cell&lt;/code&gt; object, by using the appropriate
+    set of steps given below as determined by the type of the
+    column. Then, if the cell is in the the &lt;span&gt;pending
+    &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/span&gt;, remove it.&lt;/p&gt;
 
-   &lt;dt&gt;To establish what classes apply to a column&lt;/dt&gt;
+    &lt;dl&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getCaptionClasses&quot;&gt;getCaptionClasses()&lt;/code&gt;
-   method with the index of the column in question, and an object
-   implementing the &lt;code&gt;DOMTokenList&lt;/code&gt; interface, associated
-   with an anonymous empty string. The index &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;
-   must be in the range 0 &le; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; &lt; &lt;var
-   title=&quot;&quot;&gt;N&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;N&lt;/var&gt; is the total number
-   of columns. The tokens contained in the string underlying
-   &lt;code&gt;DOMTokenList&lt;/code&gt; object when the method returns represent
-   the classes that apply to the given column. If the method is not
-   defined, no classes apply to the column.&lt;/dd&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-text&quot;&gt;text&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt&gt;To establish whether a column should be initially included in
-   the visible columns&lt;/dt&gt;
+      &lt;p&gt;Update the cell's text to the value given in the
+      &lt;code&gt;Cell&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-   &lt;dd&gt;Check whether the &lt;code
-   title=&quot;datagrid-column-class-initially-hidden&quot;&gt;initially-hidden&lt;/code&gt;
-   class applies to the column. If it does, then the column should not
-   be initially included; if it does not, then the column should be
-   initially included.&lt;/dd&gt;
+      &lt;p&gt;If the &lt;code&gt;Cell&lt;/code&gt; object has three entries, then copy
+      the image data from the &lt;code&gt;img&lt;/code&gt; element given in the
+      third entry, and let the cell's image be given by that image
+      data. Otherwise, update the cell to have no image.&lt;/p&gt;
 
-   &lt;dt id=&quot;columnType2&quot;&gt;To establish whether the data can be sorted
-   relative to a particular column&lt;/dt&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;Check whether the &lt;code
-   title=&quot;datagrid-column-class-sortable&quot;&gt;sortable&lt;/code&gt; class
-   applies to the column. If it does, then the user agent should offer
-   the user the option to have the data displayed sorted by that
-   column; if it does not, then the user agent must not allow the user
-   to ask for the data to be sorted by that column.&lt;/dd&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-editable&quot;&gt;editable&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt&gt;To establish if a column is a sorted column&lt;/dt&gt;
+      &lt;p&gt;Update the cell's text to the value given in the
+      &lt;code&gt;Cell&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-   &lt;dd&gt;If the user agent can handle multiple columns being marked as
-   sorted simultaneously: Check whether the &lt;code
-   title=&quot;datagrid-column-class-sorted&quot;&gt;sorted&lt;/code&gt; class applies to
-   the column. If it does, then that column is the sorted column,
-   otherwise it is not.&lt;/dd&gt;
+      &lt;p&gt;If the &lt;code&gt;Cell&lt;/code&gt; object has three entries, then let
+      the &lt;code&gt;datalist&lt;/code&gt; element given in the third entry be
+      the &lt;code&gt;datalist&lt;/code&gt; element giving autocompletion
+      hints. Otherwise, update the cell to have no
+      &lt;code&gt;datalist&lt;/code&gt; element.&lt;/p&gt;
 
-   &lt;dd&gt;If the user agent can only handle one column being marked as
-   sorted at a time: Check each column in turn, starting with the
-   first one, to see whether the &lt;code
-   title=&quot;datagrid-column-class-sorted&quot;&gt;sorted&lt;/code&gt; class applies to
-   that column. The first column that has that class, if any, is the
-   sorted column. If none of the columns have that class, there is no
-   sorted column.&lt;/dd&gt;
+      &lt;p&gt;If the &lt;code&gt;Cell&lt;/code&gt; object has four entries, then copy
+      the image data from the &lt;code&gt;img&lt;/code&gt; element given in the
+      fourth entry, and let the cell's image be given by that image
+      data. Otherwise, update the cell to have no image.&lt;/p&gt;
 
-   &lt;dt&gt;To establish the sort direction of a sorted column&lt;/dt&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;Check whether the &lt;code
-   title=&quot;datagrid-column-class-reversed&quot;&gt;reversed&lt;/code&gt; class
-   applies to the column. If it does, then the sort direction is
-   descending (down; first rows have the highest values), otherwise it
-   is ascending (up; first rows have the lowest values).&lt;/dd&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-checkable&quot;&gt;checkable&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt&gt;To determine the total number of rows&lt;/dt&gt;
+      &lt;p&gt;Update the cell's text to the value given in the
+      &lt;code&gt;Cell&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-   &lt;dd&gt;Determine the number of rows for the root of the data grid, and
-   determine the number of child rows for each open row. The total
-   number of rows is the sum of all these numbers.&lt;/dd&gt;
+      &lt;p&gt;Update the cell's checked state to match the value of the
+      third entry: checked if true, unchecked otherwise.&lt;/p&gt;
 
-   &lt;dt&gt;To determine the number of rows for the root of the data grid&lt;/dt&gt;
+      &lt;p&gt;If the &lt;code&gt;Cell&lt;/code&gt; object has four entries and the
+      fourth entry is true, then update the cell to be obscured as
+      indeterminate. Otherwise, the cell's state is not obscured.&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount()&lt;/code&gt; method with a
-   &lt;code&gt;RowSpecification&lt;/code&gt; object representing the empty path as
-   its only argument. The return value is the number of rows at the
-   top level of the data grid. If the return value of the method is
-   negative, not an integer, or simply not a numeric type, or if the
-   method is not defined, then zero must be used instead.&lt;/dd&gt;
+      &lt;p&gt;If the &lt;code&gt;Cell&lt;/code&gt; object has five entries, then copy
+      the image data from the &lt;code&gt;img&lt;/code&gt; element given in the
+      fifth entry, and let the cell's image be given by that image
+      data. Otherwise, update the cell to have no image.&lt;/p&gt;
 
-   &lt;dt&gt;To determine the number of child rows for a row&lt;/dt&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount()&lt;/code&gt; method with a
-   &lt;code&gt;RowSpecification&lt;/code&gt; object representing the path to the
-   row in question. The return value is the number of child rows for
-   the given row. If the return value of the method is negative, not
-   an integer, or simply not a numeric type, or if the method is not
-   defined, then zero must be used instead.&lt;/dd&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-list&quot;&gt;list&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-   &lt;dt&gt;To determine what order to render rows in&lt;/dt&gt;
+      &lt;p&gt;Update the cell's text to the value given in the
+      &lt;code&gt;Cell&lt;/code&gt; object's second entry, and the
+      &lt;code&gt;select&lt;/code&gt; element to be the one given in the
+      &lt;code&gt;Cell&lt;/code&gt; object's third entry&lt;/p&gt;
 
-   &lt;dd&gt;
+      &lt;p&gt;If the &lt;code&gt;Cell&lt;/code&gt; object has four entries, then copy
+      the image data from the &lt;code&gt;img&lt;/code&gt; element given in the
+      fourth entry, and let the cell's image be given by that image
+      data. Otherwise, update the cell to have no image.&lt;/p&gt;
 
-    &lt;p&gt;Invoke the &lt;code
-    title=&quot;dom-provider-getChildAtPosition&quot;&gt;getChildAtPosition()&lt;/code&gt;
-    method with a &lt;code&gt;RowSpecification&lt;/code&gt; object representing
-    the path to the parent of the rows that are being rendered as the
-    first argument, and the position that is being rendered as the
-    second argument. The return value is the index of the row to
-    render in that position.&lt;/p&gt;
+     &lt;/dd&gt;
 
-    &lt;div class=&quot;example&quot;&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-progress&quot;&gt;progress&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-     &lt;p&gt;If the rows are:&lt;/p&gt;
+      &lt;p&gt;Update the cell to be a progress bar whose progress, on the
+      scale of 0.0 (no progress) to 1.0 (task complete) is given by
+      the value in the &lt;code&gt;Cell&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-     &lt;ol&gt;
-      &lt;li&gt; Row &quot;0&quot;
-       &lt;ol&gt;
-        &lt;li&gt; Row &quot;0,0&quot;
-        &lt;li&gt; Row &quot;0,1&quot;
-       &lt;/ol&gt;
-      &lt;/li&gt;
-      &lt;li&gt; Row &quot;1&quot;
-       &lt;ol&gt;
-        &lt;li&gt; Row &quot;1,0&quot;
-        &lt;li&gt; Row &quot;1,1&quot;
-       &lt;/ol&gt;
-      &lt;/li&gt;
-     &lt;/ol&gt;
+     &lt;/dd&gt;
 
-     &lt;p&gt;...and the &lt;code
-    title=&quot;dom-provider-getChildAtPosition&quot;&gt;getChildAtPosition()&lt;/code&gt;
-    method is implemented as follows:&lt;/p&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-meter&quot;&gt;meter&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-    &lt;pre&gt;function getChildAtPosition(parent, child) {
-  // always return the reverse order
-  return getRowCount(parent)-child-1;
-}&lt;/pre&gt;
+      &lt;p&gt;Update the cell to be a gauge configured with the numbers
+      given by the second and subsequent entries of the
+      &lt;code&gt;Cell&lt;/code&gt; object.&lt;/p&gt;
 
-     &lt;p&gt;...then the rendering would actually be:&lt;/p&gt;
+     &lt;/dd&gt;
 
-     &lt;ol&gt;
-      &lt;li&gt; Row &quot;1&quot;
-       &lt;ol&gt;
-        &lt;li&gt; Row &quot;1,1&quot;
-        &lt;li&gt; Row &quot;1,0&quot;
-       &lt;/ol&gt;
-      &lt;/li&gt;
-      &lt;li&gt; Row &quot;0&quot;
-       &lt;ol&gt;
-        &lt;li&gt; Row &quot;0,1&quot;
-        &lt;li&gt; Row &quot;0,0&quot;
-       &lt;/ol&gt;
-      &lt;/li&gt;
-     &lt;/ol&gt;
+     &lt;dt&gt;If the column's type is &lt;code title=&quot;datagrid-type-custom&quot;&gt;custom&lt;/code&gt;&lt;/dt&gt;
+     &lt;dd&gt;
 
-    &lt;/div&gt;
+      &lt;p&gt;Update the cell's minimum width to be the length in CSS
+      pixels given by the &lt;code&gt;Cell&lt;/code&gt; object's second entry.&lt;/p&gt;
 
-    &lt;p&gt;If the return value of the method is negative, larger than the
-    number of rows that the &lt;code
-    title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount()&lt;/code&gt; method
-    reported for that parent, not an integer, or simply not a numeric
-    type, then the entire data grid should be disabled. Similarly, if
-    the method returns the same value for two or more different values
-    for the second argument (with the same first argument, and
-    assuming that the data grid hasn't had relevant update methods
-    invoked in the meantime), then the data grid should be
-    disabled. Instead of disabling the data grid, the user agent may
-    act as if the &lt;code
-    title=&quot;dom-provider-getChildAtPosition&quot;&gt;getChildAtPosition()&lt;/code&gt;
-    method was not defined on the data provider (thus disabling
-    sorting for that data grid, but still letting the user interact
-    with the data). If the method is not defined, then the return
-    value must be assumed to be the same as the second argument (an
-    identity transform; the data is rendered in its natural
-    order).&lt;/p&gt;
+      &lt;p&gt;Update the cell's minimum height to be the length in CSS
+      pixels given by the &lt;code&gt;Cell&lt;/code&gt; object's third entry.&lt;/p&gt;
 
-   &lt;/dd&gt;
+      &lt;p&gt;Update the cell's callback to be the
+      &lt;code&gt;RenderingContext2DCallback&lt;/code&gt; object given by the
+      &lt;code&gt;Cell&lt;/code&gt; object's fourth entry.&lt;/p&gt;
 
-   &lt;dt&gt;To establish what classes apply to a row&lt;/dt&gt;
+     &lt;/dd&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getRowClasses&quot;&gt;getRowClasses()&lt;/code&gt; method
-   with a &lt;code&gt;RowSpecification&lt;/code&gt; object representing the row in
-   question, and a &lt;code&gt;DOMTokenList&lt;/code&gt; associated with an empty
-   string. The tokens contained in the &lt;code&gt;DOMTokenList&lt;/code&gt;
-   object's underlying string when the method returns represent the
-   classes that apply to the row in question. If the method is not
-   defined, no classes apply to the row.&lt;/dd&gt;
+    &lt;/dl&gt;
 
-   &lt;dt&gt;To establish whether a row is a data row or a special row&lt;/dt&gt;
+   &lt;/li&gt;
 
-   &lt;dd&gt;Examine the classes that apply to the row. If the &lt;code
-   title=&quot;datagrid-row-class-header&quot;&gt;header&lt;/code&gt; class applies to
-   the row, then it is not a data row, it is a subheading. The data
-   from the first cell of the row is the text of the subheading, the
-   rest of the cells must be ignored. Otherwise, if the &lt;code
-   title=&quot;datagrid-row-class-separator&quot;&gt;separator&lt;/code&gt; class applies
-   to the row, then in the place of the row, a separator should be
-   shown. Otherwise, if the &lt;code
-   title=&quot;datagrid-row-class-selectable-separator&quot;&gt;selectable-separator&lt;/code&gt;
-   class applies to the row, then the row should be a data row, but
-   represented as a separator. (The difference between a &lt;code
-   title=&quot;datagrid-row-class-separator&quot;&gt;separator&lt;/code&gt; and a &lt;code
-   title=&quot;datagrid-row-class-selectable-separator&quot;&gt;selectable-separator&lt;/code&gt;
-   is that the former is not an item that can be actually selected,
-   whereas the second can be selected and thus has a context menu that
-   applies to it, and so forth.) For both kinds of separator rows, the
-   data of the rows' cells must all be ignored. If none of those three
-   classes apply then the row is a simple data row.&lt;/dd&gt;
+  &lt;/ol&gt;
 
-   &lt;dt id=&quot;rowType1&quot;&gt;To establish whether a row is openable&lt;/dt&gt;
+  &lt;hr&gt;
 
-   &lt;dd&gt;Determine the number of child rows for that row. If there are
-   one or more child rows, then the row is openable.&lt;/dd&gt;
+  &lt;p&gt;When the user agent is to run the &lt;dfn&gt;&lt;code&gt;datagrid&lt;/code&gt;
+  update display algorithm&lt;/dfn&gt;, the user agent must invoke the &lt;code
+  title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt; and &lt;code
+  title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt; methods on the
+  current &lt;code title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt; such
+  that all the current visible rows in the &lt;span&gt;display order sparse
+  data list&lt;/span&gt;, and all the cells in the currently visible columns
+  on all the currently visible rows, have been covered.&lt;/p&gt;
 
-   &lt;dt&gt;To establish whether a row should be initially open or closed&lt;/dt&gt;
+  &lt;p&gt;A row is considered covered if it is present in the &lt;span&gt;pending
+  &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/span&gt;, or if the &lt;code
+  title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt; method is invoked with
+  a range that includes the row in question.&lt;/p&gt;
 
-   &lt;dd&gt;If &lt;a href=&quot;#rowType1&quot;&gt;the row is openable&lt;/a&gt;, examine the
-   classes that apply to the row. If the &lt;code
-   title=&quot;datagrid-row-class-initially-open&quot;&gt;initially-open&lt;/code&gt;
-   class applies to the row, then it should be initially
-   open. Otherwise, if the &lt;code
-   title=&quot;datagrid-row-class-initially-closed&quot;&gt;initially-closed&lt;/code&gt;
-   class applies to the row, then it must be initially
-   closed. Otherwise, if neither class applies to the row, or if the
-   row is not openable, then the initial state of the row should be
-   based on platform conventions.&lt;/dd&gt;
+  &lt;p&gt;A cell is considered covered if it is present in the
+  &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells list&lt;/span&gt;, or if the
+  &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt; method is
+  invoked with a range that includes the row in question and a list of
+  columns that includes the cell's column, or if the &lt;code
+  title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt; method is invoked
+  with a list of rows and columns that intersects the cell in
+  question. However, the &lt;code
+  title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt; method can only be
+  used if the row is already present in the &lt;span&gt;display order sparse
+  data list&lt;/span&gt;.&lt;/p&gt;
 
-&lt;!-- XXXPA
-   &lt;dt&gt;To establish whether a row is deletable&lt;/dt&gt;
+  &lt;p&gt;The &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt; method,
+  if used, must be invoked with five arguments. The first argument
+  must be the index in the &lt;span&gt;display order sparse data list&lt;/span&gt;
+  to the first row that the the user agent is requesting, known as the
+  &lt;i&gt;anchor row&lt;/i&gt;. The second argument must be the number of
+  consecutive cells for which the user agent is requesting
+  information. The third argument must be the &lt;code&gt;RowID&lt;/code&gt; of
+  the row that is the nearest ancestor in the &lt;span&gt;display order
+  sparse data &lt;em&gt;tree&lt;/em&gt;&lt;/span&gt; of the anchor row. If this is the
+  &lt;code&gt;datagrid&lt;/code&gt;, then the &lt;code&gt;RowID&lt;/code&gt; object must be an
+  empty array. The fourth argument must be the display order position
+  of the anchor row in the &lt;span&gt;display order sparse data
+  tree&lt;/span&gt;, assuming that the row identified in the third argument
+  is indeed the anchor row's parent row. The fifth and final argument
+  must be an array of the identifiers of the columns for which the
+  user agent is requesting information, in the order they were added
+  to the &lt;code&gt;datagrid&lt;/code&gt;.&lt;/p&gt;
 
-   &lt;dd&gt;Check whether the &lt;code
-   title=&quot;datagrid-row-class-deletable&quot;&gt;deletable&lt;/code&gt; class applies
-   to the row. If it does, the row is deletable, and interactive user
-   agents should provide a way for the user to request that the row be
-   deleted. (See the &lt;code
-   title=&quot;dom-provider-performActionOnRow&quot;&gt;performActionOnRow()&lt;/code&gt;
-   method for more details.) Otherwise, the user agent should not
-   provide the user with a method for requesting that the row be
-   deleted.&lt;/dd&gt;
---&gt;
+  &lt;p&gt;As the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt; method
+  is invoked, the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; rows list&lt;/span&gt;
+  must be updated to include the rows for which information has been
+  requested, excluding rows for which information is already
+  available; and the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells
+  list&lt;/span&gt; must be updated to include the cells for which
+  information has been requested on those rows.&lt;/p&gt;
 
-   &lt;dt&gt;To obtain a &lt;span&gt;URL&lt;/span&gt; identifying an image representing a row&lt;/dt&gt;
+  &lt;p&gt;The &lt;code title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt; method,
+  if used, must be invoked with two arguments. The first argument must
+  be an array of &lt;code&gt;RowID&lt;/code&gt; objects identifying the rows for
+  which information is being requested. The second argument must be an
+  array of the identifiers of the columns for which the user agent is
+  requesting information, in the order they were added to the
+  &lt;code&gt;datagrid&lt;/code&gt;.&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getRowImage&quot;&gt;getRowImage()&lt;/code&gt; method with a
-   &lt;code&gt;RowSpecification&lt;/code&gt; object representing the row in
-   question. The return value is a &lt;span&gt;URL&lt;/span&gt;. Immediately &lt;span
-   title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; that URL, relative to the
-   &lt;code&gt;datagrid&lt;/code&gt; element, to obtain an &lt;span&gt;absolute
-   URL&lt;/span&gt; identifying the image that represents the row. If the
-   method returns the empty string, null, or if the method is not
-   defined, then the row has no associated image.&lt;/dd&gt; &lt;!-- changing
-   the base URL doesn't change the image used later --&gt;
+  &lt;p&gt;As the &lt;code title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt;
+  method is invoked, the &lt;span&gt;pending &lt;code&gt;datagrid&lt;/code&gt; cells
+  list&lt;/span&gt; must be updated to include the cells for which
+  information has been requested.&lt;/p&gt;
 
-   &lt;dt&gt;To obtain a context menu appropriate for a particular row&lt;/dt&gt;
+  &lt;p&gt;Calls to these methods should be batched so that the rows and
+  cells to be covered are handled by the fewest number of calls to
+  these methods as possible. To this end, user agents may invoke the
+  &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt; method for a set
+  of rows that includes some rows that are already in the
+  &lt;span&gt;display order sparse data list&lt;/span&gt;, and similarly may
+  invoke the &lt;code title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt;
+  method with row/column combinations that cover some cells for which
+  data is already known. Generally, however, user agents should avoid
+  invoking these methods with arguments that cause information to be
+  requested when it has already been requested or is already
+  known.&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getRowMenu&quot;&gt;getRowMenu()&lt;/code&gt; method with a
-   &lt;code&gt;RowSpecification&lt;/code&gt; object representing the row in
-   question. The return value is a reference to an object implementing
-   the &lt;code&gt;HTMLMenuElement&lt;/code&gt; interface, i.e. a
-   &lt;code&gt;menu&lt;/code&gt; element DOM node. (This element must then be
-   interpreted as described in the section on context menus to obtain
-   the actual context menu to use.&lt;!-- XXX update once menu section
-   works; with xrefs --&gt;) If the method returns something that is not
-   an &lt;code&gt;HTMLMenuElement&lt;/code&gt;, or if the method is not defined,
-   then the row has no associated context menu. User agents may
-   provide their own default context menu, and may add items to the
-   author-provided context menu. For example, such a menu could allow
-   the user to change the presentation of the &lt;code&gt;datagrid&lt;/code&gt;
-   element.&lt;/dd&gt;
+  &lt;div class=&quot;example&quot;&gt;
 
-   &lt;dt&gt;To establish the value of a particular cell&lt;/dt&gt;
+   &lt;p&gt;For example, consider a case represented by the following table,
+   where the cells marked &quot;Yes&quot; indicate that the data has already
+   been obtained, the cells marked &quot;Pending&quot; indicate that the data
+   has been previously requested but not yet obtained, and the cells
+   with just a dash indicate that no information has ever been
+   obtained, or any information that had been obtained has now been
+   discarded.&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getCellData&quot;&gt;getCellData()&lt;/code&gt; method with
-   the first argument being a &lt;code&gt;RowSpecification&lt;/code&gt; object
-   representing the row of the cell in question and the second
-   argument being the index of the cell's column. The second argument
-   must be a non-negative integer less than the total number of
-   columns. The return value is the value of the cell. If the return
-   value is null or the empty string, or if the method is not defined,
-   then the cell has no data. (For progress bar cells, the cell's
-   value must be further interpreted, as described below.)&lt;/dd&gt;
+   &lt;table&gt;
+    &lt;tr&gt; &lt;td&gt;        &lt;th&gt; Row   &lt;th&gt; Column A  &lt;th&gt; Column B
+    &lt;tr&gt; &lt;th&gt; Row 1  &lt;td&gt; -     &lt;td&gt; -         &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 2  &lt;td&gt; Yes   &lt;td&gt; Yes       &lt;td&gt; Yes
+    &lt;tr&gt; &lt;th&gt; Row 3  &lt;td&gt; Yes   &lt;td&gt; Yes       &lt;td&gt; Yes
+    &lt;tr&gt; &lt;th&gt; Row 4  &lt;td&gt; Yes   &lt;td&gt; Yes       &lt;td&gt; Yes
+    &lt;tr&gt; &lt;th&gt; Row 5  &lt;td&gt; -     &lt;td&gt; -         &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 6  &lt;td&gt; -     &lt;td&gt; -         &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 7  &lt;td&gt; Yes   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 8  &lt;td&gt; Yes   &lt;td&gt; Pending   &lt;td&gt; Pending
+   &lt;/table&gt;
 
-   &lt;dt&gt;To establish what classes apply to a cell&lt;/dt&gt;
+   &lt;p&gt;Thus, rows 2, 3, 4, 7, and 8 are already covered, as are the
+   cells from those rows except for the cell in column B of row 7.&lt;/p&gt;
 
-   &lt;dd&gt;Invoke the &lt;code
-   title=&quot;dom-provider-getCellClasses&quot;&gt;getCellClasses()&lt;/code&gt; method
-   with the first argument being a &lt;code&gt;RowSpecification&lt;/code&gt;
-   object representing the row of the cell in question, the second
-   argument being the index of the cell's column, and the third being
-   an object implementing the &lt;code&gt;DOMTokenList&lt;/code&gt; interface,
-   associated with an empty string. The second argument must be a
-   non-negative integer less than the total number of columns. The
-   tokens contained in the &lt;code&gt;DOMTokenList&lt;/code&gt; object's
-   underlying string when the method returns represent the classes
-   that apply to that cell. If the method is not defined, no classes
-   apply to the cell.&lt;/dd&gt;
+   &lt;p&gt;Now consider what happens if all of these rows become visible at
+   once. The user agent has several choices, including (but not
+   limited to) the following:&lt;/p&gt;
 
-   &lt;dt id=&quot;cellType1&quot;&gt;To establish the type of a cell&lt;/dt&gt;
+   &lt;ul&gt;
 
-   &lt;dd&gt;Examine the classes that apply to the cell. If the &lt;code
-   title=&quot;datagrid-cell-class-progress&quot;&gt;progress&lt;/code&gt; class applies
-   to the cell, it is a progress bar. Otherwise, if the &lt;code
-   title=&quot;datagrid-cell-class-cyclable&quot;&gt;cyclable&lt;/code&gt; class applies
-   to the cell, it is a cycling cell whose value can be cycled between
-   multiple states. Otherwise, none of these classes apply, and the
-   cell is a simple text cell.&lt;/dd&gt;
+    &lt;li&gt;Fire the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt;
+    method for rows 1 through 8 and columns A and B all at once.&lt;/li&gt;
 
-   &lt;dt&gt;To establish the value of a progress bar cell&lt;/dt&gt;
+    &lt;li&gt;Fire the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt;
+    method for row 1, then fire it again for rows 5 through 7.&lt;/li&gt;
 
-   &lt;dd&gt;If the value &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; of the cell is a string that
-   can be &lt;span title=&quot;rules for parsing floating point number
-   values&quot;&gt;converted to a floating-point number&lt;/span&gt; in the range
-   0.0&nbsp;&le;&nbsp;&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;&nbsp;&le;&nbsp;1.0, then
-   the progress bar has that value (0.0 means no progress, 1.0 means
-   complete). Otherwise, the progress bar is an indeterminate progress
-   bar.&lt;/dd&gt;
+    &lt;li&gt;Fire the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt;
+    method for row 1, then fire it again for rows 5 and 6, and then
+    fire the &lt;code title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt;
+    method for row 7 column B.&lt;/li&gt;
 
-   &lt;dt id=&quot;cellType2&quot;&gt;To establish how a simple text cell should be presented&lt;/dt&gt;
+   &lt;/ul&gt;
 
-   &lt;dd&gt;Check whether one of the &lt;code
-   title=&quot;datagrid-cell-class-checked&quot;&gt;checked&lt;/code&gt;, &lt;code
-   title=&quot;datagrid-cell-class-unchecked&quot;&gt;unchecked&lt;/code&gt;, or &lt;code
-   title=&quot;datagrid-cell-class-indeterminate&quot;&gt;indeterminate&lt;/code&gt;
-   classes applies to the cell. If any of these are present, then the
-   cell has a checkbox, otherwise none are present and the cell does
-   not have a checkbox. If the cell has no checkbox, check whether the
-   &lt;code title=&quot;datagrid-cell-class-editable&quot;&gt;editable&lt;/code&gt; class
-   applies to the cell. If it does, then the cell value is editable,
-   otherwise the cell value is static.&lt;/dd&gt;
+   &lt;p&gt;All three options are allowed, but the latter two are preferable
+   to the former, as they minimise the amount of redundant information
+   requested.&lt;/p&gt;
 
-   &lt;dt&gt;To establish the state of a cell's checkbox, if it has one&lt;/dt&gt;
+   &lt;p&gt;In any case, the data model now looks like this:&lt;/p&gt;
 
-   &lt;dd&gt;Check whether the &lt;code
-   title=&quot;datagrid-cell-class-checked&quot;&gt;checked&lt;/code&gt; class applies to
-   the cell. If it does, the cell is checked. Otherwise, check whether
-   the &lt;code title=&quot;datagrid-cell-class-unchecked&quot;&gt;unchecked&lt;/code&gt;
-   class applies to the cell. If it does, the cell is unchecked.
-   Otherwise, the &lt;code
-   title=&quot;datagrid-cell-class-indeterminate&quot;&gt;indeterminate&lt;/code&gt;
-   class applies to the cell and the cell's checkbox is in an
-   indeterminate state. When the &lt;code
-   title=&quot;datagrid-cell-class-indeterminate&quot;&gt;indeterminate&lt;/code&gt;
-   class applies to the cell, the checkbox is a tristate checkbox,
-   and the user can set it to the indeterminate state. Otherwise, only
-   the &lt;code title=&quot;datagrid-cell-class-checked&quot;&gt;checked&lt;/code&gt; and/or
-   &lt;code title=&quot;datagrid-cell-class-unchecked&quot;&gt;unchecked&lt;/code&gt;
-   classes apply to the cell, and the cell can only be toggled between
-   those two states.&lt;/dd&gt;
+   &lt;table&gt;
+    &lt;tr&gt; &lt;td&gt;        &lt;th&gt; Row     &lt;th&gt; Column A  &lt;th&gt; Column B  &lt;th&gt; Column C
+    &lt;tr&gt; &lt;th&gt; Row 1  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 2  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 3  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 4  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 5  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 6  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 7  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+    &lt;tr&gt; &lt;th&gt; Row 8  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; -
+   &lt;/table&gt;
 
-  &lt;/dl&gt;
+   &lt;p&gt;Now consider the case where a third column, column C, is added
+   to the data model. The user agent once again has several choices,
+   including (but not limited to) the following:&lt;/p&gt;
 
-  &lt;p&gt;If the data provider ever raises an exception while the
-  &lt;code&gt;datagrid&lt;/code&gt; is invoking one of its methods, the
-  &lt;code&gt;datagrid&lt;/code&gt; must act, for the purposes of that particular
-  method call, as if the relevant method had not been defined.&lt;/p&gt;
+   &lt;ul&gt;
 
-  &lt;p&gt;A &lt;code&gt;RowSpecification&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;p&lt;/var&gt; with
-  &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; path components passed to a method of the data
-  provider must fulfill the constraint &lt;span&gt;0&nbsp;&le;&nbsp;&lt;var
-  title=&quot;&quot;&gt;p&lt;sub title=&quot;&quot;&gt;&lt;var
-  title=&quot;&quot;&gt;i&lt;/var&gt;&lt;/sub&gt;&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;var
-  title=&quot;&quot;&gt;m&lt;/var&gt;-1&lt;/span&gt; for all integer values of &lt;var
-  title=&quot;&quot;&gt;i&lt;/var&gt; in the range &lt;span&gt;0&nbsp;&le;&nbsp;&lt;var
-  title=&quot;&quot;&gt;i&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;var title=&quot;&quot;&gt;n&lt;/var&gt;-1&lt;/span&gt;,
-  where &lt;var title=&quot;&quot;&gt;m&lt;/var&gt; is the value that was last returned by
-  the &lt;code title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount()&lt;/code&gt;
-  method when it was passed the &lt;code&gt;RowSpecification&lt;/code&gt; object
-  &lt;var title=&quot;&quot;&gt;q&lt;/var&gt; with &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;-1&lt;/span&gt;
-  items, where &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;p&lt;sub title=&quot;&quot;&gt;&lt;var
-  title=&quot;&quot;&gt;i&lt;/var&gt;&lt;/sub&gt;&lt;/var&gt;&nbsp;=&nbsp;&lt;var title=&quot;&quot;&gt;q&lt;sub
-  title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;&lt;/sub&gt;&lt;/var&gt;&lt;/span&gt; for all integer
-  values of &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; in the range
-  &lt;span&gt;0&nbsp;&le;&nbsp;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;var
-  title=&quot;&quot;&gt;n&lt;/var&gt;-1&lt;/span&gt;, with any changes implied by the update
-  methods taken into account.&lt;/p&gt;
+    &lt;li&gt;Fire the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt;
+    method for rows 1 through 8 again, this time listing just column
+    C.&lt;/li&gt;
 
-  &lt;p id=&quot;inconsistentDataProvider&quot;&gt;The data model is considered
-  stable: user agents may assume that subsequent calls to the data
-  provider methods will return the same data, until one of the update
-  methods is called on the &lt;code&gt;datagrid&lt;/code&gt; element. If a user
-  agent is returned inconsistent data, for example if the number of
-  rows returned by &lt;code
-  title=&quot;dom-provider-getRowCount&quot;&gt;getRowCount()&lt;/code&gt; varies in ways
-  that do not match the calls made to the update methods, the user
-  agent may disable the &lt;code&gt;datagrid&lt;/code&gt;. User agents that do not
-  disable the &lt;code&gt;datagrid&lt;/code&gt; in inconsistent cases must honor
-  the most recently returned values.&lt;/p&gt;
+    &lt;li&gt;Fire the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getRows()&lt;/code&gt;
+    method for row 1, then fire it again for rows 5 and 6, and then
+    fire the &lt;code title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt;
+    method for the other rows (in all three cases, listing just column
+    C).&lt;/li&gt;
 
-  &lt;p&gt;User agents may cache returned values so that the data provider
-  is never asked for data that could contradict earlier data. User
-  agents must not cache the return value of the &lt;code
-  title=&quot;dom-provider-getRowMenu&quot;&gt;getRowMenu&lt;/code&gt; method.&lt;/p&gt;
+   &lt;/ul&gt;
 
-  &lt;p&gt;The exact algorithm used to populate the data grid is not defined
-  here, since it will differ based on the presentation used. However,
-  the behavior of user agents must be consistent with the
-  descriptions above. For example, it would be non-conformant for a
-  user agent to make cells have both a checkbox and be editable, as
-  the descriptions above state that cells that have a checkbox cannot
-  be edited.&lt;/p&gt; &lt;!-- XXX speaking of which, do we actually want that
-  limitation? --&gt;
+   &lt;p&gt;The two options here are as bad as each other; the former
+   involves a lot of overlap, but the latter involves a lot of method
+   calls. Unfortunately the user agent can't do the obvious thing,
+   namely just to invoke the &lt;code
+   title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt; method for all the
+   rows listing just column C, because it doesn't have the row
+   information for all the rows yet (rows 1, 5 and 6 are still
+   pending).&lt;/p&gt;
 
+   &lt;p&gt;In any case, the data model now looks like this:&lt;/p&gt;
 
-  &lt;h5&gt;Updating the &lt;code&gt;datagrid&lt;/code&gt;&lt;/h5&gt;
+   &lt;table&gt;
+    &lt;tr&gt; &lt;td&gt;        &lt;th&gt; Row     &lt;th&gt; Column A  &lt;th&gt; Column B  &lt;th&gt; Column C
+    &lt;tr&gt; &lt;th&gt; Row 1  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 2  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 3  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 4  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 5  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 6  &lt;td&gt; Pending &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 7  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 8  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+   &lt;/table&gt;
 
-  &lt;p&gt;Whenever the &lt;code title=&quot;dom-datagrid-data&quot;&gt;data&lt;/code&gt;
-  attribute is set to a new value, the &lt;code&gt;datagrid&lt;/code&gt; must
-  clear the current selection, remove all the displayed rows, and plan
-  to repopulate itself using the information from the new data
-  provider at the earliest opportunity.&lt;/p&gt;
+   &lt;p&gt;If at this point the user scrolls around anywhere within this
+   &lt;code&gt;datagrid&lt;/code&gt;, the user agent won't fire the &lt;code
+   title=&quot;dom-listener-getRos&quot;&gt;getRos()&lt;/code&gt; and &lt;code
+   title=&quot;dom-listener-getCells&quot;&gt;getCells()&lt;/code&gt; methods, because
+   all of the rows and cells are covered.&lt;/p&gt;
 
-  &lt;p&gt;There are a number of update methods that can be invoked on the
-  &lt;code&gt;datagrid&lt;/code&gt; element to cause it to refresh itself in
-  slightly less drastic ways:&lt;/p&gt;
+   &lt;p&gt;Now consider the case where the user agent receives row
+   information, but no cell information, for rows 1, 5, and 6:&lt;/p&gt;
 
-  &lt;p&gt;When the &lt;dfn
-  title=&quot;dom-datagrid-updateEverything&quot;&gt;&lt;code&gt;updateEverything()&lt;/code&gt;&lt;/dfn&gt;
-  method is called, the user agent must repopulate the entire
-  &lt;code&gt;datagrid&lt;/code&gt;. If the number of rows decreased, the
-  selection must be updated appropriately. If the number of rows
-  increased, the new rows should be left unselected.&lt;/p&gt;
+   &lt;table&gt;
+    &lt;tr&gt; &lt;td&gt;        &lt;th&gt; Row     &lt;th&gt; Column A  &lt;th&gt; Column B  &lt;th&gt; Column C
+    &lt;tr&gt; &lt;th&gt; Row 1  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 2  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 3  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 4  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 5  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 6  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 7  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+    &lt;tr&gt; &lt;th&gt; Row 8  &lt;td&gt; Yes     &lt;td&gt; Pending   &lt;td&gt; Pending   &lt;td&gt; Pending
+   &lt;/table&gt;
 
-  &lt;p&gt;When the &lt;dfn
-  title=&quot;dom-datagrid-updateRowsChanged&quot;&gt;&lt;code&gt;updateRowsChanged(&lt;var
-  title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  is called, the user agent must refresh the rendering of the rows
-  starting from the row specified by &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, and
-  including the &lt;var title=&quot;&quot;&gt;count&lt;/var&gt; next siblings of the row (or
-  as many next siblings as it has, if that is less than &lt;var
-  title=&quot;&quot;&gt;count&lt;/var&gt;), including all descendant rows.&lt;/p&gt;
+   &lt;p&gt;The user agent still won't fire any methods when the user
+   scrolls, because the data is still covered. But if the script then
+   calls the &lt;code title=&quot;dom-datagrid-renotify&quot;&gt;renotify()&lt;/code&gt;
+   method, the &quot;Pending&quot; flags would get reset, and the model would
+   now look like this:&lt;/p&gt;
 
-  &lt;p&gt;When the &lt;dfn
-  title=&quot;dom-datagrid-updateRowsInserted&quot;&gt;&lt;code&gt;updateRowsInserted(&lt;var
-  title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  is called, the user agent must assume that &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;
-  new rows have been inserted, such that the first new row is
-  identified by &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;. The user agent must update
-  its rendering and the selection accordingly. The new rows should not
-  be selected.&lt;/p&gt;
+   &lt;table&gt;
+    &lt;tr&gt; &lt;td&gt;        &lt;th&gt; Row     &lt;th&gt; Column A  &lt;th&gt; Column B  &lt;th&gt; Column C
+    &lt;tr&gt; &lt;th&gt; Row 1  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+    &lt;tr&gt; &lt;th&gt; Row 2  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -      
+    &lt;tr&gt; &lt;th&gt; Row 3  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -      
+    &lt;tr&gt; &lt;th&gt; Row 4  &lt;td&gt; Yes     &lt;td&gt; Yes       &lt;td&gt; Yes       &lt;td&gt; -      
+    &lt;tr&gt; &lt;th&gt; Row 5  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+    &lt;tr&gt; &lt;th&gt; Row 6  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+    &lt;tr&gt; &lt;th&gt; Row 7  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+    &lt;tr&gt; &lt;th&gt; Row 8  &lt;td&gt; Yes     &lt;td&gt; -         &lt;td&gt; -         &lt;td&gt; -      
+   &lt;/table&gt;
 
-  &lt;p&gt;When the &lt;dfn
-  title=&quot;dom-datagrid-updateRowsRemoved&quot;&gt;&lt;code&gt;updateRowsRemoved(&lt;var
-  title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  is called, the user agent must assume that &lt;var title=&quot;&quot;&gt;count&lt;/var&gt;
-  rows have been removed starting from the row that used to be
-  identifier by &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;.  The user agent must update
-  its rendering and the selection accordingly.&lt;/p&gt;
+   &lt;p&gt;Now, assuming that all eight rows and all three columns are
+   still visible, the user agent has the following choices (amongst
+   others):&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-datagrid-updateRowChanged&quot;&gt;&lt;code&gt;updateRowChanged(&lt;var
-  title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must be exactly equivalent
-  to calling &lt;code
-  title=&quot;dom-datagrid-updateRowsChanged&quot;&gt;updateRowsChanged(&lt;var
-  title=&quot;&quot;&gt;row&lt;/var&gt;, 1)&lt;/code&gt;.&lt;/p&gt;
+   &lt;ul&gt;
 
-  &lt;p&gt;When the &lt;dfn
-  title=&quot;dom-datagrid-updateColumnChanged&quot;&gt;&lt;code&gt;updateColumnChanged(&lt;var
-  title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is called, the user agent
-  must refresh the rendering of the specified column &lt;var
-  title=&quot;&quot;&gt;column&lt;/var&gt;, for all rows.&lt;/p&gt;
+    &lt;li&gt;Fire the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getCells()&lt;/code&gt;
+    method for rows 1 through 8, listing all three columns.&lt;/li&gt;
 
-  &lt;p&gt;When the &lt;dfn
-  title=&quot;dom-datagrid-updateCellChanged&quot;&gt;&lt;code&gt;updateCellChanged(&lt;var
-  title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  is called, the user agent must refresh the rendering of the cell on
-  row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, in column &lt;var
-  title=&quot;&quot;&gt;column&lt;/var&gt;.&lt;/p&gt;
+    &lt;li&gt;Fire the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getCells()&lt;/code&gt;
+    method for rows 1 and 5 through 8, listing all three columns, and
+    then fire the method for rows 2 through 4, listing just column
+    C.&lt;/li&gt;
 
-  &lt;p&gt;Any effects the update methods have on the
-  &lt;code&gt;datagrid&lt;/code&gt;'s selection is not considered a change to the
-  selection, and must therefore not fire the &lt;code
-  title=&quot;event-select&quot;&gt;select&lt;/code&gt; event.&lt;/p&gt;
+    &lt;li&gt;Fire the &lt;code title=&quot;dom-listener-getRows&quot;&gt;getCells()&lt;/code&gt;
+    method for rows 1 and 5 through 8, listing just columns A abd B,
+    and then fire the method for rows 1 through 8, listing just column
+    C.&lt;/li&gt;
 
-  &lt;p&gt;These update methods should be called only by the data provider,
-  or code acting on behalf of the data provider. In particular,
-  calling the &lt;code
-  title=&quot;dom-datagrid-updateRowsInserted&quot;&gt;updateRowsInserted()&lt;/code&gt;
-  and &lt;code
-  title=&quot;dom-datagrid-updateRowsRemoved&quot;&gt;updateRowsRemoved()&lt;/code&gt;
-  methods without actually inserting or removing rows from the data
-  provider is &lt;a href=&quot;#inconsistentDataProvider&quot;&gt;likely to result in
-  inconsistent renderings&lt;/a&gt;, and the user agent is likely to disable
-  the data grid.&lt;/p&gt;
+   &lt;/ul&gt;
 
+   &lt;p&gt;Here the latter two are preferable because they result in less
+   overlap than the first.&lt;/p&gt;
 
-  &lt;h5&gt;Requirements for interactive user agents&lt;/h5&gt;
+  &lt;/div&gt;
 
-  &lt;p&gt;&lt;em&gt;This section only applies to interactive user agents.&lt;/em&gt;&lt;/p&gt;
+  &lt;hr&gt;
 
-  &lt;p&gt;If the &lt;code&gt;datagrid&lt;/code&gt; element has a &lt;dfn
-  title=&quot;attr-datagrid-disabled&quot;&gt;&lt;code&gt;disabled&lt;/code&gt;&lt;/dfn&gt;
-  attribute, then the user agent must disable the
-  &lt;code&gt;datagrid&lt;/code&gt;, preventing the user from interacting with it.
-  The &lt;code&gt;datagrid&lt;/code&gt; element should still continue to update
-  itself when the data provider signals changes to the data, though.
-  Obviously, conformance requirements stating that
-  &lt;code&gt;datagrid&lt;/code&gt; elements must react to users in particular
-  ways do not apply when one is disabled.&lt;/p&gt;
+  &lt;p&gt;The &lt;span&gt;task source&lt;/span&gt; for tasks queued on behalf of a
+  &lt;code&gt;datagrid&lt;/code&gt; is the &lt;span&gt;DOM manipulation task
+  source&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p&gt;If &lt;a href=&quot;#rowType1&quot;&gt;a row is openable&lt;/a&gt;, then the user agent
-  should offer to the user the option of toggling the row's
-  open/closed state. When a row's open/closed state changes, the user
-  agent must update the rendering to match the new state.&lt;/p&gt;
+  &lt;/div&gt;
 
-  &lt;p&gt;If a cell is a cell whose value &lt;a href=&quot;#cellType1&quot;&gt;can be
-  cycled between multiple states&lt;/a&gt;, then the user agent should allow
-  the user to activate the cell to cycle its value. When the user
-  activates this &quot;cycling&quot; behavior of a cell, then the
-  &lt;code&gt;datagrid&lt;/code&gt; must invoke the data provider's &lt;code
-  title=&quot;dom-provider-cycleCell&quot;&gt;cycleCell()&lt;/code&gt; method, with a
-  &lt;code&gt;RowSpecification&lt;/code&gt; object representing the cell's row as
-  the first argument and the cell's column index as the second. The
-  &lt;code&gt;datagrid&lt;/code&gt; must then act as if the
-  &lt;code&gt;datagrid&lt;/code&gt;'s &lt;code
-  title=&quot;dom-datagrid-updateCellChanged&quot;&gt;updateCellChanged()&lt;/code&gt;
-  method had been invoked with those same arguments.&lt;/p&gt;
 
-  &lt;p&gt;When a cell &lt;a href=&quot;#cellType2&quot;&gt;has a checkbox&lt;/a&gt;, the user
-  agent should allow the user to set the checkbox's state. When the
-  user changes the state of a checkbox in such a cell, the
-  &lt;code&gt;datagrid&lt;/code&gt; must invoke the data provider's &lt;code
-  title=&quot;dom-provider-setCellCheckedState&quot;&gt;setCellCheckedState()&lt;/code&gt;
-  method, with a &lt;code&gt;RowSpecification&lt;/code&gt; object representing the
-  cell's row as the first argument, the cell's column index as the
-  second, and the checkbox's new state as the third. The state should
-  be represented by the number 1 if the new state is checked, 0 if the
-  new state is unchecked, and &amp;#x2212;1 if the new state is
-  indeterminate (which must be possible only if the cell has the &lt;code
-  title=&quot;datagrid-cell-class-indeterminate&quot;&gt;indeterminate&lt;/code&gt; class
-  set). The &lt;code&gt;datagrid&lt;/code&gt; must then act as if the
-  &lt;code&gt;datagrid&lt;/code&gt;'s &lt;code
-  title=&quot;dom-datagrid-updateCellChanged&quot;&gt;updateCellChanged()&lt;/code&gt;
-  method had been invoked, specifying the same cell.&lt;/p&gt;
+  &lt;h5&gt;Listening to notifications from the &lt;code&gt;datagrid&lt;/code&gt;&lt;/h5&gt;
 
-  &lt;p&gt;If a cell &lt;a href=&quot;#cellType2&quot;&gt;is editable&lt;/a&gt;, the user agent
-  should allow the user to edit the data for that cell, and doing so
-  must cause the user agent to invoke the &lt;code
-  title=&quot;dom-provider-editCell&quot;&gt;editCell()&lt;/code&gt; method of the data
-  provider with three arguments: a &lt;code&gt;RowSpecification&lt;/code&gt;
-  object representing the cell's row, the cell's column's index, and
-  the new text entered by the user. The user agent must then act as if
-  the &lt;code
-  title=&quot;dom-datagrid-updateCellChanged&quot;&gt;updateCellChanged()&lt;/code&gt;
-  method had been invoked, with the same row and column specified.&lt;/p&gt;
+  &lt;p&gt;&lt;em&gt;The conformance criteria in this section apply to any
+  implementation of the &lt;code&gt;DataGridListener&lt;/code&gt; interface,
+  including (and most commonly) the content author's
+  implementation(s).&lt;/em&gt;&lt;/p&gt;
 
-  &lt;!-- XXXPA &lt;p class=&quot;XXX&quot;&gt;define actions (performAction(), etc)&lt;/p&gt; --&gt;
+  &lt;pre class=&quot;idl&quot;&gt;// To be implemented by Web authors as a JS object
+[NoInterfaceObject] interface &lt;dfn&gt;DataGridListener&lt;/dfn&gt; {
+  void &lt;span title=&quot;dom-listener-initialize&quot;&gt;initialize&lt;/span&gt;(in &lt;span&gt;HTMLDataGridElement&lt;/span&gt; datagrid);
 
+  void &lt;span title=&quot;dom-listener-getRows&quot;&gt;getRows&lt;/span&gt;(in unsigned long rowIndex, in unsigned long rowCount, in &lt;span&gt;RowID&lt;/span&gt; parentRow, in unsigned long position, in &lt;span&gt;ColumnList&lt;/span&gt; columns);
+  void &lt;span title=&quot;dom-listener-getCells&quot;&gt;getCells&lt;/span&gt;(in &lt;span&gt;RowIDList&lt;/span&gt; rows, in &lt;span&gt;ColumnList&lt;/span&gt; columns);
+  void &lt;span title=&quot;dom-listener-rowOpened&quot;&gt;rowOpened&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in boolean rowCountNeeded);
+  void &lt;span title=&quot;dom-listener-rowClosed&quot;&gt;rowClosed&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row);
+
+  void &lt;span title=&quot;dom-listener-cellChanged&quot;&gt;cellChanged&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in &lt;span&gt;Column&lt;/span&gt; column, in any newValue, in any prevValue);
+  &lt;span&gt;HTMLMenuElement&lt;/span&gt; &lt;span title=&quot;dom-listener-getRowMenu&quot;&gt;getRowMenu&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row);
+&lt;!--vsDGDND
+  boolean &lt;span title=&quot;dom-listener-canDrop&quot;&gt;canDrop&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in &lt;span&gt;RowID&lt;/span&gt; position, data);
+  boolean &lt;span title=&quot;dom-listener-dropped&quot;&gt;dropped&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in &lt;span&gt;RowID&lt;/span&gt; position, data);
+--&gt;&lt;!--v2DGPA
+  void &lt;span title=&quot;dom-listener-performAction&quot;&gt;performAction&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in DOMString action);
+--&gt;};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;code&gt;DataGridDataProvider&lt;/code&gt; interface, once implemented
+  by an object in a script and hooked up to a &lt;code&gt;datagrid&lt;/code&gt;
+  using the &lt;dfn title=&quot;dom-datagrid-data&quot;&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute, receives notifications when the &lt;code&gt;datagrid&lt;/code&gt;
+  needs information (such as which rows exist) for display.&lt;/p&gt;
+
+  &lt;p&gt;The following methods may be usefully implemented:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-listener-initialize&quot;&gt;&lt;code&gt;initialize(&lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; element (the one given by
+    the &lt;var title=&quot;&quot;&gt;datagrid&lt;/var&gt; argument) when the &lt;code
+    title=&quot;dom-datagrid-listener&quot;&gt;listener&lt;/code&gt; attribute is
+    set.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-listener-getRows&quot;&gt;&lt;code&gt;getRows(&lt;var title=&quot;&quot;&gt;rowIndex&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;columns&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; element when the user agent
+    finds itself needing to render rows for which it is lacking
+    information.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rowIndex&lt;/var&gt; argument gives the flattened
+    index of the first row for which it needs information, ignoring
+    the tree structure of the &lt;code&gt;datagrid&lt;/code&gt; model, where zero
+    is the first row of the entire tree.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rowCount&lt;/var&gt; argument gives the number of
+    rows for which the user agent would like information.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;parentRow&lt;/var&gt; argument gives the
+    &lt;code&gt;RowID&lt;/code&gt; object identifying the nearest ancestor of the
+    first row that the user agent is aware of. After the sort order
+    has changed, this will typically be the root of the tree
+    (identified by a &lt;code&gt;RowID&lt;/code&gt; object consisting of an empty
+    array).
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;columns&lt;/var&gt; argument gives the columns for
+    which the user agent is lacking information, as an array of column
+    identifiers (as passed to &lt;code
+    title=&quot;dom-datagrid-addColumn&quot;&gt;addColumn()&lt;/code&gt;).&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-listener-getCells&quot;&gt;&lt;code&gt;getCells(&lt;var title=&quot;&quot;&gt;rows&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;columns&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; element when the user agent
+    finds itself needing to render cells for which it is lacking
+    information in rows that it does know about.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;rows&lt;/var&gt; argument gives an array of
+    &lt;code&gt;RowID&lt;/code&gt; objects identifying the various rows for which
+    the user agent is lacking information.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;columns&lt;/var&gt; argument gives the columns for
+    which the user agent is lacking information, as an array of column
+    identifiers (as passed to &lt;code
+    title=&quot;dom-datagrid-addColumn&quot;&gt;addColumn()&lt;/code&gt;).&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-listener-rowOpened&quot;&gt;&lt;code&gt;rowOpened(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;rowCountNeeded&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; element when the user has
+    opened a row.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; argument gives an
+    &lt;code&gt;RowID&lt;/code&gt; object identifying the row that was opened.&lt;/p&gt;
+
+    &lt;p&gt;If the user agent also knows how many children that row has,
+    then the &lt;var title=&quot;&quot;&gt;rowCountNeeded&lt;/var&gt; argument will be
+    false. Otherwise, the argument will be true, and the row will
+    remain closed until the &lt;code
+    title=&quot;dom-datagrid-setRows&quot;&gt;setRows()&lt;/code&gt; method is called
+    with an accurate row count.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-listener-rowClosed&quot;&gt;&lt;code&gt;rowClosed(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; element when the user has
+    opened a row.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; argument gives an
+    &lt;code&gt;RowID&lt;/code&gt; object identifying the row that was closed.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-listener-cellChanged&quot;&gt;&lt;code&gt;cellChanged(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;column&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;newValue&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;prevValue&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Called by the &lt;code&gt;datagrid&lt;/code&gt; element when the user has
+    edited a cell or checked a check box in a cell.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; argument gives an
+    &lt;code&gt;RowID&lt;/code&gt; object identifying the row of the cell, and the
+    &lt;var title=&quot;&quot;&gt;column&lt;/var&gt; argument gives the identifier of the
+    cell's column.&lt;/p&gt;
+
+    &lt;p&gt;The &lt;var title=&quot;&quot;&gt;newValue&lt;/var&gt; argument gives the new value,
+    and the &lt;var title=&quot;&quot;&gt;prevValue&lt;/var&gt; argument gives the previous
+    value.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-listener-getRowMenu&quot;&gt;&lt;code&gt;getRowMenu(&lt;var title=&quot;&quot;&gt;row&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;Must return an &lt;code&gt;HTMLMenuElement&lt;/code&gt; object that is to
+   be used as a context menu for row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt;, or null
+   if there is no particular context menu. May be omitted if none of
+   the rows have a special context menu. As this method is called
+   immediately before showing the menu in question, no precautions
+   need to be taken if the return value of this method changes.&lt;/dd&gt;
+
+   &lt;!--v2DGDND, v2DFPA--&gt;
+
+  &lt;/dl&gt;
+
+  &lt;div class=&quot;impl&quot;&gt;
+
+  &lt;p&gt;Objects that implement the &lt;code&gt;DataGridListener&lt;/code&gt;
+  interface may omit any or all of the methods. When a method is
+  omitted, a user agent intending to call that method must instead
+  skip the method call, and must assume that the method's return value
+  is null.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+
+
+&lt;!-- v2DGS: &lt;datagrid&gt; selection (search for the bits marked &quot;...&quot; to see what needs filling in, at a minimum)
+
   &lt;h5&gt;The selection&lt;/h5&gt;
 
-  &lt;p&gt;&lt;em&gt;This section only applies to interactive user agents. For
-  other user agents, the &lt;code
-  title=&quot;dom-datagrid-selection&quot;&gt;selection&lt;/code&gt; attribute must
-  return null.&lt;/em&gt;&lt;/p&gt;
-
   &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;DataGridSelection&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;span title=&quot;dom-DataGridSelection-count&quot;&gt;length&lt;/span&gt;;
-  [IndexGetter] &lt;span&gt;RowSpecification&lt;/span&gt; &lt;span title=&quot;dom-DataGridSelection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
-  boolean &lt;span title=&quot;dom-DataGridSelection-isSelected&quot;&gt;isSelected&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row);
-  void &lt;span title=&quot;dom-DataGridSelection-setSelected&quot;&gt;setSelected&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; row, in boolean selected);
-&lt;!--  void &lt;span title=&quot;dom-DataGridSelection-addRange&quot;&gt;addRange&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; first, in &lt;span&gt;RowSpecification&lt;/span&gt; last);
-  void &lt;span title=&quot;dom-DataGridSelection-removeRange&quot;&gt;removeRange&lt;/span&gt;(in &lt;span&gt;RowSpecification&lt;/span&gt; first, in &lt;span&gt;RowSpecification&lt;/span&gt; last);
-XXX selection ranges --&gt;
+  readonly attribute unsigned long &lt;span title=&quot;dom-DataGridSelection-length&quot;&gt;length&lt;/span&gt;;
+  [IndexGetter] &lt;span&gt;RowID&lt;/span&gt; &lt;span title=&quot;dom-DataGridSelection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
+  boolean &lt;span title=&quot;dom-DataGridSelection-isSelected&quot;&gt;isSelected&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row);
+  void &lt;span title=&quot;dom-DataGridSelection-setSelected&quot;&gt;setSelected&lt;/span&gt;(in &lt;span&gt;RowID&lt;/span&gt; row, in boolean selected);
   void &lt;span title=&quot;dom-DataGridSelection-selectAll&quot;&gt;selectAll&lt;/span&gt;();
-  void &lt;span title=&quot;dom-DataGridSelection-invert&quot;&gt;invert&lt;/span&gt;();
   void &lt;span title=&quot;dom-DataGridSelection-clear&quot;&gt;clear&lt;/span&gt;();
 };&lt;/pre&gt;
 
+  &lt;dl class=&quot;domintro&quot;&gt;
+
+   ...
+
+  &lt;/dl&gt;
+
+  &lt;div class=&quot;impl&quot;&gt;
+
   &lt;p&gt;Each &lt;code&gt;datagrid&lt;/code&gt; element must keep track of which rows
   are currently selected. Initially no rows are selected, but this can
-  be changed via the methods described in this section. &lt;!--XXX
-  select-provider-selection The default data provider, for instance,
-  changes which rows are selected when it is first initialized.--&gt;&lt;/p&gt;
+  be changed via the methods described in this section.&lt;/p&gt;
 
   &lt;p&gt;The selection of a &lt;code&gt;datagrid&lt;/code&gt; is represented by its
   &lt;dfn title=&quot;dom-datagrid-selection&quot;&gt;&lt;code&gt;selection&lt;/code&gt;&lt;/dfn&gt; DOM
   attribute, which must be a &lt;code&gt;DataGridSelection&lt;/code&gt; object.&lt;/p&gt;
 
   &lt;p&gt;&lt;code&gt;DataGridSelection&lt;/code&gt; objects represent the rows in the
-  selection. In the selection the rows must be ordered in the natural
-  order of the data provider (and not, e.g., the rendered order). Rows
-  that are not rendered because one of their ancestors is closed must
-  share the same selection state as their nearest rendered
-  ancestor. Such rows are not considered part of the selection for the
-  purposes of iterating over the selection.&lt;/p&gt;
+  selection. In the selection the rows must be ordered in their
+  natural order (and not, e.g., the display order). A row with an
+  ancestor that is closed cannot be selected.&lt;/p&gt;
 
-  &lt;p class=&quot;note&quot;&gt;This selection API doesn't allow for hidden rows to
-  be selected because it is trivial to create a data provider that has
-  infinite depth, which would then require the selection to be
-  infinite if every row, including every hidden row, was selected.&lt;/p&gt;
-
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-DataGridSelection-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
   attribute must return the number of rows currently present in the
@@ -41997,7 +42668,8 @@
   properties&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-DataGridSelection-item&quot;&gt;&lt;code&gt;item(&lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return a
+  &lt;code&gt;RowID&lt;/code&gt; object identifying the &lt;var
   title=&quot;&quot;&gt;index&lt;/var&gt;th row in the selection. If the argument is out
   of range (less than zero or greater than the number of selected rows
   minus one), then it must raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt;
@@ -42006,8 +42678,9 @@
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-DataGridSelection-isSelected&quot;&gt;&lt;code&gt;isSelected()&lt;/code&gt;&lt;/dfn&gt;
   method must return the selected state of the row specified by its
-  argument. If the specified row exists and is selected, it must
-  return true, otherwise it must return false.&lt;/p&gt;
+  argument. If the specified row is in the &lt;span&gt;natural order sparse
+  data tree&lt;/span&gt; and is selected, the method must return true,
+  otherwise it must return false.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-DataGridSelection-setSelected&quot;&gt;&lt;code&gt;setSelected()&lt;/code&gt;&lt;/dfn&gt;
@@ -42015,116 +42688,51 @@
   title=&quot;&quot;&gt;selected&lt;/var&gt;. When invoked, it must set the selection
   state of row &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; to selected if &lt;var
   title=&quot;&quot;&gt;selected&lt;/var&gt; is true, and unselected if it is false. If
-  &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; is not a row in the data grid, the method
-  must raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception. If the
-  specified row is not rendered because one of its ancestors is
-  closed, the method must do nothing.&lt;/p&gt;
+  &lt;var title=&quot;&quot;&gt;row&lt;/var&gt; does not specify a row in the &lt;span&gt;natural
+  order sparse data tree&lt;/span&gt; ...
 
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-DataGridSelection-selectAll&quot;&gt;&lt;code&gt;selectAll()&lt;/code&gt;&lt;/dfn&gt;
-  method must mark all the rows in the data grid as selected. After a
-  call to &lt;code
-  title=&quot;dom-DataGridSelection-selectAll&quot;&gt;selectAll()&lt;/code&gt;, the
-  &lt;code title=&quot;dom-DataGridSelection-length&quot;&gt;length&lt;/code&gt; attribute
-  will return the number of rows in the data grid, not counting
-  children of closed rows.&lt;/p&gt;
+  method must ...
 
   &lt;p&gt;The &lt;dfn
-  title=&quot;dom-DataGridSelection-invert&quot;&gt;&lt;code&gt;invert()&lt;/code&gt;&lt;/dfn&gt;
-  method must cause all the rows in the selection that were marked as
-  selected to now be marked as not selected, and vice versa.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn
   title=&quot;dom-DataGridSelection-clear&quot;&gt;&lt;code&gt;clear()&lt;/code&gt;&lt;/dfn&gt;
-  method must mark all the rows in the data grid to be marked as not
-  selected.  After a call to &lt;code
+  method must mark all the rows in the &lt;code&gt;datagrid&lt;/code&gt; as not
+  selected. After a call to &lt;code
   title=&quot;dom-DataGridSelection-clear&quot;&gt;clear()&lt;/code&gt;, the &lt;code
   title=&quot;dom-DataGridSelection-length&quot;&gt;length&lt;/code&gt; attribute will
   return zero.&lt;/p&gt;
 
-  &lt;p&gt;If the &lt;code&gt;datagrid&lt;/code&gt; element has a &lt;dfn
-  title=&quot;attr-datagrid-multiple&quot;&gt;&lt;code&gt;multiple&lt;/code&gt;&lt;/dfn&gt;
-  attribute, then the user agent should allow the user to select any
-  number of rows (zero or more). If the attribute is not present, then
-  the user agent must not allow the user to select more than a single
-  row at a time, and selecting another one must unselect all the other
-  rows.&lt;/p&gt;
+  &lt;p&gt;If the &lt;code&gt;datagrid&lt;/code&gt; element has a &lt;code
+  title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt; attribute, then the
+  user agent should allow the user to select any number of rows (zero
+  or more). If the attribute is not present, then the user agent
+  should allow the user to select a row, and must not allow the user
+  to select more than a single row at a time; selecting another one
+  must unselect all the other rows.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;This only applies to the user. Scripts can select
   multiple rows even when the &lt;code
   title=&quot;attr-datagrid-multiple&quot;&gt;multiple&lt;/code&gt; attribute is
   absent.&lt;/p&gt;
 
-  &lt;p&gt;Whenever the selection of a &lt;code&gt;datagrid&lt;/code&gt; changes,
-  whether due to the user interacting with the element, or as a result
-  of calls to methods of the &lt;code
-  title=&quot;dom-datagrid-selection&quot;&gt;selection&lt;/code&gt; object, a &lt;dfn
-  title=&quot;event-select&quot;&gt;&lt;code&gt;select&lt;/code&gt;&lt;/dfn&gt;&lt;!-- XXX check if we
-  really should be DFNing this here. It's a DOM3 Core event. What's
-  our story going to be regarding events and defining them? --&gt; event
-  that bubbles but is not cancelable must be fired on the
-  &lt;code&gt;datagrid&lt;/code&gt; element. If changes are made to the selection
-  via calls to the object's methods during the execution of a
-  script&lt;!-- XXX should xref to a better explanation --&gt;, then the
-  &lt;code title=&quot;event-select&quot;&gt;select&lt;/code&gt; events must be coalesced
-  into one, which must then be fired&lt;!--XXX xref again--&gt; when the
-  script execution has completed&lt;!-- XXX xref --&gt;.&lt;/p&gt;
+  ...event on selection change?...
 
+  &lt;/div&gt;
+
   &lt;p class=&quot;note&quot;&gt;The &lt;code&gt;DataGridSelection&lt;/code&gt; interface has no
   relation to the &lt;code&gt;Selection&lt;/code&gt; interface.&lt;/p&gt;
 
+--&gt;
 
-  &lt;h5&gt;Columns and captions&lt;/h5&gt;
 
-  &lt;p&gt;&lt;em&gt;This section only applies to interactive user agents.&lt;/em&gt;&lt;/p&gt;
-
-  &lt;p&gt;Each &lt;code&gt;datagrid&lt;/code&gt; element must keep track of which
-  columns are currently being rendered. User agents should initially
-  show all the columns except those with the &lt;code
-  title=&quot;datagrid-column-class-initially-hidden&quot;&gt;initially-hidden&lt;/code&gt;
-  class, but may allow users to hide or show columns. User agents
-  should initially display the columns in the order given by the data
-  provider, but may allow this order to be changed by the user.&lt;/p&gt;
-
-  &lt;p&gt;If columns are not being used, as might be the case if the data
-  grid is being presented in an icon view, or if an overview of data
-  is being read in an aural context, then the text of the first column
-  of each row should be used to represent the row.&lt;/p&gt;
-
-  &lt;p&gt;If none of the columns have any captions (i.e. if the data
-  provider does not provide a &lt;code
-  title=&quot;dom-provider-getCaptionText&quot;&gt;getCaptionText()&lt;/code&gt; method),
-  then user agents may avoid showing the column headers at all. This
-  may prevent the user from performing actions on the columns (such as
-  reordering them, changing the sort column, and so on).&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;Whatever the order used for rendering, and
-  irrespective of what columns are being shown or hidden, the &quot;first
-  column&quot; as referred to in this specification is always the column
-  with index zero, and the &quot;last column&quot; is always the column with the
-  index one less than the value returned by the &lt;code
-  title=&quot;dom-provider-getcolumnCount&quot;&gt;getColumnCount()&lt;/code&gt; method
-  of the data provider.&lt;/p&gt;
-
-  &lt;p&gt;If &lt;a href=&quot;#columnType2&quot;&gt;a column is sortable&lt;/a&gt;, then the user
-  agent should allow the user to request that the data be sorted using
-  that column. When the user does so, then the &lt;code&gt;datagrid&lt;/code&gt;
-  must invoke the data provider's &lt;code
-  title=&quot;dom-provider-toggleColumnSortState&quot;&gt;toggleColumnSortState()&lt;/code&gt;
-  method, with the column's index as the only argument. The
-  &lt;code&gt;datagrid&lt;/code&gt; must &lt;em&gt;then&lt;/em&gt; act as if the
-  &lt;code&gt;datagrid&lt;/code&gt;'s &lt;code
-  title=&quot;dom-datagrid-updateEverything&quot;&gt;updateEverything()&lt;/code&gt;
-  method had been invoked.&lt;/p&gt;
-
-&lt;!--XXXDND
+&lt;!--vsDGDND
   &lt;h5&gt;Drag and drop in &lt;code&gt;datagrid&lt;/code&gt;s&lt;/h5&gt;
 
   &lt;p&gt;&lt;em&gt;This section only applies to interactive user agents.&lt;/em&gt;&lt;/p&gt;
 
-  &lt;p class=&quot;XXX&quot;&gt;define drag and drop in datagrids; selectiondraggable, etc.&lt;/p&gt;
+  ...define drag and drop in datagrids; selectiondraggable...
 --&gt;
-&lt;/div&gt;
 
 
   &lt;h4 id=&quot;the-command&quot;&gt;The &lt;dfn&gt;&lt;code&gt;command&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
@@ -74606,6 +75214,7 @@
  XXX * should check all cases of 'active document' and change the
        relevant ones to 'fully active document'.
  XXX * use &lt;code&gt;Document&lt;/code&gt; consistently instead of 'document'.
+ XXX * s/raise/throw/g
 --&gt;
 
  &lt;/body&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009843.html">[html5] r2961 - [e] (0) Add keygen to the void element list;	make those element lists alphabetic [...]
</A></li>
	<LI>Next message: <A HREF="009845.html">[html5] r2963 - [e] (0) Typos: round 1.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9844">[ date ]</a>
              <a href="thread.html#9844">[ thread ]</a>
              <a href="subject.html#9844">[ subject ]</a>
              <a href="author.html#9844">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
