<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r3234 - [e] (0) Reference abarth's draft and remove the	duplicate content from the HTML5 [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r3234%20-%20%5Be%5D%20%280%29%20Reference%20abarth%27s%20draft%20and%20remove%20the%0A%09duplicate%20content%20from%20the%20HTML5%20%5B...%5D&In-Reply-To=%3C20090612215818.A0DDB1389F2%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010112.html">
   <LINK REL="Next"  HREF="010114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r3234 - [e] (0) Reference abarth's draft and remove the	duplicate content from the HTML5 [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r3234%20-%20%5Be%5D%20%280%29%20Reference%20abarth%27s%20draft%20and%20remove%20the%0A%09duplicate%20content%20from%20the%20HTML5%20%5B...%5D&In-Reply-To=%3C20090612215818.A0DDB1389F2%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r3234 - [e] (0) Reference abarth's draft and remove the	duplicate content from the HTML5 [...]">whatwg at whatwg.org
       </A><BR>
    <I>Fri Jun 12 14:58:18 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="010112.html">[html5] r3233 - [e] (0) copy/paste error
</A></li>
        <LI>Next message: <A HREF="010114.html">[html5] r3235 - [act] (0) Revert r3146 ('Allow	href='http://example.com/demo?id=hello&amp;copy=1&amp;wor [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10113">[ date ]</a>
              <a href="thread.html#10113">[ thread ]</a>
              <a href="subject.html#10113">[ subject ]</a>
              <a href="author.html#10113">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-06-12 14:58:16 -0700 (Fri, 12 Jun 2009)
New Revision: 3234

Modified:
   index
   source
Log:
[e] (0) Reference abarth's draft and remove the duplicate content from the HTML5 spec.

Modified: index
===================================================================
--- index	2009-06-12 19:46:29 UTC (rev 3233)
+++ index	2009-06-12 21:58:16 UTC (rev 3234)
@@ -278,32 +278,25 @@
    &lt;li&gt;&lt;a href=#fetching-resources&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Fetching resources&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#concept-http-equivalent&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Protocol concepts&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#encrypted-http-and-related-security-concerns&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Encrypted HTTP and related security concerns&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;a href=#content-type-sniffing&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Determining the type of a resource&lt;/a&gt;
+     &lt;li&gt;&lt;a href=#encrypted-http-and-related-security-concerns&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Encrypted HTTP and related security concerns&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#content-type-sniffing&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Determining the type of a resource&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#character-encodings-0&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Character encodings&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#common-dom-interfaces&gt;&lt;span class=secno&gt;2.8 &lt;/span&gt;Common DOM interfaces&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#content-type&gt;&lt;span class=secno&gt;2.7.1 &lt;/span&gt;Content-Type metadata&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#content-type-sniffing:-web-pages&gt;&lt;span class=secno&gt;2.7.2 &lt;/span&gt;Content-Type sniffing: Web pages&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#content-type-sniffing:-text-or-binary&gt;&lt;span class=secno&gt;2.7.3 &lt;/span&gt;Content-Type sniffing: text or binary&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#content-type-sniffing:-unknown-type&gt;&lt;span class=secno&gt;2.7.4 &lt;/span&gt;Content-Type sniffing: unknown type&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#content-type-sniffing:-image&gt;&lt;span class=secno&gt;2.7.5 &lt;/span&gt;Content-Type sniffing: image&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#content-type-sniffing:-feed-or-html&gt;&lt;span class=secno&gt;2.7.6 &lt;/span&gt;Content-Type sniffing: feed or HTML&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;a href=#character-encodings-0&gt;&lt;span class=secno&gt;2.8 &lt;/span&gt;Character encodings&lt;/a&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;a href=#common-dom-interfaces&gt;&lt;span class=secno&gt;2.9 &lt;/span&gt;Common DOM interfaces&lt;/a&gt;
-    &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#reflecting-content-attributes-in-dom-attributes&gt;&lt;span class=secno&gt;2.9.1 &lt;/span&gt;Reflecting content attributes in DOM attributes&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#collections&gt;&lt;span class=secno&gt;2.9.2 &lt;/span&gt;Collections&lt;/a&gt;
+     &lt;li&gt;&lt;a href=#reflecting-content-attributes-in-dom-attributes&gt;&lt;span class=secno&gt;2.8.1 &lt;/span&gt;Reflecting content attributes in DOM attributes&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#collections&gt;&lt;span class=secno&gt;2.8.2 &lt;/span&gt;Collections&lt;/a&gt;
       &lt;ol&gt;
-       &lt;li&gt;&lt;a href=#htmlcollection&gt;&lt;span class=secno&gt;2.9.2.1 &lt;/span&gt;HTMLCollection&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#htmlformcontrolscollection&gt;&lt;span class=secno&gt;2.9.2.2 &lt;/span&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#htmloptionscollection&gt;&lt;span class=secno&gt;2.9.2.3 &lt;/span&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#htmlpropertycollection&gt;&lt;span class=secno&gt;2.9.2.4 &lt;/span&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#domtokenlist&gt;&lt;span class=secno&gt;2.9.3 &lt;/span&gt;DOMTokenList&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#domsettabletokenlist&gt;&lt;span class=secno&gt;2.9.4 &lt;/span&gt;DOMSettableTokenList&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#safe-passing-of-structured-data&gt;&lt;span class=secno&gt;2.9.5 &lt;/span&gt;Safe passing of structured data&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#domstringmap&gt;&lt;span class=secno&gt;2.9.6 &lt;/span&gt;DOMStringMap&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#dom-feature-strings&gt;&lt;span class=secno&gt;2.9.7 &lt;/span&gt;DOM feature strings&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#exceptions&gt;&lt;span class=secno&gt;2.9.8 &lt;/span&gt;Exceptions&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#garbage-collection&gt;&lt;span class=secno&gt;2.9.9 &lt;/span&gt;Garbage collection&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#htmlcollection&gt;&lt;span class=secno&gt;2.8.2.1 &lt;/span&gt;HTMLCollection&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#htmlformcontrolscollection&gt;&lt;span class=secno&gt;2.8.2.2 &lt;/span&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#htmloptionscollection&gt;&lt;span class=secno&gt;2.8.2.3 &lt;/span&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#htmlpropertycollection&gt;&lt;span class=secno&gt;2.8.2.4 &lt;/span&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#domtokenlist&gt;&lt;span class=secno&gt;2.8.3 &lt;/span&gt;DOMTokenList&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#domsettabletokenlist&gt;&lt;span class=secno&gt;2.8.4 &lt;/span&gt;DOMSettableTokenList&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#safe-passing-of-structured-data&gt;&lt;span class=secno&gt;2.8.5 &lt;/span&gt;Safe passing of structured data&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#domstringmap&gt;&lt;span class=secno&gt;2.8.6 &lt;/span&gt;DOMStringMap&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#dom-feature-strings&gt;&lt;span class=secno&gt;2.8.7 &lt;/span&gt;DOM feature strings&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#exceptions&gt;&lt;span class=secno&gt;2.8.8 &lt;/span&gt;Exceptions&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#garbage-collection&gt;&lt;span class=secno&gt;2.8.9 &lt;/span&gt;Garbage collection&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#dom&gt;&lt;span class=secno&gt;3 &lt;/span&gt;Semantics, structure, and APIs of HTML documents&lt;/a&gt;
   &lt;ol&gt;
    &lt;li&gt;&lt;a href=#semantics-intro&gt;&lt;span class=secno&gt;3.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
@@ -5285,637 +5278,43 @@
 
   &lt;/div&gt;
 
-  &lt;/div&gt;
 
+  &lt;h4 id=content-type-sniffing&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Determining the type of a resource&lt;/h4&gt;
 
-  &lt;div class=impl&gt;
+  &lt;!-- MIMESNIFF = <A HREF="http://tools.ietf.org/html/draft-abarth-mime-sniff">http://tools.ietf.org/html/draft-abarth-mime-sniff</A> --&gt;
 
-  &lt;h3 id=content-type-sniffing&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Determining the type of a resource&lt;/h3&gt;
+  &lt;p&gt;The &lt;dfn id=content-type title=Content-Type&gt;Content-Type metadata&lt;/dfn&gt; of a
+  resource must be obtained and interpreted in a manner consistent
+  with the requirements of the Content-Type Processing Model
+  specification. &lt;a href=#refsMIMESNIFF&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p class=warning&gt;It is imperative that the rules in this section
-  be followed exactly. When a user agent uses different heuristics for
-  content type detection than the server expects, security problems
-  can occur. For example, if a server believes that the client will
-  treat a contributed file as an image (and thus treat it as benign),
-  but a Web browser believes the content to be HTML (and thus execute
-  any scripts contained therein), the end user can be exposed to
-  malicious content, making the user vulnerable to cookie theft
-  attacks and other cross-site scripting attacks.&lt;/p&gt;
-
-
-  &lt;h4 id=content-type&gt;&lt;span class=secno&gt;2.7.1 &lt;/span&gt;Content-Type metadata&lt;/h4&gt;
-
-  &lt;p&gt;What explicit &lt;dfn id=content-type-0 title=Content-Type&gt;Content-Type
-  metadata&lt;/dfn&gt; is associated with the resource (the resource's type
-  information) depends on the protocol that was used to
-  &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resource.&lt;/p&gt;
-
-  &lt;p&gt;For HTTP resources, only the first Content-Type HTTP header, if
-  any, contributes any type information; the explicit type of the
-  resource is then the value of that header, interpreted as described
-  by the HTTP specifications. If the Content-Type HTTP header is
-  present but the value of the first such header cannot be interpreted
-  as described by the HTTP specifications (e.g. because its value
-  doesn't contain a U+002F SOLIDUS ('/') character), then the resource
-  has no type information (even if there are multiple Content-Type
-  HTTP headers and one of the other ones is syntactically correct). &lt;a href=#refsHTTP&gt;[HTTP]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;For resources fetched from the file system, user agents should use
-  platform-specific conventions, e.g. operating system extension/type
-  mappings.&lt;/p&gt;
-
-  &lt;p&gt;Extensions must not be used for determining resource types for
-  resources fetched over HTTP.&lt;/p&gt;
-
-  &lt;p&gt;For resources fetched over most other protocols, e.g. FTP, there
-  is no type information.&lt;/p&gt;
-
-
   &lt;p&gt;The &lt;dfn id=algorithm-for-extracting-an-encoding-from-a-content-type&gt;algorithm for extracting an encoding from a
-  Content-Type&lt;/dfn&gt;, given a string &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, is as
-  follows. It either returns an encoding or nothing.&lt;/p&gt;
+  Content-Type&lt;/dfn&gt;, given a string &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, is given
+  in the Content-Type Processing Model specification. It either
+  returns an encoding or nothing. &lt;a href=#refsMIMESNIFF&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Find the first seven characters in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;
-   that are an &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the word
-   &quot;charset&quot;. If no such match is found, return nothing.&lt;/p&gt;
-
-   &lt;li&gt;&lt;p&gt;Skip any U+0009, U+000A, U+000C, U+000D, or U+0020
-   characters that immediately follow the word 'charset' (there might
-   not be any).&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the next character is not a U+003D EQUALS SIGN ('='),
-   return nothing.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Skip any U+0009, U+000A, U+000C, U+000D, or U+0020
-   characters that immediately follow the equals sign (there might not
-   be any).&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Process the next character as follows:&lt;/p&gt;
-
-    &lt;dl class=switch&gt;&lt;dt&gt;If it is a U+0022 QUOTATION MARK ('&quot;') and there is a later
-     U+0022 QUOTATION MARK ('&quot;') in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dt&gt;If it is a U+0027 APOSTROPHE (&quot;'&quot;) and there is a later
-     U+0027 APOSTROPHE (&quot;'&quot;) in  &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Return the string between this character and the next
-     earliest occurrence of this character.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If it is an unmatched U+0022 QUOTATION MARK ('&quot;')&lt;/dt&gt;
-     &lt;dt&gt;If it is an unmatched U+0027 APOSTROPHE (&quot;'&quot;)&lt;/dt&gt;
-     &lt;dt&gt;If there is no next character&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Return nothing.&lt;/dd&gt;
-
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Return the string from this character to the first U+0009,
-     U+000A, U+000C, U+000D, U+0020, or U+003B character or the end of
-     &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, whichever comes first.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p class=note&gt;The above algorithm is a &lt;a href=#willful-violation&gt;willful
-  violation&lt;/a&gt; of the HTTP specification, which requires that the
-  Content-Type headers be honored, despite implementation experience
-  showing that this is not pratical in many cases. &lt;a href=#refsHTTP&gt;[HTTP]&lt;/a&gt;&lt;/p&gt;
-
-
-  &lt;h4 id=content-type-sniffing:-web-pages&gt;&lt;span class=secno&gt;2.7.2 &lt;/span&gt;Content-Type sniffing: Web pages&lt;/h4&gt;
-
   &lt;p&gt;The &lt;dfn id=content-type-sniffing-0 title=&quot;Content-Type sniffing&quot;&gt;sniffed type of a
-  resource&lt;/dfn&gt; must be found as follows:&lt;/p&gt;
+  resource&lt;/dfn&gt; must be found in a manner consistent with the
+  requirements given in the Content-Type Processing Model
+  specification for finding that &lt;i&gt;sniffed type&lt;/i&gt;. &lt;a href=#refsMIMESNIFF&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the user agent is configured to strictly obey
-   Content-Type headers for this resource, then jump to the last step
-   in this set of steps.&lt;/li&gt;
+  &lt;p&gt;The &lt;dfn id=content-type-sniffing:-image title=&quot;Content-Type sniffing: image&quot;&gt;rules for sniffing
+  images specifically&lt;/dfn&gt; are also defined in the Content-Type
+  Processing Model specification. &lt;a href=#refsMIMESNIFF&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;If the resource was fetched over an HTTP protocol and there
-   is an HTTP Content-Type header and the value of the first such
-   header has bytes that exactly match one of the following lines:&lt;/p&gt;
+  &lt;p class=warning&gt;It is imperative that the rules in the
+  Content-Type Processing Model specification be followed
+  exactly. When a user agent uses different heuristics for content
+  type detection than the server expects, security problems can
+  occur. For more details, see the Content-Type Processing Model
+  specification. &lt;a href=#refsMIMESNIFF&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Bytes in Hexadecimal
-       &lt;th&gt;Textual representation
-     &lt;tbody&gt;&lt;tr&gt;&lt;!-- Very old Apache default --&gt;&lt;td&gt;74 65 78 74 2f 70 6c 61 69 6e
-       &lt;td&gt;&lt;code title=&quot;&quot;&gt;text/plain&lt;/code&gt;
-      &lt;tr&gt;&lt;!-- Old Apache default --&gt;&lt;td&gt;74 65 78 74 2f 70 6c 61 69 6e 3b 20 63 68 61 72 73 65 74 3d 49 53 4f 2d 38 38 35 39 2d 31
-       &lt;td&gt;&lt;code title=&quot;&quot;&gt;text/plain;&nbsp;charset=ISO-8859-1&lt;/code&gt;
-      &lt;tr&gt;&lt;!-- Debian's arbitrarily different Apache default --&gt;&lt;td&gt;74 65 78 74 2f 70 6c 61 69 6e 3b 20 63 68 61 72 73 65 74 3d 69 73 6f 2d 38 38 35 39 2d 31
-       &lt;td&gt;&lt;code title=&quot;&quot;&gt;text/plain;&nbsp;charset=iso-8859-1&lt;/code&gt;
-      &lt;tr&gt;&lt;!-- Someone else's arbitrarily different Apache default (who?) --&gt;&lt;td&gt;74 65 78 74 2f 70 6c 61 69 6e 3b 20 63 68 61 72 73 65 74 3d 55 54 46 2d 38
-       &lt;td&gt;&lt;code title=&quot;&quot;&gt;text/plain;&nbsp;charset=UTF-8&lt;/code&gt;
-    &lt;/table&gt;&lt;p&gt;...then jump to the &lt;i title=&quot;content-type sniffing: text or
-    binary&quot;&gt;&lt;a href=#content-type-sniffing:-text-or-binary&gt;text or binary&lt;/a&gt;&lt;/i&gt; section below.&lt;/p&gt;
-
-    &lt;!-- while IE sniffs all text/plain, this will continue to grow as
-    people add new defaults. Hopefully IE will stop the madness in due
-    course and stop sniffing anything but the above... --&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; be the type given by
-   the &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt; for the
-   resource, ignoring parameters. If there is no such type, jump to
-   the &lt;i title=&quot;content-type sniffing: unknown type&quot;&gt;&lt;a href=#content-type-sniffing:-unknown-type&gt;unknown type&lt;/a&gt;&lt;/i&gt;
-   step below. Comparisons with this type, as defined by MIME
-   specifications, are done in an &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt;
-   manner. &lt;a href=#refsRFC2046&gt;[RFC2046]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; is &quot;unknown/unknown&quot; or
-   &quot;application/unknown&quot;, jump to the &lt;i title=&quot;content-type sniffing:
-   unknown type&quot;&gt;&lt;a href=#content-type-sniffing:-unknown-type&gt;unknown type&lt;/a&gt;&lt;/i&gt; step below.&lt;/p&gt; &lt;!-- In a study
-   looking at many billions of pages whose first five characters were
-   &quot;&lt;HTML&quot;, &quot;unknown/unknown&quot; was used to label documents about once
-   for every 5000 pages labeled &quot;text/html&quot;, and &quot;application/unknown&quot;
-   was used about once for every 35000 pages labeled
-   &quot;text/html&quot;. --&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; ends in &quot;+xml&quot;, or if
-   it is either &quot;text/xml&quot; or &quot;application/xml&quot;, then the sniffed
-   type of the resource is &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt;; return
-   that and abort these steps.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; is an image type
-   supported by the user agent (e.g. &quot;image/png&quot;, &quot;image/gif&quot;,
-   &quot;image/jpeg&quot;, etc), then jump to the &lt;i title=&quot;content-type
-   sniffing: image&quot;&gt;&lt;a href=#content-type-sniffing:-image&gt;images&lt;/a&gt;&lt;/i&gt; section below, passing it the &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; is &quot;text/html&quot;, then
-   jump to the &lt;i title=&quot;content-type sniffing: feed or html&quot;&gt;&lt;a href=#content-type-sniffing:-feed-or-html&gt;feed or
-   HTML&lt;/a&gt;&lt;/i&gt; section below.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;The sniffed type of the resource is &lt;var title=&quot;&quot;&gt;official
-   type&lt;/var&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;h4 id=content-type-sniffing:-text-or-binary&gt;&lt;span class=secno&gt;2.7.3 &lt;/span&gt;&lt;dfn&gt;Content-Type sniffing: text or binary&lt;/dfn&gt;&lt;/h4&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;The user agent may wait for 512 or more bytes of the resource
-   to be available.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; be the smaller of either 512 or
-   the number of bytes already available.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is 4 or more, and the first bytes of
-    the resource match one of the following byte sets:&lt;/p&gt;
-
-    &lt;!-- this table is present in several forms in this file; keep them in sync --&gt;
-    &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Bytes in Hexadecimal
-       &lt;th&gt;Description
-     &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;FE FF
-       &lt;td&gt;UTF-16BE BOM &lt;!-- followed by a character --&gt;&lt;!-- nobody uses this: or UTF-32LE BOM --&gt;
-      &lt;tr&gt;&lt;td&gt;FF FE
-       &lt;td&gt;UTF-16LE BOM &lt;!-- followed by a character --&gt;
-&lt;!-- nobody uses this
-      &lt;tr&gt;
-       &lt;td&gt;00 00 FE FF
-       &lt;td&gt;UTF-32BE BOM
---&gt;
-&lt;!-- this one is redundant with the one above
-      &lt;tr&gt;
-       &lt;td&gt;FF FE 00 00
-       &lt;td&gt;UTF-32LE BOM
---&gt;
-      &lt;tr&gt;&lt;td&gt;EF BB BF
-       &lt;td&gt;UTF-8 BOM &lt;!-- followed by a character, or the first byte of a multiple character sequence --&gt;
-&lt;!-- nobody uses this
-      &lt;tr&gt;
-       &lt;td&gt;DD 73 66 73
-       &lt;td&gt;UTF-EBCDIC BOM
---&gt;
-    &lt;/table&gt;&lt;p&gt;...then the sniffed type of the resource is &quot;text/plain&quot;. Abort
-    these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If none of the first &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; bytes of the
-   resource are &lt;a href=#binary-data-bytes&gt;binary data bytes&lt;/a&gt; then the sniffed type
-   of the resource is &quot;text/plain&quot;. Abort these steps.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the first bytes of the resource match one of the byte
-    sequences in the &quot;pattern&quot; column of the table in the &lt;i title=&quot;content-type sniffing: unknown type&quot;&gt;&lt;a href=#content-type-sniffing:-unknown-type&gt;unknown type&lt;/a&gt;&lt;/i&gt;
-    section below, ignoring any rows whose cell in the &quot;security&quot;
-    column says &quot;scriptable&quot; (or &quot;n/a&quot;), then the sniffed type of the
-    resource is the type given in the corresponding cell in the
-    &quot;sniffed type&quot; column on that row; abort these steps.&lt;/p&gt;
-
-    &lt;p class=warning&gt;It is critical that this step not ever return a
-    scriptable type (e.g. text/html), as otherwise that would allow a
-    privilege escalation attack.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is
-   &quot;application/octet-stream&quot;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;Bytes covered by the following ranges are &lt;dfn id=binary-data-bytes&gt;binary data
-  bytes&lt;/dfn&gt;:&lt;/p&gt;
-
-  &lt;!-- This byte list is based on RFC 2046 Section 4.1.2. Characters
-  in the range 0x00-0x1F, with the exception of 0x09, 0x0A, 0x0C, 0x0D
-  (ASCII for TAB, LF, FF, and CR), and character 0x1B (reportedly used
-  by some encodings as a shift escape), are invalid. Thus, if we see
-  them, we assume it's not text. --&gt;
-
-  &lt;ul class=brief&gt;&lt;li&gt; 0x00 - 0x08 &lt;/li&gt;
-   &lt;li&gt; 0x0B &lt;/li&gt;
-   &lt;li&gt; 0x0E - 0x1A &lt;/li&gt;
-   &lt;li&gt; 0x1C - 0x1F &lt;/li&gt;
-  &lt;/ul&gt;&lt;h4 id=content-type-sniffing:-unknown-type&gt;&lt;span class=secno&gt;2.7.4 &lt;/span&gt;&lt;dfn&gt;Content-Type sniffing: unknown type&lt;/dfn&gt;&lt;/h4&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;The user agent may wait for 512 or more bytes of the
-   resource to be available.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;stream length&lt;/var&gt; be the smaller of
-   either 512 or the number of bytes already available.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;For each row in the table below:&lt;/p&gt;
-
-    &lt;dl class=switch&gt;&lt;dt&gt;If the row has no &quot;&lt;em&gt;WS&lt;/em&gt;&quot; bytes:&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;&lt;li&gt;Let &lt;var title=&quot;&quot;&gt;pattern length&lt;/var&gt; be the length of the
-       pattern (number of bytes described by the cell in the second
-       column of the row).&lt;/li&gt;
-
-       &lt;li&gt;If &lt;var title=&quot;&quot;&gt;stream length&lt;/var&gt; is smaller than &lt;var title=&quot;&quot;&gt;pattern length&lt;/var&gt; then skip this row.&lt;/li&gt;
-
-       &lt;li&gt;Apply the &quot;and&quot; operator to the first &lt;var title=&quot;&quot;&gt;pattern
-       length&lt;/var&gt; bytes of the resource and the given mask (the
-       bytes in the cell of first column of that row), and let the
-       result be the &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;.&lt;/li&gt;
-
-       &lt;li&gt;If the bytes of the &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; matches the
-       given pattern bytes exactly, then the sniffed type of the
-       resource is the type given in the cell of the third column in
-       that row; abort these steps.&lt;/li&gt;
-
-      &lt;/ol&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;If the row has a &quot;&lt;em&gt;WS&lt;/em&gt;&quot; byte:&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt; be an
-       index into the mask and pattern byte strings of the
-       row.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt; be an
-       index into the byte stream being examined.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;&lt;em&gt;Loop&lt;/em&gt;: If &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt; points beyond the end of
-       the byte stream, then this row doesn't match, skip this
-       row.&lt;/li&gt;
-
-       &lt;li&gt;
-
-        &lt;p&gt;Examine the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt;th
-        byte of the byte stream as follows:&lt;/p&gt;
-
-        &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt;th byte
-         of the pattern is a normal hexadecimal byte and not a &quot;&lt;em&gt;WS&lt;/em&gt;&quot;
-         byte:&lt;/dt&gt;
-
-         &lt;dd&gt;
-
-          &lt;p&gt;If the &quot;and&quot; operator, applied to the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt;th byte of the stream
-          and the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt;th byte
-          of the mask, yield a value different that the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt;th byte of the
-          pattern, then skip this row.&lt;/p&gt;
-
-          &lt;p&gt;Otherwise, increment &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt; to the next byte in
-          the mask and pattern and &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt; to the next byte in
-          the byte stream.&lt;/p&gt;
-
-         &lt;/dd&gt;
-
-         &lt;dt&gt;Otherwise, if the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt;th byte of the pattern
-         is a &quot;&lt;em&gt;WS&lt;/em&gt;&quot; byte:&lt;/dt&gt;
-
-         &lt;dd&gt;
-
-          &lt;p&gt;&quot;&lt;em&gt;WS&lt;/em&gt;&quot; means &quot;whitespace&quot;, and allows insignificant
-          whitespace to be skipped when sniffing for a type
-          signature.&lt;/p&gt;
-
-          &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt;th byte
-          of the stream is one of 0x09 (ASCII TAB), 0x0A (ASCII LF),
-          0x0C (ASCII FF), 0x0D (ASCII CR), or 0x20 (ASCII space),
-          then increment only the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt; to the next byte in
-          the byte stream.&lt;/p&gt;
-
-          &lt;p&gt;Otherwise, increment only the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt; to the next byte in
-          the mask and pattern.&lt;/p&gt;
-
-         &lt;/dd&gt;
-
-        &lt;/dl&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt; does not
-       point beyond the end of the mask and pattern byte strings, then
-       jump back to the &lt;em&gt;loop&lt;/em&gt; step in this algorithm.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is the type
-       given in the cell of the third column in that row; abort these
-       steps.&lt;/li&gt;
-
-      &lt;/ol&gt;&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If none of the first &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; bytes of the
-   resource are &lt;a href=#binary-data-bytes&gt;binary data bytes&lt;/a&gt; then the sniffed type
-   of the resource is &quot;text/plain&quot;. Abort these steps.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is
-   &quot;application/octet-stream&quot;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;The table used by the above algorithm is:&lt;/p&gt;
-
-  &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th colspan=2&gt;Bytes in Hexadecimal
-     &lt;th rowspan=2&gt;Sniffed type
-     &lt;th rowspan=2&gt;Security
-     &lt;th rowspan=2&gt;Comment
-    &lt;tr&gt;&lt;th&gt;Mask
-     &lt;th&gt;Pattern
-   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;FF FF DF DF DF DF DF DF DF FF DF DF DF DF
-     &lt;td&gt;3C 21 44 4F 43 54 59 50 45 20 48 54 4D 4C &lt;!-- &quot;&lt;!DOCTYPE HTML&quot; --&gt; &lt;!-- common in static data --&gt;
-     &lt;td&gt;text/html
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;&lt;!DOCTYPE HTML&lt;/code&gt;&quot; in US-ASCII or compatible encodings, case-insensitively.
-    &lt;tr&gt;&lt;td&gt;FF FF DF DF DF DF
-     &lt;td&gt;&lt;em&gt;WS&lt;/em&gt; 3C 48 54 4D 4C &lt;!-- &quot;&lt;HTML&quot; --&gt; &lt;!-- common in static data --&gt;
-     &lt;td&gt;text/html
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;&lt;HTML&lt;/code&gt;&quot; in US-ASCII or compatible encodings, case-insensitively, possibly with leading spaces.
-    &lt;tr&gt;&lt;td&gt;FF FF DF DF DF DF
-     &lt;td&gt;&lt;em&gt;WS&lt;/em&gt; 3C 48 45 41 44 &lt;!-- &quot;&lt;HEAD&quot; --&gt; &lt;!-- common in static data --&gt;
-     &lt;td&gt;text/html
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;&lt;HEAD&lt;/code&gt;&quot; in US-ASCII or compatible encodings, case-insensitively, possibly with leading spaces.
-    &lt;tr&gt;&lt;td&gt;FF FF DF DF DF DF DF DF
-     &lt;td&gt;&lt;em&gt;WS&lt;/em&gt; 3C 53 43 52 49 50 54 &lt;!-- &quot;&lt;SCRIPT&quot; --&gt; &lt;!-- common in dynamic data --&gt;
-     &lt;td&gt;text/html
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;&lt;SCRIPT&lt;/code&gt;&quot; in US-ASCII or compatible encodings, case-insensitively, possibly with leading spaces.
-    &lt;tr&gt;&lt;td&gt;FF FF FF FF FF
-     &lt;td&gt;25 50 44 46 2D &lt;!-- &quot;%PDF-&quot; (from <A HREF="http://lxr.mozilla.org/seamonkey/source/netwerk/streamconv/converters/nsUnknownDecoder.cpp#321">http://lxr.mozilla.org/seamonkey/source/netwerk/streamconv/converters/nsUnknownDecoder.cpp#321</A>) --&gt;
-     &lt;td&gt;application/pdf
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;%PDF-&lt;/code&gt;&quot;, the PDF signature.
-    &lt;tr&gt;&lt;td&gt;FF FF FF FF FF FF FF FF FF FF FF
-     &lt;td&gt;25 21 50 53 2D 41 64 6F 62 65 2D &lt;!-- &quot;%!PS-Adobe-&quot; (from <A HREF="http://lxr.mozilla.org/seamonkey/source/netwerk/streamconv/converters/nsUnknownDecoder.cpp#321">http://lxr.mozilla.org/seamonkey/source/netwerk/streamconv/converters/nsUnknownDecoder.cpp#321</A>) --&gt;
-     &lt;td&gt;application/postscript
-     &lt;td&gt;Safe
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;%!PS-Adobe-&lt;/code&gt;&quot;, the PostScript signature.
-
-   &lt;!-- copied from the text or binary section above --&gt;
-   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;FF FF 00 00
-     &lt;td&gt;FE FF 00 00
-     &lt;td&gt;text/plain
-     &lt;td&gt;n/a
-     &lt;td&gt;UTF-16BE BOM &lt;!-- followed by at least one character --&gt;
-    &lt;tr&gt;&lt;td&gt;FF FF 00 00
-     &lt;td&gt;FF FF 00 00
-     &lt;td&gt;text/plain
-     &lt;td&gt;n/a
-     &lt;td&gt;UTF-16LE BOM &lt;!-- followed by at least one character --&gt;
-    &lt;tr&gt;&lt;td&gt;FF FF FF 00
-     &lt;td&gt;EF BB BF 00
-     &lt;td&gt;text/plain
-     &lt;td&gt;n/a
-     &lt;td&gt;UTF-8 BOM &lt;!-- followed by at least one character --&gt;
-
-   &lt;!-- based on the table in the image section below --&gt;
-   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;FF FF FF FF FF FF
-     &lt;td&gt;47 49 46 38 37 61 &lt;!-- GIF87a --&gt;
-     &lt;td&gt;image/gif
-     &lt;td&gt;Safe
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;GIF87a&lt;/code&gt;&quot;, a GIF signature.
-    &lt;tr&gt;&lt;td&gt;FF FF FF FF FF FF
-     &lt;td&gt;47 49 46 38 39 61 &lt;!-- GIF89a --&gt;
-     &lt;td&gt;image/gif
-     &lt;td&gt;Safe
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;GIF89a&lt;/code&gt;&quot;, a GIF signature.
-    &lt;tr&gt;&lt;td&gt;FF FF FF FF FF FF FF FF
-     &lt;td&gt;89 50 4E 47 0D 0A 1A 0A &lt;!-- [TAB]PNG[CR][LF][EOF][LF]; 137 80 78 71 13 10 26 10 --&gt;
-     &lt;td&gt;image/png
-     &lt;td&gt;Safe
-     &lt;td&gt;The PNG signature.
-    &lt;tr&gt;&lt;td&gt;FF FF FF
-     &lt;td&gt;FF D8 FF &lt;!-- SOI marker followed by the first byte of another marker --&gt;
-     &lt;td&gt;image/jpeg
-     &lt;td&gt;Safe
-     &lt;td&gt;A JPEG SOI marker followed by the first byte of another marker.
-    &lt;tr&gt;&lt;td&gt;FF FF
-     &lt;td&gt;42 4D
-     &lt;td&gt;image/bmp
-     &lt;td&gt;Safe
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;BM&lt;/code&gt;&quot;, a BMP signature.
-    &lt;tr&gt;&lt;td&gt;FF FF FF FF
-     &lt;td&gt;00 00 01 00
-     &lt;td&gt;image/vnd.microsoft.icon
-     &lt;td&gt;Safe
-     &lt;td&gt;A 0 word following by a 1 word, a Windows Icon file format signature.
-
-  &lt;/table&gt;&lt;p class=XXX&gt;I'd like to add types like MPEG, AVI, Flash,
-  Java, etc, to the above table.&lt;/p&gt;
-
-  &lt;p&gt;User agents may support further types if desired, by implicitly
-  adding to the above table. However, user agents should not use any
-  other patterns for types already mentioned in the table above, as
-  this could then be used for privilege escalation (where, e.g., a
-  server uses the above table to determine that content is not HTML
-  and thus safe from XSS attacks, but then a user agent detects it as
-  HTML anyway and allows script to execute).&lt;/p&gt;
-
-  &lt;p&gt;The column marked &quot;security&quot; is used by the algorithm in the
-  &quot;text or binary&quot; section, to avoid sniffing &lt;code title=&quot;&quot;&gt;text/plain&lt;/code&gt; content as a type that can be used for a
-  privilege escalation attack.&lt;/p&gt;
-
-
-  &lt;h4 id=content-type-sniffing:-image&gt;&lt;span class=secno&gt;2.7.5 &lt;/span&gt;&lt;dfn&gt;Content-Type sniffing: image&lt;/dfn&gt;&lt;/h4&gt;
-
-  &lt;p&gt;If the resource's &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; is
-  &quot;image/svg+xml&quot;, then the sniffed type of the resource is its &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; (an XML type).&lt;/p&gt;
-
-  &lt;p&gt;Otherwise, if the first bytes of the resource match one of the
-  byte sequences in the first column of the following table, then the
-  sniffed type of the resource is the type given in the corresponding
-  cell in the second column on the same row:&lt;/p&gt;
-
-  &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Bytes in Hexadecimal
-     &lt;th&gt;Sniffed type
-     &lt;th&gt;Comment
-
-   &lt;!-- update the table above if you change this! --&gt;
-   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;47 49 46 38 37 61 &lt;!-- GIF87a --&gt;
-     &lt;td&gt;image/gif
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;GIF87a&lt;/code&gt;&quot;, a GIF signature.
-    &lt;tr&gt;&lt;td&gt;47 49 46 38 39 61 &lt;!-- GIF89a --&gt;
-     &lt;td&gt;image/gif
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;GIF89a&lt;/code&gt;&quot;, a GIF signature.
-    &lt;tr&gt;&lt;td&gt;89 50 4E 47 0D 0A 1A 0A &lt;!-- [TAB]PNG[CR][LF][EOF][LF]; 137 80 78 71 13 10 26 10 --&gt;
-     &lt;td&gt;image/png
-     &lt;td&gt;The PNG signature.
-    &lt;tr&gt;&lt;td&gt;FF D8 FF &lt;!-- SOI marker followed by the first byte of another marker --&gt;
-     &lt;td&gt;image/jpeg
-     &lt;td&gt;A JPEG SOI marker followed by the first byte of another marker.
-    &lt;tr&gt;&lt;td&gt;42 4D
-     &lt;td&gt;image/bmp
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;BM&lt;/code&gt;&quot;, a BMP signature.
-    &lt;tr&gt;&lt;td&gt;00 00 01 00
-     &lt;td&gt;image/vnd.microsoft.icon
-     &lt;td&gt;A 0 word following by a 1 word, a Windows Icon file format signature.
-    &lt;!-- XXX Mozilla also detects ART (AOL proprietary format) and Windows Cursor files --&gt;
-  &lt;/table&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is the same as
-  its &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt;.&lt;/p&gt;
-
-
-  &lt;h4 id=content-type-sniffing:-feed-or-html&gt;&lt;span class=secno&gt;2.7.6 &lt;/span&gt;&lt;dfn&gt;Content-Type sniffing: feed or HTML&lt;/dfn&gt;&lt;/h4&gt;
-  &lt;!-- mostly based on:
-   <A HREF="http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx">http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx</A>
-   <A HREF="http://lxr.mozilla.org/seamonkey/source/browser/components/feeds/src/nsFeedSniffer.cpp#192">http://lxr.mozilla.org/seamonkey/source/browser/components/feeds/src/nsFeedSniffer.cpp#192</A>
-   <A HREF="http://lxr.mozilla.org/seamonkey/source/browser/components/feeds/src/nsFeedSniffer.cpp#127">http://lxr.mozilla.org/seamonkey/source/browser/components/feeds/src/nsFeedSniffer.cpp#127</A>
-  --&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;The user agent may wait for 512 or more bytes of the
-   resource to be available.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; be the stream of bytes, and let
-   &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;]&lt;/span&gt;
-   represent the byte in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; with position &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;, treating &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; as zero-indexed
-   (so the first byte is at &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;=0&lt;/span&gt;).&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If at any point this algorithm requires the user agent to
-   determine the value of a byte in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; which is not
-   yet available, or which is past the first 512 bytes of the
-   resource, or which is beyond the end of the resource, the user
-   agent must stop this algorithm, and assume that the sniffed type of
-   the resource is &quot;text/html&quot;.&lt;/p&gt;
-
-   &lt;p class=note&gt;User agents are allowed, by the first step of this
-   algorithm, to wait until the first 512 bytes of the resource are
-   available.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Initialize &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; to 0.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[0]&lt;/span&gt; is 0xEF,
-   &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[1]&lt;/span&gt; is 0xBB, and &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[2]&lt;/span&gt; is 0xBF, then set &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; to 3. (This skips over a leading UTF-8 BOM, if
-   any.)&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop start:&lt;/i&gt; Examine &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt;.&lt;/p&gt;
-
-   &lt;dl class=switch&gt;&lt;!-- skip whitespace (S token as defined in XML 1.0 section 2.3; production [3] --&gt;&lt;dt&gt;If it is 0x09 (ASCII tab), 0x20 (ASCII space), 0x0A (ASCII LF), or 0x0D (ASCII CR)&lt;/dt&gt;
-    &lt;dd&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1 and repeat this step.&lt;/dd&gt;
-
-    &lt;dt&gt;If it is 0x3C (ASCII &quot;&lt;code title=&quot;&quot;&gt;&lt;&lt;/code&gt;&quot;)&lt;/dt&gt;
-    &lt;dd&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1 and go to the next step.&lt;/dd&gt;
-
-    &lt;dt&gt;If it is anything else&lt;/dt&gt;
-    &lt;dd&gt;The sniffed type of the resource is &quot;text/html&quot;. Abort these
-    steps.&lt;/dd&gt;
-
-   &lt;/dl&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the bytes with positions &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; to
-   &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;+2&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; are
-   exactly equal to 0x21, 0x2D, 0x2D respectively (ASCII for &quot;&lt;code title=&quot;&quot;&gt;!--&lt;/code&gt;&quot;), then:&lt;/p&gt;
-
-    &lt;ol&gt;&lt;li&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 3.&lt;/li&gt; &lt;!-- skips past the &quot; ! - - &quot; --&gt;
-
-     &lt;li&gt;If the bytes with positions &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;&lt;/span&gt; to &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;+2&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; are exactly
-     equal to 0x2D, 0x2D, 0x3E respectively (ASCII for &quot;&lt;code title=&quot;&quot;&gt;--&gt;&lt;/code&gt;&quot;), then increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;
-     by 3 and jump back to the previous step (the step labeled
-     &lt;i&gt;loop start&lt;/i&gt;) in the overall algorithm in this section.&lt;/li&gt;
-
-     &lt;li&gt;Otherwise, increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1.&lt;/li&gt;
-
-     &lt;li&gt;Return to step 2 in these substeps.&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt; is 0x21 (ASCII &quot;&lt;code title=&quot;&quot;&gt;!&lt;/code&gt;&quot;):&lt;/p&gt;
-
-    &lt;!-- this skips past a DOCTYPE if there is one. It is brain-dead
-    because we don't have to be clever to parse the Atom and RSS x.y
-    DOCTYPEs, as they don't do anything clever like have internal
-    subsets or quoted &quot;&gt;&quot; characters. If this fails, then that's ok,
-    we'll treat it as HTML which is fine since we know it's not a feed
-    in that case. --&gt;
-
-    &lt;ol&gt;&lt;li&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1.&lt;/li&gt;
-
-     &lt;li&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt; equal 0x3E, then increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1 and jump back to the step labeled
-     &lt;i&gt;loop start&lt;/i&gt; in the overall algorithm in this section.&lt;/li&gt;
-
-     &lt;li&gt;Otherwise, return to step 1 in these substeps.&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt; is 0x3F (ASCII &quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;):&lt;/p&gt;
-
-    &lt;ol&gt;&lt;li&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1.&lt;/li&gt;
-
-     &lt;li&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt; and &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;+1]&lt;/span&gt; equal 0x3F and
-     0x3E respectively, then increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1 and
-     jump back to the step labeled &lt;i&gt;loop start&lt;/i&gt; in the overall
-     algorithm in this section.&lt;/li&gt;
-
-     &lt;li&gt;Otherwise, return to step 1 in these substeps.&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, if the bytes in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; starting at
-   &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; match any of the sequences of bytes in the
-   first column of the following table, then the user agent must
-   follow the steps given in the corresponding cell in the second
-   column of the same row.&lt;/p&gt;
-
-    &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Bytes in Hexadecimal
-       &lt;th&gt;Requirement
-       &lt;th&gt;Comment
-
-     &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;72 73 73
-       &lt;td&gt;The sniffed type of the resource is &quot;application/rss+xml&quot;; abort these steps
-       &lt;td&gt;The three ASCII characters &quot;&lt;code title=&quot;&quot;&gt;rss&lt;/code&gt;&quot;
-      &lt;tr&gt;&lt;td&gt;66 65 65 64
-       &lt;td&gt;The sniffed type of the resource is &quot;application/atom+xml&quot;; abort these steps
-       &lt;td&gt;The four ASCII characters &quot;&lt;code title=&quot;&quot;&gt;feed&lt;/code&gt;&quot;
-      &lt;tr&gt;&lt;td&gt;72 64 66 3A 52 44 46
-       &lt;td&gt;Continue to the next step in this algorithm
-       &lt;td&gt;The ASCII characters &quot;&lt;code title=&quot;&quot;&gt;rdf:RDF&lt;/code&gt;&quot;
-    &lt;/table&gt;&lt;p&gt;If none of the byte sequences above match the bytes in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; starting at &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;, then the
-    sniffed type of the resource is &quot;text/html&quot;. Abort these
-    steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p class=XXX&gt;If, before the next &quot;&gt;&quot;, you find two
-   xmlns* attributes with <A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>
-   and <A HREF="http://purl.org/rss/1.0/">http://purl.org/rss/1.0/</A> as the namespaces, then the sniffed
-   type of the resource is &quot;application/rss+xml&quot;, abort these
-   steps. (maybe we only need to check for <A HREF="http://purl.org/rss/1.0/">http://purl.org/rss/1.0/</A>
-   actually)&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is
-   &quot;text/html&quot;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p class=note&gt;For efficiency reasons, implementations may wish to
-  implement this algorithm and the algorithm for detecting the
-  character encoding of HTML documents in parallel.&lt;/p&gt;
-
   &lt;/div&gt;
 
+
   &lt;div class=impl&gt;
 
-  &lt;h3 id=character-encodings-0&gt;&lt;span class=secno&gt;2.8 &lt;/span&gt;Character encodings&lt;/h3&gt;
+  &lt;h3 id=character-encodings-0&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Character encodings&lt;/h3&gt;
 
   &lt;p&gt;User agents must at a minimum support the UTF-8 and Windows-1252
   encodings, but may support more.&lt;/p&gt;
@@ -6000,9 +5399,9 @@
   &lt;/div&gt;
 
 
-  &lt;h3 id=common-dom-interfaces&gt;&lt;span class=secno&gt;2.9 &lt;/span&gt;Common DOM interfaces&lt;/h3&gt;
+  &lt;h3 id=common-dom-interfaces&gt;&lt;span class=secno&gt;2.8 &lt;/span&gt;Common DOM interfaces&lt;/h3&gt;
 
-  &lt;h4 id=reflecting-content-attributes-in-dom-attributes&gt;&lt;span class=secno&gt;2.9.1 &lt;/span&gt;Reflecting content attributes in DOM attributes&lt;/h4&gt;
+  &lt;h4 id=reflecting-content-attributes-in-dom-attributes&gt;&lt;span class=secno&gt;2.8.1 &lt;/span&gt;Reflecting content attributes in DOM attributes&lt;/h4&gt;
 
   &lt;p&gt;Some &lt;span title=&quot;DOM attribute&quot;&gt;DOM attributes&lt;/span&gt; are
   defined to &lt;dfn id=reflect&gt;reflect&lt;/dfn&gt; a particular &lt;span&gt;content
@@ -6171,7 +5570,7 @@
   &lt;/div&gt;
 
 
-  &lt;h4 id=collections&gt;&lt;span class=secno&gt;2.9.2 &lt;/span&gt;Collections&lt;/h4&gt;
+  &lt;h4 id=collections&gt;&lt;span class=secno&gt;2.8.2 &lt;/span&gt;Collections&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#htmlcollection-0&gt;HTMLCollection&lt;/a&gt;&lt;/code&gt;,
   &lt;code&gt;&lt;a href=#htmlformcontrolscollection-0&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/code&gt;,
@@ -6207,7 +5606,7 @@
   &lt;/div&gt;
 
 
-  &lt;h5 id=htmlcollection&gt;&lt;span class=secno&gt;2.9.2.1 &lt;/span&gt;HTMLCollection&lt;/h5&gt;
+  &lt;h5 id=htmlcollection&gt;&lt;span class=secno&gt;2.8.2.1 &lt;/span&gt;HTMLCollection&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#htmlcollection-0&gt;HTMLCollection&lt;/a&gt;&lt;/code&gt; interface represents a generic
   &lt;a href=#collections-0 title=collections&gt;collection&lt;/a&gt; of elements.&lt;/p&gt;
@@ -6302,7 +5701,7 @@
   &lt;/div&gt;
 
 
-  &lt;h5 id=htmlformcontrolscollection&gt;&lt;span class=secno&gt;2.9.2.2 &lt;/span&gt;HTMLFormControlsCollection&lt;/h5&gt;
+  &lt;h5 id=htmlformcontrolscollection&gt;&lt;span class=secno&gt;2.8.2.2 &lt;/span&gt;HTMLFormControlsCollection&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#htmlformcontrolscollection-0&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/code&gt; interface represents
   a &lt;a href=#collections-0 title=collections&gt;collection&lt;/a&gt; of &lt;a href=#category-listed title=category-listed&gt;listed&lt;/a&gt; elements in &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt;
@@ -6435,7 +5834,7 @@
 --&gt;&lt;/div&gt;
 
 
-  &lt;h5 id=htmloptionscollection&gt;&lt;span class=secno&gt;2.9.2.3 &lt;/span&gt;HTMLOptionsCollection&lt;/h5&gt;
+  &lt;h5 id=htmloptionscollection&gt;&lt;span class=secno&gt;2.8.2.3 &lt;/span&gt;HTMLOptionsCollection&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#htmloptionscollection-0&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; interface represents a
   list of &lt;code&gt;&lt;a href=#the-option-element&gt;option&lt;/a&gt;&lt;/code&gt; elements. It is always rooted on a
@@ -6597,7 +5996,7 @@
   &lt;/ol&gt;&lt;!-- see also <A HREF="http://ln.hixie.ch/?start=1161042744&amp;count=1">http://ln.hixie.ch/?start=1161042744&amp;count=1</A> --&gt;&lt;/div&gt;
 
 
-  &lt;h5 id=htmlpropertycollection&gt;&lt;span class=secno&gt;2.9.2.4 &lt;/span&gt;HTMLPropertyCollection&lt;/h5&gt;
+  &lt;h5 id=htmlpropertycollection&gt;&lt;span class=secno&gt;2.8.2.4 &lt;/span&gt;HTMLPropertyCollection&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#htmlpropertycollection-0&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/code&gt; interface represents a
   &lt;a href=#collections-0 title=collections&gt;collection&lt;/a&gt; of elements that add
@@ -6702,7 +6101,7 @@
   &lt;/div&gt;
 
 
-  &lt;h4 id=domtokenlist&gt;&lt;span class=secno&gt;2.9.3 &lt;/span&gt;DOMTokenList&lt;/h4&gt;
+  &lt;h4 id=domtokenlist&gt;&lt;span class=secno&gt;2.8.3 &lt;/span&gt;DOMTokenList&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; interface represents an interface
   to an underlying string that consists of an &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;unordered set of
@@ -6867,7 +6266,7 @@
   &lt;/div&gt;
 
 
-  &lt;h4 id=domsettabletokenlist&gt;&lt;span class=secno&gt;2.9.4 &lt;/span&gt;DOMSettableTokenList&lt;/h4&gt;
+  &lt;h4 id=domsettabletokenlist&gt;&lt;span class=secno&gt;2.8.4 &lt;/span&gt;DOMSettableTokenList&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#domsettabletokenlist-0&gt;DOMSettableTokenList&lt;/a&gt;&lt;/code&gt; interface is the same as the
   &lt;code&gt;&lt;a href=#domtokenlist-0&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; interface, except that it allows the
@@ -6899,7 +6298,7 @@
 
   &lt;div class=impl&gt;
 
-  &lt;h4 id=safe-passing-of-structured-data&gt;&lt;span class=secno&gt;2.9.5 &lt;/span&gt;Safe passing of structured data&lt;/h4&gt;
+  &lt;h4 id=safe-passing-of-structured-data&gt;&lt;span class=secno&gt;2.8.5 &lt;/span&gt;Safe passing of structured data&lt;/h4&gt;
 
   &lt;p&gt;When a user agent is required to obtain a &lt;dfn id=structured-clone&gt;structured
   clone&lt;/dfn&gt; of an object, it must run the following algorithm, which
@@ -7014,7 +6413,7 @@
   &lt;/dl&gt;&lt;/div&gt;
 
 
-  &lt;h4 id=domstringmap&gt;&lt;span class=secno&gt;2.9.6 &lt;/span&gt;DOMStringMap&lt;/h4&gt;
+  &lt;h4 id=domstringmap&gt;&lt;span class=secno&gt;2.8.6 &lt;/span&gt;DOMStringMap&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#domstringmap-0&gt;DOMStringMap&lt;/a&gt;&lt;/code&gt; interface represents a set of
   name-value pairs. It exposes these using the scripting language's
@@ -7093,7 +6492,7 @@
   &lt;/div&gt;
 
 
-  &lt;h4 id=dom-feature-strings&gt;&lt;span class=secno&gt;2.9.7 &lt;/span&gt;DOM feature strings&lt;/h4&gt;
+  &lt;h4 id=dom-feature-strings&gt;&lt;span class=secno&gt;2.8.7 &lt;/span&gt;DOM feature strings&lt;/h4&gt;
 
   &lt;p&gt;DOM3 Core defines mechanisms for checking for interface support,
   and for obtaining implementations of interfaces, using &lt;a href=<A HREF="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures">http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures</A>&gt;feature
@@ -7123,7 +6522,7 @@
   not guaranteed that an implementation that supports &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; also supports &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; &quot;&lt;code&gt;2.0&lt;/code&gt;&quot;.&lt;/p&gt;
 
 
-  &lt;h4 id=exceptions&gt;&lt;span class=secno&gt;2.9.8 &lt;/span&gt;Exceptions&lt;/h4&gt;
+  &lt;h4 id=exceptions&gt;&lt;span class=secno&gt;2.8.8 &lt;/span&gt;Exceptions&lt;/h4&gt;
 
   &lt;p&gt;The following &lt;code&gt;DOMException&lt;/code&gt; codes are defined in DOM
   Core. &lt;a href=#refsDOMCORE&gt;[DOMCORE]&lt;/a&gt;&lt;/p&gt;
@@ -7157,7 +6556,7 @@
    &lt;li value=82&gt;&lt;dfn id=serialise_err&gt;&lt;code&gt;SERIALISE_ERR&lt;/code&gt;&lt;/dfn&gt;&lt;/li&gt; &lt;!-- actually defined in dom3ls --&gt;
   &lt;/ol&gt;&lt;div class=impl&gt;
 
-  &lt;h4 id=garbage-collection&gt;&lt;span class=secno&gt;2.9.9 &lt;/span&gt;Garbage collection&lt;/h4&gt;
+  &lt;h4 id=garbage-collection&gt;&lt;span class=secno&gt;2.8.9 &lt;/span&gt;Garbage collection&lt;/h4&gt;
 
   &lt;p&gt;There is an &lt;dfn id=implied-strong-reference&gt;implied strong reference&lt;/dfn&gt; from any DOM
   attribute that returns a pre-existing object to that object.&lt;/p&gt;
@@ -10641,21 +10040,21 @@
   aforementioned assumed type.&lt;/p&gt;
 
   &lt;p id=concept-link-type-sniffing&gt;If the external resource link
-  type defines rules for processing the resource's &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt;, then those rules
+  type defines rules for processing the resource's &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt;, then those rules
   apply. Otherwise, if the resource is expected to be an image, user
   agents may apply the &lt;a href=#content-type-sniffing:-image title=&quot;Content-Type sniffing:
   image&quot;&gt;image sniffing rules&lt;/a&gt;, with the &lt;var title=&quot;&quot;&gt;official
-  type&lt;/var&gt; being the type determined from the resource's &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt;, and use the
+  type&lt;/var&gt; being the type determined from the resource's &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt;, and use the
   resulting sniffed type of the resource as if it was the actual
   type. Otherwise, if neither of these conditions apply or if the user
   agent opts not to apply the image sniffing rules, then the user
-  agent must use the resource's &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt; to determine the
+  agent must use the resource's &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; to determine the
   type of the resource. If there is no type metadata, but the external
   resource link type has a default type defined, then the user agent
   must assume that the resource is of that type.&lt;/p&gt;
 
   &lt;p class=note&gt;The &lt;code title=link-type-stylesheet&gt;stylesheet&lt;/code&gt; link type defines
-  rules for processing the resource's &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt;.&lt;/p&gt;
+  rules for processing the resource's &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;Once the user agent has established the type of the resource, the
   user agent must apply the resource if it is of a supported type and
@@ -10681,7 +10080,7 @@
    &lt;code&gt;text/plain&lt;/code&gt;, or any other type, it would not.&lt;/p&gt;
 
    &lt;p&gt;If one the two files was returned without a
-   &lt;a href=#content-type-0&gt;Content-Type&lt;/a&gt; metadata, or with a syntactically
+   &lt;a href=#content-type&gt;Content-Type&lt;/a&gt; metadata, or with a syntactically
    incorrect type like &lt;code title=&quot;&quot;&gt;Content-Type:&nbsp;&quot;null&quot;&lt;/code&gt;, then the default type
    for &lt;code title=rel-stylesheet&gt;&lt;a href=#link-type-stylesheet&gt;stylesheet&lt;/a&gt;&lt;/code&gt; links would kick
    in. Since that default type is &lt;code title=&quot;&quot;&gt;text/css&lt;/code&gt;, the
@@ -11361,7 +10760,7 @@
 
   &lt;/ul&gt;&lt;p&gt;If an &lt;a href=#html-documents title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt; does not
   start with a BOM, and if its encoding is not explicitly given by
-  &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt;, then the
+  &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt;, then the
   character encoding used must be an &lt;a href=#ascii-compatible-character-encoding&gt;ASCII-compatible character
   encoding&lt;/a&gt;, and, in addition, if that encoding isn't US-ASCII
   itself, then the encoding must be specified using a
@@ -11573,7 +10972,7 @@
    type. For &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt; elements, this is the same as the
    &lt;code title=attr-style-type&gt;&lt;a href=#attr-style-type&gt;type&lt;/a&gt;&lt;/code&gt; content attribute's
    value, or &lt;code title=&quot;&quot;&gt;text/css&lt;/code&gt; if that is omitted. For
-   &lt;code&gt;&lt;a href=#the-link-element&gt;link&lt;/a&gt;&lt;/code&gt; elements, this is the &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata of the specified
+   &lt;code&gt;&lt;a href=#the-link-element&gt;link&lt;/a&gt;&lt;/code&gt; elements, this is the &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata of the specified
    resource&lt;/a&gt;.&lt;/dd&gt;
 
    &lt;dt&gt;The location (&lt;code title=dom-stylesheet-href&gt;href&lt;/code&gt; DOM attribute)&lt;/dt&gt;
@@ -11713,7 +11112,7 @@
   attribute is set, its value must be a valid character encoding name,
   must be the preferred name for that encoding, and must match the
   encoding given in the &lt;code title=&quot;&quot;&gt;charset&lt;/code&gt; parameter of the
-  &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the
+  &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the
   external file, if any. &lt;a href=#refsIANACHARSET&gt;[IANACHARSET]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=attr-script-async title=attr-script-async&gt;&lt;code&gt;async&lt;/code&gt;&lt;/dfn&gt; and
@@ -11862,7 +11261,7 @@
     agent must act as if it had received an empty HTTP 400
     response.&lt;/p&gt;
 
-    &lt;p&gt;Once the resource's &lt;a href=#content-type-0 title=Content-Type&gt;Content Type
+    &lt;p&gt;Once the resource's &lt;a href=#content-type title=Content-Type&gt;Content Type
     metadata&lt;/a&gt; is available, if it ever is, apply the
     &lt;a href=#algorithm-for-extracting-an-encoding-from-a-content-type&gt;algorithm for extracting an encoding from a
     Content-Type&lt;/a&gt; to it. If this returns an encoding, and the
@@ -17552,10 +16951,10 @@
 
   &lt;p&gt;The user agents should apply the &lt;a href=#content-type-sniffing:-image title=&quot;Content-Type
   sniffing: image&quot;&gt;image sniffing rules&lt;/a&gt; to determine the type
-  of the image, with the image's &lt;a href=#content-type-0 title=Content-Type&gt;associated
+  of the image, with the image's &lt;a href=#content-type title=Content-Type&gt;associated
   Content-Type headers&lt;/a&gt; giving the &lt;var title=&quot;&quot;&gt;official
   type&lt;/var&gt;. If these rules are not applied, then the type of the
-  image must be the type given by the image's &lt;a href=#content-type-0 title=Content-Type&gt;associated Content-Type headers&lt;/a&gt;.&lt;/p&gt;
+  image must be the type given by the image's &lt;a href=#content-type title=Content-Type&gt;associated Content-Type headers&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;User agents must not support non-image resources with the
   &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element (e.g. XML files whose root element is an
@@ -19269,7 +18668,7 @@
   parameters. If both the &lt;code title=attr-embed-type&gt;&lt;a href=#attr-embed-type&gt;type&lt;/a&gt;&lt;/code&gt;
   attribute and the &lt;code title=attr-embed-src&gt;&lt;a href=#attr-embed-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute
   are present, then the &lt;code title=attr-embed-type&gt;&lt;a href=#attr-embed-type&gt;type&lt;/a&gt;&lt;/code&gt;
-  attribute must specify the same type as the &lt;a href=#content-type-0 title=Content-Type&gt;explicit Content-Type metadata&lt;/a&gt; of the
+  attribute must specify the same type as the &lt;a href=#content-type title=Content-Type&gt;explicit Content-Type metadata&lt;/a&gt; of the
   resource given by the &lt;code title=attr-embed-src&gt;&lt;a href=#attr-embed-src&gt;src&lt;/a&gt;&lt;/code&gt;
   attribute. &lt;a href=#refsRFC2046&gt;[RFC2046]&lt;/a&gt;&lt;/p&gt;
 
@@ -19357,7 +18756,7 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Otherwise, if the specified resource has &lt;a href=#content-type-0 title=Content-Type&gt;explicit Content-Type metadata&lt;/a&gt;, then
+   &lt;li&gt;&lt;p&gt;Otherwise, if the specified resource has &lt;a href=#content-type title=Content-Type&gt;explicit Content-Type metadata&lt;/a&gt;, then
    that is the &lt;span&gt;content's type&lt;/span&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Otherwise, the content has no type and there can be no
@@ -19594,8 +18993,8 @@
 
        &lt;li&gt;
 
-        &lt;p&gt;If the resource has &lt;a href=#content-type-0 title=Content-Type&gt;associated
-        Content-Type metadata&lt;/a&gt;, then let the &lt;var title=&quot;&quot;&gt;resource type&lt;/var&gt; be the type specified in &lt;a href=#content-type-0 title=Content-Type&gt;the resource's Content-Type
+        &lt;p&gt;If the resource has &lt;a href=#content-type title=Content-Type&gt;associated
+        Content-Type metadata&lt;/a&gt;, then let the &lt;var title=&quot;&quot;&gt;resource type&lt;/var&gt; be the type specified in &lt;a href=#content-type title=Content-Type&gt;the resource's Content-Type
         metadata&lt;/a&gt;.&lt;/p&gt;
 
        &lt;/li&gt;
@@ -21217,7 +20616,7 @@
      to network errors, causing the user agent to give up trying to
      fetch the resource&lt;/dt&gt;
 
-     &lt;dt&gt;If the &lt;a href=#media-resource&gt;media resource&lt;/a&gt; is found to have &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt; that, when
+     &lt;dt&gt;If the &lt;a href=#media-resource&gt;media resource&lt;/a&gt; is found to have &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; that, when
      parsed as a MIME type (including any codecs described by the
      &lt;code title=&quot;&quot;&gt;codec&lt;/code&gt; parameter), represents &lt;a href=#a-type-that-the-user-agent-knows-it-cannot-render&gt;a type
      that the user agent knows it cannot render&lt;/a&gt; (even if the
@@ -32634,10 +32033,10 @@
 
   &lt;p&gt;The user agents should apply the &lt;a href=#content-type-sniffing:-image title=&quot;Content-Type
   sniffing: image&quot;&gt;image sniffing rules&lt;/a&gt; to determine the type
-  of the image, with the image's &lt;a href=#content-type-0 title=Content-Type&gt;associated
+  of the image, with the image's &lt;a href=#content-type title=Content-Type&gt;associated
   Content-Type headers&lt;/a&gt; giving the &lt;var title=&quot;&quot;&gt;official
   type&lt;/var&gt;. If these rules are not applied, then the type of the
-  image must be the type given by the image's &lt;a href=#content-type-0 title=Content-Type&gt;associated Content-Type headers&lt;/a&gt;.&lt;/p&gt;
+  image must be the type given by the image's &lt;a href=#content-type title=Content-Type&gt;associated Content-Type headers&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;User agents must not support non-image resources with the
   &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; element. User agents must not run executable code
@@ -47919,11 +47318,11 @@
     to an HTTP resource with an HTTP 204 No Content response.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, the URL must be treated in a manner equivalent to an
-    HTTP resource with a 200 OK response whose &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt; is &lt;code title=&quot;&quot;&gt;text/html&lt;/code&gt; and whose response body is the return
+    HTTP resource with a 200 OK response whose &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; is &lt;code title=&quot;&quot;&gt;text/html&lt;/code&gt; and whose response body is the return
     value converted to a string value.&lt;/p&gt;
 
     &lt;p class=note&gt;Certain contexts, in particular &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt;
-    elements, ignore the &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type
+    elements, ignore the &lt;a href=#content-type title=Content-Type&gt;Content-Type
     metadata&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -51960,7 +51359,7 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the document's out-of-band metadata (e.g. HTTP headers),
-   not counting any &lt;a href=#content-type-0 title=Content-Type&gt;type information&lt;/a&gt;
+   not counting any &lt;a href=#content-type title=Content-Type&gt;type information&lt;/a&gt;
    (such as the Content-Type HTTP header), requires some sort of
    processing that will not affect the browsing context, then perform
    that processing and abort these steps.&lt;/p&gt;
@@ -52162,7 +51561,7 @@
 
   &lt;p class=note&gt;The &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; converts bytes into
   characters for use in the &lt;a href=#tokenization title=tokenization&gt;tokenizer&lt;/a&gt;. This process relies, in part,
-  on character encoding information found in the real &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the resource;
+  on character encoding information found in the real &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the resource;
   the &quot;sniffed type&quot; is not used for this purpose.&lt;/p&gt;
 
   &lt;!-- next two paragraphs are nearly identical to the navigate-text
@@ -53638,7 +53037,7 @@
   &lt;div class=impl&gt;
 
   &lt;p&gt;&lt;strong&gt;Quirk:&lt;/strong&gt; If the document has been set to
-  &lt;a href=#quirks-mode&gt;quirks mode&lt;/a&gt; and the &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the external
+  &lt;a href=#quirks-mode&gt;quirks mode&lt;/a&gt; and the &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the external
   resource is not a supported style sheet type, the user agent must
   instead assume it to be &lt;code title=&quot;&quot;&gt;text/css&lt;/code&gt;.&lt;/p&gt;
 
@@ -59399,7 +58798,7 @@
   algorithm (the &lt;dfn id=encoding-sniffing-algorithm&gt;encoding sniffing algorithm&lt;/dfn&gt;) to determine
   the character encoding to use when decoding a document in the first
   pass. This algorithm takes as input any out-of-band metadata
-  available to the user agent (e.g. the &lt;a href=#content-type-0 title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the document)
+  available to the user agent (e.g. the &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the document)
   and all the bytes available so far, and returns an encoding and a
   &lt;dfn id=concept-encoding-confidence title=concept-encoding-confidence&gt;confidence&lt;/dfn&gt;. The
   confidence is either &lt;i&gt;tentative&lt;/i&gt;, &lt;i&gt;certain&lt;/i&gt;, or

Modified: source
===================================================================
--- source	2009-06-12 19:46:29 UTC (rev 3233)
+++ source	2009-06-12 21:58:16 UTC (rev 3234)
@@ -4969,794 +4969,43 @@
 
   &lt;/div&gt;
 
-  &lt;/div&gt;
 
+  &lt;h4 id=&quot;content-type-sniffing&quot;&gt;Determining the type of a resource&lt;/h4&gt;
 
-  &lt;div class=&quot;impl&quot;&gt;
+  &lt;!-- MIMESNIFF = <A HREF="http://tools.ietf.org/html/draft-abarth-mime-sniff">http://tools.ietf.org/html/draft-abarth-mime-sniff</A> --&gt;
 
-  &lt;h3 id=&quot;content-type-sniffing&quot;&gt;Determining the type of a resource&lt;/h3&gt;
+  &lt;p&gt;The &lt;dfn title=&quot;Content-Type&quot;&gt;Content-Type metadata&lt;/dfn&gt; of a
+  resource must be obtained and interpreted in a manner consistent
+  with the requirements of the Content-Type Processing Model
+  specification. &lt;a href=&quot;#refsMIMESNIFF&quot;&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p class=&quot;warning&quot;&gt;It is imperative that the rules in this section
-  be followed exactly. When a user agent uses different heuristics for
-  content type detection than the server expects, security problems
-  can occur. For example, if a server believes that the client will
-  treat a contributed file as an image (and thus treat it as benign),
-  but a Web browser believes the content to be HTML (and thus execute
-  any scripts contained therein), the end user can be exposed to
-  malicious content, making the user vulnerable to cookie theft
-  attacks and other cross-site scripting attacks.&lt;/p&gt;
-
-
-  &lt;h4 id=&quot;content-type&quot;&gt;Content-Type metadata&lt;/h4&gt;
-
-  &lt;p&gt;What explicit &lt;dfn title=&quot;Content-Type&quot;&gt;Content-Type
-  metadata&lt;/dfn&gt; is associated with the resource (the resource's type
-  information) depends on the protocol that was used to
-  &lt;span&gt;fetch&lt;/span&gt; the resource.&lt;/p&gt;
-
-  &lt;p&gt;For HTTP resources, only the first Content-Type HTTP header, if
-  any, contributes any type information; the explicit type of the
-  resource is then the value of that header, interpreted as described
-  by the HTTP specifications. If the Content-Type HTTP header is
-  present but the value of the first such header cannot be interpreted
-  as described by the HTTP specifications (e.g. because its value
-  doesn't contain a U+002F SOLIDUS ('/') character), then the resource
-  has no type information (even if there are multiple Content-Type
-  HTTP headers and one of the other ones is syntactically correct). &lt;a
-  href=&quot;#refsHTTP&quot;&gt;[HTTP]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;For resources fetched from the file system, user agents should use
-  platform-specific conventions, e.g. operating system extension/type
-  mappings.&lt;/p&gt;
-
-  &lt;p&gt;Extensions must not be used for determining resource types for
-  resources fetched over HTTP.&lt;/p&gt;
-
-  &lt;p&gt;For resources fetched over most other protocols, e.g. FTP, there
-  is no type information.&lt;/p&gt;
-
-
   &lt;p&gt;The &lt;dfn&gt;algorithm for extracting an encoding from a
-  Content-Type&lt;/dfn&gt;, given a string &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, is as
-  follows. It either returns an encoding or nothing.&lt;/p&gt;
+  Content-Type&lt;/dfn&gt;, given a string &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, is given
+  in the Content-Type Processing Model specification. It either
+  returns an encoding or nothing. &lt;a
+  href=&quot;#refsMIMESNIFF&quot;&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Find the first seven characters in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;
-   that are an &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the word
-   &quot;charset&quot;. If no such match is found, return nothing.&lt;/p&gt;
-
-   &lt;li&gt;&lt;p&gt;Skip any U+0009, U+000A, U+000C, U+000D, or U+0020
-   characters that immediately follow the word 'charset' (there might
-   not be any).&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the next character is not a U+003D EQUALS SIGN ('='),
-   return nothing.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Skip any U+0009, U+000A, U+000C, U+000D, or U+0020
-   characters that immediately follow the equals sign (there might not
-   be any).&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Process the next character as follows:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If it is a U+0022 QUOTATION MARK ('&quot;') and there is a later
-     U+0022 QUOTATION MARK ('&quot;') in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dt&gt;If it is a U+0027 APOSTROPHE (&quot;'&quot;) and there is a later
-     U+0027 APOSTROPHE (&quot;'&quot;) in  &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Return the string between this character and the next
-     earliest occurrence of this character.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If it is an unmatched U+0022 QUOTATION MARK ('&quot;')&lt;/dt&gt;
-     &lt;dt&gt;If it is an unmatched U+0027 APOSTROPHE (&quot;'&quot;)&lt;/dt&gt;
-     &lt;dt&gt;If there is no next character&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Return nothing.&lt;/dd&gt;
-
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Return the string from this character to the first U+0009,
-     U+000A, U+000C, U+000D, U+0020, or U+003B character or the end of
-     &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, whichever comes first.&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The above algorithm is a &lt;span&gt;willful
-  violation&lt;/span&gt; of the HTTP specification, which requires that the
-  Content-Type headers be honored, despite implementation experience
-  showing that this is not pratical in many cases. &lt;a
-  href=&quot;#refsHTTP&quot;&gt;[HTTP]&lt;/a&gt;&lt;/p&gt;
-
-
-  &lt;h4&gt;Content-Type sniffing: Web pages&lt;/h4&gt;
-
   &lt;p&gt;The &lt;dfn title=&quot;Content-Type sniffing&quot;&gt;sniffed type of a
-  resource&lt;/dfn&gt; must be found as follows:&lt;/p&gt;
+  resource&lt;/dfn&gt; must be found in a manner consistent with the
+  requirements given in the Content-Type Processing Model
+  specification for finding that &lt;i&gt;sniffed type&lt;/i&gt;. &lt;a
+  href=&quot;#refsMIMESNIFF&quot;&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;ol&gt;
+  &lt;p&gt;The &lt;dfn title=&quot;Content-Type sniffing: image&quot;&gt;rules for sniffing
+  images specifically&lt;/dfn&gt; are also defined in the Content-Type
+  Processing Model specification. &lt;a
+  href=&quot;#refsMIMESNIFF&quot;&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;If the user agent is configured to strictly obey
-   Content-Type headers for this resource, then jump to the last step
-   in this set of steps.&lt;/p&gt;&lt;/li&gt;
+  &lt;p class=&quot;warning&quot;&gt;It is imperative that the rules in the
+  Content-Type Processing Model specification be followed
+  exactly. When a user agent uses different heuristics for content
+  type detection than the server expects, security problems can
+  occur. For more details, see the Content-Type Processing Model
+  specification. &lt;a href=&quot;#refsMIMESNIFF&quot;&gt;[MIMESNIFF]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;If the resource was fetched over an HTTP protocol and there
-   is an HTTP Content-Type header and the value of the first such
-   header has bytes that exactly match one of the following lines:&lt;/p&gt;
-
-    &lt;table&gt;
-     &lt;thead&gt;
-      &lt;tr&gt;
-       &lt;th&gt;Bytes in Hexadecimal
-       &lt;th&gt;Textual representation
-     &lt;tbody&gt;
-      &lt;tr&gt; &lt;!-- Very old Apache default --&gt;
-       &lt;td&gt;74 65 78 74 2f 70 6c 61 69 6e
-       &lt;td&gt;&lt;code title=&quot;&quot;&gt;text/plain&lt;/code&gt;
-      &lt;tr&gt; &lt;!-- Old Apache default --&gt;
-       &lt;td&gt;74 65 78 74 2f 70 6c 61 69 6e 3b 20 63 68 61 72 73 65 74 3d 49 53 4f 2d 38 38 35 39 2d 31
-       &lt;td&gt;&lt;code title=&quot;&quot;&gt;text/plain;&nbsp;charset=ISO-8859-1&lt;/code&gt;
-      &lt;tr&gt; &lt;!-- Debian's arbitrarily different Apache default --&gt;
-       &lt;td&gt;74 65 78 74 2f 70 6c 61 69 6e 3b 20 63 68 61 72 73 65 74 3d 69 73 6f 2d 38 38 35 39 2d 31
-       &lt;td&gt;&lt;code title=&quot;&quot;&gt;text/plain;&nbsp;charset=iso-8859-1&lt;/code&gt;
-      &lt;tr&gt; &lt;!-- Someone else's arbitrarily different Apache default (who?) --&gt;
-       &lt;td&gt;74 65 78 74 2f 70 6c 61 69 6e 3b 20 63 68 61 72 73 65 74 3d 55 54 46 2d 38
-       &lt;td&gt;&lt;code title=&quot;&quot;&gt;text/plain;&nbsp;charset=UTF-8&lt;/code&gt;
-    &lt;/table&gt;
-
-    &lt;p&gt;...then jump to the &lt;i title=&quot;content-type sniffing: text or
-    binary&quot;&gt;text or binary&lt;/i&gt; section below.&lt;/p&gt;
-
-    &lt;!-- while IE sniffs all text/plain, this will continue to grow as
-    people add new defaults. Hopefully IE will stop the madness in due
-    course and stop sniffing anything but the above... --&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; be the type given by
-   the &lt;span title=&quot;Content-Type&quot;&gt;Content-Type metadata&lt;/span&gt; for the
-   resource, ignoring parameters. If there is no such type, jump to
-   the &lt;i title=&quot;content-type sniffing: unknown type&quot;&gt;unknown type&lt;/i&gt;
-   step below. Comparisons with this type, as defined by MIME
-   specifications, are done in an &lt;span&gt;ASCII case-insensitive&lt;/span&gt;
-   manner. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; is &quot;unknown/unknown&quot; or
-   &quot;application/unknown&quot;, jump to the &lt;i title=&quot;content-type sniffing:
-   unknown type&quot;&gt;unknown type&lt;/i&gt; step below.&lt;/p&gt; &lt;!-- In a study
-   looking at many billions of pages whose first five characters were
-   &quot;&lt;HTML&quot;, &quot;unknown/unknown&quot; was used to label documents about once
-   for every 5000 pages labeled &quot;text/html&quot;, and &quot;application/unknown&quot;
-   was used about once for every 35000 pages labeled
-   &quot;text/html&quot;. --&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; ends in &quot;+xml&quot;, or if
-   it is either &quot;text/xml&quot; or &quot;application/xml&quot;, then the sniffed
-   type of the resource is &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt;; return
-   that and abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; is an image type
-   supported by the user agent (e.g. &quot;image/png&quot;, &quot;image/gif&quot;,
-   &quot;image/jpeg&quot;, etc), then jump to the &lt;i title=&quot;content-type
-   sniffing: image&quot;&gt;images&lt;/i&gt; section below, passing it the &lt;var
-   title=&quot;&quot;&gt;official type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; is &quot;text/html&quot;, then
-   jump to the &lt;i title=&quot;content-type sniffing: feed or html&quot;&gt;feed or
-   HTML&lt;/i&gt; section below.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;The sniffed type of the resource is &lt;var title=&quot;&quot;&gt;official
-   type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-
-  &lt;h4&gt;&lt;dfn&gt;Content-Type sniffing: text or binary&lt;/dfn&gt;&lt;/h4&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;The user agent may wait for 512 or more bytes of the resource
-   to be available.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; be the smaller of either 512 or
-   the number of bytes already available.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is 4 or more, and the first bytes of
-    the resource match one of the following byte sets:&lt;/p&gt;
-
-    &lt;!-- this table is present in several forms in this file; keep them in sync --&gt;
-    &lt;table&gt;
-     &lt;thead&gt;
-      &lt;tr&gt;
-       &lt;th&gt;Bytes in Hexadecimal
-       &lt;th&gt;Description
-     &lt;tbody&gt;
-      &lt;tr&gt;
-       &lt;td&gt;FE FF
-       &lt;td&gt;UTF-16BE BOM &lt;!-- followed by a character --&gt;&lt;!-- nobody uses this: or UTF-32LE BOM --&gt;
-      &lt;tr&gt;
-       &lt;td&gt;FF FE
-       &lt;td&gt;UTF-16LE BOM &lt;!-- followed by a character --&gt;
-&lt;!-- nobody uses this
-      &lt;tr&gt;
-       &lt;td&gt;00 00 FE FF
-       &lt;td&gt;UTF-32BE BOM
---&gt;
-&lt;!-- this one is redundant with the one above
-      &lt;tr&gt;
-       &lt;td&gt;FF FE 00 00
-       &lt;td&gt;UTF-32LE BOM
---&gt;
-      &lt;tr&gt;
-       &lt;td&gt;EF BB BF
-       &lt;td&gt;UTF-8 BOM &lt;!-- followed by a character, or the first byte of a multiple character sequence --&gt;
-&lt;!-- nobody uses this
-      &lt;tr&gt;
-       &lt;td&gt;DD 73 66 73
-       &lt;td&gt;UTF-EBCDIC BOM
---&gt;
-    &lt;/table&gt;
-
-    &lt;p&gt;...then the sniffed type of the resource is &quot;text/plain&quot;. Abort
-    these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If none of the first &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; bytes of the
-   resource are &lt;span&gt;binary data bytes&lt;/span&gt; then the sniffed type
-   of the resource is &quot;text/plain&quot;. Abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the first bytes of the resource match one of the byte
-    sequences in the &quot;pattern&quot; column of the table in the &lt;i
-    title=&quot;content-type sniffing: unknown type&quot;&gt;unknown type&lt;/i&gt;
-    section below, ignoring any rows whose cell in the &quot;security&quot;
-    column says &quot;scriptable&quot; (or &quot;n/a&quot;), then the sniffed type of the
-    resource is the type given in the corresponding cell in the
-    &quot;sniffed type&quot; column on that row; abort these steps.&lt;/p&gt;
-
-    &lt;p class=&quot;warning&quot;&gt;It is critical that this step not ever return a
-    scriptable type (e.g. text/html), as otherwise that would allow a
-    privilege escalation attack.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is
-   &quot;application/octet-stream&quot;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;Bytes covered by the following ranges are &lt;dfn&gt;binary data
-  bytes&lt;/dfn&gt;:&lt;/p&gt;
-
-  &lt;!-- This byte list is based on RFC 2046 Section 4.1.2. Characters
-  in the range 0x00-0x1F, with the exception of 0x09, 0x0A, 0x0C, 0x0D
-  (ASCII for TAB, LF, FF, and CR), and character 0x1B (reportedly used
-  by some encodings as a shift escape), are invalid. Thus, if we see
-  them, we assume it's not text. --&gt;
-
-  &lt;ul class=&quot;brief&quot;&gt;
-   &lt;li&gt; 0x00 - 0x08 &lt;/li&gt;
-   &lt;li&gt; 0x0B &lt;/li&gt;
-   &lt;li&gt; 0x0E - 0x1A &lt;/li&gt;
-   &lt;li&gt; 0x1C - 0x1F &lt;/li&gt;
-  &lt;/ul&gt;
-
-
-
-  &lt;h4&gt;&lt;dfn&gt;Content-Type sniffing: unknown type&lt;/dfn&gt;&lt;/h4&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;The user agent may wait for 512 or more bytes of the
-   resource to be available.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;stream length&lt;/var&gt; be the smaller of
-   either 512 or the number of bytes already available.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;For each row in the table below:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the row has no &quot;&lt;em&gt;WS&lt;/em&gt;&quot; bytes:&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;
-
-       &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;pattern length&lt;/var&gt; be the length of the
-       pattern (number of bytes described by the cell in the second
-       column of the row).&lt;/li&gt;
-
-       &lt;li&gt;If &lt;var title=&quot;&quot;&gt;stream length&lt;/var&gt; is smaller than &lt;var
-       title=&quot;&quot;&gt;pattern length&lt;/var&gt; then skip this row.&lt;/li&gt;
-
-       &lt;li&gt;Apply the &quot;and&quot; operator to the first &lt;var title=&quot;&quot;&gt;pattern
-       length&lt;/var&gt; bytes of the resource and the given mask (the
-       bytes in the cell of first column of that row), and let the
-       result be the &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;.&lt;/li&gt;
-
-       &lt;li&gt;If the bytes of the &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; matches the
-       given pattern bytes exactly, then the sniffed type of the
-       resource is the type given in the cell of the third column in
-       that row; abort these steps.&lt;/li&gt;
-
-      &lt;/ol&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;If the row has a &quot;&lt;em&gt;WS&lt;/em&gt;&quot; byte:&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;
-
-       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt; be an
-       index into the mask and pattern byte strings of the
-       row.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt; be an
-       index into the byte stream being examined.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;&lt;em&gt;Loop&lt;/em&gt;: If &lt;var
-       title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt; points beyond the end of
-       the byte stream, then this row doesn't match, skip this
-       row.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;
-
-        &lt;p&gt;Examine the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt;th
-        byte of the byte stream as follows:&lt;/p&gt;
-
-        &lt;dl class=&quot;switch&quot;&gt;
-
-         &lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt;th byte
-         of the pattern is a normal hexadecimal byte and not a &quot;&lt;em&gt;WS&lt;/em&gt;&quot;
-         byte:&lt;/dt&gt;
-
-         &lt;dd&gt;
-
-          &lt;p&gt;If the &quot;and&quot; operator, applied to the &lt;var
-          title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt;th byte of the stream
-          and the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt;th byte
-          of the mask, yield a value different that the &lt;var
-          title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt;th byte of the
-          pattern, then skip this row.&lt;/p&gt;
-
-          &lt;p&gt;Otherwise, increment &lt;var
-          title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt; to the next byte in
-          the mask and pattern and &lt;var
-          title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt; to the next byte in
-          the byte stream.&lt;/p&gt;
-
-         &lt;/dd&gt;
-
-         &lt;dt&gt;Otherwise, if the &lt;var
-         title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt;th byte of the pattern
-         is a &quot;&lt;em&gt;WS&lt;/em&gt;&quot; byte:&lt;/dt&gt;
-
-         &lt;dd&gt;
-
-          &lt;p&gt;&quot;&lt;em&gt;WS&lt;/em&gt;&quot; means &quot;whitespace&quot;, and allows insignificant
-          whitespace to be skipped when sniffing for a type
-          signature.&lt;/p&gt;
-
-          &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt;th byte
-          of the stream is one of 0x09 (ASCII TAB), 0x0A (ASCII LF),
-          0x0C (ASCII FF), 0x0D (ASCII CR), or 0x20 (ASCII space),
-          then increment only the &lt;var
-          title=&quot;&quot;&gt;index&lt;sub&gt;stream&lt;/sub&gt;&lt;/var&gt; to the next byte in
-          the byte stream.&lt;/p&gt;
-
-          &lt;p&gt;Otherwise, increment only the &lt;var
-          title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt; to the next byte in
-          the mask and pattern.&lt;/p&gt;
-
-         &lt;/dd&gt;
-
-        &lt;/dl&gt;
-
-       &lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;index&lt;sub&gt;pattern&lt;/sub&gt;&lt;/var&gt; does not
-       point beyond the end of the mask and pattern byte strings, then
-       jump back to the &lt;em&gt;loop&lt;/em&gt; step in this algorithm.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is the type
-       given in the cell of the third column in that row; abort these
-       steps.&lt;/p&gt;&lt;/li&gt;
-
-      &lt;/ol&gt;
-
-     &lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If none of the first &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; bytes of the
-   resource are &lt;span&gt;binary data bytes&lt;/span&gt; then the sniffed type
-   of the resource is &quot;text/plain&quot;. Abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is
-   &quot;application/octet-stream&quot;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;The table used by the above algorithm is:&lt;/p&gt;
-
-  &lt;table&gt;
-   &lt;thead&gt;
-    &lt;tr&gt;
-     &lt;th colspan=&quot;2&quot;&gt;Bytes in Hexadecimal
-     &lt;th rowspan=&quot;2&quot;&gt;Sniffed type
-     &lt;th rowspan=&quot;2&quot;&gt;Security
-     &lt;th rowspan=&quot;2&quot;&gt;Comment
-    &lt;tr&gt;
-     &lt;th&gt;Mask
-     &lt;th&gt;Pattern
-   &lt;tbody&gt;
-    &lt;tr&gt;
-     &lt;td&gt;FF FF DF DF DF DF DF DF DF FF DF DF DF DF
-     &lt;td&gt;3C 21 44 4F 43 54 59 50 45 20 48 54 4D 4C &lt;!-- &quot;&lt;!DOCTYPE HTML&quot; --&gt; &lt;!-- common in static data --&gt;
-     &lt;td&gt;text/html
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;&lt;!DOCTYPE HTML&lt;/code&gt;&quot; in US-ASCII or compatible encodings, case-insensitively.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF DF DF DF DF
-     &lt;td&gt;&lt;em&gt;WS&lt;/em&gt; 3C 48 54 4D 4C &lt;!-- &quot;&lt;HTML&quot; --&gt; &lt;!-- common in static data --&gt;
-     &lt;td&gt;text/html
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;&lt;HTML&lt;/code&gt;&quot; in US-ASCII or compatible encodings, case-insensitively, possibly with leading spaces.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF DF DF DF DF
-     &lt;td&gt;&lt;em&gt;WS&lt;/em&gt; 3C 48 45 41 44 &lt;!-- &quot;&lt;HEAD&quot; --&gt; &lt;!-- common in static data --&gt;
-     &lt;td&gt;text/html
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;&lt;HEAD&lt;/code&gt;&quot; in US-ASCII or compatible encodings, case-insensitively, possibly with leading spaces.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF DF DF DF DF DF DF
-     &lt;td&gt;&lt;em&gt;WS&lt;/em&gt; 3C 53 43 52 49 50 54 &lt;!-- &quot;&lt;SCRIPT&quot; --&gt; &lt;!-- common in dynamic data --&gt;
-     &lt;td&gt;text/html
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;&lt;SCRIPT&lt;/code&gt;&quot; in US-ASCII or compatible encodings, case-insensitively, possibly with leading spaces.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF FF FF FF
-     &lt;td&gt;25 50 44 46 2D &lt;!-- &quot;%PDF-&quot; (from <A HREF="http://lxr.mozilla.org/seamonkey/source/netwerk/streamconv/converters/nsUnknownDecoder.cpp#321">http://lxr.mozilla.org/seamonkey/source/netwerk/streamconv/converters/nsUnknownDecoder.cpp#321</A>) --&gt;
-     &lt;td&gt;application/pdf
-     &lt;td&gt;Scriptable
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;%PDF-&lt;/code&gt;&quot;, the PDF signature.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF FF FF FF FF FF FF FF FF FF
-     &lt;td&gt;25 21 50 53 2D 41 64 6F 62 65 2D &lt;!-- &quot;%!PS-Adobe-&quot; (from <A HREF="http://lxr.mozilla.org/seamonkey/source/netwerk/streamconv/converters/nsUnknownDecoder.cpp#321">http://lxr.mozilla.org/seamonkey/source/netwerk/streamconv/converters/nsUnknownDecoder.cpp#321</A>) --&gt;
-     &lt;td&gt;application/postscript
-     &lt;td&gt;Safe
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;%!PS-Adobe-&lt;/code&gt;&quot;, the PostScript signature.
-
-   &lt;!-- copied from the text or binary section above --&gt;
-   &lt;tbody&gt;
-    &lt;tr&gt;
-     &lt;td&gt;FF FF 00 00
-     &lt;td&gt;FE FF 00 00
-     &lt;td&gt;text/plain
-     &lt;td&gt;n/a
-     &lt;td&gt;UTF-16BE BOM &lt;!-- followed by at least one character --&gt;
-    &lt;tr&gt;
-     &lt;td&gt;FF FF 00 00
-     &lt;td&gt;FF FF 00 00
-     &lt;td&gt;text/plain
-     &lt;td&gt;n/a
-     &lt;td&gt;UTF-16LE BOM &lt;!-- followed by at least one character --&gt;
-    &lt;tr&gt;
-     &lt;td&gt;FF FF FF 00
-     &lt;td&gt;EF BB BF 00
-     &lt;td&gt;text/plain
-     &lt;td&gt;n/a
-     &lt;td&gt;UTF-8 BOM &lt;!-- followed by at least one character --&gt;
-
-   &lt;!-- based on the table in the image section below --&gt;
-   &lt;tbody&gt;
-    &lt;tr&gt;
-     &lt;td&gt;FF FF FF FF FF FF
-     &lt;td&gt;47 49 46 38 37 61 &lt;!-- GIF87a --&gt;
-     &lt;td&gt;image/gif
-     &lt;td&gt;Safe
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;GIF87a&lt;/code&gt;&quot;, a GIF signature.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF FF FF FF FF
-     &lt;td&gt;47 49 46 38 39 61 &lt;!-- GIF89a --&gt;
-     &lt;td&gt;image/gif
-     &lt;td&gt;Safe
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;GIF89a&lt;/code&gt;&quot;, a GIF signature.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF FF FF FF FF FF FF
-     &lt;td&gt;89 50 4E 47 0D 0A 1A 0A &lt;!-- [TAB]PNG[CR][LF][EOF][LF]; 137 80 78 71 13 10 26 10 --&gt;
-     &lt;td&gt;image/png
-     &lt;td&gt;Safe
-     &lt;td&gt;The PNG signature.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF FF
-     &lt;td&gt;FF D8 FF &lt;!-- SOI marker followed by the first byte of another marker --&gt;
-     &lt;td&gt;image/jpeg
-     &lt;td&gt;Safe
-     &lt;td&gt;A JPEG SOI marker followed by the first byte of another marker.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF
-     &lt;td&gt;42 4D
-     &lt;td&gt;image/bmp
-     &lt;td&gt;Safe
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;BM&lt;/code&gt;&quot;, a BMP signature.
-    &lt;tr&gt;
-     &lt;td&gt;FF FF FF FF
-     &lt;td&gt;00 00 01 00
-     &lt;td&gt;image/vnd.microsoft.icon
-     &lt;td&gt;Safe
-     &lt;td&gt;A 0 word following by a 1 word, a Windows Icon file format signature.
-
-  &lt;/table&gt;
-
-  &lt;p class=&quot;XXX&quot;&gt;I'd like to add types like MPEG, AVI, Flash,
-  Java, etc, to the above table.&lt;/p&gt;
-
-  &lt;p&gt;User agents may support further types if desired, by implicitly
-  adding to the above table. However, user agents should not use any
-  other patterns for types already mentioned in the table above, as
-  this could then be used for privilege escalation (where, e.g., a
-  server uses the above table to determine that content is not HTML
-  and thus safe from XSS attacks, but then a user agent detects it as
-  HTML anyway and allows script to execute).&lt;/p&gt;
-
-  &lt;p&gt;The column marked &quot;security&quot; is used by the algorithm in the
-  &quot;text or binary&quot; section, to avoid sniffing &lt;code
-  title=&quot;&quot;&gt;text/plain&lt;/code&gt; content as a type that can be used for a
-  privilege escalation attack.&lt;/p&gt;
-
-
-  &lt;h4&gt;&lt;dfn&gt;Content-Type sniffing: image&lt;/dfn&gt;&lt;/h4&gt;
-
-  &lt;p&gt;If the resource's &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt; is
-  &quot;image/svg+xml&quot;, then the sniffed type of the resource is its &lt;var
-  title=&quot;&quot;&gt;official type&lt;/var&gt; (an XML type).&lt;/p&gt;
-
-  &lt;p&gt;Otherwise, if the first bytes of the resource match one of the
-  byte sequences in the first column of the following table, then the
-  sniffed type of the resource is the type given in the corresponding
-  cell in the second column on the same row:&lt;/p&gt;
-
-  &lt;table&gt;
-   &lt;thead&gt;
-    &lt;tr&gt;
-     &lt;th&gt;Bytes in Hexadecimal
-     &lt;th&gt;Sniffed type
-     &lt;th&gt;Comment
-
-   &lt;!-- update the table above if you change this! --&gt;
-   &lt;tbody&gt;
-    &lt;tr&gt;
-     &lt;td&gt;47 49 46 38 37 61 &lt;!-- GIF87a --&gt;
-     &lt;td&gt;image/gif
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;GIF87a&lt;/code&gt;&quot;, a GIF signature.
-    &lt;tr&gt;
-     &lt;td&gt;47 49 46 38 39 61 &lt;!-- GIF89a --&gt;
-     &lt;td&gt;image/gif
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;GIF89a&lt;/code&gt;&quot;, a GIF signature.
-    &lt;tr&gt;
-     &lt;td&gt;89 50 4E 47 0D 0A 1A 0A &lt;!-- [TAB]PNG[CR][LF][EOF][LF]; 137 80 78 71 13 10 26 10 --&gt;
-     &lt;td&gt;image/png
-     &lt;td&gt;The PNG signature.
-    &lt;tr&gt;
-     &lt;td&gt;FF D8 FF &lt;!-- SOI marker followed by the first byte of another marker --&gt;
-     &lt;td&gt;image/jpeg
-     &lt;td&gt;A JPEG SOI marker followed by the first byte of another marker.
-    &lt;tr&gt;
-     &lt;td&gt;42 4D
-     &lt;td&gt;image/bmp
-     &lt;td&gt;The string &quot;&lt;code title=&quot;&quot;&gt;BM&lt;/code&gt;&quot;, a BMP signature.
-    &lt;tr&gt;
-     &lt;td&gt;00 00 01 00
-     &lt;td&gt;image/vnd.microsoft.icon
-     &lt;td&gt;A 0 word following by a 1 word, a Windows Icon file format signature.
-    &lt;!-- XXX Mozilla also detects ART (AOL proprietary format) and Windows Cursor files --&gt;
-  &lt;/table&gt;
-
-  &lt;p&gt;Otherwise, the sniffed type of the resource is the same as
-  its &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt;.&lt;/p&gt;
-
-
-  &lt;h4&gt;&lt;dfn&gt;Content-Type sniffing: feed or HTML&lt;/dfn&gt;&lt;/h4&gt;
-  &lt;!-- mostly based on:
-   <A HREF="http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx">http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx</A>
-   <A HREF="http://lxr.mozilla.org/seamonkey/source/browser/components/feeds/src/nsFeedSniffer.cpp#192">http://lxr.mozilla.org/seamonkey/source/browser/components/feeds/src/nsFeedSniffer.cpp#192</A>
-   <A HREF="http://lxr.mozilla.org/seamonkey/source/browser/components/feeds/src/nsFeedSniffer.cpp#127">http://lxr.mozilla.org/seamonkey/source/browser/components/feeds/src/nsFeedSniffer.cpp#127</A>
-  --&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;The user agent may wait for 512 or more bytes of the
-   resource to be available.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; be the stream of bytes, and let
-   &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;i&lt;/var&gt;]&lt;/span&gt;
-   represent the byte in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; with position &lt;var
-   title=&quot;&quot;&gt;i&lt;/var&gt;, treating &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; as zero-indexed
-   (so the first byte is at &lt;span title=&quot;&quot;&gt;&lt;var
-   title=&quot;&quot;&gt;i&lt;/var&gt;=0&lt;/span&gt;).&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If at any point this algorithm requires the user agent to
-   determine the value of a byte in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; which is not
-   yet available, or which is past the first 512 bytes of the
-   resource, or which is beyond the end of the resource, the user
-   agent must stop this algorithm, and assume that the sniffed type of
-   the resource is &quot;text/html&quot;.&lt;/p&gt;
-
-   &lt;p class=&quot;note&quot;&gt;User agents are allowed, by the first step of this
-   algorithm, to wait until the first 512 bytes of the resource are
-   available.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Initialize &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; to 0.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[0]&lt;/span&gt; is 0xEF,
-   &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[1]&lt;/span&gt; is 0xBB, and &lt;span title=&quot;&quot;&gt;&lt;var
-   title=&quot;&quot;&gt;s&lt;/var&gt;[2]&lt;/span&gt; is 0xBF, then set &lt;var
-   title=&quot;&quot;&gt;pos&lt;/var&gt; to 3. (This skips over a leading UTF-8 BOM, if
-   any.)&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop start:&lt;/i&gt; Examine &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var
-   title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt;.&lt;/p&gt;
-
-   &lt;dl class=&quot;switch&quot;&gt;
-
-    &lt;!-- skip whitespace (S token as defined in XML 1.0 section 2.3; production [3] --&gt;
-    &lt;dt&gt;If it is 0x09 (ASCII tab), 0x20 (ASCII space), 0x0A (ASCII LF), or 0x0D (ASCII CR)&lt;/dt&gt;
-    &lt;dd&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1 and repeat this step.&lt;/dd&gt;
-
-    &lt;dt&gt;If it is 0x3C (ASCII &quot;&lt;code title=&quot;&quot;&gt;&lt;&lt;/code&gt;&quot;)&lt;/dt&gt;
-    &lt;dd&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1 and go to the next step.&lt;/dd&gt;
-
-    &lt;dt&gt;If it is anything else&lt;/dt&gt;
-    &lt;dd&gt;The sniffed type of the resource is &quot;text/html&quot;. Abort these
-    steps.&lt;/dd&gt;
-
-   &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the bytes with positions &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; to
-   &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;+2&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; are
-   exactly equal to 0x21, 0x2D, 0x2D respectively (ASCII for &quot;&lt;code
-   title=&quot;&quot;&gt;!--&lt;/code&gt;&quot;), then:&lt;/p&gt;
-
-    &lt;ol&gt;
-
-     &lt;li&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 3.&lt;/li&gt; &lt;!-- skips past the &quot; ! - - &quot; --&gt;
-
-     &lt;li&gt;If the bytes with positions &lt;span title=&quot;&quot;&gt;&lt;var
-     title=&quot;&quot;&gt;pos&lt;/var&gt;&lt;/span&gt; to &lt;span title=&quot;&quot;&gt;&lt;var
-     title=&quot;&quot;&gt;pos&lt;/var&gt;+2&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; are exactly
-     equal to 0x2D, 0x2D, 0x3E respectively (ASCII for &quot;&lt;code
-     title=&quot;&quot;&gt;--&gt;&lt;/code&gt;&quot;), then increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;
-     by 3 and jump back to the previous step (the step labeled
-     &lt;i&gt;loop start&lt;/i&gt;) in the overall algorithm in this section.&lt;/li&gt;
-
-     &lt;li&gt;Otherwise, increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1.&lt;/li&gt;
-
-     &lt;li&gt;Return to step 2 in these substeps.&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var
-   title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt; is 0x21 (ASCII &quot;&lt;code
-   title=&quot;&quot;&gt;!&lt;/code&gt;&quot;):&lt;/p&gt;
-
-    &lt;!-- this skips past a DOCTYPE if there is one. It is brain-dead
-    because we don't have to be clever to parse the Atom and RSS x.y
-    DOCTYPEs, as they don't do anything clever like have internal
-    subsets or quoted &quot;&gt;&quot; characters. If this fails, then that's ok,
-    we'll treat it as HTML which is fine since we know it's not a feed
-    in that case. --&gt;
-
-    &lt;ol&gt;
-
-     &lt;li&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1.&lt;/li&gt;
-
-     &lt;li&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var
-     title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt; equal 0x3E, then increase &lt;var
-     title=&quot;&quot;&gt;pos&lt;/var&gt; by 1 and jump back to the step labeled
-     &lt;i&gt;loop start&lt;/i&gt; in the overall algorithm in this section.&lt;/li&gt;
-
-     &lt;li&gt;Otherwise, return to step 1 in these substeps.&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var
-   title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt; is 0x3F (ASCII &quot;&lt;code
-   title=&quot;&quot;&gt;?&lt;/code&gt;&quot;):&lt;/p&gt;
-
-    &lt;ol&gt;
-
-     &lt;li&gt;Increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1.&lt;/li&gt;
-
-     &lt;li&gt;If &lt;span title=&quot;&quot;&gt;&lt;var title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var
-     title=&quot;&quot;&gt;pos&lt;/var&gt;]&lt;/span&gt; and &lt;span title=&quot;&quot;&gt;&lt;var
-     title=&quot;&quot;&gt;s&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;+1]&lt;/span&gt; equal 0x3F and
-     0x3E respectively, then increase &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; by 1 and
-     jump back to the step labeled &lt;i&gt;loop start&lt;/i&gt; in the overall
-     algorithm in this section.&lt;/li&gt;
-
-     &lt;li&gt;Otherwise, return to step 1 in these substeps.&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, if the bytes in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; starting at
-   &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt; match any of the sequences of bytes in the
-   first column of the following table, then the user agent must
-   follow the steps given in the corresponding cell in the second
-   column of the same row.&lt;/p&gt;
-
-    &lt;table&gt;
-     &lt;thead&gt;
-      &lt;tr&gt;
-       &lt;th&gt;Bytes in Hexadecimal
-       &lt;th&gt;Requirement
-       &lt;th&gt;Comment
-
-     &lt;tbody&gt;
-      &lt;tr&gt;
-       &lt;td&gt;72 73 73
-       &lt;td&gt;The sniffed type of the resource is &quot;application/rss+xml&quot;; abort these steps
-       &lt;td&gt;The three ASCII characters &quot;&lt;code title=&quot;&quot;&gt;rss&lt;/code&gt;&quot;
-      &lt;tr&gt;
-       &lt;td&gt;66 65 65 64
-       &lt;td&gt;The sniffed type of the resource is &quot;application/atom+xml&quot;; abort these steps
-       &lt;td&gt;The four ASCII characters &quot;&lt;code title=&quot;&quot;&gt;feed&lt;/code&gt;&quot;
-      &lt;tr&gt;
-       &lt;td&gt;72 64 66 3A 52 44 46
-       &lt;td&gt;Continue to the next step in this algorithm
-       &lt;td&gt;The ASCII characters &quot;&lt;code title=&quot;&quot;&gt;rdf:RDF&lt;/code&gt;&quot;
-    &lt;/table&gt;
-
-    &lt;p&gt;If none of the byte sequences above match the bytes in &lt;var
-    title=&quot;&quot;&gt;s&lt;/var&gt; starting at &lt;var title=&quot;&quot;&gt;pos&lt;/var&gt;, then the
-    sniffed type of the resource is &quot;text/html&quot;. Abort these
-    steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p class=&quot;XXX&quot;&gt;If, before the next &quot;&gt;&quot;, you find two
-   xmlns* attributes with <A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>
-   and <A HREF="http://purl.org/rss/1.0/">http://purl.org/rss/1.0/</A> as the namespaces, then the sniffed
-   type of the resource is &quot;application/rss+xml&quot;, abort these
-   steps. (maybe we only need to check for <A HREF="http://purl.org/rss/1.0/">http://purl.org/rss/1.0/</A>
-   actually)&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, the sniffed type of the resource is
-   &quot;text/html&quot;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p class=&quot;note&quot;&gt;For efficiency reasons, implementations may wish to
-  implement this algorithm and the algorithm for detecting the
-  character encoding of HTML documents in parallel.&lt;/p&gt;
-
   &lt;/div&gt;
 
+
   &lt;div class=&quot;impl&quot;&gt;
 
   &lt;h3&gt;Character encodings&lt;/h3&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010112.html">[html5] r3233 - [e] (0) copy/paste error
</A></li>
	<LI>Next message: <A HREF="010114.html">[html5] r3235 - [act] (0) Revert r3146 ('Allow	href='http://example.com/demo?id=hello&amp;copy=1&amp;wor [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10113">[ date ]</a>
              <a href="thread.html#10113">[ thread ]</a>
              <a href="subject.html#10113">[ subject ]</a>
              <a href="author.html#10113">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
