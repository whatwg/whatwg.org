<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r2720 - [] (0) Make outerHTML and insertAdjacentHTML work	on XML too. Reorganise things [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2720%20-%20%5B%5D%20%280%29%20Make%20outerHTML%20and%20insertAdjacentHTML%20work%0A%09on%20XML%20too.%20Reorganise%20things%20%5B...%5D&In-Reply-To=%3C20090129051237.199E4138A05%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009603.html">
   <LINK REL="Next"  HREF="009605.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r2720 - [] (0) Make outerHTML and insertAdjacentHTML work	on XML too. Reorganise things [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2720%20-%20%5B%5D%20%280%29%20Make%20outerHTML%20and%20insertAdjacentHTML%20work%0A%09on%20XML%20too.%20Reorganise%20things%20%5B...%5D&In-Reply-To=%3C20090129051237.199E4138A05%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r2720 - [] (0) Make outerHTML and insertAdjacentHTML work	on XML too. Reorganise things [...]">whatwg at whatwg.org
       </A><BR>
    <I>Wed Jan 28 21:12:37 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009603.html">[html5] r2719 - [] (0) prevent document.domain from being set to	'com' or 'mtnview.ca.us'.
</A></li>
        <LI>Next message: <A HREF="009605.html">[html5] r2721 - [e] (0) Missed that onload was a global that was	also on &lt;body&gt;.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9604">[ date ]</a>
              <a href="thread.html#9604">[ thread ]</a>
              <a href="subject.html#9604">[ subject ]</a>
              <a href="author.html#9604">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-01-28 21:12:36 -0800 (Wed, 28 Jan 2009)
New Revision: 2720

Modified:
   index
   source
Log:
[] (0) Make outerHTML and insertAdjacentHTML work on XML too. Reorganise things and define the interaction of XML and the DOM for the purposes of HTML APIs.

Modified: index
===================================================================
--- index	2009-01-28 07:49:07 UTC (rev 2719)
+++ index	2009-01-29 05:12:36 UTC (rev 2720)
@@ -33,7 +33,7 @@
   &lt;div class=head&gt;
    &lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;h1&gt;HTML 5&lt;/h1&gt;
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 28 January 2009&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 29 January 2009&lt;/h2&gt;
    &lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;dl&gt;&lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -331,8 +331,11 @@
    &lt;li&gt;&lt;a href=#dynamic-markup-insertion&gt;&lt;span class=secno&gt;3.7 &lt;/span&gt;Dynamic markup insertion&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#controlling-the-input-stream&gt;&lt;span class=secno&gt;3.7.1 &lt;/span&gt;Controlling the input stream&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#dynamic-markup-insertion-in-html&gt;&lt;span class=secno&gt;3.7.2 &lt;/span&gt;Dynamic markup insertion in HTML&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#dynamic-markup-insertion-in-xml&gt;&lt;span class=secno&gt;3.7.3 &lt;/span&gt;Dynamic markup insertion in XML&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#document.write()&gt;&lt;span class=secno&gt;3.7.2 &lt;/span&gt;&lt;code title=dom-document-write&gt;document.write()&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#document.writeln()&gt;&lt;span class=secno&gt;3.7.3 &lt;/span&gt;&lt;code title=dom-document-writeln&gt;document.writeln()&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#innerhtml&gt;&lt;span class=secno&gt;3.7.4 &lt;/span&gt;&lt;code title=dom-innerHTML&gt;innerHTML&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#outerhtml&gt;&lt;span class=secno&gt;3.7.5 &lt;/span&gt;&lt;code title=dom-outerHTML&gt;outerHTML&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#insertadjacenthtml()&gt;&lt;span class=secno&gt;3.7.6 &lt;/span&gt;&lt;code title=dom-insertAdjacentHTML&gt;insertAdjacentHTML()&lt;/code&gt;&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#semantics&gt;&lt;span class=secno&gt;4 &lt;/span&gt;The elements of HTML&lt;/a&gt;
   &lt;ol&gt;
    &lt;li&gt;&lt;a href=#the-root-element&gt;&lt;span class=secno&gt;4.1 &lt;/span&gt;The root element&lt;/a&gt;
@@ -1014,27 +1017,33 @@
    &lt;li&gt;&lt;a href=#serializing-html-fragments&gt;&lt;span class=secno&gt;8.4 &lt;/span&gt;Serializing HTML fragments&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#parsing-html-fragments&gt;&lt;span class=secno&gt;8.5 &lt;/span&gt;Parsing HTML fragments&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#named-character-references&gt;&lt;span class=secno&gt;8.6 &lt;/span&gt;Named character references&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
- &lt;li&gt;&lt;a href=#rendering&gt;&lt;span class=secno&gt;9 &lt;/span&gt;Rendering&lt;/a&gt;
+ &lt;li&gt;&lt;a href=#the-xhtml-syntax&gt;&lt;span class=secno&gt;9 &lt;/span&gt;The XHTML syntax&lt;/a&gt;
   &lt;ol&gt;
-   &lt;li&gt;&lt;a href=#rendering-and-menus/toolbars&gt;&lt;span class=secno&gt;9.1 &lt;/span&gt;Rendering and menus/toolbars&lt;/a&gt;
+   &lt;li&gt;&lt;a href=#writing-xhtml-documents&gt;&lt;span class=secno&gt;9.1 &lt;/span&gt;Writing XHTML documents&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#parsing-xhtml-documents&gt;&lt;span class=secno&gt;9.2 &lt;/span&gt;Parsing XHTML documents&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#serializing-xhtml-fragments&gt;&lt;span class=secno&gt;9.3 &lt;/span&gt;Serializing XHTML fragments&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#parsing-xhtml-fragments&gt;&lt;span class=secno&gt;9.4 &lt;/span&gt;Parsing XHTML fragments&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+ &lt;li&gt;&lt;a href=#rendering&gt;&lt;span class=secno&gt;10 &lt;/span&gt;Rendering&lt;/a&gt;
+  &lt;ol&gt;
+   &lt;li&gt;&lt;a href=#rendering-and-menus/toolbars&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Rendering and menus/toolbars&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=&quot;#the-'icon'-property&quot;&gt;&lt;span class=secno&gt;9.1.1 &lt;/span&gt;The 'icon' property&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
- &lt;li&gt;&lt;a href=#obsolete-features&gt;&lt;span class=secno&gt;10 &lt;/span&gt;Obsolete features&lt;/a&gt;
+     &lt;li&gt;&lt;a href=&quot;#the-'icon'-property&quot;&gt;&lt;span class=secno&gt;10.1.1 &lt;/span&gt;The 'icon' property&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
+ &lt;li&gt;&lt;a href=#obsolete-features&gt;&lt;span class=secno&gt;11 &lt;/span&gt;Obsolete features&lt;/a&gt;
   &lt;ol&gt;
-   &lt;li&gt;&lt;a href=#obsolete-elements&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Obsolete elements&lt;/a&gt;
+   &lt;li&gt;&lt;a href=#obsolete-elements&gt;&lt;span class=secno&gt;11.1 &lt;/span&gt;Obsolete elements&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#the-body-element-0&gt;&lt;span class=secno&gt;10.1.1 &lt;/span&gt;The &lt;code&gt;body&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#the-applet-element&gt;&lt;span class=secno&gt;10.1.2 &lt;/span&gt;The &lt;code&gt;applet&lt;/code&gt; element&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;a href=#conformance-checkers-0&gt;&lt;span class=secno&gt;10.2 &lt;/span&gt;Conformance checkers&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
- &lt;li&gt;&lt;a href=#no&gt;&lt;span class=secno&gt;11 &lt;/span&gt;Things that you can't do with this specification because
+     &lt;li&gt;&lt;a href=#the-body-element-0&gt;&lt;span class=secno&gt;11.1.1 &lt;/span&gt;The &lt;code&gt;body&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#the-applet-element&gt;&lt;span class=secno&gt;11.1.2 &lt;/span&gt;The &lt;code&gt;applet&lt;/code&gt; element&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#conformance-checkers-0&gt;&lt;span class=secno&gt;11.2 &lt;/span&gt;Conformance checkers&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+ &lt;li&gt;&lt;a href=#no&gt;&lt;span class=secno&gt;12 &lt;/span&gt;Things that you can't do with this specification because
   they are better handled using other technologies that are further
   described herein&lt;/a&gt;
   &lt;ol&gt;
-   &lt;li&gt;&lt;a href=#localization&gt;&lt;span class=secno&gt;11.1 &lt;/span&gt;Localization&lt;/a&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;a href=#declarative-2d-vector-graphics-and-animation&gt;&lt;span class=secno&gt;11.2 &lt;/span&gt;Declarative 2D vector graphics and animation&lt;/a&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;a href=#declarative-3d-scenes&gt;&lt;span class=secno&gt;11.3 &lt;/span&gt;Declarative 3D scenes&lt;/a&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;a href=#timers&gt;&lt;span class=secno&gt;11.4 &lt;/span&gt;Timers&lt;/a&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;a href=#rendering-and-the-dom&gt;&lt;span class=secno&gt;11.5 &lt;/span&gt;Rendering and the DOM&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#localization&gt;&lt;span class=secno&gt;12.1 &lt;/span&gt;Localization&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#declarative-2d-vector-graphics-and-animation&gt;&lt;span class=secno&gt;12.2 &lt;/span&gt;Declarative 2D vector graphics and animation&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#declarative-3d-scenes&gt;&lt;span class=secno&gt;12.3 &lt;/span&gt;Declarative 3D scenes&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#timers&gt;&lt;span class=secno&gt;12.4 &lt;/span&gt;Timers&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#rendering-and-the-dom&gt;&lt;span class=secno&gt;12.5 &lt;/span&gt;Rendering and the DOM&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a class=no-num href=#index&gt;Index&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a class=no-num href=#references&gt;References&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a class=no-num href=#acknowledgements&gt;Acknowledgements&lt;/a&gt;&lt;/ol&gt;
@@ -1408,7 +1417,7 @@
   &lt;p&gt;The term &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt; is sometimes used in
   contrast with &lt;a href=#xml-documents&gt;XML documents&lt;/a&gt; to specifically mean
   documents that were parsed using an &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; (as
-  opposed to using an &lt;span&gt;XML parser&lt;/span&gt; or created purely
+  opposed to using an &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt; or created purely
   through the DOM).&lt;/p&gt;
 
   &lt;p&gt;Generally, when the specification states that a feature applies
@@ -6172,21 +6181,13 @@
   &lt;code&gt;Document&lt;/code&gt; object is created, it must have its
   &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; set to the string &quot;loading&quot;
   if the document is associated with an &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; or an
-  &lt;span&gt;XML parser&lt;/span&gt;, or to the string &quot;complete&quot;
+  &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt;, or to the string &quot;complete&quot;
   otherwise. Various algorithms during page loading affect this
   value. When the value is set, the user agent must &lt;a href=#fire-a-simple-event&gt;fire a
   simple event&lt;/a&gt; called &lt;code title=event-readystatechange&gt;readystatechange&lt;/code&gt; at the
   &lt;code&gt;Document&lt;/code&gt; object.&lt;/p&gt; &lt;!-- XXX define
   document.onreadystatechange --&gt;
 
-  &lt;p&gt;When a &lt;code&gt;Document&lt;/code&gt; is created by an &lt;span&gt;XML
-  parser&lt;/span&gt;, the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; must be
-  changed to &quot;complete&quot; when the parser reaches the end of its input
-  stream.&lt;/p&gt; &lt;!-- XXX this should be in its own section, and we
-  should define 'delay the load event' for XML parsing so that we can
-  have the &quot;interactive&quot; state here too. also, XML parser will need to
-  fire the /pending state object/, and the 'load' event, and... --&gt;
-
   &lt;p&gt;The &lt;dfn id=dom-document-readystate title=dom-document-readyState&gt;&lt;code&gt;readyState&lt;/code&gt;&lt;/dfn&gt; DOM
   attribute must, on getting, return the &lt;a href=#current-document-readiness&gt;current document
   readiness&lt;/a&gt;.&lt;/p&gt;
@@ -7691,46 +7692,18 @@
 
   &lt;/dl&gt;&lt;h3 id=dynamic-markup-insertion&gt;&lt;span class=secno&gt;3.7 &lt;/span&gt;&lt;dfn&gt;Dynamic markup insertion&lt;/dfn&gt;&lt;/h3&gt;
 
-  &lt;p&gt;APIs for dynamically inserting markup into the document interact
-  with the parser, and thus their behavior varies depending on whether
-  they are used with &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt; (and the &lt;a href=#html-parser&gt;HTML
-  parser&lt;/a&gt;) or XHTML in &lt;a href=#xml-documents&gt;XML documents&lt;/a&gt; (and the
-  &lt;span&gt;XML parser&lt;/span&gt;&lt;!-- XXX xref --&gt;). The following table
-  cross-references the various versions of these APIs.&lt;/p&gt;
+  &lt;p class=note&gt;APIs for dynamically inserting markup into the
+  document interact with the parser, and thus their behavior, varies
+  depending on whether they are used with &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt;
+  (and the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt;) or XHTML in &lt;a href=#xml-documents&gt;XML
+  documents&lt;/a&gt; (and the &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt;).&lt;/p&gt;
 
-  &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;
-     &lt;th&gt;For documents that are &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt;&lt;/th&gt;
-     &lt;th&gt;For documents that are &lt;a href=#xml-documents&gt;XML documents&lt;/a&gt;&lt;/th&gt;
-    &lt;tbody&gt;&lt;tr&gt;&lt;th&gt;&lt;code&gt;document.open()&lt;/code&gt;&lt;/th&gt;
-     &lt;td colspan=2&gt;&lt;a href=#dom-document-open title=dom-document-open&gt;&lt;code&gt;document.open()&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
-    &lt;tr&gt;&lt;th&gt;&lt;dfn id=dom-document-write title=dom-document-write&gt;&lt;code&gt;document.write()&lt;/code&gt;&lt;/dfn&gt;&lt;/th&gt;
-     &lt;td&gt;&lt;a href=#dom-document-write-html title=dom-document-write-HTML&gt;&lt;code&gt;document.write()&lt;/code&gt; in HTML&lt;/a&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;a href=#dom-document-write-xml title=dom-document-write-XML&gt;not supported&lt;/a&gt;&lt;/td&gt;
-    &lt;tr&gt;&lt;th&gt;&lt;dfn id=dom-innerhtml title=dom-innerHTML&gt;&lt;code&gt;innerHTML&lt;/code&gt;&lt;/dfn&gt;&lt;/th&gt;
-     &lt;td&gt;&lt;a href=#dom-innerhtml-html title=dom-innerHTML-HTML&gt;&lt;code&gt;innerHTML&lt;/code&gt; in HTML&lt;/a&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;a href=#dom-innerhtml-xml title=dom-innerHTML-XML&gt;&lt;code&gt;innerHTML&lt;/code&gt; in XML&lt;/a&gt;&lt;/td&gt;
-    &lt;tr&gt;&lt;th&gt;&lt;dfn id=dom-outerhtml title=dom-outerHTML&gt;&lt;code&gt;outerHTML&lt;/code&gt;&lt;/dfn&gt;&lt;/th&gt;
-     &lt;td&gt;&lt;a href=#dom-outerhtml-html title=dom-outerHTML-HTML&gt;&lt;code&gt;outerHTML&lt;/code&gt; in HTML&lt;/a&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;a href=#dom-outerhtml-xml title=dom-outerHTML-XML&gt;not supported&lt;/a&gt;&lt;/td&gt;
-    &lt;tr&gt;&lt;th&gt;&lt;dfn id=dom-insertadjacenthtml title=dom-insertAdjacentHTML&gt;&lt;code&gt;insertAdjacentHTML()&lt;/code&gt;&lt;/dfn&gt;&lt;/th&gt;
-     &lt;td&gt;&lt;a href=#dom-insertadjacenthtml-html title=dom-insertAdjacentHTML-HTML&gt;&lt;code&gt;insertAdjacentHTML()&lt;/code&gt; in HTML&lt;/a&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;a href=#dom-insertadjacenthtml-xml title=dom-insertAdjacentHTML-XML&gt;not supported&lt;/a&gt;&lt;/td&gt;
-    &lt;/table&gt;&lt;p&gt;Regardless of the parsing mode, the &lt;dfn id=dom-document-writeln title=dom-document-writeln&gt;&lt;code&gt;document.writeln(...)&lt;/code&gt;&lt;/dfn&gt;
-  method must call the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; method with the
-  same argument(s), plus an extra argument consisting of a string
-  containing a single line feed character (U+000A).&lt;/p&gt;
+  &lt;!-- XXX must make sure we spec that innerHTML et al causes mutation
+  events to fire, but document.write() doesn't. (the latter is already
+  req-stated in the parser section, btw) --&gt;
 
-  &lt;p class=note&gt;The &lt;code title=dom-innerHTML&gt;&lt;a href=#dom-innerhtml&gt;innerHTML&lt;/a&gt;&lt;/code&gt;
-  attribute applies to both &lt;code&gt;Element&lt;/code&gt; nodes as well as
-  &lt;code&gt;Document&lt;/code&gt; nodes. The &lt;code title=dom-outerHTML&gt;&lt;a href=#dom-outerhtml&gt;outerHTML&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-insertAdjacentHTML&gt;&lt;a href=#dom-insertadjacenthtml&gt;insertAdjacentHTML()&lt;/a&gt;&lt;/code&gt; members,
-  on the other hand, only apply to &lt;code&gt;Element&lt;/code&gt; nodes.&lt;/p&gt;
 
-  &lt;p class=note&gt;When inserted using the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; method,
-  &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; elements execute (typically synchronously), but
-  when inserted using &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-outerHTML-HTML&gt;&lt;a href=#dom-outerhtml-html&gt;outerHTML&lt;/a&gt;&lt;/code&gt; attributes, they do not
-  execute at all.&lt;/p&gt;
 
-
   &lt;h4 id=controlling-the-input-stream&gt;&lt;span class=secno&gt;3.7.1 &lt;/span&gt;Controlling the input stream&lt;/h4&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-document-open title=dom-document-open&gt;&lt;code&gt;open()&lt;/code&gt;&lt;/dfn&gt;
@@ -7886,13 +7859,28 @@
   &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt;.&lt;/p&gt;
 
 
-  &lt;h4 id=dynamic-markup-insertion-in-html&gt;&lt;span class=secno&gt;3.7.2 &lt;/span&gt;Dynamic markup insertion in HTML&lt;/h4&gt;
 
-  &lt;p&gt;In HTML, the &lt;dfn id=dom-document-write-html title=dom-document-write-HTML&gt;&lt;code&gt;document.write(...)&lt;/code&gt;&lt;/dfn&gt;
+
+  &lt;h4 id=document.write()&gt;&lt;span class=secno&gt;3.7.2 &lt;/span&gt;&lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt;&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-document-write title=dom-document-write&gt;&lt;code&gt;document.write(...)&lt;/code&gt;&lt;/dfn&gt;
   method must act as follows:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;
 
+    &lt;p&gt;If the method was invoked on an &lt;a href=#xml-documents title=&quot;XML documents&quot;&gt;XML
+    document&lt;/a&gt;, throw an &lt;code&gt;&lt;a href=#invalid_access_err&gt;INVALID_ACCESS_ERR&lt;/a&gt;&lt;/code&gt;
+    exception and abort these steps.&lt;/p&gt;
+
+    &lt;!--
+    Where would document.write() insert?
+    Consider: data:text/xml,&lt;script xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;&gt;&lt;![CDATA[ document.write('&lt;foo&gt;Test&lt;/foo&gt;'); ]]&gt;&lt;/script&gt;
+    --&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;If the &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt; is undefined, the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;open()&lt;/a&gt;&lt;/code&gt; method must be called
     (with no arguments) on the &lt;code title=Document&gt;document&lt;/code&gt;
     object. If the user &lt;a href=#refused-to-allow-the-document-to-be-unloaded&gt;refused to allow the document to be
@@ -7928,7 +7916,7 @@
     tree construction stage (this can happen if a &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt;
     end tag token is emitted by the tokeniser).
 
-    &lt;p class=note&gt;If the &lt;code title=dom-document-write-HTML&gt;&lt;a href=#dom-document-write-html&gt;document.write()&lt;/a&gt;&lt;/code&gt; method was
+    &lt;p class=note&gt;If the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; method was
     called from script executing inline (i.e. executing because the
     parser parsed a set of &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; tags), then this is a
     &lt;a href=#nestedParsing&gt;reentrant invocation of the
@@ -7942,92 +7930,79 @@
 
    &lt;/li&gt;
 
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;On getting, the &lt;dfn id=dom-innerhtml-html title=dom-innerHTML-HTML&gt;&lt;code&gt;innerHTML&lt;/code&gt;&lt;/dfn&gt; DOM
-  attribute must return the result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment
-  serialization algorithm&lt;/a&gt; on the node.&lt;/p&gt;
+  &lt;/ol&gt;&lt;h4 id=document.writeln()&gt;&lt;span class=secno&gt;3.7.3 &lt;/span&gt;&lt;code title=dom-document-writeln&gt;&lt;a href=#dom-document-writeln&gt;document.writeln()&lt;/a&gt;&lt;/code&gt;&lt;/h4&gt;
 
-  &lt;p&gt;On setting, &lt;strong&gt;if the node is a document&lt;/strong&gt;, the &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; DOM attribute must run
-  the following algorithm:&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=dom-document-writeln title=dom-document-writeln&gt;&lt;code&gt;document.writeln(...)&lt;/code&gt;&lt;/dfn&gt;
+  method, when invoked, must act as if the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; method had been
+  invoked with the same argument(s), plus an extra argument consisting
+  of a string containing a single line feed character (U+000A).&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;
 
-    &lt;p&gt;If the document has an &lt;span&gt;active parser&lt;/span&gt;&lt;!--XXX
-    xref--&gt;, then stop that parser, and throw away any pending content
-    in the input stream. &lt;span class=XXX&gt;what about if it
-    doesn't, because it's either like a text/plain, or Atom, or PDF,
-    or XHTML, or image document, or something?&lt;/span&gt;&lt;/p&gt;&lt;!-- XXX see
-    also document.open() --&gt;
 
-   &lt;/li&gt;
 
-   &lt;li&gt;
+  &lt;h4 id=innerhtml&gt;&lt;span class=secno&gt;3.7.4 &lt;/span&gt;&lt;code title=dom-innerHTML&gt;&lt;a href=#dom-innerhtml&gt;innerHTML&lt;/a&gt;&lt;/code&gt;&lt;/h4&gt;
 
-    &lt;p&gt;Remove the children nodes of the &lt;code&gt;Document&lt;/code&gt; whose
-    &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute is
-    being set.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=dom-innerhtml title=dom-innerHTML&gt;&lt;code&gt;innerHTML&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute represents the markup of the node's contents.&lt;/p&gt;
 
-   &lt;/li&gt;
+  &lt;p&gt;On getting, if the node's document is an &lt;a href=#html-documents title=&quot;HTML
+  documents&quot;&gt;HTML document&lt;/a&gt;, then the attribute must return the
+  result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment serialization
+  algorithm&lt;/a&gt; on the node; otherwise, the node's document is an
+  &lt;a href=#xml-documents title=&quot;XML documents&quot;&gt;XML document&lt;/a&gt;, and the attribute
+  must return the result of running the &lt;a href=#xml-fragment-serialization-algorithm&gt;XML fragment
+  serialization algorithm&lt;/a&gt; on the node instead (this might raise
+  an exception instead of returning a string).&lt;/p&gt;
 
-   &lt;li&gt;
+  &lt;p&gt;On setting, the following steps must be run:&lt;/p&gt;
 
-    &lt;p&gt;Create a new &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt;, in its initial state,
-    and associate it with the &lt;code&gt;Document&lt;/code&gt; node.&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;
 
-   &lt;/li&gt;
+    &lt;p&gt;If the node's document is an &lt;a href=#html-documents title=&quot;HTML documents&quot;&gt;HTML
+    document&lt;/a&gt;: Invoke the &lt;a href=#html-fragment-parsing-algorithm&gt;HTML fragment parsing
+    algorithm&lt;/a&gt;.&lt;/p&gt;
 
-&lt;!-- redundant, the document is forcibly already so labeled if we get here
-   &lt;li&gt;
+    &lt;p&gt;If the node's document is an &lt;a href=#xml-documents title=&quot;XML documents&quot;&gt;XML
+    document&lt;/a&gt;: Invoke the &lt;a href=#xml-fragment-parsing-algorithm&gt;XML fragment parsing
+    algorithm&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Mark the &lt;code&gt;Document&lt;/code&gt; object as being an &lt;span
-    title=&quot;HTML documents&quot;&gt;HTML document&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;In either case, the algorithm must be invoked with the string
+    being assigned into the &lt;code title=dom-innerHTML&gt;&lt;a href=#dom-innerhtml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;. If the node is an &lt;code&gt;Element&lt;/code&gt;
+    node, then, in addition, that element must be passed as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element.&lt;/p&gt;
 
-   &lt;/li&gt;
---&gt;
+    &lt;p&gt;If this raises an exception, then abort these steps.&lt;/p&gt;
 
-   &lt;li&gt;
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be the nodes
+    returned.&lt;/p&gt;
 
-    &lt;p&gt;Place into the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; for the &lt;a href=#html-parser&gt;HTML
-    parser&lt;/a&gt; just created the string being assigned into the
-    &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
-
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Start the parser and let it run until it has consumed all the
-    characters just inserted into the input stream. (The
-    &lt;code&gt;Document&lt;/code&gt; node will have been populated with elements
-    and a &lt;code title=event-load&gt;&lt;a href=#event-load&gt;load&lt;/a&gt;&lt;/code&gt; event will have fired
-    on its &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt;
-    object.)&lt;/p&gt;
+    &lt;p&gt;If the attribute is being set on a &lt;code&gt;Document&lt;/code&gt; node,
+    and that document has an active &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; or
+    &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt;, then stop that parser.&lt;/p&gt;
 
-   &lt;/li&gt;
+    &lt;p class=XXX&gt;what about if it doesn't, because it's either
+    like a text/plain, or Atom, or PDF, or XHTML, or image document,
+    or something?&lt;/p&gt;&lt;!-- XXX see also document.open() --&gt;
 
-  &lt;/ol&gt;&lt;p&gt;Otherwise, if the node is an element, then setting the &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; DOM attribute must cause
-  the following algorithm to run instead:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;
-
-    &lt;p&gt;Invoke the &lt;a href=#html-fragment-parsing-algorithm&gt;HTML fragment parsing algorithm&lt;/a&gt;, with
-    the element whose &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute is being set
-    as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, and the string being
-    assigned into the &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;. Let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be the
-    result of this algorithm.&lt;/p&gt;
-
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Remove the children of the element whose &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute is being
-    set, without firing any mutation events.&lt;/p&gt;
+    &lt;p&gt;Remove the child nodes of the node whose &lt;code title=dom-innerHTML&gt;&lt;a href=#dom-innerhtml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute is being set.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of the &lt;code&gt;Element&lt;/code&gt; node
-    whose &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute
-    is being set.&lt;/p&gt;
+    &lt;p&gt;If the attribute is being set on a &lt;code&gt;Document&lt;/code&gt;
+    node, let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be that
+    &lt;code&gt;Document&lt;/code&gt; node. Otherwise, the attribute is being
+    set on an &lt;code&gt;Element&lt;/code&gt; node; let &lt;var title=&quot;&quot;&gt;target
+    document&lt;/var&gt; be the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of
+    that &lt;code&gt;Element&lt;/code&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -8042,23 +8017,32 @@
    &lt;li&gt;
 
     &lt;p&gt;Append all the &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; nodes to the
-    node whose &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt;
-    attribute is being set, preserving their order, without firing any
-    mutation events.&lt;/p&gt;
+    node whose &lt;code title=dom-innerHTML&gt;&lt;a href=#dom-innerhtml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute
+    is being set, preserving their order, without firing any mutation
+    events.&lt;/p&gt;
 
    &lt;/li&gt;
 
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;On getting, the &lt;dfn id=dom-outerhtml-html title=dom-outerHTML-HTML&gt;&lt;code&gt;outerHTML&lt;/code&gt;&lt;/dfn&gt; DOM
-  attribute must return the result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment
-  serialization algorithm&lt;/a&gt; on a fictional node whose only child
-  is the node on which the attribute was invoked.&lt;/p&gt;
+  &lt;/ol&gt;&lt;h4 id=outerhtml&gt;&lt;span class=secno&gt;3.7.5 &lt;/span&gt;&lt;code title=dom-outerHTML&gt;&lt;a href=#dom-outerhtml&gt;outerHTML&lt;/a&gt;&lt;/code&gt;&lt;/h4&gt;
 
-  &lt;p&gt;On setting, the &lt;code title=dom-outerHTML-HTML&gt;&lt;a href=#dom-outerhtml-html&gt;outerHTML&lt;/a&gt;&lt;/code&gt;
-  DOM attribute must cause the following algorithm to run:&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=dom-outerhtml title=dom-outerHTML&gt;&lt;code&gt;outerHTML&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute represents the markup of the element and its contents.&lt;/p&gt;
 
+  &lt;p&gt;On getting, if the node's document is an &lt;a href=#html-documents title=&quot;HTML
+  documents&quot;&gt;HTML document&lt;/a&gt;, then the attribute must return the
+  result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment serialization
+  algorithm&lt;/a&gt; on a fictional node whose only child is the node on
+  which the attribute was invoked; otherwise, the node's document is
+  an &lt;a href=#xml-documents title=&quot;XML documents&quot;&gt;XML document&lt;/a&gt;, and the
+  attribute must return the result of running the &lt;a href=#xml-fragment-serialization-algorithm&gt;XML fragment
+  serialization algorithm&lt;/a&gt; on that fictional node instead (this
+  might raise an exception instead of returning a string).&lt;/p&gt;
+
+  &lt;p&gt;On setting, the following steps must be run:&lt;/p&gt;
+
   &lt;ol&gt;&lt;li&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the element whose &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;outerHTML&lt;/a&gt;&lt;/code&gt; attribute is being
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the element whose &lt;code title=dom-outerHTML&gt;&lt;a href=#dom-outerhtml&gt;outerHTML&lt;/a&gt;&lt;/code&gt; attribute is being
     set.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -8091,24 +8075,27 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Invoke the &lt;a href=#html-fragment-parsing-algorithm&gt;HTML fragment parsing algorithm&lt;/a&gt;, with
-    &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt;
-    element and the string being assigned into the &lt;code title=dom-outerHTML-HTML&gt;&lt;a href=#dom-outerhtml-html&gt;outerHTML&lt;/a&gt;&lt;/code&gt; attribute as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;. Let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be the
-    result of this algorithm.&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s document is an &lt;a href=#html-documents title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt;: Invoke the &lt;a href=#html-fragment-parsing-algorithm&gt;HTML
+    fragment parsing algorithm&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;/li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s document is an &lt;a href=#xml-documents title=&quot;XML
+    documents&quot;&gt;XML document&lt;/a&gt;: Invoke the &lt;a href=#xml-fragment-parsing-algorithm&gt;XML fragment
+    parsing algorithm&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;li&gt;
+    &lt;p&gt;In either case, the algorithm must be invoked with the string
+    being assigned into the &lt;code title=dom-outerHTML&gt;&lt;a href=#dom-outerhtml&gt;outerHTML&lt;/a&gt;&lt;/code&gt; attribute as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;If this raises an exception, then abort these steps.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;s returned.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Set the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of all the nodes in
-    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;target
-    document&lt;/var&gt;.&lt;/p&gt;
+    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s
+    document.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -8121,9 +8108,11 @@
 
    &lt;/li&gt;
 
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-insertadjacenthtml-html title=dom-insertAdjacentHTML-HTML&gt;&lt;code&gt;insertAdjacentHTML(&lt;var title=&quot;&quot;&gt;position&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
-  method, when invoked, must run the following steps:&lt;/p&gt;
+  &lt;/ol&gt;&lt;h4 id=insertadjacenthtml()&gt;&lt;span class=secno&gt;3.7.6 &lt;/span&gt;&lt;code title=dom-insertAdjacentHTML&gt;&lt;a href=#dom-insertadjacenthtml&gt;insertAdjacentHTML()&lt;/a&gt;&lt;/code&gt;&lt;/h4&gt;
 
+  &lt;p&gt;The &lt;dfn id=dom-insertadjacenthtml title=dom-insertAdjacentHTML&gt;&lt;code&gt;insertAdjacentHTML(&lt;var title=&quot;&quot;&gt;position&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
+  method, when invoked, must run the following algorithm:&lt;/p&gt;
+
   &lt;ol&gt;&lt;li&gt;
 
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;
@@ -8185,25 +8174,27 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Invoke the &lt;a href=#html-fragment-parsing-algorithm&gt;HTML fragment parsing algorithm&lt;/a&gt;, with
-    the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element being that selected by the
-    previous step, and &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; being the method's
-    &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; argument. Let &lt;var title=&quot;&quot;&gt;new
-    children&lt;/var&gt; be the result of this algorithm.&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s document is an &lt;a href=#html-documents title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt;: Invoke the &lt;a href=#html-fragment-parsing-algorithm&gt;HTML
+    fragment parsing algorithm&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;/li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s document is an &lt;a href=#xml-documents title=&quot;XML
+    documents&quot;&gt;XML document&lt;/a&gt;: Invoke the &lt;a href=#xml-fragment-parsing-algorithm&gt;XML fragment
+    parsing algorithm&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;li&gt;
+    &lt;p&gt;In either case, the algorithm must be invoked with &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, and the
+    element selected in by the previous step as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;If this raises an exception, then abort these steps.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;s returned.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Set the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of all the nodes in
-    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;target
-    document&lt;/var&gt;.&lt;/p&gt;
+    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s
+    document.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -8259,194 +8250,8 @@
 
    &lt;/li&gt;
 
-  &lt;/ol&gt;&lt;!-- XXX must make sure we spec that innerHTML et al causes mutation
-  events to fire, but document.write() doesn't. (the latter is already
-  req-stated in the parser section, btw) --&gt;&lt;!-- <A HREF="http://msdn.microsoft.com/workshop/author/dhtml/reference/properties/innerhtml.asp">http://msdn.microsoft.com/workshop/author/dhtml/reference/properties/innerhtml.asp</A> --&gt;&lt;!-- <A HREF="http://lxr.mozilla.org/seamonkey/source/content/html/content/src/nsGenericHTMLElement.cpp#879">http://lxr.mozilla.org/seamonkey/source/content/html/content/src/nsGenericHTMLElement.cpp#879</A>
-       note script execution disabled
-       <A HREF="http://lxr.mozilla.org/seamonkey/source/content/base/src/nsContentUtils.cpp#3308">http://lxr.mozilla.org/seamonkey/source/content/base/src/nsContentUtils.cpp#3308</A>
-       <A HREF="http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLElement.cpp#L295">http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLElement.cpp#L295</A>
-       <A HREF="http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLElement.cpp#L242">http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLElement.cpp#L242</A>
-       <A HREF="http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLTokenizer.cpp#L1742">http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLTokenizer.cpp#L1742</A>
-   --&gt;&lt;h4 id=dynamic-markup-insertion-in-xml&gt;&lt;span class=secno&gt;3.7.3 &lt;/span&gt;Dynamic markup insertion in XML&lt;/h4&gt;
+  &lt;/ol&gt;&lt;h2 id=semantics&gt;&lt;span class=secno&gt;4 &lt;/span&gt;The elements of HTML&lt;/h2&gt;
 
-  &lt;p&gt;In an XML context, the &lt;dfn id=dom-innerhtml-xml title=dom-innerHTML-XML&gt;&lt;code&gt;innerHTML&lt;/code&gt;&lt;/dfn&gt; DOM attribute
-  on &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;s must return a string in the form of an
-  &lt;a href=<A HREF="http://www.w3.org/TR/xml/#wf-entities">http://www.w3.org/TR/xml/#wf-entities</A>&gt;internal general
-  parsed entity&lt;/a&gt;, and on &lt;code&gt;&lt;a href=#htmldocument&gt;HTMLDocument&lt;/a&gt;&lt;/code&gt;s must return a
-  string in the form of a &lt;a href=<A HREF="http://www.w3.org/TR/xml/#sec-well-formed">http://www.w3.org/TR/xml/#sec-well-formed</A>&gt;document
-  entity&lt;/a&gt;. The string returned must be XML namespace-well-formed
-  and must be an isomorphic serialization of all of that node's child
-  nodes, in document order. User agents may adjust prefixes and
-  namespace declarations in the serialization (and indeed might be
-  forced to do so in some cases to obtain namespace-well-formed
-  XML). For the &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt;
-  attribute on &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt; objects, if any of the
-  elements in the serialization are in no namespace, the default
-  namespace in scope for those elements must be explicitly declared as
-  the empty string.&lt;!-- because otherwise round-tripping might break
-  since it'll pick up the surrounding default ns when setting --&gt;
-  (This doesn't apply to the &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute on
-  &lt;code&gt;&lt;a href=#htmldocument&gt;HTMLDocument&lt;/a&gt;&lt;/code&gt; objects.) &lt;a href=#refsXML&gt;[XML]&lt;/a&gt; &lt;a href=#refsXMLNS&gt;[XMLNS]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;If any of the following cases are found in the DOM being
-  serialized, the user agent must raise an
-  &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception:&lt;/p&gt;
-
-  &lt;ul&gt;&lt;li&gt;A &lt;code&gt;Document&lt;/code&gt; node with no child element nodes.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;DocumentType&lt;/code&gt; node that has an external subset
-   public identifier that contains characters that are not matched by
-   the XML &lt;code title=&quot;&quot;&gt;PubidChar&lt;/code&gt; production. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;DocumentType&lt;/code&gt; node that has an external subset
-   system identifier that contains both a U+0022 QUOTATION MARK ('&quot;')
-   and a U+0027 APOSTROPHE (&quot;'&quot;).&lt;/li&gt;
-
-   &lt;li&gt;A node with a prefix or local name containing a U+003A COLON
-   (&quot;:&quot;).&lt;/li&gt;
-
-   &lt;li&gt;An &lt;code&gt;Attr&lt;/code&gt; node, &lt;code&gt;Text&lt;/code&gt; node,
-   &lt;code&gt;CDATASection&lt;/code&gt; node, &lt;code&gt;Comment&lt;/code&gt; node, or
-   &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose data contains
-   characters that are not matched by the XML &lt;code title=&quot;&quot;&gt;Char&lt;/code&gt; production. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;CDATASection&lt;/code&gt; node whose data contains the string
-   &quot;&lt;code title=&quot;&quot;&gt;]]&gt;&lt;/code&gt;&quot;.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;Comment&lt;/code&gt; node whose data contains two adjacent
-   U+002D HYPHEN-MINUS (-) characters or ends with such a
-   character.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose target name is
-   an &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the string &quot;&lt;code title=&quot;&quot;&gt;xml&lt;/code&gt;&quot;.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose target name
-   contains a U+003A COLON (&quot;:&quot;).&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose data contains
-   the string &quot;&lt;code title=&quot;&quot;&gt;?&gt;&lt;/code&gt;&quot;.&lt;/li&gt;
-
-  &lt;/ul&gt;&lt;p class=note&gt;These are the only ways to make a DOM
-  unserializable. The DOM enforces all the other XML constraints; for
-  example, trying to set an attribute with a name that contains an
-  equals sign (=) will raised an &lt;code&gt;&lt;a href=#invalid_character_err&gt;INVALID_CHARACTER_ERR&lt;/a&gt;&lt;/code&gt;
-  exception.&lt;/p&gt;
-
-  &lt;p&gt;On setting, in an XML context, the &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; DOM attribute on
-  &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;s and &lt;code&gt;&lt;a href=#htmldocument&gt;HTMLDocument&lt;/a&gt;&lt;/code&gt;s must run
-  the following algorithm:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;
-
-    &lt;p&gt;The user agent must create a new &lt;span&gt;XML parser&lt;/span&gt;&lt;!-- XXX xref --&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt;
-    attribute is being set on an element, the user agent must
-    &lt;span&gt;feed the parser&lt;/span&gt; just created the string corresponding
-    to the start tag of that element, declaring all the namespace
-    prefixes that are in scope on that element in the DOM, as well as
-    declaring the default namespace (if any) that is in scope on that
-    element in the DOM.&lt;/p&gt;
-
-    &lt;p&gt;A namespace prefix is in scope if the DOM Core &lt;code title=&quot;&quot;&gt;lookupNamespaceURI()&lt;/code&gt; method on the element would
-    return a non-null value for that prefix.&lt;/p&gt;
-
-    &lt;p&gt;The default namespace is the namespace for which the DOM Core
-    &lt;code title=&quot;&quot;&gt;isDefaultNamespace()&lt;/code&gt; method on the element
-    would return true.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;The user agent must &lt;span&gt;feed the parser&lt;/span&gt; just created
-    the string being assigned into the &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt;
-    attribute is being set on an element, the user agent must
-    &lt;span&gt;feed the parser&lt;/span&gt; the string corresponding to the end
-    tag of that element.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the parser found an XML well-formedness or XML namespace
-    well-formedness error, the attribute's setter must raise a
-    &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception and abort these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;The user agent must remove the children nodes of the node whose
-    &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute is
-    being set.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the attribute is being set on a &lt;code&gt;Document&lt;/code&gt; node,
-    let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be the children of the
-    document, preserving their order. Otherwise, the attribute is
-    being set on an &lt;code&gt;Element&lt;/code&gt; node; let &lt;var title=&quot;&quot;&gt;new
-    children&lt;/var&gt; be the children of the document's root element,
-    preserving their order.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the attribute is being set on a &lt;code&gt;Document&lt;/code&gt; node,
-    let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be that
-    &lt;code&gt;Document&lt;/code&gt; node. Otherwise, the attribute is being set
-    on an &lt;code&gt;Element&lt;/code&gt; node; let &lt;var title=&quot;&quot;&gt;target
-    document&lt;/var&gt; be the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of that
-    &lt;code&gt;Element&lt;/code&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Set the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of all the nodes in
-    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;target
-    document&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Append all the &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; nodes to the
-    node whose &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt;
-    attribute is being set, preserving their order.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;In an XML context, the &lt;dfn id=dom-document-write-xml title=dom-document-write-XML&gt;&lt;code&gt;document.write()&lt;/code&gt;&lt;/dfn&gt;
-  and &lt;dfn id=dom-insertadjacenthtml-xml title=dom-insertAdjacentHTML-XML&gt;&lt;code&gt;insertAdjacentHTML()&lt;/code&gt;&lt;/dfn&gt;
-  methods, and the &lt;dfn id=dom-outerhtml-xml title=dom-outerHTML-XML&gt;&lt;code&gt;outerHTML&lt;/code&gt;&lt;/dfn&gt; attribute on
-  both getting and setting, must raise an
-  &lt;code&gt;&lt;a href=#invalid_access_err&gt;INVALID_ACCESS_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/p&gt;
-
-&lt;!--
-Where would document.write() insert?
-Consider: data:text/xml,&lt;script xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;&gt;&lt;![CDATA[ document.write('&lt;foo&gt;Test&lt;/foo&gt;'); ]]&gt;&lt;/script&gt;
---&gt;
-
-
-
-
-  &lt;h2 id=semantics&gt;&lt;span class=secno&gt;4 &lt;/span&gt;The elements of HTML&lt;/h2&gt;
-
   &lt;h3 id=the-root-element&gt;&lt;span class=secno&gt;4.1 &lt;/span&gt;The root element&lt;/h3&gt;
 
   &lt;h4 id=the-html-element&gt;&lt;span class=secno&gt;4.1.1 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;html&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
@@ -9561,7 +9366,7 @@
   node&quot;&gt;text nodes&lt;/a&gt; that are direct children of the
   &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt; element (not any other nodes such as comments or
   elements), in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;, to the style system. For
-  XML-based styling languages, user agents must pass all the children
+  XML-based styling languages, user agents must pass all the child
   nodes of the &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt; element to the style system.&lt;/p&gt;
 
   &lt;p&gt;All &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; found by the styling language's
@@ -9786,21 +9591,12 @@
   if set, must be propagated to the clone when it is created. The
   second is a flag indicating whether the element was
   &lt;dfn id=parser-inserted&gt;&quot;parser-inserted&quot;&lt;/dfn&gt;. This flag is set by the &lt;a href=#html-parser&gt;HTML
-  parser&lt;/a&gt; and is used to handle &lt;code title=dom-document-write-HTML&gt;&lt;a href=#dom-document-write-html&gt;document.write()&lt;/a&gt;&lt;/code&gt; calls. The
-  third and fourth pieces of metadata are &lt;dfn id=&quot;the-script-block's-type&quot;&gt;&lt;var&gt;the script block's
+  parser&lt;/a&gt; and is used to handle &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; calls. The third
+  and fourth pieces of metadata are &lt;dfn id=&quot;the-script-block's-type&quot;&gt;&lt;var&gt;the script block's
   type&lt;/var&gt;&lt;/dfn&gt; and &lt;dfn id=&quot;the-script-block's-character-encoding&quot;&gt;&lt;var&gt;the script block's character
   encoding&lt;/var&gt;&lt;/dfn&gt;. They are determined when the script is run,
   based on the attributes on the element at that time.&lt;/p&gt;
 
-  &lt;p&gt;When an &lt;span&gt;XML parser&lt;/span&gt;&lt;!-- XXX xref --&gt; creates a
-  &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; element, it must be marked as being
-  &lt;a href=#parser-inserted&gt;&quot;parser-inserted&quot;&lt;/a&gt;. When the element's end tag is
-  parsed, the user agent must &lt;a href=#running-a-script title=&quot;running a
-  script&quot;&gt;run&lt;/a&gt; the &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
-
-  &lt;p class=note&gt;Equivalent requirements exist for the &lt;a href=#html-parser&gt;HTML
-  parser&lt;/a&gt;, but they are detailed in that section instead.&lt;/p&gt;
-
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; element that is marked as neither
   having &lt;a href=#already-executed&gt;&quot;already executed&quot;&lt;/a&gt; nor being
   &lt;a href=#parser-inserted&gt;&quot;parser-inserted&quot;&lt;/a&gt; is &lt;a href=#insert-an-element-into-a-document title=&quot;insert an element
@@ -9858,15 +9654,10 @@
 
     &lt;p&gt;If &lt;a href=#concept-n-noscript title=concept-n-noscript&gt;scripting is
     disabled&lt;/a&gt; for the &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; element, or if the
-    &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; element was created by an &lt;span&gt;XML
-    parser&lt;/span&gt;&lt;!-- XXX xref --&gt; that itself was created as part of
-    the processing of the &lt;code title=dom-innerHTML-XML&gt;&lt;a href=#dom-innerhtml-xml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; attribute's setter&lt;!--
-    no need to worry about the HTML case, as the HTML parser handles
-    that for us --&gt;, or if the user agent does not &lt;a href=#support-the-scripting-language&gt;support the
-    scripting language&lt;/a&gt; given by &lt;var&gt;&lt;a href=&quot;#the-script-block's-type&quot;&gt;the script block's
-    type&lt;/a&gt;&lt;/var&gt; for this &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; element, then the user
-    agent must abort these steps at this point. The script is not
-    executed.&lt;/p&gt;
+    user agent does not &lt;a href=#support-the-scripting-language&gt;support the scripting language&lt;/a&gt;
+    given by &lt;var&gt;&lt;a href=&quot;#the-script-block's-type&quot;&gt;the script block's type&lt;/a&gt;&lt;/var&gt; for this
+    &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; element, then the user agent must abort these
+    steps at this point. The script is not executed.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -10194,8 +9985,14 @@
 
   &lt;/div&gt;
 
+  &lt;p class=note&gt;When inserted using the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; method,
+  &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; elements execute (typically synchronously), but
+  when inserted using &lt;code title=dom-innerHTML&gt;&lt;a href=#dom-innerhtml&gt;innerHTML&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-outerHTML&gt;&lt;a href=#dom-outerhtml&gt;outerHTML&lt;/a&gt;&lt;/code&gt; attributes, they do not
+  execute at all.&lt;/p&gt;
 
 
+
+
   &lt;h5 id=scriptingLanguages&gt;&lt;span class=secno&gt;4.3.1.1 &lt;/span&gt;Scripting languages&lt;/h5&gt;
 
   &lt;p&gt;A user agent is said to &lt;dfn id=support-the-scripting-language&gt;support the scripting language&lt;/dfn&gt;
@@ -10357,7 +10154,7 @@
        &lt;a href=#text-node&gt;text node&lt;/a&gt; children of the &lt;code&gt;&lt;a href=#the-noscript-element&gt;noscript&lt;/a&gt;&lt;/code&gt;
        element.&lt;/li&gt;
 
-       &lt;li&gt;Set the &lt;code title=dom-innerHTML-HTML&gt;&lt;a href=#dom-innerhtml-html&gt;innerHTML&lt;/a&gt;&lt;/code&gt;
+       &lt;li&gt;Set the &lt;code title=dom-innerHTML&gt;&lt;a href=#dom-innerhtml&gt;innerHTML&lt;/a&gt;&lt;/code&gt;
        attribute of the &lt;var title=&quot;&quot;&gt;parent element&lt;/var&gt; to the value
        of &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;. (This, as a side-effect, causes the
        &lt;code&gt;&lt;a href=#the-noscript-element&gt;noscript&lt;/a&gt;&lt;/code&gt; element to be removed from the
@@ -44097,7 +43894,7 @@
     steps:&lt;/p&gt;
     &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the document is an &lt;span&gt;XML document&lt;/span&gt;, then
      throw an &lt;code&gt;&lt;a href=#invalid_access_err&gt;INVALID_ACCESS_ERR&lt;/a&gt;&lt;/code&gt; exception and abort
-     these steps.&lt;/li&gt;
+     these steps.&lt;/li&gt;&lt;!-- XXX support XML? --&gt;
      &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; argument wasn't
      specified, abort these steps without doing anything.&lt;/li&gt;
      &lt;li&gt;&lt;p&gt;If there is a selection, act as if the user had requested
@@ -46343,10 +46140,11 @@
 
 
 
-  &lt;h2 id=syntax&gt;&lt;span class=secno&gt;8 &lt;/span&gt;The HTML syntax&lt;/h2&gt;
+  &lt;h2 id=syntax&gt;&lt;span class=secno&gt;8 &lt;/span&gt;&lt;dfn&gt;The HTML syntax&lt;/dfn&gt;&lt;/h2&gt;
 
   &lt;p class=note&gt;This section only describes the rules for &lt;code title=&quot;&quot;&gt;text/html&lt;/code&gt; resources. Rules for XML resources are
-  defined by the XML specifications.&lt;/p&gt;
+  discussed in the section below entitled &quot;&lt;a href=#the-xhtml-syntax&gt;The XHTML
+  syntax&lt;/a&gt;&quot;.&lt;/p&gt;
 
   &lt;h3 id=writing-html-documents&gt;&lt;span class=secno&gt;8.1 &lt;/span&gt;Writing HTML documents&lt;/h3&gt;
 
@@ -47094,16 +46892,13 @@
   and conformance checkers.&lt;/em&gt;&lt;/p&gt;
  
   &lt;p&gt;The rules for parsing &lt;a href=#xml-documents&gt;XML documents&lt;/a&gt; (and thus
-  &lt;a href=#xhtml5&gt;XHTML&lt;/a&gt; documents) into DOM trees are covered by the XML
-  and Namespaces in XML specifications, and are out of scope of this
-  specification. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt; &lt;a href=#refsXMLNS&gt;[XMLNS]&lt;/a&gt; &lt;!-- XXX refs --&gt;&lt;/p&gt;
+  &lt;a href=#xhtml5&gt;XHTML&lt;/a&gt; documents) into DOM trees are covered by the next
+  section, entitled &quot;&lt;a href=#the-xhtml-syntax&gt;The XHTML syntax&lt;/a&gt;&quot;.&lt;/p&gt;
 
   &lt;p&gt;For &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt;, user agents must use the parsing
   rules described in this section to generate the DOM trees. Together,
   these rules define what is referred to as the &lt;dfn id=html-parser&gt;HTML
-  parser&lt;/dfn&gt;.&lt;/p&gt;&lt;!-- XXX should probably remove that &quot;must&quot; since
-  it'll be redundant with something in the navigating processing model
-  eventually --&gt;
+  parser&lt;/dfn&gt;.&lt;/p&gt;
 
   &lt;div class=note&gt;
 
@@ -47166,7 +46961,7 @@
 
   &lt;p&gt;In the common case, the data handled by the tokenization stage
   comes from the network, but &lt;a href=#dynamic-markup-insertion title=&quot;dynamic markup
-  insertion&quot;&gt;it can also come from script&lt;/a&gt;, e.g. using the &lt;code title=dom-document-write-HTML&gt;&lt;a href=#dom-document-write-html&gt;document.write()&lt;/a&gt;&lt;/code&gt; API.&lt;/p&gt;
+  insertion&quot;&gt;it can also come from script&lt;/a&gt;, e.g. using the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; API.&lt;/p&gt;
 
   &lt;p&gt;&lt;img alt=&quot;&quot; src=images/parsing-model-overview.png&gt;&lt;/p&gt;
 
@@ -47723,7 +47518,7 @@
 
   &lt;p&gt;The &lt;dfn id=insertion-point&gt;insertion point&lt;/dfn&gt; is the position (just before a
   character or just before the end of the input stream) where content
-  inserted using &lt;code title=dom-document-write-HTML&gt;&lt;a href=#dom-document-write-html&gt;document.write()&lt;/a&gt;&lt;/code&gt; is actually
+  inserted using &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; is actually
   inserted. The insertion point is relative to the position of the
   character immediately after it, it is not an absolute offset into
   the input stream. Initially, the insertion point is
@@ -49549,7 +49344,7 @@
   &lt;p id=mutation-during-parsing&gt;DOM mutation events must not fire
   for changes caused by the UA parsing the document. (Conceptually,
   the parser is not mutating the DOM, it is constructing it.) This
-  includes the parsing of any content inserted using &lt;code title=dom-document-write-HTML&gt;&lt;a href=#dom-document-write-html&gt;document.write()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-writeln&gt;&lt;a href=#dom-document-writeln&gt;document.writeln()&lt;/a&gt;&lt;/code&gt; calls. &lt;a href=#refsDOM3EVENTS&gt;[DOM3EVENTS]&lt;/a&gt;&lt;/p&gt;
+  includes the parsing of any content inserted using &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-writeln&gt;&lt;a href=#dom-document-writeln&gt;document.writeln()&lt;/a&gt;&lt;/code&gt; calls. &lt;a href=#refsDOM3EVENTS&gt;[DOM3EVENTS]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p class=note&gt;Not all of the tag names mentioned below are
   conformant tag names in this specification; many are included to
@@ -50212,11 +50007,12 @@
 
       &lt;p&gt;Mark the element as being &lt;a href=#parser-inserted&gt;&quot;parser-inserted&quot;&lt;/a&gt;.&lt;/p&gt;
 
-      &lt;p class=note&gt;This ensures that, if the script is external, any
-      &lt;code title=dom-document-write-HTML&gt;&lt;a href=#dom-document-write-html&gt;document.write()&lt;/a&gt;&lt;/code&gt;
+      &lt;p class=note&gt;This ensures that, if the script is external,
+      any &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt;
       calls in the script will execute in-line, instead of blowing the
       document away, as would happen in most other cases. It also
-      prevents the script from executing until the end tag is seen.&lt;/p&gt;
+      prevents the script from executing until the end tag is
+      seen.&lt;/p&gt;
 
      &lt;/li&gt;
 
@@ -51657,9 +51453,9 @@
     one.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=#running-a-script title=&quot;running a script&quot;&gt;Run&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;script&lt;/var&gt;. This might cause some script to execute,
-    which might cause &lt;a href=#dom-document-write-html title=dom-document-write-HTML&gt;new
-    characters to be inserted into the tokeniser&lt;/a&gt;, and might
-    cause the tokeniser to output more tokens, resulting in a &lt;a href=#nestedParsing&gt;reentrant invocation of the parser&lt;/a&gt;.&lt;/p&gt;
+    which might cause &lt;a href=#dom-document-write title=dom-document-write&gt;new characters
+    to be inserted into the tokeniser&lt;/a&gt;, and might cause the
+    tokeniser to output more tokens, resulting in a &lt;a href=#nestedParsing&gt;reentrant invocation of the parser&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Decrement the parser's &lt;a href=#script-nesting-level&gt;script nesting level&lt;/a&gt; by
     one. If the parser's &lt;a href=#script-nesting-level&gt;script nesting level&lt;/a&gt; is zero,
@@ -51675,7 +51471,7 @@
     &lt;a href=#pending-external-script&gt;pending external script&lt;/a&gt;, then:&lt;/p&gt;
 
     &lt;dl class=switch&gt;&lt;dt&gt;If the tree construction stage is &lt;a href=#nestedParsing&gt;being called reentrantly&lt;/a&gt;, say from a
-     call to &lt;code title=dom-document-write-HTML&gt;&lt;a href=#dom-document-write-html&gt;document.write()&lt;/a&gt;&lt;/code&gt;:&lt;/dt&gt;
+     call to &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt;:&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;Set the &lt;a href=#parser-pause-flag&gt;parser pause flag&lt;/a&gt; to true, and abort
      the processing of any nested invocations of the tokeniser,
@@ -53369,16 +53165,16 @@
   &lt;h3 id=parsing-html-fragments&gt;&lt;span class=secno&gt;8.5 &lt;/span&gt;Parsing HTML fragments&lt;/h3&gt;
 
   &lt;p&gt;The following steps form the &lt;dfn id=html-fragment-parsing-algorithm&gt;HTML fragment parsing
-  algorithm&lt;/dfn&gt;. The algorithm takes as input a DOM
-  &lt;code&gt;Element&lt;/code&gt;, referred to as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt;
-  element, which gives the context for the parser, as well as &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, a string to parse, and returns a list of zero
-  or more nodes.&lt;/p&gt;
+  algorithm&lt;/dfn&gt;. The algorithm optionally takes as input an
+  &lt;code&gt;Element&lt;/code&gt; node, referred to as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, which gives the context for the
+  parser, as well as &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, a string to parse, and
+  returns a list of zero or more nodes.&lt;/p&gt;
 
   &lt;p class=note&gt;Parts marked &lt;dfn id=fragment-case&gt;fragment case&lt;/dfn&gt; in algorithms
   in the parser section are parts that only occur if the parser was
-  created for the purposes of this algorithm. The algorithms have been
-  annotated with such markings for informational purposes only; such
-  markings have no normative weight. If it is possible for a condition
+  created for the purposes of this algorithm (and with a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element). The algorithms have been annotated
+  with such markings for informational purposes only; such markings
+  have no normative weight. If it is possible for a condition
   described as a &lt;a href=#fragment-case&gt;fragment case&lt;/a&gt; to occur even when the
   parser wasn't created for the purposes of handling this algorithm,
   then that is an error in the specification.&lt;/p&gt;
@@ -53399,86 +53195,93 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Set the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt;'s &lt;a href=#tokenization&gt;tokenization&lt;/a&gt;
-    stage's &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; according to the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, as follows:&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, run these
+    substeps:&lt;/p&gt;
 
-    &lt;dl class=switch&gt;&lt;dt&gt;If it is a &lt;code&gt;&lt;a href=#the-title-element&gt;title&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a href=#the-textarea-element&gt;textarea&lt;/a&gt;&lt;/code&gt;
-     element&lt;/dt&gt;
+    &lt;ol&gt;&lt;li&gt;
 
-     &lt;dd&gt;Set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to
-     the RCDATA state.&lt;/dd&gt;
+      &lt;p&gt;Set the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt;'s &lt;a href=#tokenization&gt;tokenization&lt;/a&gt;
+      stage's &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; according to the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, as follows:&lt;/p&gt;
 
+      &lt;dl class=switch&gt;&lt;dt&gt;If it is a &lt;code&gt;&lt;a href=#the-title-element&gt;title&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a href=#the-textarea-element&gt;textarea&lt;/a&gt;&lt;/code&gt;
+       element&lt;/dt&gt;
 
-     &lt;dt&gt;If it is a &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt;,
-     &lt;code&gt;xmp&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;noembed&lt;/code&gt;, or
-     &lt;code&gt;noframes&lt;/code&gt; element&lt;/dt&gt;
+       &lt;dd&gt;Set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to
+       the RCDATA state.&lt;/dd&gt;
 
-     &lt;dd&gt;Set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to
-     the CDATA state.&lt;/dd&gt;
 
+       &lt;dt&gt;If it is a &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt;,
+       &lt;code&gt;xmp&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;noembed&lt;/code&gt;, or
+       &lt;code&gt;noframes&lt;/code&gt; element&lt;/dt&gt;
 
-     &lt;dt&gt;If it is a &lt;code&gt;&lt;a href=#the-noscript-element&gt;noscript&lt;/a&gt;&lt;/code&gt; element&lt;/dt&gt;
+       &lt;dd&gt;Set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to
+       the CDATA state.&lt;/dd&gt;
 
-     &lt;dd&gt;If the &lt;a href=#scripting-flag&gt;scripting flag&lt;/a&gt; is enabled, set the
-     &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to the CDATA
-     state. Otherwise, set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to the
-     PCDATA state.&lt;/dd&gt;
 
+       &lt;dt&gt;If it is a &lt;code&gt;&lt;a href=#the-noscript-element&gt;noscript&lt;/a&gt;&lt;/code&gt; element&lt;/dt&gt;
 
-     &lt;dt&gt;If it is a &lt;code&gt;plaintext&lt;/code&gt; element&lt;/dt&gt;
+       &lt;dd&gt;If the &lt;a href=#scripting-flag&gt;scripting flag&lt;/a&gt; is enabled, set the
+       &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to the CDATA
+       state. Otherwise, set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to the
+       PCDATA state.&lt;/dd&gt;
 
-     &lt;dd&gt;Set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to
-     PLAINTEXT.&lt;/dd&gt;
 
+       &lt;dt&gt;If it is a &lt;code&gt;plaintext&lt;/code&gt; element&lt;/dt&gt;
 
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
+       &lt;dd&gt;Set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to
+       PLAINTEXT.&lt;/dd&gt;
 
-     &lt;dd&gt;Set the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; to the PCDATA
-     state.&lt;/dd&gt;
 
-    &lt;/dl&gt;&lt;/li&gt;
+       &lt;dt&gt;Otherwise&lt;/dt&gt;
 
-   &lt;li&gt;
+       &lt;dd&gt;Leave the &lt;a href=#content-model-flag&gt;content model flag&lt;/a&gt; in the PCDATA
+       state.&lt;/dd&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be a new &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; element
-    with no attributes.&lt;/p&gt;
+      &lt;/dl&gt;&lt;/li&gt;
 
-   &lt;/li&gt;
+     &lt;li&gt;
 
-   &lt;li&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be a new &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; element
+      with no attributes.&lt;/p&gt;
 
-    &lt;p&gt;Append the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; to the
-    &lt;code&gt;Document&lt;/code&gt; node created above.&lt;/p&gt;
+     &lt;/li&gt;
 
-   &lt;/li&gt;
+     &lt;li&gt;
 
-   &lt;li&gt;
+      &lt;p&gt;Append the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; to the
+      &lt;code&gt;Document&lt;/code&gt; node created above.&lt;/p&gt;
 
-    &lt;p&gt;Set up the parser's &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; so that
-    it contains just the single element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;
+     &lt;/li&gt;
 
-   &lt;/li&gt;
+     &lt;li&gt;
 
-   &lt;li&gt;
+      &lt;p&gt;Set up the parser's &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; so that
+      it contains just the single element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;a href=#reset-the-insertion-mode-appropriately title=&quot;reset the insertion mode appropriately&quot;&gt;Reset the
-    parser's insertion mode appropriately&lt;/a&gt;.&lt;/p&gt;
+     &lt;/li&gt;
 
-    &lt;p class=note&gt;The parser will reference the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element as part of that algorithm.&lt;/p&gt;
+     &lt;li&gt;
 
-   &lt;/li&gt;
+      &lt;p&gt;&lt;a href=#reset-the-insertion-mode-appropriately title=&quot;reset the insertion mode appropriately&quot;&gt;Reset the
+      parser's insertion mode appropriately&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;li&gt;
+      &lt;p class=note&gt;The parser will reference the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element as part of that algorithm.&lt;/p&gt;
 
-    &lt;p&gt;Set the parser's &lt;a href=#form-element-pointer&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/a&gt;
-    to the nearest node to the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element
-    that is a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element (going straight up the
-    ancestor chain, and including the element itself, if it is a
-    &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element), or, if there is no such
-    &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element, to null.&lt;/p&gt;
+     &lt;/li&gt;
 
-   &lt;/li&gt;
+     &lt;li&gt;
 
+      &lt;p&gt;Set the parser's &lt;a href=#form-element-pointer&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/a&gt;
+      to the nearest node to the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element
+      that is a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element (going straight up the
+      ancestor chain, and including the element itself, if it is a
+      &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element), or, if there is no such
+      &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element, to null.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;Place into the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; for the &lt;a href=#html-parser&gt;HTML
@@ -53497,9 +53300,13 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Return all the child nodes of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;,
-    preserving the document order.&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, return the
+    child nodes of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, in &lt;a href=#tree-order&gt;tree
+    order&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, return the children of the &lt;code&gt;Document&lt;/code&gt;
+    object, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/p&gt;
+
    &lt;/li&gt;
 
   &lt;/ol&gt;&lt;h3 id=named-character-references&gt;&lt;span class=secno&gt;8.6 &lt;/span&gt;&lt;dfn&gt;Named character references&lt;/dfn&gt;&lt;/h3&gt;
@@ -55658,8 +55465,222 @@
 
 
 
-  &lt;h2 id=rendering&gt;&lt;span class=secno&gt;9 &lt;/span&gt;Rendering&lt;/h2&gt;
+  &lt;h2 id=the-xhtml-syntax&gt;&lt;span class=secno&gt;9 &lt;/span&gt;&lt;dfn&gt;The XHTML syntax&lt;/dfn&gt;&lt;/h2&gt;
 
+  &lt;p class=note&gt;This section only describes the rules for XML
+  resources. Rules for &lt;code title=&quot;&quot;&gt;text/html&lt;/code&gt; resources are
+  discussed in the section above entitled &quot;&lt;a href=#syntax&gt;The HTML
+  syntax&lt;/a&gt;&quot;.&lt;/p&gt;
+
+
+  &lt;h3 id=writing-xhtml-documents&gt;&lt;span class=secno&gt;9.1 &lt;/span&gt;Writing XHTML documents&lt;/h3&gt;
+
+  &lt;p&gt;The syntax for using HTML with XML, whether in XHTML documents or
+  embedded in other XML documents, is defined in the XML and
+  Namespaces in XML specifications. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt; &lt;a href=#refsXMLNS&gt;[XMLNS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;This specification does not define any syntax-level requirements
+  beyond those defined for XML proper.&lt;/p&gt;
+
+
+  &lt;h3 id=parsing-xhtml-documents&gt;&lt;span class=secno&gt;9.2 &lt;/span&gt;Parsing XHTML documents&lt;/h3&gt;
+
+  &lt;p&gt;This section describes the relationship between XML and the DOM,
+  with a particular emphasis on how this interacts with HTML.&lt;/p&gt;
+
+  &lt;p&gt;An &lt;dfn id=xml-parser&gt;XML parser&lt;/dfn&gt;, for the purposes of this specification,
+  is a construct that follows the rules given in the XML specification
+  to map a string of bytes or characters into a &lt;code&gt;Document&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;An &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt; is either associated with a
+  &lt;code&gt;Document&lt;/code&gt; object when it is created, or creates one
+  implicitly.&lt;/p&gt;
+
+  &lt;p&gt;This &lt;code&gt;Document&lt;/code&gt; must then be populated with DOM nodes
+  that represent the tree structure of the input passed to the parser,
+  as defined by the XML specification, the Namespaces in XML
+  specification, and the DOM Core specification. DOM mutation events
+  must not fire for the operations that the &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt;
+  performs on the &lt;code&gt;Document&lt;/code&gt;'s tree, but the user agent
+  must act as if elements and attributes were individually appended
+  and set respectively so as to trigger rules in this specification
+  regarding what happens when an element in inserted into a document
+  or has its attributes set. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt; &lt;a href=#refsXMLNS&gt;[XMLNS]&lt;/a&gt; &lt;a href=#refsDOMCORE&gt;[DOMCORE]&lt;/a&gt;
+  &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;Certain algorithms in this specification &lt;dfn id=feed-the-parser title=&quot;feed the
+  parser&quot;&gt;spoon-feed the parser&lt;/dfn&gt; characters one string at a
+  time. In such cases, the &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt; must act as it
+  would have if faced with a single string consisting of the
+  concatenation of all those characters.&lt;/p&gt;
+
+  &lt;p&gt;When an &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt; creates a &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt;
+  element, it must be marked as being &lt;a href=#parser-inserted&gt;&quot;parser-inserted&quot;&lt;/a&gt;.
+  If the parser was originally created for the &lt;a href=#xml-fragment-parsing-algorithm&gt;XML fragment
+  parsing algorithm&lt;/a&gt;, then the element must be marked as
+  &lt;a href=#already-executed&gt;&quot;already executed&quot;&lt;/a&gt; also. When the element's end tag is
+  parsed, the user agent must &lt;a href=#running-a-script title=&quot;running a
+  script&quot;&gt;run&lt;/a&gt; the &lt;code&gt;&lt;a href=#script&gt;script&lt;/a&gt;&lt;/code&gt; element. If this causes
+  there to be a &lt;a href=#pending-external-script&gt;pending external script&lt;/a&gt;, then the user
+  agent must &lt;a href=#pause&gt;pause&lt;/a&gt; until that script has &lt;a href=#completed-loading&gt;completed
+  loading&lt;/a&gt;, and then &lt;a href=#executing-a-script-block title=&quot;executing a script
+  block&quot;&gt;execute it&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p class=note&gt;Since the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; API is not
+  available for &lt;a href=#xml-documents&gt;XML documents&lt;/a&gt;, much of the complexity in
+  the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; is not needed in the &lt;a href=#xml-parser&gt;XML
+  parser&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;When an &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt; reaches the end of its input, it
+  must &lt;a href=#stop-parsing&gt;stop parsing&lt;/a&gt;, following the same rules as the
+  &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt;.&lt;/p&gt;
+
+
+
+  &lt;h3 id=serializing-xhtml-fragments&gt;&lt;span class=secno&gt;9.3 &lt;/span&gt;Serializing XHTML fragments&lt;/h3&gt;
+
+  &lt;p&gt;The &lt;dfn id=xml-fragment-serialization-algorithm&gt;XML fragment serialization algorithm&lt;/dfn&gt; for a
+  &lt;code&gt;Document&lt;/code&gt; or &lt;code&gt;Element&lt;/code&gt; node either returns a
+  fragment of XML that represents that node or raises an
+  exception.&lt;/p&gt;
+
+  &lt;p&gt;For &lt;code&gt;Document&lt;/code&gt;s, the algorithm must return a string in
+  the form of a &lt;a href=<A HREF="http://www.w3.org/TR/xml/#sec-well-formed">http://www.w3.org/TR/xml/#sec-well-formed</A>&gt;document
+  entity&lt;/a&gt;, if none of the error cases below apply.&lt;/p&gt;
+
+  &lt;p&gt;For &lt;code&gt;Element&lt;/code&gt;s, the algorithm must return a string in
+  the form of an &lt;a href=<A HREF="http://www.w3.org/TR/xml/#wf-entities">http://www.w3.org/TR/xml/#wf-entities</A>&gt;internal general parsed
+  entity&lt;/a&gt;, if none of the error cases below apply.&lt;/p&gt;
+
+  &lt;p&gt;In both cases, the string returned must be XML
+  namespace-well-formed and must be an isomorphic serialization of all
+  of that node's child nodes, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;. User agents
+  may adjust prefixes and namespace declarations in the serialization
+  (and indeed might be forced to do so in some cases to obtain
+  namespace-well-formed XML).&lt;/p&gt;
+
+  &lt;p&gt;For &lt;code&gt;Element&lt;/code&gt;s, if any of the elements in the
+  serialization are in no namespace, the default namespace in scope
+  for those elements must be explicitly declared as the empty
+  string.&lt;!-- because otherwise round-tripping might break since it'll
+  pick up the surrounding default ns when setting --&gt; (This doesn't
+  apply in the &lt;code&gt;Document&lt;/code&gt; case.) &lt;a href=#refsXML&gt;[XML]&lt;/a&gt; &lt;a href=#refsXMLNS&gt;[XMLNS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;If any of the following error cases are found in the DOM subtree
+  being serialized, then the algorithm raises an
+  &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception instead of returning a
+  string:&lt;/p&gt;
+
+  &lt;ul&gt;&lt;li&gt;A &lt;code&gt;Document&lt;/code&gt; node with no child element nodes.&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;DocumentType&lt;/code&gt; node that has an external subset
+   public identifier that contains characters that are not matched by
+   the XML &lt;code title=&quot;&quot;&gt;PubidChar&lt;/code&gt; production. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt;&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;DocumentType&lt;/code&gt; node that has an external subset
+   system identifier that contains both a U+0022 QUOTATION MARK ('&quot;')
+   and a U+0027 APOSTROPHE (&quot;'&quot;).&lt;/li&gt;
+
+   &lt;li&gt;A node with a prefix or local name containing a U+003A COLON
+   (&quot;:&quot;).&lt;/li&gt;
+
+   &lt;li&gt;An &lt;code&gt;Attr&lt;/code&gt; node, &lt;code&gt;Text&lt;/code&gt; node,
+   &lt;code&gt;CDATASection&lt;/code&gt; node, &lt;code&gt;Comment&lt;/code&gt; node, or
+   &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose data contains
+   characters that are not matched by the XML &lt;code title=&quot;&quot;&gt;Char&lt;/code&gt; production. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt;&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;CDATASection&lt;/code&gt; node whose data contains the string
+   &quot;&lt;code title=&quot;&quot;&gt;]]&gt;&lt;/code&gt;&quot;.&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;Comment&lt;/code&gt; node whose data contains two adjacent
+   U+002D HYPHEN-MINUS (-) characters or ends with such a
+   character.&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose target name is
+   an &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the string &quot;&lt;code title=&quot;&quot;&gt;xml&lt;/code&gt;&quot;.&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose target name
+   contains a U+003A COLON (&quot;:&quot;).&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose data contains
+   the string &quot;&lt;code title=&quot;&quot;&gt;?&gt;&lt;/code&gt;&quot;.&lt;/li&gt;
+
+  &lt;/ul&gt;&lt;p class=note&gt;These are the only ways to make a DOM
+  unserializable. The DOM enforces all the other XML constraints; for
+  example, trying to set an attribute with a name that contains an
+  equals sign (=) will raised an &lt;code&gt;&lt;a href=#invalid_character_err&gt;INVALID_CHARACTER_ERR&lt;/a&gt;&lt;/code&gt;
+  exception.&lt;/p&gt;
+
+
+
+  &lt;h3 id=parsing-xhtml-fragments&gt;&lt;span class=secno&gt;9.4 &lt;/span&gt;Parsing XHTML fragments&lt;/h3&gt;
+
+  &lt;p&gt;The &lt;dfn id=xml-fragment-parsing-algorithm&gt;XML fragment parsing algorithm&lt;/dfn&gt; for either returns
+  a &lt;code&gt;Document&lt;/code&gt; or raises a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt;
+  exception. Given a string &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; and an optional
+  context element &lt;var title=&quot;&quot;&gt;context&lt;/var&gt;, the algorithm is as
+  follows:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;Create a new &lt;a href=#xml-parser&gt;XML parser&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, &lt;a href=#feed-the-parser&gt;feed
+    the parser&lt;/a&gt; just created the string corresponding to the
+    start tag of that element, declaring all the namespace prefixes
+    that are in scope on that element in the DOM, as well as declaring
+    the default namespace (if any) that is in scope on that element in
+    the DOM.&lt;/p&gt;
+
+    &lt;p&gt;A namespace prefix is in scope if the DOM Core &lt;code title=&quot;&quot;&gt;lookupNamespaceURI()&lt;/code&gt; method on the element would
+    return a non-null value for that prefix.&lt;/p&gt;
+
+    &lt;p&gt;The default namespace is the namespace for which the DOM Core
+    &lt;code title=&quot;&quot;&gt;isDefaultNamespace()&lt;/code&gt; method on the element
+    would return true.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;a href=#feed-the-parser&gt;Feed the parser&lt;/a&gt; just created the string &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, &lt;a href=#feed-the-parser&gt;feed
+    the parser&lt;/a&gt; just created the string corresponding to the
+    end tag of that element.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is an XML well-formedness or XML namespace
+    well-formedness error, then raise a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt;
+    exception and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, then return
+    the child nodes of the root element of the resulting
+    &lt;code&gt;Document&lt;/code&gt;, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, return the children of the &lt;code&gt;Document&lt;/code&gt;
+    object, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;&lt;h2 id=rendering&gt;&lt;span class=secno&gt;10 &lt;/span&gt;Rendering&lt;/h2&gt;
+
   &lt;!-- XXX
 
     Rendering
@@ -55839,9 +55860,9 @@
 
 
 
-  &lt;h3 id=rendering-and-menus/toolbars&gt;&lt;span class=secno&gt;9.1 &lt;/span&gt;Rendering and menus/toolbars&lt;/h3&gt;
+  &lt;h3 id=rendering-and-menus/toolbars&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Rendering and menus/toolbars&lt;/h3&gt;
 
-  &lt;h4 id=&quot;the-'icon'-property&quot;&gt;&lt;span class=secno&gt;9.1.1 &lt;/span&gt;The 'icon' property&lt;/h4&gt;
+  &lt;h4 id=&quot;the-'icon'-property&quot;&gt;&lt;span class=secno&gt;10.1.1 &lt;/span&gt;The 'icon' property&lt;/h4&gt;
 
   &lt;p&gt;UAs should use the command's Icon as the default generic icon
   provided by the user agent when the 'icon' property computes to
@@ -55852,15 +55873,15 @@
 
 
 
-  &lt;h2 id=obsolete-features&gt;&lt;span class=secno&gt;10 &lt;/span&gt;Obsolete features&lt;/h2&gt;
+  &lt;h2 id=obsolete-features&gt;&lt;span class=secno&gt;11 &lt;/span&gt;Obsolete features&lt;/h2&gt;
 
   &lt;p&gt;Authors and documents must not use the features listed in this
   section. They are documented to enable user agents to support legacy
   content in an interoperable fashion.&lt;/p&gt;
 
-  &lt;h3 id=obsolete-elements&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Obsolete elements&lt;/h3&gt;
+  &lt;h3 id=obsolete-elements&gt;&lt;span class=secno&gt;11.1 &lt;/span&gt;Obsolete elements&lt;/h3&gt;
 
-  &lt;h4 id=the-body-element-0&gt;&lt;span class=secno&gt;10.1.1 &lt;/span&gt;The &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; element&lt;/h4&gt;
+  &lt;h4 id=the-body-element-0&gt;&lt;span class=secno&gt;11.1.1 &lt;/span&gt;The &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; element&lt;/h4&gt;
 
   &lt;pre class=idl&gt;[XXX] interface &lt;a href=#htmldocument&gt;HTMLDocument&lt;/a&gt; {
            attribute DOMString &lt;a href=#dom-document-fgcolor title=dom-document-fgColor&gt;fgColor&lt;/a&gt;;
@@ -55936,7 +55957,7 @@
 
 
 
-  &lt;h4 id=the-applet-element&gt;&lt;span class=secno&gt;10.1.2 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;applet&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
+  &lt;h4 id=the-applet-element&gt;&lt;span class=secno&gt;11.1.2 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;applet&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#the-applet-element&gt;applet&lt;/a&gt;&lt;/code&gt; element is a Java-specific variant of the
   &lt;code&gt;&lt;a href=#the-embed-element&gt;embed&lt;/a&gt;&lt;/code&gt; element. In HTML5 the &lt;code&gt;&lt;a href=#the-applet-element&gt;applet&lt;/a&gt;&lt;/code&gt; element
@@ -55963,7 +55984,7 @@
 
 
 
-  &lt;h3 id=conformance-checkers-0&gt;&lt;span class=secno&gt;10.2 &lt;/span&gt;Conformance checkers&lt;/h3&gt;
+  &lt;h3 id=conformance-checkers-0&gt;&lt;span class=secno&gt;11.2 &lt;/span&gt;Conformance checkers&lt;/h3&gt;
 
   &lt;p&gt;To ease the transition from HTML4 Transitional documents to the
   language defined in &lt;em&gt;this&lt;/em&gt; specification, conformance
@@ -56037,7 +56058,7 @@
 
    &lt;li&gt;&lt;p&gt;The presence of a &lt;code&gt;noframes&lt;/code&gt; element.&lt;/li&gt;
 
-  &lt;/ul&gt;&lt;h2 id=no&gt;&lt;span class=secno&gt;11 &lt;/span&gt;Things that you can't do with this specification because
+  &lt;/ul&gt;&lt;h2 id=no&gt;&lt;span class=secno&gt;12 &lt;/span&gt;Things that you can't do with this specification because
   they are better handled using other technologies that are further
   described herein&lt;/h2&gt;
 
@@ -56049,7 +56070,7 @@
   that can be integrated into this one. This section covers some of
   the more common requests.&lt;/p&gt;
 
-  &lt;h3 id=localization&gt;&lt;span class=secno&gt;11.1 &lt;/span&gt;Localization&lt;/h3&gt;
+  &lt;h3 id=localization&gt;&lt;span class=secno&gt;12.1 &lt;/span&gt;Localization&lt;/h3&gt;
 
   &lt;p&gt;If you wish to create localized versions of an HTML application,
   the best solution is to preprocess the files on the server, and then
@@ -56058,13 +56079,13 @@
   &lt;!-- &lt;p&gt;XXX example here&lt;/p&gt; --&gt;
 
 &lt;!--XXXSVG (remove next section)--&gt;
-  &lt;h3 id=declarative-2d-vector-graphics-and-animation&gt;&lt;span class=secno&gt;11.2 &lt;/span&gt;Declarative 2D vector graphics and animation&lt;/h3&gt;
+  &lt;h3 id=declarative-2d-vector-graphics-and-animation&gt;&lt;span class=secno&gt;12.2 &lt;/span&gt;Declarative 2D vector graphics and animation&lt;/h3&gt;
   &lt;p&gt;Embedding vector graphics into XHTML documents is the domain of
   SVG.&lt;/p&gt;
 
   &lt;!-- &lt;p&gt;XXX example here&lt;/p&gt; --&gt;
 
-  &lt;h3 id=declarative-3d-scenes&gt;&lt;span class=secno&gt;11.3 &lt;/span&gt;Declarative 3D scenes&lt;/h3&gt;
+  &lt;h3 id=declarative-3d-scenes&gt;&lt;span class=secno&gt;12.3 &lt;/span&gt;Declarative 3D scenes&lt;/h3&gt;
 
   &lt;p&gt;Embedding 3D imagery into XHTML documents is the domain of X3D,
   or technologies based on X3D that are namespace-aware.&lt;/p&gt;
@@ -56073,7 +56094,7 @@
 
 
 
-  &lt;h3 id=timers&gt;&lt;span class=secno&gt;11.4 &lt;/span&gt;Timers&lt;/h3&gt;
+  &lt;h3 id=timers&gt;&lt;span class=secno&gt;12.4 &lt;/span&gt;Timers&lt;/h3&gt;
 
   &lt;p class=XXX&gt;This section is expected to be moved to its own
   specification in due course. It needs a lot of work to actually make
@@ -56153,7 +56174,7 @@
 
 
 
-  &lt;h3 id=rendering-and-the-dom&gt;&lt;span class=secno&gt;11.5 &lt;/span&gt;Rendering and the DOM&lt;/h3&gt;
+  &lt;h3 id=rendering-and-the-dom&gt;&lt;span class=secno&gt;12.5 &lt;/span&gt;Rendering and the DOM&lt;/h3&gt;
 
   &lt;p class=XXX&gt;This section is expected to be moved to its own
   specification in due course. It needs a lot of work to actually make

Modified: source
===================================================================
--- source	2009-01-28 07:49:07 UTC (rev 2719)
+++ source	2009-01-29 05:12:36 UTC (rev 2720)
@@ -6180,14 +6180,6 @@
   &lt;code&gt;Document&lt;/code&gt; object.&lt;/p&gt; &lt;!-- XXX define
   document.onreadystatechange --&gt;
 
-  &lt;p&gt;When a &lt;code&gt;Document&lt;/code&gt; is created by an &lt;span&gt;XML
-  parser&lt;/span&gt;, the &lt;span&gt;current document readiness&lt;/span&gt; must be
-  changed to &quot;complete&quot; when the parser reaches the end of its input
-  stream.&lt;/p&gt; &lt;!-- XXX this should be in its own section, and we
-  should define 'delay the load event' for XML parsing so that we can
-  have the &quot;interactive&quot; state here too. also, XML parser will need to
-  fire the /pending state object/, and the 'load' event, and... --&gt;
-
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-document-readyState&quot;&gt;&lt;code&gt;readyState&lt;/code&gt;&lt;/dfn&gt; DOM
   attribute must, on getting, return the &lt;span&gt;current document
@@ -7853,74 +7845,21 @@
   &lt;/dl&gt;
 
 
+
   &lt;h3&gt;&lt;dfn&gt;Dynamic markup insertion&lt;/dfn&gt;&lt;/h3&gt;
 
-  &lt;p&gt;APIs for dynamically inserting markup into the document interact
-  with the parser, and thus their behavior varies depending on whether
-  they are used with &lt;span&gt;HTML documents&lt;/span&gt; (and the &lt;span&gt;HTML
-  parser&lt;/span&gt;) or XHTML in &lt;span&gt;XML documents&lt;/span&gt; (and the
-  &lt;span&gt;XML parser&lt;/span&gt;&lt;!-- XXX xref --&gt;). The following table
-  cross-references the various versions of these APIs.&lt;/p&gt;
+  &lt;p class=&quot;note&quot;&gt;APIs for dynamically inserting markup into the
+  document interact with the parser, and thus their behavior, varies
+  depending on whether they are used with &lt;span&gt;HTML documents&lt;/span&gt;
+  (and the &lt;span&gt;HTML parser&lt;/span&gt;) or XHTML in &lt;span&gt;XML
+  documents&lt;/span&gt; (and the &lt;span&gt;XML parser&lt;/span&gt;).&lt;/p&gt;
 
-  &lt;table&gt;
-   &lt;thead&gt;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;/td&gt;
-     &lt;th&gt;For documents that are &lt;span&gt;HTML documents&lt;/span&gt;&lt;/th&gt;
-     &lt;th&gt;For documents that are &lt;span&gt;XML documents&lt;/span&gt;&lt;/th&gt;
-    &lt;/tr&gt;
-   &lt;/thead&gt;
-   &lt;tbody&gt;
-    &lt;tr&gt;
-     &lt;th&gt;&lt;code&gt;document.open()&lt;/code&gt;&lt;/th&gt;
-     &lt;td colspan=2&gt;&lt;span title=&quot;dom-document-open&quot;&gt;&lt;code&gt;document.open()&lt;/code&gt;&lt;/span&gt;&lt;/td&gt;
-    &lt;/tr&gt;
-    &lt;tr&gt;
-     &lt;th&gt;&lt;dfn title=&quot;dom-document-write&quot;&gt;&lt;code&gt;document.write()&lt;/code&gt;&lt;/dfn&gt;&lt;/th&gt;
-     &lt;td&gt;&lt;span title=&quot;dom-document-write-HTML&quot;&gt;&lt;code&gt;document.write()&lt;/code&gt; in HTML&lt;/span&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;span title=&quot;dom-document-write-XML&quot;&gt;not supported&lt;/span&gt;&lt;/td&gt;
-    &lt;/tr&gt;
-    &lt;tr&gt;
-     &lt;th&gt;&lt;dfn title=&quot;dom-innerHTML&quot;&gt;&lt;code&gt;innerHTML&lt;/code&gt;&lt;/dfn&gt;&lt;/th&gt;
-     &lt;td&gt;&lt;span title=&quot;dom-innerHTML-HTML&quot;&gt;&lt;code&gt;innerHTML&lt;/code&gt; in HTML&lt;/span&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;span title=&quot;dom-innerHTML-XML&quot;&gt;&lt;code&gt;innerHTML&lt;/code&gt; in XML&lt;/span&gt;&lt;/td&gt;
-    &lt;/tr&gt;
-    &lt;tr&gt;
-     &lt;th&gt;&lt;dfn title=&quot;dom-outerHTML&quot;&gt;&lt;code&gt;outerHTML&lt;/code&gt;&lt;/dfn&gt;&lt;/th&gt;
-     &lt;td&gt;&lt;span title=&quot;dom-outerHTML-HTML&quot;&gt;&lt;code&gt;outerHTML&lt;/code&gt; in HTML&lt;/span&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;span title=&quot;dom-outerHTML-XML&quot;&gt;not supported&lt;/span&gt;&lt;/td&gt;
-    &lt;/tr&gt;
-    &lt;tr&gt;
-     &lt;th&gt;&lt;dfn title=&quot;dom-insertAdjacentHTML&quot;&gt;&lt;code&gt;insertAdjacentHTML()&lt;/code&gt;&lt;/dfn&gt;&lt;/th&gt;
-     &lt;td&gt;&lt;span title=&quot;dom-insertAdjacentHTML-HTML&quot;&gt;&lt;code&gt;insertAdjacentHTML()&lt;/code&gt; in HTML&lt;/span&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;span title=&quot;dom-insertAdjacentHTML-XML&quot;&gt;not supported&lt;/span&gt;&lt;/td&gt;
-    &lt;/tr&gt;
-   &lt;/tbody&gt;
-  &lt;/table&gt;
+  &lt;!-- XXX must make sure we spec that innerHTML et al causes mutation
+  events to fire, but document.write() doesn't. (the latter is already
+  req-stated in the parser section, btw) --&gt;
 
-  &lt;p&gt;Regardless of the parsing mode, the &lt;dfn
-  title=&quot;dom-document-writeln&quot;&gt;&lt;code&gt;document.writeln(...)&lt;/code&gt;&lt;/dfn&gt;
-  method must call the &lt;code
-  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; method with the
-  same argument(s), plus an extra argument consisting of a string
-  containing a single line feed character (U+000A).&lt;/p&gt;
 
-  &lt;p class=&quot;note&quot;&gt;The &lt;code title=&quot;dom-innerHTML&quot;&gt;innerHTML&lt;/code&gt;
-  attribute applies to both &lt;code&gt;Element&lt;/code&gt; nodes as well as
-  &lt;code&gt;Document&lt;/code&gt; nodes. The &lt;code
-  title=&quot;dom-outerHTML&quot;&gt;outerHTML&lt;/code&gt; and &lt;code
-  title=&quot;dom-insertAdjacentHTML&quot;&gt;insertAdjacentHTML()&lt;/code&gt; members,
-  on the other hand, only apply to &lt;code&gt;Element&lt;/code&gt; nodes.&lt;/p&gt;
 
-  &lt;p class=&quot;note&quot;&gt;When inserted using the &lt;code
-  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; method,
-  &lt;code&gt;script&lt;/code&gt; elements execute (typically synchronously), but
-  when inserted using &lt;code
-  title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; and &lt;code
-  title=&quot;dom-outerHTML-HTML&quot;&gt;outerHTML&lt;/code&gt; attributes, they do not
-  execute at all.&lt;/p&gt;
-
-
   &lt;h4&gt;Controlling the input stream&lt;/h4&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-document-open&quot;&gt;&lt;code&gt;open()&lt;/code&gt;&lt;/dfn&gt;
@@ -8098,16 +8037,31 @@
   &lt;span&gt;input stream&lt;/span&gt;.&lt;/p&gt;
 
 
-  &lt;h4&gt;Dynamic markup insertion in HTML&lt;/h4&gt;
 
-  &lt;p&gt;In HTML, the &lt;dfn
-  title=&quot;dom-document-write-HTML&quot;&gt;&lt;code&gt;document.write(...)&lt;/code&gt;&lt;/dfn&gt;
+
+  &lt;h4&gt;&lt;code title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt;&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-document-write&quot;&gt;&lt;code&gt;document.write(...)&lt;/code&gt;&lt;/dfn&gt;
   method must act as follows:&lt;/p&gt;
 
   &lt;ol&gt;
 
    &lt;li&gt;
 
+    &lt;p&gt;If the method was invoked on an &lt;span title=&quot;XML documents&quot;&gt;XML
+    document&lt;/span&gt;, throw an &lt;code&gt;INVALID_ACCESS_ERR&lt;/code&gt;
+    exception and abort these steps.&lt;/p&gt;
+
+    &lt;!--
+    Where would document.write() insert?
+    Consider: data:text/xml,&lt;script xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;&gt;&lt;![CDATA[ document.write('&lt;foo&gt;Test&lt;/foo&gt;'); ]]&gt;&lt;/script&gt;
+    --&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;If the &lt;span&gt;insertion point&lt;/span&gt; is undefined, the &lt;code
     title=&quot;dom-document-open&quot;&gt;open()&lt;/code&gt; method must be called
     (with no arguments) on the &lt;code title=&quot;Document&quot;&gt;document&lt;/code&gt;
@@ -8145,7 +8099,7 @@
     end tag token is emitted by the tokeniser).
 
     &lt;p class=&quot;note&quot;&gt;If the &lt;code
-    title=&quot;dom-document-write-HTML&quot;&gt;document.write()&lt;/code&gt; method was
+    title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; method was
     called from script executing inline (i.e. executing because the
     parser parsed a set of &lt;code&gt;script&lt;/code&gt; tags), then this is a
     &lt;a href=&quot;#nestedParsing&quot;&gt;reentrant invocation of the
@@ -8161,108 +8115,88 @@
 
   &lt;/ol&gt;
 
-  &lt;hr&gt;
 
-  &lt;p&gt;On getting, the &lt;dfn
-  title=&quot;dom-innerHTML-HTML&quot;&gt;&lt;code&gt;innerHTML&lt;/code&gt;&lt;/dfn&gt; DOM
-  attribute must return the result of running the &lt;span&gt;HTML fragment
-  serialization algorithm&lt;/span&gt; on the node.&lt;/p&gt;
+  &lt;h4&gt;&lt;code title=&quot;dom-document-writeln&quot;&gt;document.writeln()&lt;/code&gt;&lt;/h4&gt;
 
-  &lt;p&gt;On setting, &lt;strong&gt;if the node is a document&lt;/strong&gt;, the &lt;code
-  title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; DOM attribute must run
-  the following algorithm:&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-document-writeln&quot;&gt;&lt;code&gt;document.writeln(...)&lt;/code&gt;&lt;/dfn&gt;
+  method, when invoked, must act as if the &lt;code
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; method had been
+  invoked with the same argument(s), plus an extra argument consisting
+  of a string containing a single line feed character (U+000A).&lt;/p&gt;
 
-  &lt;ol&gt;
 
-   &lt;li&gt;
 
-    &lt;p&gt;If the document has an &lt;span&gt;active parser&lt;/span&gt;&lt;!--XXX
-    xref--&gt;, then stop that parser, and throw away any pending content
-    in the input stream. &lt;span class=&quot;XXX&quot;&gt;what about if it
-    doesn't, because it's either like a text/plain, or Atom, or PDF,
-    or XHTML, or image document, or something?&lt;/span&gt;&lt;/p&gt;&lt;!-- XXX see
-    also document.open() --&gt;
 
-   &lt;/li&gt;
+  &lt;h4&gt;&lt;code title=&quot;dom-innerHTML&quot;&gt;innerHTML&lt;/code&gt;&lt;/h4&gt;
 
-   &lt;li&gt;
+  &lt;p&gt;The &lt;dfn title=&quot;dom-innerHTML&quot;&gt;&lt;code&gt;innerHTML&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute represents the markup of the node's contents.&lt;/p&gt;
 
-    &lt;p&gt;Remove the children nodes of the &lt;code&gt;Document&lt;/code&gt; whose
-    &lt;code title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; attribute is
-    being set.&lt;/p&gt;
+  &lt;p&gt;On getting, if the node's document is an &lt;span title=&quot;HTML
+  documents&quot;&gt;HTML document&lt;/span&gt;, then the attribute must return the
+  result of running the &lt;span&gt;HTML fragment serialization
+  algorithm&lt;/span&gt; on the node; otherwise, the node's document is an
+  &lt;span title=&quot;XML documents&quot;&gt;XML document&lt;/span&gt;, and the attribute
+  must return the result of running the &lt;span&gt;XML fragment
+  serialization algorithm&lt;/span&gt; on the node instead (this might raise
+  an exception instead of returning a string).&lt;/p&gt;
 
-   &lt;/li&gt;
+  &lt;p&gt;On setting, the following steps must be run:&lt;/p&gt;
 
-   &lt;li&gt;
+  &lt;ol&gt;
 
-    &lt;p&gt;Create a new &lt;span&gt;HTML parser&lt;/span&gt;, in its initial state,
-    and associate it with the &lt;code&gt;Document&lt;/code&gt; node.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-&lt;!-- redundant, the document is forcibly already so labeled if we get here
    &lt;li&gt;
 
-    &lt;p&gt;Mark the &lt;code&gt;Document&lt;/code&gt; object as being an &lt;span
-    title=&quot;HTML documents&quot;&gt;HTML document&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;If the node's document is an &lt;span title=&quot;HTML documents&quot;&gt;HTML
+    document&lt;/span&gt;: Invoke the &lt;span&gt;HTML fragment parsing
+    algorithm&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;/li&gt;
---&gt;
+    &lt;p&gt;If the node's document is an &lt;span title=&quot;XML documents&quot;&gt;XML
+    document&lt;/span&gt;: Invoke the &lt;span&gt;XML fragment parsing
+    algorithm&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;li&gt;
+    &lt;p&gt;In either case, the algorithm must be invoked with the string
+    being assigned into the &lt;code
+    title=&quot;dom-innerHTML&quot;&gt;innerHTML&lt;/code&gt; attribute as the &lt;var
+    title=&quot;&quot;&gt;input&lt;/var&gt;. If the node is an &lt;code&gt;Element&lt;/code&gt;
+    node, then, in addition, that element must be passed as the &lt;var
+    title=&quot;&quot;&gt;context&lt;/var&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;Place into the &lt;span&gt;input stream&lt;/span&gt; for the &lt;span&gt;HTML
-    parser&lt;/span&gt; just created the string being assigned into the
-    &lt;code title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; attribute.&lt;/p&gt;
+    &lt;p&gt;If this raises an exception, then abort these steps.&lt;/p&gt;
 
-   &lt;/li&gt;
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be the nodes
+    returned.&lt;/p&gt;
 
-   &lt;li&gt;
-
-    &lt;p&gt;Start the parser and let it run until it has consumed all the
-    characters just inserted into the input stream. (The
-    &lt;code&gt;Document&lt;/code&gt; node will have been populated with elements
-    and a &lt;code title=&quot;event-load&quot;&gt;load&lt;/code&gt; event will have fired
-    on its &lt;span&gt;browsing context&lt;/span&gt;'s &lt;code&gt;Window&lt;/code&gt;
-    object.)&lt;/p&gt;
-
    &lt;/li&gt;
 
-  &lt;/ol&gt;
-
-  &lt;p&gt;Otherwise, if the node is an element, then setting the &lt;code
-  title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; DOM attribute must cause
-  the following algorithm to run instead:&lt;/p&gt;
-
-  &lt;ol&gt;
-
    &lt;li&gt;
 
-    &lt;p&gt;Invoke the &lt;span&gt;HTML fragment parsing algorithm&lt;/span&gt;, with
-    the element whose &lt;code
-    title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; attribute is being set
-    as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, and the string being
-    assigned into the &lt;code
-    title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; attribute as the &lt;var
-    title=&quot;&quot;&gt;input&lt;/var&gt;. Let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be the
-    result of this algorithm.&lt;/p&gt;
+    &lt;p&gt;If the attribute is being set on a &lt;code&gt;Document&lt;/code&gt; node,
+    and that document has an active &lt;span&gt;HTML parser&lt;/span&gt; or
+    &lt;span&gt;XML parser&lt;/span&gt;, then stop that parser.&lt;/p&gt;
 
+    &lt;p class=&quot;XXX&quot;&gt;what about if it doesn't, because it's either
+    like a text/plain, or Atom, or PDF, or XHTML, or image document,
+    or something?&lt;/p&gt;&lt;!-- XXX see also document.open() --&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Remove the children of the element whose &lt;code
-    title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; attribute is being
-    set, without firing any mutation events.&lt;/p&gt;
+    &lt;p&gt;Remove the child nodes of the node whose &lt;code
+    title=&quot;dom-innerHTML&quot;&gt;innerHTML&lt;/code&gt; attribute is being set.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be the &lt;code
-    title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of the &lt;code&gt;Element&lt;/code&gt; node
-    whose &lt;code title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt; attribute
-    is being set.&lt;/p&gt;
+    &lt;p&gt;If the attribute is being set on a &lt;code&gt;Document&lt;/code&gt;
+    node, let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be that
+    &lt;code&gt;Document&lt;/code&gt; node. Otherwise, the attribute is being
+    set on an &lt;code&gt;Element&lt;/code&gt; node; let &lt;var title=&quot;&quot;&gt;target
+    document&lt;/var&gt; be the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of
+    that &lt;code&gt;Element&lt;/code&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -8277,31 +8211,39 @@
    &lt;li&gt;
 
     &lt;p&gt;Append all the &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; nodes to the
-    node whose &lt;code title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt;
-    attribute is being set, preserving their order, without firing any
-    mutation events.&lt;/p&gt;
+    node whose &lt;code title=&quot;dom-innerHTML&quot;&gt;innerHTML&lt;/code&gt; attribute
+    is being set, preserving their order, without firing any mutation
+    events.&lt;/p&gt;
 
    &lt;/li&gt;
 
   &lt;/ol&gt;
 
-  &lt;hr&gt;
 
-  &lt;p&gt;On getting, the &lt;dfn
-  title=&quot;dom-outerHTML-HTML&quot;&gt;&lt;code&gt;outerHTML&lt;/code&gt;&lt;/dfn&gt; DOM
-  attribute must return the result of running the &lt;span&gt;HTML fragment
-  serialization algorithm&lt;/span&gt; on a fictional node whose only child
-  is the node on which the attribute was invoked.&lt;/p&gt;
 
-  &lt;p&gt;On setting, the &lt;code title=&quot;dom-outerHTML-HTML&quot;&gt;outerHTML&lt;/code&gt;
-  DOM attribute must cause the following algorithm to run:&lt;/p&gt;
+  &lt;h4&gt;&lt;code title=&quot;dom-outerHTML&quot;&gt;outerHTML&lt;/code&gt;&lt;/h4&gt;
 
+  &lt;p&gt;The &lt;dfn title=&quot;dom-outerHTML&quot;&gt;&lt;code&gt;outerHTML&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute represents the markup of the element and its contents.&lt;/p&gt;
+
+  &lt;p&gt;On getting, if the node's document is an &lt;span title=&quot;HTML
+  documents&quot;&gt;HTML document&lt;/span&gt;, then the attribute must return the
+  result of running the &lt;span&gt;HTML fragment serialization
+  algorithm&lt;/span&gt; on a fictional node whose only child is the node on
+  which the attribute was invoked; otherwise, the node's document is
+  an &lt;span title=&quot;XML documents&quot;&gt;XML document&lt;/span&gt;, and the
+  attribute must return the result of running the &lt;span&gt;XML fragment
+  serialization algorithm&lt;/span&gt; on that fictional node instead (this
+  might raise an exception instead of returning a string).&lt;/p&gt;
+
+  &lt;p&gt;On setting, the following steps must be run:&lt;/p&gt;
+
   &lt;ol&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the element whose &lt;code
-    title=&quot;dom-innerHTML-HTML&quot;&gt;outerHTML&lt;/code&gt; attribute is being
+    title=&quot;dom-outerHTML&quot;&gt;outerHTML&lt;/code&gt; attribute is being
     set.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -8334,27 +8276,32 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Invoke the &lt;span&gt;HTML fragment parsing algorithm&lt;/span&gt;, with
-    &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt;
-    element and the string being assigned into the &lt;code
-    title=&quot;dom-outerHTML-HTML&quot;&gt;outerHTML&lt;/code&gt; attribute as the &lt;var
-    title=&quot;&quot;&gt;input&lt;/var&gt;. Let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be the
-    result of this algorithm.&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s document is an &lt;span
+    title=&quot;HTML documents&quot;&gt;HTML document&lt;/span&gt;: Invoke the &lt;span&gt;HTML
+    fragment parsing algorithm&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;/li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s document is an &lt;span title=&quot;XML
+    documents&quot;&gt;XML document&lt;/span&gt;: Invoke the &lt;span&gt;XML fragment
+    parsing algorithm&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;li&gt;
+    &lt;p&gt;In either case, the algorithm must be invoked with the string
+    being assigned into the &lt;code
+    title=&quot;dom-outerHTML&quot;&gt;outerHTML&lt;/code&gt; attribute as the &lt;var
+    title=&quot;&quot;&gt;input&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;parent&lt;/var&gt; as the &lt;var
+    title=&quot;&quot;&gt;context&lt;/var&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be the &lt;code
-    title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;If this raises an exception, then abort these steps.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be &lt;var
+    title=&quot;&quot;&gt;target&lt;/var&gt;s returned.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Set the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of all the nodes in
-    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;target
-    document&lt;/var&gt;.&lt;/p&gt;
+    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s
+    document.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -8369,12 +8316,14 @@
 
   &lt;/ol&gt;
 
-  &lt;hr&gt;
 
+
+  &lt;h4&gt;&lt;code title=&quot;dom-insertAdjacentHTML&quot;&gt;insertAdjacentHTML()&lt;/code&gt;&lt;/h4&gt;
+
   &lt;p&gt;The &lt;dfn
-  title=&quot;dom-insertAdjacentHTML-HTML&quot;&gt;&lt;code&gt;insertAdjacentHTML(&lt;var
+  title=&quot;dom-insertAdjacentHTML&quot;&gt;&lt;code&gt;insertAdjacentHTML(&lt;var
   title=&quot;&quot;&gt;position&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
-  method, when invoked, must run the following steps:&lt;/p&gt;
+  method, when invoked, must run the following algorithm:&lt;/p&gt;
 
   &lt;ol&gt;
 
@@ -8444,26 +8393,31 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Invoke the &lt;span&gt;HTML fragment parsing algorithm&lt;/span&gt;, with
-    the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element being that selected by the
-    previous step, and &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; being the method's
-    &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; argument. Let &lt;var title=&quot;&quot;&gt;new
-    children&lt;/var&gt; be the result of this algorithm.&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s document is an &lt;span
+    title=&quot;HTML documents&quot;&gt;HTML document&lt;/span&gt;: Invoke the &lt;span&gt;HTML
+    fragment parsing algorithm&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;/li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s document is an &lt;span title=&quot;XML
+    documents&quot;&gt;XML document&lt;/span&gt;: Invoke the &lt;span&gt;XML fragment
+    parsing algorithm&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;li&gt;
+    &lt;p&gt;In either case, the algorithm must be invoked with &lt;var
+    title=&quot;&quot;&gt;text&lt;/var&gt; as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, and the
+    element selected in by the previous step as the &lt;var
+    title=&quot;&quot;&gt;context&lt;/var&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be the &lt;code
-    title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;If this raises an exception, then abort these steps.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be &lt;var
+    title=&quot;&quot;&gt;target&lt;/var&gt;s returned.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Set the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of all the nodes in
-    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;target
-    document&lt;/var&gt;.&lt;/p&gt;
+    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s
+    document.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -8527,221 +8481,8 @@
   &lt;/ol&gt;
 
 
-  &lt;!-- XXX must make sure we spec that innerHTML et al causes mutation
-  events to fire, but document.write() doesn't. (the latter is already
-  req-stated in the parser section, btw) --&gt;
 
-  &lt;!-- <A HREF="http://msdn.microsoft.com/workshop/author/dhtml/reference/properties/innerhtml.asp">http://msdn.microsoft.com/workshop/author/dhtml/reference/properties/innerhtml.asp</A> --&gt;
-  &lt;!-- <A HREF="http://lxr.mozilla.org/seamonkey/source/content/html/content/src/nsGenericHTMLElement.cpp#879">http://lxr.mozilla.org/seamonkey/source/content/html/content/src/nsGenericHTMLElement.cpp#879</A>
-       note script execution disabled
-       <A HREF="http://lxr.mozilla.org/seamonkey/source/content/base/src/nsContentUtils.cpp#3308">http://lxr.mozilla.org/seamonkey/source/content/base/src/nsContentUtils.cpp#3308</A>
-       <A HREF="http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLElement.cpp#L295">http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLElement.cpp#L295</A>
-       <A HREF="http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLElement.cpp#L242">http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLElement.cpp#L242</A>
-       <A HREF="http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLTokenizer.cpp#L1742">http://trac.webkit.org/projects/webkit/browser/trunk/WebCore/html/HTMLTokenizer.cpp#L1742</A>
-   --&gt;
 
-
-  &lt;h4&gt;Dynamic markup insertion in XML&lt;/h4&gt;
-
-  &lt;p&gt;In an XML context, the &lt;dfn 
-  title=&quot;dom-innerHTML-XML&quot;&gt;&lt;code&gt;innerHTML&lt;/code&gt;&lt;/dfn&gt; DOM attribute
-  on &lt;code&gt;HTMLElement&lt;/code&gt;s must return a string in the form of an
-  &lt;a href=&quot;<A HREF="http://www.w3.org/TR/xml/#wf-entities">http://www.w3.org/TR/xml/#wf-entities</A>&quot;&gt;internal general
-  parsed entity&lt;/a&gt;, and on &lt;code&gt;HTMLDocument&lt;/code&gt;s must return a
-  string in the form of a &lt;a
-  href=&quot;<A HREF="http://www.w3.org/TR/xml/#sec-well-formed">http://www.w3.org/TR/xml/#sec-well-formed</A>&quot;&gt;document
-  entity&lt;/a&gt;. The string returned must be XML namespace-well-formed
-  and must be an isomorphic serialization of all of that node's child
-  nodes, in document order. User agents may adjust prefixes and
-  namespace declarations in the serialization (and indeed might be
-  forced to do so in some cases to obtain namespace-well-formed
-  XML). For the &lt;code title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt;
-  attribute on &lt;code&gt;HTMLElement&lt;/code&gt; objects, if any of the
-  elements in the serialization are in no namespace, the default
-  namespace in scope for those elements must be explicitly declared as
-  the empty string.&lt;!-- because otherwise round-tripping might break
-  since it'll pick up the surrounding default ns when setting --&gt;
-  (This doesn't apply to the &lt;code
-  title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt; attribute on
-  &lt;code&gt;HTMLDocument&lt;/code&gt; objects.) &lt;a href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt; &lt;a
-  href=&quot;#refsXMLNS&quot;&gt;[XMLNS]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;If any of the following cases are found in the DOM being
-  serialized, the user agent must raise an
-  &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception:&lt;/p&gt;
-
-  &lt;ul&gt;
-
-   &lt;li&gt;A &lt;code&gt;Document&lt;/code&gt; node with no child element nodes.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;DocumentType&lt;/code&gt; node that has an external subset
-   public identifier that contains characters that are not matched by
-   the XML &lt;code title=&quot;&quot;&gt;PubidChar&lt;/code&gt; production. &lt;a
-   href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;DocumentType&lt;/code&gt; node that has an external subset
-   system identifier that contains both a U+0022 QUOTATION MARK ('&quot;')
-   and a U+0027 APOSTROPHE (&quot;'&quot;).&lt;/li&gt;
-
-   &lt;li&gt;A node with a prefix or local name containing a U+003A COLON
-   (&quot;:&quot;).&lt;/li&gt;
-
-   &lt;li&gt;An &lt;code&gt;Attr&lt;/code&gt; node, &lt;code&gt;Text&lt;/code&gt; node,
-   &lt;code&gt;CDATASection&lt;/code&gt; node, &lt;code&gt;Comment&lt;/code&gt; node, or
-   &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose data contains
-   characters that are not matched by the XML &lt;code
-   title=&quot;&quot;&gt;Char&lt;/code&gt; production. &lt;a href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;CDATASection&lt;/code&gt; node whose data contains the string
-   &quot;&lt;code title=&quot;&quot;&gt;]]&gt;&lt;/code&gt;&quot;.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;Comment&lt;/code&gt; node whose data contains two adjacent
-   U+002D HYPHEN-MINUS (-) characters or ends with such a
-   character.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose target name is
-   an &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the string &quot;&lt;code
-   title=&quot;&quot;&gt;xml&lt;/code&gt;&quot;.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose target name
-   contains a U+003A COLON (&quot;:&quot;).&lt;/li&gt;
-
-   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose data contains
-   the string &quot;&lt;code title=&quot;&quot;&gt;?&gt;&lt;/code&gt;&quot;.&lt;/li&gt;
-
-  &lt;/ul&gt;
-
-  &lt;p class=&quot;note&quot;&gt;These are the only ways to make a DOM
-  unserializable. The DOM enforces all the other XML constraints; for
-  example, trying to set an attribute with a name that contains an
-  equals sign (=) will raised an &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt;
-  exception.&lt;/p&gt;
-
-  &lt;p&gt;On setting, in an XML context, the &lt;code
-  title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt; DOM attribute on
-  &lt;code&gt;HTMLElement&lt;/code&gt;s and &lt;code&gt;HTMLDocument&lt;/code&gt;s must run
-  the following algorithm:&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;The user agent must create a new &lt;span&gt;XML parser&lt;/span&gt;&lt;!-- XXX xref --&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the &lt;code title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt;
-    attribute is being set on an element, the user agent must
-    &lt;span&gt;feed the parser&lt;/span&gt; just created the string corresponding
-    to the start tag of that element, declaring all the namespace
-    prefixes that are in scope on that element in the DOM, as well as
-    declaring the default namespace (if any) that is in scope on that
-    element in the DOM.&lt;/p&gt;
-
-    &lt;p&gt;A namespace prefix is in scope if the DOM Core &lt;code
-    title=&quot;&quot;&gt;lookupNamespaceURI()&lt;/code&gt; method on the element would
-    return a non-null value for that prefix.&lt;/p&gt;
-
-    &lt;p&gt;The default namespace is the namespace for which the DOM Core
-    &lt;code title=&quot;&quot;&gt;isDefaultNamespace()&lt;/code&gt; method on the element
-    would return true.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;The user agent must &lt;span&gt;feed the parser&lt;/span&gt; just created
-    the string being assigned into the &lt;code
-    title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt; attribute.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the &lt;code title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt;
-    attribute is being set on an element, the user agent must
-    &lt;span&gt;feed the parser&lt;/span&gt; the string corresponding to the end
-    tag of that element.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the parser found an XML well-formedness or XML namespace
-    well-formedness error, the attribute's setter must raise a
-    &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception and abort these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;The user agent must remove the children nodes of the node whose
-    &lt;code title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt; attribute is
-    being set.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the attribute is being set on a &lt;code&gt;Document&lt;/code&gt; node,
-    let &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; be the children of the
-    document, preserving their order. Otherwise, the attribute is
-    being set on an &lt;code&gt;Element&lt;/code&gt; node; let &lt;var title=&quot;&quot;&gt;new
-    children&lt;/var&gt; be the children of the document's root element,
-    preserving their order.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the attribute is being set on a &lt;code&gt;Document&lt;/code&gt; node,
-    let &lt;var title=&quot;&quot;&gt;target document&lt;/var&gt; be that
-    &lt;code&gt;Document&lt;/code&gt; node. Otherwise, the attribute is being set
-    on an &lt;code&gt;Element&lt;/code&gt; node; let &lt;var title=&quot;&quot;&gt;target
-    document&lt;/var&gt; be the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of that
-    &lt;code&gt;Element&lt;/code&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Set the &lt;code title=&quot;&quot;&gt;ownerDocument&lt;/code&gt; of all the nodes in
-    &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;target
-    document&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Append all the &lt;var title=&quot;&quot;&gt;new children&lt;/var&gt; nodes to the
-    node whose &lt;code title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt;
-    attribute is being set, preserving their order.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;In an XML context, the &lt;dfn
-  title=&quot;dom-document-write-XML&quot;&gt;&lt;code&gt;document.write()&lt;/code&gt;&lt;/dfn&gt;
-  and &lt;dfn
-  title=&quot;dom-insertAdjacentHTML-XML&quot;&gt;&lt;code&gt;insertAdjacentHTML()&lt;/code&gt;&lt;/dfn&gt;
-  methods, and the &lt;dfn
-  title=&quot;dom-outerHTML-XML&quot;&gt;&lt;code&gt;outerHTML&lt;/code&gt;&lt;/dfn&gt; attribute on
-  both getting and setting, must raise an
-  &lt;code&gt;INVALID_ACCESS_ERR&lt;/code&gt; exception.&lt;/p&gt;
-
-&lt;!--
-Where would document.write() insert?
-Consider: data:text/xml,&lt;script xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;&gt;&lt;![CDATA[ document.write('&lt;foo&gt;Test&lt;/foo&gt;'); ]]&gt;&lt;/script&gt;
---&gt;
-
-
-
-
   &lt;h2 id=&quot;semantics&quot;&gt;The elements of HTML&lt;/h2&gt;
 
   &lt;h3&gt;The root element&lt;/h3&gt;
@@ -10039,7 +9780,7 @@
   node&quot;&gt;text nodes&lt;/span&gt; that are direct children of the
   &lt;code&gt;style&lt;/code&gt; element (not any other nodes such as comments or
   elements), in &lt;span&gt;tree order&lt;/span&gt;, to the style system. For
-  XML-based styling languages, user agents must pass all the children
+  XML-based styling languages, user agents must pass all the child
   nodes of the &lt;code&gt;style&lt;/code&gt; element to the style system.&lt;/p&gt;
 
   &lt;p&gt;All &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt; found by the styling language's
@@ -10302,21 +10043,12 @@
   second is a flag indicating whether the element was
   &lt;dfn&gt;&quot;parser-inserted&quot;&lt;/dfn&gt;. This flag is set by the &lt;span&gt;HTML
   parser&lt;/span&gt; and is used to handle &lt;code
-  title=&quot;dom-document-write-HTML&quot;&gt;document.write()&lt;/code&gt; calls. The
-  third and fourth pieces of metadata are &lt;dfn&gt;&lt;var&gt;the script block's
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; calls. The third
+  and fourth pieces of metadata are &lt;dfn&gt;&lt;var&gt;the script block's
   type&lt;/var&gt;&lt;/dfn&gt; and &lt;dfn&gt;&lt;var&gt;the script block's character
   encoding&lt;/var&gt;&lt;/dfn&gt;. They are determined when the script is run,
   based on the attributes on the element at that time.&lt;/p&gt;
 
-  &lt;p&gt;When an &lt;span&gt;XML parser&lt;/span&gt;&lt;!-- XXX xref --&gt; creates a
-  &lt;code&gt;script&lt;/code&gt; element, it must be marked as being
-  &lt;span&gt;&quot;parser-inserted&quot;&lt;/span&gt;. When the element's end tag is
-  parsed, the user agent must &lt;span title=&quot;running a
-  script&quot;&gt;run&lt;/span&gt; the &lt;code&gt;script&lt;/code&gt; element.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;Equivalent requirements exist for the &lt;span&gt;HTML
-  parser&lt;/span&gt;, but they are detailed in that section instead.&lt;/p&gt;
-
   &lt;p&gt;When a &lt;code&gt;script&lt;/code&gt; element that is marked as neither
   having &lt;span&gt;&quot;already executed&quot;&lt;/span&gt; nor being
   &lt;span&gt;&quot;parser-inserted&quot;&lt;/span&gt; is &lt;span title=&quot;insert an element
@@ -10395,16 +10127,10 @@
 
     &lt;p&gt;If &lt;span title=&quot;concept-n-noscript&quot;&gt;scripting is
     disabled&lt;/span&gt; for the &lt;code&gt;script&lt;/code&gt; element, or if the
-    &lt;code&gt;script&lt;/code&gt; element was created by an &lt;span&gt;XML
-    parser&lt;/span&gt;&lt;!-- XXX xref --&gt; that itself was created as part of
-    the processing of the &lt;code
-    title=&quot;dom-innerHTML-XML&quot;&gt;innerHTML&lt;/code&gt; attribute's setter&lt;!--
-    no need to worry about the HTML case, as the HTML parser handles
-    that for us --&gt;, or if the user agent does not &lt;span&gt;support the
-    scripting language&lt;/span&gt; given by &lt;var&gt;the script block's
-    type&lt;/var&gt; for this &lt;code&gt;script&lt;/code&gt; element, then the user
-    agent must abort these steps at this point. The script is not
-    executed.&lt;/p&gt;
+    user agent does not &lt;span&gt;support the scripting language&lt;/span&gt;
+    given by &lt;var&gt;the script block's type&lt;/var&gt; for this
+    &lt;code&gt;script&lt;/code&gt; element, then the user agent must abort these
+    steps at this point. The script is not executed.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -10786,8 +10512,17 @@
 
   &lt;/div&gt;
 
+  &lt;p class=&quot;note&quot;&gt;When inserted using the &lt;code
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; method,
+  &lt;code&gt;script&lt;/code&gt; elements execute (typically synchronously), but
+  when inserted using &lt;code
+  title=&quot;dom-innerHTML&quot;&gt;innerHTML&lt;/code&gt; and &lt;code
+  title=&quot;dom-outerHTML&quot;&gt;outerHTML&lt;/code&gt; attributes, they do not
+  execute at all.&lt;/p&gt;
 
 
+
+
   &lt;h5 id=&quot;scriptingLanguages&quot;&gt;Scripting languages&lt;/h5&gt;
 
   &lt;p&gt;A user agent is said to &lt;dfn&gt;support the scripting language&lt;/dfn&gt;
@@ -10971,7 +10706,7 @@
        &lt;span&gt;text node&lt;/span&gt; children of the &lt;code&gt;noscript&lt;/code&gt;
        element.&lt;/li&gt;
 
-       &lt;li&gt;Set the &lt;code title=&quot;dom-innerHTML-HTML&quot;&gt;innerHTML&lt;/code&gt;
+       &lt;li&gt;Set the &lt;code title=&quot;dom-innerHTML&quot;&gt;innerHTML&lt;/code&gt;
        attribute of the &lt;var title=&quot;&quot;&gt;parent element&lt;/var&gt; to the value
        of &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;. (This, as a side-effect, causes the
        &lt;code&gt;noscript&lt;/code&gt; element to be removed from the
@@ -50335,7 +50070,7 @@
     &lt;ol&gt;
      &lt;li&gt;&lt;p&gt;If the document is an &lt;span&gt;XML document&lt;/span&gt;, then
      throw an &lt;code&gt;INVALID_ACCESS_ERR&lt;/code&gt; exception and abort
-     these steps.&lt;/p&gt;&lt;/li&gt;
+     these steps.&lt;/p&gt;&lt;/li&gt;&lt;!-- XXX support XML? --&gt;
      &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; argument wasn't
      specified, abort these steps without doing anything.&lt;/p&gt;&lt;/li&gt;
      &lt;li&gt;&lt;p&gt;If there is a selection, act as if the user had requested
@@ -52932,11 +52667,12 @@
 
 
 
-  &lt;h2 id=&quot;syntax&quot;&gt;The HTML syntax&lt;/h2&gt;
+  &lt;h2 id=&quot;syntax&quot;&gt;&lt;dfn&gt;The HTML syntax&lt;/dfn&gt;&lt;/h2&gt;
 
   &lt;p class=&quot;note&quot;&gt;This section only describes the rules for &lt;code
   title=&quot;&quot;&gt;text/html&lt;/code&gt; resources. Rules for XML resources are
-  defined by the XML specifications.&lt;/p&gt;
+  discussed in the section below entitled &quot;&lt;span&gt;The XHTML
+  syntax&lt;/span&gt;&quot;.&lt;/p&gt;
 
   &lt;h3&gt;Writing HTML documents&lt;/h3&gt;
 
@@ -53767,17 +53503,13 @@
   and conformance checkers.&lt;/em&gt;&lt;/p&gt;
  
   &lt;p&gt;The rules for parsing &lt;span&gt;XML documents&lt;/span&gt; (and thus
-  &lt;span&gt;XHTML&lt;/span&gt; documents) into DOM trees are covered by the XML
-  and Namespaces in XML specifications, and are out of scope of this
-  specification. &lt;a href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt; &lt;a
-  href=&quot;#refsXMLNS&quot;&gt;[XMLNS]&lt;/a&gt; &lt;!-- XXX refs --&gt;&lt;/p&gt;
+  &lt;span&gt;XHTML&lt;/span&gt; documents) into DOM trees are covered by the next
+  section, entitled &quot;&lt;span&gt;The XHTML syntax&lt;/span&gt;&quot;.&lt;/p&gt;
 
   &lt;p&gt;For &lt;span&gt;HTML documents&lt;/span&gt;, user agents must use the parsing
   rules described in this section to generate the DOM trees. Together,
   these rules define what is referred to as the &lt;dfn&gt;HTML
-  parser&lt;/dfn&gt;.&lt;/p&gt;&lt;!-- XXX should probably remove that &quot;must&quot; since
-  it'll be redundant with something in the navigating processing model
-  eventually --&gt;
+  parser&lt;/dfn&gt;.&lt;/p&gt;
 
   &lt;div class=&quot;note&quot;&gt;
 
@@ -53841,7 +53573,7 @@
   &lt;p&gt;In the common case, the data handled by the tokenization stage
   comes from the network, but &lt;span title=&quot;dynamic markup
   insertion&quot;&gt;it can also come from script&lt;/span&gt;, e.g. using the &lt;code
-  title=&quot;dom-document-write-HTML&quot;&gt;document.write()&lt;/code&gt; API.&lt;/p&gt;
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; API.&lt;/p&gt;
 
   &lt;p&gt;&lt;img src=&quot;images/parsing-model-overview.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
 
@@ -54494,7 +54226,7 @@
   &lt;p&gt;The &lt;dfn&gt;insertion point&lt;/dfn&gt; is the position (just before a
   character or just before the end of the input stream) where content
   inserted using &lt;code
-  title=&quot;dom-document-write-HTML&quot;&gt;document.write()&lt;/code&gt; is actually
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; is actually
   inserted. The insertion point is relative to the position of the
   character immediately after it, it is not an absolute offset into
   the input stream. Initially, the insertion point is
@@ -56576,7 +56308,7 @@
   for changes caused by the UA parsing the document. (Conceptually,
   the parser is not mutating the DOM, it is constructing it.) This
   includes the parsing of any content inserted using &lt;code
-  title=&quot;dom-document-write-HTML&quot;&gt;document.write()&lt;/code&gt; and &lt;code
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; and &lt;code
   title=&quot;dom-document-writeln&quot;&gt;document.writeln()&lt;/code&gt; calls. &lt;a
   href=&quot;#refsDOM3EVENTS&quot;&gt;[DOM3EVENTS]&lt;/a&gt;&lt;/p&gt;
 
@@ -57306,11 +57038,12 @@
 
       &lt;p&gt;Mark the element as being &lt;span&gt;&quot;parser-inserted&quot;&lt;/span&gt;.&lt;/p&gt;
 
-      &lt;p class=&quot;note&quot;&gt;This ensures that, if the script is external, any
-      &lt;code title=&quot;dom-document-write-HTML&quot;&gt;document.write()&lt;/code&gt;
+      &lt;p class=&quot;note&quot;&gt;This ensures that, if the script is external,
+      any &lt;code title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt;
       calls in the script will execute in-line, instead of blowing the
       document away, as would happen in most other cases. It also
-      prevents the script from executing until the end tag is seen.&lt;/p&gt;
+      prevents the script from executing until the end tag is
+      seen.&lt;/p&gt;
 
      &lt;/li&gt;
 
@@ -58872,9 +58605,9 @@
 
     &lt;p&gt;&lt;span title=&quot;running a script&quot;&gt;Run&lt;/span&gt; the &lt;var
     title=&quot;&quot;&gt;script&lt;/var&gt;. This might cause some script to execute,
-    which might cause &lt;span title=&quot;dom-document-write-HTML&quot;&gt;new
-    characters to be inserted into the tokeniser&lt;/span&gt;, and might
-    cause the tokeniser to output more tokens, resulting in a &lt;a
+    which might cause &lt;span title=&quot;dom-document-write&quot;&gt;new characters
+    to be inserted into the tokeniser&lt;/span&gt;, and might cause the
+    tokeniser to output more tokens, resulting in a &lt;a
     href=&quot;#nestedParsing&quot;&gt;reentrant invocation of the parser&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Decrement the parser's &lt;span&gt;script nesting level&lt;/span&gt; by
@@ -58895,7 +58628,7 @@
      &lt;dt&gt;If the tree construction stage is &lt;a
      href=&quot;#nestedParsing&quot;&gt;being called reentrantly&lt;/a&gt;, say from a
      call to &lt;code
-     title=&quot;dom-document-write-HTML&quot;&gt;document.write()&lt;/code&gt;:&lt;/dt&gt;
+     title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt;:&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;Set the &lt;span&gt;parser pause flag&lt;/span&gt; to true, and abort
      the processing of any nested invocations of the tokeniser,
@@ -60757,17 +60490,18 @@
   &lt;h3&gt;Parsing HTML fragments&lt;/h3&gt;
 
   &lt;p&gt;The following steps form the &lt;dfn&gt;HTML fragment parsing
-  algorithm&lt;/dfn&gt;. The algorithm takes as input a DOM
-  &lt;code&gt;Element&lt;/code&gt;, referred to as the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt;
-  element, which gives the context for the parser, as well as &lt;var
-  title=&quot;&quot;&gt;input&lt;/var&gt;, a string to parse, and returns a list of zero
-  or more nodes.&lt;/p&gt;
+  algorithm&lt;/dfn&gt;. The algorithm optionally takes as input an
+  &lt;code&gt;Element&lt;/code&gt; node, referred to as the &lt;var
+  title=&quot;&quot;&gt;context&lt;/var&gt; element, which gives the context for the
+  parser, as well as &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, a string to parse, and
+  returns a list of zero or more nodes.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;Parts marked &lt;dfn&gt;fragment case&lt;/dfn&gt; in algorithms
   in the parser section are parts that only occur if the parser was
-  created for the purposes of this algorithm. The algorithms have been
-  annotated with such markings for informational purposes only; such
-  markings have no normative weight. If it is possible for a condition
+  created for the purposes of this algorithm (and with a &lt;var
+  title=&quot;&quot;&gt;context&lt;/var&gt; element). The algorithms have been annotated
+  with such markings for informational purposes only; such markings
+  have no normative weight. If it is possible for a condition
   described as a &lt;span&gt;fragment case&lt;/span&gt; to occur even when the
   parser wasn't created for the purposes of handling this algorithm,
   then that is an error in the specification.&lt;/p&gt;
@@ -60790,90 +60524,101 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Set the &lt;span&gt;HTML parser&lt;/span&gt;'s &lt;span&gt;tokenization&lt;/span&gt;
-    stage's &lt;span&gt;content model flag&lt;/span&gt; according to the &lt;var
-    title=&quot;&quot;&gt;context&lt;/var&gt; element, as follows:&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, run these
+    substeps:&lt;/p&gt;
 
-    &lt;dl class=&quot;switch&quot;&gt;
+    &lt;ol&gt;
 
-     &lt;dt&gt;If it is a &lt;code&gt;title&lt;/code&gt; or &lt;code&gt;textarea&lt;/code&gt;
-     element&lt;/dt&gt;
+     &lt;li&gt;
 
-     &lt;dd&gt;Set the &lt;span&gt;content model flag&lt;/span&gt; to
-     the RCDATA state.&lt;/dd&gt;
+      &lt;p&gt;Set the &lt;span&gt;HTML parser&lt;/span&gt;'s &lt;span&gt;tokenization&lt;/span&gt;
+      stage's &lt;span&gt;content model flag&lt;/span&gt; according to the &lt;var
+      title=&quot;&quot;&gt;context&lt;/var&gt; element, as follows:&lt;/p&gt;
 
+      &lt;dl class=&quot;switch&quot;&gt;
 
-     &lt;dt&gt;If it is a &lt;code&gt;style&lt;/code&gt;, &lt;code&gt;script&lt;/code&gt;,
-     &lt;code&gt;xmp&lt;/code&gt;, &lt;code&gt;iframe&lt;/code&gt;, &lt;code&gt;noembed&lt;/code&gt;, or
-     &lt;code&gt;noframes&lt;/code&gt; element&lt;/dt&gt;
+       &lt;dt&gt;If it is a &lt;code&gt;title&lt;/code&gt; or &lt;code&gt;textarea&lt;/code&gt;
+       element&lt;/dt&gt;
 
-     &lt;dd&gt;Set the &lt;span&gt;content model flag&lt;/span&gt; to
-     the CDATA state.&lt;/dd&gt;
+       &lt;dd&gt;Set the &lt;span&gt;content model flag&lt;/span&gt; to
+       the RCDATA state.&lt;/dd&gt;
 
 
-     &lt;dt&gt;If it is a &lt;code&gt;noscript&lt;/code&gt; element&lt;/dt&gt;
+       &lt;dt&gt;If it is a &lt;code&gt;style&lt;/code&gt;, &lt;code&gt;script&lt;/code&gt;,
+       &lt;code&gt;xmp&lt;/code&gt;, &lt;code&gt;iframe&lt;/code&gt;, &lt;code&gt;noembed&lt;/code&gt;, or
+       &lt;code&gt;noframes&lt;/code&gt; element&lt;/dt&gt;
 
-     &lt;dd&gt;If the &lt;span&gt;scripting flag&lt;/span&gt; is enabled, set the
-     &lt;span&gt;content model flag&lt;/span&gt; to the CDATA
-     state. Otherwise, set the &lt;span&gt;content model flag&lt;/span&gt; to the
-     PCDATA state.&lt;/dd&gt;
+       &lt;dd&gt;Set the &lt;span&gt;content model flag&lt;/span&gt; to
+       the CDATA state.&lt;/dd&gt;
 
 
-     &lt;dt&gt;If it is a &lt;code&gt;plaintext&lt;/code&gt; element&lt;/dt&gt;
+       &lt;dt&gt;If it is a &lt;code&gt;noscript&lt;/code&gt; element&lt;/dt&gt;
 
-     &lt;dd&gt;Set the &lt;span&gt;content model flag&lt;/span&gt; to
-     PLAINTEXT.&lt;/dd&gt;
+       &lt;dd&gt;If the &lt;span&gt;scripting flag&lt;/span&gt; is enabled, set the
+       &lt;span&gt;content model flag&lt;/span&gt; to the CDATA
+       state. Otherwise, set the &lt;span&gt;content model flag&lt;/span&gt; to the
+       PCDATA state.&lt;/dd&gt;
 
 
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
+       &lt;dt&gt;If it is a &lt;code&gt;plaintext&lt;/code&gt; element&lt;/dt&gt;
 
-     &lt;dd&gt;Set the &lt;span&gt;content model flag&lt;/span&gt; to the PCDATA
-     state.&lt;/dd&gt;
+       &lt;dd&gt;Set the &lt;span&gt;content model flag&lt;/span&gt; to
+       PLAINTEXT.&lt;/dd&gt;
 
-    &lt;/dl&gt;
 
-   &lt;/li&gt;
+       &lt;dt&gt;Otherwise&lt;/dt&gt;
 
-   &lt;li&gt;
+       &lt;dd&gt;Leave the &lt;span&gt;content model flag&lt;/span&gt; in the PCDATA
+       state.&lt;/dd&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be a new &lt;code&gt;html&lt;/code&gt; element
-    with no attributes.&lt;/p&gt;
+      &lt;/dl&gt;
 
-   &lt;/li&gt;
+     &lt;/li&gt;
 
-   &lt;li&gt;
+     &lt;li&gt;
 
-    &lt;p&gt;Append the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; to the
-    &lt;code&gt;Document&lt;/code&gt; node created above.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be a new &lt;code&gt;html&lt;/code&gt; element
+      with no attributes.&lt;/p&gt;
 
-   &lt;/li&gt;
+     &lt;/li&gt;
 
-   &lt;li&gt;
+     &lt;li&gt;
 
-    &lt;p&gt;Set up the parser's &lt;span&gt;stack of open elements&lt;/span&gt; so that
-    it contains just the single element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Append the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; to the
+      &lt;code&gt;Document&lt;/code&gt; node created above.&lt;/p&gt;
 
-   &lt;/li&gt;
+     &lt;/li&gt;
 
-   &lt;li&gt;
+     &lt;li&gt;
 
-    &lt;p&gt;&lt;span title=&quot;reset the insertion mode appropriately&quot;&gt;Reset the
-    parser's insertion mode appropriately&lt;/span&gt;.&lt;/p&gt;
+      &lt;p&gt;Set up the parser's &lt;span&gt;stack of open elements&lt;/span&gt; so that
+      it contains just the single element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The parser will reference the &lt;var
-    title=&quot;&quot;&gt;context&lt;/var&gt; element as part of that algorithm.&lt;/p&gt;
+     &lt;/li&gt;
 
-   &lt;/li&gt;
+     &lt;li&gt;
 
-   &lt;li&gt;
+      &lt;p&gt;&lt;span title=&quot;reset the insertion mode appropriately&quot;&gt;Reset the
+      parser's insertion mode appropriately&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Set the parser's &lt;span&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/span&gt;
-    to the nearest node to the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element
-    that is a &lt;code&gt;form&lt;/code&gt; element (going straight up the
-    ancestor chain, and including the element itself, if it is a
-    &lt;code&gt;form&lt;/code&gt; element), or, if there is no such
-    &lt;code&gt;form&lt;/code&gt; element, to null.&lt;/p&gt;
+      &lt;p class=&quot;note&quot;&gt;The parser will reference the &lt;var
+      title=&quot;&quot;&gt;context&lt;/var&gt; element as part of that algorithm.&lt;/p&gt;
 
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Set the parser's &lt;span&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/span&gt;
+      to the nearest node to the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element
+      that is a &lt;code&gt;form&lt;/code&gt; element (going straight up the
+      ancestor chain, and including the element itself, if it is a
+      &lt;code&gt;form&lt;/code&gt; element), or, if there is no such
+      &lt;code&gt;form&lt;/code&gt; element, to null.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
@@ -60895,9 +60640,13 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Return all the child nodes of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;,
-    preserving the document order.&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, return the
+    child nodes of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, in &lt;span&gt;tree
+    order&lt;/span&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, return the children of the &lt;code&gt;Document&lt;/code&gt;
+    object, in &lt;span&gt;tree order&lt;/span&gt;.&lt;/p&gt;
+
    &lt;/li&gt;
 
   &lt;/ol&gt;
@@ -60929,6 +60678,242 @@
 
 
 
+  &lt;h2&gt;&lt;dfn&gt;The XHTML syntax&lt;/dfn&gt;&lt;/h2&gt;
+
+  &lt;p class=&quot;note&quot;&gt;This section only describes the rules for XML
+  resources. Rules for &lt;code title=&quot;&quot;&gt;text/html&lt;/code&gt; resources are
+  discussed in the section above entitled &quot;&lt;span&gt;The HTML
+  syntax&lt;/span&gt;&quot;.&lt;/p&gt;
+
+
+  &lt;h3&gt;Writing XHTML documents&lt;/h3&gt;
+
+  &lt;p&gt;The syntax for using HTML with XML, whether in XHTML documents or
+  embedded in other XML documents, is defined in the XML and
+  Namespaces in XML specifications. &lt;a href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt; &lt;a
+  href=&quot;#refsXMLNS&quot;&gt;[XMLNS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;This specification does not define any syntax-level requirements
+  beyond those defined for XML proper.&lt;/p&gt;
+
+
+  &lt;h3&gt;Parsing XHTML documents&lt;/h3&gt;
+
+  &lt;p&gt;This section describes the relationship between XML and the DOM,
+  with a particular emphasis on how this interacts with HTML.&lt;/p&gt;
+
+  &lt;p&gt;An &lt;dfn&gt;XML parser&lt;/dfn&gt;, for the purposes of this specification,
+  is a construct that follows the rules given in the XML specification
+  to map a string of bytes or characters into a &lt;code&gt;Document&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;An &lt;span&gt;XML parser&lt;/span&gt; is either associated with a
+  &lt;code&gt;Document&lt;/code&gt; object when it is created, or creates one
+  implicitly.&lt;/p&gt;
+
+  &lt;p&gt;This &lt;code&gt;Document&lt;/code&gt; must then be populated with DOM nodes
+  that represent the tree structure of the input passed to the parser,
+  as defined by the XML specification, the Namespaces in XML
+  specification, and the DOM Core specification. DOM mutation events
+  must not fire for the operations that the &lt;span&gt;XML parser&lt;/span&gt;
+  performs on the &lt;code&gt;Document&lt;/code&gt;'s tree, but the user agent
+  must act as if elements and attributes were individually appended
+  and set respectively so as to trigger rules in this specification
+  regarding what happens when an element in inserted into a document
+  or has its attributes set. &lt;a href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt; &lt;a
+  href=&quot;#refsXMLNS&quot;&gt;[XMLNS]&lt;/a&gt; &lt;a href=&quot;#refsDOMCORE&quot;&gt;[DOMCORE]&lt;/a&gt;
+  &lt;a href=&quot;#refsDOMEVENTS&quot;&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;Certain algorithms in this specification &lt;dfn title=&quot;feed the
+  parser&quot;&gt;spoon-feed the parser&lt;/dfn&gt; characters one string at a
+  time. In such cases, the &lt;span&gt;XML parser&lt;/span&gt; must act as it
+  would have if faced with a single string consisting of the
+  concatenation of all those characters.&lt;/p&gt;
+
+  &lt;p&gt;When an &lt;span&gt;XML parser&lt;/span&gt; creates a &lt;code&gt;script&lt;/code&gt;
+  element, it must be marked as being &lt;span&gt;&quot;parser-inserted&quot;&lt;/span&gt;.
+  If the parser was originally created for the &lt;span&gt;XML fragment
+  parsing algorithm&lt;/span&gt;, then the element must be marked as
+  &lt;span&gt;&quot;already executed&quot;&lt;/span&gt; also. When the element's end tag is
+  parsed, the user agent must &lt;span title=&quot;running a
+  script&quot;&gt;run&lt;/span&gt; the &lt;code&gt;script&lt;/code&gt; element. If this causes
+  there to be a &lt;span&gt;pending external script&lt;/span&gt;, then the user
+  agent must &lt;span&gt;pause&lt;/span&gt; until that script has &lt;span&gt;completed
+  loading&lt;/span&gt;, and then &lt;span title=&quot;executing a script
+  block&quot;&gt;execute it&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;Since the &lt;code
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; API is not
+  available for &lt;span&gt;XML documents&lt;/span&gt;, much of the complexity in
+  the &lt;span&gt;HTML parser&lt;/span&gt; is not needed in the &lt;span&gt;XML
+  parser&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;When an &lt;span&gt;XML parser&lt;/span&gt; reaches the end of its input, it
+  must &lt;span&gt;stop parsing&lt;/span&gt;, following the same rules as the
+  &lt;span&gt;HTML parser&lt;/span&gt;.&lt;/p&gt;
+
+
+
+  &lt;h3&gt;Serializing XHTML fragments&lt;/h3&gt;
+
+  &lt;p&gt;The &lt;dfn&gt;XML fragment serialization algorithm&lt;/dfn&gt; for a
+  &lt;code&gt;Document&lt;/code&gt; or &lt;code&gt;Element&lt;/code&gt; node either returns a
+  fragment of XML that represents that node or raises an
+  exception.&lt;/p&gt;
+
+  &lt;p&gt;For &lt;code&gt;Document&lt;/code&gt;s, the algorithm must return a string in
+  the form of a &lt;a
+  href=&quot;<A HREF="http://www.w3.org/TR/xml/#sec-well-formed">http://www.w3.org/TR/xml/#sec-well-formed</A>&quot;&gt;document
+  entity&lt;/a&gt;, if none of the error cases below apply.&lt;/p&gt;
+
+  &lt;p&gt;For &lt;code&gt;Element&lt;/code&gt;s, the algorithm must return a string in
+  the form of an &lt;a
+  href=&quot;<A HREF="http://www.w3.org/TR/xml/#wf-entities">http://www.w3.org/TR/xml/#wf-entities</A>&quot;&gt;internal general parsed
+  entity&lt;/a&gt;, if none of the error cases below apply.&lt;/p&gt;
+
+  &lt;p&gt;In both cases, the string returned must be XML
+  namespace-well-formed and must be an isomorphic serialization of all
+  of that node's child nodes, in &lt;span&gt;tree order&lt;/span&gt;. User agents
+  may adjust prefixes and namespace declarations in the serialization
+  (and indeed might be forced to do so in some cases to obtain
+  namespace-well-formed XML).&lt;/p&gt;
+
+  &lt;p&gt;For &lt;code&gt;Element&lt;/code&gt;s, if any of the elements in the
+  serialization are in no namespace, the default namespace in scope
+  for those elements must be explicitly declared as the empty
+  string.&lt;!-- because otherwise round-tripping might break since it'll
+  pick up the surrounding default ns when setting --&gt; (This doesn't
+  apply in the &lt;code&gt;Document&lt;/code&gt; case.) &lt;a
+  href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt; &lt;a href=&quot;#refsXMLNS&quot;&gt;[XMLNS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;If any of the following error cases are found in the DOM subtree
+  being serialized, then the algorithm raises an
+  &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception instead of returning a
+  string:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;A &lt;code&gt;Document&lt;/code&gt; node with no child element nodes.&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;DocumentType&lt;/code&gt; node that has an external subset
+   public identifier that contains characters that are not matched by
+   the XML &lt;code title=&quot;&quot;&gt;PubidChar&lt;/code&gt; production. &lt;a
+   href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt;&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;DocumentType&lt;/code&gt; node that has an external subset
+   system identifier that contains both a U+0022 QUOTATION MARK ('&quot;')
+   and a U+0027 APOSTROPHE (&quot;'&quot;).&lt;/li&gt;
+
+   &lt;li&gt;A node with a prefix or local name containing a U+003A COLON
+   (&quot;:&quot;).&lt;/li&gt;
+
+   &lt;li&gt;An &lt;code&gt;Attr&lt;/code&gt; node, &lt;code&gt;Text&lt;/code&gt; node,
+   &lt;code&gt;CDATASection&lt;/code&gt; node, &lt;code&gt;Comment&lt;/code&gt; node, or
+   &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose data contains
+   characters that are not matched by the XML &lt;code
+   title=&quot;&quot;&gt;Char&lt;/code&gt; production. &lt;a href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt;&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;CDATASection&lt;/code&gt; node whose data contains the string
+   &quot;&lt;code title=&quot;&quot;&gt;]]&gt;&lt;/code&gt;&quot;.&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;Comment&lt;/code&gt; node whose data contains two adjacent
+   U+002D HYPHEN-MINUS (-) characters or ends with such a
+   character.&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose target name is
+   an &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the string &quot;&lt;code
+   title=&quot;&quot;&gt;xml&lt;/code&gt;&quot;.&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose target name
+   contains a U+003A COLON (&quot;:&quot;).&lt;/li&gt;
+
+   &lt;li&gt;A &lt;code&gt;ProcessingInstruction&lt;/code&gt; node whose data contains
+   the string &quot;&lt;code title=&quot;&quot;&gt;?&gt;&lt;/code&gt;&quot;.&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+  &lt;p class=&quot;note&quot;&gt;These are the only ways to make a DOM
+  unserializable. The DOM enforces all the other XML constraints; for
+  example, trying to set an attribute with a name that contains an
+  equals sign (=) will raised an &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt;
+  exception.&lt;/p&gt;
+
+
+
+  &lt;h3&gt;Parsing XHTML fragments&lt;/h3&gt;
+
+  &lt;p&gt;The &lt;dfn&gt;XML fragment parsing algorithm&lt;/dfn&gt; for either returns
+  a &lt;code&gt;Document&lt;/code&gt; or raises a &lt;code&gt;SYNTAX_ERR&lt;/code&gt;
+  exception. Given a string &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; and an optional
+  context element &lt;var title=&quot;&quot;&gt;context&lt;/var&gt;, the algorithm is as
+  follows:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Create a new &lt;span&gt;XML parser&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, &lt;span&gt;feed
+    the parser&lt;/span&gt; just created the string corresponding to the
+    start tag of that element, declaring all the namespace prefixes
+    that are in scope on that element in the DOM, as well as declaring
+    the default namespace (if any) that is in scope on that element in
+    the DOM.&lt;/p&gt;
+
+    &lt;p&gt;A namespace prefix is in scope if the DOM Core &lt;code
+    title=&quot;&quot;&gt;lookupNamespaceURI()&lt;/code&gt; method on the element would
+    return a non-null value for that prefix.&lt;/p&gt;
+
+    &lt;p&gt;The default namespace is the namespace for which the DOM Core
+    &lt;code title=&quot;&quot;&gt;isDefaultNamespace()&lt;/code&gt; method on the element
+    would return true.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span&gt;Feed the parser&lt;/span&gt; just created the string &lt;var
+    title=&quot;&quot;&gt;input&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, &lt;span&gt;feed
+    the parser&lt;/span&gt; just created the string corresponding to the
+    end tag of that element.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is an XML well-formedness or XML namespace
+    well-formedness error, then raise a &lt;code&gt;SYNTAX_ERR&lt;/code&gt;
+    exception and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is a &lt;var title=&quot;&quot;&gt;context&lt;/var&gt; element, then return
+    the child nodes of the root element of the resulting
+    &lt;code&gt;Document&lt;/code&gt;, in &lt;span&gt;tree order&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, return the children of the &lt;code&gt;Document&lt;/code&gt;
+    object, in &lt;span&gt;tree order&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+
+
   &lt;h2 id=&quot;rendering&quot;&gt;Rendering&lt;/h2&gt;
 
   &lt;!-- XXX


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009603.html">[html5] r2719 - [] (0) prevent document.domain from being set to	'com' or 'mtnview.ca.us'.
</A></li>
	<LI>Next message: <A HREF="009605.html">[html5] r2721 - [e] (0) Missed that onload was a global that was	also on &lt;body&gt;.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9604">[ date ]</a>
              <a href="thread.html#9604">[ thread ]</a>
              <a href="subject.html#9604">[ subject ]</a>
              <a href="author.html#9604">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
