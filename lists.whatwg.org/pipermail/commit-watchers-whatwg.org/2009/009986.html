<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r3105 - [t] (0) Changed HTMLPropertyCollection to always	return PropertyNodeLists when a [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r3105%20-%20%5Bt%5D%20%280%29%20Changed%20HTMLPropertyCollection%20to%20always%0A%09return%20PropertyNodeLists%20when%20a%20%5B...%5D&In-Reply-To=%3C20090516020247.F0E22140A2D%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009985.html">
   <LINK REL="Next"  HREF="009987.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r3105 - [t] (0) Changed HTMLPropertyCollection to always	return PropertyNodeLists when a [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r3105%20-%20%5Bt%5D%20%280%29%20Changed%20HTMLPropertyCollection%20to%20always%0A%09return%20PropertyNodeLists%20when%20a%20%5B...%5D&In-Reply-To=%3C20090516020247.F0E22140A2D%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r3105 - [t] (0) Changed HTMLPropertyCollection to always	return PropertyNodeLists when a [...]">whatwg at whatwg.org
       </A><BR>
    <I>Fri May 15 19:02:47 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009985.html">[html5] r3104 - [t] (0) What if there's more than one? Let's	continue our campaign of precision...
</A></li>
        <LI>Next message: <A HREF="009987.html">[html5] r3106 - [t] (0) Fix some algorithms aronud 'about'.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9986">[ date ]</a>
              <a href="thread.html#9986">[ thread ]</a>
              <a href="subject.html#9986">[ subject ]</a>
              <a href="author.html#9986">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-05-15 19:02:46 -0700 (Fri, 15 May 2009)
New Revision: 3105

Modified:
   index
   source
Log:
[t] (0) Changed HTMLPropertyCollection to always return PropertyNodeLists when accessed by name. Make itemprop=about only work for RDF on the linking elements. vCard output support. Minor tweaks to microdata. Editorial fixes.

Modified: index
===================================================================
--- index	2009-05-15 00:36:49 UTC (rev 3104)
+++ index	2009-05-16 02:02:46 UTC (rev 3105)
@@ -39,7 +39,7 @@
   &lt;div class=head&gt;
    &lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;h1&gt;HTML 5&lt;/h1&gt;
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 15 May 2009&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-recommendation-&mdash;-date:-01-jan-1901&gt;Draft Recommendation &mdash; 16 May 2009&lt;/h2&gt;
    &lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;dl&gt;&lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -2159,6 +2159,11 @@
   &lt;p&gt;The &lt;dfn id=white_space title=White_Space&gt;White_Space characters&lt;/dfn&gt; are
   those that have the Unicode property &quot;White_Space&quot;. &lt;a href=#refsUNICODE&gt;[UNICODE]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;The &lt;dfn id=alphanumeric-ascii-characters&gt;alphanumeric ASCII characters&lt;/dfn&gt; are those in the
+  ranges U+0030 DIGIT ZERO .. U+0039 DIGIT NINE, U+0041 LATIN CAPITAL
+  LETTER A .. U+005A LATIN CAPITAL LETTER Z, U+0061 LATIN SMALL LETTER
+  A .. U+007A LATIN SMALL LETTER Z.&lt;/p&gt;
+
   &lt;p&gt;Some of the micro-parsers described below follow the pattern of
   having an &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; variable that holds the string
   being parsed, and having a &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; variable
@@ -6479,15 +6484,16 @@
   &lt;pre class=idl&gt;[Callable=&lt;a href=#dom-htmlpropertycollection-nameditem title=dom-HTMLPropertyCollection-namedItem&gt;namedItem&lt;/a&gt;]
 interface &lt;dfn id=htmlpropertycollection-0&gt;HTMLPropertyCollection&lt;/dfn&gt; {
   readonly attribute unsigned long &lt;a href=#dom-htmlpropertycollection-length title=dom-HTMLPropertyCollection-length&gt;length&lt;/a&gt;;
+  [IndexGetter] &lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt; &lt;a href=#dom-htmlpropertycollection-item title=dom-HTMLPropertyCollection-item&gt;item&lt;/a&gt;(in unsigned long index);
+
   readonly attribute &lt;span&gt;DOMStringList&lt;/span&gt; &lt;a href=#dom-htmlpropertycollection-names title=dom-HTMLPropertyCollection-names&gt;names&lt;/a&gt;;
-  [IndexGetter] &lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt; &lt;a href=#dom-htmlpropertycollection-item title=dom-HTMLPropertyCollection-item&gt;item&lt;/a&gt;(in unsigned long index);
-  [NameGetter] Object &lt;a href=#dom-htmlpropertycollection-nameditem title=dom-HTMLPropertyCollection-namedItem&gt;namedItem&lt;/a&gt;(in DOMString name);
+  [NameGetter] &lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt; &lt;a href=#dom-htmlpropertycollection-nameditem title=dom-HTMLPropertyCollection-namedItem&gt;namedItem&lt;/a&gt;(in DOMString name);
 };
 
-typedef sequence&lt;DOMString&gt; &lt;dfn id=domstringarray&gt;DOMStringArray&lt;/dfn&gt;;
+typedef sequence&lt;any&gt; &lt;dfn id=propertyvaluearray&gt;PropertyValueArray&lt;/dfn&gt;;
 
 interface &lt;dfn id=propertynodelist&gt;PropertyNodeList&lt;/dfn&gt; : &lt;span&gt;NodeList&lt;/span&gt; {
-          attribute &lt;a href=#domstringarray&gt;DOMStringArray&lt;/a&gt; &lt;a href=#dom-propertynodelist-content title=dom-PropertyNodeList-content&gt;content&lt;/a&gt;;
+          attribute &lt;a href=#propertyvaluearray&gt;PropertyValueArray&lt;/a&gt; &lt;a href=#dom-propertynodelist-content title=dom-PropertyNodeList-content&gt;content&lt;/a&gt;;
 };&lt;/pre&gt;
 
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;collection&lt;/var&gt; . &lt;code title=dom-HTMLPropertyCollection-length&gt;&lt;a href=#dom-htmlpropertycollection-length&gt;length&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
@@ -6512,9 +6518,7 @@
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;collection&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;name&lt;/var&gt;]&lt;/dt&gt;
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;collection&lt;/var&gt;(&lt;var title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Returns the element with that adds the property named &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; from the collection.&lt;/p&gt;
-    &lt;p&gt;If there are multiple matching elements, then a &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object containing all those elements is returned.&lt;/p&gt;
-    &lt;p&gt;Returns null if no element adds the property named &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Returns a &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object containing any elements that add a property named &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;propertyNodeList&lt;/var&gt; . &lt;var title=&quot;&quot;&gt;content&lt;/var&gt;&lt;/dt&gt;
@@ -6537,6 +6541,13 @@
   attribute must return the number of nodes &lt;a href=#represented-by-the-collection&gt;represented by the
   collection&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;dfn id=dom-htmlpropertycollection-item title=dom-HTMLPropertyCollection-item&gt;&lt;code&gt;item(&lt;var title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must
+  return null.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;span&gt;names of the supported named properties&lt;/span&gt; consist
+  of the &lt;a href=#property-names&gt;property names&lt;/a&gt; of all the elements
+  &lt;a href=#represented-by-the-collection&gt;represented by the collection&lt;/a&gt;.&lt;/p&gt;
+
   &lt;p&gt;The &lt;dfn id=dom-htmlpropertycollection-names title=dom-HTMLPropertyCollection-names&gt;&lt;code&gt;names&lt;/code&gt;&lt;/dfn&gt;
   attribute must return a live &lt;code&gt;DOMStringList&lt;/code&gt; object
   giving the &lt;a href=#property-names&gt;property names&lt;/a&gt; of all the elements
@@ -6545,39 +6556,23 @@
   occurrence of each name. The same object must be returned each
   time.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-htmlpropertycollection-item title=dom-HTMLPropertyCollection-item&gt;&lt;code&gt;item(&lt;var title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must
-  return null.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=dom-htmlpropertycollection-nameditem title=dom-HTMLPropertyCollection-namedItem&gt;&lt;code&gt;namedItem(&lt;var title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return a
+  &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object representing a live view of the
+  &lt;code&gt;&lt;a href=#htmlpropertycollection-0&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/code&gt; object, further filtered so that
+  the only nodes in the &lt;code&gt;&lt;a href=#radionodelist&gt;RadioNodeList&lt;/a&gt;&lt;/code&gt; object are those
+  that have a &lt;a href=#property-names title=&quot;property names&quot;&gt;property name&lt;/a&gt; equal
+  to &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;. The nodes in the
+  &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object must be sorted in &lt;a href=#tree-order&gt;tree
+  order&lt;/a&gt;, and the same object must be returned each time a
+  particular &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is queried.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;span&gt;names of the supported named properties&lt;/span&gt; consist
-  of the &lt;a href=#property-names&gt;property names&lt;/a&gt; of all the elements
-  &lt;a href=#represented-by-the-collection&gt;represented by the collection&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-htmlpropertycollection-nameditem title=dom-HTMLPropertyCollection-namedItem&gt;&lt;code&gt;namedItem(&lt;var title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must act according to the
-  following algorithm:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;If, at the time the method is called, there is exactly one node
-   in the collection that has a &lt;a href=#property-names title=&quot;property names&quot;&gt;property
-   name&lt;/a&gt; equal to &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;, then return that
-   node and stop the algorithm.&lt;/li&gt;
-
-   &lt;li&gt;Otherwise, if there are no nodes in the collection that have a
-   &lt;a href=#property-names title=&quot;property names&quot;&gt;property name&lt;/a&gt; equal to &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;, then return null and stop the algorithm.&lt;/li&gt;
-
-   &lt;li&gt;Otherwise, create a &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object
-   representing a live view of the &lt;code&gt;&lt;a href=#htmlpropertycollection-0&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/code&gt;
-   object, further filtered so that the only nodes in the
-   &lt;code&gt;&lt;a href=#radionodelist&gt;RadioNodeList&lt;/a&gt;&lt;/code&gt; object are those that have a &lt;a href=#property-names title=&quot;property names&quot;&gt;property name&lt;/a&gt; equal to &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;. The nodes in the &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt;
-   object must be sorted in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/li&gt;
-
-   &lt;li&gt;Return that &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;A members of the &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; interface
+  &lt;hr&gt;&lt;p&gt;A members of the &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; interface
   inherited from the &lt;code&gt;NodeList&lt;/code&gt; interface must behave as
   they would on a &lt;code&gt;NodeList&lt;/code&gt; object.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-propertynodelist-content title=dom-PropertyNodeList-content&gt;&lt;code&gt;content&lt;/code&gt;&lt;/dfn&gt; DOM
   attribute on the &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object, on getting,
-  must return a newly constructed &lt;code&gt;&lt;a href=#domstringarray&gt;DOMStringArray&lt;/a&gt;&lt;/code&gt; whose
+  must return a newly constructed &lt;code&gt;DOMStringArray&lt;/code&gt; whose
   values are the values obtained from the &lt;code title=dom-content&gt;&lt;a href=#dom-content&gt;content&lt;/a&gt;&lt;/code&gt; DOM property of each of the
   elements represented by the object, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/p&gt;
 
@@ -40959,7 +40954,8 @@
   attribute returns an &lt;code&gt;&lt;a href=#htmlpropertycollection-0&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/code&gt;, which can
   be enumerated to go through each element that adds one or more
   properties to the item. It can also be indexed by name, which will
-  return the property with that name (if there is just one).&lt;/p&gt;
+  return an object with a list of the elements that add properties
+  with that name.&lt;/p&gt;
 
   &lt;p&gt;Each element that adds a property also has a &lt;code title=dom-content&gt;&lt;a href=#dom-content&gt;content&lt;/a&gt;&lt;/code&gt; DOM attribute that returns its
   value.
@@ -40971,39 +40967,34 @@
    &quot;net.example.name&quot; property from that item.&lt;/p&gt;
 
    &lt;pre&gt;var user = getItems('net.example.user')[0];
-alert('Hello ' + user.properties['net.example.name'].content + '!');&lt;/pre&gt;
+alert('Hello ' + user.properties['net.example.name'][0].content + '!');&lt;/pre&gt;
 
   &lt;/div&gt;
 
-  &lt;p&gt;When an item has multiple properties with the same name, the
-  &lt;code&gt;&lt;a href=#htmlpropertycollection-0&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/code&gt; returns a
-  &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object with all those properties
-  instead of returning just one. The &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt;
-  object can be used to obtained all the values at once using
-  &lt;em&gt;its&lt;/em&gt; &lt;code title=dom-PropertyNodeList-content&gt;&lt;a href=#dom-propertynodelist-content&gt;content&lt;/a&gt;&lt;/code&gt; attribute, which
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#htmlpropertycollection-0&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/code&gt; object, when indexed by
+  name in this way, actually returns a &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt;
+  object with all the matching properties. The
+  &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; object can be used to obtained all the
+  values at once using &lt;em&gt;its&lt;/em&gt; &lt;code title=dom-PropertyNodeList-content&gt;&lt;a href=#dom-propertynodelist-content&gt;content&lt;/a&gt;&lt;/code&gt; attribute, which
   returns an array of all the values.&lt;/p&gt;
 
   &lt;div class=example&gt;
 
    &lt;p&gt;In an earlier example, a &quot;com.example.feline&quot; item had two
-   &quot;com.example.color&quot; values. This script looks up such items and
-   then lists all their values. Because it doesn't know ahead of time
-   if the item has zero, one, or more colors, it checks whether the
-   value returned from the &lt;code&gt;&lt;a href=#htmlpropertycollection-0&gt;HTMLPropertyCollection&lt;/a&gt;&lt;/code&gt; is a
-   &lt;code&gt;&lt;a href=#propertynodelist&gt;PropertyNodeList&lt;/a&gt;&lt;/code&gt; (multiple colors), just a regular
-   element (one color), or null (no colors) before using it.&lt;/p&gt;
+   &quot;com.example.color&quot; values. This script looks up the first such
+   item and then lists all its values.&lt;/p&gt;
 
    &lt;pre&gt;var cat = getItems('com.example.feline')[0];
-var colors = cat.properties['com.example.color'];
+var colors = cat.properties['com.example.color'].content;
 var result;
-if (!colors) {
+if (colors.length == 0) {
   result = 'Color unknown.';
-} else if (colors instanceof PropertyNodeList) {
+} else if (colors.length == 1) {
+  result = 'Color: ' + colors[0];
+} else {
   result = 'Colors:';
-  for (var i = 0; i &lt; colors.content.length; i += 1)
-    result += ' ' + colors.content[i];
-} else {
-  result = 'Color: ' + colors.content;
+  for (var i = 0; i &lt; colors.length; i += 1)
+    result += ' ' + colors[i];
 }&lt;/pre&gt;
 
   &lt;/div&gt;
@@ -41278,12 +41269,16 @@
    &lt;dd&gt;&lt;p&gt;The value is the element's
    &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt;.&lt;/dd&gt;
 
-  &lt;/dl&gt;&lt;p&gt;If a property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt;
+  &lt;/dl&gt;&lt;p&gt;The &lt;dfn id=url-property-elements&gt;URL property elements&lt;/dfn&gt; are the &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#audio&gt;audio&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-embed-element&gt;embed&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-link-element&gt;link&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-source-element&gt;source&lt;/a&gt;&lt;/code&gt;, and &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt;
+  elements.&lt;/p&gt;
+
+  &lt;p&gt;If a property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt;
   is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, the property must be specified
-  using an &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#audio&gt;audio&lt;/a&gt;&lt;/code&gt;,
-  &lt;code&gt;&lt;a href=#the-embed-element&gt;embed&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt;,
-  &lt;code&gt;&lt;a href=#the-link-element&gt;link&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-source-element&gt;source&lt;/a&gt;&lt;/code&gt;, or
-  &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+  using an &lt;a href=#url-property-elements title=&quot;URL property elements&quot;&gt;URL property
+  element&lt;/a&gt;.&lt;/p&gt;
 
 
 
@@ -41478,29 +41473,8 @@
 
        &lt;li&gt;First Last&lt;/li&gt;
 
-      &lt;/ul&gt;&lt;p&gt;User agents must run the following steps to convert the &lt;code title=md-vcard-fn&gt;&lt;a href=#md-vcard-fn&gt;fn&lt;/a&gt;&lt;/code&gt; property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; into an implied
-      &lt;code title=md-vcard-n-family-name&gt;&lt;a href=#md-vcard-n-family-name&gt;family-name&lt;/a&gt;&lt;/code&gt;/&lt;code title=md-vcard-n-given-name&gt;&lt;a href=#md-vcard-n-given-name&gt;given-name&lt;/a&gt;&lt;/code&gt; pair:&lt;/p&gt;
+      &lt;/ul&gt;&lt;/dd&gt;
 
-      &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the &lt;code title=md-vcard-fn&gt;&lt;a href=#md-vcard-fn&gt;fn&lt;/a&gt;&lt;/code&gt; property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;&lt;a href=#split-a-string-on-spaces title=&quot;split a string on spaces&quot;&gt;Split &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; on spaces&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; be the first resulting token, and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; be the second.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; is
-       a U+002C COMMA character (,), then remove that character from
-       &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and let the implied &lt;code title=md-vcard-n-family-name&gt;&lt;a href=#md-vcard-n-family-name&gt;family-name&lt;/a&gt;&lt;/code&gt; be &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and the implied &lt;code title=md-vcard-n-given-name&gt;&lt;a href=#md-vcard-n-given-name&gt;given-name&lt;/a&gt;&lt;/code&gt; be &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; is two
-       Unicode code-points long and its second character is a U+002E
-       FULL STOP character (.), then let the implied &lt;code title=md-vcard-n-family-name&gt;&lt;a href=#md-vcard-n-family-name&gt;family-name&lt;/a&gt;&lt;/code&gt; be &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and the implied &lt;code title=md-vcard-n-given-name&gt;&lt;a href=#md-vcard-n-given-name&gt;given-name&lt;/a&gt;&lt;/code&gt; be the first
-       character of &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; is one
-       Unicode code-point long, then let the implied &lt;code title=md-vcard-n-family-name&gt;&lt;a href=#md-vcard-n-family-name&gt;family-name&lt;/a&gt;&lt;/code&gt; be &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and the implied &lt;code title=md-vcard-n-given-name&gt;&lt;a href=#md-vcard-n-given-name&gt;given-name&lt;/a&gt;&lt;/code&gt; be &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Otherwise, let the implied &lt;code title=md-vcard-n-family-name&gt;&lt;a href=#md-vcard-n-family-name&gt;family-name&lt;/a&gt;&lt;/code&gt; be &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; and the implied &lt;code title=md-vcard-n-given-name&gt;&lt;a href=#md-vcard-n-given-name&gt;given-name&lt;/a&gt;&lt;/code&gt; be &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;.&lt;/li&gt;
-
-      &lt;/ol&gt;&lt;/dd&gt;
-
     &lt;/dl&gt;&lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn id=md-vcard-n-family-name title=md-vcard-n-family-name&gt;&lt;code&gt;family-name&lt;/code&gt;&lt;/dfn&gt; (inside &lt;code title=md-vcard-n&gt;&lt;a href=#md-vcard-n&gt;n&lt;/a&gt;&lt;/code&gt;)&lt;/dt&gt;
@@ -42479,7 +42453,7 @@
   (&lt;span itemprop=&quot;organization-unit&quot;&gt;Los Angeles Division&lt;/span&gt;)
  &lt;/p&gt;
  &lt;p&gt;
-  &lt;span class=&quot;adr&quot; item&gt;
+  &lt;span itempror=&quot;adr&quot; item&gt;
    &lt;span itemprop=&quot;street-address&quot;&gt;10201 W. Pico Blvd.&lt;/span&gt;&lt;br&gt;
    &lt;span itemprop=&quot;locality&quot;&gt;Los Angeles&lt;/span&gt;,
    &lt;span itemprop=&quot;region&quot;&gt;CA&lt;/span&gt;
@@ -42558,7 +42532,7 @@
   to events are used here; this vocabulary cannot express a complete
   iCalendar instance.&lt;/p&gt;
 
-  &lt;dl&gt;&lt;dt&gt;&lt;dfn id=md-vcevent-attach title=md-vcevent-attach&gt;&lt;code&gt;attach&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+  &lt;dl&gt;&lt;dt&gt;&lt;dfn id=md-vevent-attach title=md-vevent-attach&gt;&lt;code&gt;attach&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
@@ -42567,7 +42541,7 @@
     &lt;p&gt;The &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; must be
     an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Any number of properties with the name &lt;code title=md-vcard-attach&gt;attach&lt;/code&gt; may be present within each
+    &lt;p&gt;Any number of properties with the name &lt;code title=md-vevent-attach&gt;&lt;a href=#md-vevent-attach&gt;attach&lt;/a&gt;&lt;/code&gt; may be present within each
     &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; with the type &lt;code title=md-vevent&gt;&lt;a href=#md-vevent&gt;vevent&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -43125,9 +43099,8 @@
     }
     for (var nameIndex = 0; nameIndex &lt; prop.itemprop.length; nameIndex += 1) {
       var name = prop.itemprop[nameIndex];
-      if (!name.match(':') &amp;&amp; !name.match('.')) {
+      if (!name.match(':') &amp;&amp; !name.match('.'))
         calendar += name.toUpperCase() + parameters + ':' + value + '\r\n';
-      }
     }
   }
   calendar += 'END:VEVENT\r\nEND:VCALENDAR\r\n';
@@ -43902,7 +43875,11 @@
 
   &lt;h3 id=converting-html-to-other-formats&gt;&lt;span class=secno&gt;5.5 &lt;/span&gt;Converting HTML to other formats&lt;/h3&gt;
 
+  &lt;p&gt;In all these algorithms, unless otherwise stated, operations that
+  iterate over a series of elements (whether items, properties, or
+  otherwise) must do so in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/p&gt;
 
+
   &lt;h4 id=json&gt;&lt;span class=secno&gt;5.5.1 &lt;/span&gt;JSON&lt;/h4&gt;
 
   &lt;p&gt;Given a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in a &lt;code&gt;Document&lt;/code&gt;,
@@ -44119,10 +44096,10 @@
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;If of the elements whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
    &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, exactly one has a &lt;a href=#property-names title=&quot;property
-   names&quot;&gt;property name&lt;/a&gt; equal to the string &quot;&lt;code title=&quot;&quot;&gt;about&lt;/code&gt;&quot;, and the &lt;a href=#concept-property-value title=concept-property-value&gt;property value&lt;/a&gt; of that
-   element is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be that &lt;a href=#absolute-url&gt;absolute
-   URL&lt;/a&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a new
-   blank node.&lt;/li&gt;
+   names&quot;&gt;property name&lt;/a&gt; equal to the string &quot;&lt;code title=&quot;&quot;&gt;about&lt;/code&gt;&quot;, and that element is a &lt;a href=#url-property-elements title=&quot;URL
+   property elements&quot;&gt;URL property element&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of that
+   property. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a new blank
+   node.&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -44160,14 +44137,10 @@
      reserialise it, check if the &lt;time&gt; was valid, check if it had a
      .date, a .time, a .timezone, etc. --&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not an
-     &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#audio&gt;audio&lt;/a&gt;&lt;/code&gt;,
-     &lt;code&gt;&lt;a href=#the-embed-element&gt;embed&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt;,
-     &lt;code&gt;&lt;a href=#the-link-element&gt;link&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-source-element&gt;source&lt;/a&gt;&lt;/code&gt;, or
-     &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt; element, let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be a
-     plain literal, with the language information set from the
-     &lt;a href=#language&gt;language&lt;/a&gt; of the element, if it is not
-     unknown.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not one of
+     the &lt;a href=#url-property-elements&gt;URL property elements&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be a plain literal, with the language
+     information set from the &lt;a href=#language&gt;language&lt;/a&gt; of the element, if
+     it is not unknown.&lt;/li&gt;
 
      &lt;li&gt;
 
@@ -44198,9 +44171,518 @@
 
   &lt;/ol&gt;&lt;h4 id=vcard-0&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;vCard&lt;/h4&gt;
 
-  &lt;p class=XXX&gt;...&lt;/p&gt;
+  &lt;p&gt;Given a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in a &lt;code&gt;Document&lt;/code&gt;,
+  a user agent must run the following algorithm to &lt;dfn id=extracting-a-vcard title=&quot;extracting a vCard&quot;&gt;extract any &lt;code title=md-vcard&gt;vcard&lt;/code&gt; data represented by that
+  node&lt;/dfn&gt;:&lt;/p&gt;
 
+  &lt;ol&gt;&lt;li&gt;
 
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not an element that is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; with the type &lt;code title=md-vcard&gt;&lt;a href=#md-vcard&gt;vcard&lt;/a&gt;&lt;/code&gt;, then run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has no parent, then there is
+     no vCard. Abort the algorithm, returning nothing.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;'s
+     parent.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Restart the entire algorithm with the new value of &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#add-a-vcard-line&gt;Add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;BEGIN&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot;
+   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#add-a-vcard-line&gt;Add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;PROFILE&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot;
+   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#add-a-vcard-line&gt;Add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;VERSION&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;3.0&lt;/code&gt;&quot;
+   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#add-a-vcard-line&gt;Add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;SOURCE&lt;/code&gt;&quot; and &lt;a href=&quot;#the-document's-current-address&quot;&gt;the document's current
+   address&lt;/a&gt; as the value to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;a href=#the-title-element-0&gt;the &lt;code&gt;title&lt;/code&gt; element&lt;/a&gt; is not null,
+   &lt;a href=#add-a-vcard-line&gt;add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;NAME&lt;/code&gt;&quot; and the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of &lt;a href=#the-title-element-0&gt;the
+   &lt;code&gt;title&lt;/code&gt; element&lt;/a&gt; as the value to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
+    more &lt;a href=#property-names&gt;property names&lt;/a&gt; and whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
+    &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;: for each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
+    in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;a href=#property-names&gt;property names&lt;/a&gt;, run
+    the following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is equal to the string
+     &quot;&lt;code title=&quot;&quot;&gt;about&lt;/code&gt;&quot;, skip this name.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt; be an empty set of
+     name-value pairs.&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Run the appropriate set of substeps from the following
+      list. The steps will set a variable &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;,
+      which is used in the next step.&lt;/p&gt;
+
+      &lt;dl&gt;&lt;dt&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;
+       and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code title=md-vcard-n&gt;&lt;a href=#md-vcard-n&gt;n&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n1&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the first
+         property named &lt;code title=md-vcard-n-family-name&gt;&lt;a href=#md-vcard-n-family-name&gt;family-name&lt;/a&gt;&lt;/code&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there is no
+         such property or the property's value is itself an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n2&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the first
+         property named &lt;code title=md-vcard-n-given-name&gt;&lt;a href=#md-vcard-n-given-name&gt;given-name&lt;/a&gt;&lt;/code&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there is no
+         such property or the property's value is itself an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n3&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the first
+         property named &lt;code title=md-vcard-n-additional-name&gt;&lt;a href=#md-vcard-n-additional-name&gt;additional-name&lt;/a&gt;&lt;/code&gt; in
+         &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there is
+         no such property or the property's value is itself an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n4&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the first
+         property named &lt;code title=md-vcard-n-honorific-prefix&gt;&lt;a href=#md-vcard-n-honorific-prefix&gt;honorific-prefix&lt;/a&gt;&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there
+         is no such property or the property's value is itself an
+         &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n5&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the first
+         property named &lt;code title=md-vcard-n-honorific-suffix&gt;&lt;a href=#md-vcard-n-honorific-suffix&gt;honorific-suffix&lt;/a&gt;&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there
+         is no such property or the property's value is itself an
+         &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the concatenation of the
+          following, in this order:&lt;/p&gt;
+
+          &lt;ol class=brief&gt;&lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;n1&lt;/var&gt;&lt;/li&gt;
+           &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+           &lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;n2&lt;/var&gt;&lt;/li&gt;
+           &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+           &lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;n3&lt;/var&gt;&lt;/li&gt;
+           &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+           &lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;n4&lt;/var&gt;&lt;/li&gt;
+           &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+           &lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;n5&lt;/var&gt;&lt;/li&gt;
+          &lt;/ol&gt;&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
+       &lt;dt&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;
+       and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code title=md-vcard-adr&gt;&lt;a href=#md-vcard-adr&gt;adr&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the empty
+         string.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-vcard-subproperties&gt;collecting vCard subproperties&lt;/a&gt; named &lt;code title=md-vcard-adr-post-office-box&gt;&lt;a href=#md-vcard-adr-post-office-box&gt;post-office-box&lt;/a&gt;&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-vcard-subproperties&gt;collecting vCard subproperties&lt;/a&gt; named &lt;code title=md-vcard-adr-extended-address&gt;&lt;a href=#md-vcard-adr-extended-address&gt;extended-address&lt;/a&gt;&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-vcard-subproperties&gt;collecting vCard subproperties&lt;/a&gt; named &lt;code title=md-vcard-adr-street-address&gt;&lt;a href=#md-vcard-adr-street-address&gt;street-address&lt;/a&gt;&lt;/code&gt; in
+         &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-the-first-vcard-subproperty&gt;collecting the first vCard subproperty&lt;/a&gt; named
+         &lt;code title=md-vcard-adr-locality&gt;&lt;a href=#md-vcard-adr-locality&gt;locality&lt;/a&gt;&lt;/code&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-the-first-vcard-subproperty&gt;collecting the first vCard subproperty&lt;/a&gt; named
+         &lt;code title=md-vcard-adr-region&gt;&lt;a href=#md-vcard-adr-region&gt;region&lt;/a&gt;&lt;/code&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-the-first-vcard-subproperty&gt;collecting the first vCard subproperty&lt;/a&gt; named
+         &lt;code title=md-vcard-adr-postal-code&gt;&lt;a href=#md-vcard-adr-postal-code&gt;postal-code&lt;/a&gt;&lt;/code&gt; in
+         &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-the-first-vcard-subproperty&gt;collecting the first vCard subproperty&lt;/a&gt; named
+         &lt;code title=md-vcard-adr-country-name&gt;&lt;a href=#md-vcard-adr-country-name&gt;country-name&lt;/a&gt;&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;&lt;p&gt;If there is a property named &lt;code title=md-vcard-adr-type&gt;&lt;a href=#md-vcard-adr-type&gt;type&lt;/a&gt;&lt;/code&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, and the first such property has a
+         &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; that is not
+         an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; and whose value
+         consists only of &lt;a href=#alphanumeric-ascii-characters&gt;alphanumeric ASCII characters&lt;/a&gt;,
+         then add a parameter named &quot;&lt;code title=&quot;&quot;&gt;TYPE&lt;/code&gt;&quot; whose
+         value is the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of that property
+         to &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
+       &lt;dt&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;
+       and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code title=md-vcard-org&gt;&lt;a href=#md-vcard-org&gt;org&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the empty
+         string.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-the-first-vcard-subproperty&gt;collecting the first vCard subproperty&lt;/a&gt; named
+         &lt;code title=md-vcard-org-organization-name&gt;&lt;a href=#md-vcard-org-organization-name&gt;organization-name&lt;/a&gt;&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;For each property named &lt;code title=md-vcard-org-organization-unit&gt;&lt;a href=#md-vcard-org-organization-unit&gt;organization-unit&lt;/a&gt;&lt;/code&gt;
+          in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, run the following steps:&lt;/p&gt;
+
+          &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the property
+           is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, then skip
+           this property.&lt;/li&gt;
+
+           &lt;li&gt;&lt;p&gt;Append a U+003B SEMICOLON character (;) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+           &lt;li&gt;&lt;p&gt;Append the result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text
+           string&lt;/a&gt; given by the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the property
+           to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+          &lt;/ol&gt;&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
+       &lt;dt&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;
+       with the type &lt;code title=md-vcard&gt;&lt;a href=#md-vcard&gt;vcard&lt;/a&gt;&lt;/code&gt; and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code title=md-vcard-agent&gt;&lt;a href=#md-vcard-agent&gt;agent&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the result of
+         &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; obtained from
+         &lt;a href=#extracting-a-vcard&gt;extracting a vCard&lt;/a&gt; from the element that
+         represents &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Add a parameter named &quot;&lt;code title=&quot;&quot;&gt;VALUE&lt;/code&gt;&quot;
+         whose value is &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
+       &lt;dt&gt;If the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
+       is none of the above&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;a href=#collecting-the-first-vcard-subproperty&gt;collecting the first vCard subproperty&lt;/a&gt; named
+         &lt;code title=&quot;&quot;&gt;value&lt;/code&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;&lt;p&gt;If there is a property named &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, and the
+         first such property has a &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; that is not an
+         &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; and whose value
+         consists only of &lt;a href=#alphanumeric-ascii-characters&gt;alphanumeric ASCII characters&lt;/a&gt;,
+         then add a parameter named &quot;&lt;code title=&quot;&quot;&gt;TYPE&lt;/code&gt;&quot; whose
+         value is the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of that property
+         to &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
+       &lt;dt&gt;Otherwise (the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; is not an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;)&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the property's &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is one of the &lt;a href=#url-property-elements&gt;URL
+         property elements&lt;/a&gt;, add a parameter with the name &quot;&lt;code title=&quot;&quot;&gt;VALUE&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;URI&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is a
+         &lt;code&gt;&lt;a href=#the-time-element&gt;time&lt;/a&gt;&lt;/code&gt; element and the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is
+         a &lt;a href=#valid-date-string&gt;valid date string&lt;/a&gt;, add a parameter with the name
+         &quot;&lt;code title=&quot;&quot;&gt;VALUE&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;DATE&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is a
+         &lt;code&gt;&lt;a href=#the-time-element&gt;time&lt;/a&gt;&lt;/code&gt; element and the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is
+         a &lt;a href=#valid-global-date-and-time-string&gt;valid global date and time string&lt;/a&gt;, add a
+         parameter with the name &quot;&lt;code title=&quot;&quot;&gt;VALUE&lt;/code&gt;&quot; and the
+         value &quot;&lt;code title=&quot;&quot;&gt;DATE-TIME&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Prefix every U+005C REVERSE SOLIDUS character (\) in
+         &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with another U+005C REVERSE SOLIDUS
+         character (\).&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Prefix every U+002C COMMA character (,) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C REVERSE SOLIDUS character
+         (\).&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Unless &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code title=md-vcard-geo&gt;&lt;a href=#md-vcard-geo&gt;geo&lt;/a&gt;&lt;/code&gt;, prefix every U+003B SEMICOLON
+         character (;) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C
+         REVERSE SOLIDUS character (\).&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Replace every U+000D CARRIAGE RETURN U+000A LINE FEED
+         character pair (CRLF) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C REVERSE
+         SOLIDUS character (\) followed by a U+006E LATIN SMALL LETTER
+         N.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Replace every remaining U+000D CARRIAGE RETURN (CR) or
+         U+000A LINE FEED (LF) character in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
+         with a U+005C REVERSE SOLIDUS character (\) followed by a U+006E
+         LATIN SMALL LETTER N.&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
+      &lt;/dl&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;&lt;a href=#add-a-vcard-line&gt;Add a vCard line&lt;/a&gt; with the type &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;, the parameters &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;, and the value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is no property named &lt;code title=md-vcard-n&gt;&lt;a href=#md-vcard-n&gt;n&lt;/a&gt;&lt;/code&gt;
+    whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding
+    item&lt;/a&gt; is &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then run the following
+    substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is no property named &lt;code title=md-vcard-fn&gt;&lt;a href=#md-vcard-fn&gt;fn&lt;/a&gt;&lt;/code&gt; whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then skip the remainder of these
+     substeps.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the first property named &lt;code title=md-vcard-fn&gt;&lt;a href=#md-vcard-fn&gt;fn&lt;/a&gt;&lt;/code&gt; whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has a &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; that is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, then skip the remainder of
+     these substeps.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fn&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the first property
+     named &lt;code title=md-vcard-fn&gt;&lt;a href=#md-vcard-fn&gt;fn&lt;/a&gt;&lt;/code&gt; whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If there is a property named &lt;code title=md-vcard-org&gt;&lt;a href=#md-vcard-org&gt;org&lt;/a&gt;&lt;/code&gt; whose &lt;a href=#concept-item-corresponding title=concept-item-corresponding&gt;corresponding item&lt;/a&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, and the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the first such
+     property is equal to &lt;var title=&quot;&quot;&gt;fn&lt;/var&gt; (and is not an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;), then &lt;a href=#add-a-vcard-line&gt;add a vCard
+     line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value
+     is four U+003B SEMICOLON characters (&quot;&lt;code title=&quot;&quot;&gt;;;;;&lt;/code&gt;&quot;) to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;. Then, skip
+     the remainder of these substeps.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;a href=#space-character title=&quot;space character&quot;&gt;space
+     characters&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;fn&lt;/var&gt;, if any, are not all
+     contiguous, then skip the remainder of these substeps.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;a href=#split-a-string-on-spaces title=&quot;split a string on spaces&quot;&gt;Split &lt;var title=&quot;&quot;&gt;fn&lt;/var&gt; on spaces&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;part
+     one&lt;/var&gt; be the first resulting token, and &lt;var title=&quot;&quot;&gt;part
+     two&lt;/var&gt; be the second, if any, or the empty string if there is
+     no second token. (There cannot be three, given the previous
+     step.)&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; is a
+      U+002C COMMA character (,), then remove that character from &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and &lt;a href=#add-a-vcard-line&gt;add a vCard line&lt;/a&gt; with
+      the type &quot;&lt;code title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value is the
+      concatenation of the following strings:&lt;/p&gt;
+
+      &lt;ol class=brief&gt;&lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+       &lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;Three U+003B SEMICOLON characters (;)&lt;/li&gt;
+      &lt;/ol&gt;&lt;p&gt;Then, skip the remainder of these substeps.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; is two Unicode code-points
+      long and its second character is a U+002E FULL STOP character
+      (.), then &lt;a href=#add-a-vcard-line&gt;add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value is the concatenation of the
+      following strings:&lt;/p&gt;
+
+      &lt;ol class=brief&gt;&lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+       &lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; consisting of the first character of &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;Three U+003B SEMICOLON characters (;)&lt;/li&gt;
+      &lt;/ol&gt;&lt;p&gt;Then, skip the remainder of these substeps.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; is one Unicode code-point
+      long, then &lt;a href=#add-a-vcard-line&gt;add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value is the concatenation of the
+      following strings:&lt;/p&gt;
+
+      &lt;ol class=brief&gt;&lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+       &lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;Three U+003B SEMICOLON characters (;)&lt;/li&gt;
+      &lt;/ol&gt;&lt;p&gt;Then, skip the remainder of these substeps.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;&lt;a href=#add-a-vcard-line&gt;Add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value is the concatenation of the
+      following strings:&lt;/p&gt;
+
+      &lt;ol class=brief&gt;&lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+       &lt;li&gt;The result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text string&lt;/a&gt; &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;Three U+003B SEMICOLON characters (;)&lt;/li&gt;
+      &lt;/ol&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#add-a-vcard-line&gt;Add a vCard line&lt;/a&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;END&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot;
+   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the above algorithm says that the user agent is to &lt;dfn id=add-a-vcard-line&gt;add
+  a vCard line&lt;/dfn&gt; consisting of a type &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;,
+  optionally some parameters, and a value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to
+  a string &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, it must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; be an empty string.
+
+   &lt;li&gt;&lt;p&gt;Append &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;, &lt;a href=#converted-to-uppercase&gt;converted to
+   uppercase&lt;/a&gt;, to &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there are any parameters, then for each parameter, in the
+    order that they were added, run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Append a U+003B SEMICOLON character (;) to &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the parameter's name to &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+003D EQUALS SIGN character (=) to &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the parameter's value to &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append a U+003A COLON character (:) to &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt; be 75.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If and while &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is longer than &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt; Unicode code points long, run the
+    following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Append the first &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt;
+     Unicode code points of &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Remove the first &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt;
+     Unicode code points from &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+000D CARRIAGE RETURN character (CR) to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+000A LINE FEED character (LF) to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+0020 SPACE character to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt; be 74.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append (what remains of) &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append a U+000D CARRIAGE RETURN character (CR) to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append a U+000A LINE FEED character (LF) to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above require the user agent to obtain the result
+  of &lt;dfn id=collecting-vcard-subproperties&gt;collecting vCard subproperties&lt;/dfn&gt; named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, the user
+  agent must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the empty string.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each property named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in the item
+    &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, run the following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt;
+     of the property is itself an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, then skip this
+     property.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If this is not the first property named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt; (ignoring
+     any that were skipped by the previous step), then append a U+002C
+     COMMA character (,) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text
+     string&lt;/a&gt; given by the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the property to
+     &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above require the user agent to obtain the result
+  of &lt;dfn id=collecting-the-first-vcard-subproperty&gt;collecting the first vCard subproperty&lt;/dfn&gt; named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, the user
+  agent must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there are no properties named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt;
+   in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, then abort these substeps,
+   returning the empty string.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of
+   the first property named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, then abort these substeps,
+   returning the empty string.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return the result of &lt;a href=#escaping-the-vcard-text-string&gt;escaping the vCard text
+   string&lt;/a&gt; given by the &lt;a href=#concept-property-value title=concept-property-value&gt;value&lt;/a&gt; of the first property
+   named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the above algorithms say the user agent is to &lt;dfn id=escaping-the-vcard-text-string title=&quot;escaping the vCard text string&quot;&gt;escape the vCard text
+  string&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;, the user agent must use the
+  following steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Prefix every U+005C REVERSE SOLIDUS character (\) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with another U+005C REVERSE SOLIDUS character
+   (\).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Prefix every U+002C COMMA character (,) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C REVERSE SOLIDUS character
+   (\).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Prefix every U+003B SEMICOLON character (;) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C REVERSE SOLIDUS character
+   (\).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Replace every U+000D CARRIAGE RETURN U+000A LINE FEED
+   character pair (CRLF) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C
+   REVERSE SOLIDUS character (\) followed by a U+006E LATIN SMALL
+   LETTER N.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Replace every remaining U+000D CARRIAGE RETURN (CR) or
+   U+000A LINE FEED (LF) character in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a
+   U+005C REVERSE SOLIDUS character (\) followed by a U+006E LATIN
+   SMALL LETTER N.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return the mutated &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;This algorithm can generate invalid vCard output, if
+  the input does not conform to the rules described for the &lt;code title=md-vcard&gt;&lt;a href=#md-vcard&gt;vcard&lt;/a&gt;&lt;/code&gt; &lt;a href=#predefined-type&gt;predefined type&lt;/a&gt; and &lt;a href=#predefined-property-name title=&quot;predefined property name&quot;&gt;predefined property
+  names&lt;/a&gt;.&lt;/p&gt; &lt;!-- of course since vcard doesn't define error
+  handling, this is somewhat problematic. --&gt;
+
+
   &lt;h4 id=icalendar&gt;&lt;span class=secno&gt;5.5.4 &lt;/span&gt;iCalendar&lt;/h4&gt;
 
   &lt;p class=XXX&gt;...&lt;/p&gt;

Modified: source
===================================================================
--- source	2009-05-15 00:36:49 UTC (rev 3104)
+++ source	2009-05-16 02:02:46 UTC (rev 3105)
@@ -1162,6 +1162,11 @@
   those that have the Unicode property &quot;White_Space&quot;. &lt;a
   href=&quot;#refsUNICODE&quot;&gt;[UNICODE]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;The &lt;dfn&gt;alphanumeric ASCII characters&lt;/dfn&gt; are those in the
+  ranges U+0030 DIGIT ZERO .. U+0039 DIGIT NINE, U+0041 LATIN CAPITAL
+  LETTER A .. U+005A LATIN CAPITAL LETTER Z, U+0061 LATIN SMALL LETTER
+  A .. U+007A LATIN SMALL LETTER Z.&lt;/p&gt;
+
   &lt;p&gt;Some of the micro-parsers described below follow the pattern of
   having an &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; variable that holds the string
   being parsed, and having a &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; variable
@@ -6453,15 +6458,16 @@
   &lt;pre class=&quot;idl&quot;&gt;[Callable=&lt;span title=&quot;dom-HTMLPropertyCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;]
 interface &lt;dfn&gt;HTMLPropertyCollection&lt;/dfn&gt; {
   readonly attribute unsigned long &lt;span title=&quot;dom-HTMLPropertyCollection-length&quot;&gt;length&lt;/span&gt;;
+  [IndexGetter] &lt;span&gt;HTMLElement&lt;/span&gt; &lt;span title=&quot;dom-HTMLPropertyCollection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
+
   readonly attribute &lt;span&gt;DOMStringList&lt;/span&gt; &lt;span title=&quot;dom-HTMLPropertyCollection-names&quot;&gt;names&lt;/span&gt;;
-  [IndexGetter] &lt;span&gt;HTMLElement&lt;/span&gt; &lt;span title=&quot;dom-HTMLPropertyCollection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
-  [NameGetter] Object &lt;span title=&quot;dom-HTMLPropertyCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;(in DOMString name);
+  [NameGetter] &lt;span&gt;PropertyNodeList&lt;/span&gt; &lt;span title=&quot;dom-HTMLPropertyCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;(in DOMString name);
 };
 
-typedef sequence&lt;DOMString&gt; &lt;dfn&gt;DOMStringArray&lt;/dfn&gt;;
+typedef sequence&lt;any&gt; &lt;dfn&gt;PropertyValueArray&lt;/dfn&gt;;
 
 interface &lt;dfn&gt;PropertyNodeList&lt;/dfn&gt; : &lt;span&gt;NodeList&lt;/span&gt; {
-          attribute &lt;span&gt;DOMStringArray&lt;/span&gt; &lt;span title=&quot;dom-PropertyNodeList-content&quot;&gt;content&lt;/span&gt;;
+          attribute &lt;span&gt;PropertyValueArray&lt;/span&gt; &lt;span title=&quot;dom-PropertyNodeList-content&quot;&gt;content&lt;/span&gt;;
 };&lt;/pre&gt;
 
   &lt;dl class=&quot;domintro&quot;&gt;
@@ -6488,9 +6494,7 @@
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;collection&lt;/var&gt;[&lt;var title=&quot;&quot;&gt;name&lt;/var&gt;]&lt;/dt&gt;
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;collection&lt;/var&gt;(&lt;var title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Returns the element with that adds the property named &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; from the collection.&lt;/p&gt;
-    &lt;p&gt;If there are multiple matching elements, then a &lt;code&gt;PropertyNodeList&lt;/code&gt; object containing all those elements is returned.&lt;/p&gt;
-    &lt;p&gt;Returns null if no element adds the property named &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Returns a &lt;code&gt;PropertyNodeList&lt;/code&gt; object containing any elements that add a property named &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;propertyNodeList&lt;/var&gt; . &lt;var title=&quot;&quot;&gt;content&lt;/var&gt;&lt;/dt&gt;
@@ -6519,15 +6523,6 @@
   collection&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn
-  title=&quot;dom-HTMLPropertyCollection-names&quot;&gt;&lt;code&gt;names&lt;/code&gt;&lt;/dfn&gt;
-  attribute must return a live &lt;code&gt;DOMStringList&lt;/code&gt; object
-  giving the &lt;span&gt;property names&lt;/span&gt; of all the elements
-  &lt;span&gt;represented by the collection&lt;/span&gt;, listed in &lt;span&gt;tree
-  order&lt;/span&gt;, but with duplicates removed, leaving only the first
-  occurrence of each name. The same object must be returned each
-  time.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn
   title=&quot;dom-HTMLPropertyCollection-item&quot;&gt;&lt;code&gt;item(&lt;var
   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
@@ -6539,33 +6534,26 @@
   &lt;span&gt;represented by the collection&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HTMLPropertyCollection-names&quot;&gt;&lt;code&gt;names&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return a live &lt;code&gt;DOMStringList&lt;/code&gt; object
+  giving the &lt;span&gt;property names&lt;/span&gt; of all the elements
+  &lt;span&gt;represented by the collection&lt;/span&gt;, listed in &lt;span&gt;tree
+  order&lt;/span&gt;, but with duplicates removed, leaving only the first
+  occurrence of each name. The same object must be returned each
+  time.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
   title=&quot;dom-HTMLPropertyCollection-namedItem&quot;&gt;&lt;code&gt;namedItem(&lt;var
-  title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must act according to the
-  following algorithm:&lt;/p&gt;
+  title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return a
+  &lt;code&gt;PropertyNodeList&lt;/code&gt; object representing a live view of the
+  &lt;code&gt;HTMLPropertyCollection&lt;/code&gt; object, further filtered so that
+  the only nodes in the &lt;code&gt;RadioNodeList&lt;/code&gt; object are those
+  that have a &lt;span title=&quot;property names&quot;&gt;property name&lt;/span&gt; equal
+  to &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;. The nodes in the
+  &lt;code&gt;PropertyNodeList&lt;/code&gt; object must be sorted in &lt;span&gt;tree
+  order&lt;/span&gt;, and the same object must be returned each time a
+  particular &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is queried.&lt;/p&gt;
 
-  &lt;ol&gt;
-
-   &lt;li&gt;If, at the time the method is called, there is exactly one node
-   in the collection that has a &lt;span title=&quot;property names&quot;&gt;property
-   name&lt;/span&gt; equal to &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;, then return that
-   node and stop the algorithm.&lt;/li&gt;
-
-   &lt;li&gt;Otherwise, if there are no nodes in the collection that have a
-   &lt;span title=&quot;property names&quot;&gt;property name&lt;/span&gt; equal to &lt;var
-   title=&quot;&quot;&gt;name&lt;/var&gt;, then return null and stop the algorithm.&lt;/li&gt;
-
-   &lt;li&gt;Otherwise, create a &lt;code&gt;PropertyNodeList&lt;/code&gt; object
-   representing a live view of the &lt;code&gt;HTMLPropertyCollection&lt;/code&gt;
-   object, further filtered so that the only nodes in the
-   &lt;code&gt;RadioNodeList&lt;/code&gt; object are those that have a &lt;span
-   title=&quot;property names&quot;&gt;property name&lt;/span&gt; equal to &lt;var
-   title=&quot;&quot;&gt;name&lt;/var&gt;. The nodes in the &lt;code&gt;PropertyNodeList&lt;/code&gt;
-   object must be sorted in &lt;span&gt;tree order&lt;/span&gt;.&lt;/li&gt;
-
-   &lt;li&gt;Return that &lt;code&gt;PropertyNodeList&lt;/code&gt; object.&lt;/li&gt;
-
-  &lt;/ol&gt;
-
   &lt;hr&gt;
 
   &lt;p&gt;A members of the &lt;code&gt;PropertyNodeList&lt;/code&gt; interface
@@ -46188,7 +46176,8 @@
   attribute returns an &lt;code&gt;HTMLPropertyCollection&lt;/code&gt;, which can
   be enumerated to go through each element that adds one or more
   properties to the item. It can also be indexed by name, which will
-  return the property with that name (if there is just one).&lt;/p&gt;
+  return an object with a list of the elements that add properties
+  with that name.&lt;/p&gt;
 
   &lt;p&gt;Each element that adds a property also has a &lt;code
   title=&quot;dom-content&quot;&gt;content&lt;/code&gt; DOM attribute that returns its
@@ -46201,40 +46190,35 @@
    &quot;net.example.name&quot; property from that item.&lt;/p&gt;
 
    &lt;pre&gt;var user = getItems('net.example.user')[0];
-alert('Hello ' + user.properties['net.example.name'].content + '!');&lt;/pre&gt;
+alert('Hello ' + user.properties['net.example.name'][0].content + '!');&lt;/pre&gt;
 
   &lt;/div&gt;
 
-  &lt;p&gt;When an item has multiple properties with the same name, the
-  &lt;code&gt;HTMLPropertyCollection&lt;/code&gt; returns a
-  &lt;code&gt;PropertyNodeList&lt;/code&gt; object with all those properties
-  instead of returning just one. The &lt;code&gt;PropertyNodeList&lt;/code&gt;
-  object can be used to obtained all the values at once using
-  &lt;em&gt;its&lt;/em&gt; &lt;code
+  &lt;p&gt;The &lt;code&gt;HTMLPropertyCollection&lt;/code&gt; object, when indexed by
+  name in this way, actually returns a &lt;code&gt;PropertyNodeList&lt;/code&gt;
+  object with all the matching properties. The
+  &lt;code&gt;PropertyNodeList&lt;/code&gt; object can be used to obtained all the
+  values at once using &lt;em&gt;its&lt;/em&gt; &lt;code
   title=&quot;dom-PropertyNodeList-content&quot;&gt;content&lt;/code&gt; attribute, which
   returns an array of all the values.&lt;/p&gt;
 
   &lt;div class=&quot;example&quot;&gt;
 
    &lt;p&gt;In an earlier example, a &quot;com.example.feline&quot; item had two
-   &quot;com.example.color&quot; values. This script looks up such items and
-   then lists all their values. Because it doesn't know ahead of time
-   if the item has zero, one, or more colors, it checks whether the
-   value returned from the &lt;code&gt;HTMLPropertyCollection&lt;/code&gt; is a
-   &lt;code&gt;PropertyNodeList&lt;/code&gt; (multiple colors), just a regular
-   element (one color), or null (no colors) before using it.&lt;/p&gt;
+   &quot;com.example.color&quot; values. This script looks up the first such
+   item and then lists all its values.&lt;/p&gt;
 
    &lt;pre&gt;var cat = getItems('com.example.feline')[0];
-var colors = cat.properties['com.example.color'];
+var colors = cat.properties['com.example.color'].content;
 var result;
-if (!colors) {
+if (colors.length == 0) {
   result = 'Color unknown.';
-} else if (colors instanceof PropertyNodeList) {
+} else if (colors.length == 1) {
+  result = 'Color: ' + colors[0];
+} else {
   result = 'Colors:';
-  for (var i = 0; i &lt; colors.content.length; i += 1)
-    result += ' ' + colors.content[i];
-} else {
-  result = 'Color: ' + colors.content;
+  for (var i = 0; i &lt; colors.length; i += 1)
+    result += ' ' + colors[i];
 }&lt;/pre&gt;
 
   &lt;/div&gt;
@@ -46551,12 +46535,16 @@
 
   &lt;/dl&gt;
 
+  &lt;p&gt;The &lt;dfn&gt;URL property elements&lt;/dfn&gt; are the &lt;code&gt;a&lt;/code&gt;,
+  &lt;code&gt;area&lt;/code&gt;, &lt;code&gt;audio&lt;/code&gt;, &lt;code&gt;embed&lt;/code&gt;,
+  &lt;code&gt;iframe&lt;/code&gt;, &lt;code&gt;img&lt;/code&gt;, &lt;code&gt;link&lt;/code&gt;,
+  &lt;code&gt;object&lt;/code&gt;, &lt;code&gt;source&lt;/code&gt;, and &lt;code&gt;video&lt;/code&gt;
+  elements.&lt;/p&gt;
+
   &lt;p&gt;If a property's &lt;span title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt;
   is an &lt;span&gt;absolute URL&lt;/span&gt;, the property must be specified
-  using an &lt;code&gt;a&lt;/code&gt;, &lt;code&gt;area&lt;/code&gt;, &lt;code&gt;audio&lt;/code&gt;,
-  &lt;code&gt;embed&lt;/code&gt;, &lt;code&gt;iframe&lt;/code&gt;, &lt;code&gt;img&lt;/code&gt;,
-  &lt;code&gt;link&lt;/code&gt;, &lt;code&gt;object&lt;/code&gt;, &lt;code&gt;source&lt;/code&gt;, or
-  &lt;code&gt;video&lt;/code&gt; element.&lt;/p&gt;
+  using an &lt;span title=&quot;URL property elements&quot;&gt;URL property
+  element&lt;/span&gt;.&lt;/p&gt;
 
 
 
@@ -46802,54 +46790,6 @@
 
       &lt;/ul&gt;
 
-      &lt;p&gt;User agents must run the following steps to convert the &lt;code
-      title=&quot;md-vcard-fn&quot;&gt;fn&lt;/code&gt; property's &lt;span
-      title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; into an implied
-      &lt;code title=&quot;md-vcard-n-family-name&quot;&gt;family-name&lt;/code&gt;/&lt;code
-      title=&quot;md-vcard-n-given-name&quot;&gt;given-name&lt;/code&gt; pair:&lt;/p&gt;
-
-      &lt;ol&gt;
-
-       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the &lt;code
-       title=&quot;md-vcard-fn&quot;&gt;fn&lt;/code&gt; property's &lt;span
-       title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;&lt;span title=&quot;split a string on spaces&quot;&gt;Split &lt;var
-       title=&quot;&quot;&gt;value&lt;/var&gt; on spaces&lt;/span&gt;, and let &lt;var
-       title=&quot;&quot;&gt;part one&lt;/var&gt; be the first resulting token, and &lt;var
-       title=&quot;&quot;&gt;part two&lt;/var&gt; be the second.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; is
-       a U+002C COMMA character (,), then remove that character from
-       &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and let the implied &lt;code
-       title=&quot;md-vcard-n-family-name&quot;&gt;family-name&lt;/code&gt; be &lt;var
-       title=&quot;&quot;&gt;part one&lt;/var&gt; and the implied &lt;code
-       title=&quot;md-vcard-n-given-name&quot;&gt;given-name&lt;/code&gt; be &lt;var
-       title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; is two
-       Unicode code-points long and its second character is a U+002E
-       FULL STOP character (.), then let the implied &lt;code
-       title=&quot;md-vcard-n-family-name&quot;&gt;family-name&lt;/code&gt; be &lt;var
-       title=&quot;&quot;&gt;part one&lt;/var&gt; and the implied &lt;code
-       title=&quot;md-vcard-n-given-name&quot;&gt;given-name&lt;/code&gt; be the first
-       character of &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; is one
-       Unicode code-point long, then let the implied &lt;code
-       title=&quot;md-vcard-n-family-name&quot;&gt;family-name&lt;/code&gt; be &lt;var
-       title=&quot;&quot;&gt;part one&lt;/var&gt; and the implied &lt;code
-       title=&quot;md-vcard-n-given-name&quot;&gt;given-name&lt;/code&gt; be &lt;var
-       title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Otherwise, let the implied &lt;code
-       title=&quot;md-vcard-n-family-name&quot;&gt;family-name&lt;/code&gt; be &lt;var
-       title=&quot;&quot;&gt;part two&lt;/var&gt; and the implied &lt;code
-       title=&quot;md-vcard-n-given-name&quot;&gt;given-name&lt;/code&gt; be &lt;var
-       title=&quot;&quot;&gt;part one&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-      &lt;/ol&gt;
-
      &lt;/dd&gt;
 
     &lt;/dl&gt;
@@ -48044,7 +47984,7 @@
   (&lt;span itemprop=&quot;organization-unit&quot;&gt;Los Angeles Division&lt;/span&gt;)
  &lt;/p&gt;
  &lt;p&gt;
-  &lt;span class=&quot;adr&quot; item&gt;
+  &lt;span itempror=&quot;adr&quot; item&gt;
    &lt;span itemprop=&quot;street-address&quot;&gt;10201 W. Pico Blvd.&lt;/span&gt;&lt;br&gt;
    &lt;span itemprop=&quot;locality&quot;&gt;Los Angeles&lt;/span&gt;,
    &lt;span itemprop=&quot;region&quot;&gt;CA&lt;/span&gt;
@@ -48128,7 +48068,7 @@
   &lt;dl&gt;
 
 
-   &lt;dt&gt;&lt;dfn title=&quot;md-vcevent-attach&quot;&gt;&lt;code&gt;attach&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;dfn title=&quot;md-vevent-attach&quot;&gt;&lt;code&gt;attach&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
@@ -48138,7 +48078,7 @@
     an &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p&gt;Any number of properties with the name &lt;code
-    title=&quot;md-vcard-attach&quot;&gt;attach&lt;/code&gt; may be present within each
+    title=&quot;md-vevent-attach&quot;&gt;attach&lt;/code&gt; may be present within each
     &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; with the type &lt;code
     title=&quot;md-vevent&quot;&gt;vevent&lt;/code&gt;.&lt;/p&gt;
 
@@ -48787,9 +48727,8 @@
     }
     for (var nameIndex = 0; nameIndex &lt; prop.itemprop.length; nameIndex += 1) {
       var name = prop.itemprop[nameIndex];
-      if (!name.match(':') &amp;&amp; !name.match('.')) {
+      if (!name.match(':') &amp;&amp; !name.match('.'))
         calendar += name.toUpperCase() + parameters + ':' + value + '\r\n';
-      }
     }
   }
   calendar += 'END:VEVENT\r\nEND:VCALENDAR\r\n';
@@ -49710,7 +49649,11 @@
 
   &lt;h3&gt;Converting HTML to other formats&lt;/h3&gt;
 
+  &lt;p&gt;In all these algorithms, unless otherwise stated, operations that
+  iterate over a series of elements (whether items, properties, or
+  otherwise) must do so in &lt;span&gt;tree order&lt;/span&gt;.&lt;/p&gt;
 
+
   &lt;h4&gt;JSON&lt;/h4&gt;
 
   &lt;p&gt;Given a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in a &lt;code&gt;Document&lt;/code&gt;,
@@ -50004,12 +49947,12 @@
    title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
    &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, exactly one has a &lt;span title=&quot;property
    names&quot;&gt;property name&lt;/span&gt; equal to the string &quot;&lt;code
-   title=&quot;&quot;&gt;about&lt;/code&gt;&quot;, and the &lt;span
-   title=&quot;concept-property-value&quot;&gt;property value&lt;/span&gt; of that
-   element is an &lt;span&gt;absolute URL&lt;/span&gt;, let &lt;var
-   title=&quot;&quot;&gt;subject&lt;/var&gt; be that &lt;span&gt;absolute
-   URL&lt;/span&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a new
-   blank node.&lt;/p&gt;&lt;/li&gt;
+   title=&quot;&quot;&gt;about&lt;/code&gt;&quot;, and that element is a &lt;span title=&quot;URL
+   property elements&quot;&gt;URL property element&lt;/span&gt;, let &lt;var
+   title=&quot;&quot;&gt;subject&lt;/var&gt; be the &lt;span
+   title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of that
+   property. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a new blank
+   node.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -50064,14 +50007,11 @@
      reserialise it, check if the &lt;time&gt; was valid, check if it had a
      .date, a .time, a .timezone, etc. --&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not an
-     &lt;code&gt;a&lt;/code&gt;, &lt;code&gt;area&lt;/code&gt;, &lt;code&gt;audio&lt;/code&gt;,
-     &lt;code&gt;embed&lt;/code&gt;, &lt;code&gt;iframe&lt;/code&gt;, &lt;code&gt;img&lt;/code&gt;,
-     &lt;code&gt;link&lt;/code&gt;, &lt;code&gt;object&lt;/code&gt;, &lt;code&gt;source&lt;/code&gt;, or
-     &lt;code&gt;video&lt;/code&gt; element, let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be a
-     plain literal, with the language information set from the
-     &lt;span&gt;language&lt;/span&gt; of the element, if it is not
-     unknown.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not one of
+     the &lt;span&gt;URL property elements&lt;/span&gt;, let &lt;var
+     title=&quot;&quot;&gt;value&lt;/var&gt; be a plain literal, with the language
+     information set from the &lt;span&gt;language&lt;/span&gt; of the element, if
+     it is not unknown.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;
 
@@ -50117,9 +50057,737 @@
 
   &lt;h4&gt;vCard&lt;/h4&gt;
 
-  &lt;p class=&quot;XXX&quot;&gt;...&lt;/p&gt;
+  &lt;p&gt;Given a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in a &lt;code&gt;Document&lt;/code&gt;,
+  a user agent must run the following algorithm to &lt;dfn
+  title=&quot;extracting a vCard&quot;&gt;extract any &lt;code
+  title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt; data represented by that
+  node&lt;/dfn&gt;:&lt;/p&gt;
 
+  &lt;ol&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not an element that is an &lt;span
+    title=&quot;concept-item&quot;&gt;item&lt;/span&gt; with the type &lt;code
+    title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt;, then run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has no parent, then there is
+     no vCard. Abort the algorithm, returning nothing.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;'s
+     parent.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Restart the entire algorithm with the new value of &lt;var
+     title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+   title=&quot;&quot;&gt;BEGIN&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot;
+   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+   title=&quot;&quot;&gt;PROFILE&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot;
+   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+   title=&quot;&quot;&gt;VERSION&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;3.0&lt;/code&gt;&quot;
+   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+   title=&quot;&quot;&gt;SOURCE&lt;/code&gt;&quot; and &lt;span&gt;the document's current
+   address&lt;/span&gt; as the value to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;span&gt;the &lt;code&gt;title&lt;/code&gt; element&lt;/span&gt; is not null,
+   &lt;span&gt;add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+   title=&quot;&quot;&gt;NAME&lt;/code&gt;&quot; and the &lt;code&gt;textContent&lt;/code&gt; of &lt;span&gt;the
+   &lt;code&gt;title&lt;/code&gt; element&lt;/span&gt; as the value to &lt;var
+   title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
+    more &lt;span&gt;property names&lt;/span&gt; and whose &lt;span
+    title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
+    &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;: for each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
+    in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;span&gt;property names&lt;/span&gt;, run
+    the following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is equal to the string
+     &quot;&lt;code title=&quot;&quot;&gt;about&lt;/code&gt;&quot;, skip this name.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt; be an empty set of
+     name-value pairs.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Run the appropriate set of substeps from the following
+      list. The steps will set a variable &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;,
+      which is used in the next step.&lt;/p&gt;
+
+      &lt;dl&gt;
+
+       &lt;dt&gt;If the property's &lt;span
+       title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is an &lt;span
+       title=&quot;concept-item&quot;&gt;item&lt;/span&gt; &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;
+       and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code
+       title=&quot;md-vcard-n&quot;&gt;n&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n1&lt;/var&gt; be the &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the first
+         property named &lt;code
+         title=&quot;md-vcard-n-family-name&quot;&gt;family-name&lt;/code&gt; in &lt;var
+         title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there is no
+         such property or the property's value is itself an &lt;span
+         title=&quot;concept-item&quot;&gt;item&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n2&lt;/var&gt; be the &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the first
+         property named &lt;code
+         title=&quot;md-vcard-n-given-name&quot;&gt;given-name&lt;/code&gt; in &lt;var
+         title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there is no
+         such property or the property's value is itself an &lt;span
+         title=&quot;concept-item&quot;&gt;item&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n3&lt;/var&gt; be the &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the first
+         property named &lt;code
+         title=&quot;md-vcard-n-additional-name&quot;&gt;additional-name&lt;/code&gt; in
+         &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there is
+         no such property or the property's value is itself an &lt;span
+         title=&quot;concept-item&quot;&gt;item&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n4&lt;/var&gt; be the &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the first
+         property named &lt;code
+         title=&quot;md-vcard-n-honorific-prefix&quot;&gt;honorific-prefix&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there
+         is no such property or the property's value is itself an
+         &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;n5&lt;/var&gt; be the &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the first
+         property named &lt;code
+         title=&quot;md-vcard-n-honorific-suffix&quot;&gt;honorific-suffix&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, or the empty string if there
+         is no such property or the property's value is itself an
+         &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the concatenation of the
+          following, in this order:&lt;/p&gt;
+
+          &lt;ol class=&quot;brief&quot;&gt;
+           &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;n1&lt;/var&gt;&lt;/li&gt;
+           &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+           &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;n2&lt;/var&gt;&lt;/li&gt;
+           &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+           &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;n3&lt;/var&gt;&lt;/li&gt;
+           &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+           &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;n4&lt;/var&gt;&lt;/li&gt;
+           &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+           &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;n5&lt;/var&gt;&lt;/li&gt;
+          &lt;/ol&gt;
+
+         &lt;/li&gt;
+
+        &lt;/ol&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;If the property's &lt;span
+       title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is an &lt;span
+       title=&quot;concept-item&quot;&gt;item&lt;/span&gt; &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;
+       and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code
+       title=&quot;md-vcard-adr&quot;&gt;adr&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the empty
+         string.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting vCard subproperties&lt;/span&gt; named &lt;code
+         title=&quot;md-vcard-adr-post-office-box&quot;&gt;post-office-box&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var
+         title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting vCard subproperties&lt;/span&gt; named &lt;code
+         title=&quot;md-vcard-adr-extended-address&quot;&gt;extended-address&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var
+         title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting vCard subproperties&lt;/span&gt; named &lt;code
+         title=&quot;md-vcard-adr-street-address&quot;&gt;street-address&lt;/code&gt; in
+         &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var
+         title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting the first vCard subproperty&lt;/span&gt; named
+         &lt;code title=&quot;md-vcard-adr-locality&quot;&gt;locality&lt;/code&gt; in &lt;var
+         title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var
+         title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting the first vCard subproperty&lt;/span&gt; named
+         &lt;code title=&quot;md-vcard-adr-region&quot;&gt;region&lt;/code&gt; in &lt;var
+         title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var
+         title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting the first vCard subproperty&lt;/span&gt; named
+         &lt;code title=&quot;md-vcard-adr-postal-code&quot;&gt;postal-code&lt;/code&gt; in
+         &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;Append a U+003B SEMICOLON character (;) to &lt;var
+         title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting the first vCard subproperty&lt;/span&gt; named
+         &lt;code title=&quot;md-vcard-adr-country-name&quot;&gt;country-name&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;&lt;p&gt;If there is a property named &lt;code
+         title=&quot;md-vcard-adr-type&quot;&gt;type&lt;/code&gt; in &lt;var
+         title=&quot;&quot;&gt;subitem&lt;/var&gt;, and the first such property has a
+         &lt;span title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; that is not
+         an &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; and whose value
+         consists only of &lt;span&gt;alphanumeric ASCII characters&lt;/span&gt;,
+         then add a parameter named &quot;&lt;code title=&quot;&quot;&gt;TYPE&lt;/code&gt;&quot; whose
+         value is the &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of that property
+         to &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+        &lt;/ol&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;If the property's &lt;span
+       title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is an &lt;span
+       title=&quot;concept-item&quot;&gt;item&lt;/span&gt; &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;
+       and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code
+       title=&quot;md-vcard-org&quot;&gt;org&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the empty
+         string.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Append to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting the first vCard subproperty&lt;/span&gt; named
+         &lt;code
+         title=&quot;md-vcard-org-organization-name&quot;&gt;organization-name&lt;/code&gt;
+         in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;For each property named &lt;code
+          title=&quot;md-vcard-org-organization-unit&quot;&gt;organization-unit&lt;/code&gt;
+          in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, run the following steps:&lt;/p&gt;
+
+          &lt;ol&gt;
+
+           &lt;li&gt;&lt;p&gt;If the &lt;span
+           title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the property
+           is an &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt;, then skip
+           this property.&lt;/p&gt;&lt;/li&gt;
+
+           &lt;li&gt;&lt;p&gt;Append a U+003B SEMICOLON character (;) to &lt;var
+           title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+           &lt;li&gt;&lt;p&gt;Append the result of &lt;span&gt;escaping the vCard text
+           string&lt;/span&gt; given by the &lt;span
+           title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the property
+           to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+          &lt;/ol&gt;
+
+         &lt;/li&gt;
+
+        &lt;/ol&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;If the property's &lt;span
+       title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is an &lt;span
+       title=&quot;concept-item&quot;&gt;item&lt;/span&gt; &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;
+       with the type &lt;code title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt; and &lt;var
+       title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code
+       title=&quot;md-vcard-agent&quot;&gt;agent&lt;/code&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the result of
+         &lt;span&gt;escaping the vCard text string&lt;/span&gt; obtained from
+         &lt;span&gt;extracting a vCard&lt;/span&gt; from the element that
+         represents &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Add a parameter named &quot;&lt;code title=&quot;&quot;&gt;VALUE&lt;/code&gt;&quot;
+         whose value is &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot; to &lt;var
+         title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+        &lt;/ol&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;If the property's &lt;span
+       title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is an &lt;span
+       title=&quot;concept-item&quot;&gt;item&lt;/span&gt; and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
+       is none of the above&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; the result of
+         &lt;span&gt;collecting the first vCard subproperty&lt;/span&gt; named
+         &lt;code title=&quot;&quot;&gt;value&lt;/code&gt; in &lt;var
+         title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;li&gt;&lt;p&gt;If there is a property named &lt;code
+         title=&quot;&quot;&gt;type&lt;/code&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, and the
+         first such property has a &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; that is not an
+         &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; and whose value
+         consists only of &lt;span&gt;alphanumeric ASCII characters&lt;/span&gt;,
+         then add a parameter named &quot;&lt;code title=&quot;&quot;&gt;TYPE&lt;/code&gt;&quot; whose
+         value is the &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of that property
+         to &lt;var title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+        &lt;/ol&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;Otherwise (the property's &lt;span
+       title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; is not an &lt;span
+       title=&quot;concept-item&quot;&gt;item&lt;/span&gt;)&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the property's &lt;span
+         title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is one of the &lt;span&gt;URL
+         property elements&lt;/span&gt;, add a parameter with the name &quot;&lt;code
+         title=&quot;&quot;&gt;VALUE&lt;/code&gt;&quot; and the value &quot;&lt;code
+         title=&quot;&quot;&gt;URI&lt;/code&gt;&quot; to &lt;var
+         title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is a
+         &lt;code&gt;time&lt;/code&gt; element and the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is
+         a &lt;span&gt;valid date string&lt;/span&gt;, add a parameter with the name
+         &quot;&lt;code title=&quot;&quot;&gt;VALUE&lt;/code&gt;&quot; and the value &quot;&lt;code
+         title=&quot;&quot;&gt;DATE&lt;/code&gt;&quot; to &lt;var
+         title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is a
+         &lt;code&gt;time&lt;/code&gt; element and the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is
+         a &lt;span&gt;valid global date and time string&lt;/span&gt;, add a
+         parameter with the name &quot;&lt;code title=&quot;&quot;&gt;VALUE&lt;/code&gt;&quot; and the
+         value &quot;&lt;code title=&quot;&quot;&gt;DATE-TIME&lt;/code&gt;&quot; to &lt;var
+         title=&quot;&quot;&gt;parameters&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Prefix every U+005C REVERSE SOLIDUS character (\) in
+         &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with another U+005C REVERSE SOLIDUS
+         character (\).&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Prefix every U+002C COMMA character (,) in &lt;var
+         title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C REVERSE SOLIDUS character
+         (\).&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Unless &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is &lt;code
+         title=&quot;md-vcard-geo&quot;&gt;geo&lt;/code&gt;, prefix every U+003B SEMICOLON
+         character (;) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C
+         REVERSE SOLIDUS character (\).&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Replace every U+000D CARRIAGE RETURN U+000A LINE FEED
+         character pair (CRLF) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C REVERSE
+         SOLIDUS character (\) followed by a U+006E LATIN SMALL LETTER
+         N.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Replace every remaining U+000D CARRIAGE RETURN (CR) or
+         U+000A LINE FEED (LF) character in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
+         with a U+005C REVERSE SOLIDUS character (\) followed by a U+006E
+         LATIN SMALL LETTER N.&lt;/p&gt;&lt;/li&gt;
+
+        &lt;/ol&gt;
+
+       &lt;/dd&gt;
+
+      &lt;/dl&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;&lt;span&gt;Add a vCard line&lt;/span&gt; with the type &lt;var
+      title=&quot;&quot;&gt;name&lt;/var&gt;, the parameters &lt;var
+      title=&quot;&quot;&gt;parameters&lt;/var&gt;, and the value &lt;var
+      title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is no property named &lt;code title=&quot;md-vcard-n&quot;&gt;n&lt;/code&gt;
+    whose &lt;span title=&quot;concept-item-corresponding&quot;&gt;corresponding
+    item&lt;/span&gt; is &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then run the following
+    substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;If there is no property named &lt;code
+     title=&quot;md-vcard-fn&quot;&gt;fn&lt;/code&gt; whose &lt;span
+     title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then skip the remainder of these
+     substeps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the first property named &lt;code
+     title=&quot;md-vcard-fn&quot;&gt;fn&lt;/code&gt; whose &lt;span
+     title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has a &lt;span
+     title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; that is an &lt;span
+     title=&quot;concept-item&quot;&gt;item&lt;/span&gt;, then skip the remainder of
+     these substeps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fn&lt;/var&gt; be the &lt;span
+     title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the first property
+     named &lt;code title=&quot;md-vcard-fn&quot;&gt;fn&lt;/code&gt; whose &lt;span
+     title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If there is a property named &lt;code
+     title=&quot;md-vcard-org&quot;&gt;org&lt;/code&gt; whose &lt;span
+     title=&quot;concept-item-corresponding&quot;&gt;corresponding item&lt;/span&gt; is
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, and the &lt;span
+     title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the first such
+     property is equal to &lt;var title=&quot;&quot;&gt;fn&lt;/var&gt; (and is not an &lt;span
+     title=&quot;concept-item&quot;&gt;item&lt;/span&gt;), then &lt;span&gt;add a vCard
+     line&lt;/span&gt; with the type &quot;&lt;code title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value
+     is four U+003B SEMICOLON characters (&quot;&lt;code
+     title=&quot;&quot;&gt;;;;;&lt;/code&gt;&quot;) to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;. Then, skip
+     the remainder of these substeps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;span title=&quot;space character&quot;&gt;space
+     characters&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;fn&lt;/var&gt;, if any, are not all
+     contiguous, then skip the remainder of these substeps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;split a string on spaces&quot;&gt;Split &lt;var
+     title=&quot;&quot;&gt;fn&lt;/var&gt; on spaces&lt;/span&gt;, and let &lt;var title=&quot;&quot;&gt;part
+     one&lt;/var&gt; be the first resulting token, and &lt;var title=&quot;&quot;&gt;part
+     two&lt;/var&gt; be the second, if any, or the empty string if there is
+     no second token. (There cannot be three, given the previous
+     step.)&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; is a
+      U+002C COMMA character (,), then remove that character from &lt;var
+      title=&quot;&quot;&gt;part one&lt;/var&gt; and &lt;span&gt;add a vCard line&lt;/span&gt; with
+      the type &quot;&lt;code title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value is the
+      concatenation of the following strings:&lt;/p&gt;
+
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+       &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;Three U+003B SEMICOLON characters (;)&lt;/li&gt;
+      &lt;/ol&gt;
+
+      &lt;p&gt;Then, skip the remainder of these substeps.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; is two Unicode code-points
+      long and its second character is a U+002E FULL STOP character
+      (.), then &lt;span&gt;add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+      title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value is the concatenation of the
+      following strings:&lt;/p&gt;
+
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+       &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; consisting of the first character of &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;Three U+003B SEMICOLON characters (;)&lt;/li&gt;
+      &lt;/ol&gt;
+
+      &lt;p&gt;Then, skip the remainder of these substeps.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; is one Unicode code-point
+      long, then &lt;span&gt;add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+      title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value is the concatenation of the
+      following strings:&lt;/p&gt;
+
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+       &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;Three U+003B SEMICOLON characters (;)&lt;/li&gt;
+      &lt;/ol&gt;
+
+      &lt;p&gt;Then, skip the remainder of these substeps.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;&lt;span&gt;Add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+      title=&quot;&quot;&gt;N&lt;/code&gt;&quot; whose value is the concatenation of the
+      following strings:&lt;/p&gt;
+
+      &lt;ol class=&quot;brief&quot;&gt;
+       &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;A U+003B SEMICOLON character (;)&lt;/li&gt;
+       &lt;li&gt;The result of &lt;span&gt;escaping the vCard text string&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;&lt;/li&gt;
+       &lt;li&gt;Three U+003B SEMICOLON characters (;)&lt;/li&gt;
+      &lt;/ol&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Add a vCard line&lt;/span&gt; with the type &quot;&lt;code
+   title=&quot;&quot;&gt;END&lt;/code&gt;&quot; and the value &quot;&lt;code title=&quot;&quot;&gt;VCARD&lt;/code&gt;&quot;
+   to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;When the above algorithm says that the user agent is to &lt;dfn&gt;add
+  a vCard line&lt;/dfn&gt; consisting of a type &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;,
+  optionally some parameters, and a value &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to
+  a string &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, it must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; be an empty string.
+
+   &lt;li&gt;&lt;p&gt;Append &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;, &lt;span&gt;converted to
+   uppercase&lt;/span&gt;, to &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there are any parameters, then for each parameter, in the
+    order that they were added, run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+003B SEMICOLON character (;) to &lt;var
+     title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the parameter's name to &lt;var
+     title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+003D EQUALS SIGN character (=) to &lt;var
+     title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the parameter's value to &lt;var
+     title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append a U+003A COLON character (:) to &lt;var
+   title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; to &lt;var
+   title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt; be 75.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If and while &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is longer than &lt;var
+    title=&quot;&quot;&gt;maximum length&lt;/var&gt; Unicode code points long, run the
+    following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the first &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt;
+     Unicode code points of &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; to &lt;var
+     title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Remove the first &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt;
+     Unicode code points from &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+000D CARRIAGE RETURN character (CR) to &lt;var
+     title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+000A LINE FEED character (LF) to &lt;var
+     title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append a U+0020 SPACE character to &lt;var
+     title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum length&lt;/var&gt; be 74.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append (what remains of) &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; to &lt;var
+   title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append a U+000D CARRIAGE RETURN character (CR) to &lt;var
+   title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Append a U+000A LINE FEED character (LF) to &lt;var
+   title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;When the steps above require the user agent to obtain the result
+  of &lt;dfn&gt;collecting vCard subproperties&lt;/dfn&gt; named &lt;var
+  title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, the user
+  agent must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the empty string.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each property named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in the item
+    &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, run the following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;span title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt;
+     of the property is itself an &lt;span
+     title=&quot;concept-item&quot;&gt;item&lt;/span&gt;, then skip this
+     property.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If this is not the first property named &lt;var
+     title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt; (ignoring
+     any that were skipped by the previous step), then append a U+002C
+     COMMA character (,) to &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the result of &lt;span&gt;escaping the vCard text
+     string&lt;/span&gt; given by the &lt;span
+     title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the property to
+     &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;When the steps above require the user agent to obtain the result
+  of &lt;dfn&gt;collecting the first vCard subproperty&lt;/dfn&gt; named &lt;var
+  title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, the user
+  agent must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If there are no properties named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt;
+   in &lt;var title=&quot;&quot;&gt;subitem&lt;/var&gt;, then abort these substeps,
+   returning the empty string.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of
+   the first property named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var
+   title=&quot;&quot;&gt;subitem&lt;/var&gt; is an &lt;span
+   title=&quot;concept-item&quot;&gt;item&lt;/span&gt;, then abort these substeps,
+   returning the empty string.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return the result of &lt;span&gt;escaping the vCard text
+   string&lt;/span&gt; given by the &lt;span
+   title=&quot;concept-property-value&quot;&gt;value&lt;/span&gt; of the first property
+   named &lt;var title=&quot;&quot;&gt;subname&lt;/var&gt; in &lt;var
+   title=&quot;&quot;&gt;subitem&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;When the above algorithms say the user agent is to &lt;dfn
+  title=&quot;escaping the vCard text string&quot;&gt;escape the vCard text
+  string&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;, the user agent must use the
+  following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Prefix every U+005C REVERSE SOLIDUS character (\) in &lt;var
+   title=&quot;&quot;&gt;value&lt;/var&gt; with another U+005C REVERSE SOLIDUS character
+   (\).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Prefix every U+002C COMMA character (,) in &lt;var
+   title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C REVERSE SOLIDUS character
+   (\).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Prefix every U+003B SEMICOLON character (;) in &lt;var
+   title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C REVERSE SOLIDUS character
+   (\).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Replace every U+000D CARRIAGE RETURN U+000A LINE FEED
+   character pair (CRLF) in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a U+005C
+   REVERSE SOLIDUS character (\) followed by a U+006E LATIN SMALL
+   LETTER N.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Replace every remaining U+000D CARRIAGE RETURN (CR) or
+   U+000A LINE FEED (LF) character in &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; with a
+   U+005C REVERSE SOLIDUS character (\) followed by a U+006E LATIN
+   SMALL LETTER N.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return the mutated &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p class=&quot;note&quot;&gt;This algorithm can generate invalid vCard output, if
+  the input does not conform to the rules described for the &lt;code
+  title=&quot;md-vcard&quot;&gt;vcard&lt;/code&gt; &lt;span&gt;predefined type&lt;/span&gt; and &lt;span
+  title=&quot;predefined property name&quot;&gt;predefined property
+  names&lt;/span&gt;.&lt;/p&gt; &lt;!-- of course since vcard doesn't define error
+  handling, this is somewhat problematic. --&gt;
+
+
   &lt;h4&gt;iCalendar&lt;/h4&gt;
 
   &lt;p class=&quot;XXX&quot;&gt;...&lt;/p&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009985.html">[html5] r3104 - [t] (0) What if there's more than one? Let's	continue our campaign of precision...
</A></li>
	<LI>Next message: <A HREF="009987.html">[html5] r3106 - [t] (0) Fix some algorithms aronud 'about'.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9986">[ date ]</a>
              <a href="thread.html#9986">[ thread ]</a>
              <a href="subject.html#9986">[ subject ]</a>
              <a href="author.html#9986">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
