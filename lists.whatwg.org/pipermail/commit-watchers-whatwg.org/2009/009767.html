<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r2885 - [] (0) postMessage() methods that take MessagePort	objects now take MessagePortA [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2885%20-%20%5B%5D%20%280%29%20postMessage%28%29%20methods%20that%20take%20MessagePort%0A%09objects%20now%20take%20MessagePortA%20%5B...%5D&In-Reply-To=%3C20090320210940.94CD1140A14%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009766.html">
   <LINK REL="Next"  HREF="009768.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r2885 - [] (0) postMessage() methods that take MessagePort	objects now take MessagePortA [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2885%20-%20%5B%5D%20%280%29%20postMessage%28%29%20methods%20that%20take%20MessagePort%0A%09objects%20now%20take%20MessagePortA%20%5B...%5D&In-Reply-To=%3C20090320210940.94CD1140A14%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r2885 - [] (0) postMessage() methods that take MessagePort	objects now take MessagePortA [...]">whatwg at whatwg.org
       </A><BR>
    <I>Fri Mar 20 14:09:40 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009766.html">[html5] r2884 - [e] (0) Change the term 'script's character	encoding' to be less confusing.
</A></li>
        <LI>Next message: <A HREF="009768.html">[html5] r2886 - [] (0) Add a conformance section to the WebSocket	Protocol spec (e.g. reference [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9767">[ date ]</a>
              <a href="thread.html#9767">[ thread ]</a>
              <a href="subject.html#9767">[ subject ]</a>
              <a href="author.html#9767">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-03-20 14:09:39 -0700 (Fri, 20 Mar 2009)
New Revision: 2885

Modified:
   index
   source
Log:
[] (0) postMessage() methods that take MessagePort objects now take MessagePortArray objects.

Modified: index
===================================================================
--- index	2009-03-20 20:03:52 UTC (rev 2884)
+++ index	2009-03-20 21:09:39 UTC (rev 2885)
@@ -38778,7 +38778,7 @@
 
   // &lt;a href=#crossDocumentMessages&gt;cross-document messaging&lt;/a&gt;
   void &lt;a href=#dom-window-postmessage-2 title=dom-window-postMessage-2&gt;postMessage&lt;/a&gt;(in any message, in DOMString targetOrigin);
-  void &lt;a href=#dom-window-postmessage-3 title=dom-window-postMessage-3&gt;postMessage&lt;/a&gt;(in any message, in &lt;a href=#messageport&gt;MessagePort&lt;/a&gt; messagePort, in DOMString targetOrigin);
+  void &lt;a href=#dom-window-postmessage-3 title=dom-window-postMessage-3&gt;postMessage&lt;/a&gt;(in any message, in &lt;span&gt;MessagePortArray&lt;/span&gt; ports, in DOMString targetOrigin);
 
   // &lt;a href=#event-handler-dom-attributes&gt;event handler DOM attributes&lt;/a&gt;
            attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-onabort title=handler-onabort&gt;onabort&lt;/a&gt;;
@@ -49708,9 +49708,9 @@
   readonly attribute DOMString &lt;a href=#dom-messageevent-origin title=dom-MessageEvent-origin&gt;origin&lt;/a&gt;;
   readonly attribute DOMString &lt;a href=#dom-messageevent-lasteventid title=dom-MessageEvent-lastEventId&gt;lastEventId&lt;/a&gt;;
   readonly attribute &lt;a href=#windowproxy&gt;WindowProxy&lt;/a&gt; &lt;a href=#dom-messageevent-source title=dom-MessageEvent-source&gt;source&lt;/a&gt;;
-  readonly attribute &lt;a href=#messageport&gt;MessagePort&lt;/a&gt; &lt;a href=#dom-messageevent-messageport title=dom-MessageEvent-messagePort&gt;messagePort&lt;/a&gt;;
-  void &lt;a href=#dom-messageevent-initmessageevent title=dom-MessageEvent-initMessageEvent&gt;initMessageEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any dataArg, in DOMString originArg, in DOMString lastEventIdArg, in &lt;a href=#windowproxy&gt;WindowProxy&lt;/a&gt; sourceArg, in &lt;a href=#messageport&gt;MessagePort&lt;/a&gt; messagePortArg);
-  void &lt;a href=#dom-messageevent-initmessageeventns title=dom-MessageEvent-initMessageEventNS&gt;initMessageEventNS&lt;/a&gt;(in DOMString namespaceURI, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any dataArg, in DOMString originArg, in DOMString lastEventIdArg, in &lt;a href=#windowproxy&gt;WindowProxy&lt;/a&gt; sourceArg, in &lt;a href=#messageport&gt;MessagePort&lt;/a&gt; messagePortArg);
+  readonly attribute &lt;span&gt;MessagePortArray&lt;/span&gt; &lt;a href=#dom-messageevent-ports title=dom-MessageEvent-ports&gt;ports&lt;/a&gt;;
+  void &lt;a href=#dom-messageevent-initmessageevent title=dom-MessageEvent-initMessageEvent&gt;initMessageEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any dataArg, in DOMString originArg, in DOMString lastEventIdArg, in &lt;a href=#windowproxy&gt;WindowProxy&lt;/a&gt; sourceArg, in &lt;span&gt;MessagePortArray&lt;/span&gt; portsArg);
+  void &lt;a href=#dom-messageevent-initmessageeventns title=dom-MessageEvent-initMessageEventNS&gt;initMessageEventNS&lt;/a&gt;(in DOMString namespaceURI, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any dataArg, in DOMString originArg, in DOMString lastEventIdArg, in &lt;a href=#windowproxy&gt;WindowProxy&lt;/a&gt; sourceArg, in &lt;span&gt;MessagePortArray&lt;/span&gt; portsArg);
 };&lt;/pre&gt;
 
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-MessageEvent-data&gt;&lt;a href=#dom-messageevent-data&gt;data&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
@@ -49748,13 +49748,13 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-MessageEvent-messagePort&gt;&lt;a href=#dom-messageevent-messageport&gt;messagePort&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-MessageEvent-ports&gt;&lt;a href=#dom-messageevent-ports&gt;ports&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Returns the &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; sent with the message, for
-    &lt;a href=#crossDocumentMessages&gt;cross-document messaging&lt;/a&gt; and &lt;a href=#channel-messaging&gt;channel
-    messaging&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;Returns the &lt;code&gt;MessagePortArray&lt;/code&gt; sent with the
+    message, for &lt;a href=#crossDocumentMessages&gt;cross-document messaging&lt;/a&gt; and
+    &lt;a href=#channel-messaging&gt;channel messaging&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -49784,18 +49784,18 @@
   &lt;code&gt;&lt;a href=#windowproxy&gt;WindowProxy&lt;/a&gt;&lt;/code&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; of the
   &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object from which the message came.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-messageevent-messageport title=dom-MessageEvent-messagePort&gt;&lt;code&gt;messagePort&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn id=dom-messageevent-ports title=dom-MessageEvent-ports&gt;&lt;code&gt;ports&lt;/code&gt;&lt;/dfn&gt;
   attribute represents, in &lt;a href=#crossDocumentMessages&gt;cross-document messaging&lt;/a&gt; and
-  &lt;a href=#channel-messaging&gt;channel messaging&lt;/a&gt; the &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; being
-  sent, if any.&lt;/p&gt;
+  &lt;a href=#channel-messaging&gt;channel messaging&lt;/a&gt; the &lt;code&gt;MessagePortArray&lt;/code&gt;
+  being sent, if any.&lt;/p&gt;
 
   &lt;p&gt;Unless otherwise specified, when the user agent creates and
   dispatches a &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; event in the
   algorithms described in the following sections, the &lt;code title=dom-MessageEvent-lastEventId&gt;&lt;a href=#dom-messageevent-lasteventid&gt;lastEventId&lt;/a&gt;&lt;/code&gt; attribute
   must be the empty string, the &lt;code title=dom-MessageEvent-origin&gt;&lt;a href=#dom-messageevent-origin&gt;origin&lt;/a&gt;&lt;/code&gt; attribute must be the
   empty string, the &lt;code title=dom-MessageEvent-source&gt;&lt;a href=#dom-messageevent-source&gt;source&lt;/a&gt;&lt;/code&gt; attribute must be
-  null, and the &lt;code title=dom-MessageEvent-messagePort&gt;&lt;a href=#dom-messageevent-messageport&gt;messagePort&lt;/a&gt;&lt;/code&gt;
-  attribute must be null.&lt;/p&gt;
+  null, and the &lt;code title=dom-MessageEvent-ports&gt;&lt;a href=#dom-messageevent-ports&gt;ports&lt;/a&gt;&lt;/code&gt; attribute
+  must be null.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -49911,17 +49911,22 @@
 
   &lt;h4 id=posting-messages&gt;&lt;span class=secno&gt;7.2.3 &lt;/span&gt;Posting messages&lt;/h4&gt;
 
-  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;window&lt;/var&gt; . &lt;code title=dom-window-postMessage-2&gt;&lt;a href=#dom-window-postmessage-2&gt;postMessage&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, [ &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, ] &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt;)&lt;/dt&gt;
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;window&lt;/var&gt; . &lt;code title=dom-window-postMessage-2&gt;&lt;a href=#dom-window-postmessage-2&gt;postMessage&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, [ &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;, ] &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt;)&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Posts a message, optionally with a port, to the given window.&lt;/p&gt;
+    &lt;p&gt;Posts a message, optionally with an array of ports, to the
+    given window.&lt;/p&gt;
 
     &lt;p&gt;If the origin of the target window doesn't match the given
     origin, the message is discarded, to avoid information leakage. To
     send the message to the target regardless of origin, set the
     target origin to &quot;&lt;code title=&quot;&quot;&gt;*&lt;/code&gt;&quot;.&lt;/p&gt;
 
+    &lt;p&gt;Throws an &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; if the &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; array is not null and it contains
+    either null entries, duplicate ports, or ports that are not
+    entangled.&lt;/p&gt;
+
    &lt;/dd&gt;
 
   &lt;/dl&gt;&lt;div class=impl&gt;
@@ -50000,7 +50005,7 @@
 
   &lt;h4 id=posting-messages-with-message-ports&gt;&lt;span class=secno&gt;7.2.4 &lt;/span&gt;Posting messages with message ports&lt;/h4&gt;
 
-  &lt;p&gt;When a script invokes the &lt;dfn id=dom-window-postmessage-3 title=dom-window-postMessage-3&gt;&lt;code&gt;postMessage(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;messagePort&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method (with three
+  &lt;p&gt;When a script invokes the &lt;dfn id=dom-window-postmessage-3 title=dom-window-postMessage-3&gt;&lt;code&gt;postMessage(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method (with three
   arguments) on a &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object, the user agent must
   follow these steps:
 
@@ -50027,7 +50032,7 @@
 
    &lt;li&gt; &lt;!-- NEW STEP --&gt;
 
-    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;messagePort&lt;/var&gt; argument is null, then
+    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; argument is null, then
     act as if the method had just been &lt;a href=#dom-window-postmessage-2 title=dom-window-postMessage-2&gt;called with two arguments&lt;/a&gt;,
     &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt;.&lt;/p&gt;
 
@@ -50035,13 +50040,30 @@
 
    &lt;li&gt; &lt;!-- NEW STEP --&gt;
 
-    &lt;p&gt;Try to obtain a &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt; by &lt;a href=#clone-a-port title=&quot;clone a port&quot;&gt;cloning&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;messagePort&lt;/var&gt; argument with the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt;
-    object on which the method was invoked as the owner of the
-    clone. If this returns an exception, then throw that exception and
-    abort these steps.&lt;/p&gt;
+    &lt;p&gt;If any of the entries in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; are
+    null, if any of the entries in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;
+    are not entangled &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects, or if any
+    &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; object is listed in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; more than once, then throw an
+    &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/p&gt;
 
    &lt;/li&gt;
 
+   &lt;li&gt; &lt;!-- NEW STEP --&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; be an empty array.&lt;/p&gt;
+
+    &lt;p&gt;For each port in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; in turn,
+    obtain a new port by &lt;a href=#clone-a-port title=&quot;clone a port&quot;&gt;cloning&lt;/a&gt; the
+    port with the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object on which the method was
+    invoked as the owner of the clone, and append the clone to the
+    &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array.&lt;/p&gt;
+
+    &lt;p class=note&gt;If the original &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;
+    array was empty, then the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array will
+    also be empty.&lt;/p&gt;
+
+   &lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;Return from the &lt;code title=dom-window-postMessage-3&gt;&lt;a href=#dom-window-postmessage-3&gt;postMessage()&lt;/a&gt;&lt;/code&gt; method, but
@@ -50077,8 +50099,8 @@
 
    &lt;li&gt; &lt;!-- NEW STEP --&gt;
  
-    &lt;p&gt;Let the &lt;code title=dom-MessageEvent-messagePort&gt;&lt;a href=#dom-messageevent-messageport&gt;messagePort&lt;/a&gt;&lt;/code&gt; attribute
-    of the event be the &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Let the &lt;code title=dom-MessageEvent-ports&gt;&lt;a href=#dom-messageevent-ports&gt;ports&lt;/a&gt;&lt;/code&gt; attribute
+    of the event be the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -50185,9 +50207,11 @@
   &lt;p&gt;Each channel has two message ports. Data sent through one port is
   received by the other port, and vice versa.&lt;/p&gt;
 
-  &lt;pre class=idl&gt;interface &lt;dfn id=messageport&gt;MessagePort&lt;/dfn&gt; {
+  &lt;pre class=idl&gt;typedef sequence&lt;MessagePort&gt; MessagePortArray;
+
+interface &lt;dfn id=messageport&gt;MessagePort&lt;/dfn&gt; {
   readonly attribute boolean &lt;a href=#dom-messageport-active title=dom-MessagePort-active&gt;active&lt;/a&gt;;
-  void &lt;a href=#dom-messageport-postmessage title=dom-MessagePort-postMessage&gt;postMessage&lt;/a&gt;(in any message, [Optional] in &lt;a href=#messageport&gt;MessagePort&lt;/a&gt; messagePort);&lt;!--
+  void &lt;a href=#dom-messageport-postmessage title=dom-MessagePort-postMessage&gt;postMessage&lt;/a&gt;(in any message, [Optional] in &lt;span&gt;MessagePortArray&lt;/span&gt; ports);&lt;!--
   &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-MessagePort-startConversation&quot;&gt;startConversation&lt;/span&gt;(in any message);--&gt;
   void &lt;a href=#dom-messageport-start title=dom-MessagePort-start&gt;start&lt;/a&gt;();
   void &lt;a href=#dom-messageport-close title=dom-MessagePort-close&gt;close&lt;/a&gt;();
@@ -50204,14 +50228,16 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt; . &lt;code title=dom-MessagePort-poseMessage&gt;postMessage&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;] )&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt; . &lt;code title=dom-MessagePort-poseMessage&gt;postMessage&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;] )&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Posts a message through the channel, optionally with the given port.&lt;/p&gt;
+    &lt;p&gt;Posts a message through the channel, optionally with the given
+    ports.&lt;/p&gt;
 
-    &lt;p&gt;Throws an &lt;code&gt;&lt;a href=#invalid_access_err&gt;INVALID_ACCESS_ERR&lt;/a&gt;&lt;/code&gt; if the port to be
-    sent is one of the ports involved in the communication.&lt;/p&gt;
+    &lt;p&gt;Throws an &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; if the &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; array is not null and it contains
+    either null entries, duplicate ports, ports that are not
+    entangled, or the source or target port.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -50332,20 +50358,37 @@
    attribute of the event have the value of &lt;var title=&quot;&quot;&gt;message
    clone&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the method was called with a second argument &lt;var title=&quot;&quot;&gt;data port&lt;/var&gt; and that argument isn't null, then run the
-   following substeps:&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;If the method was called with a second argument &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; and that argument isn't null, then run
+   the following substeps:&lt;/p&gt;
 
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;data port&lt;/var&gt; is the &lt;var title=&quot;&quot;&gt;source port&lt;/var&gt; or the &lt;var title=&quot;&quot;&gt;target
-     port&lt;/var&gt;, then throw an &lt;code&gt;&lt;a href=#invalid_access_err&gt;INVALID_ACCESS_ERR&lt;/a&gt;&lt;/code&gt;
-     exception and abort all these steps.&lt;/li&gt;
+    &lt;ol&gt;&lt;li&gt;
 
-     &lt;li&gt;&lt;p&gt;Try to obtain a &lt;var title=&quot;&quot;&gt;new data port&lt;/var&gt; by &lt;a href=#clone-a-port title=&quot;clone a port&quot;&gt;cloning&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;data
-     port&lt;/var&gt; with the owner of the &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt;
-     as the owner of the clone. If this returns an exception, then
-     throw that exception and abort these steps.&lt;/li&gt;
+      &lt;p&gt;If any of the entries in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; are
+      null, if any of the entries in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;
+      are not entangled &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects, or if any
+      &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; object is listed in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; more than once, then throw an
+      &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; be an empty array.&lt;/p&gt;
+
+      &lt;p&gt;For each port in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; in turn,
+      obtain a new port by &lt;a href=#clone-a-port title=&quot;clone a port&quot;&gt;cloning&lt;/a&gt;
+      the port with the owner of the &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt;
+      as the owner of the clone, and append the clone to the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array.&lt;/p&gt;
+
+      &lt;p class=note&gt;If the original &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;
+      array was empty, then the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array will
+      also be empty.&lt;/p&gt;
+
+     &lt;/li&gt;
  
-     &lt;li&gt;&lt;p&gt;Let the &lt;code title=dom-MessageEvent-messagePort&gt;&lt;a href=#dom-messageevent-messageport&gt;messagePort&lt;/a&gt;&lt;/code&gt; attribute
-     of the event be the &lt;var title=&quot;&quot;&gt;new data port&lt;/var&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Let the &lt;code title=dom-MessageEvent-ports&gt;&lt;a href=#dom-messageevent-ports&gt;ports&lt;/a&gt;&lt;/code&gt;
+     attribute of the event be the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt;
+     array.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/li&gt;
 
@@ -50403,8 +50446,9 @@
    title=&quot;&quot;&gt;message&lt;/var&gt;, the method's first argument.&lt;/p&gt;&lt;/li&gt;
  
    &lt;li&gt;&lt;p&gt;Let the &lt;code
-   title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt; attribute
-   of the event be &lt;var title=&quot;&quot;&gt;port2&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/code&gt; attribute
+   of the event be an array containing only &lt;var
+   title=&quot;&quot;&gt;port2&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt; from the method, but
    continue with these steps.&lt;/p&gt;&lt;/li&gt;
@@ -50484,6 +50528,9 @@
   &lt;!-- we might not need to explicitly say the first part of DOM
   Events is fixed to say that events on a task queue prevent GC --&gt;
 
+  &lt;!-- XXX what about ports in the ports attribute of a MessageEvent
+  that isn't dispatched yet? --&gt;
+
   &lt;/div&gt;
 
 

Modified: source
===================================================================
--- source	2009-03-20 20:03:52 UTC (rev 2884)
+++ source	2009-03-20 21:09:39 UTC (rev 2885)
@@ -43946,7 +43946,7 @@
 
   // &lt;span&gt;cross-document messaging&lt;/span&gt;
   void &lt;span title=&quot;dom-window-postMessage-2&quot;&gt;postMessage&lt;/span&gt;(in any message, in DOMString targetOrigin);
-  void &lt;span title=&quot;dom-window-postMessage-3&quot;&gt;postMessage&lt;/span&gt;(in any message, in &lt;span&gt;MessagePort&lt;/span&gt; messagePort, in DOMString targetOrigin);
+  void &lt;span title=&quot;dom-window-postMessage-3&quot;&gt;postMessage&lt;/span&gt;(in any message, in &lt;span&gt;MessagePortArray&lt;/span&gt; ports, in DOMString targetOrigin);
 
   // &lt;span&gt;event handler DOM attributes&lt;/span&gt;
            attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-onabort&quot;&gt;onabort&lt;/span&gt;;
@@ -58294,7 +58294,7 @@
 
   &lt;!-- the XXX below is for collapsing this interface onto WorkerGlobalScope so it looks like just one interface - the inheritance is a spec fiction only --&gt;
   &lt;pre class=&quot;idl&quot;&gt;[NoInterfaceObject, XXX] interface &lt;dfn&gt;DedicatedWorkerGlobalScope&lt;/dfn&gt; : &lt;span&gt;WorkerGlobalScope&lt;/span&gt; {
-  void &lt;span title=&quot;dom-DedicatedWorkerGlobalScope-postMessage&quot;&gt;postMessage&lt;/span&gt;(in any message, [Optional] in &lt;span&gt;MessagePort&lt;/span&gt; messagePort);&lt;!--
+  void &lt;span title=&quot;dom-DedicatedWorkerGlobalScope-postMessage&quot;&gt;postMessage&lt;/span&gt;(in any message, [Optional] in &lt;span&gt;MessagePortArray&lt;/span&gt; ports);&lt;!--
   &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-DedicatedWorkerGlobalScope-startConversation&quot;&gt;startConversation&lt;/span&gt;(in any message);--&gt;
            attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-DedicatedWorkerGlobalScope-onmessage&quot;&gt;onmessage&lt;/span&gt;;
 };&lt;/pre&gt;
@@ -58881,7 +58881,7 @@
 interface &lt;dfn&gt;Worker&lt;/dfn&gt; : &lt;span&gt;AbstractWorker&lt;/span&gt; {
   void &lt;span title=&quot;dom-Worker-terminate&quot;&gt;terminate&lt;/span&gt;();
 
-  void &lt;span title=&quot;dom-Worker-postMessage&quot;&gt;postMessage&lt;/span&gt;(in any message, [Optional] in &lt;span&gt;MessagePort&lt;/span&gt; messagePort);&lt;!--
+  void &lt;span title=&quot;dom-Worker-postMessage&quot;&gt;postMessage&lt;/span&gt;(in any message, [Optional] in &lt;span&gt;MessagePortArray&lt;/span&gt; ports);&lt;!--
   &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-Worker-startConversation&quot;&gt;startConversation&lt;/span&gt;(in any message);--&gt;
            attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-Worker-onmessage&quot;&gt;onmessage&lt;/span&gt;;
 };&lt;/pre&gt;
@@ -59086,10 +59086,10 @@
        cancelable, has no default action, has a &lt;code
        title=&quot;dom-MessageEvent-data&quot;&gt;data&lt;/code&gt; attribute whose value
        is the empty string and has a &lt;code
-       title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt;
-       attribute whose value is the newly created port, and
-       &lt;span&gt;queue a task&lt;/span&gt; to dispatch the event at &lt;var
-       title=&quot;&quot;&gt;worker global scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+       title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/code&gt;
+       attribute whose value is an array containing only the newly
+       created port, and &lt;span&gt;queue a task&lt;/span&gt; to dispatch the
+       event at &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
        &lt;li&gt;&lt;p&gt;Abort all these steps.&lt;/p&gt;&lt;/li&gt;
 
@@ -59129,10 +59129,10 @@
    cancelable, has no default action, has a &lt;code
    title=&quot;dom-MessageEvent-data&quot;&gt;data&lt;/code&gt; attribute whose value is
    the empty string and has a &lt;code
-   title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt; attribute
-   whose value is the newly created port, and &lt;span&gt;queue a
-   task&lt;/span&gt; to dispatch the event at &lt;var title=&quot;&quot;&gt;worker global
-   scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/code&gt; attribute
+   whose value is an array containing only the newly created port, and
+   &lt;span&gt;queue a task&lt;/span&gt; to dispatch the event at &lt;var
+   title=&quot;&quot;&gt;worker global scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -59414,9 +59414,9 @@
   readonly attribute DOMString &lt;span title=&quot;dom-MessageEvent-origin&quot;&gt;origin&lt;/span&gt;;
   readonly attribute DOMString &lt;span title=&quot;dom-MessageEvent-lastEventId&quot;&gt;lastEventId&lt;/span&gt;;
   readonly attribute &lt;span&gt;WindowProxy&lt;/span&gt; &lt;span title=&quot;dom-MessageEvent-source&quot;&gt;source&lt;/span&gt;;
-  readonly attribute &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/span&gt;;
-  void &lt;span title=&quot;dom-MessageEvent-initMessageEvent&quot;&gt;initMessageEvent&lt;/span&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any dataArg, in DOMString originArg, in DOMString lastEventIdArg, in &lt;span&gt;WindowProxy&lt;/span&gt; sourceArg, in &lt;span&gt;MessagePort&lt;/span&gt; messagePortArg);
-  void &lt;span title=&quot;dom-MessageEvent-initMessageEventNS&quot;&gt;initMessageEventNS&lt;/span&gt;(in DOMString namespaceURI, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any dataArg, in DOMString originArg, in DOMString lastEventIdArg, in &lt;span&gt;WindowProxy&lt;/span&gt; sourceArg, in &lt;span&gt;MessagePort&lt;/span&gt; messagePortArg);
+  readonly attribute &lt;span&gt;MessagePortArray&lt;/span&gt; &lt;span title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/span&gt;;
+  void &lt;span title=&quot;dom-MessageEvent-initMessageEvent&quot;&gt;initMessageEvent&lt;/span&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any dataArg, in DOMString originArg, in DOMString lastEventIdArg, in &lt;span&gt;WindowProxy&lt;/span&gt; sourceArg, in &lt;span&gt;MessagePortArray&lt;/span&gt; portsArg);
+  void &lt;span title=&quot;dom-MessageEvent-initMessageEventNS&quot;&gt;initMessageEventNS&lt;/span&gt;(in DOMString namespaceURI, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any dataArg, in DOMString originArg, in DOMString lastEventIdArg, in &lt;span&gt;WindowProxy&lt;/span&gt; sourceArg, in &lt;span&gt;MessagePortArray&lt;/span&gt; portsArg);
 };&lt;/pre&gt;
 
   &lt;dl class=&quot;domintro&quot;&gt;
@@ -59456,13 +59456,13 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Returns the &lt;code&gt;MessagePort&lt;/code&gt; sent with the message, for
-    &lt;span&gt;cross-document messaging&lt;/span&gt; and &lt;span&gt;channel
-    messaging&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;Returns the &lt;code&gt;MessagePortArray&lt;/code&gt; sent with the
+    message, for &lt;span&gt;cross-document messaging&lt;/span&gt; and
+    &lt;span&gt;channel messaging&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -59502,10 +59502,10 @@
   &lt;code&gt;Window&lt;/code&gt; object from which the message came.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn
-  title=&quot;dom-MessageEvent-messagePort&quot;&gt;&lt;code&gt;messagePort&lt;/code&gt;&lt;/dfn&gt;
+  title=&quot;dom-MessageEvent-ports&quot;&gt;&lt;code&gt;ports&lt;/code&gt;&lt;/dfn&gt;
   attribute represents, in &lt;span&gt;cross-document messaging&lt;/span&gt; and
-  &lt;span&gt;channel messaging&lt;/span&gt; the &lt;code&gt;MessagePort&lt;/code&gt; being
-  sent, if any.&lt;/p&gt;
+  &lt;span&gt;channel messaging&lt;/span&gt; the &lt;code&gt;MessagePortArray&lt;/code&gt;
+  being sent, if any.&lt;/p&gt;
 
   &lt;p&gt;Unless otherwise specified, when the user agent creates and
   dispatches a &lt;code title=&quot;event-message&quot;&gt;message&lt;/code&gt; event in the
@@ -59515,8 +59515,9 @@
   title=&quot;dom-MessageEvent-origin&quot;&gt;origin&lt;/code&gt; attribute must be the
   empty string, the &lt;code
   title=&quot;dom-MessageEvent-source&quot;&gt;source&lt;/code&gt; attribute must be
-  null, and the &lt;code title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt;
-  attribute must be null.&lt;/p&gt;
+  null, and the &lt;code
+  title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/code&gt; attribute
+  must be null.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -61359,17 +61360,23 @@
 
   &lt;dl class=&quot;domintro&quot;&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;window&lt;/var&gt; . &lt;code title=&quot;dom-window-postMessage-2&quot;&gt;postMessage&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, [ &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, ] &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;window&lt;/var&gt; . &lt;code title=&quot;dom-window-postMessage-2&quot;&gt;postMessage&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, [ &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;, ] &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt;)&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Posts a message, optionally with a port, to the given window.&lt;/p&gt;
+    &lt;p&gt;Posts a message, optionally with an array of ports, to the
+    given window.&lt;/p&gt;
 
     &lt;p&gt;If the origin of the target window doesn't match the given
     origin, the message is discarded, to avoid information leakage. To
     send the message to the target regardless of origin, set the
     target origin to &quot;&lt;code title=&quot;&quot;&gt;*&lt;/code&gt;&quot;.&lt;/p&gt;
 
+    &lt;p&gt;Throws an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; if the &lt;var
+    title=&quot;&quot;&gt;ports&lt;/var&gt; array is not null and it contains
+    either null entries, duplicate ports, or ports that are not
+    entangled.&lt;/p&gt;
+
    &lt;/dd&gt;
 
   &lt;/dl&gt;
@@ -61467,7 +61474,7 @@
 
   &lt;p&gt;When a script invokes the &lt;dfn
   title=&quot;dom-window-postMessage-3&quot;&gt;&lt;code&gt;postMessage(&lt;var
-  title=&quot;&quot;&gt;message&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;messagePort&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;message&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;, &lt;var
   title=&quot;&quot;&gt;targetOrigin&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method (with three
   arguments) on a &lt;code&gt;Window&lt;/code&gt; object, the user agent must
   follow these steps:
@@ -61502,7 +61509,7 @@
 
    &lt;li&gt; &lt;!-- NEW STEP --&gt;
 
-    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;messagePort&lt;/var&gt; argument is null, then
+    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; argument is null, then
     act as if the method had just been &lt;span
     title=&quot;dom-window-postMessage-2&quot;&gt;called with two arguments&lt;/span&gt;,
     &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; and &lt;var
@@ -61512,15 +61519,31 @@
 
    &lt;li&gt; &lt;!-- NEW STEP --&gt;
 
-    &lt;p&gt;Try to obtain a &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt; by &lt;span
-    title=&quot;clone a port&quot;&gt;cloning&lt;/span&gt; the &lt;var
-    title=&quot;&quot;&gt;messagePort&lt;/var&gt; argument with the &lt;code&gt;Window&lt;/code&gt;
-    object on which the method was invoked as the owner of the
-    clone. If this returns an exception, then throw that exception and
-    abort these steps.&lt;/p&gt;
+    &lt;p&gt;If any of the entries in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; are
+    null, if any of the entries in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;
+    are not entangled &lt;code&gt;MessagePort&lt;/code&gt; objects, or if any
+    &lt;code&gt;MessagePort&lt;/code&gt; object is listed in &lt;var
+    title=&quot;&quot;&gt;ports&lt;/var&gt; more than once, then throw an
+    &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception.&lt;/p&gt;
 
    &lt;/li&gt;
 
+   &lt;li&gt; &lt;!-- NEW STEP --&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; be an empty array.&lt;/p&gt;
+
+    &lt;p&gt;For each port in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; in turn,
+    obtain a new port by &lt;span title=&quot;clone a port&quot;&gt;cloning&lt;/span&gt; the
+    port with the &lt;code&gt;Window&lt;/code&gt; object on which the method was
+    invoked as the owner of the clone, and append the clone to the
+    &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;If the original &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;
+    array was empty, then the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array will
+    also be empty.&lt;/p&gt;
+
+   &lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;Return from the &lt;code
@@ -61562,8 +61585,8 @@
    &lt;li&gt; &lt;!-- NEW STEP --&gt;
  
     &lt;p&gt;Let the &lt;code
-    title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt; attribute
-    of the event be the &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt;.&lt;/p&gt;
+    title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/code&gt; attribute
+    of the event be the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -61687,9 +61710,11 @@
   &lt;p&gt;Each channel has two message ports. Data sent through one port is
   received by the other port, and vice versa.&lt;/p&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;MessagePort&lt;/dfn&gt; {
+  &lt;pre class=&quot;idl&quot;&gt;typedef sequence&lt;MessagePort&gt; MessagePortArray;
+
+interface &lt;dfn&gt;MessagePort&lt;/dfn&gt; {
   readonly attribute boolean &lt;span title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/span&gt;;
-  void &lt;span title=&quot;dom-MessagePort-postMessage&quot;&gt;postMessage&lt;/span&gt;(in any message, [Optional] in &lt;span&gt;MessagePort&lt;/span&gt; messagePort);&lt;!--
+  void &lt;span title=&quot;dom-MessagePort-postMessage&quot;&gt;postMessage&lt;/span&gt;(in any message, [Optional] in &lt;span&gt;MessagePortArray&lt;/span&gt; ports);&lt;!--
   &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-MessagePort-startConversation&quot;&gt;startConversation&lt;/span&gt;(in any message);--&gt;
   void &lt;span title=&quot;dom-MessagePort-start&quot;&gt;start&lt;/span&gt;();
   void &lt;span title=&quot;dom-MessagePort-close&quot;&gt;close&lt;/span&gt;();
@@ -61708,14 +61733,17 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt; . &lt;code title=&quot;dom-MessagePort-poseMessage&quot;&gt;postMessage&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;] )&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt; . &lt;code title=&quot;dom-MessagePort-poseMessage&quot;&gt;postMessage&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;] )&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Posts a message through the channel, optionally with the given port.&lt;/p&gt;
+    &lt;p&gt;Posts a message through the channel, optionally with the given
+    ports.&lt;/p&gt;
 
-    &lt;p&gt;Throws an &lt;code&gt;INVALID_ACCESS_ERR&lt;/code&gt; if the port to be
-    sent is one of the ports involved in the communication.&lt;/p&gt;
+    &lt;p&gt;Throws an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; if the &lt;var
+    title=&quot;&quot;&gt;ports&lt;/var&gt; array is not null and it contains
+    either null entries, duplicate ports, ports that are not
+    entangled, or the source or target port.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -61863,25 +61891,42 @@
    clone&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the method was called with a second argument &lt;var
-   title=&quot;&quot;&gt;data port&lt;/var&gt; and that argument isn't null, then run the
-   following substeps:&lt;/p&gt;
+   title=&quot;&quot;&gt;ports&lt;/var&gt; and that argument isn't null, then run
+   the following substeps:&lt;/p&gt;
 
     &lt;ol&gt;
 
-     &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;data port&lt;/var&gt; is the &lt;var
-     title=&quot;&quot;&gt;source port&lt;/var&gt; or the &lt;var title=&quot;&quot;&gt;target
-     port&lt;/var&gt;, then throw an &lt;code&gt;INVALID_ACCESS_ERR&lt;/code&gt;
-     exception and abort all these steps.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;
 
-     &lt;li&gt;&lt;p&gt;Try to obtain a &lt;var title=&quot;&quot;&gt;new data port&lt;/var&gt; by &lt;span
-     title=&quot;clone a port&quot;&gt;cloning&lt;/span&gt; the &lt;var title=&quot;&quot;&gt;data
-     port&lt;/var&gt; with the owner of the &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt;
-     as the owner of the clone. If this returns an exception, then
-     throw that exception and abort these steps.&lt;/p&gt;&lt;/li&gt;
+      &lt;p&gt;If any of the entries in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; are
+      null, if any of the entries in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;
+      are not entangled &lt;code&gt;MessagePort&lt;/code&gt; objects, or if any
+      &lt;code&gt;MessagePort&lt;/code&gt; object is listed in &lt;var
+      title=&quot;&quot;&gt;ports&lt;/var&gt; more than once, then throw an
+      &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; be an empty array.&lt;/p&gt;
+
+      &lt;p&gt;For each port in &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt; in turn,
+      obtain a new port by &lt;span title=&quot;clone a port&quot;&gt;cloning&lt;/span&gt;
+      the port with the owner of the &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt;
+      as the owner of the clone, and append the clone to the &lt;var
+      title=&quot;&quot;&gt;new ports&lt;/var&gt; array.&lt;/p&gt;
+
+      &lt;p class=&quot;note&quot;&gt;If the original &lt;var title=&quot;&quot;&gt;ports&lt;/var&gt;
+      array was empty, then the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt; array will
+      also be empty.&lt;/p&gt;
+
+     &lt;/li&gt;
  
      &lt;li&gt;&lt;p&gt;Let the &lt;code
-     title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt; attribute
-     of the event be the &lt;var title=&quot;&quot;&gt;new data port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+     title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/code&gt;
+     attribute of the event be the &lt;var title=&quot;&quot;&gt;new ports&lt;/var&gt;
+     array.&lt;/p&gt;&lt;/li&gt;
 
     &lt;/ol&gt;
 
@@ -61944,8 +61989,9 @@
    title=&quot;&quot;&gt;message&lt;/var&gt;, the method's first argument.&lt;/p&gt;&lt;/li&gt;
  
    &lt;li&gt;&lt;p&gt;Let the &lt;code
-   title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt; attribute
-   of the event be &lt;var title=&quot;&quot;&gt;port2&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   title=&quot;dom-MessageEvent-ports&quot;&gt;ports&lt;/code&gt; attribute
+   of the event be an array containing only &lt;var
+   title=&quot;&quot;&gt;port2&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt; from the method, but
    continue with these steps.&lt;/p&gt;&lt;/li&gt;
@@ -62039,6 +62085,9 @@
   &lt;!-- we might not need to explicitly say the first part of DOM
   Events is fixed to say that events on a task queue prevent GC --&gt;
 
+  &lt;!-- XXX what about ports in the ports attribute of a MessageEvent
+  that isn't dispatched yet? --&gt;
+
   &lt;/div&gt;
 
 


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009766.html">[html5] r2884 - [e] (0) Change the term 'script's character	encoding' to be less confusing.
</A></li>
	<LI>Next message: <A HREF="009768.html">[html5] r2886 - [] (0) Add a conformance section to the WebSocket	Protocol spec (e.g. reference [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9767">[ date ]</a>
              <a href="thread.html#9767">[ thread ]</a>
              <a href="subject.html#9767">[ subject ]</a>
              <a href="author.html#9767">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
