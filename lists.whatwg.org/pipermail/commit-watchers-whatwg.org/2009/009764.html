<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r2882 - [] (0) Change the way the Web Workers spec is	generated.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2882%20-%20%5B%5D%20%280%29%20Change%20the%20way%20the%20Web%20Workers%20spec%20is%0A%09generated.&In-Reply-To=%3C20090320083631.9A87F150BB3%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009763.html">
   <LINK REL="Next"  HREF="009765.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r2882 - [] (0) Change the way the Web Workers spec is	generated.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r2882%20-%20%5B%5D%20%280%29%20Change%20the%20way%20the%20Web%20Workers%20spec%20is%0A%09generated.&In-Reply-To=%3C20090320083631.9A87F150BB3%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r2882 - [] (0) Change the way the Web Workers spec is	generated.">whatwg at whatwg.org
       </A><BR>
    <I>Fri Mar 20 01:36:31 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009763.html">[html5] r2880 - [a] (0) Clarify that the date in &lt;time&gt; elements	with no datetime='' attribute m [...]
</A></li>
        <LI>Next message: <A HREF="009765.html">[html5] r2883 - [e] (0) Integrate the specs together a bit more,	fix some legacy issues.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9764">[ date ]</a>
              <a href="thread.html#9764">[ thread ]</a>
              <a href="subject.html#9764">[ subject ]</a>
              <a href="author.html#9764">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-03-20 01:36:31 -0700 (Fri, 20 Mar 2009)
New Revision: 2882

Modified:
   source
Log:
[] (0) Change the way the Web Workers spec is generated.

Modified: source
===================================================================
--- source	2009-03-20 07:00:22 UTC (rev 2881)
+++ source	2009-03-20 08:36:31 UTC (rev 2882)
@@ -57913,6 +57913,1581 @@
 
 
 
+  &lt;h2&gt;Web Workers&lt;/h2&gt; &lt;!--START workers--&gt;
+
+  &lt;h3&gt;Introduction&lt;/h3&gt;
+
+  &lt;h4&gt;Scope&lt;/h4&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;This specification defines an API for running scripts in the
+  background independently of any user interface scripts.&lt;/p&gt;
+
+  &lt;p&gt;This allows for long-running scripts that are not interrupted by
+  scripts that respond to clicks or other user interactions, and
+  allows long tasks to be executed without yielding to keep the page
+  responsive.&lt;/p&gt;
+
+  &lt;p&gt;Workers (as these background scripts are called herein) are
+  relatively heavy-weight, and are not intended to be used in large
+  numbers. For example, it would be inappropriate to launch one worker
+  for each pixel of a four megapixel image. The examples below show
+  some appropriate uses of workers.&lt;/p&gt;
+
+  &lt;p&gt;Generally, workers are expected to be long-lived, have a high
+  start-up performance cost, and a high per-instance memory cost.&lt;/p&gt;
+
+
+  &lt;h4&gt;Tutorial&lt;/h4&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;There are a variety of uses that workers can be put to. The
+  following subsections show various examples of this use.&lt;/p&gt;
+
+  &lt;h5&gt;A background number-crunching worker&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;The simplest use of workers is for performing a computationally
+  expensive task without interrupting the user interface.&lt;/p&gt;
+
+  &lt;p&gt;In this example, the main document spawns a worker to
+  (na&iuml;vely) compute prime numbers, and progressively displays the
+  most recently found prime number.&lt;/p&gt;
+
+  &lt;p&gt;The main page is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE primes/page.html&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;code title=&quot;dom-Worker&quot;&gt;Worker()&lt;/code&gt; constructor call
+  creates a worker and returns a &lt;code&gt;Worker&lt;/code&gt; object
+  representing that worker, which is used to communicate with the
+  worker. That object's &lt;code
+  title=&quot;handler-Worker-onmessage&quot;&gt;onmessage&lt;/code&gt; event handler
+  attribute allows the code to receive messages from the worker.&lt;/p&gt;
+
+  &lt;p&gt;The worker itself is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE primes/worker.js&lt;/pre&gt;
+
+  &lt;p&gt;The bulk of this code is simply an unoptimised search for a prime
+  number. To send a message back to the page, the &lt;code
+  title=&quot;dom-DedicatedWorkerGlobalScope-postMessage&quot;&gt;postMessage()&lt;/code&gt;
+  method is used to post a message when a prime is found.&lt;/p&gt;
+
+  &lt;p&gt;&lt;a href=&quot;<A HREF="http://www.whatwg.org/demos/workers/primes/page.html">http://www.whatwg.org/demos/workers/primes/page.html</A>&quot;&gt;View this example online&lt;/a&gt;.&lt;/p&gt;
+
+
+
+  &lt;h5&gt;A worker for updating a client-side database&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;In this example, the main document spawns a worker whose only
+  task is to listen for notifications from the server, and, when
+  appropriate, either add or remove data from the client-side
+  database.&lt;/p&gt;
+
+  &lt;p&gt;Since no communication occurs between the worker and the main
+  page, the main page can start the worker by just doing:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;script&gt;
+ new Worker('worker.js');
+&lt;/script&gt;&lt;/pre&gt;
+
+  &lt;p&gt;The worker itself is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE database-updater/worker.js&lt;/pre&gt;
+
+  &lt;p&gt;This connects to the server using the &lt;code&gt;WebSocket&lt;/code&gt;
+  mechanism and opens the local database (which, we presume, has been
+  created earlier). The worker then just listens for messages from the
+  server and acts on them as appropriate, forever (or until the main
+  page is closed).&lt;/p&gt;
+
+  &lt;p&gt;&lt;a
+  href=&quot;<A HREF="http://www.whatwg.org/demos/workers/database-updater/page.html">http://www.whatwg.org/demos/workers/database-updater/page.html</A>&quot;&gt;View
+  this example online&lt;/a&gt;. (This example will not actually function,
+  since the server does not actually exist and the database is not
+  created by this sample code.)&lt;/p&gt;
+
+
+
+  &lt;h5&gt;Worker used for background I/O&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;In this example, the main document uses two workers, one for
+  fetching stock updates for at regular intervals, and one for
+  fetching performing search queries that the user requests.&lt;/p&gt;
+
+  &lt;p&gt;The main page is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE stocks/page.html&lt;/pre&gt;
+
+  &lt;p&gt;The two workers use a common library for performing the actual
+  network calls. This library is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE stocks/io.js&lt;/pre&gt;
+
+  &lt;p&gt;The stock updater worker is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE stocks/ticker.js&lt;/pre&gt;
+
+  &lt;p&gt;The search query worker is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE stocks/searcher.js&lt;/pre&gt;
+
+  &lt;p&gt;&lt;a href=&quot;<A HREF="http://www.whatwg.org/demos/workers/stocks/page.html">http://www.whatwg.org/demos/workers/stocks/page.html</A>&quot;&gt;View this example online&lt;/a&gt;.&lt;/p&gt;
+
+
+  &lt;h5&gt;Shared workers&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;In this example, multiple windows (viewers) can be opened that
+  are all viewing the same map. All the windows share the same map
+  information, with a single worker coordinating all the viewers. Each
+  viewer can move around independently, but if they set any data on
+  the map, all the viewers are updated.&lt;/p&gt;
+
+  &lt;p&gt;The main page isn't interesting, it merely provides a way to open
+  the viewers:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE multiviewer/page.html&lt;/pre&gt;
+
+  &lt;p&gt;The viewer is more involved:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE multiviewer/viewer.html&lt;/pre&gt;
+
+  &lt;p&gt;There are several key things worth noting about the way the
+  viewer is written.&lt;/p&gt;
+
+  &lt;p&gt;&lt;strong&gt;Multiple listeners&lt;/strong&gt;. Instead of a single message
+  processing function, the code here attaches multiple event
+  listeners, each one performing a quick check to see if it is
+  relevant for the message. In this example it doesn't make much
+  difference, but if multiple authors wanted to collaborate using a
+  single port to communicate with a worker, it would allow for
+  independent code instead of changes having to all be made to a
+  single event handling function.&lt;/p&gt;
+
+  &lt;p&gt;Registering event listeners in this way also allows you to
+  unregister specific listeners when you are done with them, as is
+  done with the &lt;code title=&quot;&quot;&gt;configure()&lt;/code&gt; method in this
+  example.&lt;/p&gt;
+
+  &lt;p&gt;Finally, the worker:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE multiviewer/worker.js&lt;/pre&gt;
+
+  &lt;p&gt;&lt;strong&gt;Connecting to multiple pages&lt;/strong&gt;. The script uses
+  the &lt;code
+  title=&quot;handler-SharedWorkerGlobalScope-onconnect&quot;&gt;onconnect&lt;/code&gt;
+  event listener to listen for multiple connections.&lt;/p&gt;
+
+  &lt;p&gt;&lt;strong&gt;Direct channels&lt;/strong&gt;. When the worker receives a
+  &quot;msg&quot; message from one viewer naming another viewer, it sets up a
+  direct connection between the two, so that the two viewers can
+  communicate directly without the worker having to proxy all the
+  messages.&lt;/p&gt;
+
+  &lt;p&gt;&lt;a href=&quot;<A HREF="http://www.whatwg.org/demos/workers/multiviewer/page.html">http://www.whatwg.org/demos/workers/multiviewer/page.html</A>&quot;&gt;View this example online&lt;/a&gt;.&lt;/p&gt;
+
+
+  &lt;h5&gt;Delegation&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;With multicore CPUs becoming prevalent, one way to obtain better
+  performance is to split computationally expensive tasks amongst
+  multiple workers. In this example, a computationally expensive task
+  that is to be performed for every number from 1 to 10,000,000 is
+  farmed out to ten subworkers.&lt;/p&gt;
+
+  &lt;p&gt;The main page is as follows, it just reports the result:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE primes/page.html&lt;/pre&gt;
+
+  &lt;p&gt;The worker itself is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE multicore/worker.js&lt;/pre&gt;
+
+  &lt;p&gt;It consists of a loop to start the subworkers, and then a handler
+  that waits for all the subworkers to respond.&lt;/p&gt;
+
+  &lt;p&gt;The subworkers are implemented as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE multicore/core.js&lt;/pre&gt;
+
+  &lt;p&gt;They receive two numbers in two events, perform the computation
+  for the range of numbers thus specified, and then report the result
+  back to the parent.&lt;/p&gt;
+
+  &lt;p&gt;&lt;a href=&quot;<A HREF="http://www.whatwg.org/demos/workers/multicore/page.html">http://www.whatwg.org/demos/workers/multicore/page.html</A>&quot;&gt;View this example online&lt;/a&gt;.&lt;/p&gt;
+
+
+  &lt;h5&gt;Providing libraries&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;Suppose that a cryptography library is made available that
+  provides three tasks:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;Generate a public/private key pair&lt;/dt&gt;
+
+   &lt;dd&gt;Takes a port, on which it will send two messages, first the
+   public key and then the private key.&lt;/dd&gt;
+
+   &lt;dt&gt;Given a plaintext and a public key, return the corresponding cyphertext&lt;/dt&gt;
+
+   &lt;dd&gt;Takes a port, to which any number of messages can be sent, the
+   first giving the public key, and the remainder giving the
+   plaintext, each of which is encrypted and then sent on that same
+   channel as the cyphertext. The user can close the port when it is
+   done encrypting content.&lt;/dd&gt;
+
+   &lt;dt&gt;Given a cyphertext and a private key, return the corresponding plaintext&lt;/dt&gt;
+
+   &lt;dd&gt;Takes a port, to which any number of messages can be sent, the
+   first giving the private key, and the remainder giving the
+   cyphertext, each of which is decrypted and then sent on that same
+   channel as the plaintext. The user can close the port when it is
+   done decrypting content.&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;p&gt;The library itself is as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE crypto/libcrypto-v1.js&lt;/pre&gt;
+
+  &lt;p&gt;Note that the crypto functions here are just stubs and don't do
+  real cryptography.&lt;/p&gt;
+
+  &lt;p&gt;This library could be used as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE crypto/page.html&lt;/pre&gt;
+
+  &lt;p&gt;A later version of the API, though, might want to offload all the
+  crypto work onto subworkers. This could be done as follows:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE crypto/libcrypto-v2.js&lt;/pre&gt;
+
+  &lt;p&gt;The little subworkers would then be as follows.&lt;/p&gt;
+
+  &lt;p&gt;For generating key pairs:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE crypto/libcrypto-v2-generator.js&lt;/pre&gt;
+
+  &lt;p&gt;For encrypting:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE crypto/libcrypto-v2-encryptor.js&lt;/pre&gt;
+
+  &lt;p&gt;For decrypting:&lt;/p&gt;
+
+  &lt;pre&gt;EXAMPLE crypto/libcrypto-v2-decryptor.js&lt;/pre&gt;
+
+  &lt;p&gt;Notice how the users of the API don't have to even know that this
+  is happening &mdash; the API hasn't changed; the library can
+  delegate to subworkers without changing its API, even though it is
+  accepting data using message channels.&lt;/p&gt;
+
+  &lt;p&gt;&lt;a href=&quot;<A HREF="http://www.whatwg.org/demos/workers/crypto/page.html">http://www.whatwg.org/demos/workers/crypto/page.html</A>&quot;&gt;View this example online&lt;/a&gt;.&lt;/p&gt;
+
+
+
+  &lt;h4&gt;Conformance requirements&lt;/h4&gt;
+
+  &lt;p&gt;All diagrams, examples, and notes in this specification are
+  non-normative, as are all sections explicitly marked non-normative.
+  Everything else in this specification is normative.&lt;/p&gt;
+
+  &lt;p&gt;The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &lt;!--&quot;SHALL&quot;, &quot;SHALL
+  NOT&quot;,--&gt; &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and
+  &quot;OPTIONAL&quot; in the normative parts of this document are to be
+  interpreted as described in RFC2119. For readability, these words do
+  not appear in all uppercase letters in this specification. &lt;a
+  href=&quot;#refsRFC2119&quot;&gt;[RFC2119]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;Requirements phrased in the imperative as part of algorithms
+  (such as &quot;strip any leading space characters&quot; or &quot;return false and
+  abort these steps&quot;) are to be interpreted with the meaning of the
+  key word (&quot;must&quot;, &quot;should&quot;, &quot;may&quot;, etc) used in introducing the
+  algorithm.&lt;/p&gt;
+
+  &lt;p&gt;Some conformance requirements are phrased as requirements on
+  attributes, methods or objects. Such requirements are to be
+  interpreted as requirements on user agents.&lt;/p&gt;
+
+  &lt;p&gt;Conformance requirements phrased as algorithms or specific steps
+  may be implemented in any manner, so long as the end result is
+  equivalent. (In particular, the algorithms defined in this
+  specification are intended to be easy to follow, and not intended to
+  be performant.)&lt;/p&gt;
+
+  &lt;p&gt;The only conformance class defined by this specification is user
+  agents.&lt;/p&gt;
+
+  &lt;p&gt;User agents may impose implementation-specific limits on
+  otherwise unconstrained inputs, e.g. to prevent denial of service
+  attacks, to guard against running out of memory, or to work around
+  platform-specific limitations.&lt;/p&gt;
+
+
+  &lt;h5&gt;Dependencies&lt;/h5&gt;
+
+  &lt;p&gt;This specification relies on several other underlying
+  specifications.&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;HTML5&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Many fundamental concepts from HTML5 are used by this
+    specification. &lt;a href=&quot;#refsHTML5&quot;&gt;[HTML5]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;ECMAScript&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This specification is intended to be used with JavaScript as
+    the scripting language. &lt;a href=&quot;#refsJS&quot;&gt;[JS]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;WebIDL&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The IDL blocks in this specification use the semantics of the
+    WebIDL specification. &lt;a href=&quot;#refsWebIDL&quot;&gt;[WebIDL]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+
+  &lt;h4&gt;Terminology&lt;/h4&gt;
+
+  &lt;p&gt;The construction &quot;a &lt;code title=&quot;&quot;&gt;Foo&lt;/code&gt; object&quot;, where
+  &lt;code title=&quot;&quot;&gt;Foo&lt;/code&gt; is actually an interface, is sometimes
+  used instead of the more accurate &quot;an object implementing the
+  interface &lt;code title=&quot;&quot;&gt;Foo&lt;/code&gt;&quot;.&lt;/p&gt;
+
+  &lt;p&gt;The term DOM is used to refer to the API set made available to
+  scripts in Web applications, and does not necessarily imply the
+  existence of an actual &lt;code&gt;Document&lt;/code&gt; object or of any other
+  &lt;code&gt;Node&lt;/code&gt; objects as defined in the DOM Core
+  specifications. &lt;a href=&quot;#refsDOM3CORE&quot;&gt;[DOM3CORE]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;A DOM attribute is said to be &lt;em&gt;getting&lt;/em&gt; when its value is
+  being retrieved (e.g. by author script), and is said to be
+  &lt;em&gt;setting&lt;/em&gt; when a new value is assigned to it.&lt;/p&gt;
+
+
+
+  &lt;h3&gt;Infrastructure&lt;/h3&gt;
+
+  &lt;p&gt;There are two kinds of workers; dedicated workers, and shared
+  workers. Dedicated workers, once created, and are linked to their
+  creator; but message ports can be used to communicate from a
+  dedicated worker to multiple other browsing contexts or
+  workers. Shared workers, on the other hand, are named, and once
+  created any script running in the same &lt;span&gt;origin&lt;/span&gt; can
+  obtain a reference to that worker and communicate with it.&lt;/p&gt;
+
+
+  &lt;h4&gt;The global scope&lt;/h4&gt;
+
+  &lt;p&gt;The global scope is the &quot;inside&quot; of a worker.&lt;/p&gt;
+
+  &lt;h5&gt;The &lt;code&gt;WorkerGlobalScope&lt;/code&gt; abstract interface&lt;/h5&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;WorkerGlobalScope&lt;/dfn&gt; {
+  readonly attribute &lt;span&gt;WorkerGlobalScope&lt;/span&gt; &lt;span title=&quot;dom-WorkerGlobalScope-self&quot;&gt;self&lt;/span&gt;;
+  readonly attribute &lt;span&gt;WorkerLocation&lt;/span&gt; &lt;span title=&quot;dom-WorkerGlobalScope-location&quot;&gt;location&lt;/span&gt;;
+  // also implements everything on &lt;span&gt;WorkerUtils&lt;/span&gt;
+
+  void &lt;span title=&quot;dom-WorkerGlobalScope-close&quot;&gt;close&lt;/span&gt;();
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-WorkerGlobalScope-onclose&quot;&gt;onclose&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-WorkerGlobalScope-onerror&quot;&gt;onerror&lt;/span&gt;;
+};&lt;/pre&gt;
+
+  &lt;p&gt;Objects implementing the &lt;code&gt;WorkerGlobalScope&lt;/code&gt; interface
+  must also implement the &lt;code&gt;EventTarget&lt;/code&gt; interface.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-WorkerGlobalScope-self&quot;&gt;&lt;code&gt;self&lt;/code&gt;&lt;/dfn&gt; attribute
+  must return the &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object itself.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-WorkerGlobalScope-location&quot;&gt;&lt;code&gt;location&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the &lt;code&gt;WorkerLocation&lt;/code&gt; object created
+  for the &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object when the worker was
+  created. It represents the &lt;span&gt;absolute URL&lt;/span&gt; of the script
+  that was used to initialize the worker.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When a script invokes the &lt;dfn
+  title=&quot;dom-WorkerGlobalScope-close&quot;&gt;&lt;code&gt;close()&lt;/code&gt;&lt;/dfn&gt; method on
+  a &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object, the user agent must run the
+  following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to &lt;span&gt;fire a simple
+   event&lt;/span&gt; called &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt; at the
+   &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set the worker's &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object's
+   &lt;span title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag to
+   true.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each &lt;code&gt;MessagePort&lt;/code&gt; object that is entangled
+   with another port and that has one (but only one) port whose owner
+   is the &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object on which the method
+   was invoked (this would include, for instance, the implicit port in
+   used for dedicated workers), unentangle the two ports.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;The following are the &lt;span&gt;event handler DOM attributes&lt;/span&gt;
+  that must be supported by objects implementing the
+  &lt;code&gt;WorkerGlobalScope&lt;/code&gt; interface:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-WorkerGlobalScope-onclose&quot;&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever a &lt;code
+   title=&quot;event-close&quot;&gt;close&lt;/code&gt; event is targeted at or bubbles
+   through the &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-WorkerGlobalScope-onerror&quot;&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-error&quot;&gt;error&lt;/code&gt; event is targeted at or bubbles
+   through the &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+
+  &lt;h5&gt;Dedicated workers and the &lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt; interface&lt;/h5&gt;
+
+  &lt;!-- the XXX below is for collapsing this interface onto WorkerGlobalScope so it looks like just one interface - the inheritance is a spec fiction only --&gt;
+  &lt;pre class=&quot;idl&quot;&gt;[NoInterfaceObject, XXX] interface &lt;dfn&gt;DedicatedWorkerGlobalScope&lt;/dfn&gt; : &lt;span&gt;WorkerGlobalScope&lt;/span&gt; {
+  void &lt;span title=&quot;dom-DedicatedWorkerGlobalScope-postMessage&quot;&gt;postMessage&lt;/span&gt;(in any message, [Optional] in &lt;span&gt;MessagePort&lt;/span&gt; messagePort);&lt;!--
+  &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-DedicatedWorkerGlobalScope-startConversation&quot;&gt;startConversation&lt;/span&gt;(in any message);--&gt;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-DedicatedWorkerGlobalScope-onmessage&quot;&gt;onmessage&lt;/span&gt;;
+};&lt;/pre&gt;
+
+  &lt;p&gt;&lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt; objects act as if they
+  had an implicit &lt;code&gt;MessagePort&lt;/code&gt; associated with them. This
+  port is part of a channel that is set up when the worker is created,
+  but it is not exposed. This object must never be garbage collected
+  before the &lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;p&gt;All messages received by that port must immediately be
+  retargetted at the &lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DedicatedWorkerGlobalScope-postMessage&quot;&gt;&lt;code&gt;postMessage()&lt;/code&gt;&lt;/dfn&gt;&lt;!--
+  and &lt;dfn
+  title=&quot;dom-DedicatedWorkerGlobalScope-startConversation&quot;&gt;&lt;code&gt;startConversation()&lt;/code&gt;&lt;/dfn&gt;--&gt;
+  method&lt;!--s (startConversation)--&gt; on
+  &lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt; objects must act as if, when
+  invoked, it&lt;!--/they (startConversation)--&gt; immediately invoked the
+  method of the same name on the port, with the same arguments, and
+  returned the same return value.&lt;/p&gt;
+
+  &lt;p&gt;The following are the &lt;span&gt;event handler DOM attributes&lt;/span&gt;
+  that must be supported by objects implementing the
+  &lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt; interface:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-DedicatedWorkerGlobalScope-onmessage&quot;&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever a &lt;code
+   title=&quot;event-DedicatedWorkerGlobalScope-message&quot;&gt;message&lt;/code&gt; event is targeted
+   at or bubbles through the &lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+
+
+  &lt;h5&gt;Shared workers and the &lt;code&gt;SharedWorkerGlobalScope&lt;/code&gt; inteface&lt;/h5&gt;
+
+  &lt;!-- the XXX below is for collapsing this interface onto WorkerGlobalScope so it looks like just one interface - the inheritance is a spec fiction only --&gt;
+  &lt;pre class=&quot;idl&quot;&gt;[NoInterfaceObject, XXX] interface &lt;dfn&gt;SharedWorkerGlobalScope&lt;/dfn&gt; : &lt;span&gt;WorkerGlobalScope&lt;/span&gt; {
+  readonly attribute DOMString &lt;span title=&quot;dom-SharedWorkerGlobalScope-name&quot;&gt;name&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-SharedWorkerGlobalScope-onconnect&quot;&gt;onconnect&lt;/span&gt;;
+};&lt;/pre&gt;
+
+  &lt;p&gt;Shared workers receive message ports through &lt;code
+  title=&quot;event-WorkerGlobalScope-connect&quot;&gt;connect&lt;/code&gt; events on
+  their global object for each connection.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-SharedWorkerGlobalScope-name&quot;&gt;&lt;code&gt;name&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the value it was assigned when the
+  &lt;code&gt;SharedWorkerGlobalScope&lt;/code&gt; object was created by the
+  &quot;&lt;span&gt;run a worker&lt;/span&gt;&quot; algorithm. Its value represents the name
+  that can be used to obtain a reference to the worker using the
+  &lt;code&gt;SharedWorker&lt;/code&gt; constructor.&lt;/p&gt;
+
+  &lt;p&gt;The following are the &lt;span&gt;event handler DOM attributes&lt;/span&gt;
+  that must be supported by objects implementing the
+  &lt;code&gt;SharedWorkerGlobalScope&lt;/code&gt; interface:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-SharedWorkerGlobalScope-onconnect&quot;&gt;&lt;code&gt;onconnect&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever a &lt;code
+   title=&quot;event-SharedWorkerGlobalScope-connect&quot;&gt;connect&lt;/code&gt; event is targeted
+   at or bubbles through the &lt;code&gt;SharedWorkerGlobalScope&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+
+  &lt;h4&gt;Base URLs and origins of workers&lt;/h4&gt;
+
+  &lt;p&gt;Both the &lt;span&gt;origin&lt;/span&gt; and &lt;span&gt;effective script
+  origin&lt;/span&gt; of scripts running in workers are the
+  &lt;span&gt;origin&lt;/span&gt; of the &lt;span&gt;absolute URL&lt;/span&gt; given in that
+  the worker's &lt;code
+  title=&quot;dom-WorkerGlobalScope-location&quot;&gt;location&lt;/code&gt; attribute
+  represents.&lt;/p&gt;
+
+
+  &lt;h4&gt;The event loop&lt;/h4&gt;
+
+  &lt;p&gt;Each &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object is asssociated with a
+  &lt;span&gt;event loop&lt;/span&gt;. This &lt;span&gt;event loop&lt;/span&gt; has no
+  associated &lt;span&gt;browsing context&lt;/span&gt;, and its &lt;span title=&quot;task
+  queue&quot;&gt;task queues&lt;/span&gt; only have events, callbacks, and
+  networking activity as &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt;. The
+  processing model of these &lt;span title=&quot;event loop&quot;&gt;event
+  loops&lt;/span&gt; is defined below in the &lt;span&gt;run a worker&lt;/span&gt;
+  algorithm.&lt;/p&gt;
+
+  &lt;p&gt;Each &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object also has a &lt;dfn
+  title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/dfn&gt; flag, which must
+  initially be false, but which can get set to true by the algorithms
+  in the processing model section below.&lt;/p&gt;
+
+  &lt;p&gt;Once the &lt;code&gt;WorkerGlobalScope&lt;/code&gt;'s &lt;span
+  title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag is set to
+  true, the &lt;span&gt;event loop&lt;/span&gt;'s &lt;span title=&quot;task queue&quot;&gt;task
+  queues&lt;/span&gt; must discard any further &lt;span
+  title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; that would be added to them (tasks
+  already on the queue are unaffected unless otherwise
+  specified). Effectively, once the &lt;span
+  title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag is true,
+  timers stop firing, notifications for all pending asynchronous
+  operations are dropped, etc.&lt;/p&gt;
+
+
+  &lt;h4&gt;The worker's ports&lt;/h4&gt;
+
+  &lt;p&gt;Workers communicate with other workers and with &lt;span
+  title=&quot;browsing context&quot;&gt;browsing contexts&lt;/span&gt; through &lt;span
+  title=&quot;channel messaging&quot;&gt;message channels&lt;/span&gt; and their
+  &lt;code&gt;MessagePort&lt;/code&gt; objects.&lt;/p&gt;
+
+  &lt;p&gt;Each &lt;code&gt;WorkerGlobalScope&lt;/code&gt; &lt;var title=&quot;&quot;&gt;worker global
+  scope&lt;/var&gt; has a list of &lt;dfn&gt;the worker's ports&lt;/dfn&gt;, which
+  consists of all the &lt;code&gt;MessagePort&lt;/code&gt; objects that are
+  entangled with another port and that have one (but only one) port
+  owned by &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;. This list includes
+  &lt;!--all the &lt;code&gt;MessagePort&lt;/code&gt; objects that are in events
+  pending in the &lt;span&gt;event loop&lt;/span&gt;, as well as (commented out
+  because in practice it makes no difference either way as far as I
+  can tell, and it would be hard to strictly implement since these
+  ports might not yet be across the thread boundary)--&gt; the implicit
+  &lt;code&gt;MessagePort&lt;/code&gt; in the case of &lt;span
+  title=&quot;DedicatedWorkerGlobalScope&quot;&gt;dedicated workers&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;A worker is said to be a &lt;dfn&gt;permissible worker&lt;/dfn&gt; if
+  either:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;at some point past or present a &lt;code&gt;MessagePort&lt;/code&gt; owned
+   by the worker was entangled with a &lt;code&gt;MessagePort&lt;/code&gt; &lt;var
+   title=&quot;&quot;&gt;p&lt;/var&gt; whose owner is a &lt;code&gt;Window&lt;/code&gt; object whose
+   &lt;span&gt;active document&lt;/span&gt; is the &lt;code&gt;Document&lt;/code&gt; that was
+   that &lt;span&gt;browsing context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt;
+   when &lt;var title=&quot;&quot;&gt;p&lt;/var&gt; was created, and that
+   &lt;code&gt;Document&lt;/code&gt; is &lt;span&gt;fully active&lt;/span&gt;, or&lt;/li&gt;
+
+   &lt;li&gt;at some point past or present a &lt;code&gt;MessagePort&lt;/code&gt; owned
+   by the worker was entangled with a &lt;code&gt;MessagePort&lt;/code&gt; owned
+   by another worker that is currently a &lt;span&gt;permissible
+   worker&lt;/span&gt;.&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;A worker is said to be a &lt;dfn&gt;protected worker&lt;/dfn&gt; if
+  either:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;it has outstanding timers, database transactions, or network
+   connections, and is a &lt;span&gt;permissible worker&lt;/span&gt;, or&lt;/li&gt;
+
+   &lt;li&gt;there is a &lt;span&gt;protected worker&lt;/span&gt; that at some point
+   past or present owned a &lt;code&gt;MessagePort&lt;/code&gt; that was entangled
+   with a &lt;code&gt;MessagePort&lt;/code&gt; owned by this worker.&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;A worker is said to be an &lt;dfn&gt;active needed worker&lt;/dfn&gt; if either:
+
+  &lt;ul&gt;
+
+   &lt;li&gt;the worker is a &lt;span&gt;protected worker&lt;/span&gt;, or&lt;/li&gt;
+
+   &lt;li&gt;at least one of the &lt;span&gt;the worker's ports&lt;/span&gt; is
+   entangled with a &lt;code&gt;MessagePort&lt;/code&gt; &lt;var title=&quot;&quot;&gt;p&lt;/var&gt;
+   whose owner is a &lt;code&gt;Window&lt;/code&gt; object whose &lt;span&gt;active
+   document&lt;/span&gt; is the &lt;code&gt;Document&lt;/code&gt; that was that
+   &lt;span&gt;browsing context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt; when
+   that &lt;code&gt;MessagePort&lt;/code&gt; &lt;var title=&quot;&quot;&gt;p&lt;/var&gt; was created,
+   and that &lt;code&gt;Document&lt;/code&gt; is &lt;span&gt;fully active&lt;/span&gt;,
+   or&lt;/li&gt;
+
+   &lt;li&gt;at least one of the &lt;span&gt;the worker's ports&lt;/span&gt; has an
+   entangled &lt;code&gt;MessagePort&lt;/code&gt; owned by a
+   &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object that is itself an
+   &lt;span&gt;active needed worker&lt;/span&gt;.&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;A worker is said to be a &lt;dfn&gt;suspendable worker&lt;/dfn&gt; if it is
+  not an &lt;span&gt;active needed worker&lt;/span&gt; but either:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;at least one of the &lt;span&gt;the worker's ports&lt;/span&gt; has an
+   entangled &lt;code&gt;MessagePort&lt;/code&gt; owned by a &lt;code&gt;Window&lt;/code&gt;
+   object, or&lt;/li&gt;
+
+   &lt;li&gt;at least one of the &lt;span&gt;the worker's ports&lt;/span&gt; has an
+   entangled &lt;code&gt;MessagePort&lt;/code&gt; owned by a
+   &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object that is itself a &lt;span&gt;needed
+   worker&lt;/span&gt;.&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+
+  &lt;h4&gt;Processing model&lt;/h4&gt;
+
+  &lt;p&gt;When a user agent is to &lt;dfn&gt;run a worker&lt;/dfn&gt; for a script with
+  &lt;span&gt;URL&lt;/span&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, a browsing context &lt;var
+  title=&quot;&quot;&gt;owner browsing context&lt;/var&gt;, and with global scope &lt;var
+  title=&quot;&quot;&gt;worker global scope&lt;/var&gt;, it must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Create a completely separate and parallel execution environment
+    (i.e. a separate thread or process or equivalent construct), and
+    run the rest of these steps asychronously in that context.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Attempt to &lt;span&gt;fetch&lt;/span&gt; the resource identified by &lt;var
+    title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the attempt fails, then for each &lt;code&gt;Worker&lt;/code&gt; or
+    &lt;code&gt;SharedWorker&lt;/code&gt; object associated with &lt;var
+    title=&quot;&quot;&gt;worker global scope&lt;/var&gt;, &lt;span&gt;queue a task&lt;/span&gt; to
+    &lt;span&gt;fire a simple event&lt;/span&gt; called &lt;code
+    title=&quot;event-error&quot;&gt;error&lt;/code&gt; at that object. Abort these
+    steps.&lt;/p&gt;
+
+    &lt;p&gt;If the attempt succeeds, then let &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; be
+    the text of the resource that was obtained.&lt;/p&gt;&lt;!-- XXX do we need
+    to define character encoding decoding here? --&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;language&lt;/var&gt; be JavaScript.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;As with &lt;code&gt;script&lt;/code&gt; elements, the MIME
+    type of the script is ignored. Unlike with &lt;code&gt;script&lt;/code&gt;
+    elements, there is no way to override the type. It's always
+    assumed to be JavaScript.&lt;/p&gt; &lt;!-- XXX people will complain about
+    this. I guess we might want to examine the MIME type... --&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;A new &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; is now
+    created, as follows.&lt;/p&gt;
+
+    &lt;p&gt;Create a new &lt;span&gt;script execution environment&lt;/span&gt;
+    set up as appropriate for the scripting language &lt;var
+    title=&quot;&quot;&gt;language&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Parse/compile/initialize &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; using that
+    &lt;span&gt;script execution environment&lt;/span&gt;, as appropriate for &lt;var
+    title=&quot;&quot;&gt;language&lt;/var&gt;, and thus obtain a &lt;span&gt;list of code
+    entry-points&lt;/span&gt;; set the &lt;i&gt;initial code entry-point&lt;/i&gt; to
+    the entry-point for any executable code to be immediately run.&lt;/p&gt;
+
+    &lt;p&gt;Set the &lt;span&gt;script's global object&lt;/span&gt; to &lt;var
+    title=&quot;&quot;&gt;worker global scope&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Set the &lt;span&gt;script's browsing context&lt;/span&gt; to &lt;var
+    title=&quot;&quot;&gt;owner browsing context&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Set the &lt;span&gt;script's character encoding&lt;/span&gt; to
+    UTF-8. (This is just used for encoding non-ASCII characters in the
+    query component of URLs.)&lt;/p&gt;
+
+    &lt;p&gt;Set the &lt;span&gt;script's base URL&lt;/span&gt; to &lt;var
+    title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Create a new &lt;span&gt;script group&lt;/span&gt; and add the &lt;span
+    title=&quot;concept-script&quot;&gt;script&lt;/span&gt; to it.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;strong&gt;Closing orphan workers&lt;/strong&gt;: Start monitoring the
+    worker such that as soon as it stops being either an &lt;span&gt;active
+    needed worker&lt;/span&gt; or a &lt;span&gt;suspendable worker&lt;/span&gt;, &lt;var
+    title=&quot;&quot;&gt;worker global scope&lt;/var&gt;'s &lt;span
+    title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag is set
+    to true and &lt;span title=&quot;queue a task&quot;&gt;a task is queued&lt;/span&gt; to
+    &lt;span&gt;fire a simple event&lt;/span&gt; called &lt;code
+    title=&quot;event-close&quot;&gt;close&lt;/code&gt; at &lt;var title=&quot;&quot;&gt;worker global
+    scope&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;strong&gt;Suspending workers&lt;/strong&gt;: Start monitoring the
+    worker, such that whenever &lt;var title=&quot;&quot;&gt;worker global
+    scope&lt;/var&gt;'s &lt;span
+    title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag is false
+    and the worker is a &lt;span&gt;suspendable worker&lt;/span&gt;, the user
+    agent suspends execution of script in that worker until such time
+    as either the &lt;span
+    title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag switches
+    to true or the worker stops being a &lt;span&gt;suspendable
+    worker&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span title=&quot;jump to a code entry-point&quot;&gt;Jump&lt;/span&gt; to the
+    &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt;'s &lt;i&gt;initial code
+    entry-point&lt;/i&gt;, and let that run until it either returns, fails
+    to catch an exception, or gets prematurely aborted by the
+    &quot;&lt;span&gt;kill a worker&lt;/span&gt;&quot; or &quot;&lt;span&gt;terminate a worker&lt;/span&gt;&quot;
+    algorithms defined below.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;If the script gets aborted by the &quot;&lt;span&gt;kill a
+    worker&lt;/span&gt;&quot; algorithm, then that same algorithm will cause
+    there to only be a single &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt;
+    in the &lt;span&gt;event loop&lt;/span&gt; at the next step, namely the task
+    for the &lt;code title=&quot;message-close&quot;&gt;close&lt;/code&gt; event. The
+    &quot;&lt;span&gt;terminate a worker&lt;/span&gt;&quot; algorithm removes all the
+    events.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;i title=&quot;&quot;&gt;Event loop&lt;/i&gt;: Wait until either there is a &lt;span
+    title=&quot;concept-task&quot;&gt;task&lt;/span&gt; in one of the &lt;span&gt;event
+    loop&lt;/span&gt;'s &lt;span title=&quot;task queue&quot;&gt;task queues&lt;/span&gt; or &lt;var
+    title=&quot;&quot;&gt;worker global scope&lt;/var&gt;'s &lt;span
+    title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag is set
+    to true.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Run the oldest task on one of the &lt;span&gt;event loop&lt;/span&gt;'s
+    &lt;span title=&quot;task queue&quot;&gt;task queues&lt;/span&gt;, if any. The user
+    agent may pick any &lt;span&gt;task queue&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;The handling of events or the execution of
+    callbacks might get prematurely aborted by the &quot;&lt;span&gt;kill a
+    worker&lt;/span&gt;&quot; or &quot;&lt;span&gt;terminate a worker&lt;/span&gt;&quot; algorithms
+    defined below.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Remove the task run in the previous step, if any, from its
+    &lt;span&gt;task queue&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there are any more events in the &lt;span&gt;event loop&lt;/span&gt;'s
+    &lt;span title=&quot;task queue&quot;&gt;task queues&lt;/span&gt; or if &lt;var
+    title=&quot;&quot;&gt;worker global scope&lt;/var&gt;'s &lt;span
+    title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag is set
+    to false, then jump back to the step above labeled &lt;i&gt;event
+    loop&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Freeze the &lt;span&gt;script group&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;This kills timers, database transactions, etc.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each &lt;code&gt;Worker&lt;/code&gt; or &lt;code&gt;SharedWorker&lt;/code&gt;
+    object associated with &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;,
+    &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire a simple event&lt;/span&gt;
+    called &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt; at that object.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+ 
+  &lt;p&gt;When a user agent is to &lt;dfn&gt;kill a worker&lt;/dfn&gt; it must
+  run the following steps in parallel with the worker's main loop (the
+  &quot;&lt;span&gt;run a worker&lt;/span&gt;&quot; processing model defined above):&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the worker's &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object's
+   &lt;span title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag is
+   false, &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire a simple
+   event&lt;/span&gt; called &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt; at the
+   worker's &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set the worker's &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object's &lt;span
+   title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag to
+   true.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Wait a user-agent-defined amount of time. If the &quot;&lt;span&gt;run
+   a worker&lt;/span&gt;&quot; processing model defined above immediately starts
+   running event listeners registered for the &lt;code
+   title=&quot;event-close&quot;&gt;close&lt;/code&gt; event, this time should not be
+   zero &mdash; the idea is that the &lt;code
+   title=&quot;event-close&quot;&gt;close&lt;/code&gt; event can be used to clean up
+   when shutting down unexpectedly.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If there are any &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt;
+   queued in the &lt;span&gt;event loop&lt;/span&gt;'s &lt;span title=&quot;task
+   queue&quot;&gt;task queues&lt;/span&gt; other than the &lt;code
+   title=&quot;event-close&quot;&gt;close&lt;/code&gt; event that this algorithm just
+   added, discard them without processing them.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt; event that
+   this algorithm just queued hasn't yet been dispatched, then abort
+   the script currently running in the worker.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Wait a user-agent-defined amount of time.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Abort the script currently running in the worker (if any
+   script is running, then it will be a handler for the &lt;code
+   title=&quot;event-close&quot;&gt;close&lt;/code&gt; event).&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;User agents may invoke the &quot;&lt;span&gt;kill a worker&lt;/span&gt;&quot;
+  processing model on a worker at any time, e.g. in response to user
+  requests, in response to CPU quota management, or when a worker
+  stops being an &lt;span&gt;active needed worker&lt;/span&gt; if the worker
+  continues executing even after its &lt;span
+  title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag was
+  set to true.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When a user agent is to &lt;dfn&gt;terminate a worker&lt;/dfn&gt; it must run
+  the following steps in parallel with the worker's main loop (the
+  &quot;&lt;span&gt;run a worker&lt;/span&gt;&quot; processing model defined above):&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Set the worker's &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object's
+   &lt;span title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt; flag to
+   true.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If there are any &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt;
+   queued in the &lt;span&gt;event loop&lt;/span&gt;'s &lt;span title=&quot;task
+   queue&quot;&gt;task queues&lt;/span&gt;, discard them without processing
+   them.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Abort the script currently running in the worker.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the worker's &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object is
+   actually a &lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt; object (i.e. the
+   worker is a dedicated worker), then empty the &lt;span&gt;port message
+   queue&lt;/span&gt; of the port that the worker's implicit port is
+   entangled with.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+  &lt;h5&gt;Runtime script errors&lt;/h5&gt;
+
+  &lt;p&gt;Whenever a runtime script error occurs in one of the worker's
+  scripts, if the error did not occur while handling a previous script
+  error, the user agent must &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire
+  an error event&lt;/span&gt; at the the &lt;code&gt;WorkerGlobalScope&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;For shared workers, if the error is still &lt;i title=&quot;&quot;&gt;not
+  handled&lt;/i&gt; afterwards, or if the error occured while handling a
+  previous script error, the error should be reported to the user.&lt;/p&gt;
+
+  &lt;p&gt;For dedicated workers, if the error is still &lt;i title=&quot;&quot;&gt;not
+  handled&lt;/i&gt; afterwards, or if the error occured while handling a
+  previous script error, the user agent must further &lt;span&gt;queue a
+  task&lt;/span&gt; to &lt;span&gt;fire an error event&lt;/span&gt; at the
+  &lt;code&gt;Worker&lt;/code&gt; object associated with the worker.&lt;/p&gt;
+
+  &lt;p&gt;When the user agent is to &lt;dfn&gt;fire an error event&lt;/dfn&gt; at a
+  &lt;code&gt;Worker&lt;/code&gt; object, it must dispatch an event that uses the
+  &lt;code&gt;ErrorEvent&lt;/code&gt; interface, with the name &lt;code
+  title=&quot;event-error&quot;&gt;error&lt;/code&gt;, that doesn't bubble and is
+  cancelable, with its &lt;code
+  title=&quot;dom-ErrorEvent-message&quot;&gt;message&lt;/code&gt;, &lt;code
+  title=&quot;dom-ErrorEvent-filename&quot;&gt;filename&lt;/code&gt;, and &lt;code
+  title=&quot;dom-ErrorEvent-lineno&quot;&gt;lineno&lt;/code&gt; attributes set
+  appropriately. The default action of this event depends on whether
+  the &lt;code&gt;Worker&lt;/code&gt; object is itself in a worker. If it is, and
+  that worker is also a dedicated worker, then the user agent must
+  again &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire an error event&lt;/span&gt;
+  at the &lt;code&gt;Worker&lt;/code&gt; object associated with &lt;em&gt;that&lt;/em&gt;
+  worker. Otherwise, then the error should be reported to the
+  user.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;ErrorEvent&lt;/dfn&gt; : Event {
+  readonly attribute DOMObject &lt;span title=&quot;dom-ErrorEvent-message&quot;&gt;message&lt;/span&gt;;
+  readonly attribute DOMObject &lt;span title=&quot;dom-ErrorEvent-filename&quot;&gt;filename&lt;/span&gt;;
+  readonly attribute unsigned long &lt;span title=&quot;dom-ErrorEvent-lineno&quot;&gt;lineno&lt;/span&gt;;
+  void &lt;span title=&quot;dom-ErrorEvent-initErrorEvent&quot;&gt;initErrorEvent&lt;/span&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMObject messageArg, in DOMObject filenameArg, in unsigned long linenoArg);
+  void &lt;span title=&quot;dom-ErrorEvent-initErrorEventNS&quot;&gt;initErrorEventNS&lt;/span&gt;(in DOMString namespaceURIArg, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMObject messageArg, in DOMObject filenameArg, in unsigned long linenoArg);
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-ErrorEvent-initErrorEvent&quot;&gt;&lt;code&gt;initErrorEvent()&lt;/code&gt;&lt;/dfn&gt;
+  and &lt;dfn
+  title=&quot;dom-ErrorEvent-initErrorEventNS&quot;&gt;&lt;code&gt;initErrorEventNS()&lt;/code&gt;&lt;/dfn&gt;
+  methods must initialize the event in a manner analogous to the
+  similarly-named methods in the DOM3 Events interfaces. &lt;a
+  href=&quot;#refsDOM3EVENTS&quot;&gt;[DOM3EVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-ErrorEvent-message&quot;&gt;&lt;code&gt;message&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents the error message.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-ErrorEvent-filename&quot;&gt;&lt;code&gt;filename&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents the &lt;span&gt;absolute URL&lt;/span&gt; of the script in
+  which the error originally occured.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-ErrorEvent-lineno&quot;&gt;&lt;code&gt;lineno&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents the line number where the error occured in the
+  script.&lt;/p&gt;
+
+
+
+  &lt;h4&gt;Creating workers&lt;/h4&gt;
+
+  &lt;h5&gt;The &lt;code&gt;AbstractWorker&lt;/code&gt; abstract interface&lt;/h5&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;AbstractWorker&lt;/dfn&gt; {
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-AbstractWorker-onerror&quot;&gt;onerror&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-AbstractWorker-onclose&quot;&gt;onclose&lt;/span&gt;;
+};&lt;/pre&gt;
+
+  &lt;p&gt;Objects implementing the &lt;code&gt;AbstractWorker&lt;/code&gt; interface
+  must also implement the &lt;code&gt;EventTarget&lt;/code&gt; interface.&lt;/p&gt;
+
+  &lt;p&gt;The following are the &lt;span&gt;event handler DOM attributes&lt;/span&gt;
+  that must be supported by objects implementing the
+  &lt;code&gt;AbstractWorker&lt;/code&gt; interface:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-AbstractWorker-onerror&quot;&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-error&quot;&gt;error&lt;/code&gt; event is targeted at or bubbles
+   through the &lt;code&gt;AbstractWorker&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-AbstractWorker-onclose&quot;&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-close&quot;&gt;close&lt;/code&gt; event is targeted at or bubbles
+   through the &lt;code&gt;AbstractWorker&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+
+
+  &lt;h5&gt;Dedicated workers and the &lt;code&gt;Worker&lt;/code&gt; interface&lt;/h5&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;[&lt;span title=&quot;dom-Worker&quot;&gt;Constructor&lt;/span&gt;(in DOMString scriptURL)]
+interface &lt;dfn&gt;Worker&lt;/dfn&gt; : &lt;span&gt;AbstractWorker&lt;/span&gt; {
+  void &lt;span title=&quot;dom-Worker-terminate&quot;&gt;terminate&lt;/span&gt;();
+
+  void &lt;span title=&quot;dom-Worker-postMessage&quot;&gt;postMessage&lt;/span&gt;(in any message, [Optional] in &lt;span&gt;MessagePort&lt;/span&gt; messagePort);&lt;!--
+  &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-Worker-startConversation&quot;&gt;startConversation&lt;/span&gt;(in any message);--&gt;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-Worker-onmessage&quot;&gt;onmessage&lt;/span&gt;;
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-Worker-terminate&quot;&gt;&lt;code&gt;terminate()&lt;/code&gt;&lt;/dfn&gt; method,
+  when invoked, must cause the &quot;&lt;span&gt;terminate a worker&lt;/span&gt;&quot;
+  algorithm to be run on the worker with with the object is
+  associated.&lt;/p&gt;
+
+  &lt;p&gt;&lt;code&gt;Worker&lt;/code&gt; objects act as if they had an implicit
+  &lt;code&gt;MessagePort&lt;/code&gt; associated with them. This port is part of
+  a channel that is set up when the worker is created, but it is not
+  exposed. This object must never be garbage collected before the
+  &lt;code&gt;Worker&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;p&gt;All messages received by that port must immediately be
+  retargetted at the &lt;code&gt;Worker&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-Worker-postMessage&quot;&gt;&lt;code&gt;postMessage()&lt;/code&gt;&lt;/dfn&gt;&lt;!--
+  and &lt;dfn
+  title=&quot;dom-Worker-startConversation&quot;&gt;&lt;code&gt;startConversation()&lt;/code&gt;&lt;/dfn&gt;--&gt;
+  method&lt;!--s (startConversation)--&gt; on &lt;code&gt;Worker&lt;/code&gt; objects
+  must act as if, when invoked, it&lt;!--/they (startConversation)--&gt;
+  immediately invoked the method of the same name on the port, with
+  the same arguments, and returned the same return value.&lt;/p&gt;
+
+  &lt;p&gt;The following are the &lt;span&gt;event handler DOM attributes&lt;/span&gt;
+  that must be supported by objects implementing the
+  &lt;code&gt;Worker&lt;/code&gt; interface:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-Worker-onmessage&quot;&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever a &lt;code
+   title=&quot;event-Worker-message&quot;&gt;message&lt;/code&gt; event is targeted
+   at or bubbles through the &lt;code&gt;Worker&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When the &lt;dfn title=&quot;dom-Worker&quot;&gt;&lt;code&gt;Worker(&lt;var
+  title=&quot;&quot;&gt;scriptURL&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; constructor is invoked, the
+  user agent must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the &lt;var
+   title=&quot;&quot;&gt;scriptURL&lt;/var&gt; argument.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If this fails, throw a &lt;code&gt;SYNTAX_ERR&lt;/code&gt;
+   exception.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;origin&lt;/span&gt; of the resulting &lt;span&gt;absolute
+   URL&lt;/span&gt; is not the &lt;span title=&quot;same origin&quot;&gt;same&lt;/span&gt; as the
+   origin of the script that invoked the constructor, then throw a
+   &lt;span&gt;security exception&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a new &lt;code&gt;DedicatedWorkerGlobalScope&lt;/code&gt;
+   object&lt;/span&gt;. Let &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; be this
+   new object.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Create a new &lt;code&gt;Worker&lt;/code&gt; object, associated with
+   &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;. Let &lt;var
+   title=&quot;&quot;&gt;worker&lt;/var&gt; be this new object.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/span&gt; owned
+   by the &lt;span&gt;script execution context&lt;/span&gt; of the script that
+   invoked the method. Let this be the &lt;var title=&quot;&quot;&gt;outside
+   port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Associate the &lt;var title=&quot;&quot;&gt;outside port&lt;/var&gt; with &lt;var
+   title=&quot;&quot;&gt;worker&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/span&gt; owned
+   by &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;. Let &lt;var
+   title=&quot;&quot;&gt;inside port&lt;/var&gt; be this new object.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Associate &lt;var title=&quot;&quot;&gt;inside port&lt;/var&gt; with &lt;var
+   title=&quot;&quot;&gt;worker global scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Entangle&lt;/span&gt; &lt;var title=&quot;&quot;&gt;outside port&lt;/var&gt; and
+   &lt;var title=&quot;&quot;&gt;inside port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;worker&lt;/var&gt;, and run the following
+   steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Open &lt;var title=&quot;&quot;&gt;inside port&lt;/var&gt;'s &lt;span&gt;port message
+   queue&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Open &lt;var title=&quot;&quot;&gt;outside port&lt;/var&gt;'s &lt;span&gt;port message
+   queue&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span&gt;Run a worker&lt;/span&gt; for the resulting &lt;span&gt;absolute
+    URL&lt;/span&gt;, with the &lt;span&gt;script browsing context&lt;/span&gt; of the
+    script that invoked the method as the &lt;var title=&quot;&quot;&gt;owner browsing
+    context&lt;/var&gt;, and with &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; as
+    the global scope.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+
+  &lt;h5&gt;Shared workers and the &lt;code&gt;SharedWorker&lt;/code&gt; interface&lt;/h5&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;[&lt;span title=&quot;dom-SharedWorker&quot;&gt;Constructor&lt;/span&gt;(in DOMString scriptURL, in DOMString name)]
+interface &lt;dfn&gt;SharedWorker&lt;/dfn&gt; : &lt;span&gt;AbstractWorker&lt;/span&gt; {
+  readonly attribute &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-SharedWorker-port&quot;&gt;port&lt;/span&gt;;
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-SharedWorker-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the value it was assigned by the object's
+  constructor. It represents the &lt;code&gt;MessagePort&lt;/code&gt; for
+  communicating with the shared worker.&lt;/p&gt;
+
+  &lt;p&gt;When the &lt;dfn title=&quot;dom-SharedWorker&quot;&gt;&lt;code&gt;SharedWorker(&lt;var
+  title=&quot;&quot;&gt;scriptURL&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
+  constructor is invoked, the user agent must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the &lt;var
+   title=&quot;&quot;&gt;scriptURL&lt;/var&gt; argument.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If this fails, throw a &lt;code&gt;SYNTAX_ERR&lt;/code&gt;
+   exception.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;origin&lt;/span&gt; of the resulting &lt;span&gt;absolute
+   URL&lt;/span&gt; is not the &lt;span title=&quot;same origin&quot;&gt;same&lt;/span&gt; as the
+   origin of the script that invoked the constructor, then throw a
+   &lt;span&gt;security exception&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Execute the following substeps atomically:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Create a new &lt;code&gt;SharedWorker&lt;/code&gt; object, which will
+     shortly be associated with a &lt;code&gt;SharedWorkerGlobalScope&lt;/code&gt;
+     object. Let this &lt;code&gt;SharedWorker&lt;/code&gt; object be &lt;var
+     title=&quot;&quot;&gt;worker&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/span&gt; owned
+     by the &lt;span&gt;script execution context&lt;/span&gt; of the script that
+     invoked the method. Let this be the &lt;var title=&quot;&quot;&gt;outside
+     port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Assign &lt;var title=&quot;&quot;&gt;outside port&lt;/var&gt; to the &lt;code
+     title=&quot;dom-SharedWorker-port&quot;&gt;port&lt;/code&gt; attribute of &lt;var
+     title=&quot;&quot;&gt;worker&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If there exists a &lt;code&gt;SharedWorkerGlobalScope&lt;/code&gt; object
+      whose &lt;span title=&quot;dom-WorkerGlobalScope-closing&quot;&gt;closing&lt;/span&gt;
+      flag is false, whose &lt;code
+      title=&quot;dom-WorkerGlobalScope-name&quot;&gt;name&lt;/code&gt; attribute is
+      exactly equal to the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; argument, and
+      whose &lt;code
+      title=&quot;dom-WorkerGlobalScope-location&quot;&gt;location&lt;/code&gt; attribute
+      represents an &lt;span&gt;absolute URL&lt;/span&gt; that has the &lt;span&gt;same
+      origin&lt;/span&gt; as the resulting &lt;span&gt;absolute URL&lt;/span&gt;, then
+      run these substeps:&lt;/p&gt;
+
+      &lt;ol&gt;
+
+       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; be that
+       &lt;code&gt;SharedWorkerGlobalScope&lt;/code&gt; object.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;'s &lt;code
+       title=&quot;dom-WorkerGlobalScope-location&quot;&gt;location&lt;/code&gt;
+       attribute represents an &lt;span&gt;absolute URL&lt;/span&gt; that is not
+       exactly equal to the resulting &lt;span&gt;absolute URL&lt;/span&gt;, then
+       throw a &lt;code&gt;URL_MISMATCH_ERR&lt;/code&gt; exception and abort all
+       these steps. &lt;span class=&quot;big-issue&quot;&gt;code 21&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;Associate &lt;var title=&quot;&quot;&gt;worker&lt;/var&gt; with &lt;var
+       title=&quot;&quot;&gt;worker global scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/span&gt;
+       owned by &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;. Let this
+       be the &lt;var title=&quot;&quot;&gt;inside port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;&lt;span&gt;Entangle&lt;/span&gt; &lt;var title=&quot;&quot;&gt;outside port&lt;/var&gt;
+       and &lt;var title=&quot;&quot;&gt;inside port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;worker&lt;/var&gt; and perform the next
+       step asynchronously.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;Create an event that uses the &lt;code&gt;MessageEvent&lt;/code&gt;
+       interface, with the name &lt;code
+       title=&quot;event-connect&quot;&gt;connect&lt;/code&gt;, which does not bubble, is
+       cancelable, has no default action, has a &lt;code
+       title=&quot;dom-MessageEvent-data&quot;&gt;data&lt;/code&gt; attribute whose value
+       is the empty string and has a &lt;code
+       title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt;
+       attribute whose value is the newly created port, and
+       &lt;span&gt;queue a task&lt;/span&gt; to dispatch the event at &lt;var
+       title=&quot;&quot;&gt;worker global scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;Abort all these steps.&lt;/p&gt;&lt;/li&gt;
+
+      &lt;/ol&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a new &lt;code&gt;SharedWorkerGlobalScope&lt;/code&gt;
+     object&lt;/span&gt;. Let &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; be
+     this new object.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Associate &lt;var title=&quot;&quot;&gt;worker&lt;/var&gt; with &lt;var
+     title=&quot;&quot;&gt;worker global scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Set the &lt;code
+     title=&quot;dom-SharedWorkerGlobalScope-name&quot;&gt;name&lt;/code&gt; attribute of
+     &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; to &lt;var
+     title=&quot;&quot;&gt;name&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/span&gt;
+     owned by &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;. Let &lt;var
+     title=&quot;&quot;&gt;inside port&lt;/var&gt; be this new object.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Entangle&lt;/span&gt; &lt;var title=&quot;&quot;&gt;outside port&lt;/var&gt; and
+     &lt;var title=&quot;&quot;&gt;inside port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;worker&lt;/var&gt; and perform the next step
+   asynchronously.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Create an event that uses the &lt;code&gt;MessageEvent&lt;/code&gt;
+   interface, with the name &lt;code
+   title=&quot;event-connect&quot;&gt;connect&lt;/code&gt;, which does not bubble, is
+   cancelable, has no default action, has a &lt;code
+   title=&quot;dom-MessageEvent-data&quot;&gt;data&lt;/code&gt; attribute whose value is
+   the empty string and has a &lt;code
+   title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt; attribute
+   whose value is the newly created port, and &lt;span&gt;queue a
+   task&lt;/span&gt; to dispatch the event at &lt;var title=&quot;&quot;&gt;worker global
+   scope&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span&gt;Run a worker&lt;/span&gt; for the resulting &lt;span&gt;absolute
+    URL&lt;/span&gt;, with the &lt;span&gt;script browsing context&lt;/span&gt; of the
+    script that invoked the method as the &lt;var title=&quot;&quot;&gt;owner browsing
+    context&lt;/var&gt;, and with &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; as
+    the global scope.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+
+  &lt;h3&gt;APIs available to workers&lt;/h3&gt;
+
+  &lt;!-- the XXX below is for collapsing this interface onto WorkerGlobalScope so it looks like just one interface - the inheritance is a spec fiction only --&gt;
+  &lt;pre class=&quot;idl&quot;&gt;[NoInterfaceObject, ImplementedOn=WorkerGlobalScope, XXX] interface &lt;dfn&gt;WorkerUtils&lt;/dfn&gt; {
+  void &lt;span title=&quot;dom-WorkerGlobalScope-importScripts&quot;&gt;importScripts&lt;/span&gt;([Variadic] in DOMString urls);
+  readonly attribute &lt;span&gt;Storage&lt;/span&gt; &lt;span title=&quot;dom-localStorage&quot;&gt;localStorage&lt;/span&gt;;
+  readonly attribute &lt;span&gt;Navigator&lt;/span&gt; &lt;span title=&quot;dom-navigator&quot;&gt;navigator&lt;/span&gt;;
+  &lt;span&gt;Database&lt;/span&gt; &lt;span title=&quot;dom-opendatabase&quot;&gt;openDatabase&lt;/span&gt;(in DOMString name, in DOMString version, in DOMString displayName, in unsigned long estimatedSize);&lt;!--
+  void &lt;span title=&quot;dom-showNotification&quot;&gt;showNotification&lt;/span&gt;(in DOMString title, in DOMString subtitle, in DOMString description, [Optional] in VoidCallback onclick); XXX-NOTIFY --&gt;
+};&lt;/pre&gt;
+
+  &lt;p&gt;Objects that implement the &lt;code&gt;WorkerGlobalScope&lt;/code&gt;
+  interface must also implement the &lt;code&gt;WorkerUtils&lt;/code&gt;
+  interface.&lt;/p&gt;
+
+  &lt;p&gt;Objects that implement the &lt;code&gt;WorkerUtils&lt;/code&gt; interface
+  must also implement the &lt;code&gt;WindowTimers&lt;/code&gt; interface. (This
+  interface provides the &lt;code title=&quot;&quot;&gt;setTimeout()&lt;/code&gt; method and
+  its friends.)&lt;/p&gt;
+
+  &lt;p class=&quot;big-issue&quot;&gt;Need to define a sync database API.&lt;/p&gt;
+
+  &lt;!-- XXX ApplicationCache --&gt;
+
+  &lt;!-- XXX a way to set cookies on the URL for the script --&gt;
+
+  &lt;!-- XXX debugging: void log(in DOMString s); // log to console --&gt;
+
+  &lt;!-- XXX debugging: onerror --&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The DOM APIs (&lt;code&gt;Node&lt;/code&gt; objects, &lt;code&gt;Document&lt;/code&gt;
+  objects, etc) are not available to workers in this version of this
+  specification.&lt;/p&gt;
+
+
+  &lt;h4&gt;Importing scripts and libraries&lt;/h4&gt;
+
+  &lt;p&gt;When a script invokes the &lt;dfn
+  title=&quot;dom-WorkerGlobalScope-importScripts&quot;&gt;&lt;code&gt;importScripts(&lt;var
+  title=&quot;&quot;&gt;urls&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method on a
+  &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object, the user agent must run the
+  following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If there are no arguments, return without doing
+   anything. Abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; each
+   argument.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If any fail, throw a &lt;code&gt;SYNTAX_ERR&lt;/code&gt;
+   exception.&lt;/p&gt;&lt;/li&gt;
+
+&lt;!--
+   &lt;li&gt;&lt;p&gt;If any of the resulting &lt;span title=&quot;absolute URL&quot;&gt;absolute
+   URLs&lt;/span&gt; have an &lt;span&gt;origin&lt;/span&gt; that is not the &lt;span
+   title=&quot;same origin&quot;&gt;same&lt;/span&gt; as the origin of the script that
+   invoked the method, then throw a &lt;span&gt;security
+   exception&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+--&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Attempt to &lt;span&gt;fetch&lt;/span&gt; each resource identified by the
+    resulting &lt;span title=&quot;absolute URLs&quot;&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each argument in turn, in the order given, starting with
+    the first one, run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Wait for the fetching attempt for the corresponding resource
+      to complete.&lt;/p&gt;
+
+      &lt;p&gt;If the fetching attempt failed, throw a
+      &lt;code&gt;NETWORK_ERR&lt;/code&gt; exception and abort all these
+      steps.&lt;/p&gt;
+
+      &lt;p&gt;If the fetching attempt succeeded, then let &lt;var
+      title=&quot;&quot;&gt;source&lt;/var&gt; be the text of the resource that was
+      obtained, and let &lt;var title=&quot;&quot;&gt;language&lt;/var&gt; be
+      JavaScript.&lt;/p&gt;
+
+      &lt;p class=&quot;note&quot;&gt;As with the worker's script, the script here is
+      always assumed to be JavaScript, regardless of the MIME
+      type.&lt;/p&gt; &lt;!-- XXX --&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;&lt;span&gt;Create a script&lt;/span&gt;, using &lt;var
+      title=&quot;&quot;&gt;source&lt;/var&gt; as the script source and &lt;var
+      title=&quot;&quot;&gt;language&lt;/var&gt; as the scripting language, using the
+      same global object, browsing context, character encoding, base
+      URL, and script group as the &lt;span
+      title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that was created by the
+      worker's &lt;span&gt;run a worker&lt;/span&gt; algorithm.&lt;/p&gt;
+
+      &lt;p&gt;Let the newly created &lt;span
+      title=&quot;concept-script&quot;&gt;script&lt;/span&gt; run until it either
+      returns, fails to parse, fails to catch an exception, or gets
+      prematurely aborted by the &quot;&lt;span&gt;kill a worker&lt;/span&gt;&quot; or
+      &quot;&lt;span&gt;terminate a worker&lt;/span&gt;&quot; algorithms defined above.&lt;/p&gt;
+
+      &lt;p&gt;If it failed to parse, then throw a
+      &lt;code&gt;SyntaxError&lt;/code&gt;&lt;!-- XXX ref? --&gt; exception and abort
+      all these steps.&lt;/p&gt;
+
+      &lt;p&gt;If an exception was raised or if the script was prematurely
+      aborted, then abort all these steps, letting the exception or
+      aborting continue to be processed by the script that called the
+      &lt;code
+      title=&quot;dom-WorkerGlobalScope-importScripts&quot;&gt;importScripts()&lt;/code&gt;
+      method.&lt;/p&gt;
+
+      &lt;p&gt;If the &quot;&lt;span&gt;kill a worker&lt;/span&gt;&quot; or &quot;&lt;span&gt;terminate a
+      worker&lt;/span&gt;&quot; algorithms abort the script then abort all these
+      steps.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+  &lt;h4&gt;The &lt;code&gt;Navigator&lt;/code&gt; object&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-navigator&quot;&gt;&lt;code&gt;navigator&lt;/code&gt;&lt;/dfn&gt;
+  attribute of the &lt;code&gt;WorkerUtils&lt;/code&gt; interface must return an
+  instance of the &lt;code&gt;Navigator&lt;/code&gt; interface, which represents
+  the identity and state of the user agent (the client):&lt;/p&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;Navigator&lt;/dfn&gt; {
+  // objects implementing this interface also implement the interfaces listed below
+};&lt;/pre&gt;
+
+  &lt;p&gt;Objects implementing the &lt;code&gt;Navigator&lt;/code&gt; interface must
+  also implement the &lt;span&gt;NavigatorID&lt;/span&gt; and
+  &lt;span&gt;NavigatorOnLine&lt;/span&gt; interfaces specified in the HTML5
+  specification. &lt;a href=&quot;#refsHTML5&quot;&gt;[HTML5]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;The &lt;code&gt;Navigator&lt;/code&gt; interface defined in this
+  specification is different than the one defined in the HTML5
+  specification.&lt;/p&gt;
+
+
+  &lt;h4&gt;APIs defined in other specifications&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-localStorage&quot;&gt;&lt;code&gt;localStorage&lt;/code&gt;&lt;/dfn&gt;,
+  &lt;dfn title=&quot;dom-opendatabase&quot;&gt;&lt;code&gt;openDatabase()&lt;/code&gt;&lt;/dfn&gt; must
+  act as defined for the APIs with the same names on the
+  &lt;code&gt;Window&lt;/code&gt; object in the HTML5 specification, with the
+  exception that where the API would use the &lt;span&gt;origin&lt;/span&gt; of
+  the &lt;span&gt;active document&lt;/span&gt; of the &lt;span&gt;browsing
+  context&lt;/span&gt; of the &lt;code&gt;Window&lt;/code&gt; object on which the method
+  was supposedly invoked, it must instead use the &lt;span&gt;origin&lt;/span&gt;
+  of the script that invoked the method. &lt;a
+  href=&quot;#refsHTML5&quot;&gt;[HTML5]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-showNotification&quot;&gt;&lt;code&gt;showNotification()&lt;/code&gt;&lt;/dfn&gt;
+  methods must act as defined for the APIs with the same names on the
+  &lt;code&gt;Window&lt;/code&gt; object in the HTML5 specification. &lt;a
+  href=&quot;#refsHTML5&quot;&gt;[HTML5]&lt;/a&gt;&lt;/p&gt;
+
+
+  &lt;h4&gt;Interface objects and constructors&lt;/h4&gt;
+
+  &lt;p&gt;There must be no interface objects and constructors available in
+  the global scope of scripts whose &lt;span&gt;script execution
+  context&lt;/span&gt; is a &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object except for
+  the following:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;code&gt;XMLHttpRequest&lt;/code&gt; and all interface objects and
+   constructors defined by the XMLHttpRequest specifications, except
+   that the &lt;span&gt;document response entity body&lt;/span&gt; must always be
+   null. &lt;a href=&quot;#refsXHR&quot;&gt;[XHR]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The &lt;code&gt;WebSocket&lt;/code&gt; interface object and
+   constructor.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The &lt;code&gt;MessageChannel&lt;/code&gt; interface object and
+   constructor.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The &lt;code title=&quot;dom-Worker&quot;&gt;Worker()&lt;/code&gt; and &lt;code
+   title=&quot;dom-SharedWorker&quot;&gt;SharedWorker(&lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt; constructors.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+
+  &lt;h4&gt;Worker locations&lt;/h4&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;WorkerLocation&lt;/dfn&gt; {
+  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-href&quot;&gt;href&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-protocol&quot;&gt;protocol&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-host&quot;&gt;host&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-hostname&quot;&gt;hostname&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-port&quot;&gt;port&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-pathname&quot;&gt;pathname&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-search&quot;&gt;search&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-hash&quot;&gt;hash&lt;/span&gt;;
+};&lt;/pre&gt;
+
+  &lt;p&gt;A &lt;code&gt;WorkerLocation&lt;/code&gt; object represents an &lt;span&gt;absolute
+  URL&lt;/span&gt; set at its creation.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-WorkerLocation-href&quot;&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the &lt;span&gt;absolute URL&lt;/span&gt; that the object
+  represents.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code&gt;WorkerLocation&lt;/code&gt; interface also has the complement
+  of &lt;span&gt;URL decomposition attributes&lt;/span&gt;, &lt;dfn
+  title=&quot;dom-WorkerLocation-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;,
+  &lt;dfn title=&quot;dom-WorkerLocation-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
+  title=&quot;dom-WorkerLocation-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
+  title=&quot;dom-WorkerLocation-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;,
+  &lt;dfn
+  title=&quot;dom-WorkerLocation-pathname&quot;&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;,
+  &lt;dfn title=&quot;dom-WorkerLocation-search&quot;&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;,
+  and &lt;dfn
+  title=&quot;dom-WorkerLocation-hash&quot;&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must
+  follow the rules given for URL decomposition attributes, with the
+  &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; being the
+  &lt;span&gt;absolute URL&lt;/span&gt; that the object represents (same as the
+  &lt;code title=&quot;dom-WorkerLocation-href&quot;&gt;href&lt;/code&gt; attribute), and
+  the &lt;span title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/span&gt;
+  being a no-op, since the attributes are defined to be readonly. &lt;a
+  href=&quot;#refsHTML5&quot;&gt;[HTML5]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;!--END workers--&gt;
+
+
   &lt;h2 id=&quot;comms&quot;&gt;Communication&lt;/h2&gt;
 
 


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009763.html">[html5] r2880 - [a] (0) Clarify that the date in &lt;time&gt; elements	with no datetime='' attribute m [...]
</A></li>
	<LI>Next message: <A HREF="009765.html">[html5] r2883 - [e] (0) Integrate the specs together a bit more,	fix some legacy issues.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9764">[ date ]</a>
              <a href="thread.html#9764">[ thread ]</a>
              <a href="subject.html#9764">[ subject ]</a>
              <a href="author.html#9764">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
