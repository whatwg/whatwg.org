<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r4273 - [act] (0) Change &lt;itemref&gt; to itemref='',	to simplify processing.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4273%20-%20%5Bact%5D%20%280%29%20Change%20%3Citemref%3E%20to%20itemref%3D%27%27%2C%0A%09to%20simplify%20processing.&In-Reply-To=%3C20091022232736.9F2871389D7%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011143.html">
   <LINK REL="Next"  HREF="011145.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r4273 - [act] (0) Change &lt;itemref&gt; to itemref='',	to simplify processing.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4273%20-%20%5Bact%5D%20%280%29%20Change%20%3Citemref%3E%20to%20itemref%3D%27%27%2C%0A%09to%20simplify%20processing.&In-Reply-To=%3C20091022232736.9F2871389D7%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r4273 - [act] (0) Change &lt;itemref&gt; to itemref='',	to simplify processing.">whatwg at whatwg.org
       </A><BR>
    <I>Thu Oct 22 16:27:36 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="011143.html">[html5] r4272 - [e] (0) fix example that was missed in the earlier	fixes.
</A></li>
        <LI>Next message: <A HREF="011145.html">[html5] r4274 - [e] (0) Make a note more precise.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11144">[ date ]</a>
              <a href="thread.html#11144">[ thread ]</a>
              <a href="subject.html#11144">[ subject ]</a>
              <a href="author.html#11144">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-10-22 16:27:32 -0700 (Thu, 22 Oct 2009)
New Revision: 4273

Modified:
   complete.html
   index
   source
Log:
[act] (0) Change &lt;itemref&gt; to itemref='', to simplify processing.

Modified: complete.html
===================================================================
--- complete.html	2009-10-22 12:43:26 UTC (rev 4272)
+++ complete.html	2009-10-22 23:27:32 UTC (rev 4273)
@@ -352,9 +352,8 @@
        &lt;li&gt;&lt;a href=#pragma-directives&gt;&lt;span class=secno&gt;4.2.5.3 &lt;/span&gt;Pragma directives&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#other-pragma-directives&gt;&lt;span class=secno&gt;4.2.5.4 &lt;/span&gt;Other pragma directives&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#charset&gt;&lt;span class=secno&gt;4.2.5.5 &lt;/span&gt;Specifying the document's character encoding&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#itemref&gt;&lt;span class=secno&gt;4.2.6 &lt;/span&gt;The &lt;code&gt;itemref&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#the-style-element&gt;&lt;span class=secno&gt;4.2.7 &lt;/span&gt;The &lt;code&gt;style&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#styling&gt;&lt;span class=secno&gt;4.2.8 &lt;/span&gt;Styling&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#the-style-element&gt;&lt;span class=secno&gt;4.2.6 &lt;/span&gt;The &lt;code&gt;style&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#styling&gt;&lt;span class=secno&gt;4.2.7 &lt;/span&gt;Styling&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#scripting-1&gt;&lt;span class=secno&gt;4.3 &lt;/span&gt;Scripting&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#script&gt;&lt;span class=secno&gt;4.3.1 &lt;/span&gt;The &lt;code&gt;script&lt;/code&gt; element&lt;/a&gt;
@@ -7779,6 +7778,7 @@
            attribute boolean &lt;a href=#dom-itemscope title=dom-itemScope&gt;itemScope&lt;/a&gt;;
            attribute DOMString &lt;a href=#dom-itemtype title=dom-itemType&gt;itemType&lt;/a&gt;;
            attribute DOMString &lt;a href=#dom-itemid title=dom-itemId&gt;itemId&lt;/a&gt;;
+           attribute DOMString &lt;a href=#dom-itemref title=dom-itemRef&gt;itemRef&lt;/a&gt;;
   [PutForwards=&lt;a href=#dom-domsettabletokenlist-value title=dom-DOMSettableTokenList-value&gt;value&lt;/a&gt;] readonly attribute &lt;a href=#domsettabletokenlist&gt;DOMSettableTokenList&lt;/a&gt; &lt;a href=#dom-itemprop title=dom-itemProp&gt;itemProp&lt;/a&gt;;
   readonly attribute &lt;a href=#htmlpropertycollection&gt;HTMLPropertyCollection&lt;/a&gt; &lt;a href=#dom-properties title=dom-properties&gt;properties&lt;/a&gt;;
            attribute any &lt;a href=#dom-itemvalue title=dom-itemValue&gt;itemValue&lt;/a&gt;;
@@ -7902,6 +7902,7 @@
    &lt;li&gt;&lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-itemtype&gt;&lt;a href=#attr-itemtype&gt;itemtype&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-lang&gt;&lt;a href=#attr-lang&gt;lang&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-spellcheck&gt;&lt;a href=#attr-spellcheck&gt;spellcheck&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-style&gt;&lt;a href=#the-style-attribute&gt;style&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
@@ -11924,52 +11925,10 @@
   &lt;/div&gt;
 
 
+  &lt;h4 id=the-style-element&gt;&lt;span class=secno&gt;4.2.6 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;style&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
-  &lt;h4 id=itemref&gt;&lt;span class=secno&gt;4.2.6 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;itemref&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
-
   &lt;dl class=element&gt;&lt;dt&gt;Categories&lt;/dt&gt;
    &lt;dd&gt;&lt;a href=#metadata-content&gt;Metadata content&lt;/a&gt;.&lt;/dd&gt;
-   &lt;dd&gt;&lt;a href=#flow-content&gt;Flow content&lt;/a&gt;.&lt;/dd&gt;
-   &lt;dd&gt;&lt;a href=#phrasing-content&gt;Phrasing content&lt;/a&gt;.&lt;/dd&gt;
-   &lt;dt&gt;Contexts in which this element may be used:&lt;/dt&gt;
-   &lt;dd&gt;Where &lt;a href=#metadata-content&gt;metadata content&lt;/a&gt; is expected.&lt;/dd&gt;
-   &lt;dd&gt;Where &lt;a href=#phrasing-content&gt;phrasing content&lt;/a&gt; is expected.&lt;/dd&gt;
-   &lt;dt&gt;Content model:&lt;/dt&gt;
-   &lt;dd&gt;Empty.&lt;/dd&gt;
-   &lt;dt&gt;Content attributes:&lt;/dt&gt;
-   &lt;dd&gt;&lt;a href=#global-attributes&gt;Global attributes&lt;/a&gt;&lt;/dd&gt;
-   &lt;dd&gt;&lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt;&lt;/dd&gt;
-   &lt;dt&gt;DOM interface:&lt;/dt&gt;
-   &lt;dd&gt;
-&lt;pre class=idl&gt;interface &lt;dfn id=htmlitemrefelement&gt;HTMLItemRefElement&lt;/dfn&gt; : &lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt; {
-           attribute DOMString &lt;a href=#dom-itemref-refid title=dom-itemref-refId&gt;refId&lt;/a&gt;;
-};&lt;/pre&gt;
-   &lt;/dd&gt;
-  &lt;/dl&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element is used to include by reference
-  properties defined (using &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt;) by elements that are not
-  descendants of the &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element's nearest ancestor
-  with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=attr-itemref-refid title=attr-itemref-refid&gt;&lt;code&gt;refid&lt;/code&gt;&lt;/dfn&gt;
-  attribute is required, and its value must be the ID of an element in
-  the same &lt;code&gt;Document&lt;/code&gt; as the &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
-  element.&lt;/p&gt;
-
-  &lt;p class=note&gt;This element is described in more detail as part of
-  the &lt;a href=#microdata&gt;microdata&lt;/a&gt; model.&lt;/p&gt;
-
-  &lt;div class=impl&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-itemref-refid title=dom-itemref-refId&gt;&lt;code&gt;refId&lt;/code&gt;&lt;/dfn&gt; IDL
-  attribute must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt; content attribute.&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-  &lt;h4 id=the-style-element&gt;&lt;span class=secno&gt;4.2.7 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;style&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
-
-  &lt;dl class=element&gt;&lt;dt&gt;Categories&lt;/dt&gt;
-   &lt;dd&gt;&lt;a href=#metadata-content&gt;Metadata content&lt;/a&gt;.&lt;/dd&gt;
    &lt;dd&gt;If the &lt;code title=attr-style-scoped&gt;&lt;a href=#attr-style-scoped&gt;scoped&lt;/a&gt;&lt;/code&gt; attribute is present: &lt;a href=#flow-content&gt;flow content&lt;/a&gt;.&lt;/dd&gt;
    &lt;dt&gt;Contexts in which this element may be used:&lt;/dt&gt;
    &lt;dd&gt;If the &lt;code title=attr-style-scoped&gt;&lt;a href=#attr-style-scoped&gt;scoped&lt;/a&gt;&lt;/code&gt; attribute is absent: where &lt;a href=#metadata-content&gt;metadata content&lt;/a&gt; is expected.&lt;/dd&gt;
@@ -12158,7 +12117,7 @@
 
 
 
-  &lt;h4 id=styling&gt;&lt;span class=secno&gt;4.2.8 &lt;/span&gt;&lt;dfn title=&quot;styling processing model&quot;&gt;Styling&lt;/dfn&gt;&lt;/h4&gt;
+  &lt;h4 id=styling&gt;&lt;span class=secno&gt;4.2.7 &lt;/span&gt;&lt;dfn title=&quot;styling processing model&quot;&gt;Styling&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#the-link-element&gt;link&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt; elements can provide
   styling information for the user agent to use when rendering the
@@ -44476,19 +44435,18 @@
   &lt;/div&gt;
 
   &lt;p&gt;Properties that are not descendants of the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute can be associated
-  with the &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; using the
-  &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element, whose &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt; attribute takes the ID of an
-  element with the &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt;
-  attribute or an ancestor of such an element.&lt;/p&gt;
+  with the &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; using the &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute. This attribute takes
+  a list of IDs of elements to crawl in addition to crawling the
+  children of the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
 
   &lt;div class=example&gt;
 
    &lt;p&gt;This example is the same as the previous one, but all the
    properties are separated from their &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt;:&lt;/p&gt;
 
-   &lt;pre&gt;&lt;div itemscope id=&quot;amanda&quot;&gt;&lt;itemref refid=&quot;a&quot;&gt;&lt;itemref refid=&quot;b&quot;&gt;&lt;/div&gt;
+   &lt;pre&gt;&lt;div itemscope id=&quot;amanda&quot; itemref=&quot;a b&quot;&gt;&lt;/div&gt;
 &lt;p id=&quot;a&quot;&gt;Name: &lt;span itemprop=&quot;name&quot;&gt;Amanda&lt;/span&gt;&lt;/p&gt;
-&lt;div id=&quot;b&quot; itemprop=&quot;band&quot; itemscope&gt;&lt;itemref refid=&quot;c&quot;&gt;&lt;/div&gt;
+&lt;div id=&quot;b&quot; itemprop=&quot;band&quot; itemscope itemref=&quot;c&quot;&gt;&lt;/div&gt;
 &lt;div id=&quot;c&quot;&gt;
  &lt;p&gt;Band: &lt;span itemprop=&quot;name&quot;&gt;Jazz Band&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;Size: &lt;span itemprop=&quot;size&quot;&gt;12&lt;/span&gt; players&lt;/p&gt;
@@ -44900,19 +44858,14 @@
 
   &lt;h4 id=items&gt;&lt;span class=secno&gt;5.2.2 &lt;/span&gt;Items&lt;/h4&gt;
 
-  &lt;p&gt;Every &lt;a href=#html-elements title=&quot;HTML elements&quot;&gt;HTML element&lt;/a&gt; except the
-  &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element may have an &lt;dfn id=attr-itemscope title=attr-itemscope&gt;&lt;code&gt;itemscope&lt;/code&gt;&lt;/dfn&gt; attribute
+  &lt;p&gt;Every &lt;a href=#html-elements title=&quot;HTML elements&quot;&gt;HTML element&lt;/a&gt; may have an
+  &lt;dfn id=attr-itemscope title=attr-itemscope&gt;&lt;code&gt;itemscope&lt;/code&gt;&lt;/dfn&gt; attribute
   specified. The &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
   attribute is a &lt;a href=#boolean-attribute&gt;boolean attribute&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;An element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
-  attribute specified, and that is not an &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
-  element, creates a new &lt;dfn id=concept-item title=concept-item&gt;item&lt;/dfn&gt;, a group
-  of name-value pairs.&lt;/p&gt;
+  attribute specified creates a new &lt;dfn id=concept-item title=concept-item&gt;item&lt;/dfn&gt;, a group of name-value pairs.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute must
-  not be specified on &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
-
   &lt;hr&gt;&lt;p&gt;Elements with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
   attribute may have an &lt;dfn id=attr-itemtype title=attr-itemtype&gt;&lt;code&gt;itemtype&lt;/code&gt;&lt;/dfn&gt; attribute
   specified, to give the &lt;a href=#item-type&gt;item type&lt;/a&gt; of the &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/p&gt;
@@ -44959,7 +44912,21 @@
   vocabulary that does not &lt;a href=#support-global-identifiers-for-items&gt;support global identifiers for
   items&lt;/a&gt;, as defined by that vocabulary's specification.&lt;/p&gt;
 
+  &lt;hr&gt;&lt;p&gt;Elements with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
+  attribute may have an &lt;dfn id=attr-itemref title=attr-itemref&gt;&lt;code&gt;itemref&lt;/code&gt;&lt;/dfn&gt; attribute specified,
+  to give a list of additional elements to crawl to find the
+  name-value pairs of the &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, if
+  specified, must have a value that is an &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;unordered set of
+  unique space-separated tokens&lt;/a&gt; consisting of &lt;a href=#concept-id title=concept-ID&gt;IDs&lt;/a&gt; of elements in the same document; for
+  each one, the element's nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified, if any,
+  must not be the element with the referencing &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute specified.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute must not
+  be specified on elements that do not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified.&lt;/p&gt;
+
+
   &lt;h4 id=names:-the-itemprop-attribute&gt;&lt;span class=secno&gt;5.2.3 &lt;/span&gt;Names: the &lt;dfn title=attr-itemprop&gt;&lt;code&gt;itemprop&lt;/code&gt;&lt;/dfn&gt; attribute&lt;/h4&gt;
 
   &lt;p&gt;Every &lt;a href=#html-elements title=&quot;HTML elements&quot;&gt;HTML element&lt;/a&gt; may have an
@@ -45047,8 +45014,7 @@
 
    &lt;p&gt;And the following:&lt;/p&gt;
 
-   &lt;pre&gt;&lt;div itemscope&gt;
- &lt;itemref refid=&quot;x&quot;&gt;
+   &lt;pre&gt;&lt;div itemscope itemref=&quot;x&quot;&gt;
  &lt;p itemprop=&quot;b&quot;&gt;test&lt;/p&gt;
  &lt;p itemprop=&quot;a&quot;&gt;2&lt;/p&gt;
 &lt;/div&gt;
@@ -45134,14 +45100,12 @@
   element&lt;/a&gt;.&lt;/p&gt;
 
 
-
   &lt;h4 id=associating-names-with-items&gt;&lt;span class=secno&gt;5.2.5 &lt;/span&gt;Associating names with items&lt;/h4&gt;
 
   &lt;p&gt;To find &lt;dfn id=the-properties-of-an-item&gt;the properties of an item&lt;/dfn&gt;, the user agent must
   run the following steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute. This element
-   cannot be an &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; be a stack of elements
    initially containing the child elements of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, if any, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so that
@@ -45153,54 +45117,55 @@
    elements. This list will be the result of the algorithm: a list of
    elements with properties that apply to &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;visited nodes&lt;/var&gt; be a list of elements
-   containing just &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. This list is used to
-   avoid loops caused by &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; elements.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, &lt;a href=#split-a-string-on-spaces title=&quot;split a
+   string on spaces&quot;&gt;split the value of that &lt;code title=attr-itemref&gt;itemref&lt;/code&gt; attribute on spaces&lt;/a&gt;. For
+   each resulting token, &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an
+   element in the document with the &lt;a href=#concept-id title=concept-ID&gt;ID&lt;/a&gt;
+   &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then push the first such element onto &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;error found&lt;/var&gt; be false. If it is set
-   to true by the algorithm below, then an &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; error
-   has been found.&lt;/li&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;, run the following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;'s nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute
+     specified.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If one of the other elements in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;
+     is also &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;
+     (i.e. remove duplicates).&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; is an ancestor element of &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element is &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;
+     from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; is an ancestor element of &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element also has &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; as its nearest ancestor element with an
+     &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute
+     specified, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; in &lt;a href=#tree-order&gt;tree
+   order&lt;/a&gt;.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Pop the top element from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; be that
    element.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is already in &lt;var title=&quot;&quot;&gt;visited nodes&lt;/var&gt; then let &lt;var title=&quot;&quot;&gt;error
-   found&lt;/var&gt; be true, and skip down to the step marked &lt;i&gt;end of
-   loop&lt;/i&gt;.&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; has an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute, then append &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Append &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;visited
-   nodes&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
-   element with a &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt;
-   attribute, and there is an element in the document whose &lt;a href=#concept-id title=concept-id&gt;ID&lt;/a&gt; matches the value of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt;'s &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt; attribute, then push the
-   first element in the document whose &lt;a href=#concept-id title=concept-id&gt;ID&lt;/a&gt; matches the value of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt;'s &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt; attribute onto &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; (so that it will be the next element to be
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child elements, then:
+   push all the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; onto
+   &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so the first
+   child of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be
    popped from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;).&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is not an
-   &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does
-   not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
-   attribute, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child
-   elements, then: push all the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; onto &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;, in
-   &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so the first child of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be popped from
-   &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;).&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;&lt;i&gt;End of loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; is not
    empty, return to the step marked &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;. That is the list of
    &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;properties of the
-   item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+   item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. By definition, this list is
+   in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;A document must not contain any &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; elements
-  that would cause the &lt;var title=&quot;&quot;&gt;error found&lt;/var&gt; flag in the
-  algorithm above to be set to true if the &lt;a href=#the-properties-of-an-item title=&quot;the properties
-  of an item&quot;&gt;properties&lt;/a&gt; of all the &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; in that document were to be
-  determined.&lt;/p&gt;
-
-  &lt;p&gt;A document must not contain any elements that have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute that would not be
+  &lt;/ol&gt;&lt;p&gt;A document must not contain any elements that have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute that would not be
   found to be a property of any of the &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; in that document were their &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;properties&lt;/a&gt; all to be
   determined.&lt;/p&gt;
 
@@ -45208,7 +45173,6 @@
   its element does not have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
 
 
-
   &lt;h4 id=examples-1&gt;&lt;span class=secno&gt;5.2.6 &lt;/span&gt;Examples&lt;/h4&gt;
 
   &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
@@ -45316,7 +45280,8 @@
   the &lt;code title=attr-itemtype&gt;&lt;a href=#attr-itemtype&gt;itemtype&lt;/a&gt;&lt;/code&gt; content attribute.
   The &lt;dfn id=dom-itemid title=dom-itemId&gt;&lt;code&gt;itemId&lt;/code&gt;&lt;/dfn&gt; IDL attribute
   on &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemid&gt;&lt;a href=#attr-itemid&gt;itemid&lt;/a&gt;&lt;/code&gt; content attribute.  The &lt;dfn id=dom-itemprop title=dom-itemProp&gt;&lt;code&gt;itemProp&lt;/code&gt;&lt;/dfn&gt; IDL attribute on
-  &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; content attribute.&lt;/p&gt;
+  &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; content attribute. The &lt;dfn id=dom-itemref title=dom-itemRef&gt;&lt;code&gt;itemRef&lt;/code&gt;&lt;/dfn&gt; IDL attribute on
+  &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; content attribute.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-properties title=dom-properties&gt;&lt;code&gt;properties&lt;/code&gt;&lt;/dfn&gt; IDL
   attribute on &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must return an
@@ -84279,17 +84244,6 @@
          &lt;code title=attr-mod-cite&gt;&lt;a href=#attr-mod-cite&gt;cite&lt;/a&gt;&lt;/code&gt;;
          &lt;code title=attr-mod-datetime&gt;&lt;a href=#attr-mod-datetime&gt;datetime&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code&gt;&lt;a href=#htmlmodelement&gt;HTMLModElement&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
-    &lt;tr&gt;&lt;th&gt;&lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;&lt;/th&gt;
-     &lt;td&gt;Inclusion mechanism to reference microdata properties in other parts of the document&lt;/td&gt;
-     &lt;td&gt;&lt;a href=#metadata-content title=&quot;Metadata content&quot;&gt;metadata&lt;/a&gt;;
-         &lt;a href=#flow-content title=&quot;Flow content&quot;&gt;flow&lt;/a&gt;;
-         &lt;a href=#phrasing-content title=&quot;Phrasing content&quot;&gt;phrasing&lt;/a&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;code&gt;&lt;a href=#the-head-element-0&gt;head&lt;/a&gt;&lt;/code&gt;;
-         &lt;a href=#phrasing-content title=&quot;Phrasing content&quot;&gt;phrasing&lt;/a&gt;&lt;/td&gt;
-     &lt;td&gt;empty
-     &lt;td&gt;&lt;a href=#global-attributes title=&quot;global attributes&quot;&gt;globals&lt;/a&gt;;
-         &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;code&gt;&lt;a href=#htmlitemrefelement&gt;HTMLItemRefElement&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
     &lt;tr&gt;&lt;th&gt;&lt;code&gt;&lt;a href=#the-kbd-element&gt;kbd&lt;/a&gt;&lt;/code&gt;&lt;/th&gt;
      &lt;td&gt;User input&lt;/td&gt;
      &lt;td&gt;&lt;a href=#flow-content title=&quot;Flow content&quot;&gt;flow&lt;/a&gt;;
@@ -85099,6 +85053,10 @@
      &lt;td&gt; &lt;a href=#names:-the-itemprop-attribute title=attr-itemprop&gt;HTML elements&lt;/a&gt;
      &lt;td&gt; &lt;a href=#property-names&gt;Property names&lt;/a&gt; of a microdata item
      &lt;td&gt; &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;Unordered set of unique space-separated tokens&lt;/a&gt; consisting of &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;valid absolute URLs&lt;/a&gt;, &lt;a href=#defined-property-name title=&quot;defined property name&quot;&gt;defined property names&lt;/a&gt;, or text*
+    &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;itemref&lt;/code&gt;
+     &lt;td&gt; &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt; Referenced elements
+     &lt;td&gt; &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;Unordered set of unique space-separated tokens&lt;/a&gt; consisting of IDs*
     &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;itemscope&lt;/code&gt;
      &lt;td&gt; &lt;a href=#attr-itemscope title=attr-itemscope&gt;HTML elements&lt;/a&gt;
      &lt;td&gt; Introduces a microdata item
@@ -85252,10 +85210,6 @@
           &lt;code title=attr-textarea-readonly&gt;&lt;a href=#attr-textarea-readonly&gt;textarea&lt;/a&gt;&lt;/code&gt;
      &lt;td&gt; Whether to allow the value to be edited by the user
      &lt;td&gt; &lt;a href=#boolean-attribute&gt;Boolean attribute&lt;/a&gt;
-    &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;refid&lt;/code&gt;
-     &lt;td&gt; &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;itemref&lt;/a&gt;&lt;/code&gt;
-     &lt;td&gt; Referenced element
-     &lt;td&gt; ID*
     &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;rel&lt;/code&gt;
      &lt;td&gt; &lt;code title=attr-hyperlink-rel&gt;&lt;a href=#attr-hyperlink-rel&gt;a&lt;/a&gt;&lt;/code&gt;;
           &lt;code title=attr-hyperlink-rel&gt;&lt;a href=#attr-hyperlink-rel&gt;area&lt;/a&gt;&lt;/code&gt;;
@@ -86024,9 +85978,6 @@
     &lt;tr&gt;&lt;td&gt; &lt;code&gt;&lt;a href=#the-ins-element&gt;ins&lt;/a&gt;&lt;/code&gt;
      &lt;td&gt; &lt;code&gt;&lt;a href=#htmlmodelement&gt;HTMLModElement&lt;/a&gt;&lt;/code&gt; : &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;
 
-    &lt;tr&gt;&lt;td&gt; &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
-     &lt;td&gt; &lt;code&gt;&lt;a href=#htmlitemrefelement&gt;HTMLItemRefElement&lt;/a&gt;&lt;/code&gt; : &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;
-
     &lt;tr&gt;&lt;td&gt; &lt;code&gt;&lt;a href=#the-kbd-element&gt;kbd&lt;/a&gt;&lt;/code&gt;
      &lt;td&gt; &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;
 

Modified: index
===================================================================
--- index	2009-10-22 12:43:26 UTC (rev 4272)
+++ index	2009-10-22 23:27:32 UTC (rev 4273)
@@ -342,9 +342,8 @@
        &lt;li&gt;&lt;a href=#pragma-directives&gt;&lt;span class=secno&gt;4.2.5.3 &lt;/span&gt;Pragma directives&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#other-pragma-directives&gt;&lt;span class=secno&gt;4.2.5.4 &lt;/span&gt;Other pragma directives&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#charset&gt;&lt;span class=secno&gt;4.2.5.5 &lt;/span&gt;Specifying the document's character encoding&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#itemref&gt;&lt;span class=secno&gt;4.2.6 &lt;/span&gt;The &lt;code&gt;itemref&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#the-style-element&gt;&lt;span class=secno&gt;4.2.7 &lt;/span&gt;The &lt;code&gt;style&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#styling&gt;&lt;span class=secno&gt;4.2.8 &lt;/span&gt;Styling&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#the-style-element&gt;&lt;span class=secno&gt;4.2.6 &lt;/span&gt;The &lt;code&gt;style&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#styling&gt;&lt;span class=secno&gt;4.2.7 &lt;/span&gt;Styling&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#scripting-1&gt;&lt;span class=secno&gt;4.3 &lt;/span&gt;Scripting&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#script&gt;&lt;span class=secno&gt;4.3.1 &lt;/span&gt;The &lt;code&gt;script&lt;/code&gt; element&lt;/a&gt;
@@ -7609,6 +7608,7 @@
            attribute boolean &lt;a href=#dom-itemscope title=dom-itemScope&gt;itemScope&lt;/a&gt;;
            attribute DOMString &lt;a href=#dom-itemtype title=dom-itemType&gt;itemType&lt;/a&gt;;
            attribute DOMString &lt;a href=#dom-itemid title=dom-itemId&gt;itemId&lt;/a&gt;;
+           attribute DOMString &lt;a href=#dom-itemref title=dom-itemRef&gt;itemRef&lt;/a&gt;;
   [PutForwards=&lt;a href=#dom-domsettabletokenlist-value title=dom-DOMSettableTokenList-value&gt;value&lt;/a&gt;] readonly attribute &lt;a href=#domsettabletokenlist&gt;DOMSettableTokenList&lt;/a&gt; &lt;a href=#dom-itemprop title=dom-itemProp&gt;itemProp&lt;/a&gt;;
   readonly attribute &lt;a href=#htmlpropertycollection&gt;HTMLPropertyCollection&lt;/a&gt; &lt;a href=#dom-properties title=dom-properties&gt;properties&lt;/a&gt;;
            attribute any &lt;a href=#dom-itemvalue title=dom-itemValue&gt;itemValue&lt;/a&gt;;
@@ -7732,6 +7732,7 @@
    &lt;li&gt;&lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-itemtype&gt;&lt;a href=#attr-itemtype&gt;itemtype&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-lang&gt;&lt;a href=#attr-lang&gt;lang&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-spellcheck&gt;&lt;a href=#attr-spellcheck&gt;spellcheck&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=attr-style&gt;&lt;a href=#the-style-attribute&gt;style&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
@@ -11754,52 +11755,10 @@
   &lt;/div&gt;
 
 
+  &lt;h4 id=the-style-element&gt;&lt;span class=secno&gt;4.2.6 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;style&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
-  &lt;h4 id=itemref&gt;&lt;span class=secno&gt;4.2.6 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;itemref&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
-
   &lt;dl class=element&gt;&lt;dt&gt;Categories&lt;/dt&gt;
    &lt;dd&gt;&lt;a href=#metadata-content&gt;Metadata content&lt;/a&gt;.&lt;/dd&gt;
-   &lt;dd&gt;&lt;a href=#flow-content&gt;Flow content&lt;/a&gt;.&lt;/dd&gt;
-   &lt;dd&gt;&lt;a href=#phrasing-content&gt;Phrasing content&lt;/a&gt;.&lt;/dd&gt;
-   &lt;dt&gt;Contexts in which this element may be used:&lt;/dt&gt;
-   &lt;dd&gt;Where &lt;a href=#metadata-content&gt;metadata content&lt;/a&gt; is expected.&lt;/dd&gt;
-   &lt;dd&gt;Where &lt;a href=#phrasing-content&gt;phrasing content&lt;/a&gt; is expected.&lt;/dd&gt;
-   &lt;dt&gt;Content model:&lt;/dt&gt;
-   &lt;dd&gt;Empty.&lt;/dd&gt;
-   &lt;dt&gt;Content attributes:&lt;/dt&gt;
-   &lt;dd&gt;&lt;a href=#global-attributes&gt;Global attributes&lt;/a&gt;&lt;/dd&gt;
-   &lt;dd&gt;&lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt;&lt;/dd&gt;
-   &lt;dt&gt;DOM interface:&lt;/dt&gt;
-   &lt;dd&gt;
-&lt;pre class=idl&gt;interface &lt;dfn id=htmlitemrefelement&gt;HTMLItemRefElement&lt;/dfn&gt; : &lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt; {
-           attribute DOMString &lt;a href=#dom-itemref-refid title=dom-itemref-refId&gt;refId&lt;/a&gt;;
-};&lt;/pre&gt;
-   &lt;/dd&gt;
-  &lt;/dl&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element is used to include by reference
-  properties defined (using &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt;) by elements that are not
-  descendants of the &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element's nearest ancestor
-  with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=attr-itemref-refid title=attr-itemref-refid&gt;&lt;code&gt;refid&lt;/code&gt;&lt;/dfn&gt;
-  attribute is required, and its value must be the ID of an element in
-  the same &lt;code&gt;Document&lt;/code&gt; as the &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
-  element.&lt;/p&gt;
-
-  &lt;p class=note&gt;This element is described in more detail as part of
-  the &lt;a href=#microdata&gt;microdata&lt;/a&gt; model.&lt;/p&gt;
-
-  &lt;div class=impl&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-itemref-refid title=dom-itemref-refId&gt;&lt;code&gt;refId&lt;/code&gt;&lt;/dfn&gt; IDL
-  attribute must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt; content attribute.&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-  &lt;h4 id=the-style-element&gt;&lt;span class=secno&gt;4.2.7 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;style&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
-
-  &lt;dl class=element&gt;&lt;dt&gt;Categories&lt;/dt&gt;
-   &lt;dd&gt;&lt;a href=#metadata-content&gt;Metadata content&lt;/a&gt;.&lt;/dd&gt;
    &lt;dd&gt;If the &lt;code title=attr-style-scoped&gt;&lt;a href=#attr-style-scoped&gt;scoped&lt;/a&gt;&lt;/code&gt; attribute is present: &lt;a href=#flow-content&gt;flow content&lt;/a&gt;.&lt;/dd&gt;
    &lt;dt&gt;Contexts in which this element may be used:&lt;/dt&gt;
    &lt;dd&gt;If the &lt;code title=attr-style-scoped&gt;&lt;a href=#attr-style-scoped&gt;scoped&lt;/a&gt;&lt;/code&gt; attribute is absent: where &lt;a href=#metadata-content&gt;metadata content&lt;/a&gt; is expected.&lt;/dd&gt;
@@ -11988,7 +11947,7 @@
 
 
 
-  &lt;h4 id=styling&gt;&lt;span class=secno&gt;4.2.8 &lt;/span&gt;&lt;dfn title=&quot;styling processing model&quot;&gt;Styling&lt;/dfn&gt;&lt;/h4&gt;
+  &lt;h4 id=styling&gt;&lt;span class=secno&gt;4.2.7 &lt;/span&gt;&lt;dfn title=&quot;styling processing model&quot;&gt;Styling&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#the-link-element&gt;link&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a href=#the-style-element&gt;style&lt;/a&gt;&lt;/code&gt; elements can provide
   styling information for the user agent to use when rendering the
@@ -44306,19 +44265,18 @@
   &lt;/div&gt;
 
   &lt;p&gt;Properties that are not descendants of the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute can be associated
-  with the &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; using the
-  &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element, whose &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt; attribute takes the ID of an
-  element with the &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt;
-  attribute or an ancestor of such an element.&lt;/p&gt;
+  with the &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; using the &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute. This attribute takes
+  a list of IDs of elements to crawl in addition to crawling the
+  children of the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
 
   &lt;div class=example&gt;
 
    &lt;p&gt;This example is the same as the previous one, but all the
    properties are separated from their &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt;:&lt;/p&gt;
 
-   &lt;pre&gt;&lt;div itemscope id=&quot;amanda&quot;&gt;&lt;itemref refid=&quot;a&quot;&gt;&lt;itemref refid=&quot;b&quot;&gt;&lt;/div&gt;
+   &lt;pre&gt;&lt;div itemscope id=&quot;amanda&quot; itemref=&quot;a b&quot;&gt;&lt;/div&gt;
 &lt;p id=&quot;a&quot;&gt;Name: &lt;span itemprop=&quot;name&quot;&gt;Amanda&lt;/span&gt;&lt;/p&gt;
-&lt;div id=&quot;b&quot; itemprop=&quot;band&quot; itemscope&gt;&lt;itemref refid=&quot;c&quot;&gt;&lt;/div&gt;
+&lt;div id=&quot;b&quot; itemprop=&quot;band&quot; itemscope itemref=&quot;c&quot;&gt;&lt;/div&gt;
 &lt;div id=&quot;c&quot;&gt;
  &lt;p&gt;Band: &lt;span itemprop=&quot;name&quot;&gt;Jazz Band&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;Size: &lt;span itemprop=&quot;size&quot;&gt;12&lt;/span&gt; players&lt;/p&gt;
@@ -44730,19 +44688,14 @@
 
   &lt;h4 id=items&gt;&lt;span class=secno&gt;5.2.2 &lt;/span&gt;Items&lt;/h4&gt;
 
-  &lt;p&gt;Every &lt;a href=#html-elements title=&quot;HTML elements&quot;&gt;HTML element&lt;/a&gt; except the
-  &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element may have an &lt;dfn id=attr-itemscope title=attr-itemscope&gt;&lt;code&gt;itemscope&lt;/code&gt;&lt;/dfn&gt; attribute
+  &lt;p&gt;Every &lt;a href=#html-elements title=&quot;HTML elements&quot;&gt;HTML element&lt;/a&gt; may have an
+  &lt;dfn id=attr-itemscope title=attr-itemscope&gt;&lt;code&gt;itemscope&lt;/code&gt;&lt;/dfn&gt; attribute
   specified. The &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
   attribute is a &lt;a href=#boolean-attribute&gt;boolean attribute&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;An element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
-  attribute specified, and that is not an &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
-  element, creates a new &lt;dfn id=concept-item title=concept-item&gt;item&lt;/dfn&gt;, a group
-  of name-value pairs.&lt;/p&gt;
+  attribute specified creates a new &lt;dfn id=concept-item title=concept-item&gt;item&lt;/dfn&gt;, a group of name-value pairs.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute must
-  not be specified on &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
-
   &lt;hr&gt;&lt;p&gt;Elements with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
   attribute may have an &lt;dfn id=attr-itemtype title=attr-itemtype&gt;&lt;code&gt;itemtype&lt;/code&gt;&lt;/dfn&gt; attribute
   specified, to give the &lt;a href=#item-type&gt;item type&lt;/a&gt; of the &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/p&gt;
@@ -44789,7 +44742,21 @@
   vocabulary that does not &lt;a href=#support-global-identifiers-for-items&gt;support global identifiers for
   items&lt;/a&gt;, as defined by that vocabulary's specification.&lt;/p&gt;
 
+  &lt;hr&gt;&lt;p&gt;Elements with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
+  attribute may have an &lt;dfn id=attr-itemref title=attr-itemref&gt;&lt;code&gt;itemref&lt;/code&gt;&lt;/dfn&gt; attribute specified,
+  to give a list of additional elements to crawl to find the
+  name-value pairs of the &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, if
+  specified, must have a value that is an &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;unordered set of
+  unique space-separated tokens&lt;/a&gt; consisting of &lt;a href=#concept-id title=concept-ID&gt;IDs&lt;/a&gt; of elements in the same document; for
+  each one, the element's nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified, if any,
+  must not be the element with the referencing &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute specified.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute must not
+  be specified on elements that do not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified.&lt;/p&gt;
+
+
   &lt;h4 id=names:-the-itemprop-attribute&gt;&lt;span class=secno&gt;5.2.3 &lt;/span&gt;Names: the &lt;dfn title=attr-itemprop&gt;&lt;code&gt;itemprop&lt;/code&gt;&lt;/dfn&gt; attribute&lt;/h4&gt;
 
   &lt;p&gt;Every &lt;a href=#html-elements title=&quot;HTML elements&quot;&gt;HTML element&lt;/a&gt; may have an
@@ -44877,8 +44844,7 @@
 
    &lt;p&gt;And the following:&lt;/p&gt;
 
-   &lt;pre&gt;&lt;div itemscope&gt;
- &lt;itemref refid=&quot;x&quot;&gt;
+   &lt;pre&gt;&lt;div itemscope itemref=&quot;x&quot;&gt;
  &lt;p itemprop=&quot;b&quot;&gt;test&lt;/p&gt;
  &lt;p itemprop=&quot;a&quot;&gt;2&lt;/p&gt;
 &lt;/div&gt;
@@ -44964,14 +44930,12 @@
   element&lt;/a&gt;.&lt;/p&gt;
 
 
-
   &lt;h4 id=associating-names-with-items&gt;&lt;span class=secno&gt;5.2.5 &lt;/span&gt;Associating names with items&lt;/h4&gt;
 
   &lt;p&gt;To find &lt;dfn id=the-properties-of-an-item&gt;the properties of an item&lt;/dfn&gt;, the user agent must
   run the following steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute. This element
-   cannot be an &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; be a stack of elements
    initially containing the child elements of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, if any, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so that
@@ -44983,54 +44947,55 @@
    elements. This list will be the result of the algorithm: a list of
    elements with properties that apply to &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;visited nodes&lt;/var&gt; be a list of elements
-   containing just &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. This list is used to
-   avoid loops caused by &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; elements.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, &lt;a href=#split-a-string-on-spaces title=&quot;split a
+   string on spaces&quot;&gt;split the value of that &lt;code title=attr-itemref&gt;itemref&lt;/code&gt; attribute on spaces&lt;/a&gt;. For
+   each resulting token, &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an
+   element in the document with the &lt;a href=#concept-id title=concept-ID&gt;ID&lt;/a&gt;
+   &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then push the first such element onto &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;error found&lt;/var&gt; be false. If it is set
-   to true by the algorithm below, then an &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; error
-   has been found.&lt;/li&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;, run the following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;'s nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute
+     specified.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If one of the other elements in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;
+     is also &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;
+     (i.e. remove duplicates).&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; is an ancestor element of &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element is &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;
+     from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; is an ancestor element of &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element also has &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; as its nearest ancestor element with an
+     &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute
+     specified, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; in &lt;a href=#tree-order&gt;tree
+   order&lt;/a&gt;.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Pop the top element from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; be that
    element.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is already in &lt;var title=&quot;&quot;&gt;visited nodes&lt;/var&gt; then let &lt;var title=&quot;&quot;&gt;error
-   found&lt;/var&gt; be true, and skip down to the step marked &lt;i&gt;end of
-   loop&lt;/i&gt;.&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; has an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute, then append &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Append &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;visited
-   nodes&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
-   element with a &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt;
-   attribute, and there is an element in the document whose &lt;a href=#concept-id title=concept-id&gt;ID&lt;/a&gt; matches the value of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt;'s &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt; attribute, then push the
-   first element in the document whose &lt;a href=#concept-id title=concept-id&gt;ID&lt;/a&gt; matches the value of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt;'s &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt; attribute onto &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; (so that it will be the next element to be
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child elements, then:
+   push all the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; onto
+   &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so the first
+   child of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be
    popped from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;).&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is not an
-   &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; element, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does
-   not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt;
-   attribute, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child
-   elements, then: push all the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; onto &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;, in
-   &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so the first child of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be popped from
-   &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;).&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;&lt;i&gt;End of loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; is not
    empty, return to the step marked &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;. That is the list of
    &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;properties of the
-   item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+   item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. By definition, this list is
+   in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;A document must not contain any &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; elements
-  that would cause the &lt;var title=&quot;&quot;&gt;error found&lt;/var&gt; flag in the
-  algorithm above to be set to true if the &lt;a href=#the-properties-of-an-item title=&quot;the properties
-  of an item&quot;&gt;properties&lt;/a&gt; of all the &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; in that document were to be
-  determined.&lt;/p&gt;
-
-  &lt;p&gt;A document must not contain any elements that have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute that would not be
+  &lt;/ol&gt;&lt;p&gt;A document must not contain any elements that have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute that would not be
   found to be a property of any of the &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; in that document were their &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;properties&lt;/a&gt; all to be
   determined.&lt;/p&gt;
 
@@ -45038,7 +45003,6 @@
   its element does not have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
 
 
-
   &lt;h4 id=examples-1&gt;&lt;span class=secno&gt;5.2.6 &lt;/span&gt;Examples&lt;/h4&gt;
 
   &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
@@ -45146,7 +45110,8 @@
   the &lt;code title=attr-itemtype&gt;&lt;a href=#attr-itemtype&gt;itemtype&lt;/a&gt;&lt;/code&gt; content attribute.
   The &lt;dfn id=dom-itemid title=dom-itemId&gt;&lt;code&gt;itemId&lt;/code&gt;&lt;/dfn&gt; IDL attribute
   on &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemid&gt;&lt;a href=#attr-itemid&gt;itemid&lt;/a&gt;&lt;/code&gt; content attribute.  The &lt;dfn id=dom-itemprop title=dom-itemProp&gt;&lt;code&gt;itemProp&lt;/code&gt;&lt;/dfn&gt; IDL attribute on
-  &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; content attribute.&lt;/p&gt;
+  &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; content attribute. The &lt;dfn id=dom-itemref title=dom-itemRef&gt;&lt;code&gt;itemRef&lt;/code&gt;&lt;/dfn&gt; IDL attribute on
+  &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; content attribute.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-properties title=dom-properties&gt;&lt;code&gt;properties&lt;/code&gt;&lt;/dfn&gt; IDL
   attribute on &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; must return an
@@ -75336,17 +75301,6 @@
          &lt;code title=attr-mod-cite&gt;&lt;a href=#attr-mod-cite&gt;cite&lt;/a&gt;&lt;/code&gt;;
          &lt;code title=attr-mod-datetime&gt;&lt;a href=#attr-mod-datetime&gt;datetime&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code&gt;&lt;a href=#htmlmodelement&gt;HTMLModElement&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
-    &lt;tr&gt;&lt;th&gt;&lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;&lt;/th&gt;
-     &lt;td&gt;Inclusion mechanism to reference microdata properties in other parts of the document&lt;/td&gt;
-     &lt;td&gt;&lt;a href=#metadata-content title=&quot;Metadata content&quot;&gt;metadata&lt;/a&gt;;
-         &lt;a href=#flow-content title=&quot;Flow content&quot;&gt;flow&lt;/a&gt;;
-         &lt;a href=#phrasing-content title=&quot;Phrasing content&quot;&gt;phrasing&lt;/a&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;code&gt;&lt;a href=#the-head-element-0&gt;head&lt;/a&gt;&lt;/code&gt;;
-         &lt;a href=#phrasing-content title=&quot;Phrasing content&quot;&gt;phrasing&lt;/a&gt;&lt;/td&gt;
-     &lt;td&gt;empty
-     &lt;td&gt;&lt;a href=#global-attributes title=&quot;global attributes&quot;&gt;globals&lt;/a&gt;;
-         &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;refid&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;code&gt;&lt;a href=#htmlitemrefelement&gt;HTMLItemRefElement&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
     &lt;tr&gt;&lt;th&gt;&lt;code&gt;&lt;a href=#the-kbd-element&gt;kbd&lt;/a&gt;&lt;/code&gt;&lt;/th&gt;
      &lt;td&gt;User input&lt;/td&gt;
      &lt;td&gt;&lt;a href=#flow-content title=&quot;Flow content&quot;&gt;flow&lt;/a&gt;;
@@ -76156,6 +76110,10 @@
      &lt;td&gt; &lt;a href=#names:-the-itemprop-attribute title=attr-itemprop&gt;HTML elements&lt;/a&gt;
      &lt;td&gt; &lt;a href=#property-names&gt;Property names&lt;/a&gt; of a microdata item
      &lt;td&gt; &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;Unordered set of unique space-separated tokens&lt;/a&gt; consisting of &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;valid absolute URLs&lt;/a&gt;, &lt;a href=#defined-property-name title=&quot;defined property name&quot;&gt;defined property names&lt;/a&gt;, or text*
+    &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;itemref&lt;/code&gt;
+     &lt;td&gt; &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt; Referenced elements
+     &lt;td&gt; &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;Unordered set of unique space-separated tokens&lt;/a&gt; consisting of IDs*
     &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;itemscope&lt;/code&gt;
      &lt;td&gt; &lt;a href=#attr-itemscope title=attr-itemscope&gt;HTML elements&lt;/a&gt;
      &lt;td&gt; Introduces a microdata item
@@ -76309,10 +76267,6 @@
           &lt;code title=attr-textarea-readonly&gt;&lt;a href=#attr-textarea-readonly&gt;textarea&lt;/a&gt;&lt;/code&gt;
      &lt;td&gt; Whether to allow the value to be edited by the user
      &lt;td&gt; &lt;a href=#boolean-attribute&gt;Boolean attribute&lt;/a&gt;
-    &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;refid&lt;/code&gt;
-     &lt;td&gt; &lt;code title=attr-itemref-refid&gt;&lt;a href=#attr-itemref-refid&gt;itemref&lt;/a&gt;&lt;/code&gt;
-     &lt;td&gt; Referenced element
-     &lt;td&gt; ID*
     &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;rel&lt;/code&gt;
      &lt;td&gt; &lt;code title=attr-hyperlink-rel&gt;&lt;a href=#attr-hyperlink-rel&gt;a&lt;/a&gt;&lt;/code&gt;;
           &lt;code title=attr-hyperlink-rel&gt;&lt;a href=#attr-hyperlink-rel&gt;area&lt;/a&gt;&lt;/code&gt;;
@@ -77081,9 +77035,6 @@
     &lt;tr&gt;&lt;td&gt; &lt;code&gt;&lt;a href=#the-ins-element&gt;ins&lt;/a&gt;&lt;/code&gt;
      &lt;td&gt; &lt;code&gt;&lt;a href=#htmlmodelement&gt;HTMLModElement&lt;/a&gt;&lt;/code&gt; : &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;
 
-    &lt;tr&gt;&lt;td&gt; &lt;code&gt;&lt;a href=#itemref&gt;itemref&lt;/a&gt;&lt;/code&gt;
-     &lt;td&gt; &lt;code&gt;&lt;a href=#htmlitemrefelement&gt;HTMLItemRefElement&lt;/a&gt;&lt;/code&gt; : &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;
-
     &lt;tr&gt;&lt;td&gt; &lt;code&gt;&lt;a href=#the-kbd-element&gt;kbd&lt;/a&gt;&lt;/code&gt;
      &lt;td&gt; &lt;code&gt;&lt;a href=#htmlelement&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;
 

Modified: source
===================================================================
--- source	2009-10-22 12:43:26 UTC (rev 4272)
+++ source	2009-10-22 23:27:32 UTC (rev 4273)
@@ -7680,6 +7680,7 @@
            attribute boolean &lt;span title=&quot;dom-itemScope&quot;&gt;itemScope&lt;/span&gt;;
            attribute DOMString &lt;span title=&quot;dom-itemType&quot;&gt;itemType&lt;/span&gt;;
            attribute DOMString &lt;span title=&quot;dom-itemId&quot;&gt;itemId&lt;/span&gt;;
+           attribute DOMString &lt;span title=&quot;dom-itemRef&quot;&gt;itemRef&lt;/span&gt;;
   [PutForwards=&lt;span title=&quot;dom-DOMSettableTokenList-value&quot;&gt;value&lt;/span&gt;] readonly attribute &lt;span&gt;DOMSettableTokenList&lt;/span&gt; &lt;span title=&quot;dom-itemProp&quot;&gt;itemProp&lt;/span&gt;;
   readonly attribute &lt;span&gt;HTMLPropertyCollection&lt;/span&gt; &lt;span title=&quot;dom-properties&quot;&gt;properties&lt;/span&gt;;
            attribute any &lt;span title=&quot;dom-itemValue&quot;&gt;itemValue&lt;/span&gt;;
@@ -7804,6 +7805,7 @@
    &lt;li&gt;&lt;code title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=&quot;attr-itemtype&quot;&gt;itemtype&lt;/code&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;code title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=&quot;attr-lang&quot;&gt;lang&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=&quot;attr-spellcheck&quot;&gt;spellcheck&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code title=&quot;attr-style&quot;&gt;style&lt;/code&gt;&lt;/li&gt;
@@ -12413,53 +12415,6 @@
   &lt;/div&gt;
 
 
-
-  &lt;h4 id=&quot;itemref&quot;&gt;The &lt;dfn&gt;&lt;code&gt;itemref&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
-
-  &lt;dl class=&quot;element&quot;&gt;
-   &lt;dt&gt;Categories&lt;/dt&gt;
-   &lt;dd&gt;&lt;span&gt;Metadata content&lt;/span&gt;.&lt;/dd&gt;
-   &lt;dd&gt;&lt;span&gt;Flow content&lt;/span&gt;.&lt;/dd&gt;
-   &lt;dd&gt;&lt;span&gt;Phrasing content&lt;/span&gt;.&lt;/dd&gt;
-   &lt;dt&gt;Contexts in which this element may be used:&lt;/dt&gt;
-   &lt;dd&gt;Where &lt;span&gt;metadata content&lt;/span&gt; is expected.&lt;/dd&gt;
-   &lt;dd&gt;Where &lt;span&gt;phrasing content&lt;/span&gt; is expected.&lt;/dd&gt;
-   &lt;dt&gt;Content model:&lt;/dt&gt;
-   &lt;dd&gt;Empty.&lt;/dd&gt;
-   &lt;dt&gt;Content attributes:&lt;/dt&gt;
-   &lt;dd&gt;&lt;span&gt;Global attributes&lt;/span&gt;&lt;/dd&gt;
-   &lt;dd&gt;&lt;code title=&quot;attr-itemref-refid&quot;&gt;refid&lt;/code&gt;&lt;/dd&gt;
-   &lt;dt&gt;DOM interface:&lt;/dt&gt;
-   &lt;dd&gt;
-&lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLItemRefElement&lt;/dfn&gt; : &lt;span&gt;HTMLElement&lt;/span&gt; {
-           attribute DOMString &lt;span title=&quot;dom-itemref-refId&quot;&gt;refId&lt;/span&gt;;
-};&lt;/pre&gt;
-   &lt;/dd&gt;
-  &lt;/dl&gt;
-
-  &lt;p&gt;The &lt;code&gt;itemref&lt;/code&gt; element is used to include by reference
-  properties defined (using &lt;code
-  title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt;) by elements that are not
-  descendants of the &lt;code&gt;itemref&lt;/code&gt; element's nearest ancestor
-  with an &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn title=&quot;attr-itemref-refid&quot;&gt;&lt;code&gt;refid&lt;/code&gt;&lt;/dfn&gt;
-  attribute is required, and its value must be the ID of an element in
-  the same &lt;code&gt;Document&lt;/code&gt; as the &lt;code&gt;itemref&lt;/code&gt;
-  element.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;This element is described in more detail as part of
-  the &lt;span&gt;microdata&lt;/span&gt; model.&lt;/p&gt;
-
-  &lt;div class=&quot;impl&quot;&gt;
-
-  &lt;p&gt;The &lt;dfn title=&quot;dom-itemref-refId&quot;&gt;&lt;code&gt;refId&lt;/code&gt;&lt;/dfn&gt; IDL
-  attribute must &lt;span&gt;reflect&lt;/span&gt; the &lt;code
-  title=&quot;attr-itemref-refid&quot;&gt;refid&lt;/code&gt; content attribute.&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
   &lt;h4&gt;The &lt;dfn&gt;&lt;code&gt;style&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
   &lt;dl class=&quot;element&quot;&gt;
@@ -49458,11 +49413,11 @@
 
   &lt;p&gt;Properties that are not descendants of the element with the &lt;code
   title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute can be associated
-  with the &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; using the
-  &lt;code&gt;itemref&lt;/code&gt; element, whose &lt;code
-  title=&quot;attr-itemref-refid&quot;&gt;refid&lt;/code&gt; attribute takes the ID of an
-  element with the &lt;code title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt;
-  attribute or an ancestor of such an element.&lt;/p&gt;
+  with the &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; using the &lt;code
+  title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute. This attribute takes
+  a list of IDs of elements to crawl in addition to crawling the
+  children of the element with the &lt;code
+  title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute.&lt;/p&gt;
 
   &lt;div class=&quot;example&quot;&gt;
 
@@ -49470,9 +49425,9 @@
    properties are separated from their &lt;span
    title=&quot;concept-item&quot;&gt;items&lt;/span&gt;:&lt;/p&gt;
 
-   &lt;pre&gt;&lt;div itemscope id=&quot;amanda&quot;&gt;&lt;itemref refid=&quot;a&quot;&gt;&lt;itemref refid=&quot;b&quot;&gt;&lt;/div&gt;
+   &lt;pre&gt;&lt;div itemscope id=&quot;amanda&quot; itemref=&quot;a b&quot;&gt;&lt;/div&gt;
 &lt;p id=&quot;a&quot;&gt;Name: &lt;span itemprop=&quot;name&quot;&gt;Amanda&lt;/span&gt;&lt;/p&gt;
-&lt;div id=&quot;b&quot; itemprop=&quot;band&quot; itemscope&gt;&lt;itemref refid=&quot;c&quot;&gt;&lt;/div&gt;
+&lt;div id=&quot;b&quot; itemprop=&quot;band&quot; itemscope itemref=&quot;c&quot;&gt;&lt;/div&gt;
 &lt;div id=&quot;c&quot;&gt;
  &lt;p&gt;Band: &lt;span itemprop=&quot;name&quot;&gt;Jazz Band&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;Size: &lt;span itemprop=&quot;size&quot;&gt;12&lt;/span&gt; players&lt;/p&gt;
@@ -49926,20 +49881,15 @@
 
   &lt;h4&gt;Items&lt;/h4&gt;
 
-  &lt;p&gt;Every &lt;span title=&quot;HTML elements&quot;&gt;HTML element&lt;/span&gt; except the
-  &lt;code&gt;itemref&lt;/code&gt; element may have an &lt;dfn
-  title=&quot;attr-itemscope&quot;&gt;&lt;code&gt;itemscope&lt;/code&gt;&lt;/dfn&gt; attribute
+  &lt;p&gt;Every &lt;span title=&quot;HTML elements&quot;&gt;HTML element&lt;/span&gt; may have an
+  &lt;dfn title=&quot;attr-itemscope&quot;&gt;&lt;code&gt;itemscope&lt;/code&gt;&lt;/dfn&gt; attribute
   specified. The &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt;
   attribute is a &lt;span&gt;boolean attribute&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;An element with the &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt;
-  attribute specified, and that is not an &lt;code&gt;itemref&lt;/code&gt;
-  element, creates a new &lt;dfn title=&quot;concept-item&quot;&gt;item&lt;/dfn&gt;, a group
-  of name-value pairs.&lt;/p&gt;
+  attribute specified creates a new &lt;dfn
+  title=&quot;concept-item&quot;&gt;item&lt;/dfn&gt;, a group of name-value pairs.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute must
-  not be specified on &lt;code&gt;itemref&lt;/code&gt; elements.&lt;/p&gt;
-
   &lt;hr&gt;
 
   &lt;p&gt;Elements with an &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt;
@@ -50006,7 +49956,28 @@
   vocabulary that does not &lt;span&gt;support global identifiers for
   items&lt;/span&gt;, as defined by that vocabulary's specification.&lt;/p&gt;
 
+  &lt;hr&gt;
 
+  &lt;p&gt;Elements with an &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt;
+  attribute may have an &lt;dfn
+  title=&quot;attr-itemref&quot;&gt;&lt;code&gt;itemref&lt;/code&gt;&lt;/dfn&gt; attribute specified,
+  to give a list of additional elements to crawl to find the
+  name-value pairs of the &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute, if
+  specified, must have a value that is an &lt;span&gt;unordered set of
+  unique space-separated tokens&lt;/span&gt; consisting of &lt;span
+  title=&quot;concept-ID&quot;&gt;IDs&lt;/span&gt; of elements in the same document; for
+  each one, the element's nearest ancestor element with an &lt;code
+  title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute specified, if any,
+  must not be the element with the referencing &lt;code
+  title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute specified.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute must not
+  be specified on elements that do not have an &lt;code
+  title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute specified.&lt;/p&gt;
+
+
   &lt;h4&gt;Names: the &lt;dfn title=&quot;attr-itemprop&quot;&gt;&lt;code&gt;itemprop&lt;/code&gt;&lt;/dfn&gt; attribute&lt;/h4&gt;
 
   &lt;p&gt;Every &lt;span title=&quot;HTML elements&quot;&gt;HTML element&lt;/span&gt; may have an
@@ -50102,8 +50073,7 @@
 
    &lt;p&gt;And the following:&lt;/p&gt;
 
-   &lt;pre&gt;&lt;div itemscope&gt;
- &lt;itemref refid=&quot;x&quot;&gt;
+   &lt;pre&gt;&lt;div itemscope itemref=&quot;x&quot;&gt;
  &lt;p itemprop=&quot;b&quot;&gt;test&lt;/p&gt;
  &lt;p itemprop=&quot;a&quot;&gt;2&lt;/p&gt;
 &lt;/div&gt;
@@ -50198,7 +50168,6 @@
   element&lt;/span&gt;.&lt;/p&gt;
 
 
-
   &lt;h4&gt;Associating names with items&lt;/h4&gt;
 
   &lt;p&gt;To find &lt;dfn&gt;the properties of an item&lt;/dfn&gt;, the user agent must
@@ -50207,8 +50176,7 @@
   &lt;ol&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the element with the &lt;code
-   title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute. This element
-   cannot be an &lt;code&gt;itemref&lt;/code&gt; element.&lt;/p&gt;&lt;/li&gt;
+   title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; be a stack of elements
    initially containing the child elements of &lt;var
@@ -50222,69 +50190,79 @@
    elements with properties that apply to &lt;var
    title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;visited nodes&lt;/var&gt; be a list of elements
-   containing just &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. This list is used to
-   avoid loops caused by &lt;code&gt;itemref&lt;/code&gt; elements.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code
+   title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute, &lt;span title=&quot;split a
+   string on spaces&quot;&gt;split the value of that &lt;code
+   title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute on spaces&lt;/span&gt;. For
+   each resulting token, &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an
+   element in the document with the &lt;span title=&quot;concept-ID&quot;&gt;ID&lt;/span&gt;
+   &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then push the first such element onto &lt;var
+   title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;error found&lt;/var&gt; be false. If it is set
-   to true by the algorithm below, then an &lt;code&gt;itemref&lt;/code&gt; error
-   has been found.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; in &lt;var
+    title=&quot;&quot;&gt;queue&lt;/var&gt;, run the following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; be &lt;var
+     title=&quot;&quot;&gt;candidate&lt;/var&gt;'s nearest ancestor element with an &lt;code
+     title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute
+     specified.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If one of the other elements in &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;
+     is also &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, then remove &lt;var
+     title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;
+     (i.e. remove duplicates).&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var
+     title=&quot;&quot;&gt;queue&lt;/var&gt; is an ancestor element of &lt;var
+     title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element is &lt;var
+     title=&quot;&quot;&gt;scope&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;
+     from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var
+     title=&quot;&quot;&gt;queue&lt;/var&gt; is an ancestor element of &lt;var
+     title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element also has &lt;var
+     title=&quot;&quot;&gt;scope&lt;/var&gt; as its nearest ancestor element with an
+     &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute
+     specified, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var
+     title=&quot;&quot;&gt;queue&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; in &lt;span&gt;tree
+   order&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Pop the top element from &lt;var
    title=&quot;&quot;&gt;queue&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; be that
    element.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is already in &lt;var
-   title=&quot;&quot;&gt;visited nodes&lt;/var&gt; then let &lt;var title=&quot;&quot;&gt;error
-   found&lt;/var&gt; be true, and skip down to the step marked &lt;i&gt;end of
-   loop&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; has an &lt;code
    title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; attribute, then append &lt;var
    title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Append &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;visited
-   nodes&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an &lt;code&gt;itemref&lt;/code&gt;
-   element with a &lt;code title=&quot;attr-itemref-refid&quot;&gt;refid&lt;/code&gt;
-   attribute, and there is an element in the document whose &lt;span
-   title=&quot;concept-id&quot;&gt;ID&lt;/span&gt; matches the value of &lt;var
-   title=&quot;&quot;&gt;current&lt;/var&gt;'s &lt;code
-   title=&quot;attr-itemref-refid&quot;&gt;refid&lt;/code&gt; attribute, then push the
-   first element in the document whose &lt;span
-   title=&quot;concept-id&quot;&gt;ID&lt;/span&gt; matches the value of &lt;var
-   title=&quot;&quot;&gt;current&lt;/var&gt;'s &lt;code
-   title=&quot;attr-itemref-refid&quot;&gt;refid&lt;/code&gt; attribute onto &lt;var
-   title=&quot;&quot;&gt;queue&lt;/var&gt; (so that it will be the next element to be
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does not have an &lt;code
+   title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute, and &lt;var
+   title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child elements, then:
+   push all the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; onto
+   &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;, in &lt;span&gt;tree order&lt;/span&gt; (so the first
+   child of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be
    popped from &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is not an
-   &lt;code&gt;itemref&lt;/code&gt; element, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does
-   not have an &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt;
-   attribute, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child
-   elements, then: push all the child elements of &lt;var
-   title=&quot;&quot;&gt;current&lt;/var&gt; onto &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;, in
-   &lt;span&gt;tree order&lt;/span&gt; (so the first child of &lt;var
-   title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be popped from
-   &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;&lt;i&gt;End of loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;queue&lt;/var&gt; is not
    empty, return to the step marked &lt;i&gt;loop&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;. That is the list of
    &lt;span title=&quot;the properties of an item&quot;&gt;properties of the
-   item&lt;/span&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   item&lt;/span&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. By definition, this list is
+   in &lt;span&gt;tree order&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
-  &lt;p&gt;A document must not contain any &lt;code&gt;itemref&lt;/code&gt; elements
-  that would cause the &lt;var title=&quot;&quot;&gt;error found&lt;/var&gt; flag in the
-  algorithm above to be set to true if the &lt;span title=&quot;the properties
-  of an item&quot;&gt;properties&lt;/span&gt; of all the &lt;span
-  title=&quot;concept-item&quot;&gt;items&lt;/span&gt; in that document were to be
-  determined.&lt;/p&gt;
-
   &lt;p&gt;A document must not contain any elements that have an &lt;code
   title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; attribute that would not be
   found to be a property of any of the &lt;span
@@ -50298,7 +50276,6 @@
   title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; attribute.&lt;/p&gt;
 
 
-
   &lt;h4&gt;Examples&lt;/h4&gt;
 
   &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
@@ -50420,7 +50397,10 @@
   title=&quot;attr-itemid&quot;&gt;itemid&lt;/code&gt; content attribute.  The &lt;dfn
   title=&quot;dom-itemProp&quot;&gt;&lt;code&gt;itemProp&lt;/code&gt;&lt;/dfn&gt; IDL attribute on
   &lt;span&gt;HTML elements&lt;/span&gt; must &lt;span&gt;reflect&lt;/span&gt; the &lt;code
-  title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; content attribute.&lt;/p&gt;
+  title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; content attribute. The &lt;dfn
+  title=&quot;dom-itemRef&quot;&gt;&lt;code&gt;itemRef&lt;/code&gt;&lt;/dfn&gt; IDL attribute on
+  &lt;span&gt;HTML elements&lt;/span&gt; must &lt;span&gt;reflect&lt;/span&gt; the &lt;code
+  title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; content attribute.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-properties&quot;&gt;&lt;code&gt;properties&lt;/code&gt;&lt;/dfn&gt; IDL
   attribute on &lt;span&gt;HTML elements&lt;/span&gt; must return an
@@ -92724,20 +92704,6 @@
     &lt;/tr&gt;
 
     &lt;tr&gt;
-     &lt;th&gt;&lt;code&gt;itemref&lt;/code&gt;&lt;/th&gt;
-     &lt;td&gt;Inclusion mechanism to reference microdata properties in other parts of the document&lt;/td&gt;
-     &lt;td&gt;&lt;span title=&quot;Metadata content&quot;&gt;metadata&lt;/span&gt;;
-         &lt;span title=&quot;Flow content&quot;&gt;flow&lt;/span&gt;;
-         &lt;span title=&quot;Phrasing content&quot;&gt;phrasing&lt;/span&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;code&gt;head&lt;/code&gt;;
-         &lt;span title=&quot;Phrasing content&quot;&gt;phrasing&lt;/span&gt;&lt;/td&gt;
-     &lt;td&gt;empty
-     &lt;td&gt;&lt;span title=&quot;global attributes&quot;&gt;globals&lt;/span&gt;;
-         &lt;code title=&quot;attr-itemref-refid&quot;&gt;refid&lt;/code&gt;&lt;/td&gt;
-     &lt;td&gt;&lt;code&gt;HTMLItemRefElement&lt;/code&gt;&lt;/td&gt;
-    &lt;/tr&gt;
-
-    &lt;tr&gt;
      &lt;th&gt;&lt;code&gt;kbd&lt;/code&gt;&lt;/th&gt;
      &lt;td&gt;User input&lt;/td&gt;
      &lt;td&gt;&lt;span title=&quot;Flow content&quot;&gt;flow&lt;/span&gt;;
@@ -93754,6 +93720,11 @@
      &lt;td&gt; &lt;span&gt;Property names&lt;/span&gt; of a microdata item
      &lt;td&gt; &lt;span&gt;Unordered set of unique space-separated tokens&lt;/span&gt; consisting of &lt;span title=&quot;absolute URL&quot;&gt;valid absolute URLs&lt;/span&gt;, &lt;span title=&quot;defined property name&quot;&gt;defined property names&lt;/span&gt;, or text*
     &lt;tr&gt;
+     &lt;th&gt; &lt;code title=&quot;&quot;&gt;itemref&lt;/code&gt;
+     &lt;td&gt; &lt;code title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt;
+     &lt;td&gt; Referenced elements
+     &lt;td&gt; &lt;span&gt;Unordered set of unique space-separated tokens&lt;/span&gt; consisting of IDs*
+    &lt;tr&gt;
      &lt;th&gt; &lt;code title=&quot;&quot;&gt;itemscope&lt;/code&gt;
      &lt;td&gt; &lt;span title=&quot;attr-itemscope&quot;&gt;HTML elements&lt;/span&gt;
      &lt;td&gt; Introduces a microdata item
@@ -93940,11 +93911,6 @@
      &lt;td&gt; Whether to allow the value to be edited by the user
      &lt;td&gt; &lt;span&gt;Boolean attribute&lt;/span&gt;
     &lt;tr&gt;
-     &lt;th&gt; &lt;code title=&quot;&quot;&gt;refid&lt;/code&gt;
-     &lt;td&gt; &lt;code title=&quot;attr-itemref-refid&quot;&gt;itemref&lt;/code&gt;
-     &lt;td&gt; Referenced element
-     &lt;td&gt; ID*
-    &lt;tr&gt;
      &lt;th&gt; &lt;code title=&quot;&quot;&gt;rel&lt;/code&gt;
      &lt;td&gt; &lt;code title=&quot;attr-hyperlink-rel&quot;&gt;a&lt;/code&gt;;
           &lt;code title=&quot;attr-hyperlink-rel&quot;&gt;area&lt;/code&gt;;
@@ -94895,10 +94861,6 @@
      &lt;td&gt; &lt;code&gt;HTMLModElement&lt;/code&gt; : &lt;code&gt;HTMLElement&lt;/code&gt;
 
     &lt;tr&gt;
-     &lt;td&gt; &lt;code&gt;itemref&lt;/code&gt;
-     &lt;td&gt; &lt;code&gt;HTMLItemRefElement&lt;/code&gt; : &lt;code&gt;HTMLElement&lt;/code&gt;
-
-    &lt;tr&gt;
      &lt;td&gt; &lt;code&gt;kbd&lt;/code&gt;
      &lt;td&gt; &lt;code&gt;HTMLElement&lt;/code&gt;
 


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011143.html">[html5] r4272 - [e] (0) fix example that was missed in the earlier	fixes.
</A></li>
	<LI>Next message: <A HREF="011145.html">[html5] r4274 - [e] (0) Make a note more precise.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11144">[ date ]</a>
              <a href="thread.html#11144">[ thread ]</a>
              <a href="subject.html#11144">[ subject ]</a>
              <a href="author.html#11144">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
