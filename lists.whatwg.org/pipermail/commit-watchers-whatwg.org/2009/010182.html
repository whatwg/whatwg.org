<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r3304 - [e] (0) Write some explanatory text around the HTML	parser.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r3304%20-%20%5Be%5D%20%280%29%20Write%20some%20explanatory%20text%20around%20the%20HTML%0A%09parser.&In-Reply-To=%3C20090623013341.4BCF61389F2%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010181.html">
   <LINK REL="Next"  HREF="010183.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r3304 - [e] (0) Write some explanatory text around the HTML	parser.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r3304%20-%20%5Be%5D%20%280%29%20Write%20some%20explanatory%20text%20around%20the%20HTML%0A%09parser.&In-Reply-To=%3C20090623013341.4BCF61389F2%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r3304 - [e] (0) Write some explanatory text around the HTML	parser.">whatwg at whatwg.org
       </A><BR>
    <I>Mon Jun 22 18:33:41 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="010181.html">[html5] r3303 - [e] (0) more cleanup
</A></li>
        <LI>Next message: <A HREF="010183.html">[html5] r3305 - [e] (0) spelling errors occurred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10182">[ date ]</a>
              <a href="thread.html#10182">[ thread ]</a>
              <a href="subject.html#10182">[ subject ]</a>
              <a href="author.html#10182">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2009-06-22 18:33:39 -0700 (Mon, 22 Jun 2009)
New Revision: 3304

Modified:
   index
   source
Log:
[e] (0) Write some explanatory text around the HTML parser.

Modified: index
===================================================================
--- index	2009-06-17 07:12:07 UTC (rev 3303)
+++ index	2009-06-23 01:33:39 UTC (rev 3304)
@@ -39,7 +39,7 @@
   &lt;div class=head&gt;
    &lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;h1&gt;HTML 5&lt;/h1&gt;
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-standard-&mdash;-date:-01-jan-1901&gt;Draft Standard &mdash; 17 June 2009&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft-standard-&mdash;-date:-01-jan-1901&gt;Draft Standard &mdash; 23 June 2009&lt;/h2&gt;
    &lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;dl&gt;&lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -992,7 +992,12 @@
        &lt;li&gt;&lt;a href=#the-after-after-body-insertion-mode&gt;&lt;span class=secno&gt;9.2.5.24 &lt;/span&gt;The &quot;after after body&quot; insertion mode&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#the-after-after-frameset-insertion-mode&gt;&lt;span class=secno&gt;9.2.5.25 &lt;/span&gt;The &quot;after after frameset&quot; insertion mode&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-end&gt;&lt;span class=secno&gt;9.2.6 &lt;/span&gt;The end&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#coercing-an-html-dom-into-an-infoset&gt;&lt;span class=secno&gt;9.2.7 &lt;/span&gt;Coercing an HTML DOM into an infoset&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#coercing-an-html-dom-into-an-infoset&gt;&lt;span class=secno&gt;9.2.7 &lt;/span&gt;Coercing an HTML DOM into an infoset&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#an-introduction-to-error-handling-in-the-parser&gt;&lt;span class=secno&gt;9.2.8 &lt;/span&gt;An introduction to error handling in the parser&lt;/a&gt;
+      &lt;ol&gt;
+       &lt;li&gt;&lt;a href=#misnested-tags:-b-i-/b-/i&gt;&lt;span class=secno&gt;9.2.8.1 &lt;/span&gt;Misnested tags: &lt;b&gt;&lt;i&gt;&lt;/b&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#misnested-tags:-b-p-/b-/p&gt;&lt;span class=secno&gt;9.2.8.2 &lt;/span&gt;Misnested tags: &lt;b&gt;&lt;p&gt;&lt;/b&gt;&lt;/p&gt;&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#unexpected-markup-in-tables&gt;&lt;span class=secno&gt;9.2.8.3 &lt;/span&gt;Unexpected markup in tables&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#namespaces&gt;&lt;span class=secno&gt;9.3 &lt;/span&gt;Namespaces&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#serializing-html-fragments&gt;&lt;span class=secno&gt;9.4 &lt;/span&gt;Serializing HTML fragments&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#parsing-html-fragments&gt;&lt;span class=secno&gt;9.5 &lt;/span&gt;Parsing HTML fragments&lt;/a&gt;&lt;/li&gt;
@@ -58369,6 +58374,7 @@
   pause flag&lt;/dfn&gt;, which must be initially set to false.&lt;/p&gt;
 
 
+
   &lt;h4 id=the-input-stream&gt;&lt;span class=secno&gt;9.2.2 &lt;/span&gt;The &lt;dfn&gt;input stream&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;The stream of Unicode characters that comprises the input to the
@@ -59192,9 +59198,14 @@
   category, and scope markers. The scope markers are inserted when
   entering &lt;code&gt;&lt;a href=#the-applet-element&gt;applet&lt;/a&gt;&lt;/code&gt; elements, buttons, &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt;
   elements, marquees, table cells, and table captions, and are used to
-  prevent formatting from &quot;leaking&quot; into &lt;code&gt;&lt;a href=#the-applet-element&gt;applet&lt;/a&gt;&lt;/code&gt; elements,
-  buttons, &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt; elements, marquees, and tables.&lt;/p&gt;
+  prevent formatting from &quot;leaking&quot; &lt;em&gt;into&lt;/em&gt; &lt;code&gt;&lt;a href=#the-applet-element&gt;applet&lt;/a&gt;&lt;/code&gt;
+  elements, buttons, &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt; elements, marquees, and
+  tables.&lt;/p&gt;
 
+  &lt;p class=note&gt;The scope markers are unrelated to the concept of an
+  element being &lt;a href=#has-an-element-in-scope title=&quot;has an element in scope&quot;&gt;in
+  scope&lt;/a&gt;.&lt;/p&gt;
+
   &lt;p&gt;In addition, each element in the &lt;a href=#list-of-active-formatting-elements&gt;list of active formatting
   elements&lt;/a&gt; is associated with the token for which it was
   created, so that further elements can be created for that token if
@@ -60970,9 +60981,9 @@
   must be inserted into the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;, and the
   &lt;a href=#current-table&gt;current table&lt;/a&gt; must be marked as
   &lt;dfn id=tainted&gt;tainted&lt;/dfn&gt;. (Once the &lt;a href=#current-table&gt;current table&lt;/a&gt; has been
-  &lt;a href=#tainted&gt;tainted&lt;/a&gt;, whitespace characters are inserted into the
-  &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; instead of the &lt;a href=#current-node&gt;current
-  node&lt;/a&gt;.)&lt;/p&gt;
+  &lt;a href=#tainted&gt;tainted&lt;/a&gt;, &lt;a href=#space-character title=&quot;space character&quot;&gt;space
+  characters&lt;/a&gt; are inserted into the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;
+  instead of the &lt;a href=#current-node&gt;current node&lt;/a&gt;.)&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=foster-parent-element&gt;foster parent element&lt;/dfn&gt; is the parent element of the
   last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
@@ -64400,8 +64411,193 @@
 
 
 
-  &lt;h3 id=namespaces&gt;&lt;span class=secno&gt;9.3 &lt;/span&gt;Namespaces&lt;/h3&gt;
+  &lt;h4 id=an-introduction-to-error-handling-in-the-parser&gt;&lt;span class=secno&gt;9.2.8 &lt;/span&gt;An introduction to error handling in the parser&lt;/h4&gt;
 
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;This section examines some erroneous markup and discusses how
+  the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; handles these cases.&lt;/p&gt;
+
+
+  &lt;h5 id=misnested-tags:-b-i-/b-/i&gt;&lt;span class=secno&gt;9.2.8.1 &lt;/span&gt;Misnested tags: &lt;b&gt;&lt;i&gt;&lt;/b&gt;&lt;/i&gt;&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;The most-often discussed example of erroneous markup is as
+  follows:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;p&gt;1&lt;b&gt;2&lt;i&gt;3&lt;/b&gt;4&lt;/i&gt;5&lt;/p&gt;&lt;/pre&gt;
+
+  &lt;p&gt;The parsing of this markup is straightforward up to the &quot;3&quot;. At
+  this point, the DOM looks like this:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-i-element&gt;i&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;3&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;Here, the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has five elements
+  on it: &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;, and &lt;code&gt;&lt;a href=#the-i-element&gt;i&lt;/a&gt;&lt;/code&gt;. The &lt;a href=#list-of-active-formatting-elements&gt;list of active
+  formatting elements&lt;/a&gt; just has two: &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; and
+  &lt;code&gt;&lt;a href=#the-i-element&gt;i&lt;/a&gt;&lt;/code&gt;. The &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt; is &quot;&lt;a href=#parsing-main-inbody title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
+  &lt;p&gt;Upon receiving the end tag token with the tag name &quot;b&quot;, the &quot;&lt;a href=#adoptionAgency&gt;adoption agency algorithm&lt;/a&gt;&quot; is
+  invoked. This is a simple case, in that the &lt;var title=&quot;&quot;&gt;formatting
+  element&lt;/var&gt; is the &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element, and there is no
+  &lt;var title=&quot;&quot;&gt;furthest block&lt;/var&gt;. Thus, the &lt;a href=#stack-of-open-elements&gt;stack of open
+  elements&lt;/a&gt; ends up with just three elements: &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;, and &lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;, while the &lt;a href=#list-of-active-formatting-elements&gt;list of
+  active formatting elements&lt;/a&gt; has just one: &lt;code&gt;&lt;a href=#the-i-element&gt;i&lt;/a&gt;&lt;/code&gt;. The
+  DOM tree is unmodified at this point.&lt;/p&gt;
+
+  &lt;p&gt;The next token is a character (&quot;4&quot;), triggers the &lt;a href=#reconstruct-the-active-formatting-elements title=&quot;reconstruct the active formatting elements&quot;&gt;reconstruction of
+  the active formatting elements&lt;/a&gt;, in this case just the
+  &lt;code&gt;&lt;a href=#the-i-element&gt;i&lt;/a&gt;&lt;/code&gt; element. A new &lt;code&gt;&lt;a href=#the-i-element&gt;i&lt;/a&gt;&lt;/code&gt; element is thus created
+  for the &quot;4&quot; text node. After the end tag token for the &quot;i&quot; is also
+  received, and the &quot;5&quot; text node is inserted, the DOM looks as
+  follows:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-i-element&gt;i&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;3&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-i-element&gt;i&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;4&lt;/span&gt;&lt;/ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;5&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h5 id=misnested-tags:-b-p-/b-/p&gt;&lt;span class=secno&gt;9.2.8.2 &lt;/span&gt;Misnested tags: &lt;b&gt;&lt;p&gt;&lt;/b&gt;&lt;/p&gt;&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;A case similar to the previous one is the following:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;b&gt;1&lt;p&gt;2&lt;/b&gt;3&lt;/p&gt;&lt;/pre&gt;
+
+  &lt;p&gt;Up to the &quot;2&quot; the parsing here is straightforward:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;The interesting part is when the end tag token with the tag name
+  &quot;b&quot; is parsed.&lt;/p&gt;
+
+  &lt;p&gt;Before that token is seen, the &lt;a href=#stack-of-open-elements&gt;stack of open
+  elements&lt;/a&gt; has four elements on it: &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;, and &lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;. The
+  &lt;a href=#list-of-active-formatting-elements&gt;list of active formatting elements&lt;/a&gt; just has the one:
+  &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;. The &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt; is &quot;&lt;a href=#parsing-main-inbody title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
+  &lt;p&gt;Upon receiving the end tag token with the tag name &quot;b&quot;, the &quot;&lt;a href=#adoptionAgency&gt;adoption agency algorithm&lt;/a&gt;&quot; is invoked, as
+  in the previous example. However, in this case, there &lt;em&gt;is&lt;/em&gt; a
+  &lt;var title=&quot;&quot;&gt;furthest block&lt;/var&gt;, namely the &lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt; element. Thus,
+  this time the adoption agency algorithm isn't skipped over.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt; is the &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;
+  element. A conceptual &quot;bookmark&quot; marks the position of the
+  &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; in the &lt;a href=#list-of-active-formatting-elements&gt;list of active formatting
+  elements&lt;/a&gt;, but since that list has only one element in it,
+  it won't have much effect.&lt;/p&gt;
+
+  &lt;p&gt;As the algorithm progresses, &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; ends up set
+  to the formatting element (&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;), and &lt;var title=&quot;&quot;&gt;last
+  node&lt;/var&gt; ends up set to the &lt;var title=&quot;&quot;&gt;furthest block&lt;/var&gt;
+  (&lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;).&lt;/p&gt;
+
+  &lt;p&gt;The &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt; gets appended (moved) to the
+  &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt;, so that the DOM looks like:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;A new &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element is created, and the children of the
+  &lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt; element are moved to it:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;Finally, the new &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element is appended to the
+  &lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt; element, so that the DOM looks like:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element is removed from the &lt;a href=#list-of-active-formatting-elements&gt;list of
+  active formatting elements&lt;/a&gt; and the &lt;a href=#stack-of-open-elements&gt;stack of open
+  elements&lt;/a&gt;, so that when the &quot;3&quot; is parsed, it is appended to
+  the &lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt; element:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-p-element&gt;p&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;3&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h5 id=unexpected-markup-in-tables&gt;&lt;span class=secno&gt;9.2.8.3 &lt;/span&gt;Unexpected markup in tables&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;Error handling in tables is, for historical reasons, especially
+  strange. For example, consider the following markup:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;table&gt;&lt;strong&gt;&lt;b&gt;&lt;/strong&gt;&lt;tr&gt;&lt;td&gt;aaa&lt;/td&gt;&lt;/tr&gt;&lt;strong&gt;bbb&lt;/strong&gt;&lt;/table&gt;ccc&lt;/pre&gt;
+
+  &lt;p&gt;The highlighted &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element start tag is not allowed
+  directly inside a table like that, and the parser handles this case
+  by placing the element &lt;em&gt;before&lt;/em&gt; the table. (This is called &lt;i title=&quot;foster parent&quot;&gt;&lt;a href=#foster-parent&gt;foster parenting&lt;/a&gt;&lt;/i&gt;.) This can be seen by
+  examining the DOM tree as it stands just after the
+  &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element's start tag has been seen:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;...and then immediately after the &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element start
+  tag has been seen:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;At this point, the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has on it
+  the elements &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;, and &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; (in that order, despite the
+  resulting DOM tree); the &lt;a href=#list-of-active-formatting-elements&gt;list of active formatting
+  elements&lt;/a&gt; just has the &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element in it; the
+  &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt; is &quot;&lt;a href=#parsing-main-intable title=&quot;insertion mode: in
+  table&quot;&gt;in table&lt;/a&gt;&quot;; and the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element is
+  &lt;a href=#tainted&gt;tainted&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; start tag causes the &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element
+  to be popped off the stack and a &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; start tag to be
+  implied; the &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; elements are
+  then handled in a rather straight-forward manner, taking the parser
+  through the &quot;&lt;a href=#parsing-main-intbody title=&quot;insertion mode: in table body&quot;&gt;in table
+  body&lt;/a&gt;&quot; and &quot;&lt;a href=#parsing-main-intr title=&quot;insertion mode: in row&quot;&gt;in
+  row&lt;/a&gt;&quot; insertion modes, after which the DOM looks as
+  follows:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;Here, the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has on it the
+  elements &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;, and &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt;; the &lt;a href=#list-of-active-formatting-elements&gt;list of active
+  formatting elements&lt;/a&gt; still has the &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element in
+  it; the &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt; is &quot;&lt;a href=#parsing-main-intr title=&quot;insertion mode:
+  in row&quot;&gt;in row&lt;/a&gt;&quot;; and the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element is still
+  &lt;a href=#tainted&gt;tainted&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt; element start tag token, after putting a
+  &lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt; element on the tree, puts a marker on the &lt;a href=#list-of-active-formatting-elements&gt;list
+  of active formatting elements&lt;/a&gt; (it also switches to the &quot;&lt;a href=#parsing-main-intd title=&quot;insertion mode: in cell&quot;&gt;in cell&lt;/a&gt;&quot; &lt;a href=#insertion-mode&gt;insertion
+  mode&lt;/a&gt;).&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;The marker means that when the &quot;aaa&quot; character tokens are seen,
+  no &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element is created to hold the resulting text
+  node:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;aaa&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;The end tags are handled in a straight-forward manner; after
+  handling them, the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has on it the
+  elements &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;,
+  and &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;; the &lt;a href=#list-of-active-formatting-elements&gt;list of active formatting
+  elements&lt;/a&gt; still has the &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element in it (the
+  marker having been removed by the &quot;td&quot; end tag token); the
+  &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt; is &quot;&lt;a href=#parsing-main-intbody title=&quot;insertion mode: in
+  table body&quot;&gt;in table body&lt;/a&gt;&quot;; and the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;
+  element is still &lt;a href=#tainted&gt;tainted&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;Thus it is that the &quot;bbb&quot; character tokens are found. When &lt;a href=#reconstruct-the-active-formatting-elements title=&quot;reconstruct the active formatting elements&quot;&gt;the active
+  formatting elements are reconstructed&lt;/a&gt;, a &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;
+  element is created and &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster
+  parented&lt;/a&gt;, and then the &quot;bbb&quot; text node is appended to it:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;bbb&lt;/span&gt;&lt;/ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;aaa&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;The &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has on it the elements
+  &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;,
+  &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;, and the new &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; (again, note that
+  this doesn't match the resulting tree!); the &lt;a href=#list-of-active-formatting-elements&gt;list of active
+  formatting elements&lt;/a&gt; has the new &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element in it;
+  the &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt; is still &quot;&lt;a href=#parsing-main-intbody title=&quot;insertion
+  mode: in table body&quot;&gt;in table body&lt;/a&gt;&quot;; and the
+  &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element is still &lt;a href=#tainted&gt;tainted&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;Had the character tokens been &lt;a href=#space-character title=&quot;space character&quot;&gt;space
+  characters&lt;/a&gt; instead of &quot;bbb&quot;, the result would have been the
+  same, but only because the table is &lt;a href=#tainted&gt;tainted&lt;/a&gt;. Had the
+  &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element's start tag been before the
+  &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; instead of after, then the table wouldn't have
+  been &lt;a href=#tainted&gt;tainted&lt;/a&gt; and such &lt;a href=#space-character title=&quot;space
+  character&quot;&gt;space characters&lt;/a&gt; would just be appended to the
+  &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+
+  &lt;p&gt;Finally, the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; is closed by a &quot;table&quot; end
+  tag. This pops all the nodes from the &lt;a href=#stack-of-open-elements&gt;stack of open
+  elements&lt;/a&gt; up to and including the &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element,
+  but it doesn't affect the &lt;a href=#list-of-active-formatting-elements&gt;list of active formatting
+  elements&lt;/a&gt;, so the &quot;ccc&quot; character tokens after the table
+  result in yet another &lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt; element being created, this
+  time after the table:&lt;/p&gt;
+
+  &lt;ul class=domTree&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-head-element&gt;head&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;bbb&lt;/span&gt;&lt;/ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-td-element&gt;td&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;aaa&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;li class=t1&gt;&lt;code&gt;&lt;a href=#the-b-element&gt;b&lt;/a&gt;&lt;/code&gt;&lt;ul&gt;&lt;li class=t3&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;ccc&lt;/span&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h3 id=namespaces&gt;&lt;span class=secno&gt;9.3 &lt;/span&gt;Namespaces&lt;/h3&gt;
+
   &lt;p&gt;The &lt;dfn id=html-namespace-0&gt;HTML namespace&lt;/dfn&gt; is: &lt;code&gt;<A HREF="http://www.w3.org/1999/xhtml&lt;/code">http://www.w3.org/1999/xhtml&lt;/code</A>&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=mathml-namespace&gt;MathML namespace&lt;/dfn&gt; is: &lt;code&gt;<A HREF="http://www.w3.org/1998/Math/MathML&lt;/code">http://www.w3.org/1998/Math/MathML&lt;/code</A>&gt;&lt;/p&gt;

Modified: source
===================================================================
--- source	2009-06-17 07:12:07 UTC (rev 3303)
+++ source	2009-06-23 01:33:39 UTC (rev 3304)
@@ -71813,6 +71813,7 @@
   pause flag&lt;/dfn&gt;, which must be initially set to false.&lt;/p&gt;
 
 
+
   &lt;h4&gt;The &lt;dfn&gt;input stream&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;The stream of Unicode characters that comprises the input to the
@@ -72783,9 +72784,14 @@
   category, and scope markers. The scope markers are inserted when
   entering &lt;code&gt;applet&lt;/code&gt; elements, buttons, &lt;code&gt;object&lt;/code&gt;
   elements, marquees, table cells, and table captions, and are used to
-  prevent formatting from &quot;leaking&quot; into &lt;code&gt;applet&lt;/code&gt; elements,
-  buttons, &lt;code&gt;object&lt;/code&gt; elements, marquees, and tables.&lt;/p&gt;
+  prevent formatting from &quot;leaking&quot; &lt;em&gt;into&lt;/em&gt; &lt;code&gt;applet&lt;/code&gt;
+  elements, buttons, &lt;code&gt;object&lt;/code&gt; elements, marquees, and
+  tables.&lt;/p&gt;
 
+  &lt;p class=&quot;note&quot;&gt;The scope markers are unrelated to the concept of an
+  element being &lt;span title=&quot;has an element in scope&quot;&gt;in
+  scope&lt;/span&gt;.&lt;/p&gt;
+
   &lt;p&gt;In addition, each element in the &lt;span&gt;list of active formatting
   elements&lt;/span&gt; is associated with the token for which it was
   created, so that further elements can be created for that token if
@@ -74806,9 +74812,9 @@
   must be inserted into the &lt;i&gt;foster parent element&lt;/i&gt;, and the
   &lt;span&gt;current table&lt;/span&gt; must be marked as
   &lt;dfn&gt;tainted&lt;/dfn&gt;. (Once the &lt;span&gt;current table&lt;/span&gt; has been
-  &lt;span&gt;tainted&lt;/span&gt;, whitespace characters are inserted into the
-  &lt;i&gt;foster parent element&lt;/i&gt; instead of the &lt;span&gt;current
-  node&lt;/span&gt;.)&lt;/p&gt;
+  &lt;span&gt;tainted&lt;/span&gt;, &lt;span title=&quot;space character&quot;&gt;space
+  characters&lt;/span&gt; are inserted into the &lt;i&gt;foster parent element&lt;/i&gt;
+  instead of the &lt;span&gt;current node&lt;/span&gt;.)&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn&gt;foster parent element&lt;/dfn&gt; is the parent element of the
   last &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open
@@ -78546,6 +78552,233 @@
 
 
 
+  &lt;h4&gt;An introduction to error handling in the parser&lt;/h4&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;This section examines some erroneous markup and discusses how
+  the &lt;span&gt;HTML parser&lt;/span&gt; handles these cases.&lt;/p&gt;
+
+
+  &lt;h5&gt;Misnested tags: &lt;b&gt;&lt;i&gt;&lt;/b&gt;&lt;/i&gt;&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;The most-often discussed example of erroneous markup is as
+  follows:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;p&gt;1&lt;b&gt;2&lt;i&gt;3&lt;/b&gt;4&lt;/i&gt;5&lt;/p&gt;&lt;/pre&gt;
+
+  &lt;p&gt;The parsing of this markup is straightforward up to the &quot;3&quot;. At
+  this point, the DOM looks like this:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;p&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;i&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;3&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;Here, the &lt;span&gt;stack of open elements&lt;/span&gt; has five elements
+  on it: &lt;code&gt;html&lt;/code&gt;, &lt;code&gt;body&lt;/code&gt;, &lt;code&gt;p&lt;/code&gt;,
+  &lt;code&gt;b&lt;/code&gt;, and &lt;code&gt;i&lt;/code&gt;. The &lt;span&gt;list of active
+  formatting elements&lt;/span&gt; just has two: &lt;code&gt;b&lt;/code&gt; and
+  &lt;code&gt;i&lt;/code&gt;. The &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span
+  title=&quot;insertion mode: in body&quot;&gt;in body&lt;/span&gt;&quot;.&lt;/p&gt;
+
+  &lt;p&gt;Upon receiving the end tag token with the tag name &quot;b&quot;, the &quot;&lt;a
+  href=&quot;#adoptionAgency&quot;&gt;adoption agency algorithm&lt;/a&gt;&quot; is
+  invoked. This is a simple case, in that the &lt;var title=&quot;&quot;&gt;formatting
+  element&lt;/var&gt; is the &lt;code&gt;b&lt;/code&gt; element, and there is no
+  &lt;var title=&quot;&quot;&gt;furthest block&lt;/var&gt;. Thus, the &lt;span&gt;stack of open
+  elements&lt;/span&gt; ends up with just three elements: &lt;code&gt;html&lt;/code&gt;,
+  &lt;code&gt;body&lt;/code&gt;, and &lt;code&gt;p&lt;/code&gt;, while the &lt;span&gt;list of
+  active formatting elements&lt;/span&gt; has just one: &lt;code&gt;i&lt;/code&gt;. The
+  DOM tree is unmodified at this point.&lt;/p&gt;
+
+  &lt;p&gt;The next token is a character (&quot;4&quot;), triggers the &lt;span
+  title=&quot;reconstruct the active formatting elements&quot;&gt;reconstruction of
+  the active formatting elements&lt;/span&gt;, in this case just the
+  &lt;code&gt;i&lt;/code&gt; element. A new &lt;code&gt;i&lt;/code&gt; element is thus created
+  for the &quot;4&quot; text node. After the end tag token for the &quot;i&quot; is also
+  received, and the &quot;5&quot; text node is inserted, the DOM looks as
+  follows:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;p&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;i&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;3&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;i&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;4&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;5&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+
+  &lt;h5&gt;Misnested tags: &lt;b&gt;&lt;p&gt;&lt;/b&gt;&lt;/p&gt;&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;A case similar to the previous one is the following:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;b&gt;1&lt;p&gt;2&lt;/b&gt;3&lt;/p&gt;&lt;/pre&gt;
+
+  &lt;p&gt;Up to the &quot;2&quot; the parsing here is straightforward:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;p&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;The interesting part is when the end tag token with the tag name
+  &quot;b&quot; is parsed.&lt;/p&gt;
+
+  &lt;p&gt;Before that token is seen, the &lt;span&gt;stack of open
+  elements&lt;/span&gt; has four elements on it: &lt;code&gt;html&lt;/code&gt;,
+  &lt;code&gt;body&lt;/code&gt;, &lt;code&gt;b&lt;/code&gt;, and &lt;code&gt;p&lt;/code&gt;. The
+  &lt;span&gt;list of active formatting elements&lt;/span&gt; just has the one:
+  &lt;code&gt;b&lt;/code&gt;. The &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span
+  title=&quot;insertion mode: in body&quot;&gt;in body&lt;/span&gt;&quot;.&lt;/p&gt;
+
+  &lt;p&gt;Upon receiving the end tag token with the tag name &quot;b&quot;, the &quot;&lt;a
+  href=&quot;#adoptionAgency&quot;&gt;adoption agency algorithm&lt;/a&gt;&quot; is invoked, as
+  in the previous example. However, in this case, there &lt;em&gt;is&lt;/em&gt; a
+  &lt;var title=&quot;&quot;&gt;furthest block&lt;/var&gt;, namely the &lt;code&gt;p&lt;/code&gt; element. Thus,
+  this time the adoption agency algorithm isn't skipped over.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt; is the &lt;code&gt;body&lt;/code&gt;
+  element. A conceptual &quot;bookmark&quot; marks the position of the
+  &lt;code&gt;b&lt;/code&gt; in the &lt;span&gt;list of active formatting
+  elements&lt;/span&gt;, but since that list has only one element in it,
+  it won't have much effect.&lt;/p&gt;
+
+  &lt;p&gt;As the algorithm progresses, &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; ends up set
+  to the formatting element (&lt;code&gt;b&lt;/code&gt;), and &lt;var title=&quot;&quot;&gt;last
+  node&lt;/var&gt; ends up set to the &lt;var title=&quot;&quot;&gt;furthest block&lt;/var&gt;
+  (&lt;code&gt;p&lt;/code&gt;).&lt;/p&gt;
+
+  &lt;p&gt;The &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt; gets appended (moved) to the
+  &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt;, so that the DOM looks like:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;p&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;A new &lt;code&gt;b&lt;/code&gt; element is created, and the children of the
+  &lt;code&gt;p&lt;/code&gt; element are moved to it:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;p&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;Finally, the new &lt;code&gt;b&lt;/code&gt; element is appended to the
+  &lt;code&gt;p&lt;/code&gt; element, so that the DOM looks like:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;p&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;The &lt;code&gt;b&lt;/code&gt; element is removed from the &lt;span&gt;list of
+  active formatting elements&lt;/span&gt; and the &lt;span&gt;stack of open
+  elements&lt;/span&gt;, so that when the &quot;3&quot; is parsed, it is appended to
+  the &lt;code&gt;p&lt;/code&gt; element:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;1&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;p&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;2&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;3&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+
+  &lt;h5&gt;Unexpected markup in tables&lt;/h5&gt;
+
+  &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
+
+  &lt;p&gt;Error handling in tables is, for historical reasons, especially
+  strange. For example, consider the following markup:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;table&gt;&lt;strong&gt;&lt;b&gt;&lt;/strong&gt;&lt;tr&gt;&lt;td&gt;aaa&lt;/td&gt;&lt;/tr&gt;&lt;strong&gt;bbb&lt;/strong&gt;&lt;/table&gt;ccc&lt;/pre&gt;
+
+  &lt;p&gt;The highlighted &lt;code&gt;b&lt;/code&gt; element start tag is not allowed
+  directly inside a table like that, and the parser handles this case
+  by placing the element &lt;em&gt;before&lt;/em&gt; the table. (This is called &lt;i
+  title=&quot;foster parent&quot;&gt;foster parenting&lt;/i&gt;.) This can be seen by
+  examining the DOM tree as it stands just after the
+  &lt;code&gt;table&lt;/code&gt; element's start tag has been seen:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;table&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;...and then immediately after the &lt;code&gt;b&lt;/code&gt; element start
+  tag has been seen:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;table&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;At this point, the &lt;span&gt;stack of open elements&lt;/span&gt; has on it
+  the elements &lt;code&gt;html&lt;/code&gt;, &lt;code&gt;body&lt;/code&gt;,
+  &lt;code&gt;table&lt;/code&gt;, and &lt;code&gt;b&lt;/code&gt; (in that order, despite the
+  resulting DOM tree); the &lt;span&gt;list of active formatting
+  elements&lt;/span&gt; just has the &lt;code&gt;b&lt;/code&gt; element in it; the
+  &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span title=&quot;insertion mode: in
+  table&quot;&gt;in table&lt;/span&gt;&quot;; and the &lt;code&gt;table&lt;/code&gt; element is
+  &lt;span&gt;tainted&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code&gt;tr&lt;/code&gt; start tag causes the &lt;code&gt;b&lt;/code&gt; element
+  to be popped off the stack and a &lt;code&gt;tbody&lt;/code&gt; start tag to be
+  implied; the &lt;code&gt;tbody&lt;/code&gt; and &lt;code&gt;tr&lt;/code&gt; elements are
+  then handled in a rather straight-forward manner, taking the parser
+  through the &quot;&lt;span title=&quot;insertion mode: in table body&quot;&gt;in table
+  body&lt;/span&gt;&quot; and &quot;&lt;span title=&quot;insertion mode: in row&quot;&gt;in
+  row&lt;/span&gt;&quot; insertion modes, after which the DOM looks as
+  follows:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;table&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tbody&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tr&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;Here, the &lt;span&gt;stack of open elements&lt;/span&gt; has on it the
+  elements &lt;code&gt;html&lt;/code&gt;, &lt;code&gt;body&lt;/code&gt;, &lt;code&gt;table&lt;/code&gt;,
+  &lt;code&gt;tbody&lt;/code&gt;, and &lt;code&gt;tr&lt;/code&gt;; the &lt;span&gt;list of active
+  formatting elements&lt;/span&gt; still has the &lt;code&gt;b&lt;/code&gt; element in
+  it; the &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span title=&quot;insertion mode:
+  in row&quot;&gt;in row&lt;/span&gt;&quot;; and the &lt;code&gt;table&lt;/code&gt; element is still
+  &lt;span&gt;tainted&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code&gt;td&lt;/code&gt; element start tag token, after putting a
+  &lt;code&gt;td&lt;/code&gt; element on the tree, puts a marker on the &lt;span&gt;list
+  of active formatting elements&lt;/span&gt; (it also switches to the &quot;&lt;span
+  title=&quot;insertion mode: in cell&quot;&gt;in cell&lt;/span&gt;&quot; &lt;span&gt;insertion
+  mode&lt;/span&gt;).&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;table&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tbody&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tr&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;td&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;The marker means that when the &quot;aaa&quot; character tokens are seen,
+  no &lt;code&gt;b&lt;/code&gt; element is created to hold the resulting text
+  node:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;table&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tbody&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tr&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;td&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;aaa&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;The end tags are handled in a straight-forward manner; after
+  handling them, the &lt;span&gt;stack of open elements&lt;/span&gt; has on it the
+  elements &lt;code&gt;html&lt;/code&gt;, &lt;code&gt;body&lt;/code&gt;, &lt;code&gt;table&lt;/code&gt;,
+  and &lt;code&gt;tbody&lt;/code&gt;; the &lt;span&gt;list of active formatting
+  elements&lt;/span&gt; still has the &lt;code&gt;b&lt;/code&gt; element in it (the
+  marker having been removed by the &quot;td&quot; end tag token); the
+  &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span title=&quot;insertion mode: in
+  table body&quot;&gt;in table body&lt;/span&gt;&quot;; and the &lt;code&gt;table&lt;/code&gt;
+  element is still &lt;span&gt;tainted&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;Thus it is that the &quot;bbb&quot; character tokens are found. When &lt;span
+  title=&quot;reconstruct the active formatting elements&quot;&gt;the active
+  formatting elements are reconstructed&lt;/span&gt;, a &lt;code&gt;b&lt;/code&gt;
+  element is created and &lt;span title=&quot;foster parent&quot;&gt;foster
+  parented&lt;/span&gt;, and then the &quot;bbb&quot; text node is appended to it:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;bbb&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;table&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tbody&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tr&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;td&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;aaa&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+  &lt;p&gt;The &lt;span&gt;stack of open elements&lt;/span&gt; has on it the elements
+  &lt;code&gt;html&lt;/code&gt;, &lt;code&gt;body&lt;/code&gt;, &lt;code&gt;table&lt;/code&gt;,
+  &lt;code&gt;tbody&lt;/code&gt;, and the new &lt;code&gt;b&lt;/code&gt; (again, note that
+  this doesn't match the resulting tree!); the &lt;span&gt;list of active
+  formatting elements&lt;/span&gt; has the new &lt;code&gt;b&lt;/code&gt; element in it;
+  the &lt;span&gt;insertion mode&lt;/span&gt; is still &quot;&lt;span title=&quot;insertion
+  mode: in table body&quot;&gt;in table body&lt;/span&gt;&quot;; and the
+  &lt;code&gt;table&lt;/code&gt; element is still &lt;span&gt;tainted&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;Had the character tokens been &lt;span title=&quot;space character&quot;&gt;space
+  characters&lt;/span&gt; instead of &quot;bbb&quot;, the result would have been the
+  same, but only because the table is &lt;span&gt;tainted&lt;/span&gt;. Had the
+  &lt;code&gt;b&lt;/code&gt; element's start tag been before the
+  &lt;code&gt;table&lt;/code&gt; instead of after, then the table wouldn't have
+  been &lt;span&gt;tainted&lt;/span&gt; and such &lt;span title=&quot;space
+  character&quot;&gt;space characters&lt;/span&gt; would just be appended to the
+  &lt;code&gt;tbody&lt;/code&gt; element.&lt;/p&gt;
+
+  &lt;p&gt;Finally, the &lt;code&gt;table&lt;/code&gt; is closed by a &quot;table&quot; end
+  tag. This pops all the nodes from the &lt;span&gt;stack of open
+  elements&lt;/span&gt; up to and including the &lt;code&gt;table&lt;/code&gt; element,
+  but it doesn't affect the &lt;span&gt;list of active formatting
+  elements&lt;/span&gt;, so the &quot;ccc&quot; character tokens after the table
+  result in yet another &lt;code&gt;b&lt;/code&gt; element being created, this
+  time after the table:&lt;/p&gt;
+
+  &lt;ul class=&quot;domTree&quot;&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;html&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;head&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;body&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;bbb&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;table&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tbody&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;tr&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;td&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;aaa&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&quot;t1&quot;&gt;&lt;code&gt;b&lt;/code&gt;&lt;ul&gt;&lt;li class=&quot;t3&quot;&gt;&lt;code&gt;#text&lt;/code&gt;: &lt;span title=&quot;&quot;&gt;ccc&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
+
+
+
+
   &lt;h3&gt;Namespaces&lt;/h3&gt;
 
   &lt;p&gt;The &lt;dfn&gt;HTML namespace&lt;/dfn&gt; is: &lt;code&gt;<A HREF="http://www.w3.org/1999/xhtml&lt;/code">http://www.w3.org/1999/xhtml&lt;/code</A>&gt;&lt;/p&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010181.html">[html5] r3303 - [e] (0) more cleanup
</A></li>
	<LI>Next message: <A HREF="010183.html">[html5] r3305 - [e] (0) spelling errors occurred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10182">[ date ]</a>
              <a href="thread.html#10182">[ thread ]</a>
              <a href="subject.html#10182">[ subject ]</a>
              <a href="author.html#10182">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
