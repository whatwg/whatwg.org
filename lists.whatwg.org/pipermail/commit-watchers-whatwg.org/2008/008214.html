<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1312 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1312%20-%20/&In-Reply-To=%3C20080303022633.AFDB2139DDD%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008213.html">
   <LINK REL="Next"  HREF="008215.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1312 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1312%20-%20/&In-Reply-To=%3C20080303022633.AFDB2139DDD%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1312 - /">whatwg at whatwg.org
       </A><BR>
    <I>Sun Mar  2 18:26:33 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008213.html">[html5] r1311 - /
</A></li>
        <LI>Next message: <A HREF="008215.html">[html5] r1313 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8214">[ date ]</a>
              <a href="thread.html#8214">[ thread ]</a>
              <a href="subject.html#8214">[ subject ]</a>
              <a href="author.html#8214">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-03-02 18:26:32 -0800 (Sun, 02 Mar 2008)
New Revision: 1312

Modified:
   index
   source
Log:
[act] (2) Merged phases and insertion modes. Theoretically, this should make absolutely no difference. Please let me know the many ways in which I screwed up.

Modified: index
===================================================================
--- index	2008-03-03 01:11:51 UTC (rev 1311)
+++ index	2008-03-03 02:26:32 UTC (rev 1312)
@@ -1602,82 +1602,81 @@
        &lt;li&gt;&lt;a href=&quot;#tree-construction&quot;&gt;&lt;span class=secno&gt;8.2.4 &lt;/span&gt;Tree
         construction&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#the-main&quot;&gt;&lt;span class=secno&gt;8.2.4.1. &lt;/span&gt;The main
-          phase&lt;/a&gt;
-          &lt;ul class=toc&gt;
-           &lt;li&gt;&lt;a href=&quot;#the-stack&quot;&gt;&lt;span class=secno&gt;8.2.4.1.1. &lt;/span&gt;The
-            stack of open elements&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#the-stack&quot;&gt;&lt;span class=secno&gt;8.2.4.1. &lt;/span&gt;The stack
+          of open elements&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#the-list&quot;&gt;&lt;span class=secno&gt;8.2.4.1.2. &lt;/span&gt;The
-            list of active formatting elements&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#the-list&quot;&gt;&lt;span class=secno&gt;8.2.4.2. &lt;/span&gt;The list
+          of active formatting elements&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#creating&quot;&gt;&lt;span class=secno&gt;8.2.4.1.3.
-            &lt;/span&gt;Creating and inserting HTML elements&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#creating&quot;&gt;&lt;span class=secno&gt;8.2.4.3. &lt;/span&gt;Creating
+          and inserting HTML elements&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#closing&quot;&gt;&lt;span class=secno&gt;8.2.4.1.4. &lt;/span&gt;Closing
-            elements that have implied end tags&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#closing&quot;&gt;&lt;span class=secno&gt;8.2.4.4. &lt;/span&gt;Closing
+          elements that have implied end tags&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#the-element&quot;&gt;&lt;span class=secno&gt;8.2.4.1.5. &lt;/span&gt;The
-            element pointers&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#the-element&quot;&gt;&lt;span class=secno&gt;8.2.4.5. &lt;/span&gt;The
+          element pointers&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#the-insertion&quot;&gt;&lt;span class=secno&gt;8.2.4.1.6.
-            &lt;/span&gt;The insertion mode&lt;/a&gt;
-          &lt;/ul&gt;
+         &lt;li&gt;&lt;a href=&quot;#the-insertion&quot;&gt;&lt;span class=secno&gt;8.2.4.6. &lt;/span&gt;The
+          insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#the-initial&quot;&gt;&lt;span class=secno&gt;8.2.4.2. &lt;/span&gt;The
-          initial phase&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#the-initial&quot;&gt;&lt;span class=secno&gt;8.2.4.7. &lt;/span&gt;The
+          initial insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#the-root0&quot;&gt;&lt;span class=secno&gt;8.2.4.3. &lt;/span&gt;The root
-          element phase&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#the-root0&quot;&gt;&lt;span class=secno&gt;8.2.4.8. &lt;/span&gt;The root
+          element insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#the-before&quot;&gt;&lt;span class=secno&gt;8.2.4.4. &lt;/span&gt;The
+         &lt;li&gt;&lt;a href=&quot;#the-before&quot;&gt;&lt;span class=secno&gt;8.2.4.9. &lt;/span&gt;The
           before head insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-inhead&quot;&gt;&lt;span class=secno&gt;8.2.4.5.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-inhead&quot;&gt;&lt;span class=secno&gt;8.2.4.10.
           &lt;/span&gt;The in head insertion mode&lt;/a&gt;
 
          &lt;li&gt;&lt;a href=&quot;#parsing-main-inheadnoscript&quot;&gt;&lt;span
-          class=secno&gt;8.2.4.6. &lt;/span&gt;The in head noscript insertion mode&lt;/a&gt;
-          
+          class=secno&gt;8.2.4.11. &lt;/span&gt;The in head noscript insertion
+          mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#the-after&quot;&gt;&lt;span class=secno&gt;8.2.4.7. &lt;/span&gt;The after
-          head insertion mode&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#the-after&quot;&gt;&lt;span class=secno&gt;8.2.4.12. &lt;/span&gt;The
+          after head insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-inbody&quot;&gt;&lt;span class=secno&gt;8.2.4.8.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-inbody&quot;&gt;&lt;span class=secno&gt;8.2.4.13.
           &lt;/span&gt;The in body insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-intable&quot;&gt;&lt;span class=secno&gt;8.2.4.9.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-intable&quot;&gt;&lt;span class=secno&gt;8.2.4.14.
           &lt;/span&gt;The in table insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-incaption&quot;&gt;&lt;span class=secno&gt;8.2.4.10.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-incaption&quot;&gt;&lt;span class=secno&gt;8.2.4.15.
           &lt;/span&gt;The in caption insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-incolgroup&quot;&gt;&lt;span class=secno&gt;8.2.4.11.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-incolgroup&quot;&gt;&lt;span class=secno&gt;8.2.4.16.
           &lt;/span&gt;The in column group insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-intbody&quot;&gt;&lt;span class=secno&gt;8.2.4.12.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-intbody&quot;&gt;&lt;span class=secno&gt;8.2.4.17.
           &lt;/span&gt;The in table body insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-intr&quot;&gt;&lt;span class=secno&gt;8.2.4.13.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-intr&quot;&gt;&lt;span class=secno&gt;8.2.4.18.
           &lt;/span&gt;The in row insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-intd&quot;&gt;&lt;span class=secno&gt;8.2.4.14.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-intd&quot;&gt;&lt;span class=secno&gt;8.2.4.19.
           &lt;/span&gt;The in cell insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-inselect&quot;&gt;&lt;span class=secno&gt;8.2.4.15.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-inselect&quot;&gt;&lt;span class=secno&gt;8.2.4.20.
           &lt;/span&gt;The in select insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-afterbody&quot;&gt;&lt;span class=secno&gt;8.2.4.16.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-afterbody&quot;&gt;&lt;span class=secno&gt;8.2.4.21.
           &lt;/span&gt;The after body insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-inframeset&quot;&gt;&lt;span class=secno&gt;8.2.4.17.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-inframeset&quot;&gt;&lt;span class=secno&gt;8.2.4.22.
           &lt;/span&gt;The in frameset insertion mode&lt;/a&gt;
 
          &lt;li&gt;&lt;a href=&quot;#parsing-main-afterframeset&quot;&gt;&lt;span
-          class=secno&gt;8.2.4.18. &lt;/span&gt;The after frameset insertion mode&lt;/a&gt;
+          class=secno&gt;8.2.4.23. &lt;/span&gt;The after frameset insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#the-trailing&quot;&gt;&lt;span class=secno&gt;8.2.4.19. &lt;/span&gt;The
-          trailing end phase&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#the-after0&quot;&gt;&lt;span class=secno&gt;8.2.4.24. &lt;/span&gt;The
+          after after body insertion mode&lt;/a&gt;
+
+         &lt;li&gt;&lt;a href=&quot;#the-after1&quot;&gt;&lt;span class=secno&gt;8.2.4.25. &lt;/span&gt;The
+          after after frameset insertion mode&lt;/a&gt;
         &lt;/ul&gt;
 
        &lt;li&gt;&lt;a href=&quot;#the-unexpected&quot;&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The
@@ -40436,13 +40435,9 @@
    is created. The &quot;output&quot; of this stage consists of dynamically modifying
    or extending that document's DOM tree.
 
-  &lt;p&gt;Tree construction passes through several phases. Initially, UAs must act
-   according to the steps described as being those of &lt;a
-   href=&quot;#the-initial0&quot;&gt;the initial phase&lt;/a&gt;.
-
   &lt;p&gt;This specification does not define when an interactive user agent has to
-   render the &lt;code&gt;Document&lt;/code&gt; available to the user, or when it has to
-   begin accepting user input.
+   render the &lt;code&gt;Document&lt;/code&gt; so that it is available to the user, or
+   when it has to begin accepting user input.
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=append&gt;append a
    character&lt;/dfn&gt; to a node, the UA must collect it and all subsequent
@@ -40474,37 +40469,39 @@
    href=&quot;#hardwareLimitations&quot;&gt;practical concerns&lt;/a&gt; will likely force user
    agents to impose nesting depths.
 
-  &lt;h5 id=the-main&gt;&lt;span class=secno&gt;8.2.4.1. &lt;/span&gt;&lt;dfn id=the-main0&gt;The
-   main phase&lt;/dfn&gt;&lt;/h5&gt;
-
-  &lt;p&gt;After &lt;a href=&quot;#the-root1&quot;&gt;the root element phase&lt;/a&gt;, each token
-   emitted from the &lt;a href=&quot;#tokenisation0&quot;&gt;tokenisation&lt;/a&gt; stage must be
-   processed as described in &lt;em&gt;this&lt;/em&gt; section. This is by far the most
-   involved part of parsing an HTML document.
-
-  &lt;p&gt;The tree construction stage in this phase has several pieces of state: a
-   &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;, a &lt;a href=&quot;#list-of4&quot;&gt;list of
+  &lt;p&gt;The tree construction stage has several pieces of state: a &lt;a
+   href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;, a &lt;a href=&quot;#list-of4&quot;&gt;list of
    active formatting elements&lt;/a&gt;, a &lt;a href=&quot;#head-element&quot;&gt;&lt;code
    title=&quot;&quot;&gt;head&lt;/code&gt; element pointer&lt;/a&gt;, a &lt;a href=&quot;#form-element&quot;&gt;&lt;code
    title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt;, and an &lt;a
    href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt;.
 
-  &lt;p class=big-issue&gt;We could just fold insertion modes and phases into one
-   concept (and duplicate the two rules common to all insertion modes into
-   all of them).
+  &lt;p&gt;As each token is emitted from the tokeniser, the user agent must process
+   the token according to the rules given in the section corresponding to the
+   current &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt;.
 
-  &lt;h6 id=the-stack&gt;&lt;span class=secno&gt;8.2.4.1.1. &lt;/span&gt;The stack of open
-   elements&lt;/h6&gt;
+  &lt;h5 id=the-stack&gt;&lt;span class=secno&gt;8.2.4.1. &lt;/span&gt;The stack of open
+   elements&lt;/h5&gt;
 
-  &lt;p&gt;Initially the &lt;dfn id=stack&gt;stack of open elements&lt;/dfn&gt; contains just
-   the &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; root element node created in the
-   &lt;a href=&quot;#the-root1&quot; title=&quot;the root element phase&quot;&gt;last phase&lt;/a&gt; before
-   switching to &lt;em&gt;this&lt;/em&gt; phase (or, in the &lt;a href=&quot;#fragment&quot;&gt;fragment
-   case&lt;/a&gt;, the &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element created as
-   part of &lt;a href=&quot;#html-fragment0&quot; title=&quot;html fragment parsing
-   algorithm&quot;&gt;that algorithm&lt;/a&gt;). That's the topmost node of the stack. It
-   never gets popped off the stack. (This stack grows downwards.)
+  &lt;p&gt;Initially the &lt;dfn id=stack&gt;stack of open elements&lt;/dfn&gt; is empty.
 
+  &lt;p&gt;The &lt;a href=&quot;#root-element0&quot; title=&quot;insertion mode: root element&quot;&gt;root
+   element insertion mode&lt;/a&gt; creates the &lt;code&gt;&lt;a
+   href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; root element node, which is then added to the
+   stack.
+
+  &lt;p&gt;In the &lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;, the &lt;a href=&quot;#stack&quot;&gt;stack
+   of open elements&lt;/a&gt; is initialised to contain an &lt;code&gt;&lt;a
+   href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element that is created as part of &lt;a
+   href=&quot;#html-fragment0&quot; title=&quot;html fragment parsing algorithm&quot;&gt;that
+   algorithm&lt;/a&gt;. (The &lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt; skips the &lt;a
+   href=&quot;#root-element0&quot; title=&quot;insertion mode: root element&quot;&gt;root element
+   insertion mode&lt;/a&gt;.)
+
+  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; node, however it is created,
+   is the topmost node of the stack. It never gets popped off the stack.
+   (This stack grows downwards.)
+
   &lt;p&gt;The &lt;dfn id=current4&gt;current node&lt;/dfn&gt; is the bottommost node in this
    stack.
 
@@ -40653,8 +40650,8 @@
    misnested formatting elements&lt;/a&gt;), the stack is manipulated in a
    random-access fashion.
 
-  &lt;h6 id=the-list&gt;&lt;span class=secno&gt;8.2.4.1.2. &lt;/span&gt;The list of active
-   formatting elements&lt;/h6&gt;
+  &lt;h5 id=the-list&gt;&lt;span class=secno&gt;8.2.4.2. &lt;/span&gt;The list of active
+   formatting elements&lt;/h5&gt;
 
   &lt;p&gt;Initially the &lt;dfn id=list-of4&gt;list of active formatting elements&lt;/dfn&gt;
    is empty. It is used to handle mis-nested &lt;a href=&quot;#formatting&quot;
@@ -40742,8 +40739,8 @@
    &lt;li&gt;Go to step 1.
   &lt;/ol&gt;
 
-  &lt;h6 id=creating&gt;&lt;span class=secno&gt;8.2.4.1.3. &lt;/span&gt;Creating and inserting
-   HTML elements&lt;/h6&gt;
+  &lt;h5 id=creating&gt;&lt;span class=secno&gt;8.2.4.3. &lt;/span&gt;Creating and inserting
+   HTML elements&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=create title=&quot;create an
    element for the token&quot;&gt;create an element for a token&lt;/dfn&gt;, the UA must
@@ -40814,8 +40811,8 @@
      error&lt;/a&gt;.
   &lt;/ol&gt;
 
-  &lt;h6 id=closing&gt;&lt;span class=secno&gt;8.2.4.1.4. &lt;/span&gt;Closing elements that
-   have implied end tags&lt;/h6&gt;
+  &lt;h5 id=closing&gt;&lt;span class=secno&gt;8.2.4.4. &lt;/span&gt;Closing elements that have
+   implied end tags&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=generate&gt;generate implied
    end tags&lt;/dfn&gt;, then, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is a
@@ -40835,7 +40832,7 @@
    element to exclude from the process, then the UA must perform the above
    steps as if that element was not in the above list.
 
-  &lt;h6 id=the-element&gt;&lt;span class=secno&gt;8.2.4.1.5. &lt;/span&gt;The element pointers&lt;/h6&gt;
+  &lt;h5 id=the-element&gt;&lt;span class=secno&gt;8.2.4.5. &lt;/span&gt;The element pointers&lt;/h5&gt;
 
   &lt;p&gt;Initially the &lt;dfn id=head-element&gt;&lt;code title=&quot;&quot;&gt;head&lt;/code&gt; element
    pointer&lt;/dfn&gt; and the &lt;dfn id=form-element&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt;
@@ -40851,12 +40848,13 @@
    associate with forms in the face of dramatically bad markup, for
    historical reasons.
 
-  &lt;h6 id=the-insertion&gt;&lt;span class=secno&gt;8.2.4.1.6. &lt;/span&gt;The insertion mode&lt;/h6&gt;
+  &lt;h5 id=the-insertion&gt;&lt;span class=secno&gt;8.2.4.6. &lt;/span&gt;The insertion mode&lt;/h5&gt;
 
   &lt;p&gt;Initially the &lt;dfn id=insertion0&gt;insertion mode&lt;/dfn&gt; is &quot;&lt;a
-   href=&quot;#before4&quot; title=&quot;insertion mode: before head&quot;&gt;before head&lt;/a&gt;&quot;. It
-   can change to &quot;&lt;a href=&quot;#in-head&quot; title=&quot;insertion mode: in head&quot;&gt;in
-   head&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-head0&quot; title=&quot;insertion mode: in head
+   href=&quot;#initial&quot; title=&quot;insertion mode: initial&quot;&gt;initial&lt;/a&gt;&quot;. It can
+   change to &quot;&lt;a href=&quot;#root-element0&quot; title=&quot;insertion mode: root
+   element&quot;&gt;root element&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-head&quot; title=&quot;insertion mode: in
+   head&quot;&gt;in head&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-head0&quot; title=&quot;insertion mode: in head
    noscript&quot;&gt;in head noscript&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#after4&quot; title=&quot;insertion mode:
    after head&quot;&gt;after head&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
    body&quot;&gt;in body&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-table&quot; title=&quot;insertion mode: in
@@ -40869,15 +40867,12 @@
    title=&quot;insertion mode: in select&quot;&gt;in select&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#after5&quot;
    title=&quot;insertion mode: after body&quot;&gt;after body&lt;/a&gt;&quot;, &quot;&lt;a
    href=&quot;#in-frameset&quot; title=&quot;insertion mode: in frameset&quot;&gt;in frameset&lt;/a&gt;&quot;,
-   and &quot;&lt;a href=&quot;#after6&quot; title=&quot;insertion mode: after frameset&quot;&gt;after
-   frameset&lt;/a&gt;&quot; during the course of the parsing, as described below. It
-   affects how certain tokens are processed.
+   &quot;&lt;a href=&quot;#after6&quot; title=&quot;insertion mode: after frameset&quot;&gt;after
+   frameset&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#after7&quot; title=&quot;insertion mode: after after
+   body&quot;&gt;after after body&lt;/a&gt;&quot;, and &quot;&lt;a href=&quot;#after8&quot; title=&quot;insertion mode:
+   after after frameset&quot;&gt;after after frameset&lt;/a&gt;&quot; during the course of the
+   parsing, as described below. It affects how certain tokens are processed.
 
-  &lt;p&gt;If the tree construction stage is switched from &lt;a href=&quot;#the-main0&quot;&gt;the
-   main phase&lt;/a&gt; to &lt;a href=&quot;#the-trailing0&quot;&gt;the trailing end phase&lt;/a&gt; and
-   back again, the various pieces of state are not reset; the UA must act as
-   if the state was maintained.
-
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=reset&gt;reset the insertion
    mode appropriately&lt;/dfn&gt;, it means the UA must follow these steps:
 
@@ -41027,14 +41022,11 @@
   &lt;/ol&gt;
 --&gt;
 
-  &lt;p&gt;`
+  &lt;h5 id=the-initial&gt;&lt;span class=secno&gt;8.2.4.7. &lt;/span&gt;The &lt;dfn id=initial
+   title=&quot;insertion mode: initial&quot;&gt;initial&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
-  &lt;h5 id=the-initial&gt;&lt;span class=secno&gt;8.2.4.2. &lt;/span&gt;&lt;dfn
-   id=the-initial0&gt;The initial phase&lt;/dfn&gt;&lt;/h5&gt;
+  &lt;p&gt;Handle the token as follows:
 
-  &lt;p&gt;Initially, the tree construction stage must handle each token emitted
-   from the &lt;a href=&quot;#tokenisation0&quot;&gt;tokenisation&lt;/a&gt; stage as follows:
-
   &lt;dl class=switch&gt;
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
@@ -41335,8 +41327,9 @@
      compared to the values given in the lists above in a
      case-insensitive&lt;!-- ASCII --&gt; manner.&lt;/p&gt;
 
-    &lt;p&gt;Then, switch to &lt;a href=&quot;#the-root1&quot;&gt;the root element phase&lt;/a&gt; of the
-     tree construction stage.&lt;/p&gt;
+    &lt;p&gt;Then, change the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
+     href=&quot;#root-element0&quot; title=&quot;insertion mode: root element&quot;&gt;root
+     element&lt;/a&gt;&quot;.&lt;/p&gt;
 
    &lt;dt&gt;A start tag token
 
@@ -41353,16 +41346,16 @@
 
     &lt;p&gt;Set the document to &lt;a href=&quot;#quirks&quot;&gt;quirks mode&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Then, switch to &lt;a href=&quot;#the-root1&quot;&gt;the root element phase&lt;/a&gt; of the
-     tree construction stage and reprocess the current token.&lt;/p&gt;
+    &lt;p&gt;Then, change the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
+     href=&quot;#root-element0&quot; title=&quot;insertion mode: root element&quot;&gt;root
+     element&lt;/a&gt;&quot;.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=the-root0&gt;&lt;span class=secno&gt;8.2.4.3. &lt;/span&gt;&lt;dfn id=the-root1&gt;The
-   root element phase&lt;/dfn&gt;&lt;/h5&gt;
+  &lt;h5 id=the-root0&gt;&lt;span class=secno&gt;8.2.4.8. &lt;/span&gt;The &lt;dfn
+   id=root-element0 title=&quot;insertion mode: root element&quot;&gt;root element&lt;/dfn&gt;
+   insertion mode&lt;/h5&gt;
 
-  &lt;p&gt;After &lt;a href=&quot;#the-initial0&quot;&gt;the initial phase&lt;/a&gt;, as each token is
-   emitted from the &lt;a href=&quot;#tokenisation0&quot;&gt;tokenisation&lt;/a&gt; stage, it must
-   be processed as described in this section.
+  &lt;p&gt;Handle the token as follows:
 
   &lt;dl class=switch&gt;
    &lt;dt&gt;A DOCTYPE token
@@ -41407,9 +41400,11 @@
     &lt;p&gt;Create an &lt;code&gt;&lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt; node
      with the tag name &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt;, in the &lt;a
      href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;. Append it to the
-     &lt;code&gt;Document&lt;/code&gt; object. Switch to &lt;a href=&quot;#the-main0&quot;&gt;the main
-     phase&lt;/a&gt; and reprocess the current token.&lt;/p&gt;
+     &lt;code&gt;Document&lt;/code&gt; object.&lt;/p&gt;
 
+    &lt;p&gt;Change the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
+     href=&quot;#before4&quot; title=&quot;insertion mode: before head&quot;&gt;before head&lt;/a&gt;&quot;.&lt;/p&gt;
+
     &lt;p class=big-issue&gt;Should probably make end tags be ignored, so that
      &quot;&lt;/head&gt;&lt;!-- --&gt;&lt;html&gt;&quot; puts the comment before the root node
      (or should we?)&lt;/p&gt;
@@ -41420,7 +41415,7 @@
    content continues being appended to the nodes as described in the next
    section.
 
-  &lt;h5 id=the-before&gt;&lt;span class=secno&gt;8.2.4.4. &lt;/span&gt;The &lt;dfn id=before4
+  &lt;h5 id=the-before&gt;&lt;span class=secno&gt;8.2.4.9. &lt;/span&gt;The &lt;dfn id=before4
    title=&quot;insertion mode: before head&quot;&gt;before head&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;Handle the token as follows:
@@ -41513,7 +41508,7 @@
      after head&quot;&gt;after head&lt;/a&gt;&quot; &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt;.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-inhead&gt;&lt;span class=secno&gt;8.2.4.5. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-inhead&gt;&lt;span class=secno&gt;8.2.4.10. &lt;/span&gt;The &lt;dfn
    id=in-head title=&quot;insertion mode: in head&quot;&gt;in head&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;Handle the token as follows.
@@ -41764,7 +41759,7 @@
      get put into the head. Do we want to copy that?&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-inheadnoscript&gt;&lt;span class=secno&gt;8.2.4.6. &lt;/span&gt;The
+  &lt;h5 id=parsing-main-inheadnoscript&gt;&lt;span class=secno&gt;8.2.4.11. &lt;/span&gt;The
    &lt;dfn id=in-head0 title=&quot;insertion mode: in head noscript&quot;&gt;in head
    noscript&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
@@ -41832,7 +41827,7 @@
      name &quot;noscript&quot; had been seen and reprocess the current token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=the-after&gt;&lt;span class=secno&gt;8.2.4.7. &lt;/span&gt;The &lt;dfn id=after4
+  &lt;h5 id=the-after&gt;&lt;span class=secno&gt;8.2.4.12. &lt;/span&gt;The &lt;dfn id=after4
    title=&quot;insertion mode: after head&quot;&gt;after head&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;Handle the token as follows:
@@ -41915,7 +41910,7 @@
      had been seen, and then reprocess the current token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-inbody&gt;&lt;span class=secno&gt;8.2.4.8. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-inbody&gt;&lt;span class=secno&gt;8.2.4.13. &lt;/span&gt;The &lt;dfn
    id=in-body title=&quot;insertion mode: in body&quot;&gt;in body&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;Handle the token as follows:
@@ -42871,7 +42866,7 @@
     &lt;/ol&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-intable&gt;&lt;span class=secno&gt;8.2.4.9. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-intable&gt;&lt;span class=secno&gt;8.2.4.14. &lt;/span&gt;The &lt;dfn
    id=in-table title=&quot;insertion mode: in table&quot;&gt;in table&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
   &lt;dl class=switch&gt;
@@ -43048,7 +43043,7 @@
    href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element after this process is a &lt;a
    href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;.
 
-  &lt;h5 id=parsing-main-incaption&gt;&lt;span class=secno&gt;8.2.4.10. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-incaption&gt;&lt;span class=secno&gt;8.2.4.15. &lt;/span&gt;The &lt;dfn
    id=in-caption title=&quot;insertion mode: in caption&quot;&gt;in caption&lt;/dfn&gt;
    insertion mode&lt;/h5&gt;
 
@@ -43108,7 +43103,7 @@
      was &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-incolgroup&gt;&lt;span class=secno&gt;8.2.4.11. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-incolgroup&gt;&lt;span class=secno&gt;8.2.4.16. &lt;/span&gt;The &lt;dfn
    id=in-column title=&quot;insertion mode: in column group&quot;&gt;in column group&lt;/dfn&gt;
    insertion mode&lt;/h5&gt;
 
@@ -43184,7 +43179,7 @@
      href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-intbody&gt;&lt;span class=secno&gt;8.2.4.12. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-intbody&gt;&lt;span class=secno&gt;8.2.4.17. &lt;/span&gt;The &lt;dfn
    id=in-table0 title=&quot;insertion mode: in table body&quot;&gt;in table body&lt;/dfn&gt;
    insertion mode&lt;/h5&gt;
 
@@ -43274,7 +43269,7 @@
    href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element after this process is a &lt;a
    href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;.
 
-  &lt;h5 id=parsing-main-intr&gt;&lt;span class=secno&gt;8.2.4.13. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-intr&gt;&lt;span class=secno&gt;8.2.4.18. &lt;/span&gt;The &lt;dfn
    id=in-row title=&quot;insertion mode: in row&quot;&gt;in row&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;Handle the token as follows.
@@ -43363,7 +43358,7 @@
    href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element after this process is a &lt;a
    href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;.
 
-  &lt;h5 id=parsing-main-intd&gt;&lt;span class=secno&gt;8.2.4.14. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-intd&gt;&lt;span class=secno&gt;8.2.4.19. &lt;/span&gt;The &lt;dfn
    id=in-cell title=&quot;insertion mode: in cell&quot;&gt;in cell&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;Handle the token as follows.
@@ -43462,7 +43457,7 @@
    neither when the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; is &quot;&lt;a
    href=&quot;#in-cell&quot; title=&quot;insertion mode: in cell&quot;&gt;in cell&lt;/a&gt;&quot;.
 
-  &lt;h5 id=parsing-main-inselect&gt;&lt;span class=secno&gt;8.2.4.15. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-inselect&gt;&lt;span class=secno&gt;8.2.4.20. &lt;/span&gt;The &lt;dfn
    id=in-select title=&quot;insertion mode: in select&quot;&gt;in select&lt;/dfn&gt; insertion
    mode&lt;/h5&gt;
 
@@ -43581,7 +43576,7 @@
     &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-afterbody&gt;&lt;span class=secno&gt;8.2.4.16. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-afterbody&gt;&lt;span class=secno&gt;8.2.4.21. &lt;/span&gt;The &lt;dfn
    id=after5 title=&quot;insertion mode: after body&quot;&gt;after body&lt;/dfn&gt; insertion
    mode&lt;/h5&gt;
 
@@ -43632,8 +43627,9 @@
      an &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element in this case.) (&lt;a
      href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, switch to &lt;a href=&quot;#the-trailing0&quot;&gt;the trailing end
-     phase&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;Then, change the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
+     href=&quot;#after7&quot; title=&quot;insertion mode: after after body&quot;&gt;after after
+     body&lt;/a&gt;&quot;.&lt;/p&gt;
 
    &lt;dt&gt;Anything else
 
@@ -43643,7 +43639,7 @@
      title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot; and reprocess the token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-inframeset&gt;&lt;span class=secno&gt;8.2.4.17. &lt;/span&gt;The &lt;dfn
+  &lt;h5 id=parsing-main-inframeset&gt;&lt;span class=secno&gt;8.2.4.22. &lt;/span&gt;The &lt;dfn
    id=in-frameset title=&quot;insertion mode: in frameset&quot;&gt;in frameset&lt;/dfn&gt;
    insertion mode&lt;/h5&gt;
 
@@ -43726,7 +43722,7 @@
     &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-afterframeset&gt;&lt;span class=secno&gt;8.2.4.18. &lt;/span&gt;The
+  &lt;h5 id=parsing-main-afterframeset&gt;&lt;span class=secno&gt;8.2.4.23. &lt;/span&gt;The
    &lt;dfn id=after6 title=&quot;insertion mode: after frameset&quot;&gt;after frameset&lt;/dfn&gt;
    insertion mode&lt;/h5&gt;
 
@@ -43768,7 +43764,9 @@
    &lt;dt&gt;An end tag whose tag name is &quot;html&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;Switch to &lt;a href=&quot;#the-trailing0&quot;&gt;the trailing end phase&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;Change the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
+     href=&quot;#after8&quot; title=&quot;insertion mode: after after frameset&quot;&gt;after after
+     frameset&lt;/a&gt;&quot;.&lt;/p&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;noframes&quot;
 
@@ -43787,18 +43785,17 @@
    that do support frames but want to show the NOFRAMES content. Supporting
    the former is easy; supporting the latter is harder.
 
-  &lt;h5 id=the-trailing&gt;&lt;span class=secno&gt;8.2.4.19. &lt;/span&gt;&lt;dfn
-   id=the-trailing0&gt;The trailing end phase&lt;/dfn&gt;&lt;/h5&gt;
+  &lt;h5 id=the-after0&gt;&lt;span class=secno&gt;8.2.4.24. &lt;/span&gt;The &lt;dfn id=after7
+   title=&quot;insertion mode: after after body&quot;&gt;after after body&lt;/dfn&gt; insertion
+   mode&lt;/h5&gt;
 
-  &lt;p&gt;After &lt;a href=&quot;#the-main0&quot;&gt;the main phase&lt;/a&gt;, as each token is emitted
-   from the &lt;a href=&quot;#tokenisation0&quot;&gt;tokenisation&lt;/a&gt; stage, it must be
-   processed as described in this section.
+  &lt;p&gt;Handle the token as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;A DOCTYPE token
+   &lt;dt&gt;An end-of-file token
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#stops0&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt&gt;A comment token
 
@@ -43807,35 +43804,66 @@
      with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in
      the comment token.&lt;/p&gt;
 
+   &lt;dt&gt;A DOCTYPE token
+
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
 
+   &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
    &lt;dd&gt;
-    &lt;p&gt;Process the token as it would be processed in &lt;a href=&quot;#the-main0&quot;&gt;the
-     main phase&lt;/a&gt;.&lt;/p&gt;
-    &lt;!-- if there was a &lt;body&gt;, the space will go
-    into it, otherwise (e.g. if there was a &lt;frameset&gt;) it'll go into
-    the &lt;html&gt; node (this is important in case we have &quot;foo&lt;/html&gt;
-    bar&quot;, as we don't want that to become one word) --&gt;
-    
+    &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt;
+     had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in body&quot;&gt;in
+     body&lt;/a&gt;&quot;.&lt;/p&gt;
 
-   &lt;dt&gt;A character token that is &lt;em&gt;not&lt;/em&gt; one of U+0009 CHARACTER
-    TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM
-    FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
+   &lt;dt&gt;Anything else
 
-   &lt;dt&gt;A start tag token
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the &lt;a
+     href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a href=&quot;#in-body&quot;
+     title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot; and reprocess the token.&lt;/p&gt;
+  &lt;/dl&gt;
 
-   &lt;dt&gt;An end tag token
+  &lt;h5 id=the-after1&gt;&lt;span class=secno&gt;8.2.4.25. &lt;/span&gt;The &lt;dfn id=after8
+   title=&quot;insertion mode: after after frameset&quot;&gt;after after frameset&lt;/dfn&gt;
+   insertion mode&lt;/h5&gt;
 
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch back to &lt;a
-     href=&quot;#the-main0&quot;&gt;the main phase&lt;/a&gt; and reprocess the token.&lt;/p&gt;
+  &lt;p&gt;Handle the token as follows:
 
+  &lt;dl class=switch&gt;
    &lt;dt&gt;An end-of-file token
 
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=&quot;#stops0&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;dt&gt;A comment token
+
+   &lt;dd&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;code&gt;Document&lt;/code&gt; object
+     with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in
+     the comment token.&lt;/p&gt;
+
+   &lt;dt&gt;A DOCTYPE token
+
+   &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
+    U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
+    &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
+
+   &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+   &lt;dd&gt;
+    &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt;
+     had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in body&quot;&gt;in
+     body&lt;/a&gt;&quot;.&lt;/p&gt;
+
+   &lt;dt&gt;Anything else
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the &lt;a
+     href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a href=&quot;#in-frameset&quot;
+     title=&quot;insertion mode: in frameset&quot;&gt;in frameset&lt;/a&gt;&quot; and reprocess the
+     token.&lt;/p&gt;
   &lt;/dl&gt;
 
   &lt;h4 id=the-unexpected&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The unexpected end&lt;/h4&gt;
@@ -44245,11 +44273,6 @@
     &lt;/dl&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Switch the &lt;a href=&quot;#html-0&quot;&gt;HTML parser&lt;/a&gt;'s &lt;a
-     href=&quot;#tree-construction0&quot;&gt;tree construction&lt;/a&gt; stage to &lt;a
-     href=&quot;#the-main0&quot;&gt;the main phase&lt;/a&gt;.
-
-   &lt;li&gt;
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be a new &lt;code&gt;&lt;a
      href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element with no attributes.&lt;/p&gt;
 

Modified: source
===================================================================
--- source	2008-03-03 01:11:51 UTC (rev 1311)
+++ source	2008-03-03 02:26:32 UTC (rev 1312)
@@ -37722,13 +37722,9 @@
   parser is created. The &quot;output&quot; of this stage consists of
   dynamically modifying or extending that document's DOM tree.&lt;/p&gt;
 
-  &lt;p&gt;Tree construction passes through several phases. Initially, UAs
-  must act according to the steps described as being those of
-  &lt;span&gt;the initial phase&lt;/span&gt;.&lt;/p&gt;
-
   &lt;p&gt;This specification does not define when an interactive user agent
-  has to render the &lt;code&gt;Document&lt;/code&gt; available to the user, or
-  when it has to begin accepting user input.&lt;/p&gt;
+  has to render the &lt;code&gt;Document&lt;/code&gt; so that it is available to
+  the user, or when it has to begin accepting user input.&lt;/p&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;append a
   character&lt;/dfn&gt; to a node, the UA must collect it and all subsequent
@@ -37758,36 +37754,36 @@
   concerns&lt;/a&gt; will likely force user agents to impose nesting
   depths.&lt;/p&gt;
 
-
-  &lt;h5&gt;&lt;dfn&gt;The main phase&lt;/dfn&gt;&lt;/h5&gt;
-
-  &lt;p&gt;After &lt;span&gt;the root element phase&lt;/span&gt;, each token emitted
-  from the &lt;span&gt;tokenisation&lt;/span&gt; stage must be processed as
-  described in &lt;em&gt;this&lt;/em&gt; section. This is by far the most involved
-  part of parsing an HTML document.&lt;/p&gt;
-
-  &lt;p&gt;The tree construction stage in this phase has several pieces of
-  state: a &lt;span&gt;stack of open elements&lt;/span&gt;, a &lt;span&gt;list of active
+  &lt;p&gt;The tree construction stage has several pieces of state: a
+  &lt;span&gt;stack of open elements&lt;/span&gt;, a &lt;span&gt;list of active
   formatting elements&lt;/span&gt;, a &lt;span&gt;&lt;code title=&quot;&quot;&gt;head&lt;/code&gt;
   element pointer&lt;/span&gt;, a &lt;span&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
   pointer&lt;/span&gt;, and an &lt;span&gt;insertion mode&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p class=&quot;big-issue&quot;&gt;We could just fold insertion modes and phases
-  into one concept (and duplicate the two rules common to all
-  insertion modes into all of them).&lt;/p&gt;
+  &lt;p&gt;As each token is emitted from the tokeniser, the user agent must
+  process the token according to the rules given in the section
+  corresponding to the current &lt;span&gt;insertion mode&lt;/span&gt;.&lt;/p&gt;
 
 
-  &lt;h6&gt;The stack of open elements&lt;/h6&gt;
+  &lt;h5&gt;The stack of open elements&lt;/h5&gt;
 
-  &lt;p&gt;Initially the &lt;dfn&gt;stack of open elements&lt;/dfn&gt; contains just the
-  &lt;code&gt;html&lt;/code&gt; root element node created in the &lt;span title=&quot;the
-  root element phase&quot;&gt;last phase&lt;/span&gt; before switching to
-  &lt;em&gt;this&lt;/em&gt; phase (or, in the &lt;span&gt;fragment case&lt;/span&gt;, the
-  &lt;code&gt;html&lt;/code&gt; element created as part of &lt;span title=&quot;html
-  fragment parsing algorithm&quot;&gt;that algorithm&lt;/span&gt;). That's the
-  topmost node of the stack. It never gets popped off the stack. (This
-  stack grows downwards.)&lt;/p&gt;
+  &lt;p&gt;Initially the &lt;dfn&gt;stack of open elements&lt;/dfn&gt; is empty.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;span title=&quot;insertion mode: root element&quot;&gt;root element
+  insertion mode&lt;/span&gt; creates the &lt;code&gt;html&lt;/code&gt; root element
+  node, which is then added to the stack.&lt;/p&gt;
+
+  &lt;p&gt;In the &lt;span&gt;fragment case&lt;/span&gt;, the &lt;span&gt;stack of open
+  elements&lt;/span&gt; is initialised to contain an &lt;code&gt;html&lt;/code&gt;
+  element that is created as part of &lt;span title=&quot;html fragment
+  parsing algorithm&quot;&gt;that algorithm&lt;/span&gt;. (The &lt;span&gt;fragment
+  case&lt;/span&gt; skips the &lt;span title=&quot;insertion mode: root
+  element&quot;&gt;root element insertion mode&lt;/span&gt;.)&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code&gt;html&lt;/code&gt; node, however it is created, is the topmost
+  node of the stack. It never gets popped off the stack. (This stack
+  grows downwards.)&lt;/p&gt;
+
   &lt;p&gt;The &lt;dfn&gt;current node&lt;/dfn&gt; is the bottommost node in this
   stack.&lt;/p&gt;
 
@@ -37903,7 +37899,7 @@
   the stack is manipulated in a random-access fashion.&lt;/p&gt;
 
 
-  &lt;h6&gt;The list of active formatting elements&lt;/h6&gt;
+  &lt;h5&gt;The list of active formatting elements&lt;/h5&gt;
 
   &lt;p&gt;Initially the &lt;dfn&gt;list of active formatting elements&lt;/dfn&gt; is
   empty. It is used to handle mis-nested &lt;span
@@ -38001,7 +37997,7 @@
   &lt;/ol&gt;
 
 
-  &lt;h6&gt;Creating and inserting HTML elements&lt;/h6&gt;
+  &lt;h5&gt;Creating and inserting HTML elements&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn title=&quot;create an
   element for the token&quot;&gt;create an element for a token&lt;/dfn&gt;, the UA
@@ -38070,7 +38066,7 @@
 
 
 
-  &lt;h6&gt;Closing elements that have implied end tags&lt;/h6&gt;
+  &lt;h5&gt;Closing elements that have implied end tags&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;generate implied end
   tags&lt;/dfn&gt;, then, if the &lt;span&gt;current node&lt;/span&gt; is a
@@ -38088,7 +38084,7 @@
   list.&lt;/p&gt;
 
 
-  &lt;h6&gt;The element pointers&lt;/h6&gt;
+  &lt;h5&gt;The element pointers&lt;/h5&gt;
 
   &lt;p&gt;Initially the &lt;dfn&gt;&lt;code title=&quot;&quot;&gt;head&lt;/code&gt; element
   pointer&lt;/dfn&gt; and the &lt;dfn&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
@@ -38105,32 +38101,31 @@
   markup, for historical reasons.&lt;/p&gt;
 
 
-  &lt;h6&gt;The insertion mode&lt;/h6&gt;
+  &lt;h5&gt;The insertion mode&lt;/h5&gt;
 
   &lt;p&gt;Initially the &lt;dfn&gt;insertion mode&lt;/dfn&gt; is &quot;&lt;span
-  title=&quot;insertion mode: before head&quot;&gt;before head&lt;/span&gt;&quot;. It can
-  change to &quot;&lt;span title=&quot;insertion mode: in head&quot;&gt;in head&lt;/span&gt;&quot;,
-  &quot;&lt;span title=&quot;insertion mode: in head noscript&quot;&gt;in head
-  noscript&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: after head&quot;&gt;after
-  head&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
-  body&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in table&quot;&gt;in
-  table&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in caption&quot;&gt;in
-  caption&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in column group&quot;&gt;in
-  column group&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in table
-  body&quot;&gt;in table body&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in
-  row&quot;&gt;in row&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in cell&quot;&gt;in
-  cell&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in select&quot;&gt;in
-  select&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: after body&quot;&gt;after
-  body&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in frameset&quot;&gt;in
-  frameset&lt;/span&gt;&quot;, and &quot;&lt;span title=&quot;insertion mode: after
-  frameset&quot;&gt;after frameset&lt;/span&gt;&quot; during the course of the parsing,
-  as described below. It affects how certain tokens are processed.&lt;/p&gt;
+  title=&quot;insertion mode: initial&quot;&gt;initial&lt;/span&gt;&quot;. It can change to
+  &quot;&lt;span title=&quot;insertion mode: root element&quot;&gt;root element&lt;/span&gt;&quot;,
+  &quot;&lt;span title=&quot;insertion mode: in head&quot;&gt;in head&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: in head noscript&quot;&gt;in head noscript&lt;/span&gt;&quot;,
+  &quot;&lt;span title=&quot;insertion mode: after head&quot;&gt;after head&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: in body&quot;&gt;in body&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: in table&quot;&gt;in table&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: in caption&quot;&gt;in caption&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: in column group&quot;&gt;in column group&lt;/span&gt;&quot;,
+  &quot;&lt;span title=&quot;insertion mode: in table body&quot;&gt;in table body&lt;/span&gt;&quot;,
+  &quot;&lt;span title=&quot;insertion mode: in row&quot;&gt;in row&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: in cell&quot;&gt;in cell&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: in select&quot;&gt;in select&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: after body&quot;&gt;after body&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: in frameset&quot;&gt;in frameset&lt;/span&gt;&quot;, &quot;&lt;span
+  title=&quot;insertion mode: after frameset&quot;&gt;after frameset&lt;/span&gt;&quot;,
+  &quot;&lt;span title=&quot;insertion mode: after after body&quot;&gt;after after
+  body&lt;/span&gt;&quot;, and &quot;&lt;span title=&quot;insertion mode: after after
+  frameset&quot;&gt;after after frameset&lt;/span&gt;&quot; during the course of the
+  parsing, as described below. It affects how certain tokens are
+  processed.&lt;/p&gt;
 
-  &lt;p&gt;If the tree construction stage is switched from &lt;span&gt;the main
-  phase&lt;/span&gt; to &lt;span&gt;the trailing end phase&lt;/span&gt; and back again,
-  the various pieces of state are not reset; the UA must act as if the
-  state was maintained.&lt;/p&gt;
-
   &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;reset the insertion
   mode appropriately&lt;/dfn&gt;, it means the UA must follow these
   steps:&lt;/p&gt;
@@ -38277,13 +38272,12 @@
 
   &lt;/ol&gt;
 --&gt;
-`
 
-  &lt;h5&gt;&lt;dfn&gt;The initial phase&lt;/dfn&gt;&lt;/h5&gt;
 
-  &lt;p&gt;Initially, the tree construction stage must handle each token
-  emitted from the &lt;span&gt;tokenisation&lt;/span&gt; stage as follows:&lt;/p&gt;
+  &lt;h5&gt;The &lt;dfn title=&quot;insertion mode: initial&quot;&gt;initial&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
+  &lt;p&gt;Handle the token as follows:&lt;/p&gt;
+
   &lt;dl class=&quot;switch&quot;&gt;
 
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
@@ -38428,8 +38422,8 @@
     be compared to the values given in the lists above in a
     case-insensitive&lt;!-- ASCII --&gt; manner.&lt;/p&gt;
 
-    &lt;p&gt;Then, switch to &lt;span&gt;the root element phase&lt;/span&gt; of the tree
-    construction stage.&lt;/p&gt;
+    &lt;p&gt;Then, change the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
+    title=&quot;insertion mode: root element&quot;&gt;root element&lt;/span&gt;&quot;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -38445,19 +38439,17 @@
 
     &lt;p&gt;Set the document to &lt;span&gt;quirks mode&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Then, switch to &lt;span&gt;the root element phase&lt;/span&gt; of the tree
-    construction stage and reprocess the current token.&lt;/p&gt;
+    &lt;p&gt;Then, change the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
+    title=&quot;insertion mode: root element&quot;&gt;root element&lt;/span&gt;&quot;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
   &lt;/dl&gt;
 
 
-  &lt;h5&gt;&lt;dfn&gt;The root element phase&lt;/dfn&gt;&lt;/h5&gt;
+  &lt;h5&gt;The &lt;dfn title=&quot;insertion mode: root element&quot;&gt;root element&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
-  &lt;p&gt;After &lt;span&gt;the initial phase&lt;/span&gt;, as each token is emitted
-  from the &lt;span&gt;tokenisation&lt;/span&gt; stage, it must be processed as
-  described in this section.&lt;/p&gt;
+  &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
   &lt;dl class=&quot;switch&quot;&gt;
 
@@ -38499,9 +38491,11 @@
 
     &lt;p&gt;Create an &lt;code&gt;HTMLElement&lt;/code&gt; node with the tag name
     &lt;code&gt;html&lt;/code&gt;, in the &lt;span&gt;HTML namespace&lt;/span&gt;. Append it
-    to the &lt;code&gt;Document&lt;/code&gt; object. Switch to &lt;span&gt;the main
-    phase&lt;/span&gt; and reprocess the current token.&lt;/p&gt;
+    to the &lt;code&gt;Document&lt;/code&gt; object.&lt;/p&gt;
 
+    &lt;p&gt;Change the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
+    title=&quot;insertion mode: before head&quot;&gt;before head&lt;/span&gt;&quot;.&lt;/p&gt;
+
     &lt;p class=&quot;big-issue&quot;&gt;Should probably make end tags be ignored, so
     that &quot;&lt;/head&gt;&lt;!-- --&gt;&lt;html&gt;&quot; puts the comment before the
     root node (or should we?)&lt;/p&gt;
@@ -40911,8 +40905,9 @@
     be an &lt;code&gt;html&lt;/code&gt; element in this case.)
     (&lt;span&gt;fragment case&lt;/span&gt;)&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, switch to &lt;span&gt;the trailing end
-    phase&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;Then, change the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
+    title=&quot;insertion mode: after after body&quot;&gt;after after
+    body&lt;/span&gt;&quot;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -41056,7 +41051,9 @@
 
    &lt;dt&gt;An end tag whose tag name is &quot;html&quot;&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Switch to &lt;span&gt;the trailing end phase&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;Change the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
+    title=&quot;insertion mode: after after frameset&quot;&gt;after after
+    frameset&lt;/span&gt;&quot;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;noframes&quot;&lt;/dt&gt;
@@ -41078,17 +41075,15 @@
   harder.&lt;/p&gt;
 
 
-  &lt;h5&gt;&lt;dfn&gt;The trailing end phase&lt;/dfn&gt;&lt;/h5&gt;
+  &lt;h5&gt;The &lt;dfn title=&quot;insertion mode: after after body&quot;&gt;after after body&lt;/dfn&gt; insertion mode&lt;/h5&gt;
 
-  &lt;p&gt;After &lt;span&gt;the main phase&lt;/span&gt;, as each token is emitted from
-  the &lt;span&gt;tokenisation&lt;/span&gt; stage, it must be processed as
-  described in this section.&lt;/p&gt;
+  &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
@@ -41098,33 +41093,63 @@
     data given in the comment token.&lt;/p&gt;
    &lt;/dd&gt;
 
+   &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
    TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
    FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020
    SPACE&lt;/dt&gt;
+   &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Process the token as it would be processed in &lt;span&gt;the main
-    phase&lt;/span&gt;.&lt;/p&gt; &lt;!-- if there was a &lt;body&gt;, the space will go
-    into it, otherwise (e.g. if there was a &lt;frameset&gt;) it'll go into
-    the &lt;html&gt; node (this is important in case we have &quot;foo&lt;/html&gt;
-    bar&quot;, as we don't want that to become one word) --&gt;
+    &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+    been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in body&lt;/span&gt;&quot;.&lt;/p&gt;
    &lt;/dd&gt;
 
-   &lt;dt&gt;A character token that is &lt;em&gt;not&lt;/em&gt; one of U+0009 CHARACTER
-   TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
-   FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE&lt;/dt&gt;
-   &lt;dt&gt;A start tag token&lt;/dt&gt;
-   &lt;dt&gt;An end tag token&lt;/dt&gt;
+   &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Switch back to &lt;span&gt;the main
-    phase&lt;/span&gt; and reprocess the token.&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Set the &lt;span&gt;insertion mode&lt;/span&gt;
+    to &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in body&lt;/span&gt;&quot; and
+    reprocess the token.&lt;/p&gt;
    &lt;/dd&gt;
 
+  &lt;/dl&gt;
+
+
+  &lt;h5&gt;The &lt;dfn title=&quot;insertion mode: after after frameset&quot;&gt;after after frameset&lt;/dfn&gt; insertion mode&lt;/h5&gt;
+
+  &lt;p&gt;Handle the token as follows:&lt;/p&gt;
+
+  &lt;dl class=&quot;switch&quot;&gt;
+
    &lt;dt&gt;An end-of-file token&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
+ 
+   &lt;dt&gt;A comment token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;code&gt;Document&lt;/code&gt;
+    object with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token.&lt;/p&gt;
+   &lt;/dd&gt;
 
+   &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+   &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
+   TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
+   FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020
+   SPACE&lt;/dt&gt;
+   &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+    been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in body&lt;/span&gt;&quot;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+   &lt;dt&gt;Anything else&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Set the &lt;span&gt;insertion mode&lt;/span&gt;
+    to &quot;&lt;span title=&quot;insertion mode: in frameset&quot;&gt;in frameset&lt;/span&gt;&quot; and
+    reprocess the token.&lt;/p&gt;
+   &lt;/dd&gt;
+
   &lt;/dl&gt;
 
 
@@ -41590,13 +41615,6 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Switch the &lt;span&gt;HTML parser&lt;/span&gt;'s &lt;span&gt;tree
-    construction&lt;/span&gt; stage to &lt;span&gt;the main phase&lt;/span&gt;.
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be a new &lt;code&gt;html&lt;/code&gt; element
     with no attributes.&lt;/p&gt;
 


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008213.html">[html5] r1311 - /
</A></li>
	<LI>Next message: <A HREF="008215.html">[html5] r1313 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8214">[ date ]</a>
              <a href="thread.html#8214">[ thread ]</a>
              <a href="subject.html#8214">[ subject ]</a>
              <a href="author.html#8214">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
