<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1348 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1348%20-%20/&In-Reply-To=%3C20080305200007.2BD0238F01B%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008249.html">
   <LINK REL="Next"  HREF="008251.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1348 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1348%20-%20/&In-Reply-To=%3C20080305200007.2BD0238F01B%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1348 - /">whatwg at whatwg.org
       </A><BR>
    <I>Wed Mar  5 12:00:07 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008249.html">[html5] r1347 - /
</A></li>
        <LI>Next message: <A HREF="008251.html">[html5] r1349 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8250">[ date ]</a>
              <a href="thread.html#8250">[ thread ]</a>
              <a href="subject.html#8250">[ subject ]</a>
              <a href="author.html#8250">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-03-05 12:00:00 -0800 (Wed, 05 Mar 2008)
New Revision: 1348

Modified:
   index
   source
Log:
[act] (2) Revamp how end-of-file tokens work and how &lt;/body&gt; is handled in conformance checkers.

Modified: index
===================================================================
--- index	2008-03-05 07:19:37 UTC (rev 1347)
+++ index	2008-03-05 20:00:00 UTC (rev 1348)
@@ -1683,10 +1683,7 @@
           &quot;after after frameset&quot; insertion mode&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-unexpected&quot;&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The
-        unexpected end&lt;/a&gt;
-
-       &lt;li&gt;&lt;a href=&quot;#the-end&quot;&gt;&lt;span class=secno&gt;8.2.6 &lt;/span&gt;The end&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#the-end&quot;&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The end&lt;/a&gt;
       &lt;/ul&gt;
 
      &lt;li&gt;&lt;a href=&quot;#namespaces&quot;&gt;&lt;span class=secno&gt;8.3 &lt;/span&gt;Namespaces&lt;/a&gt;
@@ -29867,7 +29864,7 @@
   &lt;!-- next three paragraphs are similar to the navigate-text section,
   keep them in sync --&gt;
 
-  &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops0&quot; title=&quot;stop
+  &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops&quot; title=&quot;stop
    parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
   &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
@@ -29904,7 +29901,7 @@
   &lt;!-- next three paragraphs are similar to the navigate-text section,
   keep them in sync --&gt;
 
-  &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops0&quot; title=&quot;stop
+  &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops&quot; title=&quot;stop
    parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
   &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
@@ -29938,7 +29935,7 @@
   keep them in sync --&gt;
 
   &lt;p&gt;Once the page has been set up, the user agent must act as if it had &lt;a
-   href=&quot;#stops0&quot; title=&quot;stop parsing&quot;&gt;stopped parsing&lt;/a&gt;.
+   href=&quot;#stops&quot; title=&quot;stop parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
   &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
    run the &lt;a href=&quot;#application3&quot;
@@ -41371,23 +41368,16 @@
     &lt;p&gt;Then, switch the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
      href=&quot;#before4&quot; title=&quot;insertion mode: before html&quot;&gt;before html&lt;/a&gt;&quot;.&lt;/p&gt;
 
-   &lt;dt&gt;A start tag token
+   &lt;dt&gt;Anything else
 
-   &lt;dt&gt;An end tag token
-
-   &lt;dt&gt;A character token that is not one of one of U+0009 CHARACTER
-    TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM
-    FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
-
-   &lt;dt&gt;An end-of-file token
-
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the document to &lt;a href=&quot;#quirks&quot;&gt;quirks mode&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Then, switch the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
-     href=&quot;#before4&quot; title=&quot;insertion mode: before html&quot;&gt;before html&lt;/a&gt;&quot;.&lt;/p&gt;
+    &lt;p&gt;Switch the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
+     href=&quot;#before4&quot; title=&quot;insertion mode: before html&quot;&gt;before html&lt;/a&gt;&quot;,
+     then reprocess the current token.&lt;/p&gt;
   &lt;/dl&gt;
 
   &lt;h5 id=the-before&gt;&lt;span class=secno&gt;8.2.4.8. &lt;/span&gt;The &quot;&lt;dfn id=before4
@@ -41435,16 +41425,8 @@
     &lt;p&gt;Switch the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
      href=&quot;#before5&quot; title=&quot;insertion mode: before head&quot;&gt;before head&lt;/a&gt;&quot;.&lt;/p&gt;
 
-   &lt;dt&gt;A character token that is &lt;em&gt;not&lt;/em&gt; one of U+0009 CHARACTER
-    TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM
-    FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
+   &lt;dt&gt;Anything else
 
-   &lt;dt&gt;A start tag token
-
-   &lt;dt&gt;An end tag token
-
-   &lt;dt&gt;An end-of-file token
-
    &lt;dd&gt;
     &lt;p&gt;Create an &lt;code&gt;&lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt; node
      with the tag name &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt;, in the &lt;a
@@ -41457,7 +41439,8 @@
      algorithm&lt;/a&gt; with no manifest.&lt;/p&gt;
 
     &lt;p&gt;Switch the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
-     href=&quot;#before5&quot; title=&quot;insertion mode: before head&quot;&gt;before head&lt;/a&gt;&quot;.&lt;/p&gt;
+     href=&quot;#before5&quot; title=&quot;insertion mode: before head&quot;&gt;before head&lt;/a&gt;&quot;,
+     then reprocess the current token.&lt;/p&gt;
 
     &lt;p class=big-issue&gt;Should probably make end tags be ignored, so that
      &quot;&lt;/head&gt;&lt;!-- --&gt;&lt;html&gt;&quot; puts the comment before the root node
@@ -41477,11 +41460,6 @@
    handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -41536,12 +41514,8 @@
 
     &lt;p class=big-issue&gt;Do we really want to ignore end tags here?&lt;/p&gt;
 
-   &lt;dt&gt;A character token that is &lt;em&gt;not&lt;/em&gt; one of U+0009 CHARACTER
-    TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM
-    FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
+   &lt;dt&gt;Anything else
 
-   &lt;dt&gt;Any other start tag token
-
    &lt;dd&gt;
     &lt;p&gt;Act as if a start tag token with the tag name &quot;head&quot; and no attributes
      had been seen, then reprocess the current token.&lt;/p&gt;
@@ -41560,11 +41534,6 @@
    follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -41809,11 +41778,6 @@
    noscript&lt;/a&gt;&quot;, tokens must be handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A DOCTYPE token
 
    &lt;dd&gt;
@@ -41878,11 +41842,6 @@
    as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -41961,11 +41920,6 @@
    follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token
 
    &lt;dd&gt;
@@ -42019,13 +41973,33 @@
      href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;. If it is not, add the
      attribute and its corresponding value to that element.&lt;/p&gt;
 
+   &lt;dt&gt;An end-of-file token
+
+   &lt;dd&gt;
+    &lt;p&gt;If there is a node in the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;
+     that is not either a &lt;code&gt;&lt;a href=&quot;#dd&quot;&gt;dd&lt;/a&gt;&lt;/code&gt; element, a
+     &lt;code&gt;&lt;a href=&quot;#dt&quot;&gt;dt&lt;/a&gt;&lt;/code&gt; element, an &lt;code&gt;&lt;a
+     href=&quot;#li&quot;&gt;li&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt;
+     element, a &lt;code&gt;&lt;a href=&quot;#tbody&quot;&gt;tbody&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a
+     href=&quot;#td&quot;&gt;td&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a
+     href=&quot;#tfoot0&quot;&gt;tfoot&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a
+     href=&quot;#th&quot;&gt;th&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a
+     href=&quot;#thead0&quot;&gt;thead&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a
+     href=&quot;#tr&quot;&gt;tr&lt;/a&gt;&lt;/code&gt; element, the &lt;code&gt;&lt;a
+     href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; element, or the &lt;code&gt;&lt;a
+     href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a
+     href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+    &lt;!-- (some of those are
+    fragment cases) --&gt;
+    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
+
    &lt;dt&gt;An end tag whose tag name is &quot;body&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;If the second element in the &lt;a href=&quot;#stack&quot;&gt;stack of open
-     elements&lt;/a&gt; is not a &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; element,
-     this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
-     href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
+    &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
+     href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;have a &lt;code&gt;body&lt;/code&gt;
+     element in scope&lt;/a&gt;, this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;;
+     ignore the token.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if there is a node in the &lt;a href=&quot;#stack&quot;&gt;stack of open
      elements&lt;/a&gt; that is not either a &lt;code&gt;&lt;a href=&quot;#dd&quot;&gt;dd&lt;/a&gt;&lt;/code&gt;
@@ -42040,9 +42014,11 @@
      href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; element, or the &lt;code&gt;&lt;a
      href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a
      href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
-
+    &lt;!-- (some of those are fragment cases) --&gt;
+    &lt;!-- the insertion mode here is forcibly &quot;in body&quot;. --&gt;
     &lt;p&gt;Switch the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
-     href=&quot;#after5&quot; title=&quot;insertion mode: after body&quot;&gt;after body&lt;/a&gt;&quot;.&lt;/p&gt;
+     href=&quot;#after5&quot; title=&quot;insertion mode: after body&quot;&gt;after body&lt;/a&gt;&quot;.
+     Otherwise, ignore the token.&lt;/p&gt;
 
    &lt;dt&gt;An end tag whose tag name is &quot;html&quot;
 
@@ -42959,11 +42935,6 @@
    must be handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43103,6 +43074,11 @@
     &lt;p&gt;Pop that &lt;code&gt;input&lt;/code&gt; element off the &lt;a href=&quot;#stack&quot;&gt;stack of
      open elements&lt;/a&gt;.&lt;/p&gt;
 
+   &lt;dt&gt;An end-of-file token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. &lt;a href=&quot;#stops&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
+
    &lt;dt&gt;Anything else
 
    &lt;dd&gt;
@@ -43234,11 +43210,6 @@
    group&lt;/a&gt;&quot;, tokens must be handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43591,11 +43562,6 @@
    must be handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token
 
    &lt;dd&gt;
@@ -43691,6 +43657,11 @@
     &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Act as if an end tag with the tag
      name &quot;select&quot; had been seen, and reprocess the token.&lt;/p&gt;
 
+   &lt;dt&gt;An end-of-file token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. &lt;a href=&quot;#stops&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
+
    &lt;dt&gt;Anything else
 
    &lt;dd&gt;
@@ -43742,11 +43713,6 @@
    as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43789,6 +43755,11 @@
      href=&quot;#after7&quot; title=&quot;insertion mode: after after body&quot;&gt;after after
      body&lt;/a&gt;&quot;.&lt;/p&gt;
 
+   &lt;dt&gt;An end-of-file token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing.&lt;/a&gt;&lt;/p&gt;
+
    &lt;dt&gt;Anything else
 
    &lt;dd&gt;
@@ -43806,11 +43777,6 @@
    tokens must be handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43875,6 +43841,11 @@
      href=&quot;#in-body&quot; title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot; &lt;a
      href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt;.&lt;/p&gt;
 
+   &lt;dt&gt;An end-of-file token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. &lt;a href=&quot;#stops&quot;&gt;Stop parsing.&lt;/a&gt;&lt;/p&gt;
+
    &lt;dt&gt;Anything else
 
    &lt;dd&gt;
@@ -43891,11 +43862,6 @@
   &lt;!-- due to rules in the &quot;in frameset&quot; mode, this can't be entered in the fragment case --&gt;
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER TABULATION,
     U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C FORM FEED (FF),
     &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43932,6 +43898,11 @@
      href=&quot;#after8&quot; title=&quot;insertion mode: after after frameset&quot;&gt;after after
      frameset&lt;/a&gt;&quot;.&lt;/p&gt;
 
+   &lt;dt&gt;An end-of-file token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing.&lt;/a&gt;&lt;/p&gt;
+
    &lt;dt&gt;Anything else
 
    &lt;dd&gt;
@@ -43951,11 +43922,6 @@
    must be handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops0&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
-
    &lt;dt&gt;A comment token
 
    &lt;dd&gt;
@@ -43976,6 +43942,11 @@
      href=&quot;#in-body&quot; title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot; &lt;a
      href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt;.&lt;/p&gt;
 
+   &lt;dt&gt;An end-of-file token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
+
    &lt;dt&gt;Anything else
 
    &lt;dd&gt;
@@ -43993,11 +43964,6 @@
    tokens must be handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops0&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
-
    &lt;dt&gt;A comment token
 
    &lt;dd&gt;
@@ -44018,6 +43984,11 @@
      href=&quot;#in-body&quot; title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot; &lt;a
      href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt;.&lt;/p&gt;
 
+   &lt;dt&gt;An end-of-file token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
+
    &lt;dt&gt;Anything else
 
    &lt;dd&gt;
@@ -44027,37 +43998,9 @@
      token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h4 id=the-unexpected&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The unexpected end&lt;/h4&gt;
+  &lt;h4 id=the-end&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The end&lt;/h4&gt;
 
-  &lt;p&gt;When the user agent is to &lt;dfn id=stops title=&quot;stop parsing, with
-   prejudice&quot;&gt;stops parsing, with prejudice&lt;/dfn&gt;, the user agent must follow
-   the steps in this section.
-
-  &lt;ol&gt;
-   &lt;li&gt;
-    &lt;p&gt;&lt;a href=&quot;#generate&quot;&gt;Generate implied end tags.&lt;/a&gt;&lt;/p&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;If there are more than two nodes on the &lt;a href=&quot;#stack&quot;&gt;stack of open
-     elements&lt;/a&gt;, or if there are two nodes but the second node is not a
-     &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; node, this is a &lt;a
-     href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, if the parser was originally created as part of the &lt;a
-     href=&quot;#html-fragment0&quot;&gt;HTML fragment parsing algorithm&lt;/a&gt;, and there's
-     more than one element in the &lt;a href=&quot;#stack&quot;&gt;stack of open
-     elements&lt;/a&gt;, and the second node on the &lt;a href=&quot;#stack&quot;&gt;stack of open
-     elements&lt;/a&gt; is not a &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; node, then
-     this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. (&lt;a
-     href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops0&quot;&gt;Stop parsing&lt;/a&gt; (see the next section).
-  &lt;/ol&gt;
-
-  &lt;h4 id=the-end&gt;&lt;span class=secno&gt;8.2.6 &lt;/span&gt;The end&lt;/h4&gt;
-
-  &lt;p&gt;Once the user agent &lt;dfn id=stops0 title=&quot;stop parsing&quot;&gt;stops
+  &lt;p&gt;Once the user agent &lt;dfn id=stops title=&quot;stop parsing&quot;&gt;stops
    parsing&lt;/dfn&gt; the document, the user agent must follow the steps in this
    section.
 

Modified: source
===================================================================
--- source	2008-03-05 07:19:37 UTC (rev 1347)
+++ source	2008-03-05 20:00:00 UTC (rev 1348)
@@ -38469,20 +38469,16 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;A start tag token&lt;/dt&gt;
-   &lt;dt&gt;An end tag token&lt;/dt&gt;
-   &lt;dt&gt;A character token that is not one of one of U+0009 CHARACTER
-   TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
-   FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE&lt;/dt&gt;
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the document to &lt;span&gt;quirks mode&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Then, switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
-    title=&quot;insertion mode: before html&quot;&gt;before html&lt;/span&gt;&quot;.&lt;/p&gt;
+    &lt;p&gt;Switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
+    title=&quot;insertion mode: before html&quot;&gt;before html&lt;/span&gt;&quot;, then
+    reprocess the current token.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -38536,12 +38532,7 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;A character token that is &lt;em&gt;not&lt;/em&gt; one of U+0009 CHARACTER
-   TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
-   FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE&lt;/dt&gt;
-   &lt;dt&gt;A start tag token&lt;/dt&gt;
-   &lt;dt&gt;An end tag token&lt;/dt&gt;
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;Create an &lt;code&gt;HTMLElement&lt;/code&gt; node with the tag name
@@ -38554,7 +38545,8 @@
     selection algorithm&lt;/span&gt; with no manifest.&lt;/p&gt;
 
     &lt;p&gt;Switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
-    title=&quot;insertion mode: before head&quot;&gt;before head&lt;/span&gt;&quot;.&lt;/p&gt;
+    title=&quot;insertion mode: before head&quot;&gt;before head&lt;/span&gt;&quot;, then
+    reprocess the current token.&lt;/p&gt;
 
     &lt;p class=&quot;big-issue&quot;&gt;Should probably make end tags be ignored, so
     that &quot;&lt;/head&gt;&lt;!-- --&gt;&lt;html&gt;&quot; puts the comment before the
@@ -38577,11 +38569,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
    TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -38643,10 +38630,7 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;A character token that is &lt;em&gt;not&lt;/em&gt; one of U+0009 CHARACTER
-   TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
-   FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE&lt;/dt&gt;
-   &lt;dt&gt;Any other start tag token&lt;/dt&gt;
+   &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;Act as if a start tag token with the tag name &quot;head&quot; and no
@@ -38670,11 +38654,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
    TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -38930,11 +38909,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
@@ -39000,11 +38974,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
    TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -39091,11 +39060,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -39153,26 +39117,46 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;If there is a node in the &lt;span&gt;stack of open elements&lt;/span&gt;
+    that is not either a &lt;code&gt;dd&lt;/code&gt; element, a &lt;code&gt;dt&lt;/code&gt;
+    element, an &lt;code&gt;li&lt;/code&gt; element, a &lt;code&gt;p&lt;/code&gt; element, a
+    &lt;code&gt;tbody&lt;/code&gt; element, a &lt;code&gt;td&lt;/code&gt; element, a
+    &lt;code&gt;tfoot&lt;/code&gt; element, a &lt;code&gt;th&lt;/code&gt; element, a
+    &lt;code&gt;thead&lt;/code&gt; element, a &lt;code&gt;tr&lt;/code&gt; element, the
+    &lt;code&gt;body&lt;/code&gt; element, or the &lt;code&gt;html&lt;/code&gt; element, then
+    this is a &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt; &lt;!-- (some of those are
+    fragment cases) --&gt;
+
+    &lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;An end tag whose tag name is &quot;body&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the second element in the &lt;span&gt;stack of open
-    elements&lt;/span&gt; is not a &lt;code&gt;body&lt;/code&gt; element, this is a
-    &lt;span&gt;parse error&lt;/span&gt;. Ignore the token.  (&lt;span&gt;fragment
-    case&lt;/span&gt;)&lt;/p&gt;
+    &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; does not &lt;span
+    title=&quot;has an element in scope&quot;&gt;have a &lt;code&gt;body&lt;/code&gt; element
+    in scope&lt;/span&gt;, this is a &lt;span&gt;parse error&lt;/span&gt;; ignore the
+    token.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if there is a node in the &lt;span&gt;stack of open
-    elements&lt;/span&gt; that is not either a &lt;code&gt;dd&lt;/code&gt; element,
-    a &lt;code&gt;dt&lt;/code&gt; element, an &lt;code&gt;li&lt;/code&gt; element, a
+    elements&lt;/span&gt; that is not either a &lt;code&gt;dd&lt;/code&gt; element, a
+    &lt;code&gt;dt&lt;/code&gt; element, an &lt;code&gt;li&lt;/code&gt; element, a
     &lt;code&gt;p&lt;/code&gt; element, a &lt;code&gt;tbody&lt;/code&gt; element, a
     &lt;code&gt;td&lt;/code&gt; element, a &lt;code&gt;tfoot&lt;/code&gt; element, a
     &lt;code&gt;th&lt;/code&gt; element, a &lt;code&gt;thead&lt;/code&gt; element, a
     &lt;code&gt;tr&lt;/code&gt; element, the &lt;code&gt;body&lt;/code&gt; element, or the
     &lt;code&gt;html&lt;/code&gt; element, then this is a &lt;span&gt;parse
-    error&lt;/span&gt;.&lt;/p&gt;
+    error&lt;/span&gt;.&lt;/p&gt; &lt;!-- (some of those are fragment cases) --&gt;
 
+    &lt;!-- the insertion mode here is forcibly &quot;in body&quot;. --&gt;
+
     &lt;p&gt;Switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
-    title=&quot;insertion mode: after body&quot;&gt;after body&lt;/span&gt;&quot;.&lt;/p&gt;
+    title=&quot;insertion mode: after body&quot;&gt;after body&lt;/span&gt;&quot;. Otherwise,
+    ignore the token.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -40163,11 +40147,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
    TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -40322,6 +40301,11 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. &lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -40452,11 +40436,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
    TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -40836,11 +40815,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's
@@ -40951,6 +40925,11 @@
     name &quot;select&quot; had been seen, and reprocess the token.&lt;/p&gt;
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. &lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
@@ -41004,11 +40983,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
    TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -41053,6 +41027,11 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Stop parsing.&lt;/span&gt;&lt;/p&gt;
+   &lt;/dd&gt;
+
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -41072,11 +41051,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
    TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -41145,6 +41119,11 @@
     mode&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. &lt;span&gt;Stop parsing.&lt;/span&gt;&lt;/p&gt;
+   &lt;/dd&gt;
+
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
@@ -41161,11 +41140,6 @@
   &lt;!-- due to rules in the &quot;in frameset&quot; mode, this can't be entered in the fragment case --&gt;
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A character token that is one of one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
    TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -41202,6 +41176,11 @@
     frameset&lt;/span&gt;&quot;.&lt;/p&gt;
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Stop parsing.&lt;/span&gt;&lt;/p&gt;
+   &lt;/dd&gt;
+
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
@@ -41222,11 +41201,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
-   &lt;/dd&gt;
-
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;code&gt;Document&lt;/code&gt;
@@ -41246,6 +41220,11 @@
     mode&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Switch the &lt;span&gt;insertion mode&lt;/span&gt;
@@ -41262,11 +41241,6 @@
   mode: after after frameset&quot;&gt;after after frameset&lt;/span&gt;&quot;, tokens must be handled as follows:&lt;/p&gt;
 
   &lt;dl class=&quot;switch&quot;&gt;
-
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
-   &lt;/dd&gt;
  
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
@@ -41287,6 +41261,11 @@
     mode&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Switch the &lt;span&gt;insertion mode&lt;/span&gt;
@@ -41297,39 +41276,6 @@
   &lt;/dl&gt;
 
 
-  &lt;h4&gt;The unexpected end&lt;/h4&gt;
-
-  &lt;p&gt;When the user agent is to &lt;dfn title=&quot;stop parsing, with
-  prejudice&quot;&gt;stops parsing, with prejudice&lt;/dfn&gt;, the user agent must
-  follow the steps in this section.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;&lt;span&gt;Generate implied end tags.&lt;/span&gt;&lt;/p&gt;
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If there are more than two nodes on the &lt;span&gt;stack of open
-    elements&lt;/span&gt;, or if there are two nodes but the second node is
-    not a &lt;code&gt;body&lt;/code&gt; node, this is a &lt;span&gt;parse
-    error&lt;/span&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, if the parser was originally created as part of the
-    &lt;span&gt;HTML fragment parsing algorithm&lt;/span&gt;, and there's more
-    than one element in the &lt;span&gt;stack of open elements&lt;/span&gt;, and
-    the second node on the &lt;span&gt;stack of open elements&lt;/span&gt; is not
-    a &lt;code&gt;body&lt;/code&gt; node, then this is a &lt;span&gt;parse
-    error&lt;/span&gt;. (&lt;span&gt;fragment case&lt;/span&gt;)&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt; (see the next section).&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-
   &lt;h4&gt;The end&lt;/h4&gt;
 
   &lt;p&gt;Once the user agent &lt;dfn title=&quot;stop parsing&quot;&gt;stops parsing&lt;/dfn&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008249.html">[html5] r1347 - /
</A></li>
	<LI>Next message: <A HREF="008251.html">[html5] r1349 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8250">[ date ]</a>
              <a href="thread.html#8250">[ thread ]</a>
              <a href="subject.html#8250">[ subject ]</a>
              <a href="author.html#8250">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
