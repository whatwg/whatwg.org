<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1166 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1166%20-%20/&In-Reply-To=%3C20080122022244.8223A38E7E6%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008073.html">
   <LINK REL="Next"  HREF="008075.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1166 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1166%20-%20/&In-Reply-To=%3C20080122022244.8223A38E7E6%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1166 - /">whatwg at whatwg.org
       </A><BR>
    <I>Mon Jan 21 18:22:44 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008073.html">[html5] r1165 - /
</A></li>
        <LI>Next message: <A HREF="008075.html">[html5] r1167 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8074">[ date ]</a>
              <a href="thread.html#8074">[ thread ]</a>
              <a href="subject.html#8074">[ subject ]</a>
              <a href="author.html#8074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-01-21 18:22:38 -0800 (Mon, 21 Jan 2008)
New Revision: 1166

Modified:
   index
   source
Log:
[e] (1) canvas: typos, clarifications, fix old examples, add new examples

Modified: index
===================================================================
--- index	2008-01-18 02:45:39 UTC (rev 1165)
+++ index	2008-01-22 02:22:38 UTC (rev 1166)
@@ -24,7 +24,7 @@
 
    &lt;h1 id=html-5&gt;HTML 5&lt;/h1&gt;
 
-   &lt;h2 class=&quot;no-num no-toc&quot; id=working&gt;Working Draft &mdash; 18 January 2008&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=working&gt;Working Draft &mdash; 22 January 2008&lt;/h2&gt;
 
    &lt;p&gt;You can take part in this work. &lt;a
     href=&quot;<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&quot;&gt;Join the working group's
@@ -15982,7 +15982,7 @@
   &lt;p&gt;This specification only defines one context, with the name &quot;&lt;code
    title=canvas-context-2d&gt;&lt;a href=&quot;#d&quot;&gt;2d&lt;/a&gt;&lt;/code&gt;&quot;. If &lt;code
    title=dom-canvas-getContext&gt;&lt;a href=&quot;#getcontext&quot;&gt;getContext()&lt;/a&gt;&lt;/code&gt;
-   is called with that exact string for tis &lt;var title=&quot;&quot;&gt;contextId&lt;/var&gt;
+   is called with that exact string for its &lt;var title=&quot;&quot;&gt;contextId&lt;/var&gt;
    argument, then the UA must return a reference to an object implementing
    &lt;code&gt;&lt;a
    href=&quot;#canvasrenderingcontext2d&quot;&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt;.
@@ -16146,7 +16146,7 @@
 
   // pixel manipulation
   &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; &lt;a href=&quot;#getimagedata&quot; title=dom-context-2d-getImageData&gt;getImageData&lt;/a&gt;(in float sx, in float sy, in float sw, in float sh);
-  void &lt;a href=&quot;#putimagedata&quot; title=dom-context-2d-putImageData&gt;putImageData&lt;/a&gt;(in &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; image, in float dx, in float dy);
+  void &lt;a href=&quot;#putimagedata&quot; title=dom-context-2d-putImageData&gt;putImageData&lt;/a&gt;(in &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; imagedata, in float dx, in float dy);
 
   // drawing text is not supported in this version of the API
   // (there is no way to predict what metrics the fonts will have,
@@ -16980,7 +16980,7 @@
 
   &lt;p&gt;The &lt;dfn id=strokerect
    title=dom-context-2d-strokeRect&gt;&lt;code&gt;strokeRect()&lt;/code&gt;&lt;/dfn&gt; method
-   must draw stroke the specified rectangle's path using the &lt;code
+   must stroke the specified rectangle's path using the &lt;code
    title=dom-context-2d-strokeStyle&gt;&lt;a
    href=&quot;#strokestyle&quot;&gt;strokeStyle&lt;/a&gt;&lt;/code&gt;, &lt;code
    title=dom-context-2d-lineWidth&gt;&lt;a href=&quot;#linewidth&quot;&gt;lineWidth&lt;/a&gt;&lt;/code&gt;,
@@ -17254,6 +17254,11 @@
   since the image is just repeating what was stated in the previous
   paragraph. --&gt;
 
+  &lt;p class=note&gt;When a canvas is drawn onto itself, the drawing model
+   requires the source to be copied before the image is drawn back onto the
+   canvas, so it is possible to copy parts of a canvas onto overlapping parts
+   of itself.
+
   &lt;p&gt;Images are painted without affecting the current path, and are subject
    to &lt;a href=&quot;#shadows0&quot; title=shadows&gt;shadow effects&lt;/a&gt;, &lt;a
    href=&quot;#globalalpha&quot; title=dom-context-2d-globalAlpha&gt;global alpha&lt;/a&gt;, &lt;a
@@ -17274,27 +17279,27 @@
    title=&quot;&quot;&gt;sh&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return an &lt;code&gt;&lt;a
    href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; object representing the underlying
    pixel data for the area of the canvas denoted by the rectangle which has
-   one corner at the (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;)
-   coordinate, and that has width &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; and height &lt;var
-   title=&quot;&quot;&gt;sh&lt;/var&gt;. Pixels outside the canvas must be returned as
-   transparent black. Pixels must be returned as non-premultiplied alpha
-   values.
+   its top left corner at the (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var
+   title=&quot;&quot;&gt;sy&lt;/var&gt;) coordinate, and that has width &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;
+   and height &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;. Pixels outside the canvas must be
+   returned as transparent black. Pixels must be returned as
+   non-premultiplied alpha values.
 
   &lt;p&gt;&lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; objects must be
-   initialised so that their &lt;dfn id=height2
+   initialised so that their &lt;dfn id=width2
+   title=dom-imagedata-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; attribute is set to
+   &lt;var title=&quot;&quot;&gt;w&lt;/var&gt;, the number of physical device pixels per row in the
+   image data, their &lt;dfn id=height2
    title=dom-imagedata-height&gt;&lt;code&gt;height&lt;/code&gt;&lt;/dfn&gt; attribute is set to
-   &lt;var title=&quot;&quot;&gt;h&lt;/var&gt;, the number of rows in the image data, their &lt;dfn
-   id=width2 title=dom-imagedata-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; attribute is
-   set to &lt;var title=&quot;&quot;&gt;w&lt;/var&gt;, the number of physical device pixels per row
-   in the image data, and the &lt;dfn id=data1
-   title=dom-imagedata-data&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt; attribute is initialised
-   to an array of &lt;var title=&quot;&quot;&gt;h&lt;/var&gt;&times;&lt;var title=&quot;&quot;&gt;w&lt;/var&gt;&times;4
-   integers. The pixels must be represented in this array in left-to-right
-   order, row by row, starting at the top left, with each pixel's red, green,
-   blue, and alpha components being given in that order. Each component of
-   each device pixel represented in this array must be in the range 0..255,
-   representing the 8 bit value for that component. At least one pixel must
-   be returned.
+   &lt;var title=&quot;&quot;&gt;h&lt;/var&gt;, the number of rows in the image data, and the &lt;dfn
+   id=data1 title=dom-imagedata-data&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt; attribute is
+   initialised to an array of &lt;var title=&quot;&quot;&gt;h&lt;/var&gt;&times;&lt;var
+   title=&quot;&quot;&gt;w&lt;/var&gt;&times;4 integers. The pixels must be represented in this
+   array in left-to-right order, row by row, starting at the top left, with
+   each pixel's red, green, blue, and alpha components being given in that
+   order. Each component of each device pixel represented in this array must
+   be in the range 0..255, representing the 8 bit value for that component.
+   At least one pixel must be returned.
 
   &lt;p&gt;The values of the &lt;code title=dom-imagedata-data&gt;&lt;a
    href=&quot;#data1&quot;&gt;data&lt;/a&gt;&lt;/code&gt; array may be changed (the length of the
@@ -17305,13 +17310,13 @@
    algorithm, and if the result is not a number, a
    &lt;code&gt;TYPE_MISMATCH_ERR&lt;/code&gt; exception must be raised. If the result is
    less than 0, it must be clamped to zero. If the result is more than 255,
-   it must be clamed to 255. If the number is not an integer, it must be
+   it must be clamped to 255. If the number is not an integer, it must be
    rounded to the nearest integer using the IEEE 754r &lt;i&gt;roundTiesToEven&lt;/i&gt;
    rounding mode. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt; &lt;a
    href=&quot;#refsIEEE754r&quot;&gt;[IEEE754R]&lt;/a&gt;
 
   &lt;p class=note&gt;The width and height (&lt;var title=&quot;&quot;&gt;w&lt;/var&gt; and &lt;var
-   title=&quot;&quot;&gt;h&lt;/var&gt;) might be different than the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; and
+   title=&quot;&quot;&gt;h&lt;/var&gt;) might be different from the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; and
    &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments to the function, e.g. if the canvas is
    backed by a high-resolution bitmap.
 
@@ -17325,10 +17330,10 @@
 
   &lt;p&gt;The &lt;dfn id=putimagedata
    title=dom-context-2d-putImageData&gt;&lt;code&gt;putImageData(&lt;var
-   title=&quot;&quot;&gt;image&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var
+   title=&quot;&quot;&gt;imagedata&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var
    title=&quot;&quot;&gt;dy&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must take the given &lt;code&gt;&lt;a
    href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; structure, and place it at the
-   specified location &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;,&lt;var title=&quot;&quot;&gt;dy&lt;/var&gt; in the
+   specified location (&lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dy&lt;/var&gt;) in the
    canvas coordinate space, mapping each pixel represented by the &lt;code&gt;&lt;a
    href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; structure into one device pixel.
 
@@ -17387,7 +17392,14 @@
    title=dom-context-2d-putImageData&gt;&lt;a
    href=&quot;#putimagedata&quot;&gt;putImageData()&lt;/a&gt;&lt;/code&gt; operations.
 
-  &lt;p&gt;The current transformation matrix must not affect the &lt;code
+  &lt;p&gt;The current path, &lt;a href=&quot;#transformations0&quot;
+   title=dom-context-2d-transformation&gt;transformation matrix&lt;/a&gt;, &lt;a
+   href=&quot;#shadows0&quot; title=shadows&gt;shadow attributes&lt;/a&gt;, &lt;a
+   href=&quot;#globalalpha&quot; title=dom-context-2d-globalAlpha&gt;global alpha&lt;/a&gt;, &lt;a
+   href=&quot;#clipping&quot; title=&quot;clipping path&quot;&gt;clipping path&lt;/a&gt;, and &lt;a
+   href=&quot;#globalcompositeoperation&quot;
+   title=dom-context-2d-globalCompositeOperation&gt;global composition
+   operator&lt;/a&gt; must not affect the &lt;code
    title=dom-context-2d-getImageData&gt;&lt;a
    href=&quot;#getimagedata&quot;&gt;getImageData()&lt;/a&gt;&lt;/code&gt; and &lt;code
    title=dom-context-2d-putImageData&gt;&lt;a
@@ -17399,7 +17411,7 @@
     the canvas backing store, which is likely to not be one device pixel to
     each CSS pixel if the display used is a high resolution display. Thus,
     while one could create an &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt;
-    object, one would net necessarily know what resolution the canvas
+    object, one would not necessarily know what resolution the canvas
     expected (how many pixels the canvas wants to paint over one coordinate
     space unit pixel).&lt;/p&gt;
 
@@ -17423,23 +17435,86 @@
     };
   }
 
+  // create a blank slate
+  var data = CreateImageData(actualWidth, actualHeight);
+
   // create some plasma
-  var plasma = CreateImageData(actualWidth, actualHeight);
-  FillPlasma(plasma, 'green'); // green plasma
+  FillPlasma(data, 'green'); // green plasma
 
-  // create a cloud
-  var could = CreateImageData(actualWidth, actualHeight);
-  FillCloud(cloud, actualWidth/2, actualHeight/2); // put a cloud in the middle
+  // add a cloud to the plasma
+  AddCloud(data, actualWidth/2, actualHeight/2); // put a cloud in the middle
 
-  // paint them on top of each other
-  context.putImageData(plasma, 0, 0);
-  context.putImageData(cloud, 0, 0);
+  // paint the plasma+cloud on the canvas
+  context.putImageData(data, 0, 0);
 
-  function FillPlasma(data) { ... }
-  function FillCload(data, x, y) { ... }
+  // support methods
+  function FillPlasma(data, color) { ... }
+  function AddCload(data, x, y) { ... }
 &lt;/pre&gt;
   &lt;/div&gt;
 
+  &lt;div class=example&gt;
+   &lt;p&gt;Here is an example of using &lt;code title=dom-context-2d-getImageData&gt;&lt;a
+    href=&quot;#getimagedata&quot;&gt;getImageData()&lt;/a&gt;&lt;/code&gt; and &lt;code
+    title=dom-context-2d-putImageData&gt;&lt;a
+    href=&quot;#putimagedata&quot;&gt;putImageData()&lt;/a&gt;&lt;/code&gt; to implement an edge
+    detection filter.&lt;/p&gt;
+
+   &lt;pre&gt;&lt;!DOCTYPE HTML&gt;
+&lt;html&gt;
+ &lt;head&gt;
+  &lt;title&gt;Edge detection demo&lt;/title&gt;
+  &lt;script&gt;
+   var image = new Image();
+   function init() {
+     image.onload = demo;
+     image.src = &quot;image.jpeg&quot;;
+   }
+   function demo() {
+     var canvas = document.getElementsByTagName('canvas')[0];
+     var context = canvas.getContext('2d');
+
+     // draw the image onto the canvas
+     context.drawImage(image, 0, 0);
+
+     // get the image data to manipulate
+     var input = context.getImageData(0, 0, canvas.width, canvas.height);
+
+     // edge detection
+     // notice that we are using input.width and input.height here
+     // as they might not be the same as canvas.width and canvas.height
+     // (in particular, they might be different on high-res displays)
+     var w = input.width, h = input.height;
+     var inputData = input.data;
+     var outputData = new Array(w*h*4);
+     for (var y = 1; y &lt; h-1; y += 1) {
+       for (var x = 1; x &lt; w-1; x += 1) {
+         for (var c = 0; c &lt; 3; c += 1) {
+           var i = (y*w + x)*4 + c;
+           outputData[i] = 127 + -inputData[i - w*4 - 4] -   inputData[i - w*4] - inputData[i - w*4 + 4] +
+                                 -inputData[i - 4]       + 8*inputData[i]       - inputData[i + 4] +
+                                 -inputData[i + w*4 - 4] -   inputData[i + w*4] - inputData[i + w*4 + 4];
+         }
+         outputData[(y*w + x)*4 + 3] = 255; // alpha
+       }
+     }
+
+     // put the image data back after manipulation
+     var output = {
+       width: w,
+       height: h,
+       data: outputData
+     };
+     context.putImageData(output, 0, 0);
+   }
+  &lt;/script&gt;
+ &lt;/head&gt;
+ &lt;body onload=&quot;init()&quot;&gt;
+  &lt;canvas&gt;&lt;/canvas&gt;
+ &lt;/body&gt;
+&lt;/html&gt;&lt;/pre&gt;
+  &lt;/div&gt;
+
   &lt;h6 id=drawing&gt;&lt;span class=secno&gt;3.14.11.1.11. &lt;/span&gt;Drawing model&lt;/h6&gt;
 
   &lt;p&gt;When a shape or image is painted, user agents must follow these steps,

Modified: source
===================================================================
--- source	2008-01-18 02:45:39 UTC (rev 1165)
+++ source	2008-01-22 02:22:38 UTC (rev 1166)
@@ -13537,7 +13537,7 @@
   &lt;p&gt;This specification only defines one context, with the name &quot;&lt;code
   title=&quot;canvas-context-2d&quot;&gt;2d&lt;/code&gt;&quot;. If &lt;code
   title=&quot;dom-canvas-getContext&quot;&gt;getContext()&lt;/code&gt; is called with
-  that exact string for tis &lt;var title=&quot;&quot;&gt;contextId&lt;/var&gt; argument,
+  that exact string for its &lt;var title=&quot;&quot;&gt;contextId&lt;/var&gt; argument,
   then the UA must return a reference to an object implementing
   &lt;code&gt;CanvasRenderingContext2D&lt;/code&gt;. Other specifications may
   define their own contexts, which would return different objects.&lt;/p&gt;
@@ -13697,7 +13697,7 @@
 
   // pixel manipulation
   &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData&lt;/span&gt;(in float sx, in float sy, in float sw, in float sh);
-  void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; image, in float dx, in float dy);
+  void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy);
 
   // drawing text is not supported in this version of the API
   // (there is no way to predict what metrics the fonts will have,
@@ -14536,7 +14536,7 @@
 
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-context-2d-strokeRect&quot;&gt;&lt;code&gt;strokeRect()&lt;/code&gt;&lt;/dfn&gt;
-  method must draw stroke the specified rectangle's path using the
+  method must stroke the specified rectangle's path using the
   &lt;code title=&quot;dom-context-2d-strokeStyle&quot;&gt;strokeStyle&lt;/code&gt;, &lt;code
   title=&quot;dom-context-2d-lineWidth&quot;&gt;lineWidth&lt;/code&gt;, &lt;code
   title=&quot;dom-context-2d-lineJoin&quot;&gt;lineJoin&lt;/code&gt;, and (if
@@ -14837,6 +14837,11 @@
   since the image is just repeating what was stated in the previous
   paragraph. --&gt;
 
+  &lt;p class=&quot;note&quot;&gt;When a canvas is drawn onto itself, the drawing
+  model requires the source to be copied before the image is drawn
+  back onto the canvas, so it is possible to copy parts of a canvas
+  onto overlapping parts of itself.&lt;/p&gt;
+
   &lt;p&gt;Images are painted without affecting the current path, and are
   subject to &lt;span title=&quot;shadows&quot;&gt;shadow effects&lt;/span&gt;, &lt;span
   title=&quot;dom-context-2d-globalAlpha&quot;&gt;global alpha&lt;/span&gt;, &lt;span
@@ -14856,28 +14861,28 @@
   title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;,
   &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return an
   &lt;code&gt;ImageData&lt;/code&gt; object representing the underlying pixel data
-  for the area of the canvas denoted by the rectangle which has one
-  corner at the (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;)
-  coordinate, and that has width &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; and height
-  &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;. Pixels outside the canvas must be returned
-  as transparent black. Pixels must be returned as non-premultiplied
-  alpha values.&lt;/p&gt;
+  for the area of the canvas denoted by the rectangle which has its
+  top left corner at the (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;sy&lt;/var&gt;) coordinate, and that has width &lt;var
+  title=&quot;&quot;&gt;sw&lt;/var&gt; and height &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;. Pixels outside
+  the canvas must be returned as transparent black. Pixels must be
+  returned as non-premultiplied alpha values.&lt;/p&gt;
 
   &lt;p&gt;&lt;code&gt;ImageData&lt;/code&gt; objects must be initialised so that their
-  &lt;dfn title=&quot;dom-imagedata-height&quot;&gt;&lt;code&gt;height&lt;/code&gt;&lt;/dfn&gt;
-  attribute is set to &lt;var title=&quot;&quot;&gt;h&lt;/var&gt;, the number of rows in the
-  image data, their &lt;dfn
-  title=&quot;dom-imagedata-width&quot;&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; attribute is
-  set to &lt;var title=&quot;&quot;&gt;w&lt;/var&gt;, the number of physical device pixels
-  per row in the image data, and the &lt;dfn
-  title=&quot;dom-imagedata-data&quot;&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt; attribute is
-  initialised to an array of &lt;var title=&quot;&quot;&gt;h&lt;/var&gt;&times;&lt;var
-  title=&quot;&quot;&gt;w&lt;/var&gt;&times;4 integers. The pixels must be represented in
-  this array in left-to-right order, row by row, starting at the top
-  left, with each pixel's red, green, blue, and alpha components being
-  given in that order. Each component of each device pixel represented
-  in this array must be in the range 0..255, representing the 8 bit
-  value for that component. At least one pixel must be returned.&lt;/p&gt;
+  &lt;dfn title=&quot;dom-imagedata-width&quot;&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; attribute
+  is set to &lt;var title=&quot;&quot;&gt;w&lt;/var&gt;, the number of physical device
+  pixels per row in the image data, their &lt;dfn
+  title=&quot;dom-imagedata-height&quot;&gt;&lt;code&gt;height&lt;/code&gt;&lt;/dfn&gt; attribute is
+  set to &lt;var title=&quot;&quot;&gt;h&lt;/var&gt;, the number of rows in the image data,
+  and the &lt;dfn title=&quot;dom-imagedata-data&quot;&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt;
+  attribute is initialised to an array of &lt;var
+  title=&quot;&quot;&gt;h&lt;/var&gt;&times;&lt;var title=&quot;&quot;&gt;w&lt;/var&gt;&times;4 integers. The
+  pixels must be represented in this array in left-to-right order, row
+  by row, starting at the top left, with each pixel's red, green,
+  blue, and alpha components being given in that order. Each component
+  of each device pixel represented in this array must be in the range
+  0..255, representing the 8 bit value for that component. At least
+  one pixel must be returned.&lt;/p&gt;
 
   &lt;p&gt;The values of the &lt;code title=&quot;dom-imagedata-data&quot;&gt;data&lt;/code&gt;
   array may be changed (the length of the array, and the other
@@ -14887,14 +14892,14 @@
   ToNumber algorithm, and if the result is not a number, a
   &lt;code&gt;TYPE_MISMATCH_ERR&lt;/code&gt; exception must be raised. If the
   result is less than 0, it must be clamped to zero. If the result is
-  more than 255, it must be clamed to 255. If the number is not an
+  more than 255, it must be clamped to 255. If the number is not an
   integer, it must be rounded to the nearest integer using the IEEE
   754r &lt;i&gt;roundTiesToEven&lt;/i&gt; rounding mode.  &lt;a
   href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt; &lt;a
   href=&quot;#refsIEEE754r&quot;&gt;[IEEE754R]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;The width and height (&lt;var title=&quot;&quot;&gt;w&lt;/var&gt; and &lt;var
-  title=&quot;&quot;&gt;h&lt;/var&gt;) might be different than the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;
+  title=&quot;&quot;&gt;h&lt;/var&gt;) might be different from the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;
   and &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments to the function, e.g. if the
   canvas is backed by a high-resolution bitmap.&lt;/p&gt;
 
@@ -14908,11 +14913,11 @@
 
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-context-2d-putImageData&quot;&gt;&lt;code&gt;putImageData(&lt;var
-  title=&quot;&quot;&gt;image&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;imagedata&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var
   title=&quot;&quot;&gt;dy&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must take the given
   &lt;code&gt;ImageData&lt;/code&gt; structure, and place it at the specified
-  location &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;,&lt;var title=&quot;&quot;&gt;dy&lt;/var&gt; in the canvas
-  coordinate space, mapping each pixel represented by the
+  location (&lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dy&lt;/var&gt;) in the
+  canvas coordinate space, mapping each pixel represented by the
   &lt;code&gt;ImageData&lt;/code&gt; structure into one device pixel.&lt;/p&gt;
 
   &lt;p&gt;If the first argument to the method is not an object whose
@@ -14969,7 +14974,13 @@
   title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData()&lt;/code&gt;
   operations.&lt;/p&gt;
 
-  &lt;p&gt;The current transformation matrix must not affect the &lt;code
+  &lt;p&gt;The current path, &lt;span
+  title=&quot;dom-context-2d-transformation&quot;&gt;transformation matrix&lt;/span&gt;,
+  &lt;span title=&quot;shadows&quot;&gt;shadow attributes&lt;/span&gt;, &lt;span
+  title=&quot;dom-context-2d-globalAlpha&quot;&gt;global alpha&lt;/span&gt;, &lt;span
+  title=&quot;clipping path&quot;&gt;clipping path&lt;/span&gt;, and &lt;span
+  title=&quot;dom-context-2d-globalCompositeOperation&quot;&gt;global composition
+  operator&lt;/span&gt; must not affect the &lt;code
   title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData()&lt;/code&gt; and &lt;code
   title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData()&lt;/code&gt;
   methods.&lt;/p&gt;
@@ -14981,7 +14992,7 @@
    resolution of the canvas backing store, which is likely to not be
    one device pixel to each CSS pixel if the display used is a high
    resolution display. Thus, while one could create an
-   &lt;code&gt;ImageData&lt;/code&gt; object, one would net necessarily know what
+   &lt;code&gt;ImageData&lt;/code&gt; object, one would not necessarily know what
    resolution the canvas expected (how many pixels the canvas wants to
    paint over one coordinate space unit pixel).&lt;/p&gt;
 
@@ -15005,25 +15016,89 @@
     };
   }
 
+  // create a blank slate
+  var data = CreateImageData(actualWidth, actualHeight);
+
   // create some plasma
-  var plasma = CreateImageData(actualWidth, actualHeight);
-  FillPlasma(plasma, 'green'); // green plasma
+  FillPlasma(data, 'green'); // green plasma
 
-  // create a cloud
-  var could = CreateImageData(actualWidth, actualHeight);
-  FillCloud(cloud, actualWidth/2, actualHeight/2); // put a cloud in the middle
+  // add a cloud to the plasma
+  AddCloud(data, actualWidth/2, actualHeight/2); // put a cloud in the middle
 
-  // paint them on top of each other
-  context.putImageData(plasma, 0, 0);
-  context.putImageData(cloud, 0, 0);
+  // paint the plasma+cloud on the canvas
+  context.putImageData(data, 0, 0);
 
-  function FillPlasma(data) { ... }
-  function FillCload(data, x, y) { ... }
+  // support methods
+  function FillPlasma(data, color) { ... }
+  function AddCload(data, x, y) { ... }
 &lt;/pre&gt;
 
   &lt;/div&gt;
 
+  &lt;div class=&quot;example&quot;&gt;
 
+   &lt;p&gt;Here is an example of using &lt;code
+   title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData()&lt;/code&gt; and &lt;code
+   title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData()&lt;/code&gt; to
+   implement an edge detection filter.&lt;/p&gt;
+
+   &lt;pre&gt;&lt;!DOCTYPE HTML&gt;
+&lt;html&gt;
+ &lt;head&gt;
+  &lt;title&gt;Edge detection demo&lt;/title&gt;
+  &lt;script&gt;
+   var image = new Image();
+   function init() {
+     image.onload = demo;
+     image.src = &quot;image.jpeg&quot;;
+   }
+   function demo() {
+     var canvas = document.getElementsByTagName('canvas')[0];
+     var context = canvas.getContext('2d');
+
+     // draw the image onto the canvas
+     context.drawImage(image, 0, 0);
+
+     // get the image data to manipulate
+     var input = context.getImageData(0, 0, canvas.width, canvas.height);
+
+     // edge detection
+     // notice that we are using input.width and input.height here
+     // as they might not be the same as canvas.width and canvas.height
+     // (in particular, they might be different on high-res displays)
+     var w = input.width, h = input.height;
+     var inputData = input.data;
+     var outputData = new Array(w*h*4);
+     for (var y = 1; y &lt; h-1; y += 1) {
+       for (var x = 1; x &lt; w-1; x += 1) {
+         for (var c = 0; c &lt; 3; c += 1) {
+           var i = (y*w + x)*4 + c;
+           outputData[i] = 127 + -inputData[i - w*4 - 4] -   inputData[i - w*4] - inputData[i - w*4 + 4] +
+                                 -inputData[i - 4]       + 8*inputData[i]       - inputData[i + 4] +
+                                 -inputData[i + w*4 - 4] -   inputData[i + w*4] - inputData[i + w*4 + 4];
+         }
+         outputData[(y*w + x)*4 + 3] = 255; // alpha
+       }
+     }
+
+     // put the image data back after manipulation
+     var output = {
+       width: w,
+       height: h,
+       data: outputData
+     };
+     context.putImageData(output, 0, 0);
+   }
+  &lt;/script&gt;
+ &lt;/head&gt;
+ &lt;body onload=&quot;init()&quot;&gt;
+  &lt;canvas&gt;&lt;/canvas&gt;
+ &lt;/body&gt;
+&lt;/html&gt;&lt;/pre&gt;
+
+  &lt;/div&gt;
+
+
   &lt;h6&gt;Drawing model&lt;/h6&gt;
 
   &lt;p&gt;When a shape or image is painted, user agents must follow these


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008073.html">[html5] r1165 - /
</A></li>
	<LI>Next message: <A HREF="008075.html">[html5] r1167 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8074">[ date ]</a>
              <a href="thread.html#8074">[ thread ]</a>
              <a href="subject.html#8074">[ subject ]</a>
              <a href="author.html#8074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
