<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1192 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1192%20-%20/&In-Reply-To=%3C20080201064154.BECFE38EF8F%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008099.html">
   <LINK REL="Next"  HREF="008101.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1192 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1192%20-%20/&In-Reply-To=%3C20080201064154.BECFE38EF8F%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1192 - /">whatwg at whatwg.org
       </A><BR>
    <I>Thu Jan 31 22:41:54 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008099.html">[html5] r1191 - /
</A></li>
        <LI>Next message: <A HREF="008101.html">[html5] r1193 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8100">[ date ]</a>
              <a href="thread.html#8100">[ thread ]</a>
              <a href="subject.html#8100">[ subject ]</a>
              <a href="author.html#8100">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-01-31 22:41:50 -0800 (Thu, 31 Jan 2008)
New Revision: 1192

Modified:
   index
   source
Log:
[gow] (2) Overhaul of canvas security requirements.

Modified: index
===================================================================
--- index	2008-02-01 05:50:15 UTC (rev 1191)
+++ index	2008-02-01 06:41:50 UTC (rev 1192)
@@ -718,7 +718,10 @@
             &lt;/span&gt;Drawing model&lt;/a&gt;
           &lt;/ul&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#color&quot;&gt;&lt;span class=secno&gt;3.14.11.2. &lt;/span&gt;Color
+         &lt;li&gt;&lt;a href=&quot;#security1&quot;&gt;&lt;span class=secno&gt;3.14.11.2.
+          &lt;/span&gt;Security with &lt;code&gt;canvas&lt;/code&gt; elements&lt;/a&gt;
+
+         &lt;li&gt;&lt;a href=&quot;#color&quot;&gt;&lt;span class=secno&gt;3.14.11.3. &lt;/span&gt;Color
           spaces and color correction&lt;/a&gt;
         &lt;/ul&gt;
 
@@ -994,7 +997,7 @@
      &lt;li&gt;&lt;a href=&quot;#the-default0&quot;&gt;&lt;span class=secno&gt;4.2. &lt;/span&gt;The default
       view&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#security1&quot;&gt;&lt;span class=secno&gt;4.2.1. &lt;/span&gt;Security&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#security2&quot;&gt;&lt;span class=secno&gt;4.2.1. &lt;/span&gt;Security&lt;/a&gt;
 
        &lt;li&gt;&lt;a href=&quot;#constructors&quot;&gt;&lt;span class=secno&gt;4.2.2.
         &lt;/span&gt;Constructors&lt;/a&gt;
@@ -1016,7 +1019,7 @@
        &lt;li&gt;&lt;a href=&quot;#unscripted&quot;&gt;&lt;span class=secno&gt;4.3.3. &lt;/span&gt;Unscripted
         same-origin checks&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#security2&quot;&gt;&lt;span class=secno&gt;4.3.4. &lt;/span&gt;Security
+       &lt;li&gt;&lt;a href=&quot;#security3&quot;&gt;&lt;span class=secno&gt;4.3.4. &lt;/span&gt;Security
         exceptions&lt;/a&gt;
 
        &lt;li&gt;&lt;a href=&quot;#javascript-protocol&quot;&gt;&lt;span class=secno&gt;4.3.5. &lt;/span&gt;The
@@ -1046,7 +1049,7 @@
        &lt;li&gt;&lt;a href=&quot;#custom-handlers&quot;&gt;&lt;span class=secno&gt;4.5.1. &lt;/span&gt;Custom
         protocol and content handlers&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#security3&quot;&gt;&lt;span class=secno&gt;4.5.1.1. &lt;/span&gt;Security
+         &lt;li&gt;&lt;a href=&quot;#security4&quot;&gt;&lt;span class=secno&gt;4.5.1.1. &lt;/span&gt;Security
           and privacy&lt;/a&gt;
 
          &lt;li&gt;&lt;a href=&quot;#sample-handler-impl&quot;&gt;&lt;span class=secno&gt;4.5.1.2.
@@ -1105,7 +1108,7 @@
        &lt;li&gt;&lt;a href=&quot;#the-location&quot;&gt;&lt;span class=secno&gt;4.7.4. &lt;/span&gt;The
         &lt;code&gt;Location&lt;/code&gt; interface&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#security4&quot;&gt;&lt;span class=secno&gt;4.7.4.1.
+         &lt;li&gt;&lt;a href=&quot;#security5&quot;&gt;&lt;span class=secno&gt;4.7.4.1.
           &lt;/span&gt;Security&lt;/a&gt;
         &lt;/ul&gt;
 
@@ -1187,7 +1190,7 @@
           &lt;/span&gt;Threads&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#security5&quot;&gt;&lt;span class=secno&gt;4.10.7. &lt;/span&gt;Security and
+       &lt;li&gt;&lt;a href=&quot;#security6&quot;&gt;&lt;span class=secno&gt;4.10.7. &lt;/span&gt;Security and
         privacy&lt;/a&gt;
         &lt;ul class=toc&gt;
          &lt;li&gt;&lt;a href=&quot;#user-tracking&quot;&gt;&lt;span class=secno&gt;4.10.7.1. &lt;/span&gt;User
@@ -1229,7 +1232,7 @@
 
        &lt;li&gt;&lt;a href=&quot;#privacy&quot;&gt;&lt;span class=secno&gt;4.11.7. &lt;/span&gt;Privacy&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#security6&quot;&gt;&lt;span class=secno&gt;4.11.8. &lt;/span&gt;Security&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#security7&quot;&gt;&lt;span class=secno&gt;4.11.8. &lt;/span&gt;Security&lt;/a&gt;
         
         &lt;ul class=toc&gt;
          &lt;li&gt;&lt;a href=&quot;#user-agents&quot;&gt;&lt;span class=secno&gt;4.11.8.1. &lt;/span&gt;User
@@ -1396,7 +1399,7 @@
           selection&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#security7&quot;&gt;&lt;span class=secno&gt;5.3.6. &lt;/span&gt;Security
+       &lt;li&gt;&lt;a href=&quot;#security8&quot;&gt;&lt;span class=secno&gt;5.3.6. &lt;/span&gt;Security
         risks in the drag-and-drop model&lt;/a&gt;
       &lt;/ul&gt;
 
@@ -2590,7 +2593,7 @@
 
   &lt;h4 id=security&gt;&lt;span class=secno&gt;2.1.1. &lt;/span&gt;Security&lt;/h4&gt;
 
-  &lt;p&gt;User agents must raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;
+  &lt;p&gt;User agents must raise a &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;
    whenever any of the members of an &lt;code&gt;&lt;a
    href=&quot;#htmldocument&quot;&gt;HTMLDocument&lt;/a&gt;&lt;/code&gt; object are accessed by
    scripts whose &lt;a href=&quot;#origin0&quot;&gt;origin&lt;/a&gt; is not the same as the
@@ -2609,7 +2612,7 @@
    must return its current value. On setting, if the new value is an allowed
    value (as defined below), the attribute's value must be changed to the new
    value. If the new value is not an allowed value, then a &lt;a
-   href=&quot;#security8&quot;&gt;security exception&lt;/a&gt; must be raised instead.
+   href=&quot;#security9&quot;&gt;security exception&lt;/a&gt; must be raised instead.
 
   &lt;p&gt;A new value is an allowed value for the &lt;code
    title=dom-document-domain&gt;&lt;a href=&quot;#domain&quot;&gt;document.domain&lt;/a&gt;&lt;/code&gt;
@@ -16145,15 +16148,6 @@
    href=&quot;#todataurl&quot;&gt;toDataURL()&lt;/a&gt;&lt;/code&gt; to allow authors to more
    carefully control compression settings, image metadata, etc.
 
-  &lt;p&gt;&lt;strong&gt;Security:&lt;/strong&gt; To prevent &lt;em&gt;information leakage&lt;/em&gt;, the
-   &lt;code title=dom-canvas-toDataURL&gt;&lt;a
-   href=&quot;#todataurl&quot;&gt;toDataURL()&lt;/a&gt;&lt;/code&gt; and &lt;code
-   title=dom-context-2d-getImageData&gt;&lt;a
-   href=&quot;#getimagedata&quot;&gt;getImageData()&lt;/a&gt;&lt;/code&gt; methods should raise a &lt;a
-   href=&quot;#security8&quot;&gt;security exception&lt;/a&gt; if the canvas has ever had an
-   image painted on it whose &lt;a href=&quot;#origin0&quot;&gt;origin&lt;/a&gt; is different from
-   that of the script calling the method.
-
   &lt;h5 id=the-2d&gt;&lt;span class=secno&gt;3.14.11.1. &lt;/span&gt;The 2D context&lt;/h5&gt;
 
   &lt;p&gt;When the &lt;code title=dom-canvas-getContext&gt;&lt;a
@@ -17788,7 +17782,63 @@
   &lt;p class=&quot;big-issue&quot;&gt;Well, one day.&lt;/p&gt;
 --&gt;
 
-  &lt;h5 id=color&gt;&lt;span class=secno&gt;3.14.11.2. &lt;/span&gt;Color spaces and color
+  &lt;h5 id=security1&gt;&lt;span class=secno&gt;3.14.11.2. &lt;/span&gt;Security with &lt;code&gt;&lt;a
+   href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; elements&lt;/h5&gt;
+
+  &lt;p&gt;&lt;strong&gt;Information leakage&lt;/strong&gt; can occur if scripts from one
+   origin are exposed to images from another origin.
+
+  &lt;p&gt;To mitigate this, &lt;code&gt;&lt;a href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; elements are
+   defined to have a flag indicating whether they are &lt;i&gt;origin-clean&lt;/i&gt;.
+   All &lt;code&gt;&lt;a href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; elements must start with
+   their &lt;i&gt;origin-clean&lt;/i&gt; set to true. The flag must be set to false if
+   any of the following actions occur:
+
+  &lt;ul&gt;
+   &lt;li&gt;
+    &lt;p&gt;The element's 2D context's &lt;code title=dom-context-2d-drawImage&gt;&lt;a
+     href=&quot;#drawimage&quot;&gt;drawImage()&lt;/a&gt;&lt;/code&gt; method is called with an
+     &lt;code&gt;&lt;a href=&quot;#htmlimageelement&quot;&gt;HTMLImageElement&lt;/a&gt;&lt;/code&gt; whose &lt;a
+     href=&quot;#origin0&quot;&gt;origin&lt;/a&gt; differs from that of the
+     &lt;code&gt;Document&lt;/code&gt; object that owns the &lt;code&gt;&lt;a
+     href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element.
+
+   &lt;li&gt;
+    &lt;p&gt;The element's 2D context's &lt;code title=dom-context-2d-drawImage&gt;&lt;a
+     href=&quot;#drawimage&quot;&gt;drawImage()&lt;/a&gt;&lt;/code&gt; method is called with an
+     &lt;code&gt;&lt;a href=&quot;#htmlcanvaselement&quot;&gt;HTMLCanvasElement&lt;/a&gt;&lt;/code&gt; whose
+     &lt;i&gt;origin-clean&lt;/i&gt; flag is false.
+
+   &lt;li&gt;
+    &lt;p&gt;The element's 2D context's &lt;code title=dom-context-2d-fillStyle&gt;&lt;a
+     href=&quot;#fillstyle&quot;&gt;fillStyle&lt;/a&gt;&lt;/code&gt; attribute is set to a &lt;code&gt;&lt;a
+     href=&quot;#canvaspattern0&quot;&gt;CanvasPattern&lt;/a&gt;&lt;/code&gt; object that was created
+     from an &lt;code&gt;&lt;a href=&quot;#htmlimageelement&quot;&gt;HTMLImageElement&lt;/a&gt;&lt;/code&gt;
+     whose &lt;a href=&quot;#origin0&quot;&gt;origin&lt;/a&gt; differs from that of the
+     &lt;code&gt;Document&lt;/code&gt; object that owns the &lt;code&gt;&lt;a
+     href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element.
+
+   &lt;li&gt;
+    &lt;p&gt;The element's 2D context's &lt;code title=dom-context-2d-fillStyle&gt;&lt;a
+     href=&quot;#fillstyle&quot;&gt;fillStyle&lt;/a&gt;&lt;/code&gt; attribute is set to a &lt;code&gt;&lt;a
+     href=&quot;#canvaspattern0&quot;&gt;CanvasPattern&lt;/a&gt;&lt;/code&gt; object that was created
+     from an &lt;code&gt;&lt;a href=&quot;#htmlcanvaselement&quot;&gt;HTMLCanvasElement&lt;/a&gt;&lt;/code&gt;
+     whose &lt;i&gt;origin-clean&lt;/i&gt; flag is false.
+  &lt;/ul&gt;
+
+  &lt;p&gt;Whenever the &lt;code title=dom-canvas-toDataURL&gt;&lt;a
+   href=&quot;#todataurl&quot;&gt;toDataURL()&lt;/a&gt;&lt;/code&gt; method of a &lt;code&gt;&lt;a
+   href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element whose &lt;i&gt;origin-clean&lt;/i&gt; flag is
+   set to false is called, the method must immediately raise a security
+   exception.
+
+  &lt;p&gt;Whenever the &lt;code title=dom-context-2d-getImageData&gt;&lt;a
+   href=&quot;#getimagedata&quot;&gt;getImageData()&lt;/a&gt;&lt;/code&gt; method of the 2D context of
+   a &lt;code&gt;&lt;a href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element whose
+   &lt;i&gt;origin-clean&lt;/i&gt; flag is set to false is called, the method must
+   immediately raise a security exception.
+
+  &lt;h5 id=color&gt;&lt;span class=secno&gt;3.14.11.3. &lt;/span&gt;Color spaces and color
    correction&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; APIs must perform colour
@@ -25339,9 +25389,9 @@
    href=&quot;#get&quot; title=dom-item&gt;have an implicit [[Get]] method&lt;/a&gt; which
    returns &lt;span&gt;nested browsing contexts&lt;/span&gt;.
 
-  &lt;h4 id=security1&gt;&lt;span class=secno&gt;4.2.1. &lt;/span&gt;Security&lt;/h4&gt;
+  &lt;h4 id=security2&gt;&lt;span class=secno&gt;4.2.1. &lt;/span&gt;Security&lt;/h4&gt;
 
-  &lt;p&gt;User agents must raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;
+  &lt;p&gt;User agents must raise a &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;
    whenever any of the members of a &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt;
    object are accessed by scripts whose &lt;a href=&quot;#origin0&quot;&gt;origin&lt;/a&gt; is not
    the same as the &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object's &lt;a
@@ -25732,9 +25782,9 @@
     &lt;p&gt;Otherwise, the two URIs do have the same scheme/host/port.
   &lt;/ol&gt;
 
-  &lt;h4 id=security2&gt;&lt;span class=secno&gt;4.3.4. &lt;/span&gt;Security exceptions&lt;/h4&gt;
+  &lt;h4 id=security3&gt;&lt;span class=secno&gt;4.3.4. &lt;/span&gt;Security exceptions&lt;/h4&gt;
 
-  &lt;p class=big-issue&gt;Define &lt;dfn id=security8&gt;security exception&lt;/dfn&gt;.
+  &lt;p class=big-issue&gt;Define &lt;dfn id=security9&gt;security exception&lt;/dfn&gt;.
 
   &lt;h4 id=javascript-protocol&gt;&lt;span class=secno&gt;4.3.5. &lt;/span&gt;&lt;dfn
    id=the-javascript title=&quot;javascript protocol&quot;&gt;The &lt;code
@@ -26534,7 +26584,7 @@
      the user what the site in question is.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;p&gt;User agents should raise &lt;a href=&quot;#security8&quot; title=&quot;security
+  &lt;p&gt;User agents should raise &lt;a href=&quot;#security9&quot; title=&quot;security
    exception&quot;&gt;security exceptions&lt;/a&gt; if the methods are called with &lt;var
    title=&quot;&quot;&gt;protocol&lt;/var&gt; or &lt;var title=&quot;&quot;&gt;mimeType&lt;/var&gt; values that the UA
    deems to be &quot;privileged&quot;. For example, a site attempting to register a
@@ -26562,7 +26612,7 @@
    non-idempotent transaction), as the remote site would not be able to fetch
    the same data.
 
-  &lt;h5 id=security3&gt;&lt;span class=secno&gt;4.5.1.1. &lt;/span&gt;Security and privacy&lt;/h5&gt;
+  &lt;h5 id=security4&gt;&lt;span class=secno&gt;4.5.1.1. &lt;/span&gt;Security and privacy&lt;/h5&gt;
 
   &lt;p&gt;These mechanisms can introduce a number of concerns, in particular
    privacy concerns.
@@ -27910,7 +27960,7 @@
 
    &lt;li&gt;
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; has a different &lt;scheme&gt; component than
-     the manifest's URI, then raise a &lt;a href=&quot;#security8&quot;&gt;security
+     the manifest's URI, then raise a &lt;a href=&quot;#security9&quot;&gt;security
      exception&lt;/a&gt;.
 
    &lt;li&gt;
@@ -28425,7 +28475,7 @@
    hierarchical &lt;scheme&gt;). If the verification fails (either because
    the argument is syntactically incorrect, or differs in a way not described
    as acceptable in the previous sentence) then the user agent must raise a
-   &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;. &lt;a
+   &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;. &lt;a
    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
 
   &lt;p&gt;If the third argument passes its verification step, or if the third
@@ -28630,9 +28680,9 @@
 user reload must be equivalent to .reload()
 --&gt;
 
-  &lt;h5 id=security4&gt;&lt;span class=secno&gt;4.7.4.1. &lt;/span&gt;Security&lt;/h5&gt;
+  &lt;h5 id=security5&gt;&lt;span class=secno&gt;4.7.4.1. &lt;/span&gt;Security&lt;/h5&gt;
 
-  &lt;p&gt;User agents must raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;
+  &lt;p&gt;User agents must raise a &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;
    whenever any of the members of a &lt;code&gt;&lt;a
    href=&quot;#location2&quot;&gt;Location&lt;/a&gt;&lt;/code&gt; object are accessed by scripts whose
    &lt;a href=&quot;#origin0&quot;&gt;origin&lt;/a&gt; is not the same as the &lt;code&gt;&lt;a
@@ -30394,7 +30444,7 @@
    execution. This specification does not require any particular
    implementation strategy, so long as the requirement above is met.
 
-  &lt;h4 id=security5&gt;&lt;span class=secno&gt;4.10.7. &lt;/span&gt;Security and privacy&lt;/h4&gt;
+  &lt;h4 id=security6&gt;&lt;span class=secno&gt;4.10.7. &lt;/span&gt;Security and privacy&lt;/h4&gt;
 
   &lt;h5 id=user-tracking&gt;&lt;span class=secno&gt;4.10.7.1. &lt;/span&gt;User tracking&lt;/h5&gt;
 
@@ -31094,7 +31144,7 @@
    way as cookies for the purposes of user interfaces, to reduce the risk of
    using this feature for cookie resurrection.
 
-  &lt;h4 id=security6&gt;&lt;span class=secno&gt;4.11.8. &lt;/span&gt;Security&lt;/h4&gt;
+  &lt;h4 id=security7&gt;&lt;span class=secno&gt;4.11.8. &lt;/span&gt;Security&lt;/h4&gt;
 
   &lt;h5 id=user-agents&gt;&lt;span class=secno&gt;4.11.8.1. &lt;/span&gt;User agents&lt;/h5&gt;
 
@@ -33944,7 +33994,7 @@
   &lt;p&gt;If the contents of the selection cannot be represented as text or URIs,
    then the paste operation must not have any effect.
 
-  &lt;h4 id=security7&gt;&lt;span class=secno&gt;5.3.6. &lt;/span&gt;Security risks in the
+  &lt;h4 id=security8&gt;&lt;span class=secno&gt;5.3.6. &lt;/span&gt;Security risks in the
    drag-and-drop model&lt;/h4&gt;
 
   &lt;p&gt;User agents must not make the data added to the &lt;code&gt;&lt;a
@@ -35679,7 +35729,7 @@
 
   &lt;p&gt;First, if the domain part of the script's &lt;a href=&quot;#origin0&quot;&gt;origin&lt;/a&gt;
    is not a host name (e.g. it is an IP address) then the UA must raise a &lt;a
-   href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;. &lt;span class=issue&gt;We currently
+   href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;. &lt;span class=issue&gt;We currently
    don't allow connections to be set up back to an originating IP address,
    but we could, if the subdomain is the empty string.&lt;/span&gt;
 
@@ -35699,15 +35749,15 @@
     65535,
   &lt;/ul&gt;
 
-  &lt;p&gt;...then the UA must raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;.&lt;/p&gt;
+  &lt;p&gt;...then the UA must raise a &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;.&lt;/p&gt;
   &lt;!-- XXX we should have our own port for this too, e.g. 980 --&gt;
 
   &lt;p&gt;Otherwise, the user agent must verify that the &lt;a href=&quot;#the-string&quot;&gt;the
    string representing the script's domain in IDNA format&lt;/a&gt; can be obtained
    without errors. If it cannot, then the user agent must raise a &lt;a
-   href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;.
+   href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;.
 
-  &lt;p&gt;The user agent may also raise a &lt;a href=&quot;#security8&quot;&gt;security
+  &lt;p&gt;The user agent may also raise a &lt;a href=&quot;#security9&quot;&gt;security
    exception&lt;/a&gt; at this time if, for some reason, permission to create a
    direct TCP connection to the relevant host is denied. Reasons could
    include the UA being instructed by the user to not allow direct
@@ -35769,7 +35819,7 @@
    href=&quot;#network1&quot;&gt;network&lt;/a&gt;&lt;/code&gt; attribute of the object must be set to
    &lt;a href=&quot;#the-string&quot;&gt;the string representing the script's domain in IDNA
    format&lt;/a&gt;. If this string cannot be obtained, then the user agent must
-   raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt; exception when the
+   raise a &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt; exception when the
    constructor is called.
 
   &lt;p&gt;The &lt;code title=dom-Connection-peer&gt;&lt;a href=&quot;#peer&quot;&gt;peer&lt;/a&gt;&lt;/code&gt;
@@ -35777,7 +35827,7 @@
 
   &lt;p&gt;The object must then be returned, unless, for some reason, permission to
    broadcast on the local network is to be denied. In the latter case, a &lt;a
-   href=&quot;#security8&quot;&gt;security exception&lt;/a&gt; must be raised instead. User
+   href=&quot;#security9&quot;&gt;security exception&lt;/a&gt; must be raised instead. User
    agents may deny such permission for any reason, for example a user
    preference.
 
@@ -35908,7 +35958,7 @@
    href=&quot;#network1&quot;&gt;network&lt;/a&gt;&lt;/code&gt; attribute of the object must be set to
    &lt;a href=&quot;#the-string&quot;&gt;the string representing the script's domain in IDNA
    format&lt;/a&gt;. If this string cannot be obtained, then the user agent must
-   raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt; exception when the
+   raise a &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt; exception when the
    constructor is called.
 
   &lt;p&gt;The &lt;code title=dom-Connection-peer&gt;&lt;a href=&quot;#peer&quot;&gt;peer&lt;/a&gt;&lt;/code&gt;
@@ -35917,7 +35967,7 @@
   &lt;p&gt;The object must then be returned, unless, for some reason, permission to
    establish peer-to-peer connections is generally disallowed, for example
    due to administrator settings. In the latter case, a &lt;a
-   href=&quot;#security8&quot;&gt;security exception&lt;/a&gt; must be raised instead.
+   href=&quot;#security9&quot;&gt;security exception&lt;/a&gt; must be raised instead.
 
   &lt;p&gt;The user agent must then, typically while the script resumes execution,
    find a remote host to establish a connection to. To do this it must start

Modified: source
===================================================================
--- source	2008-02-01 05:50:15 UTC (rev 1191)
+++ source	2008-02-01 06:41:50 UTC (rev 1192)
@@ -13697,15 +13697,7 @@
   more carefully control compression settings, image metadata,
   etc.&lt;/p&gt;
 
-  &lt;p&gt;&lt;strong&gt;Security:&lt;/strong&gt; To prevent &lt;em&gt;information
-  leakage&lt;/em&gt;, the &lt;code
-  title=&quot;dom-canvas-toDataURL&quot;&gt;toDataURL()&lt;/code&gt; and &lt;code
-  title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData()&lt;/code&gt; methods
-  should raise a &lt;span&gt;security exception&lt;/span&gt; if the canvas has
-  ever had an image painted on it whose &lt;span&gt;origin&lt;/span&gt; is
-  different from that of the script calling the method.&lt;/p&gt;
 
-
   &lt;h5&gt;The 2D context&lt;/h5&gt;
 
   &lt;p&gt;When the &lt;code title=&quot;dom-canvas-getContext&quot;&gt;getContext()&lt;/code&gt;
@@ -15392,7 +15384,59 @@
 --&gt;
 
 
+  &lt;h5&gt;Security with &lt;code&gt;canvas&lt;/code&gt; elements&lt;/h5&gt;
 
+  &lt;p&gt;&lt;strong&gt;Information leakage&lt;/strong&gt; can occur if scripts from
+  one origin are exposed to images from another origin.&lt;/p&gt;
+
+  &lt;p&gt;To mitigate this, &lt;code&gt;canvas&lt;/code&gt; elements are defined to
+  have a flag indicating whether they are &lt;i&gt;origin-clean&lt;/i&gt;. All
+  &lt;code&gt;canvas&lt;/code&gt; elements must start with their
+  &lt;i&gt;origin-clean&lt;/i&gt; set to true. The flag must be set to false if
+  any of the following actions occur:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;&lt;p&gt;The element's 2D context's &lt;code
+   title=&quot;dom-context-2d-drawImage&quot;&gt;drawImage()&lt;/code&gt; method is
+   called with an &lt;code&gt;HTMLImageElement&lt;/code&gt; whose
+   &lt;span&gt;origin&lt;/span&gt; differs from that of the &lt;code&gt;Document&lt;/code&gt;
+   object that owns the &lt;code&gt;canvas&lt;/code&gt; element.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The element's 2D context's &lt;code
+   title=&quot;dom-context-2d-drawImage&quot;&gt;drawImage()&lt;/code&gt; method is
+   called with an &lt;code&gt;HTMLCanvasElement&lt;/code&gt; whose
+   &lt;i&gt;origin-clean&lt;/i&gt; flag is false.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The element's 2D context's &lt;code
+   title=&quot;dom-context-2d-fillStyle&quot;&gt;fillStyle&lt;/code&gt; attribute is set
+   to a &lt;code&gt;CanvasPattern&lt;/code&gt; object that was created from an
+   &lt;code&gt;HTMLImageElement&lt;/code&gt; whose &lt;span&gt;origin&lt;/span&gt; differs
+   from that of the &lt;code&gt;Document&lt;/code&gt; object that owns the
+   &lt;code&gt;canvas&lt;/code&gt; element.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The element's 2D context's &lt;code
+   title=&quot;dom-context-2d-fillStyle&quot;&gt;fillStyle&lt;/code&gt; attribute is set
+   to a &lt;code&gt;CanvasPattern&lt;/code&gt; object that was created from an
+   &lt;code&gt;HTMLCanvasElement&lt;/code&gt; whose &lt;i&gt;origin-clean&lt;/i&gt; flag is
+   false.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+  &lt;p&gt;Whenever the &lt;code
+  title=&quot;dom-canvas-toDataURL&quot;&gt;toDataURL()&lt;/code&gt; method of a
+  &lt;code&gt;canvas&lt;/code&gt; element whose &lt;i&gt;origin-clean&lt;/i&gt; flag is set to
+  false is called, the method must immediately raise a security
+  exception.&lt;/p&gt;
+
+  &lt;p&gt;Whenever the &lt;code
+  title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData()&lt;/code&gt; method of
+  the 2D context of a &lt;code&gt;canvas&lt;/code&gt; element whose
+  &lt;i&gt;origin-clean&lt;/i&gt; flag is set to false is called, the method must
+  immediately raise a security exception.&lt;/p&gt;
+
+
+
   &lt;h5&gt;Color spaces and color correction&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code&gt;canvas&lt;/code&gt; APIs must perform colour correction at


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008099.html">[html5] r1191 - /
</A></li>
	<LI>Next message: <A HREF="008101.html">[html5] r1193 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8100">[ date ]</a>
              <a href="thread.html#8100">[ thread ]</a>
              <a href="subject.html#8100">[ subject ]</a>
              <a href="author.html#8100">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
