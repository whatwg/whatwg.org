<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1308 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1308%20-%20/&In-Reply-To=%3C20080303004345.E1AED38EEF1%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008209.html">
   <LINK REL="Next"  HREF="008211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1308 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1308%20-%20/&In-Reply-To=%3C20080303004345.E1AED38EEF1%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1308 - /">whatwg at whatwg.org
       </A><BR>
    <I>Sun Mar  2 16:43:45 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008209.html">[html5] r1307 - /
</A></li>
        <LI>Next message: <A HREF="008211.html">[html5] r1309 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8210">[ date ]</a>
              <a href="thread.html#8210">[ thread ]</a>
              <a href="subject.html#8210">[ subject ]</a>
              <a href="author.html#8210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-03-02 16:43:43 -0800 (Sun, 02 Mar 2008)
New Revision: 1308

Modified:
   index
   source
Log:
[e] (0) Lay the groundwork for merging phases and insertion modes

Modified: index
===================================================================
--- index	2008-03-02 22:53:06 UTC (rev 1307)
+++ index	2008-03-03 00:43:43 UTC (rev 1308)
@@ -24,7 +24,7 @@
 
    &lt;h1 id=html-5&gt;HTML 5&lt;/h1&gt;
 
-   &lt;h2 class=&quot;no-num no-toc&quot; id=working&gt;Working Draft &mdash; 2 March 2008&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=working&gt;Working Draft &mdash; 3 March 2008&lt;/h2&gt;
 
    &lt;p&gt;You can take part in this work. &lt;a
     href=&quot;<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&quot;&gt;Join the working group's
@@ -1637,7 +1637,10 @@
           trailing end phase&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-end&quot;&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The End&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#the-unexpected&quot;&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The
+        unexpected end&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#the-end&quot;&gt;&lt;span class=secno&gt;8.2.6 &lt;/span&gt;The end&lt;/a&gt;
       &lt;/ul&gt;
 
      &lt;li&gt;&lt;a href=&quot;#namespaces&quot;&gt;&lt;span class=secno&gt;8.3 &lt;/span&gt;Namespaces&lt;/a&gt;
@@ -29815,7 +29818,7 @@
   &lt;!-- next three paragraphs are similar to the navigate-text section,
   keep them in sync --&gt;
 
-  &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops&quot; title=&quot;stop
+  &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops0&quot; title=&quot;stop
    parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
   &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
@@ -29852,7 +29855,7 @@
   &lt;!-- next three paragraphs are similar to the navigate-text section,
   keep them in sync --&gt;
 
-  &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops&quot; title=&quot;stop
+  &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops0&quot; title=&quot;stop
    parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
   &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
@@ -29886,7 +29889,7 @@
   keep them in sync --&gt;
 
   &lt;p&gt;Once the page has been set up, the user agent must act as if it had &lt;a
-   href=&quot;#stops&quot; title=&quot;stop parsing&quot;&gt;stopped parsing&lt;/a&gt;.
+   href=&quot;#stops0&quot; title=&quot;stop parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
   &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
    run the &lt;a href=&quot;#application3&quot;
@@ -41378,47 +41381,6 @@
   &lt;p&gt;Tokens in the main phase must be handled as follows:
 
   &lt;dl class=switch&gt;
-   &lt;dt&gt;A DOCTYPE token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
-
-   &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
-
-   &lt;dd&gt;
-    &lt;p&gt;If this start tag token was not the first start tag token, then it is
-     a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
-
-    &lt;p&gt;For each attribute on the token, check to see if the attribute is
-     already present on the top element of the &lt;a href=&quot;#stack&quot;&gt;stack of open
-     elements&lt;/a&gt;. If it is not, add the attribute and its corresponding
-     value to that element.&lt;/p&gt;
-
-   &lt;dt&gt;An end-of-file token
-
-   &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#generate&quot;&gt;Generate implied end tags.&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;If there are more than two nodes on the &lt;a href=&quot;#stack&quot;&gt;stack of open
-     elements&lt;/a&gt;, or if there are two nodes but the second node is not a
-     &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; node, this is a &lt;a
-     href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, if the parser was originally created as part of the &lt;a
-     href=&quot;#html-fragment0&quot;&gt;HTML fragment parsing algorithm&lt;/a&gt;, and there's
-     more than one element in the &lt;a href=&quot;#stack&quot;&gt;stack of open
-     elements&lt;/a&gt;, and the second node on the &lt;a href=&quot;#stack&quot;&gt;stack of open
-     elements&lt;/a&gt; is not a &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; node, then
-     this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. (&lt;a
-     href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
-
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing.&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p class=big-issue&gt;This fails because it doesn't imply HEAD and BODY
-     tags. We should probably expand out the insertion modes and merge them
-     with phases and then put the three things here into each insertion mode
-     instead of trying to factor them out so carefully.&lt;/p&gt;
-
    &lt;dt&gt;Anything else
 
    &lt;dd&gt;
@@ -41432,6 +41394,11 @@
       &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
         TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
         FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -41448,6 +41415,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;head&quot;
 
        &lt;dd&gt;
@@ -41514,6 +41493,11 @@
       &lt;p&gt;Handle the token as follows.&lt;/p&gt;
 
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
         TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
         FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -41530,6 +41514,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;A start tag whose tag name is one of: &quot;base&quot;, &quot;link&quot;
 
        &lt;dd&gt;
@@ -41754,6 +41750,23 @@
 
      &lt;dd&gt;
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;An end tag whose tag name is &quot;noscript&quot;
 
        &lt;dd&gt;
@@ -41805,6 +41818,11 @@
       &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
         TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
         FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -41821,6 +41839,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;body&quot;
 
        &lt;dd&gt;
@@ -41874,6 +41904,11 @@
       &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token
 
        &lt;dd&gt;
@@ -41891,6 +41926,22 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;If this start tag token was not the first start tag token, then it
+         is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+
+        &lt;p&gt;For each attribute on the token, check to see if the attribute is
+         already present on the top element of the &lt;a href=&quot;#stack&quot;&gt;stack of
+         open elements&lt;/a&gt;. If it is not, add the attribute and its
+         corresponding value to that element.&lt;/p&gt;
+
        &lt;dt&gt;A start tag token whose tag name is one of: &quot;base&quot;, &quot;link&quot;,
         &quot;meta&quot;, &quot;script&quot;, &quot;style&quot;
 
@@ -42840,6 +42891,11 @@
 
      &lt;dd&gt;
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
         TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
         FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -42856,6 +42912,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;caption&quot;
 
        &lt;dd&gt;
@@ -43070,6 +43138,11 @@
 
      &lt;dd&gt;
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
         TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
         FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43086,6 +43159,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;col&quot;
 
        &lt;dd&gt;
@@ -43410,6 +43495,11 @@
       &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token
 
        &lt;dd&gt;
@@ -43424,6 +43514,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;option&quot;
 
        &lt;dd&gt;
@@ -43516,6 +43618,11 @@
       &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
         TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
         FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43534,6 +43641,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;An end tag whose tag name is &quot;html&quot;
 
        &lt;dd&gt;
@@ -43563,6 +43682,11 @@
       &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
         TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
         FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43579,6 +43703,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;frameset&quot;
 
        &lt;dd&gt;
@@ -43632,6 +43768,11 @@
       &lt;p&gt;Handle the token as follows:&lt;/p&gt;
 
       &lt;dl class=switch&gt;
+       &lt;dt&gt;An end-of-file token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing, with prejudice.&lt;/a&gt;&lt;/p&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009 CHARACTER
         TABULATION, U+000A LINE FEED (LF), U+000B LINE TABULATION, U+000C
         FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt; or U+0020 SPACE
@@ -43648,6 +43789,18 @@
          title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment
          token.&lt;/p&gt;
 
+       &lt;dt&gt;A DOCTYPE token
+
+       &lt;dd&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
+
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;a href=&quot;#insertion0&quot;&gt;insertion
+         mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-body&quot; title=&quot;insertion mode: in
+         body&quot;&gt;in body&lt;/a&gt;&quot;.&lt;/p&gt;
+
        &lt;dt&gt;An end tag whose tag name is &quot;html&quot;
 
        &lt;dd&gt;
@@ -43720,12 +43873,45 @@
    &lt;dt&gt;An end-of-file token
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#stops0&quot;&gt;Stop parsing&lt;/a&gt;.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h4 id=the-end&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The End&lt;/h4&gt;
+  &lt;h4 id=the-unexpected&gt;&lt;span class=secno&gt;8.2.5 &lt;/span&gt;The unexpected end&lt;/h4&gt;
 
-  &lt;p&gt;Once the user agent &lt;dfn id=stops title=&quot;stop parsing&quot;&gt;stops
+  &lt;p&gt;When the user agent is to &lt;dfn id=stops title=&quot;stop parsing, with
+   prejudice&quot;&gt;stops parsing, with prejudice&lt;/dfn&gt;, the user agent must follow
+   the steps in this section.
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;&lt;a href=&quot;#generate&quot;&gt;Generate implied end tags.&lt;/a&gt;&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If there are more than two nodes on the &lt;a href=&quot;#stack&quot;&gt;stack of open
+     elements&lt;/a&gt;, or if there are two nodes but the second node is not a
+     &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; node, this is a &lt;a
+     href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, if the parser was originally created as part of the &lt;a
+     href=&quot;#html-fragment0&quot;&gt;HTML fragment parsing algorithm&lt;/a&gt;, and there's
+     more than one element in the &lt;a href=&quot;#stack&quot;&gt;stack of open
+     elements&lt;/a&gt;, and the second node on the &lt;a href=&quot;#stack&quot;&gt;stack of open
+     elements&lt;/a&gt; is not a &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; node, then
+     this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. (&lt;a
+     href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
+
+    &lt;p class=big-issue&gt;This fails because it doesn't imply HEAD and BODY
+     tags. We should probably expand out the insertion modes and merge them
+     with phases and then put the three things here into each insertion mode
+     instead of trying to factor them out so carefully.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;&lt;a href=&quot;#stops0&quot;&gt;Stop parsing&lt;/a&gt; (see the next section).
+  &lt;/ol&gt;
+
+  &lt;h4 id=the-end&gt;&lt;span class=secno&gt;8.2.6 &lt;/span&gt;The end&lt;/h4&gt;
+
+  &lt;p&gt;Once the user agent &lt;dfn id=stops0 title=&quot;stop parsing&quot;&gt;stops
    parsing&lt;/dfn&gt; the document, the user agent must follow the steps in this
    section.
 

Modified: source
===================================================================
--- source	2008-03-02 22:53:06 UTC (rev 1307)
+++ source	2008-03-03 00:43:43 UTC (rev 1308)
@@ -38523,48 +38523,6 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;If this start tag token was not the first start tag token, then
-    it is a &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt;
-    &lt;p&gt;For each attribute on the token, check to see if the attribute
-    is already present on the top element of the &lt;span&gt;stack of open
-    elements&lt;/span&gt;. If it is not, add the attribute and its
-    corresponding value to that element.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;An end-of-file token&lt;/dt&gt;
-   &lt;dd&gt;
-
-    &lt;p&gt;&lt;span&gt;Generate implied end tags.&lt;/span&gt;&lt;/p&gt;
-
-    &lt;p&gt;If there are more than two nodes on the &lt;span&gt;stack of open
-    elements&lt;/span&gt;, or if there are two nodes but the second node is
-    not a &lt;code&gt;body&lt;/code&gt; node, this is a &lt;span&gt;parse
-    error&lt;/span&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, if the parser was originally created as part of the
-    &lt;span&gt;HTML fragment parsing algorithm&lt;/span&gt;, and there's more
-    than one element in the &lt;span&gt;stack of open elements&lt;/span&gt;, and
-    the second node on the &lt;span&gt;stack of open elements&lt;/span&gt; is not
-    a &lt;code&gt;body&lt;/code&gt; node, then this is a &lt;span&gt;parse
-    error&lt;/span&gt;. (&lt;span&gt;fragment case&lt;/span&gt;)&lt;/p&gt;
-
-    &lt;p&gt;&lt;span&gt;Stop parsing.&lt;/span&gt;&lt;/p&gt;
-
-    &lt;p class=&quot;big-issue&quot;&gt;This fails because it doesn't imply HEAD and
-    BODY tags. We should probably expand out the insertion modes and
-    merge them with phases and then put the three things here into
-    each insertion mode instead of trying to factor them out so
-    carefully.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -38579,6 +38537,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009
        CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
        TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -38595,6 +38558,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;head&quot;&lt;/dt&gt;
        &lt;dd&gt;
 
@@ -38674,6 +38649,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009
        CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
        TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -38690,6 +38670,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A start tag whose tag name is one of: &quot;base&quot;, &quot;link&quot;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;&lt;span title=&quot;insert an html element&quot;&gt;Insert an HTML
@@ -38922,6 +38914,23 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;An end tag whose tag name is &quot;noscript&quot;&lt;/dt&gt;
        &lt;dd&gt;
 
@@ -38977,6 +38986,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009
        CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
        TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -38993,6 +39007,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;body&quot;&lt;/dt&gt;
        &lt;dd&gt;
 
@@ -39055,6 +39081,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token&lt;/dt&gt;
        &lt;dd&gt;
 
@@ -39073,6 +39104,21 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;If this start tag token was not the first start tag token, then
+        it is a &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt;
+        &lt;p&gt;For each attribute on the token, check to see if the attribute
+        is already present on the top element of the &lt;span&gt;stack of open
+        elements&lt;/span&gt;. If it is not, add the attribute and its
+        corresponding value to that element.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A start tag token whose tag name is one of: &quot;base&quot;, &quot;link&quot;,
        &quot;meta&quot;, &quot;script&quot;, &quot;style&quot;&lt;/dt&gt;
        &lt;dd&gt;
@@ -40073,6 +40119,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009
        CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
        TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -40089,6 +40140,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;caption&quot;&lt;/dt&gt;
        &lt;dd&gt;
 
@@ -40312,6 +40375,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009
        CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
        TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -40328,6 +40396,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;col&quot;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;&lt;span title=&quot;insert an HTML element&quot;&gt;Insert a
@@ -40686,6 +40766,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;&lt;span title=&quot;append a character&quot;&gt;Append the token's
@@ -40699,6 +40784,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;option&quot;&lt;/dt&gt;
        &lt;dd&gt;
 
@@ -40809,6 +40906,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009
        CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
        TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -40827,6 +40929,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;An end tag whose tag name is &quot;html&quot;&lt;/dt&gt;
        &lt;dd&gt;
 
@@ -40862,6 +40976,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009
        CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
        TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -40878,6 +40997,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A start tag whose tag name is &quot;frameset&quot;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;&lt;span title=&quot;Insert an HTML element&quot;&gt;Insert a
@@ -40935,6 +41066,11 @@
 
       &lt;dl class=&quot;switch&quot;&gt;
 
+       &lt;dt&gt;An end-of-file token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Stop parsing, with prejudice.&lt;/span&gt;&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;A character token that is one of one of U+0009
        CHARACTER TABULATION, U+000A LINE FEED (LF), U+000B LINE
        TABULATION, U+000C FORM FEED (FF), &lt;!--U+000D CARRIAGE RETURN (CR),--&gt;
@@ -40951,6 +41087,18 @@
         the data given in the comment token.&lt;/p&gt;
        &lt;/dd&gt;
 
+       &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+       &lt;/dd&gt;
+
+       &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
+       &lt;dd&gt;
+        &lt;p&gt;Process the token as if the &lt;span&gt;insertion mode&lt;/span&gt; had
+        been &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+        body&lt;/span&gt;&quot;.&lt;/p&gt;
+       &lt;/dd&gt;
+
        &lt;dt&gt;An end tag whose tag name is &quot;html&quot;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;Switch to &lt;span&gt;the trailing end phase&lt;/span&gt;.&lt;/p&gt;
@@ -41033,8 +41181,47 @@
   &lt;/dl&gt;
 
 
-  &lt;h4&gt;The End&lt;/h4&gt;
+  &lt;h4&gt;The unexpected end&lt;/h4&gt;
 
+  &lt;p&gt;When the user agent is to &lt;dfn title=&quot;stop parsing, with
+  prejudice&quot;&gt;stops parsing, with prejudice&lt;/dfn&gt;, the user agent must
+  follow the steps in this section.&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;&lt;span&gt;Generate implied end tags.&lt;/span&gt;&lt;/p&gt;
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there are more than two nodes on the &lt;span&gt;stack of open
+    elements&lt;/span&gt;, or if there are two nodes but the second node is
+    not a &lt;code&gt;body&lt;/code&gt; node, this is a &lt;span&gt;parse
+    error&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, if the parser was originally created as part of the
+    &lt;span&gt;HTML fragment parsing algorithm&lt;/span&gt;, and there's more
+    than one element in the &lt;span&gt;stack of open elements&lt;/span&gt;, and
+    the second node on the &lt;span&gt;stack of open elements&lt;/span&gt; is not
+    a &lt;code&gt;body&lt;/code&gt; node, then this is a &lt;span&gt;parse
+    error&lt;/span&gt;. (&lt;span&gt;fragment case&lt;/span&gt;)&lt;/p&gt;
+
+    &lt;p class=&quot;big-issue&quot;&gt;This fails because it doesn't imply HEAD and
+    BODY tags. We should probably expand out the insertion modes and
+    merge them with phases and then put the three things here into
+    each insertion mode instead of trying to factor them out so
+    carefully.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Stop parsing&lt;/span&gt; (see the next section).&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+  &lt;h4&gt;The end&lt;/h4&gt;
+
   &lt;p&gt;Once the user agent &lt;dfn title=&quot;stop parsing&quot;&gt;stops parsing&lt;/dfn&gt;
   the document, the user agent must follow the steps in this
   section.&lt;/p&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008209.html">[html5] r1307 - /
</A></li>
	<LI>Next message: <A HREF="008211.html">[html5] r1309 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8210">[ date ]</a>
              <a href="thread.html#8210">[ thread ]</a>
              <a href="subject.html#8210">[ subject ]</a>
              <a href="author.html#8210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
