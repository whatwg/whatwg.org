<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1404 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1404%20-%20/&In-Reply-To=%3C20080405130024.D3BAE139FD5%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008305.html">
   <LINK REL="Next"  HREF="008307.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1404 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1404%20-%20/&In-Reply-To=%3C20080405130024.D3BAE139FD5%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1404 - /">whatwg at whatwg.org
       </A><BR>
    <I>Sat Apr  5 06:00:24 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008305.html">[html5] r1403 - /
</A></li>
        <LI>Next message: <A HREF="008307.html">[html5] r1406 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8306">[ date ]</a>
              <a href="thread.html#8306">[ thread ]</a>
              <a href="subject.html#8306">[ subject ]</a>
              <a href="author.html#8306">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-04-05 06:00:21 -0700 (Sat, 05 Apr 2008)
New Revision: 1404

Modified:
   index
   source
Log:
[acgiowt] (2) MathML and SVG support in text/html: the parsing infrastructure

Modified: index
===================================================================
--- index	2008-04-05 11:14:50 UTC (rev 1403)
+++ index	2008-04-05 13:00:21 UTC (rev 1404)
@@ -1649,7 +1649,7 @@
         construction&lt;/a&gt;
         &lt;ul class=toc&gt;
          &lt;li&gt;&lt;a href=&quot;#creating&quot;&gt;&lt;span class=secno&gt;8.2.5.1. &lt;/span&gt;Creating
-          and inserting HTML elements&lt;/a&gt;
+          and inserting elements&lt;/a&gt;
 
          &lt;li&gt;&lt;a href=&quot;#closing&quot;&gt;&lt;span class=secno&gt;8.2.5.2. &lt;/span&gt;Closing
           elements that have implied end tags&lt;/a&gt;
@@ -1697,23 +1697,27 @@
          &lt;li&gt;&lt;a href=&quot;#parsing-main-inselect&quot;&gt;&lt;span class=secno&gt;8.2.5.16.
           &lt;/span&gt;The &quot;in select&quot; insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-inselect&quot;&gt;&lt;span class=secno&gt;8.2.5.17.
-          &lt;/span&gt;The &quot;in select in table&quot; insertion mode&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-inselectintable&quot;&gt;&lt;span
+          class=secno&gt;8.2.5.17. &lt;/span&gt;The &quot;in select in table&quot; insertion
+          mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-afterbody&quot;&gt;&lt;span class=secno&gt;8.2.5.18.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-inforeign&quot;&gt;&lt;span class=secno&gt;8.2.5.18.
+          &lt;/span&gt;The &quot;in foreign content&quot; insertion mode&lt;/a&gt;
+
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-afterbody&quot;&gt;&lt;span class=secno&gt;8.2.5.19.
           &lt;/span&gt;The &quot;after body&quot; insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#parsing-main-inframeset&quot;&gt;&lt;span class=secno&gt;8.2.5.19.
+         &lt;li&gt;&lt;a href=&quot;#parsing-main-inframeset&quot;&gt;&lt;span class=secno&gt;8.2.5.20.
           &lt;/span&gt;The &quot;in frameset&quot; insertion mode&lt;/a&gt;
 
          &lt;li&gt;&lt;a href=&quot;#parsing-main-afterframeset&quot;&gt;&lt;span
-          class=secno&gt;8.2.5.20. &lt;/span&gt;The &quot;after frameset&quot; insertion
+          class=secno&gt;8.2.5.21. &lt;/span&gt;The &quot;after frameset&quot; insertion
           mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#the-after0&quot;&gt;&lt;span class=secno&gt;8.2.5.21. &lt;/span&gt;The
+         &lt;li&gt;&lt;a href=&quot;#the-after0&quot;&gt;&lt;span class=secno&gt;8.2.5.22. &lt;/span&gt;The
           &quot;after after body&quot; insertion mode&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#the-after1&quot;&gt;&lt;span class=secno&gt;8.2.5.22. &lt;/span&gt;The
+         &lt;li&gt;&lt;a href=&quot;#the-after1&quot;&gt;&lt;span class=secno&gt;8.2.5.23. &lt;/span&gt;The
           &quot;after after frameset&quot; insertion mode&lt;/a&gt;
         &lt;/ul&gt;
 
@@ -39491,8 +39495,9 @@
    mode: in row&quot;&gt;in row&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-cell&quot; title=&quot;insertion mode: in
    cell&quot;&gt;in cell&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-select&quot; title=&quot;insertion mode: in
    select&quot;&gt;in select&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-select0&quot; title=&quot;insertion mode: in
-   select in table&quot;&gt;in select in table&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#after5&quot;
-   title=&quot;insertion mode: after body&quot;&gt;after body&lt;/a&gt;&quot;, &quot;&lt;a
+   select in table&quot;&gt;in select in table&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#in-foreign&quot;
+   title=&quot;insertion mode: in foreign content&quot;&gt;in foreign content&lt;/a&gt;&quot;, &quot;&lt;a
+   href=&quot;#after5&quot; title=&quot;insertion mode: after body&quot;&gt;after body&lt;/a&gt;&quot;, &quot;&lt;a
    href=&quot;#in-frameset&quot; title=&quot;insertion mode: in frameset&quot;&gt;in frameset&lt;/a&gt;&quot;,
    &quot;&lt;a href=&quot;#after6&quot; title=&quot;insertion mode: after frameset&quot;&gt;after
    frameset&lt;/a&gt;&quot;, &quot;&lt;a href=&quot;#after7&quot; title=&quot;insertion mode: after after
@@ -39518,6 +39523,13 @@
    mode&lt;/span&gt; unchanged (unless the rules in that section themselves switch
    the &lt;span&gt;insertion mode&lt;/span&gt;).
 
+  &lt;p&gt;When the insertion mode is switched to &quot;&lt;a href=&quot;#in-foreign&quot;
+   title=&quot;insertion mode: in foreign content&quot;&gt;in foreign content&lt;/a&gt;&quot;, the
+   &lt;dfn id=secondary1&gt;secondary insertion mode&lt;/dfn&gt; is also set. This
+   secondary mode is used within the rules for the &quot;&lt;a href=&quot;#in-foreign&quot;
+   title=&quot;insertion mode: in foreign content&quot;&gt;in foreign content&lt;/a&gt;&quot; mode to
+   handle HTML (i.e. not foreign) content.
+
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=reset&gt;reset the insertion
    mode appropriately&lt;/dfn&gt;, it means the UA must follow these steps:
 
@@ -39533,7 +39545,13 @@
     fragment parsing algorithm&lt;/a&gt; is neither a &lt;code&gt;&lt;a
     href=&quot;#td&quot;&gt;td&lt;/a&gt;&lt;/code&gt; element nor a &lt;code&gt;&lt;a href=&quot;#th&quot;&gt;th&lt;/a&gt;&lt;/code&gt;
     element, then set &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; to the &lt;var
-    title=&quot;&quot;&gt;context&lt;/var&gt; element. (&lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)
+    title=&quot;&quot;&gt;context&lt;/var&gt; element. (&lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/li&gt;
+   &lt;!-- XXX this fails to
+   actually set &quot;node&quot; to something useful in the &lt;td&gt; case, which we
+   want (either body (or nothing, to hit the last clause in this list)
+   or td/th; in the former case, remove the redundant 'fragment case'
+   bits in the 'in cell' section, in the latter case, check that
+   td.innerHTML = &quot;&lt;caption&gt;&quot; works as expected by browsers) --&gt;
 
    &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is a &lt;code&gt;select&lt;/code&gt; element, then
     switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;a href=&quot;#in-select&quot;
@@ -39572,6 +39590,12 @@
     mode&lt;/span&gt; to &quot;&lt;a href=&quot;#in-table&quot; title=&quot;insertion mode: in table&quot;&gt;in
     table&lt;/a&gt;&quot; and abort these steps.
 
+   &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is an element from the &lt;a
+    href=&quot;#mathml0&quot;&gt;MathML namespace&lt;/a&gt; or the &lt;a href=&quot;#svg-namespace&quot;&gt;SVG
+    namespace&lt;/a&gt;, then switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;a
+    href=&quot;#in-foreign&quot; title=&quot;insertion mode: in foreign content&quot;&gt;in foreign
+    content&lt;/a&gt;&quot; and abort these steps.
+
    &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is a &lt;code&gt;&lt;a href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt;
     element, then switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;a
     href=&quot;#in-body&quot; title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot; (&quot;&lt;a
@@ -39932,7 +39956,9 @@
    title=&quot;&quot;&gt;PLAINTEXT&lt;/em&gt;. Initially it must be in the PCDATA state. In the
    RCDATA and CDATA states, a further &lt;dfn id=escape&gt;escape flag&lt;/dfn&gt; is
    used to control the behaviour of the tokeniser. It is either true or
-   false, and initially must be set to the false state.
+   false, and initially must be set to the false state. The &lt;span&gt;insertion
+   mode&lt;/span&gt; and the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; also
+   affects tokenisation.
 
   &lt;p&gt;The output of the tokenisation step is a series of zero or more of the
    following tokens: DOCTYPE, start tag, end tag, comment, character,
@@ -39941,9 +39967,11 @@
    created, its name, public identifier, and system identifier must be marked
    as missing (which is a distinct state from the empty string), and the
    &lt;i&gt;force-quirks flag&lt;/i&gt; must be set to &lt;i&gt;off&lt;/i&gt; (its other state is
-   &lt;i&gt;on&lt;/i&gt;). Start and end tag tokens have a tag name and a list of
-   attributes, each of which has a name and a value. Comment and character
-   tokens have data.
+   &lt;i&gt;on&lt;/i&gt;). Start and end tag tokens have a tag name, a &lt;i&gt;self-closing
+   flag&lt;/i&gt;, and a list of attributes, each of which has a name and a value.
+   When a DOCTYPE token is created, its &lt;i&gt;self-closing flag&lt;/i&gt; must be
+   unset (its other state is that it be set), and its attributes list must be
+   empty. Comment and character tokens have data.
 
   &lt;p&gt;When a token is emitted, it must immediately be handled by the &lt;a
    href=&quot;#tree-construction0&quot;&gt;tree construction&lt;/a&gt; stage. The tree
@@ -39953,17 +39981,19 @@
    in scripts executing and using the &lt;a href=&quot;#dynamic2&quot;&gt;dynamic markup
    insertion&lt;/a&gt; APIs to insert characters into the stream being tokenised.)
 
+  &lt;p&gt;When a start tag token is emitted with its &lt;i&gt;self-closing flag&lt;/i&gt; set,
+   if the flag is not &lt;dfn id=acknowledged title=&quot;acknowledge self-closing
+   flag&quot;&gt;acknowledged&lt;/dfn&gt; when it is processed by the tree construction
+   stage, that is a &lt;a href=&quot;#parse1&quot;&gt;parse error&lt;/a&gt;.
+
   &lt;p&gt;When an end tag token is emitted, the &lt;a href=&quot;#content2&quot;&gt;content model
    flag&lt;/a&gt; must be switched to the PCDATA state.
 
   &lt;p&gt;When an end tag token is emitted with attributes, that is a &lt;a
    href=&quot;#parse1&quot;&gt;parse error&lt;/a&gt;.
 
-  &lt;p&gt;A &lt;dfn id=permitted&gt;permitted slash&lt;/dfn&gt; is a U+002F SOLIDUS character
-   that is immediately followed by a U+003E GREATER-THAN SIGN, if, and only
-   if, the current token being processed is a start tag token whose tag name
-   is the same as the tag name of one of &lt;a href=&quot;#void-elements&quot;&gt;void
-   elements&lt;/a&gt;.
+  &lt;p&gt;When an end tag token is emitted with its &lt;i&gt;self-closing flag&lt;/i&gt; set,
+   that is a &lt;a href=&quot;#parse1&quot;&gt;parse error&lt;/a&gt;.
 
   &lt;p&gt;Before each step of the tokeniser, the user agent may check to see if
    either one of the scripts in the &lt;a href=&quot;#list-of1&quot;&gt;list of scripts that
@@ -40238,9 +40268,8 @@
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
-      href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Switch to the &lt;a
-      href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
+     &lt;dd&gt;Switch to the &lt;a href=&quot;#self-closing&quot;&gt;self-closing start tag
+      state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
 
@@ -40282,9 +40311,8 @@
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
-      href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Stay in the &lt;a
-      href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
+     &lt;dd&gt;Switch to the &lt;a href=&quot;#self-closing&quot;&gt;self-closing start tag
+      state&lt;/a&gt;.
 
      &lt;dt&gt;U+0022 QUOTATION MARK (&quot;)
 
@@ -40345,9 +40373,8 @@
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
-      href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Switch to the &lt;a
-      href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
+     &lt;dd&gt;Switch to the &lt;a href=&quot;#self-closing&quot;&gt;self-closing start tag
+      state&lt;/a&gt;.
 
      &lt;dt&gt;U+0022 QUOTATION MARK (&quot;)
 
@@ -40413,9 +40440,8 @@
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
-      href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Switch to the &lt;a
-      href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
+     &lt;dd&gt;Switch to the &lt;a href=&quot;#self-closing&quot;&gt;self-closing start tag
+      state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
@@ -40634,10 +40660,26 @@
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
-      href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Switch to the &lt;a
+     &lt;dd&gt;Switch to the &lt;a href=&quot;#self-closing&quot;&gt;self-closing start tag
+      state&lt;/a&gt;.
+
+     &lt;dt&gt;Anything else
+
+     &lt;dd&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt;. Reconsume the character in the &lt;a
       href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
+    &lt;/dl&gt;
 
+   &lt;dt&gt;&lt;dfn id=self-closing&gt;Self-closing start tag state&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Consume the &lt;a href=&quot;#next-input&quot;&gt;next input character&lt;/a&gt;:&lt;/p&gt;
+
+    &lt;dl class=switch&gt;
+     &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)
+
+     &lt;dd&gt;Set the &lt;i&gt;self-closing flag&lt;/i&gt; of the current tag token. Emit the
+      current tag token. Switch to the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
+
      &lt;dt&gt;Anything else
 
      &lt;dd&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt;. Reconsume the character in the &lt;a
@@ -40674,11 +40716,50 @@
      data is the empty string, and switch to the &lt;a href=&quot;#comment0&quot;&gt;comment
      start state&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise if the next seven characters are a
+    &lt;p&gt;Otherwise, if the next seven characters are a
      &lt;span&gt;case-insensitive&lt;/span&gt;&lt;!-- XXX xref, ascii only --&gt; match for the
      word &quot;DOCTYPE&quot;, then consume those characters and switch to the &lt;a
      href=&quot;#doctype0&quot;&gt;DOCTYPE state&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, if the &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;a
+     href=&quot;#in-foreign&quot; title=&quot;insertion mode: in foreign content&quot;&gt;in foreign
+     content&lt;/a&gt;&quot; and the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not one of
+     the following:&lt;/p&gt;
+
+    &lt;ul&gt;
+     &lt;li&gt;An &lt;code&gt;mi&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML
+      namespace&lt;/a&gt;.
+
+     &lt;li&gt;An &lt;code&gt;mo&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML
+      namespace&lt;/a&gt;.
+
+     &lt;li&gt;An &lt;code&gt;mn&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML
+      namespace&lt;/a&gt;.
+
+     &lt;li&gt;An &lt;code&gt;ms&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML
+      namespace&lt;/a&gt;.
+
+     &lt;li&gt;An &lt;code&gt;mtext&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML
+      namespace&lt;/a&gt;.
+
+     &lt;li&gt;A &lt;code&gt;foreignObject&lt;/code&gt; element in the &lt;a
+      href=&quot;#svg-namespace&quot;&gt;SVG namespace&lt;/a&gt;.
+
+     &lt;li&gt;A &lt;code&gt;desc&lt;/code&gt; element in the &lt;a href=&quot;#svg-namespace&quot;&gt;SVG
+      namespace&lt;/a&gt;.
+
+     &lt;li&gt;A &lt;code&gt;&lt;a href=&quot;#title1&quot;&gt;title&lt;/a&gt;&lt;/code&gt; element in the &lt;a
+      href=&quot;#svg-namespace&quot;&gt;SVG namespace&lt;/a&gt;.
+    &lt;/ul&gt;
+
+    &lt;p&gt;...and the next seven characters are a
+     &lt;span&gt;case-sensitive&lt;/span&gt;&lt;!-- XXX xref, ascii only --&gt; match for the
+     string &quot;[CDATA[&quot; (the five uppercase letters &quot;CDATA&quot; with a U+005B LEFT
+     SQUARE BRACKET character before and after), then consume those
+     characters and switch to the &lt;span&gt;CDATA block state&lt;/span&gt; (which is
+     unrelated to the &lt;a href=&quot;#content2&quot;&gt;content model flag&lt;/a&gt;'s CDATA
+     state).&lt;/p&gt;
+
     &lt;p&gt;Otherwise, this is a &lt;a href=&quot;#parse1&quot;&gt;parse error&lt;/a&gt;. Switch to the
      &lt;a href=&quot;#bogus&quot;&gt;bogus comment state&lt;/a&gt;. The next character that is
      consumed, if any, is the first character that will be in the comment.&lt;/p&gt;
@@ -41310,6 +41391,25 @@
 
      &lt;dd&gt;Stay in the &lt;a href=&quot;#bogus0&quot;&gt;bogus DOCTYPE state&lt;/a&gt;.
     &lt;/dl&gt;
+
+   &lt;dt&gt;&lt;dfn id=cdata1&gt;CDATA state&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;em&gt;(This can only happen if the &lt;a href=&quot;#content2&quot;&gt;content model
+     flag&lt;/a&gt; is set to the PCDATA state, and is unrelated to the &lt;a
+     href=&quot;#content2&quot;&gt;content model flag&lt;/a&gt;'s CDATA state.)&lt;/em&gt;&lt;/p&gt;
+
+    &lt;p&gt;Consume every character up to the next occurrence of the three
+     character sequence U+005D RIGHT SQUARE BRACKET U+005D RIGHT SQUARE
+     BRACKET U+003E GREATER-THAN SIGN (&lt;code title=&quot;&quot;&gt;]]&gt;&lt;/code&gt;), or the end
+     of the file (EOF), whichever comes first. Emit a series of text tokens
+     consisting of all the characters consumed except the matching three
+     character sequence at the end (if one was found before the end of the
+     file).&lt;/p&gt;
+
+    &lt;p&gt;Switch to the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the end of the file was reached, reconsume the EOF character.&lt;/p&gt;
   &lt;/dl&gt;
 
   &lt;h5 id=tokenising&gt;&lt;span class=secno&gt;8.2.4.1. &lt;/span&gt;Tokenising entities&lt;/h5&gt;
@@ -41734,34 +41834,47 @@
    agents to impose nesting depths.
 
   &lt;h5 id=creating&gt;&lt;span class=secno&gt;8.2.5.1. &lt;/span&gt;Creating and inserting
-   HTML elements&lt;/h5&gt;
+   elements&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=create title=&quot;create an
-   element for the token&quot;&gt;create an element for a token&lt;/dfn&gt;, the UA must
-   create a node implementing the interface appropriate for the element type
-   corresponding to the tag name of the token (as given in the section of
-   this specification that defines that element, e.g. for an &lt;code&gt;&lt;a
-   href=&quot;#a&quot;&gt;a&lt;/a&gt;&lt;/code&gt; element it would be the &lt;code&gt;&lt;a
+   element for the token&quot;&gt;create an element for a token&lt;/dfn&gt; in a particular
+   namespace, the UA must create a node implementing the interface
+   appropriate for the element type corresponding to the tag name of the
+   token in the given namespace (as given in the specification that defines
+   that element, e.g. for an &lt;code&gt;&lt;a href=&quot;#a&quot;&gt;a&lt;/a&gt;&lt;/code&gt; element in the
+   &lt;a href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;, this specification defines
+   it to be the &lt;code&gt;&lt;a
    href=&quot;#htmlanchorelement&quot;&gt;HTMLAnchorElement&lt;/a&gt;&lt;/code&gt; interface), with
-   the tag name being the name of that element, with the node being in the &lt;a
-   href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;, and with the attributes on the
-   node being those given in the given token.
+   the tag name being the name of that element, with the node being in the
+   given namespace, and with the attributes on the node being those given in
+   the given token.
 
+  &lt;p&gt;The interface appropriate for an element in the &lt;a
+   href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt; that is not defined in this
+   specification is &lt;code&gt;&lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;. The
+   interface appropriate for an element in another namespace that is not
+   defined by that namespace's specification is &lt;code&gt;Element&lt;/code&gt;.
+
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=insert0&gt;insert an HTML
    element&lt;/dfn&gt; for a token, the UA must first &lt;a href=&quot;#create&quot;&gt;create an
-   element for the token&lt;/a&gt;, and then append this node to the &lt;a
+   element for the token&lt;/a&gt; in the &lt;a href=&quot;#html-namespace0&quot;&gt;HTML
+   namespace&lt;/a&gt;, and then append this node to the &lt;a
    href=&quot;#current4&quot;&gt;current node&lt;/a&gt;, and push it onto the &lt;a
    href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; so that it is the new &lt;a
    href=&quot;#current4&quot;&gt;current node&lt;/a&gt;.
 
   &lt;p&gt;The steps below may also require that the UA insert an HTML element in a
-   particular place, in which case the UA must &lt;a href=&quot;#create&quot;&gt;create an
-   element for the token&lt;/a&gt; and then insert or append the new node in the
-   location specified. (This happens in particular during the parsing of
-   tables with invalid content.)
+   particular place, in which case the UA must follow the same steps except
+   that it must insert or append the new node in the location specified
+   insead of appending it to the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt;. (This
+   happens in particular during the parsing of tables with invalid content.)
 
-  &lt;p&gt;The interface appropriate for an element that is not defined in this
-   specification is &lt;code&gt;&lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;.
+  &lt;p&gt;When the steps below require the UA to &lt;dfn id=insert1&gt;insert a foreign
+   element&lt;/dfn&gt; for a token, the UA must first &lt;a href=&quot;#create&quot;&gt;create an
+   element for the token&lt;/a&gt; in the given namespace, and then append this
+   node to the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt;, and push it onto the &lt;a
+   href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; so that it is the new &lt;a
+   href=&quot;#current4&quot;&gt;current node&lt;/a&gt;.
 
   &lt;p&gt;The &lt;dfn id=generic&gt;generic CDATA parsing algorithm&lt;/dfn&gt; and the &lt;dfn
    id=generic0&gt;generic RCDATA parsing algorithm&lt;/dfn&gt; consist of the
@@ -42170,8 +42283,9 @@
    &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create an element for the token&lt;/a&gt;. Append it to
-     the &lt;code&gt;Document&lt;/code&gt; object. Put this element in the &lt;a
+    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create an element for the token&lt;/a&gt;, using the &lt;a
+     href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;. Append it to the
+     &lt;code&gt;Document&lt;/code&gt; object. Put this element in the &lt;a
      href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p id=parser-appcache&gt;If the token has an attribute &quot;manifest&quot;, then run
@@ -42250,14 +42364,12 @@
    &lt;dt&gt;A start tag whose tag name is &quot;head&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create an element for the token&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token.&lt;/p&gt;
 
     &lt;p&gt;Set the &lt;a href=&quot;#head-element&quot;&gt;&lt;code title=&quot;&quot;&gt;head&lt;/code&gt; element
-     pointer&lt;/a&gt; to this new element node.&lt;/p&gt;
+     pointer&lt;/a&gt; to the newly created &lt;code&gt;&lt;a href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt;
+     element.&lt;/p&gt;
 
-    &lt;p&gt;Append the new element to the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; and
-     push it onto the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
-
     &lt;p&gt;Switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;a href=&quot;#in-head&quot;
      title=&quot;insertion mode: in head&quot;&gt;in head&lt;/a&gt;&quot;.&lt;/p&gt;
 
@@ -42328,6 +42440,10 @@
      Immediately pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a
      href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
+     set.&lt;/p&gt;
+
    &lt;dt&gt;A start tag whose tag name is &quot;meta&quot;
 
    &lt;dd&gt;
@@ -42335,6 +42451,10 @@
      Immediately pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a
      href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
+     set.&lt;/p&gt;
+
     &lt;p id=meta-charset-during-parse&gt;If the element has a &lt;code
      title=attr-meta-charset&gt;&lt;a href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
      attribute, and its value is a supported encoding, and the &lt;a
@@ -42378,7 +42498,8 @@
    &lt;dt id=scriptTag&gt;A start tag whose tag name is &quot;script&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create an element for the token&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create an element for the token&lt;/a&gt; in the &lt;a
+     href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Mark the element as being &lt;a
      href=&quot;#parser-inserted&quot;&gt;&quot;parser-inserted&quot;&lt;/a&gt;. This ensures that, if the
@@ -43418,6 +43539,10 @@
      Immediately pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a
      href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
+     set.&lt;/p&gt;
+
    &lt;dt&gt;A start tag whose tag name is &quot;hr&quot;
 
    &lt;dd&gt;
@@ -43430,6 +43555,10 @@
      Immediately pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a
      href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
+     set.&lt;/p&gt;
+
    &lt;dt&gt;A start tag whose tag name is &quot;image&quot;
 
    &lt;dd&gt;
@@ -43446,18 +43575,20 @@
     &lt;p&gt;&lt;a href=&quot;#reconstruct&quot;&gt;Reconstruct the active formatting elements&lt;/a&gt;,
      if any.&lt;/p&gt;
 
-    &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token.
+     Immediately pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a
+     href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
+     set.&lt;/p&gt;
+
     &lt;p&gt;If the &lt;a href=&quot;#form-element&quot;&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-     pointer&lt;/a&gt; is not null, then &lt;span&gt;associate&lt;/span&gt;&lt;!--XXX
-    xref! --&gt;
-     the &lt;code&gt;input&lt;/code&gt; element with the &lt;code&gt;form&lt;/code&gt; element
-     pointed to by the &lt;a href=&quot;#form-element&quot;&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt;
-     element pointer&lt;/a&gt;.&lt;/p&gt;
+     pointer&lt;/a&gt; is not null, then &lt;span&gt;associate&lt;/span&gt;&lt;!--XXX xref! --&gt;
+     the newly created &lt;code&gt;input&lt;/code&gt; element with the &lt;code&gt;form&lt;/code&gt;
+     element pointed to by the &lt;a href=&quot;#form-element&quot;&gt;&lt;code
+     title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Pop that &lt;code&gt;input&lt;/code&gt; element off the &lt;a href=&quot;#stack&quot;&gt;stack of
-     open elements&lt;/a&gt;.&lt;/p&gt;
-
    &lt;dt id=isindex&gt;A start tag whose tag name is &quot;isindex&quot;
 
    &lt;dd&gt;
@@ -43524,17 +43655,16 @@
    &lt;dt&gt;A start tag whose tag name is &quot;textarea&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create an element for the token&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create an element for the token&lt;/a&gt;, in the &lt;a
+     href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;. Append the new element to
+     the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;If the &lt;a href=&quot;#form-element&quot;&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-     pointer&lt;/a&gt; is not null, then &lt;span&gt;associate&lt;/span&gt;&lt;!--XXX
-    xref! --&gt;
-     the &lt;code&gt;textarea&lt;/code&gt; element with the &lt;code&gt;form&lt;/code&gt; element
-     pointed to by the &lt;a href=&quot;#form-element&quot;&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt;
-     element pointer&lt;/a&gt;.&lt;/p&gt;
+     pointer&lt;/a&gt; is not null, then &lt;span&gt;associate&lt;/span&gt;&lt;!--XXX xref! --&gt;
+     the newly created &lt;code&gt;textarea&lt;/code&gt; element with the
+     &lt;code&gt;form&lt;/code&gt; element pointed to by the &lt;a
+     href=&quot;#form-element&quot;&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Append the new element to the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt;.&lt;/p&gt;
-
     &lt;p&gt;Switch the tokeniser's &lt;a href=&quot;#content2&quot;&gt;content model flag&lt;/a&gt; to
      the RCDATA state.&lt;/p&gt;
 
@@ -43596,6 +43726,44 @@
     &lt;p&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt;. Act as if a start tag token with
      the tag name &quot;br&quot; had been seen. Ignore the end tag token.&lt;/p&gt;
 
+   &lt;dt&gt;A start tag whose tag name is &quot;math&quot;
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#reconstruct&quot;&gt;Reconstruct the active formatting elements&lt;/a&gt;,
+     if any.&lt;/p&gt;
+
+    &lt;p&gt;&lt;a href=&quot;#insert1&quot;&gt;Insert a foreign element&lt;/a&gt; for the token, in the
+     &lt;a href=&quot;#mathml0&quot;&gt;MathML namespace&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the token has its &lt;i&gt;self-closing flag&lt;/i&gt; set, pop the &lt;a
+     href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a href=&quot;#stack&quot;&gt;stack of open
+     elements&lt;/a&gt; and &lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let the &lt;a href=&quot;#secondary1&quot;&gt;secondary insertion mode&lt;/a&gt;
+     be the current &lt;span&gt;insertion mode&lt;/span&gt;, and then switch the
+     &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;a href=&quot;#in-foreign&quot; title=&quot;insertion
+     mode: in foreign content&quot;&gt;in foreign content&lt;/a&gt;&quot;.&lt;/p&gt;
+
+   &lt;dt&gt;A start tag whose tag name is &quot;svg&quot;
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#reconstruct&quot;&gt;Reconstruct the active formatting elements&lt;/a&gt;,
+     if any.&lt;/p&gt;
+
+    &lt;p&gt;&lt;a href=&quot;#insert1&quot;&gt;Insert a foreign element&lt;/a&gt; for the token, in the
+     &lt;a href=&quot;#svg-namespace&quot;&gt;SVG namespace&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the token has its &lt;i&gt;self-closing flag&lt;/i&gt; set, pop the &lt;a
+     href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a href=&quot;#stack&quot;&gt;stack of open
+     elements&lt;/a&gt; and &lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let the &lt;a href=&quot;#secondary1&quot;&gt;secondary insertion mode&lt;/a&gt;
+     be the current &lt;span&gt;insertion mode&lt;/span&gt;, and then switch the
+     &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;a href=&quot;#in-foreign&quot; title=&quot;insertion
+     mode: in foreign content&quot;&gt;in foreign content&lt;/a&gt;&quot;.&lt;/p&gt;
+
    &lt;dt&gt;A start or end tag whose tag name is one of: &quot;caption&quot;, &quot;col&quot;,
     &quot;colgroup&quot;, &quot;frame&quot;, &quot;frameset&quot;, &quot;head&quot;, &quot;option&quot;, &quot;optgroup&quot;, &quot;tbody&quot;,
     &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;
@@ -44006,6 +44174,10 @@
      Immediately pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a
      href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
+     set.&lt;/p&gt;
+
    &lt;dt&gt;An end tag whose tag name is &quot;colgroup&quot;
 
    &lt;dd&gt;
@@ -44446,9 +44618,9 @@
     &lt;p&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-inselect&gt;&lt;span class=secno&gt;8.2.5.17. &lt;/span&gt;The &quot;&lt;dfn
-   id=in-select0 title=&quot;insertion mode: in select in table&quot;&gt;in select in
-   table&lt;/dfn&gt;&quot; insertion mode&lt;/h5&gt;
+  &lt;h5 id=parsing-main-inselectintable&gt;&lt;span class=secno&gt;8.2.5.17. &lt;/span&gt;The
+   &quot;&lt;dfn id=in-select0 title=&quot;insertion mode: in select in table&quot;&gt;in select
+   in table&lt;/dfn&gt;&quot; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;When the &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;a href=&quot;#in-select0&quot;
    title=&quot;insertion mode: in select in table&quot;&gt;in select in table&lt;/a&gt;&quot;, tokens
@@ -44482,7 +44654,110 @@
      &lt;span&gt;insertion mode&lt;/span&gt;.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-afterbody&gt;&lt;span class=secno&gt;8.2.5.18. &lt;/span&gt;The &quot;&lt;dfn
+  &lt;h5 id=parsing-main-inforeign&gt;&lt;span class=secno&gt;8.2.5.18. &lt;/span&gt;The &quot;&lt;dfn
+   id=in-foreign title=&quot;insertion mode: in foreign content&quot;&gt;in foreign
+   content&lt;/dfn&gt;&quot; insertion mode&lt;/h5&gt;
+
+  &lt;p&gt;When the &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;a href=&quot;#in-foreign&quot;
+   title=&quot;insertion mode: in foreign content&quot;&gt;in foreign content&lt;/a&gt;&quot;, tokens
+   must be handled as follows:
+
+  &lt;dl class=switch&gt;
+   &lt;dt&gt;A character token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#insert&quot; title=&quot;insert a character&quot;&gt;Insert the token's
+     character&lt;/a&gt; into the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;dt&gt;A comment token
+
+   &lt;dd&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;a href=&quot;#current4&quot;&gt;current
+     node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data
+     given in the comment token.&lt;/p&gt;
+
+   &lt;dt&gt;A DOCTYPE token
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an
+    &lt;code&gt;mi&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an
+    &lt;code&gt;mo&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an
+    &lt;code&gt;mn&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an
+    &lt;code&gt;ms&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an
+    &lt;code&gt;mtext&lt;/code&gt; element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML
+    namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is a
+    &lt;code&gt;foreignObject&lt;/code&gt; element in the &lt;a href=&quot;#svg-namespace&quot;&gt;SVG
+    namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is a
+    &lt;code&gt;desc&lt;/code&gt; element in the &lt;a href=&quot;#svg-namespace&quot;&gt;SVG
+    namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is a &lt;code&gt;&lt;a
+    href=&quot;#title1&quot;&gt;title&lt;/a&gt;&lt;/code&gt; element in the &lt;a
+    href=&quot;#svg-namespace&quot;&gt;SVG namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an element
+    in the &lt;a href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;.
+
+   &lt;dt&gt;A start tag whose tag name is &quot;svg&quot;, if the &lt;a
+    href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an &lt;code&gt;annotation-xml&lt;/code&gt;
+    element in the &lt;a href=&quot;#mathml0&quot;&gt;MathML namespace&lt;/a&gt;.
+
+   &lt;dt&gt;An end tag
+
+   &lt;dd&gt;
+    &lt;p&gt;Process the token &lt;a href=&quot;#using8&quot;&gt;using the rules for&lt;/a&gt; the &lt;a
+     href=&quot;#secondary1&quot;&gt;secondary insertion mode&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If, after doing so, the &lt;span&gt;insertion mode&lt;/span&gt; is still &quot;&lt;a
+     href=&quot;#in-foreign&quot; title=&quot;insertion mode: in foreign content&quot;&gt;in foreign
+     content&lt;/a&gt;&quot;, but there is no element in scope that has a namespace
+     other than the &lt;a href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;, switch the
+     &lt;span&gt;insertion mode&lt;/span&gt; to the &lt;a href=&quot;#secondary1&quot;&gt;secondary
+     insertion mode&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;dt&gt;A start tag whose tag name is one of: &lt;span title=big-issue&gt;the HTML
+    element tag names&lt;/span&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Pop elements from the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;
+     until the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is in the &lt;a
+     href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Switch the &lt;span&gt;insertion mode&lt;/span&gt; to the &lt;a
+     href=&quot;#secondary1&quot;&gt;secondary insertion mode&lt;/a&gt;, and reprocess the
+     token.&lt;/p&gt;
+
+   &lt;dt&gt;Any other start tag
+
+   &lt;dd&gt;
+    &lt;p class=big-issue&gt;Apply case fixups, attribute namespace fixups.&lt;/p&gt;
+
+    &lt;p&gt;&lt;a href=&quot;#insert1&quot;&gt;Insert a foreign element&lt;/a&gt; for the token, in the
+     same namespace as the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the token has its &lt;i&gt;self-closing flag&lt;/i&gt; set, pop the &lt;a
+     href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a href=&quot;#stack&quot;&gt;stack of open
+     elements&lt;/a&gt; and &lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;.&lt;/p&gt;
+  &lt;/dl&gt;
+
+  &lt;h5 id=parsing-main-afterbody&gt;&lt;span class=secno&gt;8.2.5.19. &lt;/span&gt;The &quot;&lt;dfn
    id=after5 title=&quot;insertion mode: after body&quot;&gt;after body&lt;/dfn&gt;&quot; insertion
    mode&lt;/h5&gt;
 
@@ -44546,7 +44821,7 @@
      body&lt;/a&gt;&quot; and reprocess the token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-inframeset&gt;&lt;span class=secno&gt;8.2.5.19. &lt;/span&gt;The &quot;&lt;dfn
+  &lt;h5 id=parsing-main-inframeset&gt;&lt;span class=secno&gt;8.2.5.20. &lt;/span&gt;The &quot;&lt;dfn
    id=in-frameset title=&quot;insertion mode: in frameset&quot;&gt;in frameset&lt;/dfn&gt;&quot;
    insertion mode&lt;/h5&gt;
 
@@ -44612,6 +44887,10 @@
      Immediately pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; off the &lt;a
      href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
+     set.&lt;/p&gt;
+
    &lt;dt&gt;A start tag whose tag name is &quot;noframes&quot;
 
    &lt;dd&gt;
@@ -44637,7 +44916,7 @@
     &lt;p&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=parsing-main-afterframeset&gt;&lt;span class=secno&gt;8.2.5.20. &lt;/span&gt;The
+  &lt;h5 id=parsing-main-afterframeset&gt;&lt;span class=secno&gt;8.2.5.21. &lt;/span&gt;The
    &quot;&lt;dfn id=after6 title=&quot;insertion mode: after frameset&quot;&gt;after
    frameset&lt;/dfn&gt;&quot; insertion mode&lt;/h5&gt;
 
@@ -44697,7 +44976,7 @@
    that do support frames but want to show the NOFRAMES content. Supporting
    the former is easy; supporting the latter is harder.
 
-  &lt;h5 id=the-after0&gt;&lt;span class=secno&gt;8.2.5.21. &lt;/span&gt;The &quot;&lt;dfn id=after7
+  &lt;h5 id=the-after0&gt;&lt;span class=secno&gt;8.2.5.22. &lt;/span&gt;The &quot;&lt;dfn id=after7
    title=&quot;insertion mode: after after body&quot;&gt;after after body&lt;/dfn&gt;&quot; insertion
    mode&lt;/h5&gt;
 
@@ -44739,7 +45018,7 @@
      body&lt;/a&gt;&quot; and reprocess the token.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;h5 id=the-after1&gt;&lt;span class=secno&gt;8.2.5.22. &lt;/span&gt;The &quot;&lt;dfn id=after8
+  &lt;h5 id=the-after1&gt;&lt;span class=secno&gt;8.2.5.23. &lt;/span&gt;The &quot;&lt;dfn id=after8
    title=&quot;insertion mode: after after frameset&quot;&gt;after after frameset&lt;/dfn&gt;&quot;
    insertion mode&lt;/h5&gt;
 

Modified: source
===================================================================
--- source	2008-04-05 11:14:50 UTC (rev 1403)
+++ source	2008-04-05 13:00:21 UTC (rev 1404)
@@ -37035,9 +37035,10 @@
   title=&quot;insertion mode: in cell&quot;&gt;in cell&lt;/span&gt;&quot;, &quot;&lt;span
   title=&quot;insertion mode: in select&quot;&gt;in select&lt;/span&gt;&quot;, &quot;&lt;span
   title=&quot;insertion mode: in select in table&quot;&gt;in select in
-  table&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: after body&quot;&gt;after
-  body&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in frameset&quot;&gt;in
-  frameset&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: after
+  table&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in foreign content&quot;&gt;in
+  foreign content&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: after
+  body&quot;&gt;after body&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: in
+  frameset&quot;&gt;in frameset&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode: after
   frameset&quot;&gt;after frameset&lt;/span&gt;&quot;, &quot;&lt;span title=&quot;insertion mode:
   after after body&quot;&gt;after after body&lt;/span&gt;&quot;, and &quot;&lt;span
   title=&quot;insertion mode: after after frameset&quot;&gt;after after
@@ -37061,7 +37062,14 @@
   mode&lt;/span&gt; unchanged (unless the rules in that section themselves
   switch the &lt;span&gt;insertion mode&lt;/span&gt;).&lt;/p&gt;
 
+  &lt;p&gt;When the insertion mode is switched to &quot;&lt;span title=&quot;insertion
+  mode: in foreign content&quot;&gt;in foreign content&lt;/span&gt;&quot;, the
+  &lt;dfn&gt;secondary insertion mode&lt;/dfn&gt; is also set. This secondary mode
+  is used within the rules for the &quot;&lt;span title=&quot;insertion mode: in
+  foreign content&quot;&gt;in foreign content&lt;/span&gt;&quot; mode to handle HTML
+  (i.e. not foreign) content.&lt;/p&gt;
 
+
   &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;reset the insertion
   mode appropriately&lt;/dfn&gt;, it means the UA must follow these
   steps:&lt;/p&gt;
@@ -37079,7 +37087,12 @@
    fragment parsing algorithm&lt;/span&gt; is neither a &lt;code&gt;td&lt;/code&gt;
    element nor a &lt;code&gt;th&lt;/code&gt; element, then set &lt;var
    title=&quot;&quot;&gt;node&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;context&lt;/var&gt;
-   element. (&lt;span&gt;fragment case&lt;/span&gt;)&lt;/li&gt;
+   element. (&lt;span&gt;fragment case&lt;/span&gt;)&lt;/li&gt; &lt;!-- XXX this fails to
+   actually set &quot;node&quot; to something useful in the &lt;td&gt; case, which we
+   want (either body (or nothing, to hit the last clause in this list)
+   or td/th; in the former case, remove the redundant 'fragment case'
+   bits in the 'in cell' section, in the latter case, check that
+   td.innerHTML = &quot;&lt;caption&gt;&quot; works as expected by browsers) --&gt;
 
    &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is a &lt;code&gt;select&lt;/code&gt; element,
    then switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
@@ -37115,6 +37128,12 @@
    title=&quot;insertion mode: in table&quot;&gt;in table&lt;/span&gt;&quot; and abort these
    steps.&lt;/li&gt;
 
+   &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is an element from the &lt;span&gt;MathML
+   namespace&lt;/span&gt; or the &lt;span&gt;SVG namespace&lt;/span&gt;, then switch the
+   &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span title=&quot;insertion mode: in
+   foreign content&quot;&gt;in foreign content&lt;/span&gt;&quot; and abort these
+   steps.&lt;/li&gt;
+
    &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is a &lt;code&gt;head&lt;/code&gt; element,
    then switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
    title=&quot;insertion mode: in body&quot;&gt;in body&lt;/span&gt;&quot; (&quot;&lt;span
@@ -37450,7 +37469,8 @@
   state. In the RCDATA and CDATA states, a further &lt;dfn&gt;escape
   flag&lt;/dfn&gt; is used to control the behaviour of the tokeniser. It is
   either true or false, and initially must be set to the false
-  state.&lt;/p&gt;
+  state. The &lt;span&gt;insertion mode&lt;/span&gt; and the &lt;span&gt;stack of open
+  elements&lt;/span&gt; also affects tokenisation.&lt;/p&gt;
 
   &lt;p&gt;The output of the tokenisation step is a series of zero or more
   of the following tokens: DOCTYPE, start tag, end tag, comment,
@@ -37460,8 +37480,11 @@
   identifier, and system identifier must be marked as missing (which
   is a distinct state from the empty string), and the &lt;i&gt;force-quirks
   flag&lt;/i&gt; must be set to &lt;i&gt;off&lt;/i&gt; (its other state is
-  &lt;i&gt;on&lt;/i&gt;). Start and end tag tokens have a tag name and a list of
-  attributes, each of which has a name and a value. Comment and
+  &lt;i&gt;on&lt;/i&gt;). Start and end tag tokens have a tag name, a
+  &lt;i&gt;self-closing flag&lt;/i&gt;, and a list of attributes, each of which
+  has a name and a value. When a DOCTYPE token is created, its
+  &lt;i&gt;self-closing flag&lt;/i&gt; must be unset (its other state is that it
+  be set), and its attributes list must be empty. Comment and
   character tokens have data.&lt;/p&gt;
 
   &lt;p&gt;When a token is emitted, it must immediately be handled by the
@@ -37472,17 +37495,19 @@
   using the &lt;span&gt;dynamic markup insertion&lt;/span&gt; APIs to insert
   characters into the stream being tokenised.)&lt;/p&gt;
 
+  &lt;p&gt;When a start tag token is emitted with its &lt;i&gt;self-closing
+  flag&lt;/i&gt; set, if the flag is not &lt;dfn title=&quot;acknowledge
+  self-closing flag&quot;&gt;acknowledged&lt;/dfn&gt; when it is processed by the
+  tree construction stage, that is a &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt;
+
   &lt;p&gt;When an end tag token is emitted, the &lt;span&gt;content model
   flag&lt;/span&gt; must be switched to the PCDATA state.&lt;/p&gt;
 
   &lt;p&gt;When an end tag token is emitted with attributes, that is a
   &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;dfn&gt;permitted slash&lt;/dfn&gt; is a U+002F SOLIDUS character that
-  is immediately followed by a U+003E GREATER-THAN SIGN, if, and only
-  if, the current token being processed is a start tag token whose tag
-  name is the same as the tag name of one of &lt;span&gt;void
-  elements&lt;/span&gt;.&lt;/p&gt;
+  &lt;p&gt;When an end tag token is emitted with its &lt;i&gt;self-closing
+  flag&lt;/i&gt; set, that is a &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;Before each step of the tokeniser, the user agent may check to
   see if either one of the scripts in the &lt;span&gt;list of scripts that
@@ -37756,9 +37781,7 @@
      state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;U+002F SOLIDUS (/)&lt;/dt&gt;
-     &lt;dd&gt;&lt;span&gt;Parse error&lt;/span&gt; unless this is a &lt;span&gt;permitted
-     slash&lt;/span&gt;. Switch to the &lt;span&gt;before attribute name
-     state&lt;/span&gt;.&lt;/dd&gt;
+     &lt;dd&gt;Switch to the &lt;span&gt;self-closing start tag state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;Anything else&lt;/dt&gt;
      &lt;dd&gt;Append the current input character to the current tag token's
@@ -37796,9 +37819,7 @@
      state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;U+002F SOLIDUS (/)&lt;/dt&gt;
-     &lt;dd&gt;&lt;span&gt;Parse error&lt;/span&gt; unless this is a &lt;span&gt;permitted
-     slash&lt;/span&gt;. Stay in the &lt;span&gt;before attribute name
-     state&lt;/span&gt;.&lt;/dd&gt;
+     &lt;dd&gt;Switch to the &lt;span&gt;self-closing start tag state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;U+0022 QUOTATION MARK (&quot;)&lt;/dt&gt;
      &lt;dt&gt;U+0027 APOSTROPHE (')&lt;/dt&gt;
@@ -37851,9 +37872,7 @@
      state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;U+002F SOLIDUS (/)&lt;/dt&gt;
-     &lt;dd&gt;&lt;span&gt;Parse error&lt;/span&gt; unless this is a &lt;span&gt;permitted
-     slash&lt;/span&gt;. Switch to the &lt;span&gt;before attribute name
-     state&lt;/span&gt;.&lt;/dd&gt;
+     &lt;dd&gt;Switch to the &lt;span&gt;self-closing start tag state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;U+0022 QUOTATION MARK (&quot;)&lt;/dt&gt;
      &lt;dt&gt;U+0027 APOSTROPHE (')&lt;/dt&gt;
@@ -37912,9 +37931,7 @@
      state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;U+002F SOLIDUS (/)&lt;/dt&gt;
-     &lt;dd&gt;&lt;span&gt;Parse error&lt;/span&gt; unless this is a &lt;span&gt;permitted
-     slash&lt;/span&gt;. Switch to the &lt;span&gt;before attribute name
-     state&lt;/span&gt;.&lt;/dd&gt;
+     &lt;dd&gt;Switch to the &lt;span&gt;self-closing start tag state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;EOF&lt;/dt&gt;
      &lt;dd&gt;&lt;span&gt;Parse error&lt;/span&gt;. Emit the current tag
@@ -38123,9 +38140,7 @@
      state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;U+002F SOLIDUS (/)&lt;/dt&gt;
-     &lt;dd&gt;&lt;span&gt;Parse error&lt;/span&gt; unless this is a &lt;span&gt;permitted
-     slash&lt;/span&gt;. Switch to the &lt;span&gt;before attribute name
-     state&lt;/span&gt;.&lt;/dd&gt;
+     &lt;dd&gt;Switch to the &lt;span&gt;self-closing start tag state&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;Anything else&lt;/dt&gt;
      &lt;dd&gt;&lt;span&gt;Parse error&lt;/span&gt;. Reconsume the character in
@@ -38135,6 +38150,27 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;&lt;dfn&gt;Self-closing start tag state&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Consume the &lt;span&gt;next input character&lt;/span&gt;:&lt;/p&gt;
+
+    &lt;dl class=&quot;switch&quot;&gt;
+
+     &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)&lt;/dt&gt;
+     &lt;dd&gt;Set the &lt;i&gt;self-closing flag&lt;/i&gt; of the current tag
+     token. Emit the current tag token. Switch to the &lt;span&gt;data
+     state&lt;/span&gt;.&lt;/dd&gt;
+     
+     &lt;dt&gt;Anything else&lt;/dt&gt;
+     &lt;dd&gt;&lt;span&gt;Parse error&lt;/span&gt;. Reconsume the character in
+     the &lt;span&gt;before attribute name state&lt;/span&gt;.&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;&lt;dfn&gt;Bogus comment state&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -38171,11 +38207,35 @@
     whose data is the empty string, and switch to the &lt;span&gt;comment
     start state&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise if the next seven characters are a
+    &lt;p&gt;Otherwise, if the next seven characters are a
     &lt;span&gt;case-insensitive&lt;/span&gt;&lt;!-- XXX xref, ascii only --&gt; match
     for the word &quot;DOCTYPE&quot;, then consume those characters and switch
     to the &lt;span&gt;DOCTYPE state&lt;/span&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, if the &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span
+    title=&quot;insertion mode: in foreign content&quot;&gt;in foreign
+    content&lt;/span&gt;&quot; and the &lt;span&gt;current node&lt;/span&gt; is not one of
+    the following:&lt;/p&gt;
+
+    &lt;ul&gt;
+     &lt;li&gt;An &lt;code&gt;mi&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/li&gt;
+     &lt;li&gt;An &lt;code&gt;mo&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/li&gt;
+     &lt;li&gt;An &lt;code&gt;mn&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/li&gt;
+     &lt;li&gt;An &lt;code&gt;ms&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/li&gt;
+     &lt;li&gt;An &lt;code&gt;mtext&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/li&gt;
+     &lt;li&gt;A &lt;code&gt;foreignObject&lt;/code&gt; element in the &lt;span&gt;SVG namespace&lt;/span&gt;.&lt;/li&gt;
+     &lt;li&gt;A &lt;code&gt;desc&lt;/code&gt; element in the &lt;span&gt;SVG namespace&lt;/span&gt;.&lt;/li&gt;
+     &lt;li&gt;A &lt;code&gt;title&lt;/code&gt; element in the &lt;span&gt;SVG namespace&lt;/span&gt;.&lt;/li&gt;
+    &lt;/ul&gt;
+
+    &lt;p&gt;...and the next seven characters are a
+    &lt;span&gt;case-sensitive&lt;/span&gt;&lt;!-- XXX xref, ascii only --&gt; match for
+    the string &quot;[CDATA[&quot; (the five uppercase letters &quot;CDATA&quot; with a
+    U+005B LEFT SQUARE BRACKET character before and after), then
+    consume those characters and switch to the &lt;span&gt;CDATA block
+    state&lt;/span&gt; (which is unrelated to the &lt;span&gt;content model
+    flag&lt;/span&gt;'s CDATA state).&lt;/p&gt;
+
     &lt;p&gt;Otherwise, this is a &lt;span&gt;parse error&lt;/span&gt;. Switch to the
     &lt;span&gt;bogus comment state&lt;/span&gt;. The next character that is
     consumed, if any, is the first character that will be in the
@@ -38778,6 +38838,29 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;&lt;dfn&gt;CDATA state&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;&lt;em&gt;(This can only happen if the &lt;span&gt;content model
+    flag&lt;/span&gt; is set to the PCDATA state, and is unrelated to the
+    &lt;span&gt;content model flag&lt;/span&gt;'s CDATA state.)&lt;/em&gt;&lt;/p&gt;
+
+    &lt;p&gt;Consume every character up to the next occurrence of the three
+    character sequence U+005D RIGHT SQUARE BRACKET U+005D RIGHT SQUARE
+    BRACKET U+003E GREATER-THAN SIGN (&lt;code title=&quot;&quot;&gt;]]&gt;&lt;/code&gt;), or
+    the end of the file (EOF), whichever comes first. Emit a series of
+    text tokens consisting of all the characters consumed except the
+    matching three character sequence at the end (if one was found
+    before the end of the file).&lt;/p&gt;
+
+    &lt;p&gt;Switch to the &lt;span&gt;data state&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the end of the file was reached, reconsume the EOF
+    character.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
   &lt;/dl&gt;
 
 
@@ -39020,33 +39103,46 @@
   depths.&lt;/p&gt;
 
 
-  &lt;h5&gt;Creating and inserting HTML elements&lt;/h5&gt;
+  &lt;h5&gt;Creating and inserting elements&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn title=&quot;create an
-  element for the token&quot;&gt;create an element for a token&lt;/dfn&gt;, the UA
-  must create a node implementing the interface appropriate for the
-  element type corresponding to the tag name of the token (as given in
-  the section of this specification that defines that element,
-  e.g. for an &lt;code&gt;a&lt;/code&gt; element it would be the
-  &lt;code&gt;HTMLAnchorElement&lt;/code&gt; interface), with the tag name being
-  the name of that element, with the node being in the &lt;span&gt;HTML
-  namespace&lt;/span&gt;, and with the attributes on the node being those
+  element for the token&quot;&gt;create an element for a token&lt;/dfn&gt; in a
+  particular namespace, the UA must create a node implementing the
+  interface appropriate for the element type corresponding to the tag
+  name of the token in the given namespace (as given in the
+  specification that defines that element, e.g. for an &lt;code&gt;a&lt;/code&gt;
+  element in the &lt;span&gt;HTML namespace&lt;/span&gt;, this specification
+  defines it to be the &lt;code&gt;HTMLAnchorElement&lt;/code&gt; interface), with
+  the tag name being the name of that element, with the node being in
+  the given namespace, and with the attributes on the node being those
   given in the given token.&lt;/p&gt;
 
+  &lt;p&gt;The interface appropriate for an element in the &lt;span&gt;HTML
+  namespace&lt;/span&gt; that is not defined in this specification is
+  &lt;code&gt;HTMLElement&lt;/code&gt;. The interface appropriate for an element
+  in another namespace that is not defined by that namespace's
+  specification is &lt;code&gt;Element&lt;/code&gt;.&lt;/p&gt;
+
   &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;insert an HTML
   element&lt;/dfn&gt; for a token, the UA must first &lt;span&gt;create an element
-  for the token&lt;/span&gt;, and then append this node to the &lt;span&gt;current
-  node&lt;/span&gt;, and push it onto the &lt;span&gt;stack of open
-  elements&lt;/span&gt; so that it is the new &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+  for the token&lt;/span&gt; in the &lt;span&gt;HTML namespace&lt;/span&gt;, and then
+  append this node to the &lt;span&gt;current node&lt;/span&gt;, and push it onto
+  the &lt;span&gt;stack of open elements&lt;/span&gt; so that it is the new
+  &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;The steps below may also require that the UA insert an HTML
-  element in a particular place, in which case the UA must
-  &lt;span&gt;create an element for the token&lt;/span&gt; and then insert or
-  append the new node in the location specified. (This happens in
-  particular during the parsing of tables with invalid content.)&lt;/p&gt;
+  element in a particular place, in which case the UA must follow the
+  same steps except that it must insert or append the new node in the
+  location specified insead of appending it to the &lt;span&gt;current
+  node&lt;/span&gt;. (This happens in particular during the parsing of
+  tables with invalid content.)&lt;/p&gt;
 
-  &lt;p&gt;The interface appropriate for an element that is not defined in
-  this specification is &lt;code&gt;HTMLElement&lt;/code&gt;.&lt;/p&gt;
+  &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;insert a foreign
+  element&lt;/dfn&gt; for a token, the UA must first &lt;span&gt;create an element
+  for the token&lt;/span&gt; in the given namespace, and then append this
+  node to the &lt;span&gt;current node&lt;/span&gt;, and push it onto the
+  &lt;span&gt;stack of open elements&lt;/span&gt; so that it is the new
+  &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn&gt;generic CDATA parsing algorithm&lt;/dfn&gt; and the
   &lt;dfn&gt;generic RCDATA parsing algorithm&lt;/dfn&gt; consist of the following
@@ -39301,7 +39397,8 @@
    &lt;dt&gt;A start tag whose tag name is &quot;html&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt;. Append it to the
+    &lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt;, using the
+    &lt;span&gt;HTML namespace&lt;/span&gt;. Append it to the
     &lt;code&gt;Document&lt;/code&gt; object. Put this element in the &lt;span&gt;stack
     of open elements&lt;/span&gt;.&lt;/p&gt;
 
@@ -39385,14 +39482,11 @@
    &lt;dt&gt;A start tag whose tag name is &quot;head&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token.&lt;/p&gt;
 
-    &lt;p&gt;Set the &lt;span&gt;&lt;code title=&quot;&quot;&gt;head&lt;/code&gt; element
-    pointer&lt;/span&gt; to this new element node.&lt;/p&gt;
+    &lt;p&gt;Set the &lt;span&gt;&lt;code title=&quot;&quot;&gt;head&lt;/code&gt; element pointer&lt;/span&gt;
+    to the newly created &lt;code&gt;head&lt;/code&gt; element.&lt;/p&gt;
 
-    &lt;p&gt;Append the new element to the &lt;span&gt;current node&lt;/span&gt; and
-    push it onto the &lt;span&gt;stack of open elements&lt;/span&gt;.&lt;/p&gt;
-
     &lt;p&gt;Switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span
     title=&quot;insertion mode: in head&quot;&gt;in head&lt;/span&gt;&quot;.&lt;/p&gt;
 
@@ -39470,17 +39564,26 @@
 
    &lt;dt&gt;A start tag whose tag name is one of: &quot;base&quot;, &quot;link&quot;&lt;/dt&gt;
    &lt;dd&gt;
+
     &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token. Immediately
     pop the &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
     elements&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span title=&quot;acknowledge self-closing flag&quot;&gt;Acknowledge the
+    token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;, if it is set.&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;meta&quot;&lt;/dt&gt;
    &lt;dd&gt;
+
     &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token. Immediately
     pop the &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
     elements&lt;/span&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;span title=&quot;acknowledge self-closing flag&quot;&gt;Acknowledge the
+    token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;, if it is set.&lt;/p&gt;
+
     &lt;p id=&quot;meta-charset-during-parse&quot;&gt;If the element has a &lt;code
     title=&quot;attr-meta-charset&quot;&gt;charset&lt;/code&gt; attribute, and its
     value is a supported encoding, and the &lt;span
@@ -39526,7 +39629,8 @@
    &lt;dt id=&quot;scriptTag&quot;&gt;A start tag whose tag name is &quot;script&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt; in the &lt;span&gt;HTML
+    namespace&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p&gt;Mark the element as being
     &lt;span&gt;&quot;parser-inserted&quot;&lt;/span&gt;. This ensures that, if the
@@ -40638,6 +40742,9 @@
     pop the &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
     elements&lt;/span&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;span title=&quot;acknowledge self-closing flag&quot;&gt;Acknowledge the
+    token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;, if it is set.&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;hr&quot;&lt;/dt&gt;
@@ -40652,6 +40759,9 @@
     pop the &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
     elements&lt;/span&gt;.&lt;/p&gt;
 
+    &lt;p&gt;&lt;span title=&quot;acknowledge self-closing flag&quot;&gt;Acknowledge the
+    token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;, if it is set.&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;image&quot;&lt;/dt&gt;
@@ -40668,17 +40778,19 @@
     &lt;p&gt;&lt;span&gt;Reconstruct the active formatting elements&lt;/span&gt;, if
     any.&lt;/p&gt;
 
-    &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token.&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token. Immediately
+    pop the &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
+    elements&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;span&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-    pointer&lt;/span&gt; is not null, then &lt;span&gt;associate&lt;/span&gt;&lt;!--XXX
-    xref! --&gt; the &lt;code&gt;input&lt;/code&gt; element with the
+    &lt;p&gt;&lt;span title=&quot;acknowledge self-closing flag&quot;&gt;Acknowledge the
+    token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;, if it is set.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt;
+    is not null, then &lt;span&gt;associate&lt;/span&gt;&lt;!--XXX xref! --&gt; the
+    newly created &lt;code&gt;input&lt;/code&gt; element with the
     &lt;code&gt;form&lt;/code&gt; element pointed to by the &lt;span&gt;&lt;code
     title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Pop that &lt;code&gt;input&lt;/code&gt; element off the &lt;span&gt;stack of
-    open elements&lt;/span&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
    &lt;dt id=&quot;isindex&quot;&gt;A start tag whose tag name is &quot;isindex&quot;&lt;/dt&gt;
@@ -40759,17 +40871,16 @@
    &lt;dt&gt;A start tag whose tag name is &quot;textarea&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt;, in the
+    &lt;span&gt;HTML namespace&lt;/span&gt;. Append the new element to the
+    &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;span&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-    pointer&lt;/span&gt; is not null, then &lt;span&gt;associate&lt;/span&gt;&lt;!--XXX
-    xref! --&gt; the &lt;code&gt;textarea&lt;/code&gt; element with the
+    &lt;p&gt;If the &lt;span&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt;
+    is not null, then &lt;span&gt;associate&lt;/span&gt;&lt;!--XXX xref! --&gt; the
+    newly created &lt;code&gt;textarea&lt;/code&gt; element with the
     &lt;code&gt;form&lt;/code&gt; element pointed to by the &lt;span&gt;&lt;code
     title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Append the new element to the &lt;span&gt;current
-    node&lt;/span&gt;.&lt;/p&gt;
-
     &lt;p&gt;Switch the tokeniser's &lt;span&gt;content model flag&lt;/span&gt; to
     the RCDATA state.&lt;/p&gt;
 
@@ -40838,6 +40949,48 @@
     the tag name &quot;br&quot; had been seen. Ignore the end tag token.&lt;/p&gt;
    &lt;/dd&gt;
 
+   &lt;dt&gt;A start tag whose tag name is &quot;math&quot;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;&lt;span&gt;Reconstruct the active formatting elements&lt;/span&gt;, if
+    any.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span&gt;Insert a foreign element&lt;/span&gt; for the token, in the
+    &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the token has its &lt;i&gt;self-closing flag&lt;/i&gt; set, pop the
+    &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
+    elements&lt;/span&gt; and &lt;span title=&quot;acknowledge self-closing
+    flag&quot;&gt;acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let the &lt;span&gt;secondary insertion mode&lt;/span&gt; be the
+    current &lt;span&gt;insertion mode&lt;/span&gt;, and then switch the
+    &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span title=&quot;insertion mode: in
+    foreign content&quot;&gt;in foreign content&lt;/span&gt;&quot;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;A start tag whose tag name is &quot;svg&quot;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;&lt;span&gt;Reconstruct the active formatting elements&lt;/span&gt;, if
+    any.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span&gt;Insert a foreign element&lt;/span&gt; for the token, in the
+    &lt;span&gt;SVG namespace&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the token has its &lt;i&gt;self-closing flag&lt;/i&gt; set, pop the
+    &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
+    elements&lt;/span&gt; and &lt;span title=&quot;acknowledge self-closing
+    flag&quot;&gt;acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let the &lt;span&gt;secondary insertion mode&lt;/span&gt; be the
+    current &lt;span&gt;insertion mode&lt;/span&gt;, and then switch the
+    &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;span title=&quot;insertion mode: in
+    foreign content&quot;&gt;in foreign content&lt;/span&gt;&quot;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;A start or end tag whose tag name is one of: &quot;caption&quot;, &quot;col&quot;,
    &quot;colgroup&quot;, &quot;frame&quot;, &quot;frameset&quot;, &quot;head&quot;, &quot;option&quot;, &quot;optgroup&quot;,
    &quot;tbody&quot;, &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;&lt;/dt&gt;
@@ -41267,9 +41420,14 @@
 
    &lt;dt&gt;A start tag whose tag name is &quot;col&quot;&lt;/dt&gt;
    &lt;dd&gt;
+
     &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token. Immediately
     pop the &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
     elements&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span title=&quot;acknowledge self-closing flag&quot;&gt;Acknowledge the
+    token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;, if it is set.&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;An end tag whose tag name is &quot;colgroup&quot;&lt;/dt&gt;
@@ -41760,7 +41918,7 @@
   &lt;/dl&gt;
 
 
-  &lt;h5 id=&quot;parsing-main-inselect&quot;&gt;The &quot;&lt;dfn title=&quot;insertion mode: in select in table&quot;&gt;in select in table&lt;/dfn&gt;&quot; insertion mode&lt;/h5&gt;
+  &lt;h5 id=&quot;parsing-main-inselectintable&quot;&gt;The &quot;&lt;dfn title=&quot;insertion mode: in select in table&quot;&gt;in select in table&lt;/dfn&gt;&quot; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;When the &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span title=&quot;insertion
   mode: in select in table&quot;&gt;in select in table&lt;/span&gt;&quot;, tokens must be handled as follows:&lt;/p&gt;
@@ -41798,6 +41956,89 @@
   &lt;/dl&gt;
 
 
+  &lt;h5 id=&quot;parsing-main-inforeign&quot;&gt;The &quot;&lt;dfn title=&quot;insertion mode: in foreign content&quot;&gt;in foreign content&lt;/dfn&gt;&quot; insertion mode&lt;/h5&gt;
+
+  &lt;p&gt;When the &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span title=&quot;insertion
+  mode: in foreign content&quot;&gt;in foreign content&lt;/span&gt;&quot;, tokens must be
+  handled as follows:&lt;/p&gt;
+
+  &lt;dl class=&quot;switch&quot;&gt;
+
+   &lt;dt&gt;A character token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's
+    character&lt;/span&gt; into the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+   &lt;dt&gt;A comment token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
+    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
+    the data given in the comment token.&lt;/p&gt;
+   &lt;/dd&gt;
+
+   &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+   &lt;/dd&gt;
+
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is an &lt;code&gt;mi&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is an &lt;code&gt;mo&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is an &lt;code&gt;mn&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is an &lt;code&gt;ms&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is an &lt;code&gt;mtext&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is a &lt;code&gt;foreignObject&lt;/code&gt; element in the &lt;span&gt;SVG namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is a &lt;code&gt;desc&lt;/code&gt; element in the &lt;span&gt;SVG namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is a &lt;code&gt;title&lt;/code&gt; element in the &lt;span&gt;SVG namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag, if the &lt;span&gt;current node&lt;/span&gt; is an element in the &lt;span&gt;HTML namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;A start tag whose tag name is &quot;svg&quot;, if the &lt;span&gt;current node&lt;/span&gt; is an &lt;code&gt;annotation-xml&lt;/code&gt; element in the &lt;span&gt;MathML namespace&lt;/span&gt;.&lt;/dt&gt;
+   &lt;dt&gt;An end tag&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Process the token &lt;span&gt;using the rules for&lt;/span&gt; the
+    &lt;span&gt;secondary insertion mode&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If, after doing so, the &lt;span&gt;insertion mode&lt;/span&gt; is still
+    &quot;&lt;span title=&quot;insertion mode: in foreign content&quot;&gt;in foreign
+    content&lt;/span&gt;&quot;, but there is no element in scope that has a
+    namespace other than the &lt;span&gt;HTML namespace&lt;/span&gt;, switch the
+    &lt;span&gt;insertion mode&lt;/span&gt; to the &lt;span&gt;secondary insertion
+    mode&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;A start tag whose tag name is one of: &lt;span title=&quot;big-issue&quot;&gt;the HTML element tag names&lt;/span&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Pop elements from the &lt;span&gt;stack of open elements&lt;/span&gt; until
+    the &lt;span&gt;current node&lt;/span&gt; is in the &lt;span&gt;HTML
+    namespace&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Switch the &lt;span&gt;insertion mode&lt;/span&gt; to the &lt;span&gt;secondary
+    insertion mode&lt;/span&gt;, and reprocess the token.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;Any other start tag&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p class=&quot;big-issue&quot;&gt;Apply case fixups, attribute namespace fixups.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span&gt;Insert a foreign element&lt;/span&gt; for the token, in the
+    same namespace as the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If the token has its &lt;i&gt;self-closing flag&lt;/i&gt; set, pop the
+    &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
+    elements&lt;/span&gt; and &lt;span title=&quot;acknowledge self-closing
+    flag&quot;&gt;acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+
   &lt;h5 id=&quot;parsing-main-afterbody&quot;&gt;The &quot;&lt;dfn title=&quot;insertion mode: after body&quot;&gt;after body&lt;/dfn&gt;&quot; insertion mode&lt;/h5&gt;
 
   &lt;p&gt;When the &lt;span&gt;insertion mode&lt;/span&gt; is &quot;&lt;span title=&quot;insertion
@@ -41929,9 +42170,14 @@
 
    &lt;dt&gt;A start tag whose tag name is &quot;frame&quot;&lt;/dt&gt;
    &lt;dd&gt;
+
     &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token.
     Immediately pop the &lt;span&gt;current node&lt;/span&gt; off the
     &lt;span&gt;stack of open elements&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span title=&quot;acknowledge self-closing flag&quot;&gt;Acknowledge the
+    token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;, if it is set.&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;noframes&quot;&lt;/dt&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008305.html">[html5] r1403 - /
</A></li>
	<LI>Next message: <A HREF="008307.html">[html5] r1406 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8306">[ date ]</a>
              <a href="thread.html#8306">[ thread ]</a>
              <a href="subject.html#8306">[ subject ]</a>
              <a href="author.html#8306">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
