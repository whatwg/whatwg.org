<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1519 - / images
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1519%20-%20/%20images&In-Reply-To=%3C20080506010949.38A8513A159%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008417.html">
   <LINK REL="Next"  HREF="008419.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1519 - / images</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1519%20-%20/%20images&In-Reply-To=%3C20080506010949.38A8513A159%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1519 - / images">whatwg at whatwg.org
       </A><BR>
    <I>Mon May  5 18:09:49 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008417.html">[html5] r1518 - /
</A></li>
        <LI>Next message: <A HREF="008419.html">[html5] r1520 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8418">[ date ]</a>
              <a href="thread.html#8418">[ thread ]</a>
              <a href="subject.html#8418">[ subject ]</a>
              <a href="author.html#8418">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-05-05 18:09:48 -0700 (Mon, 05 May 2008)
New Revision: 1519

Added:
   images/baselines.png
Modified:
   index
   source
Log:
[] (0) Rendering text to a canvas: the fillText(), strokeText(), and measureText() APIs.

Added: images/baselines.png
===================================================================
(Binary files differ)


Property changes on: images/baselines.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: index
===================================================================
--- index	2008-04-30 21:59:01 UTC (rev 1518)
+++ index	2008-05-06 01:09:48 UTC (rev 1519)
@@ -25,8 +25,7 @@
 
    &lt;h1 id=html-5&gt;HTML 5&lt;/h1&gt;
 
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft&gt;Draft Recommendation &mdash; 30 April
-    2008&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft&gt;Draft Recommendation &mdash; 6 May 2008&lt;/h2&gt;
 
    &lt;p&gt;You can take part in this work. &lt;a
     href=&quot;<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&quot;&gt;Join the working group's
@@ -732,13 +731,16 @@
            &lt;li&gt;&lt;a href=&quot;#complex&quot;&gt;&lt;span class=secno&gt;3.12.11.1.8.
             &lt;/span&gt;Complex shapes (paths)&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#images&quot;&gt;&lt;span class=secno&gt;3.12.11.1.9.
+           &lt;li&gt;&lt;a href=&quot;#text&quot;&gt;&lt;span class=secno&gt;3.12.11.1.9. &lt;/span&gt;Text&lt;/a&gt;
+            
+
+           &lt;li&gt;&lt;a href=&quot;#images&quot;&gt;&lt;span class=secno&gt;3.12.11.1.10.
             &lt;/span&gt;Images&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#pixel&quot;&gt;&lt;span class=secno&gt;3.12.11.1.10. &lt;/span&gt;Pixel
+           &lt;li&gt;&lt;a href=&quot;#pixel&quot;&gt;&lt;span class=secno&gt;3.12.11.1.11. &lt;/span&gt;Pixel
             manipulation&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#drawing&quot;&gt;&lt;span class=secno&gt;3.12.11.1.11.
+           &lt;li&gt;&lt;a href=&quot;#drawing&quot;&gt;&lt;span class=secno&gt;3.12.11.1.12.
             &lt;/span&gt;Drawing model&lt;/a&gt;
           &lt;/ul&gt;
 
@@ -1614,7 +1616,7 @@
           elements&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#text&quot;&gt;&lt;span class=secno&gt;8.1.3 &lt;/span&gt;Text&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#text0&quot;&gt;&lt;span class=secno&gt;8.1.3 &lt;/span&gt;Text&lt;/a&gt;
         &lt;ul class=toc&gt;
          &lt;li&gt;&lt;a href=&quot;#newlines&quot;&gt;&lt;span class=secno&gt;8.1.3.1.
           &lt;/span&gt;Newlines&lt;/a&gt;
@@ -2369,7 +2371,9 @@
    context, the &quot;computed value of the 'color' property&quot; for the purposes of
    determining the computed value of the &lt;code title=&quot;&quot;&gt;currentColor&lt;/code&gt;
    keyword is the computed value of the 'color' property on the element in
-   question. &lt;a href=&quot;#refsCSS3COLOR&quot;&gt;[CSS3COLOR]&lt;/a&gt;
+   question. &lt;a href=&quot;#refsCSS3COLOR&quot;&gt;[CSS3COLOR]&lt;/a&gt;&lt;/p&gt;
+  &lt;!-- XXX what if that
+  element has no computed value? e.g. if it is not in a document? --&gt;
 
   &lt;p class=example&gt;If a canvas gradient's &lt;code
    title=dom-canvasgradient-addColorStop&gt;&lt;a
@@ -6647,7 +6651,8 @@
   &lt;p&gt;The processing of this attribute depends on the presentation layer. For
    example, CSS 2.1 defines a mapping from this attribute to the CSS
    'direction' and 'unicode-bidi' properties, and defines rendering in terms
-   of those properties.
+   of those properties.&lt;/p&gt;
+  &lt;!-- XXXDIR --&gt;
 
   &lt;p&gt;The &lt;dfn id=dir0 title=dom-dir&gt;&lt;code&gt;dir&lt;/code&gt;&lt;/dfn&gt; DOM attribute on
    an element must &lt;a href=&quot;#reflect&quot;&gt;reflect&lt;/a&gt; the &lt;code title=attr-dir&gt;&lt;a
@@ -13214,7 +13219,7 @@
 
    &lt;dd&gt;&lt;code title=attr-img-ismap&gt;&lt;a href=&quot;#ismap&quot;&gt;ismap&lt;/a&gt;&lt;/code&gt;
 
-   &lt;dd&gt;&lt;code title=attr-dim-width&gt;&lt;a href=&quot;#width3&quot;&gt;width&lt;/a&gt;&lt;/code&gt;
+   &lt;dd&gt;&lt;code title=attr-dim-width&gt;&lt;a href=&quot;#width4&quot;&gt;width&lt;/a&gt;&lt;/code&gt;
 
    &lt;dd&gt;&lt;code title=attr-dim-height&gt;&lt;a href=&quot;#height3&quot;&gt;height&lt;/a&gt;&lt;/code&gt;
 
@@ -13984,7 +13989,7 @@
 
    &lt;dd&gt;&lt;code title=attr-embed-type&gt;&lt;a href=&quot;#type4&quot;&gt;type&lt;/a&gt;&lt;/code&gt;
 
-   &lt;dd&gt;&lt;code title=attr-dim-width&gt;&lt;a href=&quot;#width3&quot;&gt;width&lt;/a&gt;&lt;/code&gt;
+   &lt;dd&gt;&lt;code title=attr-dim-width&gt;&lt;a href=&quot;#width4&quot;&gt;width&lt;/a&gt;&lt;/code&gt;
 
    &lt;dd&gt;&lt;code title=attr-dim-height&gt;&lt;a href=&quot;#height3&quot;&gt;height&lt;/a&gt;&lt;/code&gt;
 
@@ -13997,7 +14002,7 @@
      class=idl&gt;interface &lt;dfn id=htmlembedelement&gt;HTMLEmbedElement&lt;/dfn&gt; : &lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt; {
            attribute DOMString &lt;a href=&quot;#src4&quot; title=dom-embed-src&gt;src&lt;/a&gt;;
            attribute DOMString &lt;a href=&quot;#type5&quot; title=dom-embed-type&gt;type&lt;/a&gt;;
-           attribute long &lt;a href=&quot;#width4&quot; title=dom-dim-width&gt;width&lt;/a&gt;;
+           attribute long &lt;a href=&quot;#width5&quot; title=dom-dim-width&gt;width&lt;/a&gt;;
            attribute long &lt;a href=&quot;#height4&quot; title=dom-dim-height&gt;height&lt;/a&gt;;
 };&lt;/pre&gt;
 
@@ -14117,7 +14122,7 @@
 
    &lt;dd&gt;&lt;code title=attr-hyperlink-usemap&gt;&lt;a href=&quot;#usemap1&quot;&gt;usemap&lt;/a&gt;&lt;/code&gt;
 
-   &lt;dd&gt;&lt;code title=attr-dim-width&gt;&lt;a href=&quot;#width3&quot;&gt;width&lt;/a&gt;&lt;/code&gt;
+   &lt;dd&gt;&lt;code title=attr-dim-width&gt;&lt;a href=&quot;#width4&quot;&gt;width&lt;/a&gt;&lt;/code&gt;
 
    &lt;dd&gt;&lt;code title=attr-dim-height&gt;&lt;a href=&quot;#height3&quot;&gt;height&lt;/a&gt;&lt;/code&gt;
 
@@ -14129,7 +14134,7 @@
            attribute DOMString &lt;a href=&quot;#data0&quot; title=dom-object-data&gt;data&lt;/a&gt;;
            attribute DOMString &lt;a href=&quot;#type7&quot; title=dom-object-type&gt;type&lt;/a&gt;;
            attribute DOMString &lt;a href=&quot;#usemap0&quot; title=dom-object-useMap&gt;useMap&lt;/a&gt;;
-           attribute long &lt;a href=&quot;#width4&quot; title=dom-dim-width&gt;width&lt;/a&gt;;
+           attribute long &lt;a href=&quot;#width5&quot; title=dom-dim-width&gt;width&lt;/a&gt;;
            attribute long &lt;a href=&quot;#height4&quot; title=dom-dim-height&gt;height&lt;/a&gt;;&lt;!--
   readonly attribute Document &lt;span title=&quot;dom-object-contentDocument&quot;&gt;contentDocument&lt;/span&gt;;
   readonly attribute &lt;span&gt;Window&lt;/span&gt; &lt;span title=&quot;dom-object-contentWindow&quot;&gt;contentWindow&lt;/span&gt;;--&gt;
@@ -14484,7 +14489,7 @@
    &lt;dd&gt;&lt;code title=attr-media-controls&gt;&lt;a
     href=&quot;#controls&quot;&gt;controls&lt;/a&gt;&lt;/code&gt;
 
-   &lt;dd&gt;&lt;code title=attr-dim-width&gt;&lt;a href=&quot;#width3&quot;&gt;width&lt;/a&gt;&lt;/code&gt;
+   &lt;dd&gt;&lt;code title=attr-dim-width&gt;&lt;a href=&quot;#width4&quot;&gt;width&lt;/a&gt;&lt;/code&gt;
 
    &lt;dd&gt;&lt;code title=attr-dim-height&gt;&lt;a href=&quot;#height3&quot;&gt;height&lt;/a&gt;&lt;/code&gt;
 
@@ -14493,7 +14498,7 @@
    &lt;dd&gt;
     &lt;pre
      class=idl&gt;interface &lt;dfn id=htmlvideoelement&gt;HTMLVideoElement&lt;/dfn&gt; : &lt;a href=&quot;#htmlmediaelement&quot;&gt;HTMLMediaElement&lt;/a&gt; {
-           attribute long &lt;a href=&quot;#width4&quot; title=dom-dim-width&gt;width&lt;/a&gt;;
+           attribute long &lt;a href=&quot;#width5&quot; title=dom-dim-width&gt;width&lt;/a&gt;;
            attribute long &lt;a href=&quot;#height4&quot; title=dom-dim-height&gt;height&lt;/a&gt;;
   readonly attribute unsigned long &lt;a href=&quot;#videowidth&quot; title=dom-video-videoWidth&gt;videoWidth&lt;/a&gt;;
   readonly attribute unsigned long &lt;a href=&quot;#videoheight&quot; title=dom-video-videoHeight&gt;videoHeight&lt;/a&gt;;
@@ -14847,7 +14852,7 @@
    &lt;code title=attr-media-controls&gt;&lt;a href=&quot;#controls&quot;&gt;controls&lt;/a&gt;&lt;/code&gt;,
    apply to all &lt;a href=&quot;#media5&quot; title=&quot;media element&quot;&gt;media elements&lt;/a&gt;.
    They are defined in this section.&lt;/p&gt;
-  &lt;!-- XXX v3 features:
+  &lt;!-- XXXv3 features:
     * frame forward / backwards / step(n) while paused
     * hasAudio, hasVideo, hasCaptions, etc
     * per-frame control: get current frame; set current frame
@@ -17304,7 +17309,7 @@
   void &lt;a href=&quot;#transform&quot; title=dom-context-2d-transform&gt;transform&lt;/a&gt;(in float m11, in float m12, in float m21, in float m22, in float dx, in float dy);
   void &lt;a href=&quot;#settransform&quot; title=dom-context-2d-setTransform&gt;setTransform&lt;/a&gt;(in float m11, in float m12, in float m21, in float m22, in float dx, in float dy);
 &lt;!--
-  // XXXv3 we've also received requests for:
+  // XXXv4 we've also received requests for:
   void skew(...);
   void reflect(...); // or mirror(...)
 --&gt;
@@ -17352,6 +17357,20 @@
   void &lt;a href=&quot;#clip&quot; title=dom-context-2d-clip&gt;clip&lt;/a&gt;();
   boolean &lt;a href=&quot;#ispointinpath&quot; title=dom-context-2d-isPointInPath&gt;isPointInPath&lt;/a&gt;(in float x, in float y);
 
+  // text
+           attribute DOMString &lt;a href=&quot;#font&quot; title=dom-context-2d-font&gt;font&lt;/a&gt;; // (default 8px sans-serif)
+           attribute DOMString &lt;a href=&quot;#textalign&quot; title=dom-context-2d-textAlign&gt;textAlign&lt;/a&gt;; // &quot;start&quot;, &quot;end&quot;, &quot;left&quot;, &quot;right&quot;, &quot;center&quot; (default: &quot;start&quot;)
+           attribute DOMString &lt;a href=&quot;#textbaseline&quot; title=dom-context-2d-textBaseline&gt;textBaseline&lt;/a&gt;; // &quot;top&quot;, &quot;hanging&quot;, &quot;middle&quot;, &quot;alphabetic&quot;, &quot;ideographic&quot;, &quot;bottom&quot; (default: &quot;alphabetic&quot;)
+  void &lt;a href=&quot;#filltext&quot; title=dom-context-2d-fillText&gt;fillText&lt;/a&gt;(in DOMString text, in float x, in float y);
+  void &lt;a href=&quot;#filltext&quot; title=dom-context-2d-fillText&gt;fillText&lt;/a&gt;(in DOMString text, in float x, in float y, in float maxWidth);
+  void &lt;a href=&quot;#stroketext&quot; title=dom-context-2d-strokeText&gt;strokeText&lt;/a&gt;(in DOMString text, in float x, in float y);
+  void &lt;a href=&quot;#stroketext&quot; title=dom-context-2d-strokeText&gt;strokeText&lt;/a&gt;(in DOMString text, in float x, in float y, in float maxWidth);&lt;!-- XXXDVT
+  void &lt;span title=&quot;dom-context-2d-fillVerticalText&quot;&gt;fillVerticalText&lt;/span&gt;(in DOMString text, in float x, in float y);
+  void &lt;span title=&quot;dom-context-2d-fillVerticalText&quot;&gt;fillVerticalText&lt;/span&gt;(in DOMString text, in float x, in float y, in float maxHeight);
+  void &lt;span title=&quot;dom-context-2d-strokeVerticalText&quot;&gt;strokeVerticalText&lt;/span&gt;(in DOMString text, in float x, in float y);
+  void &lt;span title=&quot;dom-context-2d-strokeVerticalText&quot;&gt;strokeVerticalText&lt;/span&gt;(in DOMString text, in float x, in float y, in float maxHeight); --&gt;
+  &lt;a href=&quot;#textmetrics&quot;&gt;TextMetrics&lt;/a&gt; &lt;a href=&quot;#measuretext&quot; title=dom-context-2d-measureText&gt;measureText&lt;/a&gt;(in DOMString text);
+
   // drawing images
   void &lt;a href=&quot;#drawimage&quot; title=dom-context-2d-drawImage&gt;drawImage&lt;/a&gt;(in &lt;a href=&quot;#htmlimageelement&quot;&gt;HTMLImageElement&lt;/a&gt; image, in float dx, in float dy);
   void &lt;a href=&quot;#drawimage&quot; title=dom-context-2d-drawImage&gt;drawImage&lt;/a&gt;(in &lt;a href=&quot;#htmlimageelement&quot;&gt;HTMLImageElement&lt;/a&gt; image, in float dx, in float dy, in float dw, in float dh);
@@ -17365,11 +17384,6 @@
   &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; &lt;a href=&quot;#getimagedata&quot; title=dom-context-2d-getImageData&gt;getImageData&lt;/a&gt;(in float sx, in float sy, in float sw, in float sh);
   void &lt;a href=&quot;#putimagedata&quot; title=dom-context-2d-putImageData&gt;putImageData&lt;/a&gt;(in &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; imagedata, in float dx, in float dy);
   void &lt;a href=&quot;#putimagedata&quot; title=dom-context-2d-putImageData&gt;putImageData&lt;/a&gt;(in &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; imagedata, in float dx, in float dy, in float dirtyX, in float dirtyY, in float dirtyWidth, in float dirtyHeight);
-
-  // drawing text is not supported in this version of the API
-  // (there is no way to predict what metrics the fonts will have,
-  // which makes fonts very hard to use for painting)
-
 };
 
 interface &lt;dfn id=canvasgradient&gt;CanvasGradient&lt;/dfn&gt; {
@@ -17381,8 +17395,12 @@
   // opaque object
 };
 
+interface &lt;dfn id=textmetrics&gt;TextMetrics&lt;/dfn&gt; {
+  readonly attribute float &lt;a href=&quot;#width2&quot; title=dom-textmetrics-width&gt;width&lt;/a&gt;;
+};
+
 interface &lt;dfn id=imagedata&gt;ImageData&lt;/dfn&gt; {
-  readonly attribute long int &lt;a href=&quot;#width2&quot; title=dom-imagedata-width&gt;width&lt;/a&gt;;
+  readonly attribute long int &lt;a href=&quot;#width3&quot; title=dom-imagedata-width&gt;width&lt;/a&gt;;
   readonly attribute long int &lt;a href=&quot;#height2&quot; title=dom-imagedata-height&gt;height&lt;/a&gt;;
   readonly attribute int[] &lt;a href=&quot;#data1&quot; title=dom-imagedata-data&gt;data&lt;/a&gt;;
 };&lt;/pre&gt;
@@ -17439,7 +17457,11 @@
     title=dom-context-2d-shadowColor&gt;&lt;a
     href=&quot;#shadowcolor&quot;&gt;shadowColor&lt;/a&gt;&lt;/code&gt;, &lt;code
     title=dom-context-2d-globalCompositeOperation&gt;&lt;a
-    href=&quot;#globalcompositeoperation&quot;&gt;globalCompositeOperation&lt;/a&gt;&lt;/code&gt;.
+    href=&quot;#globalcompositeoperation&quot;&gt;globalCompositeOperation&lt;/a&gt;&lt;/code&gt;,
+    &lt;code title=dom-context-2d-font&gt;&lt;a href=&quot;#font&quot;&gt;font&lt;/a&gt;&lt;/code&gt;, &lt;code
+    title=dom-context-2d-textAlign&gt;&lt;a href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt;,
+    &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+    href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt;.
   &lt;/ul&gt;
 
   &lt;p class=note&gt;The current path and the current bitmap are not part of the
@@ -17457,7 +17479,7 @@
    title=dom-context-2d-restore&gt;&lt;code&gt;restore()&lt;/code&gt;&lt;/dfn&gt; method must pop
    the top entry in the drawing state stack, and reset the drawing state it
    describes. If there is no saved state, the method must do nothing.&lt;/p&gt;
-  &lt;!-- XXXv3
+  &lt;!-- XXXv4
 idea from Mihai:
 &gt; 5. Drawing states should be saveable with IDs, and for easier restoring.
 &gt;
@@ -17972,7 +17994,7 @@
    patterns, then &lt;code title=dom-context-2d-createPattern&gt;&lt;a
    href=&quot;#createpattern&quot;&gt;createPattern()&lt;/a&gt;&lt;/code&gt; must return null.&lt;/p&gt;
   &lt;!--
-   XXXv3 Requests for v3 features:
+   XXXv4 Requests for v4 features:
     * apply transforms to patterns, so you don't have to create
       transformed patterns manually by rendering them to an off-screen
       canvas then using that canvas as the pattern.
@@ -18074,7 +18096,7 @@
   what they do on setting. not a big deal; it's pretty obvious. but if
   anyone complains, we'll have to add it --&gt;
   &lt;!--
-XXXv3 dashed lines have been requested.  Philip Taylor provides these
+XXXv4 dashed lines have been requested.  Philip Taylor provides these
 notes on what would need to be defined for dashed lines:
 &gt; I don't think it's entirely trivial to add, to the detail that's
 &gt; necessary in a specification. The common graphics APIs (at least
@@ -18504,7 +18526,7 @@
   &lt;p&gt;When the context is initialised, the clipping region must be set to the
    rectangle with the top left corner at (0,0) and the width and height of
    the coordinate space.&lt;/p&gt;
-  &lt;!-- XXXv3
+  &lt;!-- XXXv4
    Jordan OSETE suggests:
     * support ways of extending the clipping region (union instead of intersection)
        - also &quot;add&quot;, &quot;substract&quot;, &quot;replace&quot;, &quot;intersect&quot; and &quot;xor&quot;
@@ -18522,8 +18544,494 @@
    If either of the arguments is infinite or NaN, then the method must return
    false.
 
-  &lt;h6 id=images&gt;&lt;span class=secno&gt;3.12.11.1.9. &lt;/span&gt;Images&lt;/h6&gt;
+  &lt;h6 id=text&gt;&lt;span class=secno&gt;3.12.11.1.9. &lt;/span&gt;Text&lt;/h6&gt;
+  &lt;!-- a v3 feature --&gt;
 
+  &lt;p&gt;The &lt;dfn id=font title=dom-context-2d-font&gt;&lt;code&gt;font&lt;/code&gt;&lt;/dfn&gt; DOM
+   attribute, on setting, must be parsed the same way as the 'font' property
+   of CSS (but without supporting property-global stylesheet syntax like
+   'inherit'), and the resulting font must be assigned to the context, with
+   the 'line-height' component forced to 'normal'. &lt;a
+   href=&quot;#refsCSS&quot;&gt;[CSS]&lt;/a&gt;&lt;!-- XXX generic version-independent
+  reference --&gt;
+
+  &lt;p&gt;On getting, the &lt;code title=dom-context-2d-font&gt;&lt;a
+   href=&quot;#font&quot;&gt;font&lt;/a&gt;&lt;/code&gt; attribute must return the serialised form of
+   the current font of the context. &lt;a
+   href=&quot;#refsCSSOM&quot;&gt;[CSSOM]&lt;/a&gt;&lt;!-- XXX ensure that this
+  defines serialisation of 'font' --&gt;
+
+  &lt;p&gt;When the context is created, the font of the context must be set to 10px
+   sans-serif. When the 'font-size' component is set to lengths using
+   percentages, 'em' or 'ex' units, or the 'larger' or 'smaller' keywords,
+   these must be interpreted relative to the computed value of the
+   'font-size' property of the corresponding &lt;code&gt;&lt;a
+   href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element. When the 'font-weight' component
+   is set to the relative values 'bolder' and 'lighter', these must be
+   interpreted relative to the computed value of the 'font-weight' property
+   of the corresponding &lt;code&gt;&lt;a href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+  &lt;!-- XXX what if that
+  element has no computed value? e.g. if it is not in a document? --&gt;
+
+  &lt;p&gt;The &lt;dfn id=textalign
+   title=dom-context-2d-textAlign&gt;&lt;code&gt;textAlign&lt;/code&gt;&lt;/dfn&gt; DOM attribute,
+   on getting, must return the current value. On setting, if the value is one
+   of &lt;code title=&quot;&quot;&gt;start&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;end&lt;/code&gt;, &lt;code
+   title=&quot;&quot;&gt;left&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;right&lt;/code&gt;, or &lt;code
+   title=&quot;&quot;&gt;center&lt;/code&gt;, then the value must be changed to the new value.
+   Otherwise, the new value must be ignored. When the context is created, the
+   &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+   href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; attribute must initially have the
+   value &lt;code title=&quot;&quot;&gt;start&lt;/code&gt;.
+
+  &lt;p&gt;The &lt;dfn id=textbaseline
+   title=dom-context-2d-textBaseline&gt;&lt;code&gt;textBaseline&lt;/code&gt;&lt;/dfn&gt; DOM
+   attribute, on getting, must return the current value. On setting, if the
+   value is one of &lt;code title=dom-context-2d-textBaseline-top&gt;&lt;a
+   href=&quot;#top&quot;&gt;top&lt;/a&gt;&lt;/code&gt;, &lt;code
+   title=dom-context-2d-textBaseline-hanging&gt;&lt;a
+   href=&quot;#hanging&quot;&gt;hanging&lt;/a&gt;&lt;/code&gt;, &lt;code
+   title=dom-context-2d-textBaseline-middle&gt;&lt;a
+   href=&quot;#middle&quot;&gt;middle&lt;/a&gt;&lt;/code&gt;, &lt;code
+   title=dom-context-2d-textBaseline-alphabetic&gt;&lt;a
+   href=&quot;#alphabetic&quot;&gt;alphabetic&lt;/a&gt;&lt;/code&gt;, &lt;code
+   title=dom-context-2d-textBaseline-ideographic&gt;&lt;a
+   href=&quot;#ideographic&quot;&gt;ideographic&lt;/a&gt;&lt;/code&gt;, or &lt;code
+   title=dom-context-2d-textBaseline-bottom&gt;&lt;a
+   href=&quot;#bottom&quot;&gt;bottom&lt;/a&gt;&lt;/code&gt;, then the value must be changed to the
+   new value. Otherwise, the new value must be ignored. When the context is
+   created, the &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+   href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; attribute must initially have
+   the value &lt;code title=&quot;&quot;&gt;alphabetic&lt;/code&gt;.
+
+  &lt;p&gt;The &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+   href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; attribute's allowed keywords
+   correspond to alignment points in the font:
+
+  &lt;p&gt;&lt;img alt=&quot;The top of the em square is roughly at the top of the glyphs
+   in a font, the hanging baseline is where some glyphs like &amp;#x0906; are
+   anchored, the middle is half-way between the top of the em square and the
+   bottom of the em square, the alphabetic baseline is where characters like
+   &amp;#x00C1;, &amp;#x00FF;, &amp;#x0066;, and &amp;#x03A9; are anchored, the ideographic
+   baseline is where glyphs like &amp;#x79C1; and &amp;#x9054; are anchored, and the
+   bottom of the em square is roughly at the bottom of the glyphs in a font.
+   The top and bottom of the bounding box can be far from these baselines,
+   due to glyphs extending far outside the em square.&quot;
+   src=&quot;images/baselines.png&quot;&gt;
+
+  &lt;p&gt;The keywords map to these alignment points as follows:
+
+  &lt;dl&gt;
+   &lt;dt&gt;&lt;dfn id=top
+    title=dom-context-2d-textBaseline-top&gt;&lt;code&gt;top&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;The top of the em square
+
+   &lt;dt&gt;&lt;dfn id=hanging
+    title=dom-context-2d-textBaseline-hanging&gt;&lt;code&gt;hanging&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;The hanging baseline
+
+   &lt;dt&gt;&lt;dfn id=middle
+    title=dom-context-2d-textBaseline-middle&gt;&lt;code&gt;middle&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;The middle of the em square
+
+   &lt;dt&gt;&lt;dfn id=alphabetic
+    title=dom-context-2d-textBaseline-alphabetic&gt;&lt;code&gt;alphabetic&lt;/code&gt;&lt;/dfn&gt;
+    
+
+   &lt;dd&gt;The alphabetic baseline
+
+   &lt;dt&gt;&lt;dfn id=ideographic
+    title=dom-context-2d-textBaseline-ideographic&gt;&lt;code&gt;ideographic&lt;/code&gt;&lt;/dfn&gt;
+    
+
+   &lt;dd&gt;The ideographic baseline
+
+   &lt;dt&gt;&lt;dfn id=bottom
+    title=dom-context-2d-textBaseline-bottom&gt;&lt;code&gt;bottom&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;The bottom of the em square
+  &lt;/dl&gt;
+
+  &lt;p&gt;The &lt;dfn id=filltext
+   title=dom-context-2d-fillText&gt;&lt;code&gt;fillText()&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn
+   id=stroketext
+   title=dom-context-2d-strokeText&gt;&lt;code&gt;strokeText()&lt;/code&gt;&lt;/dfn&gt; methods
+   take three or four arguments, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;, &lt;var
+   title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;, and optionally &lt;var
+   title=&quot;&quot;&gt;maxWidth&lt;/var&gt;, and render the given &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; at
+   the given (&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;) coordinates
+   ensuring that the text isn't wider than &lt;var title=&quot;&quot;&gt;maxWidth&lt;/var&gt; if
+   specified, using the current &lt;code title=dom-context-2d-font&gt;&lt;a
+   href=&quot;#font&quot;&gt;font&lt;/a&gt;&lt;/code&gt;, &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+   href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt;, and &lt;code
+   title=dom-context-2d-textBaseline&gt;&lt;a
+   href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; values. Specifically, when
+   the methods are called, the user agent must run the following steps:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;font&lt;/var&gt; be the current font of the browsing
+     context, as given by the &lt;code title=dom-context-2d-font&gt;&lt;a
+     href=&quot;#font&quot;&gt;font&lt;/a&gt;&lt;/code&gt; attribute.
+
+   &lt;li&gt;
+    &lt;p&gt;Replace all the &lt;a href=&quot;#space&quot; title=&quot;space character&quot;&gt;space
+     characters&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; with U+0020 SPACE characters.
+
+   &lt;li&gt;
+    &lt;p&gt;Form a hypothetical infinitely wide CSS line box containing a single
+     inline box containing the text &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;, with all the
+     properties at their initial values except the 'font' property of the
+     inline element set to &lt;var title=&quot;&quot;&gt;font&lt;/var&gt; and the 'direction'
+     property of the inline element set to the 'direction' property of the
+     &lt;code&gt;&lt;a href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element. &lt;a
+     href=&quot;#refsCSS&quot;&gt;[CSS]&lt;/a&gt;
+   &lt;/li&gt;
+   &lt;!-- XXXDIR somehow mention
+   somewhere that if you don't support CSS, dir=&quot;&quot; still maps to
+   'direction' for the purposes of things like this. --&gt;
+   &lt;!-- if you insert a step here, make sure to adjust the next step's
+   final words --&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;maxWidth&lt;/var&gt; argument was specified and the
+     hypothetical width of the inline box in the hypothetical line box is
+     greater than &lt;var title=&quot;&quot;&gt;maxWidth&lt;/var&gt; CSS pixels, then change &lt;var
+     title=&quot;&quot;&gt;font&lt;/var&gt; to have a more condensed font (if one is available
+     or if a reasonably readable one can be synthesised by applying a
+     horizontal scale factor to the font) or a smaller font, and return to
+     the previous step.
+
+   &lt;li&gt;
+    &lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt; be a point on the inline box,
+     determined by the &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+     href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; and &lt;code
+     title=dom-context-2d-textBaseline&gt;&lt;a
+     href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; values, as follows:&lt;/p&gt;
+
+    &lt;p&gt;Horizontal position:&lt;/p&gt;
+
+    &lt;dl&gt;
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+      href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; is &lt;code title=&quot;&quot;&gt;left&lt;/code&gt;
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+      href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; is &lt;code title=&quot;&quot;&gt;start&lt;/code&gt;
+      and the 'direction'&lt;!--XXXDIR--&gt; property on the &lt;code&gt;&lt;a
+      href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element has a computed value of 'ltr'
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+      href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; is &lt;code title=&quot;&quot;&gt;end&lt;/code&gt; and
+      the 'direction'&lt;!--XXXDIR--&gt; property on the &lt;code&gt;&lt;a
+      href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element has a computed value of 'rtl'
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s horizontal position be
+      the left edge of the inline box.
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+      href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; is &lt;code title=&quot;&quot;&gt;right&lt;/code&gt;
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+      href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; is &lt;code title=&quot;&quot;&gt;end&lt;/code&gt; and
+      the 'direction'&lt;!--XXXDIR--&gt; property on the &lt;code&gt;&lt;a
+      href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element has a computed value of 'ltr'
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+      href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; is &lt;code title=&quot;&quot;&gt;start&lt;/code&gt;
+      and the 'direction'&lt;!--XXXDIR--&gt; property on the &lt;code&gt;&lt;a
+      href=&quot;#canvas&quot;&gt;canvas&lt;/a&gt;&lt;/code&gt; element has a computed value of 'rtl'
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s horizontal position be
+      the right edge of the inline box.
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textAlign&gt;&lt;a
+      href=&quot;#textalign&quot;&gt;textAlign&lt;/a&gt;&lt;/code&gt; is &lt;code title=&quot;&quot;&gt;center&lt;/code&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s horizontal position be
+      half way between the left and right edges of the inline box.
+    &lt;/dl&gt;
+
+    &lt;p&gt;Vertical position:&lt;/p&gt;
+
+    &lt;dl&gt;
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+      href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; is &lt;code
+      title=dom-context-2d-textBaseline-top&gt;&lt;a href=&quot;#top&quot;&gt;top&lt;/a&gt;&lt;/code&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position be the
+      top of the em box of the first available font of the inline box.
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+      href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; is &lt;code
+      title=dom-context-2d-textBaseline-hanging&gt;&lt;a
+      href=&quot;#hanging&quot;&gt;hanging&lt;/a&gt;&lt;/code&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position be the
+      hanging baseline of the first available font of the inline box.
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+      href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; is &lt;code
+      title=dom-context-2d-textBaseline-middle&gt;&lt;a
+      href=&quot;#middle&quot;&gt;middle&lt;/a&gt;&lt;/code&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position be half
+      way between the bottom and the top of the em box of the first available
+      font of the inline box.
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+      href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; is &lt;code
+      title=dom-context-2d-textBaseline-alphabetic&gt;&lt;a
+      href=&quot;#alphabetic&quot;&gt;alphabetic&lt;/a&gt;&lt;/code&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position be the
+      alphabetic baseline of the first available font of the inline box.
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+      href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; is &lt;code
+      title=dom-context-2d-textBaseline-ideographic&gt;&lt;a
+      href=&quot;#ideographic&quot;&gt;ideographic&lt;/a&gt;&lt;/code&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position be the
+      ideographic baseline of the first available font of the inline box.
+
+     &lt;dt&gt; If &lt;code title=dom-context-2d-textBaseline&gt;&lt;a
+      href=&quot;#textbaseline&quot;&gt;textBaseline&lt;/a&gt;&lt;/code&gt; is &lt;code
+      title=dom-context-2d-textBaseline-bottom&gt;&lt;a
+      href=&quot;#bottom&quot;&gt;bottom&lt;/a&gt;&lt;/code&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position be the
+      bottom of the em box of the first available font of the inline box.
+    &lt;/dl&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Paint the hypothetical inline box as the shape given by the text's
+     glyphs, as transformed by the &lt;a href=&quot;#transformations0&quot;
+     title=dom-context-2d-transformation&gt;current transformation matrix&lt;/a&gt;,
+     and anchored and sized so that before applying the &lt;a
+     href=&quot;#transformations0&quot; title=dom-context-2d-transformation&gt;current
+     transformation matrix&lt;/a&gt;, the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt; is at
+     (&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;) and each CSS pixel is
+     mapped to one coordinate space unit.&lt;/p&gt;
+
+    &lt;p&gt;For &lt;code title=dom-context-2d-fillText&gt;&lt;a
+     href=&quot;#filltext&quot;&gt;fillText()&lt;/a&gt;&lt;/code&gt; &lt;code
+     title=dom-context-2d-fillStyle&gt;&lt;a href=&quot;#fillstyle&quot;&gt;fillStyle&lt;/a&gt;&lt;/code&gt;
+     must be applied and &lt;code title=dom-context-2d-strokeStyle&gt;&lt;a
+     href=&quot;#strokestyle&quot;&gt;strokeStyle&lt;/a&gt;&lt;/code&gt; must be ignored. For &lt;code
+     title=dom-context-2d-strokeText&gt;&lt;a
+     href=&quot;#stroketext&quot;&gt;strokeText()&lt;/a&gt;&lt;/code&gt; the reverse holds and &lt;code
+     title=dom-context-2d-strokeStyle&gt;&lt;a
+     href=&quot;#strokestyle&quot;&gt;strokeStyle&lt;/a&gt;&lt;/code&gt; must be applied and &lt;code
+     title=dom-context-2d-fillStyle&gt;&lt;a href=&quot;#fillstyle&quot;&gt;fillStyle&lt;/a&gt;&lt;/code&gt;
+     must be ignored.&lt;/p&gt;
+
+    &lt;p&gt;Text is painted without affecting the current path, and is subject to
+     &lt;a href=&quot;#shadows0&quot; title=shadows&gt;shadow effects&lt;/a&gt;, &lt;a
+     href=&quot;#globalalpha&quot; title=dom-context-2d-globalAlpha&gt;global alpha&lt;/a&gt;,
+     the &lt;a href=&quot;#clipping&quot; title=&quot;clipping region&quot;&gt;clipping region&lt;/a&gt;, and
+     &lt;a href=&quot;#globalcompositeoperation&quot;
+     title=dom-context-2d-globalCompositeOperation&gt;global composition
+     operators&lt;/a&gt;.&lt;/p&gt;
+  &lt;/ol&gt;
+  &lt;!--XXXDVT - this is commented out until CSS can get its act together
+enough to actual specify vertical text rendering (how long have we
+been waiting now?)
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-context-2d-fillVerticalText&quot;&gt;&lt;code&gt;fillVerticalText()&lt;/code&gt;&lt;/dfn&gt;
+  and &lt;dfn
+  title=&quot;dom-context-2d-strokeVerticalText&quot;&gt;&lt;code&gt;strokeVerticalText()&lt;/code&gt;&lt;/dfn&gt;
+  methods take three or four arguments, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;, and optionally &lt;var
+  title=&quot;&quot;&gt;maxHeight&lt;/var&gt;, and render the given &lt;var
+  title=&quot;&quot;&gt;text&lt;/var&gt; as vertical text at the given (&lt;var
+  title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;) coordinates ensuring that
+  the text isn't taller than &lt;var title=&quot;&quot;&gt;maxHeight&lt;/var&gt; if
+  specified, using the current &lt;code
+  title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt; and &lt;code
+  title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt;
+  values. Specifically, when the methods are called, the user agent
+  must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;font&lt;/var&gt; be the current font of the
+   browsing context, as given by the &lt;code
+   title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt; attribute.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Replace all the &lt;span title=&quot;space character&quot;&gt;space
+   characters&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; with U+0020 SPACE
+   characters.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Form a &lt;em class=&quot;big-issue&quot;&gt;whatever CSS ends up calling
+   vertical line boxes and inline boxes&lt;/em&gt; containing the text &lt;var
+   title=&quot;&quot;&gt;text&lt;/var&gt;, with all the properties at their initial
+   values except the 'font' property of the inline element set to &lt;var
+   title=&quot;&quot;&gt;font&lt;/var&gt; and the 'direction' property of the inline
+   element set to the 'direction' property of the &lt;code&gt;canvas&lt;/code&gt;
+   element.&lt;/p&gt;&lt;/li&gt;&lt;!- - XXXDIR - -&gt;
+
+   &lt;!- - if you insert a step here, make sure to adjust the next step's
+   final words - -&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;maxHeight&lt;/var&gt; argument was specified
+   and the hypothetical height of the &lt;em class=&quot;big-issue&quot;&gt;box&lt;/em&gt;
+   in the hypothetical line box is greater than &lt;var
+   title=&quot;&quot;&gt;maxHeight&lt;/var&gt; CSS pixels, then change &lt;var
+   title=&quot;&quot;&gt;font&lt;/var&gt; to have a more condensed font (if one is
+   available or if a reasonably readable one can be synthesised by
+   applying an appropriate scale factor to the font) or a smaller
+   font, and return to the previous step.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt; be a point on the &lt;em
+    class=&quot;big-issue&quot;&gt;inline box&lt;/var&gt;, determined by the &lt;code
+    title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt;, as follows:&lt;/p&gt;
+
+    &lt;p&gt;Vertical position:&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;start&lt;/code&gt;&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;left&lt;/code&gt; and the 'direction'&lt;!- -XXXDIR- -&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'ltr'&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;right&lt;/code&gt; and the 'direction'&lt;!- -XXXDIR- -&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'rtl'&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical
+     position be the top edge of the &lt;em class=&quot;big-issue&quot;&gt;inline
+     box&lt;/em&gt;.&lt;/dd&gt;
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;end&lt;/code&gt;&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;right&lt;/code&gt; and the 'direction'&lt;!- -XXXDIR- -&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'ltr'&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;left&lt;/code&gt; and the 'direction'&lt;!- -XXXDIR- -&gt; property on
+     the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'rtl'&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical
+     position be the bottom edge of the &lt;em class=&quot;big-issue&quot;&gt;inline
+     box&lt;/em&gt;.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;center&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position
+     be half way between the top and bottom edges of the &lt;em
+     class=&quot;big-issue&quot;&gt;inline box&lt;/em&gt;.&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+    &lt;p&gt;Let the horizontal position be half way between the left and
+    right edges of the em box of the first available font of the &lt;em
+    class=&quot;big-issue&quot;&gt;inline box&lt;/em&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Paint the hypothetical inline box as the shape given by the
+    text's glyphs, as transformed by the &lt;span
+    title=&quot;dom-context-2d-transformation&quot;&gt;current transformation
+    matrix&lt;/span&gt;, and anchored and sized so that before applying the
+    &lt;span title=&quot;dom-context-2d-transformation&quot;&gt;current transformation
+    matrix&lt;/span&gt;, the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt; is at (&lt;var
+    title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;) and each CSS pixel is
+    mapped to one coordinate space unit.&lt;/p&gt;
+
+    &lt;p&gt;For &lt;code
+    title=&quot;dom-context-2d-fillVerticalText&quot;&gt;fillVerticalText()&lt;/code&gt;
+    &lt;code title=&quot;dom-context-2d-fillStyle&quot;&gt;fillStyle&lt;/code&gt; must be
+    applied and &lt;code
+    title=&quot;dom-context-2d-strokeStyle&quot;&gt;strokeStyle&lt;/code&gt; must be
+    ignored. For &lt;code
+    title=&quot;dom-context-2d-strokeVerticalText&quot;&gt;strokeVerticalText()&lt;/code&gt;
+    the reverse holds and &lt;code
+    title=&quot;dom-context-2d-strokeStyle&quot;&gt;strokeStyle&lt;/code&gt; must be
+    applied and &lt;code
+    title=&quot;dom-context-2d-fillStyle&quot;&gt;fillStyle&lt;/code&gt; must be
+    ignored.&lt;/p&gt;
+
+    &lt;p&gt;Text is painted without affecting the current path, and is
+    subject to &lt;span title=&quot;shadows&quot;&gt;shadow effects&lt;/span&gt;, &lt;span
+    title=&quot;dom-context-2d-globalAlpha&quot;&gt;global alpha&lt;/span&gt;, the &lt;span
+    title=&quot;clipping region&quot;&gt;clipping region&lt;/span&gt;, and &lt;span
+    title=&quot;dom-context-2d-globalCompositeOperation&quot;&gt;global composition
+    operators&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+XXXDVT (also check for '- -' bits in the part above) --&gt;
+
+  &lt;p&gt;The &lt;dfn id=measuretext
+   title=dom-context-2d-measureText&gt;&lt;code&gt;measureText()&lt;/code&gt;&lt;/dfn&gt; method
+   takes one argument, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;. When the method is invoked,
+   the user agent must replace all the &lt;a href=&quot;#space&quot; title=&quot;space
+   character&quot;&gt;space characters&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; with U+0020
+   SPACE characters, and then must form a hypothetical infinitely wide CSS
+   line box containing a single inline box containing the text &lt;var
+   title=&quot;&quot;&gt;text&lt;/var&gt;, with all the properties at their initial values
+   except the 'font' property of the inline element set to the current font
+   of the browsing context, as given by the &lt;code
+   title=dom-context-2d-font&gt;&lt;a href=&quot;#font&quot;&gt;font&lt;/a&gt;&lt;/code&gt; attribute, and
+   must then return a new &lt;code&gt;&lt;a href=&quot;#textmetrics&quot;&gt;TextMetrics&lt;/a&gt;&lt;/code&gt;
+   object with its &lt;code title=dom-textmetrics-width&gt;&lt;a
+   href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; attribute set to the width of that inline
+   box, in CSS pixels. &lt;a href=&quot;#refsCSS&quot;&gt;[CSS]&lt;/a&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#textmetrics&quot;&gt;TextMetrics&lt;/a&gt;&lt;/code&gt; interface is
+   used for the objects returned from &lt;code
+   title=dom-context-2d-measureText&gt;&lt;a
+   href=&quot;#measuretext&quot;&gt;measureText()&lt;/a&gt;&lt;/code&gt;. It has one attribute, &lt;dfn
+   id=width2 title=dom-textmetrics-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt;, which is
+   set by the &lt;code title=dom-context-2d-measureText&gt;&lt;a
+   href=&quot;#measuretext&quot;&gt;measureText()&lt;/a&gt;&lt;/code&gt; method.
+
+  &lt;p class=note&gt;Glyphs rendered using &lt;code title=dom-context-2d-fillText&gt;&lt;a
+   href=&quot;#filltext&quot;&gt;fillText()&lt;/a&gt;&lt;/code&gt; and &lt;code
+   title=dom-context-2d-strokeText&gt;&lt;a
+   href=&quot;#stroketext&quot;&gt;strokeText()&lt;/a&gt;&lt;/code&gt; can spill out of the box given
+   by the font size (the em square size) and the width returned by &lt;code
+   title=dom-context-2d-measureText&gt;&lt;a
+   href=&quot;#measuretext&quot;&gt;measureText()&lt;/a&gt;&lt;/code&gt; (the text width). If the text
+   is to be rendered and removed, care needs to be taken to replace the
+   entire area of the canvas that the clipping region covers, not just the
+   box given by the em square height and measured text width.&lt;/p&gt;
+  &lt;!-- XXXv4 Drawing text along a given path --&gt;
+  &lt;!-- XXXv4 Adding text to a path --&gt;
+  &lt;!-- see also: <A HREF="http://www.w3.org/TR/SVG11/text.html#TextpathLayoutRules">http://www.w3.org/TR/SVG11/text.html#TextpathLayoutRules</A> --&gt;
+  &lt;!-- see also: <A HREF="http://developer.mozilla.org/en/docs/Drawing_text_using_a_canvas">http://developer.mozilla.org/en/docs/Drawing_text_using_a_canvas</A> --&gt;
+
+  &lt;p class=note&gt;A future version of the 2D context API may provide a way to
+   render fragments of documents, rendered using CSS, straight to the canvas.
+   This would be provided in preference to a dedicated way of doing multiline
+   layout.
+
+  &lt;h6 id=images&gt;&lt;span class=secno&gt;3.12.11.1.10. &lt;/span&gt;Images&lt;/h6&gt;
+
   &lt;p&gt;To draw images onto the canvas, the &lt;dfn id=drawimage
    title=dom-context-2d-drawImage&gt;&lt;code&gt;drawImage&lt;/code&gt;&lt;/dfn&gt; method can be
    used.
@@ -18625,7 +19133,7 @@
   of the target element, not the rendered image (e.g. height/width
   attributes don't affect it --&gt;
 
-  &lt;h6 id=pixel&gt;&lt;span class=secno&gt;3.12.11.1.10. &lt;/span&gt;&lt;dfn id=pixel0&gt;Pixel
+  &lt;h6 id=pixel&gt;&lt;span class=secno&gt;3.12.11.1.11. &lt;/span&gt;&lt;dfn id=pixel0&gt;Pixel
    manipulation&lt;/dfn&gt;&lt;/h6&gt;
   &lt;!--
   &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-createImageData&quot;&gt;createImageData&lt;/span&gt;(in float sw, in float sh);
@@ -18667,7 +19175,7 @@
    exception.
 
   &lt;p&gt;&lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; objects must be
-   initialised so that their &lt;dfn id=width2
+   initialised so that their &lt;dfn id=width3
    title=dom-imagedata-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; attribute is set to
    &lt;var title=&quot;&quot;&gt;w&lt;/var&gt;, the number of physical device pixels per row in the
    image data, their &lt;dfn id=height2
@@ -18725,7 +19233,7 @@
 
   &lt;p&gt;When the last four arguments are omitted, they must be assumed to have
    the values 0, 0, the &lt;code title=dom-imagedata-width&gt;&lt;a
-   href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; member of the &lt;var
+   href=&quot;#width3&quot;&gt;width&lt;/a&gt;&lt;/code&gt; member of the &lt;var
    title=&quot;&quot;&gt;imagedata&lt;/var&gt; structure, and the &lt;code
    title=dom-imagedata-height&gt;&lt;a href=&quot;#height2&quot;&gt;height&lt;/a&gt;&lt;/code&gt;member of
    the &lt;var title=&quot;&quot;&gt;imagedata&lt;/var&gt; structure, respectively.
@@ -18771,10 +19279,10 @@
    &lt;li&gt;
     &lt;p&gt;If &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;+&lt;var
      title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;&lt;/span&gt; is greater than the &lt;code
-     title=dom-imagedata-width&gt;&lt;a href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; attribute
+     title=dom-imagedata-width&gt;&lt;a href=&quot;#width3&quot;&gt;width&lt;/a&gt;&lt;/code&gt; attribute
      of the &lt;var title=&quot;&quot;&gt;imagedata&lt;/var&gt; argument, let &lt;var
      title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; be the value of that &lt;code
-     title=dom-imagedata-width&gt;&lt;a href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; attribute,
+     title=dom-imagedata-width&gt;&lt;a href=&quot;#width3&quot;&gt;width&lt;/a&gt;&lt;/code&gt; attribute,
      minus the value of &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;.&lt;/p&gt;
 
     &lt;p&gt;If &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;+&lt;var
@@ -18934,7 +19442,7 @@
 &lt;/html&gt;&lt;/pre&gt;
   &lt;/div&gt;
 
-  &lt;h6 id=drawing&gt;&lt;span class=secno&gt;3.12.11.1.11. &lt;/span&gt;Drawing model&lt;/h6&gt;
+  &lt;h6 id=drawing&gt;&lt;span class=secno&gt;3.12.11.1.12. &lt;/span&gt;Drawing model&lt;/h6&gt;
 
   &lt;p&gt;When a shape or image is painted, user agents must follow these steps,
    in the order given (or act as if they do):
@@ -19738,7 +20246,7 @@
   &lt;h4 id=dimension&gt;&lt;span class=secno&gt;3.12.17 &lt;/span&gt;&lt;dfn
    id=dimension0&gt;Dimension attributes&lt;/dfn&gt;&lt;/h4&gt;
 
-  &lt;p&gt;The &lt;dfn id=width3 title=attr-dim-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; and
+  &lt;p&gt;The &lt;dfn id=width4 title=attr-dim-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; and
    &lt;dfn id=height3 title=attr-dim-height&gt;&lt;code&gt;height&lt;/code&gt;&lt;/dfn&gt; attributes
    on &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
    href=&quot;#embed&quot;&gt;embed&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#object&quot;&gt;object&lt;/a&gt;&lt;/code&gt;,
@@ -19767,7 +20275,7 @@
    attributes, when parsing, returns no value, it must be treated, for the
    purposes of those requirements, as if it was not specified.
 
-  &lt;p&gt;The &lt;dfn id=width4 title=dom-dim-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn
+  &lt;p&gt;The &lt;dfn id=width5 title=dom-dim-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn
    id=height4 title=dom-dim-height&gt;&lt;code&gt;height&lt;/code&gt;&lt;/dfn&gt; DOM attributes
    on the &lt;code&gt;&lt;a href=&quot;#embed&quot;&gt;embed&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
    href=&quot;#object&quot;&gt;object&lt;/a&gt;&lt;/code&gt;, and &lt;code&gt;&lt;a
@@ -21714,7 +22222,7 @@
            attribute boolean &lt;code title=dom-script-async&gt;&lt;a href=&quot;#async0&quot;&gt;async&lt;/a&gt;&lt;/code&gt;;
            attribute boolean &lt;code title=dom-script-defer&gt;&lt;a href=&quot;#defer0&quot;&gt;defer&lt;/a&gt;&lt;/code&gt;;
            attribute DOMString &lt;code title=dom-script-type&gt;&lt;a href=&quot;#type12&quot;&gt;type&lt;/a&gt;&lt;/code&gt;;
-           attribute DOMString &lt;code title=dom-script-text&gt;&lt;a href=&quot;#text0&quot;&gt;text&lt;/a&gt;&lt;/code&gt;;
+           attribute DOMString &lt;code title=dom-script-text&gt;&lt;a href=&quot;#text1&quot;&gt;text&lt;/a&gt;&lt;/code&gt;;
 };&lt;/pre&gt;
   &lt;/dl&gt;
 
@@ -22022,7 +22530,7 @@
 
   &lt;p&gt;If the script is inline, then, for scripting languages that consist of
    pure text, user agents must use the value of the DOM &lt;code
-   title=dom-script-text&gt;&lt;a href=&quot;#text0&quot;&gt;text&lt;/a&gt;&lt;/code&gt; attribute (defined
+   title=dom-script-text&gt;&lt;a href=&quot;#text1&quot;&gt;text&lt;/a&gt;&lt;/code&gt; attribute (defined
    below) as the script to execute, and for XML-based scripting languages,
    user agents must use all the child nodes of the &lt;code&gt;&lt;a
    href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element as the script to execute.
@@ -22053,7 +22561,7 @@
    href=&quot;#reflect&quot;&gt;reflect&lt;/a&gt; the respective content attributes of the same
    name.
 
-  &lt;p&gt;The DOM attribute &lt;dfn id=text0
+  &lt;p&gt;The DOM attribute &lt;dfn id=text1
    title=dom-script-text&gt;&lt;code&gt;text&lt;/code&gt;&lt;/dfn&gt; must return a concatenation
    of the contents of all the &lt;a href=&quot;#text-node&quot; title=&quot;text node&quot;&gt;text
    nodes&lt;/a&gt; that are direct children of the &lt;code&gt;&lt;a
@@ -27166,7 +27674,7 @@
        protocol, then return a new globally unique identifier.
 
      &lt;li&gt;
-      &lt;p&gt;If the scheme is &quot;&lt;code title=&quot;&quot;&gt;file:&lt;/code&gt;&quot;, then the user agent
+      &lt;p&gt;If the scheme is &quot;&lt;code title=&quot;&quot;&gt;file&lt;/code&gt;&quot;, then the user agent
        may return a UA-specific origin.
 
      &lt;li&gt;
@@ -32071,7 +32579,7 @@
   [XXX] void &lt;a href=&quot;#removeitem&quot; title=dom-Storage-removeItem&gt;removeItem&lt;/a&gt;(in DOMString key); &lt;!-- XXX [[Delete]] DOMB --&gt;
   void &lt;a href=&quot;#clear0&quot; title=dom-Storage-clear&gt;clear&lt;/a&gt;();
 };&lt;/pre&gt;
-  &lt;!-- XXX v2 ideas:
+  &lt;!-- XXXv2 ideas:
     a getInfo() method that returns an object that tells you:
        - when the key was added
        - when the key was last modified
@@ -38985,11 +39493,11 @@
   &lt;p&gt;Void elements can't have any contents (since there's no end tag, no
    content can be put between the start tag and the end tag).
 
-  &lt;p&gt;CDATA elements can have &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt;,
+  &lt;p&gt;CDATA elements can have &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt;,
    though it has &lt;a href=&quot;#cdata-rcdata-restrictions&quot;&gt;restrictions&lt;/a&gt;
    described below.
 
-  &lt;p&gt;RCDATA elements can have &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt; and
+  &lt;p&gt;RCDATA elements can have &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt; and
    &lt;a href=&quot;#character3&quot; title=syntax-entities&gt;character entity
    references&lt;/a&gt;, but the text must not contain an &lt;a href=&quot;#ambiguous&quot;
    title=syntax-ambiguous-ampersand&gt;ambiguous ampersand&lt;/a&gt;. There are also
@@ -38999,7 +39507,7 @@
   &lt;p&gt;Foreign elements whose start tag is marked as self-closing can't have
    any contents (since, again, as there's no end tag, no content can be put
    between the start tag and the end tag). Foreign elements whose start tag
-   is &lt;em&gt;not&lt;/em&gt; marked as self-closing can have &lt;a href=&quot;#text1&quot;
+   is &lt;em&gt;not&lt;/em&gt; marked as self-closing can have &lt;a href=&quot;#text2&quot;
    title=syntax-text&gt;text&lt;/a&gt;, &lt;a href=&quot;#character3&quot;
    title=syntax-entities&gt;character entity references&lt;/a&gt;, &lt;a href=&quot;#cdata0&quot;
    title=syntax-cdata&gt;CDATA blocks&lt;/a&gt;, other &lt;a href=&quot;#elements2&quot;
@@ -39009,7 +39517,7 @@
    href=&quot;#ambiguous&quot; title=syntax-ambiguous-ampersand&gt;ambiguous
    ampersand&lt;/a&gt;.
 
-  &lt;p&gt;Normal elements can have &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt;, &lt;a
+  &lt;p&gt;Normal elements can have &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt;, &lt;a
    href=&quot;#character3&quot; title=syntax-entities&gt;character entity references&lt;/a&gt;,
    other &lt;a href=&quot;#elements2&quot; title=syntax-elements&gt;elements&lt;/a&gt;, and &lt;a
    href=&quot;#comments0&quot; title=syntax-comments&gt;comments&lt;/a&gt;, but the text must
@@ -39105,7 +39613,7 @@
    name; attribute names are case-insensitive.
 
   &lt;p&gt;&lt;dfn id=attribute0 title=syntax-attribute-value&gt;Attribute values&lt;/dfn&gt;
-   are a mixture of &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt; and &lt;a
+   are a mixture of &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt; and &lt;a
    href=&quot;#character3&quot; title=syntax-entities&gt;character entity references&lt;/a&gt;,
    except with the additional restriction that the text cannot contain an &lt;a
    href=&quot;#ambiguous&quot; title=syntax-ambiguous-ampersand&gt;ambiguous
@@ -39438,20 +39946,20 @@
    title=syntax-escape&gt;escaping text span&lt;/a&gt;.
 
   &lt;p&gt;An &lt;dfn id=escaping title=syntax-escape&gt;escaping text span&lt;/dfn&gt; is a
-   span of &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt; that starts with an &lt;a
+   span of &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt; that starts with an &lt;a
    href=&quot;#escaping0&quot; title=syntax-escape-start&gt;escaping text span start&lt;/a&gt;
    that is not itself in an &lt;a href=&quot;#escaping&quot; title=syntax-escape&gt;escaping
    text span&lt;/a&gt;, and ends at the next &lt;a href=&quot;#escaping1&quot;
    title=syntax-escape-end&gt;escaping text span end&lt;/a&gt;.
 
   &lt;p&gt;An &lt;dfn id=escaping0 title=syntax-escape-start&gt;escaping text span
-   start&lt;/dfn&gt; is a part of &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt; that
+   start&lt;/dfn&gt; is a part of &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt; that
    consists of the four character sequence &quot;&lt;code title=&quot;&quot;&gt;&lt;!--&lt;/code&gt;&quot;
    (U+003C LESS-THAN SIGN, U+0021 EXCLAMATION MARK, U+002D HYPHEN-MINUS,
    U+002D HYPHEN-MINUS).
 
   &lt;p&gt;An &lt;dfn id=escaping1 title=syntax-escape-end&gt;escaping text span
-   end&lt;/dfn&gt; is a part of &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt; that
+   end&lt;/dfn&gt; is a part of &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt; that
    consists of the three character sequence &quot;&lt;code title=&quot;&quot;&gt;--&gt;&lt;/code&gt;&quot;
    (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN) whose
    U+003E GREATER-THAN SIGN (&gt;).
@@ -39466,9 +39974,9 @@
    that is not followed by an &lt;a href=&quot;#escaping1&quot;
    title=syntax-escape-end&gt;escaping text span end&lt;/a&gt;.
 
-  &lt;h4 id=text&gt;&lt;span class=secno&gt;8.1.3 &lt;/span&gt;Text&lt;/h4&gt;
+  &lt;h4 id=text0&gt;&lt;span class=secno&gt;8.1.3 &lt;/span&gt;Text&lt;/h4&gt;
 
-  &lt;p&gt;&lt;dfn id=text1 title=syntax-text&gt;Text&lt;/dfn&gt; is allowed inside elements,
+  &lt;p&gt;&lt;dfn id=text2 title=syntax-text&gt;Text&lt;/dfn&gt; is allowed inside elements,
    attributes, and comments. Text must consist of Unicode characters. Text
    must not contain U+0000 characters. Text must not contain permanently
    undefined Unicode characters. Text must not contain control characters
@@ -39485,11 +39993,11 @@
 
   &lt;h4 id=character&gt;&lt;span class=secno&gt;8.1.4 &lt;/span&gt;Character entity references&lt;/h4&gt;
 
-  &lt;p&gt;In certain cases described in other sections, &lt;a href=&quot;#text1&quot;
+  &lt;p&gt;In certain cases described in other sections, &lt;a href=&quot;#text2&quot;
    title=syntax-text&gt;text&lt;/a&gt; may be mixed with &lt;dfn id=character3
    title=syntax-entities&gt;character entity references&lt;/dfn&gt;. These can be used
    to escape characters that couldn't otherwise legally be included in &lt;a
-   href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt;.
+   href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt;.
 
   &lt;p&gt;Character entity references must start with a U+0026 AMPERSAND
    (&lt;code&gt;&amp;&lt;/code&gt;). Following this, there are three possible kinds of
@@ -39529,7 +40037,7 @@
 
   &lt;p&gt;An &lt;dfn id=ambiguous title=syntax-ambiguous-ampersand&gt;ambiguous
    ampersand&lt;/dfn&gt; is a U+0026 AMPERSAND (&lt;code&gt;&amp;&lt;/code&gt;) character that
-   is followed by some &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt; other than
+   is followed by some &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt; other than
    a &lt;a href=&quot;#space&quot;&gt;space character&lt;/a&gt;, a U+003C LESS-THAN SIGN character
    ('&lt;'), or another U+0026 AMPERSAND (&lt;code&gt;&amp;&lt;/code&gt;) character.
 
@@ -39541,7 +40049,7 @@
    LETTER D, U+0041 LATIN CAPITAL LETTER A, U+0054 LATIN CAPITAL LETTER T,
    U+0041 LATIN CAPITAL LETTER A, U+005B LEFT SQUARE BRACKET (&lt;code
    title=&quot;&quot;&gt;&lt;![CDATA[&lt;/code&gt;). Following this sequence, the block may have
-   &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt;, with the additional
+   &lt;a href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt;, with the additional
    restriction that the text must not contain the three character sequence
    U+005D RIGHT SQUARE BRACKET, U+005D RIGHT SQUARE BRACKET, U+003E
    GREATER-THAN SIGN (&lt;code title=&quot;&quot;&gt;]]&gt;&lt;/code&gt;). Finally, the CDATA block
@@ -39555,7 +40063,7 @@
    the four character sequence U+003C LESS-THAN SIGN, U+0021 EXCLAMATION
    MARK, U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS (&lt;code
    title=&quot;&quot;&gt;&lt;!--&lt;/code&gt;). Following this sequence, the comment may have &lt;a
-   href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt;, with the additional restriction
+   href=&quot;#text2&quot; title=syntax-text&gt;text&lt;/a&gt;, with the additional restriction
    that the text must not start with a single U+003E GREATER-THAN SIGN
    ('&gt;') character, nor start with a U+002D HYPHEN-MINUS (&lt;code
    title=&quot;&quot;&gt;-&lt;/code&gt;) character followed by a U+003E GREATER-THAN SIGN
@@ -48870,7 +49378,7 @@
 
   &lt;pre
    class=idl&gt;[XXX] interface &lt;a href=&quot;#htmlbodyelement&quot;&gt;HTMLBodyElement&lt;/a&gt; {
-           attribute DOMString &lt;a href=&quot;#text2&quot; title=dom-body-text&gt;text&lt;/a&gt;;
+           attribute DOMString &lt;a href=&quot;#text3&quot; title=dom-body-text&gt;text&lt;/a&gt;;
            attribute DOMString &lt;a href=&quot;#bgcolor0&quot; title=dom-body-bgColor&gt;bgColor&lt;/a&gt;;
            attribute DOMString &lt;a href=&quot;#background&quot; title=dom-body-background&gt;background&lt;/a&gt;;
            attribute DOMString &lt;a href=&quot;#link0&quot; title=dom-body-link&gt;link&lt;/a&gt;;
@@ -48878,7 +49386,7 @@
            attribute DOMString &lt;a href=&quot;#alink&quot; title=dom-body-aLink&gt;aLink&lt;/a&gt;;
 };&lt;/pre&gt;
 
-  &lt;p&gt;The &lt;dfn id=text2 title=dom-body-text&gt;&lt;code&gt;text&lt;/code&gt;&lt;/dfn&gt; DOM
+  &lt;p&gt;The &lt;dfn id=text3 title=dom-body-text&gt;&lt;code&gt;text&lt;/code&gt;&lt;/dfn&gt; DOM
    attribute of the &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; element must &lt;a
    href=&quot;#reflect&quot;&gt;reflect&lt;/a&gt; the element's &lt;code
    title=attr-body-text&gt;text&lt;/code&gt; content attribute.
@@ -49085,26 +49593,28 @@
    Laurens Holst, Leif Halvard Silli, Lenny Domnitser, L&eacute;onard
    Bouchet, Leons Petrazickis, Logan&lt;!-- on
   moz irc --&gt;, Loune, Maciej
-   Stachowiak, Malcolm Rowe, Mark Nottingham, Mark Rowe&lt;!--bdash--&gt;, Mark
-   Schenk, Martijn Wargers, Martin Atkins, Martin D&uuml;rst, Martin Honnen,
-   Mathieu Henri, Matthew Mastracci, Matthew Raymond, Matthew Thomas, Mattias
-   Waldau, Max Romantschuk, Michael 'Ratt' Iannarelli, Michael A. Nachbaur,
-   Michael A. Puls II&lt;!--Shadow2531--&gt;, Michael Carter, Michael Gratton,
-   Michael Powers, Michael Smith, Michel Fortin, Michiel van der Blonk, Mihai
-   &amp;#x015E;ucan&lt;!-- from ROBO Design --&gt;, Mike Brown, Mike
-   Dierken&lt;!-- S. Mike Dierken --&gt;, Mike Dixon, Mike Schinkel, Mike Shaver,
-   Mike Smith, Mikko Rantalainen, Neil Deakin, Neil Soiffer, Olav Junker
-   Kj&aelig;r, Oliver Hunt, Peter Kasting, Philip Taylor, Philip
-   TAYLOR&lt;!-- a different one --&gt;, Rachid Finge, Rajas Moonka, Ralf Stoltze,
-   Ralph Giles, Raphael Champeimont, Rene Saarsoo, Richard Ishida, Rimantas
-   Liubertas, Robert O'Callahan, Robert Sayre, Roman Ivanov, S. Mike Dierken,
-   Sam Ruby, Sam Weinig, Scott Hess, Sean Knapp, Shaun Inman, Silvia
-   Pfeiffer, Simon Pieters, Stefan Haustein, Stephen Ma, Steve Faulkner,
-   Steve Runyon, Steven Garrity, Stewart Brodie, Stuart Parmenter, Sunava
-   Dutta, Tantek &Ccedil;elik, Terrence Wood, Thomas Broyer, Thomas O'Connor,
-   Tim Altman, Tyler Close, Vladimir Vuki&amp;#x0107;evi&amp;#x0107;, Wakaba, Wayne
-   Pollock, William Swanson, and &Oslash;istein E. Andersen, for their useful
-   and substantial comments.
+   Stachowiak, Magnus Kristiansen&lt;!--
+  Dashiva --&gt;, Malcolm Rowe, Mark
+   Nottingham, Mark Rowe&lt;!--bdash--&gt;, Mark Schenk, Martijn Wargers, Martin
+   Atkins, Martin D&uuml;rst, Martin Honnen, Masataka Yakura, Mathieu Henri,
+   Matthew Mastracci, Matthew Raymond, Matthew Thomas, Mattias Waldau, Max
+   Romantschuk, Michael 'Ratt' Iannarelli, Michael A. Nachbaur, Michael A.
+   Puls II&lt;!--Shadow2531--&gt;, Michael Carter, Michael Gratton, Michael Powers,
+   Michael Smith, Michel Fortin, Michiel van der Blonk, Mihai
+   &amp;#x015E;ucan&lt;!-- from ROBO Design --&gt;, Mike Brown, Mike Dierken&lt;!--
+  S. Mike Dierken --&gt;,
+   Mike Dixon, Mike Schinkel, Mike Shaver, Mike Smith, Mikko Rantalainen,
+   Neil Deakin, Neil Soiffer, Olav Junker Kj&aelig;r, Oliver Hunt, Peter
+   Kasting, Philip Taylor, Philip TAYLOR&lt;!-- a different one --&gt;, Rachid
+   Finge, Rajas Moonka, Ralf Stoltze, Ralph Giles, Raphael Champeimont, Rene
+   Saarsoo, Richard Ishida, Rimantas Liubertas, Robert O'Callahan, Robert
+   Sayre, Roman Ivanov, S. Mike Dierken, Sam Ruby, Sam Weinig, Scott Hess,
+   Sean Knapp, Shaun Inman, Silvia Pfeiffer, Simon Pieters, Stefan Haustein,
+   Stephen Ma, Steve Faulkner, Steve Runyon, Steven Garrity, Stewart Brodie,
+   Stuart Parmenter, Sunava Dutta, Tantek &Ccedil;elik, Terrence Wood, Thomas
+   Broyer, Thomas O'Connor, Tim Altman, Tyler Close, Vladimir
+   Vuki&amp;#x0107;evi&amp;#x0107;, Wakaba, Wayne Pollock, William Swanson, and
+   &Oslash;istein E. Andersen, for their useful and substantial comments.
 
   &lt;p&gt;Thanks also to everyone who has ever posted about HTML5 to their blogs,
    public mailing lists, or forums, including the &lt;a

Modified: source
===================================================================
--- source	2008-04-30 21:59:01 UTC (rev 1518)
+++ source	2008-05-06 01:09:48 UTC (rev 1519)
@@ -654,7 +654,8 @@
   property&quot; for the purposes of determining the computed value of the
   &lt;code title=&quot;&quot;&gt;currentColor&lt;/code&gt; keyword is the computed value of
   the 'color' property on the element in question. &lt;a
-  href=&quot;#refsCSS3COLOR&quot;&gt;[CSS3COLOR]&lt;/a&gt;&lt;/p&gt;
+  href=&quot;#refsCSS3COLOR&quot;&gt;[CSS3COLOR]&lt;/a&gt;&lt;/p&gt; &lt;!-- XXX what if that
+  element has no computed value? e.g. if it is not in a document? --&gt;
 
   &lt;p class=&quot;example&quot;&gt;If a canvas gradient's &lt;code
   title=&quot;dom-canvasgradient-addColorStop&quot;&gt;addColorStop()&lt;/code&gt; method
@@ -5081,7 +5082,7 @@
   &lt;p&gt;The processing of this attribute depends on the presentation
   layer. For example, CSS 2.1 defines a mapping from this attribute to
   the CSS 'direction' and 'unicode-bidi' properties, and defines
-  rendering in terms of those properties.&lt;/p&gt;
+  rendering in terms of those properties.&lt;/p&gt;&lt;!-- XXXDIR --&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-dir&quot;&gt;&lt;code&gt;dir&lt;/code&gt;&lt;/dfn&gt; DOM attribute on
   an element must &lt;span&gt;reflect&lt;/span&gt; the &lt;code
@@ -12817,7 +12818,7 @@
   title=&quot;media element&quot;&gt;media elements&lt;/span&gt;. They are defined in
   this section.&lt;/p&gt;
 
-  &lt;!-- XXX v3 features:
+  &lt;!-- XXXv3 features:
     * frame forward / backwards / step(n) while paused
     * hasAudio, hasVideo, hasCaptions, etc
     * per-frame control: get current frame; set current frame
@@ -14982,7 +14983,7 @@
   void &lt;span title=&quot;dom-context-2d-transform&quot;&gt;transform&lt;/span&gt;(in float m11, in float m12, in float m21, in float m22, in float dx, in float dy);
   void &lt;span title=&quot;dom-context-2d-setTransform&quot;&gt;setTransform&lt;/span&gt;(in float m11, in float m12, in float m21, in float m22, in float dx, in float dy);
 &lt;!--
-  // XXXv3 we've also received requests for:
+  // XXXv4 we've also received requests for:
   void skew(...);
   void reflect(...); // or mirror(...)
 --&gt;
@@ -15030,6 +15031,20 @@
   void &lt;span title=&quot;dom-context-2d-clip&quot;&gt;clip&lt;/span&gt;();
   boolean &lt;span title=&quot;dom-context-2d-isPointInPath&quot;&gt;isPointInPath&lt;/span&gt;(in float x, in float y);
 
+  // text
+           attribute DOMString &lt;span title=&quot;dom-context-2d-font&quot;&gt;font&lt;/span&gt;; // (default 8px sans-serif)
+           attribute DOMString &lt;span title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/span&gt;; // &quot;start&quot;, &quot;end&quot;, &quot;left&quot;, &quot;right&quot;, &quot;center&quot; (default: &quot;start&quot;)
+           attribute DOMString &lt;span title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/span&gt;; // &quot;top&quot;, &quot;hanging&quot;, &quot;middle&quot;, &quot;alphabetic&quot;, &quot;ideographic&quot;, &quot;bottom&quot; (default: &quot;alphabetic&quot;)
+  void &lt;span title=&quot;dom-context-2d-fillText&quot;&gt;fillText&lt;/span&gt;(in DOMString text, in float x, in float y);
+  void &lt;span title=&quot;dom-context-2d-fillText&quot;&gt;fillText&lt;/span&gt;(in DOMString text, in float x, in float y, in float maxWidth);
+  void &lt;span title=&quot;dom-context-2d-strokeText&quot;&gt;strokeText&lt;/span&gt;(in DOMString text, in float x, in float y);
+  void &lt;span title=&quot;dom-context-2d-strokeText&quot;&gt;strokeText&lt;/span&gt;(in DOMString text, in float x, in float y, in float maxWidth);&lt;!-- XXXDVT
+  void &lt;span title=&quot;dom-context-2d-fillVerticalText&quot;&gt;fillVerticalText&lt;/span&gt;(in DOMString text, in float x, in float y);
+  void &lt;span title=&quot;dom-context-2d-fillVerticalText&quot;&gt;fillVerticalText&lt;/span&gt;(in DOMString text, in float x, in float y, in float maxHeight);
+  void &lt;span title=&quot;dom-context-2d-strokeVerticalText&quot;&gt;strokeVerticalText&lt;/span&gt;(in DOMString text, in float x, in float y);
+  void &lt;span title=&quot;dom-context-2d-strokeVerticalText&quot;&gt;strokeVerticalText&lt;/span&gt;(in DOMString text, in float x, in float y, in float maxHeight); --&gt;
+  &lt;span&gt;TextMetrics&lt;/span&gt; &lt;span title=&quot;dom-context-2d-measureText&quot;&gt;measureText&lt;/span&gt;(in DOMString text);
+
   // drawing images
   void &lt;span title=&quot;dom-context-2d-drawImage&quot;&gt;drawImage&lt;/span&gt;(in &lt;span&gt;HTMLImageElement&lt;/span&gt; image, in float dx, in float dy);
   void &lt;span title=&quot;dom-context-2d-drawImage&quot;&gt;drawImage&lt;/span&gt;(in &lt;span&gt;HTMLImageElement&lt;/span&gt; image, in float dx, in float dy, in float dw, in float dh);
@@ -15043,11 +15058,6 @@
   &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData&lt;/span&gt;(in float sx, in float sy, in float sw, in float sh);
   void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy);
   void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy, in float dirtyX, in float dirtyY, in float dirtyWidth, in float dirtyHeight);
-
-  // drawing text is not supported in this version of the API
-  // (there is no way to predict what metrics the fonts will have,
-  // which makes fonts very hard to use for painting)
-
 };
 
 interface &lt;dfn&gt;CanvasGradient&lt;/dfn&gt; {
@@ -15059,6 +15069,10 @@
   // opaque object
 };
 
+interface &lt;dfn&gt;TextMetrics&lt;/dfn&gt; {
+  readonly attribute float &lt;span title=&quot;dom-textmetrics-width&quot;&gt;width&lt;/span&gt;;
+};
+
 interface &lt;dfn&gt;ImageData&lt;/dfn&gt; {
   readonly attribute long int &lt;span title=&quot;dom-imagedata-width&quot;&gt;width&lt;/span&gt;;
   readonly attribute long int &lt;span title=&quot;dom-imagedata-height&quot;&gt;height&lt;/span&gt;;
@@ -15109,7 +15123,10 @@
    title=&quot;dom-context-2d-shadowOffsetY&quot;&gt;shadowOffsetY&lt;/code&gt;, &lt;code
    title=&quot;dom-context-2d-shadowBlur&quot;&gt;shadowBlur&lt;/code&gt;, &lt;code
    title=&quot;dom-context-2d-shadowColor&quot;&gt;shadowColor&lt;/code&gt;, &lt;code
-   title=&quot;dom-context-2d-globalCompositeOperation&quot;&gt;globalCompositeOperation&lt;/code&gt;.&lt;/li&gt;
+   title=&quot;dom-context-2d-globalCompositeOperation&quot;&gt;globalCompositeOperation&lt;/code&gt;, &lt;code
+   title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt;, &lt;code
+   title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt;, &lt;code
+   title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt;.&lt;/li&gt;
   &lt;/ul&gt;
 
   &lt;p class=&quot;note&quot;&gt;The current path and the current bitmap are not part
@@ -15129,7 +15146,7 @@
   drawing state it describes. If there is no saved state, the method
   must do nothing.&lt;/p&gt;
 
-  &lt;!-- XXXv3
+  &lt;!-- XXXv4
 idea from Mihai:
 &gt; 5. Drawing states should be saveable with IDs, and for easier restoring.
 &gt;
@@ -15655,7 +15672,7 @@
   return null.&lt;/p&gt;
 
   &lt;!--
-   XXXv3 Requests for v3 features:
+   XXXv4 Requests for v4 features:
     * apply transforms to patterns, so you don't have to create
       transformed patterns manually by rendering them to an off-screen
       canvas then using that canvas as the pattern.
@@ -15767,7 +15784,7 @@
   anyone complains, we'll have to add it --&gt;
 
   &lt;!--
-XXXv3 dashed lines have been requested.  Philip Taylor provides these
+XXXv4 dashed lines have been requested.  Philip Taylor provides these
 notes on what would need to be defined for dashed lines:
 &gt; I don't think it's entirely trivial to add, to the detail that's
 &gt; necessary in a specification. The common graphics APIs (at least
@@ -16219,7 +16236,7 @@
   to the rectangle with the top left corner at (0,0) and the width and
   height of the coordinate space.&lt;/p&gt;
 
-  &lt;!-- XXXv3
+  &lt;!-- XXXv4
    Jordan OSETE suggests:
     * support ways of extending the clipping region (union instead of intersection)
        - also &quot;add&quot;, &quot;substract&quot;, &quot;replace&quot;, &quot;intersect&quot; and &quot;xor&quot;
@@ -16239,7 +16256,494 @@
   must return false.&lt;/p&gt;
 
 
+  &lt;h6&gt;Text&lt;/h6&gt; &lt;!-- a v3 feature --&gt;
 
+  &lt;p&gt;The &lt;dfn title=&quot;dom-context-2d-font&quot;&gt;&lt;code&gt;font&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute, on setting, must be parsed the same way as the 'font'
+  property of CSS (but without supporting property-global stylesheet
+  syntax like 'inherit'), and the resulting font must be assigned to
+  the context, with the 'line-height' component forced to 'normal'. &lt;a
+  href=&quot;#refsCSS&quot;&gt;[CSS]&lt;/a&gt;&lt;!-- XXX generic version-independent
+  reference --&gt;&lt;/p&gt;
+
+  &lt;p&gt;On getting, the &lt;code title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt;
+  attribute must return the serialised form of the current font of the
+  context. &lt;a href=&quot;#refsCSSOM&quot;&gt;[CSSOM]&lt;/a&gt;&lt;!-- XXX ensure that this
+  defines serialisation of 'font' --&gt;&lt;/p&gt;
+
+  &lt;p&gt;When the context is created, the font of the context must be set
+  to 10px sans-serif. When the 'font-size' component is set to lengths
+  using percentages, 'em' or 'ex' units, or the 'larger' or 'smaller'
+  keywords, these must be interpreted relative to the computed value
+  of the 'font-size' property of the corresponding &lt;code&gt;canvas&lt;/code&gt;
+  element. When the 'font-weight' component is set to the relative
+  values 'bolder' and 'lighter', these must be interpreted relative to
+  the computed value of the 'font-weight' property of the
+  corresponding &lt;code&gt;canvas&lt;/code&gt; element.&lt;/p&gt; &lt;!-- XXX what if that
+  element has no computed value? e.g. if it is not in a document? --&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-context-2d-textAlign&quot;&gt;&lt;code&gt;textAlign&lt;/code&gt;&lt;/dfn&gt; DOM
+  attribute, on getting, must return the current value. On setting, if
+  the value is one of &lt;code title=&quot;&quot;&gt;start&lt;/code&gt;, &lt;code
+  title=&quot;&quot;&gt;end&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;left&lt;/code&gt;, &lt;code
+  title=&quot;&quot;&gt;right&lt;/code&gt;, or &lt;code title=&quot;&quot;&gt;center&lt;/code&gt;, then the
+  value must be changed to the new value. Otherwise, the new value
+  must be ignored. When the context is created, the &lt;code
+  title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; attribute must
+  initially have the value &lt;code title=&quot;&quot;&gt;start&lt;/code&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-context-2d-textBaseline&quot;&gt;&lt;code&gt;textBaseline&lt;/code&gt;&lt;/dfn&gt;
+  DOM attribute, on getting, must return the current value. On
+  setting, if the value is one of &lt;code
+  title=&quot;dom-context-2d-textBaseline-top&quot;&gt;top&lt;/code&gt;, &lt;code
+  title=&quot;dom-context-2d-textBaseline-hanging&quot;&gt;hanging&lt;/code&gt;, &lt;code
+  title=&quot;dom-context-2d-textBaseline-middle&quot;&gt;middle&lt;/code&gt;, &lt;code
+  title=&quot;dom-context-2d-textBaseline-alphabetic&quot;&gt;alphabetic&lt;/code&gt;,
+  &lt;code
+  title=&quot;dom-context-2d-textBaseline-ideographic&quot;&gt;ideographic&lt;/code&gt;,
+  or &lt;code title=&quot;dom-context-2d-textBaseline-bottom&quot;&gt;bottom&lt;/code&gt;,
+  then the value must be changed to the new value. Otherwise, the new
+  value must be ignored. When the context is created, the &lt;code
+  title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt; attribute
+  must initially have the value &lt;code title=&quot;&quot;&gt;alphabetic&lt;/code&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt;
+  attribute's allowed keywords correspond to alignment points in the
+  font:&lt;/p&gt;
+
+  &lt;p&gt;&lt;img src=&quot;images/baselines.png&quot; alt=&quot;The top of the em square is
+  roughly at the top of the glyphs in a font, the hanging baseline is
+  where some glyphs like &amp;#x0906; are anchored, the middle is half-way
+  between the top of the em square and the bottom of the em square,
+  the alphabetic baseline is where characters like &amp;#x00C1;, &amp;#x00FF;,
+  &amp;#x0066;, and &amp;#x03A9; are anchored, the ideographic baseline is
+  where glyphs like &amp;#x79C1; and &amp;#x9054; are anchored, and the bottom
+  of the em square is roughly at the bottom of the glyphs in a
+  font. The top and bottom of the bounding box can be far from these
+  baselines, due to glyphs extending far outside the em square.&quot;&gt;&lt;/p&gt;
+
+  &lt;p&gt;The keywords map to these alignment points as follows:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-context-2d-textBaseline-top&quot;&gt;&lt;code&gt;top&lt;/code&gt;&lt;/dfn&gt;
+   &lt;dd&gt;The top of the em square&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-context-2d-textBaseline-hanging&quot;&gt;&lt;code&gt;hanging&lt;/code&gt;&lt;/dfn&gt;
+   &lt;dd&gt;The hanging baseline&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-context-2d-textBaseline-middle&quot;&gt;&lt;code&gt;middle&lt;/code&gt;&lt;/dfn&gt;
+   &lt;dd&gt;The middle of the em square&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-context-2d-textBaseline-alphabetic&quot;&gt;&lt;code&gt;alphabetic&lt;/code&gt;&lt;/dfn&gt;
+   &lt;dd&gt;The alphabetic baseline&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-context-2d-textBaseline-ideographic&quot;&gt;&lt;code&gt;ideographic&lt;/code&gt;&lt;/dfn&gt;
+   &lt;dd&gt;The ideographic baseline&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-context-2d-textBaseline-bottom&quot;&gt;&lt;code&gt;bottom&lt;/code&gt;&lt;/dfn&gt;
+   &lt;dd&gt;The bottom of the em square&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-context-2d-fillText&quot;&gt;&lt;code&gt;fillText()&lt;/code&gt;&lt;/dfn&gt; and
+  &lt;dfn
+  title=&quot;dom-context-2d-strokeText&quot;&gt;&lt;code&gt;strokeText()&lt;/code&gt;&lt;/dfn&gt;
+  methods take three or four arguments, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;, and optionally &lt;var
+  title=&quot;&quot;&gt;maxWidth&lt;/var&gt;, and render the given &lt;var
+  title=&quot;&quot;&gt;text&lt;/var&gt; at the given (&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;y&lt;/var&gt;) coordinates ensuring that the text isn't wider
+  than &lt;var title=&quot;&quot;&gt;maxWidth&lt;/var&gt; if specified, using the current
+  &lt;code title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt;, &lt;code
+  title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt;, and &lt;code
+  title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt;
+  values. Specifically, when the methods are called, the user agent
+  must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;font&lt;/var&gt; be the current font of the
+   browsing context, as given by the &lt;code
+   title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt; attribute.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Replace all the &lt;span title=&quot;space character&quot;&gt;space
+   characters&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; with U+0020 SPACE
+   characters.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Form a hypothetical infinitely wide CSS line box containing
+   a single inline box containing the text &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;,
+   with all the properties at their initial values except the 'font'
+   property of the inline element set to &lt;var title=&quot;&quot;&gt;font&lt;/var&gt; and
+   the 'direction' property of the inline element set to the
+   'direction' property of the &lt;code&gt;canvas&lt;/code&gt; element. &lt;a
+   href=&quot;#refsCSS&quot;&gt;[CSS]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;!-- XXXDIR somehow mention
+   somewhere that if you don't support CSS, dir=&quot;&quot; still maps to
+   'direction' for the purposes of things like this. --&gt;
+
+   &lt;!-- if you insert a step here, make sure to adjust the next step's
+   final words --&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;maxWidth&lt;/var&gt; argument was specified
+   and the hypothetical width of the inline box in the hypothetical
+   line box is greater than &lt;var title=&quot;&quot;&gt;maxWidth&lt;/var&gt; CSS pixels,
+   then change &lt;var title=&quot;&quot;&gt;font&lt;/var&gt; to have a more condensed font
+   (if one is available or if a reasonably readable one can be
+   synthesised by applying a horizontal scale factor to the font) or a
+   smaller font, and return to the previous step.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt; be a point on the
+    inline box, determined by the &lt;code
+    title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; and &lt;code
+    title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt; values, as
+    follows:&lt;/p&gt;
+
+    &lt;p&gt;Horizontal position:&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;left&lt;/code&gt;&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;start&lt;/code&gt; and the 'direction'&lt;!--XXXDIR--&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'ltr'&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;end&lt;/code&gt; and the 'direction'&lt;!--XXXDIR--&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'rtl'&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s horizontal
+     position be the left edge of the inline box.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;right&lt;/code&gt;&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;end&lt;/code&gt; and the 'direction'&lt;!--XXXDIR--&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'ltr'&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;start&lt;/code&gt; and the 'direction'&lt;!--XXXDIR--&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'rtl'&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s horizontal
+     position be the right edge of the inline box.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;center&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s horizontal
+     position be half way between the left and right edges of the
+     inline box.&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+    &lt;p&gt;Vertical position:&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt; is &lt;code
+     title=&quot;dom-context-2d-textBaseline-top&quot;&gt;top&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position
+     be the top of the em box of the first available font of the
+     inline box.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt; is &lt;code
+     title=&quot;dom-context-2d-textBaseline-hanging&quot;&gt;hanging&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position
+     be the hanging baseline of the first available font of the inline
+     box.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt; is &lt;code
+     title=&quot;dom-context-2d-textBaseline-middle&quot;&gt;middle&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position
+     be half way between the bottom and the top of the em box of the
+     first available font of the inline box.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt; is &lt;code
+     title=&quot;dom-context-2d-textBaseline-alphabetic&quot;&gt;alphabetic&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position
+     be the alphabetic baseline of the first available font of the inline
+     box.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt; is &lt;code
+     title=&quot;dom-context-2d-textBaseline-ideographic&quot;&gt;ideographic&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position
+     be the ideographic baseline of the first available font of the inline
+     box.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textBaseline&quot;&gt;textBaseline&lt;/code&gt; is &lt;code
+     title=&quot;dom-context-2d-textBaseline-bottom&quot;&gt;bottom&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position
+     be the bottom of the em box of the first available font of the
+     inline box.&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Paint the hypothetical inline box as the shape given by the
+    text's glyphs, as transformed by the &lt;span
+    title=&quot;dom-context-2d-transformation&quot;&gt;current transformation
+    matrix&lt;/span&gt;, and anchored and sized so that before applying the
+    &lt;span title=&quot;dom-context-2d-transformation&quot;&gt;current transformation
+    matrix&lt;/span&gt;, the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt; is at (&lt;var
+    title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;) and each CSS pixel is
+    mapped to one coordinate space unit.&lt;/p&gt;
+
+    &lt;p&gt;For &lt;code title=&quot;dom-context-2d-fillText&quot;&gt;fillText()&lt;/code&gt;
+    &lt;code title=&quot;dom-context-2d-fillStyle&quot;&gt;fillStyle&lt;/code&gt; must be
+    applied and &lt;code
+    title=&quot;dom-context-2d-strokeStyle&quot;&gt;strokeStyle&lt;/code&gt; must be
+    ignored. For &lt;code
+    title=&quot;dom-context-2d-strokeText&quot;&gt;strokeText()&lt;/code&gt; the reverse
+    holds and &lt;code
+    title=&quot;dom-context-2d-strokeStyle&quot;&gt;strokeStyle&lt;/code&gt; must be
+    applied and &lt;code
+    title=&quot;dom-context-2d-fillStyle&quot;&gt;fillStyle&lt;/code&gt; must be
+    ignored.&lt;/p&gt;
+
+    &lt;p&gt;Text is painted without affecting the current path, and is
+    subject to &lt;span title=&quot;shadows&quot;&gt;shadow effects&lt;/span&gt;, &lt;span
+    title=&quot;dom-context-2d-globalAlpha&quot;&gt;global alpha&lt;/span&gt;, the &lt;span
+    title=&quot;clipping region&quot;&gt;clipping region&lt;/span&gt;, and &lt;span
+    title=&quot;dom-context-2d-globalCompositeOperation&quot;&gt;global composition
+    operators&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+&lt;!--XXXDVT - this is commented out until CSS can get its act together
+enough to actual specify vertical text rendering (how long have we
+been waiting now?)
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-context-2d-fillVerticalText&quot;&gt;&lt;code&gt;fillVerticalText()&lt;/code&gt;&lt;/dfn&gt;
+  and &lt;dfn
+  title=&quot;dom-context-2d-strokeVerticalText&quot;&gt;&lt;code&gt;strokeVerticalText()&lt;/code&gt;&lt;/dfn&gt;
+  methods take three or four arguments, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;, and optionally &lt;var
+  title=&quot;&quot;&gt;maxHeight&lt;/var&gt;, and render the given &lt;var
+  title=&quot;&quot;&gt;text&lt;/var&gt; as vertical text at the given (&lt;var
+  title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;) coordinates ensuring that
+  the text isn't taller than &lt;var title=&quot;&quot;&gt;maxHeight&lt;/var&gt; if
+  specified, using the current &lt;code
+  title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt; and &lt;code
+  title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt;
+  values. Specifically, when the methods are called, the user agent
+  must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;font&lt;/var&gt; be the current font of the
+   browsing context, as given by the &lt;code
+   title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt; attribute.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Replace all the &lt;span title=&quot;space character&quot;&gt;space
+   characters&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; with U+0020 SPACE
+   characters.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Form a &lt;em class=&quot;big-issue&quot;&gt;whatever CSS ends up calling
+   vertical line boxes and inline boxes&lt;/em&gt; containing the text &lt;var
+   title=&quot;&quot;&gt;text&lt;/var&gt;, with all the properties at their initial
+   values except the 'font' property of the inline element set to &lt;var
+   title=&quot;&quot;&gt;font&lt;/var&gt; and the 'direction' property of the inline
+   element set to the 'direction' property of the &lt;code&gt;canvas&lt;/code&gt;
+   element.&lt;/p&gt;&lt;/li&gt;&lt;!- - XXXDIR - -&gt;
+
+   &lt;!- - if you insert a step here, make sure to adjust the next step's
+   final words - -&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;maxHeight&lt;/var&gt; argument was specified
+   and the hypothetical height of the &lt;em class=&quot;big-issue&quot;&gt;box&lt;/em&gt;
+   in the hypothetical line box is greater than &lt;var
+   title=&quot;&quot;&gt;maxHeight&lt;/var&gt; CSS pixels, then change &lt;var
+   title=&quot;&quot;&gt;font&lt;/var&gt; to have a more condensed font (if one is
+   available or if a reasonably readable one can be synthesised by
+   applying an appropriate scale factor to the font) or a smaller
+   font, and return to the previous step.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt; be a point on the &lt;em
+    class=&quot;big-issue&quot;&gt;inline box&lt;/var&gt;, determined by the &lt;code
+    title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt;, as follows:&lt;/p&gt;
+
+    &lt;p&gt;Vertical position:&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;start&lt;/code&gt;&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;left&lt;/code&gt; and the 'direction'&lt;!- -XXXDIR- -&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'ltr'&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;right&lt;/code&gt; and the 'direction'&lt;!- -XXXDIR- -&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'rtl'&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical
+     position be the top edge of the &lt;em class=&quot;big-issue&quot;&gt;inline
+     box&lt;/em&gt;.&lt;/dd&gt;
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;end&lt;/code&gt;&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;right&lt;/code&gt; and the 'direction'&lt;!- -XXXDIR- -&gt; property
+     on the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'ltr'&lt;/dt&gt;
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;left&lt;/code&gt; and the 'direction'&lt;!- -XXXDIR- -&gt; property on
+     the &lt;code&gt;canvas&lt;/code&gt; element has a computed value of
+     'rtl'&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical
+     position be the bottom edge of the &lt;em class=&quot;big-issue&quot;&gt;inline
+     box&lt;/em&gt;.&lt;/dd&gt;
+
+
+     &lt;dt&gt; If &lt;code
+     title=&quot;dom-context-2d-textAlign&quot;&gt;textAlign&lt;/code&gt; is &lt;code
+     title=&quot;&quot;&gt;center&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Let the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt;'s vertical position
+     be half way between the top and bottom edges of the &lt;em
+     class=&quot;big-issue&quot;&gt;inline box&lt;/em&gt;.&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+    &lt;p&gt;Let the horizontal position be half way between the left and
+    right edges of the em box of the first available font of the &lt;em
+    class=&quot;big-issue&quot;&gt;inline box&lt;/em&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Paint the hypothetical inline box as the shape given by the
+    text's glyphs, as transformed by the &lt;span
+    title=&quot;dom-context-2d-transformation&quot;&gt;current transformation
+    matrix&lt;/span&gt;, and anchored and sized so that before applying the
+    &lt;span title=&quot;dom-context-2d-transformation&quot;&gt;current transformation
+    matrix&lt;/span&gt;, the &lt;var title=&quot;&quot;&gt;anchor point&lt;/var&gt; is at (&lt;var
+    title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;) and each CSS pixel is
+    mapped to one coordinate space unit.&lt;/p&gt;
+
+    &lt;p&gt;For &lt;code
+    title=&quot;dom-context-2d-fillVerticalText&quot;&gt;fillVerticalText()&lt;/code&gt;
+    &lt;code title=&quot;dom-context-2d-fillStyle&quot;&gt;fillStyle&lt;/code&gt; must be
+    applied and &lt;code
+    title=&quot;dom-context-2d-strokeStyle&quot;&gt;strokeStyle&lt;/code&gt; must be
+    ignored. For &lt;code
+    title=&quot;dom-context-2d-strokeVerticalText&quot;&gt;strokeVerticalText()&lt;/code&gt;
+    the reverse holds and &lt;code
+    title=&quot;dom-context-2d-strokeStyle&quot;&gt;strokeStyle&lt;/code&gt; must be
+    applied and &lt;code
+    title=&quot;dom-context-2d-fillStyle&quot;&gt;fillStyle&lt;/code&gt; must be
+    ignored.&lt;/p&gt;
+
+    &lt;p&gt;Text is painted without affecting the current path, and is
+    subject to &lt;span title=&quot;shadows&quot;&gt;shadow effects&lt;/span&gt;, &lt;span
+    title=&quot;dom-context-2d-globalAlpha&quot;&gt;global alpha&lt;/span&gt;, the &lt;span
+    title=&quot;clipping region&quot;&gt;clipping region&lt;/span&gt;, and &lt;span
+    title=&quot;dom-context-2d-globalCompositeOperation&quot;&gt;global composition
+    operators&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+XXXDVT (also check for '- -' bits in the part above) --&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-context-2d-measureText&quot;&gt;&lt;code&gt;measureText()&lt;/code&gt;&lt;/dfn&gt;
+  method takes one argument, &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;. When the method
+  is invoked, the user agent must replace all the &lt;span title=&quot;space
+  character&quot;&gt;space characters&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;text&lt;/var&gt; with
+  U+0020 SPACE characters, and then must form a hypothetical
+  infinitely wide CSS line box containing a single inline box
+  containing the text &lt;var title=&quot;&quot;&gt;text&lt;/var&gt;, with all the
+  properties at their initial values except the 'font' property of the
+  inline element set to the current font of the browsing context, as
+  given by the &lt;code title=&quot;dom-context-2d-font&quot;&gt;font&lt;/code&gt;
+  attribute, and must then return a new &lt;code&gt;TextMetrics&lt;/code&gt;
+  object with its &lt;code title=&quot;dom-textmetrics-width&quot;&gt;width&lt;/code&gt;
+  attribute set to the width of that inline box, in CSS pixels. &lt;a
+  href=&quot;#refsCSS&quot;&gt;[CSS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;code&gt;TextMetrics&lt;/code&gt; interface is used for the objects
+  returned from &lt;code
+  title=&quot;dom-context-2d-measureText&quot;&gt;measureText()&lt;/code&gt;. It has one
+  attribute, &lt;dfn
+  title=&quot;dom-textmetrics-width&quot;&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt;, which is set
+  by the &lt;code title=&quot;dom-context-2d-measureText&quot;&gt;measureText()&lt;/code&gt;
+  method.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;Glyphs rendered using &lt;code
+  title=&quot;dom-context-2d-fillText&quot;&gt;fillText()&lt;/code&gt; and &lt;code
+  title=&quot;dom-context-2d-strokeText&quot;&gt;strokeText()&lt;/code&gt; can spill out
+  of the box given by the font size (the em square size) and the width
+  returned by &lt;code
+  title=&quot;dom-context-2d-measureText&quot;&gt;measureText()&lt;/code&gt; (the text
+  width). If the text is to be rendered and removed, care needs to be
+  taken to replace the entire area of the canvas that the clipping
+  region covers, not just the box given by the em square height and
+  measured text width.&lt;/p&gt;
+
+  &lt;!-- XXXv4 Drawing text along a given path --&gt;
+  &lt;!-- XXXv4 Adding text to a path --&gt;
+  &lt;!-- see also: <A HREF="http://www.w3.org/TR/SVG11/text.html#TextpathLayoutRules">http://www.w3.org/TR/SVG11/text.html#TextpathLayoutRules</A> --&gt;
+  &lt;!-- see also: <A HREF="http://developer.mozilla.org/en/docs/Drawing_text_using_a_canvas">http://developer.mozilla.org/en/docs/Drawing_text_using_a_canvas</A> --&gt;
+
+  &lt;p class=&quot;note&quot;&gt;A future version of the 2D context API may provide a
+  way to render fragments of documents, rendered using CSS, straight
+  to the canvas. This would be provided in preference to a dedicated
+  way of doing multiline layout.&lt;/p&gt;
+
+
   &lt;h6&gt;Images&lt;/h6&gt;
 
   &lt;p&gt;To draw images onto the canvas, the &lt;dfn
@@ -24873,7 +25377,7 @@
      support the given protocol, then return a new globally unique
      identifier.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If the scheme is &quot;&lt;code title=&quot;&quot;&gt;file:&lt;/code&gt;&quot;, then the
+     &lt;li&gt;&lt;p&gt;If the scheme is &quot;&lt;code title=&quot;&quot;&gt;file&lt;/code&gt;&quot;, then the
      user agent may return a UA-specific origin.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the
@@ -29854,7 +30358,7 @@
   void &lt;span title=&quot;dom-Storage-clear&quot;&gt;clear&lt;/span&gt;();
 };&lt;/pre&gt;
 
-  &lt;!-- XXX v2 ideas:
+  &lt;!-- XXXv2 ideas:
     a getInfo() method that returns an object that tells you:
        - when the key was added
        - when the key was last modified
@@ -44345,28 +44849,29 @@
   Kristof Zelechovski, Lachlan Hunt, Larry Page, Lars Gunther, Laura
   L. Carlson, Laura Wisewell, Laurens Holst, Leif Halvard Silli, Lenny
   Domnitser, L&eacute;onard Bouchet, Leons Petrazickis, Logan&lt;!-- on
-  moz irc --&gt;, Loune, Maciej Stachowiak, Malcolm Rowe, Mark
-  Nottingham, Mark Rowe&lt;!--bdash--&gt;, Mark Schenk, Martijn Wargers,
-  Martin Atkins, Martin D&uuml;rst, Martin Honnen, Mathieu Henri,
-  Matthew Mastracci, Matthew Raymond, Matthew Thomas, Mattias Waldau,
-  Max Romantschuk, Michael 'Ratt' Iannarelli, Michael A. Nachbaur,
-  Michael A. Puls II&lt;!--Shadow2531--&gt;, Michael Carter, Michael
-  Gratton, Michael Powers, Michael Smith, Michel Fortin, Michiel van
-  der Blonk, Mihai &amp;#x015E;ucan&lt;!-- from ROBO Design --&gt;, Mike Brown,
-  Mike Dierken&lt;!-- S. Mike Dierken --&gt;, Mike Dixon, Mike Schinkel,
-  Mike Shaver, Mike Smith, Mikko Rantalainen, Neil Deakin, Neil
-  Soiffer, Olav Junker Kj&aelig;r, Oliver Hunt, Peter Kasting, Philip
-  Taylor, Philip TAYLOR&lt;!-- a different one --&gt;, Rachid Finge, Rajas
-  Moonka, Ralf Stoltze, Ralph Giles, Raphael Champeimont, Rene
-  Saarsoo, Richard Ishida, Rimantas Liubertas, Robert O'Callahan,
-  Robert Sayre, Roman Ivanov, S. Mike Dierken, Sam Ruby, Sam Weinig,
-  Scott Hess, Sean Knapp, Shaun Inman, Silvia Pfeiffer, Simon Pieters,
-  Stefan Haustein, Stephen Ma, Steve Faulkner, Steve Runyon, Steven
-  Garrity, Stewart Brodie, Stuart Parmenter, Sunava Dutta, Tantek
-  &Ccedil;elik, Terrence Wood, Thomas Broyer, Thomas O'Connor, Tim
-  Altman, Tyler Close, Vladimir Vuki&amp;#x0107;evi&amp;#x0107;, Wakaba, Wayne
-  Pollock, William Swanson, and &Oslash;istein E. Andersen, for their
-  useful and substantial comments.&lt;/p&gt;
+  moz irc --&gt;, Loune, Maciej Stachowiak, Magnus Kristiansen&lt;!--
+  Dashiva --&gt;, Malcolm Rowe, Mark Nottingham, Mark Rowe&lt;!--bdash--&gt;,
+  Mark Schenk, Martijn Wargers, Martin Atkins, Martin D&uuml;rst,
+  Martin Honnen, Masataka Yakura, Mathieu Henri, Matthew Mastracci,
+  Matthew Raymond, Matthew Thomas, Mattias Waldau, Max Romantschuk,
+  Michael 'Ratt' Iannarelli, Michael A. Nachbaur, Michael A. Puls
+  II&lt;!--Shadow2531--&gt;, Michael Carter, Michael Gratton, Michael
+  Powers, Michael Smith, Michel Fortin, Michiel van der Blonk, Mihai
+  &amp;#x015E;ucan&lt;!-- from ROBO Design --&gt;, Mike Brown, Mike Dierken&lt;!--
+  S. Mike Dierken --&gt;, Mike Dixon, Mike Schinkel, Mike Shaver, Mike
+  Smith, Mikko Rantalainen, Neil Deakin, Neil Soiffer, Olav Junker
+  Kj&aelig;r, Oliver Hunt, Peter Kasting, Philip Taylor, Philip
+  TAYLOR&lt;!-- a different one --&gt;, Rachid Finge, Rajas Moonka, Ralf
+  Stoltze, Ralph Giles, Raphael Champeimont, Rene Saarsoo, Richard
+  Ishida, Rimantas Liubertas, Robert O'Callahan, Robert Sayre, Roman
+  Ivanov, S. Mike Dierken, Sam Ruby, Sam Weinig, Scott Hess, Sean
+  Knapp, Shaun Inman, Silvia Pfeiffer, Simon Pieters, Stefan Haustein,
+  Stephen Ma, Steve Faulkner, Steve Runyon, Steven Garrity, Stewart
+  Brodie, Stuart Parmenter, Sunava Dutta, Tantek &Ccedil;elik,
+  Terrence Wood, Thomas Broyer, Thomas O'Connor, Tim Altman, Tyler
+  Close, Vladimir Vuki&amp;#x0107;evi&amp;#x0107;, Wakaba, Wayne Pollock,
+  William Swanson, and &Oslash;istein E. Andersen, for their useful
+  and substantial comments.&lt;/p&gt;
 
   &lt;p&gt;Thanks also to everyone who has ever posted about HTML5 to their
   blogs, public mailing lists, or forums, including the &lt;a


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008417.html">[html5] r1518 - /
</A></li>
	<LI>Next message: <A HREF="008419.html">[html5] r1520 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8418">[ date ]</a>
              <a href="thread.html#8418">[ thread ]</a>
              <a href="subject.html#8418">[ subject ]</a>
              <a href="author.html#8418">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
