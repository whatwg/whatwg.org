<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1606 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1606%20-%20/&In-Reply-To=%3C20080514014419.5462C13A17A%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008503.html">
   <LINK REL="Next"  HREF="008505.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1606 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1606%20-%20/&In-Reply-To=%3C20080514014419.5462C13A17A%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1606 - /">whatwg at whatwg.org
       </A><BR>
    <I>Tue May 13 18:44:19 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008503.html">[html5] r1605 - /
</A></li>
        <LI>Next message: <A HREF="008505.html">[html5] r1607 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8504">[ date ]</a>
              <a href="thread.html#8504">[ thread ]</a>
              <a href="subject.html#8504">[ subject ]</a>
              <a href="author.html#8504">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-05-13 18:44:18 -0700 (Tue, 13 May 2008)
New Revision: 1606

Modified:
   index
   source
Log:
[giow] (2) &lt;script charset&gt; support

Modified: index
===================================================================
--- index	2008-05-14 01:19:40 UTC (rev 1605)
+++ index	2008-05-14 01:44:18 UTC (rev 1606)
@@ -2391,7 +2391,7 @@
    href=&quot;#refsCSSOM&quot;&gt;[CSSOM]&lt;/a&gt;
 
   &lt;p class=big-issue&gt;See &lt;a
-   href=&quot;<A HREF="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.35&amp;amp;content-type=text/html;%20charset=utf-8">http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.35&amp;content-type=text/html;%20charset=utf-8</A>&quot;&gt;<A HREF="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.35&amp;amp;content-type=text/html;%20charset=utf-8&lt;/a">http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.35&amp;content-type=text/html;%20charset=utf-8&lt;/a</A>&gt;
+   href=&quot;<A HREF="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?content-type=text/html;%20charset=utf-8">http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?content-type=text/html;%20charset=utf-8</A>&quot;&gt;<A HREF="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?content-type=text/html;%20charset=utf-8&lt;/a">http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?content-type=text/html;%20charset=utf-8&lt;/a</A>&gt;
 
   &lt;p&gt;Certain features are defined in terms of CSS &lt;color&gt; values. When
    the CSS value &lt;code title=&quot;&quot;&gt;currentColor&lt;/code&gt; is specified in this
@@ -7823,24 +7823,7 @@
     default type is &lt;code title=&quot;&quot;&gt;text/css&lt;/code&gt;, the style sheet
     &lt;em&gt;would&lt;/em&gt; nonetheless be applied.&lt;/p&gt;
   &lt;/div&gt;
-  &lt;!--(to be deleted) (charset dropped)
-  &lt;p&gt;The &lt;dfn title=&quot;attr-link-charset&quot;&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt;
-  attribute gives the character encoding of the linked resource. It is
-  purely advisory. The value must be a valid character encoding name.
-  &lt;a href=&quot;#refsIANACHARSET&quot;&gt;[IANACHARSET]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;For &lt;span title=&quot;external resource link&quot;&gt;external resource
-  links&lt;/span&gt;, user agents may use the character encoding given in
-  this attribute to decide whether or not to consider using the
-  resource at all. If the UA does not support the given encoding for
-  the given link relationship, then the UA may opt not to download and
-  apply the resource.&lt;/p&gt;
-
-  &lt;p&gt;However, once the resource has been fetched, user agents must
-  follow the rules for that resource type when determining the actual
-  character encoding.&lt;/p&gt;
---&gt;
-
   &lt;p&gt;The &lt;dfn id=title2 title=attr-link-title&gt;&lt;code&gt;title&lt;/code&gt;&lt;/dfn&gt;
    attribute gives the title of the link. With one exception, it is purely
    advisory. The value is text. The exception is for style sheet links, where
@@ -22585,6 +22568,8 @@
 
    &lt;dd&gt;&lt;code title=attr-script-type&gt;&lt;a href=&quot;#type11&quot;&gt;type&lt;/a&gt;&lt;/code&gt;
 
+   &lt;dd&gt;&lt;code title=attr-script-charset&gt;&lt;a href=&quot;#charset2&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
+
    &lt;dt&gt;DOM interface:
 
    &lt;dd&gt;
@@ -22594,6 +22579,7 @@
            attribute boolean &lt;code title=dom-script-async&gt;&lt;a href=&quot;#async0&quot;&gt;async&lt;/a&gt;&lt;/code&gt;;
            attribute boolean &lt;code title=dom-script-defer&gt;&lt;a href=&quot;#defer0&quot;&gt;defer&lt;/a&gt;&lt;/code&gt;;
            attribute DOMString &lt;code title=dom-script-type&gt;&lt;a href=&quot;#type12&quot;&gt;type&lt;/a&gt;&lt;/code&gt;;
+           attribute DOMString &lt;code title=dom-script-charset&gt;&lt;a href=&quot;#charset3&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;;
            attribute DOMString &lt;code title=dom-script-text&gt;&lt;a href=&quot;#text1&quot;&gt;text&lt;/a&gt;&lt;/code&gt;;
 };&lt;/pre&gt;
   &lt;/dl&gt;
@@ -22604,7 +22590,7 @@
   &lt;p&gt;When the &lt;dfn id=src9 title=attr-script-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt;
    attribute is set, the &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element
    refers to an external file. The value of the attribute must be a URI (or
-   IRI).
+   IRI). If the attribute is set, the element must be empty.
 
   &lt;p&gt;If the &lt;code title=attr-script-src&gt;&lt;a href=&quot;#src9&quot;&gt;src&lt;/a&gt;&lt;/code&gt;
    attribute is not set, then the script is given by the contents of the
@@ -22613,8 +22599,18 @@
   &lt;p&gt;The language of the script may be given by the &lt;dfn id=type11
    title=attr-script-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt; attribute. If the attribute
    is present, its value must be a valid MIME type, optionally with
-   parameters. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt;
+   parameters. The &lt;code title=&quot;&quot;&gt;charset&lt;/code&gt; parameter must not be
+   specified. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt;
 
+  &lt;p&gt;The &lt;dfn id=charset2
+   title=attr-script-charset&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt; attribute gives the
+   character encoding of the external file. The attribute must not be
+   specified if the &lt;code title=attr-script-src&gt;&lt;a
+   href=&quot;#src9&quot;&gt;src&lt;/a&gt;&lt;/code&gt; attribute is not present. If the attribute is
+   set, its value must be a valid character encoding name, and must be the
+   preferred name for that encoding. &lt;a
+   href=&quot;#refsIANACHARSET&quot;&gt;[IANACHARSET]&lt;/a&gt;
+
   &lt;p&gt;The &lt;dfn id=async title=attr-script-async&gt;&lt;code&gt;async&lt;/code&gt;&lt;/dfn&gt; and
    &lt;dfn id=defer title=attr-script-defer&gt;&lt;code&gt;defer&lt;/code&gt;&lt;/dfn&gt; attributes
    are &lt;a href=&quot;#boolean0&quot; title=&quot;boolean attribute&quot;&gt;boolean attributes&lt;/a&gt;
@@ -22643,27 +22639,29 @@
 
   &lt;p&gt;Changing the &lt;code title=attr-script-src&gt;&lt;a href=&quot;#src9&quot;&gt;src&lt;/a&gt;&lt;/code&gt;,
    &lt;code title=attr-script-type&gt;&lt;a href=&quot;#type11&quot;&gt;type&lt;/a&gt;&lt;/code&gt;, &lt;code
+   title=attr-script-charset&gt;&lt;a href=&quot;#charset2&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;, &lt;code
    title=attr-script-async&gt;&lt;a href=&quot;#async&quot;&gt;async&lt;/a&gt;&lt;/code&gt;, and &lt;code
    title=attr-script-defer&gt;&lt;a href=&quot;#defer&quot;&gt;defer&lt;/a&gt;&lt;/code&gt; attributes
    dynamically has no direct effect; these attribute are only used at
    specific times described below (namely, when the element is inserted into
    the document).
 
-  &lt;p&gt;&lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; elements have three
-   associated pieces of metadata. The first is a flag indicating whether or
-   not the script block has been &lt;dfn id=already&gt;&quot;already executed&quot;&lt;/dfn&gt;.
-   Initially, &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; elements must have
-   this flag unset (script blocks, when created, are not &quot;already executed&quot;).
-   When a &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element is cloned, the
-   &quot;already executed&quot; flag, if set, must be propagated to the clone when it
-   is created. The second is a flag indicating whether the element was &lt;dfn
+  &lt;p&gt;&lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; elements have four associated
+   pieces of metadata. The first is a flag indicating whether or not the
+   script block has been &lt;dfn id=already&gt;&quot;already executed&quot;&lt;/dfn&gt;. Initially,
+   &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; elements must have this flag
+   unset (script blocks, when created, are not &quot;already executed&quot;). When a
+   &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element is cloned, the &quot;already
+   executed&quot; flag, if set, must be propagated to the clone when it is
+   created. The second is a flag indicating whether the element was &lt;dfn
    id=parser-inserted&gt;&quot;parser-inserted&quot;&lt;/dfn&gt;. This flag is set by the &lt;a
    href=&quot;#html-0&quot;&gt;HTML parser&lt;/a&gt; and is used to handle &lt;code
    title=dom-document-write-HTML&gt;&lt;a
-   href=&quot;#document.write...&quot;&gt;document.write()&lt;/a&gt;&lt;/code&gt; calls. The third
-   piece of metadata is &lt;dfn id=the-scripts&gt;&lt;var&gt;the script's
-   type&lt;/var&gt;&lt;/dfn&gt;. It is determined when the script is run, based on the
-   attributes on the element at that time.
+   href=&quot;#document.write...&quot;&gt;document.write()&lt;/a&gt;&lt;/code&gt; calls. The third and
+   fourth pieces of metadata are &lt;dfn id=the-scripts&gt;&lt;var&gt;the script's
+   type&lt;/var&gt;&lt;/dfn&gt; and &lt;dfn id=the-scripts0&gt;&lt;var&gt;the script's character
+   encoding&lt;/var&gt;&lt;/dfn&gt;. They are determined when the script is run, based on
+   the attributes on the element at that time.
 
   &lt;p&gt;&lt;dfn id=running0 title=&quot;running a script&quot;&gt;Running a script&lt;/dfn&gt;: When a
    script block is &lt;span&gt;inserted into a document&lt;/span&gt;, the user agent must
@@ -22696,6 +22694,19 @@
      title=attr-script-language&gt;language&lt;/code&gt; attribute.&lt;/p&gt;
 
    &lt;li&gt;
+    &lt;p&gt;If the &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element has a &lt;code
+     title=attr-script-charset&gt;&lt;a href=&quot;#charset2&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
+     attribute, then let &lt;var&gt;&lt;a href=&quot;#the-scripts0&quot;&gt;the script's character
+     encoding&lt;/a&gt;&lt;/var&gt; for this &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt;
+     element be the encoding given by the &lt;code title=attr-script-charset&gt;&lt;a
+     href=&quot;#charset2&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let &lt;var&gt;&lt;a href=&quot;#the-scripts0&quot;&gt;the script's character
+     encoding&lt;/a&gt;&lt;/var&gt; for this &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt;
+     element be the same as &lt;a href=&quot;#character1&quot; title=&quot;document's character
+     encoding&quot;&gt;the encoding of the document itself&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;li&gt;
     &lt;p&gt;If &lt;a href=&quot;#scripting1&quot;&gt;scripting is disabled&lt;/a&gt;, or if the
      &lt;code&gt;Document&lt;/code&gt; has &lt;code title=dom-document-designMode&gt;&lt;a
      href=&quot;#designMode&quot;&gt;designMode&lt;/a&gt;&lt;/code&gt; enabled, or if the &lt;code&gt;&lt;a
@@ -22914,6 +22925,17 @@
      &lt;dd&gt;
       &lt;p&gt;That file must be used as the file to execute.&lt;/p&gt;
 
+      &lt;p&gt;The file must be interpreted using the character encoding given by
+       &lt;var&gt;&lt;a href=&quot;#the-scripts0&quot;&gt;the script's character
+       encoding&lt;/a&gt;&lt;/var&gt;, regardless of any metadata given by the file's &lt;a
+       href=&quot;#content-type8&quot; title=Content-Type&gt;Content-Type metadata&lt;/a&gt;.&lt;/p&gt;
+
+      &lt;p class=big-issue&gt;This means that a UTF-16 document will always assume
+       external scripts are UTF-16...? This applies, e.g., to document's
+       created using createDocument()... It also means changing
+       document.charSet will affect the character encoding used to interpret
+       scripts, is that really what happens?&lt;/p&gt;
+
      &lt;dt&gt;If the script is inline
 
      &lt;dd&gt;
@@ -22946,7 +22968,8 @@
 
   &lt;p&gt;The DOM attributes &lt;dfn id=src10
    title=dom-script-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=type12
-   title=dom-script-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=async0
+   title=dom-script-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=charset3
+   title=dom-script-charset&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=async0
    title=dom-script-async&gt;&lt;code&gt;async&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=defer0
    title=dom-script-defer&gt;&lt;code&gt;defer&lt;/code&gt;&lt;/dfn&gt;, each must &lt;a
    href=&quot;#reflect&quot;&gt;reflect&lt;/a&gt; the respective content attributes of the same

Modified: source
===================================================================
--- source	2008-05-14 01:19:40 UTC (rev 1605)
+++ source	2008-05-14 01:44:18 UTC (rev 1606)
@@ -664,7 +664,7 @@
   href=&quot;#refsCSSOM&quot;&gt;[CSSOM]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p class=&quot;big-issue&quot;&gt;See &lt;a
-  href=&quot;<A HREF="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.35&amp;amp;content-type=text/html;%20charset=utf-8">http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.35&amp;content-type=text/html;%20charset=utf-8</A>&quot;&gt;<A HREF="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.35&amp;amp;content-type=text/html;%20charset=utf-8&lt;/a">http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.35&amp;content-type=text/html;%20charset=utf-8&lt;/a</A>&gt;&lt;/p&gt;
+  href=&quot;<A HREF="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?content-type=text/html;%20charset=utf-8">http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?content-type=text/html;%20charset=utf-8</A>&quot;&gt;<A HREF="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?content-type=text/html;%20charset=utf-8&lt;/a">http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?content-type=text/html;%20charset=utf-8&lt;/a</A>&gt;&lt;/p&gt;
 
   &lt;p&gt;Certain features are defined in terms of CSS &lt;color&gt;
   values. When the CSS value &lt;code title=&quot;&quot;&gt;currentColor&lt;/code&gt; is
@@ -6259,24 +6259,6 @@
 
   &lt;/div&gt;
 
-&lt;!--(to be deleted) (charset dropped)
-  &lt;p&gt;The &lt;dfn title=&quot;attr-link-charset&quot;&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt;
-  attribute gives the character encoding of the linked resource. It is
-  purely advisory. The value must be a valid character encoding name.
-  &lt;a href=&quot;#refsIANACHARSET&quot;&gt;[IANACHARSET]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;For &lt;span title=&quot;external resource link&quot;&gt;external resource
-  links&lt;/span&gt;, user agents may use the character encoding given in
-  this attribute to decide whether or not to consider using the
-  resource at all. If the UA does not support the given encoding for
-  the given link relationship, then the UA may opt not to download and
-  apply the resource.&lt;/p&gt;
-
-  &lt;p&gt;However, once the resource has been fetched, user agents must
-  follow the rules for that resource type when determining the actual
-  character encoding.&lt;/p&gt;
---&gt;
-
   &lt;p&gt;The &lt;dfn title=&quot;attr-link-title&quot;&gt;&lt;code&gt;title&lt;/code&gt;&lt;/dfn&gt;
   attribute gives the title of the link. With one exception, it is
   purely advisory. The value is text. The exception is for style sheet
@@ -20430,6 +20412,7 @@
    &lt;dd&gt;&lt;code title=&quot;attr-script-async&quot;&gt;async&lt;/code&gt;&lt;/dd&gt;
    &lt;dd&gt;&lt;code title=&quot;attr-script-defer&quot;&gt;defer&lt;/code&gt;&lt;/dd&gt;
    &lt;dd&gt;&lt;code title=&quot;attr-script-type&quot;&gt;type&lt;/code&gt;&lt;/dd&gt;
+   &lt;dd&gt;&lt;code title=&quot;attr-script-charset&quot;&gt;charset&lt;/code&gt;&lt;/dd&gt;
    &lt;dt&gt;DOM interface:&lt;/dt&gt;
    &lt;dd&gt;
 &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLScriptElement&lt;/dfn&gt; : &lt;span&gt;HTMLElement&lt;/span&gt; {
@@ -20437,6 +20420,7 @@
            attribute boolean &lt;code title=&quot;dom-script-async&quot;&gt;async&lt;/code&gt;;
            attribute boolean &lt;code title=&quot;dom-script-defer&quot;&gt;defer&lt;/code&gt;;
            attribute DOMString &lt;code title=&quot;dom-script-type&quot;&gt;type&lt;/code&gt;;
+           attribute DOMString &lt;code title=&quot;dom-script-charset&quot;&gt;charset&lt;/code&gt;;
            attribute DOMString &lt;code title=&quot;dom-script-text&quot;&gt;text&lt;/code&gt;;
 };&lt;/pre&gt;
    &lt;/dd&gt;
@@ -20448,7 +20432,7 @@
   &lt;p&gt;When the &lt;dfn title=&quot;attr-script-src&quot;&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt;
   attribute is set, the &lt;code&gt;script&lt;/code&gt; element refers to an
   external file. The value of the attribute must be a URI (or
-  IRI).&lt;/p&gt;
+  IRI). If the attribute is set, the element must be empty.&lt;/p&gt;
 
   &lt;p&gt;If the &lt;code title=&quot;attr-script-src&quot;&gt;src&lt;/code&gt; attribute is not
   set, then the script is given by the contents of the element.&lt;/p&gt;
@@ -20456,8 +20440,18 @@
   &lt;p&gt;The language of the script may be given by the &lt;dfn
   title=&quot;attr-script-type&quot;&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt; attribute. If the
   attribute is present, its value must be a valid MIME type,
-  optionally with parameters. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt;&lt;/p&gt;
+  optionally with parameters. The &lt;code title=&quot;&quot;&gt;charset&lt;/code&gt;
+  parameter must not be specified. &lt;a
+  href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;The &lt;dfn title=&quot;attr-script-charset&quot;&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt;
+  attribute gives the character encoding of the external file. The
+  attribute must not be specified if the &lt;code
+  title=&quot;attr-script-src&quot;&gt;src&lt;/code&gt; attribute is not present. If the
+  attribute is set, its value must be a valid character encoding name,
+  and must be the preferred name for that encoding.  &lt;a
+  href=&quot;#refsIANACHARSET&quot;&gt;[IANACHARSET]&lt;/a&gt;&lt;/p&gt;
+
   &lt;p&gt;The &lt;dfn title=&quot;attr-script-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/dfn&gt; and
   &lt;dfn title=&quot;attr-script-defer&quot;&gt;&lt;code&gt;defer&lt;/code&gt;&lt;/dfn&gt; attributes
   are &lt;span title=&quot;boolean attribute&quot;&gt;boolean attributes&lt;/span&gt; that
@@ -20485,13 +20479,14 @@
 
   &lt;p&gt;Changing the &lt;code title=&quot;attr-script-src&quot;&gt;src&lt;/code&gt;, &lt;code
   title=&quot;attr-script-type&quot;&gt;type&lt;/code&gt;, &lt;code
+  title=&quot;attr-script-charset&quot;&gt;charset&lt;/code&gt;, &lt;code
   title=&quot;attr-script-async&quot;&gt;async&lt;/code&gt;, and &lt;code
   title=&quot;attr-script-defer&quot;&gt;defer&lt;/code&gt; attributes dynamically has no
   direct effect; these attribute are only used at specific times
   described below (namely, when the element is inserted into the
   document).&lt;/p&gt;
 
-  &lt;p&gt;&lt;code&gt;script&lt;/code&gt; elements have three associated pieces of
+  &lt;p&gt;&lt;code&gt;script&lt;/code&gt; elements have four associated pieces of
   metadata. The first is a flag indicating whether or not the script
   block has been &lt;dfn&gt;&quot;already executed&quot;&lt;/dfn&gt;. Initially,
   &lt;code&gt;script&lt;/code&gt; elements must have this flag unset (script
@@ -20502,9 +20497,10 @@
   &lt;dfn&gt;&quot;parser-inserted&quot;&lt;/dfn&gt;. This flag is set by the &lt;span&gt;HTML
   parser&lt;/span&gt; and is used to handle &lt;code
   title=&quot;dom-document-write-HTML&quot;&gt;document.write()&lt;/code&gt; calls. The
-  third piece of metadata is &lt;dfn&gt;&lt;var&gt;the script's
-  type&lt;/var&gt;&lt;/dfn&gt;. It is determined when the script is run, based on
-  the attributes on the element at that time.&lt;/p&gt;
+  third and fourth pieces of metadata are &lt;dfn&gt;&lt;var&gt;the script's
+  type&lt;/var&gt;&lt;/dfn&gt; and &lt;dfn&gt;&lt;var&gt;the script's character
+  encoding&lt;/var&gt;&lt;/dfn&gt;. They are determined when the script is run,
+  based on the attributes on the element at that time.&lt;/p&gt;
 
   &lt;p&gt;&lt;dfn title=&quot;running a script&quot;&gt;Running a script&lt;/dfn&gt;: When a
   script block is &lt;span&gt;inserted into a document&lt;/span&gt;, the user
@@ -20539,6 +20535,21 @@
 
    &lt;li&gt;
 
+    &lt;p&gt;If the &lt;code&gt;script&lt;/code&gt; element has a &lt;code
+    title=&quot;attr-script-charset&quot;&gt;charset&lt;/code&gt; attribute, then let
+    &lt;var&gt;the script's character encoding&lt;/var&gt; for this
+    &lt;code&gt;script&lt;/code&gt; element be the encoding given by the &lt;code
+    title=&quot;attr-script-charset&quot;&gt;charset&lt;/code&gt; attribute.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let &lt;var&gt;the script's character encoding&lt;/var&gt; for
+    this &lt;code&gt;script&lt;/code&gt; element be the same as &lt;span
+    title=&quot;document's character encoding&quot;&gt;the encoding of the document
+    itself&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;If &lt;span&gt;scripting is disabled&lt;/span&gt;, or if the
     &lt;code&gt;Document&lt;/code&gt; has &lt;code
     title=&quot;dom-document-designMode&quot;&gt;designMode&lt;/code&gt; enabled, or if
@@ -20835,6 +20846,18 @@
 
       &lt;p&gt;That file must be used as the file to execute.&lt;/p&gt;
 
+      &lt;p&gt;The file must be interpreted using the character encoding
+      given by &lt;var&gt;the script's character encoding&lt;/var&gt;, regardless
+      of any metadata given by the file's &lt;span
+      title=&quot;Content-Type&quot;&gt;Content-Type metadata&lt;/span&gt;.&lt;/p&gt;
+
+      &lt;p class=&quot;big-issue&quot;&gt;This means that a UTF-16 document will
+      always assume external scripts are UTF-16...? This applies,
+      e.g., to document's created using createDocument()... It also
+      means changing document.charSet will affect the character
+      encoding used to interpret scripts, is that really what
+      happens?&lt;/p&gt;
+
      &lt;/dd&gt;
 
      &lt;dt&gt;If the script is inline&lt;/dt&gt;
@@ -20876,6 +20899,7 @@
   &lt;p&gt;The DOM attributes &lt;dfn
   title=&quot;dom-script-src&quot;&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
   title=&quot;dom-script-type&quot;&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
+  title=&quot;dom-script-charset&quot;&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
   title=&quot;dom-script-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn
   title=&quot;dom-script-defer&quot;&gt;&lt;code&gt;defer&lt;/code&gt;&lt;/dfn&gt;, each must
   &lt;span&gt;reflect&lt;/span&gt; the respective content attributes of the same


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008503.html">[html5] r1605 - /
</A></li>
	<LI>Next message: <A HREF="008505.html">[html5] r1607 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8504">[ date ]</a>
              <a href="thread.html#8504">[ thread ]</a>
              <a href="subject.html#8504">[ subject ]</a>
              <a href="author.html#8504">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
