<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1460 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1460%20-%20/&In-Reply-To=%3C20080418223406.7E653139DDE%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008359.html">
   <LINK REL="Next"  HREF="008361.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1460 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1460%20-%20/&In-Reply-To=%3C20080418223406.7E653139DDE%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1460 - /">whatwg at whatwg.org
       </A><BR>
    <I>Fri Apr 18 15:34:06 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008359.html">[html5] r1459 - /
</A></li>
        <LI>Next message: <A HREF="008361.html">[html5] r1461 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8360">[ date ]</a>
              <a href="thread.html#8360">[ thread ]</a>
              <a href="subject.html#8360">[ subject ]</a>
              <a href="author.html#8360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-04-18 15:34:05 -0700 (Fri, 18 Apr 2008)
New Revision: 1460

Modified:
   index
   source
Log:
[] (0) Define document.charset, .characterSet, .defaultCharset

Modified: index
===================================================================
--- index	2008-04-17 23:50:22 UTC (rev 1459)
+++ index	2008-04-18 22:34:05 UTC (rev 1460)
@@ -24,7 +24,7 @@
 
    &lt;h1 id=html-5&gt;HTML 5&lt;/h1&gt;
 
-   &lt;h2 class=&quot;no-num no-toc&quot; id=working&gt;Working Draft &mdash; 17 April 2008&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=working&gt;Working Draft &mdash; 18 April 2008&lt;/h2&gt;
 
    &lt;p&gt;You can take part in this work. &lt;a
     href=&quot;<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&quot;&gt;Join the working group's
@@ -2598,6 +2598,9 @@
            attribute DOMString &lt;a href=&quot;#cookie0&quot; title=dom-document-cookie&gt;cookie&lt;/a&gt;;
   readonly attribute DOMString &lt;a href=&quot;#lastmodified&quot; title=dom-document-lastModified&gt;lastModified&lt;/a&gt;;
   readonly attribute DOMString &lt;a href=&quot;#compatmode&quot; title=dom-document-compatMode&gt;compatMode&lt;/a&gt;;
+           attribute DOMString &lt;a href=&quot;#charset0&quot; title=dom-document-charset&gt;charset&lt;/a&gt;;
+  readonly attribute DOMString &lt;a href=&quot;#characterset&quot; title=dom-document-characterSet&gt;characterSet&lt;/a&gt;;
+  readonly attribute DOMString &lt;a href=&quot;#defaultcharset&quot; title=dom-document-defaultCharset&gt;defaultCharset&lt;/a&gt;;
 
   // &lt;a href=&quot;#dom-tree0&quot;&gt;DOM tree accessors&lt;/a&gt;
            attribute DOMString &lt;a href=&quot;#document.title&quot; title=dom-document-title&gt;title&lt;/a&gt;;
@@ -2642,9 +2645,6 @@
   DOMString &lt;a href=&quot;#querycommandvalue&quot; title=dom-document-queryCommandValue&gt;queryCommandValue&lt;/a&gt;(in DOMString commandId);
   &lt;a href=&quot;#selection1&quot;&gt;Selection&lt;/a&gt; &lt;a href=&quot;#getselection0&quot; title=dom-document-getSelection&gt;getSelection&lt;/a&gt;();
 &lt;!-- XXX we're not done here.
-          attribute DOMString charset;
- readonly attribute DOMString defaultCharset;
- readonly attribute DOMString characterSet;
  readonly attribute DOMString readyState;
  readonly attribute HTMLCollection scripts;
 --&gt;
@@ -2806,6 +2806,35 @@
    &lt;/ul&gt;
   &lt;/div&gt;
 
+  &lt;p&gt;Documents have an associated &lt;dfn id=character1 title=&quot;document's
+   character encoding&quot;&gt;character encoding&lt;/dfn&gt;. When a &lt;code&gt;Document&lt;/code&gt;
+   object is created, the &lt;a href=&quot;#character1&quot;&gt;document's character
+   encoding&lt;/a&gt; must be initialised to UTF-16. Various algorithms during page
+   loading affect this value, as does the &lt;code title=dom-document-charset&gt;&lt;a
+   href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; setter. &lt;a
+   href=&quot;#refsIANACHARSET&quot;&gt;[IANACHARSET]&lt;/a&gt; &lt;!-- XXX
+  <A HREF="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</A> --&gt;
+
+  &lt;p&gt;The &lt;dfn id=charset0
+   title=dom-document-charset&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt; DOM attribute must,
+   on getting, return the preferred MIME name of the &lt;a
+   href=&quot;#character1&quot;&gt;document's character encoding&lt;/a&gt;. On setting, if the
+   new value is an IANA-registered alias for a character encoding, the &lt;a
+   href=&quot;#character1&quot;&gt;document's character encoding&lt;/a&gt; must be set to that
+   character encoding. (Otherwise, nothing happens.)
+
+  &lt;p&gt;The &lt;dfn id=characterset
+   title=dom-document-characterSet&gt;&lt;code&gt;characterSet&lt;/code&gt;&lt;/dfn&gt; DOM
+   attribute must, on getting, return the preferred MIME name of the &lt;a
+   href=&quot;#character1&quot;&gt;document's character encoding&lt;/a&gt;.
+
+  &lt;p&gt;The &lt;dfn id=defaultcharset
+   title=dom-document-defaultCharset&gt;&lt;code&gt;defaultCharset&lt;/code&gt;&lt;/dfn&gt; DOM
+   attribute must, on getting, return the preferred MIME name of a character
+   encoding, possibly the user's default encoding, or an encoding associated
+   with the user's current geographical location, or any arbitrary encoding
+   name.
+
   &lt;h3 id=elements&gt;&lt;span class=secno&gt;2.2 &lt;/span&gt;Elements&lt;/h3&gt;
 
   &lt;p&gt;The nodes representing &lt;a href=&quot;#html-elements&quot;&gt;HTML elements&lt;/a&gt; in the
@@ -7536,7 +7565,7 @@
    &lt;dt&gt;Contexts in which this element may be used:
 
    &lt;dd&gt;If the &lt;code title=attr-meta-charset&gt;&lt;a
-    href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute is present, or if the
+    href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute is present, or if the
     element is in the &lt;a href=&quot;#encoding&quot;
     title=attr-meta-http-equiv-content-type&gt;Encoding declaraton state&lt;/a&gt;: as
     the first element in a &lt;code&gt;&lt;a href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt; element.
@@ -7571,7 +7600,7 @@
 
    &lt;dd&gt;&lt;code title=attr-meta-content&gt;&lt;a href=&quot;#content0&quot;&gt;content&lt;/a&gt;&lt;/code&gt;
 
-   &lt;dd&gt;&lt;code title=attr-meta-charset&gt;&lt;a href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
+   &lt;dd&gt;&lt;code title=attr-meta-charset&gt;&lt;a href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
     (&lt;a href=&quot;#html-&quot; title=&quot;HTML documents&quot;&gt;HTML&lt;/a&gt; only)
 
    &lt;dt&gt;DOM interface:
@@ -7596,15 +7625,15 @@
    document-level metadata with the &lt;code title=attr-meta-name&gt;&lt;a
    href=&quot;#name&quot;&gt;name&lt;/a&gt;&lt;/code&gt; attribute, pragma directives with the &lt;code
    title=attr-meta-http-equiv&gt;&lt;a href=&quot;#http-equiv0&quot;&gt;http-equiv&lt;/a&gt;&lt;/code&gt;
-   attribute, and the file's &lt;a href=&quot;#character1&quot;&gt;character encoding
+   attribute, and the file's &lt;a href=&quot;#character2&quot;&gt;character encoding
    declaration&lt;/a&gt; when an HTML document is serialised to string form (e.g.
    for transmission over the network or for disk storage) with the &lt;code
-   title=attr-meta-charset&gt;&lt;a href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute.
+   title=attr-meta-charset&gt;&lt;a href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute.
 
   &lt;p&gt;Exactly one of the &lt;code title=attr-meta-name&gt;&lt;a
    href=&quot;#name&quot;&gt;name&lt;/a&gt;&lt;/code&gt;, &lt;code title=attr-meta-http-equiv&gt;&lt;a
    href=&quot;#http-equiv0&quot;&gt;http-equiv&lt;/a&gt;&lt;/code&gt;, and &lt;code
-   title=attr-meta-charset&gt;&lt;a href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attributes
+   title=attr-meta-charset&gt;&lt;a href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attributes
    must be specified.
 
   &lt;p&gt;If either &lt;code title=attr-meta-name&gt;&lt;a href=&quot;#name&quot;&gt;name&lt;/a&gt;&lt;/code&gt; or
@@ -7613,15 +7642,15 @@
    title=attr-meta-content&gt;&lt;a href=&quot;#content0&quot;&gt;content&lt;/a&gt;&lt;/code&gt; attribute
    must also be specified. Otherwise, it must be omitted.
 
-  &lt;p&gt;The &lt;dfn id=charset0 title=attr-meta-charset&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn id=charset1 title=attr-meta-charset&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt;
    attribute specifies the character encoding used by the document. This is
-   called a &lt;a href=&quot;#character1&quot;&gt;character encoding declaration&lt;/a&gt;.
+   called a &lt;a href=&quot;#character2&quot;&gt;character encoding declaration&lt;/a&gt;.
 
-  &lt;p&gt;The &lt;code title=attr-meta-charset&gt;&lt;a href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
+  &lt;p&gt;The &lt;code title=attr-meta-charset&gt;&lt;a href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
    attribute may be specified in &lt;a href=&quot;#html5&quot; title=HTML5&gt;HTML
    documents&lt;/a&gt; only, it must not be used in &lt;a href=&quot;#xhtml5&quot;
    title=XHTML&gt;XML documents&lt;/a&gt;. If the &lt;code title=attr-meta-charset&gt;&lt;a
-   href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute is specified, the element
+   href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute is specified, the element
    must be the first element in &lt;a href=&quot;#the-head0&quot;&gt;the &lt;code&gt;head&lt;/code&gt;
    element&lt;/a&gt; of the file.
 
@@ -7892,7 +7921,7 @@
      user agent requirements are all handled by the parsing section of the
      specification. The state is just an alternative form of setting the
      &lt;code title=meta-charset&gt;charset&lt;/code&gt; attribute: it is a &lt;a
-     href=&quot;#character1&quot;&gt;character encoding declaration&lt;/a&gt;.&lt;/p&gt;
+     href=&quot;#character2&quot;&gt;character encoding declaration&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;For &lt;code&gt;&lt;a href=&quot;#meta0&quot;&gt;meta&lt;/a&gt;&lt;/code&gt; elements in the &lt;a
      href=&quot;#encoding&quot; title=attr-meta-http-equiv-content-type&gt;Encoding
@@ -7912,7 +7941,7 @@
      then that element must be the first element in the document's &lt;code&gt;&lt;a
      href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt; element, and the document must not contain
      a &lt;code&gt;&lt;a href=&quot;#meta0&quot;&gt;meta&lt;/a&gt;&lt;/code&gt; element with the &lt;code
-     title=attr-meta-charset&gt;&lt;a href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute
+     title=attr-meta-charset&gt;&lt;a href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute
      present.&lt;/p&gt;
 
     &lt;p&gt;The &lt;a href=&quot;#encoding&quot;
@@ -8096,7 +8125,7 @@
   though if we do then we have to duplicate the requirements in the
   parsing section for conformance checkers --&gt;
 
-  &lt;p&gt;A &lt;dfn id=character1&gt;character encoding declaration&lt;/dfn&gt; is a mechanism
+  &lt;p&gt;A &lt;dfn id=character2&gt;character encoding declaration&lt;/dfn&gt; is a mechanism
    by which the character encoding used to store or transmit a document is
    specified.
 
@@ -8127,7 +8156,7 @@
    and, in addition, if that encoding isn't US-ASCII itself, then the
    encoding must be specified using a &lt;code&gt;&lt;a href=&quot;#meta0&quot;&gt;meta&lt;/a&gt;&lt;/code&gt;
    element with a &lt;code title=attr-meta-charset&gt;&lt;a
-   href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code&gt;&lt;a
+   href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code&gt;&lt;a
    href=&quot;#meta0&quot;&gt;meta&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=&quot;#encoding&quot;
    title=attr-meta-http-equiv-content-type&gt;Encoding declaraton state&lt;/a&gt;.
 
@@ -30279,7 +30308,9 @@
   &lt;p&gt;The actual HTTP headers and other metadata, not the headers as mutated
    or implied by the algorithms given in this specification, are the ones
    that must be used when determining the character encoding according to the
-   rules given in the above specifications.
+   rules given in the above specifications. Once the character encoding is
+   established, the &lt;a href=&quot;#character1&quot;&gt;document's character encoding&lt;/a&gt;
+   must be set to that character encoding.
 
   &lt;p&gt;If the root element, as parsed according to the XML specifications cited
    above, is found to be an &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element
@@ -30339,6 +30370,9 @@
    versions thereof. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt; &lt;a
    href=&quot;#refsRFC2046&quot;&gt;[RFC2646]&lt;/a&gt;
 
+  &lt;p&gt;The &lt;a href=&quot;#character1&quot;&gt;document's character encoding&lt;/a&gt; must be set
+   to the character encoding used to decode the document.
+
   &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
    run the &lt;a href=&quot;#application3&quot;
    title=concept-appcache-init-no-attribute&gt;application cache selection
@@ -38322,7 +38356,7 @@
    described below.
 
   &lt;p&gt;RCDATA elements can have &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt; and
-   &lt;a href=&quot;#character2&quot; title=syntax-entities&gt;character entity
+   &lt;a href=&quot;#character3&quot; title=syntax-entities&gt;character entity
    references&lt;/a&gt;, but the text must not contain an &lt;a href=&quot;#ambiguous&quot;
    title=syntax-ambiguous-ampersand&gt;ambiguous ampersand&lt;/a&gt;. There are also
    &lt;a href=&quot;#cdata-rcdata-restrictions&quot;&gt;further restrictions&lt;/a&gt; described
@@ -38332,7 +38366,7 @@
    any contents (since, again, as there's no end tag, no content can be put
    between the start tag and the end tag). Foreign elements whose start tag
    is &lt;em&gt;not&lt;/em&gt; marked as self-closing can have &lt;a href=&quot;#text1&quot;
-   title=syntax-text&gt;text&lt;/a&gt;, &lt;a href=&quot;#character2&quot;
+   title=syntax-text&gt;text&lt;/a&gt;, &lt;a href=&quot;#character3&quot;
    title=syntax-entities&gt;character entity references&lt;/a&gt;, &lt;a href=&quot;#cdata0&quot;
    title=syntax-cdata&gt;CDATA blocks&lt;/a&gt;, other &lt;a href=&quot;#elements2&quot;
    title=syntax-elements&gt;elements&lt;/a&gt;, and &lt;a href=&quot;#comments0&quot;
@@ -38342,7 +38376,7 @@
    ampersand&lt;/a&gt;.
 
   &lt;p&gt;Normal elements can have &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt;, &lt;a
-   href=&quot;#character2&quot; title=syntax-entities&gt;character entity references&lt;/a&gt;,
+   href=&quot;#character3&quot; title=syntax-entities&gt;character entity references&lt;/a&gt;,
    other &lt;a href=&quot;#elements2&quot; title=syntax-elements&gt;elements&lt;/a&gt;, and &lt;a
    href=&quot;#comments0&quot; title=syntax-comments&gt;comments&lt;/a&gt;, but the text must
    not contain the character U+003C LESS-THAN SIGN (&lt;code&gt;&lt;&lt;/code&gt;) or an
@@ -38438,7 +38472,7 @@
 
   &lt;p&gt;&lt;dfn id=attribute0 title=syntax-attribute-value&gt;Attribute values&lt;/dfn&gt;
    are a mixture of &lt;a href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt; and &lt;a
-   href=&quot;#character2&quot; title=syntax-entities&gt;character entity references&lt;/a&gt;,
+   href=&quot;#character3&quot; title=syntax-entities&gt;character entity references&lt;/a&gt;,
    except with the additional restriction that the text cannot contain an &lt;a
    href=&quot;#ambiguous&quot; title=syntax-ambiguous-ampersand&gt;ambiguous
    ampersand&lt;/a&gt;.
@@ -38818,7 +38852,7 @@
   &lt;h4 id=character&gt;&lt;span class=secno&gt;8.1.4 &lt;/span&gt;Character entity references&lt;/h4&gt;
 
   &lt;p&gt;In certain cases described in other sections, &lt;a href=&quot;#text1&quot;
-   title=syntax-text&gt;text&lt;/a&gt; may be mixed with &lt;dfn id=character2
+   title=syntax-text&gt;text&lt;/a&gt; may be mixed with &lt;dfn id=character3
    title=syntax-entities&gt;character entity references&lt;/dfn&gt;. These can be used
    to escape characters that couldn't otherwise legally be included in &lt;a
    href=&quot;#text1&quot; title=syntax-text&gt;text&lt;/a&gt;.
@@ -39435,6 +39469,11 @@
      heuristically decide which to use as a default.
   &lt;/ol&gt;
 
+  &lt;p&gt;The &lt;a href=&quot;#character1&quot;&gt;document's character encoding&lt;/a&gt; must
+   immediately be set to the value returned from this algorithm, at the same
+   time as the user agent uses the returned value to select the decoder to
+   use for the input stream.
+
   &lt;h5 id=character0&gt;&lt;span class=secno&gt;8.2.2.2. &lt;/span&gt;Character encoding
    requirements&lt;/h5&gt;
 
@@ -39566,9 +39605,11 @@
     have the same Unicode interpretations in both the current encoding and
     the new encoding, and if the user agent supports changing the converter
     on the fly, then the user agent may change to the new converter for the
-    encoding on the fly. Set the encoding to the new encoding, set the &lt;a
-    href=&quot;#confidence&quot; title=concept-encoding-confidence&gt;confidence&lt;/a&gt; to
-    &lt;i&gt;confident&lt;/i&gt;, and abort these steps.
+    encoding on the fly. Set the &lt;a href=&quot;#character1&quot;&gt;document's character
+    encoding&lt;/a&gt; and the encoding used to convert the input stream to the new
+    encoding, set the &lt;a href=&quot;#confidence&quot;
+    title=concept-encoding-confidence&gt;confidence&lt;/a&gt; to &lt;i&gt;confident&lt;/i&gt;, and
+    abort these steps.
 
    &lt;li&gt;Otherwise, &lt;a href=&quot;#navigate&quot;&gt;navigate&lt;/a&gt; to the document again,
     with &lt;a href=&quot;#replacement&quot;&gt;replacement enabled&lt;/a&gt;, but this time skip
@@ -42752,16 +42793,16 @@
      set.&lt;/p&gt;
 
     &lt;p id=meta-charset-during-parse&gt;If the element has a &lt;code
-     title=attr-meta-charset&gt;&lt;a href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
+     title=attr-meta-charset&gt;&lt;a href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
      attribute, and its value is a supported encoding, and the &lt;a
      href=&quot;#confidence&quot; title=concept-encoding-confidence&gt;confidence&lt;/a&gt; is
      currently &lt;i&gt;tentative&lt;/i&gt;, then &lt;a href=&quot;#change&quot;&gt;change the
      encoding&lt;/a&gt; to the encoding given by the value of the &lt;code
-     title=attr-meta-charset&gt;&lt;a href=&quot;#charset0&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
+     title=attr-meta-charset&gt;&lt;a href=&quot;#charset1&quot;&gt;charset&lt;/a&gt;&lt;/code&gt;
      attribute.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the element has a &lt;code title=attr-meta-charset&gt;&lt;a
-     href=&quot;#charset0&quot;&gt;content&lt;/a&gt;&lt;/code&gt; attribute, and applying the &lt;a
+     href=&quot;#charset1&quot;&gt;content&lt;/a&gt;&lt;/code&gt; attribute, and applying the &lt;a
      href=&quot;#algorithm4&quot;&gt;algorithm for extracting an encoding from a
      Content-Type&lt;/a&gt; to its value returns a supported encoding &lt;var
      title=&quot;&quot;&gt;encoding&lt;/var&gt;, and the &lt;a href=&quot;#confidence&quot;
@@ -50029,7 +50070,6 @@
 
 
    Interaction with document.open/write/close is undefined
-   How to determine the character encoding
    Integration with quirks mode problems
    &lt;style&gt; parsing needs tweaking if we want to exactly match IE
    &lt;base&gt; parsing needs tweaking to handle multiple &lt;base&gt;s

Modified: source
===================================================================
--- source	2008-04-17 23:50:22 UTC (rev 1459)
+++ source	2008-04-18 22:34:05 UTC (rev 1460)
@@ -904,6 +904,9 @@
            attribute DOMString &lt;span title=&quot;dom-document-cookie&quot;&gt;cookie&lt;/span&gt;;
   readonly attribute DOMString &lt;span title=&quot;dom-document-lastModified&quot;&gt;lastModified&lt;/span&gt;;
   readonly attribute DOMString &lt;span title=&quot;dom-document-compatMode&quot;&gt;compatMode&lt;/span&gt;;
+           attribute DOMString &lt;span title=&quot;dom-document-charset&quot;&gt;charset&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-document-characterSet&quot;&gt;characterSet&lt;/span&gt;;
+  readonly attribute DOMString &lt;span title=&quot;dom-document-defaultCharset&quot;&gt;defaultCharset&lt;/span&gt;;
 
   // &lt;span&gt;DOM tree accessors&lt;/span&gt;
            attribute DOMString &lt;span title=&quot;dom-document-title&quot;&gt;title&lt;/span&gt;;
@@ -948,9 +951,6 @@
   DOMString &lt;span title=&quot;dom-document-queryCommandValue&quot;&gt;queryCommandValue&lt;/span&gt;(in DOMString commandId);
   &lt;span&gt;Selection&lt;/span&gt; &lt;span title=&quot;dom-document-getSelection&quot;&gt;getSelection&lt;/span&gt;();
 &lt;!-- XXX we're not done here.
-          attribute DOMString charset;
- readonly attribute DOMString defaultCharset;
- readonly attribute DOMString characterSet;
  readonly attribute DOMString readyState;
  readonly attribute HTMLCollection scripts;
 --&gt;
@@ -1127,6 +1127,36 @@
 
 
 
+  &lt;p&gt;Documents have an associated &lt;dfn title=&quot;document's character
+  encoding&quot;&gt;character encoding&lt;/dfn&gt;. When a &lt;code&gt;Document&lt;/code&gt;
+  object is created, the &lt;span&gt;document's character encoding&lt;/span&gt;
+  must be initialised to UTF-16. Various algorithms during page
+  loading affect this value, as does the &lt;code
+  title=&quot;dom-document-charset&quot;&gt;charset&lt;/code&gt; setter.  &lt;a
+  href=&quot;#refsIANACHARSET&quot;&gt;[IANACHARSET]&lt;/a&gt; &lt;!-- XXX
+  <A HREF="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</A> --&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-document-charset&quot;&gt;&lt;code&gt;charset&lt;/code&gt;&lt;/dfn&gt;
+  DOM attribute must, on getting, return the preferred MIME name of
+  the &lt;span&gt;document's character encoding&lt;/span&gt;. On setting, if the
+  new value is an IANA-registered alias for a character encoding, the
+  &lt;span&gt;document's character encoding&lt;/span&gt; must be set to that
+  character encoding. (Otherwise, nothing happens.)&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-document-characterSet&quot;&gt;&lt;code&gt;characterSet&lt;/code&gt;&lt;/dfn&gt;
+  DOM attribute must, on getting, return the preferred MIME name of
+  the &lt;span&gt;document's character encoding&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-document-defaultCharset&quot;&gt;&lt;code&gt;defaultCharset&lt;/code&gt;&lt;/dfn&gt;
+  DOM attribute must, on getting, return the preferred MIME name of a
+  character encoding, possibly the user's default encoding, or an
+  encoding associated with the user's current geographical location,
+  or any arbitrary encoding name.&lt;/p&gt;
+
+
+
   &lt;h3&gt;Elements&lt;/h3&gt;
 
   &lt;p&gt;The nodes representing &lt;span&gt;HTML elements&lt;/span&gt; in the DOM must
@@ -28042,7 +28072,9 @@
   mutated or implied by the algorithms given in this specification,
   are the ones that must be used when determining the character
   encoding according to the rules given in the above
-  specifications.&lt;/p&gt;
+  specifications. Once the character encoding is established, the
+  &lt;span&gt;document's character encoding&lt;/span&gt; must be set to that
+  character encoding.&lt;/p&gt;
 
   &lt;p&gt;If the root element, as parsed according to the XML
   specifications cited above, is found to be an &lt;code&gt;html&lt;/code&gt;
@@ -28103,6 +28135,9 @@
   subsequent versions thereof. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt; &lt;a
   href=&quot;#refsRFC2046&quot;&gt;[RFC2646]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;The &lt;span&gt;document's character encoding&lt;/span&gt; must be set to the
+  character encoding used to decode the document.&lt;/p&gt;
+
   &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent
   must run the &lt;span
   title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
@@ -36975,7 +37010,12 @@
 
   &lt;/ol&gt;
 
+  &lt;p&gt;The &lt;span&gt;document's character encoding&lt;/span&gt; must immediately
+  be set to the value returned from this algorithm, at the same time
+  as the user agent uses the returned value to select the decoder to
+  use for the input stream.&lt;/p&gt;
 
+
   &lt;h5&gt;Character encoding requirements&lt;/h5&gt;
 
   &lt;p&gt;User agents must at a minimum support the UTF-8 and Windows-1252
@@ -37108,8 +37148,9 @@
    decoder have the same Unicode interpretations in both the current
    encoding and the new encoding, and if the user agent supports
    changing the converter on the fly, then the user agent may change
-   to the new converter for the encoding on the fly. Set the encoding
-   to the new encoding, set the &lt;span
+   to the new converter for the encoding on the fly. Set the
+   &lt;span&gt;document's character encoding&lt;/span&gt; and the encoding used to
+   convert the input stream to the new encoding, set the &lt;span
    title=&quot;concept-encoding-confidence&quot;&gt;confidence&lt;/span&gt; to
    &lt;i&gt;confident&lt;/i&gt;, and abort these steps.&lt;/li&gt;
 
@@ -45190,7 +45231,6 @@
 
 
    Interaction with document.open/write/close is undefined
-   How to determine the character encoding
    Integration with quirks mode problems
    &lt;style&gt; parsing needs tweaking if we want to exactly match IE
    &lt;base&gt; parsing needs tweaking to handle multiple &lt;base&gt;s


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008359.html">[html5] r1459 - /
</A></li>
	<LI>Next message: <A HREF="008361.html">[html5] r1461 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8360">[ date ]</a>
              <a href="thread.html#8360">[ thread ]</a>
              <a href="subject.html#8360">[ subject ]</a>
              <a href="author.html#8360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
