<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1197 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1197%20-%20/&In-Reply-To=%3C20080203094351.E761C38EF9C%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008104.html">
   <LINK REL="Next"  HREF="008106.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1197 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1197%20-%20/&In-Reply-To=%3C20080203094351.E761C38EF9C%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1197 - /">whatwg at whatwg.org
       </A><BR>
    <I>Sun Feb  3 01:43:51 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008104.html">[html5] r1196 - /
</A></li>
        <LI>Next message: <A HREF="008106.html">[html5] r1198 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8105">[ date ]</a>
              <a href="thread.html#8105">[ thread ]</a>
              <a href="subject.html#8105">[ subject ]</a>
              <a href="author.html#8105">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-02-03 01:43:50 -0800 (Sun, 03 Feb 2008)
New Revision: 1197

Modified:
   index
   source
Log:
[gow] (2) Revamp of ImageData and related APIs.

Modified: index
===================================================================
--- index	2008-02-03 06:59:10 UTC (rev 1196)
+++ index	2008-02-03 09:43:50 UTC (rev 1197)
@@ -16244,8 +16244,10 @@
   void &lt;a href=&quot;#drawimage&quot; title=dom-context-2d-drawImage&gt;drawImage&lt;/a&gt;(in &lt;a href=&quot;#htmlcanvaselement&quot;&gt;HTMLCanvasElement&lt;/a&gt; image, in float sx, in float sy, in float sw, in float sh, in float dx, in float dy, in float dw, in float dh);
 
   // pixel manipulation
+  &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; &lt;a href=&quot;#createimagedata&quot; title=dom-context-2d-createImageData&gt;createImageData&lt;/a&gt;(in float sw, in float sh);
   &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; &lt;a href=&quot;#getimagedata&quot; title=dom-context-2d-getImageData&gt;getImageData&lt;/a&gt;(in float sx, in float sy, in float sw, in float sh);
   void &lt;a href=&quot;#putimagedata&quot; title=dom-context-2d-putImageData&gt;putImageData&lt;/a&gt;(in &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; imagedata, in float dx, in float dy);
+  void &lt;a href=&quot;#putimagedata&quot; title=dom-context-2d-putImageData&gt;putImageData&lt;/a&gt;(in &lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt; imagedata, in float dx, in float dy, in float dirtyX, in float dirtyY, in float dirtyWidth, in float dirtyHeight);
 
   // drawing text is not supported in this version of the API
   // (there is no way to predict what metrics the fonts will have,
@@ -17505,25 +17507,44 @@
 
   &lt;h6 id=pixel&gt;&lt;span class=secno&gt;3.14.11.1.10. &lt;/span&gt;&lt;dfn id=pixel0&gt;Pixel
    manipulation&lt;/dfn&gt;&lt;/h6&gt;
+  &lt;!--
+  &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-createImageData&quot;&gt;createImageData&lt;/span&gt;(in float sw, in float sh);
+  &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData&lt;/span&gt;(in float sx, in float sy, in float sw, in float sh);
+  void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy);
+  void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy, in float dirtyX, in float dirtyY, in float dirtyWidth, in float dirtyHeight);
+--&gt;
 
+  &lt;p&gt;The &lt;dfn id=createimagedata
+   title=dom-context-2d-createImageData&gt;&lt;code&gt;createImageData(&lt;var
+   title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return
+   an &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; object representing a
+   rectangle with a width in CSS pixels equal to the absolute magnitude of
+   &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; and a height in CSS pixels equal to the absolute
+   magnitude of &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;, filled with transparent black.
+
   &lt;p&gt;The &lt;dfn id=getimagedata
    title=dom-context-2d-getImageData&gt;&lt;code&gt;getImageData(&lt;var
    title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var
    title=&quot;&quot;&gt;sh&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return an &lt;code&gt;&lt;a
    href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; object representing the underlying
-   pixel data for the area of the canvas denoted by the rectangle whose
+   pixel data for the area of the canvas denoted by the rectanglewhose
    corners are the four points (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var
    title=&quot;&quot;&gt;sy&lt;/var&gt;), (&lt;span&gt;&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;+&lt;var
    title=&quot;&quot;&gt;sw&lt;/var&gt;&lt;/span&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;), (&lt;span&gt;&lt;var
    title=&quot;&quot;&gt;sx&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;&lt;/span&gt;, &lt;span&gt;&lt;var
    title=&quot;&quot;&gt;sy&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;&lt;/span&gt;), (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;,
-   &lt;span&gt;&lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;&lt;/span&gt;). Pixels
-   outside the canvas must be returned as transparent black. Pixels must be
-   returned as non-premultiplied alpha values.
+   &lt;span&gt;&lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;&lt;/span&gt;), in canvas
+   coordinate space units. Pixels outside the canvas must be returned as
+   transparent black. Pixels must be returned as non-premultiplied alpha
+   values.
 
-  &lt;p&gt;If any of the arguments to &lt;code title=dom-context-2d-getImageData&gt;&lt;a
-   href=&quot;#getimagedata&quot;&gt;getImageData()&lt;/a&gt;&lt;/code&gt; are infinite or NaN, the
-   method must instead raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.
+  &lt;p&gt;If any of the arguments to &lt;code title=dom-context-2d-createImageData&gt;&lt;a
+   href=&quot;#createimagedata&quot;&gt;createImageData()&lt;/a&gt;&lt;/code&gt; or &lt;code
+   title=dom-context-2d-getImageData&gt;&lt;a
+   href=&quot;#getimagedata&quot;&gt;getImageData()&lt;/a&gt;&lt;/code&gt; are infinite or NaN, or if
+   either the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; or &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments are
+   zero, the method must instead raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt;
+   exception.
 
   &lt;p&gt;&lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; objects must be
    initialised so that their &lt;dfn id=width2
@@ -17547,7 +17568,7 @@
    href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; objects, are all read-only). On
    setting, JS &lt;code&gt;undefined&lt;/code&gt; values must be converted to zero. Other
    values must first be converted to numbers using JavaScript's ToNumber
-   algorithm, and if the result is not a number, a
+   algorithm, and if the result is a NaN value, a
    &lt;code&gt;TYPE_MISMATCH_ERR&lt;/code&gt; exception must be raised. If the result is
    less than 0, it must be clamped to zero. If the result is more than 255,
    it must be clamped to 255. If the number is not an integer, it must be
@@ -17557,63 +17578,115 @@
 
   &lt;p class=note&gt;The width and height (&lt;var title=&quot;&quot;&gt;w&lt;/var&gt; and &lt;var
    title=&quot;&quot;&gt;h&lt;/var&gt;) might be different from the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; and
-   &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments to the function, e.g. if the canvas is
-   backed by a high-resolution bitmap, or if the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; and
-   &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments are negative.
+   &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments to the above methods, e.g. if the canvas
+   is backed by a high-resolution bitmap, or if the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;
+   and &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments are negative.
 
-  &lt;p&gt;If the &lt;code title=dom-context-2d-getImageData&gt;&lt;a
-   href=&quot;#getimagedata&quot;&gt;getImageData()&lt;/a&gt;&lt;/code&gt; method is called with
-   either the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; or &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments set
-   to zero, the method must raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.
-
   &lt;p&gt;The &lt;dfn id=putimagedata
    title=dom-context-2d-putImageData&gt;&lt;code&gt;putImageData(&lt;var
-   title=&quot;&quot;&gt;imagedata&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var
-   title=&quot;&quot;&gt;dy&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must take the given &lt;code&gt;&lt;a
-   href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; structure, and place it at the
-   specified location (&lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dy&lt;/var&gt;) in the
-   canvas coordinate space, mapping each pixel represented by the &lt;code&gt;&lt;a
-   href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; structure into one device pixel.
+   title=&quot;&quot;&gt;imagedata&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dy&lt;/var&gt;,
+   &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;, &lt;var
+   title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
+   method writes data from &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt;
+   structures back to the canvas.
 
-  &lt;p&gt;If the first argument to the method is not an object whose [[Class]]
-   property is &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt;, but all of
-   the following conditions are true, then the method must treat the first
-   argument as if it was an &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt;
-   object (and thus not raise the &lt;code&gt;TYPE_MISMATCH_ERR&lt;/code&gt; exception):
+  &lt;p&gt;If the first argment to the method is null or not an &lt;code&gt;&lt;a
+   href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; object that was returned by &lt;code
+   title=dom-context-2d-createImageData&gt;&lt;a
+   href=&quot;#createimagedata&quot;&gt;createImageData()&lt;/a&gt;&lt;/code&gt; or &lt;code
+   title=dom-context-2d-getImageData&gt;&lt;a
+   href=&quot;#getimagedata&quot;&gt;getImageData()&lt;/a&gt;&lt;/code&gt; then the &lt;code
+   title=dom-context-2d-putImageData&gt;&lt;a
+   href=&quot;#putimagedata&quot;&gt;putImageData()&lt;/a&gt;&lt;/code&gt; method must raise a
+   &lt;code&gt;TYPE_MISMATCH_ERR&lt;/code&gt; exception.
 
-  &lt;ul&gt;
-   &lt;li&gt;The method's first argument is an object with &lt;code
-    title=dom-imagedata-width&gt;&lt;a href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; and &lt;code
-    title=dom-imagedata-height&gt;&lt;a href=&quot;#height2&quot;&gt;height&lt;/a&gt;&lt;/code&gt;
-    attributes with integer values and a &lt;code title=dom-imagedata-data&gt;&lt;a
-    href=&quot;#data1&quot;&gt;data&lt;/a&gt;&lt;/code&gt; attribute whose value is an enumerable list
-    of values that are either JS Numbers or the JS value
-    &lt;code&gt;undefined&lt;/code&gt;.
+  &lt;p&gt;If any of the arguments to the method are infinite or NaN, the method
+   must raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.
 
-   &lt;li&gt;The &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; object's &lt;code
-    title=dom-imagedata-width&gt;&lt;a href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; is greater
-    than zero.
+  &lt;p&gt;When the last four arguments are omitted, they must be assumed to have
+   the values 0, 0, the &lt;code title=dom-imagedata-width&gt;&lt;a
+   href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; member of the &lt;var
+   title=&quot;&quot;&gt;imagedata&lt;/var&gt; structure, and the &lt;code
+   title=dom-imagedata-height&gt;&lt;a href=&quot;#height2&quot;&gt;height&lt;/a&gt;&lt;/code&gt;member of
+   the &lt;var title=&quot;&quot;&gt;imagedata&lt;/var&gt; structure, respectively.
 
-   &lt;li&gt;The &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; object's &lt;code
-    title=dom-imagedata-height&gt;&lt;a href=&quot;#height2&quot;&gt;height&lt;/a&gt;&lt;/code&gt; is
-    greater than zero.
+  &lt;p&gt;When invoked with arguments that do not, per the last few paragraphs,
+   cause an exception to be raised, the &lt;code
+   title=dom-context-2d-putImageData&gt;&lt;a
+   href=&quot;#putimagedata&quot;&gt;putImageData()&lt;/a&gt;&lt;/code&gt; method must act as follows:
 
-   &lt;li&gt;The &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt; object's &lt;code
-    title=dom-imagedata-width&gt;&lt;a href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; multiplied
-    by its &lt;code title=dom-imagedata-height&gt;&lt;a
-    href=&quot;#height2&quot;&gt;height&lt;/a&gt;&lt;/code&gt; multiplied by 4 is equal to the number
-    of entries in the &lt;code&gt;&lt;a href=&quot;#imagedata&quot;&gt;ImageData&lt;/a&gt;&lt;/code&gt;
-    object's &lt;code title=dom-imagedata-data&gt;&lt;a href=&quot;#data1&quot;&gt;data&lt;/a&gt;&lt;/code&gt;
-    property.
-  &lt;/ul&gt;
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;dx&lt;sub&gt;device&lt;/sub&gt;&lt;/var&gt; be the x-coordinate of the
+     device pixel in the underlying pixel data of the canvas corresponding to
+     the &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt; coordinate in the canvas coordinate space.&lt;/p&gt;
 
-  &lt;p&gt;In the &lt;code title=dom-imagedata-data&gt;&lt;a href=&quot;#data1&quot;&gt;data&lt;/a&gt;&lt;/code&gt;
-   property, undefined values must be treated as zero, any numbers below zero
-   must be clamped to zero, any numbers above 255 must be clamped to 255, and
-   any numbers that are not integers must be rounded to the nearest integer
-   using the IEEE 754r &lt;i&gt;roundTiesToEven&lt;/i&gt; rounding mode. &lt;a
-   href=&quot;#refsIEEE754r&quot;&gt;[IEEE754R]&lt;/a&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;dy&lt;sub&gt;device&lt;/sub&gt;&lt;/var&gt; be the y-coordinate of the
+     device pixel in the underlying pixel data of the canvas corresponding to
+     the &lt;var title=&quot;&quot;&gt;dy&lt;/var&gt; coordinate in the canvas coordinate space.&lt;/p&gt;
 
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; is negative, let &lt;var
+     title=&quot;&quot;&gt;dirtyX&lt;/var&gt; be &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;&lt;/span&gt;, and let &lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;
+     be equal to the absolute magnitude of &lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; is negative, let &lt;var
+     title=&quot;&quot;&gt;dirtyY&lt;/var&gt; be &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;&lt;/span&gt;, and let &lt;var
+     title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; be equal to the absolute magnitude of &lt;var
+     title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt; is negative, let &lt;var
+     title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; be &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;dirtyX&lt;/var&gt;&lt;/span&gt;, and let &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt; be
+     zero.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt; is negative, let &lt;var
+     title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; be &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;dirtyY&lt;/var&gt;&lt;/span&gt;, and let &lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt; be
+     zero.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;&lt;/span&gt; is greater than the &lt;code
+     title=dom-imagedata-width&gt;&lt;a href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; attribute
+     of the &lt;var title=&quot;&quot;&gt;imagedata&lt;/var&gt; argument, let &lt;var
+     title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; be the value of that &lt;code
+     title=dom-imagedata-width&gt;&lt;a href=&quot;#width2&quot;&gt;width&lt;/a&gt;&lt;/code&gt; attribute,
+     minus the value of &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;&lt;/span&gt; is greater than the &lt;code
+     title=dom-imagedata-height&gt;&lt;a href=&quot;#height2&quot;&gt;height&lt;/a&gt;&lt;/code&gt;
+     attribute of the &lt;var title=&quot;&quot;&gt;imagedata&lt;/var&gt; argument, let &lt;var
+     title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; be the value of that &lt;code
+     title=dom-imagedata-height&gt;&lt;a href=&quot;#height2&quot;&gt;height&lt;/a&gt;&lt;/code&gt;
+     attribute, minus the value of &lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If, after those changes, either &lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; or &lt;var
+     title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; is negative or zero, stop these steps without
+     affecting the canvas.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Otherwise, for all values of &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; and &lt;var
+     title=&quot;&quot;&gt;y&lt;/var&gt; where &lt;span&gt;&lt;var
+     title=&quot;&quot;&gt;dirtyX&lt;/var&gt;&nbsp;&le;&nbsp;&lt;var
+     title=&quot;&quot;&gt;x&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;&lt;/span&gt;&lt;/span&gt; and &lt;span&gt;&lt;var
+     title=&quot;&quot;&gt;dirtyY&lt;/var&gt;&nbsp;&le;&nbsp;&lt;var
+     title=&quot;&quot;&gt;y&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;&lt;/span&gt;&lt;/span&gt;, copy the four channels of thr
+     pixel with coordinate (&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;) in
+     the &lt;var title=&quot;&quot;&gt;imagedata&lt;/var&gt; data structure to the pixel with
+     coordinate (&lt;span&gt;&lt;var title=&quot;&quot;&gt;x&lt;sub&gt;device&lt;/sub&gt;&lt;/var&gt;+&lt;var
+     title=&quot;&quot;&gt;x&lt;/var&gt;&lt;/span&gt;, &lt;span&gt;&lt;var
+     title=&quot;&quot;&gt;y&lt;sub&gt;device&lt;/sub&gt;&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;y&lt;/var&gt;&lt;/span&gt;) in the
+     underlying pixel data of the canvas.
+  &lt;/ol&gt;
+
   &lt;p&gt;The handling of pixel rounding when the specified coordinates do not
    exactly map to the device coordinate space is not defined by this
    specification, except that the following must result in no visible changes
@@ -17659,28 +17732,16 @@
 
    &lt;pre&gt;
   // canvas is a reference to a &lt;canvas&gt; element
-  // (note: this example uses JavaScript 1.7 features)
   var context = canvas.getContext('2d');
-  var backingStore = context.getImageData(0, 0, canvas.width, canvas.height);
-  var actualWidth = backingStore.width;
-  var actualHeight = backingStore.height;
 
-  function CreateImageData(w, h) {
-    return {
-      height: h,
-      width: w,
-      data: [i for (i in function (n) { for (let i = 0; i &lt; n; i += 1) yield 0 }(w*h*4)) ]
-    };
-  }
-
   // create a blank slate
-  var data = CreateImageData(actualWidth, actualHeight);
+  var data = context.createImageData(canvas.width, canvas.height);
 
   // create some plasma
   FillPlasma(data, 'green'); // green plasma
 
   // add a cloud to the plasma
-  AddCloud(data, actualWidth/2, actualHeight/2); // put a cloud in the middle
+  AddCloud(data, data.width/2, data.height/2); // put a cloud in the middle
 
   // paint the plasma+cloud on the canvas
   context.putImageData(data, 0, 0);
@@ -17718,13 +17779,18 @@
      // get the image data to manipulate
      var input = context.getImageData(0, 0, canvas.width, canvas.height);
 
-     // edge detection
+     // get an empty slate to put the data into
+     var output = context.crateImageData(canvas.width, canvas.height);
+
+     // alias some variables for convenience
      // notice that we are using input.width and input.height here
      // as they might not be the same as canvas.width and canvas.height
      // (in particular, they might be different on high-res displays)
      var w = input.width, h = input.height;
      var inputData = input.data;
-     var outputData = new Array(w*h*4);
+     var outputData = output.data;
+
+     // edge detection
      for (var y = 1; y &lt; h-1; y += 1) {
        for (var x = 1; x &lt; w-1; x += 1) {
          for (var c = 0; c &lt; 3; c += 1) {
@@ -17738,11 +17804,6 @@
      }
 
      // put the image data back after manipulation
-     var output = {
-       width: w,
-       height: h,
-       data: outputData
-     };
      context.putImageData(output, 0, 0);
    }
   &lt;/script&gt;

Modified: source
===================================================================
--- source	2008-02-03 06:59:10 UTC (rev 1196)
+++ source	2008-02-03 09:43:50 UTC (rev 1197)
@@ -13793,8 +13793,10 @@
   void &lt;span title=&quot;dom-context-2d-drawImage&quot;&gt;drawImage&lt;/span&gt;(in &lt;span&gt;HTMLCanvasElement&lt;/span&gt; image, in float sx, in float sy, in float sw, in float sh, in float dx, in float dy, in float dw, in float dh);
 
   // pixel manipulation
+  &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-createImageData&quot;&gt;createImageData&lt;/span&gt;(in float sw, in float sh);
   &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData&lt;/span&gt;(in float sx, in float sy, in float sw, in float sh);
   void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy);
+  void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy, in float dirtyX, in float dirtyY, in float dirtyWidth, in float dirtyHeight);
 
   // drawing text is not supported in this version of the API
   // (there is no way to predict what metrics the fonts will have,
@@ -15099,26 +15101,44 @@
 
   &lt;h6&gt;&lt;dfn&gt;Pixel manipulation&lt;/dfn&gt;&lt;/h6&gt;
 
+&lt;!--
+  &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-createImageData&quot;&gt;createImageData&lt;/span&gt;(in float sw, in float sh);
+  &lt;span&gt;ImageData&lt;/span&gt; &lt;span title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData&lt;/span&gt;(in float sx, in float sy, in float sw, in float sh);
+  void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy);
+  void &lt;span title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData&lt;/span&gt;(in &lt;span&gt;ImageData&lt;/span&gt; imagedata, in float dx, in float dy, in float dirtyX, in float dirtyY, in float dirtyWidth, in float dirtyHeight);
+--&gt;
+
   &lt;p&gt;The &lt;dfn
+  title=&quot;dom-context-2d-createImageData&quot;&gt;&lt;code&gt;createImageData(&lt;var
+  title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must
+  return an &lt;code&gt;ImageData&lt;/code&gt; object representing a rectangle
+  with a width in CSS pixels equal to the absolute magnitude of &lt;var
+  title=&quot;&quot;&gt;sw&lt;/var&gt;&lt;/span&gt; and a height in CSS pixels equal to the
+  absolute magnitude of &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;&lt;/span&gt;, filled with
+  transparent black.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
   title=&quot;dom-context-2d-getImageData&quot;&gt;&lt;code&gt;getImageData(&lt;var
   title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;,
   &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return an
   &lt;code&gt;ImageData&lt;/code&gt; object representing the underlying pixel data
-  for the area of the canvas denoted by the rectangle whose corners
-  are the four points (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var
+  for the area of the canvas denoted by the rectanglewhose corners are
+  the four points (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;),
+  (&lt;span&gt;&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;&lt;/span&gt;, &lt;var
   title=&quot;&quot;&gt;sy&lt;/var&gt;), (&lt;span&gt;&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;+&lt;var
-  title=&quot;&quot;&gt;sw&lt;/var&gt;&lt;/span&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;), (&lt;span&gt;&lt;var
-  title=&quot;&quot;&gt;sx&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;&lt;/span&gt;, &lt;span&gt;&lt;var
-  title=&quot;&quot;&gt;sy&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;&lt;/span&gt;), (&lt;var
-  title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;span&gt;&lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;+&lt;var
-  title=&quot;&quot;&gt;sh&lt;/var&gt;&lt;/span&gt;). Pixels outside the canvas must be
-  returned as transparent black. Pixels must be returned as
-  non-premultiplied alpha values.&lt;/p&gt;
+  title=&quot;&quot;&gt;sw&lt;/var&gt;&lt;/span&gt;, &lt;span&gt;&lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;+&lt;var
+  title=&quot;&quot;&gt;sh&lt;/var&gt;&lt;/span&gt;), (&lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;span&gt;&lt;var
+  title=&quot;&quot;&gt;sy&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;sh&lt;/var&gt;&lt;/span&gt;), in canvas
+  coordinate space units. Pixels outside the canvas must be returned
+  as transparent black. Pixels must be returned as non-premultiplied
+  alpha values.&lt;/p&gt;
 
   &lt;p&gt;If any of the arguments to &lt;code
-  title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData()&lt;/code&gt; are
-  infinite or NaN, the method must instead raise an
-  &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.&lt;/p&gt;
+  title=&quot;dom-context-2d-createImageData&quot;&gt;createImageData()&lt;/code&gt; or
+  &lt;code title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData()&lt;/code&gt; are
+  infinite or NaN, or if either the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; or &lt;var
+  title=&quot;&quot;&gt;sh&lt;/var&gt; arguments are zero, the method must instead raise
+  an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.&lt;/p&gt;
 
   &lt;p&gt;&lt;code&gt;ImageData&lt;/code&gt; objects must be initialised so that their
   &lt;dfn title=&quot;dom-imagedata-width&quot;&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; attribute
@@ -15141,7 +15161,7 @@
   attributes in &lt;code&gt;ImageData&lt;/code&gt; objects, are all read-only). On
   setting, JS &lt;code&gt;undefined&lt;/code&gt; values must be converted to zero.
   Other values must first be converted to numbers using JavaScript's
-  ToNumber algorithm, and if the result is not a number, a
+  ToNumber algorithm, and if the result is a NaN value, a
   &lt;code&gt;TYPE_MISMATCH_ERR&lt;/code&gt; exception must be raised. If the
   result is less than 0, it must be clamped to zero. If the result is
   more than 255, it must be clamped to 255. If the number is not an
@@ -15152,64 +15172,134 @@
 
   &lt;p class=&quot;note&quot;&gt;The width and height (&lt;var title=&quot;&quot;&gt;w&lt;/var&gt; and &lt;var
   title=&quot;&quot;&gt;h&lt;/var&gt;) might be different from the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;
-  and &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments to the function, e.g. if the
-  canvas is backed by a high-resolution bitmap, or if the &lt;var
+  and &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments to the above methods, e.g. if
+  the canvas is backed by a high-resolution bitmap, or if the &lt;var
   title=&quot;&quot;&gt;sw&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments are
   negative.&lt;/p&gt;
 
-  &lt;p&gt;If the &lt;code
-  title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData()&lt;/code&gt; method is
-  called with either the &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt; or &lt;var
-  title=&quot;&quot;&gt;sh&lt;/var&gt; arguments set to zero, the method must raise an
-  &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.&lt;/p&gt;
-
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-context-2d-putImageData&quot;&gt;&lt;code&gt;putImageData(&lt;var
   title=&quot;&quot;&gt;imagedata&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var
-  title=&quot;&quot;&gt;dy&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must take the given
-  &lt;code&gt;ImageData&lt;/code&gt; structure, and place it at the specified
-  location (&lt;var title=&quot;&quot;&gt;dx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dy&lt;/var&gt;) in the
-  canvas coordinate space, mapping each pixel represented by the
-  &lt;code&gt;ImageData&lt;/code&gt; structure into one device pixel.&lt;/p&gt;
+  title=&quot;&quot;&gt;dy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;dirtyY&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;, &lt;var
+  title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method writes data from
+  &lt;code&gt;ImageData&lt;/code&gt; structures back to the canvas.&lt;/p&gt;
 
-  &lt;p&gt;If the first argument to the method is not an object whose
-  [[Class]] property is &lt;code&gt;ImageData&lt;/code&gt;, but all of the
-  following conditions are true, then the method must treat the first
-  argument as if it was an &lt;code&gt;ImageData&lt;/code&gt; object (and thus not
-  raise the &lt;code&gt;TYPE_MISMATCH_ERR&lt;/code&gt; exception):&lt;/p&gt;
+  &lt;p&gt;If the first argment to the method is null or not an
+  &lt;code&gt;ImageData&lt;/code&gt; object that was returned by &lt;code
+  title=&quot;dom-context-2d-createImageData&quot;&gt;createImageData()&lt;/code&gt; or
+  &lt;code title=&quot;dom-context-2d-getImageData&quot;&gt;getImageData()&lt;/code&gt; then
+  the &lt;code title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData()&lt;/code&gt;
+  method must raise a &lt;code&gt;TYPE_MISMATCH_ERR&lt;/code&gt; exception.&lt;/p&gt;
 
-  &lt;ul&gt;
+  &lt;p&gt;If any of the arguments to the method are infinite or NaN, the
+  method must raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.&lt;/p&gt;
 
-   &lt;li&gt;The method's first argument is an object with &lt;code
-   title=&quot;dom-imagedata-width&quot;&gt;width&lt;/code&gt; and &lt;code
-   title=&quot;dom-imagedata-height&quot;&gt;height&lt;/code&gt; attributes with integer
-   values and a &lt;code title=&quot;dom-imagedata-data&quot;&gt;data&lt;/code&gt; attribute
-   whose value is an enumerable list of values that are either JS
-   Numbers or the JS value &lt;code&gt;undefined&lt;/code&gt;.&lt;/li&gt;
+  &lt;p&gt;When the last four arguments are omitted, they must be assumed to
+  have the values 0, 0, the &lt;code
+  title=&quot;dom-imagedata-width&quot;&gt;width&lt;/code&gt; member of the &lt;var
+  title=&quot;&quot;&gt;imagedata&lt;/var&gt; structure, and the &lt;code
+  title=&quot;dom-imagedata-height&quot;&gt;height&lt;/code&gt;member of the &lt;var
+  title=&quot;&quot;&gt;imagedata&lt;/var&gt; structure, respectively.&lt;/p&gt;
 
-   &lt;li&gt;The &lt;code&gt;ImageData&lt;/code&gt; object's &lt;code
-   title=&quot;dom-imagedata-width&quot;&gt;width&lt;/code&gt; is greater than
-   zero.&lt;/li&gt;
+  &lt;p&gt;When invoked with arguments that do not, per the last few
+  paragraphs, cause an exception to be raised, the &lt;code
+  title=&quot;dom-context-2d-putImageData&quot;&gt;putImageData()&lt;/code&gt; method
+  must act as follows:&lt;/p&gt;
 
-   &lt;li&gt;The &lt;code&gt;ImageData&lt;/code&gt; object's &lt;code
-   title=&quot;dom-imagedata-height&quot;&gt;height&lt;/code&gt; is greater than
-   zero.&lt;/li&gt;
+  &lt;ol&gt;
 
-   &lt;li&gt;The &lt;code&gt;ImageData&lt;/code&gt; object's &lt;code
-   title=&quot;dom-imagedata-width&quot;&gt;width&lt;/code&gt; multiplied by its &lt;code
-   title=&quot;dom-imagedata-height&quot;&gt;height&lt;/code&gt; multiplied by 4 is equal
-   to the number of entries in the &lt;code&gt;ImageData&lt;/code&gt; object's
-   &lt;code title=&quot;dom-imagedata-data&quot;&gt;data&lt;/code&gt; property.&lt;/li&gt;
+   &lt;li&gt;
 
-  &lt;/ul&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;dx&lt;sub&gt;device&lt;/sub&gt;&lt;/var&gt; be the x-coordinate
+    of the device pixel in the underlying pixel data of the canvas
+    corresponding to the &lt;var title=&quot;&quot;&gt;dx&lt;/var&gt; coordinate in the
+    canvas coordinate space.&lt;/p&gt;
 
-  &lt;p&gt;In the &lt;code title=&quot;dom-imagedata-data&quot;&gt;data&lt;/code&gt; property,
-  undefined values must be treated as zero, any numbers below zero
-  must be clamped to zero, any numbers above 255 must be clamped to
-  255, and any numbers that are not integers must be rounded to the
-  nearest integer using the IEEE 754r &lt;i&gt;roundTiesToEven&lt;/i&gt; rounding
-  mode. &lt;a href=&quot;#refsIEEE754r&quot;&gt;[IEEE754R]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;dy&lt;sub&gt;device&lt;/sub&gt;&lt;/var&gt; be the y-coordinate
+    of the device pixel in the underlying pixel data of the canvas
+    corresponding to the &lt;var title=&quot;&quot;&gt;dy&lt;/var&gt; coordinate in the
+    canvas coordinate space.&lt;/p&gt;
 
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; is negative, let &lt;var
+    title=&quot;&quot;&gt;dirtyX&lt;/var&gt; be &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;+&lt;var
+    title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;&lt;/span&gt;, and let &lt;var
+    title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; be equal to the absolute magnitude of
+    &lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; is negative, let &lt;var
+    title=&quot;&quot;&gt;dirtyY&lt;/var&gt; be &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;+&lt;var
+    title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;&lt;/span&gt;, and let &lt;var
+    title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; be equal to the absolute magnitude of
+    &lt;var title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt; is negative, let &lt;var
+    title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; be &lt;span&gt;&lt;var
+    title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;&lt;/span&gt;, and
+    let &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt; be zero.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt; is negative, let &lt;var
+    title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; be &lt;span&gt;&lt;var
+    title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;&lt;/span&gt;, and
+    let &lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt; be zero.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;+&lt;var
+    title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;&lt;/span&gt; is greater than the &lt;code
+    title=&quot;dom-imagedata-width&quot;&gt;width&lt;/code&gt; attribute of the &lt;var
+    title=&quot;&quot;&gt;imagedata&lt;/var&gt; argument, let &lt;var
+    title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt; be the value of that &lt;code
+    title=&quot;dom-imagedata-width&quot;&gt;width&lt;/code&gt; attribute, minus the
+    value of &lt;var title=&quot;&quot;&gt;dirtyX&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;+&lt;var
+    title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;&lt;/span&gt; is greater than the &lt;code
+    title=&quot;dom-imagedata-height&quot;&gt;height&lt;/code&gt; attribute of the &lt;var
+    title=&quot;&quot;&gt;imagedata&lt;/var&gt; argument, let &lt;var
+    title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; be the value of that &lt;code
+    title=&quot;dom-imagedata-height&quot;&gt;height&lt;/code&gt; attribute, minus the
+    value of &lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If, after those changes, either &lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;
+    or &lt;var title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt; is negative or zero, stop these
+    steps without affecting the canvas.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Otherwise, for all values of &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; and &lt;var
+   title=&quot;&quot;&gt;y&lt;/var&gt; where &lt;span&gt;&lt;var
+   title=&quot;&quot;&gt;dirtyX&lt;/var&gt;&nbsp;&le;&nbsp;&lt;var
+   title=&quot;&quot;&gt;x&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;span&gt;&lt;var
+   title=&quot;&quot;&gt;dirtyX&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;dirtyWidth&lt;/var&gt;&lt;/span&gt;&lt;/span&gt;
+   and &lt;span&gt;&lt;var title=&quot;&quot;&gt;dirtyY&lt;/var&gt;&nbsp;&le;&nbsp;&lt;var
+   title=&quot;&quot;&gt;y&lt;/var&gt;&nbsp;&lt;&nbsp;&lt;span&gt;&lt;var
+   title=&quot;&quot;&gt;dirtyY&lt;/var&gt;+&lt;var
+   title=&quot;&quot;&gt;dirtyHeight&lt;/var&gt;&lt;/span&gt;&lt;/span&gt;, copy the four channels of
+   thr pixel with coordinate (&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;, &lt;var
+   title=&quot;&quot;&gt;y&lt;/var&gt;) in the &lt;var title=&quot;&quot;&gt;imagedata&lt;/var&gt; data
+   structure to the pixel with coordinate (&lt;span&gt;&lt;var
+   title=&quot;&quot;&gt;x&lt;sub&gt;device&lt;/sub&gt;&lt;/var&gt;+&lt;var title=&quot;&quot;&gt;x&lt;/var&gt;&lt;/span&gt;,
+   &lt;span&gt;&lt;var title=&quot;&quot;&gt;y&lt;sub&gt;device&lt;/sub&gt;&lt;/var&gt;+&lt;var
+   title=&quot;&quot;&gt;y&lt;/var&gt;&lt;/span&gt;) in the underlying pixel data of the
+   canvas.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
   &lt;p&gt;The handling of pixel rounding when the specified coordinates do
   not exactly map to the device coordinate space is not defined by
   this specification, except that the following must result in no
@@ -15254,28 +15344,16 @@
 
    &lt;pre&gt;
   // canvas is a reference to a &lt;canvas&gt; element
-  // (note: this example uses JavaScript 1.7 features)
   var context = canvas.getContext('2d');
-  var backingStore = context.getImageData(0, 0, canvas.width, canvas.height);
-  var actualWidth = backingStore.width;
-  var actualHeight = backingStore.height;
 
-  function CreateImageData(w, h) {
-    return {
-      height: h,
-      width: w,
-      data: [i for (i in function (n) { for (let i = 0; i &lt; n; i += 1) yield 0 }(w*h*4)) ]
-    };
-  }
-
   // create a blank slate
-  var data = CreateImageData(actualWidth, actualHeight);
+  var data = context.createImageData(canvas.width, canvas.height);
 
   // create some plasma
   FillPlasma(data, 'green'); // green plasma
 
   // add a cloud to the plasma
-  AddCloud(data, actualWidth/2, actualHeight/2); // put a cloud in the middle
+  AddCloud(data, data.width/2, data.height/2); // put a cloud in the middle
 
   // paint the plasma+cloud on the canvas
   context.putImageData(data, 0, 0);
@@ -15314,13 +15392,18 @@
      // get the image data to manipulate
      var input = context.getImageData(0, 0, canvas.width, canvas.height);
 
-     // edge detection
+     // get an empty slate to put the data into
+     var output = context.crateImageData(canvas.width, canvas.height);
+
+     // alias some variables for convenience
      // notice that we are using input.width and input.height here
      // as they might not be the same as canvas.width and canvas.height
      // (in particular, they might be different on high-res displays)
      var w = input.width, h = input.height;
      var inputData = input.data;
-     var outputData = new Array(w*h*4);
+     var outputData = output.data;
+
+     // edge detection
      for (var y = 1; y &lt; h-1; y += 1) {
        for (var x = 1; x &lt; w-1; x += 1) {
          for (var c = 0; c &lt; 3; c += 1) {
@@ -15334,11 +15417,6 @@
      }
 
      // put the image data back after manipulation
-     var output = {
-       width: w,
-       height: h,
-       data: outputData
-     };
      context.putImageData(output, 0, 0);
    }
   &lt;/script&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008104.html">[html5] r1196 - /
</A></li>
	<LI>Next message: <A HREF="008106.html">[html5] r1198 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8105">[ date ]</a>
              <a href="thread.html#8105">[ thread ]</a>
              <a href="subject.html#8105">[ subject ]</a>
              <a href="author.html#8105">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
