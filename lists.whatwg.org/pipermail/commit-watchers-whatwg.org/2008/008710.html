<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1812 - [] (0) URLification of offline application cache	and of session history.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1812%20-%20%5B%5D%20%280%29%20URLification%20of%20offline%20application%20cache%0A%09and%20of%20session%20history.&In-Reply-To=%3C20080627015606.CB50B38E29F%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008709.html">
   <LINK REL="Next"  HREF="008711.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1812 - [] (0) URLification of offline application cache	and of session history.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1812%20-%20%5B%5D%20%280%29%20URLification%20of%20offline%20application%20cache%0A%09and%20of%20session%20history.&In-Reply-To=%3C20080627015606.CB50B38E29F%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1812 - [] (0) URLification of offline application cache	and of session history.">whatwg at whatwg.org
       </A><BR>
    <I>Thu Jun 26 18:56:06 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008709.html">[html5] r1811 - [g] (2) URLify the registerContentHandler()	section. This also modified the rule [...]
</A></li>
        <LI>Next message: <A HREF="008711.html">[html5] r1813 - [] (0) URLify Location.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8710">[ date ]</a>
              <a href="thread.html#8710">[ thread ]</a>
              <a href="subject.html#8710">[ subject ]</a>
              <a href="author.html#8710">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-06-26 18:56:06 -0700 (Thu, 26 Jun 2008)
New Revision: 1812

Modified:
   index
   source
Log:
[] (0) URLification of offline application cache and of session history.

Modified: index
===================================================================
--- index	2008-06-27 00:21:35 UTC (rev 1811)
+++ index	2008-06-27 01:56:06 UTC (rev 1812)
@@ -2856,6 +2856,14 @@
      script. (Such scripts would not be conforming, however, as &lt;code
      title=attr-xml-base&gt;&lt;a href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes
      are not allowed in &lt;a href=&quot;#html-&quot;&gt;HTML documents&lt;/a&gt;.)&lt;/p&gt;
+
+   &lt;dt&gt;If the URL to be resolved was found in an offline application cache
+    manifest
+
+   &lt;dd&gt;
+    &lt;p&gt;The base URL is the URL of the &lt;a href=&quot;#application0&quot;&gt;application
+     cache&lt;/a&gt; &lt;a href=&quot;#the-manifest&quot;
+     title=concept-appcache-manifest&gt;manifest&lt;/a&gt;.
   &lt;/dl&gt;
 
   &lt;p&gt;The &lt;dfn id=document0&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt;
@@ -32219,8 +32227,7 @@
   &lt;p&gt;The &lt;code title=dom-navigator-registerContentHandler&gt;&lt;a
    href=&quot;#registercontenthandler&quot;&gt;registerContentHandler()&lt;/a&gt;&lt;/code&gt; method
    would work equivalently, but for unknown MIME types instead of unknown
-   protocols.&lt;/p&gt;
-  &lt;!-- XXXURL XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX \(URI\|IRI\|URL\) --&gt;
+   protocols.
 
   &lt;h3 id=offline&gt;&lt;span class=secno&gt;5.7 &lt;/span&gt;Offline Web applications&lt;/h3&gt;
 
@@ -32231,20 +32238,18 @@
   &lt;p class=big-issue&gt;...
 
   &lt;h4 id=appcache&gt;&lt;span class=secno&gt;5.7.2 &lt;/span&gt;Application caches&lt;/h4&gt;
-  &lt;!-- XXXURL change to URL --&gt;
 
   &lt;p&gt;An &lt;dfn id=application0&gt;application cache&lt;/dfn&gt; is a collection of
-   resources. An application cache is identified by the URI of a resource
-   manifest which is used to populate the cache.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   resources. An application cache is identified by the &lt;a
+   href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; of a resource manifest which is used to
+   populate the cache.
 
   &lt;p&gt;Application caches are versioned, and there can be different instances
-   of caches for the same manifest URI, each having a different version. A
+   of caches for the same manifest URL, each having a different version. A
    cache is newer than another if it was created after the other (in other
-   words, caches in a group have a chronological order).&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   words, caches in a group have a chronological order).
 
-  &lt;p&gt;Each group of application caches for the same manifest URI have a common
+  &lt;p&gt;Each group of application caches for the same manifest URL have a common
    &lt;dfn id=update0 title=concept-appcache-status&gt;update status&lt;/dfn&gt;, which
    is one of the following: &lt;i&gt;idle&lt;/i&gt;, &lt;i&gt;checking&lt;/i&gt;, &lt;i&gt;downloading&lt;/i&gt;.
 
@@ -32267,9 +32272,9 @@
   &lt;p&gt;An application cache consists of:
 
   &lt;ul&gt;
-   &lt;li&gt; &lt;!-- XXXURL change to URL --&gt;
+   &lt;li&gt;
     &lt;p&gt;One of more resources (including their out-of-band metadata, such as
-     HTTP headers, if any), identified by URIs, each falling into one (or
+     HTTP headers, if any), identified by URLs, each falling into one (or
      more) of the following categories:&lt;/p&gt;
 
     &lt;dl&gt;
@@ -32284,9 +32289,9 @@
       attribute.
 
      &lt;dt&gt;&lt;dfn id=the-manifest title=concept-appcache-manifest&gt;The
-      manifest&lt;/dfn&gt; &lt;!-- XXXURL change to URL --&gt;
+      manifest&lt;/dfn&gt;
 
-     &lt;dd&gt;The resource corresponding to the URI that was given in an implicit
+     &lt;dd&gt;The resource corresponding to the URL that was given in an implicit
       entry's &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element's &lt;code
       title=attr-html-manifest&gt;&lt;a href=&quot;#manifest&quot;&gt;manifest&lt;/a&gt;&lt;/code&gt;
       attribute. The manifest is downloaded and processed during the &lt;a
@@ -32315,9 +32320,8 @@
 
      &lt;dt&gt;&lt;dfn id=opportunistically
       title=concept-appcache-oppcache&gt;Opportunistically cached entries&lt;/dfn&gt;
-      &lt;!-- XXXURL change to URL --&gt;
 
-     &lt;dd&gt;Resources whose URIs &lt;a href=&quot;#matches&quot;
+     &lt;dd&gt;Resources whose URLs &lt;a href=&quot;#matches&quot;
       title=concept-appcache-matches-oppcache&gt;matched&lt;/a&gt; an &lt;a
       href=&quot;#opportunistic&quot; title=concept-appcache-oppcache-ns&gt;opportunistic
       caching namespace&lt;/a&gt; when they were fetched, and were therefore cached
@@ -32329,26 +32333,23 @@
      &lt;dd&gt;Resources that were added to the cache by the &lt;code
       title=dom-appcache-add&gt;&lt;a href=&quot;#addurl&quot;&gt;add()&lt;/a&gt;&lt;/code&gt; method.
     &lt;/dl&gt;
-    &lt;!-- XXXURL change to URL --&gt;
-    &lt;p class=note&gt;A URI in the list can be flagged with multiple different
+
+    &lt;p class=note&gt;A URL in the list can be flagged with multiple different
      types, and thus an entry can end up being categorized as multiple
      entries. For example, an entry can be an explicit entry and a dynamic
      entry at the same time.&lt;/p&gt;
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;Zero or more &lt;dfn id=opportunistic
     title=concept-appcache-oppcache-ns&gt;opportunistic caching
-    namespaces&lt;/dfn&gt;: URIs, used as &lt;a href=&quot;#matches&quot;
+    namespaces&lt;/dfn&gt;: URLs, used as &lt;a href=&quot;#matches&quot;
     title=concept-appcache-matches-oppcache&gt;prefix match patterns&lt;/a&gt;, each
     of which is mapped to a &lt;a href=&quot;#fallback0&quot;
-    title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;. Each namespace URI
-    prefix, when parsed as a URI, has the &lt;a href=&quot;#same-origin&quot;&gt;same
+    title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;. Each namespace URL
+    prefix, when parsed as a URL, has the &lt;a href=&quot;#same-origin&quot;&gt;same
     origin&lt;/a&gt; as &lt;a href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;the
-    manifest&lt;/a&gt;.&lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
+    manifest&lt;/a&gt;.
 
-   &lt;li&gt;Zero or more URIs that form the &lt;dfn id=online
+   &lt;li&gt;Zero or more URLs that form the &lt;dfn id=online
     title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/dfn&gt;.
   &lt;/ul&gt;
 
@@ -32409,9 +32410,9 @@
      CHARACTER TABULATION (tab) characters, followed by a single U+0023
      NUMBER SIGN (#) character, followed by zero or more characters other
      than U+000A LINE FEED (LF) and U+000D CARRIAGE RETURN (CR) characters.&lt;/p&gt;
-    &lt;!-- XXXURL change to URL --&gt;
+
     &lt;p class=note&gt;Comments must be on a line on their own. If they were to be
-     included on a line with a URI, the &quot;#&quot; would be mistaken for part of a
+     included on a line with a URL, the &quot;#&quot; would be mistaken for part of a
      fragment identifier.&lt;/p&gt;
 
    &lt;dt&gt;A section header
@@ -32448,35 +32449,32 @@
 
     &lt;p&gt;When the current section is the explicit section or the online
      whitelist section, data lines must consist of zero or more U+0020 SPACE
-     and U+0009 CHARACTER TABULATION (tab) characters, a valid URI reference
-     or IRI reference to a resource other than the manifest itself, and then
-     zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
-     characters. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-     href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+     and U+0009 CHARACTER TABULATION (tab) characters, a &lt;a
+     href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; identifying a resource other than the
+     manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER
+     TABULATION (tab) characters.&lt;/p&gt;
 
     &lt;p&gt;When the current section is the fallback section, data lines must
      consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION
-     (tab) characters, a valid URI reference or IRI reference to a resource
-     other than the manifest itself, one or more U+0020 SPACE and U+0009
-     CHARACTER TABULATION (tab) characters, another valid URI reference or
-     IRI reference to a resource other than the manifest itself, and then
-     zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
-     characters. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-     href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-    &lt;!-- XXXURL change to URL --&gt;
-    &lt;p class=note&gt;The URI or IRI references in data lines can't be empty
-     strings, since those would be relative URIs to the manifest itself. Such
-     lines would be confused with blank or invalid lines, anyway.&lt;/p&gt;
+     (tab) characters, a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; identifying a
+     resource other than the manifest itself, one or more U+0020 SPACE and
+     U+0009 CHARACTER TABULATION (tab) characters, another &lt;a
+     href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; identifying a resource other than the
+     manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER
+     TABULATION (tab) characters.&lt;/p&gt;
+
+    &lt;p class=note&gt;The URLs in data lines can't be empty strings, since those
+     would be relative URLs to the manifest itself. Such lines would be
+     confused with blank or invalid lines, anyway.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;p&gt;Manifests may contain sections more than once. Sections may be empty.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+  &lt;p&gt;Manifests may contain sections more than once. Sections may be empty.
 
-  &lt;p&gt;URIs that are to be fallback pages associated with &lt;a
+  &lt;p&gt;URLs that are to be fallback pages associated with &lt;a
    href=&quot;#opportunistic&quot; title=concept-appcache-oppcache-ns&gt;opportunistic
    caching namespaces&lt;/a&gt;, and those namespaces themselves, must be given in
-   fallback sections, with the namespace being the first URI of the data
-   line, and the corresponding fallback page being the second URI. All the
+   fallback sections, with the namespace being the first URL of the data
+   line, and the corresponding fallback page being the second URL. All the
    other pages to be cached must be listed in explicit sections.
 
   &lt;p&gt;&lt;a href=&quot;#opportunistic&quot;
@@ -32484,25 +32482,22 @@
    must have the &lt;a href=&quot;#same-origin&quot;&gt;same origin&lt;/a&gt; as the manifest
    itself.
 
-  &lt;p&gt;An opportunistic caching namespace must not be listed more than once.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+  &lt;p&gt;An opportunistic caching namespace must not be listed more than once.
 
-  &lt;p&gt;URIs that the user agent is to put into the &lt;a href=&quot;#online&quot;
+  &lt;p&gt;URLs that the user agent is to put into the &lt;a href=&quot;#online&quot;
    title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt; must all be
-   specified in online whitelist sections. (This is needed for any URI that
-   the page is intending to use to communicate back to the server.)&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   specified in online whitelist sections. (This is needed for any URL that
+   the page is intending to use to communicate back to the server.)
 
-  &lt;p&gt;URIs in the online whitelist section must not also be listed in explicit
+  &lt;p&gt;URLs in the online whitelist section must not also be listed in explicit
    section, and must not be listed as fallback entries in the fallback
-   section. (URIs in the online whitelist section may match opportunistic
-   caching namespaces, however.)&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   section. (URLs in the online whitelist section may match opportunistic
+   caching namespaces, however.)
 
-  &lt;p&gt;Relative URIs must be given relative to the manifest's own URI.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL; maybe have explicit support for this in the URL section? --&gt;
+  &lt;p&gt;Relative URLs must be given relative to the manifest's own URL.
 
-  &lt;p&gt;URIs in manifests must not have fragment identifiers.
+  &lt;p&gt;URLs in manifests must not have fragment identifiers (i.e. the U+0023
+   NUMBER SIGN character isn't allowed in URLs in manifests).
 
   &lt;h5 id=parsing1&gt;&lt;span class=secno&gt;5.7.3.2. &lt;/span&gt;Parsing cache manifests&lt;/h5&gt;
 
@@ -32518,27 +32513,21 @@
    be replaced by U+FFFD REPLACEMENT CHARACTERs. (this isn't black-box
    testable since neither U+0000 nor U+FFFD are valid anywhere in the
    syntax and thus both will be treated the same anyway)--&gt;
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt; be an initially empty list of &lt;a
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; be an initially empty list of &lt;a
      href=&quot;#explicit&quot; title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; be an initially empty mapping of
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback URLs&lt;/var&gt; be an initially empty mapping of
      &lt;a href=&quot;#opportunistic&quot;
      title=concept-appcache-oppcache-ns&gt;opportunistic caching namespaces&lt;/a&gt;
      to &lt;a href=&quot;#fallback0&quot; title=concept-appcache-fallback&gt;fallback
      entries&lt;/a&gt;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;online whitelist URIs&lt;/var&gt; be an initially empty
-     list of URIs for a &lt;a href=&quot;#online&quot;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;online whitelist URLs&lt;/var&gt; be an initially empty
+     list of URLs for a &lt;a href=&quot;#online&quot;
      title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt;.
 
    &lt;li&gt;
@@ -32626,21 +32615,26 @@
     &lt;dl class=switch&gt;
      &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;explicit&quot;
 
-     &lt;dd&gt; &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is not a syntactically correct URI
-       reference or IRI reference, then jump back to the step labeled &quot;start
-       of line&quot;.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, resolve the URI reference or IRI reference to an absolute
-       URI or IRI, and drop the fragment identifier, if any.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Now, if the resource's URI has a different &lt;scheme&gt; component
-       than the manifest's URI (compared
-       case-insensitively&lt;!-- XXX ASCII --&gt;), then jump back to the step
-       labeled &quot;start of line&quot;.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, add this URI to the &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt;.&lt;/p&gt;
+     &lt;dd&gt;
+      &lt;p&gt;&lt;a href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; &lt;var
+       title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;
 
+      &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;If the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; has a
+       different &lt;a href=&quot;#ltschemegt&quot; title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
+       component than the manifest's URL (compared
+       case-insensitively&lt;!-- XXX ASCII
+      --&gt;), then jump back to the
+       step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Drop the &lt;a href=&quot;#ltfragmentgt&quot;
+       title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component of the resulting &lt;a
+       href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt;, if it has one.&lt;/p&gt;
+
+      &lt;p&gt;Add the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; to the &lt;var
+       title=&quot;&quot;&gt;explicit URLs&lt;/var&gt;.&lt;/p&gt;
+
      &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;fallback&quot;
 
      &lt;dd&gt;
@@ -32654,79 +32648,73 @@
        U+0020 SPACE or U+0009 CHARACTER TABULATION (tab) character in &lt;var
        title=&quot;&quot;&gt;line&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
 
-      &lt;p&gt;Strip any leading U+0020 SPACE or U+0009 CHARACTER TABULATION (tab)
-       characters in &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; are
-       not both syntactically correct URI or IRI references, then jump back
-       to the step labeled &quot;start of line&quot;.&lt;/p&gt;
-      &lt;!-- XXXURL use algorithms --&gt;
-      &lt;p&gt;Resolve the URI or IRI references in &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;
-       and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; to absolute URIs or IRIs, and drop
-       the fragment identifiers, if any.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var title=&quot;&quot;&gt;part
-       one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; mapping
-       as an &lt;a href=&quot;#opportunistic&quot;
+      &lt;p&gt;&lt;a href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; &lt;var
+       title=&quot;&quot;&gt;part one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If either fails, then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; corresponding to &lt;var
+       title=&quot;&quot;&gt;part one&lt;/var&gt; does not have the &lt;a href=&quot;#same-origin&quot;&gt;same
+       origin&lt;/a&gt; as the manifest's URL, then jump back to the step labeled
+       &quot;start of line&quot;.&lt;/p&gt;
+      &lt;!-- SECURITY --&gt;
+      &lt;p&gt;If the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; for &lt;var
+       title=&quot;&quot;&gt;part two has a different &lt;a href=&quot;#ltschemegt&quot;
+       title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component than the manifest's URL
+       (compared case-insensitively&lt;!-- XXX ASCII --&gt;), then jump back to the
+       step labeled &quot;start of line&quot;.&lt;/var&gt;&lt;/p&gt;
+
+      &lt;p&gt;Drop any the &lt;a href=&quot;#ltfragmentgt&quot;
+       title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; components of the resulting &lt;a
+       href=&quot;#absolute&quot; title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/a&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; corresponding to &lt;var
+       title=&quot;&quot;&gt;part one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback
+       URIs&lt;/var&gt; mapping as an &lt;a href=&quot;#opportunistic&quot;
        title=concept-appcache-oppcache-ns&gt;opportunistic caching
        namespace&lt;/a&gt;, then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var title=&quot;&quot;&gt;part
-       one&lt;/var&gt; does not have the &lt;a href=&quot;#same-origin&quot;&gt;same origin&lt;/a&gt; as
-       the manifest's URI, then jump back to the step labeled &quot;start of
-       line&quot;.&lt;/p&gt;
-      &lt;!-- SECURITY --&gt; &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var title=&quot;&quot;&gt;part
-       two&lt;/var&gt; has a different &lt;scheme&gt; component than the manifest's
-       URI (compared case-insensitively&lt;!-- XXX
-      ASCII --&gt;), then jump
-       back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, add the absolute URI or IRI corresponding to &lt;var
-       title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt;
-       mapping as an &lt;a href=&quot;#opportunistic&quot;
+
+      &lt;p&gt;Otherwise, add the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt;
+       corresponding to &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var
+       title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; mapping as an &lt;a href=&quot;#opportunistic&quot;
        title=concept-appcache-oppcache-ns&gt;opportunistic caching
-       namespace&lt;/a&gt;, mapped to the absolute URI corresponding to &lt;var
-       title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;a href=&quot;#fallback0&quot;
-       title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.&lt;/p&gt;
+       namespace&lt;/a&gt;, mapped to the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt;
+       corresponding to &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;a
+       href=&quot;#fallback0&quot; title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.&lt;/p&gt;
 
      &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;online whitelist&quot;
 
-     &lt;dd&gt; &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is not a syntactically correct URI
-       reference or IRI reference, then jump back to the step labeled &quot;start
-       of line&quot;.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, resolve the URI reference or IRI reference to an absolute
-       URI or IRI, and drop the fragment identifier, if any.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Now, if the resource's URI has a different &lt;scheme&gt; component
-       than the manifest's URI, then jump back to the step labeled &quot;start of
-       line&quot;.&lt;/p&gt;
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, add this URI to the &lt;var title=&quot;&quot;&gt;online whitelist
-       URIs&lt;/var&gt;.&lt;/p&gt;
+     &lt;dd&gt;
+      &lt;p&gt;&lt;a href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; &lt;var
+       title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;If the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; has a
+       different &lt;a href=&quot;#ltschemegt&quot; title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
+       component than the manifest's URL (compared
+       case-insensitively&lt;!-- XXX ASCII
+      --&gt;), then jump back to the
+       step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Drop the &lt;a href=&quot;#ltfragmentgt&quot;
+       title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component of the resulting &lt;a
+       href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt;, if it has one.&lt;/p&gt;
+
+      &lt;p&gt;Add the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; to the &lt;var
+       title=&quot;&quot;&gt;online whitelist URLs&lt;/var&gt;.&lt;/p&gt;
     &lt;/dl&gt;
 
    &lt;li&gt;
     &lt;p&gt;Jump back to the step labeled &quot;start of line&quot;. (That step jumps to the
      next, and last, step when the end of the file is reached.)
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt; list, the &lt;var
-     title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; mapping, and the &lt;var title=&quot;&quot;&gt;online
-     whitelist URIs&lt;/var&gt;.
+    &lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; list, the &lt;var
+     title=&quot;&quot;&gt;fallback URLs&lt;/var&gt; mapping, and the &lt;var title=&quot;&quot;&gt;online
+     whitelist URLs&lt;/var&gt;.
   &lt;/ol&gt;
-  &lt;!-- XXXURL change to URL --&gt;
 
-  &lt;p&gt;Relative URI references and IRI references resolved to absolute URIs or
-   IRIs in the above algorithm must be resolved according to section 5.1 of
-   RFC3986 (i.e. relative to the base URI from the encapsulating entity or
-   the URI used to retrieve the entity, since there is no way to embed a base
-   URI in the manifest itself). &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
-
   &lt;p class=note&gt;If a resource is listed in both the online whitelist and in
    the explicit section, then that resource will be downloaded and cached,
    but when the page tries to use this resource, the user agent will ignore
@@ -32748,26 +32736,21 @@
    ui the first time they cache themselves (right now the original cache is
    done without notifications to the browsing contexts)
 
-  &lt;ol&gt;&lt;!-- XXXURL change to URL --&gt;
-
+  &lt;ol&gt;
    &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt; be the URI of the &lt;a
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt; be the URL of the &lt;a
      href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;manifest&lt;/a&gt; of the
      cache to be updated.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; be the group of &lt;a
      href=&quot;#application0&quot; title=&quot;application cache&quot;&gt;application caches&lt;/a&gt;
-     identified by &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
+     identified by &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;.
 
    &lt;li&gt;
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; be the most recently updated &lt;a
      href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; identified by &lt;var
-     title=&quot;&quot;&gt;manifest URI&lt;/var&gt; (that is, the newest version found in &lt;var
+     title=&quot;&quot;&gt;manifest URL&lt;/var&gt; (that is, the newest version found in &lt;var
      title=&quot;&quot;&gt;cache group&lt;/var&gt;).
 
    &lt;li&gt;
@@ -32779,9 +32762,9 @@
      &lt;i&gt;checking&lt;/i&gt;. This entire step must be performed as one atomic
      operation so as to avoid race conditions.
 
-   &lt;li&gt; &lt;!-- XXXURL change to URL --&gt;
-    &lt;p&gt;If there is already a resource with the URI of &lt;var title=&quot;&quot;&gt;manifest
-     URI&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, and that resource is categorized
+   &lt;li&gt;
+    &lt;p&gt;If there is already a resource with the URL of &lt;var title=&quot;&quot;&gt;manifest
+     URL&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, and that resource is categorized
      as a &lt;a href=&quot;#the-manifest&quot;
      title=concept-appcache-manifest&gt;manifest&lt;/a&gt;, then this is an &lt;dfn
      id=upgrade title=concept-appcache-upgrade&gt;upgrade attempt&lt;/dfn&gt;.
@@ -32806,8 +32789,8 @@
      indicating to the user that the user agent is checking for the
      availability of updates.&lt;/p&gt;
 
-   &lt;li&gt; &lt;!-- XXXURL change to URL --&gt;
-    &lt;p&gt;Fetch the resource from &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt;, and let &lt;var
+   &lt;li&gt;
+    &lt;p&gt;Fetch the resource from &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;, and let &lt;var
      title=&quot;&quot;&gt;manifest&lt;/var&gt; be that resource.&lt;/p&gt;
 
     &lt;p&gt;If the resource is labeled with the MIME type &lt;code
@@ -32877,45 +32860,35 @@
      with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of
      this event should be the display of some sort of user interface
      indicating to the user that a new version is being downloaded.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
     &lt;p&gt;If this is an &lt;a href=&quot;#upgrade&quot;
      title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;, then let &lt;var
      title=&quot;&quot;&gt;new cache&lt;/var&gt; be a newly created &lt;a
      href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; identified by &lt;span
-     title=&quot;&quot;&gt;manifest URI&lt;/span&gt;, being a new version in &lt;var title=&quot;&quot;&gt;cache
+     title=&quot;&quot;&gt;manifest URL&lt;/span&gt;, being a new version in &lt;var title=&quot;&quot;&gt;cache
      group&lt;/var&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt; and &lt;var
      title=&quot;&quot;&gt;cache&lt;/var&gt; be the same version of the application cache.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; be an empty list of URIs with flags.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; be an empty list of URLs with flags.
 
    &lt;li&gt;
-    &lt;p&gt;Add all the URIs in the list of &lt;a href=&quot;#explicit&quot;
+    &lt;p&gt;Add all the URLs in the list of &lt;a href=&quot;#explicit&quot;
      title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt; obtained by parsing
      &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each
      flagged with &quot;explicit entry&quot;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Add all the URIs in the list of &lt;a href=&quot;#fallback0&quot;
+    &lt;p&gt;Add all the URLs in the list of &lt;a href=&quot;#fallback0&quot;
      title=concept-appcache-fallback&gt;fallback entries&lt;/a&gt; obtained by parsing
      &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each
      flagged with &quot;fallback entry&quot;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
     &lt;p&gt;If this is an &lt;a href=&quot;#upgrade&quot;
      title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;, then add all the
-     URIs of &lt;a href=&quot;#opportunistically&quot;
+     URLs of &lt;a href=&quot;#opportunistically&quot;
      title=concept-appcache-oppcache&gt;opportunistically cached entries&lt;/a&gt; in
      &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; that &lt;a href=&quot;#matches&quot;
      title=concept-appcache-matches-oppcache&gt;match&lt;/a&gt; the &lt;a
@@ -32923,35 +32896,29 @@
      caching namespaces&lt;/a&gt; obtained by parsing &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt;
      to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each flagged with &quot;opportunistic
      entry&quot;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
     &lt;p&gt;If this is an &lt;a href=&quot;#upgrade&quot;
      title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;, then add all the
-     URIs of &lt;a href=&quot;#implicit&quot; title=concept-appcache-implicit&gt;implicit
+     URLs of &lt;a href=&quot;#implicit&quot; title=concept-appcache-implicit&gt;implicit
      entries&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file
      list&lt;/var&gt;, each flagged with &quot;implicit entry&quot;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
     &lt;p&gt;If this is an &lt;a href=&quot;#upgrade&quot;
      title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;, then add all the
-     URIs of &lt;a href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic
+     URLs of &lt;a href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic
      entries&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file
      list&lt;/var&gt;, each flagged with &quot;dynamic entry&quot;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;If any URI is in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; more than once, then
-     merge the entries into one entry for that URI, that entry having all the
+    &lt;p&gt;If any URL is in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; more than once, then
+     merge the entries into one entry for that URL, that entry having all the
      flags that the original entries had.
 
-   &lt;li&gt; &lt;!-- XXXURL change to URL --&gt;
-    &lt;p&gt;For each URI in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, run the following
-     steps. These steps may be run in parallel for two or more of the URIs at
+   &lt;li&gt;
+    &lt;p&gt;For each URL in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, run the following
+     steps. These steps may be run in parallel for two or more of the URLs at
      a time.&lt;/p&gt;
 
     &lt;ol&gt;
@@ -32995,40 +32962,30 @@
      &lt;li&gt;
       &lt;p&gt;Otherwise, the fetching succeeded. Store the resource in the &lt;var
        title=&quot;&quot;&gt;new cache&lt;/var&gt;.
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li&gt;
-      &lt;p&gt;If the URI being processed was flagged as an &quot;explicit entry&quot; in
+      &lt;p&gt;If the URL being processed was flagged as an &quot;explicit entry&quot; in
        &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the entry as an &lt;a
        href=&quot;#explicit&quot; title=concept-appcache-explicit&gt;explicit entry&lt;/a&gt;.
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li&gt;
-      &lt;p&gt;If the URI being processed was flagged as a &quot;fallback entry&quot; in &lt;var
+      &lt;p&gt;If the URL being processed was flagged as a &quot;fallback entry&quot; in &lt;var
        title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the entry as a &lt;a
        href=&quot;#fallback0&quot; title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li&gt;
-      &lt;p&gt;If the URI being processed was flagged as a &quot;opportunistic entry&quot; in
+      &lt;p&gt;If the URL being processed was flagged as a &quot;opportunistic entry&quot; in
        &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the entry as an &lt;a
        href=&quot;#opportunistically&quot;
        title=concept-appcache-oppcache&gt;opportunistically cached entry&lt;/a&gt;.
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li&gt;
-      &lt;p&gt;If the URI being processed was flagged as an &quot;implicit entry&quot; in
+      &lt;p&gt;If the URL being processed was flagged as an &quot;implicit entry&quot; in
        &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the entry as a &lt;a
        href=&quot;#implicit&quot; title=concept-appcache-implicit&gt;implicit entry&lt;/a&gt;.
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li&gt;
-      &lt;p&gt;If the URI being processed was flagged as an &quot;dynamic entry&quot; in &lt;var
+      &lt;p&gt;If the URL being processed was flagged as an &quot;dynamic entry&quot; in &lt;var
        title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the entry as a &lt;a
        href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt;.
     &lt;/ol&gt;
@@ -33038,20 +32995,16 @@
      if it's not there already, and categorize this entry (whether newly
      added or not) as &lt;a href=&quot;#the-manifest&quot;
      title=concept-appcache-manifest&gt;the manifest&lt;/a&gt;.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
     &lt;p&gt;Store the list of &lt;a href=&quot;#opportunistic&quot;
      title=concept-appcache-oppcache-ns&gt;opportunistic caching namespaces&lt;/a&gt;,
-     and the URIs of the &lt;a href=&quot;#fallback0&quot;
+     and the URLs of the &lt;a href=&quot;#fallback0&quot;
      title=concept-appcache-fallback&gt;fallback entries&lt;/a&gt; that they map to,
      in the new cache.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Store the URIs that form the new &lt;a href=&quot;#online&quot;
+    &lt;p&gt;Store the URLs that form the new &lt;a href=&quot;#online&quot;
      title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt; in the new
      cache.
 
@@ -33073,10 +33026,10 @@
    &lt;li&gt;
     &lt;p&gt;If this is a &lt;a href=&quot;#cache&quot; title=concept-appcache-cache&gt;cache
      attempt&lt;/a&gt;, then:&lt;/p&gt;
-    &lt;!-- XXXURL change to URL --&gt;
+
     &lt;p id=flagAsCandidateForCache-result&gt;Associate any &lt;code&gt;Document&lt;/code&gt;
      objects that were &lt;a href=&quot;#flagAsCandidateForCache&quot;&gt;flagged as
-     candidates&lt;/a&gt; for this manifest URI's caches with &lt;var
+     candidates&lt;/a&gt; for this manifest URL's caches with &lt;var
      title=&quot;&quot;&gt;cache&lt;/var&gt;.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=&quot;#firing2&quot;&gt;Fire a simple event&lt;/a&gt; called &lt;code
@@ -33139,47 +33092,46 @@
   &lt;p&gt;The processing model of application caches for offline support in Web
    applications is part of the &lt;a href=&quot;#navigate&quot;
    title=navigate&gt;navigation&lt;/a&gt; model, but references the algorithms defined
-   in this section.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   in this section.
 
-  &lt;p&gt;A URI &lt;dfn id=matches title=concept-appcache-matches-oppcache&gt;matches an
+  &lt;p&gt;A URL &lt;dfn id=matches title=concept-appcache-matches-oppcache&gt;matches an
    opportunistic caching namespace&lt;/dfn&gt; if there exists an &lt;a
    href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; whose &lt;a href=&quot;#the-manifest&quot;
-   title=concept-appcache-manifest&gt;manifest&lt;/a&gt;'s URI has the &lt;a
-   href=&quot;#same-origin&quot;&gt;same origin&lt;/a&gt; as the URI in question, and if that
+   title=concept-appcache-manifest&gt;manifest&lt;/a&gt;'s URL has the &lt;a
+   href=&quot;#same-origin&quot;&gt;same origin&lt;/a&gt; as the URL in question, and if that
    application cache has an &lt;a href=&quot;#opportunistic&quot;
    title=concept-appcache-oppcache-ns&gt;opportunistic caching namespace&lt;/a&gt;
-   with a &lt;path&gt; component that exactly matches the start of the
-   &lt;path&gt; component of the URI being examined. If multiple
-   opportunistic caching namespaces match the same URI, the one with the
-   longest &lt;path&gt; component is the one that matches. A URI looking for
-   an opportunistic caching namespace can match more than one application
+   with a &lt;a href=&quot;#ltpathgt&quot; title=url-path&gt;&lt;path&gt;&lt;/a&gt; component that
+   exactly matches the start of the &lt;a href=&quot;#ltpathgt&quot;
+   title=url-path&gt;&lt;path&gt;&lt;/a&gt; component of the URL being examined. If
+   multiple opportunistic caching namespaces match the same URL, the one with
+   the longest &lt;path&gt; component is the one that matches. A URL looking
+   for an opportunistic caching namespace can match more than one application
    cache at a time, but only matches one namespace in each cache.
 
-  &lt;div class=example&gt; &lt;!-- XXXURL change to URL --&gt;
+  &lt;div class=example&gt;
    &lt;p&gt;If a manifest &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/app1/manifest&lt;/code">http://example.com/app1/manifest&lt;/code</A>&gt;
     declares that &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/resources/images&lt;/code">http://example.com/resources/images&lt;/code</A>&gt;
     should be opportunistically cached, and the user navigates to &lt;code
     title=&quot;&quot;&gt;<A HREF="http://example.com/resources/images/cat.png&lt;/code">http://example.com/resources/images/cat.png&lt;/code</A>&gt;, then the
     user agent will decide that the application cache identified by &lt;code
     title=&quot;&quot;&gt;<A HREF="http://example.com/app1/manifest&lt;/code">http://example.com/app1/manifest&lt;/code</A>&gt; contains a namespace
-    with a match for that URI.&lt;/p&gt;
+    with a match for that URL.&lt;/p&gt;
   &lt;/div&gt;
-  &lt;!-- XXXURL change to URL --&gt;
 
   &lt;p&gt;When the &lt;dfn id=application2
    title=concept-appcache-init-with-attribute&gt;application cache selection
-   algorithm&lt;/dfn&gt; algorithm is invoked with a manifest URI, the user agent
+   algorithm&lt;/dfn&gt; algorithm is invoked with a manifest URL, the user agent
    must run the first applicable set of steps from the following list:
 
   &lt;dl class=switch&gt;
    &lt;dt&gt;If the resource is not being loaded as part of navigation of a &lt;a
     href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt;
 
-   &lt;dd&gt; &lt;!-- XXXURL change to URL --&gt;
+   &lt;dd&gt;
     &lt;p&gt;As an optimization, if the resource was loaded from an &lt;a
-     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, and the manifest URI of that
-     cache doesn't match the manifest URI with which the algorithm was
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, and the manifest URL of that
+     cache doesn't match the manifest URL with which the algorithm was
      invoked, then the user agent should mark the entry in that application
      cache corresponding to the resource that was just loaded as being &lt;a
      href=&quot;#foreign&quot; title=concept-appcache-foreign&gt;foreign&lt;/a&gt;.&lt;/p&gt;
@@ -33188,22 +33140,19 @@
      caches.&lt;/p&gt;
    &lt;/dd&gt;
    &lt;!-- otherwise, we're talking top-level browsing contexts only: --&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;dt&gt;If the resource being loaded was loaded from an application cache and
-    the URI of that application cache's manifest is the same as the manifest
-    URI with which the algorithm was invoked
+    the URL of that application cache's manifest is the same as the manifest
+    URL with which the algorithm was invoked
 
    &lt;dd&gt;
     &lt;p&gt;Associate the &lt;code&gt;Document&lt;/code&gt; with the cache from which it was
      loaded. Invoke the &lt;a href=&quot;#application1&quot;&gt;application cache update
      process&lt;/a&gt;.&lt;/p&gt;
-   &lt;/dd&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;dt&gt;If the resource being loaded was loaded from an application cache and
-    the URI of that application cache's manifest is &lt;em&gt;not&lt;/em&gt; the same as
-    the manifest URI with which the algorithm was invoked
+    the URL of that application cache's manifest is &lt;em&gt;not&lt;/em&gt; the same as
+    the manifest URL with which the algorithm was invoked
 
    &lt;dd&gt;
     &lt;p&gt;Mark the entry for this resource in the application cache from which
@@ -33228,45 +33177,38 @@
     but it was loaded using HTTP GET or equivalent
 
    &lt;dd&gt;
-    &lt;ol&gt;&lt;!-- XXXURL change to URL --&gt;
-
+    &lt;ol&gt;
      &lt;li&gt;
-      &lt;p&gt;If the manifest URI does not have the &lt;a href=&quot;#same-origin&quot;&gt;same
-       origin&lt;/a&gt; as the resource's own URI, then invoke the &lt;a
+      &lt;p&gt;If the manifest URL does not have the &lt;a href=&quot;#same-origin&quot;&gt;same
+       origin&lt;/a&gt; as the resource's own URL, then invoke the &lt;a
        href=&quot;#application3&quot;
        title=concept-appcache-init-no-attribute&gt;application cache selection
        algorithm&lt;/a&gt; again, but without a manifest, and abort these steps.
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li&gt;
       &lt;p&gt;If there is already an &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;
-       identified by this manifest URI, and the most up to date version of
+       identified by this manifest URL, and the most up to date version of
        that &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; contains a resource
-       with the URI of the manifest, and that resource is categorized as a &lt;a
+       with the URL of the manifest, and that resource is categorized as a &lt;a
        href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;manifest&lt;/a&gt;,
        then: store the resource in the matching cache, categorized as an &lt;a
        href=&quot;#implicit&quot; title=concept-appcache-implicit&gt;implicit entry&lt;/a&gt;,
        associate the &lt;code&gt;Document&lt;/code&gt; with that cache, invoke the &lt;a
        href=&quot;#application1&quot;&gt;application cache update process&lt;/a&gt;, and abort
        these steps.
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li id=flagAsCandidateForCache&gt;
       &lt;p&gt;Flag the resource's &lt;code&gt;Document&lt;/code&gt; as a candidate for this
-       manifest URI's caches, so that it will be &lt;a
+       manifest URL's caches, so that it will be &lt;a
        href=&quot;#flagAsCandidateForCache-result&quot;&gt;associated with an application
-       cache identified by this manifest URI&lt;/a&gt; later, when such an &lt;a
+       cache identified by this manifest URL&lt;/a&gt; later, when such an &lt;a
        href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; is ready.
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li&gt;
       &lt;p&gt;If there is already an &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;
-       identified by this manifest URI, then the most up to date version of
+       identified by this manifest URL, then the most up to date version of
        that &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; does not yet
-       contain a resource with the URI of the manifest, or it does but that
+       contain a resource with the URL of the manifest, or it does but that
        resource is not yet categorized as a &lt;a href=&quot;#the-manifest&quot;
        title=concept-appcache-manifest&gt;manifest&lt;/a&gt;: store the resource in
        that cache, categorized as an &lt;a href=&quot;#implicit&quot;
@@ -33275,13 +33217,11 @@
        removing any other categories it might have), and abort these steps.
        (An &lt;a href=&quot;#application1&quot;&gt;application cache update process&lt;/a&gt; is
        already in progress.)
-     &lt;/li&gt;
-     &lt;!-- XXXURL change to URL --&gt;
 
      &lt;li&gt;
       &lt;p&gt;Otherwise, there is no matching &lt;a href=&quot;#application0&quot;&gt;application
        cache&lt;/a&gt;: create a new application cache identified by this manifest
-       URI, store the resource in that cache, categorized as an &lt;a
+       URL, store the resource in that cache, categorized as an &lt;a
        href=&quot;#implicit&quot; title=concept-appcache-implicit&gt;implicit entry&lt;/a&gt;,
        and then invoke the &lt;a href=&quot;#application1&quot;&gt;application cache update
        process&lt;/a&gt;.
@@ -33318,19 +33258,15 @@
    &lt;li&gt;
     &lt;p&gt;If the resource is not to be fetched using the HTTP GET mechanism or
      equivalent, then fetch the resource normally and abort these steps.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;If the resource's URI, ignoring its fragment identifier if any, is
+    &lt;p&gt;If the resource's URL, ignoring its fragment identifier if any, is
      listed in the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;'s &lt;a
      href=&quot;#online&quot; title=concept-appcache-onlinewhitelist&gt;online
      whitelist&lt;/a&gt;, then fetch the resource normally and abort these steps.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;If the resource's URI is &lt;a href=&quot;#implicit&quot;
+    &lt;p&gt;If the resource's URL is &lt;a href=&quot;#implicit&quot;
      title=concept-appcache-implicit&gt;an implicit entry&lt;/a&gt;, &lt;a
      href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;the manifest&lt;/a&gt;,
      &lt;a href=&quot;#explicit&quot; title=concept-appcache-explicit&gt;an explicit
@@ -33341,11 +33277,11 @@
      entry&lt;/a&gt; in the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, then
      fetch the resource from the cache and abort these steps.
 
-   &lt;li&gt; &lt;!-- XXXURL change to URL --&gt;
-    &lt;p&gt;If the resource's URI has the &lt;a href=&quot;#same-origin&quot;&gt;same origin&lt;/a&gt;
-     as the manifest's URI, and the start of the resource's URI's
-     &lt;path&gt; component is exactly matched by the &lt;path&gt; component
-     of an &lt;a href=&quot;#opportunistic&quot;
+   &lt;li&gt;
+    &lt;p&gt;If the resource's URL has the &lt;a href=&quot;#same-origin&quot;&gt;same origin&lt;/a&gt;
+     as the manifest's URL, and the start of the resource's URL's &lt;a
+     href=&quot;#ltpathgt&quot; title=url-path&gt;&lt;path&gt;&lt;/a&gt; component is exactly
+     matched by the &lt;path&gt; component of an &lt;a href=&quot;#opportunistic&quot;
      title=concept-appcache-oppcache-ns&gt;opportunistic caching namespace&lt;/a&gt;
      in the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, then:
 
@@ -33498,11 +33434,10 @@
    title=dom-appcache-add&gt;&lt;a href=&quot;#addurl&quot;&gt;add()&lt;/a&gt;&lt;/code&gt; method, with the
    oldest entry being the zeroth entry, and the most recently added entry
    having the index &lt;span&gt;&lt;code title=dom-appcache-length&gt;&lt;a
-   href=&quot;#length8&quot;&gt;length&lt;/a&gt;&lt;/code&gt;-1&lt;/span&gt;.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   href=&quot;#length8&quot;&gt;length&lt;/a&gt;&lt;/code&gt;-1&lt;/span&gt;.
 
   &lt;p&gt;The &lt;dfn id=itemindex4 title=dom-appcache-item&gt;&lt;code&gt;item(&lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the absolute URI of
+   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the absolute URL of
    the &lt;a href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt;
    with index &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; from the &lt;a
    href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, if one is associated with the
@@ -33521,23 +33456,13 @@
     &lt;p&gt;If the &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
      object is not associated with any application cache, then raise an
      &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these steps.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; is not a valid URI reference, then raise a
-     &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception and abort these steps. &lt;a
-     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
+    &lt;p&gt;&lt;a href=&quot;#resolve&quot; title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; the &lt;var
+     title=&quot;&quot;&gt;url&lt;/var&gt; argument. If this fails, raise a
+     &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception and abort these steps.
 
    &lt;li&gt;
-    &lt;p class=big-issue&gt;resolve relative URIs; on failure, raise a
-     &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
-
-   &lt;li&gt;
     &lt;p&gt;If there is already a resource in in the &lt;a
      href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which the &lt;code&gt;&lt;a
      href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is
@@ -33545,18 +33470,14 @@
      that entry is categorized as a &lt;a href=&quot;#dynamic3&quot;
      title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt; and return and abort
      these steps.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL --&gt;
 
    &lt;li&gt;
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a different &lt;scheme&gt; component than
-     the manifest's URI, then raise a &lt;a href=&quot;#security9&quot;&gt;security
-     exception&lt;/a&gt;.
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a different &lt;a href=&quot;#ltschemegt&quot;
+     title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component than the manifest's URL,
+     then raise a &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;.
 
    &lt;li&gt;
     &lt;p&gt;Return, but do not abort these steps.
-   &lt;/li&gt;
-   &lt;!-- XXXURL change to URL, maybe xref &quot;fetch&quot;? --&gt;
 
    &lt;li&gt;
     &lt;p&gt;Fetch the resource referenced by &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.
@@ -33586,17 +33507,17 @@
    target of Progress Events, much like the &lt;a
    href=&quot;<A HREF="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/XMLHttpRequest-2/Overview.html?content-type=text/html;%20charset=utf-8#xmlhttprequesteventtarget-interface">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/XMLHttpRequest-2/Overview.html?content-type=text/html;%20charset=utf-8#xmlhttprequesteventtarget-interface</A>&quot;&gt;XMLHttpRequestEventTarget&lt;/a&gt;
    interface. This would also make this far more complex to spec and
-   implement.&lt;/p&gt;
-  &lt;!-- XXXURL algorithms --&gt;
+   implement.
 
   &lt;p&gt;The &lt;dfn id=remove2 title=dom-appcache-remove&gt;&lt;code&gt;remove(&lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must remove the &lt;a
-   href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt;
-   categorization of any entry with the address &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in
-   the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which the &lt;code&gt;&lt;a
-   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is associated.
-   &lt;span class=big-issue&gt;Resolve relative URIs... (ignore syntax
-   errors)&lt;/span&gt; If this removes the last categorization of an entry in that
+   title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must &lt;a href=&quot;#resolve&quot;
+   title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument
+   and, if that is successful, remove the &lt;a href=&quot;#dynamic3&quot;
+   title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt; categorization of any
+   entry whose address is the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt;
+   in the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which the
+   &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is
+   associated. If this removes the last categorization of an entry in that
    cache, then the entry must be removed entirely (such that if it is
    re-added, it will be loaded from the network again). If the &lt;code&gt;&lt;a
    href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is not
@@ -33776,22 +33697,20 @@
    return the object implementing the &lt;code&gt;&lt;a
    href=&quot;#history2&quot;&gt;History&lt;/a&gt;&lt;/code&gt; interface for that &lt;code&gt;&lt;a
    href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object's &lt;a href=&quot;#active&quot;&gt;active
-   document&lt;/a&gt;.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   document&lt;/a&gt;.
 
   &lt;p&gt;&lt;code&gt;&lt;a href=&quot;#history2&quot;&gt;History&lt;/a&gt;&lt;/code&gt; objects represent their &lt;a
    href=&quot;#browsing1&quot;&gt;browsing context&lt;/a&gt;'s session history as a flat list of
    &lt;a href=&quot;#session0&quot; title=&quot;session history entry&quot;&gt;session history
    entries&lt;/a&gt;. Each &lt;dfn id=session0&gt;session history entry&lt;/dfn&gt; consists of
-   either a URI or a &lt;a href=&quot;#state&quot;&gt;state object&lt;/a&gt;, or both, and may in
-   addition have a title, a &lt;code&gt;Document&lt;/code&gt; object, form data, a scroll
-   position, and other information associated with it.
+   either a &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; or a &lt;a href=&quot;#state&quot;&gt;state object&lt;/a&gt;, or
+   both, and may in addition have a title, a &lt;code&gt;Document&lt;/code&gt; object,
+   form data, a scroll position, and other information associated with it.
 
   &lt;p class=note&gt;This does not imply that the user interface need be linear.
-   See the &lt;a href=&quot;#history-notes&quot;&gt;notes below&lt;/a&gt;.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   See the &lt;a href=&quot;#history-notes&quot;&gt;notes below&lt;/a&gt;.
 
-  &lt;p&gt;URIs without associated &lt;a href=&quot;#state&quot; title=&quot;state object&quot;&gt;state
+  &lt;p&gt;URLs without associated &lt;a href=&quot;#state&quot; title=&quot;state object&quot;&gt;state
    objects&lt;/a&gt; are added to the session history as the user (or script)
    navigates from page to page.
 
@@ -33848,20 +33767,18 @@
    algorithms given below, act as if they had not. When the user or script
    navigates back or forwards to a page which has no in-memory DOM objects,
    any other entries that shared the same &lt;code&gt;Document&lt;/code&gt; object with
-   it must share the new object as well.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   it must share the new object as well.
 
-  &lt;p&gt;When state object entries are added, a URI can be provided. This URI is
+  &lt;p&gt;When state object entries are added, a URL can be provided. This URL is
    used to replace the state object entry if the &lt;code&gt;Document&lt;/code&gt; is
-   evicted.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+   evicted.
 
   &lt;p&gt;When a user agent discards the DOM from an entry in the session history,
    it must also discard all the entries that share that &lt;code&gt;Document&lt;/code&gt;
-   but do not have an associated URI (i.e. entries that only have a &lt;a
+   but do not have an associated URL (i.e. entries that only have a &lt;a
    href=&quot;#state&quot;&gt;state object&lt;/a&gt;). Entries that shared that
    &lt;code&gt;Document&lt;/code&gt; object but had a state object and have a different
-   URI must then have their &lt;em&gt;state objects&lt;/em&gt; removed. Removed entries
+   URL must then have their &lt;em&gt;state objects&lt;/em&gt; removed. Removed entries
    are not recreated if the user or script navigates back to the page. If
    there are no state object entries for that &lt;code&gt;Document&lt;/code&gt; object
    then no entries are removed.
@@ -33952,48 +33869,67 @@
   &lt;p&gt;The &lt;dfn id=pushstate title=dom-history-pushState&gt;&lt;code&gt;pushState(&lt;var
    title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;title&lt;/var&gt;, &lt;var
    title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method adds a state object to the
-   history.&lt;/p&gt;
-  &lt;!-- XXXURL algorithms XXXDOCURL --&gt;
+   history.
 
-  &lt;p&gt;When this method is invoked, the user agent must first check the third
-   argument. If a third argument is specified, then the user agent must
-   verify that the third argument is a valid URI or IRI (as defined by RFC
-   3986 and 3987), and if so, that, after resolving it to an absolute URI, it
-   is either identical to &lt;span&gt;the document's address&lt;/span&gt;, or that it
-   differs from that address only in the &lt;query&gt;, &lt;abs_path&gt;,
-   and/or &lt;fragment&gt; parts, as applicable (the &lt;query&gt; and
-   &lt;abs_path&gt; parts can only be the same if the document's URI uses a
-   hierarchical &lt;scheme&gt;). If the verification fails (either because
-   the argument is syntactically incorrect, or differs in a way not described
-   as acceptable in the previous sentence) then the user agent must raise a
-   &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;. &lt;a
-   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
+  &lt;p&gt;When this method is invoked, the user agent must run the following
+   steps:
 
-  &lt;p&gt;If the third argument passes its verification step, or if the third
-   argument was omitted, then the user agent must remove from the &lt;a
-   href=&quot;#session&quot;&gt;session history&lt;/a&gt; any entries for that
-   &lt;code&gt;Document&lt;/code&gt; from the entry after the &lt;a href=&quot;#current1&quot;&gt;current
-   entry&lt;/a&gt; up to the last entry in the session history that references the
-   same &lt;code&gt;Document&lt;/code&gt; object, if any. If the &lt;a
-   href=&quot;#current1&quot;&gt;current entry&lt;/a&gt; is the last entry in the session
-   history, or if there are no entries after the &lt;a href=&quot;#current1&quot;&gt;current
-   entry&lt;/a&gt; that reference the same &lt;code&gt;Document&lt;/code&gt; object, then no
-   entries are removed.&lt;/p&gt;
-  &lt;!-- XXXURL change to URL --&gt;
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;If a third argument is specified, run these substeps:&lt;/p&gt;
 
-  &lt;p&gt;Then, the user agent must add a state object entry to the session
-   history, after the &lt;a href=&quot;#current1&quot;&gt;current entry&lt;/a&gt;, with the
-   specified &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; as the state object, the given &lt;var
-   title=&quot;&quot;&gt;title&lt;/var&gt; as the title, and, if the third argument is present,
-   the given &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the URI of the entry.
+    &lt;ol&gt;
+     &lt;li&gt;&lt;a href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the value of
+      the third argument.
 
-  &lt;p&gt;Then, the user agent must set this new entry as being the &lt;a
-   href=&quot;#last-activated&quot;&gt;last activated entry&lt;/a&gt; for the
-   &lt;code&gt;Document&lt;/code&gt;.
+     &lt;li&gt;If that fails, raise a &lt;a href=&quot;#security9&quot;&gt;security exception&lt;/a&gt;
+      and abort the &lt;code title=dom-history-pushState&gt;&lt;a
+      href=&quot;#pushstate&quot;&gt;pushState()&lt;/a&gt;&lt;/code&gt; steps.
 
-  &lt;p&gt;Finally, the user agent must update the &lt;a href=&quot;#current1&quot;&gt;current
-   entry&lt;/a&gt; to be the this newly added entry.
+     &lt;li&gt;Compare the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; to
+      &lt;span&gt;the document's address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;. If any part of
+      these two &lt;a href=&quot;#url&quot; title=URL&gt;URLs&lt;/a&gt; differ other than the &lt;a
+      href=&quot;#ltpathgt&quot; title=url-path&gt;&lt;path&gt;&lt;/a&gt;, &lt;a href=&quot;#ltquerygt&quot;
+      title=url-query&gt;&lt;query&gt;&lt;/a&gt;, and &lt;a href=&quot;#ltfragmentgt&quot;
+      title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; components, then raise a &lt;a
+      href=&quot;#security9&quot;&gt;security exception&lt;/a&gt; and abort the &lt;code
+      title=dom-history-pushState&gt;&lt;a href=&quot;#pushstate&quot;&gt;pushState()&lt;/a&gt;&lt;/code&gt;
+      steps.
+    &lt;/ol&gt;
 
+    &lt;p&gt;For the purposes of the comparison in the above substeps, the &lt;a
+     href=&quot;#ltpathgt&quot; title=url-path&gt;&lt;path&gt;&lt;/a&gt; and &lt;a
+     href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt; components can only
+     be the same if the URLs use a hierarchical &lt;a href=&quot;#ltschemegt&quot;
+     title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Remove from the &lt;a href=&quot;#session&quot;&gt;session history&lt;/a&gt; any entries for
+     the &lt;code&gt;Document&lt;/code&gt; from the entry after the &lt;a
+     href=&quot;#current1&quot;&gt;current entry&lt;/a&gt; up to the last entry in the session
+     history that references the same &lt;code&gt;Document&lt;/code&gt; object, if any.
+     If the &lt;a href=&quot;#current1&quot;&gt;current entry&lt;/a&gt; is the last entry in the
+     session history, or if there are no entries after the &lt;a
+     href=&quot;#current1&quot;&gt;current entry&lt;/a&gt; that reference the same
+     &lt;code&gt;Document&lt;/code&gt; object, then no entries are removed.
+
+   &lt;li&gt;
+    &lt;p&gt;Add a state object entry to the session history, after the &lt;a
+     href=&quot;#current1&quot;&gt;current entry&lt;/a&gt;, with the specified &lt;var
+     title=&quot;&quot;&gt;data&lt;/var&gt; as the state object, the given &lt;var
+     title=&quot;&quot;&gt;title&lt;/var&gt; as the title, and, if the third argument is
+     present, the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; that was found in the
+     first step as the URL of the entry.
+
+   &lt;li&gt;
+    &lt;p&gt;Set this new entry as being the &lt;a href=&quot;#last-activated&quot;&gt;last
+     activated entry&lt;/a&gt; for the &lt;code&gt;Document&lt;/code&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;Update the &lt;a href=&quot;#current1&quot;&gt;current entry&lt;/a&gt; to be the this newly
+     added entry.
+  &lt;/ol&gt;
+
   &lt;p class=note&gt;The &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; is purely advisory. User agents
    might use the title in the user interface.
 
@@ -34048,6 +33984,7 @@
      bubbles but is not cancelable and has no default action.
   &lt;/ol&gt;
   &lt;!-- XXX onpopstate should be defined somewhere --&gt;
+  &lt;!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXURL \(url\|uri\|iri\) --&gt;
   &lt;!-- XXXURL check with DOM3 Events --&gt;
 
   &lt;pre

Modified: source
===================================================================
--- source	2008-06-27 00:21:35 UTC (rev 1811)
+++ source	2008-06-27 01:56:06 UTC (rev 1812)
@@ -1118,6 +1118,13 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;If the URL to be resolved was found in an offline application
+   cache manifest&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The base URL is the URL of the &lt;span&gt;application
+   cache&lt;/span&gt; &lt;span
+   title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+
   &lt;/dl&gt;
 
   &lt;p&gt;The &lt;dfn&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; is
@@ -29871,7 +29878,6 @@
   method would work equivalently, but for unknown MIME types instead
   of unknown protocols.&lt;/p&gt;
 
-  &lt;!-- XXXURL XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX \(URI\|IRI\|URL\) --&gt;
 
 
 
@@ -29886,20 +29892,17 @@
 
   &lt;h4 id=&quot;appcache&quot;&gt;Application caches&lt;/h4&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
   &lt;p&gt;An &lt;dfn&gt;application cache&lt;/dfn&gt; is a collection of resources. An
-  application cache is identified by the URI of a resource
-  manifest which is used to populate the cache.&lt;/p&gt;
+  application cache is identified by the &lt;span&gt;absolute URL&lt;/span&gt; of
+  a resource manifest which is used to populate the cache.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
   &lt;p&gt;Application caches are versioned, and there can be different
-  instances of caches for the same manifest URI, each having a
+  instances of caches for the same manifest URL, each having a
   different version. A cache is newer than another if it was created
   after the other (in other words, caches in a group have a
   chronological order).&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;Each group of application caches for the same manifest URI have a
+  &lt;p&gt;Each group of application caches for the same manifest URL have a
   common &lt;dfn title=&quot;concept-appcache-status&quot;&gt;update status&lt;/dfn&gt;,
   which is one of the following: &lt;i&gt;idle&lt;/i&gt;, &lt;i&gt;checking&lt;/i&gt;,
   &lt;i&gt;downloading&lt;/i&gt;.&lt;/p&gt;
@@ -29926,9 +29929,8 @@
 
    &lt;li&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
     &lt;p&gt;One of more resources (including their out-of-band metadata,
-    such as HTTP headers, if any), identified by URIs, each falling
+    such as HTTP headers, if any), identified by URLs, each falling
     into one (or more) of the following categories:&lt;/p&gt;
 
     &lt;dl&gt;
@@ -29944,8 +29946,7 @@
  
      &lt;dt&gt;&lt;dfn title=&quot;concept-appcache-manifest&quot;&gt;The manifest&lt;/dfn&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
-     &lt;dd&gt;The resource corresponding to the URI that was given in an
+     &lt;dd&gt;The resource corresponding to the URL that was given in an
      implicit entry's &lt;code&gt;html&lt;/code&gt; element's &lt;code
      title=&quot;attr-html-manifest&quot;&gt;manifest&lt;/code&gt; attribute. The
      manifest is downloaded and processed during the &lt;span&gt;application
@@ -29974,8 +29975,7 @@
  
      &lt;dt&gt;&lt;dfn title=&quot;concept-appcache-oppcache&quot;&gt;Opportunistically cached entries&lt;/dfn&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
-     &lt;dd&gt;Resources whose URIs &lt;span
+     &lt;dd&gt;Resources whose URLs &lt;span
      title=&quot;concept-appcache-matches-oppcache&quot;&gt;matched&lt;/span&gt; an &lt;span
      title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
      namespace&lt;/span&gt; when they were fetched, and were therefore
@@ -29989,27 +29989,24 @@
 
     &lt;/dl&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
-    &lt;p class=&quot;note&quot;&gt;A URI in the list can be flagged with multiple
+    &lt;p class=&quot;note&quot;&gt;A URL in the list can be flagged with multiple
     different types, and thus an entry can end up being categorized as
     multiple entries. For example, an entry can be an explicit entry
     and a dynamic entry at the same time.&lt;/p&gt;
 
    &lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;Zero or more &lt;dfn
    title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
-   namespaces&lt;/dfn&gt;: URIs, used as &lt;span
+   namespaces&lt;/dfn&gt;: URLs, used as &lt;span
    title=&quot;concept-appcache-matches-oppcache&quot;&gt;prefix match
    patterns&lt;/span&gt;, each of which is mapped to a &lt;span
    title=&quot;concept-appcache-fallback&quot;&gt;fallback entry&lt;/span&gt;. Each
-   namespace URI prefix, when parsed as a URI, has the &lt;span&gt;same
+   namespace URL prefix, when parsed as a URL, has the &lt;span&gt;same
    origin&lt;/span&gt; as &lt;span title=&quot;concept-appcache-manifest&quot;&gt;the
    manifest&lt;/span&gt;.&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;Zero or more URIs that form the &lt;dfn
+   &lt;li&gt;Zero or more URLs that form the &lt;dfn
    title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/dfn&gt;.
 
   &lt;/ul&gt;
@@ -30078,9 +30075,8 @@
     characters other than U+000A LINE FEED (LF) and U+000D CARRIAGE
     RETURN (CR) characters.&lt;/p&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
     &lt;p class=&quot;note&quot;&gt;Comments must be on a line on their own. If they
-    were to be included on a line with a URI, the &quot;#&quot; would be
+    were to be included on a line with a URL, the &quot;#&quot; would be
     mistaken for part of a fragment identifier.&lt;/p&gt;
 
    &lt;dt&gt;A section header
@@ -30117,42 +30113,35 @@
 
     &lt;p&gt;When the current section is the explicit section or the online
     whitelist section, data lines must consist of zero or more U+0020
-    SPACE and U+0009 CHARACTER TABULATION (tab) characters, a valid
-    URI reference or IRI reference to a resource other than the
+    SPACE and U+0009 CHARACTER TABULATION (tab) characters, a
+    &lt;span&gt;valid URL&lt;/span&gt; identifying a resource other than the
     manifest itself, and then zero or more U+0020 SPACE and U+0009
-    CHARACTER TABULATION (tab) characters. &lt;a
-    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+    CHARACTER TABULATION (tab) characters.&lt;/p&gt;
 
     &lt;p&gt;When the current section is the fallback section, data lines
     must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
-    TABULATION (tab) characters, a valid URI reference or IRI
-    reference to a resource other than the manifest itself, one or
-    more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
-    characters, another valid URI reference or IRI reference to a
-    resource other than the manifest itself, and then zero or more
-    U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters. &lt;a
-    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+    TABULATION (tab) characters, a &lt;span&gt;valid URL&lt;/span&gt; identifying
+    a resource other than the manifest itself, one or more U+0020
+    SPACE and U+0009 CHARACTER TABULATION (tab) characters, another
+    &lt;span&gt;valid URL&lt;/span&gt; identifying a resource other than the
+    manifest itself, and then zero or more U+0020 SPACE and U+0009
+    CHARACTER TABULATION (tab) characters.&lt;/p&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
-    &lt;p class=&quot;note&quot;&gt;The URI or IRI references in data lines can't be
-    empty strings, since those would be relative URIs to the manifest
-    itself. Such lines would be confused with blank or invalid lines,
-    anyway.&lt;/p&gt;
+    &lt;p class=&quot;note&quot;&gt;The URLs in data lines can't be empty strings,
+    since those would be relative URLs to the manifest itself. Such
+    lines would be confused with blank or invalid lines, anyway.&lt;/p&gt;
 
   &lt;/dl&gt;
 
   &lt;p&gt;Manifests may contain sections more than once. Sections may be
   empty.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;URIs that are to be fallback pages associated with &lt;span
+  &lt;p&gt;URLs that are to be fallback pages associated with &lt;span
   title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
   namespaces&lt;/span&gt;, and those namespaces themselves, must be given in
-  fallback sections, with the namespace being the first URI of the
+  fallback sections, with the namespace being the first URL of the
   data line, and the corresponding fallback page being the second
-  URI. All the other pages to be cached must be listed in explicit
+  URL. All the other pages to be cached must be listed in explicit
   sections.&lt;/p&gt;
 
   &lt;p&gt;&lt;span title=&quot;concept-appcache-oppcache-ns&quot;&gt;Opportunistic caching
@@ -30162,25 +30151,23 @@
   &lt;p&gt;An opportunistic caching namespace must not be listed more than
   once.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;URIs that the user agent is to put into the &lt;span
+  &lt;p&gt;URLs that the user agent is to put into the &lt;span
   title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/span&gt;
   must all be specified in online whitelist sections. (This is needed
-  for any URI that the page is intending to use to communicate back to
+  for any URL that the page is intending to use to communicate back to
   the server.)&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;URIs in the online whitelist section must not also be listed in
+  &lt;p&gt;URLs in the online whitelist section must not also be listed in
   explicit section, and must not be listed as fallback entries in the
-  fallback section. (URIs in the online whitelist section may match
+  fallback section. (URLs in the online whitelist section may match
   opportunistic caching namespaces, however.)&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;Relative URIs must be given relative to the manifest's own
-  URI.&lt;/p&gt;
+  &lt;p&gt;Relative URLs must be given relative to the manifest's own
+  URL.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL; maybe have explicit support for this in the URL section? --&gt;
-  &lt;p&gt;URIs in manifests must not have fragment identifiers.&lt;/p&gt;
+  &lt;p&gt;URLs in manifests must not have fragment identifiers (i.e. the
+  U+0023 NUMBER SIGN character isn't allowed in URLs in
+  manifests).&lt;/p&gt;
 
 
   &lt;h5&gt;Parsing cache manifests&lt;/h5&gt;
@@ -30198,20 +30185,17 @@
    testable since neither U+0000 nor U+FFFD are valid anywhere in the
    syntax and thus both will be treated the same anyway)--&gt;&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt; be an initially empty
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; be an initially empty
    list of &lt;span title=&quot;concept-appcache-explicit&quot;&gt;explicit
    entries&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; be an initially empty
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback URLs&lt;/var&gt; be an initially empty
    mapping of &lt;span title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic
    caching namespaces&lt;/span&gt; to &lt;span
    title=&quot;concept-appcache-fallback&quot;&gt;fallback entries&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;online whitelist URIs&lt;/var&gt; be an
-   initially empty list of URIs for a &lt;span
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;online whitelist URLs&lt;/var&gt; be an
+   initially empty list of URLs for a &lt;span
    title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online
    whitelist&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
@@ -30296,25 +30280,24 @@
 
      &lt;dd&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is not a syntactically correct
-      URI reference or IRI reference, then jump back to the step
-      labeled &quot;start of line&quot;.&lt;/p&gt;
+      &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; &lt;var
+      title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, resolve the URI reference or IRI reference to an
-      absolute URI or IRI, and drop the fragment identifier, if any.&lt;/p&gt;
+      &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
+      line&quot;.&lt;/p&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Now, if the resource's URI has a different &lt;scheme&gt;
-      component than the manifest's URI (compared
-      case-insensitively&lt;!-- XXX ASCII --&gt;), then jump back to the
-      step labeled &quot;start of line&quot;.&lt;/p&gt;
+      &lt;p&gt;If the resulting &lt;span&gt;absolute URL&lt;/span&gt; has a different
+      &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component than
+      the manifest's URL (compared case-insensitively&lt;!-- XXX ASCII
+      --&gt;), then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, add this URI to the &lt;var title=&quot;&quot;&gt;explicit
-      URIs&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Drop the &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
+      component of the resulting &lt;span&gt;absolute URL&lt;/span&gt;, if it has
+      one.&lt;/p&gt;
 
+      &lt;p&gt;Add the resulting &lt;span&gt;absolute URL&lt;/span&gt; to the &lt;var
+      title=&quot;&quot;&gt;explicit URLs&lt;/var&gt;.&lt;/p&gt;
+
      &lt;/dd&gt;
 
      &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;fallback&quot;&lt;/dt&gt;
@@ -30332,48 +30315,40 @@
       TABULATION (tab) character in &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; be &lt;var
       title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
 
-      &lt;p&gt;Strip any leading U+0020 SPACE or U+0009 CHARACTER TABULATION
-      (tab) characters in &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; &lt;var title=&quot;&quot;&gt;part
+      one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part
-      two&lt;/var&gt; are not both syntactically correct URI or IRI
-      references, then jump back to the step labeled &quot;start of
+      &lt;p&gt;If either fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
 
-      &lt;!-- XXXURL use algorithms --&gt;
-      &lt;p&gt;Resolve the URI or IRI references in &lt;var title=&quot;&quot;&gt;part
-      one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; to absolute URIs or
-      IRIs, and drop the fragment identifiers, if any.&lt;/p&gt;
+      &lt;p&gt;If the &lt;span&gt;absolute URL&lt;/span&gt; corresponding to &lt;var
+      title=&quot;&quot;&gt;part one&lt;/var&gt; does not have the &lt;span&gt;same
+      origin&lt;/span&gt; as the manifest's URL, then jump back to the step
+      labeled &quot;start of line&quot;.&lt;/p&gt; &lt;!-- SECURITY --&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var
+      &lt;p&gt;If the resulting &lt;span&gt;absolute URL&lt;/span&gt; for &lt;var
+      title=&quot;&quot;&gt;part two&lt;/span&gt; has a different &lt;span
+      title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component than the
+      manifest's URL (compared case-insensitively&lt;!-- XXX ASCII --&gt;),
+      then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Drop any the &lt;span
+      title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; components of the
+      resulting &lt;span title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/span&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;span&gt;absolute URL&lt;/span&gt; corresponding to &lt;var
       title=&quot;&quot;&gt;part one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback
       URIs&lt;/var&gt; mapping as an &lt;span
       title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
       namespace&lt;/span&gt;, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var
-      title=&quot;&quot;&gt;part one&lt;/var&gt; does not have the &lt;span&gt;same
-      origin&lt;/span&gt; as the manifest's URI, then jump back to the step
-      labeled &quot;start of line&quot;.&lt;/p&gt; &lt;!-- SECURITY --&gt;
-
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var
-      title=&quot;&quot;&gt;part two&lt;/var&gt; has a different &lt;scheme&gt; component
-      than the manifest's URI (compared case-insensitively&lt;!-- XXX
-      ASCII --&gt;), then jump back to the step labeled &quot;start of
-      line&quot;.&lt;/p&gt;
-
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, add the absolute URI or IRI corresponding to &lt;var
-      title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt;
-      mapping as an &lt;span
+      &lt;p&gt;Otherwise, add the &lt;span&gt;absolute URL&lt;/span&gt; corresponding to
+      &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;fallback
+      URIs&lt;/var&gt; mapping as an &lt;span
       title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
-      namespace&lt;/span&gt;, mapped to the absolute URI corresponding to
-      &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;span
+      namespace&lt;/span&gt;, mapped to the &lt;span&gt;absolute URL&lt;/span&gt;
+      corresponding to &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;span
       title=&quot;concept-appcache-fallback&quot;&gt;fallback entry&lt;/span&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
@@ -30382,24 +30357,24 @@
 
      &lt;dd&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is not a syntactically correct URI
-      reference or IRI reference, then jump back to the step labeled
-      &quot;start of line&quot;.&lt;/p&gt;
+      &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; &lt;var
+      title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, resolve the URI reference or IRI reference to an
-      absolute URI or IRI, and drop the fragment identifier, if any.&lt;/p&gt;
+      &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
+      line&quot;.&lt;/p&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Now, if the resource's URI has a different &lt;scheme&gt;
-      component than the manifest's URI, then jump back to the step
-      labeled &quot;start of line&quot;.&lt;/p&gt;
+      &lt;p&gt;If the resulting &lt;span&gt;absolute URL&lt;/span&gt; has a different
+      &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component than
+      the manifest's URL (compared case-insensitively&lt;!-- XXX ASCII
+      --&gt;), then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;!-- XXXURL change to URL --&gt;
-      &lt;p&gt;Otherwise, add this URI to the &lt;var title=&quot;&quot;&gt;online whitelist
-      URIs&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Drop the &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
+      component of the resulting &lt;span&gt;absolute URL&lt;/span&gt;, if it has
+      one.&lt;/p&gt;
 
+      &lt;p&gt;Add the resulting &lt;span&gt;absolute URL&lt;/span&gt; to the &lt;var
+      title=&quot;&quot;&gt;online whitelist URLs&lt;/var&gt;.&lt;/p&gt;
+
      &lt;/dd&gt;
 
     &lt;/dl&gt;
@@ -30410,21 +30385,12 @@
    jumps to the next, and last, step when the end of the file is
    reached.)&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt; list, the &lt;var
-   title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; mapping, and the &lt;var title=&quot;&quot;&gt;online
-   whitelist URIs&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; list, the &lt;var
+   title=&quot;&quot;&gt;fallback URLs&lt;/var&gt; mapping, and the &lt;var title=&quot;&quot;&gt;online
+   whitelist URLs&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;Relative URI references and IRI references resolved to absolute
-  URIs or IRIs in the above algorithm must be resolved according to
-  section 5.1 of RFC3986 (i.e. relative to the base URI from the
-  encapsulating entity or the URI used to retrieve the entity, since
-  there is no way to embed a base URI in the manifest itself). &lt;a
-  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
   &lt;p class=&quot;note&quot;&gt;If a resource is listed in both the online whitelist
   and in the explicit section, then that resource will be downloaded
   and cached, but when the page tries to use this resource, the user
@@ -30449,20 +30415,17 @@
 
   &lt;ol&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt; be the URI of the &lt;span
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt; be the URL of the &lt;span
    title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt; of the cache to
    be updated.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; be the group of &lt;span
    title=&quot;application cache&quot;&gt;application caches&lt;/span&gt; identified by
-   &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; be the most recently updated
    &lt;span&gt;application cache&lt;/span&gt; identified by &lt;var title=&quot;&quot;&gt;manifest
-   URI&lt;/var&gt; (that is, the newest version found in &lt;var title=&quot;&quot;&gt;cache
+   URL&lt;/var&gt; (that is, the newest version found in &lt;var title=&quot;&quot;&gt;cache
    group&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the &lt;span title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt;
@@ -30475,9 +30438,8 @@
 
    &lt;li&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
-    &lt;p&gt;If there is already a resource with the URI of &lt;var
-    title=&quot;&quot;&gt;manifest URI&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, and
+    &lt;p&gt;If there is already a resource with the URL of &lt;var
+    title=&quot;&quot;&gt;manifest URL&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, and
     that resource is categorized as a &lt;span
     title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;, then this is an
     &lt;dfn title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
@@ -30509,8 +30471,7 @@
 
    &lt;li&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
-    &lt;p&gt;Fetch the resource from &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt;, and
+    &lt;p&gt;Fetch the resource from &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;, and
     let &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; be that resource.&lt;/p&gt;
 
     &lt;p&gt;If the resource is labeled with the MIME type &lt;code
@@ -30588,34 +30549,29 @@
    be the display of some sort of user interface indicating to the
    user that a new version is being downloaded.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;If this is an &lt;span title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
    attempt&lt;/span&gt;, then let &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt; be a newly
    created &lt;span&gt;application cache&lt;/span&gt; identified by &lt;span
-   title=&quot;&quot;&gt;manifest URI&lt;/span&gt;, being a new version in &lt;var
+   title=&quot;&quot;&gt;manifest URL&lt;/span&gt;, being a new version in &lt;var
    title=&quot;&quot;&gt;cache group&lt;/var&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;new
    cache&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; be the same version of
    the application cache.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; be an empty list of
-   URIs with flags.&lt;/p&gt;&lt;/li&gt;
+   URLs with flags.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;Add all the URIs in the list of &lt;span
+   &lt;li&gt;&lt;p&gt;Add all the URLs in the list of &lt;span
    title=&quot;concept-appcache-explicit&quot;&gt;explicit entries&lt;/span&gt; obtained
    by parsing &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file
    list&lt;/var&gt;, each flagged with &quot;explicit entry&quot;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;Add all the URIs in the list of &lt;span
+   &lt;li&gt;&lt;p&gt;Add all the URLs in the list of &lt;span
    title=&quot;concept-appcache-fallback&quot;&gt;fallback entries&lt;/span&gt; obtained
    by parsing &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file
    list&lt;/var&gt;, each flagged with &quot;fallback entry&quot;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;If this is an &lt;span title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
-   attempt&lt;/span&gt;, then add all the URIs of &lt;span
+   attempt&lt;/span&gt;, then add all the URLs of &lt;span
    title=&quot;concept-appcache-oppcache&quot;&gt;opportunistically cached
    entries&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; that &lt;span
    title=&quot;concept-appcache-matches-oppcache&quot;&gt;match&lt;/span&gt; the &lt;span
@@ -30624,31 +30580,27 @@
    to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each flagged with &quot;opportunistic
    entry&quot;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;If this is an &lt;span title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
-   attempt&lt;/span&gt;, then add all the URIs of &lt;span
+   attempt&lt;/span&gt;, then add all the URLs of &lt;span
    title=&quot;concept-appcache-implicit&quot;&gt;implicit entries&lt;/span&gt; in &lt;var
    title=&quot;&quot;&gt;cache&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each flagged
    with &quot;implicit entry&quot;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;If this is an &lt;span title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
-   attempt&lt;/span&gt;, then add all the URIs of &lt;span
+   attempt&lt;/span&gt;, then add all the URLs of &lt;span
    title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entries&lt;/span&gt; in &lt;var
    title=&quot;&quot;&gt;cache&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each flagged
    with &quot;dynamic entry&quot;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;If any URI is in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; more than
-   once, then merge the entries into one entry for that URI, that
+   &lt;li&gt;&lt;p&gt;If any URL is in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; more than
+   once, then merge the entries into one entry for that URL, that
    entry having all the flags that the original entries had.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
-    &lt;p&gt;For each URI in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, run the
+    &lt;p&gt;For each URL in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, run the
     following steps. These steps may be run in parallel for two or
-    more of the URIs at a time.&lt;/p&gt;
+    more of the URLs at a time.&lt;/p&gt;
 
     &lt;ol&gt;
 
@@ -30691,33 +30643,28 @@
      &lt;li&gt;&lt;p&gt;Otherwise, the fetching succeeded. Store the resource in
      the &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
-     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as an &quot;explicit
+     &lt;li&gt;&lt;p&gt;If the URL being processed was flagged as an &quot;explicit
      entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the
      entry as an &lt;span title=&quot;concept-appcache-explicit&quot;&gt;explicit
      entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
-     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as a &quot;fallback
+     &lt;li&gt;&lt;p&gt;If the URL being processed was flagged as a &quot;fallback
      entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the
      entry as a &lt;span title=&quot;concept-appcache-fallback&quot;&gt;fallback
      entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
-     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as a &quot;opportunistic
+     &lt;li&gt;&lt;p&gt;If the URL being processed was flagged as a &quot;opportunistic
      entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the
      entry as an &lt;span
      title=&quot;concept-appcache-oppcache&quot;&gt;opportunistically cached
      entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
-     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as an &quot;implicit
+     &lt;li&gt;&lt;p&gt;If the URL being processed was flagged as an &quot;implicit
      entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the
      entry as a &lt;span title=&quot;concept-appcache-implicit&quot;&gt;implicit
      entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
-     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as an &quot;dynamic
+     &lt;li&gt;&lt;p&gt;If the URL being processed was flagged as an &quot;dynamic
      entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorize the
      entry as a &lt;span title=&quot;concept-appcache-dynamic&quot;&gt;dynamic
      entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -30731,15 +30678,13 @@
    (whether newly added or not) as &lt;span
    title=&quot;concept-appcache-manifest&quot;&gt;the manifest&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;Store the list of &lt;span
    title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
-   namespaces&lt;/span&gt;, and the URIs of the &lt;span
+   namespaces&lt;/span&gt;, and the URLs of the &lt;span
    title=&quot;concept-appcache-fallback&quot;&gt;fallback entries&lt;/span&gt; that they
    map to, in the new cache.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;Store the URIs that form the new &lt;span
+   &lt;li&gt;&lt;p&gt;Store the URLs that form the new &lt;span
    title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/span&gt; in
    the new cache.&lt;/p&gt;&lt;/li&gt;
 
@@ -30766,11 +30711,10 @@
     &lt;p&gt;If this is a &lt;span title=&quot;concept-appcache-cache&quot;&gt;cache
     attempt&lt;/span&gt;, then:&lt;/p&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
     &lt;p id=&quot;flagAsCandidateForCache-result&quot;&gt;Associate any
     &lt;code&gt;Document&lt;/code&gt; objects that were &lt;a
     href=&quot;#flagAsCandidateForCache&quot;&gt;flagged as candidates&lt;/a&gt; for this
-    manifest URI's caches with &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;.&lt;/p&gt;
+    manifest URL's caches with &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;.&lt;/p&gt;
 
     &lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; called &lt;code
     title=&quot;event-cached&quot;&gt;cached&lt;/code&gt; at the
@@ -30842,25 +30786,24 @@
   title=&quot;navigate&quot;&gt;navigation&lt;/span&gt; model, but references the
   algorithms defined in this section.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;A URI &lt;dfn title=&quot;concept-appcache-matches-oppcache&quot;&gt;matches an
+  &lt;p&gt;A URL &lt;dfn title=&quot;concept-appcache-matches-oppcache&quot;&gt;matches an
   opportunistic caching namespace&lt;/dfn&gt; if there exists an
   &lt;span&gt;application cache&lt;/span&gt; whose &lt;span
-  title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;'s URI has the
-  &lt;span&gt;same origin&lt;/span&gt; as the URI in question, and if that
+  title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;'s URL has the
+  &lt;span&gt;same origin&lt;/span&gt; as the URL in question, and if that
   application cache has an &lt;span
   title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
-  namespace&lt;/span&gt; with a &lt;path&gt; component that exactly matches
-  the start of the &lt;path&gt; component of the URI being
+  namespace&lt;/span&gt; with a &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt;
+  component that exactly matches the start of the &lt;span
+  title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component of the URL being
   examined. If multiple opportunistic caching namespaces match the
-  same URI, the one with the longest &lt;path&gt; component is the one
-  that matches. A URI looking for an opportunistic caching namespace
+  same URL, the one with the longest &lt;path&gt; component is the one
+  that matches. A URL looking for an opportunistic caching namespace
   can match more than one application cache at a time, but only
   matches one namespace in each cache.&lt;/p&gt;
 
   &lt;div class=&quot;example&quot;&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;p&gt;If a manifest &lt;code
    title=&quot;&quot;&gt;<A HREF="http://example.com/app1/manifest&lt;/code">http://example.com/app1/manifest&lt;/code</A>&gt; declares that
    &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/resources/images&lt;/code">http://example.com/resources/images&lt;/code</A>&gt; should be
@@ -30868,14 +30811,13 @@
    title=&quot;&quot;&gt;<A HREF="http://example.com/resources/images/cat.png&lt;/code">http://example.com/resources/images/cat.png&lt;/code</A>&gt;, then
    the user agent will decide that the application cache identified by
    &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/app1/manifest&lt;/code">http://example.com/app1/manifest&lt;/code</A>&gt; contains a
-   namespace with a match for that URI.&lt;/p&gt;
+   namespace with a match for that URL.&lt;/p&gt;
 
   &lt;/div&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
   &lt;p&gt;When the &lt;dfn
   title=&quot;concept-appcache-init-with-attribute&quot;&gt;application cache
-  selection algorithm&lt;/dfn&gt; algorithm is invoked with a manifest URI,
+  selection algorithm&lt;/dfn&gt; algorithm is invoked with a manifest URL,
   the user agent must run the first applicable set of steps from the
   following list:&lt;/p&gt;
 
@@ -30886,10 +30828,9 @@
 
    &lt;dd&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
     &lt;p&gt;As an optimization, if the resource was loaded from an
-    &lt;span&gt;application cache&lt;/span&gt;, and the manifest URI of that cache
-    doesn't match the manifest URI with which the algorithm was
+    &lt;span&gt;application cache&lt;/span&gt;, and the manifest URL of that cache
+    doesn't match the manifest URL with which the algorithm was
     invoked, then the user agent should mark the entry in that
     application cache corresponding to the resource that was just
     loaded as being &lt;span
@@ -30902,10 +30843,9 @@
 
    &lt;!-- otherwise, we're talking top-level browsing contexts only: --&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;dt&gt;If the resource being loaded was loaded from an application
-   cache and the URI of that application cache's manifest is the
-   same as the manifest URI with which the algorithm was invoked&lt;/dt&gt;
+   cache and the URL of that application cache's manifest is the
+   same as the manifest URL with which the algorithm was invoked&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;Associate the &lt;code&gt;Document&lt;/code&gt; with the cache from which
     it was loaded. Invoke the &lt;span&gt;application cache update
@@ -30913,10 +30853,9 @@
    &lt;/dd&gt;
 
 
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;dt&gt;If the resource being loaded was loaded from an application
-   cache and the URI of that application cache's manifest is
-   &lt;em&gt;not&lt;/em&gt; the same as the manifest URI with which the algorithm
+   cache and the URL of that application cache's manifest is
+   &lt;em&gt;not&lt;/em&gt; the same as the manifest URL with which the algorithm
    was invoked&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -30950,18 +30889,16 @@
 
     &lt;ol&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
-     &lt;li&gt;&lt;p&gt;If the manifest URI does not have the &lt;span&gt;same
-     origin&lt;/span&gt; as the resource's own URI, then invoke the &lt;span
+     &lt;li&gt;&lt;p&gt;If the manifest URL does not have the &lt;span&gt;same
+     origin&lt;/span&gt; as the resource's own URL, then invoke the &lt;span
      title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
      selection algorithm&lt;/span&gt; again, but without a manifest, and
      abort these steps.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
      &lt;li&gt;&lt;p&gt;If there is already an &lt;span&gt;application cache&lt;/span&gt;
-     identified by this manifest URI, and the most up to date version
+     identified by this manifest URL, and the most up to date version
      of that &lt;span&gt;application cache&lt;/span&gt; contains a resource with
-     the URI of the manifest, and that resource is categorized as a
+     the URL of the manifest, and that resource is categorized as a
      &lt;span title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;, then:
      store the resource in the matching cache, categorized as an &lt;span
      title=&quot;concept-appcache-implicit&quot;&gt;implicit entry&lt;/span&gt;,
@@ -30969,19 +30906,17 @@
      &lt;span&gt;application cache update process&lt;/span&gt;, and abort these
      steps.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
      &lt;li id=&quot;flagAsCandidateForCache&quot;&gt;&lt;p&gt;Flag the resource's
-     &lt;code&gt;Document&lt;/code&gt; as a candidate for this manifest URI's
+     &lt;code&gt;Document&lt;/code&gt; as a candidate for this manifest URL's
      caches, so that it will be &lt;a
      href=&quot;#flagAsCandidateForCache-result&quot;&gt;associated with an
-     application cache identified by this manifest URI&lt;/a&gt; later, when
+     application cache identified by this manifest URL&lt;/a&gt; later, when
      such an &lt;span&gt;application cache&lt;/span&gt; is ready.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
      &lt;li&gt;&lt;p&gt;If there is already an &lt;span&gt;application cache&lt;/span&gt;
-     identified by this manifest URI, then the most up to date version
+     identified by this manifest URL, then the most up to date version
      of that &lt;span&gt;application cache&lt;/span&gt; does not yet contain a
-     resource with the URI of the manifest, or it does but that
+     resource with the URL of the manifest, or it does but that
      resource is not yet categorized as a &lt;span
      title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;: store the
      resource in that cache, categorized as an &lt;span
@@ -30991,10 +30926,9 @@
      abort these steps. (An &lt;span&gt;application cache update
      process&lt;/span&gt; is already in progress.)&lt;/p&gt;&lt;/li&gt;
 
-     &lt;!-- XXXURL change to URL --&gt;
      &lt;li&gt;&lt;p&gt;Otherwise, there is no matching &lt;span&gt;application
      cache&lt;/span&gt;: create a new application cache identified by this
-     manifest URI, store the resource in that cache, categorized as an
+     manifest URL, store the resource in that cache, categorized as an
      &lt;span title=&quot;concept-appcache-implicit&quot;&gt;implicit entry&lt;/span&gt;,
      and then invoke the &lt;span&gt;application cache update
      process&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -31038,14 +30972,12 @@
    mechanism or equivalent, then fetch the resource normally and abort
    these steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;If the resource's URI, ignoring its fragment identifier if
+   &lt;li&gt;&lt;p&gt;If the resource's URL, ignoring its fragment identifier if
    any, is listed in the &lt;span&gt;application cache&lt;/span&gt;'s &lt;span
    title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/span&gt;,
    then fetch the resource normally and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;If the resource's URI is &lt;span
+   &lt;li&gt;&lt;p&gt;If the resource's URL is &lt;span
    title=&quot;concept-appcache-implicit&quot;&gt;an implicit entry&lt;/span&gt;, &lt;span
    title=&quot;concept-appcache-manifest&quot;&gt;the manifest&lt;/span&gt;, &lt;span
    title=&quot;concept-appcache-explicit&quot;&gt;an explicit entry&lt;/span&gt;, &lt;span
@@ -31057,11 +30989,11 @@
 
    &lt;li&gt;
 
-    &lt;!-- XXXURL change to URL --&gt;
-    &lt;p&gt;If the resource's URI has the &lt;span&gt;same origin&lt;/span&gt; as the
-    manifest's URI, and the start of the resource's URI's &lt;path&gt;
-    component is exactly matched by the &lt;path&gt; component of an
-    &lt;span title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+    &lt;p&gt;If the resource's URL has the &lt;span&gt;same origin&lt;/span&gt; as the
+    manifest's URL, and the start of the resource's URL's &lt;span
+    title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component is exactly matched
+    by the &lt;path&gt; component of an &lt;span
+    title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
     namespace&lt;/span&gt; in the &lt;span&gt;application cache&lt;/span&gt;, then:
 
     &lt;p&gt;Fetch the resource normally. If this results 4xx or 5xx status
@@ -31205,10 +31137,9 @@
   index &lt;span&gt;&lt;code
   title=&quot;dom-appcache-length&quot;&gt;length&lt;/code&gt;-1&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
   &lt;p&gt;The &lt;dfn title=&quot;dom-appcache-item&quot;&gt;&lt;code&gt;item(&lt;var
   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the absolute
-  URI of the &lt;span title=&quot;concept-appcache-dynamic&quot;&gt;dynamic
+  URL&lt;/span&gt; of the &lt;span title=&quot;concept-appcache-dynamic&quot;&gt;dynamic
   entry&lt;/span&gt; with index &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; from the
   &lt;span&gt;application cache&lt;/span&gt;, if one is associated with the
   &lt;code&gt;ApplicationCache&lt;/code&gt; object. If the object is not
@@ -31229,17 +31160,10 @@
    &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these
    steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; is not a valid URI reference,
-   then raise a &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception and abort these
-   steps. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a URL&quot;&gt;Resolve&lt;/span&gt; the &lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt; argument. If this fails, raise a
+   &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p class=&quot;big-issue&quot;&gt;resolve relative URIs; on failure, raise a
-   &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception&lt;/p&gt;&lt;/li&gt;
-
-   &lt;!-- XXXURL change to URL --&gt;
    &lt;li&gt;&lt;p&gt;If there is already a resource in in the &lt;span&gt;application
    cache&lt;/span&gt; with which the &lt;code&gt;ApplicationCache&lt;/code&gt; object is
    associated that has the address &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, then
@@ -31247,14 +31171,13 @@
    title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entry&lt;/span&gt; and return
    and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL --&gt;
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a different &lt;scheme&gt;
-   component than the manifest's URI, then raise a &lt;span&gt;security
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a different &lt;span
+   title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component than the
+   manifest's URL, then raise a &lt;span&gt;security
    exception&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return, but do not abort these steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;!-- XXXURL change to URL, maybe xref &quot;fetch&quot;? --&gt;
    &lt;li&gt;&lt;p&gt;Fetch the resource referenced by &lt;var
    title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
@@ -31287,20 +31210,19 @@
   interface. This would also make this far more complex to spec and
   implement.&lt;/p&gt;
 
-  &lt;!-- XXXURL algorithms --&gt;
   &lt;p&gt;The &lt;dfn title=&quot;dom-appcache-remove&quot;&gt;&lt;code&gt;remove(&lt;var
-  title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must remove the &lt;span
+  title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must &lt;span title=&quot;resolve a
+  url&quot;&gt;resolve&lt;/span&gt; the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument and, if
+  that is successful, remove the &lt;span
   title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entry&lt;/span&gt; categorization
-  of any entry with the address &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the
-  &lt;span&gt;application cache&lt;/span&gt; with which the
-  &lt;code&gt;ApplicationCache&lt;/code&gt; object is associated. &lt;span
-  class=&quot;big-issue&quot;&gt;Resolve relative URIs... (ignore syntax
-  errors)&lt;/span&gt; If this removes the last categorization of an entry
-  in that cache, then the entry must be removed entirely (such that if
-  it is re-added, it will be loaded from the network again). If the
-  &lt;code&gt;ApplicationCache&lt;/code&gt; object is not associated with any
-  application cache, then the method must raise an
-  &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception instead.&lt;/p&gt;
+  of any entry whose address is the resulting &lt;span&gt;absolute
+  URL&lt;/span&gt; in the &lt;span&gt;application cache&lt;/span&gt; with which the
+  &lt;code&gt;ApplicationCache&lt;/code&gt; object is associated. If this removes
+  the last categorization of an entry in that cache, then the entry
+  must be removed entirely (such that if it is re-added, it will be
+  loaded from the network again). If the &lt;code&gt;ApplicationCache&lt;/code&gt;
+  object is not associated with any application cache, then the method
+  must raise an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception instead.&lt;/p&gt;
 
   &lt;p&gt;If the &lt;dfn
   title=&quot;dom-appcache-update&quot;&gt;&lt;code&gt;update()&lt;/code&gt;&lt;/dfn&gt; method is
@@ -31468,20 +31390,18 @@
   implementing the &lt;code&gt;History&lt;/code&gt; interface for that
   &lt;code&gt;Window&lt;/code&gt; object's &lt;span&gt;active document&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
   &lt;p&gt;&lt;code&gt;History&lt;/code&gt; objects represent their &lt;span&gt;browsing
   context&lt;/span&gt;'s session history as a flat list of &lt;span
   title=&quot;session history entry&quot;&gt;session history entries&lt;/span&gt;. Each
-  &lt;dfn&gt;session history entry&lt;/dfn&gt; consists of either a URI or a
-  &lt;span&gt;state object&lt;/span&gt;, or both, and may in addition have a
-  title, a &lt;code&gt;Document&lt;/code&gt; object, form data, a scroll position,
-  and other information associated with it.&lt;/p&gt;
+  &lt;dfn&gt;session history entry&lt;/dfn&gt; consists of either a
+  &lt;span&gt;URL&lt;/span&gt; or a &lt;span&gt;state object&lt;/span&gt;, or both, and may in
+  addition have a title, a &lt;code&gt;Document&lt;/code&gt; object, form data, a
+  scroll position, and other information associated with it.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;This does not imply that the user interface need be
   linear. See the &lt;a href=&quot;#history-notes&quot;&gt;notes below&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;URIs without associated &lt;span title=&quot;state object&quot;&gt;state
+  &lt;p&gt;URLs without associated &lt;span title=&quot;state object&quot;&gt;state
   objects&lt;/span&gt; are added to the session history as the user (or
   script) navigates from page to page.&lt;/p&gt;
 
@@ -31539,18 +31459,16 @@
   &lt;code&gt;Document&lt;/code&gt; object with it must share the new object as
   well.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;When state object entries are added, a URI can be provided. This
-  URI is used to replace the state object entry if the
+  &lt;p&gt;When state object entries are added, a URL can be provided. This
+  URL is used to replace the state object entry if the
   &lt;code&gt;Document&lt;/code&gt; is evicted.&lt;/p&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
   &lt;p&gt;When a user agent discards the DOM from an entry in the session
   history, it must also discard all the entries that share that
-  &lt;code&gt;Document&lt;/code&gt; but do not have an associated URI
+  &lt;code&gt;Document&lt;/code&gt; but do not have an associated URL
   (i.e. entries that only have a &lt;span&gt;state object&lt;/span&gt;). Entries
   that shared that &lt;code&gt;Document&lt;/code&gt; object but had a state object
-  and have a different URI must then have their &lt;em&gt;state objects&lt;/em&gt;
+  and have a different URL must then have their &lt;em&gt;state objects&lt;/em&gt;
   removed. Removed entries are not recreated if the user or script
   navigates back to the page. If there are no state object entries for
   that &lt;code&gt;Document&lt;/code&gt; object then no entries are removed.&lt;/p&gt;
@@ -31634,48 +31552,66 @@
   title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method adds a state object to the
   history.&lt;/p&gt;
 
-  &lt;!-- XXXURL algorithms XXXDOCURL --&gt;
-  &lt;p&gt;When this method is invoked, the user agent must first check the
-  third argument. If a third argument is specified, then the user
-  agent must verify that the third argument is a valid URI or IRI (as
-  defined by RFC 3986 and 3987), and if so, that, after resolving it
-  to an absolute URI, it is either identical to &lt;span&gt;the document's
-  address&lt;/span&gt;, or that it differs from that address only in the
-  &lt;query&gt;, &lt;abs_path&gt;, and/or &lt;fragment&gt; parts, as
-  applicable (the &lt;query&gt; and &lt;abs_path&gt; parts can only be
-  the same if the document's URI uses a hierarchical
-  &lt;scheme&gt;). If the verification fails (either because the
-  argument is syntactically incorrect, or differs in a way not
-  described as acceptable in the previous sentence) then the user
-  agent must raise a &lt;span&gt;security exception&lt;/span&gt;. &lt;a
-  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+  &lt;p&gt;When this method is invoked, the user agent must run the following steps:&lt;/p&gt;
 
-  &lt;p&gt;If the third argument passes its verification step, or if the
-  third argument was omitted, then the user agent must remove from the
-  &lt;span&gt;session history&lt;/span&gt; any entries for that
-  &lt;code&gt;Document&lt;/code&gt; from the entry after the &lt;span&gt;current
-  entry&lt;/span&gt; up to the last entry in the session history that
-  references the same &lt;code&gt;Document&lt;/code&gt; object, if any. If the
-  &lt;span&gt;current entry&lt;/span&gt; is the last entry in the session history,
-  or if there are no entries after the &lt;span&gt;current entry&lt;/span&gt; that
-  reference the same &lt;code&gt;Document&lt;/code&gt; object, then no entries are
-  removed.&lt;/p&gt;
+  &lt;ol&gt;
 
-  &lt;!-- XXXURL change to URL --&gt;
-  &lt;p&gt;Then, the user agent must add a state object entry to the session
-  history, after the &lt;span&gt;current entry&lt;/span&gt;, with the specified
-  &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; as the state object, the given &lt;var
-  title=&quot;&quot;&gt;title&lt;/var&gt; as the title, and, if the third argument is
-  present, the given &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the URI of the
-  entry.&lt;/p&gt;
+   &lt;li&gt;
 
-  &lt;p&gt;Then, the user agent must set this new entry as being the
-  &lt;span&gt;last activated entry&lt;/span&gt; for the &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
+    &lt;p&gt;If a third argument is specified, run these substeps:&lt;/p&gt;
 
-  &lt;p&gt;Finally, the user agent must update the &lt;span&gt;current
-  entry&lt;/span&gt; to be the this newly added entry.&lt;/p&gt;
+    &lt;ol&gt;
 
+     &lt;li&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the value of the
+     third argument.&lt;/li&gt;
+
+     &lt;li&gt;If that fails, raise a &lt;span&gt;security exception&lt;/span&gt; and
+     abort the &lt;code title=&quot;dom-history-pushState&quot;&gt;pushState()&lt;/code&gt;
+     steps.&lt;/li&gt;
+
+     &lt;li&gt;Compare the resulting &lt;span&gt;absolute URL&lt;/span&gt; to &lt;span&gt;the
+     document's address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;. If any part of these
+     two &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt; differ other than the &lt;span
+     title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt;, &lt;span
+     title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt;, and &lt;span
+     title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; components, then
+     raise a &lt;span&gt;security exception&lt;/span&gt; and abort the &lt;code
+     title=&quot;dom-history-pushState&quot;&gt;pushState()&lt;/code&gt; steps.&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+    &lt;p&gt;For the purposes of the comparison in the above substeps, the
+    &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; and &lt;span
+    title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; components can only be the
+    same if the URLs use a hierarchical &lt;span
+    title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Remove from the &lt;span&gt;session history&lt;/span&gt; any entries for
+   the &lt;code&gt;Document&lt;/code&gt; from the entry after the &lt;span&gt;current
+   entry&lt;/span&gt; up to the last entry in the session history that
+   references the same &lt;code&gt;Document&lt;/code&gt; object, if any. If the
+   &lt;span&gt;current entry&lt;/span&gt; is the last entry in the session
+   history, or if there are no entries after the &lt;span&gt;current
+   entry&lt;/span&gt; that reference the same &lt;code&gt;Document&lt;/code&gt; object,
+   then no entries are removed.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Add a state object entry to the session history, after the
+   &lt;span&gt;current entry&lt;/span&gt;, with the specified &lt;var
+   title=&quot;&quot;&gt;data&lt;/var&gt; as the state object, the given &lt;var
+   title=&quot;&quot;&gt;title&lt;/var&gt; as the title, and, if the third argument is
+   present, the &lt;span&gt;absolute URL&lt;/span&gt; that was found in the first
+   step as the URL of the entry.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set this new entry as being the &lt;span&gt;last activated
+   entry&lt;/span&gt; for the &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Update the &lt;span&gt;current entry&lt;/span&gt; to be the this newly
+   added entry.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
   &lt;p class=&quot;note&quot;&gt;The &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; is purely
   advisory. User agents might use the title in the user interface.&lt;/p&gt;
 
@@ -31732,6 +31668,8 @@
 
   &lt;!-- XXX onpopstate should be defined somewhere --&gt;
 
+  &lt;!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXURL \(url\|uri\|iri\) --&gt;
+
   &lt;!-- XXXURL check with DOM3 Events --&gt;
   &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;PopStateEvent&lt;/dfn&gt; : Event {
   readonly attribute DOMObject &lt;span title=&quot;dom-PopStateEvent-state&quot;&gt;state&lt;/span&gt;;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008709.html">[html5] r1811 - [g] (2) URLify the registerContentHandler()	section. This also modified the rule [...]
</A></li>
	<LI>Next message: <A HREF="008711.html">[html5] r1813 - [] (0) URLify Location.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8710">[ date ]</a>
              <a href="thread.html#8710">[ thread ]</a>
              <a href="subject.html#8710">[ subject ]</a>
              <a href="author.html#8710">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
