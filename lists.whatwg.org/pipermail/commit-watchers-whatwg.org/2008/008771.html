<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1873 - [] (0) Define Message Channels and Ports. Also,	factor out the XXXDISCARD stuff  [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1873%20-%20%5B%5D%20%280%29%20Define%20Message%20Channels%20and%20Ports.%20Also%2C%0A%09factor%20out%20the%20XXXDISCARD%20stuff%20%20%5B...%5D&In-Reply-To=%3C20080715100648.0E779141AE8%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008770.html">
   <LINK REL="Next"  HREF="008772.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1873 - [] (0) Define Message Channels and Ports. Also,	factor out the XXXDISCARD stuff  [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1873%20-%20%5B%5D%20%280%29%20Define%20Message%20Channels%20and%20Ports.%20Also%2C%0A%09factor%20out%20the%20XXXDISCARD%20stuff%20%20%5B...%5D&In-Reply-To=%3C20080715100648.0E779141AE8%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1873 - [] (0) Define Message Channels and Ports. Also,	factor out the XXXDISCARD stuff  [...]">whatwg at whatwg.org
       </A><BR>
    <I>Tue Jul 15 03:06:48 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008770.html">[html5] r1872 - [] (0) More work on Pipes.
</A></li>
        <LI>Next message: <A HREF="008772.html">[html5] r1874 - [] (0) Define the three-argument form of	postMessage().
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8771">[ date ]</a>
              <a href="thread.html#8771">[ thread ]</a>
              <a href="subject.html#8771">[ subject ]</a>
              <a href="author.html#8771">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-07-15 03:06:47 -0700 (Tue, 15 Jul 2008)
New Revision: 1873

Modified:
   index
   source
Log:
[] (0) Define Message Channels and Ports. Also, factor out the XXXDISCARD stuff into its own section.

Modified: index
===================================================================
--- index	2008-07-13 00:50:37 UTC (rev 1872)
+++ index	2008-07-15 10:06:47 UTC (rev 1873)
@@ -25,7 +25,7 @@
 
    &lt;h1 id=html-5&gt;HTML 5&lt;/h1&gt;
 
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft&gt;Draft Recommendation &mdash; 13 July
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft&gt;Draft Recommendation &mdash; 15 July
     2008&lt;/h2&gt;
 
    &lt;p&gt;You can take part in this work. &lt;a
@@ -1251,6 +1251,9 @@
 
        &lt;li&gt;&lt;a href=&quot;#history0&quot;&gt;&lt;span class=secno&gt;5.9.9 &lt;/span&gt;History
         traversal&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#closing&quot;&gt;&lt;span class=secno&gt;5.9.10 &lt;/span&gt;Closing a
+        browsing context&lt;/a&gt;
       &lt;/ul&gt;
 
      &lt;li&gt;&lt;a href=&quot;#structured&quot;&gt;&lt;span class=secno&gt;5.10 &lt;/span&gt;Structured
@@ -1603,8 +1606,8 @@
             &lt;/span&gt;Data framing&lt;/a&gt;
           &lt;/ul&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#closing&quot;&gt;&lt;span class=secno&gt;7.3.4.3. &lt;/span&gt;Closing the
-          connection&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#closing0&quot;&gt;&lt;span class=secno&gt;7.3.4.3. &lt;/span&gt;Closing
+          the connection&lt;/a&gt;
         &lt;/ul&gt;
       &lt;/ul&gt;
 
@@ -1615,15 +1618,24 @@
         model&lt;/a&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#pipe-messaging&quot;&gt;&lt;span class=secno&gt;7.5 &lt;/span&gt;Pipe
+     &lt;li&gt;&lt;a href=&quot;#channel&quot;&gt;&lt;span class=secno&gt;7.5 &lt;/span&gt;Channel
       messaging&lt;/a&gt;
       &lt;ul class=toc&gt;
        &lt;li&gt;&lt;a href=&quot;#introduction5&quot;&gt;&lt;span class=secno&gt;7.5.1
         &lt;/span&gt;Introduction&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#pipes&quot;&gt;&lt;span class=secno&gt;7.5.2 &lt;/span&gt;Pipes&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#message&quot;&gt;&lt;span class=secno&gt;7.5.2 &lt;/span&gt;Message
+        channels&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#pipe-ends&quot;&gt;&lt;span class=secno&gt;7.5.3 &lt;/span&gt;Pipe ends&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#message0&quot;&gt;&lt;span class=secno&gt;7.5.3 &lt;/span&gt;Message
+        ports&lt;/a&gt;
+        &lt;ul class=toc&gt;
+         &lt;li&gt;&lt;a href=&quot;#ports&quot;&gt;&lt;span class=secno&gt;7.5.3.1. &lt;/span&gt;Ports and
+          browsing contexts&lt;/a&gt;
+
+         &lt;li&gt;&lt;a href=&quot;#ports0&quot;&gt;&lt;span class=secno&gt;7.5.3.2. &lt;/span&gt;Ports and
+          garbage collection&lt;/a&gt;
+        &lt;/ul&gt;
       &lt;/ul&gt;
     &lt;/ul&gt;
 
@@ -1724,7 +1736,7 @@
          &lt;li&gt;&lt;a href=&quot;#creating&quot;&gt;&lt;span class=secno&gt;8.2.5.1. &lt;/span&gt;Creating
           and inserting elements&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#closing0&quot;&gt;&lt;span class=secno&gt;8.2.5.2. &lt;/span&gt;Closing
+         &lt;li&gt;&lt;a href=&quot;#closing1&quot;&gt;&lt;span class=secno&gt;8.2.5.2. &lt;/span&gt;Closing
           elements that have implied end tags&lt;/a&gt;
 
          &lt;li&gt;&lt;a href=&quot;#foster&quot;&gt;&lt;span class=secno&gt;8.2.5.3. &lt;/span&gt;Foster
@@ -30261,7 +30273,7 @@
 
   // &lt;a href=&quot;#cross-document&quot;&gt;cross-document messaging&lt;/a&gt;
   void &lt;a href=&quot;#postmessage&quot; title=dom-window-postMessage&gt;postMessage&lt;/a&gt;(in DOMString message, in DOMString targetOrigin);
-  void &lt;a href=&quot;#postmessage&quot; title=dom-window-postMessage&gt;postMessage&lt;/a&gt;(in DOMString message, in &lt;a href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt; pipeEnd, in DOMString targetOrigin);
+  void &lt;a href=&quot;#postmessage&quot; title=dom-window-postMessage&gt;postMessage&lt;/a&gt;(in DOMString message, in &lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt; messagePort, in DOMString targetOrigin);
 
   // &lt;a href=&quot;#event4&quot;&gt;event handler DOM attributes&lt;/a&gt;
            attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#onabort&quot; title=handler-onabort&gt;onabort&lt;/a&gt;;
@@ -30311,13 +30323,22 @@
   &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object also provides the
    scope for script execution. Each &lt;code&gt;Document&lt;/code&gt; in a &lt;a
    href=&quot;#browsing1&quot;&gt;browsing context&lt;/a&gt; has an associated &lt;dfn
-   id=list-of2&gt;list of added properties&lt;/dfn&gt; which, when a document is &lt;a
+   id=list-of2&gt;list of added properties&lt;/dfn&gt; that, when a document is &lt;a
    href=&quot;#active&quot; title=&quot;active document&quot;&gt;active&lt;/a&gt;, are available on the
-   &lt;code&gt;Document&lt;/code&gt;'s &lt;a href=&quot;#default3&quot;&gt;default view&lt;/a&gt; &lt;code&gt;&lt;a
+   &lt;code&gt;Document&lt;/code&gt;'s &lt;a href=&quot;#default3&quot;&gt;default view&lt;/a&gt;'s &lt;code&gt;&lt;a
    href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object. A &lt;code&gt;Document&lt;/code&gt; object's
    &lt;a href=&quot;#list-of2&quot;&gt;list of added properties&lt;/a&gt; must be empty when the
    &lt;code&gt;Document&lt;/code&gt; object is created.
 
+  &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; in a &lt;a href=&quot;#browsing1&quot;&gt;browsing
+   context&lt;/a&gt; also has an associated &lt;dfn id=list-of3&gt;list of message
+   ports&lt;/dfn&gt;, which must be initially empty. The list is used during &lt;a
+   href=&quot;#traverse&quot; title=&quot;traverse the history&quot;&gt;history traversal&lt;/a&gt; in
+   much the same way as the &lt;a href=&quot;#list-of2&quot;&gt;list of added properties&lt;/a&gt;,
+   to keep track of message ports that need to be reactivated if the
+   &lt;code&gt;Document&lt;/code&gt; is made the &lt;a href=&quot;#active&quot;&gt;active document&lt;/a&gt;
+   again.
+
   &lt;p&gt;Objects implementing the &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt;
    interface must also implement the &lt;code&gt;EventTarget&lt;/code&gt; interface.
 
@@ -31382,7 +31403,7 @@
 
    &lt;dd&gt;
     &lt;p&gt;Must be invoked whenever a &lt;code title=event-message&gt;&lt;a
-     href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt; event is targeted at or bubbles
+     href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt; event is targeted at or bubbles
      through the element.
 
    &lt;dt&gt;&lt;dfn id=onmousedown
@@ -33950,40 +33971,34 @@
    that are therefore merely different states of one particular document) are
    contiguous by definition.
 
-  &lt;p&gt;User agents may &lt;dfn id=discard&gt;discard&lt;/dfn&gt; the DOMs of entries other
+  &lt;p&gt;User agents may &lt;a href=&quot;#discard&quot; title=&quot;discard a
+   Document&quot;&gt;discard&lt;/a&gt; the &lt;code&gt;Document&lt;/code&gt; objects of entries other
    than the &lt;a href=&quot;#current1&quot;&gt;current entry&lt;/a&gt; that are not referenced
    from any script, reloading the pages afresh when the user or script
    navigates back to such pages. This specification does not specify when
-   user agents should discard pages' DOMs and when they should cache them.
-   See the section on the &lt;code title=event-load&gt;&lt;a
-   href=&quot;#load0&quot;&gt;load&lt;/a&gt;&lt;/code&gt; and &lt;code title=event-unload&gt;unload&lt;/code&gt;
-   events for more details.&lt;/p&gt;
-  &lt;!-- XXX crossref! XXXDISCARD --&gt;
+   user agents should discard &lt;code&gt;Document&lt;/code&gt; objects and when they
+   should cache them.
 
-  &lt;p&gt;Entries that have had their DOM discarded must, for the purposes of the
-   algorithms given below, act as if they had not. When the user or script
-   navigates back or forwards to a page which has no in-memory DOM objects,
-   any other entries that shared the same &lt;code&gt;Document&lt;/code&gt; object with
-   it must share the new object as well.
+  &lt;p&gt;Entries that have had their &lt;code&gt;Document&lt;/code&gt; objects discarded
+   must, for the purposes of the algorithms given below, act as if they had
+   not. When the user or script navigates back or forwards to a page which
+   has no in-memory DOM objects, any other entries that shared the same
+   &lt;code&gt;Document&lt;/code&gt; object with it must share the new object as well.
 
   &lt;p&gt;When state object entries are added, a URL can be provided. This URL is
    used to replace the state object entry if the &lt;code&gt;Document&lt;/code&gt; is
    evicted.
 
-  &lt;p&gt;When a user agent discards the DOM from an entry in the session history,
-   it must also discard all the entries that share that &lt;code&gt;Document&lt;/code&gt;
-   but do not have an associated URL (i.e. entries that only have a &lt;a
-   href=&quot;#state&quot;&gt;state object&lt;/a&gt;). Entries that shared that
-   &lt;code&gt;Document&lt;/code&gt; object but had a state object and have a different
-   URL must then have their &lt;em&gt;state objects&lt;/em&gt; removed. Removed entries
-   are not recreated if the user or script navigates back to the page. If
-   there are no state object entries for that &lt;code&gt;Document&lt;/code&gt; object
-   then no entries are removed.
+  &lt;p&gt;When a user agent discards the &lt;code&gt;Document&lt;/code&gt; object from an
+   entry in the session history, it must also discard all the entries that
+   share that &lt;code&gt;Document&lt;/code&gt; but do not have an associated URL (i.e.
+   entries that only have a &lt;a href=&quot;#state&quot;&gt;state object&lt;/a&gt;). Entries that
+   shared that &lt;code&gt;Document&lt;/code&gt; object but had a state object and have a
+   different URL must then have their &lt;em&gt;state objects&lt;/em&gt; removed. Removed
+   entries are not recreated if the user or script navigates back to the
+   page. If there are no state object entries for that &lt;code&gt;Document&lt;/code&gt;
+   object then no entries are removed.
 
-  &lt;p class=big-issue&gt;&lt;!--XXXDISCARD--&gt; when an entry is discarded, any frozen
-   timers, intervals, XMLHttpRequests, database transactions, etc, must be
-   killed
-
   &lt;h4 id=the-history&gt;&lt;span class=secno&gt;5.8.2 &lt;/span&gt;The &lt;code&gt;&lt;a
    href=&quot;#history2&quot;&gt;History&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
@@ -34661,9 +34676,8 @@
      document
 
    &lt;li&gt;
-    &lt;p class=big-issue&gt;if flag is set: reset timers, empty event queue, kill
-     any pending transactions, kill XMLHttpRequests, etc, and set things up
-     so that the document will be discarded asap &lt;!--XXXDISCARD--&gt;
+    &lt;p class=big-issue&gt;if flag is set: &lt;a href=&quot;#discard&quot; title=&quot;discard a
+     document&quot;&gt;discard the &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;
 
    &lt;li&gt;
     &lt;dl&gt;
@@ -35057,6 +35071,15 @@
      &lt;li class=big-issue&gt;freeze any timers, intervals, XMLHttpRequests,
       database transactions, etc
 
+     &lt;li id=port-traversal-deactivation&gt;If there are any &lt;code&gt;&lt;a
+      href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects whose owner is the
+      browsing context's default view's &lt;code&gt;&lt;a
+      href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object and that are entangled with
+      another port, the user agent must &lt;a href=&quot;#deactivate&quot;
+      title=&quot;deactivate a port&quot;&gt;deactivate&lt;/a&gt; all such ports and let the
+      &lt;code&gt;Document&lt;/code&gt;'s &lt;a href=&quot;#list-of3&quot;&gt;list of message ports&lt;/a&gt;
+      be a list of those ports.
+
      &lt;li&gt;The user agent must move any properties that have been added to the
       browsing context's default view's &lt;code&gt;&lt;a
       href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object to the &lt;a href=&quot;#active&quot;&gt;active
@@ -35108,6 +35131,12 @@
       href=&quot;#list-of2&quot;&gt;list of added properties&lt;/a&gt; to browsing context's
       default view's &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object.
 
+     &lt;li id=port-traversal-reactivation&gt;If the &lt;a href=&quot;#active&quot;&gt;active
+      document&lt;/a&gt;'s &lt;a href=&quot;#list-of3&quot;&gt;list of message ports&lt;/a&gt; is not
+      empty, then the user agent must &lt;a href=&quot;#reactivate&quot; title=&quot;reactivate
+      a port&quot;&gt;reactivate&lt;/a&gt; all the ports in that list. Empty that &lt;a
+      href=&quot;#list-of3&quot;&gt;list of message ports&lt;/a&gt;.
+
      &lt;li class=big-issue&gt;unfreeze any timers, intervals, XMLHttpRequests,
       database transactions, etc
     &lt;/ol&gt;
@@ -35151,6 +35180,27 @@
   &lt;p class=big-issue&gt;how does the changing of the global attributes affect
    .watch() when seen from other Windows?
 
+  &lt;h4 id=closing&gt;&lt;span class=secno&gt;5.9.10 &lt;/span&gt;Closing a browsing context&lt;/h4&gt;
+
+  &lt;p class=big-issue&gt;Closing a browsing context and discarding it (vs closing
+   it and keeping it around in memory).
+
+  &lt;p class=big-issue&gt;when a browsing context is closed, all session history
+   entries' &lt;code&gt;Document&lt;/code&gt; objects must be discarded.
+
+  &lt;p class=big-issue&gt;When a user agent is to &lt;dfn id=discard&gt;discard a
+   &lt;code&gt;Document&lt;/code&gt;&lt;/dfn&gt;, any frozen timers, intervals,
+   XMLHttpRequests, database transactions, etc, must be killed, and any ports
+   owned by the Window object that aren't in a &lt;a href=&quot;#list-of3&quot;&gt;list of
+   message ports&lt;/a&gt;, if the document is the &lt;a href=&quot;#active&quot;&gt;active
+   document&lt;/a&gt;, or otherwise any ports in that document's &lt;a
+   href=&quot;#list-of3&quot;&gt;list of message ports&lt;/a&gt;, if the document is not the &lt;a
+   href=&quot;#active&quot;&gt;active document&lt;/a&gt;, must be &lt;span&gt;deactivated&lt;/span&gt; and
+   unentangled.
+
+  &lt;p class=big-issue&gt;Also, &lt;code title=event-unload&gt;unload&lt;/code&gt; events
+   should fire.
+
   &lt;h3 id=structured&gt;&lt;span class=secno&gt;5.10 &lt;/span&gt;Structured client-side
    storage&lt;/h3&gt;
 
@@ -35934,7 +35984,7 @@
 
   &lt;pre class=idl&gt;interface &lt;dfn id=sqlerror&gt;SQLError&lt;/dfn&gt; {
   readonly attribute unsigned int &lt;a href=&quot;#code1&quot; title=dom-SQLError-code&gt;code&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=&quot;#message&quot; title=dom-SQLError-message&gt;message&lt;/a&gt;;
+  readonly attribute DOMString &lt;a href=&quot;#message1&quot; title=dom-SQLError-message&gt;message&lt;/a&gt;;
 };&lt;/pre&gt;
 
   &lt;p&gt;The &lt;dfn id=code1 title=dom-SQLError-code&gt;&lt;code&gt;code&lt;/code&gt;&lt;/dfn&gt; DOM
@@ -36003,7 +36053,7 @@
   &lt;p class=big-issue&gt;We should define a more thorough list of codes.
    Implementation feedback is requested to determine what codes are needed.
 
-  &lt;p&gt;The &lt;dfn id=message
+  &lt;p&gt;The &lt;dfn id=message1
    title=dom-SQLError-message&gt;&lt;code&gt;message&lt;/code&gt;&lt;/dfn&gt; DOM attribute must
    return an error message describing the error encountered. The message
    should be localized to the user's language.
@@ -40745,7 +40795,7 @@
   &lt;p&gt;Messages in &lt;a href=&quot;#server-sent&quot;&gt;server-sent events&lt;/a&gt;, &lt;a
    href=&quot;#web-sockets&quot;&gt;Web sockets&lt;/a&gt;, &lt;a
    href=&quot;#cross-document&quot;&gt;cross-document messaging&lt;/a&gt;, and &lt;a
-   href=&quot;#pipe-messaging0&quot;&gt;pipe messaging&lt;/a&gt; use the &lt;dfn id=message0
+   href=&quot;#channel0&quot;&gt;channel messaging&lt;/a&gt; use the &lt;dfn id=message2
    title=event-message&gt;&lt;code&gt;message&lt;/code&gt;&lt;/dfn&gt; event.
 
   &lt;p&gt;The following interface is defined for this event:
@@ -40755,9 +40805,9 @@
   readonly attribute DOMString &lt;a href=&quot;#origin1&quot; title=dom-MessageEvent-origin&gt;origin&lt;/a&gt;;
   readonly attribute DOMString &lt;a href=&quot;#lasteventid&quot; title=dom-MessageEvent-lastEventId&gt;lastEventId&lt;/a&gt;;
   readonly attribute &lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt; &lt;a href=&quot;#source3&quot; title=dom-MessageEvent-source&gt;source&lt;/a&gt;;
-  readonly attribute &lt;a href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt; &lt;a href=&quot;#pipeend&quot; title=dom-MessageEvent-pipeEnd&gt;pipeEnd&lt;/a&gt;;
-  void &lt;a href=&quot;#initmessageevent&quot; title=dom-MessageEvent-initMessageEvent&gt;initMessageEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString dataArg, in DOMString originArg, in DOMString lastEventIdArg, in Window sourceArg, in &lt;a href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt; pipeEndArg);
-  void &lt;a href=&quot;#initmessageeventns&quot; title=dom-MessageEvent-initMessageEventNS&gt;initMessageEventNS&lt;/a&gt;(in DOMString namespaceURI, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString dataArg, in DOMString originArg, in DOMString lastEventIdArg, in Window sourceArg, in &lt;a href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt; pipeEndArg);
+  readonly attribute &lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt; &lt;a href=&quot;#messageport&quot; title=dom-MessageEvent-messagePort&gt;messagePort&lt;/a&gt;;
+  void &lt;a href=&quot;#initmessageevent&quot; title=dom-MessageEvent-initMessageEvent&gt;initMessageEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString dataArg, in DOMString originArg, in DOMString lastEventIdArg, in Window sourceArg, in &lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt; messagePortArg);
+  void &lt;a href=&quot;#initmessageeventns&quot; title=dom-MessageEvent-initMessageEventNS&gt;initMessageEventNS&lt;/a&gt;(in DOMString namespaceURI, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString dataArg, in DOMString originArg, in DOMString lastEventIdArg, in Window sourceArg, in &lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt; messagePortArg);
 };&lt;/pre&gt;
 
   &lt;p&gt;The &lt;dfn id=initmessageevent
@@ -40789,22 +40839,23 @@
    represents, in &lt;a href=&quot;#cross-document&quot;&gt;cross-document messaging&lt;/a&gt;, the
    &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; from which the message came.
 
-  &lt;p&gt;The &lt;dfn id=pipeend
-   title=dom-MessageEvent-pipeEnd&gt;&lt;code&gt;pipeEnd&lt;/code&gt;&lt;/dfn&gt; attribute
-   represents, in &lt;a href=&quot;#cross-document&quot;&gt;cross-document messaging&lt;/a&gt; and
-   &lt;a href=&quot;#pipe-messaging0&quot;&gt;pipe messaging&lt;/a&gt; the &lt;code&gt;&lt;a
-   href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt;&lt;/code&gt; being sent, if any.
+  &lt;p&gt;The &lt;dfn id=messageport
+   title=dom-MessageEvent-messagePort&gt;&lt;code&gt;messagePort&lt;/code&gt;&lt;/dfn&gt;
+   attribute represents, in &lt;a href=&quot;#cross-document&quot;&gt;cross-document
+   messaging&lt;/a&gt; and &lt;a href=&quot;#channel0&quot;&gt;channel messaging&lt;/a&gt; the &lt;code&gt;&lt;a
+   href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; being sent, if any.
 
   &lt;p&gt;Unless otherwise specified, when the user agent creates and dispatches a
-   &lt;code title=event-message&gt;&lt;a href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt; event in
+   &lt;code title=event-message&gt;&lt;a href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt; event in
    the algorithms described in the following sections, the &lt;code
    title=dom-MessageEvent-lastEventId&gt;&lt;a
    href=&quot;#lasteventid&quot;&gt;lastEventId&lt;/a&gt;&lt;/code&gt; attribute must be the empty
    string, the &lt;code title=dom-MessageEvent-origin&gt;&lt;a
    href=&quot;#origin1&quot;&gt;origin&lt;/a&gt;&lt;/code&gt; attribute must be the empty string, the
    &lt;code title=dom-MessageEvent-source&gt;&lt;a href=&quot;#source3&quot;&gt;source&lt;/a&gt;&lt;/code&gt;
-   attribute must be null, and the &lt;code title=dom-MessageEvent-pipeEnd&gt;&lt;a
-   href=&quot;#pipeend&quot;&gt;pipeEnd&lt;/a&gt;&lt;/code&gt; attribute must be null.
+   attribute must be null, and the &lt;code
+   title=dom-MessageEvent-messagePort&gt;&lt;a
+   href=&quot;#messageport&quot;&gt;messagePort&lt;/a&gt;&lt;/code&gt; attribute must be null.
 
   &lt;h3 id=server-sent-events&gt;&lt;span class=secno&gt;7.2 &lt;/span&gt;&lt;dfn
    id=server-sent&gt;Server-sent events&lt;/dfn&gt;&lt;/h3&gt;
@@ -40834,7 +40885,7 @@
    href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the &lt;a
    href=&quot;#url&quot;&gt;URL&lt;/a&gt; specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, and if that
    succeeds, add the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; to the &lt;a
-   href=&quot;#list-of3&quot; title=concept-eventsource-list&gt;list of event sources&lt;/a&gt;
+   href=&quot;#list-of4&quot; title=concept-eventsource-list&gt;list of event sources&lt;/a&gt;
    for that object. The same URL can be registered multiple times. If the URL
    fails to resolve, then the user agent must raise a &lt;code&gt;SYNTAX_ERR&lt;/code&gt;
    exception.
@@ -40845,7 +40896,7 @@
    href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the &lt;a
    href=&quot;#url&quot;&gt;URL&lt;/a&gt; specified in &lt;var title=&quot;&quot;&gt;src&lt;/var&gt;, and if that
    succeeds, remove the resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; from
-   the &lt;a href=&quot;#list-of3&quot; title=concept-eventsource-list&gt;list of event
+   the &lt;a href=&quot;#list-of4&quot; title=concept-eventsource-list&gt;list of event
    sources&lt;/a&gt; for that object. If the same URI has been registered multiple
    times, removing it must remove only one instance of that URI for each
    invocation of the &lt;code title=removeEventSource&gt;removeEventSource()&lt;/code&gt;
@@ -40856,7 +40907,7 @@
 
   &lt;p&gt;Each object implementing the &lt;code&gt;EventTarget&lt;/code&gt; and &lt;code&gt;&lt;a
    href=&quot;#remoteeventtarget&quot;&gt;RemoteEventTarget&lt;/a&gt;&lt;/code&gt; interfaces has a
-   &lt;dfn id=list-of3 title=concept-eventsource-list&gt;list of event
+   &lt;dfn id=list-of4 title=concept-eventsource-list&gt;list of event
    sources&lt;/dfn&gt; that are registered for that object.
 
   &lt;p&gt;When a new URI is added to this list, the user agent should, as soon as
@@ -41148,7 +41199,7 @@
    &lt;li&gt;
     &lt;p&gt;Otherwise, create an event that uses the &lt;code&gt;&lt;a
      href=&quot;#messageevent&quot;&gt;MessageEvent&lt;/a&gt;&lt;/code&gt; interface, with the event
-     name &lt;code title=event-message&gt;&lt;a href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt;,
+     name &lt;code title=event-message&gt;&lt;a href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt;,
      which does not bubble, is cancelable, and has no default action. The
      &lt;code title=dom-MessageEvent-data&gt;&lt;a href=&quot;#data4&quot;&gt;data&lt;/a&gt;&lt;/code&gt;
      attribute must be set to the value of the &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;
@@ -41189,7 +41240,7 @@
 data: 10&lt;/pre&gt;
 
    &lt;p&gt;...would cause an event &lt;code title=event-message&gt;&lt;a
-    href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt; with the interface &lt;code&gt;&lt;a
+    href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt; with the interface &lt;code&gt;&lt;a
     href=&quot;#messageevent&quot;&gt;MessageEvent&lt;/a&gt;&lt;/code&gt; to be dispatched on the
     &lt;code&gt;&lt;a href=&quot;#eventsource&quot;&gt;eventsource&lt;/a&gt;&lt;/code&gt; element, whose &lt;code
     title=dom-MessageEvent-data&gt;&lt;a href=&quot;#data4&quot;&gt;data&lt;/a&gt;&lt;/code&gt; attribute
@@ -41410,14 +41461,14 @@
   &lt;p class=note&gt;No information regarding why the connection was closed is
    passed to the application in this version of this specification.
 
-  &lt;p&gt;The &lt;code title=event-message&gt;&lt;a href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt;
+  &lt;p&gt;The &lt;code title=event-message&gt;&lt;a href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt;
    event is fired when when data is received for a connection.
 
   &lt;p&gt;Events that would be fired during script execution (e.g. between the
    &lt;code&gt;&lt;a href=&quot;#websocket0&quot;&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object being created
    &mdash; and thus the connection being established &mdash; and the current
    script completing; or, during the execution of a &lt;code
-   title=event-message&gt;&lt;a href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt; event handler)
+   title=event-message&gt;&lt;a href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt; event handler)
    must be buffered, and those events queued up and each one individually
    fired after the script has completed.&lt;/p&gt;
   &lt;!-- XXX make this more generic
@@ -41443,7 +41494,7 @@
 
    &lt;dd&gt;
     &lt;p&gt;Must be invoked whenever a &lt;code title=event-message&gt;&lt;a
-     href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt; event is targeted at or bubbles
+     href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt; event is targeted at or bubbles
      through the &lt;code&gt;&lt;a href=&quot;#websocket0&quot;&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object.
 
    &lt;dt&gt;&lt;dfn id=onclose
@@ -41921,7 +41972,7 @@
         &lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; is 0x00, create an event that
          uses the &lt;code&gt;&lt;a href=&quot;#messageevent&quot;&gt;MessageEvent&lt;/a&gt;&lt;/code&gt;
          interface, with the event name &lt;code title=event-message&gt;&lt;a
-         href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt;, which does not bubble, is
+         href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt;, which does not bubble, is
          cancelable, has no default action, and whose &lt;code
          title=dom-MessageEvent-data&gt;&lt;a href=&quot;#data4&quot;&gt;data&lt;/a&gt;&lt;/code&gt;
          attribute is set to &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, and dispatch it at the
@@ -42115,7 +42166,7 @@
     &lt;p&gt;Send a 0xff byte to the client to indicate the end of the message.
   &lt;/ol&gt;
 
-  &lt;h5 id=closing&gt;&lt;span class=secno&gt;7.3.4.3. &lt;/span&gt;Closing the connection&lt;/h5&gt;
+  &lt;h5 id=closing0&gt;&lt;span class=secno&gt;7.3.4.3. &lt;/span&gt;Closing the connection&lt;/h5&gt;
 
   &lt;p&gt;To &lt;dfn id=close1&gt;close the Web Socket connection&lt;/dfn&gt;, either the user
    agent or the server closes the TCP/IP connection. There is no closing
@@ -42173,9 +42224,12 @@
      continue running these steps.&lt;/p&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Wait for the &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object on which
-     the method was invoked to have finished executing any pending scripts.&lt;/p&gt;
-    &lt;!-- XXX define this in terms of the event queue --&gt;
+    &lt;p&gt;Wait for all scripts in the &lt;a href=&quot;#unit-of&quot;&gt;unit of related
+     browsing contexts&lt;/a&gt; to which the the &lt;code&gt;&lt;a
+     href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object on which the method was invoked
+     belongs to have finished executing any pending scripts.&lt;/p&gt;
+    &lt;!-- XXX define this in terms of the
+    event queue --&gt;
 
    &lt;li&gt;
     &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument has a value other
@@ -42189,7 +42243,7 @@
    &lt;li&gt;
     &lt;p&gt;Create an event that uses the &lt;code&gt;&lt;a
      href=&quot;#messageevent&quot;&gt;MessageEvent&lt;/a&gt;&lt;/code&gt; interface, with the event
-     name &lt;code title=event-message&gt;&lt;a href=&quot;#message0&quot;&gt;message&lt;/a&gt;&lt;/code&gt;,
+     name &lt;code title=event-message&gt;&lt;a href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt;,
      which does not bubble, is cancelable, and has no default action. The
      &lt;code title=dom-MessageEvent-data&gt;&lt;a href=&quot;#data4&quot;&gt;data&lt;/a&gt;&lt;/code&gt;
      attribute must be set to the value passed as the &lt;var
@@ -42274,92 +42328,422 @@
    security reasons. It also requires that UAs be careful to allow access to
    certain properties but not others.
 
-  &lt;p class=big-issue&gt;postMessage() with a pipe isn't yet defined
+  &lt;p class=big-issue&gt;postMessage() with a message port isn't yet defined
 
-  &lt;h3 id=pipe-messaging&gt;&lt;span class=secno&gt;7.5 &lt;/span&gt;&lt;dfn
-   id=pipe-messaging0&gt;Pipe messaging&lt;/dfn&gt;&lt;/h3&gt;
+  &lt;h3 id=channel&gt;&lt;span class=secno&gt;7.5 &lt;/span&gt;&lt;dfn id=channel0&gt;Channel
+   messaging&lt;/dfn&gt;&lt;/h3&gt;
 
   &lt;h4 id=introduction5&gt;&lt;span class=secno&gt;7.5.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;
 
-  &lt;p class=big-issue&gt;An introduction to the pipe APIs.
+  &lt;p class=big-issue&gt;An introduction to the channel and port APIs.
 
-  &lt;h4 id=pipes&gt;&lt;span class=secno&gt;7.5.2 &lt;/span&gt;Pipes&lt;/h4&gt;
+  &lt;h4 id=message&gt;&lt;span class=secno&gt;7.5.2 &lt;/span&gt;Message channels&lt;/h4&gt;
 
   &lt;pre
-   class=idl&gt;[&lt;a href=&quot;#pipe0&quot; title=dom-Pipe&gt;Constructor&lt;/a&gt;] interface &lt;dfn id=pipe&gt;Pipe&lt;/dfn&gt; {
-  readonly attribute &lt;a href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt; &lt;a href=&quot;#end1&quot; title=dom-pipe-end1&gt;end1&lt;/a&gt;;
-  readonly attribute &lt;a href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt; &lt;a href=&quot;#end2&quot; title=dom-pipe-end2&gt;end2&lt;/a&gt;;
+   class=idl&gt;[&lt;span title=dom-Pipe&gt;Constructor&lt;/span&gt;] interface &lt;dfn id=messagechannel&gt;MessageChannel&lt;/dfn&gt; {
+  readonly attribute &lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt; &lt;a href=&quot;#port1&quot; title=dom-channel-port1&gt;port1&lt;/a&gt;;
+  readonly attribute &lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt; &lt;a href=&quot;#port2&quot; title=dom-channel-port2&gt;port2&lt;/a&gt;;
 };&lt;/pre&gt;
 
-  &lt;p&gt;When the &lt;dfn id=pipe0 title=dom-Pipe&gt;&lt;code&gt;Pipe()&lt;/code&gt;&lt;/dfn&gt;
-   constructor is called, it must run the following algorithm:
+  &lt;p&gt;When the &lt;dfn id=messagechannel0
+   title=dom-MessageChannel&gt;&lt;code&gt;MessageChannel()&lt;/code&gt;&lt;/dfn&gt; constructor
+   is called, it must run the following algorithm:
 
   &lt;ol&gt;
    &lt;li&gt;
-    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create a new &lt;code&gt;PipeEnd&lt;/code&gt; object&lt;/a&gt; owned
-     by the &lt;a href=&quot;#script3&quot;&gt;script browsing context&lt;/a&gt;, and let &lt;var
-     title=&quot;&quot;&gt;end1&lt;/var&gt; be that object.
+    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create a new &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/a&gt;
+     owned by the &lt;a href=&quot;#script3&quot;&gt;script browsing context&lt;/a&gt;, and let
+     &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt; be that object.
 
    &lt;li&gt;
-    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create a new &lt;code&gt;PipeEnd&lt;/code&gt; object&lt;/a&gt; owned
-     by the &lt;a href=&quot;#script3&quot;&gt;script browsing context&lt;/a&gt;, and let &lt;var
-     title=&quot;&quot;&gt;end2&lt;/var&gt; be that object.
+    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create a new &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/a&gt;
+     owned by the &lt;a href=&quot;#script3&quot;&gt;script browsing context&lt;/a&gt;, and let
+     &lt;var title=&quot;&quot;&gt;port2&lt;/var&gt; be that object.
 
    &lt;li&gt;
-    &lt;p&gt;&lt;a href=&quot;#entangle&quot;&gt;Entangle&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;end1&lt;/var&gt; and &lt;var
-     title=&quot;&quot;&gt;end2&lt;/var&gt; objects.
+    &lt;p&gt;&lt;a href=&quot;#entangle&quot;&gt;Entangle&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt; and
+     &lt;var title=&quot;&quot;&gt;port2&lt;/var&gt; objects.
 
    &lt;li&gt;
-    &lt;p&gt;Create a new &lt;code&gt;&lt;a href=&quot;#pipe&quot;&gt;Pipe&lt;/a&gt;&lt;/code&gt; object, and let
-     &lt;var title=&quot;&quot;&gt;pipe&lt;/var&gt; be that object.
+    &lt;p&gt;Set the &lt;code title=dom-MessagePort-active&gt;&lt;a
+     href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute of the two ports to true.
 
    &lt;li&gt;
-    &lt;p&gt;Let the &lt;code title=dom-pipe-end1&gt;&lt;a href=&quot;#end1&quot;&gt;end1&lt;/a&gt;&lt;/code&gt;
-     attribute of the &lt;var title=&quot;&quot;&gt;pipe&lt;/var&gt; object be &lt;var
-     title=&quot;&quot;&gt;end1&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Instantiate a new &lt;code&gt;&lt;a
+     href=&quot;#messagechannel&quot;&gt;MessageChannel&lt;/a&gt;&lt;/code&gt; object, and let &lt;var
+     title=&quot;&quot;&gt;channel&lt;/var&gt; be that object.
 
    &lt;li&gt;
-    &lt;p&gt;Let the &lt;code title=dom-pipe-end2&gt;&lt;a href=&quot;#end2&quot;&gt;end2&lt;/a&gt;&lt;/code&gt;
-     attribute of the &lt;var title=&quot;&quot;&gt;pipe&lt;/var&gt; object be &lt;var
-     title=&quot;&quot;&gt;end2&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Let the &lt;code title=dom-channel-port1&gt;&lt;a
+     href=&quot;#port1&quot;&gt;port1&lt;/a&gt;&lt;/code&gt; attribute of the &lt;var
+     title=&quot;&quot;&gt;channel&lt;/var&gt; object be &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt;.&lt;/p&gt;
 
    &lt;li&gt;
-    &lt;p&gt;Return &lt;var title=&quot;&quot;&gt;pipe&lt;/var&gt;.
+    &lt;p&gt;Let the &lt;code title=dom-channel-port2&gt;&lt;a
+     href=&quot;#port2&quot;&gt;port2&lt;/a&gt;&lt;/code&gt; attribute of the &lt;var
+     title=&quot;&quot;&gt;channel&lt;/var&gt; object be &lt;var title=&quot;&quot;&gt;port2&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Return &lt;var title=&quot;&quot;&gt;channel&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;p&gt;The &lt;dfn id=end1 title=dom-pipe-end1&gt;&lt;code&gt;end1&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn
-   id=end2 title=dom-pipe-end2&gt;&lt;code&gt;end2&lt;/code&gt;&lt;/dfn&gt; attributes must return
-   the values they were assigned when the &lt;code&gt;&lt;a
-   href=&quot;#pipe&quot;&gt;Pipe&lt;/a&gt;&lt;/code&gt; object was created.
+  &lt;p&gt;The &lt;dfn id=port1 title=dom-channel-port1&gt;&lt;code&gt;port1&lt;/code&gt;&lt;/dfn&gt; and
+   &lt;dfn id=port2 title=dom-channel-port2&gt;&lt;code&gt;port2&lt;/code&gt;&lt;/dfn&gt; attributes
+   must return the values they were assigned when the &lt;code&gt;&lt;a
+   href=&quot;#messagechannel&quot;&gt;MessageChannel&lt;/a&gt;&lt;/code&gt; object was created.
 
-  &lt;h4 id=pipe-ends&gt;&lt;span class=secno&gt;7.5.3 &lt;/span&gt;Pipe ends&lt;/h4&gt;
+  &lt;h4 id=message0&gt;&lt;span class=secno&gt;7.5.3 &lt;/span&gt;Message ports&lt;/h4&gt;
 
-  &lt;p&gt;Each pipe has two ends. Data sent down one end is received by the other
-   end, and vice versa.
+  &lt;p&gt;Each channel has two message ports. Data sent through one port is
+   received by the other port, and vice versa.
 
-  &lt;pre class=idl&gt;interface &lt;dfn id=pipeend0&gt;PipeEnd&lt;/dfn&gt; {
-  readonly attribute &lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt; &lt;span title=dom-owner&gt;ownerWindow&lt;/span&gt;;
-  readonly attribute boolean &lt;span title=dom-endpipe&gt;active&lt;/span&gt;;
-  void &lt;span title=dom-pipeend-postMessage&gt;postMessage&lt;/span&gt;(in DOMString message);
-  void &lt;span title=dom-pipeend-postMessage&gt;postMessage&lt;/span&gt;(in DOMString message, in &lt;a href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt; pipeEnd);
-  void &lt;span title=dom-pipeend-close&gt;close&lt;/span&gt;();
+  &lt;pre class=idl&gt;interface &lt;dfn id=messageport0&gt;MessagePort&lt;/dfn&gt; {
+  readonly attribute &lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt; &lt;a href=&quot;#ownerwindow&quot; title=dom-MessagePort-ownerWindow&gt;ownerWindow&lt;/a&gt;;
+  readonly attribute boolean &lt;a href=&quot;#active0&quot; title=dom-MessagePort-active&gt;active&lt;/a&gt;;
+  boolean &lt;a href=&quot;#postmessage0&quot; title=dom-MessagePort-postMessage&gt;postMessage&lt;/a&gt;(in DOMString message);
+  boolean &lt;a href=&quot;#postmessage0&quot; title=dom-MessagePort-postMessage&gt;postMessage&lt;/a&gt;(in DOMString message, in &lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt; messagePort);
+  void &lt;a href=&quot;#close2&quot; title=dom-MessagePort-close&gt;close&lt;/a&gt;();
 
   // event handler attributes
-           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=handler-endpipe-onmessage&gt;onmessage&lt;/span&gt;;
-           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=handler-endpipe-onunload&gt;onunload&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#onmessage1&quot; title=handler-MessagePort-onmessage&gt;onmessage&lt;/a&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#onunload0&quot; title=handler-MessagePort-onunload&gt;onunload&lt;/a&gt;;
 };&lt;/pre&gt;
 
-  &lt;p class=big-issue&gt;When the user agent is to &lt;dfn id=create&gt;create a new
-   &lt;code&gt;PipeEnd&lt;/code&gt; object&lt;/dfn&gt; owned by a &lt;code&gt;&lt;a
-   href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;owner&lt;/var&gt;, it
-   must...
+  &lt;p&gt;When the user agent is to &lt;dfn id=create&gt;create a new
+   &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/dfn&gt; owned by a &lt;code&gt;&lt;a
+   href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;owner&lt;/var&gt;, it must
+   run the following steps:
 
-  &lt;p class=big-issue&gt;When the user agent is to &lt;dfn
-   id=entangle&gt;entangle&lt;/dfn&gt; two &lt;code&gt;&lt;a
-   href=&quot;#pipeend0&quot;&gt;PipeEnd&lt;/a&gt;&lt;/code&gt; objects, it must...
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;Instantiate a new &lt;code&gt;&lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt;
+     object, and let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be that object.
 
+   &lt;li&gt;
+    &lt;p&gt;Set the &lt;code title=dom-MessagePort-ownerWindow&gt;&lt;a
+     href=&quot;#ownerwindow&quot;&gt;ownerWindow&lt;/a&gt;&lt;/code&gt; attribute of &lt;var
+     title=&quot;&quot;&gt;port&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;owner&lt;/var&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;Set the &lt;code title=dom-MessagePort-active&gt;&lt;a
+     href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute of &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;
+     be false.
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When the user agent is to &lt;dfn id=entangle&gt;entangle&lt;/dfn&gt; two &lt;code&gt;&lt;a
+   href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects, it must run the
+   following steps:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;If either port is already entangled, then let &lt;var
+     title=&quot;&quot;&gt;port1&lt;/var&gt; be that port, and run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+     &lt;li&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;old port&lt;/var&gt; be the port that &lt;var
+       title=&quot;&quot;&gt;port1&lt;/var&gt; is entangled with.
+
+     &lt;li&gt;
+      &lt;p&gt;Unentangle &lt;var title=&quot;&quot;&gt;old port&lt;/var&gt;, so that it is no longer
+       entangled with any ports.
+
+     &lt;li&gt;
+      &lt;p&gt;Set the &lt;code title=dom-MessagePort-active&gt;&lt;a
+       href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute of &lt;var title=&quot;&quot;&gt;old
+       port&lt;/var&gt; to false.
+
+     &lt;li&gt;
+      &lt;p&gt;Unentangle &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt;, so that it is no longer
+       entangled with any ports.
+    &lt;/ol&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;old port&lt;/var&gt; were the
+     two ports of a &lt;code&gt;&lt;a href=&quot;#messagechannel&quot;&gt;MessageChannel&lt;/a&gt;&lt;/code&gt;
+     object, then that &lt;code&gt;&lt;a
+     href=&quot;#messagechannel&quot;&gt;MessageChannel&lt;/a&gt;&lt;/code&gt; object no longer
+     represents an actual channel: the two ports in that object are no longer
+     entangled.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Associate the two ports to be entangled, so that they form the two
+     parts of a new channel. (There is no &lt;code&gt;&lt;a
+     href=&quot;#messagechannel&quot;&gt;MessageChannel&lt;/a&gt;&lt;/code&gt; object that represents
+     this channel.)
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When the user agent is to &lt;dfn id=clone&gt;clone a port&lt;/dfn&gt; &lt;var
+   title=&quot;&quot;&gt;original port&lt;/var&gt;, with the clone being owned by &lt;var
+   title=&quot;&quot;&gt;owner&lt;/var&gt;, it must run the following steps, which return either
+   a new &lt;code&gt;&lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; object or an
+   exception for the caller to raise:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;original port&lt;/var&gt; is not entangled without
+     another port, then return an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception
+     and abort all these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt; be the port with which the
+     &lt;var title=&quot;&quot;&gt;original port&lt;/var&gt; is entangled.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;original status&lt;/var&gt; be the value of the &lt;code
+     title=dom-MessagePort-active&gt;&lt;a href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt;
+     attribute of the &lt;var title=&quot;&quot;&gt;original port&lt;/var&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;&lt;a href=&quot;#create&quot;&gt;Create a new &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/a&gt;
+     owned by &lt;var title=&quot;&quot;&gt;owner&lt;/var&gt;, and let &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt;
+     be that object.
+
+   &lt;li&gt;
+    &lt;p&gt;&lt;a href=&quot;#entangle&quot;&gt;Entangle&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt;
+     and &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt; objects. The &lt;var title=&quot;&quot;&gt;original
+     port&lt;/var&gt; object will have its &lt;code title=dom-MessagePort-active&gt;&lt;a
+     href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute permanently set to false by
+     this process.
+
+   &lt;li&gt;
+    &lt;p&gt;Let the &lt;code title=dom-MessagePort-active&gt;&lt;a
+     href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute of the &lt;var title=&quot;&quot;&gt;new
+     port&lt;/var&gt; object have the same value as &lt;var title=&quot;&quot;&gt;original
+     status&lt;/var&gt;.
+   &lt;/li&gt;
+   &lt;!-- we
+   don't throw if it's false, because it might become true again,
+   e.g. if you're sending a port that is entangled with a port that's
+   associated with a document that's currently not the active document
+   of its iframe, but which hasn't been discarded yet --&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Return &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt;. It is the clone.
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn id=ownerwindow
+   title=dom-MessagePort-ownerWindow&gt;&lt;code&gt;ownerWindow&lt;/code&gt;&lt;/dfn&gt; attribute
+   must return the value it was assigned when the &lt;code&gt;&lt;a
+   href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; object was created.
+
+  &lt;p&gt;The &lt;dfn id=active0
+   title=dom-MessagePort-active&gt;&lt;code&gt;active&lt;/code&gt;&lt;/dfn&gt; attribute must
+   return the last value that it was set to according to the rules of this
+   specification.
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn id=postmessage0
+   title=dom-MessagePort-postMessage&gt;&lt;code&gt;postMessage()&lt;/code&gt;&lt;/dfn&gt; method,
+   when called on a port &lt;var title=&quot;&quot;&gt;source port&lt;/var&gt;, must cause the user
+   agent to run the following steps:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be the method's first argument.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;data port&lt;/var&gt; be the method's second argument, if
+     any.
+
+   &lt;li&gt;
+    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;source port&lt;/var&gt;'s &lt;code
+     title=dom-MessagePort-active&gt;&lt;a href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt;
+     attribute is false, then return false and abort these steps.
+   &lt;/li&gt;
+   &lt;!-- we don't
+   raise an exception because this attribute can become false at a
+   moment's notice, but we return false so that the caller can check
+   whether the port was active at time of calling without a race
+   condition. --&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt; be the port with which &lt;var
+     title=&quot;&quot;&gt;source port&lt;/var&gt; is entangled.
+
+   &lt;li&gt;
+    &lt;p&gt;Create an event that uses the &lt;code&gt;&lt;a
+     href=&quot;#messageevent&quot;&gt;MessageEvent&lt;/a&gt;&lt;/code&gt; interface, with the name
+     &lt;code title=event-message&gt;&lt;a href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt;, which
+     does not bubble, is cancelable, and has no default action.
+
+   &lt;li&gt;
+    &lt;p&gt;Let the &lt;code title=dom-MessageEvent-data&gt;&lt;a
+     href=&quot;#data4&quot;&gt;data&lt;/a&gt;&lt;/code&gt; attribute of the event have the value of
+     &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, the method's first argument.
+
+   &lt;li&gt;
+    &lt;p&gt;If the method was called with a second argument &lt;var title=&quot;&quot;&gt;data
+     port&lt;/var&gt; and that argument isn't null, then run the following
+     substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+     &lt;li&gt;
+      &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;data port&lt;/var&gt; is the &lt;var title=&quot;&quot;&gt;source
+       port&lt;/var&gt; or the &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt;, then throw an
+       &lt;code&gt;INVALID_ACCESS_ERR&lt;/code&gt; exception and abort all these steps.
+
+     &lt;li&gt;
+      &lt;p&gt;Try to obtain a &lt;var title=&quot;&quot;&gt;new data port&lt;/var&gt; by &lt;a
+       href=&quot;#clone&quot; title=&quot;clone a port&quot;&gt;cloning&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;data
+       port&lt;/var&gt; with the &lt;a href=&quot;#ownerwindow&quot;
+       title=dom-MessagePort-ownerWindow&gt;owner&lt;/a&gt; of the &lt;var
+       title=&quot;&quot;&gt;target port&lt;/var&gt; as the owner of the clone. If this returns
+       an exception, then throw that exception and abort these steps.
+
+     &lt;li&gt;
+      &lt;p&gt;Let the &lt;code title=dom-MessageEvent-messagePort&gt;&lt;a
+       href=&quot;#messageport&quot;&gt;messagePort&lt;/a&gt;&lt;/code&gt; attribute of the event be
+       the &lt;var title=&quot;&quot;&gt;new data port&lt;/var&gt;.
+    &lt;/ol&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Return true from the method, but continue with these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;Wait for all scripts in the &lt;a href=&quot;#unit-of&quot;&gt;unit of related
+     browsing contexts&lt;/a&gt; to which the the &lt;a href=&quot;#ownerwindow&quot;
+     title=dom-MessagePort-ownerWindow&gt;owner&lt;/a&gt; of the &lt;var title=&quot;&quot;&gt;target
+     port&lt;/var&gt; belongs to have executed to completion, and then dispatch the
+     event at the &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt; object. If this never
+     happens (e.g. the relevant &lt;a href=&quot;#browsing1&quot;&gt;browsing context&lt;/a&gt; is
+     closed by the user before the event can be dispatched), then discard the
+     event.
+   &lt;/li&gt;
+   &lt;!-- XXX queue --&gt;
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn id=close2
+   title=dom-MessagePort-close&gt;&lt;code&gt;close()&lt;/code&gt;&lt;/dfn&gt; method, when called
+   on a port &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt;, must cause the user agent to run
+   the following steps:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt; is entangled with another port, then
+     let &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt; be that port and run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+     &lt;li&gt;
+      &lt;p&gt;Unentangle &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt;, so that it is no longer
+       entangled with any ports.
+
+     &lt;li&gt;
+      &lt;p&gt;Set the &lt;code title=dom-MessagePort-active&gt;&lt;a
+       href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute of &lt;var title=&quot;&quot;&gt;remote
+       port&lt;/var&gt; to false.
+
+     &lt;li&gt;
+      &lt;p&gt;Unentangle &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt;, so that it is no longer
+       entangled with any ports.
+    &lt;/ol&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Set the &lt;code title=dom-MessagePort-active&gt;&lt;a
+     href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute of &lt;var title=&quot;&quot;&gt;local
+     port&lt;/var&gt; to false.
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The following are the &lt;a href=&quot;#event4&quot;&gt;event handler DOM attributes&lt;/a&gt;
+   that must be supported by objects implementing the &lt;code&gt;&lt;a
+   href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; interface:
+
+  &lt;dl&gt;
+   &lt;dt&gt;&lt;dfn id=onmessage1
+    title=handler-MessagePort-onmessage&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever a &lt;code
+     title=event-MessagePort-message&gt;message&lt;/code&gt; event is targeted at or
+     bubbles through the &lt;code&gt;&lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt;
+     object.
+
+   &lt;dt&gt;&lt;dfn id=onunload0
+    title=handler-MessagePort-onunload&gt;&lt;code&gt;onunload&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever an &lt;code title=event-unload&gt;unload&lt;/code&gt;
+     event is targeted at or bubbles through the &lt;code&gt;&lt;a
+     href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; object.
+  &lt;/dl&gt;
+
+  &lt;p class=note&gt;Nothing in this specification causes an &lt;code
+   title=event-unload&gt;unload&lt;/code&gt; event to be targetted at a &lt;code&gt;&lt;a
+   href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; object. This feature is
+   intended for use with Workers. &lt;a href=&quot;#refsWORKERS&quot;&gt;[WORKERS]&lt;/a&gt;
+
+  &lt;h5 id=ports&gt;&lt;span class=secno&gt;7.5.3.1. &lt;/span&gt;Ports and browsing contexts&lt;/h5&gt;
+
+  &lt;p&gt;During &lt;a href=&quot;#traverse&quot; title=&quot;traverse the history&quot;&gt;session history
+   traversal&lt;/a&gt; (e.g. when a user &lt;a href=&quot;#navigate&quot;
+   title=navigate&gt;navigates&lt;/a&gt; a &lt;a href=&quot;#browsing1&quot;&gt;browsing context&lt;/a&gt;
+   to another page, or goes back to a previous page), the user agent will
+   have to &lt;a href=&quot;#port-traversal-deactivation&quot;&gt;deactivate&lt;/a&gt; and/or &lt;a
+   href=&quot;#port-traversal-reactivation&quot;&gt;reactivate&lt;/a&gt; some ports.
+
+  &lt;p&gt;Ports are deactivated and unentangled when the &lt;code&gt;Document&lt;/code&gt;
+   that was the &lt;a href=&quot;#active&quot;&gt;active document&lt;/a&gt; of the &lt;a
+   href=&quot;#browsing1&quot;&gt;browsing context&lt;/a&gt; corresponding to the &lt;code&gt;&lt;a
+   href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object that &lt;a href=&quot;#ownerwindow&quot;
+   title=dom-MessagePort-ownerWindow&gt;owns&lt;/a&gt; them is &lt;a href=&quot;#discard&quot;
+   title=&quot;discard a document&quot;&gt;discarded&lt;/a&gt;.
+
+  &lt;p&gt;To &lt;dfn id=deactivate&gt;deactivate a port&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;local
+   port&lt;/var&gt; that is entangled with a second port &lt;var title=&quot;&quot;&gt;remote
+   port&lt;/var&gt;, the user agent must set the &lt;code
+   title=dom-MessagePort-active&gt;&lt;a href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt;
+   attribute of the &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt; to false.
+
+  &lt;p&gt;To &lt;dfn id=reactivate&gt;reactivate a port&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;local
+   port&lt;/var&gt; that is entangled with a second port &lt;var title=&quot;&quot;&gt;remote
+   port&lt;/var&gt;, the user agent must set the &lt;code
+   title=dom-MessagePort-active&gt;&lt;a href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt;
+   attribute of the &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt; to true.
+
+  &lt;p class=note&gt;It's important to note that activating or deactivating a port
+   actually changes the &lt;code title=dom-MessagePort-active&gt;&lt;a
+   href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute of the port's entangled port,
+   not its own attribute.
+
+  &lt;h5 id=ports0&gt;&lt;span class=secno&gt;7.5.3.2. &lt;/span&gt;Ports and garbage
+   collection&lt;/h5&gt;
+
+  &lt;p&gt;User agents must act as if &lt;code&gt;&lt;a
+   href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects have a strong
+   reference to their entangled &lt;code&gt;&lt;a
+   href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; object so long as that other
+   &lt;code&gt;&lt;a href=&quot;#messageport0&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt; object has any &lt;code
+   title=event-message&gt;&lt;a href=&quot;#message2&quot;&gt;message&lt;/a&gt;&lt;/code&gt; or &lt;code
+   title=event-unload&gt;unload&lt;/code&gt; event listeners registered.
+
+  &lt;div class=note&gt;
+   &lt;p&gt;Thus, a message port can be received, given an event listener, and then
+    forgotten, and so long as that event listener could receive a message,
+    the channel will be maintained.&lt;/p&gt;
+
+   &lt;p&gt;Of course, if this was to occur on both sides of the channel, then both
+    ports would be garbage collected, since they would not be reachable from
+    live code, despite having a strong reference to each other.&lt;/p&gt;
+  &lt;/div&gt;
+
+  &lt;p&gt;When an entangled message port is about to be garbage collected, it must
+   be &lt;a href=&quot;#deactivate&quot; title=&quot;deactivate a port&quot;&gt;deactivated&lt;/a&gt; and
+   then unentangled, so that the two ports are no longer related and so that
+   the other port's &lt;code title=dom-MessagePort-active&gt;&lt;a
+   href=&quot;#active0&quot;&gt;active&lt;/a&gt;&lt;/code&gt; attribute is set to false.
+
   &lt;h2 id=syntax&gt;&lt;span class=secno&gt;8. &lt;/span&gt;The HTML syntax&lt;/h2&gt;
 
   &lt;h3 id=writing0&gt;&lt;span class=secno&gt;8.1 &lt;/span&gt;Writing HTML documents&lt;/h3&gt;
@@ -44228,7 +44612,7 @@
 
    &lt;dd&gt;
     &lt;p&gt;The following HTML elements are those that end up in the &lt;a
-     href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt;: &lt;code&gt;&lt;a
+     href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt;: &lt;code&gt;&lt;a
      href=&quot;#a&quot;&gt;a&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#b&quot;&gt;b&lt;/a&gt;&lt;/code&gt;,
      &lt;code&gt;big&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#em&quot;&gt;em&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;font&lt;/code&gt;,
      &lt;code&gt;&lt;a href=&quot;#i&quot;&gt;i&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;nobr&lt;/code&gt;, &lt;code&gt;s&lt;/code&gt;,
@@ -44343,7 +44727,7 @@
   &lt;h5 id=the-list&gt;&lt;span class=secno&gt;8.2.3.3. &lt;/span&gt;The list of active
    formatting elements&lt;/h5&gt;
 
-  &lt;p&gt;Initially the &lt;dfn id=list-of4&gt;list of active formatting elements&lt;/dfn&gt;
+  &lt;p&gt;Initially the &lt;dfn id=list-of5&gt;list of active formatting elements&lt;/dfn&gt;
    is empty. It is used to handle mis-nested &lt;a href=&quot;#formatting&quot;
    title=formatting&gt;formatting element tags&lt;/a&gt;.
 
@@ -44360,32 +44744,32 @@
    steps:
 
   &lt;ol&gt;
-   &lt;li&gt;If there are no entries in the &lt;a href=&quot;#list-of4&quot;&gt;list of active
+   &lt;li&gt;If there are no entries in the &lt;a href=&quot;#list-of5&quot;&gt;list of active
     formatting elements&lt;/a&gt;, then there is nothing to reconstruct; stop this
     algorithm.
 
    &lt;li&gt;If the last (most recently added) entry in the &lt;a
-    href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt; is a marker, or
+    href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt; is a marker, or
     if it is an element that is in the &lt;a href=&quot;#stack&quot;&gt;stack of open
     elements&lt;/a&gt;, then there is nothing to reconstruct; stop this algorithm.
 
    &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; be the last (most recently added)
-    element in the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+    element in the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
     elements&lt;/a&gt;.
 
    &lt;li&gt;If there are no entries before &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; in the &lt;a
-    href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt;, then jump to
+    href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt;, then jump to
     step 8.
 
    &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; be the entry one earlier than &lt;var
-    title=&quot;&quot;&gt;entry&lt;/var&gt; in the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+    title=&quot;&quot;&gt;entry&lt;/var&gt; in the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
     elements&lt;/a&gt;.
 
    &lt;li&gt;If &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; is neither a marker nor an element that
     is also in the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;, go to step 4.
 
    &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; be the element one later than &lt;var
-    title=&quot;&quot;&gt;entry&lt;/var&gt; in the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+    title=&quot;&quot;&gt;entry&lt;/var&gt; in the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
     elements&lt;/a&gt;.
 
    &lt;li&gt;Perform a shallow clone of the element &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; to
@@ -44399,7 +44783,7 @@
     entry for &lt;var title=&quot;&quot;&gt;clone&lt;/var&gt;.
 
    &lt;li&gt;If the entry for &lt;var title=&quot;&quot;&gt;clone&lt;/var&gt; in the &lt;a
-    href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt; is not the last
+    href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt; is not the last
     entry in the list, return to step 7.
   &lt;/ol&gt;
 
@@ -44408,7 +44792,7 @@
    haven't been explicitly closed.
 
   &lt;p class=note&gt;The way this specification is written, the &lt;a
-   href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt; always consists of
+   href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt; always consists of
    elements in chronological order with the least recently added element
    first and the most recently added element last (except for while steps 8
    to 11 of the above algorithm are being executed, of course).
@@ -44419,9 +44803,9 @@
 
   &lt;ol&gt;
    &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; be the last (most recently added) entry
-    in the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt;.
+    in the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt;.
 
-   &lt;li&gt;Remove &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; from the &lt;a href=&quot;#list-of4&quot;&gt;list of
+   &lt;li&gt;Remove &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; from the &lt;a href=&quot;#list-of5&quot;&gt;list of
     active formatting elements&lt;/a&gt;.
 
    &lt;li&gt;If &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; was a marker, then stop the algorithm at
@@ -44620,7 +45004,7 @@
 
      &lt;dd&gt;
       &lt;p&gt;Consume the &lt;a href=&quot;#next-input&quot;&gt;next input character&lt;/a&gt;. If it is
-       a U+002F SOLIDUS (/) character, switch to the &lt;a href=&quot;#close2&quot;&gt;close
+       a U+002F SOLIDUS (/) character, switch to the &lt;a href=&quot;#close3&quot;&gt;close
        tag open state&lt;/a&gt;. Otherwise, emit a U+003C LESS-THAN SIGN character
        token and reconsume the current input character in the &lt;a
        href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.&lt;/p&gt;
@@ -44638,7 +45022,7 @@
 
        &lt;dt&gt;U+002F SOLIDUS (/)
 
-       &lt;dd&gt;Switch to the &lt;a href=&quot;#close2&quot;&gt;close tag open state&lt;/a&gt;.
+       &lt;dd&gt;Switch to the &lt;a href=&quot;#close3&quot;&gt;close tag open state&lt;/a&gt;.
 
        &lt;dt&gt;U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL
         LETTER Z
@@ -44675,7 +45059,7 @@
       &lt;/dl&gt;
     &lt;/dl&gt;
 
-   &lt;dt&gt;&lt;dfn id=close2&gt;Close tag open state&lt;/dfn&gt;
+   &lt;dt&gt;&lt;dfn id=close3&gt;Close tag open state&lt;/dfn&gt;
 
    &lt;dd&gt;
     &lt;p&gt;If the &lt;a href=&quot;#content3&quot;&gt;content model flag&lt;/a&gt; is set to the RCDATA
@@ -46610,7 +46994,7 @@
      this is a &lt;a href=&quot;#parse2&quot;&gt;parse error&lt;/a&gt;.
   &lt;/ol&gt;
 
-  &lt;h5 id=closing0&gt;&lt;span class=secno&gt;8.2.5.2. &lt;/span&gt;Closing elements that
+  &lt;h5 id=closing1&gt;&lt;span class=secno&gt;8.2.5.2. &lt;/span&gt;Closing elements that
    have implied end tags&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=generate&gt;generate implied
@@ -47982,12 +48366,12 @@
    &lt;dt&gt;A start tag whose tag name is &quot;a&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;If the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt;
+    &lt;p&gt;If the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt;
      contains an element whose tag name is &quot;a&quot; between the end of the list
      and the last marker on the list (or the start of the list if there is no
      marker on the list), then this is a &lt;a href=&quot;#parse2&quot;&gt;parse error&lt;/a&gt;;
      act as if an end tag with the tag name &quot;a&quot; had been seen, then remove
-     that element from the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+     that element from the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
      elements&lt;/a&gt; and the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; if the
      end tag didn't already remove it (it might not have if the element is
      not &lt;a href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;in table
@@ -48006,7 +48390,7 @@
      if any.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token. Add that
-     element to the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+     element to the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
      elements&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt&gt;A start tag whose tag name is one of: &quot;b&quot;, &quot;big&quot;, &quot;em&quot;, &quot;font&quot;, &quot;i&quot;,
@@ -48017,7 +48401,7 @@
      if any.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token. Add that
-     element to the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+     element to the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
      elements&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;nobr&quot;
@@ -48034,7 +48418,7 @@
      any.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token. Add that
-     element to the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+     element to the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
      elements&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt id=adoptionAgency&gt;An end tag whose tag name is one of: &quot;a&quot;, &quot;b&quot;,
@@ -48047,7 +48431,7 @@
     &lt;ol&gt;
      &lt;li&gt;
       &lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;formatting element&lt;/var&gt; be the last element
-       in the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt;
+       in the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt;
        that:&lt;/p&gt;
 
       &lt;ul&gt;
@@ -48088,7 +48472,7 @@
        bottom of the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;, from the &lt;a
        href=&quot;#current5&quot;&gt;current node&lt;/a&gt; up to and including the &lt;var
        title=&quot;&quot;&gt;formatting element&lt;/var&gt;, and remove the &lt;var
-       title=&quot;&quot;&gt;formatting element&lt;/var&gt; from the &lt;a href=&quot;#list-of4&quot;&gt;list of
+       title=&quot;&quot;&gt;formatting element&lt;/var&gt; from the &lt;a href=&quot;#list-of5&quot;&gt;list of
        active formatting elements&lt;/a&gt;.
 
      &lt;li&gt;
@@ -48102,7 +48486,7 @@
 
      &lt;li&gt;
       &lt;p&gt;Let a bookmark note the position of the &lt;var title=&quot;&quot;&gt;formatting
-       element&lt;/var&gt; in the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+       element&lt;/var&gt; in the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
        elements&lt;/a&gt; relative to the elements on either side of it in the
        list.
 
@@ -48115,7 +48499,7 @@
         title=&quot;&quot;&gt;node&lt;/var&gt; in the &lt;a href=&quot;#stack&quot;&gt;stack of open
         elements&lt;/a&gt;.
 
-       &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not in the &lt;a href=&quot;#list-of4&quot;&gt;list
+       &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not in the &lt;a href=&quot;#list-of5&quot;&gt;list
         of active formatting elements&lt;/a&gt;, then remove &lt;var
         title=&quot;&quot;&gt;node&lt;/var&gt; from the &lt;a href=&quot;#stack&quot;&gt;stack of open
         elements&lt;/a&gt; and then go back to step 1.
@@ -48127,11 +48511,11 @@
        &lt;li&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt; is the &lt;var
         title=&quot;&quot;&gt;furthest block&lt;/var&gt;, then move the aforementioned bookmark
         to be immediately after the &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in the &lt;a
-        href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt;.
+        href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt;.
 
        &lt;li&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; has any children, perform a shallow
         clone of &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, replace the entry for &lt;var
-        title=&quot;&quot;&gt;node&lt;/var&gt; in the &lt;a href=&quot;#list-of4&quot;&gt;list of active
+        title=&quot;&quot;&gt;node&lt;/var&gt; in the &lt;a href=&quot;#list-of5&quot;&gt;list of active
         formatting elements&lt;/a&gt; with an entry for the clone, replace the
         entry for &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in the &lt;a href=&quot;#stack&quot;&gt;stack of
         open elements&lt;/a&gt; with an entry for the clone, and let &lt;var
@@ -48172,8 +48556,8 @@
 
      &lt;li&gt;
       &lt;p&gt;Remove the &lt;var title=&quot;&quot;&gt;formatting element&lt;/var&gt; from the &lt;a
-       href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt;, and insert
-       the clone into the &lt;a href=&quot;#list-of4&quot;&gt;list of active formatting
+       href=&quot;#list-of5&quot;&gt;list of active formatting elements&lt;/a&gt;, and insert
+       the clone into the &lt;a href=&quot;#list-of5&quot;&gt;list of active formatting
        elements&lt;/a&gt; at the position of the aforementioned bookmark.
 
      &lt;li&gt;
@@ -48223,7 +48607,7 @@
      pointed to by the &lt;a href=&quot;#form-element&quot;&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt;
      element pointer&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Insert a marker at the end of the &lt;a href=&quot;#list-of4&quot;&gt;list of active
+    &lt;p&gt;Insert a marker at the end of the &lt;a href=&quot;#list-of5&quot;&gt;list of active
      formatting elements&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt&gt;A start tag token whose tag name is one of: &quot;applet&quot;, &quot;marquee&quot;,
@@ -48235,7 +48619,7 @@
 
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token.&lt;/p&gt;
 
-    &lt;p&gt;Insert a marker at the end of the &lt;a href=&quot;#list-of4&quot;&gt;list of active
+    &lt;p&gt;Insert a marker at the end of the &lt;a href=&quot;#list-of5&quot;&gt;list of active
      formatting elements&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt&gt;An end tag token whose tag name is one of: &quot;applet&quot;, &quot;button&quot;,
@@ -48706,7 +49090,7 @@
     &lt;p&gt;&lt;a href=&quot;#clear2&quot;&gt;Clear the stack back to a table context&lt;/a&gt;. (See
      below.)&lt;/p&gt;
 
-    &lt;p&gt;Insert a marker at the end of the &lt;a href=&quot;#list-of4&quot;&gt;list of active
+    &lt;p&gt;Insert a marker at the end of the &lt;a href=&quot;#list-of5&quot;&gt;list of active
      formatting elements&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token, then
@@ -49108,7 +49492,7 @@
      switch the &lt;span&gt;insertion mode&lt;/span&gt; to &quot;&lt;a href=&quot;#in-cell&quot;
      title=&quot;insertion mode: in cell&quot;&gt;in cell&lt;/a&gt;&quot;.&lt;/p&gt;
 
-    &lt;p&gt;Insert a marker at the end of the &lt;a href=&quot;#list-of4&quot;&gt;list of active
+    &lt;p&gt;Insert a marker at the end of the &lt;a href=&quot;#list-of5&quot;&gt;list of active
      formatting elements&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt&gt;An end tag whose tag name is &quot;tr&quot;
@@ -49225,7 +49609,7 @@
      is a &lt;a href=&quot;#parse2&quot;&gt;parse error&lt;/a&gt;; ignore the token. (&lt;a
      href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;a href=&quot;#close3&quot;&gt;close the cell&lt;/a&gt; (see below) and
+    &lt;p&gt;Otherwise, &lt;a href=&quot;#close4&quot;&gt;close the cell&lt;/a&gt; (see below) and
      reprocess the current token.&lt;/p&gt;
 
    &lt;dt&gt;An end tag whose tag name is one of: &quot;body&quot;, &quot;caption&quot;, &quot;col&quot;,
@@ -49245,7 +49629,7 @@
      href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;), then this is a &lt;a
      href=&quot;#parse2&quot;&gt;parse error&lt;/a&gt; and the token must be ignored.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;a href=&quot;#close3&quot;&gt;close the cell&lt;/a&gt; (see below) and
+    &lt;p&gt;Otherwise, &lt;a href=&quot;#close4&quot;&gt;close the cell&lt;/a&gt; (see below) and
      reprocess the current token.&lt;/p&gt;
 
    &lt;dt&gt;Anything else
@@ -49256,7 +49640,7 @@
      &lt;span&gt;insertion mode&lt;/span&gt;.&lt;/p&gt;
   &lt;/dl&gt;
 
-  &lt;p&gt;Where the steps above say to &lt;dfn id=close3&gt;close the cell&lt;/dfn&gt;, they
+  &lt;p&gt;Where the steps above say to &lt;dfn id=close4&gt;close the cell&lt;/dfn&gt;, they
    mean to run the following algorithm:
 
   &lt;ol&gt;

Modified: source
===================================================================
--- source	2008-07-13 00:50:37 UTC (rev 1872)
+++ source	2008-07-15 10:06:47 UTC (rev 1873)
@@ -16823,9 +16823,9 @@
   &lt;p&gt;The &lt;dfn title=&quot;dom-media-muted&quot;&gt;&lt;code&gt;muted&lt;/code&gt;&lt;/dfn&gt;
   attribute must return true if the audio channels are muted and false
   otherwise. On setting, the attribute must be set to the new value;
-  if the new value is true, audio playback for this &lt;span&gt;media resource&lt;/span&gt;
-  must then be muted, and if false, audio playback must then be
-  enabled.&lt;/p&gt;
+  if the new value is true, audio playback for this &lt;span&gt;media
+  resource&lt;/span&gt; must then be muted, and if false, audio playback
+  must then be enabled.&lt;/p&gt;
 
   &lt;p&gt;Whenever either the &lt;code title=&quot;dom-media-muted&quot;&gt;muted&lt;/code&gt; or
   &lt;code title=&quot;dom-media-volume&quot;&gt;volume&lt;/code&gt; attributes are changed,
@@ -27779,7 +27779,7 @@
 
   // &lt;span&gt;cross-document messaging&lt;/span&gt;
   void &lt;span title=&quot;dom-window-postMessage&quot;&gt;postMessage&lt;/span&gt;(in DOMString message, in DOMString targetOrigin);
-  void &lt;span title=&quot;dom-window-postMessage&quot;&gt;postMessage&lt;/span&gt;(in DOMString message, in &lt;span&gt;PipeEnd&lt;/span&gt; pipeEnd, in DOMString targetOrigin);
+  void &lt;span title=&quot;dom-window-postMessage&quot;&gt;postMessage&lt;/span&gt;(in DOMString message, in &lt;span&gt;MessagePort&lt;/span&gt; messagePort, in DOMString targetOrigin);
 
   // &lt;span&gt;event handler DOM attributes&lt;/span&gt;
            attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-onabort&quot;&gt;onabort&lt;/span&gt;;
@@ -27830,12 +27830,21 @@
   &lt;p&gt;The &lt;code&gt;Window&lt;/code&gt; object also provides the scope for script
   execution. Each &lt;code&gt;Document&lt;/code&gt; in a &lt;span&gt;browsing
   context&lt;/span&gt; has an associated &lt;dfn&gt;list of added properties&lt;/dfn&gt;
-  which, when a document is &lt;span title=&quot;active
-  document&quot;&gt;active&lt;/span&gt;, are available on the &lt;code&gt;Document&lt;/code&gt;'s
-  &lt;span&gt;default view&lt;/span&gt; &lt;code&gt;Window&lt;/code&gt; object. A
-  &lt;code&gt;Document&lt;/code&gt; object's &lt;span&gt;list of added properties&lt;/span&gt;
-  must be empty when the &lt;code&gt;Document&lt;/code&gt; object is created.&lt;/p&gt;
+  that, when a document is &lt;span title=&quot;active
+  document&quot;&gt;active&lt;/span&gt;, are available on the
+  &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;default view&lt;/span&gt;'s
+  &lt;code&gt;Window&lt;/code&gt; object. A &lt;code&gt;Document&lt;/code&gt; object's
+  &lt;span&gt;list of added properties&lt;/span&gt; must be empty when the
+  &lt;code&gt;Document&lt;/code&gt; object is created.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; in a &lt;span&gt;browsing context&lt;/span&gt;
+  also has an associated &lt;dfn&gt;list of message ports&lt;/dfn&gt;, which must
+  be initially empty. The list is used during &lt;span title=&quot;traverse
+  the history&quot;&gt;history traversal&lt;/span&gt; in much the same way as the
+  &lt;span&gt;list of added properties&lt;/span&gt;, to keep track of message
+  ports that need to be reactivated if the &lt;code&gt;Document&lt;/code&gt; is
+  made the &lt;span&gt;active document&lt;/span&gt; again.&lt;/p&gt;
+
   &lt;p&gt;Objects implementing the &lt;code&gt;Window&lt;/code&gt; interface must also
   implement the &lt;code&gt;EventTarget&lt;/code&gt; interface.&lt;/p&gt;
 
@@ -31611,41 +31620,37 @@
   &lt;code&gt;Document&lt;/code&gt; (and that are therefore merely different
   states of one particular document) are contiguous by definition.&lt;/p&gt;
 
-  &lt;p&gt;User agents may &lt;dfn&gt;discard&lt;/dfn&gt; the DOMs of entries other than
-  the &lt;span&gt;current entry&lt;/span&gt; that are not referenced from any
-  script, reloading the pages afresh when the user or script navigates
-  back to such pages. This specification does not specify when user
-  agents should discard pages' DOMs and when they should cache
-  them. See the section on the &lt;code title=&quot;event-load&quot;&gt;load&lt;/code&gt;
-  and &lt;code title=&quot;event-unload&quot;&gt;unload&lt;/code&gt; events for more
-  details.&lt;/p&gt; &lt;!-- XXX crossref! XXXDISCARD --&gt;
+  &lt;p&gt;User agents may &lt;span title=&quot;discard a Document&quot;&gt;discard&lt;/span&gt;
+  the &lt;code&gt;Document&lt;/code&gt; objects of entries other than the
+  &lt;span&gt;current entry&lt;/span&gt; that are not referenced from any script,
+  reloading the pages afresh when the user or script navigates back to
+  such pages. This specification does not specify when user agents
+  should discard &lt;code&gt;Document&lt;/code&gt; objects and when they should
+  cache them.&lt;/p&gt;
 
-  &lt;p&gt;Entries that have had their DOM discarded must, for the purposes
-  of the algorithms given below, act as if they had not. When the user
-  or script navigates back or forwards to a page which has no
-  in-memory DOM objects, any other entries that shared the same
-  &lt;code&gt;Document&lt;/code&gt; object with it must share the new object as
-  well.&lt;/p&gt;
+  &lt;p&gt;Entries that have had their &lt;code&gt;Document&lt;/code&gt; objects
+  discarded must, for the purposes of the algorithms given below, act
+  as if they had not. When the user or script navigates back or
+  forwards to a page which has no in-memory DOM objects, any other
+  entries that shared the same &lt;code&gt;Document&lt;/code&gt; object with it
+  must share the new object as well.&lt;/p&gt;
 
   &lt;p&gt;When state object entries are added, a URL can be provided. This
   URL is used to replace the state object entry if the
   &lt;code&gt;Document&lt;/code&gt; is evicted.&lt;/p&gt;
 
-  &lt;p&gt;When a user agent discards the DOM from an entry in the session
-  history, it must also discard all the entries that share that
-  &lt;code&gt;Document&lt;/code&gt; but do not have an associated URL
-  (i.e. entries that only have a &lt;span&gt;state object&lt;/span&gt;). Entries
-  that shared that &lt;code&gt;Document&lt;/code&gt; object but had a state object
-  and have a different URL must then have their &lt;em&gt;state objects&lt;/em&gt;
-  removed. Removed entries are not recreated if the user or script
-  navigates back to the page. If there are no state object entries for
-  that &lt;code&gt;Document&lt;/code&gt; object then no entries are removed.&lt;/p&gt;
+  &lt;p&gt;When a user agent discards the &lt;code&gt;Document&lt;/code&gt; object from
+  an entry in the session history, it must also discard all the
+  entries that share that &lt;code&gt;Document&lt;/code&gt; but do not have an
+  associated URL (i.e. entries that only have a &lt;span&gt;state
+  object&lt;/span&gt;). Entries that shared that &lt;code&gt;Document&lt;/code&gt;
+  object but had a state object and have a different URL must then
+  have their &lt;em&gt;state objects&lt;/em&gt; removed. Removed entries are not
+  recreated if the user or script navigates back to the page. If there
+  are no state object entries for that &lt;code&gt;Document&lt;/code&gt; object
+  then no entries are removed.&lt;/p&gt;
 
-  &lt;p class=&quot;big-issue&quot;&gt;&lt;!--XXXDISCARD--&gt; when an entry is discarded,
-  any frozen timers, intervals, XMLHttpRequests, database
-  transactions, etc, must be killed &lt;/p&gt;
 
-
   &lt;h4&gt;The &lt;code&gt;History&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;History&lt;/dfn&gt; {
@@ -32316,10 +32321,7 @@
 
    &lt;li&gt;&lt;p class=&quot;big-issue&quot;&gt;onunload, and if present set flag that we will kill document&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p class=&quot;big-issue&quot;&gt;if flag is set: reset timers, empty event
-   queue, kill any pending transactions, kill XMLHttpRequests, etc,
-   and set things up so that the document will be discarded asap
-   &lt;!--XXXDISCARD--&gt;&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p class=&quot;big-issue&quot;&gt;if flag is set: &lt;span title=&quot;discard a document&quot;&gt;discard the &lt;code&gt;Document&lt;/code&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -32722,6 +32724,14 @@
      &lt;li class=&quot;big-issue&quot;&gt;freeze any timers, intervals,
      XMLHttpRequests, database transactions, etc&lt;/li&gt;
 
+     &lt;li id=&quot;port-traversal-deactivation&quot;&gt;If there are any
+     &lt;code&gt;MessagePort&lt;/code&gt; objects whose owner is the browsing
+     context's default view's &lt;code&gt;Window&lt;/code&gt; object and that are
+     entangled with another port, the user agent must &lt;span
+     title=&quot;deactivate a port&quot;&gt;deactivate&lt;/span&gt; all such ports and
+     let the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;list of message
+     ports&lt;/span&gt; be a list of those ports.&lt;/li&gt;
+
      &lt;li&gt;The user agent must move any properties that have been added
      to the browsing context's default view's &lt;code&gt;Window&lt;/code&gt;
      object to the &lt;span&gt;active document&lt;/span&gt;'s
@@ -32783,6 +32793,12 @@
      &lt;span&gt;list of added properties&lt;/span&gt; to browsing context's
      default view's &lt;code&gt;Window&lt;/code&gt; object.&lt;/li&gt;
 
+     &lt;li id=&quot;port-traversal-reactivation&quot;&gt;If the &lt;span&gt;active
+     document&lt;/span&gt;'s &lt;span&gt;list of message ports&lt;/span&gt; is not
+     empty, then the user agent must &lt;span title=&quot;reactivate a
+     port&quot;&gt;reactivate&lt;/span&gt; all the ports in that list. Empty that
+     &lt;span&gt;list of message ports&lt;/span&gt;.&lt;/li&gt;
+
      &lt;li class=&quot;big-issue&quot;&gt;unfreeze any timers, intervals,
      XMLHttpRequests, database transactions, etc&lt;/li&gt;
 
@@ -32827,9 +32843,31 @@
   affect .watch() when seen from other Windows?&lt;/p&gt;
 
 
+  &lt;h4&gt;Closing a browsing context&lt;/h4&gt;
 
+  &lt;p class=&quot;big-issue&quot;&gt;Closing a browsing context and discarding it
+  (vs closing it and keeping it around in memory).&lt;/p&gt;
 
+  &lt;p class=&quot;big-issue&quot;&gt;when a browsing context is closed, all session
+  history entries' &lt;code&gt;Document&lt;/code&gt; objects must be
+  discarded.&lt;/p&gt;
 
+  &lt;p class=&quot;big-issue&quot;&gt;When a user agent is to &lt;dfn&gt;discard a
+  &lt;code&gt;Document&lt;/code&gt;&lt;/dfn&gt;, any frozen timers, intervals,
+  XMLHttpRequests, database transactions, etc, must be killed, and any
+  ports owned by the Window object that aren't in a &lt;span&gt;list of
+  message ports&lt;/span&gt;, if the document is the &lt;span&gt;active
+  document&lt;/span&gt;, or otherwise any ports in that document's
+  &lt;span&gt;list of message ports&lt;/span&gt;, if the document is not the
+  &lt;span&gt;active document&lt;/span&gt;, must be &lt;span&gt;deactivated&lt;/span&gt; and
+  unentangled.&lt;/p&gt;
+
+  &lt;p class=&quot;big-issue&quot;&gt;Also, &lt;code title=&quot;event-unload&quot;&gt;unload&lt;/code&gt;
+  events should fire.&lt;/p&gt;
+
+
+
+
   &lt;h3&gt;Structured client-side storage&lt;/h3&gt;
 
   &lt;h4 id=&quot;storage&quot;&gt;Storing name/value pairs&lt;/h4&gt;
@@ -38275,7 +38313,7 @@
 
   &lt;p&gt;Messages in &lt;span&gt;server-sent events&lt;/span&gt;, &lt;span&gt;Web
   sockets&lt;/span&gt;, &lt;span&gt;cross-document messaging&lt;/span&gt;, and
-  &lt;span&gt;pipe messaging&lt;/span&gt; use the &lt;dfn
+  &lt;span&gt;channel messaging&lt;/span&gt; use the &lt;dfn
   title=&quot;event-message&quot;&gt;&lt;code&gt;message&lt;/code&gt;&lt;/dfn&gt; event.&lt;/p&gt;
 
   &lt;p&gt;The following interface is defined for this event:&lt;/p&gt;
@@ -38285,9 +38323,9 @@
   readonly attribute DOMString &lt;span title=&quot;dom-MessageEvent-origin&quot;&gt;origin&lt;/span&gt;;
   readonly attribute DOMString &lt;span title=&quot;dom-MessageEvent-lastEventId&quot;&gt;lastEventId&lt;/span&gt;;
   readonly attribute &lt;span&gt;Window&lt;/span&gt; &lt;span title=&quot;dom-MessageEvent-source&quot;&gt;source&lt;/span&gt;;
-  readonly attribute &lt;span&gt;PipeEnd&lt;/span&gt; &lt;span title=&quot;dom-MessageEvent-pipeEnd&quot;&gt;pipeEnd&lt;/span&gt;;
-  void &lt;span title=&quot;dom-MessageEvent-initMessageEvent&quot;&gt;initMessageEvent&lt;/span&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString dataArg, in DOMString originArg, in DOMString lastEventIdArg, in Window sourceArg, in &lt;span&gt;PipeEnd&lt;/span&gt; pipeEndArg);
-  void &lt;span title=&quot;dom-MessageEvent-initMessageEventNS&quot;&gt;initMessageEventNS&lt;/span&gt;(in DOMString namespaceURI, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString dataArg, in DOMString originArg, in DOMString lastEventIdArg, in Window sourceArg, in &lt;span&gt;PipeEnd&lt;/span&gt; pipeEndArg);
+  readonly attribute &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/span&gt;;
+  void &lt;span title=&quot;dom-MessageEvent-initMessageEvent&quot;&gt;initMessageEvent&lt;/span&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString dataArg, in DOMString originArg, in DOMString lastEventIdArg, in Window sourceArg, in &lt;span&gt;MessagePort&lt;/span&gt; messagePortArg);
+  void &lt;span title=&quot;dom-MessageEvent-initMessageEventNS&quot;&gt;initMessageEventNS&lt;/span&gt;(in DOMString namespaceURI, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString dataArg, in DOMString originArg, in DOMString lastEventIdArg, in Window sourceArg, in &lt;span&gt;MessagePort&lt;/span&gt; messagePortArg);
 };&lt;/pre&gt;
 
   &lt;p&gt;The &lt;dfn
@@ -38321,10 +38359,10 @@
   &lt;code&gt;Window&lt;/code&gt; from which the message came.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn
-  title=&quot;dom-MessageEvent-pipeEnd&quot;&gt;&lt;code&gt;pipeEnd&lt;/code&gt;&lt;/dfn&gt;
+  title=&quot;dom-MessageEvent-messagePort&quot;&gt;&lt;code&gt;messagePort&lt;/code&gt;&lt;/dfn&gt;
   attribute represents, in &lt;span&gt;cross-document messaging&lt;/span&gt; and
-  &lt;span&gt;pipe messaging&lt;/span&gt; the &lt;code&gt;PipeEnd&lt;/code&gt; being sent, if
-  any.&lt;/p&gt;
+  &lt;span&gt;channel messaging&lt;/span&gt; the &lt;code&gt;MessagePort&lt;/code&gt; being
+  sent, if any.&lt;/p&gt;
 
   &lt;p&gt;Unless otherwise specified, when the user agent creates and
   dispatches a &lt;code title=&quot;event-message&quot;&gt;message&lt;/code&gt; event in the
@@ -38334,7 +38372,7 @@
   title=&quot;dom-MessageEvent-origin&quot;&gt;origin&lt;/code&gt; attribute must be the
   empty string, the &lt;code
   title=&quot;dom-MessageEvent-source&quot;&gt;source&lt;/code&gt; attribute must be
-  null, and the &lt;code title=&quot;dom-MessageEvent-pipeEnd&quot;&gt;pipeEnd&lt;/code&gt;
+  null, and the &lt;code title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt;
   attribute must be null.&lt;/p&gt;
 
 
@@ -39851,9 +39889,11 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Wait for the &lt;code&gt;Window&lt;/code&gt; object on which the method was
-    invoked to have finished executing any pending scripts.&lt;/p&gt;
-    &lt;!-- XXX define this in terms of the event queue --&gt;
+    &lt;p&gt;Wait for all scripts in the &lt;span&gt;unit of related browsing
+    contexts&lt;/span&gt; to which the the &lt;code&gt;Window&lt;/code&gt; object on
+    which the method was invoked belongs to have finished executing
+    any pending scripts.&lt;/p&gt; &lt;!-- XXX define this in terms of the
+    event queue --&gt;
 
    &lt;/li&gt;
 
@@ -39962,92 +40002,412 @@
   disallowed for security reasons. It also requires that UAs be
   careful to allow access to certain properties but not others.&lt;/p&gt;
 
-  &lt;p class=&quot;big-issue&quot;&gt;postMessage() with a pipe isn't yet defined&lt;/p&gt;
+  &lt;p class=&quot;big-issue&quot;&gt;postMessage() with a message port isn't yet
+  defined&lt;/p&gt;
 
 
 
-  &lt;h3&gt;&lt;dfn&gt;Pipe messaging&lt;/dfn&gt;&lt;/h3&gt;
+  &lt;h3&gt;&lt;dfn&gt;Channel messaging&lt;/dfn&gt;&lt;/h3&gt;
 
   &lt;h4&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;&lt;/p&gt;
 
-  &lt;p class=&quot;big-issue&quot;&gt;An introduction to the pipe APIs.&lt;/p&gt;
+  &lt;p class=&quot;big-issue&quot;&gt;An introduction to the channel and port
+  APIs.&lt;/p&gt;
 
 
 
-  &lt;h4&gt;Pipes&lt;/h4&gt;
+  &lt;h4&gt;Message channels&lt;/h4&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;[&lt;span title=&quot;dom-Pipe&quot;&gt;Constructor&lt;/span&gt;] interface &lt;dfn&gt;Pipe&lt;/dfn&gt; {
-  readonly attribute &lt;span&gt;PipeEnd&lt;/span&gt; &lt;span title=&quot;dom-pipe-end1&quot;&gt;end1&lt;/span&gt;;
-  readonly attribute &lt;span&gt;PipeEnd&lt;/span&gt; &lt;span title=&quot;dom-pipe-end2&quot;&gt;end2&lt;/span&gt;;
+  &lt;pre class=&quot;idl&quot;&gt;[&lt;span title=&quot;dom-Pipe&quot;&gt;Constructor&lt;/span&gt;] interface &lt;dfn&gt;MessageChannel&lt;/dfn&gt; {
+  readonly attribute &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-channel-port1&quot;&gt;port1&lt;/span&gt;;
+  readonly attribute &lt;span&gt;MessagePort&lt;/span&gt; &lt;span title=&quot;dom-channel-port2&quot;&gt;port2&lt;/span&gt;;
 };&lt;/pre&gt;
 
-  &lt;p&gt;When the &lt;dfn title=&quot;dom-Pipe&quot;&gt;&lt;code&gt;Pipe()&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;When the &lt;dfn
+  title=&quot;dom-MessageChannel&quot;&gt;&lt;code&gt;MessageChannel()&lt;/code&gt;&lt;/dfn&gt;
   constructor is called, it must run the following algorithm:&lt;/p&gt;
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a new &lt;code&gt;PipeEnd&lt;/code&gt; object&lt;/span&gt; owned
-   by the &lt;span&gt;script browsing context&lt;/span&gt;, and let &lt;var
-   title=&quot;&quot;&gt;end1&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a new &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/span&gt;
+   owned by the &lt;span&gt;script browsing context&lt;/span&gt;, and let &lt;var
+   title=&quot;&quot;&gt;port1&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a new &lt;code&gt;PipeEnd&lt;/code&gt; object&lt;/span&gt; owned
-   by the &lt;span&gt;script browsing context&lt;/span&gt;, and let &lt;var
-   title=&quot;&quot;&gt;end2&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a new &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/span&gt;
+   owned by the &lt;span&gt;script browsing context&lt;/span&gt;, and let &lt;var
+   title=&quot;&quot;&gt;port2&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Entangle&lt;/span&gt; the &lt;var title=&quot;&quot;&gt;end1&lt;/var&gt; and &lt;var
-   title=&quot;&quot;&gt;end2&lt;/var&gt; objects.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Entangle&lt;/span&gt; the &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt; and &lt;var
+   title=&quot;&quot;&gt;port2&lt;/var&gt; objects.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Create a new &lt;code&gt;Pipe&lt;/code&gt; object, and let &lt;var
-   title=&quot;&quot;&gt;pipe&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Set the &lt;code title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt;
+   attribute of the two ports to true.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let the &lt;code title=&quot;dom-pipe-end1&quot;&gt;end1&lt;/code&gt; attribute of
-   the &lt;var title=&quot;&quot;&gt;pipe&lt;/var&gt; object be &lt;var
-   title=&quot;&quot;&gt;end1&lt;/var&gt;.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Instantiate a new &lt;code&gt;MessageChannel&lt;/code&gt; object, and
+   let &lt;var title=&quot;&quot;&gt;channel&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let the &lt;code title=&quot;dom-pipe-end2&quot;&gt;end2&lt;/code&gt; attribute of
-   the &lt;var title=&quot;&quot;&gt;pipe&lt;/var&gt; object be &lt;var
-   title=&quot;&quot;&gt;end2&lt;/var&gt;.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let the &lt;code title=&quot;dom-channel-port1&quot;&gt;port1&lt;/code&gt;
+   attribute of the &lt;var title=&quot;&quot;&gt;channel&lt;/var&gt; object be &lt;var
+   title=&quot;&quot;&gt;port1&lt;/var&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;pipe&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let the &lt;code title=&quot;dom-channel-port2&quot;&gt;port2&lt;/code&gt;
+   attribute of the &lt;var title=&quot;&quot;&gt;channel&lt;/var&gt; object be &lt;var
+   title=&quot;&quot;&gt;port2&lt;/var&gt;.&lt;/p&gt;
 
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;channel&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
   &lt;/ol&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-pipe-end1&quot;&gt;&lt;code&gt;end1&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn
-  title=&quot;dom-pipe-end2&quot;&gt;&lt;code&gt;end2&lt;/code&gt;&lt;/dfn&gt; attributes must return
-  the values they were assigned when the &lt;code&gt;Pipe&lt;/code&gt; object was
-  created.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn title=&quot;dom-channel-port1&quot;&gt;&lt;code&gt;port1&lt;/code&gt;&lt;/dfn&gt; and
+  &lt;dfn title=&quot;dom-channel-port2&quot;&gt;&lt;code&gt;port2&lt;/code&gt;&lt;/dfn&gt; attributes
+  must return the values they were assigned when the
+  &lt;code&gt;MessageChannel&lt;/code&gt; object was created.&lt;/p&gt;
 
 
+  &lt;h4&gt;Message ports&lt;/h4&gt;
 
-  &lt;h4&gt;Pipe ends&lt;/h4&gt;
+  &lt;p&gt;Each channel has two message ports. Data sent through one port is
+  received by the other port, and vice versa.&lt;/p&gt;
 
-  &lt;p&gt;Each pipe has two ends. Data sent down one end is received by the
-  other end, and vice versa.&lt;/p&gt;
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;MessagePort&lt;/dfn&gt; {
+  readonly attribute &lt;span&gt;Window&lt;/span&gt; &lt;span title=&quot;dom-MessagePort-ownerWindow&quot;&gt;ownerWindow&lt;/span&gt;;
+  readonly attribute boolean &lt;span title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/span&gt;;
+  boolean &lt;span title=&quot;dom-MessagePort-postMessage&quot;&gt;postMessage&lt;/span&gt;(in DOMString message);
+  boolean &lt;span title=&quot;dom-MessagePort-postMessage&quot;&gt;postMessage&lt;/span&gt;(in DOMString message, in &lt;span&gt;MessagePort&lt;/span&gt; messagePort);
+  void &lt;span title=&quot;dom-MessagePort-close&quot;&gt;close&lt;/span&gt;();
 
-  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;PipeEnd&lt;/dfn&gt; {
-  readonly attribute &lt;span&gt;Window&lt;/span&gt; &lt;span title=&quot;dom-owner&quot;&gt;ownerWindow&lt;/span&gt;;
-  readonly attribute boolean &lt;span title=&quot;dom-endpipe&quot;&gt;active&lt;/span&gt;;
-  void &lt;span title=&quot;dom-pipeend-postMessage&quot;&gt;postMessage&lt;/span&gt;(in DOMString message);
-  void &lt;span title=&quot;dom-pipeend-postMessage&quot;&gt;postMessage&lt;/span&gt;(in DOMString message, in &lt;span&gt;PipeEnd&lt;/span&gt; pipeEnd);
-  void &lt;span title=&quot;dom-pipeend-close&quot;&gt;close&lt;/span&gt;();
-
   // event handler attributes
-           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-endpipe-onmessage&quot;&gt;onmessage&lt;/span&gt;;
-           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-endpipe-onunload&quot;&gt;onunload&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-MessagePort-onmessage&quot;&gt;onmessage&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-MessagePort-onunload&quot;&gt;onunload&lt;/span&gt;;
 };&lt;/pre&gt;
 
-  &lt;p class=&quot;big-issue&quot;&gt;When the user agent is to &lt;dfn&gt;create a new
-  &lt;code&gt;PipeEnd&lt;/code&gt; object&lt;/dfn&gt; owned by a &lt;code&gt;Window&lt;/code&gt;
-  object &lt;var title=&quot;&quot;&gt;owner&lt;/var&gt;, it must...&lt;/p&gt;
+  &lt;p&gt;When the user agent is to &lt;dfn&gt;create a new
+  &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/dfn&gt; owned by a &lt;code&gt;Window&lt;/code&gt;
+  object &lt;var title=&quot;&quot;&gt;owner&lt;/var&gt;, it must run the following
+  steps:&lt;/p&gt;
 
-  &lt;p class=&quot;big-issue&quot;&gt;When the user agent is to &lt;dfn&gt;entangle&lt;/dfn&gt;
-  two &lt;code&gt;PipeEnd&lt;/code&gt; objects, it must...&lt;/p&gt;
+  &lt;ol&gt;
 
+   &lt;li&gt;&lt;p&gt;Instantiate a new &lt;code&gt;MessagePort&lt;/code&gt; object, and let
+   &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Set the &lt;code
+   title=&quot;dom-MessagePort-ownerWindow&quot;&gt;ownerWindow&lt;/code&gt; attribute of
+   &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;owner&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Set the &lt;code title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt;
+   attribute of &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be false.&lt;/p&gt;&lt;/li&gt;
 
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When the user agent is to &lt;dfn&gt;entangle&lt;/dfn&gt; two
+  &lt;code&gt;MessagePort&lt;/code&gt; objects, it must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If either port is already entangled, then let &lt;var
+   title=&quot;&quot;&gt;port1&lt;/var&gt; be that port, and run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;old port&lt;/var&gt; be the port that &lt;var
+     title=&quot;&quot;&gt;port1&lt;/var&gt; is entangled with.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Unentangle &lt;var title=&quot;&quot;&gt;old port&lt;/var&gt;, so that it is no
+     longer entangled with any ports.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Set the &lt;code title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt;
+     attribute of &lt;var title=&quot;&quot;&gt;old port&lt;/var&gt; to false.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Unentangle &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt;, so that it is no
+     longer entangled with any ports.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;port1&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;old port&lt;/var&gt;
+    were the two ports of a &lt;code&gt;MessageChannel&lt;/code&gt; object, then
+    that &lt;code&gt;MessageChannel&lt;/code&gt; object no longer represents an
+    actual channel: the two ports in that object are no longer
+    entangled.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Associate the two ports to be entangled, so that they form
+   the two parts of a new channel. (There is no
+   &lt;code&gt;MessageChannel&lt;/code&gt; object that represents this
+   channel.)&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When the user agent is to &lt;dfn&gt;clone a port&lt;/dfn&gt; &lt;var
+  title=&quot;&quot;&gt;original port&lt;/var&gt;, with the clone being owned by &lt;var
+  title=&quot;&quot;&gt;owner&lt;/var&gt;, it must run the following steps, which return
+  either a new &lt;code&gt;MessagePort&lt;/code&gt; object or an exception for the
+  caller to raise:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;original port&lt;/var&gt; is not entangled
+   without another port, then return an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt;
+   exception and abort all these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt; be the port with
+   which the &lt;var title=&quot;&quot;&gt;original port&lt;/var&gt; is entangled.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;original status&lt;/var&gt; be the value of the
+   &lt;code title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt; attribute of the
+   &lt;var title=&quot;&quot;&gt;original port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create a new &lt;code&gt;MessagePort&lt;/code&gt; object&lt;/span&gt;
+   owned by &lt;var title=&quot;&quot;&gt;owner&lt;/var&gt;, and let &lt;var title=&quot;&quot;&gt;new
+   port&lt;/var&gt; be that object.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Entangle&lt;/span&gt; the &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt;
+   and &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt; objects. The &lt;var
+   title=&quot;&quot;&gt;original port&lt;/var&gt; object will have its &lt;code
+   title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt; attribute permanently
+   set to false by this process.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let the &lt;code title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt;
+   attribute of the &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt; object have the same
+   value as &lt;var title=&quot;&quot;&gt;original status&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt; &lt;!-- we
+   don't throw if it's false, because it might become true again,
+   e.g. if you're sending a port that is entangled with a port that's
+   associated with a document that's currently not the active document
+   of its iframe, but which hasn't been discarded yet --&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;new port&lt;/var&gt;. It is the
+   clone.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-MessagePort-ownerWindow&quot;&gt;&lt;code&gt;ownerWindow&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the value it was assigned when the
+  &lt;code&gt;MessagePort&lt;/code&gt; object was created.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-MessagePort-active&quot;&gt;&lt;code&gt;active&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the last value that it was set to according to
+  the rules of this specification.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-MessagePort-postMessage&quot;&gt;&lt;code&gt;postMessage()&lt;/code&gt;&lt;/dfn&gt;
+  method, when called on a port &lt;var title=&quot;&quot;&gt;source port&lt;/var&gt;, must
+  cause the user agent to run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be the method's first
+   argument.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;data port&lt;/var&gt; be the method's second
+   argument, if any.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;source port&lt;/var&gt;'s &lt;code
+   title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt; attribute is false,
+   then return false and abort these steps.&lt;/p&gt;&lt;/li&gt; &lt;!-- we don't
+   raise an exception because this attribute can become false at a
+   moment's notice, but we return false so that the caller can check
+   whether the port was active at time of calling without a race
+   condition. --&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt; be the port with which
+   &lt;var title=&quot;&quot;&gt;source port&lt;/var&gt; is entangled.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Create an event that uses the &lt;code&gt;MessageEvent&lt;/code&gt;
+   interface, with the name &lt;code
+   title=&quot;event-message&quot;&gt;message&lt;/code&gt;, which does not bubble, is
+   cancelable, and has no default action.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let the &lt;code title=&quot;dom-MessageEvent-data&quot;&gt;data&lt;/code&gt;
+   attribute of the event have the value of &lt;var
+   title=&quot;&quot;&gt;message&lt;/var&gt;, the method's first argument.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the method was called with a second argument &lt;var
+   title=&quot;&quot;&gt;data port&lt;/var&gt; and that argument isn't null, then run the
+   following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;data port&lt;/var&gt; is the &lt;var
+     title=&quot;&quot;&gt;source port&lt;/var&gt; or the &lt;var title=&quot;&quot;&gt;target
+     port&lt;/var&gt;, then throw an &lt;code&gt;INVALID_ACCESS_ERR&lt;/code&gt;
+     exception and abort all these steps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Try to obtain a &lt;var title=&quot;&quot;&gt;new data port&lt;/var&gt; by &lt;span
+     title=&quot;clone a port&quot;&gt;cloning&lt;/span&gt; the &lt;var title=&quot;&quot;&gt;data
+     port&lt;/var&gt; with the &lt;span
+     title=&quot;dom-MessagePort-ownerWindow&quot;&gt;owner&lt;/span&gt; of the &lt;var
+     title=&quot;&quot;&gt;target port&lt;/var&gt; as the owner of the clone. If this
+     returns an exception, then throw that exception and abort these
+     steps.&lt;/p&gt;&lt;/li&gt;
+ 
+     &lt;li&gt;&lt;p&gt;Let the &lt;code
+     title=&quot;dom-MessageEvent-messagePort&quot;&gt;messagePort&lt;/code&gt; attribute
+     of the event be the &lt;var title=&quot;&quot;&gt;new data port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return true from the method, but continue with these
+   steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Wait for all scripts in the &lt;span&gt;unit of related browsing
+   contexts&lt;/span&gt; to which the the &lt;span
+   title=&quot;dom-MessagePort-ownerWindow&quot;&gt;owner&lt;/span&gt; of the &lt;var
+   title=&quot;&quot;&gt;target port&lt;/var&gt; belongs to have executed to completion,
+   and then dispatch the event at the &lt;var title=&quot;&quot;&gt;target port&lt;/var&gt;
+   object. If this never happens (e.g. the relevant &lt;span&gt;browsing
+   context&lt;/span&gt; is closed by the user before the event can be
+   dispatched), then discard the event.&lt;/p&gt;&lt;/li&gt;&lt;!-- XXX queue --&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-MessagePort-close&quot;&gt;&lt;code&gt;close()&lt;/code&gt;&lt;/dfn&gt;
+  method, when called on a port &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt;, must
+  cause the user agent to run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt; is entangled with another
+    port, then let &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt; be that port and
+    run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Unentangle &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt;, so that it is
+     no longer entangled with any ports.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Set the &lt;code title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt;
+     attribute of &lt;var title=&quot;&quot;&gt;remote port&lt;/var&gt; to false.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Unentangle &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt;, so that it is
+     no longer entangled with any ports.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set the &lt;code title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt;
+   attribute of &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt; to false.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The following are the &lt;span&gt;event handler DOM attributes&lt;/span&gt;
+  that must be supported by objects implementing the
+  &lt;code&gt;MessagePort&lt;/code&gt; interface:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-MessagePort-onmessage&quot;&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever a &lt;code
+   title=&quot;event-MessagePort-message&quot;&gt;message&lt;/code&gt; event is targeted
+   at or bubbles through the &lt;code&gt;MessagePort&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-MessagePort-onunload&quot;&gt;&lt;code&gt;onunload&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-unload&quot;&gt;unload&lt;/code&gt; event is targeted at or bubbles
+   through the &lt;code&gt;MessagePort&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;p class=&quot;note&quot;&gt;Nothing in this specification causes an &lt;code
+  title=&quot;event-unload&quot;&gt;unload&lt;/code&gt; event to be targetted at a
+  &lt;code&gt;MessagePort&lt;/code&gt; object. This feature is intended for use
+  with Workers. &lt;a href=&quot;#refsWORKERS&quot;&gt;[WORKERS]&lt;/a&gt;&lt;/p&gt;
+
+
+
+  &lt;h5&gt;Ports and browsing contexts&lt;/h5&gt;
+
+  &lt;p&gt;During &lt;span title=&quot;traverse the history&quot;&gt;session history
+  traversal&lt;/span&gt; (e.g. when a user &lt;span
+  title=&quot;navigate&quot;&gt;navigates&lt;/span&gt; a &lt;span&gt;browsing context&lt;/span&gt; to
+  another page, or goes back to a previous page), the user agent will
+  have to &lt;a href=&quot;#port-traversal-deactivation&quot;&gt;deactivate&lt;/a&gt; and/or
+  &lt;a href=&quot;#port-traversal-reactivation&quot;&gt;reactivate&lt;/a&gt; some
+  ports.&lt;/p&gt;
+
+  &lt;p&gt;Ports are deactivated and unentangled when the
+  &lt;code&gt;Document&lt;/code&gt; that was the &lt;span&gt;active document&lt;/span&gt; of
+  the &lt;span&gt;browsing context&lt;/span&gt; corresponding to the
+  &lt;code&gt;Window&lt;/code&gt; object that &lt;span
+  title=&quot;dom-MessagePort-ownerWindow&quot;&gt;owns&lt;/span&gt; them is &lt;span
+  title=&quot;discard a document&quot;&gt;discarded&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;To &lt;dfn&gt;deactivate a port&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt;
+  that is entangled with a second port &lt;var title=&quot;&quot;&gt;remote
+  port&lt;/var&gt;, the user agent must set the &lt;code
+  title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt; attribute of the &lt;var
+  title=&quot;&quot;&gt;remote port&lt;/var&gt; to false.&lt;/p&gt;
+
+  &lt;p&gt;To &lt;dfn&gt;reactivate a port&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;local port&lt;/var&gt;
+  that is entangled with a second port &lt;var title=&quot;&quot;&gt;remote
+  port&lt;/var&gt;, the user agent must set the &lt;code
+  title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt; attribute of the &lt;var
+  title=&quot;&quot;&gt;remote port&lt;/var&gt; to true.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;It's important to note that activating or
+  deactivating a port actually changes the &lt;code
+  title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt; attribute of the port's
+  entangled port, not its own attribute.&lt;/p&gt;
+
+
+
+  &lt;h5&gt;Ports and garbage collection&lt;/h5&gt;
+
+  &lt;p&gt;User agents must act as if &lt;code&gt;MessagePort&lt;/code&gt; objects have
+  a strong reference to their entangled &lt;code&gt;MessagePort&lt;/code&gt;
+  object so long as that other &lt;code&gt;MessagePort&lt;/code&gt; object has any
+  &lt;code title=&quot;event-message&quot;&gt;message&lt;/code&gt; or &lt;code
+  title=&quot;event-unload&quot;&gt;unload&lt;/code&gt; event listeners registered.&lt;/p&gt;
+
+  &lt;div class=&quot;note&quot;&gt;
+
+   &lt;p&gt;Thus, a message port can be received, given an event listener,
+   and then forgotten, and so long as that event listener could
+   receive a message, the channel will be maintained.&lt;/p&gt;
+
+   &lt;p&gt;Of course, if this was to occur on both sides of the channel,
+   then both ports would be garbage collected, since they would not be
+   reachable from live code, despite having a strong reference to each
+   other.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+  &lt;p&gt;When an entangled message port is about to be garbage collected,
+  it must be &lt;span title=&quot;deactivate a port&quot;&gt;deactivated&lt;/span&gt; and
+  then unentangled, so that the two ports are no longer related and so
+  that the other port's &lt;code
+  title=&quot;dom-MessagePort-active&quot;&gt;active&lt;/code&gt; attribute is set to
+  false.&lt;/p&gt;
+
+
+
+
+
+
+
   &lt;h2 id=&quot;syntax&quot;&gt;The HTML syntax&lt;/h2&gt;
 
   &lt;h3&gt;Writing HTML documents&lt;/h3&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008770.html">[html5] r1872 - [] (0) More work on Pipes.
</A></li>
	<LI>Next message: <A HREF="008772.html">[html5] r1874 - [] (0) Define the three-argument form of	postMessage().
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8771">[ date ]</a>
              <a href="thread.html#8771">[ thread ]</a>
              <a href="subject.html#8771">[ subject ]</a>
              <a href="author.html#8771">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
