<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1731 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1731%20-%20/&In-Reply-To=%3C20080607002754.5218F1B0D98%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008629.html">
   <LINK REL="Next"  HREF="008631.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1731 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1731%20-%20/&In-Reply-To=%3C20080607002754.5218F1B0D98%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1731 - /">whatwg at whatwg.org
       </A><BR>
    <I>Fri Jun  6 17:27:54 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008629.html">[html5] r1730 - /
</A></li>
        <LI>Next message: <A HREF="008631.html">[html5] r1732 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8630">[ date ]</a>
              <a href="thread.html#8630">[ thread ]</a>
              <a href="subject.html#8630">[ subject ]</a>
              <a href="author.html#8630">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-06-06 17:27:53 -0700 (Fri, 06 Jun 2008)
New Revision: 1731

Modified:
   index
   source
Log:
[cgiowt] (2) add support for the new html elements. fix the handling of optional tags we added recently. also: clarify some notes, remove redundant requirements, clean up some punctuation.

Modified: index
===================================================================
--- index	2008-06-06 19:03:41 UTC (rev 1730)
+++ index	2008-06-07 00:27:53 UTC (rev 1731)
@@ -25,7 +25,7 @@
 
    &lt;h1 id=html-5&gt;HTML 5&lt;/h1&gt;
 
-   &lt;h2 class=&quot;no-num no-toc&quot; id=draft&gt;Draft Recommendation &mdash; 6 June
+   &lt;h2 class=&quot;no-num no-toc&quot; id=draft&gt;Draft Recommendation &mdash; 7 June
     2008&lt;/h2&gt;
 
    &lt;p&gt;You can take part in this work. &lt;a
@@ -5097,7 +5097,7 @@
  Test: <A HREF="http://www.hixie.ch/tests/adhoc/html/flow/image-maps/004-demo.html">http://www.hixie.ch/tests/adhoc/html/flow/image-maps/004-demo.html</A>
  IE6 on Wine treats the following characters like this also: U+1-U+1f,
  U+21-U+2b, U+2d-U+2f, U+3a, U+3c-U+40, U+5b-U+60, U+7b-U+82,
- U+84-U+89, U+8b, U+8d, U+8f-U`+99, U+9b, U+9d, U+a0-U+bf, U+d7, U+f7,
+ U+84-U+89, U+8b, U+8d, U+8f-U+99, U+9b, U+9d, U+a0-U+bf, U+d7, U+f7,
  U+1f6-U+1f9, U+218-U+24f, U+2a9-U+385, U+387, U+38b, U+38d, U+3a2,
  U+3cf, U+3d7-U+3d9, U+3db, U+3dd, U+3df, U+3e1, U+3f4-U+400, U+40d,
  U+450, U+45d, U+482-U+48f, U+4c5-U+4c6, U+4c9-U+4ca, U+4cd-U+4cf,
@@ -8847,20 +8847,6 @@
    element (if any), and that element's child nodes. Otherwise, the specified
    styles must, if applied, be applied to the entire document.
 
-  &lt;p&gt;If the &lt;code title=attr-style-scoped&gt;&lt;a href=&quot;#scoped&quot;&gt;scoped&lt;/a&gt;&lt;/code&gt;
-   attribute is not specified, the &lt;code&gt;&lt;a href=&quot;#style1&quot;&gt;style&lt;/a&gt;&lt;/code&gt;
-   element must be the child of a &lt;code&gt;&lt;a href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt;
-   element or of a &lt;code&gt;&lt;a href=&quot;#noscript&quot;&gt;noscript&lt;/a&gt;&lt;/code&gt; element that
-   is a child of a &lt;code&gt;&lt;a href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt; element.
-
-  &lt;p&gt;If the &lt;code title=attr-style-scoped&gt;&lt;a href=&quot;#scoped&quot;&gt;scoped&lt;/a&gt;&lt;/code&gt;
-   attribute &lt;em&gt;is&lt;/em&gt; specified, then the &lt;code&gt;&lt;a
-   href=&quot;#style1&quot;&gt;style&lt;/a&gt;&lt;/code&gt; element must be the child of a &lt;a
-   href=&quot;#flow-content0&quot;&gt;flow content&lt;/a&gt; element, before any text nodes
-   other than &lt;a href=&quot;#inter-element&quot;&gt;inter-element whitespace&lt;/a&gt;, and
-   before any elements other than other &lt;code&gt;&lt;a
-   href=&quot;#style1&quot;&gt;style&lt;/a&gt;&lt;/code&gt; elements.
-
   &lt;p id=title-on-style&gt;The &lt;dfn id=title3
    title=attr-style-title&gt;&lt;code&gt;title&lt;/code&gt;&lt;/dfn&gt; attribute on &lt;code&gt;&lt;a
    href=&quot;#style1&quot;&gt;style&lt;/a&gt;&lt;/code&gt; elements defines &lt;a
@@ -41797,13 +41783,11 @@
    title=syntax-comments&gt;comment&lt;/a&gt;, except if the first thing inside the
    &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; element is a &lt;code&gt;&lt;a
    href=&quot;#script1&quot;&gt;script&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a
-   href=&quot;#style1&quot;&gt;style&lt;/a&gt;&lt;/code&gt;
-   element&lt;!-- and the node immediately preceding
-  the &lt;code&gt;body&lt;/code&gt; element is a &lt;code&gt;head&lt;/code&gt; element whose
-  end tag has been omitted (XXX this last bit is commented out for now
-  because we have the dubious rule in the parser that makes &lt;style&gt;
-  and &lt;script&gt; elements between &lt;/head&gt; and &lt;body&gt; end up in the
-  &lt;head&gt; instead of the &lt;body&gt;)--&gt;.&lt;/p&gt;
+   href=&quot;#style1&quot;&gt;style&lt;/a&gt;&lt;/code&gt; element.
+   &lt;!-- Note that even if the &lt;/head&gt; end
+  tag is present, the parser makes &lt;style&gt; and &lt;script&gt; elements
+  between &lt;/head&gt; and &lt;body&gt; end up in the &lt;head&gt; instead of implying
+  the &lt;body&gt; --&gt;&lt;/p&gt;
   &lt;!-- &lt;/body&gt; --&gt;
 
   &lt;p&gt;A &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; element's &lt;span
@@ -43143,9 +43127,9 @@
      href=&quot;#h3&quot;&gt;h3&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#h4&quot;&gt;h4&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
      href=&quot;#h5&quot;&gt;h5&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#h6&quot;&gt;h6&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
      href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#hr&quot;&gt;hr&lt;/a&gt;&lt;/code&gt;,
-     &lt;code&gt;&lt;a href=&quot;#iframe&quot;&gt;iframe&lt;/a&gt;&lt;/code&gt;,
-     &lt;code&gt;image&lt;/code&gt;&lt;!-- XXX ? this isn't an element that can end up
-   on the stack--&gt;,
+     &lt;code&gt;&lt;a href=&quot;#iframe&quot;&gt;iframe&lt;/a&gt;&lt;/code&gt;, &lt;!--
+   &lt;code&gt;image&lt;/code&gt;, (commented out because this isn't an element
+   that can end up on the stack, so it doesn't matter) --&gt;
      &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;input&lt;/code&gt;,
      &lt;code&gt;isindex&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#li&quot;&gt;li&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
      href=&quot;#link&quot;&gt;link&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;listing&lt;/code&gt;, &lt;code&gt;&lt;a
@@ -45578,7 +45562,8 @@
    end tags&lt;/dfn&gt;, then, while the &lt;a href=&quot;#current5&quot;&gt;current node&lt;/a&gt; is a
    &lt;code&gt;&lt;a href=&quot;#dd&quot;&gt;dd&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a
    href=&quot;#dt&quot;&gt;dt&lt;/a&gt;&lt;/code&gt; element, an &lt;code&gt;&lt;a href=&quot;#li&quot;&gt;li&lt;/a&gt;&lt;/code&gt;
-   element, a &lt;code&gt;&lt;a href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; element, an &lt;code&gt;&lt;a
+   element, an &lt;code&gt;option&lt;/code&gt; element, an &lt;code&gt;optgroup&lt;/code&gt; element,
+   a &lt;code&gt;&lt;a href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; element, an &lt;code&gt;&lt;a
    href=&quot;#rp&quot;&gt;rp&lt;/a&gt;&lt;/code&gt; element, or an &lt;code&gt;&lt;a href=&quot;#rt&quot;&gt;rt&lt;/a&gt;&lt;/code&gt;
    element, the UA must pop the &lt;a href=&quot;#current5&quot;&gt;current node&lt;/a&gt; off the
    &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.
@@ -46118,7 +46103,8 @@
      href=&quot;#in-body&quot; title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot;
      &lt;span&gt;insertion mode&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;dt&gt;A start tag whose tag name is one of: &quot;base&quot;, &quot;link&quot;
+   &lt;dt&gt;A start tag whose tag name is one of: &quot;base&quot;, &quot;command&quot;,
+    &quot;event-source&quot;, &quot;link&quot;
 
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token.
@@ -46164,7 +46150,7 @@
     &lt;p&gt;Follow the &lt;a href=&quot;#generic0&quot;&gt;generic RCDATA parsing algorithm&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;a
-    href=&quot;#scripting2&quot;&gt;scripting flag&lt;/a&gt; is enabled:
+    href=&quot;#scripting2&quot;&gt;scripting flag&lt;/a&gt; is enabled
 
    &lt;dt&gt;A start tag whose tag name is one of: &quot;noframes&quot;, &quot;style&quot;
 
@@ -46172,7 +46158,7 @@
     &lt;p&gt;Follow the &lt;a href=&quot;#generic&quot;&gt;generic CDATA parsing algorithm&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;a
-    href=&quot;#scripting2&quot;&gt;scripting flag&lt;/a&gt; is disabled:
+    href=&quot;#scripting2&quot;&gt;scripting flag&lt;/a&gt; is disabled
 
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token.&lt;/p&gt;
@@ -46521,8 +46507,8 @@
      the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;. If it is not, add the
      attribute and its corresponding value to that element.&lt;/p&gt;
 
-   &lt;dt&gt;A start tag token whose tag name is one of: &quot;base&quot;, &quot;link&quot;, &quot;meta&quot;,
-    &quot;noframes&quot;, &quot;script&quot;, &quot;style&quot;, &quot;title&quot;
+   &lt;dt&gt;A start tag token whose tag name is one of: &quot;base&quot;, &quot;command&quot;,
+    &quot;event-source&quot;, &quot;link&quot;, &quot;meta&quot;, &quot;noframes&quot;, &quot;script&quot;, &quot;style&quot;, &quot;title&quot;
 
    &lt;dd&gt;
     &lt;p&gt;Process the token &lt;a href=&quot;#using8&quot;&gt;using the rules for&lt;/a&gt; the &quot;&lt;a
@@ -46600,10 +46586,14 @@
 
     &lt;p class=note&gt;The fake end tag token here can only be ignored in the &lt;a
      href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+   &lt;!-- start tags for non-phrasing flow content elements --&gt;
+   &lt;!-- the normal ones --&gt;
 
-   &lt;dt&gt;A start tag whose tag name is one of: &quot;address&quot;, &quot;blockquote&quot;,
-    &quot;center&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;, &quot;fieldset&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;,
-    &quot;h6&quot;, &quot;menu&quot;, &quot;ol&quot;, &quot;p&quot;, &quot;ul&quot;
+   &lt;dt&gt;A start tag whose tag name is one of: &quot;address&quot;, &quot;article&quot;, &quot;aside&quot;,
+    &quot;blockquote&quot;, &quot;center&quot;, &quot;datagrid&quot;, &quot;dialog&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;,
+    &quot;fieldset&quot;, &quot;footer&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;, &quot;header&quot;,
+    &quot;menu&quot;, &quot;nav&quot;, &quot;ol&quot;, &quot;p&quot;, &quot;section&quot;, &quot;ul&quot;
 
    &lt;dd&gt; &lt;!-- As of May 2008 this doesn't match any browser exactly, but is
     as close to what IE does as I can get without doing the non-tree
@@ -46628,6 +46618,8 @@
     --&gt;
     
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token.&lt;/p&gt;
+   &lt;/dd&gt;
+   &lt;!-- as normal, but drops leading newline --&gt;
 
    &lt;dt&gt;A start tag whose tag name is one of: &quot;pre&quot;, &quot;listing&quot;
 
@@ -46643,6 +46635,8 @@
      ignore that token and move on to the next one. (Newlines at the start of
      &lt;code&gt;&lt;a href=&quot;#pre&quot;&gt;pre&lt;/a&gt;&lt;/code&gt; blocks are ignored as an authoring
      convenience.)&lt;/p&gt;
+   &lt;/dd&gt;
+   &lt;!-- as normal, but interacts with the form element pointer --&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;form&quot;
 
@@ -46661,15 +46655,12 @@
     &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token, and set
      the &lt;code title=form&gt;form&lt;/code&gt; element pointer to point to the element
      created.&lt;/p&gt;
+   &lt;/dd&gt;
+   &lt;!-- as normal, but imply &lt;/li&gt; when there's another &lt;li&gt; open in weird cases --&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;li&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a href=&quot;#have-an&quot;
-     title=&quot;has an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt; element in
-     scope&lt;/a&gt;, then act as if an end tag with the tag name &lt;code&gt;&lt;a
-     href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; had been seen.&lt;/p&gt;
-
     &lt;p&gt;Run the following algorithm:&lt;/p&gt;
 
     &lt;ol&gt;
@@ -46679,42 +46670,44 @@
 
      &lt;li&gt;
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is an &lt;code&gt;&lt;a href=&quot;#li&quot;&gt;li&lt;/a&gt;&lt;/code&gt;
-       element, then pop all the nodes from the &lt;a href=&quot;#current5&quot;&gt;current
-       node&lt;/a&gt; up to &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, including &lt;var
-       title=&quot;&quot;&gt;node&lt;/var&gt;, then stop this algorithm. If more than one node
-       is popped, then this is a &lt;a href=&quot;#parse1&quot;&gt;parse error&lt;/a&gt;.
+       element, then act as if an end tag with the tag name &lt;code&gt;&lt;a
+       href=&quot;#li&quot;&gt;li&lt;/a&gt;&lt;/code&gt; had been seen, then jump to the last step.
 
      &lt;li&gt;
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not in the &lt;a
        href=&quot;#formatting&quot;&gt;formatting&lt;/a&gt; category, and is not in the &lt;a
        href=&quot;#phrasing1&quot;&gt;phrasing&lt;/a&gt; category, and is not an &lt;code&gt;&lt;a
        href=&quot;#address&quot;&gt;address&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a
-       href=&quot;#div&quot;&gt;div&lt;/a&gt;&lt;/code&gt; element, then stop this algorithm.
+       href=&quot;#div&quot;&gt;div&lt;/a&gt;&lt;/code&gt; element, then jump to the last step.
      &lt;/li&gt;
-     &lt;!-- an element &lt;foo&gt; is in this
-     list if the following markup:
+     &lt;!-- an element &lt;foo&gt; is in this list if
+     the following markup:
 
          &lt;!DOCTYPE html&gt;&lt;body&gt;&lt;ol&gt;&lt;li&gt;&lt;foo&gt;&lt;li&gt;
 
-     ...results in the second &lt;li&gt; not being (in any way) a
-     descendant of the first &lt;li&gt;, or if &lt;foo&gt; is a formatting
-     element that gets reopened later. --&gt;
+     ...results in the second &lt;li&gt; not being (in any way) a descendant
+     of the first &lt;li&gt;, or if &lt;foo&gt; is a formatting element that gets
+     reopened later. --&gt;
 
      &lt;li&gt;
       &lt;p&gt;Otherwise, set &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; to the previous entry in the
        &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; and return to step 2.
+
+     &lt;li&gt;
+      &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
+       href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt;
+       element in scope&lt;/a&gt;, then act as if an end tag with the tag name
+       &lt;code&gt;&lt;a href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; had been seen.&lt;/p&gt;
+
+      &lt;p&gt;Finally, &lt;a href=&quot;#insert0&quot;&gt;insert an HTML element&lt;/a&gt; for the
+       token.&lt;/p&gt;
     &lt;/ol&gt;
+   &lt;/dd&gt;
+   &lt;!-- as normal, but imply &lt;/dt&gt; or &lt;/dd&gt; when there's another &lt;dt&gt; or &lt;dd&gt; open in weird cases  --&gt;
 
-    &lt;p&gt;Finally, &lt;a href=&quot;#insert0&quot;&gt;insert an HTML element&lt;/a&gt; for the token.&lt;/p&gt;
-
    &lt;dt&gt;A start tag whose tag name is one of: &quot;dd&quot;, &quot;dt&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a href=&quot;#have-an&quot;
-     title=&quot;has an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt; element in
-     scope&lt;/a&gt;, then act as if an end tag with the tag name &lt;code&gt;&lt;a
-     href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; had been seen.&lt;/p&gt;
-
     &lt;p&gt;Run the following algorithm:&lt;/p&gt;
 
     &lt;ol&gt;
@@ -46724,35 +46717,42 @@
 
      &lt;li&gt;
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is a &lt;code&gt;&lt;a href=&quot;#dd&quot;&gt;dd&lt;/a&gt;&lt;/code&gt;
-       or &lt;code&gt;&lt;a href=&quot;#dt&quot;&gt;dt&lt;/a&gt;&lt;/code&gt; element, then pop all the nodes
-       from the &lt;a href=&quot;#current5&quot;&gt;current node&lt;/a&gt; up to &lt;var
-       title=&quot;&quot;&gt;node&lt;/var&gt;, including &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then stop
-       this algorithm. If more than one node is popped, then this is a &lt;a
-       href=&quot;#parse1&quot;&gt;parse error&lt;/a&gt;.
+       or &lt;code&gt;&lt;a href=&quot;#dt&quot;&gt;dt&lt;/a&gt;&lt;/code&gt; element, then act as if an end
+       tag with the same tag name as &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; had been seen,
+       then jump to the last step.
 
      &lt;li&gt;
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not in the &lt;a
        href=&quot;#formatting&quot;&gt;formatting&lt;/a&gt; category, and is not in the &lt;a
        href=&quot;#phrasing1&quot;&gt;phrasing&lt;/a&gt; category, and is not an &lt;code&gt;&lt;a
        href=&quot;#address&quot;&gt;address&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a
-       href=&quot;#div&quot;&gt;div&lt;/a&gt;&lt;/code&gt; element, then stop this algorithm.
+       href=&quot;#div&quot;&gt;div&lt;/a&gt;&lt;/code&gt; element, then jump to the last step.
      &lt;/li&gt;
-     &lt;!-- an element &lt;foo&gt; is in this
-     list if the following markup:
+     &lt;!-- an element &lt;foo&gt; is in this list if
+     the following markup:
 
-         &lt;!DOCTYPE html&gt;&lt;body&gt;&lt;ol&gt;&lt;dt&gt;&lt;foo&gt;&lt;dt&gt;
+         &lt;!DOCTYPE html&gt;&lt;body&gt;&lt;dl&gt;&lt;dt&gt;&lt;foo&gt;&lt;dt&gt;
 
-     ...results in the second &lt;li&gt; not being (in any way) a
-     descendant of the first &lt;li&gt;, or if &lt;foo&gt; is a formatting
-     element that gets reopened later. --&gt;
+     ...results in the second &lt;dt&gt; not being (in any way) a descendant
+     of the first &lt;dt&gt;, or if &lt;foo&gt; is a formatting element that gets
+     reopened later. --&gt;
 
      &lt;li&gt;
       &lt;p&gt;Otherwise, set &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; to the previous entry in the
        &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; and return to step 2.
+
+     &lt;li&gt;
+      &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
+       href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt;
+       element in scope&lt;/a&gt;, then act as if an end tag with the tag name
+       &lt;code&gt;&lt;a href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; had been seen.&lt;/p&gt;
+
+      &lt;p&gt;Finally, &lt;a href=&quot;#insert0&quot;&gt;insert an HTML element&lt;/a&gt; for the
+       token.&lt;/p&gt;
     &lt;/ol&gt;
+   &lt;/dd&gt;
+   &lt;!-- same as normal, but effectively ends parsing --&gt;
 
-    &lt;p&gt;Finally, &lt;a href=&quot;#insert0&quot;&gt;insert an HTML element&lt;/a&gt; for the token.&lt;/p&gt;
-
    &lt;dt&gt;A start tag whose tag name is &quot;plaintext&quot;
 
    &lt;dd&gt;
@@ -46770,10 +46770,14 @@
      seen, that will be the last token ever seen other than character tokens
      (and the end-of-file token), because there is no way to switch the &lt;a
      href=&quot;#content2&quot;&gt;content model flag&lt;/a&gt; out of the PLAINTEXT state.&lt;/p&gt;
+   &lt;/dd&gt;
+   &lt;!-- end tags for non-phrasing flow content elements --&gt;
+   &lt;!-- the normal ones --&gt;
 
-   &lt;dt&gt;An end tag whose tag name is one of: &quot;address&quot;, &quot;blockquote&quot;,
-    &quot;center&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;, &quot;fieldset&quot;, &quot;listing&quot;, &quot;menu&quot;, &quot;ol&quot;, &quot;pre&quot;,
-    &quot;ul&quot;
+   &lt;dt&gt;An end tag whose tag name is one of: &quot;address&quot;, &quot;article&quot;, &quot;aside&quot;,
+    &quot;blockquote&quot;, &quot;center&quot;, &quot;datagrid&quot;, &quot;dialog&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;,
+    &quot;fieldset&quot;, &quot;footer&quot;, &quot;header&quot;, &quot;listing&quot;, &quot;menu&quot;, &quot;nav&quot;, &quot;ol&quot;, &quot;pre&quot;,
+    &quot;section&quot;, &quot;ul&quot;
 
    &lt;dd&gt;
     &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
@@ -46797,6 +46801,8 @@
        until an element with the same tag name as the token has been popped
        from the stack.
     &lt;/ol&gt;
+   &lt;/dd&gt;
+   &lt;!-- as normal, but interacts with the form element pointer --&gt;
 
    &lt;dt&gt;An end tag whose tag name is &quot;form&quot;
 
@@ -46825,23 +46831,39 @@
        until an element with the same tag name as the token has been popped
        from the stack.
     &lt;/ol&gt;
+   &lt;/dd&gt;
+   &lt;!-- as normal, except &lt;/p&gt; implies &lt;p&gt; if there's no &lt;p&gt; in scope, and needs care as the elements have optional tags --&gt;
 
    &lt;dt&gt;An end tag whose tag name is &quot;p&quot;
 
    &lt;dd&gt;
-    &lt;p&gt;If the &lt;a href=&quot;#current5&quot;&gt;current node&lt;/a&gt; is not a &lt;code&gt;&lt;a
-     href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a href=&quot;#parse1&quot;&gt;parse
-     error&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
+     href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;have an element in
+     scope&lt;/a&gt; with the same tag name as that of the token, then this is a &lt;a
+     href=&quot;#parse1&quot;&gt;parse error&lt;/a&gt;; act as if a start tag with the tag name
+     &lt;code&gt;&lt;a href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; had been seen, then reprocess the
+     current token.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a href=&quot;#have-an&quot;
-     title=&quot;has an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt; element in
-     scope&lt;/a&gt;, then pop elements from this stack until the stack no longer
-     &lt;a href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt;
-     element in scope&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;Otherwise, run these steps:&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, act as if a start tag with the tag name &lt;code&gt;&lt;a
-     href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; had been seen, then reprocess the current token.&lt;/p&gt;
+    &lt;ol&gt;
+     &lt;li&gt;
+      &lt;p&gt;&lt;a href=&quot;#generate&quot;&gt;Generate implied end tags&lt;/a&gt;, except for
+       elements with the same tag name as the token.
 
+     &lt;li&gt;
+      &lt;p&gt;If the &lt;a href=&quot;#current5&quot;&gt;current node&lt;/a&gt; is not an element with
+       the same tag name as that of the token, then this is a &lt;a
+       href=&quot;#parse1&quot;&gt;parse error&lt;/a&gt;.
+
+     &lt;li&gt;
+      &lt;p&gt;Pop elements from the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;
+       until an element with the same tag name as the token has been popped
+       from the stack.
+    &lt;/ol&gt;
+   &lt;/dd&gt;
+   &lt;!-- as normal, but needs care as the elements have optional tags --&gt;
+
    &lt;dt&gt;An end tag whose tag name is one of: &quot;dd&quot;, &quot;dt&quot;, &quot;li&quot;
 
    &lt;dd&gt;
@@ -46867,6 +46889,8 @@
        until an element with the same tag name as the token has been popped
        from the stack.
     &lt;/ol&gt;
+   &lt;/dd&gt;
+   &lt;!-- as normal, except acts as a closer for any of the h1-h6 elements --&gt;
 
    &lt;dt&gt;An end tag whose tag name is one of: &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;,
     &quot;h6&quot;
@@ -46896,6 +46920,12 @@
        until an element whose tag name is one of &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;,
        &quot;h5&quot;, or &quot;h6&quot; has been popped from the stack.
     &lt;/ol&gt;
+
+   &lt;dt&gt;An end tag whose tag name is &quot;sarcasm&quot;
+
+   &lt;dd&gt;
+    &lt;p&gt;Take a deep breath, then act as described in the &quot;any other end tag&quot;
+     entry below.&lt;/p&gt;
    &lt;/dd&gt;
    &lt;!-- ADOPTION AGENCY ELEMENTS
         Mozilla-only: bdo blink del ins sub sup q
@@ -47212,7 +47242,7 @@
      title=&quot;insertion mode: in table&quot;&gt;in table&lt;/a&gt;&quot;.&lt;/p&gt;
 
    &lt;dt&gt;A start tag whose tag name is one of: &quot;area&quot;, &quot;basefont&quot;, &quot;bgsound&quot;,
-    &quot;br&quot;, &quot;embed&quot;, &quot;img&quot;, &quot;param&quot;, &quot;spacer&quot;, &quot;wbr&quot;
+    &quot;br&quot;, &quot;embed&quot;, &quot;img&quot;, &quot;spacer&quot;, &quot;wbr&quot;
 
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=&quot;#reconstruct&quot;&gt;Reconstruct the active formatting elements&lt;/a&gt;,
@@ -47226,6 +47256,17 @@
      flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
      set.&lt;/p&gt;
 
+   &lt;dt&gt;A start tag whose tag name is one of: &quot;param&quot;, &quot;source&quot;
+
+   &lt;dd&gt;
+    &lt;p&gt;&lt;a href=&quot;#insert0&quot;&gt;Insert an HTML element&lt;/a&gt; for the token.
+     Immediately pop the &lt;a href=&quot;#current5&quot;&gt;current node&lt;/a&gt; off the &lt;a
+     href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;a href=&quot;#acknowledged&quot; title=&quot;acknowledge self-closing
+     flag&quot;&gt;Acknowledge the token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/a&gt;, if it is
+     set.&lt;/p&gt;
+
    &lt;dt&gt;A start tag whose tag name is &quot;hr&quot;
 
    &lt;dd&gt;
@@ -47380,7 +47421,7 @@
    &lt;dt&gt;A start tag whose tag name is one of: &quot;iframe&quot;, &quot;noembed&quot;
 
    &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;a
-    href=&quot;#scripting2&quot;&gt;scripting flag&lt;/a&gt; is enabled:
+    href=&quot;#scripting2&quot;&gt;scripting flag&lt;/a&gt; is enabled
 
    &lt;dd&gt;
     &lt;p&gt;Follow the &lt;a href=&quot;#generic&quot;&gt;generic CDATA parsing algorithm&lt;/a&gt;.&lt;/p&gt;
@@ -47501,31 +47542,30 @@
    &lt;/dd&gt;
 --&gt;
 
-   &lt;dt&gt;A start or end tag whose tag name is one of: &quot;caption&quot;, &quot;col&quot;,
-    &quot;colgroup&quot;, &quot;frame&quot;, &quot;frameset&quot;, &quot;head&quot;, &quot;option&quot;, &quot;optgroup&quot;, &quot;tbody&quot;,
-    &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;
+   &lt;dt&gt;A start &lt;!--or end--&gt; tag whose tag name is one of: &quot;caption&quot;, &quot;col&quot;,
+    &quot;colgroup&quot;, &quot;frame&quot;, &quot;frameset&quot;, &quot;head&quot;, &quot;tbody&quot;, &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;,
+    &quot;thead&quot;, &quot;tr&quot;&lt;/dt&gt;
+   &lt;!--&lt;dt&gt;An end tag whose tag name is one of: &quot;area&quot;, &quot;base&quot;,
+   &quot;basefont&quot;, &quot;bgsound&quot;, &quot;command&quot;, &quot;embed&quot;, &quot;event-source&quot;, &quot;hr&quot;,
+   &quot;iframe&quot;, &quot;image&quot;, &quot;img&quot;, &quot;input&quot;, &quot;isindex&quot;, &quot;link&quot;, &quot;meta&quot;,
+   &quot;noembed&quot;, &quot;noframes&quot;, &quot;param&quot;, &quot;script&quot;, &quot;select&quot;, &quot;source&quot;,
+   &quot;spacer&quot;, &quot;style&quot;, &quot;table&quot;, &quot;textarea&quot;, &quot;title&quot;, &quot;wbr&quot;&lt;/dt&gt;--&gt;
+   &lt;!--
+   add keygen if we add the start tag --&gt;
+   &lt;!--&lt;dt&gt;An end tag whose tag name is &quot;noscript&quot;, if the
+   &lt;span&gt;scripting flag&lt;/span&gt; is enabled&lt;/dt&gt;--&gt;
 
-   &lt;dt&gt;An end tag whose tag name is one of: &quot;area&quot;, &quot;basefont&quot;, &quot;bgsound&quot;,
-    &quot;embed&quot;, &quot;hr&quot;, &quot;iframe&quot;, &quot;image&quot;, &quot;img&quot;, &quot;input&quot;, &quot;isindex&quot;, &quot;noembed&quot;,
-    &quot;noframes&quot;, &quot;param&quot;, &quot;select&quot;, &quot;spacer&quot;, &quot;table&quot;, &quot;textarea&quot;, &quot;wbr&quot;&lt;/dt&gt;
-   &lt;!-- add keygen if we add the start
-   tag --&gt;
-
-   &lt;dt&gt;An end tag whose tag name is &quot;noscript&quot;, if the &lt;a
-    href=&quot;#scripting2&quot;&gt;scripting flag&lt;/a&gt; is enabled:
-
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=&quot;#parse1&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+    &lt;!-- end tags are commented out because since they can never end
+    up on the stack anyway, the default end tag clause will
+    automatically handle them. we don't want to have text in the spec
+    that is just an optimisation, as that detracts from the spec
+    itself --&gt;
+    
 
-   &lt;dt&gt;A start or end tag whose tag name is one of: &quot;event-source&quot;,
-    &quot;section&quot;, &quot;nav&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;header&quot;, &quot;footer&quot;, &quot;datagrid&quot;,
-    &quot;command&quot;
+   &lt;dt&gt;Any other start tag
 
-   &lt;dd&gt; &lt;!-- XXXX --&gt;
-    &lt;p class=big-issue&gt;Work in progress!&lt;/p&gt;
-
-   &lt;dt&gt;A start tag token not covered by the previous entries
-
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=&quot;#reconstruct&quot;&gt;Reconstruct the active formatting elements&lt;/a&gt;,
      if any.&lt;/p&gt;
@@ -47535,7 +47575,7 @@
     &lt;p class=note&gt;This element will be a &lt;a href=&quot;#phrasing1&quot;&gt;phrasing&lt;/a&gt;
      element.&lt;/p&gt;
 
-   &lt;dt&gt;An end tag token not covered by the previous entries
+   &lt;dt&gt;Any other end tag
 
    &lt;dd&gt;
     &lt;p&gt;Run the following algorithm:&lt;/p&gt;

Modified: source
===================================================================
--- source	2008-06-06 19:03:41 UTC (rev 1730)
+++ source	2008-06-07 00:27:53 UTC (rev 1731)
@@ -3553,7 +3553,7 @@
  Test: <A HREF="http://www.hixie.ch/tests/adhoc/html/flow/image-maps/004-demo.html">http://www.hixie.ch/tests/adhoc/html/flow/image-maps/004-demo.html</A>
  IE6 on Wine treats the following characters like this also: U+1-U+1f,
  U+21-U+2b, U+2d-U+2f, U+3a, U+3c-U+40, U+5b-U+60, U+7b-U+82,
- U+84-U+89, U+8b, U+8d, U+8f-U`+99, U+9b, U+9d, U+a0-U+bf, U+d7, U+f7,
+ U+84-U+89, U+8b, U+8d, U+8f-U+99, U+9b, U+9d, U+a0-U+bf, U+d7, U+f7,
  U+1f6-U+1f9, U+218-U+24f, U+2a9-U+385, U+387, U+38b, U+38d, U+3a2,
  U+3cf, U+3d7-U+3d9, U+3db, U+3dd, U+3df, U+3e1, U+3f4-U+400, U+40d,
  U+450, U+45d, U+482-U+48f, U+4c5-U+4c6, U+4c9-U+4ca, U+4cd-U+4cf,
@@ -7204,17 +7204,6 @@
   (if any), and that element's child nodes. Otherwise, the specified
   styles must, if applied, be applied to the entire document.&lt;/p&gt;
 
-  &lt;p&gt;If the &lt;code title=&quot;attr-style-scoped&quot;&gt;scoped&lt;/code&gt; attribute is
-  not specified, the &lt;code&gt;style&lt;/code&gt; element must be the child of a
-  &lt;code&gt;head&lt;/code&gt; element or of a &lt;code&gt;noscript&lt;/code&gt; element that
-  is a child of a &lt;code&gt;head&lt;/code&gt; element.&lt;/p&gt;
-
-  &lt;p&gt;If the &lt;code title=&quot;attr-style-scoped&quot;&gt;scoped&lt;/code&gt; attribute
-  &lt;em&gt;is&lt;/em&gt; specified, then the &lt;code&gt;style&lt;/code&gt; element must be
-  the child of a &lt;span&gt;flow content&lt;/span&gt; element, before any text
-  nodes other than &lt;span&gt;inter-element whitespace&lt;/span&gt;, and before
-  any elements other than other &lt;code&gt;style&lt;/code&gt; elements.&lt;/p&gt;
-
   &lt;p id=&quot;title-on-style&quot;&gt;The &lt;dfn
   title=&quot;attr-style-title&quot;&gt;&lt;code&gt;title&lt;/code&gt;&lt;/dfn&gt; attribute on
   &lt;code&gt;style&lt;/code&gt; elements defines &lt;span&gt;alternative style sheet
@@ -39414,12 +39403,10 @@
   &lt;span&gt;space character&lt;/span&gt; or a &lt;span
   title=&quot;syntax-comments&quot;&gt;comment&lt;/span&gt;, except if the first thing
   inside the &lt;code&gt;body&lt;/code&gt; element is a &lt;code&gt;script&lt;/code&gt; or
-  &lt;code&gt;style&lt;/code&gt; element&lt;!-- and the node immediately preceding
-  the &lt;code&gt;body&lt;/code&gt; element is a &lt;code&gt;head&lt;/code&gt; element whose
-  end tag has been omitted (XXX this last bit is commented out for now
-  because we have the dubious rule in the parser that makes &lt;style&gt;
-  and &lt;script&gt; elements between &lt;/head&gt; and &lt;body&gt; end up in the
-  &lt;head&gt; instead of the &lt;body&gt;)--&gt;.&lt;/p&gt;
+  &lt;code&gt;style&lt;/code&gt; element. &lt;!-- Note that even if the &lt;/head&gt; end
+  tag is present, the parser makes &lt;style&gt; and &lt;script&gt; elements
+  between &lt;/head&gt; and &lt;body&gt; end up in the &lt;head&gt; instead of implying
+  the &lt;body&gt; --&gt;&lt;/p&gt;
 
   &lt;!-- &lt;/body&gt; --&gt;
   &lt;p&gt;A &lt;code&gt;body&lt;/code&gt; element's &lt;span title=&quot;syntax-end-tag&quot;&gt;end
@@ -40723,19 +40710,19 @@
    &lt;code&gt;fieldset&lt;/code&gt;, &lt;code&gt;form&lt;/code&gt;, &lt;code&gt;frame&lt;/code&gt;,
    &lt;code&gt;frameset&lt;/code&gt;, &lt;code&gt;h1&lt;/code&gt;, &lt;code&gt;h2&lt;/code&gt;,
    &lt;code&gt;h3&lt;/code&gt;, &lt;code&gt;h4&lt;/code&gt;, &lt;code&gt;h5&lt;/code&gt;, &lt;code&gt;h6&lt;/code&gt;,
-   &lt;code&gt;head&lt;/code&gt;, &lt;code&gt;hr&lt;/code&gt;, &lt;code&gt;iframe&lt;/code&gt;,
-   &lt;code&gt;image&lt;/code&gt;&lt;!-- XXX ? this isn't an element that can end up
-   on the stack--&gt;, &lt;code&gt;img&lt;/code&gt;, &lt;code&gt;input&lt;/code&gt;,
-   &lt;code&gt;isindex&lt;/code&gt;, &lt;code&gt;li&lt;/code&gt;, &lt;code&gt;link&lt;/code&gt;,
-   &lt;code&gt;listing&lt;/code&gt;, &lt;code&gt;menu&lt;/code&gt;, &lt;code&gt;meta&lt;/code&gt;,
-   &lt;code&gt;noembed&lt;/code&gt;, &lt;code&gt;noframes&lt;/code&gt;, &lt;code&gt;noscript&lt;/code&gt;,
-   &lt;code&gt;ol&lt;/code&gt;, &lt;code&gt;optgroup&lt;/code&gt;, &lt;code&gt;option&lt;/code&gt;,
-   &lt;code&gt;p&lt;/code&gt;, &lt;code&gt;param&lt;/code&gt;, &lt;code&gt;plaintext&lt;/code&gt;,
-   &lt;code&gt;pre&lt;/code&gt;, &lt;code&gt;script&lt;/code&gt;, &lt;code&gt;select&lt;/code&gt;,
-   &lt;code&gt;spacer&lt;/code&gt;, &lt;code&gt;style&lt;/code&gt;, &lt;code&gt;tbody&lt;/code&gt;,
-   &lt;code&gt;textarea&lt;/code&gt;, &lt;code&gt;tfoot&lt;/code&gt;, &lt;code&gt;thead&lt;/code&gt;,
-   &lt;code&gt;title&lt;/code&gt;, &lt;code&gt;tr&lt;/code&gt;, &lt;code&gt;ul&lt;/code&gt;, and
-   &lt;code&gt;wbr&lt;/code&gt;.&lt;/p&gt;&lt;/dd&gt;
+   &lt;code&gt;head&lt;/code&gt;, &lt;code&gt;hr&lt;/code&gt;, &lt;code&gt;iframe&lt;/code&gt;, &lt;!--
+   &lt;code&gt;image&lt;/code&gt;, (commented out because this isn't an element
+   that can end up on the stack, so it doesn't matter) --&gt;
+   &lt;code&gt;img&lt;/code&gt;, &lt;code&gt;input&lt;/code&gt;, &lt;code&gt;isindex&lt;/code&gt;,
+   &lt;code&gt;li&lt;/code&gt;, &lt;code&gt;link&lt;/code&gt;, &lt;code&gt;listing&lt;/code&gt;,
+   &lt;code&gt;menu&lt;/code&gt;, &lt;code&gt;meta&lt;/code&gt;, &lt;code&gt;noembed&lt;/code&gt;,
+   &lt;code&gt;noframes&lt;/code&gt;, &lt;code&gt;noscript&lt;/code&gt;, &lt;code&gt;ol&lt;/code&gt;,
+   &lt;code&gt;optgroup&lt;/code&gt;, &lt;code&gt;option&lt;/code&gt;, &lt;code&gt;p&lt;/code&gt;,
+   &lt;code&gt;param&lt;/code&gt;, &lt;code&gt;plaintext&lt;/code&gt;, &lt;code&gt;pre&lt;/code&gt;,
+   &lt;code&gt;script&lt;/code&gt;, &lt;code&gt;select&lt;/code&gt;, &lt;code&gt;spacer&lt;/code&gt;,
+   &lt;code&gt;style&lt;/code&gt;, &lt;code&gt;tbody&lt;/code&gt;, &lt;code&gt;textarea&lt;/code&gt;,
+   &lt;code&gt;tfoot&lt;/code&gt;, &lt;code&gt;thead&lt;/code&gt;, &lt;code&gt;title&lt;/code&gt;,
+   &lt;code&gt;tr&lt;/code&gt;, &lt;code&gt;ul&lt;/code&gt;, and &lt;code&gt;wbr&lt;/code&gt;.&lt;/p&gt;&lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn&gt;Scoping&lt;/dfn&gt;&lt;/dt&gt;
    &lt;dd&gt;&lt;p&gt;The following HTML elements introduce new &lt;span title=&quot;has
@@ -42807,7 +42794,8 @@
   &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;generate implied end
   tags&lt;/dfn&gt;, then, while the &lt;span&gt;current node&lt;/span&gt; is a
   &lt;code&gt;dd&lt;/code&gt; element, a &lt;code&gt;dt&lt;/code&gt; element, an
-  &lt;code&gt;li&lt;/code&gt; element, a &lt;code&gt;p&lt;/code&gt; element, an
+  &lt;code&gt;li&lt;/code&gt; element, an &lt;code&gt;option&lt;/code&gt; element, an
+  &lt;code&gt;optgroup&lt;/code&gt; element, a &lt;code&gt;p&lt;/code&gt; element, an
   &lt;code&gt;rp&lt;/code&gt; element, or an &lt;code&gt;rt&lt;/code&gt; element, the UA must
   pop the &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
   elements&lt;/span&gt;.&lt;/p&gt;
@@ -43225,7 +43213,8 @@
     mode&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
-   &lt;dt&gt;A start tag whose tag name is one of: &quot;base&quot;, &quot;link&quot;&lt;/dt&gt;
+   &lt;dt&gt;A start tag whose tag name is one of: &quot;base&quot;, &quot;command&quot;,
+   &quot;event-source&quot;, &quot;link&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token. Immediately
@@ -43272,13 +43261,13 @@
     &lt;p&gt;Follow the &lt;span&gt;generic RCDATA parsing algorithm&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
-   &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;span&gt;scripting flag&lt;/span&gt; is enabled:&lt;/dt&gt;
+   &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;span&gt;scripting flag&lt;/span&gt; is enabled&lt;/dt&gt;
    &lt;dt&gt;A start tag whose tag name is one of: &quot;noframes&quot;, &quot;style&quot;&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;Follow the &lt;span&gt;generic CDATA parsing algorithm&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
-   &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;span&gt;scripting flag&lt;/span&gt; is disabled:&lt;/dt&gt;
+   &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;span&gt;scripting flag&lt;/span&gt; is disabled&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token.&lt;/p&gt;
@@ -43656,8 +43645,9 @@
     add the attribute and its corresponding value to that element.&lt;/p&gt;
    &lt;/dd&gt;
 
-   &lt;dt&gt;A start tag token whose tag name is one of: &quot;base&quot;, &quot;link&quot;,
-   &quot;meta&quot;, &quot;noframes&quot;, &quot;script&quot;, &quot;style&quot;, &quot;title&quot;&lt;/dt&gt;
+   &lt;dt&gt;A start tag token whose tag name is one of: &quot;base&quot;, &quot;command&quot;,
+   &quot;event-source&quot;, &quot;link&quot;, &quot;meta&quot;, &quot;noframes&quot;, &quot;script&quot;, &quot;style&quot;,
+   &quot;title&quot;&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;Process the token &lt;span&gt;using the rules for&lt;/span&gt; the &quot;&lt;span
     title=&quot;insertion mode: in head&quot;&gt;in head&lt;/span&gt;&quot; &lt;span&gt;insertion
@@ -43737,9 +43727,13 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;A start tag whose tag name is one of: &quot;address&quot;, &quot;blockquote&quot;,
-   &quot;center&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;, &quot;fieldset&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;,
-   &quot;h5&quot;, &quot;h6&quot;, &quot;menu&quot;, &quot;ol&quot;, &quot;p&quot;, &quot;ul&quot;&lt;/dt&gt;
+   &lt;!-- start tags for non-phrasing flow content elements --&gt;
+
+   &lt;!-- the normal ones --&gt;
+   &lt;dt&gt;A start tag whose tag name is one of: &quot;address&quot;, &quot;article&quot;,
+   &quot;aside&quot;, &quot;blockquote&quot;, &quot;center&quot;, &quot;datagrid&quot;, &quot;dialog&quot;, &quot;dir&quot;,
+   &quot;div&quot;, &quot;dl&quot;, &quot;fieldset&quot;, &quot;footer&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;,
+   &quot;h6&quot;, &quot;header&quot;, &quot;menu&quot;, &quot;nav&quot;, &quot;ol&quot;, &quot;p&quot;, &quot;section&quot;, &quot;ul&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;!-- As of May 2008 this doesn't match any browser exactly, but is
@@ -43769,6 +43763,7 @@
 
    &lt;/dd&gt;
 
+   &lt;!-- as normal, but drops leading newline --&gt;
    &lt;dt&gt;A start tag whose tag name is one of: &quot;pre&quot;, &quot;listing&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -43786,6 +43781,7 @@
 
    &lt;/dd&gt;
 
+   &lt;!-- as normal, but interacts with the form element pointer --&gt;
    &lt;dt&gt;A start tag whose tag name is &quot;form&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -43806,14 +43802,10 @@
 
    &lt;/dd&gt;
 
+   &lt;!-- as normal, but imply &lt;/li&gt; when there's another &lt;li&gt; open in weird cases --&gt;
    &lt;dt&gt;A start tag whose tag name is &quot;li&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; &lt;span title=&quot;has
-    an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt; element in
-    scope&lt;/span&gt;, then act as if an end tag with the tag name
-    &lt;code&gt;p&lt;/code&gt; had been seen.&lt;/p&gt;
-
     &lt;p&gt;Run the following algorithm:&lt;/p&gt;
 
     &lt;ol&gt;
@@ -43821,44 +43813,47 @@
      &lt;li&gt;&lt;p&gt;Initialise &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; to be the &lt;span&gt;current
      node&lt;/span&gt; (the bottommost node of the stack).&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is an &lt;code&gt;li&lt;/code&gt;
-     element, then pop all the nodes from the &lt;span&gt;current
-     node&lt;/span&gt; up to &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, including &lt;var
-     title=&quot;&quot;&gt;node&lt;/var&gt;, then stop this algorithm. If more than
-     one node is popped, then this is a &lt;span&gt;parse
-     error&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is an &lt;code&gt;li&lt;/code&gt; element,
+     then act as if an end tag with the tag name &lt;code&gt;li&lt;/code&gt; had
+     been seen, then jump to the last step.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not in the
      &lt;span&gt;formatting&lt;/span&gt; category, and is not in the
      &lt;span&gt;phrasing&lt;/span&gt; category, and is not an
-     &lt;code&gt;address&lt;/code&gt; or &lt;code&gt;div&lt;/code&gt; element, then stop
-     this algorithm.&lt;/p&gt;&lt;/li&gt; &lt;!-- an element &lt;foo&gt; is in this
-     list if the following markup:
+     &lt;code&gt;address&lt;/code&gt; or &lt;code&gt;div&lt;/code&gt; element, then jump to
+     the last step.&lt;/p&gt;&lt;/li&gt; &lt;!-- an element &lt;foo&gt; is in this list if
+     the following markup:
 
          &lt;!DOCTYPE html&gt;&lt;body&gt;&lt;ol&gt;&lt;li&gt;&lt;foo&gt;&lt;li&gt;
 
-     ...results in the second &lt;li&gt; not being (in any way) a
-     descendant of the first &lt;li&gt;, or if &lt;foo&gt; is a formatting
-     element that gets reopened later. --&gt;
+     ...results in the second &lt;li&gt; not being (in any way) a descendant
+     of the first &lt;li&gt;, or if &lt;foo&gt; is a formatting element that gets
+     reopened later. --&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, set &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; to the previous entry
-     in the &lt;span&gt;stack of open elements&lt;/span&gt; and return to step
-     2.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Otherwise, set &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; to the previous
+     entry in the &lt;span&gt;stack of open elements&lt;/span&gt; and return to
+     step 2.&lt;/p&gt;&lt;/li&gt;
 
+     &lt;li&gt;
+
+      &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; &lt;span title=&quot;has
+      an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt; element in
+      scope&lt;/span&gt;, then act as if an end tag with the tag name
+      &lt;code&gt;p&lt;/code&gt; had been seen.&lt;/p&gt;
+
+      &lt;p&gt;Finally, &lt;span&gt;insert an HTML element&lt;/span&gt; for the
+      token.&lt;/p&gt;
+
+     &lt;/li&gt;
+
     &lt;/ol&gt;
 
-    &lt;p&gt;Finally, &lt;span&gt;insert an HTML element&lt;/span&gt; for the token.&lt;/p&gt;
-
    &lt;/dd&gt;
 
+   &lt;!-- as normal, but imply &lt;/dt&gt; or &lt;/dd&gt; when there's another &lt;dt&gt; or &lt;dd&gt; open in weird cases  --&gt;
    &lt;dt&gt;A start tag whose tag name is one of: &quot;dd&quot;, &quot;dt&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; &lt;span title=&quot;has
-    an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt; element in
-    scope&lt;/span&gt;, then act as if an end tag with the tag name
-    &lt;code&gt;p&lt;/code&gt; had been seen.&lt;/p&gt;
-
     &lt;p&gt;Run the following algorithm:&lt;/p&gt;
 
     &lt;ol&gt;
@@ -43867,35 +43862,44 @@
      node&lt;/span&gt; (the bottommost node of the stack).&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is a &lt;code&gt;dd&lt;/code&gt; or
-     &lt;code&gt;dt&lt;/code&gt; element, then pop all the nodes from the
-     &lt;span&gt;current node&lt;/span&gt; up to &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;,
-     including &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then stop this algorithm.
-     If more than one node is popped, then this is a &lt;span&gt;parse
-     error&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+     &lt;code&gt;dt&lt;/code&gt; element, then act as if an end tag with the same
+     tag name as &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; had been seen, then jump to
+     the last step.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not in the
      &lt;span&gt;formatting&lt;/span&gt; category, and is not in the
      &lt;span&gt;phrasing&lt;/span&gt; category, and is not an
-     &lt;code&gt;address&lt;/code&gt; or &lt;code&gt;div&lt;/code&gt; element, then stop
-     this algorithm.&lt;/p&gt;&lt;/li&gt; &lt;!-- an element &lt;foo&gt; is in this
-     list if the following markup:
+     &lt;code&gt;address&lt;/code&gt; or &lt;code&gt;div&lt;/code&gt; element, then jump to
+     the last step.&lt;/p&gt;&lt;/li&gt; &lt;!-- an element &lt;foo&gt; is in this list if
+     the following markup:
 
-         &lt;!DOCTYPE html&gt;&lt;body&gt;&lt;ol&gt;&lt;dt&gt;&lt;foo&gt;&lt;dt&gt;
+         &lt;!DOCTYPE html&gt;&lt;body&gt;&lt;dl&gt;&lt;dt&gt;&lt;foo&gt;&lt;dt&gt;
 
-     ...results in the second &lt;li&gt; not being (in any way) a
-     descendant of the first &lt;li&gt;, or if &lt;foo&gt; is a formatting
-     element that gets reopened later. --&gt;
+     ...results in the second &lt;dt&gt; not being (in any way) a descendant
+     of the first &lt;dt&gt;, or if &lt;foo&gt; is a formatting element that gets
+     reopened later. --&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, set &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; to the previous entry
-     in the &lt;span&gt;stack of open elements&lt;/span&gt; and return to step
-     2.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Otherwise, set &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; to the previous
+     entry in the &lt;span&gt;stack of open elements&lt;/span&gt; and return to
+     step 2.&lt;/p&gt;&lt;/li&gt;
 
+     &lt;li&gt;
+
+      &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; &lt;span title=&quot;has
+      an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt; element in
+      scope&lt;/span&gt;, then act as if an end tag with the tag name
+      &lt;code&gt;p&lt;/code&gt; had been seen.&lt;/p&gt;
+
+      &lt;p&gt;Finally, &lt;span&gt;insert an HTML element&lt;/span&gt; for the
+      token.&lt;/p&gt;
+
+     &lt;/li&gt;
+
     &lt;/ol&gt;
 
-    &lt;p&gt;Finally, &lt;span&gt;insert an HTML element&lt;/span&gt; for the token.&lt;/p&gt;
-
    &lt;/dd&gt;
 
+   &lt;!-- same as normal, but effectively ends parsing --&gt;
    &lt;dt&gt;A start tag whose tag name is &quot;plaintext&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -43917,9 +43921,13 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;An end tag whose tag name is one of: &quot;address&quot;,
-   &quot;blockquote&quot;, &quot;center&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;, &quot;fieldset&quot;,
-   &quot;listing&quot;, &quot;menu&quot;, &quot;ol&quot;, &quot;pre&quot;, &quot;ul&quot;&lt;/dt&gt;
+   &lt;!-- end tags for non-phrasing flow content elements --&gt;
+
+   &lt;!-- the normal ones --&gt;
+   &lt;dt&gt;An end tag whose tag name is one of: &quot;address&quot;, &quot;article&quot;,
+   &quot;aside&quot;, &quot;blockquote&quot;, &quot;center&quot;, &quot;datagrid&quot;, &quot;dialog&quot;, &quot;dir&quot;,
+   &quot;div&quot;, &quot;dl&quot;, &quot;fieldset&quot;, &quot;footer&quot;, &quot;header&quot;, &quot;listing&quot;, &quot;menu&quot;,
+   &quot;nav&quot;, &quot;ol&quot;, &quot;pre&quot;, &quot;section&quot;, &quot;ul&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; does not &lt;span
@@ -43945,6 +43953,7 @@
 
    &lt;/dd&gt;
 
+   &lt;!-- as normal, but interacts with the form element pointer --&gt;
    &lt;dt&gt;An end tag whose tag name is &quot;form&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -43974,24 +43983,37 @@
 
    &lt;/dd&gt;
 
+   &lt;!-- as normal, except &lt;/p&gt; implies &lt;p&gt; if there's no &lt;p&gt; in scope, and needs care as the elements have optional tags --&gt;
    &lt;dt&gt;An end tag whose tag name is &quot;p&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the &lt;span&gt;current node&lt;/span&gt; is not a &lt;code&gt;p&lt;/code&gt;
-    element, then this is a &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt;
-
-    &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; &lt;span title=&quot;has
-    an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt; element in
-    scope&lt;/span&gt;, then pop elements from this stack until the
-    stack no longer &lt;span title=&quot;has an element in scope&quot;&gt;has a
-    &lt;code&gt;p&lt;/code&gt; element in scope&lt;/span&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, act as if a start tag with the tag name
+    &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; does not &lt;span
+    title=&quot;has an element in scope&quot;&gt;have an element in scope&lt;/span&gt;
+    with the same tag name as that of the token, then this is a
+    &lt;span&gt;parse error&lt;/span&gt;; act as if a start tag with the tag name
     &lt;code&gt;p&lt;/code&gt; had been seen, then reprocess the current
     token.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, run these steps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Generate implied end tags&lt;/span&gt;, except
+     for elements with the same tag name as the token.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;span&gt;current node&lt;/span&gt; is not an element with
+     the same tag name as that of the token, then this is a
+     &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Pop elements from the &lt;span&gt;stack of open elements&lt;/span&gt;
+     until an element with the same tag name as the token has been
+     popped from the stack.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
    &lt;/dd&gt;
 
+   &lt;!-- as normal, but needs care as the elements have optional tags --&gt;
    &lt;dt&gt;An end tag whose tag name is one of: &quot;dd&quot;, &quot;dt&quot;, &quot;li&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -44019,8 +44041,8 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;An end tag whose tag name is one of: &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;,
-   &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;&lt;/dt&gt;
+   &lt;!-- as normal, except acts as a closer for any of the h1-h6 elements --&gt;
+   &lt;dt&gt;An end tag whose tag name is one of: &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; does not &lt;span
@@ -44048,6 +44070,12 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;An end tag whose tag name is &quot;sarcasm&quot;&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Take a deep breath, then act as described in the &quot;any other end
+    tag&quot; entry below.&lt;/p&gt;
+   &lt;/dd&gt;
+
    &lt;!-- ADOPTION AGENCY ELEMENTS
         Mozilla-only: bdo blink del ins sub sup q
         Safari-only: code dfn kbd nobr samp var wbr
@@ -44394,7 +44422,7 @@
    &lt;/dd&gt;
 
    &lt;dt&gt;A start tag whose tag name is one of: &quot;area&quot;, &quot;basefont&quot;,
-   &quot;bgsound&quot;, &quot;br&quot;, &quot;embed&quot;, &quot;img&quot;, &quot;param&quot;, &quot;spacer&quot;, &quot;wbr&quot;&lt;/dt&gt;
+   &quot;bgsound&quot;, &quot;br&quot;, &quot;embed&quot;, &quot;img&quot;, &quot;spacer&quot;, &quot;wbr&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;&lt;span&gt;Reconstruct the active formatting elements&lt;/span&gt;, if
@@ -44409,6 +44437,18 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;A start tag whose tag name is one of: &quot;param&quot;, &quot;source&quot;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token. Immediately
+    pop the &lt;span&gt;current node&lt;/span&gt; off the &lt;span&gt;stack of open
+    elements&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span title=&quot;acknowledge self-closing flag&quot;&gt;Acknowledge the
+    token's &lt;i&gt;self-closing flag&lt;/i&gt;&lt;/span&gt;, if it is set.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;A start tag whose tag name is &quot;hr&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
@@ -44576,7 +44616,7 @@
    &lt;/dd&gt;
 
    &lt;dt&gt;A start tag whose tag name is one of: &quot;iframe&quot;, &quot;noembed&quot;&lt;/dt&gt;
-   &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;span&gt;scripting flag&lt;/span&gt; is enabled:&lt;/dt&gt;
+   &lt;dt&gt;A start tag whose tag name is &quot;noscript&quot;, if the &lt;span&gt;scripting flag&lt;/span&gt; is enabled&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;Follow the &lt;span&gt;generic CDATA parsing algorithm&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
@@ -44701,34 +44741,30 @@
 
    &lt;/dd&gt;
 --&gt;
-   &lt;dt&gt;A start or end tag whose tag name is one of: &quot;caption&quot;, &quot;col&quot;,
-   &quot;colgroup&quot;, &quot;frame&quot;, &quot;frameset&quot;, &quot;head&quot;, &quot;option&quot;, &quot;optgroup&quot;,
-   &quot;tbody&quot;, &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;&lt;/dt&gt;
-   &lt;dt&gt;An end tag whose tag name is one of: &quot;area&quot;, &quot;basefont&quot;,
-   &quot;bgsound&quot;, &quot;embed&quot;, &quot;hr&quot;, &quot;iframe&quot;, &quot;image&quot;, &quot;img&quot;, &quot;input&quot;,
-   &quot;isindex&quot;, &quot;noembed&quot;, &quot;noframes&quot;, &quot;param&quot;, &quot;select&quot;, &quot;spacer&quot;,
-   &quot;table&quot;, &quot;textarea&quot;, &quot;wbr&quot;&lt;/dt&gt; &lt;!-- add keygen if we add the start
-   tag --&gt;
-   &lt;dt&gt;An end tag whose tag name is &quot;noscript&quot;, if the &lt;span&gt;scripting flag&lt;/span&gt; is enabled:&lt;/dt&gt;
+
+   &lt;dt&gt;A start &lt;!--or end--&gt; tag whose tag name is one of: &quot;caption&quot;,
+   &quot;col&quot;, &quot;colgroup&quot;, &quot;frame&quot;, &quot;frameset&quot;, &quot;head&quot;, &quot;tbody&quot;, &quot;td&quot;,
+   &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;&lt;/dt&gt;
+   &lt;!--&lt;dt&gt;An end tag whose tag name is one of: &quot;area&quot;, &quot;base&quot;,
+   &quot;basefont&quot;, &quot;bgsound&quot;, &quot;command&quot;, &quot;embed&quot;, &quot;event-source&quot;, &quot;hr&quot;,
+   &quot;iframe&quot;, &quot;image&quot;, &quot;img&quot;, &quot;input&quot;, &quot;isindex&quot;, &quot;link&quot;, &quot;meta&quot;,
+   &quot;noembed&quot;, &quot;noframes&quot;, &quot;param&quot;, &quot;script&quot;, &quot;select&quot;, &quot;source&quot;,
+   &quot;spacer&quot;, &quot;style&quot;, &quot;table&quot;, &quot;textarea&quot;, &quot;title&quot;, &quot;wbr&quot;&lt;/dt&gt;--&gt; &lt;!--
+   add keygen if we add the start tag --&gt;
+   &lt;!--&lt;dt&gt;An end tag whose tag name is &quot;noscript&quot;, if the
+   &lt;span&gt;scripting flag&lt;/span&gt; is enabled&lt;/dt&gt;--&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Ignore the token.&lt;/p&gt;
+    &lt;!-- end tags are commented out because since they can never end
+    up on the stack anyway, the default end tag clause will
+    automatically handle them. we don't want to have text in the spec
+    that is just an optimisation, as that detracts from the spec
+    itself --&gt;
    &lt;/dd&gt;
 
-   &lt;dt&gt;A start or end tag whose tag name is one of:
-   &quot;event-source&quot;, &quot;section&quot;, &quot;nav&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;header&quot;,
-   &quot;footer&quot;, &quot;datagrid&quot;, &quot;command&quot;&lt;/dt&gt;
-
+   &lt;dt&gt;Any other start tag&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;!-- XXXX --&gt;
-
-    &lt;p class=&quot;big-issue&quot;&gt;Work in progress!&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;A start tag token not covered by the previous entries&lt;/dt&gt;
-   &lt;dd&gt;
-
     &lt;p&gt;&lt;span&gt;Reconstruct the active formatting elements&lt;/span&gt;, if
     any.&lt;/p&gt;
 
@@ -44739,7 +44775,7 @@
 
    &lt;/dd&gt;
 
-   &lt;dt&gt;An end tag token not covered by the previous entries&lt;/dt&gt;
+   &lt;dt&gt;Any other end tag&lt;/dt&gt;
    &lt;dd&gt;
 
     &lt;p&gt;Run the following algorithm:&lt;/p&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008629.html">[html5] r1730 - /
</A></li>
	<LI>Next message: <A HREF="008631.html">[html5] r1732 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8630">[ date ]</a>
              <a href="thread.html#8630">[ thread ]</a>
              <a href="subject.html#8630">[ subject ]</a>
              <a href="author.html#8630">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
