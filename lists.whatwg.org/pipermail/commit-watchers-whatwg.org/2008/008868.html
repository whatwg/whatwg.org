<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1970 - [e] (0) Rearrange sections around so that related	topics are closer together.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1970%20-%20%5Be%5D%20%280%29%20Rearrange%20sections%20around%20so%20that%20related%0A%09topics%20are%20closer%20together.&In-Reply-To=%3C20080801052357.600091428AD%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008867.html">
   <LINK REL="Next"  HREF="008869.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1970 - [e] (0) Rearrange sections around so that related	topics are closer together.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1970%20-%20%5Be%5D%20%280%29%20Rearrange%20sections%20around%20so%20that%20related%0A%09topics%20are%20closer%20together.&In-Reply-To=%3C20080801052357.600091428AD%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1970 - [e] (0) Rearrange sections around so that related	topics are closer together.">whatwg at whatwg.org
       </A><BR>
    <I>Thu Jul 31 22:23:57 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008867.html">[html5] r1969 - [e] (0) clarify where to bail if you want to ignore	the navigation for some reason
</A></li>
        <LI>Next message: <A HREF="008869.html">[html5] r1971 - [] (0) Define fetching. (bug 5848)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8868">[ date ]</a>
              <a href="thread.html#8868">[ thread ]</a>
              <a href="subject.html#8868">[ subject ]</a>
              <a href="author.html#8868">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2008-07-31 22:23:56 -0700 (Thu, 31 Jul 2008)
New Revision: 1970

Modified:
   index
   source
Log:
[e] (0) Rearrange sections around so that related topics are closer together.

Modified: index
===================================================================
--- index	2008-08-01 00:46:19 UTC (rev 1969)
+++ index	2008-08-01 05:23:56 UTC (rev 1970)
@@ -227,128 +227,128 @@
      &lt;li&gt;&lt;a href=&quot;#case-sensitivity&quot;&gt;&lt;span class=secno&gt;2.3
       &lt;/span&gt;Case-sensitivity&lt;/a&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#urls&quot;&gt;&lt;span class=secno&gt;2.4 &lt;/span&gt;URLs&lt;/a&gt;
-      &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#terminology0&quot;&gt;&lt;span class=secno&gt;2.4.1
-        &lt;/span&gt;Terminology&lt;/a&gt;
-
-       &lt;li&gt;&lt;a href=&quot;#parsing0&quot;&gt;&lt;span class=secno&gt;2.4.2 &lt;/span&gt;Parsing
-        URLs&lt;/a&gt;
-
-       &lt;li&gt;&lt;a href=&quot;#resolving&quot;&gt;&lt;span class=secno&gt;2.4.3 &lt;/span&gt;Resolving
-        URLs&lt;/a&gt;
-
-       &lt;li&gt;&lt;a href=&quot;#dynamic&quot;&gt;&lt;span class=secno&gt;2.4.4 &lt;/span&gt;Dynamic changes
-        to base URLs&lt;/a&gt;
-
-       &lt;li&gt;&lt;a href=&quot;#interfaces&quot;&gt;&lt;span class=secno&gt;2.4.5 &lt;/span&gt;Interfaces
-        for URL manipulation&lt;/a&gt;
-      &lt;/ul&gt;
-
-     &lt;li&gt;&lt;a href=&quot;#common0&quot;&gt;&lt;span class=secno&gt;2.5 &lt;/span&gt;Common
+     &lt;li&gt;&lt;a href=&quot;#common0&quot;&gt;&lt;span class=secno&gt;2.4 &lt;/span&gt;Common
       microsyntaxes&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#common1&quot;&gt;&lt;span class=secno&gt;2.5.1 &lt;/span&gt;Common parser
+       &lt;li&gt;&lt;a href=&quot;#common1&quot;&gt;&lt;span class=secno&gt;2.4.1 &lt;/span&gt;Common parser
         idioms&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#boolean&quot;&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Boolean
+       &lt;li&gt;&lt;a href=&quot;#boolean&quot;&gt;&lt;span class=secno&gt;2.4.2 &lt;/span&gt;Boolean
         attributes&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#numbers&quot;&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Numbers&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#numbers&quot;&gt;&lt;span class=secno&gt;2.4.3 &lt;/span&gt;Numbers&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#unsigned&quot;&gt;&lt;span class=secno&gt;2.5.3.1. &lt;/span&gt;Unsigned
+         &lt;li&gt;&lt;a href=&quot;#unsigned&quot;&gt;&lt;span class=secno&gt;2.4.3.1. &lt;/span&gt;Unsigned
           integers&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#signed&quot;&gt;&lt;span class=secno&gt;2.5.3.2. &lt;/span&gt;Signed
+         &lt;li&gt;&lt;a href=&quot;#signed&quot;&gt;&lt;span class=secno&gt;2.4.3.2. &lt;/span&gt;Signed
           integers&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#real-numbers&quot;&gt;&lt;span class=secno&gt;2.5.3.3. &lt;/span&gt;Real
+         &lt;li&gt;&lt;a href=&quot;#real-numbers&quot;&gt;&lt;span class=secno&gt;2.4.3.3. &lt;/span&gt;Real
           numbers&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#ratios&quot;&gt;&lt;span class=secno&gt;2.5.3.4. &lt;/span&gt;Ratios&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#ratios&quot;&gt;&lt;span class=secno&gt;2.4.3.4. &lt;/span&gt;Ratios&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#percentages-and-dimensions&quot;&gt;&lt;span class=secno&gt;2.5.3.5.
+         &lt;li&gt;&lt;a href=&quot;#percentages-and-dimensions&quot;&gt;&lt;span class=secno&gt;2.4.3.5.
           &lt;/span&gt;Percentages and dimensions&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#lists&quot;&gt;&lt;span class=secno&gt;2.5.3.6. &lt;/span&gt;Lists of
+         &lt;li&gt;&lt;a href=&quot;#lists&quot;&gt;&lt;span class=secno&gt;2.4.3.6. &lt;/span&gt;Lists of
           integers&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#dates&quot;&gt;&lt;span class=secno&gt;2.5.4 &lt;/span&gt;Dates and
+       &lt;li&gt;&lt;a href=&quot;#dates&quot;&gt;&lt;span class=secno&gt;2.4.4 &lt;/span&gt;Dates and
         times&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#specific&quot;&gt;&lt;span class=secno&gt;2.5.4.1. &lt;/span&gt;Specific
+         &lt;li&gt;&lt;a href=&quot;#specific&quot;&gt;&lt;span class=secno&gt;2.4.4.1. &lt;/span&gt;Specific
           moments in time&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#vaguer&quot;&gt;&lt;span class=secno&gt;2.5.4.2. &lt;/span&gt;Vaguer
+         &lt;li&gt;&lt;a href=&quot;#vaguer&quot;&gt;&lt;span class=secno&gt;2.4.4.2. &lt;/span&gt;Vaguer
           moments in time&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#time-offsets&quot;&gt;&lt;span class=secno&gt;2.5.5 &lt;/span&gt;Time
+       &lt;li&gt;&lt;a href=&quot;#time-offsets&quot;&gt;&lt;span class=secno&gt;2.4.5 &lt;/span&gt;Time
         offsets&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#tokens&quot;&gt;&lt;span class=secno&gt;2.5.6 &lt;/span&gt;Tokens&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#tokens&quot;&gt;&lt;span class=secno&gt;2.4.6 &lt;/span&gt;Tokens&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#keywords&quot;&gt;&lt;span class=secno&gt;2.5.7 &lt;/span&gt;Keywords and
+       &lt;li&gt;&lt;a href=&quot;#keywords&quot;&gt;&lt;span class=secno&gt;2.4.7 &lt;/span&gt;Keywords and
         enumerated attributes&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#syntax-references&quot;&gt;&lt;span class=secno&gt;2.5.8
+       &lt;li&gt;&lt;a href=&quot;#syntax-references&quot;&gt;&lt;span class=secno&gt;2.4.8
         &lt;/span&gt;References&lt;/a&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#common2&quot;&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Common DOM
-      interfaces&lt;/a&gt;
+     &lt;li&gt;&lt;a href=&quot;#urls&quot;&gt;&lt;span class=secno&gt;2.5 &lt;/span&gt;URLs&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#reflecting&quot;&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Reflecting
-        content attributes in DOM attributes&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#terminology0&quot;&gt;&lt;span class=secno&gt;2.5.1
+        &lt;/span&gt;Terminology&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#collections&quot;&gt;&lt;span class=secno&gt;2.6.2
-        &lt;/span&gt;Collections&lt;/a&gt;
-        &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#htmlcollection&quot;&gt;&lt;span class=secno&gt;2.6.2.1.
-          &lt;/span&gt;HTMLCollection&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#parsing0&quot;&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Parsing
+        URLs&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#htmlformcontrolscollection&quot;&gt;&lt;span class=secno&gt;2.6.2.2.
-          &lt;/span&gt;HTMLFormControlsCollection&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#resolving&quot;&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Resolving
+        URLs&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#htmloptionscollection&quot;&gt;&lt;span class=secno&gt;2.6.2.3.
-          &lt;/span&gt;HTMLOptionsCollection&lt;/a&gt;
-        &lt;/ul&gt;
+       &lt;li&gt;&lt;a href=&quot;#dynamic&quot;&gt;&lt;span class=secno&gt;2.5.4 &lt;/span&gt;Dynamic changes
+        to base URLs&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#domtokenlist&quot;&gt;&lt;span class=secno&gt;2.6.3
-        &lt;/span&gt;DOMTokenList&lt;/a&gt;
-
-       &lt;li&gt;&lt;a href=&quot;#domstringmap&quot;&gt;&lt;span class=secno&gt;2.6.4
-        &lt;/span&gt;DOMStringMap&lt;/a&gt;
-
-       &lt;li&gt;&lt;a href=&quot;#dom-feature&quot;&gt;&lt;span class=secno&gt;2.6.5 &lt;/span&gt;DOM feature
-        strings&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#interfaces&quot;&gt;&lt;span class=secno&gt;2.5.5 &lt;/span&gt;Interfaces
+        for URL manipulation&lt;/a&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#fetching&quot;&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Fetching
+     &lt;li&gt;&lt;a href=&quot;#fetching&quot;&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Fetching
       resources&lt;/a&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#content-type-sniffing&quot;&gt;&lt;span class=secno&gt;2.8
+     &lt;li&gt;&lt;a href=&quot;#content-type-sniffing&quot;&gt;&lt;span class=secno&gt;2.7
       &lt;/span&gt;Determining the type of a resource&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#content-type&quot;&gt;&lt;span class=secno&gt;2.8.1
+       &lt;li&gt;&lt;a href=&quot;#content-type&quot;&gt;&lt;span class=secno&gt;2.7.1
         &lt;/span&gt;Content-Type metadata&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type0&quot;&gt;&lt;span class=secno&gt;2.8.2
+       &lt;li&gt;&lt;a href=&quot;#content-type0&quot;&gt;&lt;span class=secno&gt;2.7.2
         &lt;/span&gt;Content-Type sniffing: Web pages&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type1&quot;&gt;&lt;span class=secno&gt;2.8.3
+       &lt;li&gt;&lt;a href=&quot;#content-type1&quot;&gt;&lt;span class=secno&gt;2.7.3
         &lt;/span&gt;Content-Type sniffing: text or binary&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type2&quot;&gt;&lt;span class=secno&gt;2.8.4
+       &lt;li&gt;&lt;a href=&quot;#content-type2&quot;&gt;&lt;span class=secno&gt;2.7.4
         &lt;/span&gt;Content-Type sniffing: unknown type&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type3&quot;&gt;&lt;span class=secno&gt;2.8.5
+       &lt;li&gt;&lt;a href=&quot;#content-type3&quot;&gt;&lt;span class=secno&gt;2.7.5
         &lt;/span&gt;Content-Type sniffing: image&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type4&quot;&gt;&lt;span class=secno&gt;2.8.6
+       &lt;li&gt;&lt;a href=&quot;#content-type4&quot;&gt;&lt;span class=secno&gt;2.7.6
         &lt;/span&gt;Content-Type sniffing: feed or HTML&lt;/a&gt;
       &lt;/ul&gt;
+
+     &lt;li&gt;&lt;a href=&quot;#common2&quot;&gt;&lt;span class=secno&gt;2.8 &lt;/span&gt;Common DOM
+      interfaces&lt;/a&gt;
+      &lt;ul class=toc&gt;
+       &lt;li&gt;&lt;a href=&quot;#reflecting&quot;&gt;&lt;span class=secno&gt;2.8.1 &lt;/span&gt;Reflecting
+        content attributes in DOM attributes&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#collections&quot;&gt;&lt;span class=secno&gt;2.8.2
+        &lt;/span&gt;Collections&lt;/a&gt;
+        &lt;ul class=toc&gt;
+         &lt;li&gt;&lt;a href=&quot;#htmlcollection&quot;&gt;&lt;span class=secno&gt;2.8.2.1.
+          &lt;/span&gt;HTMLCollection&lt;/a&gt;
+
+         &lt;li&gt;&lt;a href=&quot;#htmlformcontrolscollection&quot;&gt;&lt;span class=secno&gt;2.8.2.2.
+          &lt;/span&gt;HTMLFormControlsCollection&lt;/a&gt;
+
+         &lt;li&gt;&lt;a href=&quot;#htmloptionscollection&quot;&gt;&lt;span class=secno&gt;2.8.2.3.
+          &lt;/span&gt;HTMLOptionsCollection&lt;/a&gt;
+        &lt;/ul&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#domtokenlist&quot;&gt;&lt;span class=secno&gt;2.8.3
+        &lt;/span&gt;DOMTokenList&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#domstringmap&quot;&gt;&lt;span class=secno&gt;2.8.4
+        &lt;/span&gt;DOMStringMap&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#dom-feature&quot;&gt;&lt;span class=secno&gt;2.8.5 &lt;/span&gt;DOM feature
+        strings&lt;/a&gt;
+      &lt;/ul&gt;
     &lt;/ul&gt;
 
    &lt;li&gt;&lt;a href=&quot;#dom&quot;&gt;&lt;span class=secno&gt;3. &lt;/span&gt;Semantics and structure of
@@ -2909,707 +2909,8 @@
    corresponding characters in the range U+0061 .. U+007A (i.e. LATIN SMALL
    LETTER A to LATIN SMALL LETTER Z).
 
-  &lt;h3 id=urls&gt;&lt;span class=secno&gt;2.4 &lt;/span&gt;URLs&lt;/h3&gt;
+  &lt;h3 id=common0&gt;&lt;span class=secno&gt;2.4 &lt;/span&gt;Common microsyntaxes&lt;/h3&gt;
 
-  &lt;p&gt;This specification defines the term &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt;, and defines
-   various algorithms for dealing with URLs, because for historical reasons
-   the rules defined by the URI and IRI specifications are not a complete
-   description of what HTML user agents need to implement to be compatible
-   with Web content.
-
-  &lt;h4 id=terminology0&gt;&lt;span class=secno&gt;2.4.1 &lt;/span&gt;Terminology&lt;/h4&gt;
-
-  &lt;p&gt;A &lt;dfn id=url&gt;URL&lt;/dfn&gt; is a string used to identify a resource. &lt;span
-   id=urldoc&gt;A &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is always associated with a
-   &lt;code&gt;Document&lt;/code&gt;, either explicitly when the URL is created or
-   defined; or through a DOM node, in which case the associated
-   &lt;code&gt;Document&lt;/code&gt; is the node's &lt;code&gt;Document&lt;/code&gt;; or through a
-   script, in which case the associated &lt;code&gt;Document&lt;/code&gt; is the script's
-   &lt;a href=&quot;#script4&quot;&gt;script document context&lt;/a&gt;.&lt;/span&gt;
-
-  &lt;p&gt;A &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a &lt;dfn id=valid&gt;valid URL&lt;/dfn&gt; if at least
-   one of the following conditions holds:
-
-  &lt;ul&gt;
-   &lt;li&gt;
-    &lt;p&gt;The &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a valid URI reference &lt;a
-     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;.
-
-   &lt;li&gt;
-    &lt;p&gt;The &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a valid IRI reference and it has no
-     query component. &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;The &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a valid IRI reference and its query
-     component contains no unescaped non-ASCII characters. &lt;a
-     href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;The &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a valid IRI reference and the &lt;a
-     href=&quot;#character3&quot; title=&quot;document's character encoding&quot;&gt;character
-     encoding&lt;/a&gt; of the URL's &lt;code&gt;Document&lt;/code&gt; is UTF-8 or UTF-16. &lt;a
-     href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
-  &lt;/ul&gt;
-
-  &lt;p class=note&gt;The term &quot;URL&quot; in this specification is used in a manner
-   distinct from the precise technical meaning it is given in RFC 3986.
-   Readers familiar with that RFC will find it easier to read &lt;em&gt;this&lt;/em&gt;
-   specification if they pretend the term &quot;URL&quot; as used herein is really
-   called something else altogether.
-
-  &lt;h4 id=parsing0&gt;&lt;span class=secno&gt;2.4.2 &lt;/span&gt;Parsing URLs&lt;/h4&gt;
-
-  &lt;p&gt;To &lt;dfn id=parse0&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
-   component parts, the user agent must use the following steps:
-
-  &lt;ol&gt;
-   &lt;li&gt;
-    &lt;p&gt;Strip leading and trailing &lt;a href=&quot;#space&quot; title=&quot;space
-     character&quot;&gt;space characters&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.
-
-   &lt;li&gt;
-    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC 3986, with
-     the following exceptions:&lt;/p&gt;
-
-    &lt;ul&gt;
-     &lt;li&gt;Add all characters with codepoints less than or equal to U+0020 or
-      greater than or equal to U+007F to the &lt;unreserved&gt; production.
-
-     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E, U+0060,
-      and U+007B .. U+007D to the &lt;unreserved&gt; production. &lt;!--
-       0022 QUOTATION MARK
-       003C LESS-THAN SIGN
-       003E GREATER-THAN SIGN
-       005B LEFT SQUARE BRACKET
-       005C REVERSE SOLIDUS
-       005D RIGHT SQUARE BRACKET
-       005E CIRCUMFLEX ACCENT
-       0060 GRAVE ACCENT
-       007B LEFT CURLY BRACKET
-       007C VERTICAL LINE
-       007D RIGHT CURLY BRACKET
-      --&gt;
-      
-
-     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second alternative
-      way of matching the &lt;pct-encoded&gt; production, except when the
-      &lt;pct-encoded&gt; is used in the &lt;reg-name&gt; production.
-
-     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters allowed in
-      the &lt;fragment&gt; production.&lt;/li&gt;
-     &lt;!-- some browsers also have other differences, e.g. Mozilla
-     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
-     is &quot;ftp&quot;. --&gt;
-    &lt;/ul&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the &lt;URI-reference&gt;
-     production, even after the above changes are made to the ABNF
-     definitions, then parsing the URL fails with an error. &lt;a
-     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
-     components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; defined
-     as follows:&lt;/p&gt;
-
-    &lt;dl&gt;
-     &lt;dt&gt;&lt;dfn id=ltschemegt title=url-scheme&gt;&lt;scheme&gt;&lt;/dfn&gt;
-
-     &lt;dd&gt;
-      &lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.
-
-     &lt;dt&gt;&lt;dfn id=lthostgt title=url-host&gt;&lt;host&gt;&lt;/dfn&gt;
-
-     &lt;dd&gt;
-      &lt;p&gt;The substring matched by the &lt;host&gt; production, if any.
-
-     &lt;dt&gt;&lt;dfn id=ltportgt title=url-port&gt;&lt;port&gt;&lt;/dfn&gt;
-
-     &lt;dd&gt;
-      &lt;p&gt;The substring matched by the &lt;port&gt; production, if any.
-
-     &lt;dt&gt;&lt;dfn id=lthostportgt title=url-hostport&gt;&lt;hostport&gt;&lt;/dfn&gt;
-
-     &lt;dd&gt;
-      &lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt; component
-       and the port given by the &lt;port&gt; component is different than the
-       default port defined for the protocol given by the &lt;scheme&gt;
-       component, then &lt;hostport&gt; is the substring that starts with the
-       substring matched by the &lt;host&gt; production and ends with the
-       substring matched by the &lt;port&gt; production, and includes the
-       colon in between the two. Otherwise, it is the same as the
-       &lt;host&gt; component.&lt;/p&gt;
-
-     &lt;dt&gt;&lt;dfn id=ltpathgt title=url-path&gt;&lt;path&gt;&lt;/dfn&gt;
-
-     &lt;dd&gt;
-      &lt;p&gt;The substring matched by one of the following productions, if one of
-       them was matched:&lt;/p&gt;
-
-      &lt;ul class=brief&gt;
-       &lt;li&gt;&lt;path-abempty&gt;
-
-       &lt;li&gt;&lt;path-absolute&gt;
-
-       &lt;li&gt;&lt;path-noscheme&gt;
-
-       &lt;li&gt;&lt;path-rootless&gt;
-
-       &lt;li&gt;&lt;path-empty&gt;
-      &lt;/ul&gt;
-
-     &lt;dt&gt;&lt;dfn id=ltquerygt title=url-query&gt;&lt;query&gt;&lt;/dfn&gt;
-
-     &lt;dd&gt;
-      &lt;p&gt;The substring matched by the &lt;query&gt; production, if any.
-
-     &lt;dt&gt;&lt;dfn id=ltfragmentgt title=url-fragment&gt;&lt;fragment&gt;&lt;/dfn&gt;
-
-     &lt;dd&gt;
-      &lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.
-    &lt;/dl&gt;
-  &lt;/ol&gt;
-  &lt;!-- XXX we might want to define &quot;server-based naming authority&quot;,
-  it's not clear RFC3986 does a good job of defining that anymore
-  (earlier URI specs did) --&gt;
-
-  &lt;h4 id=resolving&gt;&lt;span class=secno&gt;2.4.3 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
-
-  &lt;p&gt;Relative URLs are resolved relative to a base URL. The &lt;dfn
-   id=base-&gt;base URL&lt;/dfn&gt; of a &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is the &lt;a
-   href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; obtained as follows:
-
-  &lt;dl class=switch&gt;
-   &lt;dt&gt;If the URL to be resolved was passed to an API
-
-   &lt;dd&gt;
-    &lt;p&gt;The base URL is the &lt;a href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; of the
-     script's &lt;a href=&quot;#script4&quot;&gt;script document context&lt;/a&gt;.
-
-   &lt;dt&gt;If the URL to be resolved is from the value of a content attribute
-
-   &lt;dd&gt;
-    &lt;p&gt;The base URL is the &lt;i&gt;base URI of the element&lt;/i&gt; that the attribute
-     is on, as defined by the XML Base specification, with &lt;i&gt;the base URI of
-     the document entity&lt;/i&gt; being defined as the &lt;a
-     href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; of the &lt;code&gt;Document&lt;/code&gt;
-     that owns the element.&lt;/p&gt;
-
-    &lt;p&gt;For the purposes of the XML Base specification, user agents must act
-     as if all &lt;code&gt;Document&lt;/code&gt; objects represented XML documents.&lt;/p&gt;
-
-    &lt;p class=note&gt;It is possible for &lt;code title=attr-xml-base&gt;&lt;a
-     href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes to be present even in
-     HTML fragments, as such attributes can be added dynamically using
-     script. (Such scripts would not be conforming, however, as &lt;code
-     title=attr-xml-base&gt;&lt;a href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes
-     are not allowed in &lt;a href=&quot;#html-&quot;&gt;HTML documents&lt;/a&gt;.)&lt;/p&gt;
-
-   &lt;dt&gt;If the URL to be resolved was found in an offline application cache
-    manifest
-
-   &lt;dd&gt;
-    &lt;p&gt;The base URL is the URL of the &lt;a href=&quot;#application0&quot;&gt;application
-     cache&lt;/a&gt; &lt;a href=&quot;#the-manifest&quot;
-     title=concept-appcache-manifest&gt;manifest&lt;/a&gt;.
-  &lt;/dl&gt;
-
-  &lt;p&gt;The &lt;dfn id=document0&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt;
-   is the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; obtained by running these
-   steps:
-
-  &lt;ol&gt;
-   &lt;li&gt;
-    &lt;p&gt;If there is no &lt;code&gt;&lt;a href=&quot;#base&quot;&gt;base&lt;/a&gt;&lt;/code&gt; element that is
-     both a child of &lt;a href=&quot;#the-head0&quot;&gt;the &lt;code&gt;head&lt;/code&gt; element&lt;/a&gt;
-     and has an &lt;code title=attr-base-href&gt;&lt;a href=&quot;#href&quot;&gt;href&lt;/a&gt;&lt;/code&gt;
-     attribute, then the &lt;a href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; is
-     &lt;span&gt;the document's address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;.
-
-   &lt;li&gt;
-    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the &lt;code
-     title=attr-base-href&gt;&lt;a href=&quot;#href&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute of the
-     first such element.
-
-   &lt;li&gt;
-    &lt;p&gt;&lt;a href=&quot;#resolve&quot; title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; the &lt;var
-     title=&quot;&quot;&gt;url&lt;/var&gt; URL, using &lt;span&gt;the document's
-     address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt; as the &lt;a href=&quot;#base-&quot;&gt;base URL&lt;/a&gt;
-     (thus, the &lt;code&gt;&lt;a href=&quot;#base&quot;&gt;base&lt;/a&gt;&lt;/code&gt; &lt;code
-     title=attr-base-href&gt;&lt;a href=&quot;#href&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute isn't
-     affect by &lt;code title=attr-xml-base&gt;&lt;a
-     href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes).
-
-   &lt;li&gt;
-    &lt;p&gt;The &lt;a href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; is the result of the
-     previous step if it was successful; otherwise it is &lt;span&gt;the document's
-     address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;.
-  &lt;/ol&gt;
-
-  &lt;p&gt;To &lt;dfn id=resolve&gt;resolve a URL&lt;/dfn&gt; to an &lt;a
-   href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; the user agent must use the following
-   steps. Resolving a URL can result in an error, in which case the URL is
-   not resolvable.
-
-  &lt;ol&gt;
-   &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; being
-     resolved.
-
-   &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the &lt;code&gt;Document&lt;/code&gt; &lt;a
-     href=&quot;#urldoc&quot;&gt;associated with&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.
-
-   &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be the &lt;a href=&quot;#character3&quot;
-     title=&quot;document's character encoding&quot;&gt;character encoding&lt;/a&gt; of &lt;var
-     title=&quot;&quot;&gt;document&lt;/var&gt;.
-
-   &lt;li&gt;
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is UTF-16, then change it to UTF-8.
-
-   &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;a href=&quot;#base-&quot;&gt;base URL&lt;/a&gt; for
-     &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. (This is an &lt;a href=&quot;#absolute&quot;&gt;absolute
-     URL&lt;/a&gt;.)
-
-   &lt;li&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse0&quot; title=&quot;parse a URL&quot;&gt;Parse&lt;/a&gt; &lt;var
-     title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.
-
-   &lt;li&gt;
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=&quot;#lthostgt&quot;
-     title=url-host&gt;&lt;host&gt;&lt;/a&gt; component, then replace the matching
-     subtring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that results from
-     expanding any sequences of percent-encoded octets in that component that
-     are valid UTF-8 sequences into Unicode characters as defined by UTF-8.&lt;/p&gt;
-
-    &lt;p&gt;If any percent-encoded octets in that component are not valid UTF-8
-     sequences, then return an error and abort these steps.&lt;/p&gt;
-
-    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring, with both
-     the AllowUnassigned and UseSTD3ASCIIRules flags set. Replace the
-     matching substring with the result of the ToASCII algorithm.&lt;/p&gt;
-
-    &lt;p&gt;If ToASCII fails to convert one of the components of the string, e.g.
-     because it is too long or because it contains invalid characters, then
-     return an error and abort these steps. &lt;a
-     href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=&quot;#ltpathgt&quot;
-     title=url-path&gt;&lt;path&gt;&lt;/a&gt; component, then replace the matching
-     substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that results from
-     applying the following steps to each character other than U+0025 PERCENT
-     SIGN (%) that doesn't match the original &lt;path&gt; production defined
-     in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;
-     &lt;li&gt;Encode the character into a sequence of octets as defined by UTF-8.
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those octets.
-      &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
-    &lt;/ol&gt;
-
-    &lt;div class=example&gt;
-     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code
-      title=&quot;&quot;&gt;//example.com/a^b&amp;#x263a;c%FFd%z/?e&lt;/code&gt;&quot;, then the &lt;a
-      href=&quot;#ltpathgt&quot; title=url-path&gt;&lt;path&gt;&lt;/a&gt; component's substring
-      would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&amp;#x263a;c%FFd%z/&lt;/code&gt;&quot; and the two
-      characters that would have to be escaped would be &quot;&lt;code
-      title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&amp;#x263a;&lt;/code&gt;&quot;. The result
-      after this step was applied would therefore be that &lt;var
-      title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code
-      title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
-    &lt;/div&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=&quot;#ltquerygt&quot;
-     title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, then replace the matching
-     substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that results from
-     applying the following steps to each character other than U+0025 PERCENT
-     SIGN (%) that doesn't match the original &lt;query&gt; production
-     defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;
-     &lt;li&gt;If the character in question cannot be expressed in the encoding
-      &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a single 0x3F octet
-      (an ASCII question mark) and skip the remaining substeps for this
-      character.
-
-     &lt;li&gt;Encode the character into a sequence of octets as defined by the
-      encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;.
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those octets.
-      &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
-    &lt;/ol&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2 Relative
-     Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the potentially relative
-     URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as
-     the base URI (&lt;var title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a
-     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC 3987,
-     returning an error and aborting these steps if appropriate. &lt;a
-     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p class=example&gt;For instance, if an absolute URI that would be returned
-     by the above algorithm violates the restrictions specific to its scheme,
-     e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the &quot;&lt;code
-     title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax, then user
-     agents are to treat this as an error instead.&lt;!-- RFC
-    3986, 3.1 Scheme --&gt;&lt;/p&gt;
-
-   &lt;li&gt;
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var
-     title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution algorithm.
-
-   &lt;li&gt;
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a server-based naming
-     authority, replace all U+005C REVERSE SOLIDUS (\) characters in &lt;var
-     title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS (/) characters.
-
-   &lt;li&gt;
-    &lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.
-  &lt;/ol&gt;
-
-  &lt;p&gt;A &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is an &lt;dfn id=absolute&gt;absolute URL&lt;/dfn&gt; if &lt;a
-   href=&quot;#resolve&quot; title=&quot;resolve a URL&quot;&gt;resolving&lt;/a&gt; it results in the same
-   URL without an error.
-
-  &lt;h4 id=dynamic&gt;&lt;span class=secno&gt;2.4.4 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
-
-  &lt;p&gt;When an &lt;code title=attr-xml-base&gt;&lt;a href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt;
-   attribute changes, the attribute's element, and all descendant elements,
-   are &lt;a href=&quot;#affected&quot;&gt;affected by a base URL change&lt;/a&gt;.
-
-  &lt;p&gt;When a document's &lt;a href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; changes,
-   all elements in that document are &lt;a href=&quot;#affected&quot;&gt;affected by a base
-   URL change&lt;/a&gt;.
-
-  &lt;p&gt;When an element is moved from one document to another, if the two
-   documents have different &lt;a href=&quot;#document0&quot; title=&quot;document base
-   URL&quot;&gt;base URLs&lt;/a&gt;, then that element and all its descendants are &lt;a
-   href=&quot;#affected&quot;&gt;affected by a base URL change&lt;/a&gt;.
-
-  &lt;p&gt;When an element is &lt;dfn id=affected&gt;affected by a base URL change&lt;/dfn&gt;,
-   it must act as described in the following list:
-
-  &lt;dl class=switch&gt;
-   &lt;dt&gt;If the element is a &lt;a href=&quot;#hyperlinks&quot; title=hyperlink&gt;hyperlink
-    element&lt;/a&gt;
-
-   &lt;dd&gt;
-    &lt;p&gt;If the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; identified by the
-     hyperlink is being shown to the user, or if any data derived from that
-     URL is affecting the display, then the &lt;code
-     title=attr-hyperlink-href&gt;&lt;a href=&quot;#href6&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute
-     should be &lt;a href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;reresolved&lt;/a&gt; and
-     the UI updated appropriately.&lt;/p&gt;
-
-    &lt;p class=example&gt;For example, the CSS &lt;code title=&quot;&quot;&gt;:link&lt;/code&gt;/&lt;code
-     title=&quot;&quot;&gt;:visited&lt;/code&gt; pseudo-classes might have been affected.&lt;/p&gt;
-
-    &lt;p&gt;If the hyperlink has a &lt;code title=attr-hyperlink-ping&gt;&lt;a
-     href=&quot;#ping&quot;&gt;ping&lt;/a&gt;&lt;/code&gt; attribute and its &lt;a href=&quot;#absolute&quot;
-     title=&quot;absolute URL&quot;&gt;absolute URL(s)&lt;/a&gt; are being shown to the user,
-     then the &lt;code title=attr-hyperlink-ping&gt;&lt;a href=&quot;#ping&quot;&gt;ping&lt;/a&gt;&lt;/code&gt;
-     attribute's tokens should be &lt;a href=&quot;#resolve&quot; title=&quot;resolve a
-     url&quot;&gt;reresolved&lt;/a&gt; and the UI updated appropriately.&lt;/p&gt;
-
-   &lt;dt&gt;If the element is a &lt;code&gt;&lt;a href=&quot;#blockquote&quot;&gt;blockquote&lt;/a&gt;&lt;/code&gt;,
-    &lt;code&gt;&lt;a href=&quot;#q&quot;&gt;q&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#ins&quot;&gt;ins&lt;/a&gt;&lt;/code&gt;, or
-    &lt;code&gt;&lt;a href=&quot;#del&quot;&gt;del&lt;/a&gt;&lt;/code&gt; element with a &lt;code
-    title=&quot;&quot;&gt;cite&lt;/code&gt; attribute
-
-   &lt;dd&gt;
-    &lt;p&gt;If the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; identified by the &lt;code
-     title=&quot;&quot;&gt;cite&lt;/code&gt; attribute is being shown to the user, or if any
-     data derived from that URL is affecting the display, then the it should
-     be &lt;a href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;reresolved&lt;/a&gt; and the UI
-     updated appropriately.&lt;/p&gt;
-
-   &lt;dt&gt;Otherwise
-
-   &lt;dd&gt;
-    &lt;p&gt;The element is not directly affected.&lt;/p&gt;
-
-    &lt;p class=example&gt;Changing the base URL doesn't affect the image displayed
-     by &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt; elements, although subsequent
-     accesses of the &lt;code title=dom-img-src&gt;&lt;a href=&quot;#src0&quot;&gt;src&lt;/a&gt;&lt;/code&gt;
-     DOM attribute from script will return a new &lt;a href=&quot;#absolute&quot;&gt;absolute
-     URL&lt;/a&gt; that might no longer correspond to the image being shown.&lt;/p&gt;
-  &lt;/dl&gt;
-
-  &lt;h4 id=interfaces&gt;&lt;span class=secno&gt;2.4.5 &lt;/span&gt;Interfaces for URL
-   manipulation&lt;/h4&gt;
-
-  &lt;p&gt;An interface that has a complement of &lt;dfn id=url-decomposition&gt;URL
-   decomposition attributes&lt;/dfn&gt; will have seven attributes with the
-   following definitions:
-
-  &lt;pre class=idl&gt;
-           attribute DOMString &lt;a href=&quot;#protocol&quot; title=dom-uda-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=&quot;#host&quot; title=dom-uda-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=&quot;#hostname&quot; title=dom-uda-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=&quot;#port&quot; title=dom-uda-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=&quot;#pathname&quot; title=dom-uda-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=&quot;#search&quot; title=dom-uda-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=&quot;#hash&quot; title=dom-uda-hash&gt;hash&lt;/a&gt;;
-&lt;/pre&gt;
-
-  &lt;p&gt;The attributes defined to be URL decomposition attributes must act as
-   described for the attributes with the same corresponding names in this
-   section.
-
-  &lt;p&gt;In addition, an interface with a complement of URL decomposition
-   attributes will define an &lt;dfn id=input
-   title=concept-uda-input&gt;input&lt;/dfn&gt;, which is a &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt;
-   that the attributes act on, and a &lt;dfn id=common3
-   title=concept-uda-setter&gt;common setter action&lt;/dfn&gt;, which is a set of
-   steps invoked when any of the attributes' setters are invoked.
-
-  &lt;p&gt;The seven URL decomposition attributes have similar requirements.
-
-  &lt;p&gt;On getting, if the &lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt;
-   fulfills the condition given in the &quot;getter condition&quot; column
-   corresponding to the attribute in the table below, the user agent must
-   return the part of the &lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt;
-   URL given in the &quot;component&quot; column, with any prefixes specified in the
-   &quot;prefix&quot; column appropriately added to the start of the string and any
-   suffixes specified in the &quot;suffix&quot; column appropriately added to the end
-   of the string. Otherwise, the attribute must return the empty string.
-
-  &lt;p&gt;On setting, the new value must first be mutated as described by the
-   &quot;setter preprocessor&quot; column, then mutated by %-escaping any characters in
-   the new value that are not valid in the relevant component as given by the
-   &quot;component&quot; column. Then, if the resulting new value fulfills the
-   condition given in the &quot;setter condition&quot; column, the user agent must make
-   a new string &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; by replacing the component of the
-   URL given by the &quot;component&quot; column in the &lt;a href=&quot;#input&quot;
-   title=concept-uda-input&gt;input&lt;/a&gt; URL with the new value; otherwise, the
-   user agent must let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be equal to the &lt;a
-   href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt;. Finally, the user agent
-   must invoke the &lt;a href=&quot;#common3&quot; title=concept-uda-setter&gt;common setter
-   action&lt;/a&gt; with the value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.
-
-  &lt;p&gt;When replacing a component in the URL, if the component is part of an
-   optional group in the URL syntax consisting of a character followed by the
-   component, the component (including its prefix character) must be included
-   even if the new value is the empty string.
-
-  &lt;p class=note&gt;The previous paragraph applies in particular to the &quot;&lt;code
-   title=&quot;&quot;&gt;:&lt;/code&gt;&quot; before a &lt;port&gt; component, the &quot;&lt;code
-   title=&quot;&quot;&gt;?&lt;/code&gt;&quot; before a &lt;query&gt; component, and the &quot;&lt;code
-   title=&quot;&quot;&gt;#&lt;/code&gt;&quot; before a &lt;fragment&gt; component.
-
-  &lt;p&gt;For the purposes of the above definitions, URLs must be parsed using the
-   &lt;a href=&quot;#parse0&quot; title=&quot;parse a URL&quot;&gt;URL parsing rules&lt;/a&gt; defined in
-   this specification.
-
-  &lt;table&gt;
-   &lt;thead&gt;
-    &lt;tr&gt;
-     &lt;th&gt;Attribute
-
-     &lt;th&gt;Component
-
-     &lt;th&gt;Getter Condition
-
-     &lt;th&gt;Prefix
-
-     &lt;th&gt;Suffix
-
-     &lt;th&gt;Setter Preprocessor
-
-     &lt;th&gt;Setter Condition
-
-   &lt;tbody&gt;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn id=protocol title=dom-uda-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#ltschemegt&quot; title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;U+003A COLON (&quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;)
-
-     &lt;td&gt;Remove all trailing U+003A COLON (&quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;)
-      characters
-
-     &lt;td&gt;The new value is not the empty string
-
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn id=host title=dom-uda-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#lthostportgt&quot; title=url-hostport&gt;&lt;hostport&gt;&lt;/a&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
-      and uses a server-based naming authority
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;&mdash;
-
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn id=hostname title=dom-uda-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#lthostgt&quot; title=url-host&gt;&lt;host&gt;&lt;/a&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
-      and uses a server-based naming authority
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;Remove all leading U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;)
-      characters
-
-     &lt;td&gt;&mdash;
-
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn id=port title=dom-uda-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#ltportgt&quot; title=url-port&gt;&lt;port&gt;&lt;/a&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical,
-      uses a server-based naming authority, and contained a &lt;a
-      href=&quot;#ltportgt&quot; title=url-port&gt;&lt;port&gt;&lt;/a&gt; component (possibly an
-      empty one)
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;Remove any characters in the new value that are not in the range
-      U+0030 DIGIT ZERO .. U+0039 DIGIT NINE. If the resulting string is
-      empty, set it to a single U+0030 DIGIT ZERO character ('0').
-
-     &lt;td&gt;&mdash;
-
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn id=pathname title=dom-uda-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#ltpathgt&quot; title=url-path&gt;&lt;path&gt;&lt;/a&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;If it has no leading U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;)
-      character, prepend a U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;)
-      character to the new value
-
-     &lt;td&gt;&mdash;
-
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn id=search title=dom-uda-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical,
-      and contained a &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
-      component (possibly an empty one)
-
-     &lt;td&gt;U+003F QUESTION MARK (&quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;)
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;Remove one leading U+003F QUESTION MARK (&quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;)
-      character, if any
-
-     &lt;td&gt;&mdash;
-
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn id=hash title=dom-uda-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#ltfragmentgt&quot; title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-
-     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; contained a &lt;a
-      href=&quot;#ltfragmentgt&quot; title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component
-      (possibly an empty one)
-
-     &lt;td&gt;U+0023 NUMBER SIGN (&quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot;)
-
-     &lt;td&gt;&mdash;
-
-     &lt;td&gt;Remove one leading U+0023 NUMBER SIGN (&quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot;)
-      character, if any
-
-     &lt;td&gt;&mdash;
-  &lt;/table&gt;
-  &lt;!--
-  <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
-  <A HREF="http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp">http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp</A>
-  <A HREF="http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722">http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722</A>
---&gt;
-
-  &lt;div class=example&gt;
-   &lt;p&gt;The table below demonstrates how the getter condition for &lt;code
-    title=dom-uda-search&gt;&lt;a href=&quot;#search&quot;&gt;search&lt;/a&gt;&lt;/code&gt; results in
-    different results depending on the exact original syntax of the URL:&lt;/p&gt;
-
-   &lt;table&gt;
-    &lt;thead&gt;
-     &lt;tr&gt;
-      &lt;th&gt; Input URL
-
-      &lt;th&gt; &lt;code title=dom-uda-search&gt;&lt;a href=&quot;#search&quot;&gt;search&lt;/a&gt;&lt;/code&gt;
-       value
-
-      &lt;th&gt; Explanation
-
-    &lt;tbody&gt;
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/&lt;/code">http://example.com/&lt;/code</A>&gt;
-
-      &lt;td&gt; &lt;i&gt;empty string&lt;/i&gt;
-
-      &lt;td&gt; No &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
-       component in input URL.
-
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?&lt;/code">http://example.com/?&lt;/code</A>&gt;
-
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
-
-      &lt;td&gt; There is a &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
-       component, but it is empty. The question mark in the resulting value
-       is the prefix.
-
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test&lt;/code">http://example.com/?test&lt;/code</A>&gt;
-
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-
-      &lt;td&gt; The &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
-       component has the value &quot;&lt;code title=&quot;&quot;&gt;test&lt;/code&gt;&quot;.
-
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test#&lt;/code">http://example.com/?test#&lt;/code</A>&gt;
-
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-
-      &lt;td&gt; The (empty) &lt;a href=&quot;#ltfragmentgt&quot;
-       title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component is not part of the
-       &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt; component.
-   &lt;/table&gt;
-  &lt;/div&gt;
-
-  &lt;h3 id=common0&gt;&lt;span class=secno&gt;2.5 &lt;/span&gt;Common microsyntaxes&lt;/h3&gt;
-
   &lt;p&gt;There are various places in HTML that accept particular data types, such
    as dates or numbers. This section describes what the conformance criteria
    for content in those formats is, and how to parse them.&lt;/p&gt;
@@ -3620,7 +2921,7 @@
    attribute values are clearly defined either in terms of microsyntaxes or
    in terms of other specs, or as &quot;Text&quot; or some such.
 
-  &lt;h4 id=common1&gt;&lt;span class=secno&gt;2.5.1 &lt;/span&gt;Common parser idioms&lt;/h4&gt;
+  &lt;h4 id=common1&gt;&lt;span class=secno&gt;2.4.1 &lt;/span&gt;Common parser idioms&lt;/h4&gt;
 
   &lt;p&gt;The &lt;dfn id=space title=&quot;space character&quot;&gt;space characters&lt;/dfn&gt;, for
    the purposes of this specification, are U+0020 SPACE, U+0009 CHARACTER
@@ -3666,7 +2967,7 @@
    the Unicode character class Zs. In both cases, the collected characters
    are not used. &lt;a href=&quot;#refsUNICODE&quot;&gt;[UNICODE]&lt;/a&gt;
 
-  &lt;h4 id=boolean&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Boolean attributes&lt;/h4&gt;
+  &lt;h4 id=boolean&gt;&lt;span class=secno&gt;2.4.2 &lt;/span&gt;Boolean attributes&lt;/h4&gt;
 
   &lt;p&gt;A number of attributes in HTML5 are &lt;dfn id=boolean0 title=&quot;boolean
    attribute&quot;&gt;boolean attributes&lt;/dfn&gt;. The presence of a boolean attribute
@@ -3678,11 +2979,11 @@
    for the attribute's canonical name, with no leading or trailing
    whitespace.
 
-  &lt;h4 id=numbers&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Numbers&lt;/h4&gt;
+  &lt;h4 id=numbers&gt;&lt;span class=secno&gt;2.4.3 &lt;/span&gt;Numbers&lt;/h4&gt;
 
-  &lt;h5 id=unsigned&gt;&lt;span class=secno&gt;2.5.3.1. &lt;/span&gt;Unsigned integers&lt;/h5&gt;
+  &lt;h5 id=unsigned&gt;&lt;span class=secno&gt;2.4.3.1. &lt;/span&gt;Unsigned integers&lt;/h5&gt;
 
-  &lt;p&gt;A string is a &lt;dfn id=valid0&gt;valid non-negative integer&lt;/dfn&gt; if it
+  &lt;p&gt;A string is a &lt;dfn id=valid&gt;valid non-negative integer&lt;/dfn&gt; if it
    consists of one of more characters in the range U+0030 DIGIT ZERO (0) to
    U+0039 DIGIT NINE (9).
 
@@ -3741,9 +3042,9 @@
     &lt;p&gt;Return &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;h5 id=signed&gt;&lt;span class=secno&gt;2.5.3.2. &lt;/span&gt;Signed integers&lt;/h5&gt;
+  &lt;h5 id=signed&gt;&lt;span class=secno&gt;2.4.3.2. &lt;/span&gt;Signed integers&lt;/h5&gt;
 
-  &lt;p&gt;A string is a &lt;dfn id=valid1&gt;valid integer&lt;/dfn&gt; if it consists of one
+  &lt;p&gt;A string is a &lt;dfn id=valid0&gt;valid integer&lt;/dfn&gt; if it consists of one
    of more characters in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE
    (9), optionally prefixed with a U+002D HYPHEN-MINUS (&quot;-&quot;) character.
 
@@ -3819,9 +3120,9 @@
      title=&quot;&quot;&gt;value&lt;/var&gt;, otherwise return 0-&lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;h5 id=real-numbers&gt;&lt;span class=secno&gt;2.5.3.3. &lt;/span&gt;Real numbers&lt;/h5&gt;
+  &lt;h5 id=real-numbers&gt;&lt;span class=secno&gt;2.4.3.3. &lt;/span&gt;Real numbers&lt;/h5&gt;
 
-  &lt;p&gt;A string is a &lt;dfn id=valid2&gt;valid floating point number&lt;/dfn&gt; if it
+  &lt;p&gt;A string is a &lt;dfn id=valid1&gt;valid floating point number&lt;/dfn&gt; if it
    consists of one of more characters in the range U+0030 DIGIT ZERO (0) to
    U+0039 DIGIT NINE (9), optionally with a single U+002E FULL STOP (&quot;.&quot;)
    character somewhere (either before these numbers, in between two numbers,
@@ -3941,13 +3242,13 @@
      title=&quot;&quot;&gt;value&lt;/var&gt;, otherwise return 0-&lt;var title=&quot;&quot;&gt;value&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;h5 id=ratios&gt;&lt;span class=secno&gt;2.5.3.4. &lt;/span&gt;Ratios&lt;/h5&gt;
+  &lt;h5 id=ratios&gt;&lt;span class=secno&gt;2.4.3.4. &lt;/span&gt;Ratios&lt;/h5&gt;
 
   &lt;p class=note&gt;The algorithms described in this section are used by the
    &lt;code&gt;&lt;a href=&quot;#progress&quot;&gt;progress&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a
    href=&quot;#meter&quot;&gt;meter&lt;/a&gt;&lt;/code&gt; elements.
 
-  &lt;p&gt;A &lt;dfn id=valid3&gt;valid denominator punctuation character&lt;/dfn&gt; is one of
+  &lt;p&gt;A &lt;dfn id=valid2&gt;valid denominator punctuation character&lt;/dfn&gt; is one of
    the characters from the table below. There is &lt;dfn id=a-value
    title=&quot;values associated with denominator punctuation characters&quot;&gt;a value
    associated with each denominator punctuation character&lt;/dfn&gt;, as shown in
@@ -4025,7 +3326,7 @@
     href=&quot;#refsUNICODE&quot;&gt;[UNICODE]&lt;/a&gt;
 
    &lt;li&gt;If there are still further characters in the string, and the next
-    character in the string is a &lt;a href=&quot;#valid3&quot;&gt;valid denominator
+    character in the string is a &lt;a href=&quot;#valid2&quot;&gt;valid denominator
     punctuation character&lt;/a&gt;, set &lt;var title=&quot;&quot;&gt;denominator&lt;/var&gt; to that
     character.
 
@@ -4048,7 +3349,7 @@
     sub-algorithm in step 9.
 
    &lt;li&gt;If there are still further characters in the string, and the next
-    character in the string is a &lt;a href=&quot;#valid3&quot;&gt;valid denominator
+    character in the string is a &lt;a href=&quot;#valid2&quot;&gt;valid denominator
     punctuation character&lt;/a&gt;, return nothing and abort these steps.
 
    &lt;li&gt;If the string contains any other characters in the range U+0030 DIGIT
@@ -4083,24 +3384,24 @@
    &lt;li&gt;Parse &lt;var title=&quot;&quot;&gt;string&lt;/var&gt; according to the &lt;a
     href=&quot;#rules1&quot;&gt;rules for parsing floating point number values&lt;/a&gt;, to
     obtain &lt;var title=&quot;&quot;&gt;number&lt;/var&gt;. This step cannot fail (&lt;var
-    title=&quot;&quot;&gt;string&lt;/var&gt; is guaranteed to be a &lt;a href=&quot;#valid2&quot;&gt;valid
+    title=&quot;&quot;&gt;string&lt;/var&gt; is guaranteed to be a &lt;a href=&quot;#valid1&quot;&gt;valid
     floating point number&lt;/a&gt;).
 
    &lt;li&gt;Return &lt;var title=&quot;&quot;&gt;number&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;h5 id=percentages-and-dimensions&gt;&lt;span class=secno&gt;2.5.3.5.
+  &lt;h5 id=percentages-and-dimensions&gt;&lt;span class=secno&gt;2.4.3.5.
    &lt;/span&gt;Percentages and dimensions&lt;/h5&gt;
 
-  &lt;p class=big-issue&gt;&lt;dfn id=valid4&gt;valid positive non-zero integers&lt;/dfn&gt;
+  &lt;p class=big-issue&gt;&lt;dfn id=valid3&gt;valid positive non-zero integers&lt;/dfn&gt;
    &lt;dfn id=rules2&gt;rules for parsing dimension values&lt;/dfn&gt; (only used by
    height/width on img, embed, object &mdash; lengths in css pixels or
    percentages)
 
-  &lt;h5 id=lists&gt;&lt;span class=secno&gt;2.5.3.6. &lt;/span&gt;Lists of integers&lt;/h5&gt;
+  &lt;h5 id=lists&gt;&lt;span class=secno&gt;2.4.3.6. &lt;/span&gt;Lists of integers&lt;/h5&gt;
 
-  &lt;p&gt;A &lt;dfn id=valid5&gt;valid list of integers&lt;/dfn&gt; is a number of &lt;a
-   href=&quot;#valid1&quot; title=&quot;valid integer&quot;&gt;valid integers&lt;/a&gt; separated by
+  &lt;p&gt;A &lt;dfn id=valid4&gt;valid list of integers&lt;/dfn&gt; is a number of &lt;a
+   href=&quot;#valid0&quot; title=&quot;valid integer&quot;&gt;valid integers&lt;/a&gt; separated by
    U+002C COMMA characters, with no other characters (e.g. no &lt;a
    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;). In addition,
    there might be restrictions on the number of integers that can be given,
@@ -4378,7 +3679,7 @@
     &lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;numbers&lt;/var&gt; list and abort.
   &lt;/ol&gt;
 
-  &lt;h4 id=dates&gt;&lt;span class=secno&gt;2.5.4 &lt;/span&gt;Dates and times&lt;/h4&gt;
+  &lt;h4 id=dates&gt;&lt;span class=secno&gt;2.4.4 &lt;/span&gt;Dates and times&lt;/h4&gt;
 
   &lt;p&gt;In the algorithms below, the &lt;dfn id=number&gt;number of days in month &lt;var
    title=&quot;&quot;&gt;month&lt;/var&gt; of year &lt;var title=&quot;&quot;&gt;year&lt;/var&gt;&lt;/dfn&gt; is:
@@ -4389,9 +3690,9 @@
    4 but not by 100; and &lt;em&gt;28&lt;/em&gt; otherwise. This takes into account leap
    years in the Gregorian calendar. &lt;a href=&quot;#refsGREGORIAN&quot;&gt;[GREGORIAN]&lt;/a&gt;
 
-  &lt;h5 id=specific&gt;&lt;span class=secno&gt;2.5.4.1. &lt;/span&gt;Specific moments in time&lt;/h5&gt;
+  &lt;h5 id=specific&gt;&lt;span class=secno&gt;2.4.4.1. &lt;/span&gt;Specific moments in time&lt;/h5&gt;
 
-  &lt;p&gt;A string is a &lt;dfn id=valid6&gt;valid datetime&lt;/dfn&gt; if it has four digits
+  &lt;p&gt;A string is a &lt;dfn id=valid5&gt;valid datetime&lt;/dfn&gt; if it has four digits
    (representing the year), a literal hyphen, two digits (representing the
    month), a literal hyphen, two digits (representing the day), optionally
    some spaces, either a literal T or a space, optionally some more spaces,
@@ -4424,7 +3725,7 @@
    U+002B PLUS SIGN, and the minus U+002D (same as the hyphen).
 
   &lt;div class=example&gt;
-   &lt;p&gt;The following are some examples of dates written as &lt;a href=&quot;#valid6&quot;
+   &lt;p&gt;The following are some examples of dates written as &lt;a href=&quot;#valid5&quot;
     title=&quot;valid datetime&quot;&gt;valid datetimes&lt;/a&gt;.&lt;/p&gt;
 
    &lt;dl&gt;
@@ -4477,7 +3778,7 @@
    user agent must apply the following algorithm to the string. This will
    either return a time in UTC, with associated timezone information for
    round tripping or display purposes, or nothing, indicating the value is
-   not a &lt;a href=&quot;#valid6&quot;&gt;valid datetime&lt;/a&gt;. If at any point the algorithm
+   not a &lt;a href=&quot;#valid5&quot;&gt;valid datetime&lt;/a&gt;. If at any point the algorithm
    says that it &quot;fails&quot;, this means that it returns nothing.
 
   &lt;ol&gt;
@@ -4705,7 +4006,7 @@
     &lt;p&gt;Return &lt;var title=&quot;&quot;&gt;time&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;timezone&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;h5 id=vaguer&gt;&lt;span class=secno&gt;2.5.4.2. &lt;/span&gt;Vaguer moments in time&lt;/h5&gt;
+  &lt;h5 id=vaguer&gt;&lt;span class=secno&gt;2.4.4.2. &lt;/span&gt;Vaguer moments in time&lt;/h5&gt;
 
   &lt;p&gt;This section defines &lt;dfn id=date-or title=&quot;date or time string&quot;&gt;date or
    time strings&lt;/dfn&gt;. There are two kinds, &lt;dfn id=date-or0 title=&quot;date or
@@ -5087,14 +4388,14 @@
     &lt;p&gt;Abort these steps (the string is parsed).
   &lt;/ol&gt;
 
-  &lt;h4 id=time-offsets&gt;&lt;span class=secno&gt;2.5.5 &lt;/span&gt;Time offsets&lt;/h4&gt;
+  &lt;h4 id=time-offsets&gt;&lt;span class=secno&gt;2.4.5 &lt;/span&gt;Time offsets&lt;/h4&gt;
 
-  &lt;p class=big-issue&gt;&lt;dfn id=valid7&gt;valid time offset&lt;/dfn&gt;, &lt;dfn
+  &lt;p class=big-issue&gt;&lt;dfn id=valid6&gt;valid time offset&lt;/dfn&gt;, &lt;dfn
    id=rules4&gt;rules for parsing time offsets&lt;/dfn&gt;, &lt;dfn id=time-offset&gt;time
    offset serialization rules&lt;/dfn&gt;; in the format &quot;5d4h3m2s1ms&quot; or &quot;3m 9.2s&quot;
    or &quot;00:00:00.00&quot; or similar.
 
-  &lt;h4 id=tokens&gt;&lt;span class=secno&gt;2.5.6 &lt;/span&gt;Tokens&lt;/h4&gt;
+  &lt;h4 id=tokens&gt;&lt;span class=secno&gt;2.4.6 &lt;/span&gt;Tokens&lt;/h4&gt;
 
   &lt;p&gt;A &lt;dfn id=set-of&gt;set of space-separated tokens&lt;/dfn&gt; is a set of zero or
    more words separated by one or more &lt;a href=&quot;#space&quot; title=&quot;space
@@ -5238,7 +4539,7 @@
    to a single space, except at the start and end of the string, where such
    spaces are removed.
 
-  &lt;h4 id=keywords&gt;&lt;span class=secno&gt;2.5.7 &lt;/span&gt;Keywords and enumerated
+  &lt;h4 id=keywords&gt;&lt;span class=secno&gt;2.4.7 &lt;/span&gt;Keywords and enumerated
    attributes&lt;/h4&gt;
 
   &lt;p&gt;Some attributes are defined as taking one of a finite set of keywords.
@@ -5282,9 +4583,9 @@
    &lt;em&gt;missing value default&lt;/em&gt;), but for various reasons that isn't the
    way this specification actually defines it.
 
-  &lt;h4 id=syntax-references&gt;&lt;span class=secno&gt;2.5.8 &lt;/span&gt;References&lt;/h4&gt;
+  &lt;h4 id=syntax-references&gt;&lt;span class=secno&gt;2.4.8 &lt;/span&gt;References&lt;/h4&gt;
 
-  &lt;p&gt;A &lt;dfn id=valid8&gt;valid hash-name reference&lt;/dfn&gt; to an element of type
+  &lt;p&gt;A &lt;dfn id=valid7&gt;valid hash-name reference&lt;/dfn&gt; to an element of type
    &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is a string consisting of a U+0023 NUMBER SIGN
    (&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;) character followed by a string which exactly
    matches the value of the &lt;code title=&quot;&quot;&gt;name&lt;/code&gt; attribute of an
@@ -5320,606 +4621,707 @@
    --&gt;
   &lt;/ol&gt;
 
-  &lt;h3 id=common2&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Common DOM interfaces&lt;/h3&gt;
+  &lt;h3 id=urls&gt;&lt;span class=secno&gt;2.5 &lt;/span&gt;URLs&lt;/h3&gt;
 
-  &lt;h4 id=reflecting&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Reflecting content
-   attributes in DOM attributes&lt;/h4&gt;
+  &lt;p&gt;This specification defines the term &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt;, and defines
+   various algorithms for dealing with URLs, because for historical reasons
+   the rules defined by the URI and IRI specifications are not a complete
+   description of what HTML user agents need to implement to be compatible
+   with Web content.
 
-  &lt;p&gt;Some &lt;span title=&quot;DOM attribute&quot;&gt;DOM attributes&lt;/span&gt; are defined to
-   &lt;dfn id=reflect&gt;reflect&lt;/dfn&gt; a particular &lt;span&gt;content attribute&lt;/span&gt;.
-   This means that on getting, the DOM attribute returns the current value of
-   the content attribute, and on setting, the DOM attribute changes the value
-   of the content attribute to the given value.
+  &lt;h4 id=terminology0&gt;&lt;span class=secno&gt;2.5.1 &lt;/span&gt;Terminology&lt;/h4&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; attribute
-   whose content attribute is defined to contain a &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt;,
-   then on getting, the DOM attribute must &lt;a href=&quot;#resolve&quot; title=&quot;resolve
-   a url&quot;&gt;resolve&lt;/a&gt; the value of the content attribute and return the
-   resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; if that was successful, or
-   the empty string otherwise; and on setting, must set the content attribute
-   to the specified literal value. If the content attribute is absent, the
-   DOM attribute must return the default value, if the content attribute has
-   one, or else the empty string.
+  &lt;p&gt;A &lt;dfn id=url&gt;URL&lt;/dfn&gt; is a string used to identify a resource. &lt;span
+   id=urldoc&gt;A &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is always associated with a
+   &lt;code&gt;Document&lt;/code&gt;, either explicitly when the URL is created or
+   defined; or through a DOM node, in which case the associated
+   &lt;code&gt;Document&lt;/code&gt; is the node's &lt;code&gt;Document&lt;/code&gt;; or through a
+   script, in which case the associated &lt;code&gt;Document&lt;/code&gt; is the script's
+   &lt;a href=&quot;#script4&quot;&gt;script document context&lt;/a&gt;.&lt;/span&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; attribute
-   whose content attribute is defined to contain one or more &lt;a href=&quot;#url&quot;
-   title=URL&gt;URLs&lt;/a&gt;, then on getting, the DOM attribute must &lt;span
-   title=&quot;split the string on spaces&quot;&gt;split the content attribute on
-   spaces&lt;/span&gt; and return the concatenation of &lt;a href=&quot;#resolve&quot;
-   title=&quot;resolve a URL&quot;&gt;resolving&lt;/a&gt; each token URL to an &lt;a
-   href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt;, with a single U+0020 SPACE character
-   between each URL, ignoring any tokens that did not resolve successfully.
-   If the content attribute is absent, the DOM attribute must return the
-   default value, if the content attribute has one, or else the empty string.
-   On setting, the DOM attribute must set the content attribute to the
-   specified literal value.
+  &lt;p&gt;A &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a &lt;dfn id=valid8&gt;valid URL&lt;/dfn&gt; if at least
+   one of the following conditions holds:
 
-  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; whose content
-   attribute is an &lt;a href=&quot;#enumerated&quot;&gt;enumerated attribute&lt;/a&gt;, and the
-   DOM attribute is &lt;dfn id=limited&gt;limited to only known values&lt;/dfn&gt;, then,
-   on getting, the DOM attribute must return the conforming value associated
-   with the state the attribute is in (in its canonical case), or the empty
-   string if the attribute is in a state that has no associated keyword
-   value; and on setting, if the new value is an &lt;a href=&quot;#ascii&quot;&gt;ASCII
-   case-insensitive&lt;/a&gt; match for one of the keywords given for that
-   attribute, then the content attribute must be set to the conforming value
-   associated with the state that the attribute would be in if set to the
-   given new value, otherwise, if the new value is the empty string, then the
-   content attribute must be removed, otherwise, the setter must raise a
-   &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception.
+  &lt;ul&gt;
+   &lt;li&gt;
+    &lt;p&gt;The &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a valid URI reference &lt;a
+     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;.
 
-  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; but doesn't
-   fall into any of the above categories, then the getting and setting must
-   be done in a transparent, case-preserving manner.
+   &lt;li&gt;
+    &lt;p&gt;The &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a valid IRI reference and it has no
+     query component. &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a boolean attribute, then on getting
-   the DOM attribute must return true if the attribute is set, and false if
-   it is absent. On setting, the content attribute must be removed if the DOM
-   attribute is set to false, and must be set to have the same value as its
-   name if the DOM attribute is set to true. (This corresponds to the rules
-   for &lt;a href=&quot;#boolean0&quot; title=&quot;boolean attribute&quot;&gt;boolean content
-   attributes&lt;/a&gt;.)
+   &lt;li&gt;
+    &lt;p&gt;The &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a valid IRI reference and its query
+     component contains no unescaped non-ASCII characters. &lt;a
+     href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a signed integer type
-   (&lt;code&gt;long&lt;/code&gt;) then, on getting, the content attribute must be parsed
-   according to &lt;a href=&quot;#rules0&quot; title=&quot;rules for parsing integers&quot;&gt;the
-   rules for parsing signed integers&lt;/a&gt;, and if that is successful, the
-   resulting value must be returned. If, on the other hand, it fails, or if
-   the attribute is absent, then the default value must be returned instead,
-   or 0 if there is no default value. On setting, the given value must be
-   converted to the shortest possible string representing the number as a &lt;a
-   href=&quot;#valid1&quot;&gt;valid integer&lt;/a&gt; in base ten and then that string must be
-   used as the new content attribute value.
+   &lt;li&gt;
+    &lt;p&gt;The &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is a valid IRI reference and the &lt;a
+     href=&quot;#character3&quot; title=&quot;document's character encoding&quot;&gt;character
+     encoding&lt;/a&gt; of the URL's &lt;code&gt;Document&lt;/code&gt; is UTF-8 or UTF-16. &lt;a
+     href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
+  &lt;/ul&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is an &lt;em&gt;unsigned&lt;/em&gt; integer type
-   (&lt;code&gt;unsigned long&lt;/code&gt;) then, on getting, the content attribute must
-   be parsed according to &lt;a href=&quot;#rules&quot; title=&quot;rules for parsing
-   non-negative integers&quot;&gt;the rules for parsing unsigned integers&lt;/a&gt;, and if
-   that is successful, the resulting value must be returned. If, on the other
-   hand, it fails, or if the attribute is absent, the default value must be
-   returned instead, or 0 if there is no default value. On setting, the given
-   value must be converted to the shortest possible string representing the
-   number as a &lt;a href=&quot;#valid0&quot;&gt;valid non-negative integer&lt;/a&gt; in base ten
-   and then that string must be used as the new content attribute value.
+  &lt;p class=note&gt;The term &quot;URL&quot; in this specification is used in a manner
+   distinct from the precise technical meaning it is given in RFC 3986.
+   Readers familiar with that RFC will find it easier to read &lt;em&gt;this&lt;/em&gt;
+   specification if they pretend the term &quot;URL&quot; as used herein is really
+   called something else altogether.
 
-  &lt;p&gt;If a reflecting DOM attribute is an unsigned integer type
-   (&lt;code&gt;unsigned long&lt;/code&gt;) that is &lt;dfn id=limited0&gt;limited to only
-   positive non-zero numbers&lt;/dfn&gt;, then the behavior is similar to the
-   previous case, but zero is not allowed. On getting, the content attribute
-   must first be parsed according to &lt;a href=&quot;#rules&quot; title=&quot;rules for
-   parsing non-negative integers&quot;&gt;the rules for parsing unsigned
-   integers&lt;/a&gt;, and if that is successful, the resulting value must be
-   returned. If, on the other hand, it fails, or if the attribute is absent,
-   the default value must be returned instead, or 1 if there is no default
-   value. On setting, if the value is zero, the user agent must fire an
-   &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception. Otherwise, the given value must be
-   converted to the shortest possible string representing the number as a &lt;a
-   href=&quot;#valid0&quot;&gt;valid non-negative integer&lt;/a&gt; in base ten and then that
-   string must be used as the new content attribute value.
+  &lt;h4 id=parsing0&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Parsing URLs&lt;/h4&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a floating point number type
-   (&lt;code&gt;float&lt;/code&gt;) and the content attribute is defined to contain a
-   time offset, then, on getting, the content attribute must be parsed
-   according to &lt;a href=&quot;#rules4&quot; title=&quot;rules for parsing time offsets&quot;&gt;the
-   rules for parsing time offsets&lt;/a&gt;, and if that is successful, the
-   resulting value, in seconds, must be returned. If that fails, or if the
-   attribute is absent, the default value must be returned, or the
-   not-a-number value (NaN) if there is no default value. On setting, the
-   given value, interpreted as a time offset in seconds, must be converted to
-   a string using the &lt;a href=&quot;#time-offset&quot;&gt;time offset serialization
-   rules&lt;/a&gt;, and that string must be used as the new content attribute
-   value.
+  &lt;p&gt;To &lt;dfn id=parse0&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
+   component parts, the user agent must use the following steps:
 
-  &lt;p&gt;If a reflecting DOM attribute is a floating point number type
-   (&lt;code&gt;float&lt;/code&gt;) and it doesn't fall into one of the earlier
-   categories, then, on getting, the content attribute must be parsed
-   according to &lt;a href=&quot;#rules1&quot; title=&quot;rules for parsing floating point
-   number values&quot;&gt;the rules for parsing floating point number values&lt;/a&gt;, and
-   if that is successful, the resulting value must be returned. If, on the
-   other hand, it fails, or if the attribute is absent, the default value
-   must be returned instead, or 0.0 if there is no default value. On setting,
-   the given value must be converted to the shortest possible string
-   representing the number as a &lt;a href=&quot;#valid2&quot;&gt;valid floating point
-   number&lt;/a&gt; in base ten and then that string must be used as the new
-   content attribute value.
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;Strip leading and trailing &lt;a href=&quot;#space&quot; title=&quot;space
+     character&quot;&gt;space characters&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.
 
-  &lt;p&gt;If a reflecting DOM attribute is of the type &lt;code&gt;&lt;a
-   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt;, then on getting it must
-   return a &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object
-   whose underlying string is the element's corresponding content attribute.
-   When the &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object
-   mutates its underlying string, the content attribute must itself be
-   immediately mutated. When the attribute is absent, then the string
-   represented by the &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt;
-   object is the empty string; when the object mutates this empty string, the
-   user agent must first add the corresponding content attribute, and then
-   mutate that attribute instead. &lt;code&gt;&lt;a
-   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; attributes are always
-   read-only. The same &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt;
-   object must be returned every time for each attribute.
+   &lt;li&gt;
+    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC 3986, with
+     the following exceptions:&lt;/p&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute has the type &lt;code&gt;&lt;a
-   href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;, or an interface that descends
-   from &lt;code&gt;&lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;, then, on
-   getting, it must run the following algorithm (stopping at the first point
-   where a value is returned):
+    &lt;ul&gt;
+     &lt;li&gt;Add all characters with codepoints less than or equal to U+0020 or
+      greater than or equal to U+007F to the &lt;unreserved&gt; production.
 
-  &lt;ol&gt;
-   &lt;li&gt;If the corresponding content attribute is absent, then the DOM
-    attribute must return null.
+     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E, U+0060,
+      and U+007B .. U+007D to the &lt;unreserved&gt; production. &lt;!--
+       0022 QUOTATION MARK
+       003C LESS-THAN SIGN
+       003E GREATER-THAN SIGN
+       005B LEFT SQUARE BRACKET
+       005C REVERSE SOLIDUS
+       005D RIGHT SQUARE BRACKET
+       005E CIRCUMFLEX ACCENT
+       0060 GRAVE ACCENT
+       007B LEFT CURLY BRACKET
+       007C VERTICAL LINE
+       007D RIGHT CURLY BRACKET
+      --&gt;
+      
 
-   &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; be the element that the &lt;code
-    title=&quot;&quot;&gt;document.getElementById()&lt;/code&gt; method would find if it was
-    passed as its argument the current value of the corresponding content
-    attribute.
+     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second alternative
+      way of matching the &lt;pct-encoded&gt; production, except when the
+      &lt;pct-encoded&gt; is used in the &lt;reg-name&gt; production.
 
-   &lt;li&gt;If &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; is null, or if it is not
-    type-compatible with the DOM attribute, then the DOM attribute must
-    return null.
+     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters allowed in
+      the &lt;fragment&gt; production.&lt;/li&gt;
+     &lt;!-- some browsers also have other differences, e.g. Mozilla
+     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
+     is &quot;ftp&quot;. --&gt;
+    &lt;/ul&gt;
 
-   &lt;li&gt;Otherwise, it must return &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;.
-  &lt;/ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the &lt;URI-reference&gt;
+     production, even after the above changes are made to the ABNF
+     definitions, then parsing the URL fails with an error. &lt;a
+     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;On setting, if the given element has an &lt;code title=attr-id&gt;&lt;a
-   href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute, then the content attribute must be set
-   to the value of that &lt;code title=attr-id&gt;&lt;a href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt;
-   attribute. Otherwise, the DOM attribute must be set to the empty string.&lt;/p&gt;
-  &lt;!-- XXX or raise an exception? --&gt;
+    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
+     components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; defined
+     as follows:&lt;/p&gt;
 
-  &lt;h4 id=collections&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Collections&lt;/h4&gt;
+    &lt;dl&gt;
+     &lt;dt&gt;&lt;dfn id=ltschemegt title=url-scheme&gt;&lt;scheme&gt;&lt;/dfn&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#htmlcollection0&quot;&gt;HTMLCollection&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
-   href=&quot;#htmlformcontrolscollection0&quot;&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/code&gt;,
-   and &lt;code&gt;&lt;a
-   href=&quot;#htmloptionscollection0&quot;&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; interfaces
-   represent various lists of DOM nodes. Collectively, objects implementing
-   these interfaces are called &lt;dfn id=collections0&gt;collections&lt;/dfn&gt;.
+     &lt;dd&gt;
+      &lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.
 
-  &lt;p&gt;When a &lt;a href=&quot;#collections0&quot; title=collections&gt;collection&lt;/a&gt; is
-   created, a filter and a root are associated with the collection.
+     &lt;dt&gt;&lt;dfn id=lthostgt title=url-host&gt;&lt;host&gt;&lt;/dfn&gt;
 
-  &lt;p class=example&gt;For example, when the &lt;code&gt;&lt;a
-   href=&quot;#htmlcollection0&quot;&gt;HTMLCollection&lt;/a&gt;&lt;/code&gt; object for the &lt;code
-   title=dom-document-images&gt;&lt;a href=&quot;#images0&quot;&gt;document.images&lt;/a&gt;&lt;/code&gt;
-   attribute is created, it is associated with a filter that selects only
-   &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt; elements, and rooted at the root of
-   the document.
+     &lt;dd&gt;
+      &lt;p&gt;The substring matched by the &lt;host&gt; production, if any.
 
-  &lt;p&gt;The &lt;a href=&quot;#collections0&quot; title=collections&gt;collection&lt;/a&gt; then &lt;dfn
-   id=represents title=&quot;represented by the collection&quot;&gt;represents&lt;/dfn&gt; a &lt;a
-   href=&quot;#live&quot;&gt;live&lt;/a&gt; view of the subtree rooted at the collection's root,
-   containing only nodes that match the given filter. The view is linear. In
-   the absence of specific requirements to the contrary, the nodes within the
-   collection must be sorted in &lt;a href=&quot;#tree-order&quot;&gt;tree order&lt;/a&gt;.
+     &lt;dt&gt;&lt;dfn id=ltportgt title=url-port&gt;&lt;port&gt;&lt;/dfn&gt;
 
-  &lt;p class=note&gt;The &lt;code title=dom-table-rows&gt;&lt;a
-   href=&quot;#rows&quot;&gt;rows&lt;/a&gt;&lt;/code&gt; list is not in tree order.
+     &lt;dd&gt;
+      &lt;p&gt;The substring matched by the &lt;port&gt; production, if any.
 
-  &lt;p&gt;An attribute that returns a collection must return the same object every
-   time it is retrieved.
+     &lt;dt&gt;&lt;dfn id=lthostportgt title=url-hostport&gt;&lt;hostport&gt;&lt;/dfn&gt;
 
-  &lt;h5 id=htmlcollection&gt;&lt;span class=secno&gt;2.6.2.1. &lt;/span&gt;HTMLCollection&lt;/h5&gt;
+     &lt;dd&gt;
+      &lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt; component
+       and the port given by the &lt;port&gt; component is different than the
+       default port defined for the protocol given by the &lt;scheme&gt;
+       component, then &lt;hostport&gt; is the substring that starts with the
+       substring matched by the &lt;host&gt; production and ends with the
+       substring matched by the &lt;port&gt; production, and includes the
+       colon in between the two. Otherwise, it is the same as the
+       &lt;host&gt; component.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#htmlcollection0&quot;&gt;HTMLCollection&lt;/a&gt;&lt;/code&gt; interface
-   represents a generic &lt;a href=&quot;#collections0&quot;
-   title=collections&gt;collection&lt;/a&gt; of elements.
+     &lt;dt&gt;&lt;dfn id=ltpathgt title=url-path&gt;&lt;path&gt;&lt;/dfn&gt;
 
-  &lt;pre class=idl&gt;interface &lt;dfn id=htmlcollection0&gt;HTMLCollection&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;a href=&quot;#length&quot; title=dom-HTMLCollection-length&gt;length&lt;/a&gt;;
-  [IndexGetter] Element &lt;a href=&quot;#itemindex&quot; title=dom-HTMLCollection-item&gt;item&lt;/a&gt;(in unsigned long index);
-  [NameGetter] Element &lt;a href=&quot;#nameditem&quot; title=dom-HTMLCollection-namedItem&gt;namedItem&lt;/a&gt;(in DOMString name);
-};&lt;/pre&gt;
+     &lt;dd&gt;
+      &lt;p&gt;The substring matched by one of the following productions, if one of
+       them was matched:&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=length
-   title=dom-HTMLCollection-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt; attribute must
-   return the number of nodes &lt;a href=&quot;#represents&quot;&gt;represented by the
-   collection&lt;/a&gt;.
+      &lt;ul class=brief&gt;
+       &lt;li&gt;&lt;path-abempty&gt;
 
-  &lt;p&gt;The &lt;dfn id=itemindex title=dom-HTMLCollection-item&gt;&lt;code&gt;item(&lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must return
-   null.
+       &lt;li&gt;&lt;path-absolute&gt;
 
-  &lt;p&gt;The &lt;dfn id=nameditem
-   title=dom-HTMLCollection-namedItem&gt;&lt;code&gt;namedItem(&lt;var
-   title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the first node in the
-   collection that matches the following requirements:
+       &lt;li&gt;&lt;path-noscheme&gt;
 
-  &lt;ul&gt;
-   &lt;li&gt;It is an &lt;code&gt;&lt;a href=&quot;#a&quot;&gt;a&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
-    href=&quot;#applet&quot;&gt;applet&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#area&quot;&gt;area&lt;/a&gt;&lt;/code&gt;,
-    &lt;code&gt;form&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a
-    href=&quot;#object&quot;&gt;object&lt;/a&gt;&lt;/code&gt; element with a &lt;code
-    title=attr-name&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;,
-    or,
+       &lt;li&gt;&lt;path-rootless&gt;
 
-   &lt;li&gt;It is an &lt;a href=&quot;#html-elements&quot; title=&quot;HTML elements&quot;&gt;HTML
-    element&lt;/a&gt; of any kind with an &lt;code title=attr-id&gt;&lt;a
-    href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;.
-    (Non-HTML elements, even if they have IDs, are not searched for the
-    purposes of &lt;code title=dom-HTMLCollection-namedItem&gt;&lt;a
-    href=&quot;#nameditem&quot;&gt;namedItem()&lt;/a&gt;&lt;/code&gt;.)
-  &lt;/ul&gt;
+       &lt;li&gt;&lt;path-empty&gt;
+      &lt;/ul&gt;
 
-  &lt;p&gt;If no such elements are found, then the method must return null.
+     &lt;dt&gt;&lt;dfn id=ltquerygt title=url-query&gt;&lt;query&gt;&lt;/dfn&gt;
 
-  &lt;h5 id=htmlformcontrolscollection&gt;&lt;span class=secno&gt;2.6.2.2.
-   &lt;/span&gt;HTMLFormControlsCollection&lt;/h5&gt;
+     &lt;dd&gt;
+      &lt;p&gt;The substring matched by the &lt;query&gt; production, if any.
 
-  &lt;p&gt;The &lt;code&gt;&lt;a
-   href=&quot;#htmlformcontrolscollection0&quot;&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/code&gt;
-   interface represents a &lt;a href=&quot;#collections0&quot;
-   title=collections&gt;collection&lt;/a&gt; of form controls.
+     &lt;dt&gt;&lt;dfn id=ltfragmentgt title=url-fragment&gt;&lt;fragment&gt;&lt;/dfn&gt;
 
-  &lt;pre
-   class=idl&gt;interface &lt;dfn id=htmlformcontrolscollection0&gt;HTMLFormControlsCollection&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;a href=&quot;#length0&quot; title=dom-HTMLFormControlsCollection-length&gt;length&lt;/a&gt;;
-  [IndexGetter] &lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt; &lt;a href=&quot;#itemindex0&quot; title=dom-HTMLFormControlsCollection-item&gt;item&lt;/a&gt;(in unsigned long index);
-  [NameGetter] Object &lt;a href=&quot;#nameditem0&quot; title=dom-HTMLFormControlsCollection-namedItem&gt;namedItem&lt;/a&gt;(in DOMString name);
-};&lt;/pre&gt;
+     &lt;dd&gt;
+      &lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.
+    &lt;/dl&gt;
+  &lt;/ol&gt;
+  &lt;!-- XXX we might want to define &quot;server-based naming authority&quot;,
+  it's not clear RFC3986 does a good job of defining that anymore
+  (earlier URI specs did) --&gt;
 
-  &lt;p&gt;The &lt;dfn id=length0
-   title=dom-HTMLFormControlsCollection-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
-   attribute must return the number of nodes &lt;a
-   href=&quot;#represents&quot;&gt;represented by the collection&lt;/a&gt;.
+  &lt;h4 id=resolving&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
 
-  &lt;p&gt;The &lt;dfn id=itemindex0
-   title=dom-HTMLFormControlsCollection-item&gt;&lt;code&gt;item(&lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must return
-   null.
+  &lt;p&gt;Relative URLs are resolved relative to a base URL. The &lt;dfn
+   id=base-&gt;base URL&lt;/dfn&gt; of a &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is the &lt;a
+   href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; obtained as follows:
 
-  &lt;p&gt;The &lt;dfn id=nameditem0
-   title=dom-HTMLFormControlsCollection-namedItem&gt;&lt;code&gt;namedItem(&lt;var
-   title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must act according to the
-   following algorithm:
+  &lt;dl class=switch&gt;
+   &lt;dt&gt;If the URL to be resolved was passed to an API
 
+   &lt;dd&gt;
+    &lt;p&gt;The base URL is the &lt;a href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; of the
+     script's &lt;a href=&quot;#script4&quot;&gt;script document context&lt;/a&gt;.
+
+   &lt;dt&gt;If the URL to be resolved is from the value of a content attribute
+
+   &lt;dd&gt;
+    &lt;p&gt;The base URL is the &lt;i&gt;base URI of the element&lt;/i&gt; that the attribute
+     is on, as defined by the XML Base specification, with &lt;i&gt;the base URI of
+     the document entity&lt;/i&gt; being defined as the &lt;a
+     href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; of the &lt;code&gt;Document&lt;/code&gt;
+     that owns the element.&lt;/p&gt;
+
+    &lt;p&gt;For the purposes of the XML Base specification, user agents must act
+     as if all &lt;code&gt;Document&lt;/code&gt; objects represented XML documents.&lt;/p&gt;
+
+    &lt;p class=note&gt;It is possible for &lt;code title=attr-xml-base&gt;&lt;a
+     href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes to be present even in
+     HTML fragments, as such attributes can be added dynamically using
+     script. (Such scripts would not be conforming, however, as &lt;code
+     title=attr-xml-base&gt;&lt;a href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes
+     are not allowed in &lt;a href=&quot;#html-&quot;&gt;HTML documents&lt;/a&gt;.)&lt;/p&gt;
+
+   &lt;dt&gt;If the URL to be resolved was found in an offline application cache
+    manifest
+
+   &lt;dd&gt;
+    &lt;p&gt;The base URL is the URL of the &lt;a href=&quot;#application0&quot;&gt;application
+     cache&lt;/a&gt; &lt;a href=&quot;#the-manifest&quot;
+     title=concept-appcache-manifest&gt;manifest&lt;/a&gt;.
+  &lt;/dl&gt;
+
+  &lt;p&gt;The &lt;dfn id=document0&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt;
+   is the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; obtained by running these
+   steps:
+
   &lt;ol&gt;
-   &lt;li&gt;If, at the time the method is called, there is exactly one node in the
-    collection that has either an &lt;code title=attr-id&gt;&lt;a
-    href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code title=attr-name&gt;name&lt;/code&gt;
-    attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;, then return that node and
-    stop the algorithm.
+   &lt;li&gt;
+    &lt;p&gt;If there is no &lt;code&gt;&lt;a href=&quot;#base&quot;&gt;base&lt;/a&gt;&lt;/code&gt; element that is
+     both a child of &lt;a href=&quot;#the-head0&quot;&gt;the &lt;code&gt;head&lt;/code&gt; element&lt;/a&gt;
+     and has an &lt;code title=attr-base-href&gt;&lt;a href=&quot;#href&quot;&gt;href&lt;/a&gt;&lt;/code&gt;
+     attribute, then the &lt;a href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; is
+     &lt;span&gt;the document's address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;.
 
-   &lt;li&gt;Otherwise, if there are no nodes in the collection that have either an
-    &lt;code title=attr-id&gt;&lt;a href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code
-    title=attr-name&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;,
-    then return null and stop the algorithm.
+   &lt;li&gt;
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the &lt;code
+     title=attr-base-href&gt;&lt;a href=&quot;#href&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute of the
+     first such element.
 
-   &lt;li&gt;Otherwise, create a &lt;code&gt;NodeList&lt;/code&gt; object representing a live
-    view of the &lt;code&gt;&lt;a
-    href=&quot;#htmlformcontrolscollection0&quot;&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/code&gt;
-    object, further filtered so that the only nodes in the
-    &lt;code&gt;NodeList&lt;/code&gt; object are those that have either an &lt;code
-    title=attr-id&gt;&lt;a href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code
-    title=attr-name&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;.
-    The nodes in the &lt;code&gt;NodeList&lt;/code&gt; object must be sorted in &lt;a
-    href=&quot;#tree-order&quot;&gt;tree order&lt;/a&gt;.
+   &lt;li&gt;
+    &lt;p&gt;&lt;a href=&quot;#resolve&quot; title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; the &lt;var
+     title=&quot;&quot;&gt;url&lt;/var&gt; URL, using &lt;span&gt;the document's
+     address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt; as the &lt;a href=&quot;#base-&quot;&gt;base URL&lt;/a&gt;
+     (thus, the &lt;code&gt;&lt;a href=&quot;#base&quot;&gt;base&lt;/a&gt;&lt;/code&gt; &lt;code
+     title=attr-base-href&gt;&lt;a href=&quot;#href&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute isn't
+     affect by &lt;code title=attr-xml-base&gt;&lt;a
+     href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes).
 
-   &lt;li&gt;Return that &lt;code&gt;NodeList&lt;/code&gt; object.
+   &lt;li&gt;
+    &lt;p&gt;The &lt;a href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; is the result of the
+     previous step if it was successful; otherwise it is &lt;span&gt;the document's
+     address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;.
   &lt;/ol&gt;
-  &lt;!--
-<A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C%21DOCTYPE%20html%3E...%0A%3Cform%20name%3D%22a%22%3E%3Cinput%20id%3D%22x%22%20name%3D%22y%22%3E%3Cinput%20name%3D%22x%22%20id%3D%22y%22%3E%3C/form%3E%0A%3Cscript%3E%0A%20%20var%20x%3B%0A%20%20w%28x%20%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20x%5B0%5D.parentNode.removeChild%28x%5B0%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20w%28x%20%3D%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%3C/script%3E%0A">http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C%21DOCTYPE%20html%3E...%0A%3Cform%20name%3D%22a%22%3E%3Cinput%20id%3D%22x%22%20name%3D%22y%22%3E%3Cinput%20name%3D%22x%22%20id%3D%22y%22%3E%3C/form%3E%0A%3Cscript%3E%0A%20%20var%20x%3B%0A%20%20w%28x%20%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20x%5B0%5D.parentNode.removeChild%28x%5B0%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20w%28x%20%3D%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%3C/script%3E%0A</A>
---&gt;
 
-  &lt;h5 id=htmloptionscollection&gt;&lt;span class=secno&gt;2.6.2.3.
-   &lt;/span&gt;HTMLOptionsCollection&lt;/h5&gt;
+  &lt;p&gt;To &lt;dfn id=resolve&gt;resolve a URL&lt;/dfn&gt; to an &lt;a
+   href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; the user agent must use the following
+   steps. Resolving a URL can result in an error, in which case the URL is
+   not resolvable.
 
-  &lt;p&gt;The &lt;code&gt;&lt;a
-   href=&quot;#htmloptionscollection0&quot;&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; interface
-   represents a list of &lt;code&gt;option&lt;/code&gt; elements.
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; being
+     resolved.
 
-  &lt;pre
-   class=idl&gt;interface &lt;dfn id=htmloptionscollection0&gt;HTMLOptionsCollection&lt;/dfn&gt; {
-           attribute unsigned long &lt;a href=&quot;#length1&quot; title=dom-HTMLOptionsCollection-length&gt;length&lt;/a&gt;;
-  [IndexGetter] HTMLOptionElement &lt;a href=&quot;#itemindex1&quot; title=dom-HTMLOptionsCollection-item&gt;item&lt;/a&gt;(in unsigned long index);
-  [NameGetter] Object &lt;a href=&quot;#nameditem1&quot; title=dom-HTMLOptionsCollection-namedItem&gt;namedItem&lt;/a&gt;(in DOMString name);
-};&lt;/pre&gt;
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the &lt;code&gt;Document&lt;/code&gt; &lt;a
+     href=&quot;#urldoc&quot;&gt;associated with&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.
 
-  &lt;p&gt;On getting, the &lt;dfn id=length1
-   title=dom-HTMLOptionsCollection-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt; attribute
-   must return the number of nodes &lt;a href=&quot;#represents&quot;&gt;represented by the
-   collection&lt;/a&gt;.
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be the &lt;a href=&quot;#character3&quot;
+     title=&quot;document's character encoding&quot;&gt;character encoding&lt;/a&gt; of &lt;var
+     title=&quot;&quot;&gt;document&lt;/var&gt;.
 
-  &lt;p&gt;On setting, the behavior depends on whether the new value is equal to,
-   greater than, or less than the number of nodes &lt;a
-   href=&quot;#represents&quot;&gt;represented by the collection&lt;/a&gt; at that time. If the
-   number is the same, then setting the attribute must do nothing. If the new
-   value is greater, then &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; new &lt;code&gt;option&lt;/code&gt;
-   elements with no attributes and no child nodes must be appended to the
-   &lt;code&gt;select&lt;/code&gt; element on which the &lt;code&gt;&lt;a
-   href=&quot;#htmloptionscollection0&quot;&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; is rooted,
-   where &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is the difference between the two numbers (new
-   value minus old value). If the new value is lower, then the last &lt;var
-   title=&quot;&quot;&gt;n&lt;/var&gt; nodes in the collection must be removed from their parent
-   nodes, where &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is the difference between the two
-   numbers (old value minus new value).
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is UTF-16, then change it to UTF-8.
 
-  &lt;p class=note&gt;Setting &lt;code title=dom-HTMLOptionsCollection-length&gt;&lt;a
-   href=&quot;#length1&quot;&gt;length&lt;/a&gt;&lt;/code&gt; never removes or adds any
-   &lt;code&gt;optgroup&lt;/code&gt; elements, and never adds new children to existing
-   &lt;code&gt;optgroup&lt;/code&gt; elements (though it can remove children from them).
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;a href=&quot;#base-&quot;&gt;base URL&lt;/a&gt; for
+     &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. (This is an &lt;a href=&quot;#absolute&quot;&gt;absolute
+     URL&lt;/a&gt;.)
 
-  &lt;p&gt;The &lt;dfn id=itemindex1
-   title=dom-HTMLOptionsCollection-item&gt;&lt;code&gt;item(&lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must return
-   null.
+   &lt;li&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot; title=&quot;parse a URL&quot;&gt;Parse&lt;/a&gt; &lt;var
+     title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.
 
-  &lt;p&gt;The &lt;dfn id=nameditem1
-   title=dom-HTMLOptionsCollection-namedItem&gt;&lt;code&gt;namedItem(&lt;var
-   title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must act according to the
-   following algorithm:
+   &lt;li&gt;
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=&quot;#lthostgt&quot;
+     title=url-host&gt;&lt;host&gt;&lt;/a&gt; component, then replace the matching
+     subtring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that results from
+     expanding any sequences of percent-encoded octets in that component that
+     are valid UTF-8 sequences into Unicode characters as defined by UTF-8.&lt;/p&gt;
 
-  &lt;ol&gt;
-   &lt;li&gt;If, at the time the method is called, there is exactly one node in the
-    collection that has either an &lt;code title=attr-id&gt;&lt;a
-    href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code title=attr-name&gt;name&lt;/code&gt;
-    attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;, then return that node and
-    stop the algorithm.
+    &lt;p&gt;If any percent-encoded octets in that component are not valid UTF-8
+     sequences, then return an error and abort these steps.&lt;/p&gt;
 
-   &lt;li&gt;Otherwise, if there are no nodes in the collection that have either an
-    &lt;code title=attr-id&gt;&lt;a href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code
-    title=attr-name&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;,
-    then return null and stop the algorithm.
+    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring, with both
+     the AllowUnassigned and UseSTD3ASCIIRules flags set. Replace the
+     matching substring with the result of the ToASCII algorithm.&lt;/p&gt;
 
-   &lt;li&gt;Otherwise, create a &lt;code&gt;NodeList&lt;/code&gt; object representing a live
-    view of the &lt;code&gt;&lt;a
-    href=&quot;#htmloptionscollection0&quot;&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; object,
-    further filtered so that the only nodes in the &lt;code&gt;NodeList&lt;/code&gt;
-    object are those that have either an &lt;code title=attr-id&gt;&lt;a
-    href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code
-    title=attr-option-name&gt;name&lt;/code&gt; attribute equal to &lt;var
-    title=&quot;&quot;&gt;key&lt;/var&gt;. The nodes in the &lt;code&gt;NodeList&lt;/code&gt; object must be
-    sorted in &lt;a href=&quot;#tree-order&quot;&gt;tree order&lt;/a&gt;.
+    &lt;p&gt;If ToASCII fails to convert one of the components of the string, e.g.
+     because it is too long or because it contains invalid characters, then
+     return an error and abort these steps. &lt;a
+     href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;Return that &lt;code&gt;NodeList&lt;/code&gt; object.
-  &lt;/ol&gt;
-  &lt;!-- see also <A HREF="http://ln.hixie.ch/?start=1161042744&amp;count=1">http://ln.hixie.ch/?start=1161042744&amp;count=1</A> --&gt;
+   &lt;li&gt;
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=&quot;#ltpathgt&quot;
+     title=url-path&gt;&lt;path&gt;&lt;/a&gt; component, then replace the matching
+     substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that results from
+     applying the following steps to each character other than U+0025 PERCENT
+     SIGN (%) that doesn't match the original &lt;path&gt; production defined
+     in RFC 3986:&lt;/p&gt;
 
-  &lt;p class=big-issue&gt;We may want to add &lt;code&gt;add()&lt;/code&gt; and
-   &lt;code&gt;remove()&lt;/code&gt; methods here too because IE implements
-   HTMLSelectElement and HTMLOptionsCollection on the same object, and so
-   people use them almost interchangeably in the wild.
+    &lt;ol&gt;
+     &lt;li&gt;Encode the character into a sequence of octets as defined by UTF-8.
 
-  &lt;h4 id=domtokenlist&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;DOMTokenList&lt;/h4&gt;
+     &lt;li&gt;Replace the character with the percent-encoded form of those octets.
+      &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
+    &lt;/ol&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; interface
-   represents an interface to an underlying string that consists of an &lt;a
-   href=&quot;#unordered&quot;&gt;unordered set of unique space-separated tokens&lt;/a&gt;.
+    &lt;div class=example&gt;
+     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code
+      title=&quot;&quot;&gt;//example.com/a^b&amp;#x263a;c%FFd%z/?e&lt;/code&gt;&quot;, then the &lt;a
+      href=&quot;#ltpathgt&quot; title=url-path&gt;&lt;path&gt;&lt;/a&gt; component's substring
+      would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&amp;#x263a;c%FFd%z/&lt;/code&gt;&quot; and the two
+      characters that would have to be escaped would be &quot;&lt;code
+      title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&amp;#x263a;&lt;/code&gt;&quot;. The result
+      after this step was applied would therefore be that &lt;var
+      title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code
+      title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
+    &lt;/div&gt;
 
-  &lt;p&gt;Which string underlies a particular &lt;code&gt;&lt;a
-   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object is defined when the
-   object is created. It might be a content attribute (e.g. the string that
-   underlies the &lt;code title=dom-classList&gt;&lt;a
-   href=&quot;#classlist&quot;&gt;classList&lt;/a&gt;&lt;/code&gt; object is the &lt;code
-   title=attr-class&gt;&lt;a href=&quot;#class&quot;&gt;class&lt;/a&gt;&lt;/code&gt; attribute), or it might
-   be an anonymous string (e.g. when a &lt;code&gt;&lt;a
-   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object is passed to an
-   author-implemented callback in the &lt;code&gt;&lt;a
-   href=&quot;#datagrid0&quot;&gt;datagrid&lt;/a&gt;&lt;/code&gt; APIs).
+   &lt;li&gt;
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=&quot;#ltquerygt&quot;
+     title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, then replace the matching
+     substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that results from
+     applying the following steps to each character other than U+0025 PERCENT
+     SIGN (%) that doesn't match the original &lt;query&gt; production
+     defined in RFC 3986:&lt;/p&gt;
 
-  &lt;pre
-   class=idl&gt;[&lt;a href=&quot;#stringify&quot; title=dom-tokenlist-toString&gt;Stringifies&lt;/a&gt;] interface &lt;dfn id=domtokenlist0&gt;DOMTokenList&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;a href=&quot;#length2&quot; title=dom-tokenlist-length&gt;length&lt;/a&gt;;
-  [IndexGetter] DOMString &lt;a href=&quot;#itemindex2&quot; title=dom-tokenlist-item&gt;item&lt;/a&gt;(in unsigned long index);
-  boolean &lt;a href=&quot;#hastoken&quot; title=dom-tokenlist-has&gt;has&lt;/a&gt;(in DOMString token);
-  void &lt;a href=&quot;#addtoken&quot; title=dom-tokenlist-add&gt;add&lt;/a&gt;(in DOMString token);
-  void &lt;a href=&quot;#remove0&quot; title=dom-tokenlist-remove&gt;remove&lt;/a&gt;(in DOMString token);
-  boolean &lt;a href=&quot;#toggle&quot; title=dom-tokenlist-toggle&gt;toggle&lt;/a&gt;(in DOMString token);
-};&lt;/pre&gt;
+    &lt;ol&gt;
+     &lt;li&gt;If the character in question cannot be expressed in the encoding
+      &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a single 0x3F octet
+      (an ASCII question mark) and skip the remaining substeps for this
+      character.
 
-  &lt;p&gt;The &lt;dfn id=length2 title=dom-tokenlist-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
-   attribute must return the number of &lt;em&gt;unique&lt;/em&gt; tokens that result
-   from &lt;a href=&quot;#split&quot; title=&quot;split a string on spaces&quot;&gt;splitting the
-   underlying string on spaces&lt;/a&gt;.
+     &lt;li&gt;Encode the character into a sequence of octets as defined by the
+      encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;.
 
-  &lt;p&gt;The &lt;dfn id=itemindex2 title=dom-tokenlist-item&gt;&lt;code&gt;item(&lt;var
-   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must &lt;a href=&quot;#split&quot;
-   title=&quot;split a string on spaces&quot;&gt;split the underlying string on
-   spaces&lt;/a&gt;, sort the resulting list of tokens by Unicode
-   codepoint&lt;!-- XXX that's
-  basically nonsense. What sort order do we want here? It should be
-  the cheapest one possible that is well-defined for all Unicode. --&gt;,
-   remove exact duplicates, and then return the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th
-   item in this list. If &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; is equal to or greater
-   than the number of tokens, then the method must return null.
+     &lt;li&gt;Replace the character with the percent-encoded form of those octets.
+      &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
+    &lt;/ol&gt;
 
-  &lt;p&gt;The &lt;dfn id=hastoken title=dom-tokenlist-has&gt;&lt;code&gt;has(&lt;var
-   title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
-   algorithm:
+   &lt;li&gt;
+    &lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2 Relative
+     Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the potentially relative
+     URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as
+     the base URI (&lt;var title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a
+     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
 
-  &lt;ol&gt;
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;a
-    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, then raise an
-    &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the algorithm.
+   &lt;li&gt;
+    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC 3987,
+     returning an error and aborting these steps if appropriate. &lt;a
+     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;Otherwise, &lt;a href=&quot;#split&quot; title=&quot;split a string on spaces&quot;&gt;split the
-    underlying string on spaces&lt;/a&gt; to get the list of tokens in the object's
-    underlying string.
+    &lt;p class=example&gt;For instance, if an absolute URI that would be returned
+     by the above algorithm violates the restrictions specific to its scheme,
+     e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the &quot;&lt;code
+     title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax, then user
+     agents are to treat this as an error instead.&lt;!-- RFC
+    3986, 3.1 Scheme --&gt;&lt;/p&gt;
 
-   &lt;li&gt;If the token indicated by &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is one of the
-    tokens in the object's underlying string then return true and stop this
-    algorithm.
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var
+     title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution algorithm.
 
-   &lt;li&gt;Otherwise, return false.
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a server-based naming
+     authority, replace all U+005C REVERSE SOLIDUS (\) characters in &lt;var
+     title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS (/) characters.
+
+   &lt;li&gt;
+    &lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;p&gt;The &lt;dfn id=addtoken title=dom-tokenlist-add&gt;&lt;code&gt;add(&lt;var
-   title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
-   algorithm:
+  &lt;p&gt;A &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt; is an &lt;dfn id=absolute&gt;absolute URL&lt;/dfn&gt; if &lt;a
+   href=&quot;#resolve&quot; title=&quot;resolve a URL&quot;&gt;resolving&lt;/a&gt; it results in the same
+   URL without an error.
 
-  &lt;ol&gt;
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;a
-    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, then raise an
-    &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the algorithm.
+  &lt;h4 id=dynamic&gt;&lt;span class=secno&gt;2.5.4 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
 
-   &lt;li&gt;Otherwise, &lt;a href=&quot;#split&quot; title=&quot;split a string on spaces&quot;&gt;split the
-    underlying string on spaces&lt;/a&gt; to get the list of tokens in the object's
-    underlying string.
+  &lt;p&gt;When an &lt;code title=attr-xml-base&gt;&lt;a href=&quot;#xmlbase&quot;&gt;xml:base&lt;/a&gt;&lt;/code&gt;
+   attribute changes, the attribute's element, and all descendant elements,
+   are &lt;a href=&quot;#affected&quot;&gt;affected by a base URL change&lt;/a&gt;.
 
-   &lt;li&gt;If the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is already one of the tokens in
-    the &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
-    underlying string then stop the algorithm.
+  &lt;p&gt;When a document's &lt;a href=&quot;#document0&quot;&gt;document base URL&lt;/a&gt; changes,
+   all elements in that document are &lt;a href=&quot;#affected&quot;&gt;affected by a base
+   URL change&lt;/a&gt;.
 
-   &lt;li&gt;Otherwise, if the &lt;code&gt;&lt;a
-    href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's underlying string
-    is not the empty string and the last character of that string is not a &lt;a
-    href=&quot;#space&quot;&gt;space character&lt;/a&gt;, then append a U+0020 SPACE character
-    to the end of that string.
+  &lt;p&gt;When an element is moved from one document to another, if the two
+   documents have different &lt;a href=&quot;#document0&quot; title=&quot;document base
+   URL&quot;&gt;base URLs&lt;/a&gt;, then that element and all its descendants are &lt;a
+   href=&quot;#affected&quot;&gt;affected by a base URL change&lt;/a&gt;.
 
-   &lt;li&gt;Append the value of &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; to the end of the
-    &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
-    underlying string.
-  &lt;/ol&gt;
+  &lt;p&gt;When an element is &lt;dfn id=affected&gt;affected by a base URL change&lt;/dfn&gt;,
+   it must act as described in the following list:
 
-  &lt;p&gt;The &lt;dfn id=remove0 title=dom-tokenlist-remove&gt;&lt;code&gt;remove(&lt;var
-   title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
-   algorithm:
+  &lt;dl class=switch&gt;
+   &lt;dt&gt;If the element is a &lt;a href=&quot;#hyperlinks&quot; title=hyperlink&gt;hyperlink
+    element&lt;/a&gt;
 
-  &lt;ol&gt;
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;a
-    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, then raise an
-    &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the algorithm.
+   &lt;dd&gt;
+    &lt;p&gt;If the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; identified by the
+     hyperlink is being shown to the user, or if any data derived from that
+     URL is affecting the display, then the &lt;code
+     title=attr-hyperlink-href&gt;&lt;a href=&quot;#href6&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute
+     should be &lt;a href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;reresolved&lt;/a&gt; and
+     the UI updated appropriately.&lt;/p&gt;
 
-   &lt;li&gt;Otherwise, &lt;a href=&quot;#remove&quot; title=&quot;remove a token from a
-    string&quot;&gt;remove the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; from the underlying
-    string&lt;/a&gt;.
-  &lt;/ol&gt;
+    &lt;p class=example&gt;For example, the CSS &lt;code title=&quot;&quot;&gt;:link&lt;/code&gt;/&lt;code
+     title=&quot;&quot;&gt;:visited&lt;/code&gt; pseudo-classes might have been affected.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=toggle title=dom-tokenlist-toggle&gt;&lt;code&gt;toggle(&lt;var
-   title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
-   algorithm:
+    &lt;p&gt;If the hyperlink has a &lt;code title=attr-hyperlink-ping&gt;&lt;a
+     href=&quot;#ping&quot;&gt;ping&lt;/a&gt;&lt;/code&gt; attribute and its &lt;a href=&quot;#absolute&quot;
+     title=&quot;absolute URL&quot;&gt;absolute URL(s)&lt;/a&gt; are being shown to the user,
+     then the &lt;code title=attr-hyperlink-ping&gt;&lt;a href=&quot;#ping&quot;&gt;ping&lt;/a&gt;&lt;/code&gt;
+     attribute's tokens should be &lt;a href=&quot;#resolve&quot; title=&quot;resolve a
+     url&quot;&gt;reresolved&lt;/a&gt; and the UI updated appropriately.&lt;/p&gt;
 
-  &lt;ol&gt;
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;a
-    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, then raise an
-    &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the algorithm.
+   &lt;dt&gt;If the element is a &lt;code&gt;&lt;a href=&quot;#blockquote&quot;&gt;blockquote&lt;/a&gt;&lt;/code&gt;,
+    &lt;code&gt;&lt;a href=&quot;#q&quot;&gt;q&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#ins&quot;&gt;ins&lt;/a&gt;&lt;/code&gt;, or
+    &lt;code&gt;&lt;a href=&quot;#del&quot;&gt;del&lt;/a&gt;&lt;/code&gt; element with a &lt;code
+    title=&quot;&quot;&gt;cite&lt;/code&gt; attribute
 
-   &lt;li&gt;Otherwise, &lt;a href=&quot;#split&quot; title=&quot;split a string on spaces&quot;&gt;split the
-    underlying string on spaces&lt;/a&gt; to get the list of tokens in the object's
-    underlying string.
+   &lt;dd&gt;
+    &lt;p&gt;If the &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; identified by the &lt;code
+     title=&quot;&quot;&gt;cite&lt;/code&gt; attribute is being shown to the user, or if any
+     data derived from that URL is affecting the display, then the it should
+     be &lt;a href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;reresolved&lt;/a&gt; and the UI
+     updated appropriately.&lt;/p&gt;
 
-   &lt;li&gt;If the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is already one of the tokens in
-    the &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
-    underlying string then &lt;a href=&quot;#remove&quot; title=&quot;remove a token from a
-    string&quot;&gt;remove the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; from the underlying
-    string&lt;/a&gt;, and stop the algorithm, returning false.
+   &lt;dt&gt;Otherwise
 
-   &lt;li&gt;Otherwise, if the &lt;code&gt;&lt;a
-    href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's underlying string
-    is not the empty string and the last character of that string is not a &lt;a
-    href=&quot;#space&quot;&gt;space character&lt;/a&gt;, then append a U+0020 SPACE character
-    to the end of that string.
+   &lt;dd&gt;
+    &lt;p&gt;The element is not directly affected.&lt;/p&gt;
 
-   &lt;li&gt;Append the value of &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; to the end of the
-    &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
-    underlying string.
+    &lt;p class=example&gt;Changing the base URL doesn't affect the image displayed
+     by &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt; elements, although subsequent
+     accesses of the &lt;code title=dom-img-src&gt;&lt;a href=&quot;#src0&quot;&gt;src&lt;/a&gt;&lt;/code&gt;
+     DOM attribute from script will return a new &lt;a href=&quot;#absolute&quot;&gt;absolute
+     URL&lt;/a&gt; that might no longer correspond to the image being shown.&lt;/p&gt;
+  &lt;/dl&gt;
 
-   &lt;li&gt;Return true.
-  &lt;/ol&gt;
+  &lt;h4 id=interfaces&gt;&lt;span class=secno&gt;2.5.5 &lt;/span&gt;Interfaces for URL
+   manipulation&lt;/h4&gt;
 
-  &lt;p&gt;Objects implementing the &lt;code&gt;&lt;a
-   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; interface must &lt;dfn
-   id=stringify title=dom-tokenlist-toString&gt;stringify&lt;/dfn&gt; to the object's
-   underlying string representation.
+  &lt;p&gt;An interface that has a complement of &lt;dfn id=url-decomposition&gt;URL
+   decomposition attributes&lt;/dfn&gt; will have seven attributes with the
+   following definitions:
 
-  &lt;h4 id=domstringmap&gt;&lt;span class=secno&gt;2.6.4 &lt;/span&gt;DOMStringMap&lt;/h4&gt;
+  &lt;pre class=idl&gt;
+           attribute DOMString &lt;a href=&quot;#protocol&quot; title=dom-uda-protocol&gt;protocol&lt;/a&gt;;
+           attribute DOMString &lt;a href=&quot;#host&quot; title=dom-uda-host&gt;host&lt;/a&gt;;
+           attribute DOMString &lt;a href=&quot;#hostname&quot; title=dom-uda-hostname&gt;hostname&lt;/a&gt;;
+           attribute DOMString &lt;a href=&quot;#port&quot; title=dom-uda-port&gt;port&lt;/a&gt;;
+           attribute DOMString &lt;a href=&quot;#pathname&quot; title=dom-uda-pathname&gt;pathname&lt;/a&gt;;
+           attribute DOMString &lt;a href=&quot;#search&quot; title=dom-uda-search&gt;search&lt;/a&gt;;
+           attribute DOMString &lt;a href=&quot;#hash&quot; title=dom-uda-hash&gt;hash&lt;/a&gt;;
+&lt;/pre&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#domstringmap0&quot;&gt;DOMStringMap&lt;/a&gt;&lt;/code&gt; interface
-   represents a set of name-value pairs. When a &lt;code&gt;&lt;a
-   href=&quot;#domstringmap0&quot;&gt;DOMStringMap&lt;/a&gt;&lt;/code&gt; object is instanced, it is
-   associated with three algorithms, one for getting values from names, one
-   for setting names to certain values, and one for deleting names.
+  &lt;p&gt;The attributes defined to be URL decomposition attributes must act as
+   described for the attributes with the same corresponding names in this
+   section.
 
-  &lt;p class=big-issue&gt;The names of the methods on this interface are temporary
-   and will be fixed when the Web IDL / &quot;Language Bindings for DOM
-   Specifications&quot; spec is ready to handle this case.
+  &lt;p&gt;In addition, an interface with a complement of URL decomposition
+   attributes will define an &lt;dfn id=input
+   title=concept-uda-input&gt;input&lt;/dfn&gt;, which is a &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt;
+   that the attributes act on, and a &lt;dfn id=common3
+   title=concept-uda-setter&gt;common setter action&lt;/dfn&gt;, which is a set of
+   steps invoked when any of the attributes' setters are invoked.
 
-  &lt;pre class=idl&gt;interface &lt;dfn id=domstringmap0&gt;DOMStringMap&lt;/dfn&gt; {
-  [NameGetter] DOMString &lt;a href=&quot;#xxx1name&quot; title=dom-stringmap-XXX1&gt;XXX1&lt;/a&gt;(in DOMString name); &lt;!-- XXX DOMB --&gt;
-  [NameSetter] void &lt;a href=&quot;#xxx2name&quot; title=dom-stringmap-XXX2&gt;XXX2&lt;/a&gt;(in DOMString name, in DOMString value); &lt;!-- XXX DOMB --&gt;
-  [XXX] boolean &lt;a href=&quot;#xxx3name&quot; title=dom-stringmap-XXX3&gt;XXX3&lt;/a&gt;(in DOMString name); &lt;!-- XXX DOMB --&gt;
-};&lt;/pre&gt;
+  &lt;p&gt;The seven URL decomposition attributes have similar requirements.
 
-  &lt;p&gt;The &lt;dfn id=xxx1name title=dom-stringmap-XXX1&gt;&lt;code&gt;XXX1(&lt;var
-   title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must call the algorithm for
-   getting values from names, passing &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the name,
-   and must return the corresponding value, or null if &lt;var
-   title=&quot;&quot;&gt;name&lt;/var&gt; has no corresponding value.
+  &lt;p&gt;On getting, if the &lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt;
+   fulfills the condition given in the &quot;getter condition&quot; column
+   corresponding to the attribute in the table below, the user agent must
+   return the part of the &lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt;
+   URL given in the &quot;component&quot; column, with any prefixes specified in the
+   &quot;prefix&quot; column appropriately added to the start of the string and any
+   suffixes specified in the &quot;suffix&quot; column appropriately added to the end
+   of the string. Otherwise, the attribute must return the empty string.
 
-  &lt;p&gt;The &lt;dfn id=xxx2name title=dom-stringmap-XXX2&gt;&lt;code&gt;XXX2(&lt;var
-   title=&quot;&quot;&gt;name&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must
-   call the algorithm for setting names to certain values, passing &lt;var
-   title=&quot;&quot;&gt;name&lt;/var&gt; as the name and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; as the
-   value.
+  &lt;p&gt;On setting, the new value must first be mutated as described by the
+   &quot;setter preprocessor&quot; column, then mutated by %-escaping any characters in
+   the new value that are not valid in the relevant component as given by the
+   &quot;component&quot; column. Then, if the resulting new value fulfills the
+   condition given in the &quot;setter condition&quot; column, the user agent must make
+   a new string &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; by replacing the component of the
+   URL given by the &quot;component&quot; column in the &lt;a href=&quot;#input&quot;
+   title=concept-uda-input&gt;input&lt;/a&gt; URL with the new value; otherwise, the
+   user agent must let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be equal to the &lt;a
+   href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt;. Finally, the user agent
+   must invoke the &lt;a href=&quot;#common3&quot; title=concept-uda-setter&gt;common setter
+   action&lt;/a&gt; with the value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.
 
-  &lt;p&gt;The &lt;dfn id=xxx3name title=dom-stringmap-XXX3&gt;&lt;code&gt;XXX3(&lt;var
-   title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must call the algorithm for
-   deleting names, passing &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the name, and must
-   return true.
+  &lt;p&gt;When replacing a component in the URL, if the component is part of an
+   optional group in the URL syntax consisting of a character followed by the
+   component, the component (including its prefix character) must be included
+   even if the new value is the empty string.
 
-  &lt;h4 id=dom-feature&gt;&lt;span class=secno&gt;2.6.5 &lt;/span&gt;DOM feature strings&lt;/h4&gt;
+  &lt;p class=note&gt;The previous paragraph applies in particular to the &quot;&lt;code
+   title=&quot;&quot;&gt;:&lt;/code&gt;&quot; before a &lt;port&gt; component, the &quot;&lt;code
+   title=&quot;&quot;&gt;?&lt;/code&gt;&quot; before a &lt;query&gt; component, and the &quot;&lt;code
+   title=&quot;&quot;&gt;#&lt;/code&gt;&quot; before a &lt;fragment&gt; component.
 
-  &lt;p&gt;DOM3 Core defines mechanisms for checking for interface support, and for
-   obtaining implementations of interfaces, using &lt;a
-   href=&quot;<A HREF="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures">http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures</A>&quot;&gt;feature
-   strings&lt;/a&gt;. &lt;a href=&quot;#refsDOM3CORE&quot;&gt;[DOM3CORE]&lt;/a&gt;
+  &lt;p&gt;For the purposes of the above definitions, URLs must be parsed using the
+   &lt;a href=&quot;#parse0&quot; title=&quot;parse a URL&quot;&gt;URL parsing rules&lt;/a&gt; defined in
+   this specification.
 
-  &lt;p&gt;A DOM application can use the &lt;dfn id=hasfeature
-   title=hasFeature&gt;&lt;code&gt;hasFeature(&lt;var title=&quot;&quot;&gt;feature&lt;/var&gt;, &lt;var
-   title=&quot;&quot;&gt;version&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method of the
-   &lt;code&gt;DOMImplementation&lt;/code&gt; interface with parameter values &quot;&lt;code
-   title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; and &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; (respectively) to determine
-   whether or not this module is supported by the implementation. In addition
-   to the feature string &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;, the feature string
-   &quot;&lt;code title=&quot;&quot;&gt;XHTML&lt;/code&gt;&quot; (with version string &quot;&lt;code&gt;5.0&lt;/code&gt;&quot;) can
-   be used to check if the implementation supports XHTML. User agents should
-   respond with a true value when the &lt;code&gt;&lt;a
-   href=&quot;#hasfeature&quot;&gt;hasFeature&lt;/a&gt;&lt;/code&gt; method is queried with these
-   values. Authors are cautioned, however, that UAs returning true might not
-   be perfectly compliant, and that UAs returning false might well have
-   support for features in this specification; in general, therefore, use of
-   this method is discouraged.
+  &lt;table&gt;
+   &lt;thead&gt;
+    &lt;tr&gt;
+     &lt;th&gt;Attribute
 
-  &lt;p&gt;The values &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; and &quot;&lt;code
-   title=&quot;&quot;&gt;XHTML&lt;/code&gt;&quot; (both with version &quot;&lt;code&gt;5.0&lt;/code&gt;&quot;) should also
-   be supported in the context of the &lt;code&gt;getFeature()&lt;/code&gt; and
-   &lt;code&gt;isSupported()&lt;/code&gt; methods, as defined by DOM3 Core.
+     &lt;th&gt;Component
 
-  &lt;p class=note&gt;The interfaces defined in this specification are not always
-   supersets of the interfaces defined in DOM2 HTML; some features that were
-   formerly deprecated, poorly supported, rarely used or considered
-   unnecessary have been removed. Therefore it is not guaranteed that an
-   implementation that supports &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;
-   &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; also supports &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;
-   &quot;&lt;code&gt;2.0&lt;/code&gt;&quot;.
+     &lt;th&gt;Getter Condition
 
-  &lt;h3 id=fetching&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Fetching resources&lt;/h3&gt;
+     &lt;th&gt;Prefix
 
+     &lt;th&gt;Suffix
+
+     &lt;th&gt;Setter Preprocessor
+
+     &lt;th&gt;Setter Condition
+
+   &lt;tbody&gt;
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn id=protocol title=dom-uda-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#ltschemegt&quot; title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;U+003A COLON (&quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;)
+
+     &lt;td&gt;Remove all trailing U+003A COLON (&quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;)
+      characters
+
+     &lt;td&gt;The new value is not the empty string
+
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn id=host title=dom-uda-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#lthostportgt&quot; title=url-hostport&gt;&lt;hostport&gt;&lt;/a&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
+      and uses a server-based naming authority
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;&mdash;
+
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn id=hostname title=dom-uda-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#lthostgt&quot; title=url-host&gt;&lt;host&gt;&lt;/a&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
+      and uses a server-based naming authority
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;Remove all leading U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;)
+      characters
+
+     &lt;td&gt;&mdash;
+
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn id=port title=dom-uda-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#ltportgt&quot; title=url-port&gt;&lt;port&gt;&lt;/a&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical,
+      uses a server-based naming authority, and contained a &lt;a
+      href=&quot;#ltportgt&quot; title=url-port&gt;&lt;port&gt;&lt;/a&gt; component (possibly an
+      empty one)
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;Remove any characters in the new value that are not in the range
+      U+0030 DIGIT ZERO .. U+0039 DIGIT NINE. If the resulting string is
+      empty, set it to a single U+0030 DIGIT ZERO character ('0').
+
+     &lt;td&gt;&mdash;
+
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn id=pathname title=dom-uda-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#ltpathgt&quot; title=url-path&gt;&lt;path&gt;&lt;/a&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;If it has no leading U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;)
+      character, prepend a U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;)
+      character to the new value
+
+     &lt;td&gt;&mdash;
+
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn id=search title=dom-uda-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical,
+      and contained a &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
+      component (possibly an empty one)
+
+     &lt;td&gt;U+003F QUESTION MARK (&quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;)
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;Remove one leading U+003F QUESTION MARK (&quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;)
+      character, if any
+
+     &lt;td&gt;&mdash;
+
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn id=hash title=dom-uda-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#ltfragmentgt&quot; title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
+
+     &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; contained a &lt;a
+      href=&quot;#ltfragmentgt&quot; title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component
+      (possibly an empty one)
+
+     &lt;td&gt;U+0023 NUMBER SIGN (&quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot;)
+
+     &lt;td&gt;&mdash;
+
+     &lt;td&gt;Remove one leading U+0023 NUMBER SIGN (&quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot;)
+      character, if any
+
+     &lt;td&gt;&mdash;
+  &lt;/table&gt;
+  &lt;!--
+  <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
+  <A HREF="http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp">http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp</A>
+  <A HREF="http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722">http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722</A>
+--&gt;
+
+  &lt;div class=example&gt;
+   &lt;p&gt;The table below demonstrates how the getter condition for &lt;code
+    title=dom-uda-search&gt;&lt;a href=&quot;#search&quot;&gt;search&lt;/a&gt;&lt;/code&gt; results in
+    different results depending on the exact original syntax of the URL:&lt;/p&gt;
+
+   &lt;table&gt;
+    &lt;thead&gt;
+     &lt;tr&gt;
+      &lt;th&gt; Input URL
+
+      &lt;th&gt; &lt;code title=dom-uda-search&gt;&lt;a href=&quot;#search&quot;&gt;search&lt;/a&gt;&lt;/code&gt;
+       value
+
+      &lt;th&gt; Explanation
+
+    &lt;tbody&gt;
+     &lt;tr&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/&lt;/code">http://example.com/&lt;/code</A>&gt;
+
+      &lt;td&gt; &lt;i&gt;empty string&lt;/i&gt;
+
+      &lt;td&gt; No &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
+       component in input URL.
+
+     &lt;tr&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?&lt;/code">http://example.com/?&lt;/code</A>&gt;
+
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
+
+      &lt;td&gt; There is a &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
+       component, but it is empty. The question mark in the resulting value
+       is the prefix.
+
+     &lt;tr&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test&lt;/code">http://example.com/?test&lt;/code</A>&gt;
+
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
+
+      &lt;td&gt; The &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt;
+       component has the value &quot;&lt;code title=&quot;&quot;&gt;test&lt;/code&gt;&quot;.
+
+     &lt;tr&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test#&lt;/code">http://example.com/?test#&lt;/code</A>&gt;
+
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
+
+      &lt;td&gt; The (empty) &lt;a href=&quot;#ltfragmentgt&quot;
+       title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component is not part of the
+       &lt;a href=&quot;#ltquerygt&quot; title=url-query&gt;&lt;query&gt;&lt;/a&gt; component.
+   &lt;/table&gt;
+  &lt;/div&gt;
+
+  &lt;h3 id=fetching&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Fetching resources&lt;/h3&gt;
+
   &lt;p class=big-issue&gt;replace all instances of the word 'fetch' or 'download'
    with a reference to this section, and put something here that talks about
    caching, that redirects to the offline storage stuff when appropriate,
@@ -5935,7 +5337,7 @@
   (e.g. not loading video poster frames until the video is on the
   screen) --&gt;
 
-  &lt;h3 id=content-type-sniffing&gt;&lt;span class=secno&gt;2.8 &lt;/span&gt;Determining the
+  &lt;h3 id=content-type-sniffing&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Determining the
    type of a resource&lt;/h3&gt;
 
   &lt;p class=warning&gt;It is imperative that the rules in this section be
@@ -5947,7 +5349,7 @@
    the end user can be exposed to malicious content, making the user
    vulnerable to cookie theft attacks and other cross-site scripting attacks.
 
-  &lt;h4 id=content-type&gt;&lt;span class=secno&gt;2.8.1 &lt;/span&gt;Content-Type metadata&lt;/h4&gt;
+  &lt;h4 id=content-type&gt;&lt;span class=secno&gt;2.7.1 &lt;/span&gt;Content-Type metadata&lt;/h4&gt;
 
   &lt;p&gt;What explicit &lt;dfn id=content-type5 title=Content-Type&gt;Content-Type
    metadata&lt;/dfn&gt; is associated with the resource (the resource's type
@@ -6030,7 +5432,7 @@
   &lt;p class=note&gt;The above algorithm is a willful violation of the HTTP
    specification. &lt;a href=&quot;#refsRFC2616&quot;&gt;[RFC2616]&lt;/a&gt;
 
-  &lt;h4 id=content-type0&gt;&lt;span class=secno&gt;2.8.2 &lt;/span&gt;Content-Type sniffing:
+  &lt;h4 id=content-type0&gt;&lt;span class=secno&gt;2.7.2 &lt;/span&gt;Content-Type sniffing:
    Web pages&lt;/h4&gt;
 
   &lt;p&gt;The &lt;dfn id=sniffed title=&quot;Content-Type sniffing&quot;&gt;sniffed type of a
@@ -6135,7 +5537,7 @@
     &lt;p&gt;The sniffed type of the resource is &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;h4 id=content-type1&gt;&lt;span class=secno&gt;2.8.3 &lt;/span&gt;&lt;dfn
+  &lt;h4 id=content-type1&gt;&lt;span class=secno&gt;2.7.3 &lt;/span&gt;&lt;dfn
    id=content-type6&gt;Content-Type sniffing: text or binary&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;ol&gt;
@@ -6239,7 +5641,7 @@
    &lt;li&gt; 0x1C - 0x1F
   &lt;/ul&gt;
 
-  &lt;h4 id=content-type2&gt;&lt;span class=secno&gt;2.8.4 &lt;/span&gt;&lt;dfn
+  &lt;h4 id=content-type2&gt;&lt;span class=secno&gt;2.7.4 &lt;/span&gt;&lt;dfn
    id=content-type7&gt;Content-Type sniffing: unknown type&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;ol&gt;
@@ -6575,7 +5977,7 @@
    binary&quot; section, to avoid sniffing &lt;code title=&quot;&quot;&gt;text/plain&lt;/code&gt;
    content as a type that can be used for a privilege escalation attack.
 
-  &lt;h4 id=content-type3&gt;&lt;span class=secno&gt;2.8.5 &lt;/span&gt;&lt;dfn
+  &lt;h4 id=content-type3&gt;&lt;span class=secno&gt;2.7.5 &lt;/span&gt;&lt;dfn
    id=content-type8&gt;Content-Type sniffing: image&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;If the first bytes of the resource match one of the byte sequences in
@@ -6644,7 +6046,7 @@
   &lt;p&gt;Otherwise, the sniffed type of the resource is the same as its &lt;var
    title=&quot;&quot;&gt;official type&lt;/var&gt;.
 
-  &lt;h4 id=content-type4&gt;&lt;span class=secno&gt;2.8.6 &lt;/span&gt;&lt;dfn
+  &lt;h4 id=content-type4&gt;&lt;span class=secno&gt;2.7.6 &lt;/span&gt;&lt;dfn
    id=content-type9&gt;Content-Type sniffing: feed or HTML&lt;/dfn&gt;&lt;/h4&gt;
   &lt;!-- mostly based on:
    <A HREF="http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx">http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx</A>
@@ -6823,6 +6225,604 @@
    this algorithm and the algorithm for detecting the character encoding of
    HTML documents in parallel.
 
+  &lt;h3 id=common2&gt;&lt;span class=secno&gt;2.8 &lt;/span&gt;Common DOM interfaces&lt;/h3&gt;
+
+  &lt;h4 id=reflecting&gt;&lt;span class=secno&gt;2.8.1 &lt;/span&gt;Reflecting content
+   attributes in DOM attributes&lt;/h4&gt;
+
+  &lt;p&gt;Some &lt;span title=&quot;DOM attribute&quot;&gt;DOM attributes&lt;/span&gt; are defined to
+   &lt;dfn id=reflect&gt;reflect&lt;/dfn&gt; a particular &lt;span&gt;content attribute&lt;/span&gt;.
+   This means that on getting, the DOM attribute returns the current value of
+   the content attribute, and on setting, the DOM attribute changes the value
+   of the content attribute to the given value.
+
+  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; attribute
+   whose content attribute is defined to contain a &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt;,
+   then on getting, the DOM attribute must &lt;a href=&quot;#resolve&quot; title=&quot;resolve
+   a url&quot;&gt;resolve&lt;/a&gt; the value of the content attribute and return the
+   resulting &lt;a href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; if that was successful, or
+   the empty string otherwise; and on setting, must set the content attribute
+   to the specified literal value. If the content attribute is absent, the
+   DOM attribute must return the default value, if the content attribute has
+   one, or else the empty string.
+
+  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; attribute
+   whose content attribute is defined to contain one or more &lt;a href=&quot;#url&quot;
+   title=URL&gt;URLs&lt;/a&gt;, then on getting, the DOM attribute must &lt;span
+   title=&quot;split the string on spaces&quot;&gt;split the content attribute on
+   spaces&lt;/span&gt; and return the concatenation of &lt;a href=&quot;#resolve&quot;
+   title=&quot;resolve a URL&quot;&gt;resolving&lt;/a&gt; each token URL to an &lt;a
+   href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt;, with a single U+0020 SPACE character
+   between each URL, ignoring any tokens that did not resolve successfully.
+   If the content attribute is absent, the DOM attribute must return the
+   default value, if the content attribute has one, or else the empty string.
+   On setting, the DOM attribute must set the content attribute to the
+   specified literal value.
+
+  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; whose content
+   attribute is an &lt;a href=&quot;#enumerated&quot;&gt;enumerated attribute&lt;/a&gt;, and the
+   DOM attribute is &lt;dfn id=limited&gt;limited to only known values&lt;/dfn&gt;, then,
+   on getting, the DOM attribute must return the conforming value associated
+   with the state the attribute is in (in its canonical case), or the empty
+   string if the attribute is in a state that has no associated keyword
+   value; and on setting, if the new value is an &lt;a href=&quot;#ascii&quot;&gt;ASCII
+   case-insensitive&lt;/a&gt; match for one of the keywords given for that
+   attribute, then the content attribute must be set to the conforming value
+   associated with the state that the attribute would be in if set to the
+   given new value, otherwise, if the new value is the empty string, then the
+   content attribute must be removed, otherwise, the setter must raise a
+   &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception.
+
+  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; but doesn't
+   fall into any of the above categories, then the getting and setting must
+   be done in a transparent, case-preserving manner.
+
+  &lt;p&gt;If a reflecting DOM attribute is a boolean attribute, then on getting
+   the DOM attribute must return true if the attribute is set, and false if
+   it is absent. On setting, the content attribute must be removed if the DOM
+   attribute is set to false, and must be set to have the same value as its
+   name if the DOM attribute is set to true. (This corresponds to the rules
+   for &lt;a href=&quot;#boolean0&quot; title=&quot;boolean attribute&quot;&gt;boolean content
+   attributes&lt;/a&gt;.)
+
+  &lt;p&gt;If a reflecting DOM attribute is a signed integer type
+   (&lt;code&gt;long&lt;/code&gt;) then, on getting, the content attribute must be parsed
+   according to &lt;a href=&quot;#rules0&quot; title=&quot;rules for parsing integers&quot;&gt;the
+   rules for parsing signed integers&lt;/a&gt;, and if that is successful, the
+   resulting value must be returned. If, on the other hand, it fails, or if
+   the attribute is absent, then the default value must be returned instead,
+   or 0 if there is no default value. On setting, the given value must be
+   converted to the shortest possible string representing the number as a &lt;a
+   href=&quot;#valid0&quot;&gt;valid integer&lt;/a&gt; in base ten and then that string must be
+   used as the new content attribute value.
+
+  &lt;p&gt;If a reflecting DOM attribute is an &lt;em&gt;unsigned&lt;/em&gt; integer type
+   (&lt;code&gt;unsigned long&lt;/code&gt;) then, on getting, the content attribute must
+   be parsed according to &lt;a href=&quot;#rules&quot; title=&quot;rules for parsing
+   non-negative integers&quot;&gt;the rules for parsing unsigned integers&lt;/a&gt;, and if
+   that is successful, the resulting value must be returned. If, on the other
+   hand, it fails, or if the attribute is absent, the default value must be
+   returned instead, or 0 if there is no default value. On setting, the given
+   value must be converted to the shortest possible string representing the
+   number as a &lt;a href=&quot;#valid&quot;&gt;valid non-negative integer&lt;/a&gt; in base ten
+   and then that string must be used as the new content attribute value.
+
+  &lt;p&gt;If a reflecting DOM attribute is an unsigned integer type
+   (&lt;code&gt;unsigned long&lt;/code&gt;) that is &lt;dfn id=limited0&gt;limited to only
+   positive non-zero numbers&lt;/dfn&gt;, then the behavior is similar to the
+   previous case, but zero is not allowed. On getting, the content attribute
+   must first be parsed according to &lt;a href=&quot;#rules&quot; title=&quot;rules for
+   parsing non-negative integers&quot;&gt;the rules for parsing unsigned
+   integers&lt;/a&gt;, and if that is successful, the resulting value must be
+   returned. If, on the other hand, it fails, or if the attribute is absent,
+   the default value must be returned instead, or 1 if there is no default
+   value. On setting, if the value is zero, the user agent must fire an
+   &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception. Otherwise, the given value must be
+   converted to the shortest possible string representing the number as a &lt;a
+   href=&quot;#valid&quot;&gt;valid non-negative integer&lt;/a&gt; in base ten and then that
+   string must be used as the new content attribute value.
+
+  &lt;p&gt;If a reflecting DOM attribute is a floating point number type
+   (&lt;code&gt;float&lt;/code&gt;) and the content attribute is defined to contain a
+   time offset, then, on getting, the content attribute must be parsed
+   according to &lt;a href=&quot;#rules4&quot; title=&quot;rules for parsing time offsets&quot;&gt;the
+   rules for parsing time offsets&lt;/a&gt;, and if that is successful, the
+   resulting value, in seconds, must be returned. If that fails, or if the
+   attribute is absent, the default value must be returned, or the
+   not-a-number value (NaN) if there is no default value. On setting, the
+   given value, interpreted as a time offset in seconds, must be converted to
+   a string using the &lt;a href=&quot;#time-offset&quot;&gt;time offset serialization
+   rules&lt;/a&gt;, and that string must be used as the new content attribute
+   value.
+
+  &lt;p&gt;If a reflecting DOM attribute is a floating point number type
+   (&lt;code&gt;float&lt;/code&gt;) and it doesn't fall into one of the earlier
+   categories, then, on getting, the content attribute must be parsed
+   according to &lt;a href=&quot;#rules1&quot; title=&quot;rules for parsing floating point
+   number values&quot;&gt;the rules for parsing floating point number values&lt;/a&gt;, and
+   if that is successful, the resulting value must be returned. If, on the
+   other hand, it fails, or if the attribute is absent, the default value
+   must be returned instead, or 0.0 if there is no default value. On setting,
+   the given value must be converted to the shortest possible string
+   representing the number as a &lt;a href=&quot;#valid1&quot;&gt;valid floating point
+   number&lt;/a&gt; in base ten and then that string must be used as the new
+   content attribute value.
+
+  &lt;p&gt;If a reflecting DOM attribute is of the type &lt;code&gt;&lt;a
+   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt;, then on getting it must
+   return a &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object
+   whose underlying string is the element's corresponding content attribute.
+   When the &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object
+   mutates its underlying string, the content attribute must itself be
+   immediately mutated. When the attribute is absent, then the string
+   represented by the &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt;
+   object is the empty string; when the object mutates this empty string, the
+   user agent must first add the corresponding content attribute, and then
+   mutate that attribute instead. &lt;code&gt;&lt;a
+   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; attributes are always
+   read-only. The same &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt;
+   object must be returned every time for each attribute.
+
+  &lt;p&gt;If a reflecting DOM attribute has the type &lt;code&gt;&lt;a
+   href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;, or an interface that descends
+   from &lt;code&gt;&lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt;, then, on
+   getting, it must run the following algorithm (stopping at the first point
+   where a value is returned):
+
+  &lt;ol&gt;
+   &lt;li&gt;If the corresponding content attribute is absent, then the DOM
+    attribute must return null.
+
+   &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; be the element that the &lt;code
+    title=&quot;&quot;&gt;document.getElementById()&lt;/code&gt; method would find if it was
+    passed as its argument the current value of the corresponding content
+    attribute.
+
+   &lt;li&gt;If &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; is null, or if it is not
+    type-compatible with the DOM attribute, then the DOM attribute must
+    return null.
+
+   &lt;li&gt;Otherwise, it must return &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;.
+  &lt;/ol&gt;
+
+  &lt;p&gt;On setting, if the given element has an &lt;code title=attr-id&gt;&lt;a
+   href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute, then the content attribute must be set
+   to the value of that &lt;code title=attr-id&gt;&lt;a href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt;
+   attribute. Otherwise, the DOM attribute must be set to the empty string.&lt;/p&gt;
+  &lt;!-- XXX or raise an exception? --&gt;
+
+  &lt;h4 id=collections&gt;&lt;span class=secno&gt;2.8.2 &lt;/span&gt;Collections&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#htmlcollection0&quot;&gt;HTMLCollection&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
+   href=&quot;#htmlformcontrolscollection0&quot;&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/code&gt;,
+   and &lt;code&gt;&lt;a
+   href=&quot;#htmloptionscollection0&quot;&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; interfaces
+   represent various lists of DOM nodes. Collectively, objects implementing
+   these interfaces are called &lt;dfn id=collections0&gt;collections&lt;/dfn&gt;.
+
+  &lt;p&gt;When a &lt;a href=&quot;#collections0&quot; title=collections&gt;collection&lt;/a&gt; is
+   created, a filter and a root are associated with the collection.
+
+  &lt;p class=example&gt;For example, when the &lt;code&gt;&lt;a
+   href=&quot;#htmlcollection0&quot;&gt;HTMLCollection&lt;/a&gt;&lt;/code&gt; object for the &lt;code
+   title=dom-document-images&gt;&lt;a href=&quot;#images0&quot;&gt;document.images&lt;/a&gt;&lt;/code&gt;
+   attribute is created, it is associated with a filter that selects only
+   &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt; elements, and rooted at the root of
+   the document.
+
+  &lt;p&gt;The &lt;a href=&quot;#collections0&quot; title=collections&gt;collection&lt;/a&gt; then &lt;dfn
+   id=represents title=&quot;represented by the collection&quot;&gt;represents&lt;/dfn&gt; a &lt;a
+   href=&quot;#live&quot;&gt;live&lt;/a&gt; view of the subtree rooted at the collection's root,
+   containing only nodes that match the given filter. The view is linear. In
+   the absence of specific requirements to the contrary, the nodes within the
+   collection must be sorted in &lt;a href=&quot;#tree-order&quot;&gt;tree order&lt;/a&gt;.
+
+  &lt;p class=note&gt;The &lt;code title=dom-table-rows&gt;&lt;a
+   href=&quot;#rows&quot;&gt;rows&lt;/a&gt;&lt;/code&gt; list is not in tree order.
+
+  &lt;p&gt;An attribute that returns a collection must return the same object every
+   time it is retrieved.
+
+  &lt;h5 id=htmlcollection&gt;&lt;span class=secno&gt;2.8.2.1. &lt;/span&gt;HTMLCollection&lt;/h5&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#htmlcollection0&quot;&gt;HTMLCollection&lt;/a&gt;&lt;/code&gt; interface
+   represents a generic &lt;a href=&quot;#collections0&quot;
+   title=collections&gt;collection&lt;/a&gt; of elements.
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=htmlcollection0&gt;HTMLCollection&lt;/dfn&gt; {
+  readonly attribute unsigned long &lt;a href=&quot;#length&quot; title=dom-HTMLCollection-length&gt;length&lt;/a&gt;;
+  [IndexGetter] Element &lt;a href=&quot;#itemindex&quot; title=dom-HTMLCollection-item&gt;item&lt;/a&gt;(in unsigned long index);
+  [NameGetter] Element &lt;a href=&quot;#nameditem&quot; title=dom-HTMLCollection-namedItem&gt;namedItem&lt;/a&gt;(in DOMString name);
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn id=length
+   title=dom-HTMLCollection-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt; attribute must
+   return the number of nodes &lt;a href=&quot;#represents&quot;&gt;represented by the
+   collection&lt;/a&gt;.
+
+  &lt;p&gt;The &lt;dfn id=itemindex title=dom-HTMLCollection-item&gt;&lt;code&gt;item(&lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must return
+   null.
+
+  &lt;p&gt;The &lt;dfn id=nameditem
+   title=dom-HTMLCollection-namedItem&gt;&lt;code&gt;namedItem(&lt;var
+   title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the first node in the
+   collection that matches the following requirements:
+
+  &lt;ul&gt;
+   &lt;li&gt;It is an &lt;code&gt;&lt;a href=&quot;#a&quot;&gt;a&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
+    href=&quot;#applet&quot;&gt;applet&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#area&quot;&gt;area&lt;/a&gt;&lt;/code&gt;,
+    &lt;code&gt;form&lt;/code&gt;, &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a
+    href=&quot;#object&quot;&gt;object&lt;/a&gt;&lt;/code&gt; element with a &lt;code
+    title=attr-name&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;,
+    or,
+
+   &lt;li&gt;It is an &lt;a href=&quot;#html-elements&quot; title=&quot;HTML elements&quot;&gt;HTML
+    element&lt;/a&gt; of any kind with an &lt;code title=attr-id&gt;&lt;a
+    href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;.
+    (Non-HTML elements, even if they have IDs, are not searched for the
+    purposes of &lt;code title=dom-HTMLCollection-namedItem&gt;&lt;a
+    href=&quot;#nameditem&quot;&gt;namedItem()&lt;/a&gt;&lt;/code&gt;.)
+  &lt;/ul&gt;
+
+  &lt;p&gt;If no such elements are found, then the method must return null.
+
+  &lt;h5 id=htmlformcontrolscollection&gt;&lt;span class=secno&gt;2.8.2.2.
+   &lt;/span&gt;HTMLFormControlsCollection&lt;/h5&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a
+   href=&quot;#htmlformcontrolscollection0&quot;&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/code&gt;
+   interface represents a &lt;a href=&quot;#collections0&quot;
+   title=collections&gt;collection&lt;/a&gt; of form controls.
+
+  &lt;pre
+   class=idl&gt;interface &lt;dfn id=htmlformcontrolscollection0&gt;HTMLFormControlsCollection&lt;/dfn&gt; {
+  readonly attribute unsigned long &lt;a href=&quot;#length0&quot; title=dom-HTMLFormControlsCollection-length&gt;length&lt;/a&gt;;
+  [IndexGetter] &lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt; &lt;a href=&quot;#itemindex0&quot; title=dom-HTMLFormControlsCollection-item&gt;item&lt;/a&gt;(in unsigned long index);
+  [NameGetter] Object &lt;a href=&quot;#nameditem0&quot; title=dom-HTMLFormControlsCollection-namedItem&gt;namedItem&lt;/a&gt;(in DOMString name);
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn id=length0
+   title=dom-HTMLFormControlsCollection-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+   attribute must return the number of nodes &lt;a
+   href=&quot;#represents&quot;&gt;represented by the collection&lt;/a&gt;.
+
+  &lt;p&gt;The &lt;dfn id=itemindex0
+   title=dom-HTMLFormControlsCollection-item&gt;&lt;code&gt;item(&lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must return
+   null.
+
+  &lt;p&gt;The &lt;dfn id=nameditem0
+   title=dom-HTMLFormControlsCollection-namedItem&gt;&lt;code&gt;namedItem(&lt;var
+   title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must act according to the
+   following algorithm:
+
+  &lt;ol&gt;
+   &lt;li&gt;If, at the time the method is called, there is exactly one node in the
+    collection that has either an &lt;code title=attr-id&gt;&lt;a
+    href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code title=attr-name&gt;name&lt;/code&gt;
+    attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;, then return that node and
+    stop the algorithm.
+
+   &lt;li&gt;Otherwise, if there are no nodes in the collection that have either an
+    &lt;code title=attr-id&gt;&lt;a href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code
+    title=attr-name&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;,
+    then return null and stop the algorithm.
+
+   &lt;li&gt;Otherwise, create a &lt;code&gt;NodeList&lt;/code&gt; object representing a live
+    view of the &lt;code&gt;&lt;a
+    href=&quot;#htmlformcontrolscollection0&quot;&gt;HTMLFormControlsCollection&lt;/a&gt;&lt;/code&gt;
+    object, further filtered so that the only nodes in the
+    &lt;code&gt;NodeList&lt;/code&gt; object are those that have either an &lt;code
+    title=attr-id&gt;&lt;a href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code
+    title=attr-name&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;.
+    The nodes in the &lt;code&gt;NodeList&lt;/code&gt; object must be sorted in &lt;a
+    href=&quot;#tree-order&quot;&gt;tree order&lt;/a&gt;.
+
+   &lt;li&gt;Return that &lt;code&gt;NodeList&lt;/code&gt; object.
+  &lt;/ol&gt;
+  &lt;!--
+<A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C%21DOCTYPE%20html%3E...%0A%3Cform%20name%3D%22a%22%3E%3Cinput%20id%3D%22x%22%20name%3D%22y%22%3E%3Cinput%20name%3D%22x%22%20id%3D%22y%22%3E%3C/form%3E%0A%3Cscript%3E%0A%20%20var%20x%3B%0A%20%20w%28x%20%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20x%5B0%5D.parentNode.removeChild%28x%5B0%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20w%28x%20%3D%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%3C/script%3E%0A">http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C%21DOCTYPE%20html%3E...%0A%3Cform%20name%3D%22a%22%3E%3Cinput%20id%3D%22x%22%20name%3D%22y%22%3E%3Cinput%20name%3D%22x%22%20id%3D%22y%22%3E%3C/form%3E%0A%3Cscript%3E%0A%20%20var%20x%3B%0A%20%20w%28x%20%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20x%5B0%5D.parentNode.removeChild%28x%5B0%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20w%28x%20%3D%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%3C/script%3E%0A</A>
+--&gt;
+
+  &lt;h5 id=htmloptionscollection&gt;&lt;span class=secno&gt;2.8.2.3.
+   &lt;/span&gt;HTMLOptionsCollection&lt;/h5&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a
+   href=&quot;#htmloptionscollection0&quot;&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; interface
+   represents a list of &lt;code&gt;option&lt;/code&gt; elements.
+
+  &lt;pre
+   class=idl&gt;interface &lt;dfn id=htmloptionscollection0&gt;HTMLOptionsCollection&lt;/dfn&gt; {
+           attribute unsigned long &lt;a href=&quot;#length1&quot; title=dom-HTMLOptionsCollection-length&gt;length&lt;/a&gt;;
+  [IndexGetter] HTMLOptionElement &lt;a href=&quot;#itemindex1&quot; title=dom-HTMLOptionsCollection-item&gt;item&lt;/a&gt;(in unsigned long index);
+  [NameGetter] Object &lt;a href=&quot;#nameditem1&quot; title=dom-HTMLOptionsCollection-namedItem&gt;namedItem&lt;/a&gt;(in DOMString name);
+};&lt;/pre&gt;
+
+  &lt;p&gt;On getting, the &lt;dfn id=length1
+   title=dom-HTMLOptionsCollection-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt; attribute
+   must return the number of nodes &lt;a href=&quot;#represents&quot;&gt;represented by the
+   collection&lt;/a&gt;.
+
+  &lt;p&gt;On setting, the behavior depends on whether the new value is equal to,
+   greater than, or less than the number of nodes &lt;a
+   href=&quot;#represents&quot;&gt;represented by the collection&lt;/a&gt; at that time. If the
+   number is the same, then setting the attribute must do nothing. If the new
+   value is greater, then &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; new &lt;code&gt;option&lt;/code&gt;
+   elements with no attributes and no child nodes must be appended to the
+   &lt;code&gt;select&lt;/code&gt; element on which the &lt;code&gt;&lt;a
+   href=&quot;#htmloptionscollection0&quot;&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; is rooted,
+   where &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is the difference between the two numbers (new
+   value minus old value). If the new value is lower, then the last &lt;var
+   title=&quot;&quot;&gt;n&lt;/var&gt; nodes in the collection must be removed from their parent
+   nodes, where &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is the difference between the two
+   numbers (old value minus new value).
+
+  &lt;p class=note&gt;Setting &lt;code title=dom-HTMLOptionsCollection-length&gt;&lt;a
+   href=&quot;#length1&quot;&gt;length&lt;/a&gt;&lt;/code&gt; never removes or adds any
+   &lt;code&gt;optgroup&lt;/code&gt; elements, and never adds new children to existing
+   &lt;code&gt;optgroup&lt;/code&gt; elements (though it can remove children from them).
+
+  &lt;p&gt;The &lt;dfn id=itemindex1
+   title=dom-HTMLOptionsCollection-item&gt;&lt;code&gt;item(&lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must return
+   null.
+
+  &lt;p&gt;The &lt;dfn id=nameditem1
+   title=dom-HTMLOptionsCollection-namedItem&gt;&lt;code&gt;namedItem(&lt;var
+   title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must act according to the
+   following algorithm:
+
+  &lt;ol&gt;
+   &lt;li&gt;If, at the time the method is called, there is exactly one node in the
+    collection that has either an &lt;code title=attr-id&gt;&lt;a
+    href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code title=attr-name&gt;name&lt;/code&gt;
+    attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;, then return that node and
+    stop the algorithm.
+
+   &lt;li&gt;Otherwise, if there are no nodes in the collection that have either an
+    &lt;code title=attr-id&gt;&lt;a href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code
+    title=attr-name&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;,
+    then return null and stop the algorithm.
+
+   &lt;li&gt;Otherwise, create a &lt;code&gt;NodeList&lt;/code&gt; object representing a live
+    view of the &lt;code&gt;&lt;a
+    href=&quot;#htmloptionscollection0&quot;&gt;HTMLOptionsCollection&lt;/a&gt;&lt;/code&gt; object,
+    further filtered so that the only nodes in the &lt;code&gt;NodeList&lt;/code&gt;
+    object are those that have either an &lt;code title=attr-id&gt;&lt;a
+    href=&quot;#id&quot;&gt;id&lt;/a&gt;&lt;/code&gt; attribute or a &lt;code
+    title=attr-option-name&gt;name&lt;/code&gt; attribute equal to &lt;var
+    title=&quot;&quot;&gt;key&lt;/var&gt;. The nodes in the &lt;code&gt;NodeList&lt;/code&gt; object must be
+    sorted in &lt;a href=&quot;#tree-order&quot;&gt;tree order&lt;/a&gt;.
+
+   &lt;li&gt;Return that &lt;code&gt;NodeList&lt;/code&gt; object.
+  &lt;/ol&gt;
+  &lt;!-- see also <A HREF="http://ln.hixie.ch/?start=1161042744&amp;count=1">http://ln.hixie.ch/?start=1161042744&amp;count=1</A> --&gt;
+
+  &lt;p class=big-issue&gt;We may want to add &lt;code&gt;add()&lt;/code&gt; and
+   &lt;code&gt;remove()&lt;/code&gt; methods here too because IE implements
+   HTMLSelectElement and HTMLOptionsCollection on the same object, and so
+   people use them almost interchangeably in the wild.
+
+  &lt;h4 id=domtokenlist&gt;&lt;span class=secno&gt;2.8.3 &lt;/span&gt;DOMTokenList&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; interface
+   represents an interface to an underlying string that consists of an &lt;a
+   href=&quot;#unordered&quot;&gt;unordered set of unique space-separated tokens&lt;/a&gt;.
+
+  &lt;p&gt;Which string underlies a particular &lt;code&gt;&lt;a
+   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object is defined when the
+   object is created. It might be a content attribute (e.g. the string that
+   underlies the &lt;code title=dom-classList&gt;&lt;a
+   href=&quot;#classlist&quot;&gt;classList&lt;/a&gt;&lt;/code&gt; object is the &lt;code
+   title=attr-class&gt;&lt;a href=&quot;#class&quot;&gt;class&lt;/a&gt;&lt;/code&gt; attribute), or it might
+   be an anonymous string (e.g. when a &lt;code&gt;&lt;a
+   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object is passed to an
+   author-implemented callback in the &lt;code&gt;&lt;a
+   href=&quot;#datagrid0&quot;&gt;datagrid&lt;/a&gt;&lt;/code&gt; APIs).
+
+  &lt;pre
+   class=idl&gt;[&lt;a href=&quot;#stringify&quot; title=dom-tokenlist-toString&gt;Stringifies&lt;/a&gt;] interface &lt;dfn id=domtokenlist0&gt;DOMTokenList&lt;/dfn&gt; {
+  readonly attribute unsigned long &lt;a href=&quot;#length2&quot; title=dom-tokenlist-length&gt;length&lt;/a&gt;;
+  [IndexGetter] DOMString &lt;a href=&quot;#itemindex2&quot; title=dom-tokenlist-item&gt;item&lt;/a&gt;(in unsigned long index);
+  boolean &lt;a href=&quot;#hastoken&quot; title=dom-tokenlist-has&gt;has&lt;/a&gt;(in DOMString token);
+  void &lt;a href=&quot;#addtoken&quot; title=dom-tokenlist-add&gt;add&lt;/a&gt;(in DOMString token);
+  void &lt;a href=&quot;#remove0&quot; title=dom-tokenlist-remove&gt;remove&lt;/a&gt;(in DOMString token);
+  boolean &lt;a href=&quot;#toggle&quot; title=dom-tokenlist-toggle&gt;toggle&lt;/a&gt;(in DOMString token);
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn id=length2 title=dom-tokenlist-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+   attribute must return the number of &lt;em&gt;unique&lt;/em&gt; tokens that result
+   from &lt;a href=&quot;#split&quot; title=&quot;split a string on spaces&quot;&gt;splitting the
+   underlying string on spaces&lt;/a&gt;.
+
+  &lt;p&gt;The &lt;dfn id=itemindex2 title=dom-tokenlist-item&gt;&lt;code&gt;item(&lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must &lt;a href=&quot;#split&quot;
+   title=&quot;split a string on spaces&quot;&gt;split the underlying string on
+   spaces&lt;/a&gt;, sort the resulting list of tokens by Unicode
+   codepoint&lt;!-- XXX that's
+  basically nonsense. What sort order do we want here? It should be
+  the cheapest one possible that is well-defined for all Unicode. --&gt;,
+   remove exact duplicates, and then return the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th
+   item in this list. If &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; is equal to or greater
+   than the number of tokens, then the method must return null.
+
+  &lt;p&gt;The &lt;dfn id=hastoken title=dom-tokenlist-has&gt;&lt;code&gt;has(&lt;var
+   title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+   algorithm:
+
+  &lt;ol&gt;
+   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;a
+    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, then raise an
+    &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the algorithm.
+
+   &lt;li&gt;Otherwise, &lt;a href=&quot;#split&quot; title=&quot;split a string on spaces&quot;&gt;split the
+    underlying string on spaces&lt;/a&gt; to get the list of tokens in the object's
+    underlying string.
+
+   &lt;li&gt;If the token indicated by &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is one of the
+    tokens in the object's underlying string then return true and stop this
+    algorithm.
+
+   &lt;li&gt;Otherwise, return false.
+  &lt;/ol&gt;
+
+  &lt;p&gt;The &lt;dfn id=addtoken title=dom-tokenlist-add&gt;&lt;code&gt;add(&lt;var
+   title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+   algorithm:
+
+  &lt;ol&gt;
+   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;a
+    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, then raise an
+    &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the algorithm.
+
+   &lt;li&gt;Otherwise, &lt;a href=&quot;#split&quot; title=&quot;split a string on spaces&quot;&gt;split the
+    underlying string on spaces&lt;/a&gt; to get the list of tokens in the object's
+    underlying string.
+
+   &lt;li&gt;If the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is already one of the tokens in
+    the &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
+    underlying string then stop the algorithm.
+
+   &lt;li&gt;Otherwise, if the &lt;code&gt;&lt;a
+    href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's underlying string
+    is not the empty string and the last character of that string is not a &lt;a
+    href=&quot;#space&quot;&gt;space character&lt;/a&gt;, then append a U+0020 SPACE character
+    to the end of that string.
+
+   &lt;li&gt;Append the value of &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; to the end of the
+    &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
+    underlying string.
+  &lt;/ol&gt;
+
+  &lt;p&gt;The &lt;dfn id=remove0 title=dom-tokenlist-remove&gt;&lt;code&gt;remove(&lt;var
+   title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+   algorithm:
+
+  &lt;ol&gt;
+   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;a
+    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, then raise an
+    &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the algorithm.
+
+   &lt;li&gt;Otherwise, &lt;a href=&quot;#remove&quot; title=&quot;remove a token from a
+    string&quot;&gt;remove the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; from the underlying
+    string&lt;/a&gt;.
+  &lt;/ol&gt;
+
+  &lt;p&gt;The &lt;dfn id=toggle title=dom-tokenlist-toggle&gt;&lt;code&gt;toggle(&lt;var
+   title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+   algorithm:
+
+  &lt;ol&gt;
+   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;a
+    href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, then raise an
+    &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the algorithm.
+
+   &lt;li&gt;Otherwise, &lt;a href=&quot;#split&quot; title=&quot;split a string on spaces&quot;&gt;split the
+    underlying string on spaces&lt;/a&gt; to get the list of tokens in the object's
+    underlying string.
+
+   &lt;li&gt;If the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is already one of the tokens in
+    the &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
+    underlying string then &lt;a href=&quot;#remove&quot; title=&quot;remove a token from a
+    string&quot;&gt;remove the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; from the underlying
+    string&lt;/a&gt;, and stop the algorithm, returning false.
+
+   &lt;li&gt;Otherwise, if the &lt;code&gt;&lt;a
+    href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's underlying string
+    is not the empty string and the last character of that string is not a &lt;a
+    href=&quot;#space&quot;&gt;space character&lt;/a&gt;, then append a U+0020 SPACE character
+    to the end of that string.
+
+   &lt;li&gt;Append the value of &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; to the end of the
+    &lt;code&gt;&lt;a href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; object's
+    underlying string.
+
+   &lt;li&gt;Return true.
+  &lt;/ol&gt;
+
+  &lt;p&gt;Objects implementing the &lt;code&gt;&lt;a
+   href=&quot;#domtokenlist0&quot;&gt;DOMTokenList&lt;/a&gt;&lt;/code&gt; interface must &lt;dfn
+   id=stringify title=dom-tokenlist-toString&gt;stringify&lt;/dfn&gt; to the object's
+   underlying string representation.
+
+  &lt;h4 id=domstringmap&gt;&lt;span class=secno&gt;2.8.4 &lt;/span&gt;DOMStringMap&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#domstringmap0&quot;&gt;DOMStringMap&lt;/a&gt;&lt;/code&gt; interface
+   represents a set of name-value pairs. When a &lt;code&gt;&lt;a
+   href=&quot;#domstringmap0&quot;&gt;DOMStringMap&lt;/a&gt;&lt;/code&gt; object is instanced, it is
+   associated with three algorithms, one for getting values from names, one
+   for setting names to certain values, and one for deleting names.
+
+  &lt;p class=big-issue&gt;The names of the methods on this interface are temporary
+   and will be fixed when the Web IDL / &quot;Language Bindings for DOM
+   Specifications&quot; spec is ready to handle this case.
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=domstringmap0&gt;DOMStringMap&lt;/dfn&gt; {
+  [NameGetter] DOMString &lt;a href=&quot;#xxx1name&quot; title=dom-stringmap-XXX1&gt;XXX1&lt;/a&gt;(in DOMString name); &lt;!-- XXX DOMB --&gt;
+  [NameSetter] void &lt;a href=&quot;#xxx2name&quot; title=dom-stringmap-XXX2&gt;XXX2&lt;/a&gt;(in DOMString name, in DOMString value); &lt;!-- XXX DOMB --&gt;
+  [XXX] boolean &lt;a href=&quot;#xxx3name&quot; title=dom-stringmap-XXX3&gt;XXX3&lt;/a&gt;(in DOMString name); &lt;!-- XXX DOMB --&gt;
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn id=xxx1name title=dom-stringmap-XXX1&gt;&lt;code&gt;XXX1(&lt;var
+   title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must call the algorithm for
+   getting values from names, passing &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the name,
+   and must return the corresponding value, or null if &lt;var
+   title=&quot;&quot;&gt;name&lt;/var&gt; has no corresponding value.
+
+  &lt;p&gt;The &lt;dfn id=xxx2name title=dom-stringmap-XXX2&gt;&lt;code&gt;XXX2(&lt;var
+   title=&quot;&quot;&gt;name&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must
+   call the algorithm for setting names to certain values, passing &lt;var
+   title=&quot;&quot;&gt;name&lt;/var&gt; as the name and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; as the
+   value.
+
+  &lt;p&gt;The &lt;dfn id=xxx3name title=dom-stringmap-XXX3&gt;&lt;code&gt;XXX3(&lt;var
+   title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must call the algorithm for
+   deleting names, passing &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the name, and must
+   return true.
+
+  &lt;h4 id=dom-feature&gt;&lt;span class=secno&gt;2.8.5 &lt;/span&gt;DOM feature strings&lt;/h4&gt;
+
+  &lt;p&gt;DOM3 Core defines mechanisms for checking for interface support, and for
+   obtaining implementations of interfaces, using &lt;a
+   href=&quot;<A HREF="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures">http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures</A>&quot;&gt;feature
+   strings&lt;/a&gt;. &lt;a href=&quot;#refsDOM3CORE&quot;&gt;[DOM3CORE]&lt;/a&gt;
+
+  &lt;p&gt;A DOM application can use the &lt;dfn id=hasfeature
+   title=hasFeature&gt;&lt;code&gt;hasFeature(&lt;var title=&quot;&quot;&gt;feature&lt;/var&gt;, &lt;var
+   title=&quot;&quot;&gt;version&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method of the
+   &lt;code&gt;DOMImplementation&lt;/code&gt; interface with parameter values &quot;&lt;code
+   title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; and &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; (respectively) to determine
+   whether or not this module is supported by the implementation. In addition
+   to the feature string &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;, the feature string
+   &quot;&lt;code title=&quot;&quot;&gt;XHTML&lt;/code&gt;&quot; (with version string &quot;&lt;code&gt;5.0&lt;/code&gt;&quot;) can
+   be used to check if the implementation supports XHTML. User agents should
+   respond with a true value when the &lt;code&gt;&lt;a
+   href=&quot;#hasfeature&quot;&gt;hasFeature&lt;/a&gt;&lt;/code&gt; method is queried with these
+   values. Authors are cautioned, however, that UAs returning true might not
+   be perfectly compliant, and that UAs returning false might well have
+   support for features in this specification; in general, therefore, use of
+   this method is discouraged.
+
+  &lt;p&gt;The values &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; and &quot;&lt;code
+   title=&quot;&quot;&gt;XHTML&lt;/code&gt;&quot; (both with version &quot;&lt;code&gt;5.0&lt;/code&gt;&quot;) should also
+   be supported in the context of the &lt;code&gt;getFeature()&lt;/code&gt; and
+   &lt;code&gt;isSupported()&lt;/code&gt; methods, as defined by DOM3 Core.
+
+  &lt;p class=note&gt;The interfaces defined in this specification are not always
+   supersets of the interfaces defined in DOM2 HTML; some features that were
+   formerly deprecated, poorly supported, rarely used or considered
+   unnecessary have been removed. Therefore it is not guaranteed that an
+   implementation that supports &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;
+   &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; also supports &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;
+   &quot;&lt;code&gt;2.0&lt;/code&gt;&quot;.
+
   &lt;h2 id=dom&gt;&lt;span class=secno&gt;3. &lt;/span&gt;Semantics and structure of HTML
    documents&lt;/h2&gt;
 
@@ -9089,7 +9089,7 @@
    address of the document's &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; &lt;a
    href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;manifest&lt;/a&gt;, if
    there is one. If the attribute is present, the attribute's value must be a
-   &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;.
+   &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;.
 
   &lt;p&gt;The &lt;code title=attr-html-manifest&gt;&lt;a
    href=&quot;#manifest&quot;&gt;manifest&lt;/a&gt;&lt;/code&gt; attribute only &lt;a
@@ -9250,7 +9250,7 @@
    attribute, or both.
 
   &lt;p&gt;The &lt;dfn id=href title=attr-base-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt; content
-   attribute, if specified, must contain a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;.
+   attribute, if specified, must contain a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;.
 
   &lt;p&gt;A &lt;code&gt;&lt;a href=&quot;#base&quot;&gt;base&lt;/a&gt;&lt;/code&gt; element, if it has an &lt;code
    title=attr-base-href&gt;&lt;a href=&quot;#href&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute, must come
@@ -9346,7 +9346,7 @@
 
   &lt;p&gt;The destination of the link is given by the &lt;dfn id=href1
    title=attr-link-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt; attribute, which must be
-   present and must contain a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;. If the &lt;code
+   present and must contain a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;. If the &lt;code
    title=attr-link-href&gt;&lt;a href=&quot;#href1&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute is absent,
    then the element does not define a link.
 
@@ -10136,16 +10136,16 @@
      attribute must have a value consisting either of:
 
     &lt;ul&gt;
-     &lt;li&gt; just a &lt;a href=&quot;#valid0&quot;&gt;valid non-negative integer&lt;/a&gt;, or
+     &lt;li&gt; just a &lt;a href=&quot;#valid&quot;&gt;valid non-negative integer&lt;/a&gt;, or
 
-     &lt;li&gt; a &lt;a href=&quot;#valid0&quot;&gt;valid non-negative integer&lt;/a&gt;, followed by a
+     &lt;li&gt; a &lt;a href=&quot;#valid&quot;&gt;valid non-negative integer&lt;/a&gt;, followed by a
       U+003B SEMICOLON (&lt;code title=&quot;&quot;&gt;;&lt;/code&gt;), followed by one or more &lt;a
       href=&quot;#space&quot; title=&quot;space character&quot;&gt;space characters&lt;/a&gt;, followed by
       either a U+0055 LATIN CAPITAL LETTER U or a U+0075 LATIN SMALL LETTER
       U, a U+0052 LATIN CAPITAL LETTER R or a U+0072 LATIN SMALL LETTER R, a
       U+004C LATIN CAPITAL LETTER L or a U+006C LATIN SMALL LETTER L, a
       U+003D EQUALS SIGN (&lt;code title=&quot;&quot;&gt;=&lt;/code&gt;), and then a &lt;a
-      href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;.
+      href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;.
     &lt;/ul&gt;
 
     &lt;p&gt;In the former case, the integer represents a number of seconds before
@@ -11928,7 +11928,7 @@
    title=attr-blockquote-cite&gt;&lt;code&gt;cite&lt;/code&gt;&lt;/dfn&gt; attribute.
 
   &lt;p&gt;If the &lt;code title=attr-blockquote-cite&gt;&lt;a href=&quot;#cite&quot;&gt;cite&lt;/a&gt;&lt;/code&gt;
-   attribute is present, it must be a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;. User
+   attribute is present, it must be a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;. User
    agents should allow users to follow such citation links.
 
   &lt;p&gt;If a &lt;code&gt;&lt;a href=&quot;#blockquote&quot;&gt;blockquote&lt;/a&gt;&lt;/code&gt; element is &lt;a
@@ -12000,7 +12000,7 @@
    attribute is omitted, the list is an ascending list (1, 2, 3, ...).
 
   &lt;p&gt;The &lt;dfn id=start0 title=attr-ol-start&gt;&lt;code&gt;start&lt;/code&gt;&lt;/dfn&gt;
-   attribute, if present, must be a &lt;a href=&quot;#valid1&quot;&gt;valid integer&lt;/a&gt;
+   attribute, if present, must be a &lt;a href=&quot;#valid0&quot;&gt;valid integer&lt;/a&gt;
    giving the ordinal value of the first list item.
 
   &lt;p&gt;If the &lt;code title=attr-ol-start&gt;&lt;a href=&quot;#start0&quot;&gt;start&lt;/a&gt;&lt;/code&gt;
@@ -12185,7 +12185,7 @@
    element.
 
   &lt;p&gt;The &lt;dfn id=value title=attr-li-value&gt;&lt;code&gt;value&lt;/code&gt;&lt;/dfn&gt;
-   attribute, if present, must be a &lt;a href=&quot;#valid1&quot;&gt;valid integer&lt;/a&gt;
+   attribute, if present, must be a &lt;a href=&quot;#valid0&quot;&gt;valid integer&lt;/a&gt;
    giving the ordinal value of the list item.
 
   &lt;p&gt;If the &lt;code title=attr-li-value&gt;&lt;a href=&quot;#value&quot;&gt;value&lt;/a&gt;&lt;/code&gt;
@@ -12758,7 +12758,7 @@
    &lt;dfn id=cite1 title=attr-q-cite&gt;&lt;code&gt;cite&lt;/code&gt;&lt;/dfn&gt; attribute.
 
   &lt;p&gt;If the &lt;code title=attr-q-cite&gt;&lt;a href=&quot;#cite1&quot;&gt;cite&lt;/a&gt;&lt;/code&gt;
-   attribute is present, it must be a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;. User
+   attribute is present, it must be a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;. User
    agents should allow users to follow such citation links.
 
   &lt;p&gt;If a &lt;code&gt;&lt;a href=&quot;#q&quot;&gt;q&lt;/a&gt;&lt;/code&gt; element is contained (directly or
@@ -13677,7 +13677,7 @@
   &lt;p&gt;&lt;strong&gt;Author requirements&lt;/strong&gt;: The &lt;code
    title=attr-progress-max&gt;&lt;a href=&quot;#max&quot;&gt;max&lt;/a&gt;&lt;/code&gt; and &lt;code
    title=attr-progress-value&gt;&lt;a href=&quot;#value1&quot;&gt;value&lt;/a&gt;&lt;/code&gt; attributes,
-   when present, must have values that are &lt;a href=&quot;#valid2&quot; title=&quot;valid
+   when present, must have values that are &lt;a href=&quot;#valid1&quot; title=&quot;valid
    floating point number&quot;&gt;valid floating point numbers&lt;/a&gt;. The &lt;code
    title=attr-progress-max&gt;&lt;a href=&quot;#max&quot;&gt;max&lt;/a&gt;&lt;/code&gt; attribute, if
    present, must have a value greater than zero. The &lt;code
@@ -13892,7 +13892,7 @@
    title=attr-meter-max&gt;&lt;a href=&quot;#max1&quot;&gt;max&lt;/a&gt;&lt;/code&gt;, and &lt;code
    title=attr-meter-optimum&gt;&lt;a href=&quot;#optimum&quot;&gt;optimum&lt;/a&gt;&lt;/code&gt; attributes
    are all optional. When present, they must have values that are &lt;a
-   href=&quot;#valid2&quot; title=&quot;valid floating point number&quot;&gt;valid floating point
+   href=&quot;#valid1&quot; title=&quot;valid floating point number&quot;&gt;valid floating point
    numbers&lt;/a&gt;, and their values must satisfy the following inequalities:
 
   &lt;ul class=brief&gt;
@@ -15138,7 +15138,7 @@
    part of that document that discusses the change.
 
   &lt;p&gt;If the &lt;code title=attr-mod-cite&gt;&lt;a href=&quot;#cite3&quot;&gt;cite&lt;/a&gt;&lt;/code&gt;
-   attribute is present, it must be a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; that
+   attribute is present, it must be a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt; that
    explains the change. User agents should allow users to follow such
    citation links.
 
@@ -15148,14 +15148,14 @@
 
   &lt;p&gt;If present, the &lt;code title=attr-mod-datetime&gt;&lt;a
    href=&quot;#datetime1&quot;&gt;datetime&lt;/a&gt;&lt;/code&gt; attribute must be a &lt;a
-   href=&quot;#valid6&quot;&gt;valid datetime&lt;/a&gt; value.
+   href=&quot;#valid5&quot;&gt;valid datetime&lt;/a&gt; value.
 
   &lt;p&gt;User agents must parse the &lt;code title=attr-mod-datetime&gt;&lt;a
    href=&quot;#datetime1&quot;&gt;datetime&lt;/a&gt;&lt;/code&gt; attribute according to the &lt;a
    href=&quot;#datetime-parser&quot;&gt;parse a string as a datetime value&lt;/a&gt; algorithm.
    If that doesn't return a time, then the modification has no associated
    timestamp (the value is non-conforming; it is not a &lt;a
-   href=&quot;#valid6&quot;&gt;valid datetime&lt;/a&gt;). Otherwise, the modification is marked
+   href=&quot;#valid5&quot;&gt;valid datetime&lt;/a&gt;). Otherwise, the modification is marked
    as having been made at the given datetime. User agents should use the
    associated timezone information to determine which timezone to present the
    given datetime in.
@@ -15491,7 +15491,7 @@
    content&lt;/a&gt;.
 
   &lt;p&gt;The &lt;code title=attr-img-src&gt;&lt;a href=&quot;#src&quot;&gt;src&lt;/a&gt;&lt;/code&gt; attribute
-   must be present, and must contain a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;
+   must be present, and must contain a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;
    referencing a non-interactive, optionally animated, image resource that is
    neither paged nor scripted.
 
@@ -16203,7 +16203,7 @@
   &lt;p&gt;The &lt;dfn id=src1 title=attr-iframe-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt; attribute
    gives the address of a page that the nested &lt;a href=&quot;#browsing1&quot;&gt;browsing
    context&lt;/a&gt; is to contain. The attribute, if present, must be a &lt;a
-   href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;. When the browsing context is created, if the
+   href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;. When the browsing context is created, if the
    attribute is present, the user agent must &lt;a href=&quot;#navigate&quot;&gt;navigate&lt;/a&gt;
    the element's browsing context to the given &lt;a href=&quot;#url&quot;&gt;URL&lt;/a&gt;, with
    &lt;a href=&quot;#replacement&quot;&gt;replacement enabled&lt;/a&gt;, and with the &lt;code&gt;&lt;a
@@ -16638,7 +16638,7 @@
 
   &lt;p&gt;The &lt;dfn id=src3 title=attr-embed-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt; attribute
    gives the address of the resource being embedded. The attribute, if
-   present, must contain a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;.
+   present, must contain a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;.
 
   &lt;p&gt;The &lt;dfn id=type4 title=attr-embed-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;
    attribute, if present, gives the MIME type of the plugin to instantiate.
@@ -16851,7 +16851,7 @@
 
   &lt;p&gt;The &lt;dfn id=data title=attr-object-data&gt;&lt;code&gt;data&lt;/code&gt;&lt;/dfn&gt;
    attribute, if present, specifies the address of the resource. If present,
-   the attribute must be a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;.
+   the attribute must be a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;.
 
   &lt;p&gt;The &lt;dfn id=type6 title=attr-object-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;
    attribute, if present, specifies the type of the resource. If present, the
@@ -17321,8 +17321,8 @@
   &lt;p&gt;The &lt;dfn id=poster title=attr-video-poster&gt;&lt;code&gt;poster&lt;/code&gt;&lt;/dfn&gt;
    attribute gives the address of an image file that the user agent can show
    while no video data is available. The attribute, if present, must contain
-   a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;. If the specified resource is to be used,
-   it must be fetched when the element is created or when the &lt;code
+   a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;. If the specified resource is to be
+   used, it must be fetched when the element is created or when the &lt;code
    title=attr-video-poster&gt;&lt;a href=&quot;#poster&quot;&gt;poster&lt;/a&gt;&lt;/code&gt; attribute is
    set. The &lt;dfn id=poster0&gt;poster frame&lt;/dfn&gt; is then the image obtained
    from that resource, if any.&lt;/p&gt;
@@ -17727,7 +17727,7 @@
 
   &lt;p&gt;The &lt;dfn id=src5 title=attr-source-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt; attribute
    gives the address of the &lt;a href=&quot;#media10&quot;&gt;media resource&lt;/a&gt;. The value
-   must be a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;. This attribute must be present.
+   must be a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;. This attribute must be present.
 
   &lt;p&gt;The &lt;dfn id=type8 title=attr-source-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;
    attribute gives the type of the &lt;a href=&quot;#media10&quot;&gt;media resource&lt;/a&gt;, to
@@ -17873,7 +17873,7 @@
    href=&quot;#media10&quot; title=&quot;media resource&quot;&gt;media resources&lt;/a&gt; that do not
    self-describe their &lt;a href=&quot;#adjusted1&quot;
    title=concept-video-adjusted-ratio&gt;pixel ratio&lt;/a&gt;. The attribute value,
-   if specified, must be a &lt;a href=&quot;#valid2&quot;&gt;valid floating point number&lt;/a&gt;
+   if specified, must be a &lt;a href=&quot;#valid1&quot;&gt;valid floating point number&lt;/a&gt;
    giving the ratio of the correct rendered width of each pixel to the actual
    height of each pixel in the image. The default value, if the attribute is
    omitted or cannot be parsed, is 1.0.
@@ -18076,7 +18076,7 @@
   &lt;p&gt;The &lt;dfn id=src7 title=attr-media-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt; content
    attribute on &lt;a href=&quot;#media7&quot; title=&quot;media element&quot;&gt;media elements&lt;/a&gt;
    gives the address of the media resource (video, audio) to show. The
-   attribute, if present, must contain a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;.
+   attribute, if present, must contain a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;.
 
   &lt;p&gt;If the &lt;code title=attr-media-src&gt;&lt;a href=&quot;#src7&quot;&gt;src&lt;/a&gt;&lt;/code&gt;
    attribute of a &lt;a href=&quot;#media7&quot;&gt;media element&lt;/a&gt; that is already in a
@@ -20276,7 +20276,7 @@
    to control the size of the coordinate space: &lt;dfn id=width0
    title=attr-canvas-width&gt;&lt;code&gt;width&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn id=height0
    title=attr-canvas-height&gt;&lt;code&gt;height&lt;/code&gt;&lt;/dfn&gt;. These attributes, when
-   specified, must have values that are &lt;a href=&quot;#valid0&quot; title=&quot;valid
+   specified, must have values that are &lt;a href=&quot;#valid&quot; title=&quot;valid
    non-negative integer&quot;&gt;valid non-negative integers&lt;/a&gt;. The &lt;a
    href=&quot;#rules&quot;&gt;rules for parsing non-negative integers&lt;/a&gt; must be used to
    obtain their numeric values. If an attribute is missing, or if parsing its
@@ -23055,7 +23055,7 @@
    href=&quot;#rectangle0&quot; title=attr-area-shape-rect&gt;rectangle&lt;/a&gt; state.
 
   &lt;p&gt;The &lt;dfn id=coords title=attr-area-coords&gt;&lt;code&gt;coords&lt;/code&gt;&lt;/dfn&gt;
-   attribute must, if specified, contain a &lt;a href=&quot;#valid5&quot;&gt;valid list of
+   attribute must, if specified, contain a &lt;a href=&quot;#valid4&quot;&gt;valid list of
    integers&lt;/a&gt;. This attribute gives the coordinates for the shape described
    by the &lt;code title=attr-area-shape&gt;&lt;a href=&quot;#shape&quot;&gt;shape&lt;/a&gt;&lt;/code&gt;
    attribute. The processing for this attribute is described as part of the
@@ -23185,7 +23185,7 @@
    &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a
    href=&quot;#object&quot;&gt;object&lt;/a&gt;&lt;/code&gt; element. The &lt;code
    title=attr-area-usemap&gt;usemap&lt;/code&gt; attribute, if specified, must be a &lt;a
-   href=&quot;#valid8&quot;&gt;valid hash-name reference&lt;/a&gt; to a &lt;code&gt;&lt;a
+   href=&quot;#valid7&quot;&gt;valid hash-name reference&lt;/a&gt; to a &lt;code&gt;&lt;a
    href=&quot;#map&quot;&gt;map&lt;/a&gt;&lt;/code&gt; element.
 
   &lt;p&gt;If an &lt;code&gt;&lt;a href=&quot;#img&quot;&gt;img&lt;/a&gt;&lt;/code&gt; element or an &lt;code&gt;&lt;a
@@ -23507,7 +23507,7 @@
    give the dimensions of the visual content of the element (the width and
    height respectively, relative to the nominal direction of the output
    medium), in CSS pixels. The attributes, if specified, must have values
-   that are &lt;a href=&quot;#valid4&quot;&gt;valid positive non-zero integers&lt;/a&gt;.
+   that are &lt;a href=&quot;#valid3&quot;&gt;valid positive non-zero integers&lt;/a&gt;.
 
   &lt;p&gt;The specified dimensions given may differ from the dimensions specified
    in the resource itself, since the resource may have a resolution that
@@ -23923,7 +23923,7 @@
   &lt;p&gt;If the &lt;code&gt;&lt;a href=&quot;#colgroup&quot;&gt;colgroup&lt;/a&gt;&lt;/code&gt; element contains no
    &lt;code&gt;&lt;a href=&quot;#col&quot;&gt;col&lt;/a&gt;&lt;/code&gt; elements, then the element may have a
    &lt;dfn id=span0 title=attr-colgroup-span&gt;&lt;code&gt;span&lt;/code&gt;&lt;/dfn&gt; content
-   attribute specified, whose value must be a &lt;a href=&quot;#valid0&quot;&gt;valid
+   attribute specified, whose value must be a &lt;a href=&quot;#valid&quot;&gt;valid
    non-negative integer&lt;/a&gt; greater than zero.
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#colgroup&quot;&gt;colgroup&lt;/a&gt;&lt;/code&gt; element and its &lt;code
@@ -23977,7 +23977,7 @@
 
   &lt;p&gt;The element may have a &lt;dfn id=span2
    title=attr-col-span&gt;&lt;code&gt;span&lt;/code&gt;&lt;/dfn&gt; content attribute specified,
-   whose value must be a &lt;a href=&quot;#valid0&quot;&gt;valid non-negative integer&lt;/a&gt;
+   whose value must be a &lt;a href=&quot;#valid&quot;&gt;valid non-negative integer&lt;/a&gt;
    greater than zero.
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#col&quot;&gt;col&lt;/a&gt;&lt;/code&gt; element and its &lt;code
@@ -24450,13 +24450,13 @@
   &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#td&quot;&gt;td&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a
    href=&quot;#th&quot;&gt;th&lt;/a&gt;&lt;/code&gt; elements may have a &lt;dfn id=colspan
    title=attr-tdth-colspan&gt;&lt;code&gt;colspan&lt;/code&gt;&lt;/dfn&gt; content attribute
-   specified, whose value must be a &lt;a href=&quot;#valid0&quot;&gt;valid non-negative
+   specified, whose value must be a &lt;a href=&quot;#valid&quot;&gt;valid non-negative
    integer&lt;/a&gt; greater than zero.
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#td&quot;&gt;td&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a
    href=&quot;#th&quot;&gt;th&lt;/a&gt;&lt;/code&gt; elements may also have a &lt;dfn id=rowspan
    title=attr-tdth-rowspan&gt;&lt;code&gt;rowspan&lt;/code&gt;&lt;/dfn&gt; content attribute
-   specified, whose value must be a &lt;a href=&quot;#valid0&quot;&gt;valid non-negative
+   specified, whose value must be a &lt;a href=&quot;#valid&quot;&gt;valid non-negative
    integer&lt;/a&gt;.
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#td&quot;&gt;td&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a
@@ -25557,7 +25557,7 @@
 
   &lt;p&gt;The &lt;dfn id=src9 title=attr-script-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt; attribute,
    if specified, gives the address of the external script resource to use.
-   The value of the attribute must be a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;
+   The value of the attribute must be a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;
    identifying a script resource of the type given by the &lt;code
    title=attr-script-type&gt;&lt;a href=&quot;#type11&quot;&gt;type&lt;/a&gt;&lt;/code&gt; attribute, if the
    attribute is present, or of the type &quot;&lt;code
@@ -26194,7 +26194,7 @@
    represents a target for events generated by a remote server.
 
   &lt;p&gt;The &lt;dfn id=src11 title=attr-eventsource-src&gt;&lt;code&gt;src&lt;/code&gt;&lt;/dfn&gt;
-   attribute, if specified, must give a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;
+   attribute, if specified, must give a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;
    identifying a resource that uses the &lt;code&gt;text/event-stream&lt;/code&gt;
    format.
 
@@ -28523,7 +28523,7 @@
 
   &lt;p&gt;The &lt;dfn id=icon title=attr-command-icon&gt;&lt;code&gt;icon&lt;/code&gt;&lt;/dfn&gt;
    attribute gives a picture that represents the command. If the attribute is
-   specified, the attribute's value must contain a &lt;a href=&quot;#valid&quot;&gt;valid
+   specified, the attribute's value must contain a &lt;a href=&quot;#valid8&quot;&gt;valid
    URL&lt;/a&gt;.
 
   &lt;p&gt;The &lt;dfn id=hidden title=attr-command-hidden&gt;&lt;code&gt;hidden&lt;/code&gt;&lt;/dfn&gt;
@@ -29969,7 +29969,7 @@
    processing model is to be applied to that element.
 
   &lt;p&gt;The &lt;code title=attr-template&gt;&lt;a href=&quot;#template&quot;&gt;template&lt;/a&gt;&lt;/code&gt;
-   attribute, when specified, must be a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; to an
+   attribute, when specified, must be a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt; to an
    XML or HTML document, or a fragment identifier pointing at another part of
    the document. If there is a fragment identifier present, then the element
    with that ID in the target document must be a &lt;code&gt;&lt;a
@@ -29985,7 +29985,7 @@
   &lt;p&gt;The &lt;dfn id=ref title=attr-ref&gt;&lt;code&gt;ref&lt;/code&gt;&lt;/dfn&gt; attribute may be
    specified on any element on which the &lt;code title=attr-template&gt;&lt;a
    href=&quot;#template&quot;&gt;template&lt;/a&gt;&lt;/code&gt; attribute is specified. If it is
-   specified, it must be a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; to an XML or HTML
+   specified, it must be a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt; to an XML or HTML
    document, or a fragment identifier pointing at another part of the
    document.
 
@@ -31315,9 +31315,9 @@
   &lt;p&gt;The method has four arguments, though they are all optional.
 
   &lt;p&gt;The first argument, &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, must be a &lt;a
-   href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; for a page to load in the browsing context. If
-   no arguments are provided, or if the first argument is the empty string,
-   then the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument defaults to
+   href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt; for a page to load in the browsing context.
+   If no arguments are provided, or if the first argument is the empty
+   string, then the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument defaults to
    &quot;&lt;code&gt;about:blank&lt;/code&gt;&lt;!-- XXX xref --&gt;&quot;. The argument must be &lt;a
    href=&quot;#resolve&quot; title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; to an &lt;a
    href=&quot;#absolute&quot;&gt;absolute URL&lt;/a&gt; (or an error) when the method is
@@ -33546,16 +33546,16 @@
     &lt;p&gt;When the current section is the explicit section or the online
      whitelist section, data lines must consist of zero or more U+0020 SPACE
      and U+0009 CHARACTER TABULATION (tab) characters, a &lt;a
-     href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; identifying a resource other than the
+     href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt; identifying a resource other than the
      manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER
      TABULATION (tab) characters.&lt;/p&gt;
 
     &lt;p&gt;When the current section is the fallback section, data lines must
      consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION
-     (tab) characters, a &lt;a href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; identifying a
+     (tab) characters, a &lt;a href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt; identifying a
      resource other than the manifest itself, one or more U+0020 SPACE and
      U+0009 CHARACTER TABULATION (tab) characters, another &lt;a
-     href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt; identifying a resource other than the
+     href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt; identifying a resource other than the
      manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER
      TABULATION (tab) characters.&lt;/p&gt;
 
@@ -37292,8 +37292,8 @@
 
   &lt;p&gt;The &lt;dfn id=href6 title=attr-hyperlink-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;
    attribute on a hyperlink element must have a value that is a &lt;a
-   href=&quot;#valid&quot;&gt;valid URL&lt;/a&gt;. This URL is the &lt;em&gt;destination resource&lt;/em&gt;
-   of the hyperlink.
+   href=&quot;#valid8&quot;&gt;valid URL&lt;/a&gt;. This URL is the &lt;em&gt;destination
+   resource&lt;/em&gt; of the hyperlink.
 
   &lt;div class=note&gt;
    &lt;p&gt;The &lt;code title=attr-hyperlink-href&gt;&lt;a href=&quot;#href6&quot;&gt;href&lt;/a&gt;&lt;/code&gt;
@@ -38166,7 +38166,7 @@
    href=&quot;#unordered&quot;&gt;unordered set of unique space-separated tokens&lt;/a&gt;. The
    values must all be either &lt;code title=attr-link-sizes-any&gt;&lt;a
    href=&quot;#any&quot;&gt;any&lt;/a&gt;&lt;/code&gt; or a value that consists of two &lt;a
-   href=&quot;#valid0&quot; title=&quot;valid non-negative integer&quot;&gt;valid non-negative
+   href=&quot;#valid&quot; title=&quot;valid non-negative integer&quot;&gt;valid non-negative
    integers&lt;/a&gt; that do not have a leading U+0030 DIGIT ZERO (0) character
    and that are separated by a single U+0078 LATIN SMALL LETTER X character.
 
@@ -38949,7 +38949,7 @@
 
   &lt;p&gt;The &lt;code title=attr-tabindex&gt;&lt;a href=&quot;#tabindex&quot;&gt;tabindex&lt;/a&gt;&lt;/code&gt;
    attribute, if specified, must have a value that is a &lt;a
-   href=&quot;#valid1&quot;&gt;valid integer&lt;/a&gt;.
+   href=&quot;#valid0&quot;&gt;valid integer&lt;/a&gt;.
 
   &lt;p&gt;If the attribute is specified, it must be parsed using the &lt;a
    href=&quot;#rules0&quot;&gt;rules for parsing integers&lt;/a&gt;. The attribute's values have

Modified: source
===================================================================
--- source	2008-08-01 00:46:19 UTC (rev 1969)
+++ source	2008-08-01 05:23:56 UTC (rev 1970)
@@ -995,676 +995,6 @@
 
 
 
-  &lt;h3&gt;URLs&lt;/h3&gt;
-
-  &lt;p&gt;This specification defines the term &lt;span&gt;URL&lt;/span&gt;, and defines
-  various algorithms for dealing with URLs, because for historical
-  reasons the rules defined by the URI and IRI specifications are not
-  a complete description of what HTML user agents need to implement to
-  be compatible with Web content.&lt;/p&gt;
-
-
-  &lt;h4&gt;Terminology&lt;/h4&gt;
-
-  &lt;p&gt;A &lt;dfn&gt;URL&lt;/dfn&gt; is a string used to identify a resource. &lt;span
-  id=&quot;urldoc&quot;&gt;A &lt;span&gt;URL&lt;/span&gt; is always associated with a
-  &lt;code&gt;Document&lt;/code&gt;, either explicitly when the URL is created or
-  defined; or through a DOM node, in which case the associated
-  &lt;code&gt;Document&lt;/code&gt; is the node's &lt;code&gt;Document&lt;/code&gt;; or
-  through a script, in which case the associated &lt;code&gt;Document&lt;/code&gt;
-  is the script's &lt;span&gt;script document context&lt;/span&gt;.&lt;/span&gt;&lt;/p&gt;
-
-  &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is a &lt;dfn&gt;valid URL&lt;/dfn&gt; if at least one of
-  the following conditions holds:&lt;/p&gt;
-
-  &lt;ul&gt;
-
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid URI reference &lt;a
-   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and it has no
-   query component. &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and its query
-   component contains no unescaped non-ASCII characters. &lt;a
-   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and the &lt;span
-   title=&quot;document's character encoding&quot;&gt;character encoding&lt;/span&gt; of
-   the URL's &lt;code&gt;Document&lt;/code&gt; is UTF-8 or UTF-16. &lt;a
-   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ul&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The term &quot;URL&quot; in this specification is used in a
-  manner distinct from the precise technical meaning it is given in
-  RFC 3986. Readers familiar with that RFC will find it easier to read
-  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
-  herein is really called something else altogether.&lt;/p&gt;
-
-
-  &lt;h4&gt;Parsing URLs&lt;/h4&gt;
-
-  &lt;p&gt;To &lt;dfn&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
-  component parts, the user agent must use the following steps:&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Strip leading and trailing &lt;span title=&quot;space
-   character&quot;&gt;space characters&lt;/span&gt; from &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC
-    3986, with the following exceptions:&lt;/p&gt;
-
-    &lt;ul&gt;
-
-     &lt;li&gt;Add all characters with codepoints less than or equal to
-     U+0020 or greater than or equal to U+007F to the
-     &lt;unreserved&gt; production.&lt;/li&gt;
-
-     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E,
-     U+0060, and U+007B .. U+007D to the &lt;unreserved&gt;
-     production.
-      &lt;!--
-       0022 QUOTATION MARK
-       003C LESS-THAN SIGN
-       003E GREATER-THAN SIGN
-       005B LEFT SQUARE BRACKET
-       005C REVERSE SOLIDUS
-       005D RIGHT SQUARE BRACKET
-       005E CIRCUMFLEX ACCENT
-       0060 GRAVE ACCENT
-       007B LEFT CURLY BRACKET
-       007C VERTICAL LINE
-       007D RIGHT CURLY BRACKET
-      --&gt;
-     &lt;/li&gt;
-
-     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second
-     alternative way of matching the &lt;pct-encoded&gt; production,
-     except when the &lt;pct-encoded&gt; is used in the
-     &lt;reg-name&gt; production.&lt;/li&gt;
-
-     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters
-     allowed in the &lt;fragment&gt; production.&lt;/li&gt;
-
-     &lt;!-- some browsers also have other differences, e.g. Mozilla
-     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
-     is &quot;ftp&quot;. --&gt;
-
-    &lt;/ul&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the
-    &lt;URI-reference&gt; production, even after the above changes are
-    made to the ABNF definitions, then parsing the URL fails with an
-    error. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
-    components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
-    defined as follows:&lt;/p&gt;
-
-    &lt;dl&gt;
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;host&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;port&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-hostport&quot;&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt;
-     component and the port given by the &lt;port&gt; component is
-     different than the default port defined for the protocol given by
-     the &lt;scheme&gt; component, then &lt;hostport&gt; is the
-     substring that starts with the substring matched by the
-     &lt;host&gt; production and ends with the substring matched by the
-     &lt;port&gt; production, and includes the colon in between the
-     two. Otherwise, it is the same as the &lt;host&gt; component.&lt;/p&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;The substring matched by one of the following productions, if
-      one of them was matched:&lt;/p&gt;
-
-      &lt;ul class=&quot;brief&quot;&gt;
-       &lt;li&gt;&lt;path-abempty&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-absolute&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-noscheme&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-rootless&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-empty&gt;&lt;/li&gt;
-      &lt;/ul&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;query&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;!-- XXX we might want to define &quot;server-based naming authority&quot;,
-  it's not clear RFC3986 does a good job of defining that anymore
-  (earlier URI specs did) --&gt;
-
-
-  &lt;h4&gt;Resolving URLs&lt;/h4&gt;
-
-  &lt;p&gt;Relative URLs are resolved relative to a base URL. The &lt;dfn&gt;base
-  URL&lt;/dfn&gt; of a &lt;span&gt;URL&lt;/span&gt; is the &lt;span&gt;absolute URL&lt;/span&gt;
-  obtained as follows:&lt;/p&gt;
-
-  &lt;dl class=&quot;switch&quot;&gt;
-
-   &lt;dt&gt;If the URL to be resolved was passed to an API&lt;/dt&gt;
-
-   &lt;dd&gt;&lt;p&gt;The base URL is the &lt;span&gt;document base URL&lt;/span&gt; of the
-   script's &lt;span&gt;script document context&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;If the URL to be resolved is from the value of a content
-   attribute&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The base URL is the &lt;i&gt;base URI of the element&lt;/i&gt; that the
-    attribute is on, as defined by the XML Base specification, with
-    &lt;i&gt;the base URI of the document entity&lt;/i&gt; being defined as the
-    &lt;span&gt;document base URL&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt; that
-    owns the element.&lt;/p&gt;
-
-    &lt;p&gt;For the purposes of the XML Base specification, user agents
-    must act as if all &lt;code&gt;Document&lt;/code&gt; objects represented XML
-    documents.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;It is possible for &lt;code
-    title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes to be present
-    even in HTML fragments, as such attributes can be added
-    dynamically using script. (Such scripts would not be conforming,
-    however, as &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes
-    are not allowed in &lt;span&gt;HTML documents&lt;/span&gt;.)&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;If the URL to be resolved was found in an offline application
-   cache manifest&lt;/dt&gt;
-
-   &lt;dd&gt;&lt;p&gt;The base URL is the URL of the &lt;span&gt;application
-   cache&lt;/span&gt; &lt;span
-   title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
-
-  &lt;/dl&gt;
-
-  &lt;p&gt;The &lt;dfn&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; is
-  the &lt;span&gt;absolute URL&lt;/span&gt; obtained by running these steps:&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;base&lt;/code&gt; element that is both a
-   child of &lt;span&gt;the &lt;code&gt;head&lt;/code&gt; element&lt;/span&gt; and has an
-   &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute, then the
-   &lt;span&gt;document base URL&lt;/span&gt; is &lt;span&gt;the document's
-   address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the
-   &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute of the first such
-   element.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a URL&quot;&gt;Resolve&lt;/span&gt; the &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt; URL, using &lt;span&gt;the document's
-   address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt; as the &lt;span&gt;base URL&lt;/span&gt;
-   (thus, the &lt;code&gt;base&lt;/code&gt; &lt;code
-   title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute isn't affect by &lt;code
-   title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes).&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;document base URL&lt;/span&gt; is the result of the
-   previous step if it was successful; otherwise it is &lt;span&gt;the
-   document's address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;To &lt;dfn&gt;resolve a URL&lt;/dfn&gt; to an &lt;span&gt;absolute URL&lt;/span&gt; the
-  user agent must use the following steps. Resolving a URL can result
-  in an error, in which case the URL is not resolvable.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;span&gt;URL&lt;/span&gt; being
-   resolved.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the
-   &lt;code&gt;Document&lt;/code&gt; &lt;a href=&quot;#urldoc&quot;&gt;associated with&lt;/a&gt; &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be the &lt;span
-   title=&quot;document's character encoding&quot;&gt;character encoding&lt;/span&gt; of
-   &lt;var title=&quot;&quot;&gt;document&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is UTF-16, then change it to
-   UTF-8.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;span&gt;base URL&lt;/span&gt;
-   for &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. (This is an &lt;span&gt;absolute
-   URL&lt;/span&gt;.)&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;parse a URL&quot;&gt;Parse&lt;/span&gt; &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
-    title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt; component, then replace the
-    matching subtring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from expanding any sequences of percent-encoded octets in
-    that component that are valid UTF-8 sequences into Unicode
-    characters as defined by UTF-8.&lt;/p&gt;
-
-    &lt;p&gt;If any percent-encoded octets in that component are not valid
-    UTF-8 sequences, then return an error and abort these steps.&lt;/p&gt;
-
-    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring,
-    with both the AllowUnassigned and UseSTD3ASCIIRules flags
-    set. Replace the matching substring with the result of the ToASCII
-    algorithm.&lt;/p&gt;
-
-    &lt;p&gt;If ToASCII fails to convert one of the components of the
-    string, e.g. because it is too long or because it contains invalid
-    characters, then return an error and abort these steps. &lt;a
-    href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
-    title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from applying the following steps to each character other
-    than U+0025 PERCENT SIGN (%) that doesn't match the original
-    &lt;path&gt; production defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;
-
-     &lt;li&gt;Encode the character into a sequence of octets as defined by
-     UTF-8.&lt;/li&gt;
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those
-     octets. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-    &lt;div class=&quot;example&quot;&gt;
-
-     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code
-     title=&quot;&quot;&gt;//example.com/a^b&amp;#x263a;c%FFd%z/?e&lt;/code&gt;&quot;, then the
-     &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component's substring
-     would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&amp;#x263a;c%FFd%z/&lt;/code&gt;&quot; and the two
-     characters that would have to be escaped would be &quot;&lt;code
-     title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&amp;#x263a;&lt;/code&gt;&quot;. The
-     result after this step was applied would therefore be that &lt;var
-     title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code
-     title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
-
-    &lt;/div&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
-    title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from applying the following steps to each character other
-    than U+0025 PERCENT SIGN (%) that doesn't match the original
-    &lt;query&gt; production defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;
-
-     &lt;li&gt;If the character in question cannot be expressed in the
-     encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a
-     single 0x3F octet (an ASCII question mark) and skip the remaining
-     substeps for this character.&lt;/li&gt;
-
-     &lt;li&gt;Encode the character into a sequence of octets as defined by
-     the encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;.&lt;/li&gt;
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those
-     octets. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2
-   Relative Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the
-   potentially relative URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and
-   &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URI (&lt;var
-   title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC
-    3987, returning an error and aborting these steps if
-    appropriate. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;For instance, if an absolute URI that would be
-    returned by the above algorithm violates the restrictions specific
-    to its scheme, e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the
-    &quot;&lt;code title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax,
-    then user agents are to treat this as an error instead.&lt;!-- RFC
-    3986, 3.1 Scheme --&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var
-   title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution
-   algorithm.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a
-   server-based naming authority, replace all U+005C REVERSE SOLIDUS
-   (\) characters in &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS
-   (/) characters.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is an &lt;dfn&gt;absolute URL&lt;/dfn&gt; if &lt;span
-  title=&quot;resolve a URL&quot;&gt;resolving&lt;/span&gt; it results in the same
-  URL without an error.&lt;/p&gt;
-
-
-  &lt;h4&gt;Dynamic changes to base URLs&lt;/h4&gt;
-
-  &lt;p&gt;When an &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attribute
-  changes, the attribute's element, and all descendant elements, are
-  &lt;span&gt;affected by a base URL change&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When a document's &lt;span&gt;document base URL&lt;/span&gt; changes, all
-  elements in that document are &lt;span&gt;affected by a base URL
-  change&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When an element is moved from one document to another, if the two
-  documents have different &lt;span title=&quot;document base URL&quot;&gt;base
-  URLs&lt;/span&gt;, then that element and all its descendants are
-  &lt;span&gt;affected by a base URL change&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When an element is &lt;dfn&gt;affected by a base URL change&lt;/dfn&gt;, it
-  must act as described in the following list:&lt;/p&gt;
-
-  &lt;dl class=&quot;switch&quot;&gt;
-
-   &lt;dt&gt;If the element is a &lt;span title=&quot;hyperlink&quot;&gt;hyperlink
-   element&lt;/span&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;If the &lt;span&gt;absolute URL&lt;/span&gt; identified by the hyperlink is
-    being shown to the user, or if any data derived from that URL is
-    affecting the display, then the &lt;code
-    title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute should be &lt;span
-    title=&quot;resolve a url&quot;&gt;reresolved&lt;/span&gt; and the UI updated
-    appropriately.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;For example, the CSS &lt;code
-    title=&quot;&quot;&gt;:link&lt;/code&gt;/&lt;code title=&quot;&quot;&gt;:visited&lt;/code&gt;
-    pseudo-classes might have been affected.&lt;/p&gt;
-
-    &lt;p&gt;If the hyperlink has a &lt;code
-    title=&quot;attr-hyperlink-ping&quot;&gt;ping&lt;/code&gt; attribute and its &lt;span
-    title=&quot;absolute URL&quot;&gt;absolute URL(s)&lt;/span&gt; are being shown to the
-    user, then the &lt;code title=&quot;attr-hyperlink-ping&quot;&gt;ping&lt;/code&gt;
-    attribute's tokens should be &lt;span title=&quot;resolve a
-    url&quot;&gt;reresolved&lt;/span&gt; and the UI updated appropriately.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;If the element is a &lt;code&gt;blockquote&lt;/code&gt;, &lt;code&gt;q&lt;/code&gt;,
-   &lt;code&gt;ins&lt;/code&gt;, or &lt;code&gt;del&lt;/code&gt; element with a &lt;code
-   title=&quot;&quot;&gt;cite&lt;/code&gt; attribute&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;If the &lt;span&gt;absolute URL&lt;/span&gt; identified by the &lt;code
-    title=&quot;&quot;&gt;cite&lt;/code&gt; attribute is being shown to the user, or if
-    any data derived from that URL is affecting the display, then the
-    it should be &lt;span title=&quot;resolve a url&quot;&gt;reresolved&lt;/span&gt; and the
-    UI updated appropriately.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The element is not directly affected.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;Changing the base URL doesn't affect the image
-    displayed by &lt;code&gt;img&lt;/code&gt; elements, although subsequent
-    accesses of the &lt;code title=&quot;dom-img-src&quot;&gt;src&lt;/code&gt; DOM attribute
-    from script will return a new &lt;span&gt;absolute URL&lt;/span&gt; that might
-    no longer correspond to the image being shown.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;
-
-
-
-
-
-  &lt;h4&gt;Interfaces for URL manipulation&lt;/h4&gt;
-
- &lt;p&gt;An interface that has a complement of &lt;dfn&gt;URL decomposition
-  attributes&lt;/dfn&gt; will have seven attributes with the following
-  definitions:&lt;/p&gt;
-
-&lt;pre class=&quot;idl&quot;&gt;
-           attribute DOMString &lt;span title=&quot;dom-uda-protocol&quot;&gt;protocol&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-host&quot;&gt;host&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-hostname&quot;&gt;hostname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-port&quot;&gt;port&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-pathname&quot;&gt;pathname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-search&quot;&gt;search&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-hash&quot;&gt;hash&lt;/span&gt;;
-&lt;/pre&gt;
-
-  &lt;p&gt;The attributes defined to be URL decomposition attributes must
-  act as described for the attributes with the same corresponding
-  names in this section.&lt;/p&gt;
-
-  &lt;p&gt;In addition, an interface with a complement of URL decomposition
-  attributes will define an &lt;dfn
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/dfn&gt;, which is a &lt;span&gt;URL&lt;/span&gt;
-  that the attributes act on, and a &lt;dfn
-  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/dfn&gt;, which is a
-  set of steps invoked when any of the attributes' setters are
-  invoked.&lt;/p&gt;
-
-  &lt;p&gt;The seven URL decomposition attributes have similar
-  requirements.&lt;/p&gt;
-
-  &lt;p&gt;On getting, if the &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt;
-  fulfills the condition given in the &quot;getter condition&quot; column
-  corresponding to the attribute in the table below, the user agent
-  must return the part of the &lt;span
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; URL given in the &quot;component&quot;
-  column, with any prefixes specified in the &quot;prefix&quot; column
-  appropriately added to the start of the string and any suffixes
-  specified in the &quot;suffix&quot; column appropriately added to the end of
-  the string. Otherwise, the attribute must return the empty
-  string.&lt;/p&gt;
-
-  &lt;p&gt;On setting, the new value must first be mutated as described by
-  the &quot;setter preprocessor&quot; column, then mutated by %-escaping any
-  characters in the new value that are not valid in the relevant
-  component as given by the &quot;component&quot; column. Then, if the resulting
-  new value fulfills the condition given in the &quot;setter condition&quot;
-  column, the user agent must make a new string &lt;var
-  title=&quot;&quot;&gt;output&lt;/var&gt; by replacing the component of the URL given by
-  the &quot;component&quot; column in the &lt;span
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; URL with the new value;
-  otherwise, the user agent must let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be
-  equal to the &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt;. Finally,
-  the user agent must invoke the &lt;span
-  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/span&gt; with the
-  value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When replacing a component in the URL, if the component is part
-  of an optional group in the URL syntax consisting of a character
-  followed by the component, the component (including its prefix
-  character) must be included even if the new value is the empty
-  string.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The previous paragraph applies in particular to the
-  &quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot; before a &lt;port&gt; component, the &quot;&lt;code
-  title=&quot;&quot;&gt;?&lt;/code&gt;&quot; before a &lt;query&gt; component, and the &quot;&lt;code
-  title=&quot;&quot;&gt;#&lt;/code&gt;&quot; before a &lt;fragment&gt; component.&lt;/p&gt;
-
-  &lt;p&gt;For the purposes of the above definitions, URLs must be parsed
-  using the &lt;span title=&quot;parse a URL&quot;&gt;URL parsing rules&lt;/span&gt; defined
-  in this specification.&lt;/p&gt;
-
-  &lt;table&gt;
-   &lt;thead&gt;      
-    &lt;tr&gt;
-     &lt;th&gt;Attribute
-     &lt;th&gt;Component
-     &lt;th&gt;Getter Condition
-     &lt;th&gt;Prefix
-     &lt;th&gt;Suffix
-     &lt;th&gt;Setter Preprocessor
-     &lt;th&gt;Setter Condition
-   &lt;tbody&gt;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;U+003A COLON (&quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;)
-     &lt;td&gt;Remove all trailing U+003A COLON (&quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;) characters
-     &lt;td&gt;The new value is not the empty string
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-hostport&quot;&gt;&lt;hostport&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical and uses a server-based naming authority
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical and uses a server-based naming authority
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove all leading U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;) characters
-     &lt;td&gt;&mdash;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical, uses a server-based naming authority, and contained a &lt;span title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/span&gt; component (possibly an empty one)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove any characters in the new value that are not in the range U+0030 DIGIT ZERO .. U+0039 DIGIT NINE.
-         If the resulting string is empty, set it to a single U+0030 DIGIT ZERO character ('0').
-     &lt;td&gt;&mdash;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-pathname&quot;&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;If it has no leading U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;) character, prepend a U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;) character to the new value
-     &lt;td&gt;&mdash;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-search&quot;&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical, and contained a &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component (possibly an empty one)
-     &lt;td&gt;U+003F QUESTION MARK (&quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove one leading U+003F QUESTION MARK (&quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;) character, if any
-     &lt;td&gt;&mdash;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-hash&quot;&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; contained a &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component (possibly an empty one)
-     &lt;td&gt;U+0023 NUMBER SIGN (&quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot;)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove one leading U+0023 NUMBER SIGN (&quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot;) character, if any
-     &lt;td&gt;&mdash;
-  &lt;/table&gt;
-
-&lt;!--
-  <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
-  <A HREF="http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp">http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp</A>
-  <A HREF="http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722">http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722</A>
---&gt;
-
-  &lt;div class=&quot;example&quot;&gt;
-
-   &lt;p&gt;The table below demonstrates how the getter condition for &lt;code
-   title=&quot;dom-uda-search&quot;&gt;search&lt;/code&gt; results in different results
-   depending on the exact original syntax of the URL:&lt;/p&gt;
-
-   &lt;table&gt;
-    &lt;thead&gt;
-     &lt;tr&gt;
-      &lt;th&gt; Input URL
-      &lt;th&gt; &lt;code title=&quot;dom-uda-search&quot;&gt;search&lt;/code&gt; value
-      &lt;th&gt; Explanation
-    &lt;tbody&gt;
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/&lt;/code">http://example.com/&lt;/code</A>&gt;
-      &lt;td&gt; &lt;i&gt;empty string&lt;/i&gt;
-      &lt;td&gt; No &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component in input URL.
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?&lt;/code">http://example.com/?&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
-      &lt;td&gt; There is a &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component, but it is empty. The question mark in the resulting value is the prefix.
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test&lt;/code">http://example.com/?test&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-      &lt;td&gt; The &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component has the value &quot;&lt;code title=&quot;&quot;&gt;test&lt;/code&gt;&quot;.
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test#&lt;/code">http://example.com/?test#&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-      &lt;td&gt; The (empty) &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component is not part of the &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component.
-   &lt;/table&gt;
-
-  &lt;/div&gt;
-
-
-
   &lt;h3&gt;Common microsyntaxes&lt;/h3&gt;
 
   &lt;p&gt;There are various places in HTML that accept particular data
@@ -3428,624 +2758,678 @@
   &lt;/ol&gt;
 
 
-  &lt;h3&gt;Common DOM interfaces&lt;/h3&gt;
 
-  &lt;h4&gt;Reflecting content attributes in DOM attributes&lt;/h4&gt;
 
-  &lt;p&gt;Some &lt;span title=&quot;DOM attribute&quot;&gt;DOM attributes&lt;/span&gt; are
-  defined to &lt;dfn&gt;reflect&lt;/dfn&gt; a particular &lt;span&gt;content
-  attribute&lt;/span&gt;. This means that on getting, the DOM attribute
-  returns the current value of the content attribute, and on setting,
-  the DOM attribute changes the value of the content attribute to the
-  given value.&lt;/p&gt;
+  &lt;h3&gt;URLs&lt;/h3&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt;
-  attribute whose content attribute is defined to contain a
-  &lt;span&gt;URL&lt;/span&gt;, then on getting, the DOM attribute must &lt;span
-  title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the value of the content
-  attribute and return the resulting &lt;span&gt;absolute URL&lt;/span&gt; if that
-  was successful, or the empty string otherwise; and on setting, must
-  set the content attribute to the specified literal value. If the
-  content attribute is absent, the DOM attribute must return the
-  default value, if the content attribute has one, or else the empty
-  string.&lt;/p&gt;
+  &lt;p&gt;This specification defines the term &lt;span&gt;URL&lt;/span&gt;, and defines
+  various algorithms for dealing with URLs, because for historical
+  reasons the rules defined by the URI and IRI specifications are not
+  a complete description of what HTML user agents need to implement to
+  be compatible with Web content.&lt;/p&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt;
-  attribute whose content attribute is defined to contain one or more
-  &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt;, then on getting, the DOM attribute
-  must &lt;span title=&quot;split the string on spaces&quot;&gt;split the content
-  attribute on spaces&lt;/span&gt; and return the concatenation of &lt;span
-  title=&quot;resolve a URL&quot;&gt;resolving&lt;/span&gt; each token URL to an
-  &lt;span&gt;absolute URL&lt;/span&gt;, with a single U+0020 SPACE character
-  between each URL, ignoring any tokens that did not resolve
-  successfully. If the content attribute is absent, the DOM attribute
-  must return the default value, if the content attribute has one, or
-  else the empty string. On setting, the DOM attribute must set the
-  content attribute to the specified literal value.&lt;/p&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; whose
-  content attribute is an &lt;span&gt;enumerated attribute&lt;/span&gt;, and the
-  DOM attribute is &lt;dfn&gt;limited to only known values&lt;/dfn&gt;, then, on
-  getting, the DOM attribute must return the conforming value
-  associated with the state the attribute is in (in its canonical
-  case), or the empty string if the attribute is in a state that has
-  no associated keyword value; and on setting, if the new value is an
-  &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for one of the keywords
-  given for that attribute, then the content attribute must be set to
-  the conforming value associated with the state that the attribute
-  would be in if set to the given new value, otherwise, if the new
-  value is the empty string, then the content attribute must be
-  removed, otherwise, the setter must raise a &lt;code&gt;SYNTAX_ERR&lt;/code&gt;
-  exception.&lt;/p&gt;
+  &lt;h4&gt;Terminology&lt;/h4&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; but
-  doesn't fall into any of the above categories, then the getting and
-  setting must be done in a transparent, case-preserving manner.&lt;/p&gt;
+  &lt;p&gt;A &lt;dfn&gt;URL&lt;/dfn&gt; is a string used to identify a resource. &lt;span
+  id=&quot;urldoc&quot;&gt;A &lt;span&gt;URL&lt;/span&gt; is always associated with a
+  &lt;code&gt;Document&lt;/code&gt;, either explicitly when the URL is created or
+  defined; or through a DOM node, in which case the associated
+  &lt;code&gt;Document&lt;/code&gt; is the node's &lt;code&gt;Document&lt;/code&gt;; or
+  through a script, in which case the associated &lt;code&gt;Document&lt;/code&gt;
+  is the script's &lt;span&gt;script document context&lt;/span&gt;.&lt;/span&gt;&lt;/p&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a boolean attribute, then on
-  getting the DOM attribute must return true if the attribute is set,
-  and false if it is absent. On setting, the content attribute must be
-  removed if the DOM attribute is set to false, and must be set to
-  have the same value as its name if the DOM attribute is set to
-  true. (This corresponds to the rules for &lt;span title=&quot;boolean
-  attribute&quot;&gt;boolean content attributes&lt;/span&gt;.)&lt;/p&gt;
+  &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is a &lt;dfn&gt;valid URL&lt;/dfn&gt; if at least one of
+  the following conditions holds:&lt;/p&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a signed integer type
-  (&lt;code&gt;long&lt;/code&gt;) then, on getting, the content attribute must be
-  parsed according to &lt;span title=&quot;rules for parsing integers&quot;&gt;the
-  rules for parsing signed integers&lt;/span&gt;, and if that is successful,
-  the resulting value must be returned. If, on the other hand, it
-  fails, or if the attribute is absent, then the default value must be
-  returned instead, or 0 if there is no default value. On setting, the
-  given value must be converted to the shortest possible string
-  representing the number as a &lt;span&gt;valid integer&lt;/span&gt; in base ten
-  and then that string must be used as the new content attribute
-  value.&lt;/p&gt;
+  &lt;ul&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is an &lt;em&gt;unsigned&lt;/em&gt; integer
-  type (&lt;code&gt;unsigned long&lt;/code&gt;) then, on getting, the content
-  attribute must be parsed according to &lt;span title=&quot;rules for parsing
-  non-negative integers&quot;&gt;the rules for parsing unsigned
-  integers&lt;/span&gt;, and if that is successful, the resulting value must
-  be returned. If, on the other hand, it fails, or if the attribute is
-  absent, the default value must be returned instead, or 0 if there is
-  no default value. On setting, the given value must be converted to
-  the shortest possible string representing the number as a
-  &lt;span&gt;valid non-negative integer&lt;/span&gt; in base ten and then that
-  string must be used as the new content attribute value.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid URI reference &lt;a
+   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is an unsigned integer type
-  (&lt;code&gt;unsigned long&lt;/code&gt;) that is &lt;dfn&gt;limited to only positive
-  non-zero numbers&lt;/dfn&gt;, then the behavior is similar to the previous
-  case, but zero is not allowed. On getting, the content attribute
-  must first be parsed according to &lt;span title=&quot;rules for parsing
-  non-negative integers&quot;&gt;the rules for parsing unsigned
-  integers&lt;/span&gt;, and if that is successful, the resulting value must
-  be returned. If, on the other hand, it fails, or if the attribute is
-  absent, the default value must be returned instead, or 1 if there is
-  no default value. On setting, if the value is zero, the user agent
-  must fire an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception. Otherwise, the
-  given value must be converted to the shortest possible string
-  representing the number as a &lt;span&gt;valid non-negative integer&lt;/span&gt;
-  in base ten and then that string must be used as the new content
-  attribute value.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and it has no
+   query component. &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a floating point number type
-  (&lt;code&gt;float&lt;/code&gt;) and the content attribute is defined to contain
-  a time offset, then, on getting, the content attribute must be
-  parsed according to &lt;span title=&quot;rules for parsing time offsets&quot;&gt;the
-  rules for parsing time offsets&lt;/span&gt;, and if that is successful, the
-  resulting value, in seconds, must be returned. If that fails, or if
-  the attribute is absent, the default value must be returned, or the
-  not-a-number value (NaN) if there is no default value. On setting,
-  the given value, interpreted as a time offset in seconds, must be
-  converted to a string using the &lt;span&gt;time offset serialization
-  rules&lt;/span&gt;, and that string must be used as the new content
-  attribute value.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and its query
+   component contains no unescaped non-ASCII characters. &lt;a
+   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is a floating point number type
-  (&lt;code&gt;float&lt;/code&gt;) and it doesn't fall into one of the earlier
-  categories, then, on getting, the content attribute must be parsed
-  according to &lt;span title=&quot;rules for parsing floating point number
-  values&quot;&gt;the rules for parsing floating point number values&lt;/span&gt;,
-  and if that is successful, the resulting value must be returned. If,
-  on the other hand, it fails, or if the attribute is absent, the
-  default value must be returned instead, or 0.0 if there is no
-  default value. On setting, the given value must be converted to the
-  shortest possible string representing the number as a &lt;span&gt;valid
-  floating point number&lt;/span&gt; in base ten and then that string must
-  be used as the new content attribute value.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and the &lt;span
+   title=&quot;document's character encoding&quot;&gt;character encoding&lt;/span&gt; of
+   the URL's &lt;code&gt;Document&lt;/code&gt; is UTF-8 or UTF-16. &lt;a
+   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute is of the type
-  &lt;code&gt;DOMTokenList&lt;/code&gt;, then on getting it must return a
-  &lt;code&gt;DOMTokenList&lt;/code&gt; object whose underlying string is the
-  element's corresponding content attribute. When the
-  &lt;code&gt;DOMTokenList&lt;/code&gt; object mutates its underlying string, the
-  content attribute must itself be immediately mutated. When the
-  attribute is absent, then the string represented by the
-  &lt;code&gt;DOMTokenList&lt;/code&gt; object is the empty string; when the
-  object mutates this empty string, the user agent must first add the
-  corresponding content attribute, and then mutate that attribute
-  instead. &lt;code&gt;DOMTokenList&lt;/code&gt; attributes are always
-  read-only. The same &lt;code&gt;DOMTokenList&lt;/code&gt; object must be
-  returned every time for each attribute.&lt;/p&gt;
+  &lt;/ul&gt;
 
-  &lt;p&gt;If a reflecting DOM attribute has the type
-  &lt;code&gt;HTMLElement&lt;/code&gt;, or an interface that descends from
-  &lt;code&gt;HTMLElement&lt;/code&gt;, then, on getting, it must run the
-  following algorithm (stopping at the first point where a value is
-  returned):
+  &lt;p class=&quot;note&quot;&gt;The term &quot;URL&quot; in this specification is used in a
+  manner distinct from the precise technical meaning it is given in
+  RFC 3986. Readers familiar with that RFC will find it easier to read
+  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
+  herein is really called something else altogether.&lt;/p&gt;
 
+
+  &lt;h4&gt;Parsing URLs&lt;/h4&gt;
+
+  &lt;p&gt;To &lt;dfn&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
+  component parts, the user agent must use the following steps:&lt;/p&gt;
+
   &lt;ol&gt;
 
-   &lt;li&gt;If the corresponding content attribute is absent, then the
-   DOM attribute must return null.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Strip leading and trailing &lt;span title=&quot;space
+   character&quot;&gt;space characters&lt;/span&gt; from &lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; be the element that the &lt;code
-   title=&quot;&quot;&gt;document.getElementById()&lt;/code&gt; method would find if it
-   was passed as its argument the current value of the corresponding
-   content attribute.&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;If &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; is null, or if it is not
-   type-compatible with the DOM attribute, then the DOM attribute must
-   return null.&lt;/li&gt;
+    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC
+    3986, with the following exceptions:&lt;/p&gt;
 
-   &lt;li&gt;Otherwise, it must return &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;.&lt;/li&gt;
+    &lt;ul&gt;
 
-  &lt;/ol&gt;
+     &lt;li&gt;Add all characters with codepoints less than or equal to
+     U+0020 or greater than or equal to U+007F to the
+     &lt;unreserved&gt; production.&lt;/li&gt;
 
-  &lt;p&gt;On setting, if the given element has an &lt;code
-  title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute, then the content attribute must
-  be set to the value of that &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt;
-  attribute. Otherwise, the DOM attribute must be set to the empty
-  string.&lt;/p&gt;&lt;!-- XXX or raise an exception? --&gt;
+     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E,
+     U+0060, and U+007B .. U+007D to the &lt;unreserved&gt;
+     production.
+      &lt;!--
+       0022 QUOTATION MARK
+       003C LESS-THAN SIGN
+       003E GREATER-THAN SIGN
+       005B LEFT SQUARE BRACKET
+       005C REVERSE SOLIDUS
+       005D RIGHT SQUARE BRACKET
+       005E CIRCUMFLEX ACCENT
+       0060 GRAVE ACCENT
+       007B LEFT CURLY BRACKET
+       007C VERTICAL LINE
+       007D RIGHT CURLY BRACKET
+      --&gt;
+     &lt;/li&gt;
 
+     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second
+     alternative way of matching the &lt;pct-encoded&gt; production,
+     except when the &lt;pct-encoded&gt; is used in the
+     &lt;reg-name&gt; production.&lt;/li&gt;
 
+     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters
+     allowed in the &lt;fragment&gt; production.&lt;/li&gt;
 
-  &lt;h4&gt;Collections&lt;/h4&gt;
+     &lt;!-- some browsers also have other differences, e.g. Mozilla
+     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
+     is &quot;ftp&quot;. --&gt;
 
-  &lt;p&gt;The &lt;code&gt;HTMLCollection&lt;/code&gt;,
-  &lt;code&gt;HTMLFormControlsCollection&lt;/code&gt;, and
-  &lt;code&gt;HTMLOptionsCollection&lt;/code&gt; interfaces represent various
-  lists of DOM nodes. Collectively, objects implementing these
-  interfaces are called &lt;dfn&gt;collections&lt;/dfn&gt;.&lt;/p&gt;
+    &lt;/ul&gt;
 
-  &lt;p&gt;When a &lt;span title=&quot;collections&quot;&gt;collection&lt;/span&gt; is created, a
-  filter and a root are associated with the collection.&lt;/p&gt;
+   &lt;/li&gt;
 
-  &lt;p class=&quot;example&quot;&gt;For example, when the &lt;code&gt;HTMLCollection&lt;/code&gt;
-  object for the &lt;code
-  title=&quot;dom-document-images&quot;&gt;document.images&lt;/code&gt; attribute is
-  created, it is associated with a filter that selects only
-  &lt;code&gt;img&lt;/code&gt; elements, and rooted at the root of the
-  document.&lt;/p&gt;
+   &lt;li&gt;
 
-  &lt;p&gt;The &lt;span title=&quot;collections&quot;&gt;collection&lt;/span&gt; then &lt;dfn
-  title=&quot;represented by the collection&quot;&gt;represents&lt;/dfn&gt; a
-  &lt;span&gt;live&lt;/span&gt; view of the subtree rooted at the collection's
-  root, containing only nodes that match the given filter. The view is
-  linear. In the absence of specific requirements to the contrary, the
-  nodes within the collection must be sorted in &lt;span&gt;tree
-  order&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the
+    &lt;URI-reference&gt; production, even after the above changes are
+    made to the ABNF definitions, then parsing the URL fails with an
+    error. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p class=&quot;note&quot;&gt;The &lt;code title=&quot;dom-table-rows&quot;&gt;rows&lt;/code&gt; list is
-  not in tree order.&lt;/p&gt;
+    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
+    components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+    defined as follows:&lt;/p&gt;
 
-  &lt;p&gt;An attribute that returns a collection must return the same
-  object every time it is retrieved.&lt;/p&gt;
+    &lt;dl&gt;
 
+     &lt;dt&gt;&lt;dfn title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-  &lt;h5&gt;HTMLCollection&lt;/h5&gt;
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
 
-  &lt;p&gt;The &lt;code&gt;HTMLCollection&lt;/code&gt; interface represents a generic
-  &lt;span title=&quot;collections&quot;&gt;collection&lt;/span&gt; of elements.&lt;/p&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLCollection&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;span title=&quot;dom-HTMLCollection-length&quot;&gt;length&lt;/span&gt;;
-  [IndexGetter] Element &lt;span title=&quot;dom-HTMLCollection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
-  [NameGetter] Element &lt;span title=&quot;dom-HTMLCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;(in DOMString name);
-};&lt;/pre&gt;
+     &lt;dt&gt;&lt;dfn title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-HTMLCollection-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
-  attribute must return the number of nodes &lt;span&gt;represented by the
-  collection&lt;/span&gt;.&lt;/p&gt;
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;host&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-HTMLCollection-item&quot;&gt;&lt;code&gt;item(&lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must
-  return null.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-HTMLCollection-namedItem&quot;&gt;&lt;code&gt;namedItem(&lt;var
-  title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the first node
-  in the collection that matches the following requirements:&lt;/p&gt;
+     &lt;dt&gt;&lt;dfn title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-  &lt;ul&gt;
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;port&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
 
-   &lt;li&gt;It is an &lt;code&gt;a&lt;/code&gt;, &lt;code&gt;applet&lt;/code&gt;,
-   &lt;code&gt;area&lt;/code&gt;, &lt;code&gt;form&lt;/code&gt;, &lt;code&gt;img&lt;/code&gt;, or
-   &lt;code&gt;object&lt;/code&gt; element with a &lt;code
-   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
-   title=&quot;&quot;&gt;key&lt;/var&gt;, or,&lt;/li&gt;
 
-   &lt;li&gt;It is an &lt;span title=&quot;HTML elements&quot;&gt;HTML element&lt;/span&gt; of any
-   kind with an &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute equal to
-   &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;. (Non-HTML elements, even if they have IDs,
-   are not searched for the purposes of &lt;code
-   title=&quot;dom-HTMLCollection-namedItem&quot;&gt;namedItem()&lt;/code&gt;.)&lt;/li&gt;
+     &lt;dt&gt;&lt;dfn title=&quot;url-hostport&quot;&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-  &lt;/ul&gt;
+     &lt;dd&gt;&lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt;
+     component and the port given by the &lt;port&gt; component is
+     different than the default port defined for the protocol given by
+     the &lt;scheme&gt; component, then &lt;hostport&gt; is the
+     substring that starts with the substring matched by the
+     &lt;host&gt; production and ends with the substring matched by the
+     &lt;port&gt; production, and includes the colon in between the
+     two. Otherwise, it is the same as the &lt;host&gt; component.&lt;/p&gt;
 
-  &lt;p&gt;If no such elements are found, then the method must return
-  null.&lt;/p&gt;
 
+     &lt;dt&gt;&lt;dfn title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
+     &lt;dd&gt;
 
-  &lt;h5&gt;HTMLFormControlsCollection&lt;/h5&gt;
+      &lt;p&gt;The substring matched by one of the following productions, if
+      one of them was matched:&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;HTMLFormControlsCollection&lt;/code&gt; interface represents
-  a &lt;span title=&quot;collections&quot;&gt;collection&lt;/span&gt; of form controls.&lt;/p&gt;
+      &lt;ul class=&quot;brief&quot;&gt;
+       &lt;li&gt;&lt;path-abempty&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-absolute&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-noscheme&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-rootless&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-empty&gt;&lt;/li&gt;
+      &lt;/ul&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLFormControlsCollection&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;span title=&quot;dom-HTMLFormControlsCollection-length&quot;&gt;length&lt;/span&gt;;
-  [IndexGetter] &lt;span&gt;HTMLElement&lt;/span&gt; &lt;span title=&quot;dom-HTMLFormControlsCollection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
-  [NameGetter] Object &lt;span title=&quot;dom-HTMLFormControlsCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;(in DOMString name);
-};&lt;/pre&gt;
+     &lt;/dd&gt;
 
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-HTMLFormControlsCollection-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
-  attribute must return the number of nodes &lt;span&gt;represented by the
-  collection&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-HTMLFormControlsCollection-item&quot;&gt;&lt;code&gt;item(&lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must
-  return null.&lt;/p&gt;
+     &lt;dt&gt;&lt;dfn title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-HTMLFormControlsCollection-namedItem&quot;&gt;&lt;code&gt;namedItem(&lt;var title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
-  method must act according to the following algorithm:
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;query&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
 
-  &lt;ol&gt;
 
-   &lt;li&gt;If, at the time the method is called, there is exactly one node
-   in the collection that has either an &lt;code
-   title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
-   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;,
-   then return that node and stop the algorithm.&lt;/li&gt;
+     &lt;dt&gt;&lt;dfn title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
-   &lt;li&gt;Otherwise, if there are no nodes in the collection that have
-   either an &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
-   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
-   title=&quot;&quot;&gt;key&lt;/var&gt;, then return null and stop the algorithm.&lt;/li&gt;
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
 
-   &lt;li&gt;Otherwise, create a &lt;code&gt;NodeList&lt;/code&gt; object representing a
-   live view of the &lt;code&gt;HTMLFormControlsCollection&lt;/code&gt; object,
-   further filtered so that the only nodes in the
-   &lt;code&gt;NodeList&lt;/code&gt; object are those that have either an &lt;code
-   title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
-   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
-   title=&quot;&quot;&gt;key&lt;/var&gt;. The nodes in the &lt;code&gt;NodeList&lt;/code&gt; object
-   must be sorted in &lt;span&gt;tree order&lt;/span&gt;.&lt;/li&gt;
+    &lt;/dl&gt;
 
-   &lt;li&gt;Return that &lt;code&gt;NodeList&lt;/code&gt; object.&lt;/li&gt;
+   &lt;/li&gt;
 
   &lt;/ol&gt;
 
+  &lt;!-- XXX we might want to define &quot;server-based naming authority&quot;,
+  it's not clear RFC3986 does a good job of defining that anymore
+  (earlier URI specs did) --&gt;
 
-&lt;!--
-<A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C%21DOCTYPE%20html%3E...%0A%3Cform%20name%3D%22a%22%3E%3Cinput%20id%3D%22x%22%20name%3D%22y%22%3E%3Cinput%20name%3D%22x%22%20id%3D%22y%22%3E%3C/form%3E%0A%3Cscript%3E%0A%20%20var%20x%3B%0A%20%20w%28x%20%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20x%5B0%5D.parentNode.removeChild%28x%5B0%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20w%28x%20%3D%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%3C/script%3E%0A">http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C%21DOCTYPE%20html%3E...%0A%3Cform%20name%3D%22a%22%3E%3Cinput%20id%3D%22x%22%20name%3D%22y%22%3E%3Cinput%20name%3D%22x%22%20id%3D%22y%22%3E%3C/form%3E%0A%3Cscript%3E%0A%20%20var%20x%3B%0A%20%20w%28x%20%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20x%5B0%5D.parentNode.removeChild%28x%5B0%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20w%28x%20%3D%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%3C/script%3E%0A</A>
---&gt;
 
+  &lt;h4&gt;Resolving URLs&lt;/h4&gt;
 
-  &lt;h5&gt;HTMLOptionsCollection&lt;/h5&gt;
+  &lt;p&gt;Relative URLs are resolved relative to a base URL. The &lt;dfn&gt;base
+  URL&lt;/dfn&gt; of a &lt;span&gt;URL&lt;/span&gt; is the &lt;span&gt;absolute URL&lt;/span&gt;
+  obtained as follows:&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;HTMLOptionsCollection&lt;/code&gt; interface represents
-  a list of &lt;code&gt;option&lt;/code&gt; elements.&lt;/p&gt;
+  &lt;dl class=&quot;switch&quot;&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLOptionsCollection&lt;/dfn&gt; {
-           attribute unsigned long &lt;span title=&quot;dom-HTMLOptionsCollection-length&quot;&gt;length&lt;/span&gt;;
-  [IndexGetter] HTMLOptionElement &lt;span title=&quot;dom-HTMLOptionsCollection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
-  [NameGetter] Object &lt;span title=&quot;dom-HTMLOptionsCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;(in DOMString name);
-};&lt;/pre&gt;
+   &lt;dt&gt;If the URL to be resolved was passed to an API&lt;/dt&gt;
 
-  &lt;p&gt;On getting, the &lt;dfn
-  title=&quot;dom-HTMLOptionsCollection-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
-  attribute must return the number of nodes &lt;span&gt;represented by the
-  collection&lt;/span&gt;.&lt;/p&gt;
+   &lt;dd&gt;&lt;p&gt;The base URL is the &lt;span&gt;document base URL&lt;/span&gt; of the
+   script's &lt;span&gt;script document context&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
 
-  &lt;p&gt;On setting, the behavior depends on whether the new value is
-  equal to, greater than, or less than the number of nodes
-  &lt;span&gt;represented by the collection&lt;/span&gt; at that time. If the
-  number is the same, then setting the attribute must do nothing. If
-  the new value is greater, then &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; new
-  &lt;code&gt;option&lt;/code&gt; elements with no attributes and no child nodes
-  must be appended to the &lt;code&gt;select&lt;/code&gt; element on which the
-  &lt;code&gt;HTMLOptionsCollection&lt;/code&gt; is rooted, where &lt;var
-  title=&quot;&quot;&gt;n&lt;/var&gt; is the difference between the two numbers (new
-  value minus old value). If the new value is lower, then the last
-  &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; nodes in the collection must be removed from
-  their parent nodes, where &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is the difference
-  between the two numbers (old value minus new value).&lt;/p&gt;
+   &lt;dt&gt;If the URL to be resolved is from the value of a content
+   attribute&lt;/dt&gt;
 
-  &lt;p class=&quot;note&quot;&gt;Setting &lt;code
-  title=&quot;dom-HTMLOptionsCollection-length&quot;&gt;length&lt;/code&gt; never removes
-  or adds any &lt;code&gt;optgroup&lt;/code&gt; elements, and never adds new
-  children to existing &lt;code&gt;optgroup&lt;/code&gt; elements (though it can
-  remove children from them).&lt;/p&gt;
+   &lt;dd&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-HTMLOptionsCollection-item&quot;&gt;&lt;code&gt;item(&lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must
-  return null.&lt;/p&gt;
+    &lt;p&gt;The base URL is the &lt;i&gt;base URI of the element&lt;/i&gt; that the
+    attribute is on, as defined by the XML Base specification, with
+    &lt;i&gt;the base URI of the document entity&lt;/i&gt; being defined as the
+    &lt;span&gt;document base URL&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt; that
+    owns the element.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-HTMLOptionsCollection-namedItem&quot;&gt;&lt;code&gt;namedItem(&lt;var title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
-  method must act according to the following algorithm:
+    &lt;p&gt;For the purposes of the XML Base specification, user agents
+    must act as if all &lt;code&gt;Document&lt;/code&gt; objects represented XML
+    documents.&lt;/p&gt;
 
+    &lt;p class=&quot;note&quot;&gt;It is possible for &lt;code
+    title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes to be present
+    even in HTML fragments, as such attributes can be added
+    dynamically using script. (Such scripts would not be conforming,
+    however, as &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes
+    are not allowed in &lt;span&gt;HTML documents&lt;/span&gt;.)&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;If the URL to be resolved was found in an offline application
+   cache manifest&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The base URL is the URL of the &lt;span&gt;application
+   cache&lt;/span&gt; &lt;span
+   title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;p&gt;The &lt;dfn&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; is
+  the &lt;span&gt;absolute URL&lt;/span&gt; obtained by running these steps:&lt;/p&gt;
+
   &lt;ol&gt;
 
-   &lt;li&gt;If, at the time the method is called, there is exactly one node
-   in the collection that has either an &lt;code
-   title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
-   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
-   title=&quot;&quot;&gt;key&lt;/var&gt;, then return that node and stop the
-   algorithm.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;base&lt;/code&gt; element that is both a
+   child of &lt;span&gt;the &lt;code&gt;head&lt;/code&gt; element&lt;/span&gt; and has an
+   &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute, then the
+   &lt;span&gt;document base URL&lt;/span&gt; is &lt;span&gt;the document's
+   address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;Otherwise, if there are no nodes in the collection that have
-   either an &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
-   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
-   title=&quot;&quot;&gt;key&lt;/var&gt;, then return null and stop the algorithm.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the
+   &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute of the first such
+   element.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;Otherwise, create a &lt;code&gt;NodeList&lt;/code&gt; object representing a
-   live view of the &lt;code&gt;HTMLOptionsCollection&lt;/code&gt; object, further
-   filtered so that the only nodes in the &lt;code&gt;NodeList&lt;/code&gt; object
-   are those that have either an &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt;
-   attribute or a &lt;code title=&quot;attr-option-name&quot;&gt;name&lt;/code&gt; attribute
-   equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;. The nodes in the
-   &lt;code&gt;NodeList&lt;/code&gt; object must be sorted in &lt;span&gt;tree
-   order&lt;/span&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a URL&quot;&gt;Resolve&lt;/span&gt; the &lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt; URL, using &lt;span&gt;the document's
+   address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt; as the &lt;span&gt;base URL&lt;/span&gt;
+   (thus, the &lt;code&gt;base&lt;/code&gt; &lt;code
+   title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute isn't affect by &lt;code
+   title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes).&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;Return that &lt;code&gt;NodeList&lt;/code&gt; object.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;span&gt;document base URL&lt;/span&gt; is the result of the
+   previous step if it was successful; otherwise it is &lt;span&gt;the
+   document's address&lt;/span&gt;&lt;!-- XXXDOCURL --&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
-  &lt;!-- see also <A HREF="http://ln.hixie.ch/?start=1161042744&amp;count=1">http://ln.hixie.ch/?start=1161042744&amp;count=1</A> --&gt;
+  &lt;p&gt;To &lt;dfn&gt;resolve a URL&lt;/dfn&gt; to an &lt;span&gt;absolute URL&lt;/span&gt; the
+  user agent must use the following steps. Resolving a URL can result
+  in an error, in which case the URL is not resolvable.&lt;/p&gt;
 
-  &lt;p class=&quot;big-issue&quot;&gt;We may want to add &lt;code&gt;add()&lt;/code&gt; and
-  &lt;code&gt;remove()&lt;/code&gt; methods here too because IE implements
-  HTMLSelectElement and HTMLOptionsCollection on the same object, and
-  so people use them almost interchangeably in the wild.&lt;/p&gt;
+  &lt;ol&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;span&gt;URL&lt;/span&gt; being
+   resolved.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;h4&gt;DOMTokenList&lt;/h4&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the
+   &lt;code&gt;Document&lt;/code&gt; &lt;a href=&quot;#urldoc&quot;&gt;associated with&lt;/a&gt; &lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;The &lt;code&gt;DOMTokenList&lt;/code&gt; interface represents an interface
-  to an underlying string that consists of an &lt;span&gt;unordered set of
-  unique space-separated tokens&lt;/span&gt;.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be the &lt;span
+   title=&quot;document's character encoding&quot;&gt;character encoding&lt;/span&gt; of
+   &lt;var title=&quot;&quot;&gt;document&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;Which string underlies a particular &lt;code&gt;DOMTokenList&lt;/code&gt;
-  object is defined when the object is created. It might be a content
-  attribute (e.g. the string that underlies the &lt;code
-  title=&quot;dom-classList&quot;&gt;classList&lt;/code&gt; object is the &lt;code
-  title=&quot;attr-class&quot;&gt;class&lt;/code&gt; attribute), or it might be an
-  anonymous string (e.g. when a &lt;code&gt;DOMTokenList&lt;/code&gt; object is
-  passed to an author-implemented callback in the
-  &lt;code&gt;datagrid&lt;/code&gt; APIs).&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is UTF-16, then change it to
+   UTF-8.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;[&lt;span title=&quot;dom-tokenlist-toString&quot;&gt;Stringifies&lt;/span&gt;] interface &lt;dfn&gt;DOMTokenList&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;span title=&quot;dom-tokenlist-length&quot;&gt;length&lt;/span&gt;;
-  [IndexGetter] DOMString &lt;span title=&quot;dom-tokenlist-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
-  boolean &lt;span title=&quot;dom-tokenlist-has&quot;&gt;has&lt;/span&gt;(in DOMString token);
-  void &lt;span title=&quot;dom-tokenlist-add&quot;&gt;add&lt;/span&gt;(in DOMString token);
-  void &lt;span title=&quot;dom-tokenlist-remove&quot;&gt;remove&lt;/span&gt;(in DOMString token);
-  boolean &lt;span title=&quot;dom-tokenlist-toggle&quot;&gt;toggle&lt;/span&gt;(in DOMString token);
-};&lt;/pre&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;span&gt;base URL&lt;/span&gt;
+   for &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. (This is an &lt;span&gt;absolute
+   URL&lt;/span&gt;.)&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
-  attribute must return the number of &lt;em&gt;unique&lt;/em&gt; tokens that
-  result from &lt;span title=&quot;split a string on spaces&quot;&gt;splitting the
-  underlying string on spaces&lt;/span&gt;.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;parse a URL&quot;&gt;Parse&lt;/span&gt; &lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/p&gt;&lt;/li&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-item&quot;&gt;&lt;code&gt;item(&lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must &lt;span title=&quot;split a
-  string on spaces&quot;&gt;split the underlying string on spaces&lt;/span&gt;, sort
-  the resulting list of tokens by Unicode codepoint&lt;!-- XXX that's
-  basically nonsense. What sort order do we want here? It should be
-  the cheapest one possible that is well-defined for all Unicode. --&gt;,
-  remove exact duplicates, and then return the &lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt;th item in this list. If &lt;var
-  title=&quot;&quot;&gt;index&lt;/var&gt; is equal to or greater than the number of
-  tokens, then the method must return null.&lt;/p&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
+    title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt; component, then replace the
+    matching subtring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from expanding any sequences of percent-encoded octets in
+    that component that are valid UTF-8 sequences into Unicode
+    characters as defined by UTF-8.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-has&quot;&gt;&lt;code&gt;has(&lt;var
-  title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
-  algorithm:&lt;/p&gt;
+    &lt;p&gt;If any percent-encoded octets in that component are not valid
+    UTF-8 sequences, then return an error and abort these steps.&lt;/p&gt;
 
-  &lt;ol&gt;
+    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring,
+    with both the AllowUnassigned and UseSTD3ASCIIRules flags
+    set. Replace the matching substring with the result of the ToASCII
+    algorithm.&lt;/p&gt;
 
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;span
-   title=&quot;space character&quot;&gt;space characters&lt;/span&gt;, then raise an
-   &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the
-   algorithm.&lt;/li&gt;
+    &lt;p&gt;If ToASCII fails to convert one of the components of the
+    string, e.g. because it is too long or because it contains invalid
+    characters, then return an error and abort these steps. &lt;a
+    href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;Otherwise, &lt;span title=&quot;split a string on spaces&quot;&gt;split the
-   underlying string on spaces&lt;/span&gt; to get the list of tokens in the
-   object's underlying string.&lt;/li&gt;
+   &lt;/li&gt;
 
-   &lt;li&gt;If the token indicated by &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is one of
-   the tokens in the object's underlying string then return true and
-   stop this algorithm.&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;Otherwise, return false.&lt;/li&gt;
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
+    title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from applying the following steps to each character other
+    than U+0025 PERCENT SIGN (%) that doesn't match the original
+    &lt;path&gt; production defined in RFC 3986:&lt;/p&gt;
 
-  &lt;/ol&gt;
+    &lt;ol&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-add&quot;&gt;&lt;code&gt;add(&lt;var
-  title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
-  algorithm:&lt;/p&gt;
+     &lt;li&gt;Encode the character into a sequence of octets as defined by
+     UTF-8.&lt;/li&gt;
 
-  &lt;ol&gt;
+     &lt;li&gt;Replace the character with the percent-encoded form of those
+     octets. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
 
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;span
-   title=&quot;space character&quot;&gt;space characters&lt;/span&gt;, then raise an
-   &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the
-   algorithm.&lt;/li&gt;
+    &lt;/ol&gt;
 
-   &lt;li&gt;Otherwise, &lt;span title=&quot;split a string on spaces&quot;&gt;split the
-   underlying string on spaces&lt;/span&gt; to get the list of tokens in the
-   object's underlying string.&lt;/li&gt;
+    &lt;div class=&quot;example&quot;&gt;
 
-   &lt;li&gt;If the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is already one of the
-   tokens in the &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying string
-   then stop the algorithm.&lt;/li&gt;
+     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code
+     title=&quot;&quot;&gt;//example.com/a^b&amp;#x263a;c%FFd%z/?e&lt;/code&gt;&quot;, then the
+     &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component's substring
+     would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&amp;#x263a;c%FFd%z/&lt;/code&gt;&quot; and the two
+     characters that would have to be escaped would be &quot;&lt;code
+     title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&amp;#x263a;&lt;/code&gt;&quot;. The
+     result after this step was applied would therefore be that &lt;var
+     title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code
+     title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
 
-   &lt;li&gt;Otherwise, if the &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying
-   string is not the empty string and the last character of that
-   string is not a &lt;span&gt;space character&lt;/span&gt;, then append a U+0020
-   SPACE character to the end of that string.&lt;/li&gt;
+    &lt;/div&gt;
 
-   &lt;li&gt;Append the value of &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; to the end of the
-   &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying string.&lt;/li&gt;
+   &lt;/li&gt;
 
-  &lt;/ol&gt;
+   &lt;li&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-remove&quot;&gt;&lt;code&gt;remove(&lt;var
-  title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
-  algorithm:&lt;/p&gt;
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
+    title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from applying the following steps to each character other
+    than U+0025 PERCENT SIGN (%) that doesn't match the original
+    &lt;query&gt; production defined in RFC 3986:&lt;/p&gt;
 
-  &lt;ol&gt;
+    &lt;ol&gt;
 
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;span
-   title=&quot;space character&quot;&gt;space characters&lt;/span&gt;, then raise an
-   &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the
-   algorithm.&lt;/li&gt;
+     &lt;li&gt;If the character in question cannot be expressed in the
+     encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a
+     single 0x3F octet (an ASCII question mark) and skip the remaining
+     substeps for this character.&lt;/li&gt;
 
-   &lt;li&gt;Otherwise, &lt;span title=&quot;remove a token from a string&quot;&gt;remove
-   the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; from the underlying
-   string&lt;/span&gt;.&lt;/li&gt;
+     &lt;li&gt;Encode the character into a sequence of octets as defined by
+     the encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;
+     &lt;li&gt;Replace the character with the percent-encoded form of those
+     octets. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-toggle&quot;&gt;&lt;code&gt;toggle(&lt;var
-  title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
-  algorithm:&lt;/p&gt;
+    &lt;/ol&gt;
 
-  &lt;ol&gt;
+   &lt;/li&gt;
 
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;span
-   title=&quot;space character&quot;&gt;space characters&lt;/span&gt;, then raise an
-   &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the
-   algorithm.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2
+   Relative Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the
+   potentially relative URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and
+   &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URI (&lt;var
+   title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;Otherwise, &lt;span title=&quot;split a string on spaces&quot;&gt;split the
-   underlying string on spaces&lt;/span&gt; to get the list of tokens in the
-   object's underlying string.&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;If the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is already one of the
-   tokens in the &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying string
-   then &lt;span title=&quot;remove a token from a string&quot;&gt;remove the given
-   &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; from the underlying string&lt;/span&gt;, and
-   stop the algorithm, returning false.&lt;/li&gt;
+    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC
+    3987, returning an error and aborting these steps if
+    appropriate. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;Otherwise, if the &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying
-   string is not the empty string and the last character of that
-   string is not a &lt;span&gt;space character&lt;/span&gt;, then append a U+0020
-   SPACE character to the end of that string.&lt;/li&gt;
+    &lt;p class=&quot;example&quot;&gt;For instance, if an absolute URI that would be
+    returned by the above algorithm violates the restrictions specific
+    to its scheme, e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the
+    &quot;&lt;code title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax,
+    then user agents are to treat this as an error instead.&lt;!-- RFC
+    3986, 3.1 Scheme --&gt;&lt;/p&gt;
 
-   &lt;li&gt;Append the value of &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; to the end of the
-   &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying string.&lt;/li&gt;
+   &lt;/li&gt;
 
-   &lt;li&gt;Return true.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var
+   title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution
+   algorithm.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a
+   server-based naming authority, replace all U+005C REVERSE SOLIDUS
+   (\) characters in &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS
+   (/) characters.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
   &lt;/ol&gt;
 
-  &lt;p&gt;Objects implementing the &lt;code&gt;DOMTokenList&lt;/code&gt; interface must
-  &lt;dfn title=&quot;dom-tokenlist-toString&quot;&gt;stringify&lt;/dfn&gt; to the object's
-  underlying string representation.&lt;/p&gt;
+  &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is an &lt;dfn&gt;absolute URL&lt;/dfn&gt; if &lt;span
+  title=&quot;resolve a URL&quot;&gt;resolving&lt;/span&gt; it results in the same
+  URL without an error.&lt;/p&gt;
 
 
-  &lt;h4&gt;DOMStringMap&lt;/h4&gt;
+  &lt;h4&gt;Dynamic changes to base URLs&lt;/h4&gt;
 
-  &lt;p&gt;The &lt;code&gt;DOMStringMap&lt;/code&gt; interface represents a set of
-  name-value pairs. When a &lt;code&gt;DOMStringMap&lt;/code&gt; object is
-  instanced, it is associated with three algorithms, one for getting
-  values from names, one for setting names to certain values, and one
-  for deleting names.&lt;/p&gt;
+  &lt;p&gt;When an &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attribute
+  changes, the attribute's element, and all descendant elements, are
+  &lt;span&gt;affected by a base URL change&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p class=&quot;big-issue&quot;&gt;The names of the methods on this interface are
-  temporary and will be fixed when the Web IDL / &quot;Language Bindings
-  for DOM Specifications&quot; spec is ready to handle this case.&lt;/p&gt;
+  &lt;p&gt;When a document's &lt;span&gt;document base URL&lt;/span&gt; changes, all
+  elements in that document are &lt;span&gt;affected by a base URL
+  change&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;DOMStringMap&lt;/dfn&gt; {
-  [NameGetter] DOMString &lt;span title=&quot;dom-stringmap-XXX1&quot;&gt;XXX1&lt;/span&gt;(in DOMString name); &lt;!-- XXX DOMB --&gt;
-  [NameSetter] void &lt;span title=&quot;dom-stringmap-XXX2&quot;&gt;XXX2&lt;/span&gt;(in DOMString name, in DOMString value); &lt;!-- XXX DOMB --&gt;
-  [XXX] boolean &lt;span title=&quot;dom-stringmap-XXX3&quot;&gt;XXX3&lt;/span&gt;(in DOMString name); &lt;!-- XXX DOMB --&gt;
-};&lt;/pre&gt;
+  &lt;p&gt;When an element is moved from one document to another, if the two
+  documents have different &lt;span title=&quot;document base URL&quot;&gt;base
+  URLs&lt;/span&gt;, then that element and all its descendants are
+  &lt;span&gt;affected by a base URL change&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-stringmap-XXX1&quot;&gt;&lt;code&gt;XXX1(&lt;var
-  title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must call the algorithm for
-  getting values from names, passing &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the
-  name, and must return the corresponding value, or null if &lt;var
-  title=&quot;&quot;&gt;name&lt;/var&gt; has no corresponding value.&lt;/p&gt;
+  &lt;p&gt;When an element is &lt;dfn&gt;affected by a base URL change&lt;/dfn&gt;, it
+  must act as described in the following list:&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-stringmap-XXX2&quot;&gt;&lt;code&gt;XXX2(&lt;var
-  title=&quot;&quot;&gt;name&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
-  must call the algorithm for setting names to certain values, passing
-  &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the name and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-  as the value.&lt;/p&gt;
+  &lt;dl class=&quot;switch&quot;&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-stringmap-XXX3&quot;&gt;&lt;code&gt;XXX3(&lt;var
-  title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must call the algorithm for
-  deleting names, passing &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the name, and
-  must return true.&lt;/p&gt;
+   &lt;dt&gt;If the element is a &lt;span title=&quot;hyperlink&quot;&gt;hyperlink
+   element&lt;/span&gt;&lt;/dt&gt;
 
+   &lt;dd&gt;
 
-  &lt;h4&gt;DOM feature strings&lt;/h4&gt;
+    &lt;p&gt;If the &lt;span&gt;absolute URL&lt;/span&gt; identified by the hyperlink is
+    being shown to the user, or if any data derived from that URL is
+    affecting the display, then the &lt;code
+    title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute should be &lt;span
+    title=&quot;resolve a url&quot;&gt;reresolved&lt;/span&gt; and the UI updated
+    appropriately.&lt;/p&gt;
 
-  &lt;p&gt;DOM3 Core defines mechanisms for checking for interface support,
-  and for obtaining implementations of interfaces, using &lt;a
-  href=&quot;<A HREF="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures">http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures</A>&quot;&gt;feature
-  strings&lt;/a&gt;. &lt;a href=&quot;#refsDOM3CORE&quot;&gt;[DOM3CORE]&lt;/a&gt;&lt;/p&gt;
+    &lt;p class=&quot;example&quot;&gt;For example, the CSS &lt;code
+    title=&quot;&quot;&gt;:link&lt;/code&gt;/&lt;code title=&quot;&quot;&gt;:visited&lt;/code&gt;
+    pseudo-classes might have been affected.&lt;/p&gt;
 
-  &lt;p&gt;A DOM application can use the &lt;dfn
-  title=&quot;hasFeature&quot;&gt;&lt;code&gt;hasFeature(&lt;var title=&quot;&quot;&gt;feature&lt;/var&gt;,
-  &lt;var title=&quot;&quot;&gt;version&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method of the
-  &lt;code&gt;DOMImplementation&lt;/code&gt; interface with parameter values
-  &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; and &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; (respectively)
-  to determine whether or not this module is supported by the
-  implementation. In addition to the feature string &quot;&lt;code
-  title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;, the feature string &quot;&lt;code
-  title=&quot;&quot;&gt;XHTML&lt;/code&gt;&quot; (with version string &quot;&lt;code&gt;5.0&lt;/code&gt;&quot;) can
-  be used to check if the implementation supports XHTML. User agents
-  should respond with a true value when the &lt;code&gt;hasFeature&lt;/code&gt;
-  method is queried with these values. Authors are cautioned, however,
-  that UAs returning true might not be perfectly compliant, and that
-  UAs returning false might well have support for features in this
-  specification; in general, therefore, use of this method is
-  discouraged.&lt;/p&gt;
+    &lt;p&gt;If the hyperlink has a &lt;code
+    title=&quot;attr-hyperlink-ping&quot;&gt;ping&lt;/code&gt; attribute and its &lt;span
+    title=&quot;absolute URL&quot;&gt;absolute URL(s)&lt;/span&gt; are being shown to the
+    user, then the &lt;code title=&quot;attr-hyperlink-ping&quot;&gt;ping&lt;/code&gt;
+    attribute's tokens should be &lt;span title=&quot;resolve a
+    url&quot;&gt;reresolved&lt;/span&gt; and the UI updated appropriately.&lt;/p&gt;
 
-  &lt;p&gt;The values &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; and &quot;&lt;code
-  title=&quot;&quot;&gt;XHTML&lt;/code&gt;&quot; (both with version &quot;&lt;code&gt;5.0&lt;/code&gt;&quot;) should
-  also be supported in the context of the &lt;code&gt;getFeature()&lt;/code&gt;
-  and &lt;code&gt;isSupported()&lt;/code&gt; methods, as defined by DOM3 Core.&lt;/p&gt;
+   &lt;/dd&gt;
 
-  &lt;p class=&quot;note&quot;&gt;The interfaces defined in this specification are not
-  always supersets of the interfaces defined in DOM2 HTML; some
-  features that were formerly deprecated, poorly supported, rarely
-  used or considered unnecessary have been removed. Therefore it is
-  not guaranteed that an implementation that supports &quot;&lt;code
-  title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; also supports &quot;&lt;code
-  title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; &quot;&lt;code&gt;2.0&lt;/code&gt;&quot;.&lt;/p&gt;
+   &lt;dt&gt;If the element is a &lt;code&gt;blockquote&lt;/code&gt;, &lt;code&gt;q&lt;/code&gt;,
+   &lt;code&gt;ins&lt;/code&gt;, or &lt;code&gt;del&lt;/code&gt; element with a &lt;code
+   title=&quot;&quot;&gt;cite&lt;/code&gt; attribute&lt;/dt&gt;
 
+   &lt;dd&gt;
 
+    &lt;p&gt;If the &lt;span&gt;absolute URL&lt;/span&gt; identified by the &lt;code
+    title=&quot;&quot;&gt;cite&lt;/code&gt; attribute is being shown to the user, or if
+    any data derived from that URL is affecting the display, then the
+    it should be &lt;span title=&quot;resolve a url&quot;&gt;reresolved&lt;/span&gt; and the
+    UI updated appropriately.&lt;/p&gt;
 
+   &lt;/dd&gt;
+
+   &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The element is not directly affected.&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;Changing the base URL doesn't affect the image
+    displayed by &lt;code&gt;img&lt;/code&gt; elements, although subsequent
+    accesses of the &lt;code title=&quot;dom-img-src&quot;&gt;src&lt;/code&gt; DOM attribute
+    from script will return a new &lt;span&gt;absolute URL&lt;/span&gt; that might
+    no longer correspond to the image being shown.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+
+
+
+
+  &lt;h4&gt;Interfaces for URL manipulation&lt;/h4&gt;
+
+ &lt;p&gt;An interface that has a complement of &lt;dfn&gt;URL decomposition
+  attributes&lt;/dfn&gt; will have seven attributes with the following
+  definitions:&lt;/p&gt;
+
+&lt;pre class=&quot;idl&quot;&gt;
+           attribute DOMString &lt;span title=&quot;dom-uda-protocol&quot;&gt;protocol&lt;/span&gt;;
+           attribute DOMString &lt;span title=&quot;dom-uda-host&quot;&gt;host&lt;/span&gt;;
+           attribute DOMString &lt;span title=&quot;dom-uda-hostname&quot;&gt;hostname&lt;/span&gt;;
+           attribute DOMString &lt;span title=&quot;dom-uda-port&quot;&gt;port&lt;/span&gt;;
+           attribute DOMString &lt;span title=&quot;dom-uda-pathname&quot;&gt;pathname&lt;/span&gt;;
+           attribute DOMString &lt;span title=&quot;dom-uda-search&quot;&gt;search&lt;/span&gt;;
+           attribute DOMString &lt;span title=&quot;dom-uda-hash&quot;&gt;hash&lt;/span&gt;;
+&lt;/pre&gt;
+
+  &lt;p&gt;The attributes defined to be URL decomposition attributes must
+  act as described for the attributes with the same corresponding
+  names in this section.&lt;/p&gt;
+
+  &lt;p&gt;In addition, an interface with a complement of URL decomposition
+  attributes will define an &lt;dfn
+  title=&quot;concept-uda-input&quot;&gt;input&lt;/dfn&gt;, which is a &lt;span&gt;URL&lt;/span&gt;
+  that the attributes act on, and a &lt;dfn
+  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/dfn&gt;, which is a
+  set of steps invoked when any of the attributes' setters are
+  invoked.&lt;/p&gt;
+
+  &lt;p&gt;The seven URL decomposition attributes have similar
+  requirements.&lt;/p&gt;
+
+  &lt;p&gt;On getting, if the &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt;
+  fulfills the condition given in the &quot;getter condition&quot; column
+  corresponding to the attribute in the table below, the user agent
+  must return the part of the &lt;span
+  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; URL given in the &quot;component&quot;
+  column, with any prefixes specified in the &quot;prefix&quot; column
+  appropriately added to the start of the string and any suffixes
+  specified in the &quot;suffix&quot; column appropriately added to the end of
+  the string. Otherwise, the attribute must return the empty
+  string.&lt;/p&gt;
+
+  &lt;p&gt;On setting, the new value must first be mutated as described by
+  the &quot;setter preprocessor&quot; column, then mutated by %-escaping any
+  characters in the new value that are not valid in the relevant
+  component as given by the &quot;component&quot; column. Then, if the resulting
+  new value fulfills the condition given in the &quot;setter condition&quot;
+  column, the user agent must make a new string &lt;var
+  title=&quot;&quot;&gt;output&lt;/var&gt; by replacing the component of the URL given by
+  the &quot;component&quot; column in the &lt;span
+  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; URL with the new value;
+  otherwise, the user agent must let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be
+  equal to the &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt;. Finally,
+  the user agent must invoke the &lt;span
+  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/span&gt; with the
+  value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
+
+  &lt;p&gt;When replacing a component in the URL, if the component is part
+  of an optional group in the URL syntax consisting of a character
+  followed by the component, the component (including its prefix
+  character) must be included even if the new value is the empty
+  string.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;The previous paragraph applies in particular to the
+  &quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot; before a &lt;port&gt; component, the &quot;&lt;code
+  title=&quot;&quot;&gt;?&lt;/code&gt;&quot; before a &lt;query&gt; component, and the &quot;&lt;code
+  title=&quot;&quot;&gt;#&lt;/code&gt;&quot; before a &lt;fragment&gt; component.&lt;/p&gt;
+
+  &lt;p&gt;For the purposes of the above definitions, URLs must be parsed
+  using the &lt;span title=&quot;parse a URL&quot;&gt;URL parsing rules&lt;/span&gt; defined
+  in this specification.&lt;/p&gt;
+
+  &lt;table&gt;
+   &lt;thead&gt;      
+    &lt;tr&gt;
+     &lt;th&gt;Attribute
+     &lt;th&gt;Component
+     &lt;th&gt;Getter Condition
+     &lt;th&gt;Prefix
+     &lt;th&gt;Suffix
+     &lt;th&gt;Setter Preprocessor
+     &lt;th&gt;Setter Condition
+   &lt;tbody&gt;
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn title=&quot;dom-uda-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;
+     &lt;td&gt;&lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt;
+     &lt;td&gt;&mdash;
+     &lt;td&gt;&mdash;
+     &lt;td&gt;U+003A COLON (&quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;)
+     &lt;td&gt;Remove all trailing U+003A COLON (&quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;) characters
+     &lt;td&gt;The new value is not the empty string
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn title=&quot;dom-uda-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
+     &lt;td&gt;&lt;span title=&quot;url-hostport&quot;&gt;&lt;hostport&gt;&lt;/span&gt;
+     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical and uses a server-based naming authority
+     &lt;td&gt;&mdash;
+     &lt;td&gt;&mdash;
+     &lt;td&gt;&mdash;
+     &lt;td&gt;&mdash;
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn title=&quot;dom-uda-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
+     &lt;td&gt;&lt;span title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt;
+     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical and uses a server-based naming authority
+     &lt;td&gt;&mdash;
+     &lt;td&gt;&mdash;
+     &lt;td&gt;Remove all leading U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;) characters
+     &lt;td&gt;&mdash;
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn title=&quot;dom-uda-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;
+     &lt;td&gt;&lt;span title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/span&gt;
+     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical, uses a server-based naming authority, and contained a &lt;span title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/span&gt; component (possibly an empty one)
+     &lt;td&gt;&mdash;
+     &lt;td&gt;&mdash;
+     &lt;td&gt;Remove any characters in the new value that are not in the range U+0030 DIGIT ZERO .. U+0039 DIGIT NINE.
+         If the resulting string is empty, set it to a single U+0030 DIGIT ZERO character ('0').
+     &lt;td&gt;&mdash;
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn title=&quot;dom-uda-pathname&quot;&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;
+     &lt;td&gt;&lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt;
+     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical
+     &lt;td&gt;&mdash;
+     &lt;td&gt;&mdash;
+     &lt;td&gt;If it has no leading U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;) character, prepend a U+002F SOLIDUS (&quot;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;&quot;) character to the new value
+     &lt;td&gt;&mdash;
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn title=&quot;dom-uda-search&quot;&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;
+     &lt;td&gt;&lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt;
+     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical, and contained a &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component (possibly an empty one)
+     &lt;td&gt;U+003F QUESTION MARK (&quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;)
+     &lt;td&gt;&mdash;
+     &lt;td&gt;Remove one leading U+003F QUESTION MARK (&quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot;) character, if any
+     &lt;td&gt;&mdash;
+    &lt;tr&gt;
+     &lt;td&gt;&lt;dfn title=&quot;dom-uda-hash&quot;&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;
+     &lt;td&gt;&lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
+     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; contained a &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component (possibly an empty one)
+     &lt;td&gt;U+0023 NUMBER SIGN (&quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot;)
+     &lt;td&gt;&mdash;
+     &lt;td&gt;Remove one leading U+0023 NUMBER SIGN (&quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot;) character, if any
+     &lt;td&gt;&mdash;
+  &lt;/table&gt;
+
+&lt;!--
+  <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
+  <A HREF="http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp">http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp</A>
+  <A HREF="http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722">http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722</A>
+--&gt;
+
+  &lt;div class=&quot;example&quot;&gt;
+
+   &lt;p&gt;The table below demonstrates how the getter condition for &lt;code
+   title=&quot;dom-uda-search&quot;&gt;search&lt;/code&gt; results in different results
+   depending on the exact original syntax of the URL:&lt;/p&gt;
+
+   &lt;table&gt;
+    &lt;thead&gt;
+     &lt;tr&gt;
+      &lt;th&gt; Input URL
+      &lt;th&gt; &lt;code title=&quot;dom-uda-search&quot;&gt;search&lt;/code&gt; value
+      &lt;th&gt; Explanation
+    &lt;tbody&gt;
+     &lt;tr&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/&lt;/code">http://example.com/&lt;/code</A>&gt;
+      &lt;td&gt; &lt;i&gt;empty string&lt;/i&gt;
+      &lt;td&gt; No &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component in input URL.
+     &lt;tr&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?&lt;/code">http://example.com/?&lt;/code</A>&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
+      &lt;td&gt; There is a &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component, but it is empty. The question mark in the resulting value is the prefix.
+     &lt;tr&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test&lt;/code">http://example.com/?test&lt;/code</A>&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
+      &lt;td&gt; The &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component has the value &quot;&lt;code title=&quot;&quot;&gt;test&lt;/code&gt;&quot;.
+     &lt;tr&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test#&lt;/code">http://example.com/?test#&lt;/code</A>&gt;
+      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
+      &lt;td&gt; The (empty) &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component is not part of the &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component.
+   &lt;/table&gt;
+
+  &lt;/div&gt;
+
+
+
   &lt;h3&gt;Fetching resources&lt;/h3&gt;
 
   &lt;p class=&quot;big-issue&quot;&gt;replace all instances of the word 'fetch' or
@@ -4843,9 +4227,625 @@
 
 
 
+  &lt;h3&gt;Common DOM interfaces&lt;/h3&gt;
 
+  &lt;h4&gt;Reflecting content attributes in DOM attributes&lt;/h4&gt;
 
+  &lt;p&gt;Some &lt;span title=&quot;DOM attribute&quot;&gt;DOM attributes&lt;/span&gt; are
+  defined to &lt;dfn&gt;reflect&lt;/dfn&gt; a particular &lt;span&gt;content
+  attribute&lt;/span&gt;. This means that on getting, the DOM attribute
+  returns the current value of the content attribute, and on setting,
+  the DOM attribute changes the value of the content attribute to the
+  given value.&lt;/p&gt;
 
+  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt;
+  attribute whose content attribute is defined to contain a
+  &lt;span&gt;URL&lt;/span&gt;, then on getting, the DOM attribute must &lt;span
+  title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the value of the content
+  attribute and return the resulting &lt;span&gt;absolute URL&lt;/span&gt; if that
+  was successful, or the empty string otherwise; and on setting, must
+  set the content attribute to the specified literal value. If the
+  content attribute is absent, the DOM attribute must return the
+  default value, if the content attribute has one, or else the empty
+  string.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt;
+  attribute whose content attribute is defined to contain one or more
+  &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt;, then on getting, the DOM attribute
+  must &lt;span title=&quot;split the string on spaces&quot;&gt;split the content
+  attribute on spaces&lt;/span&gt; and return the concatenation of &lt;span
+  title=&quot;resolve a URL&quot;&gt;resolving&lt;/span&gt; each token URL to an
+  &lt;span&gt;absolute URL&lt;/span&gt;, with a single U+0020 SPACE character
+  between each URL, ignoring any tokens that did not resolve
+  successfully. If the content attribute is absent, the DOM attribute
+  must return the default value, if the content attribute has one, or
+  else the empty string. On setting, the DOM attribute must set the
+  content attribute to the specified literal value.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; whose
+  content attribute is an &lt;span&gt;enumerated attribute&lt;/span&gt;, and the
+  DOM attribute is &lt;dfn&gt;limited to only known values&lt;/dfn&gt;, then, on
+  getting, the DOM attribute must return the conforming value
+  associated with the state the attribute is in (in its canonical
+  case), or the empty string if the attribute is in a state that has
+  no associated keyword value; and on setting, if the new value is an
+  &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for one of the keywords
+  given for that attribute, then the content attribute must be set to
+  the conforming value associated with the state that the attribute
+  would be in if set to the given new value, otherwise, if the new
+  value is the empty string, then the content attribute must be
+  removed, otherwise, the setter must raise a &lt;code&gt;SYNTAX_ERR&lt;/code&gt;
+  exception.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is a &lt;code&gt;DOMString&lt;/code&gt; but
+  doesn't fall into any of the above categories, then the getting and
+  setting must be done in a transparent, case-preserving manner.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is a boolean attribute, then on
+  getting the DOM attribute must return true if the attribute is set,
+  and false if it is absent. On setting, the content attribute must be
+  removed if the DOM attribute is set to false, and must be set to
+  have the same value as its name if the DOM attribute is set to
+  true. (This corresponds to the rules for &lt;span title=&quot;boolean
+  attribute&quot;&gt;boolean content attributes&lt;/span&gt;.)&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is a signed integer type
+  (&lt;code&gt;long&lt;/code&gt;) then, on getting, the content attribute must be
+  parsed according to &lt;span title=&quot;rules for parsing integers&quot;&gt;the
+  rules for parsing signed integers&lt;/span&gt;, and if that is successful,
+  the resulting value must be returned. If, on the other hand, it
+  fails, or if the attribute is absent, then the default value must be
+  returned instead, or 0 if there is no default value. On setting, the
+  given value must be converted to the shortest possible string
+  representing the number as a &lt;span&gt;valid integer&lt;/span&gt; in base ten
+  and then that string must be used as the new content attribute
+  value.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is an &lt;em&gt;unsigned&lt;/em&gt; integer
+  type (&lt;code&gt;unsigned long&lt;/code&gt;) then, on getting, the content
+  attribute must be parsed according to &lt;span title=&quot;rules for parsing
+  non-negative integers&quot;&gt;the rules for parsing unsigned
+  integers&lt;/span&gt;, and if that is successful, the resulting value must
+  be returned. If, on the other hand, it fails, or if the attribute is
+  absent, the default value must be returned instead, or 0 if there is
+  no default value. On setting, the given value must be converted to
+  the shortest possible string representing the number as a
+  &lt;span&gt;valid non-negative integer&lt;/span&gt; in base ten and then that
+  string must be used as the new content attribute value.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is an unsigned integer type
+  (&lt;code&gt;unsigned long&lt;/code&gt;) that is &lt;dfn&gt;limited to only positive
+  non-zero numbers&lt;/dfn&gt;, then the behavior is similar to the previous
+  case, but zero is not allowed. On getting, the content attribute
+  must first be parsed according to &lt;span title=&quot;rules for parsing
+  non-negative integers&quot;&gt;the rules for parsing unsigned
+  integers&lt;/span&gt;, and if that is successful, the resulting value must
+  be returned. If, on the other hand, it fails, or if the attribute is
+  absent, the default value must be returned instead, or 1 if there is
+  no default value. On setting, if the value is zero, the user agent
+  must fire an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception. Otherwise, the
+  given value must be converted to the shortest possible string
+  representing the number as a &lt;span&gt;valid non-negative integer&lt;/span&gt;
+  in base ten and then that string must be used as the new content
+  attribute value.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is a floating point number type
+  (&lt;code&gt;float&lt;/code&gt;) and the content attribute is defined to contain
+  a time offset, then, on getting, the content attribute must be
+  parsed according to &lt;span title=&quot;rules for parsing time offsets&quot;&gt;the
+  rules for parsing time offsets&lt;/span&gt;, and if that is successful, the
+  resulting value, in seconds, must be returned. If that fails, or if
+  the attribute is absent, the default value must be returned, or the
+  not-a-number value (NaN) if there is no default value. On setting,
+  the given value, interpreted as a time offset in seconds, must be
+  converted to a string using the &lt;span&gt;time offset serialization
+  rules&lt;/span&gt;, and that string must be used as the new content
+  attribute value.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is a floating point number type
+  (&lt;code&gt;float&lt;/code&gt;) and it doesn't fall into one of the earlier
+  categories, then, on getting, the content attribute must be parsed
+  according to &lt;span title=&quot;rules for parsing floating point number
+  values&quot;&gt;the rules for parsing floating point number values&lt;/span&gt;,
+  and if that is successful, the resulting value must be returned. If,
+  on the other hand, it fails, or if the attribute is absent, the
+  default value must be returned instead, or 0.0 if there is no
+  default value. On setting, the given value must be converted to the
+  shortest possible string representing the number as a &lt;span&gt;valid
+  floating point number&lt;/span&gt; in base ten and then that string must
+  be used as the new content attribute value.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute is of the type
+  &lt;code&gt;DOMTokenList&lt;/code&gt;, then on getting it must return a
+  &lt;code&gt;DOMTokenList&lt;/code&gt; object whose underlying string is the
+  element's corresponding content attribute. When the
+  &lt;code&gt;DOMTokenList&lt;/code&gt; object mutates its underlying string, the
+  content attribute must itself be immediately mutated. When the
+  attribute is absent, then the string represented by the
+  &lt;code&gt;DOMTokenList&lt;/code&gt; object is the empty string; when the
+  object mutates this empty string, the user agent must first add the
+  corresponding content attribute, and then mutate that attribute
+  instead. &lt;code&gt;DOMTokenList&lt;/code&gt; attributes are always
+  read-only. The same &lt;code&gt;DOMTokenList&lt;/code&gt; object must be
+  returned every time for each attribute.&lt;/p&gt;
+
+  &lt;p&gt;If a reflecting DOM attribute has the type
+  &lt;code&gt;HTMLElement&lt;/code&gt;, or an interface that descends from
+  &lt;code&gt;HTMLElement&lt;/code&gt;, then, on getting, it must run the
+  following algorithm (stopping at the first point where a value is
+  returned):
+
+  &lt;ol&gt;
+
+   &lt;li&gt;If the corresponding content attribute is absent, then the
+   DOM attribute must return null.&lt;/li&gt;
+
+   &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; be the element that the &lt;code
+   title=&quot;&quot;&gt;document.getElementById()&lt;/code&gt; method would find if it
+   was passed as its argument the current value of the corresponding
+   content attribute.&lt;/li&gt;
+
+   &lt;li&gt;If &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; is null, or if it is not
+   type-compatible with the DOM attribute, then the DOM attribute must
+   return null.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, it must return &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;On setting, if the given element has an &lt;code
+  title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute, then the content attribute must
+  be set to the value of that &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt;
+  attribute. Otherwise, the DOM attribute must be set to the empty
+  string.&lt;/p&gt;&lt;!-- XXX or raise an exception? --&gt;
+
+
+
+  &lt;h4&gt;Collections&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;code&gt;HTMLCollection&lt;/code&gt;,
+  &lt;code&gt;HTMLFormControlsCollection&lt;/code&gt;, and
+  &lt;code&gt;HTMLOptionsCollection&lt;/code&gt; interfaces represent various
+  lists of DOM nodes. Collectively, objects implementing these
+  interfaces are called &lt;dfn&gt;collections&lt;/dfn&gt;.&lt;/p&gt;
+
+  &lt;p&gt;When a &lt;span title=&quot;collections&quot;&gt;collection&lt;/span&gt; is created, a
+  filter and a root are associated with the collection.&lt;/p&gt;
+
+  &lt;p class=&quot;example&quot;&gt;For example, when the &lt;code&gt;HTMLCollection&lt;/code&gt;
+  object for the &lt;code
+  title=&quot;dom-document-images&quot;&gt;document.images&lt;/code&gt; attribute is
+  created, it is associated with a filter that selects only
+  &lt;code&gt;img&lt;/code&gt; elements, and rooted at the root of the
+  document.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;span title=&quot;collections&quot;&gt;collection&lt;/span&gt; then &lt;dfn
+  title=&quot;represented by the collection&quot;&gt;represents&lt;/dfn&gt; a
+  &lt;span&gt;live&lt;/span&gt; view of the subtree rooted at the collection's
+  root, containing only nodes that match the given filter. The view is
+  linear. In the absence of specific requirements to the contrary, the
+  nodes within the collection must be sorted in &lt;span&gt;tree
+  order&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;The &lt;code title=&quot;dom-table-rows&quot;&gt;rows&lt;/code&gt; list is
+  not in tree order.&lt;/p&gt;
+
+  &lt;p&gt;An attribute that returns a collection must return the same
+  object every time it is retrieved.&lt;/p&gt;
+
+
+  &lt;h5&gt;HTMLCollection&lt;/h5&gt;
+
+  &lt;p&gt;The &lt;code&gt;HTMLCollection&lt;/code&gt; interface represents a generic
+  &lt;span title=&quot;collections&quot;&gt;collection&lt;/span&gt; of elements.&lt;/p&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLCollection&lt;/dfn&gt; {
+  readonly attribute unsigned long &lt;span title=&quot;dom-HTMLCollection-length&quot;&gt;length&lt;/span&gt;;
+  [IndexGetter] Element &lt;span title=&quot;dom-HTMLCollection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
+  [NameGetter] Element &lt;span title=&quot;dom-HTMLCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;(in DOMString name);
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HTMLCollection-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the number of nodes &lt;span&gt;represented by the
+  collection&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-HTMLCollection-item&quot;&gt;&lt;code&gt;item(&lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must
+  return null.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HTMLCollection-namedItem&quot;&gt;&lt;code&gt;namedItem(&lt;var
+  title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the first node
+  in the collection that matches the following requirements:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;It is an &lt;code&gt;a&lt;/code&gt;, &lt;code&gt;applet&lt;/code&gt;,
+   &lt;code&gt;area&lt;/code&gt;, &lt;code&gt;form&lt;/code&gt;, &lt;code&gt;img&lt;/code&gt;, or
+   &lt;code&gt;object&lt;/code&gt; element with a &lt;code
+   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
+   title=&quot;&quot;&gt;key&lt;/var&gt;, or,&lt;/li&gt;
+
+   &lt;li&gt;It is an &lt;span title=&quot;HTML elements&quot;&gt;HTML element&lt;/span&gt; of any
+   kind with an &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute equal to
+   &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;. (Non-HTML elements, even if they have IDs,
+   are not searched for the purposes of &lt;code
+   title=&quot;dom-HTMLCollection-namedItem&quot;&gt;namedItem()&lt;/code&gt;.)&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+  &lt;p&gt;If no such elements are found, then the method must return
+  null.&lt;/p&gt;
+
+
+
+  &lt;h5&gt;HTMLFormControlsCollection&lt;/h5&gt;
+
+  &lt;p&gt;The &lt;code&gt;HTMLFormControlsCollection&lt;/code&gt; interface represents
+  a &lt;span title=&quot;collections&quot;&gt;collection&lt;/span&gt; of form controls.&lt;/p&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLFormControlsCollection&lt;/dfn&gt; {
+  readonly attribute unsigned long &lt;span title=&quot;dom-HTMLFormControlsCollection-length&quot;&gt;length&lt;/span&gt;;
+  [IndexGetter] &lt;span&gt;HTMLElement&lt;/span&gt; &lt;span title=&quot;dom-HTMLFormControlsCollection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
+  [NameGetter] Object &lt;span title=&quot;dom-HTMLFormControlsCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;(in DOMString name);
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HTMLFormControlsCollection-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the number of nodes &lt;span&gt;represented by the
+  collection&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HTMLFormControlsCollection-item&quot;&gt;&lt;code&gt;item(&lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must
+  return null.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HTMLFormControlsCollection-namedItem&quot;&gt;&lt;code&gt;namedItem(&lt;var title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
+  method must act according to the following algorithm:
+
+  &lt;ol&gt;
+
+   &lt;li&gt;If, at the time the method is called, there is exactly one node
+   in the collection that has either an &lt;code
+   title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
+   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;,
+   then return that node and stop the algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, if there are no nodes in the collection that have
+   either an &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
+   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
+   title=&quot;&quot;&gt;key&lt;/var&gt;, then return null and stop the algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, create a &lt;code&gt;NodeList&lt;/code&gt; object representing a
+   live view of the &lt;code&gt;HTMLFormControlsCollection&lt;/code&gt; object,
+   further filtered so that the only nodes in the
+   &lt;code&gt;NodeList&lt;/code&gt; object are those that have either an &lt;code
+   title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
+   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
+   title=&quot;&quot;&gt;key&lt;/var&gt;. The nodes in the &lt;code&gt;NodeList&lt;/code&gt; object
+   must be sorted in &lt;span&gt;tree order&lt;/span&gt;.&lt;/li&gt;
+
+   &lt;li&gt;Return that &lt;code&gt;NodeList&lt;/code&gt; object.&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+&lt;!--
+<A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C%21DOCTYPE%20html%3E...%0A%3Cform%20name%3D%22a%22%3E%3Cinput%20id%3D%22x%22%20name%3D%22y%22%3E%3Cinput%20name%3D%22x%22%20id%3D%22y%22%3E%3C/form%3E%0A%3Cscript%3E%0A%20%20var%20x%3B%0A%20%20w%28x%20%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20x%5B0%5D.parentNode.removeChild%28x%5B0%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20w%28x%20%3D%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%3C/script%3E%0A">http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C%21DOCTYPE%20html%3E...%0A%3Cform%20name%3D%22a%22%3E%3Cinput%20id%3D%22x%22%20name%3D%22y%22%3E%3Cinput%20name%3D%22x%22%20id%3D%22y%22%3E%3C/form%3E%0A%3Cscript%3E%0A%20%20var%20x%3B%0A%20%20w%28x%20%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20x%5B0%5D.parentNode.removeChild%28x%5B0%5D%29%3B%0A%20%20w%28x.length%29%3B%0A%20%20w%28x%20%3D%3D%20document.forms%5B%27a%27%5D%5B%27x%27%5D%29%3B%0A%3C/script%3E%0A</A>
+--&gt;
+
+
+  &lt;h5&gt;HTMLOptionsCollection&lt;/h5&gt;
+
+  &lt;p&gt;The &lt;code&gt;HTMLOptionsCollection&lt;/code&gt; interface represents
+  a list of &lt;code&gt;option&lt;/code&gt; elements.&lt;/p&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HTMLOptionsCollection&lt;/dfn&gt; {
+           attribute unsigned long &lt;span title=&quot;dom-HTMLOptionsCollection-length&quot;&gt;length&lt;/span&gt;;
+  [IndexGetter] HTMLOptionElement &lt;span title=&quot;dom-HTMLOptionsCollection-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
+  [NameGetter] Object &lt;span title=&quot;dom-HTMLOptionsCollection-namedItem&quot;&gt;namedItem&lt;/span&gt;(in DOMString name);
+};&lt;/pre&gt;
+
+  &lt;p&gt;On getting, the &lt;dfn
+  title=&quot;dom-HTMLOptionsCollection-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the number of nodes &lt;span&gt;represented by the
+  collection&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;On setting, the behavior depends on whether the new value is
+  equal to, greater than, or less than the number of nodes
+  &lt;span&gt;represented by the collection&lt;/span&gt; at that time. If the
+  number is the same, then setting the attribute must do nothing. If
+  the new value is greater, then &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; new
+  &lt;code&gt;option&lt;/code&gt; elements with no attributes and no child nodes
+  must be appended to the &lt;code&gt;select&lt;/code&gt; element on which the
+  &lt;code&gt;HTMLOptionsCollection&lt;/code&gt; is rooted, where &lt;var
+  title=&quot;&quot;&gt;n&lt;/var&gt; is the difference between the two numbers (new
+  value minus old value). If the new value is lower, then the last
+  &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; nodes in the collection must be removed from
+  their parent nodes, where &lt;var title=&quot;&quot;&gt;n&lt;/var&gt; is the difference
+  between the two numbers (old value minus new value).&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;Setting &lt;code
+  title=&quot;dom-HTMLOptionsCollection-length&quot;&gt;length&lt;/code&gt; never removes
+  or adds any &lt;code&gt;optgroup&lt;/code&gt; elements, and never adds new
+  children to existing &lt;code&gt;optgroup&lt;/code&gt; elements (though it can
+  remove children from them).&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-HTMLOptionsCollection-item&quot;&gt;&lt;code&gt;item(&lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection. If there is no &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;th node in the collection, then the method must
+  return null.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HTMLOptionsCollection-namedItem&quot;&gt;&lt;code&gt;namedItem(&lt;var title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt;
+  method must act according to the following algorithm:
+
+  &lt;ol&gt;
+
+   &lt;li&gt;If, at the time the method is called, there is exactly one node
+   in the collection that has either an &lt;code
+   title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
+   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
+   title=&quot;&quot;&gt;key&lt;/var&gt;, then return that node and stop the
+   algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, if there are no nodes in the collection that have
+   either an &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt; attribute or a &lt;code
+   title=&quot;attr-name&quot;&gt;name&lt;/code&gt; attribute equal to &lt;var
+   title=&quot;&quot;&gt;key&lt;/var&gt;, then return null and stop the algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, create a &lt;code&gt;NodeList&lt;/code&gt; object representing a
+   live view of the &lt;code&gt;HTMLOptionsCollection&lt;/code&gt; object, further
+   filtered so that the only nodes in the &lt;code&gt;NodeList&lt;/code&gt; object
+   are those that have either an &lt;code title=&quot;attr-id&quot;&gt;id&lt;/code&gt;
+   attribute or a &lt;code title=&quot;attr-option-name&quot;&gt;name&lt;/code&gt; attribute
+   equal to &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;. The nodes in the
+   &lt;code&gt;NodeList&lt;/code&gt; object must be sorted in &lt;span&gt;tree
+   order&lt;/span&gt;.&lt;/li&gt;
+
+   &lt;li&gt;Return that &lt;code&gt;NodeList&lt;/code&gt; object.&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;!-- see also <A HREF="http://ln.hixie.ch/?start=1161042744&amp;count=1">http://ln.hixie.ch/?start=1161042744&amp;count=1</A> --&gt;
+
+  &lt;p class=&quot;big-issue&quot;&gt;We may want to add &lt;code&gt;add()&lt;/code&gt; and
+  &lt;code&gt;remove()&lt;/code&gt; methods here too because IE implements
+  HTMLSelectElement and HTMLOptionsCollection on the same object, and
+  so people use them almost interchangeably in the wild.&lt;/p&gt;
+
+
+  &lt;h4&gt;DOMTokenList&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;code&gt;DOMTokenList&lt;/code&gt; interface represents an interface
+  to an underlying string that consists of an &lt;span&gt;unordered set of
+  unique space-separated tokens&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;Which string underlies a particular &lt;code&gt;DOMTokenList&lt;/code&gt;
+  object is defined when the object is created. It might be a content
+  attribute (e.g. the string that underlies the &lt;code
+  title=&quot;dom-classList&quot;&gt;classList&lt;/code&gt; object is the &lt;code
+  title=&quot;attr-class&quot;&gt;class&lt;/code&gt; attribute), or it might be an
+  anonymous string (e.g. when a &lt;code&gt;DOMTokenList&lt;/code&gt; object is
+  passed to an author-implemented callback in the
+  &lt;code&gt;datagrid&lt;/code&gt; APIs).&lt;/p&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;[&lt;span title=&quot;dom-tokenlist-toString&quot;&gt;Stringifies&lt;/span&gt;] interface &lt;dfn&gt;DOMTokenList&lt;/dfn&gt; {
+  readonly attribute unsigned long &lt;span title=&quot;dom-tokenlist-length&quot;&gt;length&lt;/span&gt;;
+  [IndexGetter] DOMString &lt;span title=&quot;dom-tokenlist-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
+  boolean &lt;span title=&quot;dom-tokenlist-has&quot;&gt;has&lt;/span&gt;(in DOMString token);
+  void &lt;span title=&quot;dom-tokenlist-add&quot;&gt;add&lt;/span&gt;(in DOMString token);
+  void &lt;span title=&quot;dom-tokenlist-remove&quot;&gt;remove&lt;/span&gt;(in DOMString token);
+  boolean &lt;span title=&quot;dom-tokenlist-toggle&quot;&gt;toggle&lt;/span&gt;(in DOMString token);
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the number of &lt;em&gt;unique&lt;/em&gt; tokens that
+  result from &lt;span title=&quot;split a string on spaces&quot;&gt;splitting the
+  underlying string on spaces&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-item&quot;&gt;&lt;code&gt;item(&lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must &lt;span title=&quot;split a
+  string on spaces&quot;&gt;split the underlying string on spaces&lt;/span&gt;, sort
+  the resulting list of tokens by Unicode codepoint&lt;!-- XXX that's
+  basically nonsense. What sort order do we want here? It should be
+  the cheapest one possible that is well-defined for all Unicode. --&gt;,
+  remove exact duplicates, and then return the &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;th item in this list. If &lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt; is equal to or greater than the number of
+  tokens, then the method must return null.&lt;/p&gt;
+
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-has&quot;&gt;&lt;code&gt;has(&lt;var
+  title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;span
+   title=&quot;space character&quot;&gt;space characters&lt;/span&gt;, then raise an
+   &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the
+   algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, &lt;span title=&quot;split a string on spaces&quot;&gt;split the
+   underlying string on spaces&lt;/span&gt; to get the list of tokens in the
+   object's underlying string.&lt;/li&gt;
+
+   &lt;li&gt;If the token indicated by &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is one of
+   the tokens in the object's underlying string then return true and
+   stop this algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, return false.&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-add&quot;&gt;&lt;code&gt;add(&lt;var
+  title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;span
+   title=&quot;space character&quot;&gt;space characters&lt;/span&gt;, then raise an
+   &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the
+   algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, &lt;span title=&quot;split a string on spaces&quot;&gt;split the
+   underlying string on spaces&lt;/span&gt; to get the list of tokens in the
+   object's underlying string.&lt;/li&gt;
+
+   &lt;li&gt;If the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is already one of the
+   tokens in the &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying string
+   then stop the algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, if the &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying
+   string is not the empty string and the last character of that
+   string is not a &lt;span&gt;space character&lt;/span&gt;, then append a U+0020
+   SPACE character to the end of that string.&lt;/li&gt;
+
+   &lt;li&gt;Append the value of &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; to the end of the
+   &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying string.&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-remove&quot;&gt;&lt;code&gt;remove(&lt;var
+  title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;span
+   title=&quot;space character&quot;&gt;space characters&lt;/span&gt;, then raise an
+   &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the
+   algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, &lt;span title=&quot;remove a token from a string&quot;&gt;remove
+   the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; from the underlying
+   string&lt;/span&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-tokenlist-toggle&quot;&gt;&lt;code&gt;toggle(&lt;var
+  title=&quot;&quot;&gt;token&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; argument contains any &lt;span
+   title=&quot;space character&quot;&gt;space characters&lt;/span&gt;, then raise an
+   &lt;code&gt;INVALID_CHARACTER_ERR&lt;/code&gt; exception and stop the
+   algorithm.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, &lt;span title=&quot;split a string on spaces&quot;&gt;split the
+   underlying string on spaces&lt;/span&gt; to get the list of tokens in the
+   object's underlying string.&lt;/li&gt;
+
+   &lt;li&gt;If the given &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; is already one of the
+   tokens in the &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying string
+   then &lt;span title=&quot;remove a token from a string&quot;&gt;remove the given
+   &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; from the underlying string&lt;/span&gt;, and
+   stop the algorithm, returning false.&lt;/li&gt;
+
+   &lt;li&gt;Otherwise, if the &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying
+   string is not the empty string and the last character of that
+   string is not a &lt;span&gt;space character&lt;/span&gt;, then append a U+0020
+   SPACE character to the end of that string.&lt;/li&gt;
+
+   &lt;li&gt;Append the value of &lt;var title=&quot;&quot;&gt;token&lt;/var&gt; to the end of the
+   &lt;code&gt;DOMTokenList&lt;/code&gt; object's underlying string.&lt;/li&gt;
+
+   &lt;li&gt;Return true.&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;Objects implementing the &lt;code&gt;DOMTokenList&lt;/code&gt; interface must
+  &lt;dfn title=&quot;dom-tokenlist-toString&quot;&gt;stringify&lt;/dfn&gt; to the object's
+  underlying string representation.&lt;/p&gt;
+
+
+  &lt;h4&gt;DOMStringMap&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;code&gt;DOMStringMap&lt;/code&gt; interface represents a set of
+  name-value pairs. When a &lt;code&gt;DOMStringMap&lt;/code&gt; object is
+  instanced, it is associated with three algorithms, one for getting
+  values from names, one for setting names to certain values, and one
+  for deleting names.&lt;/p&gt;
+
+  &lt;p class=&quot;big-issue&quot;&gt;The names of the methods on this interface are
+  temporary and will be fixed when the Web IDL / &quot;Language Bindings
+  for DOM Specifications&quot; spec is ready to handle this case.&lt;/p&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;DOMStringMap&lt;/dfn&gt; {
+  [NameGetter] DOMString &lt;span title=&quot;dom-stringmap-XXX1&quot;&gt;XXX1&lt;/span&gt;(in DOMString name); &lt;!-- XXX DOMB --&gt;
+  [NameSetter] void &lt;span title=&quot;dom-stringmap-XXX2&quot;&gt;XXX2&lt;/span&gt;(in DOMString name, in DOMString value); &lt;!-- XXX DOMB --&gt;
+  [XXX] boolean &lt;span title=&quot;dom-stringmap-XXX3&quot;&gt;XXX3&lt;/span&gt;(in DOMString name); &lt;!-- XXX DOMB --&gt;
+};&lt;/pre&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-stringmap-XXX1&quot;&gt;&lt;code&gt;XXX1(&lt;var
+  title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must call the algorithm for
+  getting values from names, passing &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the
+  name, and must return the corresponding value, or null if &lt;var
+  title=&quot;&quot;&gt;name&lt;/var&gt; has no corresponding value.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-stringmap-XXX2&quot;&gt;&lt;code&gt;XXX2(&lt;var
+  title=&quot;&quot;&gt;name&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
+  must call the algorithm for setting names to certain values, passing
+  &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the name and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
+  as the value.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-stringmap-XXX3&quot;&gt;&lt;code&gt;XXX3(&lt;var
+  title=&quot;&quot;&gt;name&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must call the algorithm for
+  deleting names, passing &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the name, and
+  must return true.&lt;/p&gt;
+
+
+  &lt;h4&gt;DOM feature strings&lt;/h4&gt;
+
+  &lt;p&gt;DOM3 Core defines mechanisms for checking for interface support,
+  and for obtaining implementations of interfaces, using &lt;a
+  href=&quot;<A HREF="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures">http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures</A>&quot;&gt;feature
+  strings&lt;/a&gt;. &lt;a href=&quot;#refsDOM3CORE&quot;&gt;[DOM3CORE]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;A DOM application can use the &lt;dfn
+  title=&quot;hasFeature&quot;&gt;&lt;code&gt;hasFeature(&lt;var title=&quot;&quot;&gt;feature&lt;/var&gt;,
+  &lt;var title=&quot;&quot;&gt;version&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method of the
+  &lt;code&gt;DOMImplementation&lt;/code&gt; interface with parameter values
+  &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; and &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; (respectively)
+  to determine whether or not this module is supported by the
+  implementation. In addition to the feature string &quot;&lt;code
+  title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;, the feature string &quot;&lt;code
+  title=&quot;&quot;&gt;XHTML&lt;/code&gt;&quot; (with version string &quot;&lt;code&gt;5.0&lt;/code&gt;&quot;) can
+  be used to check if the implementation supports XHTML. User agents
+  should respond with a true value when the &lt;code&gt;hasFeature&lt;/code&gt;
+  method is queried with these values. Authors are cautioned, however,
+  that UAs returning true might not be perfectly compliant, and that
+  UAs returning false might well have support for features in this
+  specification; in general, therefore, use of this method is
+  discouraged.&lt;/p&gt;
+
+  &lt;p&gt;The values &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; and &quot;&lt;code
+  title=&quot;&quot;&gt;XHTML&lt;/code&gt;&quot; (both with version &quot;&lt;code&gt;5.0&lt;/code&gt;&quot;) should
+  also be supported in the context of the &lt;code&gt;getFeature()&lt;/code&gt;
+  and &lt;code&gt;isSupported()&lt;/code&gt; methods, as defined by DOM3 Core.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;The interfaces defined in this specification are not
+  always supersets of the interfaces defined in DOM2 HTML; some
+  features that were formerly deprecated, poorly supported, rarely
+  used or considered unnecessary have been removed. Therefore it is
+  not guaranteed that an implementation that supports &quot;&lt;code
+  title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; &quot;&lt;code&gt;5.0&lt;/code&gt;&quot; also supports &quot;&lt;code
+  title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot; &quot;&lt;code&gt;2.0&lt;/code&gt;&quot;.&lt;/p&gt;
+
+
+
+
   &lt;h2 id=&quot;dom&quot;&gt;Semantics and structure of HTML documents&lt;/h2&gt;
 
   &lt;h3 id=&quot;semantics-intro&quot;&gt;Introduction&lt;/h3&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008867.html">[html5] r1969 - [e] (0) clarify where to bail if you want to ignore	the navigation for some reason
</A></li>
	<LI>Next message: <A HREF="008869.html">[html5] r1971 - [] (0) Define fetching. (bug 5848)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8868">[ date ]</a>
              <a href="thread.html#8868">[ thread ]</a>
              <a href="subject.html#8868">[ subject ]</a>
              <a href="author.html#8868">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
