<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r1037 - /
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1037%20-%20/&In-Reply-To=%3C20071008192853.49BD41389CC%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007944.html">
   <LINK REL="Next"  HREF="007946.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r1037 - /</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r1037%20-%20/&In-Reply-To=%3C20071008192853.49BD41389CC%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r1037 - /">whatwg at whatwg.org
       </A><BR>
    <I>Mon Oct  8 12:28:53 PDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="007944.html">[html5] r1036 - /
</A></li>
        <LI>Next message: <A HREF="007946.html">[html5] r1038 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7945">[ date ]</a>
              <a href="thread.html#7945">[ thread ]</a>
              <a href="subject.html#7945">[ subject ]</a>
              <a href="author.html#7945">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2007-10-08 12:28:51 -0700 (Mon, 08 Oct 2007)
New Revision: 1037

Modified:
   index
   source
Log:
[] (0) * Add comment regarding the imperative voice used in algorithms.
* Removed references to RFC2732.
* Fixed references to &lt;hostname&gt; (changed to &lt;host&gt;, mentioned &lt;ihost&gt; where appropriate).
* Add note saying we need to handle IP addresses in definition of origin.
* Added section 'Unscripted same-origin checks'.
* Moved the 'Offline Web applications' section (and renamed it 'Browser state').
* Added section 'Offline Web applications' for offline application caches.
* Made surgical changes to the history traversal to mention offline application caches.
* Made surgical changes to the navigation to mention offline application caches.
* Made surgical changes to the parser to mention offline application caches.
* Fixed cross-references to 'accessible' in the storage section.
* Defined '&lt;hostport&gt;' which the RFCs had dropped on the floor.
* Fixed typos, added XXX notes to the editor, made certain IDs more consistent.

Modified: index
===================================================================
--- index	2007-09-25 09:54:15 UTC (rev 1036)
+++ index	2007-10-08 19:28:51 UTC (rev 1037)
@@ -22,8 +22,7 @@
 
    &lt;h1 id=html-5&gt;HTML 5&lt;/h1&gt;
 
-   &lt;h2 class=&quot;no-num no-toc&quot; id=working&gt;Working Draft &mdash; 25 September
-    2007&lt;/h2&gt;
+   &lt;h2 class=&quot;no-num no-toc&quot; id=working&gt;Working Draft &mdash; 8 October 2007&lt;/h2&gt;
 
    &lt;p&gt;You can take part in this work. &lt;a
     href=&quot;<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&quot;&gt;Join the working group's
@@ -987,24 +986,27 @@
 
        &lt;li&gt;&lt;a href=&quot;#origin&quot;&gt;&lt;span class=secno&gt;4.3.2. &lt;/span&gt;Origin&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#security2&quot;&gt;&lt;span class=secno&gt;4.3.3. &lt;/span&gt;Security
+       &lt;li&gt;&lt;a href=&quot;#unscripted&quot;&gt;&lt;span class=secno&gt;4.3.3. &lt;/span&gt;Unscripted
+        same-origin checks&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#security2&quot;&gt;&lt;span class=secno&gt;4.3.4. &lt;/span&gt;Security
         exceptions&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#javascript-protocol&quot;&gt;&lt;span class=secno&gt;4.3.4. &lt;/span&gt;The
+       &lt;li&gt;&lt;a href=&quot;#javascript-protocol&quot;&gt;&lt;span class=secno&gt;4.3.5. &lt;/span&gt;The
         &lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt; protocol&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#events&quot;&gt;&lt;span class=secno&gt;4.3.5. &lt;/span&gt;Events&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#events&quot;&gt;&lt;span class=secno&gt;4.3.6. &lt;/span&gt;Events&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#event-handler-attributes&quot;&gt;&lt;span class=secno&gt;4.3.5.1.
+         &lt;li&gt;&lt;a href=&quot;#event-handler-attributes&quot;&gt;&lt;span class=secno&gt;4.3.6.1.
           &lt;/span&gt;Event handler attributes&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#event&quot;&gt;&lt;span class=secno&gt;4.3.5.2. &lt;/span&gt;Event
+         &lt;li&gt;&lt;a href=&quot;#event&quot;&gt;&lt;span class=secno&gt;4.3.6.2. &lt;/span&gt;Event
           firing&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#events0&quot;&gt;&lt;span class=secno&gt;4.3.5.3. &lt;/span&gt;Events and
+         &lt;li&gt;&lt;a href=&quot;#events0&quot;&gt;&lt;span class=secno&gt;4.3.6.3. &lt;/span&gt;Events and
           the &lt;code&gt;Window&lt;/code&gt; object&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#runtime-script-errors&quot;&gt;&lt;span class=secno&gt;4.3.5.4.
+         &lt;li&gt;&lt;a href=&quot;#runtime-script-errors&quot;&gt;&lt;span class=secno&gt;4.3.6.4.
           &lt;/span&gt;Runtime script errors&lt;/a&gt;
         &lt;/ul&gt;
       &lt;/ul&gt;
@@ -1014,279 +1016,311 @@
 
      &lt;li&gt;&lt;a href=&quot;#browser&quot;&gt;&lt;span class=secno&gt;4.5. &lt;/span&gt;Browser state&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#offline&quot;&gt;&lt;span class=secno&gt;4.5.1. &lt;/span&gt;Offline Web
-        applications&lt;/a&gt;
-
-       &lt;li&gt;&lt;a href=&quot;#custom-handlers&quot;&gt;&lt;span class=secno&gt;4.5.2. &lt;/span&gt;Custom
+       &lt;li&gt;&lt;a href=&quot;#custom-handlers&quot;&gt;&lt;span class=secno&gt;4.5.1. &lt;/span&gt;Custom
         protocol and content handlers&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#security3&quot;&gt;&lt;span class=secno&gt;4.5.2.1. &lt;/span&gt;Security
+         &lt;li&gt;&lt;a href=&quot;#security3&quot;&gt;&lt;span class=secno&gt;4.5.1.1. &lt;/span&gt;Security
           and privacy&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#sample-handler-impl&quot;&gt;&lt;span class=secno&gt;4.5.2.2.
+         &lt;li&gt;&lt;a href=&quot;#sample-handler-impl&quot;&gt;&lt;span class=secno&gt;4.5.1.2.
           &lt;/span&gt;Sample user interface&lt;/a&gt;
         &lt;/ul&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#history&quot;&gt;&lt;span class=secno&gt;4.6. &lt;/span&gt;Session history and
+     &lt;li&gt;&lt;a href=&quot;#offline&quot;&gt;&lt;span class=secno&gt;4.6. &lt;/span&gt;Offline Web
+      applications&lt;/a&gt;
+      &lt;ul class=toc&gt;
+       &lt;li&gt;&lt;a href=&quot;#introduction1&quot;&gt;&lt;span class=secno&gt;4.6.1.
+        &lt;/span&gt;Introduction&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#appcache&quot;&gt;&lt;span class=secno&gt;4.6.2. &lt;/span&gt;Application
+        caches&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#manifests&quot;&gt;&lt;span class=secno&gt;4.6.3. &lt;/span&gt;The cache
+        manifest syntax&lt;/a&gt;
+        &lt;ul class=toc&gt;
+         &lt;li&gt;&lt;a href=&quot;#writing&quot;&gt;&lt;span class=secno&gt;4.6.3.1. &lt;/span&gt;Writing
+          cache manifests&lt;/a&gt;
+
+         &lt;li&gt;&lt;a href=&quot;#parsing0&quot;&gt;&lt;span class=secno&gt;4.6.3.2. &lt;/span&gt;Parsing
+          cache manifests&lt;/a&gt;
+        &lt;/ul&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#updating1&quot;&gt;&lt;span class=secno&gt;4.6.4. &lt;/span&gt;Updating an
+        application cache&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#processing2&quot;&gt;&lt;span class=secno&gt;4.6.5. &lt;/span&gt;Processing
+        model&lt;/a&gt;
+        &lt;ul class=toc&gt;
+         &lt;li&gt;&lt;a href=&quot;#changes&quot;&gt;&lt;span class=secno&gt;4.6.5.1. &lt;/span&gt;Changes to
+          the networking model&lt;/a&gt;
+        &lt;/ul&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#application&quot;&gt;&lt;span class=secno&gt;4.6.6. &lt;/span&gt;Application
+        cache API&lt;/a&gt;
+
+       &lt;li&gt;&lt;a href=&quot;#browser0&quot;&gt;&lt;span class=secno&gt;4.6.7. &lt;/span&gt;Browser
+        state&lt;/a&gt;
+      &lt;/ul&gt;
+
+     &lt;li&gt;&lt;a href=&quot;#history&quot;&gt;&lt;span class=secno&gt;4.7. &lt;/span&gt;Session history and
       navigation&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#the-session&quot;&gt;&lt;span class=secno&gt;4.6.1. &lt;/span&gt;The session
+       &lt;li&gt;&lt;a href=&quot;#the-session&quot;&gt;&lt;span class=secno&gt;4.7.1. &lt;/span&gt;The session
         history of browsing contexts&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-history&quot;&gt;&lt;span class=secno&gt;4.6.2. &lt;/span&gt;The
+       &lt;li&gt;&lt;a href=&quot;#the-history&quot;&gt;&lt;span class=secno&gt;4.7.2. &lt;/span&gt;The
         &lt;code&gt;History&lt;/code&gt; interface&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#activating&quot;&gt;&lt;span class=secno&gt;4.6.3. &lt;/span&gt;Activating
+       &lt;li&gt;&lt;a href=&quot;#activating&quot;&gt;&lt;span class=secno&gt;4.7.3. &lt;/span&gt;Activating
         state objects&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-location&quot;&gt;&lt;span class=secno&gt;4.6.4. &lt;/span&gt;The
+       &lt;li&gt;&lt;a href=&quot;#the-location&quot;&gt;&lt;span class=secno&gt;4.7.4. &lt;/span&gt;The
         &lt;code&gt;Location&lt;/code&gt; interface&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#security4&quot;&gt;&lt;span class=secno&gt;4.6.4.1.
+         &lt;li&gt;&lt;a href=&quot;#security4&quot;&gt;&lt;span class=secno&gt;4.7.4.1.
           &lt;/span&gt;Security&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#history-notes&quot;&gt;&lt;span class=secno&gt;4.6.5.
+       &lt;li&gt;&lt;a href=&quot;#history-notes&quot;&gt;&lt;span class=secno&gt;4.7.5.
         &lt;/span&gt;Implementation notes for session history&lt;/a&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#navigating&quot;&gt;&lt;span class=secno&gt;4.7. &lt;/span&gt;Navigating
+     &lt;li&gt;&lt;a href=&quot;#navigating&quot;&gt;&lt;span class=secno&gt;4.8. &lt;/span&gt;Navigating
       across documents&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#read-html&quot;&gt;&lt;span class=secno&gt;4.7.1. &lt;/span&gt;Page load
+       &lt;li&gt;&lt;a href=&quot;#read-html&quot;&gt;&lt;span class=secno&gt;4.8.1. &lt;/span&gt;Page load
         processing model for HTML files&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#read-xml&quot;&gt;&lt;span class=secno&gt;4.7.2. &lt;/span&gt;Page load
+       &lt;li&gt;&lt;a href=&quot;#read-xml&quot;&gt;&lt;span class=secno&gt;4.8.2. &lt;/span&gt;Page load
         processing model for XML files&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#read-text&quot;&gt;&lt;span class=secno&gt;4.7.3. &lt;/span&gt;Page load
+       &lt;li&gt;&lt;a href=&quot;#read-text&quot;&gt;&lt;span class=secno&gt;4.8.3. &lt;/span&gt;Page load
         processing model for text files&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#read-image&quot;&gt;&lt;span class=secno&gt;4.7.4. &lt;/span&gt;Page load
+       &lt;li&gt;&lt;a href=&quot;#read-image&quot;&gt;&lt;span class=secno&gt;4.8.4. &lt;/span&gt;Page load
         processing model for images&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#read-plugin&quot;&gt;&lt;span class=secno&gt;4.7.5. &lt;/span&gt;Page load
+       &lt;li&gt;&lt;a href=&quot;#read-plugin&quot;&gt;&lt;span class=secno&gt;4.8.5. &lt;/span&gt;Page load
         processing model for content that uses plugins&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#non-DOM-inline-content&quot;&gt;&lt;span class=secno&gt;4.7.6.
-        &lt;/span&gt;Page load processing model for inline content that doesn't
-        have a DOM&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#read-ua-inline&quot;&gt;&lt;span class=secno&gt;4.8.6. &lt;/span&gt;Page
+        load processing model for inline content that doesn't have a DOM&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#scroll-to-fragid&quot;&gt;&lt;span class=secno&gt;4.7.7.
+       &lt;li&gt;&lt;a href=&quot;#scroll-to-fragid&quot;&gt;&lt;span class=secno&gt;4.8.7.
         &lt;/span&gt;Scrolling to a fragment identifier&lt;/a&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#content-type-sniffing&quot;&gt;&lt;span class=secno&gt;4.8.
+     &lt;li&gt;&lt;a href=&quot;#content-type-sniffing&quot;&gt;&lt;span class=secno&gt;4.9.
       &lt;/span&gt;Determining the type of a new resource in a browsing context&lt;/a&gt;
       
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#content-type0&quot;&gt;&lt;span class=secno&gt;4.8.1.
+       &lt;li&gt;&lt;a href=&quot;#content-type0&quot;&gt;&lt;span class=secno&gt;4.9.1.
         &lt;/span&gt;Content-Type sniffing: text or binary&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type1&quot;&gt;&lt;span class=secno&gt;4.8.2.
+       &lt;li&gt;&lt;a href=&quot;#content-type1&quot;&gt;&lt;span class=secno&gt;4.9.2.
         &lt;/span&gt;Content-Type sniffing: unknown type&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type2&quot;&gt;&lt;span class=secno&gt;4.8.3.
+       &lt;li&gt;&lt;a href=&quot;#content-type2&quot;&gt;&lt;span class=secno&gt;4.9.3.
         &lt;/span&gt;Content-Type sniffing: image&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type3&quot;&gt;&lt;span class=secno&gt;4.8.4.
+       &lt;li&gt;&lt;a href=&quot;#content-type3&quot;&gt;&lt;span class=secno&gt;4.9.4.
         &lt;/span&gt;Content-Type sniffing: feed or HTML&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#content-type&quot;&gt;&lt;span class=secno&gt;4.8.5.
+       &lt;li&gt;&lt;a href=&quot;#content-type&quot;&gt;&lt;span class=secno&gt;4.9.5.
         &lt;/span&gt;Content-Type metadata&lt;/a&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#storage&quot;&gt;&lt;span class=secno&gt;4.9. &lt;/span&gt;Client-side session
-      and persistent storage of name/value pairs&lt;/a&gt;
+     &lt;li&gt;&lt;a href=&quot;#storage&quot;&gt;&lt;span class=secno&gt;4.10. &lt;/span&gt;Client-side
+      session and persistent storage of name/value pairs&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#introduction1&quot;&gt;&lt;span class=secno&gt;4.9.1.
+       &lt;li&gt;&lt;a href=&quot;#introduction2&quot;&gt;&lt;span class=secno&gt;4.10.1.
         &lt;/span&gt;Introduction&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-storage&quot;&gt;&lt;span class=secno&gt;4.9.2. &lt;/span&gt;The
+       &lt;li&gt;&lt;a href=&quot;#the-storage&quot;&gt;&lt;span class=secno&gt;4.10.2. &lt;/span&gt;The
         &lt;code&gt;Storage&lt;/code&gt; interface&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-storageitem&quot;&gt;&lt;span class=secno&gt;4.9.3. &lt;/span&gt;The
+       &lt;li&gt;&lt;a href=&quot;#the-storageitem&quot;&gt;&lt;span class=secno&gt;4.10.3. &lt;/span&gt;The
         &lt;code&gt;StorageItem&lt;/code&gt; interface&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-sessionstorage&quot;&gt;&lt;span class=secno&gt;4.9.4. &lt;/span&gt;The
+       &lt;li&gt;&lt;a href=&quot;#the-sessionstorage&quot;&gt;&lt;span class=secno&gt;4.10.4. &lt;/span&gt;The
         &lt;code title=dom-sessionStorage&gt;sessionStorage&lt;/code&gt; attribute&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-globalstorage&quot;&gt;&lt;span class=secno&gt;4.9.5. &lt;/span&gt;The
+       &lt;li&gt;&lt;a href=&quot;#the-globalstorage&quot;&gt;&lt;span class=secno&gt;4.10.5. &lt;/span&gt;The
         &lt;code title=dom-globalStorage&gt;globalStorage&lt;/code&gt; attribute&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#the-storage0&quot;&gt;&lt;span class=secno&gt;4.9.6. &lt;/span&gt;The &lt;code
+       &lt;li&gt;&lt;a href=&quot;#the-storage0&quot;&gt;&lt;span class=secno&gt;4.10.6. &lt;/span&gt;The &lt;code
         title=event-storage&gt;storage&lt;/code&gt; event&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#miscellaneous0&quot;&gt;&lt;span class=secno&gt;4.9.7.
+       &lt;li&gt;&lt;a href=&quot;#miscellaneous0&quot;&gt;&lt;span class=secno&gt;4.10.7.
         &lt;/span&gt;Miscellaneous implementation requirements for storage
         areas&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#disk-space&quot;&gt;&lt;span class=secno&gt;4.9.7.1. &lt;/span&gt;Disk
+         &lt;li&gt;&lt;a href=&quot;#disk-space&quot;&gt;&lt;span class=secno&gt;4.10.7.1. &lt;/span&gt;Disk
           space&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#threads0&quot;&gt;&lt;span class=secno&gt;4.9.7.2.
+         &lt;li&gt;&lt;a href=&quot;#threads0&quot;&gt;&lt;span class=secno&gt;4.10.7.2.
           &lt;/span&gt;Threads&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#security5&quot;&gt;&lt;span class=secno&gt;4.9.8. &lt;/span&gt;Security and
+       &lt;li&gt;&lt;a href=&quot;#security5&quot;&gt;&lt;span class=secno&gt;4.10.8. &lt;/span&gt;Security and
         privacy&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#user-tracking&quot;&gt;&lt;span class=secno&gt;4.9.8.1. &lt;/span&gt;User
+         &lt;li&gt;&lt;a href=&quot;#user-tracking&quot;&gt;&lt;span class=secno&gt;4.10.8.1. &lt;/span&gt;User
           tracking&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#cookie&quot;&gt;&lt;span class=secno&gt;4.9.8.2. &lt;/span&gt;Cookie
+         &lt;li&gt;&lt;a href=&quot;#cookie&quot;&gt;&lt;span class=secno&gt;4.10.8.2. &lt;/span&gt;Cookie
           resurrection&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#integrity&quot;&gt;&lt;span class=secno&gt;4.9.8.3. &lt;/span&gt;Integrity
-          of &quot;public&quot; storage areas&lt;/a&gt;
+         &lt;li&gt;&lt;a href=&quot;#integrity&quot;&gt;&lt;span class=secno&gt;4.10.8.3.
+          &lt;/span&gt;Integrity of &quot;public&quot; storage areas&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#cross-protocol&quot;&gt;&lt;span class=secno&gt;4.9.8.4.
+         &lt;li&gt;&lt;a href=&quot;#cross-protocol&quot;&gt;&lt;span class=secno&gt;4.10.8.4.
           &lt;/span&gt;Cross-protocol and cross-port attacks&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#dns-spoofing&quot;&gt;&lt;span class=secno&gt;4.9.8.5. &lt;/span&gt;DNS
+         &lt;li&gt;&lt;a href=&quot;#dns-spoofing&quot;&gt;&lt;span class=secno&gt;4.10.8.5. &lt;/span&gt;DNS
           spoofing attacks&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#cross-directory&quot;&gt;&lt;span class=secno&gt;4.9.8.6.
+         &lt;li&gt;&lt;a href=&quot;#cross-directory&quot;&gt;&lt;span class=secno&gt;4.10.8.6.
           &lt;/span&gt;Cross-directory attacks&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#public&quot;&gt;&lt;span class=secno&gt;4.9.8.7. &lt;/span&gt;Public
+         &lt;li&gt;&lt;a href=&quot;#public&quot;&gt;&lt;span class=secno&gt;4.10.8.7. &lt;/span&gt;Public
           storage areas corresponding to hosts&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#storage0&quot;&gt;&lt;span class=secno&gt;4.9.8.8. &lt;/span&gt;Storage
+         &lt;li&gt;&lt;a href=&quot;#storage0&quot;&gt;&lt;span class=secno&gt;4.10.8.8. &lt;/span&gt;Storage
           areas in the face of untrusted higher-level domains that do not
           correspond to public storage areas&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#storage1&quot;&gt;&lt;span class=secno&gt;4.9.8.9. &lt;/span&gt;Storage
+         &lt;li&gt;&lt;a href=&quot;#storage1&quot;&gt;&lt;span class=secno&gt;4.10.8.9. &lt;/span&gt;Storage
           areas in the face of untrusted subdomains&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#implementation&quot;&gt;&lt;span class=secno&gt;4.9.8.10.
+         &lt;li&gt;&lt;a href=&quot;#implementation&quot;&gt;&lt;span class=secno&gt;4.10.8.10.
           &lt;/span&gt;Implementation risks&lt;/a&gt;
         &lt;/ul&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#sql&quot;&gt;&lt;span class=secno&gt;4.10. &lt;/span&gt;Client-side database
+     &lt;li&gt;&lt;a href=&quot;#sql&quot;&gt;&lt;span class=secno&gt;4.11. &lt;/span&gt;Client-side database
       storage&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#introduction2&quot;&gt;&lt;span class=secno&gt;4.10.1.
+       &lt;li&gt;&lt;a href=&quot;#introduction3&quot;&gt;&lt;span class=secno&gt;4.11.1.
         &lt;/span&gt;Introduction&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#databases&quot;&gt;&lt;span class=secno&gt;4.10.2.
+       &lt;li&gt;&lt;a href=&quot;#databases&quot;&gt;&lt;span class=secno&gt;4.11.2.
         &lt;/span&gt;Databases&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#executing&quot;&gt;&lt;span class=secno&gt;4.10.3. &lt;/span&gt;Executing
+       &lt;li&gt;&lt;a href=&quot;#executing&quot;&gt;&lt;span class=secno&gt;4.11.3. &lt;/span&gt;Executing
         SQL statements&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#database&quot;&gt;&lt;span class=secno&gt;4.10.4. &lt;/span&gt;Database
+       &lt;li&gt;&lt;a href=&quot;#database&quot;&gt;&lt;span class=secno&gt;4.11.4. &lt;/span&gt;Database
         query results&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#privacy&quot;&gt;&lt;span class=secno&gt;4.10.5. &lt;/span&gt;Privacy&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#privacy&quot;&gt;&lt;span class=secno&gt;4.11.5. &lt;/span&gt;Privacy&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#security6&quot;&gt;&lt;span class=secno&gt;4.10.6. &lt;/span&gt;Security&lt;/a&gt;
+       &lt;li&gt;&lt;a href=&quot;#security6&quot;&gt;&lt;span class=secno&gt;4.11.6. &lt;/span&gt;Security&lt;/a&gt;
         
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#user-agents&quot;&gt;&lt;span class=secno&gt;4.10.6.1. &lt;/span&gt;User
+         &lt;li&gt;&lt;a href=&quot;#user-agents&quot;&gt;&lt;span class=secno&gt;4.11.6.1. &lt;/span&gt;User
           agents&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#sql-injection&quot;&gt;&lt;span class=secno&gt;4.10.6.2. &lt;/span&gt;SQL
+         &lt;li&gt;&lt;a href=&quot;#sql-injection&quot;&gt;&lt;span class=secno&gt;4.11.6.2. &lt;/span&gt;SQL
           injection&lt;/a&gt;
         &lt;/ul&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#links&quot;&gt;&lt;span class=secno&gt;4.11. &lt;/span&gt;Links&lt;/a&gt;
+     &lt;li&gt;&lt;a href=&quot;#links&quot;&gt;&lt;span class=secno&gt;4.12. &lt;/span&gt;Links&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#hyperlink&quot;&gt;&lt;span class=secno&gt;4.11.1. &lt;/span&gt;Hyperlink
+       &lt;li&gt;&lt;a href=&quot;#hyperlink&quot;&gt;&lt;span class=secno&gt;4.12.1. &lt;/span&gt;Hyperlink
         elements&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#following&quot;&gt;&lt;span class=secno&gt;4.11.2. &lt;/span&gt;Following
+       &lt;li&gt;&lt;a href=&quot;#following&quot;&gt;&lt;span class=secno&gt;4.12.2. &lt;/span&gt;Following
         hyperlinks&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#hyperlink0&quot;&gt;&lt;span class=secno&gt;4.11.2.1.
+         &lt;li&gt;&lt;a href=&quot;#hyperlink0&quot;&gt;&lt;span class=secno&gt;4.12.2.1.
           &lt;/span&gt;Hyperlink auditing&lt;/a&gt;
         &lt;/ul&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#linkTypes&quot;&gt;&lt;span class=secno&gt;4.11.3. &lt;/span&gt;Link
+       &lt;li&gt;&lt;a href=&quot;#linkTypes&quot;&gt;&lt;span class=secno&gt;4.12.3. &lt;/span&gt;Link
         types&lt;/a&gt;
         &lt;ul class=toc&gt;
-         &lt;li&gt;&lt;a href=&quot;#link-type&quot;&gt;&lt;span class=secno&gt;4.11.3.1. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type&quot;&gt;&lt;span class=secno&gt;4.12.3.1. &lt;/span&gt;Link
           type &quot;&lt;code&gt;alternate&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type0&quot;&gt;&lt;span class=secno&gt;4.11.3.2. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type0&quot;&gt;&lt;span class=secno&gt;4.12.3.2. &lt;/span&gt;Link
           type &quot;&lt;code&gt;archives&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type1&quot;&gt;&lt;span class=secno&gt;4.11.3.3. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type1&quot;&gt;&lt;span class=secno&gt;4.12.3.3. &lt;/span&gt;Link
           type &quot;&lt;code&gt;author&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type2&quot;&gt;&lt;span class=secno&gt;4.11.3.4. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type2&quot;&gt;&lt;span class=secno&gt;4.12.3.4. &lt;/span&gt;Link
           type &quot;&lt;code&gt;bookmark&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type3&quot;&gt;&lt;span class=secno&gt;4.11.3.5. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type3&quot;&gt;&lt;span class=secno&gt;4.12.3.5. &lt;/span&gt;Link
           type &quot;&lt;code&gt;contact&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type4&quot;&gt;&lt;span class=secno&gt;4.11.3.6. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type4&quot;&gt;&lt;span class=secno&gt;4.12.3.6. &lt;/span&gt;Link
           type &quot;&lt;code&gt;external&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type5&quot;&gt;&lt;span class=secno&gt;4.11.3.7. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type5&quot;&gt;&lt;span class=secno&gt;4.12.3.7. &lt;/span&gt;Link
           type &quot;&lt;code&gt;feed&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type6&quot;&gt;&lt;span class=secno&gt;4.11.3.8. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type6&quot;&gt;&lt;span class=secno&gt;4.12.3.8. &lt;/span&gt;Link
           type &quot;&lt;code&gt;help&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type7&quot;&gt;&lt;span class=secno&gt;4.11.3.9. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type7&quot;&gt;&lt;span class=secno&gt;4.12.3.9. &lt;/span&gt;Link
           type &quot;&lt;code&gt;icon&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type8&quot;&gt;&lt;span class=secno&gt;4.11.3.10. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type8&quot;&gt;&lt;span class=secno&gt;4.12.3.10. &lt;/span&gt;Link
           type &quot;&lt;code&gt;license&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type9&quot;&gt;&lt;span class=secno&gt;4.11.3.11. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type9&quot;&gt;&lt;span class=secno&gt;4.12.3.11. &lt;/span&gt;Link
           type &quot;&lt;code&gt;nofollow&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type10&quot;&gt;&lt;span class=secno&gt;4.11.3.12. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type10&quot;&gt;&lt;span class=secno&gt;4.12.3.12. &lt;/span&gt;Link
           type &quot;&lt;code&gt;pingback&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type11&quot;&gt;&lt;span class=secno&gt;4.11.3.13. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type11&quot;&gt;&lt;span class=secno&gt;4.12.3.13. &lt;/span&gt;Link
           type &quot;&lt;code&gt;prefetch&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type12&quot;&gt;&lt;span class=secno&gt;4.11.3.14. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type12&quot;&gt;&lt;span class=secno&gt;4.12.3.14. &lt;/span&gt;Link
           type &quot;&lt;code&gt;search&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type13&quot;&gt;&lt;span class=secno&gt;4.11.3.15. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type13&quot;&gt;&lt;span class=secno&gt;4.12.3.15. &lt;/span&gt;Link
           type &quot;&lt;code&gt;stylesheet&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type14&quot;&gt;&lt;span class=secno&gt;4.11.3.16. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type14&quot;&gt;&lt;span class=secno&gt;4.12.3.16. &lt;/span&gt;Link
           type &quot;&lt;code&gt;sidebar&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#link-type15&quot;&gt;&lt;span class=secno&gt;4.11.3.17. &lt;/span&gt;Link
+         &lt;li&gt;&lt;a href=&quot;#link-type15&quot;&gt;&lt;span class=secno&gt;4.12.3.17. &lt;/span&gt;Link
           type &quot;&lt;code&gt;tag&lt;/code&gt;&quot;&lt;/a&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#hierarchical&quot;&gt;&lt;span class=secno&gt;4.11.3.18.
+         &lt;li&gt;&lt;a href=&quot;#hierarchical&quot;&gt;&lt;span class=secno&gt;4.12.3.18.
           &lt;/span&gt;Hierarchical link types&lt;/a&gt;
           &lt;ul class=toc&gt;
-           &lt;li&gt;&lt;a href=&quot;#link-type16&quot;&gt;&lt;span class=secno&gt;4.11.3.18.1.
+           &lt;li&gt;&lt;a href=&quot;#link-type16&quot;&gt;&lt;span class=secno&gt;4.12.3.18.1.
             &lt;/span&gt;Link type &quot;&lt;code&gt;first&lt;/code&gt;&quot;&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#link-type17&quot;&gt;&lt;span class=secno&gt;4.11.3.18.2.
+           &lt;li&gt;&lt;a href=&quot;#link-type17&quot;&gt;&lt;span class=secno&gt;4.12.3.18.2.
             &lt;/span&gt;Link type &quot;&lt;code&gt;index&lt;/code&gt;&quot;&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#link-type18&quot;&gt;&lt;span class=secno&gt;4.11.3.18.3.
+           &lt;li&gt;&lt;a href=&quot;#link-type18&quot;&gt;&lt;span class=secno&gt;4.12.3.18.3.
             &lt;/span&gt;Link type &quot;&lt;code&gt;last&lt;/code&gt;&quot;&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#link-type19&quot;&gt;&lt;span class=secno&gt;4.11.3.18.4.
+           &lt;li&gt;&lt;a href=&quot;#link-type19&quot;&gt;&lt;span class=secno&gt;4.12.3.18.4.
             &lt;/span&gt;Link type &quot;&lt;code&gt;next&lt;/code&gt;&quot;&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#link-type20&quot;&gt;&lt;span class=secno&gt;4.11.3.18.5.
+           &lt;li&gt;&lt;a href=&quot;#link-type20&quot;&gt;&lt;span class=secno&gt;4.12.3.18.5.
             &lt;/span&gt;Link type &quot;&lt;code&gt;prev&lt;/code&gt;&quot;&lt;/a&gt;
 
-           &lt;li&gt;&lt;a href=&quot;#link-type21&quot;&gt;&lt;span class=secno&gt;4.11.3.18.6.
+           &lt;li&gt;&lt;a href=&quot;#link-type21&quot;&gt;&lt;span class=secno&gt;4.12.3.18.6.
             &lt;/span&gt;Link type &quot;&lt;code&gt;up&lt;/code&gt;&quot;&lt;/a&gt;
           &lt;/ul&gt;
 
-         &lt;li&gt;&lt;a href=&quot;#other0&quot;&gt;&lt;span class=secno&gt;4.11.3.19. &lt;/span&gt;Other link
+         &lt;li&gt;&lt;a href=&quot;#other0&quot;&gt;&lt;span class=secno&gt;4.12.3.19. &lt;/span&gt;Other link
           types&lt;/a&gt;
         &lt;/ul&gt;
       &lt;/ul&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#interfaces&quot;&gt;&lt;span class=secno&gt;4.12. &lt;/span&gt;Interfaces for
+     &lt;li&gt;&lt;a href=&quot;#interfaces&quot;&gt;&lt;span class=secno&gt;4.13. &lt;/span&gt;Interfaces for
       URI manipulation&lt;/a&gt;
     &lt;/ul&gt;
 
@@ -1393,7 +1427,7 @@
        &lt;li&gt;&lt;a href=&quot;#connecting&quot;&gt;&lt;span class=secno&gt;6.2.2. &lt;/span&gt;Connecting
         to an event stream&lt;/a&gt;
 
-       &lt;li&gt;&lt;a href=&quot;#parsing0&quot;&gt;&lt;span class=secno&gt;6.2.3. &lt;/span&gt;Parsing an
+       &lt;li&gt;&lt;a href=&quot;#parsing1&quot;&gt;&lt;span class=secno&gt;6.2.3. &lt;/span&gt;Parsing an
         event stream&lt;/a&gt;
 
        &lt;li&gt;&lt;a href=&quot;#event-stream-interpretation&quot;&gt;&lt;span class=secno&gt;6.2.4.
@@ -1466,7 +1500,7 @@
      &lt;li&gt;&lt;a href=&quot;#crossDocumentMessages&quot;&gt;&lt;span class=secno&gt;6.4.
       &lt;/span&gt;Cross-document messaging&lt;/a&gt;
       &lt;ul class=toc&gt;
-       &lt;li&gt;&lt;a href=&quot;#processing2&quot;&gt;&lt;span class=secno&gt;6.4.1. &lt;/span&gt;Processing
+       &lt;li&gt;&lt;a href=&quot;#processing3&quot;&gt;&lt;span class=secno&gt;6.4.1. &lt;/span&gt;Processing
         model&lt;/a&gt;
       &lt;/ul&gt;
     &lt;/ul&gt;
@@ -1476,7 +1510,7 @@
 
    &lt;li&gt;&lt;a href=&quot;#syntax&quot;&gt;&lt;span class=secno&gt;8. &lt;/span&gt;The HTML syntax&lt;/a&gt;
     &lt;ul class=toc&gt;
-     &lt;li&gt;&lt;a href=&quot;#writing&quot;&gt;&lt;span class=secno&gt;8.1. &lt;/span&gt;Writing HTML
+     &lt;li&gt;&lt;a href=&quot;#writing0&quot;&gt;&lt;span class=secno&gt;8.1. &lt;/span&gt;Writing HTML
       documents&lt;/a&gt;
       &lt;ul class=toc&gt;
        &lt;li&gt;&lt;a href=&quot;#the-doctype&quot;&gt;&lt;span class=secno&gt;8.1.1. &lt;/span&gt;The
@@ -1591,7 +1625,7 @@
      &lt;li&gt;&lt;a href=&quot;#serialising&quot;&gt;&lt;span class=secno&gt;8.4. &lt;/span&gt;Serialising
       HTML fragments&lt;/a&gt;
 
-     &lt;li&gt;&lt;a href=&quot;#parsing1&quot;&gt;&lt;span class=secno&gt;8.5. &lt;/span&gt;Parsing HTML
+     &lt;li&gt;&lt;a href=&quot;#parsing2&quot;&gt;&lt;span class=secno&gt;8.5. &lt;/span&gt;Parsing HTML
       fragments&lt;/a&gt;
 
      &lt;li&gt;&lt;a href=&quot;#entities&quot;&gt;&lt;span class=secno&gt;8.6. &lt;/span&gt;Entities&lt;/a&gt;
@@ -1831,6 +1865,11 @@
    letters in this specification. &lt;a href=&quot;#refsRFC2119&quot;&gt;[RFC2119]&lt;/a&gt;&lt;/p&gt;
   &lt;!-- XXX but they should be marked up --&gt;
 
+  &lt;p&gt;Requirements phrased in the imperative as part of algorithms (such as
+   &quot;strip any leading space characters&quot; or &quot;return false and abort these
+   steps&quot;) are to be interpreted with the meaning of the key word (&quot;must&quot;,
+   &quot;should&quot;, &quot;may&quot;, etc) used in introducing the algorithm.
+
   &lt;p&gt;This specification describes the conformance criteria for user agents
    (relevant to implementors) and documents (relevant to authors and
    authoring tool implementors).
@@ -2263,10 +2302,9 @@
 
   &lt;p&gt;For readability, the term URI is used to refer to both ASCII URIs and
    Unicode IRIs, as those terms are defined by RFC 3986 and RFC 3987
-   respectively, and as modified by RFC 2732. On the rare occasions where
-   IRIs are not allowed but ASCII URIs are, this is called out explicitly. &lt;a
-   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-   href=&quot;#refsRFC2732&quot;&gt;[RFC2732]&lt;/a&gt;
+   respectively. On the rare occasions where IRIs are not allowed but ASCII
+   URIs are, this is called out explicitly. &lt;a
+   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
 
   &lt;p&gt;The term &lt;dfn id=root-element&gt;root element&lt;/dfn&gt;, when not qualified to
    explicitly refer to the document's root element, means the furthest
@@ -2559,8 +2597,8 @@
   &lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt; object's &lt;span title=&quot;the document's
    address&quot;&gt;address&lt;/span&gt;&lt;!-- XXX xref --&gt; is hierarchical and uses a
    server-based naming authority, then its &lt;dfn id=domain0 title=&quot;document's
-   domain&quot;&gt;domain&lt;/dfn&gt; is the &lt;hostname&gt; part of that address.
-   Otherwise, it has no domain.
+   domain&quot;&gt;domain&lt;/dfn&gt; is the &lt;host&gt;/&lt;ihost&gt; part of that
+   address. Otherwise, it has no domain.
 
   &lt;p class=note&gt;The &lt;code title=dom-document-domain&gt;&lt;a
    href=&quot;#domain&quot;&gt;domain&lt;/a&gt;&lt;/code&gt; attribute is used to enable pages on
@@ -2568,6 +2606,8 @@
    class=big-issue&gt;, though this is not yet defined by this
    specification&lt;/span&gt;.&lt;/p&gt;
   &lt;!-- XXX xref --&gt;
+
+  &lt;p class=big-issue&gt;we should handle IP addresses here&lt;/p&gt;
   &lt;!--XXX
     <A HREF="http://lxr.mozilla.org/seamonkey/source/content/html/document/src/nsHTMLDocument.cpp">http://lxr.mozilla.org/seamonkey/source/content/html/document/src/nsHTMLDocument.cpp</A>
     search for ::GetDomain ::SetDomain
@@ -3741,9 +3781,9 @@
    method must do nothing if there is no &lt;a
    href=&quot;#script-created&quot;&gt;script-created parser&lt;/a&gt; associated with the
    document. If there is such a parser, then, when the method is called, the
-   user agent must insert an &lt;a href=&quot;#explicit&quot;&gt;explicit &quot;EOF&quot; character&lt;/a&gt;
-   at the &lt;a href=&quot;#insertion&quot;&gt;insertion point&lt;/a&gt; of the parser's &lt;a
-   href=&quot;#input0&quot;&gt;input stream&lt;/a&gt;.
+   user agent must insert an &lt;a href=&quot;#explicit0&quot;&gt;explicit &quot;EOF&quot;
+   character&lt;/a&gt; at the &lt;a href=&quot;#insertion&quot;&gt;insertion point&lt;/a&gt; of the
+   parser's &lt;a href=&quot;#input0&quot;&gt;input stream&lt;/a&gt;.
 
   &lt;h4 id=dynamic0&gt;&lt;span class=secno&gt;2.5.2. &lt;/span&gt;Dynamic markup insertion in
    HTML&lt;/h4&gt;
@@ -19751,7 +19791,7 @@
    conforming document with no &lt;code&gt;&lt;a href=&quot;#noscript&quot;&gt;noscript&lt;/a&gt;&lt;/code&gt;
    elements and no &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; elements, and
    such that no step in the algorithm causes an &lt;a href=&quot;#html-0&quot;&gt;HTML
-   parser&lt;/a&gt; to flag a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;:
+   parser&lt;/a&gt; to flag a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;:
 
   &lt;ol&gt;
    &lt;li&gt;Remove every &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element from
@@ -24647,6 +24687,8 @@
   &lt;p&gt;Access to certain APIs is granted or denied to scripts based on the &lt;dfn
    id=origin0&gt;origin&lt;/dfn&gt; of the script and the API being accessed.
 
+  &lt;p&gt;The origin of a script depends on the context of that script:
+
   &lt;dl&gt;
    &lt;dt&gt;If a script is in a &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element
 
@@ -24703,14 +24745,14 @@
 
   &lt;p&gt;The origin of a &lt;code&gt;Document&lt;/code&gt; or image that was served over the
    network and whose address uses a URI scheme with a server-based naming
-   authority is the tuple consisting of the &lt;scheme&gt;, &lt;host&gt;, and
-   &lt;port&gt; parts of the &lt;code&gt;Document&lt;/code&gt;'s full URI. &lt;a
-   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-   href=&quot;#refsRFC2732&quot;&gt;[RFC2732]&lt;/a&gt;
+   authority is the tuple consisting of the &lt;scheme&gt;,
+   &lt;host&gt;/&lt;ihost&gt;, and &lt;port&gt; parts of the
+   &lt;code&gt;Document&lt;/code&gt;'s full URI. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
 
   &lt;p&gt;The origin of a &lt;code&gt;Document&lt;/code&gt; or image that was generated from a
    &lt;code&gt;data:&lt;/code&gt; URI found in another &lt;code&gt;Document&lt;/code&gt; or in a
-   script is the origin of the that &lt;code&gt;Document&lt;/code&gt; or script.
+   script is the origin of the &lt;code&gt;Document&lt;/code&gt; or script.
 
   &lt;p&gt;The origin of a &lt;code&gt;Document&lt;/code&gt; or image that was generated from a
    &lt;code&gt;data:&lt;/code&gt; URI from another source is a globally unique identifier
@@ -24739,11 +24781,93 @@
    kill multi-homed systems like GMail. Should we do something like have a
    DNS record say whether or not to include the IP in the origin for a host?
 
-  &lt;h4 id=security2&gt;&lt;span class=secno&gt;4.3.3. &lt;/span&gt;Security exceptions&lt;/h4&gt;
+  &lt;h4 id=unscripted&gt;&lt;span class=secno&gt;4.3.3. &lt;/span&gt;Unscripted same-origin
+   checks&lt;/h4&gt;
 
+  &lt;p&gt;When two URIs are to be compared to determine if they have the &lt;dfn
+   id=same-schemehostport&gt;same scheme/host/port&lt;/dfn&gt;, it means that the
+   following algorithm must be invoked, where &lt;var title=&quot;&quot;&gt;uri&lt;sub
+   title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;uri&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;
+   are the two URIs.
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;First, both &lt;var title=&quot;&quot;&gt;uri&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var
+     title=&quot;&quot;&gt;uri&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; must be normalized to obtain the
+     two tuples (&lt;var title=&quot;&quot;&gt;scheme&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, &lt;var
+     title=&quot;&quot;&gt;host&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;sub
+     title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;) and (&lt;var title=&quot;&quot;&gt;scheme&lt;sub
+     title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;host&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;,
+     &lt;var title=&quot;&quot;&gt;port&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;), by applying the
+     following subalgorithm to each URI:&lt;/p&gt;
+
+    &lt;ol&gt;
+     &lt;li&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; be the URI being normalized.
+
+     &lt;li&gt;
+      &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; according to the rules described in
+       RFC 3986 and RFC 3987. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+       href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
+
+     &lt;li&gt;
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; does not use a server-based naming
+       authority, then fail the overall algorithm &mdash; the two URIs do not
+       have the same scheme/host/port.
+
+     &lt;li&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;scheme&gt; component of
+       the URI. If the UA doesn't support the given protocol, then fail the
+       overall algorithm &mdash; the two URIs do not have the same
+       scheme/host/port&lt;!-- (this should not be
+     possible, since this algorithm is only invoked with URIs that
+     have been actually fetched) --&gt;.
+
+     &lt;li&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the &lt;host&gt;/&lt;ihost&gt;
+       component of the URI.
+
+     &lt;li&gt;
+      &lt;p&gt;Apply the IDNA ToASCII algorithm to &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, with
+       both the AllowUnassigned and UseSTD3ASCIIRules flags set. Let &lt;var
+       title=&quot;&quot;&gt;host&lt;/var&gt; be the result of the ToASCII algorithm.&lt;/p&gt;
+
+      &lt;p&gt;If ToASCII fails to convert one of the components of the string,
+       e.g. because it is too long or because it contains invalid characters,
+       then fail the overall algorithm &mdash; the two URIs do not have the
+       same scheme/host/port. &lt;a href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;li&gt;
+      &lt;p&gt;If no port is explicitly listed, then let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;
+       be the default port for the protocol given by &lt;var
+       title=&quot;&quot;&gt;scheme&lt;/var&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be the
+       &lt;port&gt; component of the URI.
+
+     &lt;li&gt;
+      &lt;p&gt;Return the tuple (&lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt;, &lt;var
+       title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;).
+    &lt;/ol&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;scheme&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; is not
+     case-insensitively&lt;!-- XXX ascii case matching --&gt; identical to &lt;var
+     title=&quot;&quot;&gt;scheme&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, or if &lt;var title=&quot;&quot;&gt;host&lt;sub
+     title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; is not
+     case-insensitively&lt;!-- XXX ascii case matching --&gt; identical to &lt;var
+     title=&quot;&quot;&gt;host&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, or if &lt;var title=&quot;&quot;&gt;port&lt;sub
+     title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; is not identical to &lt;var title=&quot;&quot;&gt;port&lt;sub
+     title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, then fail the overall algorithm &mdash; the two
+     URIs do not have the same scheme/host/port.
+
+   &lt;li&gt;
+    &lt;p&gt;Otherwise, the two URIs do have the same scheme/host/port.
+  &lt;/ol&gt;
+
+  &lt;h4 id=security2&gt;&lt;span class=secno&gt;4.3.4. &lt;/span&gt;Security exceptions&lt;/h4&gt;
+
   &lt;p class=big-issue&gt;Define &lt;dfn id=security8&gt;security exception&lt;/dfn&gt;.
 
-  &lt;h4 id=javascript-protocol&gt;&lt;span class=secno&gt;4.3.4. &lt;/span&gt;&lt;dfn
+  &lt;h4 id=javascript-protocol&gt;&lt;span class=secno&gt;4.3.5. &lt;/span&gt;&lt;dfn
    id=the-javascript title=&quot;javascript protocol&quot;&gt;The &lt;code
    title=&quot;&quot;&gt;javascript:&lt;/code&gt; protocol&lt;/dfn&gt;&lt;/h4&gt;
 
@@ -24818,7 +24942,7 @@
     context&lt;/a&gt;.&lt;/p&gt;
   &lt;/div&gt;
 
-  &lt;h4 id=events&gt;&lt;span class=secno&gt;4.3.5. &lt;/span&gt;Events&lt;/h4&gt;
+  &lt;h4 id=events&gt;&lt;span class=secno&gt;4.3.6. &lt;/span&gt;Events&lt;/h4&gt;
 
   &lt;p class=big-issue&gt;We need to define how to handle events that are to be
    fired on a Document that is no longer the active document of its browsing
@@ -24829,7 +24953,7 @@
    element section, which says scripts don't run when the document isn't
    active.
 
-  &lt;h5 id=event-handler-attributes&gt;&lt;span class=secno&gt;4.3.5.1. &lt;/span&gt;Event
+  &lt;h5 id=event-handler-attributes&gt;&lt;span class=secno&gt;4.3.6.1. &lt;/span&gt;Event
    handler attributes&lt;/h5&gt;
 
   &lt;p&gt;&lt;a href=&quot;#html-elements&quot;&gt;HTML elements&lt;/a&gt; can have &lt;dfn id=event1&gt;event
@@ -24885,7 +25009,8 @@
    and DOM attributes, and on &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt;
    objects, as DOM attributes:
 
-  &lt;dl&gt;
+  &lt;dl&gt;&lt;!-- XXX should change 'the element' below to 'the object' or something --&gt;
+
    &lt;dt&gt;&lt;dfn id=onabort title=handler-onabort&gt;&lt;code&gt;onabort&lt;/code&gt;&lt;/dfn&gt;
 
    &lt;dd&gt;
@@ -25216,7 +25341,7 @@
    set to invoke the function associated with the event handler attribute
    otherwise.
 
-  &lt;h5 id=event&gt;&lt;span class=secno&gt;4.3.5.2. &lt;/span&gt;Event firing&lt;/h5&gt;
+  &lt;h5 id=event&gt;&lt;span class=secno&gt;4.3.6.2. &lt;/span&gt;Event firing&lt;/h5&gt;
 
   &lt;p class=big-issue&gt;maybe this should be moved higher up (terminology?
    conformance? DOM?) Also, the whole terminology thing should be changed so
@@ -25303,7 +25428,7 @@
    actions are defined in terms of &lt;em&gt;any&lt;/em&gt; event of the right type on
    that element, not those that are dispatched in expected ways.
 
-  &lt;h5 id=events0&gt;&lt;span class=secno&gt;4.3.5.3. &lt;/span&gt;Events and the &lt;code&gt;&lt;a
+  &lt;h5 id=events0&gt;&lt;span class=secno&gt;4.3.6.3. &lt;/span&gt;Events and the &lt;code&gt;&lt;a
    href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; object&lt;/h5&gt;
 
   &lt;p&gt;When an event is dispatched at a DOM node in a &lt;code&gt;Document&lt;/code&gt; in
@@ -25322,7 +25447,7 @@
     bubbling has been prevented.
   &lt;/ol&gt;
 
-  &lt;h5 id=runtime-script-errors&gt;&lt;span class=secno&gt;4.3.5.4. &lt;/span&gt;Runtime
+  &lt;h5 id=runtime-script-errors&gt;&lt;span class=secno&gt;4.3.6.4. &lt;/span&gt;Runtime
    script errors&lt;/h5&gt;
 
   &lt;p&gt;&lt;em&gt;This section only applies to user agents that support scripting in
@@ -25425,33 +25550,7 @@
 &lt;!-- XXX there are other attributes! --&gt;};&lt;/pre&gt;
   &lt;!-- also, see window.external.AddSearchProvider() and similar DOM APIs from IE --&gt;
 
-  &lt;h4 id=offline&gt;&lt;span class=secno&gt;4.5.1. &lt;/span&gt;Offline Web applications&lt;/h4&gt;
-
-  &lt;p&gt;The &lt;dfn id=navigator.online
-   title=dom-navigator-onLine&gt;&lt;code&gt;navigator.onLine&lt;/code&gt;&lt;/dfn&gt; attribute
-   must return false if the user agent will not contact the network when the
-   user follows links or when a script requests a remote page (or knows that
-   such an attempt would fail), and must return true otherwise.
-
-  &lt;p&gt;The &lt;dfn id=offline0 title=event-offline&gt;&lt;code&gt;offline&lt;/code&gt;&lt;/dfn&gt;
-   event must be fired when the value of the &lt;code
-   title=dom-navigator-onLine&gt;&lt;a
-   href=&quot;#navigator.online&quot;&gt;navigator.onLine&lt;/a&gt;&lt;/code&gt; attribute of the
-   &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; changes from true to false.
-
-  &lt;p&gt;The &lt;dfn id=online title=event-online&gt;&lt;code&gt;online&lt;/code&gt;&lt;/dfn&gt; event
-   must be fired when the value of the &lt;code title=dom-navigator-onLine&gt;&lt;a
-   href=&quot;#navigator.online&quot;&gt;navigator.onLine&lt;/a&gt;&lt;/code&gt; attribute of the
-   &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; changes from false to true.
-
-  &lt;p&gt;These events are in no namespace, do bubble, are not cancelable, have no
-   default action, and use the normal &lt;code&gt;Event&lt;/code&gt; interface. They must
-   be fired on &lt;a href=&quot;#the-body0&quot;&gt;the body element&lt;/a&gt;. (As the events
-   bubble, they will reach the &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt;
-   object.)&lt;/p&gt;
-  &lt;!-- XXX ononline onoffline need to be defined --&gt;
-
-  &lt;h4 id=custom-handlers&gt;&lt;span class=secno&gt;4.5.2. &lt;/span&gt;Custom protocol and
+  &lt;h4 id=custom-handlers&gt;&lt;span class=secno&gt;4.5.1. &lt;/span&gt;Custom protocol and
    content handlers&lt;/h4&gt;
 
   &lt;p&gt;The &lt;dfn id=registerprotocolhandler
@@ -25583,10 +25682,10 @@
 
   &lt;p&gt;This section does not define how the pages registered by these methods
    are used, beyond the requirements on how to process the &lt;var
-   title=&quot;&quot;&gt;uri&lt;/var&gt; value (see above). To some extent, the &lt;span
-   title=&quot;navigating across documents&quot;&gt;processing model for navigating across
-   documents&lt;/span&gt; defines some cases where these methods are relevant, but
-   in general UAs may use this information wherever they would otherwise
+   title=&quot;&quot;&gt;uri&lt;/var&gt; value (see above). To some extent, the &lt;a
+   href=&quot;#navigate&quot; title=navigate&gt;processing model for navigating across
+   documents&lt;/a&gt; defines some cases where these methods are relevant, but in
+   general UAs may use this information wherever they would otherwise
    consider handing content to native plugins or helper applications.
 
   &lt;p&gt;UAs must not use registered content handlers to handle content that was
@@ -25594,7 +25693,7 @@
    non-idempotent transaction), as the remote site would not be able to fetch
    the same data.
 
-  &lt;h5 id=security3&gt;&lt;span class=secno&gt;4.5.2.1. &lt;/span&gt;Security and privacy&lt;/h5&gt;
+  &lt;h5 id=security3&gt;&lt;span class=secno&gt;4.5.1.1. &lt;/span&gt;Security and privacy&lt;/h5&gt;
 
   &lt;p&gt;These mechanisms can introduce a number of concerns, in particular
    privacy concerns.
@@ -25672,7 +25771,7 @@
    trust the third-party handler, a decision many users are unable to make or
    even understand).
 
-  &lt;h5 id=sample-handler-impl&gt;&lt;span class=secno&gt;4.5.2.2. &lt;/span&gt;Sample user
+  &lt;h5 id=sample-handler-impl&gt;&lt;span class=secno&gt;4.5.1.2. &lt;/span&gt;Sample user
    interface&lt;/h5&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;
@@ -25755,9 +25854,1332 @@
    would work equivalently, but for unknown MIME types instead of unknown
    protocols.
 
-  &lt;h3 id=history&gt;&lt;span class=secno&gt;4.6. &lt;/span&gt;Session history and navigation&lt;/h3&gt;
+  &lt;h3 id=offline&gt;&lt;span class=secno&gt;4.6. &lt;/span&gt;Offline Web applications&lt;/h3&gt;
 
-  &lt;h4 id=the-session&gt;&lt;span class=secno&gt;4.6.1. &lt;/span&gt;The session history of
+  &lt;h4 id=introduction1&gt;&lt;span class=secno&gt;4.6.1. &lt;/span&gt;Introduction&lt;/h4&gt;
+
+  &lt;p class=big-issue&gt;...
+
+  &lt;h4 id=appcache&gt;&lt;span class=secno&gt;4.6.2. &lt;/span&gt;Application caches&lt;/h4&gt;
+
+  &lt;p&gt;An &lt;dfn id=application0&gt;application cache&lt;/dfn&gt; is a collection of
+   resources. An application cache is identified by the URI of a resource
+   manifest which is used to populate the cache.
+
+  &lt;p&gt;Application caches are versioned, and there can be different instances
+   of caches for the same manifest URI, each having a different version.
+
+  &lt;p&gt;Each group of application caches for the same manifest URI have a common
+   &lt;dfn id=update0 title=concept-appcache-status&gt;update status&lt;/dfn&gt;, which
+   is one of the following: &lt;i&gt;idle&lt;/i&gt;, &lt;i&gt;checking&lt;/i&gt;, &lt;i&gt;downloading&lt;/i&gt;,
+   &lt;i&gt;update ready&lt;/i&gt;.
+
+  &lt;p id=&quot;#appcache-history-1&quot;&gt;A &lt;a href=&quot;#browsing0&quot;&gt;browsing context&lt;/a&gt; can
+   be associated with an application cache. A &lt;a href=&quot;#child&quot;&gt;child browsing
+   context&lt;/a&gt; is always associated with the same browsing context as its &lt;a
+   href=&quot;#parent&quot;&gt;parent browsing context&lt;/a&gt;, if any. A &lt;a
+   href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; is associated with the
+   application cache appropriate for its &lt;a href=&quot;#active&quot;&gt;active
+   document&lt;/a&gt;. (A browsing context's associated cache thus can &lt;a
+   href=&quot;#appcache-history-2&quot;&gt;change&lt;/a&gt; during &lt;a href=&quot;#traverse&quot;
+   title=&quot;traverse the history&quot;&gt;session history traversal&lt;/a&gt;.)
+
+  &lt;p&gt;A &lt;code&gt;Document&lt;/code&gt; initially has no appropriate cache, but steps &lt;a
+   href=&quot;#parser-appcache&quot;&gt;in the parser&lt;/a&gt; and in the &lt;a href=&quot;#navigate&quot;
+   title=navigate&gt;navigation&lt;/a&gt; sections cause &lt;a href=&quot;#application2&quot;
+   title=concept-appcache-init-with-attribute&gt;cache selection&lt;/a&gt; to occur
+   early in the page load process.
+
+  &lt;p&gt;An application cache consists of:
+
+  &lt;ul&gt;
+   &lt;li&gt;
+    &lt;p&gt;One of more resources (including their out-of-band metadata, such as
+     HTTP headers, if any), identified by URIs, each falling into one (or
+     more) of the following categories:&lt;/p&gt;
+
+    &lt;dl&gt;
+     &lt;dt&gt;&lt;dfn id=implicit title=concept-appcache-implicit&gt;Implicit
+      entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources that were added to the cache because a &lt;a
+      href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; was &lt;a
+      href=&quot;#navigate&quot; title=navigate&gt;navigated&lt;/a&gt; to that document and the
+      document indicated that this was its cache, using the &lt;code
+      title=attr-html-application&gt;application&lt;/code&gt; attribute.
+
+     &lt;dt&gt;&lt;dfn id=the-manifest title=concept-appcache-manifest&gt;The
+      manifest&lt;/dfn&gt;
+
+     &lt;dd&gt;The resource corresponding to the URI that was given in an implicit
+      entry's &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element's &lt;code
+      title=attr-html-application&gt;application&lt;/code&gt; attribute. The manifest
+      is downloaded and processed during the &lt;a
+      href=&quot;#application1&quot;&gt;application cache update process&lt;/a&gt;. All the &lt;a
+      href=&quot;#implicit&quot; title=concept-appcache-implicit&gt;implicit entries&lt;/a&gt;
+      have the &lt;a href=&quot;#same-schemehostport&quot;&gt;same scheme/host/port&lt;/a&gt; as
+      the manifest.
+
+     &lt;dt&gt;&lt;dfn id=explicit title=concept-appcache-explicit&gt;Explicit
+      entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources that were listed in the cache's &lt;a href=&quot;#the-manifest&quot;
+      title=concept-appcache-manifest&gt;manifest&lt;/a&gt;. Explicit entries can also
+      be marked as &lt;dfn id=foreign
+      title=concept-appcache-foreign&gt;foreign&lt;/dfn&gt;, which means that they
+      have an &lt;code title=attr-html-application&gt;application&lt;/code&gt; attribute
+      but that it doesn't point at this cache's &lt;a href=&quot;#the-manifest&quot;
+      title=concept-appcache-manifest&gt;manifest&lt;/a&gt;.
+
+     &lt;dt&gt;&lt;dfn id=fallback0 title=concept-appcache-fallback&gt;Fallback
+      entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources that were listed in the cache's &lt;a href=&quot;#the-manifest&quot;
+      title=concept-appcache-manifest&gt;manifest&lt;/a&gt; as fallback entries.
+
+     &lt;dt&gt;&lt;dfn id=opportunistically
+      title=concept-appcache-oppcache&gt;Opportunistically cached entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources whose URIs &lt;a href=&quot;#matches&quot;
+      title=concept-appcache-matches-oppcache&gt;matched&lt;/a&gt; an &lt;a
+      href=&quot;#opportunistic&quot; title=concept-appcache-oppcache-ns&gt;opportunistic
+      caching namespace&lt;/a&gt; when they were fetched, and were therefore cached
+      in the application cache.
+
+     &lt;dt&gt;&lt;dfn id=dynamic3 title=concept-appcache-dynamic&gt;Dynamic
+      entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources that were added to the cache by the &lt;code
+      title=dom-appcache-add&gt;&lt;a href=&quot;#adduri&quot;&gt;add()&lt;/a&gt;&lt;/code&gt; method.
+    &lt;/dl&gt;
+
+   &lt;li&gt;Zero or more &lt;dfn id=opportunistic
+    title=concept-appcache-oppcache-ns&gt;opportunistic caching
+    namespaces&lt;/dfn&gt;: URIs, used as &lt;a href=&quot;#matches&quot;
+    title=concept-appcache-matches-oppcache&gt;prefix match patterns&lt;/a&gt;, each
+    of which is mapped to a &lt;a href=&quot;#fallback0&quot;
+    title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;. Each namespace URI
+    prefix, when parsed as a URI, has the &lt;a href=&quot;#same-schemehostport&quot;&gt;same
+    scheme/host/port&lt;/a&gt; as &lt;a href=&quot;#the-manifest&quot;
+    title=concept-appcache-manifest&gt;the manifest&lt;/a&gt;.
+
+   &lt;li&gt;Zero or more URIs that form the &lt;dfn id=online
+    title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/dfn&gt;.
+  &lt;/ul&gt;
+
+  &lt;p&gt;Multiple application caches can contain the same resource, e.g. if their
+   manifests all reference that resource. If the user agent is to &lt;dfn
+   id=select0 title=concept-appcache-selection&gt;select an application
+   cache&lt;/dfn&gt; from a list of caches that contain a resource, that the user
+   agent must use the application cache that the user most likely wants to
+   see the resource from, taking into account the following:
+
+  &lt;ul&gt;
+   &lt;li&gt;which application cache was most recently updated,
+
+   &lt;li&gt;which application cache was being used to display the resource from
+    which the user decided to look at the new resource, and
+
+   &lt;li&gt;which application cache the user prefers.
+  &lt;/ul&gt;
+
+  &lt;h4 id=manifests&gt;&lt;span class=secno&gt;4.6.3. &lt;/span&gt;The cache manifest syntax&lt;/h4&gt;
+
+  &lt;h5 id=writing&gt;&lt;span class=secno&gt;4.6.3.1. &lt;/span&gt;Writing cache manifests&lt;/h5&gt;
+
+  &lt;p&gt;Manifests must be served using the &lt;code
+   title=&quot;&quot;&gt;text/cache-manifest&lt;/code&gt; MIME type. All resources served using
+   the &lt;code title=&quot;&quot;&gt;text/cache-manifest&lt;/code&gt; MIME type must follow the
+   syntax of application cache manifests, as described in this section.
+
+  &lt;p&gt;An application cache manifest is a text file, whose text is encoded
+   using UTF-8. Data in application cache manifests is line-based. Newlines
+   must be represented by U+000A LINE FEED (LF) characters, U+000D CARRIAGE
+   RETURN (CR) characters, or U+000D CARRIAGE RETURN (CR) U+000A LINE FEED
+   (LF) pairs.
+
+  &lt;p class=note&gt;This is a willful double violation of RFC2046.
+
+  &lt;p&gt;The first line of an application cache manifest must consist of the
+   string &quot;CACHE&quot;, a single U+0020 SPACE character, the string &quot;MANIFEST&quot;,
+   and zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
+   characters. If any other text is found on the first line, the user agent
+   will ignore the entire file. The first line may optionally be preceded by
+   a U+FEFF BYTE ORDER MARK (BOM) character.
+
+  &lt;p&gt;Subsequent lines, if any, must all be one of the following:
+
+  &lt;dl&gt;
+   &lt;dt&gt;A blank line
+
+   &lt;dd&gt;
+    &lt;p&gt;Blank lines must consist of zero or more U+0020 SPACE and U+0009
+     CHARACTER TABULATION (tab) characters only.&lt;/p&gt;
+
+   &lt;dt&gt;A comment
+
+   &lt;dd&gt;
+    &lt;p&gt;Comment lines must consist of zero or more U+0020 SPACE and U+0009
+     CHARACTER TABULATION (tab) characters, followed by a single U+0023
+     NUMBER SIGN (#) character, followed by zero or more characters other
+     than U+000A LINE FEED (LF) and U+000D CARRIAGE RETURN (CR) characters.&lt;/p&gt;
+
+    &lt;p class=note&gt;Comments must be on a line on their own. If they were to be
+     included on a line with a URI, the &quot;#&quot; would be mistaken for part of a
+     fragment identifier.&lt;/p&gt;
+
+   &lt;dt&gt;A section header
+
+   &lt;dd&gt;
+    &lt;p&gt;Section headers change the current section. There are three possible
+     section headers:
+
+    &lt;dl&gt;
+     &lt;dt&gt;&lt;code&gt;CACHE:&lt;/code&gt;
+
+     &lt;dd&gt;Switches to the explicit section.
+
+     &lt;dt&gt;&lt;code&gt;FALLBACK:&lt;/code&gt;
+
+     &lt;dd&gt;Switches to the fallback section.
+
+     &lt;dt&gt;&lt;code&gt;NETWORK:&lt;/code&gt;
+
+     &lt;dd&gt;Switches to the online whitelist section.
+    &lt;/dl&gt;
+
+    &lt;p&gt;Section header lines must consist of zero or more U+0020 SPACE and
+     U+0009 CHARACTER TABULATION (tab) characters, followed by one of the
+     names above (including the U+003A COLON (:) character) followed by zero
+     or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.&lt;/p&gt;
+
+    &lt;p&gt;Ironically, by default, the current section is the explicit section.&lt;/p&gt;
+
+   &lt;dt&gt;Data for the current section
+
+   &lt;dd&gt;
+    &lt;p&gt;The format that data lines must take depends on the current section.&lt;/p&gt;
+
+    &lt;p&gt;When the current section is the explicit section or the online
+     whitelist section, data lines must consist of zero or more U+0020 SPACE
+     and U+0009 CHARACTER TABULATION (tab) characters, a valid URI reference
+     or IRI reference, and then zero or more U+0020 SPACE and U+0009
+     CHARACTER TABULATION (tab) characters. &lt;a
+     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p&gt;When the current section is the fallback section, data lines must
+     consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION
+     (tab) characters, a valid URI reference or IRI reference, one or more
+     U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, another
+     valid URI reference or IRI reference, and then zero or more U+0020 SPACE
+     and U+0009 CHARACTER TABULATION (tab) characters. &lt;a
+     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+  &lt;/dl&gt;
+
+  &lt;p&gt;Manifests may contain sections more than once. Sections may be empty.
+
+  &lt;p&gt;Manifests must specify all the URIs that are to be cached. URIs that are
+   to be fallback pages associated with &lt;a href=&quot;#opportunistic&quot;
+   title=concept-appcache-oppcache-ns&gt;opportunistic caching namespaces&lt;/a&gt;,
+   and those namespaces themselves, must be given in fallback sections, with
+   the namespace being the first URI of the data line, and the corresponding
+   fallback page being the second URI. All the other pages to be cached must
+   be listed in explicit sections.
+
+  &lt;p&gt;Relative URIs must be given relative to the manifest's own URI.
+
+  &lt;p&gt;URIs in manifests must not have fragment identifiers.
+
+  &lt;p&gt;&lt;a href=&quot;#opportunistic&quot;
+   title=concept-appcache-oppcache-ns&gt;Opportunistic caching namespaces&lt;/a&gt;
+   must have the &lt;a href=&quot;#same-schemehostport&quot;&gt;same scheme/host/port&lt;/a&gt; as
+   the manifest itself.
+
+  &lt;p&gt;An opportunistic caching namespace must not be listed more than once.
+
+  &lt;p&gt;URIs that the user agent is to put into the &lt;a href=&quot;#online&quot;
+   title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt; must all be
+   specified in online whitelist sections. (This is needed for any URI that
+   the page is intending to use to communicate back to the server.)
+
+  &lt;p&gt;URIs in the online whitelist section must not also be listed in explicit
+   section, and must not be listed as fallback entries in the fallback
+   section. (URIs in the online whitelist section may match opportunistic
+   caching namespaces, however.)
+
+  &lt;h5 id=parsing0&gt;&lt;span class=secno&gt;4.6.3.2. &lt;/span&gt;Parsing cache manifests&lt;/h5&gt;
+
+  &lt;p&gt;When a user agent is to &lt;dfn id=parse&gt;parse a manifest&lt;/dfn&gt;, it means
+   that the user agent must run the following steps:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;The user agent must decode the bytestream corresponding with the
+     manifest to be parsed, treating it as UTF-8. Bytes or sequences of bytes
+     that are not valid UTF-8 sequences must be interpreted as a U+FFFD
+     REPLACEMENT CHARACTER. All U+0000 NULL characters must be replaced by
+     U+FFFD REPLACEMENT CHARACTERs.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt; be an initially empty list of &lt;a
+     href=&quot;#explicit&quot; title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; be an initially empty mapping of
+     &lt;a href=&quot;#opportunistic&quot;
+     title=concept-appcache-oppcache-ns&gt;opportunistic caching namespaces&lt;/a&gt;
+     to &lt;a href=&quot;#fallback0&quot; title=concept-appcache-fallback&gt;fallback
+     entries&lt;/a&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;online whitelist URIs&lt;/var&gt; be an initially empty
+     list of URIs for a &lt;a href=&quot;#online&quot;
+     title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; be the decoded text of the manifest's
+     bytestream.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; be a pointer into &lt;var
+     title=&quot;&quot;&gt;input&lt;/var&gt;, initially pointing at the first character.
+
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is pointing at a U+FEFF BYTE ORDER
+     MARK (BOM) character, then advance &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; to the
+     next character.
+
+   &lt;li&gt;
+    &lt;p&gt;If the characters starting from &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; are
+     &quot;CACHE&quot;, followed by a U+0020 SPACE character, followed by &quot;MANIFEST&quot;,
+     then advance &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; to the next character after
+     those. Otherwise, this isn't a cache manifest; abort this algorithm with
+     a failure while checking for the magic signature.
+
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is not past the end of &lt;var
+     title=&quot;&quot;&gt;input&lt;/var&gt; and the character at &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;
+     is neither a U+000A LINE FEED (LF) characters nor a U+000D CARRIAGE
+     RETURN (CR) character, then this isn't a cache manifest; abort this
+     algorithm with a failure while checking for the magic signature.
+
+   &lt;li&gt;
+    &lt;p&gt;This is a cache manifest. The algorithm cannot fail beyond this point
+     (though bogus lines can get ignored).
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &quot;explicit&quot;.
+
+   &lt;li&gt;
+    &lt;p&gt;&lt;em&gt;Start of line&lt;/em&gt;: If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is past the
+     end of &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, then jump to the last step. Otherwise,
+     &lt;a href=&quot;#collect&quot;&gt;collect a sequence of characters&lt;/a&gt; that are U+000A
+     LINE FEED (LF), U+000D CARRIAGE RETURN (CR), U+0020 SPACE, or U+0009
+     CHARACTER TABULATION (tab) characters.
+
+   &lt;li&gt;
+    &lt;p&gt;Now, &lt;a href=&quot;#collect&quot;&gt;collect a sequence of characters&lt;/a&gt; that are
+     &lt;em&gt;not&lt;/em&gt; U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR)
+     characters, and let the result be &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;If the first character in &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is a U+0023 NUMBER
+     SIGN (#) character, then jump back to the step labelled &quot;start of line&quot;.
+
+   &lt;li&gt;
+    &lt;p&gt;Drop any trailing U+0020 SPACE, or U+0009 CHARACTER TABULATION (tab)
+     characters at the end of &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;CACHE:&quot; (the word &quot;CACHE&quot; followed
+     by a U+003A COLON (:) character), then set &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; to
+     &quot;explicit&quot; and jump back to the step labelled &quot;start of line&quot;.
+
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;FALLBACK:&quot; (the word &quot;FALLBACK&quot;
+     followed by a U+003A COLON (:) character), then set &lt;var
+     title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;fallback&quot; and jump back to the step labelled
+     &quot;start of line&quot;.
+
+   &lt;li&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;NETWORK:&quot; (the word &quot;NETWORK&quot;
+     followed by a U+003A COLON (:) character), then set &lt;var
+     title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;online whitelist&quot; and jump back to the step
+     labelled &quot;start of line&quot;.
+
+   &lt;li&gt;
+    &lt;p&gt;This is either a data line or it is syntactically incorrect.&lt;/p&gt;
+
+    &lt;dl class=switch&gt;
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;explicit&quot;
+
+     &lt;dd&gt;
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is not a syntactically valid URI
+       reference or IRI reference, then jump back to the step labelled &quot;start
+       of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, resolve the URI reference or IRI reference to an absolute
+       URI or IRI, drop any fragment identifier, and add this URI to the &lt;var
+       title=&quot;&quot;&gt;explicit URIs&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;fallback&quot;
+
+     &lt;dd&gt;
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; does not contain at least one U+0020
+       SPACE or U+0009 CHARACTER TABULATION (tab) character, then jump back
+       to the step labelled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, let everything before the first U+0020 SPACE or U+0009
+       CHARACTER TABULATION (tab) character in &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; be
+       &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;, and let everything after the first
+       U+0020 SPACE or U+0009 CHARACTER TABULATION (tab) character in &lt;var
+       title=&quot;&quot;&gt;line&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Strip any leading U+0020 SPACE or U+0009 CHARACTER TABULATION (tab)
+       characters in &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; are
+       not both syntactically valid URI or IRI references, then jump back to
+       the step labelled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Resolve the URI or IRI references in &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;
+       and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; to absolute URIs or IRIs.&lt;/p&gt;
+
+      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var title=&quot;&quot;&gt;part
+       one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; mapping
+       as an &lt;a href=&quot;#opportunistic&quot;
+       title=concept-appcache-oppcache-ns&gt;opportunistic caching
+       namespaces&lt;/a&gt;, then jump back to the step labelled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var title=&quot;&quot;&gt;part
+       one&lt;/var&gt; does not have the &lt;a href=&quot;#same-schemehostport&quot;&gt;same
+       scheme/host/port&lt;/a&gt; as the manifest's URI, then jump back to the step
+       labelled &quot;start of line&quot;.&lt;/p&gt;
+      &lt;!-- SECURITY --&gt;
+      &lt;p&gt;Otherwise, add the absolute URI or IRI corresponding to &lt;var
+       title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt;
+       mapping as an &lt;a href=&quot;#opportunistic&quot;
+       title=concept-appcache-oppcache-ns&gt;opportunistic caching
+       namespaces&lt;/a&gt;, mapped to the absolute URI corresponding to &lt;var
+       title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;a href=&quot;#fallback0&quot;
+       title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.&lt;/p&gt;
+
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;online whitelist&quot;
+
+     &lt;dd&gt;
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is not a syntactically valid URI
+       reference or IRI reference, then jump back to the step labelled &quot;start
+       of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, resolve the URI reference or IRI reference to an absolute
+       URI or IRI, drop any fragment identifier, and add this URI to the &lt;var
+       title=&quot;&quot;&gt;online whitelist URIs&lt;/var&gt;.&lt;/p&gt;
+    &lt;/dl&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Jump back to the step labelled &quot;start of line&quot;. (That step jumps to
+     the next, and last, step when the end of the file is reached.)
+
+   &lt;li&gt;
+    &lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt; list, the &lt;var
+     title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; mapping, and the &lt;var title=&quot;&quot;&gt;online
+     URIs&lt;/var&gt;.
+  &lt;/ol&gt;
+
+  &lt;p&gt;Relative URI references and IRI references resolved to absolute URIs or
+   IRIs in the above algorithm must use the manifest's URI as the Base URI
+   from the Retrieval URI for the purposes reference resolution as defined by
+   RFC 3986. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
+
+  &lt;h4 id=updating1&gt;&lt;span class=secno&gt;4.6.4. &lt;/span&gt;Updating an application
+   cache&lt;/h4&gt;
+
+  &lt;p&gt;When the user agent is required (by other parts of this specification)
+   to start the &lt;dfn id=application1&gt;application cache update process&lt;/dfn&gt;,
+   the user agent must run the following steps:
+
+  &lt;p class=big-issue&gt;the event stuff needs to be more consistent -- something
+   about showing every step of the ui or no steps or something; and we need
+   to deal with showing ui for browsing contexts that open when an update is
+   already in progress, and we may need to give applications control over the
+   ui the first time they cache themselves (right now the original cache is
+   done without notifications to the browsing contexts)
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt; be the URI of the &lt;a
+     href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;manifest&lt;/a&gt; of the
+     cache to be updated.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; be the group of &lt;a
+     href=&quot;#application0&quot; title=&quot;application cache&quot;&gt;application caches&lt;/a&gt;
+     identified by &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; be the most recently updated &lt;a
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; identified by &lt;var
+     title=&quot;&quot;&gt;manifest URI&lt;/var&gt; (that is, the newest version found in &lt;var
+     title=&quot;&quot;&gt;cache group&lt;/var&gt;).
+
+   &lt;li&gt;
+    &lt;p&gt;If the &lt;a href=&quot;#update0&quot; title=concept-appcache-status&gt;status&lt;/a&gt; of
+     the &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; is either &lt;i&gt;checking&lt;/i&gt; or
+     &lt;i&gt;downloading&lt;/i&gt;, then abort these steps, as an update is already in
+     progress for them. Otherwise, set the &lt;a href=&quot;#update0&quot;
+     title=concept-appcache-status&gt;status&lt;/a&gt; of this group of caches to
+     &lt;i&gt;checking&lt;/i&gt;. This entire step must be performed as one atomic
+     operation so as to avoid race conditions.
+
+   &lt;li&gt;
+    &lt;p&gt;If there is already a resource with the URI of &lt;var title=&quot;&quot;&gt;manifest
+     URI&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, and that resource is categorised
+     as a &lt;a href=&quot;#the-manifest&quot;
+     title=concept-appcache-manifest&gt;manifest&lt;/a&gt;, then this is an &lt;dfn
+     id=upgrade title=concept-appcache-upgrade&gt;upgrade attempt&lt;/dfn&gt;.
+     Otherwise, this is a &lt;dfn id=cache title=concept-appcache-cache&gt;cache
+     attempt&lt;/dfn&gt;.&lt;/p&gt;
+
+    &lt;p class=note&gt;If this is a &lt;a href=&quot;#cache&quot;
+     title=concept-appcache-cache&gt;cache attempt&lt;/a&gt;, then &lt;var
+     title=&quot;&quot;&gt;cache&lt;/var&gt; is forcibly the only application cache in &lt;var
+     title=&quot;&quot;&gt;cache group&lt;/var&gt;, and it hasn't ever been populated from its
+     manifest (i.e. this update is an attempt to download the application for
+     the first time). It also can't have any browsing contexts associated
+     with it.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;&lt;a href=&quot;#firing2&quot;&gt;Fire a simple event&lt;/a&gt; called &lt;code
+     title=event-checking&gt;checking&lt;/code&gt; at the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of each
+     &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; that is associated
+     with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of
+     this event should be the display of some sort of user interface
+     indicating to the user that the user agent is checking for the
+     availability of updates.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Fetch the resource from &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt;, and let &lt;var
+     title=&quot;&quot;&gt;manifest&lt;/var&gt; be that resource.&lt;/p&gt;
+
+    &lt;p&gt;If the resource is labelled with the MIME type &lt;code
+     title=&quot;&quot;&gt;text/cache-manifest&lt;/code&gt;, parse &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt;
+     according to the &lt;a href=&quot;#parse&quot; title=&quot;parse a manifest&quot;&gt;rules for
+     parsing manifests&lt;/a&gt;, obtaining a list of &lt;a href=&quot;#explicit&quot;
+     title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt;, &lt;a
+     href=&quot;#fallback0&quot; title=concept-appcache-fallback&gt;fallback entries&lt;/a&gt;
+     and the &lt;a href=&quot;#opportunistic&quot;
+     title=concept-appcache-oppcache-ns&gt;opportunistic caching namespaces&lt;/a&gt;
+     that map to them, and entries for the &lt;a href=&quot;#online&quot;
+     title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If the previous step fails (e.g. the server returns a 4xx or 5xx
+     response or equivalent, or there is a DNS error, or the connection times
+     out, or the parser for manifests fails when checking the magic
+     signature), or if the resource is labelled with a MIME type other than
+     &lt;code title=&quot;&quot;&gt;text/cache-manifest&lt;/code&gt;, then run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+     &lt;li&gt;
+      &lt;p&gt;&lt;a href=&quot;#firing2&quot;&gt;Fire a simple event&lt;/a&gt; called &lt;code
+       title=event-error&gt;&lt;a href=&quot;#error1&quot;&gt;error&lt;/a&gt;&lt;/code&gt; at the &lt;code&gt;&lt;a
+       href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of each
+       &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; that is associated
+       with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of
+       this event should be the display of some sort of user interface
+       indicating to the user that the user agent failed to save the
+       application for offline use.
+
+     &lt;li&gt;
+      &lt;p&gt;If this is a &lt;a href=&quot;#cache&quot; title=concept-appcache-cache&gt;cache
+       attempt&lt;/a&gt;, then discard &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; and abort the
+       update process, optionally alerting the user to the failure.
+
+     &lt;li&gt;
+      &lt;p&gt;Otherwise, jump to the last step in the overall set of steps of the
+       update process.
+    &lt;/ol&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If this is an &lt;a href=&quot;#upgrade&quot;
+     title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt; and the newly
+     downloaded &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; is byte-for-byte identical to
+     the manifest found in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, or if the server
+     reported it as &quot;304 Not Modified&quot; or equivalent, then &lt;a
+     href=&quot;#firing2&quot;&gt;fire a simple event&lt;/a&gt; called &lt;code
+     title=event-noupdate&gt;noupdate&lt;/code&gt; at the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of each
+     &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; that is associated
+     with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of
+     this event should be the display of some sort of user interface
+     indicating to the user that the application is up to date. Then, jump to
+     the last step of the update process.
+
+   &lt;li&gt;
+    &lt;p&gt;Set the &lt;a href=&quot;#update0&quot; title=concept-appcache-status&gt;status&lt;/a&gt; of
+     &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; to &lt;i&gt;downloading&lt;/i&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;&lt;a href=&quot;#firing2&quot;&gt;Fire a simple event&lt;/a&gt; called &lt;code
+     title=event-downloading&gt;downloading&lt;/code&gt; at the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of each
+     &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; that is associated
+     with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of
+     this event should be the display of some sort of user interface
+     indicating to the user that a new version is being downloaded.
+
+   &lt;li&gt;
+    &lt;p&gt;If this is an &lt;a href=&quot;#upgrade&quot;
+     title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;, then let &lt;var
+     title=&quot;&quot;&gt;new cache&lt;/var&gt; be a newly created &lt;a
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; identified by &lt;span
+     title=&quot;&quot;&gt;manifest URI&lt;/span&gt;, being a new version in &lt;var title=&quot;&quot;&gt;cache
+     group&lt;/var&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt; and &lt;var
+     title=&quot;&quot;&gt;cache&lt;/var&gt; be the same version of the application cache.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; be an empty list of URIs with flags.
+
+   &lt;li&gt;
+    &lt;p&gt;Add all the URIs in the list of &lt;a href=&quot;#explicit&quot;
+     title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt; obtained by parsing
+     &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each
+     flagged with &quot;explicit entry&quot;.
+
+   &lt;li&gt;
+    &lt;p&gt;Add all the URIs in the list of &lt;a href=&quot;#fallback0&quot;
+     title=concept-appcache-fallback&gt;fallback entries&lt;/a&gt; obtained by parsing
+     &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each
+     flagged with &quot;fallback entry&quot;.
+
+   &lt;li&gt;
+    &lt;p&gt;If this is an &lt;a href=&quot;#upgrade&quot;
+     title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;, then add all the
+     URIs of &lt;a href=&quot;#opportunistically&quot;
+     title=concept-appcache-oppcache&gt;opportunistically cached entries&lt;/a&gt; in
+     &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; that &lt;a href=&quot;#matches&quot;
+     title=concept-appcache-matches-oppcache&gt;match&lt;/a&gt; the &lt;a
+     href=&quot;#opportunistic&quot; title=concept-appcache-oppcache-ns&gt;opportunistic
+     caching namespaces&lt;/a&gt; obtained by parsing &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt;
+     to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each flagged with &quot;opportunistic
+     entry&quot;.
+
+   &lt;li&gt;
+    &lt;p&gt;If this is an &lt;a href=&quot;#upgrade&quot;
+     title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;, then add all the
+     URIs of &lt;a href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic
+     entries in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;,
+     each flagged with &quot;dynamic entry&quot;.&lt;/a&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;If any URI is in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; more than once, then
+     merge the entries into one entry for that URI, that entry having all the
+     flags that the original entries had.
+
+   &lt;li&gt;
+    &lt;p&gt;For each URI in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, run the following
+     steps:&lt;/p&gt;
+
+    &lt;ol&gt;
+     &lt;li&gt;
+      &lt;p&gt;&lt;a href=&quot;#firing2&quot;&gt;Fire a simple event&lt;/a&gt; called &lt;code
+       title=event-progress&gt;&lt;a href=&quot;#progress0&quot;&gt;progress&lt;/a&gt;&lt;/code&gt; at the
+       &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+       singleton of each &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt;
+       that is associated with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;.
+       The default action of this event should be the display of some sort of
+       user interface indicating to the user that a file is being downloaded
+       in preparation for updating the application.
+     &lt;/li&gt;
+     &lt;!-- XXX need to include
+     progress information --&gt;
+
+     &lt;li&gt;
+      &lt;p&gt;Fetch the resource. If this is an &lt;a href=&quot;#upgrade&quot;
+       title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;, then use &lt;var
+       title=&quot;&quot;&gt;cache&lt;/var&gt; as an HTTP cache, and honour HTTP caching
+       semantics (such as expiration, ETags, and so forth) with respect to
+       that cache. User agents may also have other caches in place.
+
+     &lt;li&gt;
+      &lt;p&gt;If the previous steps fails (e.g. the server returns a 4xx or 5xx
+       response or equivalent, or there is a DNS error, or the connection
+       times out), then run these substeps:&lt;/p&gt;
+
+      &lt;ol&gt;
+       &lt;li&gt;
+        &lt;p&gt;&lt;a href=&quot;#firing2&quot;&gt;Fire a simple event&lt;/a&gt; called &lt;code
+         title=event-error&gt;&lt;a href=&quot;#error1&quot;&gt;error&lt;/a&gt;&lt;/code&gt; at the &lt;code&gt;&lt;a
+         href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of
+         each &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; that is
+         associated with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;. The
+         default action of this event should be the display of some sort of
+         user interface indicating to the user that the user agent failed to
+         save the application for offline use.
+
+       &lt;li&gt;
+        &lt;p&gt;If this is a &lt;a href=&quot;#cache&quot; title=concept-appcache-cache&gt;cache
+         attempt&lt;/a&gt;, then discard &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; and abort the
+         update process, optionally alerting the user to the failure.
+
+       &lt;li&gt;
+        &lt;p&gt;Otherwise, jump to the last step in the overall set of steps of
+         the update process.
+      &lt;/ol&gt;
+
+     &lt;li&gt;
+      &lt;p&gt;Otherwise, the fetching succeeded. Store the resource in the &lt;var
+       title=&quot;&quot;&gt;new cache&lt;/var&gt;.
+
+     &lt;li&gt;
+      &lt;p&gt;If the URI being processed was flagged as an &quot;explicit entry&quot; in
+       &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorise the entry as an &lt;a
+       href=&quot;#explicit&quot; title=concept-appcache-explicit&gt;explicit entry&lt;/a&gt;.
+
+     &lt;li&gt;
+      &lt;p&gt;If the URI being processed was flagged as a &quot;fallback entry&quot; in &lt;var
+       title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorise the entry as a &lt;a
+       href=&quot;#fallback0&quot; title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.
+
+     &lt;li&gt;
+      &lt;p&gt;If the URI being processed was flagged as a &quot;opportunistic entry&quot; in
+       &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorise the entry as an &lt;a
+       href=&quot;#opportunistically&quot;
+       title=concept-appcache-oppcache&gt;opportunistically cached entry&lt;/a&gt;.
+
+     &lt;li&gt;
+      &lt;p&gt;If the URI being processed was flagged as an &quot;dynamic entry&quot; in &lt;var
+       title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorise the entry as a &lt;a
+       href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt;.
+    &lt;/ol&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Store &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;,
+     if it's not there already, and categorise this entry (whether newly
+     added or not) as &lt;a href=&quot;#the-manifest&quot;
+     title=concept-appcache-manifest&gt;the manifest&lt;/a&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;Store the list of &lt;a href=&quot;#opportunistic&quot;
+     title=concept-appcache-oppcache-ns&gt;opportunistic caching namespaces&lt;/a&gt;,
+     and the URIs of the &lt;a href=&quot;#fallback0&quot;
+     title=concept-appcache-fallback&gt;fallback entries&lt;/a&gt; that they map to,
+     in the new cache.
+
+   &lt;li&gt;
+    &lt;p&gt;Store the URIs that form the new &lt;a href=&quot;#online&quot;
+     title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt; in the new
+     cache.
+
+   &lt;li&gt;
+    &lt;p&gt;If this is a &lt;a href=&quot;#cache&quot; title=concept-appcache-cache&gt;cache
+     attempt&lt;/a&gt;, then:&lt;/p&gt;
+
+    &lt;p&gt;Set the &lt;a href=&quot;#update0&quot; title=concept-appcache-status&gt;status&lt;/a&gt; of
+     &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; to &lt;i&gt;idle&lt;/i&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Associate any &lt;code&gt;Document&lt;/code&gt; objects that were &lt;a
+     href=&quot;#flagAsCandidateForCache&quot;&gt;flagged as candidates&lt;/a&gt; for this
+     manifest URI's caches with &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;a href=&quot;#firing2&quot;&gt;Fire a simple event&lt;/a&gt; called &lt;code
+     title=event-cached&gt;cached&lt;/code&gt; at the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of each
+     &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; that is associated
+     with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of
+     this event should be the display of some sort of user interface
+     indicating to the user that the application has been cached and that
+     they can now use it offline.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Otherwise, this is an &lt;a href=&quot;#upgrade&quot;
+     title=concept-appcache-upgrade&gt;upgrade attempt&lt;/a&gt;:&lt;/p&gt;
+
+    &lt;p&gt;Set the &lt;a href=&quot;#update0&quot; title=concept-appcache-status&gt;status&lt;/a&gt; of
+     &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; to &lt;i&gt;update ready&lt;/i&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;a href=&quot;#firing2&quot;&gt;Fire a simple event&lt;/a&gt; called &lt;code
+     title=event-updateready&gt;updateready&lt;/code&gt; at the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of each
+     &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt; that is associated
+     with a cache in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of
+     this event should be the display of some sort of user interface
+     indicating to the user that a new version is available and that they can
+     activate it by reloading the page.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Abort these steps. The following step is jumped to by various parts of
+     the algorithm above when they have to cancel the update.
+
+   &lt;li&gt;
+    &lt;p&gt;Let the &lt;a href=&quot;#update0&quot; title=concept-appcache-status&gt;status&lt;/a&gt; of
+     the group of caches to which &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; belongs be
+     &lt;i&gt;idle&lt;/i&gt;. If appropriate, remove any user interface indicating that
+     an update for this cache is in progress.
+  &lt;/ol&gt;
+
+  &lt;h4 id=processing2&gt;&lt;span class=secno&gt;4.6.5. &lt;/span&gt;Processing model&lt;/h4&gt;
+
+  &lt;p&gt;The processing model of application caches for offline support in Web
+   applications is part of the &lt;a href=&quot;#navigate&quot;
+   title=navigate&gt;navigation&lt;/a&gt; model, but references the algorithms defined
+   in this section.
+
+  &lt;p&gt;A URI &lt;dfn id=matches title=concept-appcache-matches-oppcache&gt;matches an
+   opportunistic caching namespace&lt;/dfn&gt; if there exists an &lt;a
+   href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; whose &lt;a href=&quot;#the-manifest&quot;
+   title=concept-appcache-manifest&gt;manifest&lt;/a&gt;'s URI has the &lt;a
+   href=&quot;#same-schemehostport&quot;&gt;same scheme/host/port&lt;/a&gt; as the URI in
+   question, and if that application cache has an &lt;a href=&quot;#opportunistic&quot;
+   title=concept-appcache-oppcache-ns&gt;opportunistic caching namespace&lt;/a&gt;
+   with a &lt;path&gt; component that exactly matches the start of the
+   &lt;path&gt; component of the URI being examined. If multiple
+   opportunistic caching namespaces match the same URI, the one with the
+   longest &lt;path&gt; component is the one that matches. A URI looking for
+   an opportunistic caching namespace can match more than one application
+   cache at a time, but only matches one namespace in each cache.
+
+  &lt;div class=example&gt;
+   &lt;p&gt;If a manifest &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/app1/manifest&lt;/code">http://example.com/app1/manifest&lt;/code</A>&gt;
+    declares that &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/resources/images&lt;/code">http://example.com/resources/images&lt;/code</A>&gt;
+    should be opportunistically cached, and the user navigates to &lt;code
+    title=&quot;&quot;&gt;<A HREF="http://example.com/resources/images/cat.png&lt;/code">http://example.com/resources/images/cat.png&lt;/code</A>&gt;, then the
+    user agent will decide that the application cache identified by &lt;code
+    title=&quot;&quot;&gt;<A HREF="http://example.com/app1/manifest&lt;/code">http://example.com/app1/manifest&lt;/code</A>&gt; contains a namespace
+    with a match for that URI.&lt;/p&gt;
+  &lt;/div&gt;
+
+  &lt;p&gt;When the &lt;dfn id=application2
+   title=concept-appcache-init-with-attribute&gt;application cache selection
+   algorithm&lt;/dfn&gt; algorithm is invoked with a manifest URI, the user agent
+   must run the first applicable set of steps from the following list:
+
+  &lt;dl class=switch&gt;
+   &lt;dt&gt;If the resource is not being loaded as part of navigation of a &lt;a
+    href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;As an optimisation, if the resource was loaded from an &lt;a
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, and the manifest URI of that
+     cache doesn't match the manifest URI with which the algorithm was
+     invoked, then the user agent should mark the entry in that application
+     cache corresponding to the resource that was just loaded as being &lt;a
+     href=&quot;#foreign&quot; title=concept-appcache-foreign&gt;foreign&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Other than that, nothing special happens with respect to application
+     caches.&lt;/p&gt;
+   &lt;/dd&gt;
+   &lt;!-- otherwise, we're talking top-level browsing contexts only: --&gt;
+
+   &lt;dt&gt;If the resource being loaded was loaded from an application cache and
+    the URI of that application cache's manifest is the same as the manifest
+    URI with which the algorithm was invoked
+
+   &lt;dd&gt;
+    &lt;p&gt;Associate the &lt;code&gt;Document&lt;/code&gt; with the cache from which it was
+     loaded. Invoke the &lt;a href=&quot;#application1&quot;&gt;application cache update
+     process&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;dt&gt;If the resource being loaded was loaded from an application cache and
+    the URI of that application cache's manifest is &lt;em&gt;not&lt;/em&gt; the same as
+    the manifest URI with which the algorithm was invoked
+
+   &lt;dd&gt;
+    &lt;p&gt;Mark the entry for this resource in the application cache from which
+     it was loaded as &lt;a href=&quot;#foreign&quot;
+     title=concept-appcache-foreign&gt;foreign&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Restart the current navigation from the top of the &lt;a href=&quot;#navigate&quot;
+     title=navigate&gt;navigation algorithm&lt;/a&gt;, undoing any changes that were
+     made as part of the initial load (changes can be avoided by ensuring
+     that the step to &lt;a href=&quot;#update2&quot;&gt;update the session history with the
+     new page&lt;/a&gt; is only ever completed &lt;em&gt;after&lt;/em&gt; the application cache
+     selection algorithm is run, though this is not required).&lt;/p&gt;
+
+    &lt;p class=note&gt;The navigation will not result in the same resource being
+     loaded, because &quot;foreign&quot; entries are never picked during navigation.&lt;/p&gt;
+
+    &lt;p&gt;User agents may notify the user of the inconsistency between the cache
+     manifest and the resource's own metadata, to aid in application
+     development.&lt;/p&gt;
+
+   &lt;dt&gt;If the resource being loaded was not loaded from an application cache,
+    but it was loaded using HTTP GET or equivalent
+
+   &lt;dd&gt;
+    &lt;ol&gt;
+     &lt;li&gt;
+      &lt;p&gt;If the manifest URI does not have the &lt;a
+       href=&quot;#same-schemehostport&quot;&gt;same scheme/host/port&lt;/a&gt; as the
+       resource's own URI, then invoke the &lt;a href=&quot;#application3&quot;
+       title=concept-appcache-init-no-attribute&gt;application cache selection
+       algorithm&lt;/a&gt; again, but without a manifest, and abort these steps.
+
+     &lt;li&gt;
+      &lt;p&gt;If there is already an &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;
+       identified by this manifest URI, and that &lt;a
+       href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; contains a resource with
+       the URI of the manifest, and that resource is categorised as a &lt;a
+       href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;manifest&lt;/a&gt;,
+       then: store the resource in the matching cache with the most up to
+       date version, categorised as an &lt;a href=&quot;#implicit&quot;
+       title=concept-appcache-implicit&gt;implicit entry&lt;/a&gt;, associate the
+       &lt;code&gt;Document&lt;/code&gt; with that cache, invoke the &lt;a
+       href=&quot;#application1&quot;&gt;application cache update process&lt;/a&gt;, and abort
+       these steps.
+
+     &lt;li id=flagAsCandidateForCache&gt;
+      &lt;p&gt;Flag the resource's &lt;code&gt;Document&lt;/code&gt; as a candidate for this
+       manifest URI's caches.
+
+     &lt;li&gt;
+      &lt;p&gt;If there is already an &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;
+       identified by this manifest URI, then that &lt;a
+       href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; does not yet contain a
+       resource with the URI of the manifest, or it does but that resource is
+       not yet categorised as a &lt;a href=&quot;#the-manifest&quot;
+       title=concept-appcache-manifest&gt;manifest&lt;/a&gt;: store the resource in
+       that cache, categorised as an &lt;a href=&quot;#implicit&quot;
+       title=concept-appcache-implicit&gt;implicit entry&lt;/a&gt; (replacing the
+       file's previous contents if it was already in the cache, but not
+       removing any other categories it might have), and abort these steps.
+
+     &lt;li&gt;
+      &lt;p&gt;Otherwise, there is no matching &lt;a href=&quot;#application0&quot;&gt;application
+       cache&lt;/a&gt;: create a new application cache identified by this manifest
+       URI, store the resource in that cache, categorised as an &lt;a
+       href=&quot;#implicit&quot; title=concept-appcache-implicit&gt;implicit entry&lt;/a&gt;,
+       and then invoke the &lt;a href=&quot;#application1&quot;&gt;application cache update
+       process&lt;/a&gt;.
+    &lt;/ol&gt;
+
+   &lt;dt&gt;Otherwise
+
+   &lt;dd&gt;
+    &lt;p&gt;Invoke the &lt;a href=&quot;#application3&quot;
+     title=concept-appcache-init-no-attribute&gt;application cache selection
+     algorithm&lt;/a&gt; again, but without a manifest.&lt;/p&gt;
+  &lt;/dl&gt;
+
+  &lt;p&gt;When the &lt;dfn id=application3
+   title=concept-appcache-init-no-attribute&gt;application cache selection
+   algorithm&lt;/dfn&gt; is invoked &lt;em&gt;without&lt;/em&gt; a manifest, then: if the
+   resource is being loaded as part of navigation of a &lt;a
+   href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt;, and the resource was
+   fetched from a particular &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;,
+   then the user agent must associate the &lt;code&gt;Document&lt;/code&gt; with that
+   application cache and invoke the &lt;a href=&quot;#application1&quot;&gt;application cache
+   update process&lt;/a&gt; for that cache; otherwise, nothing special happens with
+   respect to application caches.
+
+  &lt;h5 id=changes&gt;&lt;span class=secno&gt;4.6.5.1. &lt;/span&gt;Changes to the networking
+   model&lt;/h5&gt;
+
+  &lt;p&gt;When a browsing context is associated with an &lt;a
+   href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, any and all resource loads
+   must go through the following steps instead of immediately invoking the
+   mechanisms appropriate to that resource's scheme:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;If the resource is not to be fetched using the HTTP GET mechanism or
+     equivalent, then fetch the resource normally and abort these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;If the resource's URI, ignoring its fragment identifier if any, is
+     listed in the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;'s &lt;a
+     href=&quot;#online&quot; title=concept-appcache-onlinewhitelist&gt;online
+     whitelist&lt;/a&gt;, then fetch the resource normally and abort these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;If the resource's URI is &lt;a href=&quot;#implicit&quot;
+     title=concept-appcache-implicit&gt;an implicit entry&lt;/a&gt;, &lt;a
+     href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;the manifest&lt;/a&gt;,
+     &lt;a href=&quot;#explicit&quot; title=concept-appcache-explicit&gt;an explicit
+     entry&lt;/a&gt;, &lt;a href=&quot;#fallback0&quot; title=concept-appcache-fallback&gt;a
+     fallback entry&lt;/a&gt;, &lt;a href=&quot;#opportunistically&quot;
+     title=concept-appcache-oppcache&gt;an opportunistically cached entry&lt;/a&gt;,
+     or a &lt;a href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic
+     entry&lt;/a&gt; in the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, then
+     fetch the resource from the cache and abort these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;If the resource's URI has the &lt;a href=&quot;#same-schemehostport&quot;&gt;same
+     scheme/host/port&lt;/a&gt; as the manifest's URI, and the start of the
+     resource's URI's &lt;path&gt; component is exactly matched by the
+     &lt;path&gt; component of an &lt;a href=&quot;#opportunistic&quot;
+     title=concept-appcache-oppcache-ns&gt;opportunistic caching namespace&lt;/a&gt;
+     in the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, then:
+
+    &lt;p&gt;Fetch the resource normally. If this results 4xx or 5xx status codes
+     or equivalent, or if there were network errors, then instead fetch, from
+     the cache, the resource of the &lt;a href=&quot;#fallback0&quot;
+     title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt; corresponding to the
+     namespace with the longest matching &lt;path&gt; component. Abort these
+     steps.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Fail the resource load.
+  &lt;/ol&gt;
+
+  &lt;p class=note&gt;The above algorithm ensures that resources that are not
+   present in the manifest will always fail to load (at least, after the
+   cache has been primed the first time), making the testing of offline
+   applications simpler.
+
+  &lt;h4 id=application&gt;&lt;span class=secno&gt;4.6.6. &lt;/span&gt;Application cache API&lt;/h4&gt;
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=applicationcache&gt;ApplicationCache&lt;/dfn&gt; {
+
+  // &lt;a href=&quot;#update0&quot; title=concept-appcache-status&gt;update status&lt;/a&gt;
+  const unsigned short &lt;a href=&quot;#uncached&quot; title=dom-appcache-UNCACHED&gt;UNCACHED&lt;/a&gt; = 0;
+  const unsigned short &lt;a href=&quot;#idle&quot; title=dom-appcache-IDLE&gt;IDLE&lt;/a&gt; = 1;
+  const unsigned short &lt;a href=&quot;#checking&quot; title=dom-appcache-CHECKING&gt;CHECKING&lt;/a&gt; = 2;
+  const unsigned short &lt;a href=&quot;#downloading&quot; title=dom-appcache-DOWNLOADING&gt;DOWNLOADING&lt;/a&gt; = 3;
+  const unsigned short &lt;a href=&quot;#updateready&quot; title=dom-appcache-UPDATEREADY&gt;UPDATEREADY&lt;/a&gt; = 4;
+  readonly attribute unsigned short &lt;a href=&quot;#status0&quot; title=dom-appcache-status&gt;status&lt;/a&gt;;
+
+  // updates
+  void &lt;a href=&quot;#update1&quot; title=dom-appcache-update&gt;update&lt;/a&gt;();
+  void &lt;a href=&quot;#swapcache&quot; title=dom-appcache-swapCache&gt;swapCache&lt;/a&gt;();
+
+  // dynamic entries
+  readonly attribute unsigned long &lt;a href=&quot;#length6&quot; title=dom-appcache-length&gt;length&lt;/a&gt;;
+  DOMString &lt;a href=&quot;#itemindex4&quot; title=dom-appcache-item&gt;item&lt;/a&gt;(in unsigned long index);
+  void &lt;a href=&quot;#adduri&quot; title=dom-appcache-add&gt;add&lt;/a&gt;(in DOMString uri);
+  void &lt;a href=&quot;#remove1&quot; title=dom-appcache-remove&gt;remove&lt;/a&gt;(in DOMString uri);
+
+  // events
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#onchecking&quot; title=handler-appcache-onchecking&gt;onchecking&lt;/a&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#onerror0&quot; title=handler-appcache-onerror&gt;onerror&lt;/a&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#onnoupdate&quot; title=handler-appcache-onnoupdate&gt;onnoupdate&lt;/a&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#ondownloading&quot; title=handler-appcache-ondownloading&gt;ondownloading&lt;/a&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#onprogress&quot; title=handler-appcache-onprogress&gt;onprogress&lt;/a&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#onupdateready&quot; title=handler-appcache-onupdateready&gt;onupdateready&lt;/a&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;a href=&quot;#oncached&quot; title=handler-appcache-oncached&gt;oncached&lt;/a&gt;;
+
+};&lt;/pre&gt;
+
+  &lt;p&gt;Objects implementing the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; interface must also
+   implement the &lt;code&gt;EventTarget&lt;/code&gt; interface.
+
+  &lt;p&gt;There is a one-to-one mapping from &lt;code&gt;Document&lt;/code&gt; objects to
+   &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; objects. The
+   &lt;dfn id=applicationcache0
+   title=dom-applicationCache&gt;&lt;code&gt;applicationCache&lt;/code&gt;&lt;/dfn&gt; attribute
+   on &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; objects must return the
+   &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object
+   associated with the &lt;a href=&quot;#active&quot;&gt;active document&lt;/a&gt; of the &lt;code&gt;&lt;a
+   href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt;'s &lt;a href=&quot;#browsing0&quot;&gt;browsing
+   context&lt;/a&gt;.
+
+  &lt;p&gt;An &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object
+   might be associated with an &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;.
+   When the &lt;code&gt;Document&lt;/code&gt; object that the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object maps to is
+   associated with an application cache, then that is the application cache
+   with which the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is associated.
+   Otherwise, the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is associated
+   with the application cache that the &lt;code&gt;Document&lt;/code&gt; object's &lt;a
+   href=&quot;#browsing0&quot;&gt;browsing context&lt;/a&gt; is associated with, if any.
+
+  &lt;p&gt;The &lt;dfn id=status0 title=dom-appcache-status&gt;&lt;code&gt;status&lt;/code&gt;&lt;/dfn&gt;
+   attribute, on getting, must return the current state of the &lt;a
+   href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is associated
+   with, if any. This must be the appropriate value from the following list:
+
+  &lt;dl&gt;
+   &lt;dt&gt;&lt;dfn id=uncached
+    title=dom-appcache-UNCACHED&gt;&lt;code&gt;UNCACHED&lt;/code&gt;&lt;/dfn&gt; (numeric value 0)
+
+   &lt;dd&gt;
+    &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+     object is not associated with an &lt;a href=&quot;#application0&quot;&gt;application
+     cache&lt;/a&gt; at this time.
+
+   &lt;dt&gt;&lt;dfn id=idle title=dom-appcache-IDLE&gt;&lt;code&gt;IDLE&lt;/code&gt;&lt;/dfn&gt; (numeric
+    value 1)
+
+   &lt;dd&gt;
+    &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+     object is associated with an &lt;a href=&quot;#application0&quot;&gt;application
+     cache&lt;/a&gt; whose group is in the &lt;i&gt;idle&lt;/i&gt; &lt;span
+     title=concept-appcache-states&gt;update status&lt;/span&gt;.
+
+   &lt;dt&gt;&lt;dfn id=checking
+    title=dom-appcache-CHECKING&gt;&lt;code&gt;CHECKING&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)
+
+   &lt;dd&gt;
+    &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+     object is associated with an &lt;a href=&quot;#application0&quot;&gt;application
+     cache&lt;/a&gt; whose group is in the &lt;i&gt;checking&lt;/i&gt; &lt;span
+     title=concept-appcache-states&gt;update status&lt;/span&gt;.
+
+   &lt;dt&gt;&lt;dfn id=downloading
+    title=dom-appcache-DOWNLOADING&gt;&lt;code&gt;DOWNLOADING&lt;/code&gt;&lt;/dfn&gt; (numeric
+    value 3)
+
+   &lt;dd&gt;
+    &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+     object is associated with an &lt;a href=&quot;#application0&quot;&gt;application
+     cache&lt;/a&gt; whose group is in the &lt;i&gt;downloading&lt;/i&gt; &lt;span
+     title=concept-appcache-states&gt;update status&lt;/span&gt;.
+
+   &lt;dt&gt;&lt;dfn id=updateready
+    title=dom-appcache-UPDATEREADY&gt;&lt;code&gt;UPDATEREADY&lt;/code&gt;&lt;/dfn&gt; (numeric
+    value 4)
+
+   &lt;dd&gt;
+    &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+     object is associated with an &lt;a href=&quot;#application0&quot;&gt;application
+     cache&lt;/a&gt; whose group is in the &lt;i&gt;update ready&lt;/i&gt; &lt;span
+     title=concept-appcache-states&gt;update status&lt;/span&gt;.
+  &lt;/dl&gt;
+
+  &lt;p&gt;The &lt;dfn id=length6 title=dom-appcache-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+   attribute must return the number of entries in the &lt;a
+   href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is associated,
+   if any, and zero the object is not associated with any application cache.
+
+  &lt;p&gt;The &lt;a href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic
+   entries&lt;/a&gt; in the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; are
+   ordered in the same order as they were added to the cache by the &lt;code
+   title=dom-appcache-add&gt;&lt;a href=&quot;#adduri&quot;&gt;add()&lt;/a&gt;&lt;/code&gt; method, with the
+   oldest entry being the zeroth entry, and the most recently added entry
+   having the index &lt;span&gt;&lt;code title=dom-appcache-length&gt;&lt;a
+   href=&quot;#length6&quot;&gt;length&lt;/a&gt;&lt;/code&gt;-1&lt;/span&gt;.
+
+  &lt;p&gt;The &lt;dfn id=itemindex4 title=dom-appcache-item&gt;&lt;code&gt;item(&lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;a
+   href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic entries&lt;/a&gt; with
+   index &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; from the &lt;a
+   href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, if one is associated with the
+   &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object. If
+   the object is not associated with any application cache, or if the &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt; argument is lower than zero or greater than
+   &lt;span&gt;&lt;code title=dom-appcache-length&gt;&lt;a
+   href=&quot;#length6&quot;&gt;length&lt;/a&gt;&lt;/code&gt;-1&lt;/span&gt;, the method must instead raise
+   an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.
+
+  &lt;p&gt;The &lt;dfn id=adduri title=dom-appcache-add&gt;&lt;code&gt;add(&lt;var
+   title=&quot;&quot;&gt;uri&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following steps:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;If the &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+     object is not associated with any application cache, then raise an
+     &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;If there is already a resource in in the &lt;a
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is
+     associated that has the address &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt;, then ensure
+     that entry is categorised as a &lt;a href=&quot;#dynamic3&quot;
+     title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt; and return and abort
+     these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;Return, but do not abort these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;Fetch the resource referenced by &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;If this results 4xx or 5xx status codes or equivalent, or if there
+     were network errors, then abort these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;Wait for there to be no running scripts, or at least no running
+     scripts that can reach an &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object associated
+     with the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which this
+     &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is
+     associated.&lt;/p&gt;
+
+    &lt;p&gt;Add the fetched resource to the &lt;a href=&quot;#application0&quot;&gt;application
+     cache&lt;/a&gt; and categorise it as a &lt;a href=&quot;#dynamic3&quot;
+     title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt; before letting any such
+     scripts resume.&lt;/p&gt;
+  &lt;/ol&gt;
+
+  &lt;p class=big-issue&gt;We can make the add() API more usable (i.e. make it
+   possible to detect progress and distinguish success from errors without
+   polling and timeouts) if we have the method return an object that is a
+   target of Progress Events, much like the &lt;a
+   href=&quot;<A HREF="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/XMLHttpRequest-2/Overview.html?content-type=text/html;%20charset=utf-8#xmlhttprequesteventtarget-interface">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/XMLHttpRequest-2/Overview.html?content-type=text/html;%20charset=utf-8#xmlhttprequesteventtarget-interface</A>&quot;&gt;XMLHttpRequestEventTarget&lt;/a&gt;
+   interface. This would also make this far more complex to spec and
+   implement.
+
+  &lt;p&gt;The &lt;dfn id=remove1 title=dom-appcache-remove&gt;&lt;code&gt;remove(&lt;var
+   title=&quot;&quot;&gt;uri&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must remove the &lt;a
+   href=&quot;#dynamic3&quot; title=concept-appcache-dynamic&gt;dynamic entry&lt;/a&gt;
+   categorisation of any entry with the address &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; in
+   the &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is associated.
+   If this removes the last categorisation of an entry in that cache, then
+   the entry must be removed entirely (such that if it is re-added, it will
+   be loaded from the network again). If the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is not
+   associated with any application cache, then the method must raise an
+   &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception instead.
+
+  &lt;p&gt;If the &lt;dfn id=update1
+   title=dom-appcache-update&gt;&lt;code&gt;update()&lt;/code&gt;&lt;/dfn&gt; method is invoked,
+   the user agent must invoke the &lt;a href=&quot;#application1&quot;&gt;application cache
+   update process&lt;/a&gt;, in the background, for the &lt;a
+   href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is associated.
+   If there is no such application cache, then the method must raise an
+   &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception instead.
+
+  &lt;p&gt;If the &lt;dfn id=swapcache
+   title=dom-appcache-swapCache&gt;&lt;code&gt;swapCache()&lt;/code&gt;&lt;/dfn&gt; method is
+   invoked, the user agent must run the following steps:
+
+  &lt;ol&gt;
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the &lt;code&gt;Document&lt;/code&gt; with
+     which the &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+     object is associated.
+
+   &lt;li&gt;
+    &lt;p&gt;Check that &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; is associated with an &lt;a
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;. If it is not, then raise an
+     &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these steps.&lt;/p&gt;
+
+    &lt;p class=note&gt;This is not the same thing as the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object being itself
+     associated with an &lt;a href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;! In
+     particular, this can only happen if &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; is in a
+     &lt;a href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; be the &lt;a
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; with which the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object is
+     associated. (By definition, this is the same as the one that was found
+     in the previous step.)
+
+   &lt;li&gt;
+    &lt;p&gt;Check that there is an application cache in the same group as &lt;var
+     title=&quot;&quot;&gt;cache&lt;/var&gt; which has an entry categorised as a &lt;a
+     href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;manifest&lt;/a&gt; that
+     has is newer than &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;. If there is not, then raise
+     an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these steps.
+
+   &lt;li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt; be the newest &lt;a
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt; in the same group as &lt;var
+     title=&quot;&quot;&gt;cache&lt;/var&gt; which has an entry categorised as a &lt;a
+     href=&quot;#the-manifest&quot; title=concept-appcache-manifest&gt;manifest&lt;/a&gt;.
+
+   &lt;li&gt;
+    &lt;p&gt;Unassociate &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; from &lt;var
+     title=&quot;&quot;&gt;cache&lt;/var&gt; and instead associate it with &lt;var title=&quot;&quot;&gt;new
+     cache&lt;/var&gt;.
+  &lt;/ol&gt;
+
+  &lt;p&gt;The following are the &lt;a href=&quot;#event3&quot;&gt;event handler DOM attributes&lt;/a&gt;
+   that must be supported by objects implementing the &lt;code&gt;&lt;a
+   href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; interface:
+
+  &lt;dl&gt;
+   &lt;dt&gt;&lt;dfn id=onchecking
+    title=handler-appcache-onchecking&gt;&lt;code&gt;onchecking&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever an &lt;code title=event-checking&gt;checking&lt;/code&gt;
+     event is targeted at or bubbles through the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object.
+
+   &lt;dt&gt;&lt;dfn id=onerror0
+    title=handler-appcache-onerror&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever an &lt;code title=event-error&gt;&lt;a
+     href=&quot;#error1&quot;&gt;error&lt;/a&gt;&lt;/code&gt; event is targeted at or bubbles through
+     the &lt;code&gt;&lt;a href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt;
+     object.
+
+   &lt;dt&gt;&lt;dfn id=onnoupdate
+    title=handler-appcache-onnoupdate&gt;&lt;code&gt;onnoupdate&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever an &lt;code title=event-noupdate&gt;noupdate&lt;/code&gt;
+     event is targeted at or bubbles through the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object.
+
+   &lt;dt&gt;&lt;dfn id=ondownloading
+    title=handler-appcache-ondownloading&gt;&lt;code&gt;ondownloading&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever an &lt;code
+     title=event-downloading&gt;downloading&lt;/code&gt; event is targeted at or
+     bubbles through the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object.
+
+   &lt;dt&gt;&lt;dfn id=onprogress
+    title=handler-appcache-onprogress&gt;&lt;code&gt;onprogress&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever an &lt;code title=event-progress&gt;&lt;a
+     href=&quot;#progress0&quot;&gt;progress&lt;/a&gt;&lt;/code&gt; event is targeted at or bubbles
+     through the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object.
+
+   &lt;dt&gt;&lt;dfn id=onupdateready
+    title=handler-appcache-onupdateready&gt;&lt;code&gt;onupdateready&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever an &lt;code
+     title=event-updateready&gt;updateready&lt;/code&gt; event is targeted at or
+     bubbles through the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object.
+
+   &lt;dt&gt;&lt;dfn id=oncached
+    title=handler-appcache-oncached&gt;&lt;code&gt;oncached&lt;/code&gt;&lt;/dfn&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Must be invoked whenever a &lt;code title=event-cached&gt;cached&lt;/code&gt;
+     event is targeted at or bubbles through the &lt;code&gt;&lt;a
+     href=&quot;#applicationcache&quot;&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object.
+  &lt;/dl&gt;
+
+  &lt;h4 id=browser0&gt;&lt;span class=secno&gt;4.6.7. &lt;/span&gt;Browser state&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;dfn id=navigator.online
+   title=dom-navigator-onLine&gt;&lt;code&gt;navigator.onLine&lt;/code&gt;&lt;/dfn&gt; attribute
+   must return false if the user agent will not contact the network when the
+   user follows links or when a script requests a remote page (or knows that
+   such an attempt would fail), and must return true otherwise.
+
+  &lt;p&gt;When the value that would be returned by the &lt;code
+   title=dom-navigator-onLine&gt;&lt;a
+   href=&quot;#navigator.online&quot;&gt;navigator.onLine&lt;/a&gt;&lt;/code&gt; attribute of the
+   &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; changes from true to false, the
+   user agent must &lt;a href=&quot;#firing2&quot;&gt;fire a simple event&lt;/a&gt; called &lt;dfn
+   id=offline0 title=event-offline&gt;&lt;code&gt;offline&lt;/code&gt;&lt;/dfn&gt; at &lt;a
+   href=&quot;#the-body0&quot;&gt;the body element&lt;/a&gt;.
+
+  &lt;p&gt;On the other hand, when the value that would be returned by the &lt;code
+   title=dom-navigator-onLine&gt;&lt;a
+   href=&quot;#navigator.online&quot;&gt;navigator.onLine&lt;/a&gt;&lt;/code&gt; attribute of the
+   &lt;code&gt;&lt;a href=&quot;#window&quot;&gt;Window&lt;/a&gt;&lt;/code&gt; changes from false to true, the
+   user agent must &lt;a href=&quot;#firing2&quot;&gt;fire a simple event&lt;/a&gt; called &lt;dfn
+   id=online0 title=event-online&gt;&lt;code&gt;online&lt;/code&gt;&lt;/dfn&gt; at &lt;a
+   href=&quot;#the-body0&quot;&gt;the body element&lt;/a&gt;.&lt;/p&gt;
+  &lt;!-- XXX ononline onoffline need to be defined --&gt;
+
+  &lt;h3 id=history&gt;&lt;span class=secno&gt;4.7. &lt;/span&gt;Session history and navigation&lt;/h3&gt;
+
+  &lt;h4 id=the-session&gt;&lt;span class=secno&gt;4.7.1. &lt;/span&gt;The session history of
    browsing contexts&lt;/h4&gt;
 
   &lt;p&gt;The sequence of &lt;code&gt;Document&lt;/code&gt;s in a &lt;a
@@ -25856,11 +27278,11 @@
    there are no state object entries for that &lt;code&gt;Document&lt;/code&gt; object
    then no entries are removed.
 
-  &lt;h4 id=the-history&gt;&lt;span class=secno&gt;4.6.2. &lt;/span&gt;The &lt;code&gt;&lt;a
+  &lt;h4 id=the-history&gt;&lt;span class=secno&gt;4.7.2. &lt;/span&gt;The &lt;code&gt;&lt;a
    href=&quot;#history1&quot;&gt;History&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;pre class=idl&gt;interface &lt;dfn id=history1&gt;History&lt;/dfn&gt; {
-  readonly attribute long &lt;a href=&quot;#length6&quot; title=dom-history-length&gt;length&lt;/a&gt;;
+  readonly attribute long &lt;a href=&quot;#length7&quot; title=dom-history-length&gt;length&lt;/a&gt;;
   void &lt;a href=&quot;#godelta&quot; title=dom-history-go&gt;go&lt;/a&gt;(in long delta);
   void &lt;a href=&quot;#go&quot; title=dom-history-go-0&gt;go&lt;/a&gt;();
   void &lt;a href=&quot;#back&quot; title=dom-history-back&gt;back&lt;/a&gt;();
@@ -25870,7 +27292,7 @@
   void &lt;a href=&quot;#clearstate&quot; title=dom-history-clearState&gt;clearState&lt;/a&gt;();
 };&lt;/pre&gt;
 
-  &lt;p&gt;The &lt;dfn id=length6 title=dom-history-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn id=length7 title=dom-history-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
    attribute of the &lt;code&gt;&lt;a href=&quot;#history1&quot;&gt;History&lt;/a&gt;&lt;/code&gt; interface
    must return the number of entries in this &lt;a href=&quot;#session&quot;&gt;session
    history&lt;/a&gt;.
@@ -25883,7 +27305,7 @@
 
   &lt;p&gt;If the index of the &lt;a href=&quot;#current0&quot;&gt;current entry&lt;/a&gt; plus &lt;var
    title=&quot;&quot;&gt;delta&lt;/var&gt; is less than zero or greater than or equal to the &lt;a
-   href=&quot;#length6&quot; title=dom-history-length&gt;number of items in the session
+   href=&quot;#length7&quot; title=dom-history-length&gt;number of items in the session
    history&lt;/a&gt;, then the user agent must do nothing.
 
   &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; is zero, then the user agent must act
@@ -25898,7 +27320,8 @@
    title=&quot;&quot;&gt;delta&lt;/var&gt;.
 
   &lt;p&gt;When a user agent is required to &lt;dfn id=traverse&gt;traverse the
-   history&lt;/dfn&gt; to a specified entry, the user agent must act as follows:
+   history&lt;/dfn&gt;&lt;!-- (traversal) --&gt; to a specified entry, the user agent
+   must act as follows:
 
   &lt;ol&gt;
    &lt;li&gt;If there is no longer a &lt;code&gt;Document&lt;/code&gt; object for the entry in
@@ -25962,9 +27385,13 @@
         href=&quot;#browsing1&quot;&gt;browsing context name&lt;/a&gt; must be unset.
       &lt;/ol&gt;
 
-     &lt;li&gt;The user agent must make the &lt;a href=&quot;#specified&quot;&gt;specified
-      entry&lt;/a&gt;'s &lt;code&gt;Document&lt;/code&gt; object the &lt;a href=&quot;#active&quot;&gt;active
-      document&lt;/a&gt; of the &lt;a href=&quot;#browsing0&quot;&gt;browsing context&lt;/a&gt;.
+     &lt;li id=appcache-history-2&gt;The user agent must make the &lt;a
+      href=&quot;#specified&quot;&gt;specified entry&lt;/a&gt;'s &lt;code&gt;Document&lt;/code&gt; object
+      the &lt;a href=&quot;#active&quot;&gt;active document&lt;/a&gt; of the &lt;a
+      href=&quot;#browsing0&quot;&gt;browsing context&lt;/a&gt;. (If it is a &lt;a
+      href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt;, this might &lt;a
+      href=&quot;#appcache-history-1&quot;&gt;change which &lt;span&gt;application cache&lt;/span&gt;
+      it is associated with.)&lt;/a&gt;
 
      &lt;li&gt;If the &lt;a href=&quot;#specified&quot;&gt;specified entry&lt;/a&gt; has a &lt;a
       href=&quot;#browsing1&quot;&gt;browsing context name&lt;/a&gt; stored with it, then the
@@ -26061,17 +27488,16 @@
   &lt;p&gt;When this method is invoked, the user agent must first check the third
    argument. If a third argument is specified, then the user agent must
    verify that the third argument is a valid URI or IRI (as defined by RFC
-   3986 and 3987, and as modified by RFC 2732), and if so, that, after
-   resolving it to an absolute URI, it is either identical to the document's
-   URI, or that it differs from the document's URI only in the &lt;query&gt;,
-   &lt;abs_path&gt;, and/or &lt;fragment&gt; parts, as applicable (the
-   &lt;query&gt; and &lt;abs_path&gt; parts can only be the same if the
-   document's URI uses a hierarchical &lt;scheme&gt;). If the verification
-   fails (either because the argument is syntactically incorrect, or differs
-   in a way not described as acceptable in the previous sentence) then the
-   user agent must raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;. &lt;a
-   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-   href=&quot;#refsRFC2732&quot;&gt;[RFC2732]&lt;/a&gt;
+   3986 and 3987), and if so, that, after resolving it to an absolute URI, it
+   is either identical to the document's URI, or that it differs from the
+   document's URI only in the &lt;query&gt;, &lt;abs_path&gt;, and/or
+   &lt;fragment&gt; parts, as applicable (the &lt;query&gt; and
+   &lt;abs_path&gt; parts can only be the same if the document's URI uses a
+   hierarchical &lt;scheme&gt;). If the verification fails (either because
+   the argument is syntactically incorrect, or differs in a way not described
+   as acceptable in the previous sentence) then the user agent must raise a
+   &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;. &lt;a
+   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
 
   &lt;p&gt;If the third argument passes its verification step, or if the third
    argument was omitted, then the user agent must remove from the &lt;a
@@ -26118,7 +27544,7 @@
    the last entry for that &lt;code&gt;Document&lt;/code&gt; object in the session
    history.
 
-  &lt;h4 id=activating&gt;&lt;span class=secno&gt;4.6.3. &lt;/span&gt;&lt;dfn id=activating0
+  &lt;h4 id=activating&gt;&lt;span class=secno&gt;4.7.3. &lt;/span&gt;&lt;dfn id=activating0
    title=&quot;activate the state object&quot;&gt;Activating state objects&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When a state object in the session history is activated (which happens
@@ -26153,7 +27579,7 @@
   &lt;p class=big-issue&gt;Should we coalesce these events if they occur while the
    page is away? (e.g. during traversal -- see above)
 
-  &lt;h4 id=the-location&gt;&lt;span class=secno&gt;4.6.4. &lt;/span&gt;The &lt;code&gt;&lt;a
+  &lt;h4 id=the-location&gt;&lt;span class=secno&gt;4.7.4. &lt;/span&gt;The &lt;code&gt;&lt;a
    href=&quot;#location2&quot;&gt;Location&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; object in a browsing context's session
@@ -26275,7 +27701,7 @@
 user reload must be equivalent to .reload()
 --&gt;
 
-  &lt;h5 id=security4&gt;&lt;span class=secno&gt;4.6.4.1. &lt;/span&gt;Security&lt;/h5&gt;
+  &lt;h5 id=security4&gt;&lt;span class=secno&gt;4.7.4.1. &lt;/span&gt;Security&lt;/h5&gt;
 
   &lt;p&gt;User agents must raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;
    whenever any of the members of a &lt;code&gt;&lt;a
@@ -26293,7 +27719,7 @@
    title=dom-location-href&gt;&lt;a href=&quot;#href5&quot;&gt;href&lt;/a&gt;&lt;/code&gt; attribute's
    setter.
 
-  &lt;h4 id=history-notes&gt;&lt;span class=secno&gt;4.6.5. &lt;/span&gt;Implementation notes
+  &lt;h4 id=history-notes&gt;&lt;span class=secno&gt;4.7.5. &lt;/span&gt;Implementation notes
    for session history&lt;/h4&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;
@@ -26332,7 +27758,7 @@
    that are invoked on a timer, or from event handlers that do not represent
    a clear user action, or that are invoked in rapid succession.
 
-  &lt;h3 id=navigating&gt;&lt;span class=secno&gt;4.7. &lt;/span&gt;Navigating across documents&lt;/h3&gt;
+  &lt;h3 id=navigating&gt;&lt;span class=secno&gt;4.8. &lt;/span&gt;Navigating across documents&lt;/h3&gt;
 
   &lt;p&gt;Certain actions cause the &lt;a href=&quot;#browsing0&quot;&gt;browsing context&lt;/a&gt; to
    &lt;dfn id=navigate&gt;navigate&lt;/dfn&gt;. For example, &lt;a href=&quot;#following0&quot;
@@ -26363,8 +27789,9 @@
      of the supported protocols, or an inline prompt to allow the user to
      select &lt;a href=&quot;#registerprotocolhandler&quot;
      title=dom-navigator-registerProtocolHandler&gt;a registered handler&lt;/a&gt; for
-     the given scheme, then &lt;a href=&quot;#display&quot; title=&quot;display a user agent
-     page inline&quot;&gt;display the inline content&lt;/a&gt; and abort these steps.
+     the given scheme, then &lt;a href=&quot;#page-load4&quot;
+     title=navigate-ua-inline&gt;display the inline content&lt;/a&gt; and abort these
+     steps.
 
    &lt;li&gt;
     &lt;p&gt;If the new resource is to be handled using a mechanism that does not
@@ -26372,12 +27799,40 @@
      that mechanism instead.
 
    &lt;li&gt;
-    &lt;p&gt;Start fetching the specified resource, as appropriate (e.g. performing
-     an HTTP GET or POST operation, or reading the file from disk, or
-     executing script in the case of a &lt;a href=&quot;#the-javascript&quot;
-     title=&quot;javascript protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt; URI&lt;/a&gt;).
-     If this results in a redirect, return to step 2 with the new resource.
+    &lt;p&gt;If the new resource is to be fetched using HTTP GET or equivalent, and
+     if the browsing context being navigated is a &lt;a
+     href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt;, then check if there
+     are any &lt;a href=&quot;#application0&quot; title=&quot;application cache&quot;&gt;application
+     caches&lt;/a&gt; that have a &lt;a href=&quot;#the-manifest&quot;
+     title=concept-appcache-manifest&gt;manifest&lt;/a&gt; with the &lt;a
+     href=&quot;#same-schemehostport&quot;&gt;same scheme/host/port&lt;/a&gt; as the URI in
+     question, and that have this URI as one of their entries (excluding
+     entries marked as &lt;a href=&quot;#foreign&quot;
+     title=concept-appcache-foreign&gt;manifest&lt;/a&gt;), and that already contain
+     their manifest, categorised as a &lt;a href=&quot;#the-manifest&quot;
+     title=concept-appcache-manifest&gt;manifest&lt;/a&gt;. If so, then the user agent
+     must then fetch the resource from the &lt;a href=&quot;#select0&quot;
+     title=concept-appcache-selection&gt;most appropriate application cache&lt;/a&gt;
+     of those that match.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, start fetching the specified resource in the appropriate
+     manner (e.g. performing an HTTP GET or POST operation, or reading the
+     file from disk, or executing script in the case of a &lt;a
+     href=&quot;#the-javascript&quot; title=&quot;javascript protocol&quot;&gt;&lt;code
+     title=&quot;&quot;&gt;javascript:&lt;/code&gt; URI&lt;/a&gt;). If this results in a redirect,
+     return to step 2 with the new resource.&lt;/p&gt;
+
+    &lt;p class=example&gt;For example, imagine an HTML page with an associated
+     application cache displaying an image and a form, where the image is
+     also used by several other application caches. If the user right-clicks
+     on the image and chooses &quot;View Image&quot;, then the user agent could decide
+     to show the image from any of those caches, but it is likely that the
+     most useful cache for the user would be the one that was used for the
+     aforementioned HTML page. On the other hand, if the user submits the
+     form, and the form does a POST submission, then the user agent will not
+     use an application cache at all; the submission will be made to the
+     network.&lt;/p&gt;
+
    &lt;li&gt;
     &lt;p&gt;Wait for one or more bytes to be available or for the user agent to
      establish that the resource in question is empty. During this time, the
@@ -26385,6 +27840,39 @@
      other navigation attempts.
 
    &lt;li&gt;
+    &lt;p&gt;If the resource was not fetched from an &lt;a
+     href=&quot;#application0&quot;&gt;application cache&lt;/a&gt;, and was to be fetched using
+     HTTP GET or equivalent, and its URI &lt;a href=&quot;#matches&quot;
+     title=concept-appcache-matches-oppcache&gt;matches the opportunistic
+     caching namespace&lt;/a&gt; of one or more application caches, then:&lt;/p&gt;
+
+    &lt;dl class=switch&gt;
+     &lt;dt&gt;If the file was successfully downloaded
+
+     &lt;dd&gt;The user agent must cache the resource in all those application
+      caches, categorised as &lt;a href=&quot;#opportunistically&quot;
+      title=concept-appcache-oppcache&gt;opportunistically cached entries&lt;/a&gt;.
+
+     &lt;dt&gt;If the server returned a 4xx or 5xx status code or equivalent, or
+      there were network errors
+
+     &lt;dd&gt;If the browsing context being navigated is a &lt;a
+      href=&quot;#top-level&quot;&gt;top-level browsing context&lt;/a&gt;, then the user agent
+      must discard the failed load and instead use the &lt;a href=&quot;#fallback0&quot;
+      title=concept-appcache-fallback&gt;fallback resource&lt;/a&gt; specified for the
+      opportunistic caching namespace in question. If multiple application
+      caches match, the user agent must use the fallback of the &lt;a
+      href=&quot;#select0&quot; title=concept-appcache-selection&gt;most appropriate
+      application cache&lt;/a&gt; of those that match. For the purposes of session
+      history (and features that depend on session history, e.g. bookmarking)
+      the user agent must use the URI of the resource that was requested (the
+      one that matched the opportunistic caching namespace), not the fallback
+      resource. However, the user agent may indicate to the user that the
+      original page load failed, that the page used was a fallback resource,
+      and what the URI of the fallback resource actually is.
+    &lt;/dl&gt;
+
+   &lt;li&gt;
     &lt;p&gt;If the document's out-of-band metadata (e.g. HTTP headers), not
      counting any &lt;a href=&quot;#content-type8&quot; title=Content-Type&gt;type
      information&lt;/a&gt; (such as the Content-Type HTTP header), requires some
@@ -26458,8 +27946,9 @@
      supported, or an inline prompt to allow the user to select &lt;a
      href=&quot;#registercontenthandler&quot;
      title=dom-navigator-registerContentHandler&gt;a registered handler&lt;/a&gt; for
-     the given type, then &lt;a href=&quot;#display&quot; title=&quot;display a user agent page
-     inline&quot;&gt;display the inline content&lt;/a&gt; and abort these steps.
+     the given type, then &lt;a href=&quot;#page-load4&quot;
+     title=navigate-ua-inline&gt;display the inline content&lt;/a&gt; and abort these
+     steps.
 
    &lt;li&gt;
     &lt;p&gt;Otherwise, the document's &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is such that the
@@ -26469,7 +27958,7 @@
   &lt;/ol&gt;
 
   &lt;p&gt;Some of the sections below, to which the above algorithm defers in
-   certain cases, require the user agent to &lt;dfn id=update0&gt;update the
+   certain cases, require the user agent to &lt;dfn id=update2&gt;update the
    session history with the new page&lt;/dfn&gt;. When a user agent is required to
    do this, it must follows the set of steps given below that is appropriate
    for the situation at hand. From the point of view of any script, these
@@ -26533,7 +28022,7 @@
     &lt;/dl&gt;
   &lt;/ol&gt;
 
-  &lt;h4 id=read-html&gt;&lt;span class=secno&gt;4.7.1. &lt;/span&gt;&lt;dfn id=page-load
+  &lt;h4 id=read-html&gt;&lt;span class=secno&gt;4.8.1. &lt;/span&gt;&lt;dfn id=page-load
    title=navigate-html&gt;Page load processing model for HTML files&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When an HTML document is to be loaded in a &lt;a href=&quot;#browsing0&quot;&gt;browsing
@@ -26544,10 +28033,11 @@
    the &lt;a href=&quot;#input0&quot;&gt;input stream&lt;/a&gt; for that parser.
 
   &lt;p class=note&gt;The &lt;a href=&quot;#input0&quot;&gt;input stream&lt;/a&gt; converts bytes into
-   characters for use in the &lt;span&gt;tokeniser&lt;/span&gt;. This process relies, in
-   part, on character encoding information found in the real &lt;a
-   href=&quot;#content-type8&quot; title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the
-   resource; the &quot;sniffed type&quot; is not used for this purpose.&lt;/p&gt;
+   characters for use in the &lt;span&gt;tokeniser&lt;/span&gt;&lt;!-- XXX xref
+  --&gt;. This
+   process relies, in part, on character encoding information found in the
+   real &lt;a href=&quot;#content-type8&quot; title=Content-Type&gt;Content-Type metadata&lt;/a&gt;
+   of the resource; the &quot;sniffed type&quot; is not used for this purpose.&lt;/p&gt;
   &lt;!-- next two paragraphs are nearly identical to the navigate-text
   section, keep them in sync --&gt;
 
@@ -26557,9 +28047,13 @@
 
   &lt;p&gt;After creating the &lt;code&gt;Document&lt;/code&gt; object, but potentially before
    the page has finished parsing, the user agent must &lt;a
-   href=&quot;#update0&quot;&gt;update the session history with the new page&lt;/a&gt;.
+   href=&quot;#update2&quot;&gt;update the session history with the new page&lt;/a&gt;.
 
-  &lt;h4 id=read-xml&gt;&lt;span class=secno&gt;4.7.2. &lt;/span&gt;&lt;dfn id=page-load0
+  &lt;p class=note&gt;&lt;a href=&quot;#application2&quot;
+   title=concept-appcache-init-with-attribute&gt;Application cache selection&lt;/a&gt;
+   happens &lt;a href=&quot;#parser-appcache&quot;&gt;in the HTML parser&lt;/a&gt;.
+
+  &lt;h4 id=read-xml&gt;&lt;span class=secno&gt;4.8.2. &lt;/span&gt;&lt;dfn id=page-load0
    title=navigate-xml&gt;Page load processing model for XML files&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When faced with displaying an XML file inline, user agents must first
@@ -26574,6 +28068,30 @@
    that must be used when determining the character encoding according to the
    rules given in the above specifications.
 
+  &lt;p&gt;If the root element, as parsed according to the XML specifications cited
+   above, is found to be an &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element
+   with an attribute &lt;code title=attr-html-application&gt;application&lt;/code&gt;,
+   then, as soon as the element is inserted into the DOM, the user agent must
+   run the &lt;a href=&quot;#application2&quot;
+   title=concept-appcache-init-with-attribute&gt;application cache selection
+   algorithm&lt;/a&gt; with the value of that attribute as the manifest URI.
+   Otherwise, as soon as the root element is inserted into the DOM, the user
+   agent must run the &lt;a href=&quot;#application3&quot;
+   title=concept-appcache-init-no-attribute&gt;application cache selection
+   algorithm&lt;/a&gt; with no manifest.
+
+  &lt;p class=note&gt;Because the processing of the &lt;code
+   title=attr-html-application&gt;application&lt;/code&gt; attribute happens only once
+   the root element is parsed, any URIs referenced by processing instructions
+   before the root element (such as &lt;code
+   title=&quot;&quot;&gt;&lt;?xml-styleesheet?&gt;&lt;/code&gt; and &lt;code
+   title=&quot;&quot;&gt;&lt;?xbl?&gt;&lt;/code&gt; PIs) will be fetched from the network and
+   cannot be cached.&lt;/p&gt;
+  &lt;!-- XXX any ideas for avoiding this, that
+  aren't a PI themselves? We can't delay the processing, since the
+  whole point of the &lt;?xbl?&gt; PI is to have the XBL sheet loaded before
+  the root element... --&gt;
+
   &lt;p&gt;User agents may examine the namespace of the root &lt;code&gt;Element&lt;/code&gt;
    node of this &lt;code&gt;Document&lt;/code&gt; object to perform namespace-based
    dispatch to alternative processing tools, e.g. determining that the
@@ -26583,14 +28101,14 @@
    href=&quot;#navigate&quot;&gt;navigate&lt;/a&gt; steps above.
 
   &lt;p&gt;Otherwise, then, with the newly created &lt;code&gt;Document&lt;/code&gt;, the user
-   agents must &lt;a href=&quot;#update0&quot;&gt;update the session history with the new
+   agents must &lt;a href=&quot;#update2&quot;&gt;update the session history with the new
    page&lt;/a&gt;. User agents may do this before the complete document has been
    parsed (thus achieving &lt;i&gt;incremental rendering&lt;/i&gt;).
 
   &lt;p&gt;Error messages from the parse process (e.g. namespace well-formedness
    errors) may be reported inline by mutating the &lt;code&gt;Document&lt;/code&gt;.
 
-  &lt;h4 id=read-text&gt;&lt;span class=secno&gt;4.7.3. &lt;/span&gt;&lt;dfn id=page-load1
+  &lt;h4 id=read-text&gt;&lt;span class=secno&gt;4.8.3. &lt;/span&gt;&lt;dfn id=page-load1
    title=navigate-text&gt;Page load processing model for text files&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When a plain text document is to be loaded in a &lt;a
@@ -26606,9 +28124,14 @@
   &lt;p&gt;The rules for how to convert the bytes of the plain text document into
    actual characters are defined in RFC 2046, RFC 2646, and subsequent
    versions thereof. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt; &lt;a
-   href=&quot;#refsRFC2046&quot;&gt;[RFC2646]&lt;/a&gt;&lt;/p&gt;
+   href=&quot;#refsRFC2046&quot;&gt;[RFC2646]&lt;/a&gt;
+
+  &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
+   run the &lt;a href=&quot;#application3&quot;
+   title=concept-appcache-init-no-attribute&gt;application cache selection
+   algorithm&lt;/a&gt; with no manifest.&lt;/p&gt;
   &lt;!-- next two paragraphs are nearly identical to the navigate-html
-  section and similar to the &quot;non-DOM-inline-content&quot; section, and the
+  section and similar to the &quot;navigate-ua-inline&quot; section, and the
   next three are similar to the navigate-image and navigate-plugin
   sections; keep them all in sync --&gt;
 
@@ -26618,14 +28141,14 @@
 
   &lt;p&gt;After creating the &lt;code&gt;Document&lt;/code&gt; object, but potentially before
    the page has finished parsing, the user agent must &lt;a
-   href=&quot;#update0&quot;&gt;update the session history with the new page&lt;/a&gt;.
+   href=&quot;#update2&quot;&gt;update the session history with the new page&lt;/a&gt;.
 
   &lt;p&gt;User agents may add content to the &lt;code&gt;&lt;a href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt;
    element of the &lt;code&gt;Document&lt;/code&gt;, e.g. linking to stylesheet or an XBL
    binding, providing script, giving the document a &lt;code&gt;&lt;a
    href=&quot;#title1&quot;&gt;title&lt;/a&gt;&lt;/code&gt;, etc.
 
-  &lt;h4 id=read-image&gt;&lt;span class=secno&gt;4.7.4. &lt;/span&gt;&lt;dfn id=page-load2
+  &lt;h4 id=read-image&gt;&lt;span class=secno&gt;4.8.4. &lt;/span&gt;&lt;dfn id=page-load2
    title=navigate-image&gt;Page load processing model for images&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When an image resource is to be loaded in a &lt;a
@@ -26646,9 +28169,14 @@
   &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops&quot; title=&quot;stop
    parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
+  &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
+   run the &lt;a href=&quot;#application3&quot;
+   title=concept-appcache-init-no-attribute&gt;application cache selection
+   algorithm&lt;/a&gt; with no manifest.
+
   &lt;p&gt;After creating the &lt;code&gt;Document&lt;/code&gt; object, but potentially before
    the page has finished fully loading, the user agent must &lt;a
-   href=&quot;#update0&quot;&gt;update the session history with the new page&lt;/a&gt;.
+   href=&quot;#update2&quot;&gt;update the session history with the new page&lt;/a&gt;.
 
   &lt;p&gt;User agents may add content to the &lt;code&gt;&lt;a href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt;
    element of the &lt;code&gt;Document&lt;/code&gt;, or attributes to the &lt;code&gt;&lt;a
@@ -26656,7 +28184,7 @@
    binding, to provide a script, to give the document a &lt;code&gt;&lt;a
    href=&quot;#title1&quot;&gt;title&lt;/a&gt;&lt;/code&gt;, etc.
 
-  &lt;h4 id=read-plugin&gt;&lt;span class=secno&gt;4.7.5. &lt;/span&gt;&lt;dfn id=page-load3
+  &lt;h4 id=read-plugin&gt;&lt;span class=secno&gt;4.8.5. &lt;/span&gt;&lt;dfn id=page-load3
    title=navigate-plugin&gt;Page load processing model for content that uses
    plugins&lt;/dfn&gt;&lt;/h4&gt;
 
@@ -26678,9 +28206,14 @@
   &lt;p&gt;Then, the user agent must act as if it had &lt;a href=&quot;#stops&quot; title=&quot;stop
    parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
+  &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
+   run the &lt;a href=&quot;#application3&quot;
+   title=concept-appcache-init-no-attribute&gt;application cache selection
+   algorithm&lt;/a&gt; with no manifest.
+
   &lt;p&gt;After creating the &lt;code&gt;Document&lt;/code&gt; object, but potentially before
    the page has finished fully loading, the user agent must &lt;a
-   href=&quot;#update0&quot;&gt;update the session history with the new page&lt;/a&gt;.
+   href=&quot;#update2&quot;&gt;update the session history with the new page&lt;/a&gt;.
 
   &lt;p&gt;User agents may add content to the &lt;code&gt;&lt;a href=&quot;#head&quot;&gt;head&lt;/a&gt;&lt;/code&gt;
    element of the &lt;code&gt;Document&lt;/code&gt;, or attributes to the &lt;code&gt;&lt;a
@@ -26688,28 +28221,34 @@
    XBL binding, or to give the document a &lt;code&gt;&lt;a
    href=&quot;#title1&quot;&gt;title&lt;/a&gt;&lt;/code&gt;.
 
-  &lt;h4 id=non-DOM-inline-content&gt;&lt;span class=secno&gt;4.7.6. &lt;/span&gt;Page load
-   processing model for inline content that doesn't have a DOM&lt;/h4&gt;
+  &lt;h4 id=read-ua-inline&gt;&lt;span class=secno&gt;4.8.6. &lt;/span&gt;&lt;dfn id=page-load4
+   title=navigate-ua-inline&gt;Page load processing model for inline content
+   that doesn't have a DOM&lt;/dfn&gt;&lt;/h4&gt;
 
-  &lt;p&gt;When the user agent is to &lt;dfn id=display&gt;display a user agent page
-   inline&lt;/dfn&gt; in a &lt;a href=&quot;#browsing0&quot;&gt;browsing context&lt;/a&gt;, the user
-   agent should create a &lt;code&gt;Document&lt;/code&gt; object, mark it as being an &lt;a
-   href=&quot;#html-&quot; title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt;, and then either
-   associate that &lt;code&gt;Document&lt;/code&gt; with a custom rendering that is not
-   rendered using the normal &lt;code&gt;Document&lt;/code&gt; rendering rules, or mutate
-   that &lt;code&gt;Document&lt;/code&gt; until it represents the content the user agent
-   wants to render.&lt;/p&gt;
+  &lt;p&gt;When the user agent is to display a user agent page inline in a &lt;a
+   href=&quot;#browsing0&quot;&gt;browsing context&lt;/a&gt;, the user agent should create a
+   &lt;code&gt;Document&lt;/code&gt; object, mark it as being an &lt;a href=&quot;#html-&quot;
+   title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt;, and then either associate that
+   &lt;code&gt;Document&lt;/code&gt; with a custom rendering that is not rendered using
+   the normal &lt;code&gt;Document&lt;/code&gt; rendering rules, or mutate that
+   &lt;code&gt;Document&lt;/code&gt; until it represents the content the user agent wants
+   to render.&lt;/p&gt;
   &lt;!-- next two paragraphs are similar to the navigate-text section,
   keep them in sync --&gt;
 
   &lt;p&gt;Once the page has been set up, the user agent must act as if it had &lt;a
    href=&quot;#stops&quot; title=&quot;stop parsing&quot;&gt;stopped parsing&lt;/a&gt;.
 
+  &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent must
+   run the &lt;a href=&quot;#application3&quot;
+   title=concept-appcache-init-no-attribute&gt;application cache selection
+   algorithm&lt;/a&gt; with no manifest.
+
   &lt;p&gt;After creating the &lt;code&gt;Document&lt;/code&gt; object, but potentially before
    the page has been completely set up, the user agent must &lt;a
-   href=&quot;#update0&quot;&gt;update the session history with the new page&lt;/a&gt;.
+   href=&quot;#update2&quot;&gt;update the session history with the new page&lt;/a&gt;.
 
-  &lt;h4 id=scroll-to-fragid&gt;&lt;span class=secno&gt;4.7.7. &lt;/span&gt;&lt;dfn id=scrolling0
+  &lt;h4 id=scroll-to-fragid&gt;&lt;span class=secno&gt;4.8.7. &lt;/span&gt;&lt;dfn id=scrolling0
    title=navigate-fragid&gt;Scrolling to a fragment identifier&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When a user agent is supposed to scroll for a fragment identifier, then
@@ -26717,7 +28256,7 @@
 
   &lt;ol&gt;
    &lt;li&gt;
-    &lt;p&gt;First, &lt;a href=&quot;#update0&quot;&gt;update the session history with the new
+    &lt;p&gt;First, &lt;a href=&quot;#update2&quot;&gt;update the session history with the new
      page&lt;/a&gt;, where &quot;the new page&quot; has the same &lt;code&gt;Document&lt;/code&gt; as
      before but with the URI having the newly specified fragment identifier.
 
@@ -26731,7 +28270,7 @@
    the document&lt;/dfn&gt;&quot; from a frag id -- id=&quot;&quot;, name=&quot;&quot;, XPointer, etc;
    missing IDs (e.g. the infamous &quot;#top&quot;)
 
-  &lt;h3 id=content-type-sniffing&gt;&lt;span class=secno&gt;4.8. &lt;/span&gt;Determining the
+  &lt;h3 id=content-type-sniffing&gt;&lt;span class=secno&gt;4.9. &lt;/span&gt;Determining the
    type of a new resource in a browsing context&lt;/h3&gt;
 
   &lt;p class=warning&gt;It is imperative that the rules in this section be
@@ -26828,7 +28367,7 @@
      type&lt;/var&gt;.
   &lt;/ol&gt;
 
-  &lt;h4 id=content-type0&gt;&lt;span class=secno&gt;4.8.1. &lt;/span&gt;&lt;dfn
+  &lt;h4 id=content-type0&gt;&lt;span class=secno&gt;4.9.1. &lt;/span&gt;&lt;dfn
    id=content-type4&gt;Content-Type sniffing: text or binary&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;ol&gt;
@@ -26918,7 +28457,7 @@
     &lt;p&gt;Otherwise, the sniffed type of the resource is &quot;text/plain&quot;.
   &lt;/ul&gt;
 
-  &lt;h4 id=content-type1&gt;&lt;span class=secno&gt;4.8.2. &lt;/span&gt;&lt;dfn
+  &lt;h4 id=content-type1&gt;&lt;span class=secno&gt;4.9.2. &lt;/span&gt;&lt;dfn
    id=content-type5&gt;Content-Type sniffing: unknown type&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;ol&gt;
@@ -27170,7 +28709,7 @@
    determine that content is not HTML and thus safe from XSS attacks, but
    then a user agent detects it as HTML anyway and allows script to execute).
 
-  &lt;h4 id=content-type2&gt;&lt;span class=secno&gt;4.8.3. &lt;/span&gt;&lt;dfn
+  &lt;h4 id=content-type2&gt;&lt;span class=secno&gt;4.9.3. &lt;/span&gt;&lt;dfn
    id=content-type6&gt;Content-Type sniffing: image&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;If the first bytes of the file match one of the byte sequences in the
@@ -27232,7 +28771,7 @@
   &lt;p&gt;Otherwise, the &lt;i&gt;sniffed type&lt;/i&gt; of the resource is the same as its
    &lt;var title=&quot;&quot;&gt;official type&lt;/var&gt;.
 
-  &lt;h4 id=content-type3&gt;&lt;span class=secno&gt;4.8.4. &lt;/span&gt;&lt;dfn
+  &lt;h4 id=content-type3&gt;&lt;span class=secno&gt;4.9.4. &lt;/span&gt;&lt;dfn
    id=content-type7&gt;Content-Type sniffing: feed or HTML&lt;/dfn&gt;&lt;/h4&gt;
   &lt;!-- mostly based on:
    <A HREF="http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx">http://blogs.msdn.com/rssteam/articles/PublishersGuide.aspx</A>
@@ -27402,7 +28941,7 @@
    this algorithm and the algorithm for detecting the character encoding of
    HTML documents in parallel.
 
-  &lt;h4 id=content-type&gt;&lt;span class=secno&gt;4.8.5. &lt;/span&gt;Content-Type metadata&lt;/h4&gt;
+  &lt;h4 id=content-type&gt;&lt;span class=secno&gt;4.9.5. &lt;/span&gt;Content-Type metadata&lt;/h4&gt;
 
   &lt;p&gt;What explicit &lt;dfn id=content-type8 title=Content-Type&gt;Content-Type
    metadata&lt;/dfn&gt; is associated with the resource (the resource's type
@@ -27486,10 +29025,10 @@
     &lt;/dl&gt;
   &lt;/ol&gt;
 
-  &lt;h3 id=storage&gt;&lt;span class=secno&gt;4.9. &lt;/span&gt;Client-side session and
+  &lt;h3 id=storage&gt;&lt;span class=secno&gt;4.10. &lt;/span&gt;Client-side session and
    persistent storage of name/value pairs&lt;/h3&gt;
 
-  &lt;h4 id=introduction1&gt;&lt;span class=secno&gt;4.9.1. &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction2&gt;&lt;span class=secno&gt;4.10.1. &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;em&gt;This section is non-normative.&lt;/em&gt;
 
@@ -27597,12 +29136,12 @@
    To store structured data in a storage area, you must first convert it to a
    string.
 
-  &lt;h4 id=the-storage&gt;&lt;span class=secno&gt;4.9.2. &lt;/span&gt;The &lt;code&gt;&lt;a
+  &lt;h4 id=the-storage&gt;&lt;span class=secno&gt;4.10.2. &lt;/span&gt;The &lt;code&gt;&lt;a
    href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;pre class=idl&gt;
 interface &lt;dfn id=storage2&gt;Storage&lt;/dfn&gt; {
-  readonly attribute unsigned long &lt;a href=&quot;#length7&quot; title=dom-Storage-length&gt;length&lt;/a&gt;;
+  readonly attribute unsigned long &lt;a href=&quot;#length8&quot; title=dom-Storage-length&gt;length&lt;/a&gt;;
   DOMString &lt;a href=&quot;#keyn&quot; title=dom-Storage-key&gt;key&lt;/a&gt;(in unsigned long index);
   &lt;a href=&quot;#storageitem&quot;&gt;StorageItem&lt;/a&gt; &lt;a href=&quot;#getitem&quot; title=dom-Storage-getItem&gt;getItem&lt;/a&gt;(in DOMString key);
   void &lt;a href=&quot;#setitem&quot; title=dom-Storage-setItem&gt;setItem&lt;/a&gt;(in DOMString key, in DOMString data);
@@ -27634,16 +29173,17 @@
    the script in question is running in a &lt;span&gt;secure browsing
    context&lt;/span&gt;&lt;!-- XXX xref --&gt;.
 
-  &lt;p&gt;The &lt;dfn id=length7 title=dom-Storage-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn id=length8 title=dom-Storage-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
    attribute must return the number of key/value pairs currently present and
    &lt;a href=&quot;#accessible&quot; title=&quot;accessible keys&quot;&gt;accessible&lt;/a&gt; in the list
    associated with the object.
 
   &lt;p&gt;The &lt;dfn id=keyn title=dom-Storage-key&gt;&lt;code&gt;key(&lt;var
    title=&quot;&quot;&gt;n&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the name of the &lt;var
-   title=&quot;&quot;&gt;n&lt;/var&gt;th &lt;span&gt;accessible&lt;/span&gt; key in the list. The order of
-   keys is user-agent defined, but must be consistent within an object
-   between changes to the number of keys. (Thus, &lt;a href=&quot;#setitem&quot;
+   title=&quot;&quot;&gt;n&lt;/var&gt;th &lt;a href=&quot;#accessible&quot; title=&quot;accessible
+   keys&quot;&gt;accessible&lt;/a&gt; key in the list. The order of keys is user-agent
+   defined, but must be consistent within an object between changes to the
+   number of keys. (Thus, &lt;a href=&quot;#setitem&quot;
    title=dom-Storage-setItem&gt;adding&lt;/a&gt; or &lt;a href=&quot;#removeitem&quot;
    title=dom-Storage-removeItem&gt;removing&lt;/a&gt; a key may change the order of
    the keys, but merely changing the value of an existing key must not.)
@@ -27660,12 +29200,14 @@
    href=&quot;#storageitem&quot;&gt;StorageItem&lt;/a&gt;&lt;/code&gt; object representing the
    key/value pair with the given &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;. If the given &lt;var
    title=&quot;&quot;&gt;key&lt;/var&gt; does not exist in the list associated with the object,
-   or is not &lt;span&gt;accessible&lt;/span&gt;, then this method must return null.
-   Subsequent calls to this method with the same key from scripts running in
-   the same &lt;span&gt;security context&lt;/span&gt; must return the same instance of
-   the &lt;code&gt;&lt;a href=&quot;#storageitem&quot;&gt;StorageItem&lt;/a&gt;&lt;/code&gt; interface. (Such
-   instances must not be shared across security contexts, though.)&lt;/p&gt;
-  &lt;!-- XXX define security context --&gt;
+   or is not &lt;a href=&quot;#accessible&quot; title=&quot;accessible keys&quot;&gt;accessible&lt;/a&gt;,
+   then this method must return null. Subsequent calls to this method with
+   the same key from scripts running in the same &lt;span&gt;security
+   context&lt;/span&gt; must return the same instance of the &lt;code&gt;&lt;a
+   href=&quot;#storageitem&quot;&gt;StorageItem&lt;/a&gt;&lt;/code&gt; interface. (Such instances must
+   not be shared across security contexts, though.)&lt;/p&gt;
+  &lt;!-- XXX define
+  security context --&gt;
 
   &lt;p&gt;The &lt;dfn id=setitem title=dom-Storage-setItem&gt;&lt;code&gt;setItem(&lt;var
    title=&quot;&quot;&gt;key&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must
@@ -27683,12 +29225,13 @@
    &quot;safe for both secure and insecure content&quot;.
 
   &lt;p&gt;If the given &lt;var title=&quot;&quot;&gt;key&lt;/var&gt; &lt;em&gt;does&lt;/em&gt; exist in the list,
-   then, if the key/value pair with the given &lt;var title=&quot;&quot;&gt;key&lt;/var&gt; is
-   &lt;span&gt;accessible&lt;/span&gt;, it must have its value updated so that any
-   current or future &lt;code&gt;&lt;a href=&quot;#storageitem&quot;&gt;StorageItem&lt;/a&gt;&lt;/code&gt;
-   objects referring to this key/value pair will return the value given in
-   the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; argument. If it is &lt;em&gt;not&lt;/em&gt;
-   &lt;span&gt;accessible&lt;/span&gt;, the method must raise a &lt;a
+   then, if the key/value pair with the given &lt;var title=&quot;&quot;&gt;key&lt;/var&gt; is &lt;a
+   href=&quot;#accessible&quot; title=&quot;accessible keys&quot;&gt;accessible&lt;/a&gt;, it must have
+   its value updated so that any current or future &lt;code&gt;&lt;a
+   href=&quot;#storageitem&quot;&gt;StorageItem&lt;/a&gt;&lt;/code&gt; objects referring to this
+   key/value pair will return the value given in the &lt;var
+   title=&quot;&quot;&gt;value&lt;/var&gt; argument. If it is &lt;em&gt;not&lt;/em&gt; &lt;a href=&quot;#accessible&quot;
+   title=&quot;accessible keys&quot;&gt;accessible&lt;/a&gt;, the method must raise a &lt;a
    href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;.
 
   &lt;p&gt;When the &lt;code title=dom-Storage-setItem&gt;&lt;a
@@ -27708,10 +29251,11 @@
    title=dom-Storage-removeItem&gt;&lt;code&gt;removeItem(&lt;var
    title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must cause the key/value pair with
    the given &lt;var title=&quot;&quot;&gt;key&lt;/var&gt; to be removed from the list associated
-   with the object, if it exists and is &lt;span&gt;accessible&lt;/span&gt;. If no item
-   with that key exists, the method must do nothing. If an item with that key
-   exists but is not &lt;span&gt;accessible&lt;/span&gt;, the method must raise a &lt;a
-   href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;.
+   with the object, if it exists and is &lt;a href=&quot;#accessible&quot;
+   title=&quot;accessible keys&quot;&gt;accessible&lt;/a&gt;. If no item with that key exists,
+   the method must do nothing. If an item with that key exists but is not &lt;a
+   href=&quot;#accessible&quot; title=&quot;accessible keys&quot;&gt;accessible&lt;/a&gt;, the method must
+   raise a &lt;a href=&quot;#security8&quot;&gt;security exception&lt;/a&gt;.
 
   &lt;p&gt;The &lt;code title=dom-Storage-setItem&gt;&lt;a
    href=&quot;#setitem&quot;&gt;setItem()&lt;/a&gt;&lt;/code&gt; and &lt;code
@@ -27722,20 +29266,21 @@
 
   &lt;p&gt;In the ECMAScript DOM binding, enumerating a &lt;code&gt;&lt;a
    href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt; object must enumerate through the
-   currently stored and &lt;span&gt;accessible&lt;/span&gt; keys in the list the object
-   is associated with. (It must not enumerate the values or the actual
-   members of the interface). In the ECMAScript DOM binding, &lt;code&gt;&lt;a
-   href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt; objects must support dereferencing
-   such that getting a property that is not a member of the object (i.e. is
-   neither a member of the &lt;code&gt;&lt;a href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt;
-   interface nor of &lt;code title=dom-Object&gt;Object&lt;/code&gt;) must invoke the
-   &lt;code title=dom-Storage-getItem&gt;&lt;a href=&quot;#getitem&quot;&gt;getItem()&lt;/a&gt;&lt;/code&gt;
-   method with the property's name as the argument, and setting such a
-   property must invoke the &lt;code title=dom-Storage-setItem&gt;&lt;a
+   currently stored and &lt;a href=&quot;#accessible&quot; title=&quot;accessible
+   keys&quot;&gt;accessible&lt;/a&gt; keys in the list the object is associated with. (It
+   must not enumerate the values or the actual members of the interface). In
+   the ECMAScript DOM binding, &lt;code&gt;&lt;a href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt;
+   objects must support dereferencing such that getting a property that is
+   not a member of the object (i.e. is neither a member of the &lt;code&gt;&lt;a
+   href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt; interface nor of &lt;code
+   title=dom-Object&gt;Object&lt;/code&gt;) must invoke the &lt;code
+   title=dom-Storage-getItem&gt;&lt;a href=&quot;#getitem&quot;&gt;getItem()&lt;/a&gt;&lt;/code&gt; method
+   with the property's name as the argument, and setting such a property must
+   invoke the &lt;code title=dom-Storage-setItem&gt;&lt;a
    href=&quot;#setitem&quot;&gt;setItem()&lt;/a&gt;&lt;/code&gt; method with the property's name as
    the first argument and the given value as the second argument.
 
-  &lt;h4 id=the-storageitem&gt;&lt;span class=secno&gt;4.9.3. &lt;/span&gt;The &lt;code&gt;&lt;a
+  &lt;h4 id=the-storageitem&gt;&lt;span class=secno&gt;4.10.3. &lt;/span&gt;The &lt;code&gt;&lt;a
    href=&quot;#storageitem&quot;&gt;StorageItem&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;p&gt;Items in &lt;code&gt;&lt;a href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt; objects are
@@ -27801,7 +29346,7 @@
    the key/value pair would no longer appear in the appropriate &lt;code&gt;&lt;a
    href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt; object.
 
-  &lt;h4 id=the-sessionstorage&gt;&lt;span class=secno&gt;4.9.4. &lt;/span&gt;The &lt;code
+  &lt;h4 id=the-sessionstorage&gt;&lt;span class=secno&gt;4.10.4. &lt;/span&gt;The &lt;code
    title=dom-sessionStorage&gt;&lt;a
    href=&quot;#sessionstorage&quot;&gt;sessionStorage&lt;/a&gt;&lt;/code&gt; attribute&lt;/h4&gt;
 
@@ -27874,7 +29419,7 @@
    title=event-storage&gt;&lt;a href=&quot;#storage3&quot;&gt;storage&lt;/a&gt;&lt;/code&gt; event must be
    fired, as &lt;a href=&quot;#storage3&quot; title=event-storage&gt;described below&lt;/a&gt;.
 
-  &lt;h4 id=the-globalstorage&gt;&lt;span class=secno&gt;4.9.5. &lt;/span&gt;The &lt;code
+  &lt;h4 id=the-globalstorage&gt;&lt;span class=secno&gt;4.10.5. &lt;/span&gt;The &lt;code
    title=dom-globalStorage&gt;&lt;a href=&quot;#globalstorage&quot;&gt;globalStorage&lt;/a&gt;&lt;/code&gt;
    attribute&lt;/h4&gt;
 
@@ -28033,7 +29578,7 @@
     global storage area is notified of the change.&lt;/p&gt;
   &lt;/div&gt;
 
-  &lt;h4 id=the-storage0&gt;&lt;span class=secno&gt;4.9.6. &lt;/span&gt;The &lt;code
+  &lt;h4 id=the-storage0&gt;&lt;span class=secno&gt;4.10.6. &lt;/span&gt;The &lt;code
    title=event-storage&gt;&lt;a href=&quot;#storage3&quot;&gt;storage&lt;/a&gt;&lt;/code&gt; event&lt;/h4&gt;
 
   &lt;p&gt;The &lt;dfn id=storage3 title=event-storage&gt;&lt;code&gt;storage&lt;/code&gt;&lt;/dfn&gt;
@@ -28090,10 +29635,10 @@
    &quot;&lt;code&gt;#session&lt;/code&gt;&quot; if it was a session storage area.&lt;/p&gt;
   &lt;!-- XXX onstorage should be defined --&gt;
 
-  &lt;h4 id=miscellaneous0&gt;&lt;span class=secno&gt;4.9.7. &lt;/span&gt;Miscellaneous
+  &lt;h4 id=miscellaneous0&gt;&lt;span class=secno&gt;4.10.7. &lt;/span&gt;Miscellaneous
    implementation requirements for storage areas&lt;/h4&gt;
 
-  &lt;h5 id=disk-space&gt;&lt;span class=secno&gt;4.9.7.1. &lt;/span&gt;Disk space&lt;/h5&gt;
+  &lt;h5 id=disk-space&gt;&lt;span class=secno&gt;4.10.7.1. &lt;/span&gt;Disk space&lt;/h5&gt;
 
   &lt;p&gt;User agents should limit the total amount of space allowed for a domain
    based on the domain of the page setting the value.
@@ -28125,14 +29670,14 @@
    Implementation feedback is welcome and will be used to update this
    suggestion in future.
 
-  &lt;h5 id=threads0&gt;&lt;span class=secno&gt;4.9.7.2. &lt;/span&gt;Threads&lt;/h5&gt;
+  &lt;h5 id=threads0&gt;&lt;span class=secno&gt;4.10.7.2. &lt;/span&gt;Threads&lt;/h5&gt;
 
   &lt;p&gt;Multiple browsing contexts must be able to access the global storage
    areas simultaneously in a predictable manner. Scripts must not be able to
    detect any concurrent script execution.
 
   &lt;p&gt;This is required to guarentee that the &lt;code title=dom-Storage-length&gt;&lt;a
-   href=&quot;#length7&quot;&gt;length&lt;/a&gt;&lt;/code&gt; attribute of a &lt;code&gt;&lt;a
+   href=&quot;#length8&quot;&gt;length&lt;/a&gt;&lt;/code&gt; attribute of a &lt;code&gt;&lt;a
    href=&quot;#storage2&quot;&gt;Storage&lt;/a&gt;&lt;/code&gt; object never changes while a script is
    executing, other than in a way that is predictable by the script itself.
 
@@ -28149,9 +29694,9 @@
    specification does not require any particular implementation strategy, so
    long as the requirement above is met.
 
-  &lt;h4 id=security5&gt;&lt;span class=secno&gt;4.9.8. &lt;/span&gt;Security and privacy&lt;/h4&gt;
+  &lt;h4 id=security5&gt;&lt;span class=secno&gt;4.10.8. &lt;/span&gt;Security and privacy&lt;/h4&gt;
 
-  &lt;h5 id=user-tracking&gt;&lt;span class=secno&gt;4.9.8.1. &lt;/span&gt;User tracking&lt;/h5&gt;
+  &lt;h5 id=user-tracking&gt;&lt;span class=secno&gt;4.10.8.1. &lt;/span&gt;User tracking&lt;/h5&gt;
 
   &lt;p&gt;A third-party advertiser (or any entity capable of getting content
    distributed to multiple sites) could use a unique identifier stored in its
@@ -28285,7 +29830,7 @@
    headers and configuration settings) to combine separate sessions into
    coherent user profiles.
 
-  &lt;h5 id=cookie&gt;&lt;span class=secno&gt;4.9.8.2. &lt;/span&gt;Cookie resurrection&lt;/h5&gt;
+  &lt;h5 id=cookie&gt;&lt;span class=secno&gt;4.10.8.2. &lt;/span&gt;Cookie resurrection&lt;/h5&gt;
 
   &lt;p&gt;If the user interface for persistent storage presents data in the
    persistent storage feature separately from data in HTTP session cookies,
@@ -28293,7 +29838,7 @@
    allow sites to use the two features as redundant backup for each other,
    defeating a user's attempts to protect his privacy.
 
-  &lt;h5 id=integrity&gt;&lt;span class=secno&gt;4.9.8.3. &lt;/span&gt;Integrity of &quot;public&quot;
+  &lt;h5 id=integrity&gt;&lt;span class=secno&gt;4.10.8.3. &lt;/span&gt;Integrity of &quot;public&quot;
    storage areas&lt;/h5&gt;
 
   &lt;p&gt;Since the &quot;&lt;a href=&quot;#public0&quot; title=&quot;public storage area&quot;&gt;public&lt;/a&gt;&quot;
@@ -28307,7 +29852,7 @@
    must not trust information stored in &quot;&lt;a href=&quot;#public0&quot; title=&quot;public
    storage area&quot;&gt;public&lt;/a&gt;&quot; global storage areas.
 
-  &lt;h5 id=cross-protocol&gt;&lt;span class=secno&gt;4.9.8.4. &lt;/span&gt;Cross-protocol and
+  &lt;h5 id=cross-protocol&gt;&lt;span class=secno&gt;4.10.8.4. &lt;/span&gt;Cross-protocol and
    cross-port attacks&lt;/h5&gt;
 
   &lt;p&gt;This API makes no distinction between content served over HTTP, FTP, or
@@ -28347,7 +29892,7 @@
    with no further interaction. How about putting the port number at the end
    of the string being compared? (Implicitly.)
 
-  &lt;h5 id=dns-spoofing&gt;&lt;span class=secno&gt;4.9.8.5. &lt;/span&gt;DNS spoofing attacks&lt;/h5&gt;
+  &lt;h5 id=dns-spoofing&gt;&lt;span class=secno&gt;4.10.8.5. &lt;/span&gt;DNS spoofing attacks&lt;/h5&gt;
 
   &lt;p&gt;Because of the potential for DNS spoofing attacks, one cannot guarentee
    that a host claiming to be in a certain domain really is from that domain.
@@ -28361,7 +29906,7 @@
    condition, data stored by scripts in secure contexts default to being
    marked as &quot;safe only for secure content&quot;.)
 
-  &lt;h5 id=cross-directory&gt;&lt;span class=secno&gt;4.9.8.6. &lt;/span&gt;Cross-directory
+  &lt;h5 id=cross-directory&gt;&lt;span class=secno&gt;4.10.8.6. &lt;/span&gt;Cross-directory
    attacks&lt;/h5&gt;
 
   &lt;p&gt;Different authors sharing one host name, for example users hosting
@@ -28375,7 +29920,7 @@
    usual DOM scripting security model would make it trivial to bypass this
    protection and access the data from any path.
 
-  &lt;h5 id=public&gt;&lt;span class=secno&gt;4.9.8.7. &lt;/span&gt;Public storage areas
+  &lt;h5 id=public&gt;&lt;span class=secno&gt;4.10.8.7. &lt;/span&gt;Public storage areas
    corresponding to hosts&lt;/h5&gt;
 
   &lt;p&gt;If a &quot;&lt;a href=&quot;#public0&quot; title=&quot;public storage area&quot;&gt;public&lt;/a&gt;&quot; global
@@ -28391,9 +29936,9 @@
    to &quot;&lt;a href=&quot;#public0&quot; title=&quot;public storage area&quot;&gt;public&lt;/a&gt;&quot; global
    storage areas from accessing any storage areas other than their own.
 
-  &lt;h5 id=storage0&gt;&lt;span class=secno&gt;4.9.8.8. &lt;/span&gt;Storage areas in the face
-   of untrusted higher-level domains that do not correspond to public storage
-   areas&lt;/h5&gt;
+  &lt;h5 id=storage0&gt;&lt;span class=secno&gt;4.10.8.8. &lt;/span&gt;Storage areas in the
+   face of untrusted higher-level domains that do not correspond to public
+   storage areas&lt;/h5&gt;
 
   &lt;p&gt;Authors should not store sensitive data using the global storage APIs if
    there are hosts with fully-qualified domain names that are subsets of
@@ -28403,8 +29948,8 @@
    storage area if he does not trust the host that runs
    &lt;code&gt;example.net&lt;/code&gt;.
 
-  &lt;h5 id=storage1&gt;&lt;span class=secno&gt;4.9.8.9. &lt;/span&gt;Storage areas in the face
-   of untrusted subdomains&lt;/h5&gt;
+  &lt;h5 id=storage1&gt;&lt;span class=secno&gt;4.10.8.9. &lt;/span&gt;Storage areas in the
+   face of untrusted subdomains&lt;/h5&gt;
 
   &lt;p&gt;If an author publishing content on one host, e.g.
    &lt;code&gt;example.com&lt;/code&gt;, wishes to use the &lt;code
@@ -28415,7 +29960,7 @@
    accessible only to that host (and its parent domains), and not to any of
    the real subdomains (e.g. &lt;code&gt;upload.example.com&lt;/code&gt;).
 
-  &lt;h5 id=implementation&gt;&lt;span class=secno&gt;4.9.8.10. &lt;/span&gt;Implementation
+  &lt;h5 id=implementation&gt;&lt;span class=secno&gt;4.10.8.10. &lt;/span&gt;Implementation
    risks&lt;/h5&gt;
 
   &lt;p&gt;The two primary risks when implementing this persistent storage feature
@@ -28455,13 +30000,13 @@
    list of &quot;&lt;a href=&quot;#public0&quot; title=&quot;public storage area&quot;&gt;public&lt;/a&gt;&quot;
    domains, and apply the restrictions described above.
 
-  &lt;h3 id=sql&gt;&lt;span class=secno&gt;4.10. &lt;/span&gt;Client-side database storage&lt;/h3&gt;
+  &lt;h3 id=sql&gt;&lt;span class=secno&gt;4.11. &lt;/span&gt;Client-side database storage&lt;/h3&gt;
 
-  &lt;h4 id=introduction2&gt;&lt;span class=secno&gt;4.10.1. &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction3&gt;&lt;span class=secno&gt;4.11.1. &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p class=big-issue&gt;...
 
-  &lt;h4 id=databases&gt;&lt;span class=secno&gt;4.10.2. &lt;/span&gt;Databases&lt;/h4&gt;
+  &lt;h4 id=databases&gt;&lt;span class=secno&gt;4.11.2. &lt;/span&gt;Databases&lt;/h4&gt;
 
   &lt;p&gt;Each &lt;i&gt;&lt;a href=&quot;#origin0&quot;&gt;origin&lt;/a&gt;&lt;/i&gt; has an associated set of
    databases. Each database has a name and a current version. There is no way
@@ -28538,7 +30083,7 @@
    version that differs from the new version will start failing at this
    point. Finally, the method must return true.
 
-  &lt;h4 id=executing&gt;&lt;span class=secno&gt;4.10.3. &lt;/span&gt;Executing SQL statements&lt;/h4&gt;
+  &lt;h4 id=executing&gt;&lt;span class=secno&gt;4.11.3. &lt;/span&gt;Executing SQL statements&lt;/h4&gt;
 
   &lt;p&gt;Once a &lt;code&gt;&lt;a href=&quot;#database0&quot;&gt;Database&lt;/a&gt;&lt;/code&gt; object has been
    obtained, an author can interact with the database using the &lt;code
@@ -28672,7 +30217,7 @@
   &lt;p class=note&gt;A future version of this specification may define the exact
    SQL subset required in more detail.
 
-  &lt;h4 id=database&gt;&lt;span class=secno&gt;4.10.4. &lt;/span&gt;Database query results&lt;/h4&gt;
+  &lt;h4 id=database&gt;&lt;span class=secno&gt;4.11.4. &lt;/span&gt;Database query results&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code title=dom-database-executeSql&gt;&lt;a
    href=&quot;#executesql&quot;&gt;executeSql()&lt;/a&gt;&lt;/code&gt; method invokes its callback
@@ -28756,7 +30301,7 @@
    language, describing the error encountered by the last statement. If there
    was no error, the attribute's value must be the empty string.
 
-  &lt;h4 id=privacy&gt;&lt;span class=secno&gt;4.10.5. &lt;/span&gt;Privacy&lt;/h4&gt;
+  &lt;h4 id=privacy&gt;&lt;span class=secno&gt;4.11.5. &lt;/span&gt;Privacy&lt;/h4&gt;
 
   &lt;p&gt;In contrast with the &lt;code title=dom-globalStorage&gt;&lt;a
    href=&quot;#globalstorage&quot;&gt;globalStorage&lt;/a&gt;&lt;/code&gt; feature, which
@@ -28771,9 +30316,9 @@
    way as cookies for the purposes of user interfaces, to reduce the risk of
    using this feature for cookie resurrection.
 
-  &lt;h4 id=security6&gt;&lt;span class=secno&gt;4.10.6. &lt;/span&gt;Security&lt;/h4&gt;
+  &lt;h4 id=security6&gt;&lt;span class=secno&gt;4.11.6. &lt;/span&gt;Security&lt;/h4&gt;
 
-  &lt;h5 id=user-agents&gt;&lt;span class=secno&gt;4.10.6.1. &lt;/span&gt;User agents&lt;/h5&gt;
+  &lt;h5 id=user-agents&gt;&lt;span class=secno&gt;4.11.6.1. &lt;/span&gt;User agents&lt;/h5&gt;
 
   &lt;p&gt;User agent implementors are strongly encouraged to audit all their
    supported SQL statements for security implications. For example, &lt;code
@@ -28786,7 +30331,7 @@
    disk representation of the data, as all data in ECMAScript is implicitly
    UTF-16.
 
-  &lt;h5 id=sql-injection&gt;&lt;span class=secno&gt;4.10.6.2. &lt;/span&gt;SQL injection&lt;/h5&gt;
+  &lt;h5 id=sql-injection&gt;&lt;span class=secno&gt;4.11.6.2. &lt;/span&gt;SQL injection&lt;/h5&gt;
 
   &lt;p&gt;Authors are strongly recommended to make use of the &lt;code
    title=&quot;&quot;&gt;?&lt;/code&gt; placeholder feature of the &lt;code
@@ -28794,9 +30339,9 @@
    href=&quot;#executesql&quot;&gt;executeSql()&lt;/a&gt;&lt;/code&gt; method, and to never construct
    SQL statements on the fly.
 
-  &lt;h3 id=links&gt;&lt;span class=secno&gt;4.11. &lt;/span&gt;Links&lt;/h3&gt;
+  &lt;h3 id=links&gt;&lt;span class=secno&gt;4.12. &lt;/span&gt;Links&lt;/h3&gt;
 
-  &lt;h4 id=hyperlink&gt;&lt;span class=secno&gt;4.11.1. &lt;/span&gt;Hyperlink elements&lt;/h4&gt;
+  &lt;h4 id=hyperlink&gt;&lt;span class=secno&gt;4.12.1. &lt;/span&gt;Hyperlink elements&lt;/h4&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=&quot;#a&quot;&gt;a&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a
    href=&quot;#area&quot;&gt;area&lt;/a&gt;&lt;/code&gt;, and &lt;code&gt;&lt;a href=&quot;#link&quot;&gt;link&lt;/a&gt;&lt;/code&gt;
@@ -28873,7 +30418,7 @@
    fetching the resource, user agents must not use metadata included in the
    link to the resource to determine its type.
 
-  &lt;h4 id=following&gt;&lt;span class=secno&gt;4.11.2. &lt;/span&gt;&lt;dfn
+  &lt;h4 id=following&gt;&lt;span class=secno&gt;4.12.2. &lt;/span&gt;&lt;dfn
    id=following0&gt;Following hyperlinks&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When a user &lt;em&gt;follows a hyperlink&lt;/em&gt;, the user agent must &lt;a
@@ -28928,7 +30473,7 @@
   &lt;p&gt;Otherwise, the browsing context that must be navigated is the same
    browsing context as the one which the hyperlink element itself is in.
 
-  &lt;h5 id=hyperlink0&gt;&lt;span class=secno&gt;4.11.2.1. &lt;/span&gt;Hyperlink auditing&lt;/h5&gt;
+  &lt;h5 id=hyperlink0&gt;&lt;span class=secno&gt;4.12.2.1. &lt;/span&gt;Hyperlink auditing&lt;/h5&gt;
 
   &lt;p&gt;If an &lt;code&gt;&lt;a href=&quot;#a&quot;&gt;a&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a
    href=&quot;#area&quot;&gt;area&lt;/a&gt;&lt;/code&gt; hyperlink element has a &lt;code
@@ -28995,7 +30540,7 @@
    it sounds kooky. --&gt;
    &lt;/div&gt;
 
-  &lt;h4 id=linkTypes&gt;&lt;span class=secno&gt;4.11.3. &lt;/span&gt;Link types&lt;/h4&gt;
+  &lt;h4 id=linkTypes&gt;&lt;span class=secno&gt;4.12.3. &lt;/span&gt;Link types&lt;/h4&gt;
 
   &lt;p&gt;The following table summarises the link types that are defined by this
    specification. This table is non-normative; the actual definitions for the
@@ -29304,7 +30849,7 @@
 
     --&gt;
 
-  &lt;h5 id=link-type&gt;&lt;span class=secno&gt;4.11.3.1. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type&gt;&lt;span class=secno&gt;4.12.3.1. &lt;/span&gt;Link type &quot;&lt;dfn
    id=alternate title=rel-alternate&gt;&lt;code&gt;alternate&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-alternate&gt;&lt;a href=&quot;#alternate&quot;&gt;alternate&lt;/a&gt;&lt;/code&gt;
@@ -29381,7 +30926,7 @@
    document, it is also implying that those two documents are alternative
    representations of each other.
 
-  &lt;h5 id=link-type0&gt;&lt;span class=secno&gt;4.11.3.2. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type0&gt;&lt;span class=secno&gt;4.12.3.2. &lt;/span&gt;Link type &quot;&lt;dfn
    id=archives title=rel-archives&gt;&lt;code&gt;archives&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-archives&gt;&lt;a href=&quot;#archives&quot;&gt;archives&lt;/a&gt;&lt;/code&gt;
@@ -29401,7 +30946,7 @@
    treat the keyword &quot;&lt;code title=&quot;&quot;&gt;archive&lt;/code&gt;&quot; like the &lt;code
    title=rel-archives&gt;&lt;a href=&quot;#archives&quot;&gt;archives&lt;/a&gt;&lt;/code&gt; keyword.
 
-  &lt;h5 id=link-type1&gt;&lt;span class=secno&gt;4.11.3.3. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type1&gt;&lt;span class=secno&gt;4.12.3.3. &lt;/span&gt;Link type &quot;&lt;dfn
    id=author title=rel-author&gt;&lt;code&gt;author&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-author&gt;&lt;a href=&quot;#author&quot;&gt;author&lt;/a&gt;&lt;/code&gt; keyword
@@ -29433,7 +30978,7 @@
    &quot;&lt;code&gt;made&lt;/code&gt;&quot; as having the &lt;code title=rel-author&gt;&lt;a
    href=&quot;#author&quot;&gt;author&lt;/a&gt;&lt;/code&gt; keyword specified as a link relationship.
 
-  &lt;h5 id=link-type2&gt;&lt;span class=secno&gt;4.11.3.4. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type2&gt;&lt;span class=secno&gt;4.12.3.4. &lt;/span&gt;Link type &quot;&lt;dfn
    id=bookmark title=rel-bookmark&gt;&lt;code&gt;bookmark&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-bookmark&gt;&lt;a href=&quot;#bookmark&quot;&gt;bookmark&lt;/a&gt;&lt;/code&gt;
@@ -29474,7 +31019,7 @@
  ...&lt;/pre&gt;
   &lt;/div&gt;
 
-  &lt;h5 id=link-type3&gt;&lt;span class=secno&gt;4.11.3.5. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type3&gt;&lt;span class=secno&gt;4.12.3.5. &lt;/span&gt;Link type &quot;&lt;dfn
    id=contact title=rel-contact&gt;&lt;code&gt;contact&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-contact&gt;&lt;a href=&quot;#contact&quot;&gt;contact&lt;/a&gt;&lt;/code&gt;
@@ -29499,7 +31044,7 @@
    that the referenced document provides further contact information for the
    page as a whole.
 
-  &lt;h5 id=link-type4&gt;&lt;span class=secno&gt;4.11.3.6. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type4&gt;&lt;span class=secno&gt;4.12.3.6. &lt;/span&gt;Link type &quot;&lt;dfn
    id=external title=rel-external&gt;&lt;code&gt;external&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-external&gt;&lt;a href=&quot;#external&quot;&gt;external&lt;/a&gt;&lt;/code&gt;
@@ -29510,7 +31055,7 @@
    keyword indicates that the link is leading to a document that is not part
    of the site that the current document forms a part of.
 
-  &lt;h5 id=link-type5&gt;&lt;span class=secno&gt;4.11.3.7. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type5&gt;&lt;span class=secno&gt;4.12.3.7. &lt;/span&gt;Link type &quot;&lt;dfn
    id=feed title=rel-feed&gt;&lt;code&gt;feed&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-feed&gt;&lt;a href=&quot;#feed&quot;&gt;feed&lt;/a&gt;&lt;/code&gt; keyword may be
@@ -29554,7 +31099,7 @@
  &lt;/ul&gt;&lt;/pre&gt;
   &lt;/div&gt;
 
-  &lt;h5 id=link-type6&gt;&lt;span class=secno&gt;4.11.3.8. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type6&gt;&lt;span class=secno&gt;4.12.3.8. &lt;/span&gt;Link type &quot;&lt;dfn
    id=help title=rel-help&gt;&lt;code&gt;help&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-help&gt;&lt;a href=&quot;#help&quot;&gt;help&lt;/a&gt;&lt;/code&gt; keyword may be
@@ -29582,7 +31127,7 @@
    title=rel-help&gt;&lt;a href=&quot;#help&quot;&gt;help&lt;/a&gt;&lt;/code&gt; keyword indicates that the
    referenced document provides help for the page as a whole.
 
-  &lt;h5 id=link-type7&gt;&lt;span class=secno&gt;4.11.3.9. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type7&gt;&lt;span class=secno&gt;4.12.3.9. &lt;/span&gt;Link type &quot;&lt;dfn
    id=icon3 title=rel-icon&gt;&lt;code&gt;icon&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-icon&gt;&lt;a href=&quot;#icon3&quot;&gt;icon&lt;/a&gt;&lt;/code&gt; keyword may be
@@ -29599,7 +31144,7 @@
    appropriate icon according to the &lt;code title=attr-link-media&gt;&lt;a
    href=&quot;#media0&quot;&gt;media&lt;/a&gt;&lt;/code&gt; attribute.
 
-  &lt;h5 id=link-type8&gt;&lt;span class=secno&gt;4.11.3.10. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type8&gt;&lt;span class=secno&gt;4.12.3.10. &lt;/span&gt;Link type &quot;&lt;dfn
    id=license title=rel-license&gt;&lt;code&gt;license&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-license&gt;&lt;a href=&quot;#license&quot;&gt;license&lt;/a&gt;&lt;/code&gt;
@@ -29616,7 +31161,7 @@
    treat the keyword &quot;&lt;code title=&quot;&quot;&gt;copyright&lt;/code&gt;&quot; like the &lt;code
    title=rel-license&gt;&lt;a href=&quot;#license&quot;&gt;license&lt;/a&gt;&lt;/code&gt; keyword.
 
-  &lt;h5 id=link-type9&gt;&lt;span class=secno&gt;4.11.3.11. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type9&gt;&lt;span class=secno&gt;4.12.3.11. &lt;/span&gt;Link type &quot;&lt;dfn
    id=nofollow title=rel-nofollow&gt;&lt;code&gt;nofollow&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-nofollow&gt;&lt;a href=&quot;#nofollow&quot;&gt;nofollow&lt;/a&gt;&lt;/code&gt;
@@ -29627,7 +31172,7 @@
    keyword indicates that the link is not endorsed by the original author or
    publisher of the page.
 
-  &lt;h5 id=link-type10&gt;&lt;span class=secno&gt;4.11.3.12. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type10&gt;&lt;span class=secno&gt;4.12.3.12. &lt;/span&gt;Link type &quot;&lt;dfn
    id=pingback title=rel-pingback&gt;&lt;code&gt;pingback&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-pingback&gt;&lt;a href=&quot;#pingback&quot;&gt;pingback&lt;/a&gt;&lt;/code&gt;
@@ -29639,7 +31184,7 @@
    href=&quot;#pingback&quot;&gt;pingback&lt;/a&gt;&lt;/code&gt; keyword, see the Pingback 1.0
    specification. &lt;a href=&quot;#refsPINGBACK&quot;&gt;[PINGBACK]&lt;/a&gt;
 
-  &lt;h5 id=link-type11&gt;&lt;span class=secno&gt;4.11.3.13. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type11&gt;&lt;span class=secno&gt;4.12.3.13. &lt;/span&gt;Link type &quot;&lt;dfn
    id=prefetch title=rel-prefetch&gt;&lt;code&gt;prefetch&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-prefetch&gt;&lt;a href=&quot;#prefetch&quot;&gt;prefetch&lt;/a&gt;&lt;/code&gt;
@@ -29652,7 +31197,7 @@
    resource is likely to be beneficial, as it is highly likely that the user
    will require this resource.
 
-  &lt;h5 id=link-type12&gt;&lt;span class=secno&gt;4.11.3.14. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type12&gt;&lt;span class=secno&gt;4.12.3.14. &lt;/span&gt;Link type &quot;&lt;dfn
    id=search0 title=rel-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-search&gt;&lt;a href=&quot;#search0&quot;&gt;search&lt;/a&gt;&lt;/code&gt; keyword
@@ -29670,7 +31215,7 @@
    href=&quot;#search0&quot;&gt;search&lt;/a&gt;&lt;/code&gt; link type to enable user agents to
    autodiscover search interfaces.
 
-  &lt;h5 id=link-type13&gt;&lt;span class=secno&gt;4.11.3.15. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type13&gt;&lt;span class=secno&gt;4.12.3.15. &lt;/span&gt;Link type &quot;&lt;dfn
    id=stylesheet title=rel-stylesheet&gt;&lt;code&gt;stylesheet&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-stylesheet&gt;&lt;a
@@ -29688,7 +31233,7 @@
    &lt;code&gt;&lt;a href=&quot;#link&quot;&gt;link&lt;/a&gt;&lt;/code&gt; element, then the link is an
    alternative stylesheet.
 
-  &lt;h5 id=link-type14&gt;&lt;span class=secno&gt;4.11.3.16. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type14&gt;&lt;span class=secno&gt;4.12.3.16. &lt;/span&gt;Link type &quot;&lt;dfn
    id=sidebar title=rel-sidebar&gt;&lt;code&gt;sidebar&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-sidebar&gt;&lt;a href=&quot;#sidebar&quot;&gt;sidebar&lt;/a&gt;&lt;/code&gt;
@@ -29708,7 +31253,7 @@
    specified is a &lt;dfn id=sidebar0 title=rel-sidebar-hyperlink&gt;sidebar
    hyperlink&lt;/dfn&gt;.
 
-  &lt;h5 id=link-type15&gt;&lt;span class=secno&gt;4.11.3.17. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h5 id=link-type15&gt;&lt;span class=secno&gt;4.12.3.17. &lt;/span&gt;Link type &quot;&lt;dfn
    id=tag title=rel-tag&gt;&lt;code&gt;tag&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h5&gt;
 
   &lt;p&gt;The &lt;code title=rel-tag&gt;&lt;a href=&quot;#tag&quot;&gt;tag&lt;/a&gt;&lt;/code&gt; keyword may be
@@ -29721,7 +31266,7 @@
    that the &lt;em&gt;tag&lt;/em&gt; that the referenced document represents applies to
    the current document.
 
-  &lt;h5 id=hierarchical&gt;&lt;span class=secno&gt;4.11.3.18. &lt;/span&gt;Hierarchical link
+  &lt;h5 id=hierarchical&gt;&lt;span class=secno&gt;4.12.3.18. &lt;/span&gt;Hierarchical link
    types&lt;/h5&gt;
 
   &lt;p&gt;Some documents form part of a hierarchical structure of documents.
@@ -29734,7 +31279,7 @@
    &lt;em&gt;previous sibling&lt;/em&gt;, and the one that follows it is its &lt;em&gt;next
    sibling&lt;/em&gt;. A document with no parent forms the top of the hierarchy.
 
-  &lt;h6 id=link-type16&gt;&lt;span class=secno&gt;4.11.3.18.1. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h6 id=link-type16&gt;&lt;span class=secno&gt;4.12.3.18.1. &lt;/span&gt;Link type &quot;&lt;dfn
    id=first title=rel-first&gt;&lt;code&gt;first&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h6&gt;
 
   &lt;p&gt;The &lt;code title=rel-first&gt;&lt;a href=&quot;#first&quot;&gt;first&lt;/a&gt;&lt;/code&gt; keyword may
@@ -29753,7 +31298,7 @@
    title=&quot;&quot;&gt;start&lt;/code&gt;&quot; like the &lt;code title=rel-first&gt;&lt;a
    href=&quot;#first&quot;&gt;first&lt;/a&gt;&lt;/code&gt; keyword.
 
-  &lt;h6 id=link-type17&gt;&lt;span class=secno&gt;4.11.3.18.2. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h6 id=link-type17&gt;&lt;span class=secno&gt;4.12.3.18.2. &lt;/span&gt;Link type &quot;&lt;dfn
    id=index title=rel-index&gt;&lt;code&gt;index&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h6&gt;
 
   &lt;p&gt;The &lt;code title=rel-index&gt;&lt;a href=&quot;#index&quot;&gt;index&lt;/a&gt;&lt;/code&gt; keyword may
@@ -29771,7 +31316,7 @@
    title=&quot;&quot;&gt;contents&lt;/code&gt;&quot;, and &quot;&lt;code title=&quot;&quot;&gt;toc&lt;/code&gt;&quot; like the &lt;code
    title=rel-index&gt;&lt;a href=&quot;#index&quot;&gt;index&lt;/a&gt;&lt;/code&gt; keyword.
 
-  &lt;h6 id=link-type18&gt;&lt;span class=secno&gt;4.11.3.18.3. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h6 id=link-type18&gt;&lt;span class=secno&gt;4.12.3.18.3. &lt;/span&gt;Link type &quot;&lt;dfn
    id=last title=rel-last&gt;&lt;code&gt;last&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h6&gt;
 
   &lt;p&gt;The &lt;code title=rel-last&gt;&lt;a href=&quot;#last&quot;&gt;last&lt;/a&gt;&lt;/code&gt; keyword may be
@@ -29789,7 +31334,7 @@
    treat the keyword &quot;&lt;code title=&quot;&quot;&gt;end&lt;/code&gt;&quot; like the &lt;code
    title=rel-last&gt;&lt;a href=&quot;#last&quot;&gt;last&lt;/a&gt;&lt;/code&gt; keyword.
 
-  &lt;h6 id=link-type19&gt;&lt;span class=secno&gt;4.11.3.18.4. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h6 id=link-type19&gt;&lt;span class=secno&gt;4.12.3.18.4. &lt;/span&gt;Link type &quot;&lt;dfn
    id=next title=rel-next&gt;&lt;code&gt;next&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h6&gt;
 
   &lt;p&gt;The &lt;code title=rel-next&gt;&lt;a href=&quot;#next&quot;&gt;next&lt;/a&gt;&lt;/code&gt; keyword may be
@@ -29803,7 +31348,7 @@
    the link is leading to the document that is the next sibling of the
    current document.
 
-  &lt;h6 id=link-type20&gt;&lt;span class=secno&gt;4.11.3.18.5. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h6 id=link-type20&gt;&lt;span class=secno&gt;4.12.3.18.5. &lt;/span&gt;Link type &quot;&lt;dfn
    id=prev title=rel-prev&gt;&lt;code&gt;prev&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h6&gt;
 
   &lt;p&gt;The &lt;code title=rel-prev&gt;&lt;a href=&quot;#prev&quot;&gt;prev&lt;/a&gt;&lt;/code&gt; keyword may be
@@ -29821,7 +31366,7 @@
    treat the keyword &quot;&lt;code title=&quot;&quot;&gt;previous&lt;/code&gt;&quot; like the &lt;code
    title=rel-prev&gt;&lt;a href=&quot;#prev&quot;&gt;prev&lt;/a&gt;&lt;/code&gt; keyword.
 
-  &lt;h6 id=link-type21&gt;&lt;span class=secno&gt;4.11.3.18.6. &lt;/span&gt;Link type &quot;&lt;dfn
+  &lt;h6 id=link-type21&gt;&lt;span class=secno&gt;4.12.3.18.6. &lt;/span&gt;Link type &quot;&lt;dfn
    id=up title=rel-up&gt;&lt;code&gt;up&lt;/code&gt;&lt;/dfn&gt;&quot;&lt;/h6&gt;
 
   &lt;p&gt;The &lt;code title=rel-up&gt;&lt;a href=&quot;#up&quot;&gt;up&lt;/a&gt;&lt;/code&gt; keyword may be used
@@ -29845,7 +31390,7 @@
      &lt;/nav&gt;
    --&gt;
 
-  &lt;h5 id=other0&gt;&lt;span class=secno&gt;4.11.3.19. &lt;/span&gt;Other link types&lt;/h5&gt;
+  &lt;h5 id=other0&gt;&lt;span class=secno&gt;4.12.3.19. &lt;/span&gt;Other link types&lt;/h5&gt;
 
   &lt;p&gt;Other than the types defined above, only types defined as extensions in
    the &lt;a href=&quot;<A HREF="http://wiki.whatwg.org/wiki/RelExtensions">http://wiki.whatwg.org/wiki/RelExtensions</A>&quot;&gt;WHATWG Wiki
@@ -29975,7 +31520,7 @@
   &lt;p&gt;This specification does not define how new values will get approved. It
    is expected that the Wiki will have a community that addresses this.
 
-  &lt;h3 id=interfaces&gt;&lt;span class=secno&gt;4.12. &lt;/span&gt;Interfaces for URI
+  &lt;h3 id=interfaces&gt;&lt;span class=secno&gt;4.13. &lt;/span&gt;Interfaces for URI
    manipulation&lt;/h3&gt;
 
   &lt;p&gt;An interface that has a complement of &lt;dfn id=uri-decomposition&gt;URI
@@ -30028,9 +31573,8 @@
    action&lt;/a&gt; with the value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.
 
   &lt;p&gt;The rules for parsing and constructing URIs are described in RFC 3986
-   and RFC 3987, as modified by RFC 2732. &lt;a
-   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-   href=&quot;#refsRFC2732&quot;&gt;[RFC2732]&lt;/a&gt;
+   and RFC 3987. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
 
   &lt;table&gt;
    &lt;thead&gt;
@@ -30070,7 +31614,7 @@
     &lt;tr&gt;
      &lt;td&gt;&lt;dfn id=host0 title=dom-uda-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
 
-     &lt;td&gt;&lt;hostport&gt;
+     &lt;td&gt;&lt;a href=&quot;#lthostportgt&quot;&gt;&lt;hostport&gt;&lt;/a&gt;
 
      &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
       and uses a server-based naming authority
@@ -30087,7 +31631,7 @@
      &lt;td&gt;&lt;dfn id=hostname0 title=dom-uda-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
       
 
-     &lt;td&gt;&lt;host&gt;
+     &lt;td&gt;&lt;host&gt;/&lt;ihost&gt;
 
      &lt;td&gt;&lt;a href=&quot;#input&quot; title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
       and uses a server-based naming authority
@@ -30168,6 +31712,12 @@
 
      &lt;td&gt;&mdash;
   &lt;/table&gt;
+
+  &lt;p&gt;The &lt;dfn id=lthostportgt&gt;&lt;hostport&gt;&lt;/dfn&gt; component is defined as
+   being the &lt;host&gt;/&lt;ihost&gt; component, followed by a colon and
+   the &lt;port&gt; component, but with the colon and &lt;port&gt; component
+   omitted if the given port matches the default port for the protocol given
+   by the &lt;scheme&gt; component.&lt;/p&gt;
   &lt;!--
   <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
   <A HREF="http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp">http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp</A>
@@ -31627,11 +33177,11 @@
 
   &lt;pre class=idl&gt;interface &lt;dfn id=undomanager&gt;UndoManager&lt;/dfn&gt; {
   unsigned long &lt;a href=&quot;#adddata&quot; title=dom-UndoManager-add&gt;add&lt;/a&gt;(in DOMObject data, in DOMStrong title);
-  void &lt;a href=&quot;#remove1&quot; title=dom-UndoManager-remove&gt;remove&lt;/a&gt;(in unsigned long index);
+  void &lt;a href=&quot;#remove2&quot; title=dom-UndoManager-remove&gt;remove&lt;/a&gt;(in unsigned long index);
   void &lt;a href=&quot;#clearundo&quot; title=dom-UndoManager-clearUndo&gt;clearUndo&lt;/a&gt;();
   void &lt;a href=&quot;#clearredo&quot; title=dom-UndoManager-clearRedo&gt;clearRedo&lt;/a&gt;();
   DOMObject &lt;a href=&quot;#itemn&quot; title=dom-UndoManager-item&gt;item&lt;/a&gt;(in unsigned long index);
-  readonly attribute unsigned long &lt;a href=&quot;#length8&quot; title=dom-UndoManager-length&gt;length&lt;/a&gt;;
+  readonly attribute unsigned long &lt;a href=&quot;#length9&quot; title=dom-UndoManager-length&gt;length&lt;/a&gt;;
   readonly attribute unsigned long &lt;a href=&quot;#position0&quot; title=dom-UndoManager-position&gt;position&lt;/a&gt;;
 };&lt;/pre&gt;
 
@@ -31656,7 +33206,7 @@
    entries are absent from the &lt;a href=&quot;#undo-transaction&quot;&gt;undo transaction
    history&lt;/a&gt;.
 
-  &lt;p&gt;The &lt;dfn id=length8
+  &lt;p&gt;The &lt;dfn id=length9
    title=dom-UndoManager-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt; attribute must
    return the number of &lt;a href=&quot;#undo-object&quot;&gt;undo object&lt;/a&gt; entries in the
    &lt;a href=&quot;#undo-transaction&quot;&gt;undo transaction history&lt;/a&gt;.
@@ -31680,7 +33230,7 @@
    nearest to the &lt;a href=&quot;#current3&quot;&gt;undo position&lt;/a&gt;, on the &quot;redo&quot; side.
    If there are no &lt;a href=&quot;#undo-object&quot;&gt;undo object&lt;/a&gt; entries on the
    &quot;redo&quot; side, then the attribute must return the same as the &lt;code
-   title=dom-UndoManager-length&gt;&lt;a href=&quot;#length8&quot;&gt;length&lt;/a&gt;&lt;/code&gt;
+   title=dom-UndoManager-length&gt;&lt;a href=&quot;#length9&quot;&gt;length&lt;/a&gt;&lt;/code&gt;
    attribute. If there are no &lt;a href=&quot;#undo-object&quot;&gt;undo object&lt;/a&gt; entries
    on the &quot;undo&quot; side of the &lt;a href=&quot;#current3&quot;&gt;undo position&lt;/a&gt;, the &lt;code
    title=dom-UndoManager-position&gt;&lt;a href=&quot;#position0&quot;&gt;position&lt;/a&gt;&lt;/code&gt;
@@ -31722,12 +33272,12 @@
    expire server-held state when the server limitations come into play.&lt;/p&gt;
   &lt;!-- XXX note on expiring undo in case server can only do one level undo --&gt;
 
-  &lt;p&gt;The &lt;dfn id=remove1 title=dom-UndoManager-remove&gt;&lt;code&gt;remove(&lt;var
+  &lt;p&gt;The &lt;dfn id=remove2 title=dom-UndoManager-remove&gt;&lt;code&gt;remove(&lt;var
    title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must remove the &lt;a
    href=&quot;#undo-object&quot;&gt;undo object&lt;/a&gt; entry with the specified &lt;var
    title=&quot;&quot;&gt;index&lt;/var&gt;. If the index is less than zero or greater than or
    equal to &lt;code title=dom-UndoManager-length&gt;&lt;a
-   href=&quot;#length8&quot;&gt;length&lt;/a&gt;&lt;/code&gt; then the method must raise an
+   href=&quot;#length9&quot;&gt;length&lt;/a&gt;&lt;/code&gt; then the method must raise an
    &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception. &lt;a href=&quot;#dom-changes&quot;&gt;DOM
    changes&lt;/a&gt; entries are unaffected by this method.
 
@@ -32333,7 +33883,7 @@
    members in their DOM interfaces for handling their text selection:
 
   &lt;pre
-   class=idl&gt;  void &lt;a href=&quot;#select0&quot; title=&quot;dom-textarea/input-select&quot;&gt;select&lt;/a&gt;();
+   class=idl&gt;  void &lt;a href=&quot;#select1&quot; title=&quot;dom-textarea/input-select&quot;&gt;select&lt;/a&gt;();
            attribute unsigned long &lt;a href=&quot;#selectionstart&quot; title=&quot;dom-textarea/input-selectionStart&quot;&gt;selectionStart&lt;/a&gt;;
            attribute unsigned long &lt;a href=&quot;#selectionend&quot; title=&quot;dom-textarea/input-selectionEnd&quot;&gt;selectionEnd&lt;/a&gt;;
   void &lt;a href=&quot;#setselectionrange&quot; title=&quot;dom-textarea/input-setSelectionRange&quot;&gt;setSelectionRange&lt;/a&gt;(in unsigned long start, in unsigned long end);&lt;/pre&gt;
@@ -32342,7 +33892,7 @@
   &lt;p&gt;These methods and attributes expose and control the selection of
    &lt;code&gt;input&lt;/code&gt; and &lt;code&gt;textarea&lt;/code&gt; text fields.
 
-  &lt;p&gt;The &lt;dfn id=select0
+  &lt;p&gt;The &lt;dfn id=select1
    title=&quot;dom-textarea/input-select&quot;&gt;&lt;code&gt;select()&lt;/code&gt;&lt;/dfn&gt; method must
    cause the contents of the text field to be fully selected.
 
@@ -32622,7 +34172,7 @@
 
   &lt;p&gt;For non-HTTP protocols, UAs should act in equivalent ways.
 
-  &lt;h4 id=parsing0&gt;&lt;span class=secno&gt;6.2.3. &lt;/span&gt;Parsing an event stream&lt;/h4&gt;
+  &lt;h4 id=parsing1&gt;&lt;span class=secno&gt;6.2.3. &lt;/span&gt;Parsing an event stream&lt;/h4&gt;
 
   &lt;p&gt;This event stream format's MIME type is
    &lt;code&gt;application/x-dom-event-stream&lt;/code&gt;.
@@ -33882,7 +35432,7 @@
    to communicate with each other regardless of their source domain, in a way
    designed to not enable cross-site scripting attacks.
 
-  &lt;h4 id=processing2&gt;&lt;span class=secno&gt;6.4.1. &lt;/span&gt;Processing model&lt;/h4&gt;
+  &lt;h4 id=processing3&gt;&lt;span class=secno&gt;6.4.1. &lt;/span&gt;Processing model&lt;/h4&gt;
 
   &lt;p&gt;When a script invokes the &lt;dfn id=postmessage
    title=dom-window-postMessage&gt;&lt;code&gt;postMessage(&lt;var
@@ -33976,7 +35526,7 @@
 
   &lt;h2 id=syntax&gt;&lt;span class=secno&gt;8. &lt;/span&gt;The HTML syntax&lt;/h2&gt;
 
-  &lt;h3 id=writing&gt;&lt;span class=secno&gt;8.1. &lt;/span&gt;Writing HTML documents&lt;/h3&gt;
+  &lt;h3 id=writing0&gt;&lt;span class=secno&gt;8.1. &lt;/span&gt;Writing HTML documents&lt;/h3&gt;
 
   &lt;p&gt;&lt;em&gt;This section only applies to documents, authoring tools, and markup
    generators. In particular, it does not apply to conformance checkers;
@@ -34743,7 +36293,7 @@
 
   &lt;p&gt;This specification defines the parsing rules for HTML documents, whether
    they are syntactically valid or not. Certain points in the parsing
-   algorithm are said to be &lt;dfn id=parse title=&quot;parse error&quot;&gt;parse
+   algorithm are said to be &lt;dfn id=parse0 title=&quot;parse error&quot;&gt;parse
    errors&lt;/dfn&gt;. The error handling for parse errors is well-defined: user
    agents must either act as described below when encountering such problems,
    or must abort processing at the first error that they encounter for which
@@ -35294,7 +36844,7 @@
 
   &lt;p&gt;All U+0000 NULL characters in the input must be replaced by U+FFFD
    REPLACEMENT CHARACTERs. Any occurrences of such characters is a &lt;a
-   href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.
+   href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.
 
   &lt;p&gt;U+000D CARRIAGE RETURN (CR) characters, and U+000A LINE FEED (LF)
    characters, are treated specially. Any CR characters that are followed by
@@ -35320,7 +36870,7 @@
    representing the end of the &lt;a href=&quot;#input0&quot;&gt;input stream&lt;/a&gt;. If the
    parser is a &lt;a href=&quot;#script-created&quot;&gt;script-created parser&lt;/a&gt;, then the
    end of the &lt;a href=&quot;#input0&quot;&gt;input stream&lt;/a&gt; is reached when an &lt;dfn
-   id=explicit&gt;explicit &quot;EOF&quot; character&lt;/dfn&gt; (inserted by the &lt;code
+   id=explicit0&gt;explicit &quot;EOF&quot; character&lt;/dfn&gt; (inserted by the &lt;code
    title=dom-document-close&gt;&lt;a href=&quot;#close&quot;&gt;document.close()&lt;/a&gt;&lt;/code&gt;
    method) is consumed. Otherwise, the &quot;EOF&quot; character is not a real
    character in the stream, but rather the lack of any further characters.
@@ -35411,7 +36961,7 @@
    flag&lt;/a&gt; must be switched to the PCDATA state.
 
   &lt;p&gt;When an end tag token is emitted with attributes, that is a &lt;a
-   href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.
+   href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.
 
   &lt;p&gt;A &lt;dfn id=permitted&gt;permitted slash&lt;/dfn&gt; is a U+002F SOLIDUS character
    that is immediately followed by a U+003E GREATER-THAN SIGN, if, and only
@@ -35569,18 +37119,18 @@
 
        &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)
 
-       &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit a U+003C LESS-THAN SIGN
+       &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit a U+003C LESS-THAN SIGN
         character token and a U+003E GREATER-THAN SIGN character token.
         Switch to the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
        &lt;dt&gt;U+003F QUESTION MARK (?)
 
-       &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
+       &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
         href=&quot;#bogus&quot;&gt;bogus comment state&lt;/a&gt;.
 
        &lt;dt&gt;Anything else
 
-       &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit a U+003C LESS-THAN SIGN
+       &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit a U+003C LESS-THAN SIGN
         character token and reconsume the current input character in the &lt;a
         href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
       &lt;/dl&gt;
@@ -35642,18 +37192,18 @@
 
      &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit a U+003C LESS-THAN SIGN
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit a U+003C LESS-THAN SIGN
       character token and a U+002F SOLIDUS character token. Reconsume the EOF
       character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#bogus&quot;&gt;bogus comment state&lt;/a&gt;.
     &lt;/dl&gt;
 
@@ -35690,13 +37240,13 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
       href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
 
@@ -35740,13 +37290,13 @@
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
       href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Stay in the &lt;a
       href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
 
@@ -35794,13 +37344,13 @@
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
       href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
 
@@ -35814,7 +37364,7 @@
      emitting the tag token, if appropriate), the complete attribute's name
      must be compared to the other attributes on the same token; if there is
      already an attribute on the token with the exact same name, then this is
-     a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt; and the new attribute must be
+     a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt; and the new attribute must be
      dropped, along with the value that gets associated with it (if any).&lt;/p&gt;
 
    &lt;dt&gt;&lt;dfn id=after&gt;After attribute name state&lt;/dfn&gt;
@@ -35855,13 +37405,13 @@
 
      &lt;dt&gt;U+002F SOLIDUS (/)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt; unless this is a &lt;a
       href=&quot;#permitted&quot;&gt;permitted slash&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#before&quot;&gt;before attribute name state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
 
@@ -35913,7 +37463,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
       Reconsume the character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
@@ -35940,7 +37490,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
       Reconsume the character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
@@ -35967,7 +37517,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
       Reconsume the character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
@@ -36008,7 +37558,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the current tag token.
       Reconsume the character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
@@ -36066,7 +37616,7 @@
      word &quot;DOCTYPE&quot;, then consume those characters and switch to the &lt;a
      href=&quot;#doctype0&quot;&gt;DOCTYPE state&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, is is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Switch to the &lt;a
+    &lt;p&gt;Otherwise, is is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Switch to the &lt;a
      href=&quot;#bogus&quot;&gt;bogus comment state&lt;/a&gt;. The next character that is
      consumed, if any, is the first character that will be in the comment.&lt;/p&gt;
 
@@ -36082,12 +37632,12 @@
 
      &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Switch to
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Switch to
       the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
       the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
@@ -36108,12 +37658,12 @@
 
      &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Switch to
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Switch to
       the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
       the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
@@ -36135,7 +37685,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
       the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.&lt;/dd&gt;
      &lt;!-- For
      security reasons: otherwise, hostile user could put a &lt;script&gt; in
@@ -36161,7 +37711,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
       the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.&lt;/dd&gt;
      &lt;!-- For
      security reasons: otherwise, hostile user could put a &lt;script&gt; in
@@ -36189,13 +37739,13 @@
 
      &lt;dt&gt;U+002D HYPHEN-MINUS (-)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Append a U+002D HYPHEN-MINUS (-)
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Append a U+002D HYPHEN-MINUS (-)
       character to the comment token's data. Stay in the &lt;a
       href=&quot;#comment3&quot;&gt;comment end state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Emit the comment token. Reconsume
       the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.&lt;/dd&gt;
      &lt;!-- For
      security reasons: otherwise, hostile user could put a &lt;script&gt; in
@@ -36205,9 +37755,9 @@
 
      &lt;dt&gt;Anything else
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Append two U+002D HYPHEN-MINUS (-)
-      characters and the input character to the comment token's data. Switch
-      to the &lt;a href=&quot;#comment&quot;&gt;comment state&lt;/a&gt;.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Append two U+002D HYPHEN-MINUS
+      (-) characters and the input character to the comment token's data.
+      Switch to the &lt;a href=&quot;#comment&quot;&gt;comment state&lt;/a&gt;.
     &lt;/dl&gt;
 
    &lt;dt&gt;&lt;dfn id=doctype0&gt;DOCTYPE state&lt;/dfn&gt;
@@ -36231,8 +37781,8 @@
 
      &lt;dt&gt;Anything else
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Reconsume the current character in
-      the &lt;a href=&quot;#before1&quot;&gt;before DOCTYPE name state&lt;/a&gt;.
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Reconsume the current character
+      in the &lt;a href=&quot;#before1&quot;&gt;before DOCTYPE name state&lt;/a&gt;.
     &lt;/dl&gt;
 
    &lt;dt&gt;&lt;dfn id=before1&gt;Before DOCTYPE name state&lt;/dfn&gt;
@@ -36256,13 +37806,13 @@
 
      &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Create a new DOCTYPE token. Set
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Create a new DOCTYPE token. Set
       its correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit the token. Switch to the
       &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Create a new DOCTYPE token. Set
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Create a new DOCTYPE token. Set
       its correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit the token. Reconsume the
       EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
@@ -36299,7 +37849,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
@@ -36336,7 +37886,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
@@ -36354,7 +37904,7 @@
        the word &quot;SYSTEM&quot;, then consume those characters and switch to the &lt;a
        href=&quot;#before3&quot;&gt;before DOCTYPE system identifier state&lt;/a&gt;.&lt;/p&gt;
 
-      &lt;p&gt;Otherwise, this is the &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Switch to
+      &lt;p&gt;Otherwise, this is the &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Switch to
        the &lt;a href=&quot;#bogus0&quot;&gt;bogus DOCTYPE state&lt;/a&gt;.&lt;/p&gt;
     &lt;/dl&gt;
 
@@ -36392,20 +37942,20 @@
 
      &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token. Switch
       to the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#bogus0&quot;&gt;bogus DOCTYPE state&lt;/a&gt;.
     &lt;/dl&gt;
 
@@ -36422,7 +37972,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
@@ -36447,7 +37997,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
@@ -36498,14 +38048,14 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#bogus0&quot;&gt;bogus DOCTYPE state&lt;/a&gt;.
     &lt;/dl&gt;
 
@@ -36543,20 +38093,20 @@
 
      &lt;dt&gt;U+003E GREATER-THAN SIGN (&gt;)
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token. Switch
       to the &lt;a href=&quot;#data-state&quot;&gt;data state&lt;/a&gt;.
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#bogus0&quot;&gt;bogus DOCTYPE state&lt;/a&gt;.
     &lt;/dl&gt;
 
@@ -36573,7 +38123,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
@@ -36598,7 +38148,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
@@ -36637,14 +38187,14 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
 
      &lt;dt&gt;Anything else
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch to the &lt;a
       href=&quot;#bogus0&quot;&gt;bogus DOCTYPE state&lt;/a&gt;.
     &lt;/dl&gt;
 
@@ -36661,7 +38211,7 @@
 
      &lt;dt&gt;EOF
 
-     &lt;dd&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
+     &lt;dd&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the DOCTYPE token's
       correctness flag to &lt;i&gt;incorrect&lt;/i&gt;. Emit that DOCTYPE token.
       Reconsume the EOF character in the &lt;a href=&quot;#data-state&quot;&gt;data
       state&lt;/a&gt;.
@@ -36743,18 +38293,18 @@
 
     &lt;p&gt;If no characters match the range, then don't consume any characters
      (and unconsume the U+0023 NUMBER SIGN character and, if appropriate, the
-     X character). This is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;; nothing is
+     X character). This is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;; nothing is
      returned.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the next character is a U+003B SEMICOLON, consume that
-     too. If it isn't, there is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+     too. If it isn't, there is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;If one or more characters match the range, then take them all and
      interpret the string of characters as a number (either hexadecimal or
      decimal as appropriate).&lt;/p&gt;
 
     &lt;p&gt;If that number is one of the numbers in the first column of the
-     following table, then this is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Find
+     following table, then this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Find
      the row with that number in the first column, and return a character
      token for the Unicode character given in the second column of that row.&lt;/p&gt;
 
@@ -37000,7 +38550,7 @@
 
     &lt;p&gt;Otherwise, if the number is zero, if the number is higher than
      0x10FFFF, or if it's one of the surrogate characters (characters in the
-     range 0xD800 to 0xDFFF), then this is a &lt;a href=&quot;#parse&quot;&gt;parse
+     range 0xD800 to 0xDFFF), then this is a &lt;a href=&quot;#parse0&quot;&gt;parse
      error&lt;/a&gt;; return a character token for the U+FFFD REPLACEMENT CHARACTER
      character instead.&lt;/p&gt;
 
@@ -37014,11 +38564,11 @@
      characters case-sensitively matching one of the identifiers in the first
      column of the &lt;a href=&quot;#entities0&quot;&gt;entities&lt;/a&gt; table.&lt;/p&gt;
 
-    &lt;p&gt;If no match can be made, then this is a &lt;a href=&quot;#parse&quot;&gt;parse
+    &lt;p&gt;If no match can be made, then this is a &lt;a href=&quot;#parse0&quot;&gt;parse
      error&lt;/a&gt;. No characters are consumed, and nothing is returned.&lt;/p&gt;
 
     &lt;p&gt;If the last character matched is not a U+003B SEMICOLON (&lt;code
-     title=&quot;&quot;&gt;;&lt;/code&gt;), there is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+     title=&quot;&quot;&gt;;&lt;/code&gt;), there is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;If the entity is being consumed &lt;a href=&quot;#entity0&quot; title=&quot;entity in
      attribute value state&quot;&gt;as part of an attribute&lt;/a&gt;, and the last
@@ -37116,7 +38666,7 @@
     &lt;p&gt;If the DOCTYPE token's &lt;code title=&quot;&quot;&gt;name&lt;/code&gt; does not
      case-insensitively match the string &quot;&lt;code title=&quot;&quot;&gt;HTML&lt;/code&gt;&quot;, or if
      the token's public identifier is not missing, or if the token's system
-     identifier is not missing, then there is a &lt;a href=&quot;#parse&quot;&gt;parse
+     identifier is not missing, then there is a &lt;a href=&quot;#parse0&quot;&gt;parse
      error&lt;/a&gt;. Conformance checkers may, instead of reporting this error,
      switch to a conformance checking mode for another language (e.g. based
      on the DOCTYPE token a conformance checker could recognise that the
@@ -37399,7 +38949,7 @@
    &lt;dt&gt;An end-of-file token
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the document to &lt;a href=&quot;#quirks&quot;&gt;quirks mode&lt;/a&gt;.&lt;/p&gt;
 
@@ -37418,7 +38968,7 @@
    &lt;dt&gt;A DOCTYPE token
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
    &lt;dt&gt;A comment token
 
@@ -37445,6 +38995,15 @@
    &lt;dt&gt;An end-of-file token
 
    &lt;dd&gt;
+    &lt;p id=parser-appcache&gt;If the token is a start tag token with the tag name
+     &quot;html&quot;, and it has an attribute &quot;application&quot;, then run the &lt;a
+     href=&quot;#application2&quot;
+     title=concept-appcache-init-with-attribute&gt;application cache selection
+     algorithm&lt;/a&gt; with the value of that attribute as the manifest URI.
+     Otherwise, run the &lt;a href=&quot;#application3&quot;
+     title=concept-appcache-init-no-attribute&gt;application cache selection
+     algorithm&lt;/a&gt; with no manifest.&lt;/p&gt;
+
     &lt;p&gt;Create an &lt;code&gt;&lt;a href=&quot;#htmlelement&quot;&gt;HTMLElement&lt;/a&gt;&lt;/code&gt; node
      with the tag name &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt;, in the &lt;a
      href=&quot;#html-namespace0&quot;&gt;HTML namespace&lt;/a&gt;. Append it to the
@@ -37797,7 +39356,7 @@
 
    &lt;li&gt;
     &lt;p&gt;If the next token is an end tag token with the same tag name as the
-     start tag token, ignore it. Otherwise, this is a &lt;a href=&quot;#parse&quot;&gt;parse
+     start tag token, ignore it. Otherwise, this is a &lt;a href=&quot;#parse0&quot;&gt;parse
      error&lt;/a&gt;.
   &lt;/ol&gt;
 
@@ -38023,13 +39582,13 @@
    &lt;dt&gt;A DOCTYPE token
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
    &lt;dt&gt;A start tag whose tag name is &quot;html&quot;
 
    &lt;dd&gt;
     &lt;p&gt;If this start tag token was not the first start tag token, then it is
-     a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+     a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;For each attribute on the token, check to see if the attribute is
      already present on the top element of the &lt;a href=&quot;#stack&quot;&gt;stack of open
@@ -38044,14 +39603,14 @@
     &lt;p&gt;If there are more than two nodes on the &lt;a href=&quot;#stack&quot;&gt;stack of open
      elements&lt;/a&gt;, or if there are two nodes but the second node is not a
      &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; node, this is a &lt;a
-     href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+     href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the parser was originally created as part of the &lt;a
      href=&quot;#html-fragment0&quot;&gt;HTML fragment parsing algorithm&lt;/a&gt;, and there's
      more than one element in the &lt;a href=&quot;#stack&quot;&gt;stack of open
      elements&lt;/a&gt;, and the second node on the &lt;a href=&quot;#stack&quot;&gt;stack of open
      elements&lt;/a&gt; is not a &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; node, then
-     this is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. (&lt;a
+     this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. (&lt;a
      href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=&quot;#stops&quot;&gt;Stop parsing.&lt;/a&gt;&lt;/p&gt;
@@ -38127,7 +39686,7 @@
        &lt;dt&gt;Any other end tag
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
         &lt;p class=big-issue&gt;Do we really want to ignore end tags here?&lt;/p&gt;
 
@@ -38260,7 +39819,7 @@
          have switched back to the PCDATA state.&lt;/p&gt;
 
         &lt;p&gt;If the next token is not an end tag token with the tag name
-         &quot;script&quot;, then this is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;; mark the
+         &quot;script&quot;, then this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;; mark the
          &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element as &lt;a
          href=&quot;#already&quot;&gt;&quot;already executed&quot;&lt;/a&gt;. Otherwise, the token is the
          &lt;code&gt;&lt;a href=&quot;#script0&quot;&gt;script&lt;/a&gt;&lt;/code&gt; element's end tag, so
@@ -38376,7 +39935,7 @@
        &lt;dt&gt;Any other end tag
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;Anything else
 
@@ -38431,12 +39990,12 @@
        &lt;dt&gt;Any other end tag
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;Anything else
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Act as if an end tag with the
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Act as if an end tag with the
          tag name &quot;noscript&quot; had been seen and reprocess the current token.&lt;/p&gt;
       &lt;/dl&gt;
 
@@ -38486,7 +40045,7 @@
         &quot;meta&quot;, &quot;script&quot;, &quot;style&quot;, &quot;title&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;Push the node pointed to by the &lt;a href=&quot;#head-element&quot;&gt;&lt;code
          title=&quot;&quot;&gt;head&lt;/code&gt; element pointer&lt;/a&gt; onto the &lt;a
@@ -38544,14 +40103,14 @@
        &lt;dt&gt;A start tag whose tag name is &quot;title&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Process the token as if the &lt;a
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Process the token as if the &lt;a
          href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; had been &quot;&lt;a href=&quot;#in-head&quot;
          title=&quot;insertion mode: in head&quot;&gt;in head&lt;/a&gt;&quot;.&lt;/p&gt;
 
        &lt;dt&gt;A start tag whose tag name is &quot;body&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;If the second element on the &lt;a href=&quot;#stack&quot;&gt;stack of open
          elements&lt;/a&gt; is not a &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt;
@@ -38570,7 +40129,7 @@
        &lt;dd&gt;
         &lt;p&gt;If the second element in the &lt;a href=&quot;#stack&quot;&gt;stack of open
          elements&lt;/a&gt; is not a &lt;code&gt;&lt;a href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt;
-         element, this is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Ignore the
+         element, this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Ignore the
          token. (&lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise, if there is a node in the &lt;a href=&quot;#stack&quot;&gt;stack of
@@ -38586,7 +40145,7 @@
          href=&quot;#tr&quot;&gt;tr&lt;/a&gt;&lt;/code&gt; element, the &lt;code&gt;&lt;a
          href=&quot;#body0&quot;&gt;body&lt;/a&gt;&lt;/code&gt; element, or the &lt;code&gt;&lt;a
          href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.
 
         &lt;p&gt;Change the &lt;a href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a
          href=&quot;#after4&quot; title=&quot;insertion mode: after body&quot;&gt;after body&lt;/a&gt;&quot;.&lt;/p&gt;
@@ -38634,7 +40193,7 @@
        &lt;dd&gt;
         &lt;p&gt;If the &lt;a href=&quot;#form-element&quot;&gt;&lt;code title=form&gt;form&lt;/code&gt;
          element pointer&lt;/a&gt; is not null, ignore the token with a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
 
@@ -38669,7 +40228,7 @@
            &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; up to &lt;var
            title=&quot;&quot;&gt;node&lt;/var&gt;, including &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then stop
            this algorithm. If more than one node is popped, then this is a &lt;a
-           href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.
+           href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.
 
          &lt;li&gt;
           &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not in the &lt;a
@@ -38719,7 +40278,7 @@
            href=&quot;#current4&quot;&gt;current node&lt;/a&gt; up to &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;,
            including &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then stop this algorithm. If
            more than one node is popped, then this is a &lt;a
-           href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.
+           href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.
 
          &lt;li&gt;
           &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is not in the &lt;a
@@ -38778,7 +40337,7 @@
 
         &lt;p&gt;Now, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not an element
          with the same tag name as that of the token, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
          href=&quot;#have-an&quot;&gt;has an element in scope&lt;/a&gt; with the same tag name
@@ -38800,7 +40359,7 @@
 
         &lt;p&gt;Now, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not an element
          with the same tag name as that of the token, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;Otherwise, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an
          element with the same tag name as that of the token pop that element
@@ -38819,7 +40378,7 @@
 
         &lt;p&gt;If the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not a &lt;code&gt;&lt;a
          href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
          href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;has a &lt;code&gt;p&lt;/code&gt;
@@ -38842,7 +40401,7 @@
 
         &lt;p&gt;If the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not an element with
          the same tag name as the token, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
          href=&quot;#have-an&quot;&gt;has an element in scope&lt;/a&gt; whose tag name matches
@@ -38883,7 +40442,7 @@
 
         &lt;p&gt;Now, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not an element
          with the same tag name as that of the token, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
          href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;has in scope&lt;/a&gt; an
@@ -38907,7 +40466,7 @@
          contains an element whose tag name is &quot;a&quot; between the end of the
          list and the last marker on the list (or the start of the list if
          there is no marker on the list), then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;; act as if an end tag with the tag
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;; act as if an end tag with the tag
          name &quot;a&quot; had been seen, then remove that element from the &lt;a
          href=&quot;#list-of4&quot;&gt;list of active formatting elements&lt;/a&gt; and the &lt;a
          href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; if the end tag didn't
@@ -38952,7 +40511,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
          href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;has a
          &lt;code&gt;nobr&lt;/code&gt; element in scope&lt;/a&gt;, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Act as if an end tag with the tag
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Act as if an end tag with the tag
          name &lt;code&gt;nobr&lt;/code&gt; had been seen, then once again &lt;a
          href=&quot;#reconstruct&quot;&gt;reconstruct the active formatting elements&lt;/a&gt;,
          if any.&lt;/p&gt;
@@ -38984,12 +40543,12 @@
           &lt;p&gt;If there is no such node, or, if that node is also in the &lt;a
            href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; but the element is not &lt;a
            href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;in scope&lt;/a&gt;, then
-           this is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Abort these steps. The
-           token is ignored.&lt;/p&gt;
+           this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Abort these steps.
+           The token is ignored.&lt;/p&gt;
 
           &lt;p&gt;Otherwise, if there is such a node, but that node is not in the
            &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;, then this is a &lt;a
-           href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;; remove the element from the list,
+           href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;; remove the element from the list,
            and abort these steps.&lt;/p&gt;
 
           &lt;p&gt;Otherwise, there is a &lt;var title=&quot;&quot;&gt;formatting element&lt;/var&gt; and
@@ -38997,7 +40556,7 @@
            elements&quot;&gt;the stack&lt;/a&gt; and is &lt;a href=&quot;#have-an&quot; title=&quot;has an
            element in scope&quot;&gt;in scope&lt;/a&gt;. If the element is not the &lt;a
            href=&quot;#current4&quot;&gt;current node&lt;/a&gt;, this is a &lt;a
-           href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. In any case, proceed with the
+           href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. In any case, proceed with the
            algorithm as written in the following steps.&lt;/p&gt;
 
          &lt;li&gt;
@@ -39128,7 +40687,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
          href=&quot;#have-an&quot; title=&quot;has an element in scope&quot;&gt;has a
          &lt;code&gt;button&lt;/code&gt; element in scope&lt;/a&gt;, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;; act as if an end tag with the tag
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;; act as if an end tag with the tag
          name &quot;button&quot; had been seen, then reprocess the token.&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -39163,7 +40722,7 @@
 
         &lt;p&gt;Now, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not an element
          with the same tag name as the token, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;Now, if the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
          href=&quot;#have-an&quot;&gt;has an element in scope&lt;/a&gt; whose tag name matches
@@ -39223,7 +40782,7 @@
        &lt;dt&gt;A start tag whose tag name is &quot;image&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Change the token's tag name to
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Change the token's tag name to
          &quot;img&quot; and reprocess it. (Don't ask.)&lt;/p&gt;
         &lt;!-- As of
         2005-12, studies showed that around 0.2% of pages used the
@@ -39252,7 +40811,7 @@
        &lt;dt id=isindex&gt;A start tag whose tag name is &quot;isindex&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;If the &lt;a href=&quot;#form-element&quot;&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
          pointer&lt;/a&gt; is not null, then ignore the token.&lt;/p&gt;
@@ -39353,7 +40912,7 @@
          have switched back to the PCDATA state.&lt;/p&gt;
 
         &lt;p&gt;If the next token is an end tag token with the tag name
-         &quot;textarea&quot;, ignore it. Otherwise, this is a &lt;a href=&quot;#parse&quot;&gt;parse
+         &quot;textarea&quot;, ignore it. Otherwise, this is a &lt;a href=&quot;#parse0&quot;&gt;parse
          error&lt;/a&gt;.&lt;/p&gt;
 
        &lt;dt&gt;A start tag whose tag name is one of: &quot;iframe&quot;, &quot;noembed&quot;,
@@ -39381,8 +40940,8 @@
        &lt;dt&gt;An end tag whose tag name is &quot;br&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Act as if a start tag token with
-         the tag name &quot;br&quot; had been seen. Ignore the end tag token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Act as if a start tag token
+         with the tag name &quot;br&quot; had been seen. Ignore the end tag token.&lt;/p&gt;
 
        &lt;dt&gt;A start or end tag whose tag name is one of: &quot;caption&quot;, &quot;col&quot;,
         &quot;colgroup&quot;, &quot;frame&quot;, &quot;frameset&quot;, &quot;head&quot;, &quot;option&quot;, &quot;optgroup&quot;,
@@ -39398,7 +40957,7 @@
         href=&quot;#scripting2&quot;&gt;scripting is enabled&lt;/a&gt;:
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;A start or end tag whose tag name is one of: &quot;event-source&quot;,
         &quot;section&quot;, &quot;nav&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;header&quot;, &quot;footer&quot;, &quot;datagrid&quot;,
@@ -39448,7 +41007,7 @@
            &lt;li&gt;
             &lt;p&gt;If the tag name of the end tag token does not match the tag
              name of the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt;, this is a &lt;a
-             href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.
+             href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.
 
            &lt;li&gt;
             &lt;p&gt;Pop all the nodes from the &lt;a href=&quot;#current4&quot;&gt;current
@@ -39460,7 +41019,7 @@
           &lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is in neither the &lt;a
            href=&quot;#formatting&quot;&gt;formatting&lt;/a&gt; category nor the &lt;a
            href=&quot;#phrasing&quot;&gt;phrasing&lt;/a&gt; category, then this is a &lt;a
-           href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Stop this algorithm. The end tag
+           href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Stop this algorithm. The end tag
            token is ignored.
 
          &lt;li&gt;
@@ -39545,7 +41104,7 @@
        &lt;dt&gt;A start tag whose tag name is &quot;table&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Act as if an end tag token with
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Act as if an end tag token with
          the tag name &quot;table&quot; had been seen, then, if that token wasn't
          ignored, reprocess the current token.&lt;/p&gt;
 
@@ -39558,7 +41117,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
          href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;have an
          element in table scope&lt;/a&gt; with the same tag name as the token, this
-         is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
+         is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
          href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -39567,7 +41126,7 @@
 
         &lt;p&gt;Now, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not a &lt;code&gt;&lt;a
          href=&quot;#table&quot;&gt;table&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;Pop elements from this stack until a &lt;code&gt;&lt;a
          href=&quot;#table&quot;&gt;table&lt;/a&gt;&lt;/code&gt; element has been popped from the
@@ -39579,12 +41138,12 @@
         &quot;colgroup&quot;, &quot;html&quot;, &quot;tbody&quot;, &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;Anything else
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Process the token as if the &lt;a
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Process the token as if the &lt;a
          href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; was &quot;&lt;a href=&quot;#in-body&quot;
          title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot;, with the following
          exception:&lt;/p&gt;
@@ -39635,7 +41194,7 @@
        href=&quot;#table&quot;&gt;table&lt;/a&gt;&lt;/code&gt; element or an &lt;code&gt;&lt;a
        href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element, pop elements from the &lt;a
        href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;. If this causes any elements
-       to be popped from the stack, then this is a &lt;a href=&quot;#parse&quot;&gt;parse
+       to be popped from the stack, then this is a &lt;a href=&quot;#parse0&quot;&gt;parse
        error&lt;/a&gt;.&lt;/p&gt;
 
       &lt;p class=note&gt;The &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; being an
@@ -39654,7 +41213,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
          href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;have an
          element in table scope&lt;/a&gt; with the same tag name as the token, this
-         is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
+         is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
          href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -39663,7 +41222,7 @@
 
         &lt;p&gt;Now, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not a &lt;code&gt;&lt;a
          href=&quot;#caption0&quot;&gt;caption&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;Pop elements from this stack until a &lt;code&gt;&lt;a
          href=&quot;#caption0&quot;&gt;caption&lt;/a&gt;&lt;/code&gt; element has been popped from the
@@ -39681,7 +41240,7 @@
        &lt;dt&gt;An end tag whose tag name is &quot;table&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Act as if an end tag with the
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Act as if an end tag with the
          tag name &quot;caption&quot; had been seen, then, if that token wasn't
          ignored, reprocess the current token.&lt;/p&gt;
 
@@ -39692,7 +41251,7 @@
         &quot;html&quot;, &quot;tbody&quot;, &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;Anything else
 
@@ -39737,7 +41296,7 @@
        &lt;dd&gt;
         &lt;p&gt;If the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is the root &lt;code&gt;&lt;a
          href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;, ignore the token. (&lt;a
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;, ignore the token. (&lt;a
          href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise, pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; (which
@@ -39749,7 +41308,7 @@
        &lt;dt&gt;An end tag whose tag name is &quot;col&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;Anything else
 
@@ -39781,7 +41340,7 @@
        &lt;dt&gt;A start tag whose tag name is one of: &quot;th&quot;, &quot;td&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Act as if a start tag with the
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Act as if a start tag with the
          tag name &quot;tr&quot; had been seen, then reprocess the current token.&lt;/p&gt;
 
        &lt;dt&gt;An end tag whose tag name is one of: &quot;tbody&quot;, &quot;tfoot&quot;, &quot;thead&quot;
@@ -39790,7 +41349,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
          href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;have an
          element in table scope&lt;/a&gt; with the same tag name as the token, this
-         is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+         is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
 
@@ -39811,7 +41370,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
          href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;have a
          &lt;code&gt;tbody&lt;/code&gt;, &lt;code&gt;thead&lt;/code&gt;, or &lt;code&gt;tfoot&lt;/code&gt;
-         element in table scope&lt;/a&gt;, this is a &lt;a href=&quot;#parse&quot;&gt;parse
+         element in table scope&lt;/a&gt;, this is a &lt;a href=&quot;#parse0&quot;&gt;parse
          error&lt;/a&gt;. Ignore the token. (&lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -39827,7 +41386,7 @@
         &quot;colgroup&quot;, &quot;html&quot;, &quot;td&quot;, &quot;th&quot;, &quot;tr&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;Anything else
 
@@ -39845,7 +41404,7 @@
        href=&quot;#thead0&quot;&gt;thead&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a
        href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element, pop elements from the &lt;a
        href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;. If this causes any elements
-       to be popped from the stack, then this is a &lt;a href=&quot;#parse&quot;&gt;parse
+       to be popped from the stack, then this is a &lt;a href=&quot;#parse0&quot;&gt;parse
        error&lt;/a&gt;.&lt;/p&gt;
 
       &lt;p class=note&gt;The &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; being an
@@ -39877,7 +41436,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
          href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;have an
          element in table scope&lt;/a&gt; with the same tag name as the token, this
-         is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
+         is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
          href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -39909,7 +41468,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
          href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;have an
          element in table scope&lt;/a&gt; with the same tag name as the token, this
-         is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+         is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
         &lt;p&gt;Otherwise, act as if an end tag with the tag name &quot;tr&quot; had been
          seen, then reprocess the current token.&lt;/p&gt;
@@ -39918,7 +41477,7 @@
         &quot;colgroup&quot;, &quot;html&quot;, &quot;td&quot;, &quot;th&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;Anything else
 
@@ -39934,7 +41493,7 @@
        href=&quot;#tr&quot;&gt;tr&lt;/a&gt;&lt;/code&gt; element or an &lt;code&gt;&lt;a
        href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element, pop elements from the &lt;a
        href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;. If this causes any elements
-       to be popped from the stack, then this is a &lt;a href=&quot;#parse&quot;&gt;parse
+       to be popped from the stack, then this is a &lt;a href=&quot;#parse0&quot;&gt;parse
        error&lt;/a&gt;.&lt;/p&gt;
 
       &lt;p class=note&gt;The &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; being an
@@ -39952,8 +41511,8 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
          href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;have an
          element in table scope&lt;/a&gt; with the same tag name as that of the
-         token, then this is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt; and the token
-         must be ignored.&lt;/p&gt;
+         token, then this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt; and the
+         token must be ignored.&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
 
@@ -39962,7 +41521,7 @@
 
         &lt;p&gt;Now, if the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is not an element
          with the same tag name as the token, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;Pop elements from this stack until an element with the same tag
          name as the token has been popped from the stack.&lt;/p&gt;
@@ -39982,7 +41541,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does
          &lt;em&gt;not&lt;/em&gt; &lt;a href=&quot;#have-an0&quot; title=&quot;has an element in table
          scope&quot;&gt;have a &lt;code&gt;td&lt;/code&gt; or &lt;code&gt;th&lt;/code&gt; element in table
-         scope&lt;/a&gt;, then this is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;; ignore
+         scope&lt;/a&gt;, then this is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;; ignore
          the token. (&lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise, &lt;a href=&quot;#close2&quot;&gt;close the cell&lt;/a&gt; (see below) and
@@ -39992,7 +41551,7 @@
         &quot;colgroup&quot;, &quot;html&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;An end tag whose tag name is one of: &quot;table&quot;, &quot;tbody&quot;, &quot;tfoot&quot;,
         &quot;thead&quot;, &quot;tr&quot;
@@ -40003,7 +41562,7 @@
          element in table scope&lt;/a&gt; with the same tag name as that of the
          token (which can only happen for &quot;tbody&quot;, &quot;tfoot&quot; and &quot;thead&quot;, or,
          in the &lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;), then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt; and the token must be ignored.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt; and the token must be ignored.&lt;/p&gt;
 
         &lt;p&gt;Otherwise, &lt;a href=&quot;#close2&quot;&gt;close the cell&lt;/a&gt; (see below) and
          reprocess the current token.&lt;/p&gt;
@@ -40096,7 +41655,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an
          &lt;code&gt;optgroup&lt;/code&gt; element, then pop that node from the &lt;a
          href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;. Otherwise, this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;, ignore the token.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;, ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;An end tag whose tag name is &quot;option&quot;
 
@@ -40104,7 +41663,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is an
          &lt;code&gt;option&lt;/code&gt; element, then pop that node from the &lt;a
          href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt;. Otherwise, this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;, ignore the token.&lt;/p&gt;
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;, ignore the token.&lt;/p&gt;
 
        &lt;dt&gt;An end tag whose tag name is &quot;select&quot;
 
@@ -40112,7 +41671,7 @@
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; does not &lt;a
          href=&quot;#have-an0&quot; title=&quot;has an element in table scope&quot;&gt;have an
          element in table scope&lt;/a&gt; with the same tag name as the token, this
-         is a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
+         is a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;. Ignore the token. (&lt;a
          href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -40125,14 +41684,14 @@
        &lt;dt&gt;A start tag whose tag name is &quot;select&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Act as if the token had been an
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Act as if the token had been an
          end tag with the tag name &quot;select&quot; instead.&lt;/p&gt;
 
        &lt;dt&gt;An end tag whose tag name is one of: &quot;caption&quot;, &quot;table&quot;, &quot;tbody&quot;,
         &quot;tfoot&quot;, &quot;thead&quot;, &quot;tr&quot;, &quot;td&quot;, &quot;th&quot;
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
         &lt;p&gt;If the &lt;a href=&quot;#stack&quot;&gt;stack of open elements&lt;/a&gt; &lt;a
          href=&quot;#have-an0&quot;&gt;has an element in table scope&lt;/a&gt; with the same tag
@@ -40143,7 +41702,7 @@
        &lt;dt&gt;Anything else
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
       &lt;/dl&gt;
 
      &lt;dt id=parsing-main-afterbody&gt;If the &lt;a href=&quot;#insertion0&quot;&gt;insertion
@@ -40177,7 +41736,7 @@
        &lt;dd&gt;
         &lt;p&gt;If the parser was originally created as part of the &lt;a
          href=&quot;#html-fragment0&quot;&gt;HTML fragment parsing algorithm&lt;/a&gt;, this is
-         a &lt;a href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;; ignore the token. (The element
+         a &lt;a href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;; ignore the token. (The element
          will be an &lt;code&gt;&lt;a href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element in this
          case.) (&lt;a href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
@@ -40187,7 +41746,7 @@
        &lt;dt&gt;Anything else
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Set the &lt;a
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Set the &lt;a
          href=&quot;#insertion0&quot;&gt;insertion mode&lt;/a&gt; to &quot;&lt;a href=&quot;#in-body&quot;
          title=&quot;insertion mode: in body&quot;&gt;in body&lt;/a&gt;&quot; and reprocess the
          token.&lt;/p&gt;
@@ -40228,7 +41787,7 @@
        &lt;dd&gt;
         &lt;p&gt;If the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; is the root &lt;code&gt;&lt;a
          href=&quot;#html&quot;&gt;html&lt;/a&gt;&lt;/code&gt; element, then this is a &lt;a
-         href=&quot;#parse&quot;&gt;parse error&lt;/a&gt;; ignore the token. (&lt;a
+         href=&quot;#parse0&quot;&gt;parse error&lt;/a&gt;; ignore the token. (&lt;a
          href=&quot;#fragment&quot;&gt;fragment case&lt;/a&gt;)&lt;/p&gt;
 
         &lt;p&gt;Otherwise, pop the &lt;a href=&quot;#current4&quot;&gt;current node&lt;/a&gt; from the
@@ -40259,7 +41818,7 @@
        &lt;dt&gt;Anything else
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
       &lt;/dl&gt;
 
      &lt;dt id=parsing-main-afterframeset&gt;If the &lt;a href=&quot;#insertion0&quot;&gt;insertion
@@ -40301,7 +41860,7 @@
        &lt;dt&gt;Anything else
 
        &lt;dd&gt;
-        &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+        &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
       &lt;/dl&gt;
     &lt;/dl&gt;
   &lt;/dl&gt;
@@ -40321,7 +41880,7 @@
    &lt;dt&gt;A DOCTYPE token
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Ignore the token.&lt;/p&gt;
 
    &lt;dt&gt;A comment token
 
@@ -40352,7 +41911,7 @@
    &lt;dt&gt;An end tag token
 
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=&quot;#parse&quot;&gt;Parse error&lt;/a&gt;. Switch back to &lt;a
+    &lt;p&gt;&lt;a href=&quot;#parse0&quot;&gt;Parse error&lt;/a&gt;. Switch back to &lt;a
      href=&quot;#the-main0&quot;&gt;the main phase&lt;/a&gt; and reprocess the token.&lt;/p&gt;
 
    &lt;dt&gt;An end-of-file token
@@ -40642,7 +42201,7 @@
    element's &lt;span title=syntax-start-tag&gt;start tag&lt;/span&gt; would imply the
    end tag for the &lt;code&gt;&lt;a href=&quot;#p&quot;&gt;p&lt;/a&gt;&lt;/code&gt;).
 
-  &lt;h3 id=parsing1&gt;&lt;span class=secno&gt;8.5. &lt;/span&gt;Parsing HTML fragments&lt;/h3&gt;
+  &lt;h3 id=parsing2&gt;&lt;span class=secno&gt;8.5. &lt;/span&gt;Parsing HTML fragments&lt;/h3&gt;
 
   &lt;p&gt;The following steps form the &lt;dfn id=html-fragment0&gt;HTML fragment
    parsing algorithm&lt;/dfn&gt;. The algorithm takes as input a DOM

Modified: source
===================================================================
--- source	2007-09-25 09:54:15 UTC (rev 1036)
+++ source	2007-10-08 19:28:51 UTC (rev 1037)
@@ -221,6 +221,12 @@
   specification. &lt;a href=&quot;#refsRFC2119&quot;&gt;[RFC2119]&lt;/a&gt;&lt;/p&gt;
   &lt;!-- XXX but they should be marked up --&gt;
 
+  &lt;p&gt;Requirements phrased in the imperative as part of algorithms
+  (such as &quot;strip any leading space characters&quot; or &quot;return false and
+  abort these steps&quot;) are to be interpreted with the meaning of the
+  key word (&quot;must&quot;, &quot;should&quot;, &quot;may&quot;, etc) used in introducing the
+  algorithm.&lt;/p&gt;
+
   &lt;p&gt;This specification describes the conformance criteria for user
   agents (relevant to implementors) and documents (relevant to
   authors and authoring tool implementors).&lt;/p&gt;
@@ -705,11 +711,10 @@
 
   &lt;p&gt;For readability, the term URI is used to refer to both ASCII URIs
   and Unicode IRIs, as those terms are defined by RFC 3986 and RFC
-  3987 respectively, and as modified by RFC 2732. On the rare
-  occasions where IRIs are not allowed but ASCII URIs are, this is
-  called out explicitly. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC2732&quot;&gt;[RFC2732]&lt;/a&gt;&lt;/p&gt;
+  3987 respectively. On the rare occasions where IRIs are not allowed
+  but ASCII URIs are, this is called out explicitly. &lt;a
+  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The term &lt;dfn&gt;root element&lt;/dfn&gt;, when not qualified to
   explicitly refer to the document's root element, means the furthest
@@ -1007,7 +1012,7 @@
   &lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt; object's &lt;span title=&quot;the document's
   address&quot;&gt;address&lt;/span&gt;&lt;!-- XXX xref --&gt; is hierarchical and uses a
   server-based naming authority, then its &lt;dfn title=&quot;document's
-  domain&quot;&gt;domain&lt;/dfn&gt; is the &lt;hostname&gt; part of that
+  domain&quot;&gt;domain&lt;/dfn&gt; is the &lt;host&gt;/&lt;ihost&gt; part of that
   address. Otherwise, it has no domain.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;The &lt;code title=&quot;dom-document-domain&quot;&gt;domain&lt;/code&gt;
@@ -1015,6 +1020,8 @@
   access each others' DOMs&lt;span class=&quot;big-issue&quot;&gt;, though this is not
   yet defined by this specification&lt;/span&gt;.&lt;/p&gt;&lt;!-- XXX xref --&gt;
 
+  &lt;p class=&quot;big-issue&quot;&gt;we should handle IP addresses here&lt;/p&gt;
+
   &lt;!--XXX
     <A HREF="http://lxr.mozilla.org/seamonkey/source/content/html/document/src/nsHTMLDocument.cpp">http://lxr.mozilla.org/seamonkey/source/content/html/document/src/nsHTMLDocument.cpp</A>
     search for ::GetDomain ::SetDomain
@@ -22265,6 +22272,8 @@
   &lt;p&gt;Access to certain APIs is granted or denied to scripts based on
   the &lt;dfn&gt;origin&lt;/dfn&gt; of the script and the API being accessed.&lt;/p&gt;
 
+  &lt;p&gt;The origin of a script depends on the context of that script:&lt;/p&gt;
+
   &lt;dl&gt;
 
    &lt;dt&gt;If a script is in a &lt;code&gt;script&lt;/code&gt; element&lt;/dt&gt;
@@ -22333,15 +22342,14 @@
   &lt;p&gt;The origin of a &lt;code&gt;Document&lt;/code&gt; or image that was served
   over the network and whose address uses a URI scheme with a
   server-based naming authority is the tuple consisting of the
-  &lt;scheme&gt;, &lt;host&gt;, and &lt;port&gt; parts of the
-  &lt;code&gt;Document&lt;/code&gt;'s full URI. &lt;a
+  &lt;scheme&gt;, &lt;host&gt;/&lt;ihost&gt;, and &lt;port&gt; parts
+  of the &lt;code&gt;Document&lt;/code&gt;'s full URI. &lt;a
   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC2732&quot;&gt;[RFC2732]&lt;/a&gt;&lt;/p&gt;
+  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The origin of a &lt;code&gt;Document&lt;/code&gt; or image that was generated
   from a &lt;code&gt;data:&lt;/code&gt; URI found in another &lt;code&gt;Document&lt;/code&gt;
-  or in a script is the origin of the that &lt;code&gt;Document&lt;/code&gt; or
+  or in a script is the origin of the &lt;code&gt;Document&lt;/code&gt; or
   script.&lt;/p&gt;
 
   &lt;p&gt;The origin of a &lt;code&gt;Document&lt;/code&gt; or image that was generated
@@ -22373,6 +22381,100 @@
   not to include the IP in the origin for a host?&lt;/p&gt;
 
 
+  &lt;h4&gt;Unscripted same-origin checks&lt;/h4&gt;
+
+  &lt;p&gt;When two URIs are to be compared to determine if they have the
+  &lt;dfn&gt;same scheme/host/port&lt;/dfn&gt;, it means that the following
+  algorithm must be invoked, where &lt;var title=&quot;&quot;&gt;uri&lt;sub
+  title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;uri&lt;sub
+  title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; are the two URIs.&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;First, both &lt;var title=&quot;&quot;&gt;uri&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; and
+    &lt;var title=&quot;&quot;&gt;uri&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; must be normalized to
+    obtain the two tuples (&lt;var title=&quot;&quot;&gt;scheme&lt;sub
+    title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;host&lt;sub
+    title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;sub
+    title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;) and (&lt;var title=&quot;&quot;&gt;scheme&lt;sub
+    title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;host&lt;sub
+    title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;sub
+    title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;), by applying the following subalgorithm to
+    each URI:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; be the URI being normalized.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; according to the rules
+     described in RFC 3986 and RFC 3987. &lt;a
+     href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+     href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; does not use a server-based
+     naming authority, then fail the overall algorithm &mdash; the two
+     URIs do not have the same scheme/host/port.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;scheme&gt;
+     component of the URI. If the UA doesn't support the given
+     protocol, then fail the overall algorithm &mdash; the two URIs do
+     not have the same scheme/host/port&lt;!-- (this should not be
+     possible, since this algorithm is only invoked with URIs that
+     have been actually fetched) --&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the
+     &lt;host&gt;/&lt;ihost&gt; component of the URI.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Apply the IDNA ToASCII algorithm to &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;,
+      with both the AllowUnassigned and UseSTD3ASCIIRules flags
+      set. Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the result of the ToASCII
+      algorithm.&lt;/p&gt;
+
+      &lt;p&gt;If ToASCII fails to convert one of the components of the
+      string, e.g. because it is too long or because it contains
+      invalid characters, then fail the overall algorithm &mdash; the
+      two URIs do not have the same scheme/host/port. &lt;a
+      href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If no port is explicitly listed, then let &lt;var
+     title=&quot;&quot;&gt;port&lt;/var&gt; be the default port for the protocol given by
+     &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt;. Otherwise, let &lt;var
+     title=&quot;&quot;&gt;port&lt;/var&gt; be the &lt;port&gt; component of the
+     URI.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Return the tuple (&lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt;, &lt;var
+     title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;scheme&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; is not
+   case-insensitively&lt;!-- XXX ascii case matching --&gt; identical to
+   &lt;var title=&quot;&quot;&gt;scheme&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, or if &lt;var
+   title=&quot;&quot;&gt;host&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; is not
+   case-insensitively&lt;!-- XXX ascii case matching --&gt; identical to
+   &lt;var title=&quot;&quot;&gt;host&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, or if &lt;var
+   title=&quot;&quot;&gt;port&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; is not identical to &lt;var
+   title=&quot;&quot;&gt;port&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, then fail the overall
+   algorithm &mdash; the two URIs do not have the same
+   scheme/host/port.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Otherwise, the two URIs do have the same
+   scheme/host/port.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  
+
+
+
   &lt;h4&gt;Security exceptions&lt;/h4&gt;
 
   &lt;p class=&quot;big-issue&quot;&gt;Define &lt;dfn&gt;security exception&lt;/dfn&gt;.&lt;/p&gt;
@@ -22523,6 +22625,7 @@
   as DOM attributes:&lt;/p&gt;
 
   &lt;dl&gt;
+   &lt;!-- XXX should change 'the element' below to 'the object' or something --&gt;
 
    &lt;dt&gt;&lt;dfn title=&quot;handler-onabort&quot;&gt;&lt;code&gt;onabort&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
 
@@ -23025,33 +23128,6 @@
 &lt;!-- XXX there are other attributes! --&gt;};&lt;/pre&gt;
 &lt;!-- also, see window.external.AddSearchProvider() and similar DOM APIs from IE --&gt;
 
-  &lt;h4 id=&quot;offline&quot;&gt;Offline Web applications&lt;/h4&gt;
-
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-navigator-onLine&quot;&gt;&lt;code&gt;navigator.onLine&lt;/code&gt;&lt;/dfn&gt;
-  attribute must return false if the user agent will not contact the
-  network when the user follows links or when a script requests a
-  remote page (or knows that such an attempt would fail), and must
-  return true otherwise.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn title=&quot;event-offline&quot;&gt;&lt;code&gt;offline&lt;/code&gt;&lt;/dfn&gt; event
-  must be fired when the value of the &lt;code
-  title=&quot;dom-navigator-onLine&quot;&gt;navigator.onLine&lt;/code&gt; attribute of
-  the &lt;code&gt;Window&lt;/code&gt; changes from true to false.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn title=&quot;event-online&quot;&gt;&lt;code&gt;online&lt;/code&gt;&lt;/dfn&gt; event
-  must be fired when the value of the &lt;code
-  title=&quot;dom-navigator-onLine&quot;&gt;navigator.onLine&lt;/code&gt; attribute of
-  the &lt;code&gt;Window&lt;/code&gt; changes from false to true.&lt;/p&gt;
-
-  &lt;p&gt;These events are in no namespace, do bubble, are not cancelable,
-  have no default action, and use the normal &lt;code&gt;Event&lt;/code&gt;
-  interface. They must be fired on &lt;span&gt;the body element&lt;/span&gt;. (As
-  the events bubble, they will reach the &lt;code&gt;Window&lt;/code&gt;
-  object.)&lt;/p&gt;
-
-  &lt;!-- XXX ononline onoffline need to be defined --&gt;
-
   &lt;h4 id=&quot;custom-handlers&quot;&gt;Custom protocol and content handlers&lt;/h4&gt;
 
   &lt;p&gt;The &lt;dfn
@@ -23201,10 +23277,10 @@
   arguments in an ECMAScript implementation).&lt;/p&gt;
 
   &lt;p&gt;This section does not define how the pages registered by these
-  methods are used, beyond the requirements on how to process the
-  &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; value (see above). To some extent, the &lt;span
-  title=&quot;navigating across documents&quot;&gt;processing model for navigating
-  across documents&lt;/span&gt; defines some cases where these methods are
+  methods are used, beyond the requirements on how to process the &lt;var
+  title=&quot;&quot;&gt;uri&lt;/var&gt; value (see above). To some extent, the &lt;span
+  title=&quot;navigate&quot;&gt;processing model for navigating across
+  documents&lt;/span&gt; defines some cases where these methods are
   relevant, but in general UAs may use this information wherever they
   would otherwise consider handing content to native plugins or helper
   applications.&lt;/p&gt;
@@ -23383,6 +23459,1372 @@
 
 
 
+
+  &lt;h3 id=&quot;offline&quot;&gt;Offline Web applications&lt;/h3&gt;
+
+  &lt;h4&gt;Introduction&lt;/h4&gt;
+
+  &lt;p class=&quot;big-issue&quot;&gt;...&lt;/p&gt;
+
+
+  &lt;h4 id=&quot;appcache&quot;&gt;Application caches&lt;/h4&gt;
+
+  &lt;p&gt;An &lt;dfn&gt;application cache&lt;/dfn&gt; is a collection of resources. An
+  application cache is identified by the URI of a resource
+  manifest which is used to populate the cache.&lt;/p&gt;
+
+  &lt;p&gt;Application caches are versioned, and there can be different
+  instances of caches for the same manifest URI, each having a
+  different version.&lt;/p&gt;
+
+  &lt;p&gt;Each group of application caches for the same manifest URI have a
+  common &lt;dfn title=&quot;concept-appcache-status&quot;&gt;update status&lt;/dfn&gt;,
+  which is one of the following: &lt;i&gt;idle&lt;/i&gt;, &lt;i&gt;checking&lt;/i&gt;,
+  &lt;i&gt;downloading&lt;/i&gt;, &lt;i&gt;update ready&lt;/i&gt;.&lt;/p&gt;
+
+  &lt;p id=&quot;#appcache-history-1&quot;&gt;A &lt;span&gt;browsing context&lt;/span&gt; can be
+  associated with an application cache. A &lt;span&gt;child browsing
+  context&lt;/span&gt; is always associated with the same browsing context
+  as its &lt;span&gt;parent browsing context&lt;/span&gt;, if any. A
+  &lt;span&gt;top-level browsing context&lt;/span&gt; is associated with the
+  application cache appropriate for its &lt;span&gt;active
+  document&lt;/span&gt;. (A browsing context's associated cache thus can &lt;a
+  href=&quot;#appcache-history-2&quot;&gt;change&lt;/a&gt; during &lt;span title=&quot;traverse
+  the history&quot;&gt;session history traversal&lt;/span&gt;.)&lt;/p&gt;
+
+  &lt;p&gt;A &lt;code&gt;Document&lt;/code&gt; initially has no appropriate cache, but
+  steps &lt;a href=&quot;#parser-appcache&quot;&gt;in the parser&lt;/a&gt; and in the &lt;span
+  title=&quot;navigate&quot;&gt;navigation&lt;/span&gt; sections cause &lt;span
+  title=&quot;concept-appcache-init-with-attribute&quot;&gt;cache selection&lt;/span&gt;
+  to occur early in the page load process.&lt;/p&gt;
+
+  &lt;p&gt;An application cache consists of:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;One of more resources (including their out-of-band metadata,
+    such as HTTP headers, if any), identified by URIs, each falling
+    into one (or more) of the following categories:&lt;/p&gt;
+
+    &lt;dl&gt;
+ 
+     &lt;dt&gt;&lt;dfn title=&quot;concept-appcache-implicit&quot;&gt;Implicit entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources that were added to the cache because a
+     &lt;span&gt;top-level browsing context&lt;/span&gt; was &lt;span
+     title=&quot;navigate&quot;&gt;navigated&lt;/span&gt; to that document and the
+     document indicated that this was its cache, using the &lt;code
+     title=&quot;attr-html-application&quot;&gt;application&lt;/code&gt; attribute.
+
+ 
+     &lt;dt&gt;&lt;dfn title=&quot;concept-appcache-manifest&quot;&gt;The manifest&lt;/dfn&gt;
+
+     &lt;dd&gt;The resource corresponding to the URI that was given in an
+     implicit entry's &lt;code&gt;html&lt;/code&gt; element's &lt;code
+     title=&quot;attr-html-application&quot;&gt;application&lt;/code&gt; attribute. The
+     manifest is downloaded and processed during the &lt;span&gt;application
+     cache update process&lt;/span&gt;. All the &lt;span
+     title=&quot;concept-appcache-implicit&quot;&gt;implicit entries&lt;/span&gt; have
+     the &lt;span&gt;same scheme/host/port&lt;/span&gt; as the manifest.
+
+ 
+     &lt;dt&gt;&lt;dfn title=&quot;concept-appcache-explicit&quot;&gt;Explicit entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources that were listed in the cache's &lt;span
+     title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;. Explicit
+     entries can also be marked as &lt;dfn
+     title=&quot;concept-appcache-foreign&quot;&gt;foreign&lt;/dfn&gt;, which means that they
+     have an &lt;code title=&quot;attr-html-application&quot;&gt;application&lt;/code&gt;
+     attribute but that it doesn't point at this cache's &lt;span
+     title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;.
+
+ 
+     &lt;dt&gt;&lt;dfn title=&quot;concept-appcache-fallback&quot;&gt;Fallback entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources that were listed in the cache's &lt;span
+     title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt; as fallback
+     entries.
+
+ 
+     &lt;dt&gt;&lt;dfn title=&quot;concept-appcache-oppcache&quot;&gt;Opportunistically cached entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources whose URIs &lt;span
+     title=&quot;concept-appcache-matches-oppcache&quot;&gt;matched&lt;/span&gt; an &lt;span
+     title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+     namespace&lt;/span&gt; when they were fetched, and were therefore
+     cached in the application cache.
+
+ 
+     &lt;dt&gt;&lt;dfn title=&quot;concept-appcache-dynamic&quot;&gt;Dynamic entries&lt;/dfn&gt;
+
+     &lt;dd&gt;Resources that were added to the cache by the &lt;code
+     title=&quot;dom-appcache-add&quot;&gt;add()&lt;/code&gt; method.
+
+    &lt;/dl&gt;
+
+   &lt;li&gt;Zero or more &lt;dfn
+   title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+   namespaces&lt;/dfn&gt;: URIs, used as &lt;span
+   title=&quot;concept-appcache-matches-oppcache&quot;&gt;prefix match
+   patterns&lt;/span&gt;, each of which is mapped to a &lt;span
+   title=&quot;concept-appcache-fallback&quot;&gt;fallback entry&lt;/span&gt;. Each
+   namespace URI prefix, when parsed as a URI, has the &lt;span&gt;same
+   scheme/host/port&lt;/span&gt; as &lt;span
+   title=&quot;concept-appcache-manifest&quot;&gt;the manifest&lt;/span&gt;.&lt;/li&gt;
+
+   &lt;li&gt;Zero or more URIs that form the &lt;dfn
+   title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/dfn&gt;.
+
+  &lt;/ul&gt;
+
+  &lt;p&gt;Multiple application caches can contain the same resource,
+  e.g. if their manifests all reference that resource. If the user
+  agent is to &lt;dfn title=&quot;concept-appcache-selection&quot;&gt;select an
+  application cache&lt;/dfn&gt; from a list of caches that contain a
+  resource, that the user agent must use the application cache that
+  the user most likely wants to see the resource from, taking into
+  account the following:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;which application cache was most recently updated,
+
+   &lt;li&gt;which application cache was being used to display the
+   resource from which the user decided to look at the new resource,
+   and
+
+   &lt;li&gt;which application cache the user prefers.&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+
+  &lt;h4 id=&quot;manifests&quot;&gt;The cache manifest syntax&lt;/h4&gt;
+
+  &lt;h5&gt;Writing cache manifests&lt;/h5&gt;
+
+  &lt;p&gt;Manifests must be served using the &lt;code
+  title=&quot;&quot;&gt;text/cache-manifest&lt;/code&gt; MIME type. All resources served
+  using the &lt;code title=&quot;&quot;&gt;text/cache-manifest&lt;/code&gt; MIME type must
+  follow the syntax of application cache manifests, as described in
+  this section.&lt;/p&gt;
+
+  &lt;p&gt;An application cache manifest is a text file, whose text is
+  encoded using UTF-8. Data in application cache manifests is
+  line-based. Newlines must be represented by U+000A LINE FEED (LF)
+  characters, U+000D CARRIAGE RETURN (CR) characters, or U+000D
+  CARRIAGE RETURN (CR) U+000A LINE FEED (LF) pairs.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;This is a willful double violation of RFC2046.&lt;/p&gt;
+
+  &lt;p&gt;The first line of an application cache manifest must consist of
+  the string &quot;CACHE&quot;, a single U+0020 SPACE character, the string
+  &quot;MANIFEST&quot;, and zero or more U+0020 SPACE and U+0009 CHARACTER
+  TABULATION (tab) characters. If any other text is found on the first
+  line, the user agent will ignore the entire file. The first line may
+  optionally be preceded by a U+FEFF BYTE ORDER MARK (BOM)
+  character.&lt;/p&gt;
+
+  &lt;p&gt;Subsequent lines, if any, must all be one of the following:&lt;/p&gt;
+
+  &lt;dl&gt;
+   &lt;dt&gt;A blank line
+   &lt;dd&gt;
+    &lt;p&gt;Blank lines must consist of zero or more U+0020 SPACE and
+    U+0009 CHARACTER TABULATION (tab) characters only.&lt;/p&gt;
+
+   &lt;dt&gt;A comment
+   &lt;dd&gt;
+    &lt;p&gt;Comment lines must consist of zero or more U+0020 SPACE and
+    U+0009 CHARACTER TABULATION (tab) characters, followed by a single
+    U+0023 NUMBER SIGN (#) character, followed by zero or more
+    characters other than U+000A LINE FEED (LF) and U+000D CARRIAGE
+    RETURN (CR) characters.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;Comments must be on a line on their own. If they
+    were to be included on a line with a URI, the &quot;#&quot; would be
+    mistaken for part of a fragment identifier.&lt;/p&gt;
+
+   &lt;dt&gt;A section header
+   &lt;dd&gt;
+    &lt;p&gt;Section headers change the current section. There are three
+    possible section headers:
+
+    &lt;dl&gt;
+
+     &lt;dt&gt;&lt;code&gt;CACHE:&lt;/code&gt;
+     &lt;dd&gt;Switches to the explicit section.
+
+     &lt;dt&gt;&lt;code&gt;FALLBACK:&lt;/code&gt;
+     &lt;dd&gt;Switches to the fallback section.
+
+     &lt;dt&gt;&lt;code&gt;NETWORK:&lt;/code&gt;
+     &lt;dd&gt;Switches to the online whitelist section.
+
+    &lt;/dl&gt;
+
+    &lt;p&gt;Section header lines must consist of zero or more U+0020 SPACE
+    and U+0009 CHARACTER TABULATION (tab) characters, followed by one
+    of the names above (including the U+003A COLON (:) character)
+    followed by zero or more U+0020 SPACE and U+0009 CHARACTER
+    TABULATION (tab) characters.&lt;/p&gt;
+
+    &lt;p&gt;Ironically, by default, the current section is the explicit
+    section.&lt;/p&gt;
+
+   &lt;dt&gt;Data for the current section
+   &lt;dd&gt;
+    &lt;p&gt;The format that data lines must take depends on the current
+    section.&lt;/p&gt;
+
+    &lt;p&gt;When the current section is the explicit section or the online
+    whitelist section, data lines must consist of zero or more U+0020
+    SPACE and U+0009 CHARACTER TABULATION (tab) characters, a valid
+    URI reference or IRI reference, and then zero or more U+0020 SPACE
+    and U+0009 CHARACTER TABULATION (tab) characters. &lt;a
+    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p&gt;When the current section is the fallback section, data lines
+    must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
+    TABULATION (tab) characters, a valid URI reference or IRI
+    reference, one or more U+0020 SPACE and U+0009 CHARACTER
+    TABULATION (tab) characters, another valid URI reference or IRI
+    reference, and then zero or more U+0020 SPACE and U+0009 CHARACTER
+    TABULATION (tab) characters. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
+    &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;/dl&gt;
+
+  &lt;p&gt;Manifests may contain sections more than once. Sections may be
+  empty.&lt;/p&gt;
+
+  &lt;p&gt;Manifests must specify all the URIs that are to be cached. URIs
+  that are to be fallback pages associated with &lt;span
+  title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+  namespaces&lt;/span&gt;, and those namespaces themselves, must be given in
+  fallback sections, with the namespace being the first URI of the
+  data line, and the corresponding fallback page being the second
+  URI. All the other pages to be cached must be listed in explicit
+  sections.&lt;/p&gt;
+
+  &lt;p&gt;Relative URIs must be given relative to the manifest's own
+  URI.&lt;/p&gt;
+
+  &lt;p&gt;URIs in manifests must not have fragment identifiers.&lt;/p&gt;
+
+  &lt;p&gt;&lt;span title=&quot;concept-appcache-oppcache-ns&quot;&gt;Opportunistic caching
+  namespaces&lt;/span&gt; must have the &lt;span&gt;same scheme/host/port&lt;/span&gt;
+  as the manifest itself.&lt;/p&gt;
+
+  &lt;p&gt;An opportunistic caching namespace must not be listed more than
+  once.&lt;/p&gt;
+
+  &lt;p&gt;URIs that the user agent is to put into the &lt;span
+  title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/span&gt;
+  must all be specified in online whitelist sections. (This is needed
+  for any URI that the page is intending to use to communicate back to
+  the server.)&lt;/p&gt;
+
+  &lt;p&gt;URIs in the online whitelist section must not also be listed in
+  explicit section, and must not be listed as fallback entries in the
+  fallback section. (URIs in the online whitelist section may match
+  opportunistic caching namespaces, however.)&lt;/p&gt;
+
+
+  &lt;h5&gt;Parsing cache manifests&lt;/h5&gt;
+
+  &lt;p&gt;When a user agent is to &lt;dfn&gt;parse a manifest&lt;/dfn&gt;, it means
+  that the user agent must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+   
+   &lt;li&gt;&lt;p&gt;The user agent must decode the bytestream corresponding with
+   the manifest to be parsed, treating it as UTF-8. Bytes or sequences
+   of bytes that are not valid UTF-8 sequences must be interpreted as
+   a U+FFFD REPLACEMENT CHARACTER. All U+0000 NULL characters must be
+   replaced by U+FFFD REPLACEMENT CHARACTERs.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt; be an initially empty
+   list of &lt;span title=&quot;concept-appcache-explicit&quot;&gt;explicit
+   entries&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; be an initially empty
+   mapping of &lt;span title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic
+   caching namespaces&lt;/span&gt; to &lt;span
+   title=&quot;concept-appcache-fallback&quot;&gt;fallback entries&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;online whitelist URIs&lt;/var&gt; be an
+   initially empty list of URIs for a &lt;span
+   title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online
+   whitelist&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; be the decoded text of the
+   manifest's bytestream.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; be a pointer into &lt;var
+   title=&quot;&quot;&gt;input&lt;/var&gt;, initially pointing at the first
+   character.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is pointing at a U+FEFF BYTE
+   ORDER MARK (BOM) character, then advance &lt;var
+   title=&quot;&quot;&gt;position&lt;/var&gt; to the next character.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the characters starting from &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;
+   are &quot;CACHE&quot;, followed by a U+0020 SPACE character, followed by
+   &quot;MANIFEST&quot;, then advance &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; to the next
+   character after those. Otherwise, this isn't a cache manifest;
+   abort this algorithm with a failure while checking for the magic
+   signature.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is not past the end of &lt;var
+   title=&quot;&quot;&gt;input&lt;/var&gt; and the character at &lt;var
+   title=&quot;&quot;&gt;position&lt;/var&gt; is neither a U+000A LINE FEED (LF)
+   characters nor a U+000D CARRIAGE RETURN (CR) character, then this
+   isn't a cache manifest; abort this algorithm with a failure while
+   checking for the magic signature.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;This is a cache manifest. The algorithm cannot fail beyond
+   this point (though bogus lines can get ignored).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &quot;explicit&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;em&gt;Start of line&lt;/em&gt;: If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is
+   past the end of &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, then jump to the last
+   step. Otherwise, &lt;span&gt;collect a sequence of characters&lt;/span&gt; that
+   are U+000A LINE FEED (LF), U+000D CARRIAGE RETURN (CR), U+0020
+   SPACE, or U+0009 CHARACTER TABULATION (tab) characters.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Now, &lt;span&gt;collect a sequence of characters&lt;/span&gt; that are
+   &lt;em&gt;not&lt;/em&gt; U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR)
+   characters, and let the result be &lt;var
+   title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the first character in &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is a
+   U+0023 NUMBER SIGN (#) character, then jump back to the step
+   labelled &quot;start of line&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Drop any trailing U+0020 SPACE, or U+0009 CHARACTER
+   TABULATION (tab) characters at the end of &lt;var
+   title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;CACHE:&quot; (the word
+   &quot;CACHE&quot; followed by a U+003A COLON (:) character), then set &lt;var
+   title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;explicit&quot; and jump back to the step
+   labelled &quot;start of line&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;FALLBACK:&quot; (the word
+   &quot;FALLBACK&quot; followed by a U+003A COLON (:) character), then set &lt;var
+   title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;fallback&quot; and jump back to the step
+   labelled &quot;start of line&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;NETWORK:&quot; (the word
+   &quot;NETWORK&quot; followed by a U+003A COLON (:) character), then set &lt;var
+   title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;online whitelist&quot; and jump back to the step
+   labelled &quot;start of line&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;This is either a data line or it is syntactically incorrect.&lt;/p&gt;
+
+    &lt;dl class=&quot;switch&quot;&gt;
+
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;explicit&quot;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is not a syntactically valid URI
+      reference or IRI reference, then jump back to the step labelled
+      &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, resolve the URI reference or IRI reference to an
+      absolute URI or IRI, drop any fragment identifier, and add this
+      URI to the &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;fallback&quot;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; does not contain at least one
+      U+0020 SPACE or U+0009 CHARACTER TABULATION (tab) character,
+      then jump back to the step labelled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, let everything before the first U+0020 SPACE or
+      U+0009 CHARACTER TABULATION (tab) character in &lt;var
+      title=&quot;&quot;&gt;line&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt;, and let
+      everything after the first U+0020 SPACE or U+0009 CHARACTER
+      TABULATION (tab) character in &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; be &lt;var
+      title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Strip any leading U+0020 SPACE or U+0009 CHARACTER TABULATION
+      (tab) characters in &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part
+      two&lt;/var&gt; are not both syntactically valid URI or IRI
+      references, then jump back to the step labelled &quot;start of
+      line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Resolve the URI or IRI references in &lt;var title=&quot;&quot;&gt;part
+      one&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; to absolute URIs or
+      IRIs.&lt;/p&gt;
+
+      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var
+      title=&quot;&quot;&gt;part one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback
+      URIs&lt;/var&gt; mapping as an &lt;span
+      title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+      namespaces&lt;/span&gt;, then jump back to the step labelled &quot;start of
+      line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;If the absolute URI or IRI corresponding to &lt;var
+      title=&quot;&quot;&gt;part one&lt;/var&gt; does not have the &lt;span&gt;same
+      scheme/host/port&lt;/span&gt; as the manifest's URI, then jump back to
+      the step labelled &quot;start of line&quot;.&lt;/p&gt; &lt;!-- SECURITY --&gt;
+
+      &lt;p&gt;Otherwise, add the absolute URI or IRI corresponding to &lt;var
+      title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;fallback URIs&lt;/var&gt;
+      mapping as an &lt;span
+      title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+      namespaces&lt;/span&gt;, mapped to the absolute URI corresponding to
+      &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;span
+      title=&quot;concept-appcache-fallback&quot;&gt;fallback entry&lt;/span&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;online whitelist&quot;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; is not a syntactically valid URI
+      reference or IRI reference, then jump back to the step labelled
+      &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, resolve the URI reference or IRI reference to an
+      absolute URI or IRI, drop any fragment identifier, and add this
+      URI to the &lt;var title=&quot;&quot;&gt;online whitelist URIs&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Jump back to the step labelled &quot;start of line&quot;. (That step
+   jumps to the next, and last, step when the end of the file is
+   reached.)&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URIs&lt;/var&gt; list, the &lt;var
+   title=&quot;&quot;&gt;fallback URIs&lt;/var&gt; mapping, and the &lt;var title=&quot;&quot;&gt;online
+   URIs&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;Relative URI references and IRI references resolved to absolute
+  URIs or IRIs in the above algorithm must use the manifest's URI as
+  the Base URI from the Retrieval URI for the purposes reference
+  resolution as defined by RFC 3986. &lt;a
+  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+
+
+  &lt;h4&gt;Updating an application cache&lt;/h4&gt;
+
+  &lt;p&gt;When the user agent is required (by other parts of this
+  specification) to start the &lt;dfn&gt;application cache update
+  process&lt;/dfn&gt;, the user agent must run the following steps:&lt;/p&gt;
+
+  &lt;p class=&quot;big-issue&quot;&gt;the event stuff needs to be more consistent --
+  something about showing every step of the ui or no steps or
+  something; and we need to deal with showing ui for browsing contexts
+  that open when an update is already in progress, and we may need to
+  give applications control over the ui the first time they cache
+  themselves (right now the original cache is done without
+  notifications to the browsing contexts)&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt; be the URI of the &lt;span
+   title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt; of the cache to
+   be updated.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; be the group of &lt;span
+   title=&quot;application cache&quot;&gt;application caches&lt;/span&gt; identified by
+   &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; be the most recently updated
+   &lt;span&gt;application cache&lt;/span&gt; identified by &lt;var title=&quot;&quot;&gt;manifest
+   URI&lt;/var&gt; (that is, the newest version found in &lt;var title=&quot;&quot;&gt;cache
+   group&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt;
+   of the &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; is either &lt;i&gt;checking&lt;/i&gt; or
+   &lt;i&gt;downloading&lt;/i&gt;, then abort these steps, as an update is already
+   in progress for them. Otherwise, set the &lt;span title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt; of this group of
+   caches to &lt;i&gt;checking&lt;/i&gt;. This entire step must be performed as
+   one atomic operation so as to avoid race conditions.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there is already a resource with the URI of &lt;var
+    title=&quot;&quot;&gt;manifest URI&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, and
+    that resource is categorised as a &lt;span
+    title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;, then this is an
+    &lt;dfn title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
+    attempt&lt;/dfn&gt;. Otherwise, this is a &lt;dfn
+    title=&quot;concept-appcache-cache&quot;&gt;cache attempt&lt;/dfn&gt;.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;If this is a &lt;span
+    title=&quot;concept-appcache-cache&quot;&gt;cache attempt&lt;/span&gt;, then &lt;var
+    title=&quot;&quot;&gt;cache&lt;/var&gt; is forcibly the only application cache in
+    &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;, and it hasn't ever been populated
+    from its manifest (i.e. this update is an attempt to download the
+    application for the first time). It also can't have any browsing
+    contexts associated with it.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; called &lt;code
+    title=&quot;event-checking&quot;&gt;checking&lt;/code&gt; at the
+    &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of each &lt;span&gt;top-level
+    browsing context&lt;/span&gt; that is associated with a cache in &lt;var
+    title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of this event
+    should be the display of some sort of user interface indicating to
+    the user that the user agent is checking for the availability of
+    updates.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Fetch the resource from &lt;var title=&quot;&quot;&gt;manifest URI&lt;/var&gt;, and
+    let &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; be that resource.&lt;/p&gt;
+
+    &lt;p&gt;If the resource is labelled with the MIME type &lt;code
+    title=&quot;&quot;&gt;text/cache-manifest&lt;/code&gt;, parse &lt;var
+    title=&quot;&quot;&gt;manifest&lt;/var&gt; according to the &lt;span title=&quot;parse a
+    manifest&quot;&gt;rules for parsing manifests&lt;/span&gt;, obtaining a list of
+    &lt;span title=&quot;concept-appcache-explicit&quot;&gt;explicit entries&lt;/span&gt;,
+    &lt;span title=&quot;concept-appcache-fallback&quot;&gt;fallback entries&lt;/span&gt;
+    and the &lt;span title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic
+    caching namespaces&lt;/span&gt; that map to them, and entries for the
+    &lt;span title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online
+    whitelist&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If the previous step fails (e.g. the server returns a 4xx or
+    5xx response or equivalent, or there is a DNS error, or the
+    connection times out, or the parser for manifests fails when
+    checking the magic signature), or if the resource is labelled with
+    a MIME type other than &lt;code title=&quot;&quot;&gt;text/cache-manifest&lt;/code&gt;,
+    then run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; called &lt;code
+     title=&quot;event-error&quot;&gt;error&lt;/code&gt; at the
+     &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of each &lt;span&gt;top-level
+     browsing context&lt;/span&gt; that is associated with a cache in &lt;var
+     title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of this event
+     should be the display of some sort of user interface indicating
+     to the user that the user agent failed to save the application
+     for offline use.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If this is a &lt;span title=&quot;concept-appcache-cache&quot;&gt;cache
+     attempt&lt;/span&gt;, then discard &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; and abort
+     the update process, optionally alerting the user to the
+     failure.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, jump to the last step in the overall set of
+     steps of the update process.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If this is an &lt;span title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
+   attempt&lt;/span&gt; and the newly downloaded &lt;var
+   title=&quot;&quot;&gt;manifest&lt;/var&gt; is byte-for-byte identical to the manifest
+   found in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, or if the server reported it as
+   &quot;304 Not Modified&quot; or equivalent, then &lt;span&gt;fire a simple
+   event&lt;/span&gt; called &lt;code title=&quot;event-noupdate&quot;&gt;noupdate&lt;/code&gt; at
+   the &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of each &lt;span&gt;top-level
+   browsing context&lt;/span&gt; that is associated with a cache in &lt;var
+   title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of this event should
+   be the display of some sort of user interface indicating to the
+   user that the application is up to date. Then, jump to the last
+   step of the update process.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set the &lt;span title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; to
+   &lt;i&gt;downloading&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; called &lt;code
+   title=&quot;event-downloading&quot;&gt;downloading&lt;/code&gt; at the
+   &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of each &lt;span&gt;top-level
+   browsing context&lt;/span&gt; that is associated with a cache in &lt;var
+   title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of this event should
+   be the display of some sort of user interface indicating to the
+   user that a new version is being downloaded.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If this is an &lt;span title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
+   attempt&lt;/span&gt;, then let &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt; be a newly
+   created &lt;span&gt;application cache&lt;/span&gt; identified by &lt;span
+   title=&quot;&quot;&gt;manifest URI&lt;/span&gt;, being a new version in &lt;var
+   title=&quot;&quot;&gt;cache group&lt;/var&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;new
+   cache&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; be the same version of
+   the application cache.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; be an empty list of
+   URIs with flags.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Add all the URIs in the list of &lt;span
+   title=&quot;concept-appcache-explicit&quot;&gt;explicit entries&lt;/span&gt; obtained
+   by parsing &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file
+   list&lt;/var&gt;, each flagged with &quot;explicit entry&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Add all the URIs in the list of &lt;span
+   title=&quot;concept-appcache-fallback&quot;&gt;fallback entries&lt;/span&gt; obtained
+   by parsing &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file
+   list&lt;/var&gt;, each flagged with &quot;fallback entry&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If this is an &lt;span title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
+   attempt&lt;/span&gt;, then add all the URIs of &lt;span
+   title=&quot;concept-appcache-oppcache&quot;&gt;opportunistically cached
+   entries&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; that &lt;span
+   title=&quot;concept-appcache-matches-oppcache&quot;&gt;match&lt;/span&gt; the &lt;span
+   title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+   namespaces&lt;/span&gt; obtained by parsing &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt;
+   to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each flagged with &quot;opportunistic
+   entry&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If this is an &lt;span title=&quot;concept-appcache-upgrade&quot;&gt;upgrade
+   attempt&lt;/span&gt;, then add all the URIs of &lt;span
+   title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entries&lt;/dfn&gt; in &lt;var
+   title=&quot;&quot;&gt;cache&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, each flagged
+   with &quot;dynamic entry&quot;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If any URI is in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt; more than
+   once, then merge the entries into one entry for that URI, that
+   entry having all the flags that the original entries had.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each URI in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, run the
+    following steps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; called &lt;code
+     title=&quot;event-progress&quot;&gt;progress&lt;/code&gt; at the
+     &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of each &lt;span&gt;top-level
+     browsing context&lt;/span&gt; that is associated with a cache in &lt;var
+     title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of this event
+     should be the display of some sort of user interface indicating
+     to the user that a file is being downloaded in preparation for
+     updating the application.&lt;/p&gt;&lt;/li&gt; &lt;!-- XXX need to include
+     progress information --&gt;
+
+     &lt;li&gt;&lt;p&gt;Fetch the resource. If this is an &lt;span
+     title=&quot;concept-appcache-upgrade&quot;&gt;upgrade attempt&lt;/span&gt;, then use
+     &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; as an HTTP cache, and honour HTTP
+     caching semantics (such as expiration, ETags, and so forth) with
+     respect to that cache. User agents may also have other caches in
+     place.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the previous steps fails (e.g. the server returns a 4xx or
+      5xx response or equivalent, or there is a DNS error, or the
+      connection times out), then run these substeps:&lt;/p&gt;
+
+      &lt;ol&gt;
+
+       &lt;li&gt;&lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; called &lt;code
+       title=&quot;event-error&quot;&gt;error&lt;/code&gt; at the
+       &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of each &lt;span&gt;top-level
+       browsing context&lt;/span&gt; that is associated with a cache in &lt;var
+       title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of this event
+       should be the display of some sort of user interface indicating
+       to the user that the user agent failed to save the application
+       for offline use.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;If this is a &lt;span title=&quot;concept-appcache-cache&quot;&gt;cache
+       attempt&lt;/span&gt;, then discard &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; and
+       abort the update process, optionally alerting the user to the
+       failure.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;Otherwise, jump to the last step in the overall set of
+       steps of the update process.&lt;/p&gt;&lt;/li&gt;
+
+      &lt;/ol&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, the fetching succeeded. Store the resource in
+     the &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as an &quot;explicit
+     entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorise the
+     entry as an &lt;span title=&quot;concept-appcache-explicit&quot;&gt;explicit
+     entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as a &quot;fallback
+     entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorise the
+     entry as a &lt;span title=&quot;concept-appcache-fallback&quot;&gt;fallback
+     entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as a &quot;opportunistic
+     entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorise the
+     entry as an &lt;span
+     title=&quot;concept-appcache-oppcache&quot;&gt;opportunistically cached
+     entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the URI being processed was flagged as an &quot;dynamic
+     entry&quot; in &lt;var title=&quot;&quot;&gt;file list&lt;/var&gt;, then categorise the
+     entry as a &lt;span title=&quot;concept-appcache-dynamic&quot;&gt;dynamic
+     entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Store &lt;var title=&quot;&quot;&gt;manifest&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;new
+   cache&lt;/var&gt;, if it's not there already, and categorise this entry
+   (whether newly added or not) as &lt;span
+   title=&quot;concept-appcache-manifest&quot;&gt;the manifest&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Store the list of &lt;span
+   title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+   namespaces&lt;/span&gt;, and the URIs of the &lt;span
+   title=&quot;concept-appcache-fallback&quot;&gt;fallback entries&lt;/span&gt; that they
+   map to, in the new cache.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Store the URIs that form the new &lt;span
+   title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/span&gt; in
+   the new cache.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If this is a &lt;span title=&quot;concept-appcache-cache&quot;&gt;cache
+    attempt&lt;/span&gt;, then:&lt;/p&gt;
+
+    &lt;p&gt;Set the &lt;span title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; to
+    &lt;i&gt;idle&lt;/i&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Associate any &lt;code&gt;Document&lt;/code&gt; objects that were &lt;a
+    href=&quot;#flagAsCandidateForCache&quot;&gt;flagged as candidates&lt;/a&gt; for this
+    manifest URI's caches with &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; called &lt;code
+    title=&quot;event-cached&quot;&gt;cached&lt;/code&gt; at the
+    &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of each &lt;span&gt;top-level
+    browsing context&lt;/span&gt; that is associated with a cache in &lt;var
+    title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of this event
+    should be the display of some sort of user interface indicating to
+    the user that the application has been cached and that they can
+    now use it offline.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Otherwise, this is an &lt;span
+    title=&quot;concept-appcache-upgrade&quot;&gt;upgrade attempt&lt;/span&gt;:&lt;/p&gt;
+
+    &lt;p&gt;Set the &lt;span title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; to &lt;i&gt;update
+    ready&lt;/i&gt;.&lt;/p&gt;
+
+    &lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; called &lt;code
+    title=&quot;event-updateready&quot;&gt;updateready&lt;/code&gt; at the
+    &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of each &lt;span&gt;top-level
+    browsing context&lt;/span&gt; that is associated with a cache in &lt;var
+    title=&quot;&quot;&gt;cache group&lt;/var&gt;. The default action of this event
+    should be the display of some sort of user interface indicating to
+    the user that a new version is available and that they can
+    activate it by reloading the page.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Abort these steps. The following step is jumped to by
+   various parts of the algorithm above when they have to cancel the
+   update.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let the &lt;span title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt;
+   of the group of caches to which &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; belongs
+   be &lt;i&gt;idle&lt;/i&gt;. If appropriate, remove any user interface
+   indicating that an update for this cache is in progress.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+  &lt;h4&gt;Processing model&lt;/h4&gt;
+
+  &lt;p&gt;The processing model of application caches for offline support in
+  Web applications is part of the &lt;span
+  title=&quot;navigate&quot;&gt;navigation&lt;/span&gt; model, but references the
+  algorithms defined in this section.&lt;/p&gt;
+
+  &lt;p&gt;A URI &lt;dfn title=&quot;concept-appcache-matches-oppcache&quot;&gt;matches an
+  opportunistic caching namespace&lt;/dfn&gt; if there exists an
+  &lt;span&gt;application cache&lt;/span&gt; whose &lt;span
+  title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;'s URI has the
+  &lt;span&gt;same scheme/host/port&lt;/span&gt; as the URI in question, and if
+  that application cache has an &lt;span
+  title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+  namespace&lt;/span&gt; with a &lt;path&gt; component that exactly matches
+  the start of the &lt;path&gt; component of the URI being
+  examined. If multiple opportunistic caching namespaces match the
+  same URI, the one with the longest &lt;path&gt; component is the one
+  that matches. A URI looking for an opportunistic caching namespace
+  can match more than one application cache at a time, but only
+  matches one namespace in each cache.&lt;/p&gt;
+
+  &lt;div class=&quot;example&quot;&gt;
+
+   &lt;p&gt;If a manifest &lt;code
+   title=&quot;&quot;&gt;<A HREF="http://example.com/app1/manifest&lt;/code">http://example.com/app1/manifest&lt;/code</A>&gt; declares that
+   &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/resources/images&lt;/code">http://example.com/resources/images&lt;/code</A>&gt; should be
+   opportunistically cached, and the user navigates to &lt;code
+   title=&quot;&quot;&gt;<A HREF="http://example.com/resources/images/cat.png&lt;/code">http://example.com/resources/images/cat.png&lt;/code</A>&gt;, then
+   the user agent will decide that the application cache identified by
+   &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/app1/manifest&lt;/code">http://example.com/app1/manifest&lt;/code</A>&gt; contains a
+   namespace with a match for that URI.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+  &lt;p&gt;When the &lt;dfn
+  title=&quot;concept-appcache-init-with-attribute&quot;&gt;application cache
+  selection algorithm&lt;/dfn&gt; algorithm is invoked with a manifest URI,
+  the user agent must run the first applicable set of steps from the
+  following list:&lt;/p&gt;
+
+  &lt;dl class=&quot;switch&quot;&gt;
+
+   &lt;dt&gt;If the resource is not being loaded as part of navigation of a
+   &lt;span&gt;top-level browsing context&lt;/span&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;As an optimisation, if the resource was loaded from an
+    &lt;span&gt;application cache&lt;/span&gt;, and the manifest URI of that cache
+    doesn't match the manifest URI with which the algorithm was
+    invoked, then the user agent should mark the entry in that
+    application cache corresponding to the resource that was just
+    loaded as being &lt;span
+    title=&quot;concept-appcache-foreign&quot;&gt;foreign&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Other than that, nothing special happens with respect to
+    application caches.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;!-- otherwise, we're talking top-level browsing contexts only: --&gt;
+
+   &lt;dt&gt;If the resource being loaded was loaded from an application
+   cache and the URI of that application cache's manifest is the
+   same as the manifest URI with which the algorithm was invoked&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Associate the &lt;code&gt;Document&lt;/code&gt; with the cache from which
+    it was loaded. Invoke the &lt;span&gt;application cache update
+    process&lt;/span&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;If the resource being loaded was loaded from an application
+   cache and the URI of that application cache's manifest is
+   &lt;em&gt;not&lt;/em&gt; the same as the manifest URI with which the algorithm
+   was invoked&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Mark the entry for this resource in the application cache from
+    which it was loaded as &lt;span
+    title=&quot;concept-appcache-foreign&quot;&gt;foreign&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Restart the current navigation from the top of the &lt;span
+    title=&quot;navigate&quot;&gt;navigation algorithm&lt;/span&gt;, undoing any changes
+    that were made as part of the initial load (changes can be avoided
+    by ensuring that the step to &lt;span&gt;update the session history with
+    the new page&lt;/span&gt; is only ever completed &lt;em&gt;after&lt;/em&gt; the
+    application cache selection algorithm is run, though this is not
+    required).&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;The navigation will not result in the same
+    resource being loaded, because &quot;foreign&quot; entries are never picked
+    during navigation.&lt;/p&gt;
+
+    &lt;p&gt;User agents may notify the user of the inconsistency between
+    the cache manifest and the resource's own metadata, to aid in
+    application development.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;If the resource being loaded was not loaded from an application
+   cache, but it was loaded using HTTP GET or equivalent&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;If the manifest URI does not have the &lt;span&gt;same
+     scheme/host/port&lt;/span&gt; as the resource's own URI, then invoke
+     the &lt;span title=&quot;concept-appcache-init-no-attribute&quot;&gt;application
+     cache selection algorithm&lt;/span&gt; again, but without a manifest,
+     and abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If there is already an &lt;span&gt;application cache&lt;/span&gt;
+     identified by this manifest URI, and that &lt;span&gt;application
+     cache&lt;/span&gt; contains a resource with the URI of the manifest,
+     and that resource is categorised as a &lt;span
+     title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;, then: store
+     the resource in the matching cache with the most up to date
+     version, categorised as an &lt;span
+     title=&quot;concept-appcache-implicit&quot;&gt;implicit entry&lt;/span&gt;,
+     associate the &lt;code&gt;Document&lt;/code&gt; with that cache, invoke the
+     &lt;span&gt;application cache update process&lt;/span&gt;, and abort these
+     steps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li id=&quot;flagAsCandidateForCache&quot;&gt;&lt;p&gt;Flag the resource's
+     &lt;code&gt;Document&lt;/code&gt; as a candidate for this manifest URI's
+     caches.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If there is already an &lt;span&gt;application cache&lt;/span&gt;
+     identified by this manifest URI, then that &lt;span&gt;application
+     cache&lt;/span&gt; does not yet contain a resource with the URI of the
+     manifest, or it does but that resource is not yet categorised as
+     a &lt;span title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;: store
+     the resource in that cache, categorised as an &lt;span
+     title=&quot;concept-appcache-implicit&quot;&gt;implicit entry&lt;/span&gt;
+     (replacing the file's previous contents if it was already in the
+     cache, but not removing any other categories it might have), and
+     abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Otherwise, there is no matching &lt;span&gt;application
+     cache&lt;/span&gt;: create a new application cache identified by this
+     manifest URI, store the resource in that cache, categorised as an
+     &lt;span title=&quot;concept-appcache-implicit&quot;&gt;implicit entry&lt;/span&gt;,
+     and then invoke the &lt;span&gt;application cache update
+     process&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Otherwise&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Invoke the &lt;span
+    title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
+    selection algorithm&lt;/span&gt; again, but without a manifest.&lt;/p&gt;
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;p&gt;When the &lt;dfn
+  title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
+  selection algorithm&lt;/dfn&gt; is invoked &lt;em&gt;without&lt;/em&gt; a manifest,
+  then: if the resource is being loaded as part of navigation of a
+  &lt;span&gt;top-level browsing context&lt;/span&gt;, and the resource was
+  fetched from a particular &lt;span&gt;application cache&lt;/span&gt;, then the
+  user agent must associate the &lt;code&gt;Document&lt;/code&gt; with that
+  application cache and invoke the &lt;span&gt;application cache update
+  process&lt;/span&gt; for that cache; otherwise, nothing special happens
+  with respect to application caches.&lt;/p&gt;
+
+
+  &lt;h5&gt;Changes to the networking model&lt;/h5&gt;
+
+  &lt;p&gt;When a browsing context is associated with an &lt;span&gt;application
+  cache&lt;/span&gt;, any and all resource loads must go through the
+  following steps instead of immediately invoking the mechanisms
+  appropriate to that resource's scheme:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the resource is not to be fetched using the HTTP GET
+   mechanism or equivalent, then fetch the resource normally and abort
+   these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the resource's URI, ignoring its fragment identifier if
+   any, is listed in the &lt;span&gt;application cache&lt;/span&gt;'s &lt;span
+   title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/span&gt;,
+   then fetch the resource normally and abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the resource's URI is &lt;span
+   title=&quot;concept-appcache-implicit&quot;&gt;an implicit entry&lt;/span&gt;, &lt;span
+   title=&quot;concept-appcache-manifest&quot;&gt;the manifest&lt;/span&gt;, &lt;span
+   title=&quot;concept-appcache-explicit&quot;&gt;an explicit entry&lt;/span&gt;, &lt;span
+   title=&quot;concept-appcache-fallback&quot;&gt;a fallback entry&lt;/span&gt;, &lt;span
+   title=&quot;concept-appcache-oppcache&quot;&gt;an opportunistically cached
+   entry&lt;/span&gt;, or a &lt;span title=&quot;concept-appcache-dynamic&quot;&gt;dynamic
+   entry&lt;/span&gt; in the &lt;span&gt;application cache&lt;/span&gt;, then fetch the
+   resource from the cache and abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If the resource's URI has the &lt;span&gt;same
+    scheme/host/port&lt;/span&gt; as the manifest's URI, and the start of
+    the resource's URI's &lt;path&gt; component is exactly matched by
+    the &lt;path&gt; component of an &lt;span
+    title=&quot;concept-appcache-oppcache-ns&quot;&gt;opportunistic caching
+    namespace&lt;/span&gt; in the &lt;span&gt;application cache&lt;/span&gt;, then:
+
+    &lt;p&gt;Fetch the resource normally. If this results 4xx or 5xx status
+    codes or equivalent, or if there were network errors, then instead
+    fetch, from the cache, the resource of the &lt;span
+    title=&quot;concept-appcache-fallback&quot;&gt;fallback entry&lt;/span&gt;
+    corresponding to the namespace with the longest matching
+    &lt;path&gt; component. Abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Fail the resource load.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p class=&quot;note&quot;&gt;The above algorithm ensures that resources that are
+  not present in the manifest will always fail to load (at least,
+  after the cache has been primed the first time), making the testing
+  of offline applications simpler.&lt;/p&gt;
+
+
+  &lt;h4&gt;Application cache API&lt;/h4&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;ApplicationCache&lt;/dfn&gt; {
+
+  // &lt;span title=&quot;concept-appcache-status&quot;&gt;update status&lt;/span&gt;
+  const unsigned short &lt;span title=&quot;dom-appcache-UNCACHED&quot;&gt;UNCACHED&lt;/span&gt; = 0;
+  const unsigned short &lt;span title=&quot;dom-appcache-IDLE&quot;&gt;IDLE&lt;/span&gt; = 1;
+  const unsigned short &lt;span title=&quot;dom-appcache-CHECKING&quot;&gt;CHECKING&lt;/span&gt; = 2;
+  const unsigned short &lt;span title=&quot;dom-appcache-DOWNLOADING&quot;&gt;DOWNLOADING&lt;/span&gt; = 3;
+  const unsigned short &lt;span title=&quot;dom-appcache-UPDATEREADY&quot;&gt;UPDATEREADY&lt;/span&gt; = 4;
+  readonly attribute unsigned short &lt;span title=&quot;dom-appcache-status&quot;&gt;status&lt;/span&gt;;
+
+  // updates
+  void &lt;span title=&quot;dom-appcache-update&quot;&gt;update&lt;/span&gt;();
+  void &lt;span title=&quot;dom-appcache-swapCache&quot;&gt;swapCache&lt;/span&gt;();
+
+  // dynamic entries
+  readonly attribute unsigned long &lt;span title=&quot;dom-appcache-length&quot;&gt;length&lt;/span&gt;;
+  DOMString &lt;span title=&quot;dom-appcache-item&quot;&gt;item&lt;/span&gt;(in unsigned long index);
+  void &lt;span title=&quot;dom-appcache-add&quot;&gt;add&lt;/span&gt;(in DOMString uri);
+  void &lt;span title=&quot;dom-appcache-remove&quot;&gt;remove&lt;/span&gt;(in DOMString uri);
+
+  // events
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-appcache-onchecking&quot;&gt;onchecking&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-appcache-onerror&quot;&gt;onerror&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-appcache-onnoupdate&quot;&gt;onnoupdate&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-appcache-ondownloading&quot;&gt;ondownloading&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-appcache-onprogress&quot;&gt;onprogress&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-appcache-onupdateready&quot;&gt;onupdateready&lt;/span&gt;;
+           attribute &lt;span&gt;EventListener&lt;/span&gt; &lt;span title=&quot;handler-appcache-oncached&quot;&gt;oncached&lt;/span&gt;;
+
+};&lt;/pre&gt;
+
+  &lt;p&gt;Objects implementing the &lt;code&gt;ApplicationCache&lt;/code&gt; interface
+  must also implement the &lt;code&gt;EventTarget&lt;/code&gt; interface.&lt;/p&gt;
+
+  &lt;p&gt;There is a one-to-one mapping from &lt;code&gt;Document&lt;/code&gt; objects
+  to &lt;code&gt;ApplicationCache&lt;/code&gt; objects. The &lt;dfn
+  title=&quot;dom-applicationCache&quot;&gt;&lt;code&gt;applicationCache&lt;/code&gt;&lt;/dfn&gt;
+  attribute on &lt;code&gt;Window&lt;/code&gt; objects must return the
+  &lt;code&gt;ApplicationCache&lt;/code&gt; object associated with the
+  &lt;span&gt;active document&lt;/span&gt; of the &lt;code&gt;Window&lt;/code&gt;'s
+  &lt;span&gt;browsing context&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;An &lt;code&gt;ApplicationCache&lt;/code&gt; object might be associated with
+  an &lt;span&gt;application cache&lt;/span&gt;. When the &lt;code&gt;Document&lt;/code&gt;
+  object that the &lt;code&gt;ApplicationCache&lt;/code&gt; object maps to is
+  associated with an application cache, then that is the application
+  cache with which the &lt;code&gt;ApplicationCache&lt;/code&gt; object is
+  associated. Otherwise, the &lt;code&gt;ApplicationCache&lt;/code&gt; object is
+  associated with the application cache that the &lt;code&gt;Document&lt;/code&gt;
+  object's &lt;span&gt;browsing context&lt;/span&gt; is associated with, if
+  any.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-appcache-status&quot;&gt;&lt;code&gt;status&lt;/code&gt;&lt;/dfn&gt;
+  attribute, on getting, must return the current state of the
+  &lt;span&gt;application cache&lt;/span&gt; &lt;code&gt;ApplicationCache&lt;/code&gt; object
+  is associated with, if any. This must be the appropriate value from
+  the following list:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-appcache-UNCACHED&quot;&gt;&lt;code&gt;UNCACHED&lt;/code&gt;&lt;/dfn&gt;
+   (numeric value 0)&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The &lt;code&gt;ApplicationCache&lt;/code&gt; object is not associated
+   with an &lt;span&gt;application cache&lt;/span&gt; at this time.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-appcache-IDLE&quot;&gt;&lt;code&gt;IDLE&lt;/code&gt;&lt;/dfn&gt;
+   (numeric value 1)&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The &lt;code&gt;ApplicationCache&lt;/code&gt; object is associated with
+   an &lt;span&gt;application cache&lt;/span&gt; whose group is in the &lt;i&gt;idle&lt;/i&gt;
+   &lt;span title=&quot;concept-appcache-states&quot;&gt;update
+   status&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-appcache-CHECKING&quot;&gt;&lt;code&gt;CHECKING&lt;/code&gt;&lt;/dfn&gt;
+   (numeric value 2)&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The &lt;code&gt;ApplicationCache&lt;/code&gt; object is associated with
+   an &lt;span&gt;application cache&lt;/span&gt; whose group is in the
+   &lt;i&gt;checking&lt;/i&gt; &lt;span title=&quot;concept-appcache-states&quot;&gt;update
+   status&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-appcache-DOWNLOADING&quot;&gt;&lt;code&gt;DOWNLOADING&lt;/code&gt;&lt;/dfn&gt;
+   (numeric value 3)&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The &lt;code&gt;ApplicationCache&lt;/code&gt; object is associated with
+   an &lt;span&gt;application cache&lt;/span&gt; whose group is in the
+   &lt;i&gt;downloading&lt;/i&gt; &lt;span title=&quot;concept-appcache-states&quot;&gt;update
+   status&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-appcache-UPDATEREADY&quot;&gt;&lt;code&gt;UPDATEREADY&lt;/code&gt;&lt;/dfn&gt;
+   (numeric value 4)&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;The &lt;code&gt;ApplicationCache&lt;/code&gt; object is associated with
+   an &lt;span&gt;application cache&lt;/span&gt; whose group is in the &lt;i&gt;update
+   ready&lt;/i&gt; &lt;span title=&quot;concept-appcache-states&quot;&gt;update
+   status&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-appcache-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return the number of entries in the &lt;span&gt;application
+  cache&lt;/span&gt; with which the &lt;code&gt;ApplicationCache&lt;/code&gt; object is
+  associated, if any, and zero the object is not associated with any
+  application cache.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;span title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entries&lt;/span&gt;
+  in the &lt;span&gt;application cache&lt;/span&gt; are ordered in the same order
+  as they were added to the cache by the &lt;code
+  title=&quot;dom-appcache-add&quot;&gt;add()&lt;/code&gt; method, with the oldest entry
+  being the zeroth entry, and the most recently added entry having the
+  index &lt;span&gt;&lt;code
+  title=&quot;dom-appcache-length&quot;&gt;length&lt;/code&gt;-1&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-appcache-item&quot;&gt;&lt;code&gt;item(&lt;var
+  title=&quot;&quot;&gt;index&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the &lt;span
+  title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entries&lt;/span&gt; with index
+  &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; from the &lt;span&gt;application cache&lt;/span&gt;,
+  if one is associated with the &lt;code&gt;ApplicationCache&lt;/code&gt;
+  object. If the object is not associated with any application cache,
+  or if the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; argument is lower than zero or
+  greater than &lt;span&gt;&lt;code
+  title=&quot;dom-appcache-length&quot;&gt;length&lt;/code&gt;-1&lt;/span&gt;, the method must
+  instead raise an &lt;code&gt;INDEX_SIZE_ERR&lt;/code&gt; exception.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-appcache-add&quot;&gt;&lt;code&gt;add(&lt;var
+  title=&quot;&quot;&gt;uri&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;ApplicationCache&lt;/code&gt; object is not
+   associated with any application cache, then raise an
+   &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these
+   steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If there is already a resource in in the &lt;span&gt;application
+   cache&lt;/span&gt; with which the &lt;code&gt;ApplicationCache&lt;/code&gt; object is
+   associated that has the address &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt;, then
+   ensure that entry is categorised as a &lt;span
+   title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entry&lt;/span&gt; and return
+   and abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return, but do not abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Fetch the resource referenced by &lt;var
+   title=&quot;&quot;&gt;uri&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If this results 4xx or 5xx status codes or equivalent, or if
+   there were network errors, then abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Wait for there to be no running scripts, or at least no running
+    scripts that can reach an &lt;code&gt;ApplicationCache&lt;/code&gt; object
+    associated with the &lt;span&gt;application cache&lt;/span&gt; with which this
+    &lt;code&gt;ApplicationCache&lt;/code&gt; object is associated.&lt;/p&gt;
+
+    &lt;p&gt;Add the fetched resource to the &lt;span&gt;application cache&lt;/span&gt;
+    and categorise it as a &lt;span
+    title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entry&lt;/span&gt; before
+    letting any such scripts resume.&lt;/p&gt;
+  
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p class=&quot;big-issue&quot;&gt;We can make the add() API more usable
+  (i.e. make it possible to detect progress and distinguish success
+  from errors without polling and timeouts) if we have the method
+  return an object that is a target of Progress Events, much like the
+  &lt;a
+  href=&quot;<A HREF="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/XMLHttpRequest-2/Overview.html?content-type=text/html;%20charset=utf-8#xmlhttprequesteventtarget-interface">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/XMLHttpRequest-2/Overview.html?content-type=text/html;%20charset=utf-8#xmlhttprequesteventtarget-interface</A>&quot;&gt;XMLHttpRequestEventTarget&lt;/a&gt;
+  interface. This would also make this far more complex to spec and
+  implement.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-appcache-remove&quot;&gt;&lt;code&gt;remove(&lt;var
+  title=&quot;&quot;&gt;uri&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must remove the &lt;span
+  title=&quot;concept-appcache-dynamic&quot;&gt;dynamic entry&lt;/span&gt; categorisation
+  of any entry with the address &lt;var title=&quot;&quot;&gt;uri&lt;/var&gt; in the
+  &lt;span&gt;application cache&lt;/span&gt; with which the
+  &lt;code&gt;ApplicationCache&lt;/code&gt; object is associated. If this removes
+  the last categorisation of an entry in that cache, then the entry
+  must be removed entirely (such that if it is re-added, it will be
+  loaded from the network again). If the &lt;code&gt;ApplicationCache&lt;/code&gt;
+  object is not associated with any application cache, then the method
+  must raise an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception instead.&lt;/p&gt;
+
+  &lt;p&gt;If the &lt;dfn
+  title=&quot;dom-appcache-update&quot;&gt;&lt;code&gt;update()&lt;/code&gt;&lt;/dfn&gt; method is
+  invoked, the user agent must invoke the &lt;span&gt;application cache
+  update process&lt;/span&gt;, in the background, for the &lt;span&gt;application
+  cache&lt;/span&gt; with which the &lt;code&gt;ApplicationCache&lt;/code&gt; object is
+  associated. If there is no such application cache, then the method
+  must raise an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception instead.&lt;/p&gt;
+
+  &lt;p&gt;If the &lt;dfn
+  title=&quot;dom-appcache-swapCache&quot;&gt;&lt;code&gt;swapCache()&lt;/code&gt;&lt;/dfn&gt; method
+  is invoked, the user agent must run the following steps:
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the
+    &lt;code&gt;Document&lt;/code&gt; with which the &lt;code&gt;ApplicationCache&lt;/code&gt;
+    object is associated.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Check that &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; is associated with an
+    &lt;span&gt;application cache&lt;/span&gt;. If it is not, then raise an
+    &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these
+    steps.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;This is not the same thing as the
+    &lt;code&gt;ApplicationCache&lt;/code&gt; object being itself associated with
+    an &lt;span&gt;application cache&lt;/span&gt;! In particular, this can only
+    happen if &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; is in a &lt;span&gt;top-level
+    browsing context&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; be the &lt;span&gt;application
+   cache&lt;/span&gt; with which the &lt;code&gt;ApplicationCache&lt;/code&gt; object is
+   associated. (By definition, this is the same as the one that was
+   found in the previous step.)&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Check that there is an application cache in the same group
+   as &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; which has an entry categorised as a
+   &lt;span title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt; that has is
+   newer than &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;. If there is not, then raise
+   an &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception and abort these
+   steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt; be the newest
+   &lt;span&gt;application cache&lt;/span&gt; in the same group as &lt;var
+   title=&quot;&quot;&gt;cache&lt;/var&gt; which has an entry categorised as a &lt;span
+   title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Unassociate &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; from &lt;var
+   title=&quot;&quot;&gt;cache&lt;/var&gt; and instead associate it with &lt;var
+   title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;The following are the &lt;span&gt;event handler DOM attributes&lt;/span&gt;
+  that must be supported by objects implementing the
+  &lt;code&gt;ApplicationCache&lt;/code&gt; interface:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-appcache-onchecking&quot;&gt;&lt;code&gt;onchecking&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-checking&quot;&gt;checking&lt;/code&gt; event is targeted at or
+   bubbles through the &lt;code&gt;ApplicationCache&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-appcache-onerror&quot;&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-error&quot;&gt;error&lt;/code&gt; event is targeted at or bubbles
+   through the &lt;code&gt;ApplicationCache&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-appcache-onnoupdate&quot;&gt;&lt;code&gt;onnoupdate&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-noupdate&quot;&gt;noupdate&lt;/code&gt; event is targeted at or
+   bubbles through the &lt;code&gt;ApplicationCache&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-appcache-ondownloading&quot;&gt;&lt;code&gt;ondownloading&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-downloading&quot;&gt;downloading&lt;/code&gt; event is targeted at
+   or bubbles through the &lt;code&gt;ApplicationCache&lt;/code&gt;
+   object.&lt;/p&gt;&lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-appcache-onprogress&quot;&gt;&lt;code&gt;onprogress&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-progress&quot;&gt;progress&lt;/code&gt; event is targeted at or
+   bubbles through the &lt;code&gt;ApplicationCache&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-appcache-onupdateready&quot;&gt;&lt;code&gt;onupdateready&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever an &lt;code
+   title=&quot;event-updateready&quot;&gt;updateready&lt;/code&gt; event is targeted at
+   or bubbles through the &lt;code&gt;ApplicationCache&lt;/code&gt;
+   object.&lt;/p&gt;&lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;dfn title=&quot;handler-appcache-oncached&quot;&gt;&lt;code&gt;oncached&lt;/code&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Must be invoked whenever a &lt;code
+   title=&quot;event-cached&quot;&gt;cached&lt;/code&gt; event is targeted at or bubbles
+   through the &lt;code&gt;ApplicationCache&lt;/code&gt; object.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+
+  &lt;h4&gt;Browser state&lt;/h4&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-navigator-onLine&quot;&gt;&lt;code&gt;navigator.onLine&lt;/code&gt;&lt;/dfn&gt;
+  attribute must return false if the user agent will not contact the
+  network when the user follows links or when a script requests a
+  remote page (or knows that such an attempt would fail), and must
+  return true otherwise.&lt;/p&gt;
+
+  &lt;p&gt;When the value that would be returned by the &lt;code
+  title=&quot;dom-navigator-onLine&quot;&gt;navigator.onLine&lt;/code&gt; attribute of
+  the &lt;code&gt;Window&lt;/code&gt; changes from true to false, the user agent
+  must &lt;span&gt;fire a simple event&lt;/span&gt; called &lt;dfn
+  title=&quot;event-offline&quot;&gt;&lt;code&gt;offline&lt;/code&gt;&lt;/dfn&gt; at &lt;span&gt;the body
+  element&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;On the other hand, when the value that would be returned by the
+  &lt;code title=&quot;dom-navigator-onLine&quot;&gt;navigator.onLine&lt;/code&gt; attribute
+  of the &lt;code&gt;Window&lt;/code&gt; changes from false to true, the user
+  agent must &lt;span&gt;fire a simple event&lt;/span&gt; called &lt;dfn
+  title=&quot;event-online&quot;&gt;&lt;code&gt;online&lt;/code&gt;&lt;/dfn&gt; at &lt;span&gt;the body
+  element&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;!-- XXX ononline onoffline need to be defined --&gt;
+
+
+
   &lt;h3 id=&quot;history&quot;&gt;Session history and navigation&lt;/h3&gt;
 
   &lt;h4&gt;The session history of browsing contexts&lt;/h4&gt;
@@ -23520,8 +24962,9 @@
   whose index equals the index of the &lt;span&gt;current entry&lt;/span&gt; plus
   &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;.&lt;/p&gt;
 
-  &lt;p&gt;When a user agent is required to &lt;dfn&gt;traverse the history&lt;/dfn&gt;
-  to a specified entry, the user agent must act as follows:&lt;/p&gt;
+  &lt;p&gt;When a user agent is required to &lt;dfn&gt;traverse the
+  history&lt;/dfn&gt;&lt;!-- (traversal) --&gt; to a specified entry, the user
+  agent must act as follows:&lt;/p&gt;
 
   &lt;ol&gt;
 
@@ -23588,9 +25031,13 @@
 
      &lt;/li&gt;
 
-     &lt;li&gt;The user agent must make the &lt;span&gt;specified entry&lt;/span&gt;'s
-     &lt;code&gt;Document&lt;/code&gt; object the &lt;span&gt;active document&lt;/span&gt; of
-     the &lt;span&gt;browsing context&lt;/span&gt;.&lt;/li&gt;
+     &lt;li id=&quot;appcache-history-2&quot;&gt;The user agent must make the
+     &lt;span&gt;specified entry&lt;/span&gt;'s &lt;code&gt;Document&lt;/code&gt; object the
+     &lt;span&gt;active document&lt;/span&gt; of the &lt;span&gt;browsing
+     context&lt;/span&gt;. (If it is a &lt;span&gt;top-level browsing
+     context&lt;/span&gt;, this might &lt;a
+     href=&quot;#appcache-history-1&quot;&gt;change&lt;/span&gt; which &lt;span&gt;application
+     cache&lt;/span&gt; it is associated with.)&lt;/li&gt;
 
      &lt;li&gt;If the &lt;span&gt;specified entry&lt;/span&gt; has a &lt;span&gt;browsing
      context name&lt;/span&gt; stored with it, then the following
@@ -23682,19 +25129,17 @@
   &lt;p&gt;When this method is invoked, the user agent must first check the
   third argument. If a third argument is specified, then the user
   agent must verify that the third argument is a valid URI or IRI (as
-  defined by RFC 3986 and 3987, and as modified by RFC 2732), and if
-  so, that, after resolving it to an absolute URI, it is either
-  identical to the document's URI, or that it differs from the
-  document's URI only in the &lt;query&gt;, &lt;abs_path&gt;, and/or
-  &lt;fragment&gt; parts, as applicable (the &lt;query&gt; and
-  &lt;abs_path&gt; parts can only be the same if the document's URI
-  uses a hierarchical &lt;scheme&gt;). If the verification fails
-  (either because the argument is syntactically incorrect, or differs
-  in a way not described as acceptable in the previous sentence) then
-  the user agent must raise a &lt;span&gt;security exception&lt;/span&gt;. &lt;a
-  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC2732&quot;&gt;[RFC2732]&lt;/a&gt;&lt;/p&gt;
+  defined by RFC 3986 and 3987), and if so, that, after resolving it
+  to an absolute URI, it is either identical to the document's URI, or
+  that it differs from the document's URI only in the &lt;query&gt;,
+  &lt;abs_path&gt;, and/or &lt;fragment&gt; parts, as applicable (the
+  &lt;query&gt; and &lt;abs_path&gt; parts can only be the same if the
+  document's URI uses a hierarchical &lt;scheme&gt;). If the
+  verification fails (either because the argument is syntactically
+  incorrect, or differs in a way not described as acceptable in the
+  previous sentence) then the user agent must raise a &lt;span&gt;security
+  exception&lt;/span&gt;. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;If the third argument passes its verification step, or if the
   third argument was omitted, then the user agent must remove from the
@@ -23980,26 +25425,100 @@
    scheme is not one of the supported protocols, or an inline prompt
    to allow the user to select &lt;span
    title=&quot;dom-navigator-registerProtocolHandler&quot;&gt;a registered
-   handler&lt;/span&gt; for the given scheme, then &lt;span title=&quot;display a
-   user agent page inline&quot;&gt;display the inline content&lt;/span&gt; and abort
-   these steps.&lt;/p&gt;&lt;/li&gt;
+   handler&lt;/span&gt; for the given scheme, then &lt;span
+   title=&quot;navigate-ua-inline&quot;&gt;display the inline content&lt;/span&gt; and
+   abort these steps.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the new resource is to be handled using a mechanism that
    does not affect the browsing context, then abort these steps and
    proceed with that mechanism instead.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Start fetching the specified resource, as appropriate
-   (e.g. performing an HTTP GET or POST operation, or reading the file
-   from disk, or executing script in the case of a &lt;span
-   title=&quot;javascript protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt;
-   URI&lt;/span&gt;). If this results in a redirect, return to step 2 with
-   the new resource.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;If the new resource is to be fetched using HTTP GET or
+    equivalent, and if the browsing context being navigated is a
+    &lt;span&gt;top-level browsing context&lt;/span&gt;, then check if there are
+    any &lt;span title=&quot;application cache&quot;&gt;application caches&lt;/span&gt; that
+    have a &lt;span title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;
+    with the &lt;span&gt;same scheme/host/port&lt;/span&gt; as the URI in
+    question, and that have this URI as one of their entries
+    (excluding entries marked as &lt;span
+    title=&quot;concept-appcache-foreign&quot;&gt;manifest&lt;/span&gt;), and that
+    already contain their manifest, categorised as a &lt;span
+    title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;. If so, then the
+    user agent must then fetch the resource from the &lt;span
+    title=&quot;concept-appcache-selection&quot;&gt;most appropriate application
+    cache&lt;/span&gt; of those that match.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, start fetching the specified resource in the
+    appropriate manner (e.g. performing an HTTP GET or POST operation,
+    or reading the file from disk, or executing script in the case of
+    a &lt;span title=&quot;javascript protocol&quot;&gt;&lt;code
+    title=&quot;&quot;&gt;javascript:&lt;/code&gt; URI&lt;/span&gt;). If this results in a
+    redirect, return to step 2 with the new resource.&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;For example, imagine an HTML page with an
+    associated application cache displaying an image and a form, where
+    the image is also used by several other application caches. If the
+    user right-clicks on the image and chooses &quot;View Image&quot;, then the
+    user agent could decide to show the image from any of those
+    caches, but it is likely that the most useful cache for the user
+    would be the one that was used for the aforementioned HTML
+    page. On the other hand, if the user submits the form, and the
+    form does a POST submission, then the user agent will not use an
+    application cache at all; the submission will be made to the
+    network.&lt;/p&gt;
+
+   &lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Wait for one or more bytes to be available or for the user
    agent to establish that the resource in question is empty. During
    this time, the user agent may allow the user to cancel this
    navigation attempt or start other navigation attempts.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;If the resource was not fetched from an &lt;span&gt;application
+    cache&lt;/span&gt;, and was to be fetched using HTTP GET or equivalent,
+    and its URI &lt;span
+    title=&quot;concept-appcache-matches-oppcache&quot;&gt;matches the
+    opportunistic caching namespace&lt;/span&gt; of one or more application
+    caches, then:&lt;/p&gt;
+
+    &lt;dl class=&quot;switch&quot;&gt;
+
+     &lt;dt&gt;If the file was successfully downloaded&lt;/dt&gt;
+
+     &lt;dd&gt;The user agent must cache the resource in all those
+     application caches, categorised as &lt;span
+     title=&quot;concept-appcache-oppcache&quot;&gt;opportunistically cached
+     entries&lt;/span&gt;.&lt;/dd&gt;
+
+
+     &lt;dt&gt;If the server returned a 4xx or 5xx status code or
+     equivalent, or there were network errors&lt;/dt&gt;
+
+     &lt;dd&gt;If the browsing context being navigated is a &lt;span&gt;top-level
+     browsing context&lt;/span&gt;, then the user agent must discard the
+     failed load and instead use the &lt;span
+     title=&quot;concept-appcache-fallback&quot;&gt;fallback resource&lt;/span&gt;
+     specified for the opportunistic caching namespace in question. If
+     multiple application caches match, the user agent must use the
+     fallback of the &lt;span title=&quot;concept-appcache-selection&quot;&gt;most
+     appropriate application cache&lt;/span&gt; of those that match. For the
+     purposes of session history (and features that depend on session
+     history, e.g. bookmarking) the user agent must use the URI of the
+     resource that was requested (the one that matched the
+     opportunistic caching namespace), not the fallback
+     resource. However, the user agent may indicate to the user that
+     the original page load failed, that the page used was a fallback
+     resource, and what the URI of the fallback resource actually
+     is.&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If the document's out-of-band metadata (e.g. HTTP headers),
    not counting any &lt;span title=&quot;Content-Type&quot;&gt;type information&lt;/span&gt;
    (such as the Content-Type HTTP header), requires some sort of
@@ -24069,9 +25588,9 @@
    the content, an error message because the specified type is not
    supported, or an inline prompt to allow the user to select &lt;span
    title=&quot;dom-navigator-registerContentHandler&quot;&gt;a registered
-   handler&lt;/span&gt; for the given type, then &lt;span title=&quot;display a user
-   agent page inline&quot;&gt;display the inline content&lt;/span&gt; and abort
-   these steps.&lt;/p&gt;&lt;/li&gt;
+   handler&lt;/span&gt; for the given type, then &lt;span
+   title=&quot;navigate-ua-inline&quot;&gt;display the inline content&lt;/span&gt; and
+   abort these steps.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Otherwise, the document's &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is such
    that the resource will not affect the browsing context,
@@ -24163,10 +25682,11 @@
   document as the &lt;span&gt;input stream&lt;/span&gt; for that parser.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;The &lt;span&gt;input stream&lt;/span&gt; converts bytes into
-  characters for use in the &lt;span&gt;tokeniser&lt;/span&gt;. This process
-  relies, in part, on character encoding information found in the real
-  &lt;span title=&quot;Content-Type&quot;&gt;Content-Type metadata&lt;/span&gt; of the
-  resource; the &quot;sniffed type&quot; is not used for this purpose.&lt;/p&gt;
+  characters for use in the &lt;span&gt;tokeniser&lt;/span&gt;&lt;!-- XXX xref
+  --&gt;. This process relies, in part, on character encoding information
+  found in the real &lt;span title=&quot;Content-Type&quot;&gt;Content-Type
+  metadata&lt;/span&gt; of the resource; the &quot;sniffed type&quot; is not used for
+  this purpose.&lt;/p&gt;
 
   &lt;!-- next two paragraphs are nearly identical to the navigate-text
   section, keep them in sync --&gt;
@@ -24179,7 +25699,14 @@
   before the page has finished parsing, the user agent must
   &lt;span&gt;update the session history with the new page&lt;/span&gt;.&lt;/p&gt;
 
+  &lt;p class=&quot;note&quot;&gt;&lt;span
+  title=&quot;concept-appcache-init-with-attribute&quot;&gt;Application cache
+  selection&lt;/span&gt; happens &lt;a href=&quot;#parser-appcache&quot;&gt;in the HTML
+  parser&lt;/a&gt;.&lt;/p&gt;
 
+
+
+
   &lt;h4 id=&quot;read-xml&quot;&gt;&lt;dfn title=&quot;navigate-xml&quot;&gt;Page load processing model for XML files&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;When faced with displaying an XML file inline, user agents must
@@ -24196,6 +25723,29 @@
   encoding according to the rules given in the above
   specifications.&lt;/p&gt;
 
+  &lt;p&gt;If the root element, as parsed according to the XML
+  specifications cited above, is found to be an &lt;code&gt;html&lt;/code&gt;
+  element with an attribute &lt;code
+  title=&quot;attr-html-application&quot;&gt;application&lt;/code&gt;, then, as soon as
+  the element is inserted into the DOM, the user agent must run the
+  &lt;span title=&quot;concept-appcache-init-with-attribute&quot;&gt;application cache
+  selection algorithm&lt;/span&gt; with the value of that attribute as the
+  manifest URI. Otherwise, as soon as the root element is inserted
+  into the DOM, the user agent must run the &lt;span
+  title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
+  selection algorithm&lt;/span&gt; with no manifest.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;Because the processing of the &lt;code
+  title=&quot;attr-html-application&quot;&gt;application&lt;/code&gt; attribute happens
+  only once the root element is parsed, any URIs referenced by
+  processing instructions before the root element (such as &lt;code
+  title=&quot;&quot;&gt;&lt;?xml-styleesheet?&gt;&lt;/code&gt; and &lt;code
+  title=&quot;&quot;&gt;&lt;?xbl?&gt;&lt;/code&gt; PIs) will be fetched from the network and
+  cannot be cached.&lt;/p&gt; &lt;!-- XXX any ideas for avoiding this, that
+  aren't a PI themselves? We can't delay the processing, since the
+  whole point of the &lt;?xbl?&gt; PI is to have the XBL sheet loaded before
+  the root element... --&gt;
+
   &lt;p&gt;User agents may examine the namespace of the root
   &lt;code&gt;Element&lt;/code&gt; node of this &lt;code&gt;Document&lt;/code&gt; object to
   perform namespace-based dispatch to alternative processing tools,
@@ -24232,8 +25782,13 @@
   subsequent versions thereof. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt; &lt;a
   href=&quot;#refsRFC2046&quot;&gt;[RFC2646]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent
+  must run the &lt;span
+  title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
+  selection algorithm&lt;/span&gt; with no manifest.&lt;/p&gt;
+
   &lt;!-- next two paragraphs are nearly identical to the navigate-html
-  section and similar to the &quot;non-DOM-inline-content&quot; section, and the
+  section and similar to the &quot;navigate-ua-inline&quot; section, and the
   next three are similar to the navigate-image and navigate-plugin
   sections; keep them all in sync --&gt;
 
@@ -24269,6 +25824,11 @@
   &lt;p&gt;Then, the user agent must act as if it had &lt;span title=&quot;stop
   parsing&quot;&gt;stopped parsing&lt;/span&gt;.&lt;/p&gt;
 
+  &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent
+  must run the &lt;span
+  title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
+  selection algorithm&lt;/span&gt; with no manifest.&lt;/p&gt;
+
   &lt;p&gt;After creating the &lt;code&gt;Document&lt;/code&gt; object, but potentially
   before the page has finished fully loading, the user agent must
   &lt;span&gt;update the session history with the new page&lt;/span&gt;.&lt;/p&gt;
@@ -24298,6 +25858,11 @@
   &lt;p&gt;Then, the user agent must act as if it had &lt;span title=&quot;stop
   parsing&quot;&gt;stopped parsing&lt;/span&gt;.&lt;/p&gt;
 
+  &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent
+  must run the &lt;span
+  title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
+  selection algorithm&lt;/span&gt; with no manifest.&lt;/p&gt;
+
   &lt;p&gt;After creating the &lt;code&gt;Document&lt;/code&gt; object, but potentially
   before the page has finished fully loading, the user agent must
   &lt;span&gt;update the session history with the new page&lt;/span&gt;.&lt;/p&gt;
@@ -24308,16 +25873,16 @@
   the document a &lt;code&gt;title&lt;/code&gt;.&lt;/p&gt;
 
 
-  &lt;h4 id=&quot;non-DOM-inline-content&quot;&gt;Page load processing model for inline content that doesn't have a DOM&lt;/h4&gt;
+  &lt;h4 id=&quot;read-ua-inline&quot;&gt;&lt;dfn title=&quot;navigate-ua-inline&quot;&gt;Page load processing model for inline content that doesn't have a DOM&lt;/dfn&gt;&lt;/h4&gt;
 
-  &lt;p&gt;When the user agent is to &lt;dfn&gt;display a user agent page
-  inline&lt;/dfn&gt; in a &lt;span&gt;browsing context&lt;/span&gt;, the user agent
-  should create a &lt;code&gt;Document&lt;/code&gt; object, mark it as being an
-  &lt;span title=&quot;HTML documents&quot;&gt;HTML document&lt;/span&gt;, and then either
-  associate that &lt;code&gt;Document&lt;/code&gt; with a custom rendering that is
-  not rendered using the normal &lt;code&gt;Document&lt;/code&gt; rendering rules,
-  or mutate that &lt;code&gt;Document&lt;/code&gt; until it represents the content
-  the user agent wants to render.&lt;/p&gt;
+  &lt;p&gt;When the user agent is to display a user agent page inline in a
+  &lt;span&gt;browsing context&lt;/span&gt;, the user agent should create a
+  &lt;code&gt;Document&lt;/code&gt; object, mark it as being an &lt;span title=&quot;HTML
+  documents&quot;&gt;HTML document&lt;/span&gt;, and then either associate that
+  &lt;code&gt;Document&lt;/code&gt; with a custom rendering that is not rendered
+  using the normal &lt;code&gt;Document&lt;/code&gt; rendering rules, or mutate
+  that &lt;code&gt;Document&lt;/code&gt; until it represents the content the user
+  agent wants to render.&lt;/p&gt;
 
   &lt;!-- next two paragraphs are similar to the navigate-text section,
   keep them in sync --&gt;
@@ -24325,6 +25890,11 @@
   &lt;p&gt;Once the page has been set up, the user agent must act as if it
   had &lt;span title=&quot;stop parsing&quot;&gt;stopped parsing&lt;/span&gt;.&lt;/p&gt;
 
+  &lt;p&gt;Upon creation of the &lt;code&gt;Document&lt;/code&gt; object, the user agent
+  must run the &lt;span
+  title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
+  selection algorithm&lt;/span&gt; with no manifest.&lt;/p&gt;
+
   &lt;p&gt;After creating the &lt;code&gt;Document&lt;/code&gt; object, but potentially
   before the page has been completely set up, the user agent must
   &lt;span&gt;update the session history with the new page&lt;/span&gt;.&lt;/p&gt;
@@ -25190,9 +26760,10 @@
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-Storage-key&quot;&gt;&lt;code&gt;key(&lt;var
   title=&quot;&quot;&gt;n&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return the name of the
-  &lt;var title=&quot;&quot;&gt;n&lt;/var&gt;th &lt;span&gt;accessible&lt;/span&gt; key in the list. The
-  order of keys is user-agent defined, but must be consistent within
-  an object between changes to the number of keys. (Thus, &lt;span
+  &lt;var title=&quot;&quot;&gt;n&lt;/var&gt;th &lt;span title=&quot;accessible
+  keys&quot;&gt;accessible&lt;/span&gt; key in the list. The order of keys is
+  user-agent defined, but must be consistent within an object between
+  changes to the number of keys. (Thus, &lt;span
   title=&quot;dom-Storage-setItem&quot;&gt;adding&lt;/span&gt; or &lt;span
   title=&quot;dom-Storage-removeItem&quot;&gt;removing&lt;/span&gt; a key may change the
   order of the keys, but merely changing the value of an existing key
@@ -25208,12 +26779,13 @@
   &lt;code&gt;StorageItem&lt;/code&gt; object representing the key/value pair with
   the given &lt;var title=&quot;&quot;&gt;key&lt;/var&gt;. If the given &lt;var
   title=&quot;&quot;&gt;key&lt;/var&gt; does not exist in the list associated with the
-  object, or is not &lt;span&gt;accessible&lt;/span&gt;, then this method must
-  return null. Subsequent calls to this method with the same key from
-  scripts running in the same &lt;span&gt;security context&lt;/span&gt; must
-  return the same instance of the &lt;code&gt;StorageItem&lt;/code&gt;
-  interface. (Such instances must not be shared across security
-  contexts, though.)&lt;/p&gt; &lt;!-- XXX define security context --&gt;
+  object, or is not &lt;span title=&quot;accessible keys&quot;&gt;accessible&lt;/span&gt;,
+  then this method must return null. Subsequent calls to this method
+  with the same key from scripts running in the same &lt;span&gt;security
+  context&lt;/span&gt; must return the same instance of the
+  &lt;code&gt;StorageItem&lt;/code&gt; interface. (Such instances must not be
+  shared across security contexts, though.)&lt;/p&gt; &lt;!-- XXX define
+  security context --&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-Storage-setItem&quot;&gt;&lt;code&gt;setItem(&lt;var
   title=&quot;&quot;&gt;key&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method
@@ -25233,12 +26805,13 @@
 
   &lt;p&gt;If the given &lt;var title=&quot;&quot;&gt;key&lt;/var&gt; &lt;em&gt;does&lt;/em&gt; exist in the
   list, then, if the key/value pair with the given &lt;var
-  title=&quot;&quot;&gt;key&lt;/var&gt; is &lt;span&gt;accessible&lt;/span&gt;, it must have its
-  value updated so that any current or future &lt;code&gt;StorageItem&lt;/code&gt;
-  objects referring to this key/value pair will return the value given
-  in the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; argument. If it is &lt;em&gt;not&lt;/em&gt;
-  &lt;span&gt;accessible&lt;/span&gt;, the method must raise a &lt;span&gt;security
-  exception&lt;/span&gt;.&lt;/p&gt;
+  title=&quot;&quot;&gt;key&lt;/var&gt; is &lt;span title=&quot;accessible
+  keys&quot;&gt;accessible&lt;/span&gt;, it must have its value updated so that any
+  current or future &lt;code&gt;StorageItem&lt;/code&gt; objects referring to this
+  key/value pair will return the value given in the &lt;var
+  title=&quot;&quot;&gt;value&lt;/var&gt; argument. If it is &lt;em&gt;not&lt;/em&gt; &lt;span
+  title=&quot;accessible keys&quot;&gt;accessible&lt;/span&gt;, the method must raise a
+  &lt;span&gt;security exception&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;When the &lt;code title=&quot;dom-Storage-setItem&quot;&gt;setItem()&lt;/code&gt;
   method is successfully invoked (i.e. when it doesn't raise an
@@ -25253,11 +26826,11 @@
   &lt;p&gt;The &lt;dfn title=&quot;dom-Storage-removeItem&quot;&gt;&lt;code&gt;removeItem(&lt;var
   title=&quot;&quot;&gt;key&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must cause the key/value
   pair with the given &lt;var title=&quot;&quot;&gt;key&lt;/var&gt; to be removed from the
-  list associated with the object, if it exists and is
-  &lt;span&gt;accessible&lt;/span&gt;. If no item with that key exists, the method
-  must do nothing. If an item with that key exists but is not
-  &lt;span&gt;accessible&lt;/span&gt;, the method must raise a &lt;span&gt;security
-  exception&lt;/span&gt;.&lt;/p&gt;
+  list associated with the object, if it exists and is &lt;span
+  title=&quot;accessible keys&quot;&gt;accessible&lt;/span&gt;. If no item with that key
+  exists, the method must do nothing. If an item with that key exists
+  but is not &lt;span title=&quot;accessible keys&quot;&gt;accessible&lt;/span&gt;, the
+  method must raise a &lt;span&gt;security exception&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code title=&quot;dom-Storage-setItem&quot;&gt;setItem()&lt;/code&gt; and &lt;code
   title=&quot;dom-Storage-removeItem&quot;&gt;removeItem()&lt;/code&gt; methods must be
@@ -25266,13 +26839,13 @@
   changed at all.&lt;/p&gt;
 
   &lt;p&gt;In the ECMAScript DOM binding, enumerating a &lt;code&gt;Storage&lt;/code&gt;
-  object must enumerate through the currently stored and
-  &lt;span&gt;accessible&lt;/span&gt; keys in the list the object is associated
-  with. (It must not enumerate the values or the actual members of the
-  interface). In the ECMAScript DOM binding, &lt;code&gt;Storage&lt;/code&gt;
-  objects must support dereferencing such that getting a property that
-  is not a member of the object (i.e. is neither a member of the
-  &lt;code&gt;Storage&lt;/code&gt; interface nor of &lt;code
+  object must enumerate through the currently stored and &lt;span
+  title=&quot;accessible keys&quot;&gt;accessible&lt;/span&gt; keys in the list the
+  object is associated with. (It must not enumerate the values or the
+  actual members of the interface). In the ECMAScript DOM binding,
+  &lt;code&gt;Storage&lt;/code&gt; objects must support dereferencing such that
+  getting a property that is not a member of the object (i.e. is
+  neither a member of the &lt;code&gt;Storage&lt;/code&gt; interface nor of &lt;code
   title=&quot;dom-Object&quot;&gt;Object&lt;/code&gt;) must invoke the &lt;code
   title=&quot;dom-Storage-getItem&quot;&gt;getItem()&lt;/code&gt; method with the
   property's name as the argument, and setting such a property must
@@ -27558,10 +29131,9 @@
   value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
 
   &lt;p&gt;The rules for parsing and constructing URIs are described in RFC
-  3986 and RFC 3987, as modified by RFC 2732. &lt;a
+  3986 and RFC 3987. &lt;a
   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC2732&quot;&gt;[RFC2732]&lt;/a&gt;&lt;/p&gt;
+  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
 
   &lt;table&gt;
    &lt;thead&gt;      
@@ -27584,7 +29156,7 @@
      &lt;td&gt;The new value is not the empty string
     &lt;tr&gt;
      &lt;td&gt;&lt;dfn title=&quot;dom-uda-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;hostport&gt;
+     &lt;td&gt;&lt;span&gt;&lt;hostport&gt;&lt;/span&gt;
      &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical and uses a server-based naming authority
      &lt;td&gt;&mdash;
      &lt;td&gt;&mdash;
@@ -27592,7 +29164,7 @@
      &lt;td&gt;&mdash;
     &lt;tr&gt;
      &lt;td&gt;&lt;dfn title=&quot;dom-uda-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;host&gt;
+     &lt;td&gt;&lt;host&gt;/&lt;ihost&gt;
      &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical and uses a server-based naming authority
      &lt;td&gt;&mdash;
      &lt;td&gt;&mdash;
@@ -27632,6 +29204,11 @@
      &lt;td&gt;&mdash;
   &lt;/table&gt;
 
+  &lt;p&gt;The &lt;dfn&gt;&lt;hostport&gt;&lt;/dfn&gt; component is defined as being the
+  &lt;host&gt;/&lt;ihost&gt; component, followed by a colon and the
+  &lt;port&gt; component, but with the colon and &lt;port&gt;
+  component omitted if the given port matches the default port for the
+  protocol given by the &lt;scheme&gt; component.&lt;/p&gt;
 
 &lt;!--
   <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
@@ -34585,6 +36162,15 @@
    &lt;dt&gt;An end tag token&lt;/dt&gt;
    &lt;dt&gt;An end-of-file token&lt;/dt&gt;
    &lt;dd&gt;
+
+    &lt;p id=&quot;parser-appcache&quot;&gt;If the token is a start tag token with the
+    tag name &quot;html&quot;, and it has an attribute &quot;application&quot;, then run
+    the &lt;span title=&quot;concept-appcache-init-with-attribute&quot;&gt;application
+    cache selection algorithm&lt;/span&gt; with the value of that attribute
+    as the manifest URI. Otherwise, run the &lt;span
+    title=&quot;concept-appcache-init-no-attribute&quot;&gt;application cache
+    selection algorithm&lt;/span&gt; with no manifest.&lt;/p&gt;
+
     &lt;p&gt;Create an &lt;code&gt;HTMLElement&lt;/code&gt; node with the tag name
     &lt;code&gt;html&lt;/code&gt;, in the &lt;span&gt;HTML namespace&lt;/span&gt;. Append it
     to the &lt;code&gt;Document&lt;/code&gt; object. Switch to &lt;span&gt;the main


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007944.html">[html5] r1036 - /
</A></li>
	<LI>Next message: <A HREF="007946.html">[html5] r1038 - /
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7945">[ date ]</a>
              <a href="thread.html#7945">[ thread ]</a>
              <a href="subject.html#7945">[ subject ]</a>
              <a href="author.html#7945">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
