<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r4582 - [giow] (1) Delay appcache events if the document	hasn't loaded yet.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4582%20-%20%5Bgiow%5D%20%281%29%20Delay%20appcache%20events%20if%20the%20document%0A%09hasn%27t%20loaded%20yet.&In-Reply-To=%3C20100113013558.852711389D8%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011449.html">
   <LINK REL="Next"  HREF="011451.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r4582 - [giow] (1) Delay appcache events if the document	hasn't loaded yet.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4582%20-%20%5Bgiow%5D%20%281%29%20Delay%20appcache%20events%20if%20the%20document%0A%09hasn%27t%20loaded%20yet.&In-Reply-To=%3C20100113013558.852711389D8%40hixie.dreamhostps.com%3E"
       TITLE="[html5] r4582 - [giow] (1) Delay appcache events if the document	hasn't loaded yet.">whatwg at whatwg.org
       </A><BR>
    <I>Tue Jan 12 17:35:58 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="011449.html">[html5] r4581 - [acgiow] (0) Provide a safe way to host hostile	content for use with an &lt;iframe [...]
</A></li>
        <LI>Next message: <A HREF="011451.html">[html5] r4583 - [e] (0) Correct the list of events that fire during	copy&amp;paste.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11450">[ date ]</a>
              <a href="thread.html#11450">[ thread ]</a>
              <a href="subject.html#11450">[ subject ]</a>
              <a href="author.html#11450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-01-12 17:35:55 -0800 (Tue, 12 Jan 2010)
New Revision: 4582

Modified:
   complete.html
   index
   source
Log:
[giow] (1) Delay appcache events if the document hasn't loaded yet.

Modified: complete.html
===================================================================
--- complete.html	2010-01-12 11:45:42 UTC (rev 4581)
+++ complete.html	2010-01-13 01:35:55 UTC (rev 4582)
@@ -110,7 +110,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;Web Applications 1.0&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 12 January 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 13 January 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -54213,6 +54213,8 @@
   not show prominent update progress notifications for applications
   that cancel the relevant events.&lt;/p&gt;
 
+  &lt;p class=note&gt;These events are delayed until after the &lt;code title=event-load&gt;load&lt;/code&gt; event has fired.&lt;/p&gt;
+
   &lt;p&gt;The &lt;a href=#application-cache-download-process&gt;application cache download process&lt;/a&gt; steps are as
   follows:
 
@@ -54275,8 +54277,8 @@
 
      &lt;li&gt;&lt;p&gt;If these steps were invoked with a &lt;a href=#cache-host&gt;cache
      host&lt;/a&gt;, and the &lt;a href=#concept-appcache-status title=concept-appcache-status&gt;status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; is &lt;i&gt;checking&lt;/i&gt; or
-     &lt;i&gt;downloading&lt;/i&gt;, then &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire
-     a simple event&lt;/a&gt; named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; that is
+     &lt;i&gt;downloading&lt;/i&gt;, then &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to
+     &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; that is
      cancelable at the &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of that
      &lt;a href=#cache-host&gt;cache host&lt;/a&gt;. The default action of this event must
      be, if the user agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the
@@ -54286,8 +54288,8 @@
 
      &lt;li&gt;&lt;p&gt;If these steps were invoked with a &lt;a href=#cache-host&gt;cache
      host&lt;/a&gt;, and the &lt;a href=#concept-appcache-status title=concept-appcache-status&gt;status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; is &lt;i&gt;downloading&lt;/i&gt;, then also
-     &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt;
-     named &lt;code title=event-appcache-downloading&gt;&lt;a href=#event-appcache-downloading&gt;downloading&lt;/a&gt;&lt;/code&gt; that is
+     &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
+     event&lt;/a&gt; named &lt;code title=event-appcache-downloading&gt;&lt;a href=#event-appcache-downloading&gt;downloading&lt;/a&gt;&lt;/code&gt; that is
      cancelable at the &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of that
      &lt;a href=#cache-host&gt;cache host&lt;/a&gt;. The default action of this event must
      be, if the user agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the
@@ -54304,8 +54306,8 @@
 
      &lt;li&gt;&lt;p&gt;For each &lt;a href=#cache-host&gt;cache host&lt;/a&gt; associated with an
      &lt;a href=#application-cache&gt;application cache&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache
-     group&lt;/var&gt;, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
-     event&lt;/a&gt; that is cancelable named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; at the
+     group&lt;/var&gt;, &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a
+     simple event&lt;/a&gt; that is cancelable named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; at the
      &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the &lt;a href=#cache-host&gt;cache
      host&lt;/a&gt;. The default action of these events must be, if the
      user agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the display of
@@ -54323,8 +54325,8 @@
 
    &lt;li&gt;&lt;p&gt;If this is a &lt;a href=#concept-appcache-cache title=concept-appcache-cache&gt;cache
    attempt&lt;/a&gt;, then this algorithm was invoked with a &lt;a href=#cache-host&gt;cache
-   host&lt;/a&gt;; &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
-   event&lt;/a&gt; named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; that is cancelable
+   host&lt;/a&gt;; &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a
+   simple event&lt;/a&gt; named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; that is cancelable
    at the &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of that &lt;a href=#cache-host&gt;cache
    host&lt;/a&gt;. The default action of this event must be, if the user
    agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the display of some sort
@@ -54396,8 +54398,8 @@
 
      &lt;li&gt;&lt;p&gt;Let the &lt;a href=#concept-appcache-status title=concept-appcache-status&gt;status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; be &lt;i&gt;idle&lt;/i&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt;
-     that task.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-post-load-task title=&quot;queue a post-load
+     task&quot;&gt;queue that task as a post-load task&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Abort the &lt;a href=#application-cache-download-process&gt;application cache download
      process&lt;/a&gt;.&lt;/li&gt;
@@ -54482,8 +54484,8 @@
 
      &lt;li&gt;&lt;p&gt;Let the &lt;a href=#concept-appcache-status title=concept-appcache-status&gt;status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; be &lt;i&gt;idle&lt;/i&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt;
-     that task.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-post-load-task title=&quot;queue a post-load
+     task&quot;&gt;queue that task as a post-load task&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Abort the &lt;a href=#application-cache-download-process&gt;application cache download
      process&lt;/a&gt;.&lt;/li&gt;
@@ -54504,8 +54506,8 @@
 
    &lt;li&gt;&lt;p&gt;For each &lt;a href=#cache-host&gt;cache host&lt;/a&gt; associated with an
    &lt;a href=#application-cache&gt;application cache&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;,
-   &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; that
-   is cancelable named &lt;code title=event-appcache-downloading&gt;&lt;a href=#event-appcache-downloading&gt;downloading&lt;/a&gt;&lt;/code&gt; at the
+   &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
+   event&lt;/a&gt; that is cancelable named &lt;code title=event-appcache-downloading&gt;&lt;a href=#event-appcache-downloading&gt;downloading&lt;/a&gt;&lt;/code&gt; at the
    &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the &lt;a href=#cache-host&gt;cache
    host&lt;/a&gt;. The default action of these events must be, if the
    user agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the display of some
@@ -54554,9 +54556,9 @@
 
      &lt;li&gt;&lt;p&gt;For each &lt;a href=#cache-host&gt;cache host&lt;/a&gt; associated with an
      &lt;a href=#application-cache&gt;application cache&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache
-     group&lt;/var&gt;, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire an event with the
-     name &lt;code title=event-appcache-progress&gt;&lt;a href=#event-appcache-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, which
-     does not bubble, which is cancelable, and which uses the
+     group&lt;/var&gt;, &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to fire an event
+     with the name &lt;code title=event-appcache-progress&gt;&lt;a href=#event-appcache-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, which does not
+     bubble, which is cancelable, and which uses the
      &lt;code&gt;ProgressEvent&lt;/code&gt; interface, at the
      &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the &lt;a href=#cache-host&gt;cache
      host&lt;/a&gt;. The &lt;code title=dom-ProgressEvents-lengthComputable&gt;lengthComputable&lt;/code&gt;
@@ -54682,8 +54684,9 @@
 
    &lt;li&gt;&lt;p&gt;For each &lt;a href=#cache-host&gt;cache host&lt;/a&gt; associated with an
    &lt;a href=#application-cache&gt;application cache&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;,
-   &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire an event with the name &lt;code title=event-appcache-progress&gt;&lt;a href=#event-appcache-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, which does not
-   bubble, which is cancelable, and which uses the
+   &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to fire an event with the name
+   &lt;code title=event-appcache-progress&gt;&lt;a href=#event-appcache-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, which does
+   not bubble, which is cancelable, and which uses the
    &lt;code&gt;ProgressEvent&lt;/code&gt; interface, at the
    &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the &lt;a href=#cache-host&gt;cache
    host&lt;/a&gt;. The &lt;code title=dom-ProgressEvents-lengthComputable&gt;lengthComputable&lt;/code&gt;
@@ -54716,7 +54719,7 @@
     &lt;ol&gt;&lt;li&gt;&lt;p&gt;Unassociate the &lt;code&gt;Document&lt;/code&gt; for this entry from
      &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
+     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-post-load-task&gt;Queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
      event&lt;/a&gt; that is cancelable named &lt;code title=event-appcache-error&gt;&lt;a href=#event-appcache-error&gt;error&lt;/a&gt;&lt;/code&gt; at the
      &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the
      &lt;code&gt;Document&lt;/code&gt; for this entry, if there still is one. The
@@ -54818,8 +54821,8 @@
    status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; to
    &lt;i&gt;idle&lt;/i&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt;
-   that task.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-post-load-task title=&quot;queue a post-load
+   task&quot;&gt;queue that task as a post-oad task&lt;/a&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;The &lt;dfn id=cache-failure-steps&gt;cache failure steps&lt;/dfn&gt; are as follows:&lt;/p&gt;
 
@@ -54878,8 +54881,8 @@
    attempt&lt;/a&gt;, discard &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;
    altogether.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt;
-   that task.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-post-load-task title=&quot;queue a post-load
+   task&quot;&gt;queue that task as a post-load task&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Abort the &lt;a href=#application-cache-download-process&gt;application cache download
    process&lt;/a&gt;.&lt;/li&gt;
@@ -54895,7 +54898,28 @@
   allows user agents to keep caches primed and to update caches even
   before the user visits a site.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for these &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; is the &lt;a href=#networking-task-source&gt;networking task
+  &lt;hr&gt;&lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; has a list of &lt;dfn id=pending-application-cache-download-process-tasks&gt;pending application
+  cache download process tasks&lt;/dfn&gt; that is used to delay events
+  fired by the algorithm above until the document's &lt;code title=event-load&gt;load&lt;/code&gt; event has fired. When the
+  &lt;code&gt;Document&lt;/code&gt; is created, the list must be empty.&lt;/p&gt;
+
+  &lt;p&gt;When the steps above say to &lt;dfn id=queue-a-post-load-task&gt;queue a post-load task&lt;/dfn&gt;
+  &lt;var title=&quot;&quot;&gt;task&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;task&lt;/var&gt; is a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that dispatches an event on a
+  target &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;, the user agent must run the appropriate steps
+  from the following list:&lt;/p&gt;
+
+  &lt;dl&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s &lt;code&gt;Document&lt;/code&gt; has
+   &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;&lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;Queue&lt;/a&gt; the task &lt;var title=&quot;&quot;&gt;task&lt;/var&gt;.&lt;/dd&gt;
+
+   &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;task&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s
+   &lt;code&gt;Document&lt;/code&gt;'s list of &lt;a href=#pending-application-cache-download-process-tasks&gt;pending application cache
+   download process tasks&lt;/a&gt;.&lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for these &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; is the &lt;a href=#networking-task-source&gt;networking task
   source&lt;/a&gt;.&lt;/p&gt;
   
 
@@ -76627,9 +76651,21 @@
    must bubble but not be cancelable and has no default
    action.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; mentioned in this section is the
-  &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task source&lt;/a&gt;.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt; has any &lt;a href=#pending-application-cache-download-process-tasks&gt;pending
+   application cache download process tasks&lt;/a&gt;, then &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt; each such &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in the order they were added to
+   the list of &lt;a href=#pending-application-cache-download-process-tasks&gt;pending application cache download process
+   tasks&lt;/a&gt;, and then empty the list of &lt;a href=#pending-application-cache-download-process-tasks&gt;pending application
+   cache download process tasks&lt;/a&gt;. The &lt;a href=#task-source&gt;task source&lt;/a&gt;
+   for these &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; is the
+   &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;The &lt;code&gt;Document&lt;/code&gt; is now &lt;dfn id=completely-loaded&gt;completely
+   loaded&lt;/dfn&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;Except where otherwise specified, the &lt;a href=#task-source&gt;task source&lt;/a&gt;
+  for the &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; mentioned in this
+  section is the &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task source&lt;/a&gt;.&lt;/p&gt;
+
   &lt;/div&gt;
 
 

Modified: index
===================================================================
--- index	2010-01-12 11:45:42 UTC (rev 4581)
+++ index	2010-01-13 01:35:55 UTC (rev 4582)
@@ -112,7 +112,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;HTML5 (including next generation additions still in development)&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 12 January 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 13 January 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -54124,6 +54124,8 @@
   not show prominent update progress notifications for applications
   that cancel the relevant events.&lt;/p&gt;
 
+  &lt;p class=note&gt;These events are delayed until after the &lt;code title=event-load&gt;load&lt;/code&gt; event has fired.&lt;/p&gt;
+
   &lt;p&gt;The &lt;a href=#application-cache-download-process&gt;application cache download process&lt;/a&gt; steps are as
   follows:
 
@@ -54186,8 +54188,8 @@
 
      &lt;li&gt;&lt;p&gt;If these steps were invoked with a &lt;a href=#cache-host&gt;cache
      host&lt;/a&gt;, and the &lt;a href=#concept-appcache-status title=concept-appcache-status&gt;status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; is &lt;i&gt;checking&lt;/i&gt; or
-     &lt;i&gt;downloading&lt;/i&gt;, then &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire
-     a simple event&lt;/a&gt; named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; that is
+     &lt;i&gt;downloading&lt;/i&gt;, then &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to
+     &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; that is
      cancelable at the &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of that
      &lt;a href=#cache-host&gt;cache host&lt;/a&gt;. The default action of this event must
      be, if the user agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the
@@ -54197,8 +54199,8 @@
 
      &lt;li&gt;&lt;p&gt;If these steps were invoked with a &lt;a href=#cache-host&gt;cache
      host&lt;/a&gt;, and the &lt;a href=#concept-appcache-status title=concept-appcache-status&gt;status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; is &lt;i&gt;downloading&lt;/i&gt;, then also
-     &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt;
-     named &lt;code title=event-appcache-downloading&gt;&lt;a href=#event-appcache-downloading&gt;downloading&lt;/a&gt;&lt;/code&gt; that is
+     &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
+     event&lt;/a&gt; named &lt;code title=event-appcache-downloading&gt;&lt;a href=#event-appcache-downloading&gt;downloading&lt;/a&gt;&lt;/code&gt; that is
      cancelable at the &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of that
      &lt;a href=#cache-host&gt;cache host&lt;/a&gt;. The default action of this event must
      be, if the user agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the
@@ -54215,8 +54217,8 @@
 
      &lt;li&gt;&lt;p&gt;For each &lt;a href=#cache-host&gt;cache host&lt;/a&gt; associated with an
      &lt;a href=#application-cache&gt;application cache&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache
-     group&lt;/var&gt;, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
-     event&lt;/a&gt; that is cancelable named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; at the
+     group&lt;/var&gt;, &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a
+     simple event&lt;/a&gt; that is cancelable named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; at the
      &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the &lt;a href=#cache-host&gt;cache
      host&lt;/a&gt;. The default action of these events must be, if the
      user agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the display of
@@ -54234,8 +54236,8 @@
 
    &lt;li&gt;&lt;p&gt;If this is a &lt;a href=#concept-appcache-cache title=concept-appcache-cache&gt;cache
    attempt&lt;/a&gt;, then this algorithm was invoked with a &lt;a href=#cache-host&gt;cache
-   host&lt;/a&gt;; &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
-   event&lt;/a&gt; named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; that is cancelable
+   host&lt;/a&gt;; &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a
+   simple event&lt;/a&gt; named &lt;code title=event-appcache-checking&gt;&lt;a href=#event-appcache-checking&gt;checking&lt;/a&gt;&lt;/code&gt; that is cancelable
    at the &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of that &lt;a href=#cache-host&gt;cache
    host&lt;/a&gt;. The default action of this event must be, if the user
    agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the display of some sort
@@ -54307,8 +54309,8 @@
 
      &lt;li&gt;&lt;p&gt;Let the &lt;a href=#concept-appcache-status title=concept-appcache-status&gt;status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; be &lt;i&gt;idle&lt;/i&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt;
-     that task.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-post-load-task title=&quot;queue a post-load
+     task&quot;&gt;queue that task as a post-load task&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Abort the &lt;a href=#application-cache-download-process&gt;application cache download
      process&lt;/a&gt;.&lt;/li&gt;
@@ -54393,8 +54395,8 @@
 
      &lt;li&gt;&lt;p&gt;Let the &lt;a href=#concept-appcache-status title=concept-appcache-status&gt;status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; be &lt;i&gt;idle&lt;/i&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt;
-     that task.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-post-load-task title=&quot;queue a post-load
+     task&quot;&gt;queue that task as a post-load task&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Abort the &lt;a href=#application-cache-download-process&gt;application cache download
      process&lt;/a&gt;.&lt;/li&gt;
@@ -54415,8 +54417,8 @@
 
    &lt;li&gt;&lt;p&gt;For each &lt;a href=#cache-host&gt;cache host&lt;/a&gt; associated with an
    &lt;a href=#application-cache&gt;application cache&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;,
-   &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; that
-   is cancelable named &lt;code title=event-appcache-downloading&gt;&lt;a href=#event-appcache-downloading&gt;downloading&lt;/a&gt;&lt;/code&gt; at the
+   &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
+   event&lt;/a&gt; that is cancelable named &lt;code title=event-appcache-downloading&gt;&lt;a href=#event-appcache-downloading&gt;downloading&lt;/a&gt;&lt;/code&gt; at the
    &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the &lt;a href=#cache-host&gt;cache
    host&lt;/a&gt;. The default action of these events must be, if the
    user agent &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the display of some
@@ -54465,9 +54467,9 @@
 
      &lt;li&gt;&lt;p&gt;For each &lt;a href=#cache-host&gt;cache host&lt;/a&gt; associated with an
      &lt;a href=#application-cache&gt;application cache&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache
-     group&lt;/var&gt;, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire an event with the
-     name &lt;code title=event-appcache-progress&gt;&lt;a href=#event-appcache-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, which
-     does not bubble, which is cancelable, and which uses the
+     group&lt;/var&gt;, &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to fire an event
+     with the name &lt;code title=event-appcache-progress&gt;&lt;a href=#event-appcache-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, which does not
+     bubble, which is cancelable, and which uses the
      &lt;code&gt;ProgressEvent&lt;/code&gt; interface, at the
      &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the &lt;a href=#cache-host&gt;cache
      host&lt;/a&gt;. The &lt;code title=dom-ProgressEvents-lengthComputable&gt;lengthComputable&lt;/code&gt;
@@ -54593,8 +54595,9 @@
 
    &lt;li&gt;&lt;p&gt;For each &lt;a href=#cache-host&gt;cache host&lt;/a&gt; associated with an
    &lt;a href=#application-cache&gt;application cache&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;,
-   &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire an event with the name &lt;code title=event-appcache-progress&gt;&lt;a href=#event-appcache-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, which does not
-   bubble, which is cancelable, and which uses the
+   &lt;a href=#queue-a-post-load-task&gt;queue a post-load task&lt;/a&gt; to fire an event with the name
+   &lt;code title=event-appcache-progress&gt;&lt;a href=#event-appcache-progress&gt;progress&lt;/a&gt;&lt;/code&gt;, which does
+   not bubble, which is cancelable, and which uses the
    &lt;code&gt;ProgressEvent&lt;/code&gt; interface, at the
    &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the &lt;a href=#cache-host&gt;cache
    host&lt;/a&gt;. The &lt;code title=dom-ProgressEvents-lengthComputable&gt;lengthComputable&lt;/code&gt;
@@ -54627,7 +54630,7 @@
     &lt;ol&gt;&lt;li&gt;&lt;p&gt;Unassociate the &lt;code&gt;Document&lt;/code&gt; for this entry from
      &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
+     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-post-load-task&gt;Queue a post-load task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
      event&lt;/a&gt; that is cancelable named &lt;code title=event-appcache-error&gt;&lt;a href=#event-appcache-error&gt;error&lt;/a&gt;&lt;/code&gt; at the
      &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; singleton of the
      &lt;code&gt;Document&lt;/code&gt; for this entry, if there still is one. The
@@ -54729,8 +54732,8 @@
    status&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt; to
    &lt;i&gt;idle&lt;/i&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt;
-   that task.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-post-load-task title=&quot;queue a post-load
+   task&quot;&gt;queue that task as a post-oad task&lt;/a&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;The &lt;dfn id=cache-failure-steps&gt;cache failure steps&lt;/dfn&gt; are as follows:&lt;/p&gt;
 
@@ -54789,8 +54792,8 @@
    attempt&lt;/a&gt;, discard &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;
    altogether.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt;
-   that task.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;For each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;a href=#queue-a-post-load-task title=&quot;queue a post-load
+   task&quot;&gt;queue that task as a post-load task&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Abort the &lt;a href=#application-cache-download-process&gt;application cache download
    process&lt;/a&gt;.&lt;/li&gt;
@@ -54806,7 +54809,28 @@
   allows user agents to keep caches primed and to update caches even
   before the user visits a site.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for these &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; is the &lt;a href=#networking-task-source&gt;networking task
+  &lt;hr&gt;&lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; has a list of &lt;dfn id=pending-application-cache-download-process-tasks&gt;pending application
+  cache download process tasks&lt;/dfn&gt; that is used to delay events
+  fired by the algorithm above until the document's &lt;code title=event-load&gt;load&lt;/code&gt; event has fired. When the
+  &lt;code&gt;Document&lt;/code&gt; is created, the list must be empty.&lt;/p&gt;
+
+  &lt;p&gt;When the steps above say to &lt;dfn id=queue-a-post-load-task&gt;queue a post-load task&lt;/dfn&gt;
+  &lt;var title=&quot;&quot;&gt;task&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;task&lt;/var&gt; is a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that dispatches an event on a
+  target &lt;code&gt;&lt;a href=#applicationcache&gt;ApplicationCache&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;, the user agent must run the appropriate steps
+  from the following list:&lt;/p&gt;
+
+  &lt;dl&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s &lt;code&gt;Document&lt;/code&gt; has
+   &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;&lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;Queue&lt;/a&gt; the task &lt;var title=&quot;&quot;&gt;task&lt;/var&gt;.&lt;/dd&gt;
+
+   &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;task&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s
+   &lt;code&gt;Document&lt;/code&gt;'s list of &lt;a href=#pending-application-cache-download-process-tasks&gt;pending application cache
+   download process tasks&lt;/a&gt;.&lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for these &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; is the &lt;a href=#networking-task-source&gt;networking task
   source&lt;/a&gt;.&lt;/p&gt;
   
 
@@ -70981,9 +71005,21 @@
    must bubble but not be cancelable and has no default
    action.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; mentioned in this section is the
-  &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task source&lt;/a&gt;.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt; has any &lt;a href=#pending-application-cache-download-process-tasks&gt;pending
+   application cache download process tasks&lt;/a&gt;, then &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queue&lt;/a&gt; each such &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in the order they were added to
+   the list of &lt;a href=#pending-application-cache-download-process-tasks&gt;pending application cache download process
+   tasks&lt;/a&gt;, and then empty the list of &lt;a href=#pending-application-cache-download-process-tasks&gt;pending application
+   cache download process tasks&lt;/a&gt;. The &lt;a href=#task-source&gt;task source&lt;/a&gt;
+   for these &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; is the
+   &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;The &lt;code&gt;Document&lt;/code&gt; is now &lt;dfn id=completely-loaded&gt;completely
+   loaded&lt;/dfn&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;Except where otherwise specified, the &lt;a href=#task-source&gt;task source&lt;/a&gt;
+  for the &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; mentioned in this
+  section is the &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task source&lt;/a&gt;.&lt;/p&gt;
+
   &lt;/div&gt;
 
 

Modified: source
===================================================================
--- source	2010-01-12 11:45:42 UTC (rev 4581)
+++ source	2010-01-13 01:35:55 UTC (rev 4582)
@@ -61189,6 +61189,9 @@
   not show prominent update progress notifications for applications
   that cancel the relevant events.&lt;/p&gt;
 
+  &lt;p class=&quot;note&quot;&gt;These events are delayed until after the &lt;code
+  title=&quot;event-load&quot;&gt;load&lt;/code&gt; event has fired.&lt;/p&gt;
+
   &lt;p&gt;The &lt;span&gt;application cache download process&lt;/span&gt; steps are as
   follows:
 
@@ -61268,8 +61271,8 @@
      host&lt;/span&gt;, and the &lt;span
      title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt; of &lt;var
      title=&quot;&quot;&gt;cache group&lt;/var&gt; is &lt;i&gt;checking&lt;/i&gt; or
-     &lt;i&gt;downloading&lt;/i&gt;, then &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire
-     a simple event&lt;/span&gt; named &lt;code
+     &lt;i&gt;downloading&lt;/i&gt;, then &lt;span&gt;queue a post-load task&lt;/span&gt; to
+     &lt;span&gt;fire a simple event&lt;/span&gt; named &lt;code
      title=&quot;event-appcache-checking&quot;&gt;checking&lt;/code&gt; that is
      cancelable at the &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of that
      &lt;span&gt;cache host&lt;/span&gt;. The default action of this event must
@@ -61282,8 +61285,8 @@
      host&lt;/span&gt;, and the &lt;span
      title=&quot;concept-appcache-status&quot;&gt;status&lt;/span&gt; of &lt;var
      title=&quot;&quot;&gt;cache group&lt;/var&gt; is &lt;i&gt;downloading&lt;/i&gt;, then also
-     &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire a simple event&lt;/span&gt;
-     named &lt;code
+     &lt;span&gt;queue a post-load task&lt;/span&gt; to &lt;span&gt;fire a simple
+     event&lt;/span&gt; named &lt;code
      title=&quot;event-appcache-downloading&quot;&gt;downloading&lt;/code&gt; that is
      cancelable at the &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of that
      &lt;span&gt;cache host&lt;/span&gt;. The default action of this event must
@@ -61303,8 +61306,8 @@
 
      &lt;li&gt;&lt;p&gt;For each &lt;span&gt;cache host&lt;/span&gt; associated with an
      &lt;span&gt;application cache&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;cache
-     group&lt;/var&gt;, &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire a simple
-     event&lt;/span&gt; that is cancelable named &lt;code
+     group&lt;/var&gt;, &lt;span&gt;queue a post-load task&lt;/span&gt; to &lt;span&gt;fire a
+     simple event&lt;/span&gt; that is cancelable named &lt;code
      title=&quot;event-appcache-checking&quot;&gt;checking&lt;/code&gt; at the
      &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of the &lt;span&gt;cache
      host&lt;/span&gt;. The default action of these events must be, if the
@@ -61326,8 +61329,8 @@
 
    &lt;li&gt;&lt;p&gt;If this is a &lt;span title=&quot;concept-appcache-cache&quot;&gt;cache
    attempt&lt;/span&gt;, then this algorithm was invoked with a &lt;span&gt;cache
-   host&lt;/span&gt;; &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire a simple
-   event&lt;/span&gt; named &lt;code
+   host&lt;/span&gt;; &lt;span&gt;queue a post-load task&lt;/span&gt; to &lt;span&gt;fire a
+   simple event&lt;/span&gt; named &lt;code
    title=&quot;event-appcache-checking&quot;&gt;checking&lt;/code&gt; that is cancelable
    at the &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of that &lt;span&gt;cache
    host&lt;/span&gt;. The default action of this event must be, if the user
@@ -61416,8 +61419,8 @@
      title=&quot;&quot;&gt;cache group&lt;/var&gt; be &lt;i&gt;idle&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;For each &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; in &lt;var
-     title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;span title=&quot;queue a task&quot;&gt;queue&lt;/span&gt;
-     that task.&lt;/p&gt;&lt;/li&gt;
+     title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;span title=&quot;queue a post-load
+     task&quot;&gt;queue that task as a post-load task&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Abort the &lt;span&gt;application cache download
      process&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -61521,8 +61524,8 @@
      title=&quot;&quot;&gt;cache group&lt;/var&gt; be &lt;i&gt;idle&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;For each &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; in &lt;var
-     title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;span title=&quot;queue a task&quot;&gt;queue&lt;/span&gt;
-     that task.&lt;/p&gt;&lt;/li&gt;
+     title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;span title=&quot;queue a post-load
+     task&quot;&gt;queue that task as a post-load task&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Abort the &lt;span&gt;application cache download
      process&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -61547,8 +61550,8 @@
 
    &lt;li&gt;&lt;p&gt;For each &lt;span&gt;cache host&lt;/span&gt; associated with an
    &lt;span&gt;application cache&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;,
-   &lt;span&gt;queue a task&lt;/span&gt; to &lt;span&gt;fire a simple event&lt;/span&gt; that
-   is cancelable named &lt;code
+   &lt;span&gt;queue a post-load task&lt;/span&gt; to &lt;span&gt;fire a simple
+   event&lt;/span&gt; that is cancelable named &lt;code
    title=&quot;event-appcache-downloading&quot;&gt;downloading&lt;/code&gt; at the
    &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of the &lt;span&gt;cache
    host&lt;/span&gt;. The default action of these events must be, if the
@@ -61605,9 +61608,10 @@
 
      &lt;li&gt;&lt;p&gt;For each &lt;span&gt;cache host&lt;/span&gt; associated with an
      &lt;span&gt;application cache&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;cache
-     group&lt;/var&gt;, &lt;span&gt;queue a task&lt;/span&gt; to fire an event with the
-     name &lt;code title=&quot;event-appcache-progress&quot;&gt;progress&lt;/code&gt;, which
-     does not bubble, which is cancelable, and which uses the
+     group&lt;/var&gt;, &lt;span&gt;queue a post-load task&lt;/span&gt; to fire an event
+     with the name &lt;code
+     title=&quot;event-appcache-progress&quot;&gt;progress&lt;/code&gt;, which does not
+     bubble, which is cancelable, and which uses the
      &lt;code&gt;ProgressEvent&lt;/code&gt; interface, at the
      &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of the &lt;span&gt;cache
      host&lt;/span&gt;. The &lt;code
@@ -61747,9 +61751,9 @@
 
    &lt;li&gt;&lt;p&gt;For each &lt;span&gt;cache host&lt;/span&gt; associated with an
    &lt;span&gt;application cache&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;,
-   &lt;span&gt;queue a task&lt;/span&gt; to fire an event with the name &lt;code
-   title=&quot;event-appcache-progress&quot;&gt;progress&lt;/code&gt;, which does not
-   bubble, which is cancelable, and which uses the
+   &lt;span&gt;queue a post-load task&lt;/span&gt; to fire an event with the name
+   &lt;code title=&quot;event-appcache-progress&quot;&gt;progress&lt;/code&gt;, which does
+   not bubble, which is cancelable, and which uses the
    &lt;code&gt;ProgressEvent&lt;/code&gt; interface, at the
    &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of the &lt;span&gt;cache
    host&lt;/span&gt;. The &lt;code
@@ -61792,7 +61796,7 @@
      &lt;li&gt;&lt;p&gt;Unassociate the &lt;code&gt;Document&lt;/code&gt; for this entry from
      &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to &lt;span&gt;fire a simple
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a post-load task&lt;/span&gt; to &lt;span&gt;fire a simple
      event&lt;/span&gt; that is cancelable named &lt;code
      title=&quot;event-appcache-error&quot;&gt;error&lt;/code&gt; at the
      &lt;code&gt;ApplicationCache&lt;/code&gt; singleton of the
@@ -61914,8 +61918,8 @@
    &lt;i&gt;idle&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;For each &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; in &lt;var
-   title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;span title=&quot;queue a task&quot;&gt;queue&lt;/span&gt;
-   that task.&lt;/p&gt;&lt;/li&gt;
+   title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;span title=&quot;queue a post-load
+   task&quot;&gt;queue that task as a post-oad task&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
@@ -61989,8 +61993,8 @@
    altogether.&lt;/p&gt;
 
    &lt;li&gt;&lt;p&gt;For each &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; in &lt;var
-   title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;span title=&quot;queue a task&quot;&gt;queue&lt;/span&gt;
-   that task.&lt;/p&gt;&lt;/li&gt;
+   title=&quot;&quot;&gt;task list&lt;/var&gt;, &lt;span title=&quot;queue a post-load
+   task&quot;&gt;queue that task as a post-load task&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Abort the &lt;span&gt;application cache download
    process&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -62010,6 +62014,37 @@
   allows user agents to keep caches primed and to update caches even
   before the user visits a site.&lt;/p&gt;
 
+  &lt;hr&gt;
+
+  &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; has a list of &lt;dfn&gt;pending application
+  cache download process tasks&lt;/dfn&gt; that is used to delay events
+  fired by the algorithm above until the document's &lt;code
+  title=&quot;event-load&quot;&gt;load&lt;/code&gt; event has fired. When the
+  &lt;code&gt;Document&lt;/code&gt; is created, the list must be empty.&lt;/p&gt;
+
+  &lt;p&gt;When the steps above say to &lt;dfn&gt;queue a post-load task&lt;/dfn&gt;
+  &lt;var title=&quot;&quot;&gt;task&lt;/var&gt;, where &lt;var title=&quot;&quot;&gt;task&lt;/var&gt; is a &lt;span
+  title=&quot;concept-task&quot;&gt;task&lt;/span&gt; that dispatches an event on a
+  target &lt;code&gt;ApplicationCache&lt;/code&gt; object &lt;var
+  title=&quot;&quot;&gt;target&lt;/var&gt;, the user agent must run the appropriate steps
+  from the following list:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s &lt;code&gt;Document&lt;/code&gt; has
+   &lt;span&gt;completely loaded&lt;/span&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;&lt;span title=&quot;queue a task&quot;&gt;Queue&lt;/span&gt; the task &lt;var
+   title=&quot;&quot;&gt;task&lt;/var&gt;.&lt;/p&gt;&lt;/dd&gt;
+
+   &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+   &lt;dd&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;task&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;'s
+   &lt;code&gt;Document&lt;/code&gt;'s list of &lt;span&gt;pending application cache
+   download process tasks&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
   &lt;p&gt;The &lt;span&gt;task source&lt;/span&gt; for these &lt;span
   title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; is the &lt;span&gt;networking task
   source&lt;/span&gt;.&lt;/p&gt;
@@ -87418,11 +87453,24 @@
    must bubble but not be cancelable and has no default
    action.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt; has any &lt;span&gt;pending
+   application cache download process tasks&lt;/span&gt;, then &lt;span
+   title=&quot;queue a task&quot;&gt;queue&lt;/span&gt; each such &lt;span
+   title=&quot;concept-task&quot;&gt;task&lt;/span&gt; in the order they were added to
+   the list of &lt;span&gt;pending application cache download process
+   tasks&lt;/span&gt;, and then empty the list of &lt;span&gt;pending application
+   cache download process tasks&lt;/span&gt;. The &lt;span&gt;task source&lt;/span&gt;
+   for these &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; is the
+   &lt;span&gt;networking task source&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The &lt;code&gt;Document&lt;/code&gt; is now &lt;dfn&gt;completely
+   loaded&lt;/dfn&gt;.&lt;/p&gt;&lt;/li&gt;
+
   &lt;/ol&gt;
 
-  &lt;p&gt;The &lt;span&gt;task source&lt;/span&gt; for the &lt;span
-  title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; mentioned in this section is the
-  &lt;span&gt;DOM manipulation task source&lt;/span&gt;.&lt;/p&gt;
+  &lt;p&gt;Except where otherwise specified, the &lt;span&gt;task source&lt;/span&gt;
+  for the &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; mentioned in this
+  section is the &lt;span&gt;DOM manipulation task source&lt;/span&gt;.&lt;/p&gt;
 
   &lt;/div&gt;
 


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011449.html">[html5] r4581 - [acgiow] (0) Provide a safe way to host hostile	content for use with an &lt;iframe [...]
</A></li>
	<LI>Next message: <A HREF="011451.html">[html5] r4583 - [e] (0) Correct the list of events that fire during	copy&amp;paste.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11450">[ date ]</a>
              <a href="thread.html#11450">[ thread ]</a>
              <a href="subject.html#11450">[ subject ]</a>
              <a href="author.html#11450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
