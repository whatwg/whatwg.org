<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r4632 - [agiow] (2) Make history traversal unrelated to	history truncation always async. [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4632%20-%20%5Bagiow%5D%20%282%29%20Make%20history%20traversal%20unrelated%20to%0A%09history%20truncation%20always%20async.%20%5B...%5D&In-Reply-To=%3C20100129013140.E57D11C84004%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011499.html">
   <LINK REL="Next"  HREF="011501.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r4632 - [agiow] (2) Make history traversal unrelated to	history truncation always async. [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4632%20-%20%5Bagiow%5D%20%282%29%20Make%20history%20traversal%20unrelated%20to%0A%09history%20truncation%20always%20async.%20%5B...%5D&In-Reply-To=%3C20100129013140.E57D11C84004%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r4632 - [agiow] (2) Make history traversal unrelated to	history truncation always async. [...]">whatwg at whatwg.org
       </A><BR>
    <I>Thu Jan 28 17:31:40 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="011499.html">[html5] r4631 - [giowt] (0) Update to new DC term.
</A></li>
        <LI>Next message: <A HREF="011501.html">[html5] r4633 - [giowt] (0) Microdata: Make the RDF output not	generate duplicate blank nodes fo [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11500">[ date ]</a>
              <a href="thread.html#11500">[ thread ]</a>
              <a href="subject.html#11500">[ subject ]</a>
              <a href="author.html#11500">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-01-28 17:31:38 -0800 (Thu, 28 Jan 2010)
New Revision: 4632

Modified:
   complete.html
   index
   source
Log:
[agiow] (2) Make history traversal unrelated to history truncation always async. Make popstate/hashchange async. Add context information to hashchange.

Modified: complete.html
===================================================================
--- complete.html	2010-01-28 01:22:24 UTC (rev 4631)
+++ complete.html	2010-01-29 01:31:38 UTC (rev 4632)
@@ -110,7 +110,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;Web Applications 1.0&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 28 January 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 29 January 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -728,11 +728,10 @@
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#the-session-history-of-browsing-contexts&gt;&lt;span class=secno&gt;6.10.1 &lt;/span&gt;The session history of browsing contexts&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-history-interface&gt;&lt;span class=secno&gt;6.10.2 &lt;/span&gt;The &lt;code&gt;History&lt;/code&gt; interface&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#activating-state-object-entries&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;Activating state object entries&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#the-location-interface&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;The &lt;code&gt;Location&lt;/code&gt; interface&lt;/a&gt;
+     &lt;li&gt;&lt;a href=#the-location-interface&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;The &lt;code&gt;Location&lt;/code&gt; interface&lt;/a&gt;
       &lt;ol&gt;
-       &lt;li&gt;&lt;a href=#security-3&gt;&lt;span class=secno&gt;6.10.4.1 &lt;/span&gt;Security&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#history-notes&gt;&lt;span class=secno&gt;6.10.5 &lt;/span&gt;Implementation notes for session history&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#security-3&gt;&lt;span class=secno&gt;6.10.3.1 &lt;/span&gt;Security&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#history-notes&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;Implementation notes for session history&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#browsing-the-web&gt;&lt;span class=secno&gt;6.11 &lt;/span&gt;Browsing the Web&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#navigating-across-documents&gt;&lt;span class=secno&gt;6.11.1 &lt;/span&gt;Navigating across documents&lt;/a&gt;&lt;/li&gt;
@@ -743,7 +742,9 @@
      &lt;li&gt;&lt;a href=#read-plugin&gt;&lt;span class=secno&gt;6.11.6 &lt;/span&gt;Page load processing model for content that uses plugins&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#read-ua-inline&gt;&lt;span class=secno&gt;6.11.7 &lt;/span&gt;Page load processing model for inline content that doesn't have a DOM&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#scroll-to-fragid&gt;&lt;span class=secno&gt;6.11.8 &lt;/span&gt;Navigating to a fragment identifier&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#history-traversal&gt;&lt;span class=secno&gt;6.11.9 &lt;/span&gt;History traversal&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#history-traversal&gt;&lt;span class=secno&gt;6.11.9 &lt;/span&gt;History traversal&lt;/a&gt;
+      &lt;ol&gt;
+       &lt;li&gt;&lt;a href=#event-definitions&gt;&lt;span class=secno&gt;6.11.9.1 &lt;/span&gt;Event definitions&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#unloading-documents&gt;&lt;span class=secno&gt;6.11.10 &lt;/span&gt;Unloading documents&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#event-definition&gt;&lt;span class=secno&gt;6.11.10.1 &lt;/span&gt;Event definition&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
@@ -893,7 +894,7 @@
      &lt;li&gt;&lt;a href=#worker-locations&gt;&lt;span class=secno&gt;9.3.5 &lt;/span&gt;Worker locations&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#comms&gt;&lt;span class=secno&gt;10 &lt;/span&gt;Communication&lt;/a&gt;
   &lt;ol&gt;
-   &lt;li&gt;&lt;a href=#event-definitions&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Event definitions&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#event-definitions-0&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Event definitions&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#server-sent-events&gt;&lt;span class=secno&gt;10.2 &lt;/span&gt;Server-sent events&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#server-sent-events-intro&gt;&lt;span class=secno&gt;10.2.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
@@ -9856,21 +9857,20 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Remove any &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; queued by
+   the &lt;a href=#history-traversal-task-source&gt;history traversal task source&lt;/a&gt;.&lt;/li&gt;
+
    &lt;li&gt;Remove any earlier entries that share the same
    &lt;code&gt;Document&lt;/code&gt;.&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt; is false, then add a new
+   entry, just before the last entry, and associate with the new entry
+   the text that was parsed by the previous parser associated with the
+   &lt;code&gt;Document&lt;/code&gt; object, as well as the state of the document
+   at the start of these steps. (This allows the user to step
+   backwards in the session history to see the page before it was
+   blown away by the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt; call.)&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt; is false, then add a new entry,
-    just before the last entry, and assocaite with the new entry the
-    text that was parsed by the previous parser associated with the
-    &lt;code&gt;Document&lt;/code&gt; object, as well as the state of the document
-    at the start of these steps. (This allows the user to step
-    backwards in the session history to see the page before it was
-    blown away by the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt; call.)&lt;/p&gt;
-
-   &lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Finally, set the &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt; to point at
    just before the end of the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; (which at this
    point will be empty).&lt;/li&gt;
@@ -20618,8 +20618,10 @@
   its &lt;code title=attr-object-type&gt;&lt;a href=#attr-object-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute is set,
   changed, or removed: the user agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt;
   to run the following steps to (re)determine what the
-  &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt; element represents:&lt;/p&gt;
-  &lt;!-- Changing the base URL doesn't trigger this. --&gt;
+  &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt; element represents. The &lt;a href=#task-source&gt;task source&lt;/a&gt;
+  for this &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; is the &lt;a href=#dom-manipulation-task-source&gt;DOM
+  manipulation task source&lt;/a&gt;.&lt;/p&gt; &lt;!-- Changing the base URL
+  doesn't trigger this. --&gt;
 
   &lt;ol&gt;&lt;li&gt;
 
@@ -20970,10 +20972,7 @@
    &lt;a href=#fallback-content&gt;fallback content&lt;/a&gt;. If the element has an instantiated
    &lt;a href=#plugin&gt;plugin&lt;/a&gt;, then unload it.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; above is the &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation
-  task source&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;p id=object-plugin&gt;When the algorithm above instantiates a
+  &lt;/ol&gt;&lt;p id=object-plugin&gt;When the algorithm above instantiates a
   &lt;a href=#plugin&gt;plugin&lt;/a&gt;, the user agent should pass the names and values
   of all the attributes on the element, and &lt;!-- then a parameter
   named &quot;PARAM&quot; whose value is null, and then --&gt; all the names and
@@ -51934,6 +51933,15 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;The &lt;dfn id=history-traversal-task-source&gt;history traversal task source&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This &lt;a href=#task-source&gt;task source&lt;/a&gt; is used to queue calls to &lt;code title=dom-history-back&gt;&lt;a href=#dom-history-back&gt;history.back()&lt;/a&gt;&lt;/code&gt; and similar
+    APIs.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
   &lt;/dl&gt;&lt;/div&gt;
 
 
@@ -52409,7 +52417,7 @@
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onblur title=handler-window-onblur&gt;&lt;code&gt;onblur&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-blur&gt;blur&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onerror title=handler-window-onerror&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-error&gt;error&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onfocus title=handler-window-onfocus&gt;&lt;code&gt;onfocus&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-focus&gt;focus&lt;/code&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onhashchange title=handler-window-onhashchange&gt;&lt;code&gt;onhashchange&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt; &lt;!-- new --&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onhashchange title=handler-window-onhashchange&gt;&lt;code&gt;onhashchange&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt; &lt;!-- new --&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onload title=handler-window-onload&gt;&lt;code&gt;onload&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-load&gt;load&lt;/code&gt; &lt;!-- widely used --&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onmessage title=handler-window-onmessage&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; &lt;!-- new for postMessage --&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onoffline title=handler-window-onoffline&gt;&lt;code&gt;onoffline&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-offline&gt;&lt;a href=#event-offline&gt;offline&lt;/a&gt;&lt;/code&gt; &lt;!-- new --&gt;
@@ -55939,14 +55947,26 @@
 
   &lt;p&gt;The actual entries are not accessible from script.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-history-go title=dom-history-go&gt;&lt;code&gt;go(&lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method causes the UA to run the
-  following steps:&lt;/p&gt;
+  &lt;p&gt;When the &lt;dfn id=dom-history-go title=dom-history-go&gt;&lt;code&gt;go(&lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, if the
+  argument to the method was omitted or has the value zero, the user
+  agent must act as if the &lt;code title=dom-location-reload&gt;&lt;a href=#dom-location-reload&gt;location.reload()&lt;/a&gt;&lt;/code&gt; method was
+  called instead. Otherwise, the user agent must &lt;a href=#traverse-the-history-by-a-delta&gt;traverse the
+  history by a delta&lt;/a&gt; whose value is the value of the method's
+  argument.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the argument to the method was omitted or has the value
-   zero, then act as if the &lt;code title=dom-location-reload&gt;&lt;a href=#dom-location-reload&gt;location.reload()&lt;/a&gt;&lt;/code&gt; method was
-   called instead, and abort these steps.&lt;/p&gt;
+  &lt;p&gt;When the &lt;dfn id=dom-history-back title=dom-history-back&gt;&lt;code&gt;back()&lt;/code&gt;&lt;/dfn&gt;
+  method is invoked, the user agent must &lt;a href=#traverse-the-history-by-a-delta&gt;traverse the history by
+  a delta&lt;/a&gt; &minus;1.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be the argument to the
+  &lt;p&gt;When the &lt;dfn id=dom-history-forward title=dom-history-forward&gt;&lt;code&gt;forward()&lt;/code&gt;&lt;/dfn&gt;method is
+  invoked, the user agent must &lt;a href=#traverse-the-history-by-a-delta&gt;traverse the history by a
+  delta&lt;/a&gt; +1.&lt;/p&gt;
+
+  &lt;p&gt;To &lt;dfn id=traverse-the-history-by-a-delta&gt;traverse the history by a delta&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;, the user agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt;
+  to run the following steps. The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the
+  queued task is the &lt;a href=#history-traversal-task-source&gt;history traversal task source&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be the argument to the
    method.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the index of the &lt;a href=#current-entry-of-the-joint-session-history&gt;current entry of the joint session
@@ -55962,24 +55982,17 @@
    &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; of the &lt;var title=&quot;&quot;&gt;specified
    entry&lt;/var&gt;.&lt;/li&gt;
 
+   &lt;!-- XXX if going to another doc, try to unload the document here
+   (firing beforeunload, unload, pagehide) --&gt;
+
    &lt;li&gt;&lt;p&gt;&lt;a href=#traverse-the-history&gt;Traverse the history&lt;/a&gt; of the &lt;var title=&quot;&quot;&gt;specified browsing context&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/p&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the user navigates through a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;,
   e.g. using a browser's back and forward buttons, the user agent must
-  translate this action into the equivalent invocations of the &lt;code title=dom-history-go&gt;&lt;a href=#dom-history-go&gt;history.go(&lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;
-  method on the various affected &lt;code title=dom-window&gt;&lt;a href=#dom-window&gt;window&lt;/a&gt;&lt;/code&gt; objects.&lt;/p&gt;
+  &lt;a href=#traverse-the-history-by-a-delta&gt;traverse the history by a delta&lt;/a&gt; equivalent to the
+  action specified by the user.&lt;/p&gt;
 
-  &lt;p&gt;Some of the other members of the &lt;code&gt;&lt;a href=#history-0&gt;History&lt;/a&gt;&lt;/code&gt; interface
-  are defined in terms of the &lt;code title=dom-history-go&gt;&lt;a href=#dom-history-go&gt;go()&lt;/a&gt;&lt;/code&gt;
-  method, as follows:&lt;/p&gt;
-
-  &lt;table&gt;&lt;tr&gt;&lt;th&gt;Member&lt;/th&gt;
-    &lt;th&gt;Definition&lt;/th&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-history-back title=dom-history-back&gt;&lt;code&gt;back()&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Must do the same as &lt;code title=dom-history-go&gt;&lt;a href=#dom-history-go&gt;go(-1)&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-history-forward title=dom-history-forward&gt;&lt;code&gt;forward()&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Must do the same as &lt;code title=dom-history-go&gt;&lt;a href=#dom-history-go&gt;go(1)&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
-   &lt;/table&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-history-pushstate title=dom-history-pushState&gt;&lt;code&gt;pushState(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;title&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method adds a state object entry to
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-history-pushstate title=dom-history-pushState&gt;&lt;code&gt;pushState(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;title&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method adds a state object entry to
   the history.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-history-replacestate title=dom-history-replaceState&gt;&lt;code&gt;replaceState(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;title&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method updates the state object,
@@ -56011,12 +56024,12 @@
 
      &lt;li&gt;If the &lt;a href=#origin&gt;origin&lt;/a&gt; of the resulting &lt;a href=#absolute-url&gt;absolute
      URL&lt;/a&gt; is not the same as the &lt;a href=#origin&gt;origin&lt;/a&gt; of the
-     &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;code title=&quot;script's browsing
-     context&quot;&gt;&lt;a href=&quot;#script's-browsing-context&quot;&gt;browsing context, and either the &lt;span title=url-path&gt;&lt;path&gt;&lt;/span&gt; or &lt;span title=url-query&gt;&lt;query&gt;&lt;/span&gt; components of the two
-     &lt;span title=URL&gt;URLs&lt;/span&gt; comparedi in the previous step
-     differ, raise a &lt;code&gt;SECURITY_ERR&lt;/code&gt; exception and abort
+     &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
+     context&quot;&gt;browsing context&lt;/a&gt;, and either the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; or &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components of the two
+     &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; comparedi in the previous step
+     differ, raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception and abort
      these steps. (This prevents sandboxed content from spoofing other
-     pages on the same origin.)&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+     pages on the same origin.)&lt;/li&gt;
 
     &lt;/ol&gt;&lt;p&gt;For the purposes of the comparisons in the above substeps, the
     &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; and &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components can only be the
@@ -56042,6 +56055,9 @@
 
      &lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;Remove any &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; queued
+     by the &lt;a href=#history-traversal-task-source&gt;history traversal task source&lt;/a&gt;.&lt;/li&gt;
+
      &lt;li&gt;&lt;p&gt;Add a state object entry to the session history, after the
      &lt;a href=#current-entry&gt;current entry&lt;/a&gt;, with &lt;var title=&quot;&quot;&gt;cloned data&lt;/var&gt; as
      the state object, the given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title,
@@ -56071,7 +56087,7 @@
 
     &lt;p class=note&gt;Since this is neither a &lt;a href=#navigate title=navigate&gt;navigation&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing
     context&lt;/a&gt; nor a &lt;a href=#traverse-the-history title=&quot;traverse the history&quot;&gt;history
-    traversal&lt;/a&gt;, it does not cause a &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt; event to be fired.&lt;/p&gt;
+    traversal&lt;/a&gt;, it does not cause a &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt; event to be fired.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -56186,78 +56202,8 @@
 
 
 
-  &lt;h4 id=activating-state-object-entries&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;&lt;dfn title=&quot;activate the state object&quot;&gt;Activating state object entries&lt;/dfn&gt;&lt;/h4&gt;
+  &lt;h4 id=the-location-interface&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;The &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
-  &lt;div class=impl&gt;
-
-  &lt;p&gt;When an entry in the session history is activated (which happens
-  during &lt;a href=#traverse-the-history title=&quot;traverse the history&quot;&gt;session history
-  traversal&lt;/a&gt;), the user agent must run the following steps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;!-- only called for the first entry of a Document set and for
-  state object entries, not for frag id change entries --&gt;&lt;li&gt;&lt;p&gt;If the entry is a &lt;a href=#state-object&gt;state object&lt;/a&gt; entry, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be a &lt;a href=#structured-clone&gt;structured clone&lt;/a&gt; of that
-   state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
-   null.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Run the appropriate steps according to the conditions
-    described:&lt;/p&gt;
-
-    &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; is set to the
-     string &quot;complete&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Synchronously fire a &lt;dfn id=event-popstate title=event-popstate&gt;&lt;code&gt;popstate&lt;/code&gt;&lt;/dfn&gt; event on the
-     &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the &lt;code&gt;Document&lt;/code&gt;, using
-     the &lt;code&gt;&lt;a href=#popstateevent&gt;PopStateEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt; attribute set to the
-     value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble but
-     not be cancelable and has no default action.&lt;/dd&gt;
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Let the &lt;code&gt;Document&lt;/code&gt;'s &lt;dfn id=pending-state-object&gt;pending state
-     object&lt;/dfn&gt; be &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. (If there was already
-     a &lt;a href=#pending-state-object&gt;pending state object&lt;/a&gt;, the previous one is
-     discarded.)&lt;/p&gt;
-
-     &lt;p class=note&gt;The event will then be fired just after the &lt;code title=event-load&gt;load&lt;/code&gt; event.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#pending-state-object&gt;pending state object&lt;/a&gt; must be initially null.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;/div&gt;
-
-  &lt;pre class=idl&gt;interface &lt;dfn id=popstateevent&gt;PopStateEvent&lt;/dfn&gt; : Event {
-  readonly attribute any &lt;a href=#dom-popstateevent-state title=dom-PopStateEvent-state&gt;state&lt;/a&gt;;
-  void &lt;a href=#dom-popstateevent-initpopstateevent title=dom-PopStateEvent-initPopStateEvent&gt;initPopStateEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any stateArg);
-};&lt;/pre&gt;
-
-  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Returns the information that was provided to &lt;code title=dom-history-pushState&gt;&lt;a href=#dom-history-pushstate&gt;pushState()&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-history-replaceState&gt;&lt;a href=#dom-history-replacestate&gt;replaceState()&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;&lt;div class=impl&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-popstateevent-initpopstateevent title=dom-PopStateEvent-initPopStateEvent&gt;&lt;code&gt;initPopStateEvent()&lt;/code&gt;&lt;/dfn&gt;
-  method must initialize the event in a manner analogous to the
-  similarly-named method in the DOM Events interfaces. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-popstateevent-state title=dom-PopStateEvent-state&gt;&lt;code&gt;state&lt;/code&gt;&lt;/dfn&gt;
-  attribute represents the context information for the event, or null,
-  if the state represented is the initial state of the
-  &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-
-  &lt;h4 id=the-location-interface&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;The &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
-
   &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; object in a &lt;a href=#browsing-context&gt;browsing
   context&lt;/a&gt;'s session history is associated with a unique
   instance of a &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
@@ -56464,7 +56410,7 @@
 
   &lt;div class=impl&gt;
 
-  &lt;h5 id=security-3&gt;&lt;span class=secno&gt;6.10.4.1 &lt;/span&gt;Security&lt;/h5&gt;
+  &lt;h5 id=security-3&gt;&lt;span class=secno&gt;6.10.3.1 &lt;/span&gt;Security&lt;/h5&gt;
 
   &lt;p&gt;User agents must raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception whenever
   any of the members of a &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; object are accessed by
@@ -56487,7 +56433,7 @@
 
   &lt;div class=impl&gt;
 
-  &lt;h4 id=history-notes&gt;&lt;span class=secno&gt;6.10.5 &lt;/span&gt;Implementation notes for session history&lt;/h4&gt;
+  &lt;h4 id=history-notes&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;Implementation notes for session history&lt;/h4&gt;
   &lt;!-- don't change the ID without updating multiple internal links --&gt;
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
@@ -56925,6 +56871,12 @@
 
        &lt;/li&gt;
 
+       &lt;li&gt;&lt;p&gt;Remove any &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt;
+       queued by the &lt;a href=#history-traversal-task-source&gt;history traversal task
+       source&lt;/a&gt;.&lt;/li&gt; &lt;!-- so the network is racing
+       history.back(), in the case of setting location.href=&quot;&quot; and
+       then calling history.back() --&gt;
+
        &lt;li&gt;&lt;p&gt;Append a new entry at the end of the &lt;code&gt;&lt;a href=#history-0&gt;History&lt;/a&gt;&lt;/code&gt;
        object representing the new resource and its
        &lt;code&gt;Document&lt;/code&gt; object and related state.&lt;/li&gt;
@@ -57212,6 +57164,9 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Remove any &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; queued by
+   the &lt;a href=#history-traversal-task-source&gt;history traversal task source&lt;/a&gt;.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Append a new entry at the end of the &lt;code&gt;&lt;a href=#history-0&gt;History&lt;/a&gt;&lt;/code&gt;
    object representing the new resource and its &lt;code&gt;Document&lt;/code&gt;
    object and related state. Its &lt;a href=#url&gt;URL&lt;/a&gt; must be set to the
@@ -57282,9 +57237,14 @@
   document&lt;/a&gt;, if that is an element; otherwise there is no
   &lt;i&gt;&lt;a href=#target-element&gt;target element&lt;/a&gt;&lt;/i&gt;. &lt;a href=#refsSELECTORS&gt;[SELECTORS]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;/div&gt;
 
-  &lt;h4 id=history-traversal&gt;&lt;span class=secno&gt;6.11.9 &lt;/span&gt;History traversal&lt;/h4&gt;
 
+
+  &lt;h4 id=history-traversal&gt;&lt;span class=secno&gt;6.11.9 &lt;/span&gt;History traversal&lt;/h4&gt; &lt;!-- session history --&gt;
+
+  &lt;div class=impl&gt;
+
   &lt;p&gt;When a user agent is required to &lt;dfn id=traverse-the-history&gt;traverse the history&lt;/dfn&gt;
   to a &lt;i&gt;specified entry&lt;/i&gt;, optionally with &lt;a href=#replacement-enabled&gt;replacement
   enabled&lt;/a&gt;, the user agent must act as follows:&lt;/p&gt;
@@ -57301,8 +57261,6 @@
    created. (This can never happen with &lt;a href=#replacement-enabled&gt;replacement
    enabled&lt;/a&gt;.)&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Release the &lt;a href=#storage-mutex&gt;storage mutex&lt;/a&gt;.&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;'s title was not set by the
    &lt;code title=dom-history-pushState&gt;&lt;a href=#dom-history-pushstate&gt;pushState()&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-history-replaceState&gt;&lt;a href=#dom-history-replacestate&gt;replaceState()&lt;/a&gt;&lt;/code&gt; methods,
    then set its title to the value returned by the &lt;code title=dom-document-title&gt;&lt;a href=#document.title&gt;document.title&lt;/a&gt;&lt;/code&gt; IDL
@@ -57383,7 +57341,10 @@
    &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a URL that differs from
    the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;'s only by its fragment identifier,
    and the two share the same &lt;code&gt;Document&lt;/code&gt; object, then let
-   &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true. Otherwise, let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be false.&lt;/li&gt;
+   &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var title=&quot;&quot;&gt;old
+   URL&lt;/var&gt; be the URL of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt; and &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;i&gt;specified
+   entry&lt;/i&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be
+   false.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the traversal was initiated with &lt;dfn id=replacement-enabled&gt;replacement
    enabled&lt;/dfn&gt;, remove the entry immediately before the
@@ -57398,22 +57359,144 @@
    view, for instance the scroll position or values of form fields,
    that it had previously recorded.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is a state object or the
-   first entry for a &lt;code&gt;Document&lt;/code&gt;, the user agent must &lt;a href=#activating-state-object-entries title=&quot;activate the state object&quot;&gt;activate that
-   entry&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is a state object or the first
+    entry for a &lt;code&gt;Document&lt;/code&gt;, the user agent must run the
+    following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the entry is a &lt;a href=#state-object&gt;state object&lt;/a&gt; entry, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be a &lt;a href=#structured-clone&gt;structured clone&lt;/a&gt; of that
+     state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
+     null.&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Run the appropriate steps according to the conditions
+      described:&lt;/p&gt;
+
+      &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; is set to the
+       string &quot;complete&quot;&lt;/dt&gt;
+
+       &lt;dd&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to fire a &lt;code title=event-popstate&gt;&lt;a href=#event-popstate&gt;popstate&lt;/a&gt;&lt;/code&gt; event at the
+       &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the &lt;code&gt;Document&lt;/code&gt;, using
+       the &lt;code&gt;&lt;a href=#popstateevent&gt;PopStateEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt; attribute set to
+       the value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble
+       but not be cancelable and has no default action.&lt;/dd&gt;
+
+       &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+       &lt;dd&gt;&lt;p&gt;Let the &lt;code&gt;Document&lt;/code&gt;'s &lt;dfn id=pending-state-object&gt;pending state
+       object&lt;/dfn&gt; be &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. (If there was already
+       a &lt;a href=#pending-state-object&gt;pending state object&lt;/a&gt;, the previous one is
+       discarded.)&lt;/p&gt;
+
+       &lt;p class=note&gt;The event will then be fired just after the &lt;code title=event-load&gt;load&lt;/code&gt; event.&lt;/dd&gt;
+
+      &lt;/dl&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; is true, then
-   synchronously &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; with the name &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt; at the &lt;a href=#browsing-context&gt;browsing
-   context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object.&lt;/li&gt;
+   &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire a &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt; event at the
+   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object, using
+   the &lt;code&gt;&lt;a href=#hashchangeevent&gt;HashChangeEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-HashChangeEvent-oldURL&gt;&lt;a href=#dom-hashchangeevent-oldurl&gt;oldURL&lt;/a&gt;&lt;/code&gt; attribute set to
+   &lt;var title=&quot;&quot;&gt;old URL&lt;/var&gt; and the &lt;code title=dom-HashChangeEvent-newURL&gt;&lt;a href=#dom-hashchangeevent-newurl&gt;newURL&lt;/a&gt;&lt;/code&gt; attribute set to
+   &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt;. This event must bubble but not be
+   cancelable and has no default action.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Release the &lt;a href=#storage-mutex&gt;storage mutex&lt;/a&gt; again.&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;The &lt;a href=#current-entry&gt;current entry&lt;/a&gt; is now the &lt;i&gt;specified
    entry&lt;/i&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;/div&gt;
+  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#pending-state-object&gt;pending state object&lt;/a&gt; must be initially null.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the tasks mentioned above is the
+  &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task source&lt;/a&gt;.&lt;/p&gt;
 
+
+  &lt;h5 id=event-definitions&gt;&lt;span class=secno&gt;6.11.9.1 &lt;/span&gt;Event definitions&lt;/h5&gt;
+
+  &lt;/div&gt;
+
+  &lt;p&gt;The &lt;dfn id=event-popstate title=event-popstate&gt;&lt;code&gt;popstate&lt;/code&gt;&lt;/dfn&gt; event
+  is fired when navigating to a &lt;a href=#session-history-entry&gt;session history entry&lt;/a&gt;
+  that represents a state object.&lt;/p&gt;
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=popstateevent&gt;PopStateEvent&lt;/dfn&gt; : Event {
+  readonly attribute any &lt;a href=#dom-popstateevent-state title=dom-PopStateEvent-state&gt;state&lt;/a&gt;;
+  void &lt;a href=#dom-popstateevent-initpopstateevent title=dom-PopStateEvent-initPopStateEvent&gt;initPopStateEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any stateArg);
+};&lt;/pre&gt;
+
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the information that was provided to &lt;code title=dom-history-pushState&gt;&lt;a href=#dom-history-pushstate&gt;pushState()&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-history-replaceState&gt;&lt;a href=#dom-history-replacestate&gt;replaceState()&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;div class=impl&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-popstateevent-initpopstateevent title=dom-PopStateEvent-initPopStateEvent&gt;&lt;code&gt;initPopStateEvent()&lt;/code&gt;&lt;/dfn&gt;
+  method must initialize the event in a manner analogous to the
+  similarly-named method in the DOM Events interfaces. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-popstateevent-state title=dom-PopStateEvent-state&gt;&lt;code&gt;state&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents the context information for the event, or null,
+  if the state represented is the initial state of the
+  &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=event-hashchange title=event-hashchange&gt;&lt;code&gt;hashchange&lt;/code&gt;&lt;/dfn&gt;
+  event is fired when navigating to a &lt;a href=#session-history-entry&gt;session history
+  entry&lt;/a&gt; whose &lt;a href=#url&gt;URL&lt;/a&gt; differs from that of the
+  previous one only in the fragment identifier.&lt;/p&gt;
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=hashchangeevent&gt;HashChangeEvent&lt;/dfn&gt; : Event {
+  readonly attribute any &lt;a href=#dom-hashchangeevent-oldurl title=dom-HashChangeEvent-oldURL&gt;oldURL&lt;/a&gt;;
+  readonly attribute any &lt;a href=#dom-hashchangeevent-newurl title=dom-HashChangeEvent-newURL&gt;newURL&lt;/a&gt;;
+  void &lt;a href=#dom-hashchangeevent-inithashchangeevent title=dom-HashChangeEvent-initHashChangeEvent&gt;initHashChangeEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString oldURLArg, in DOMString newURLArg);
+};&lt;/pre&gt;
+
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-HashChangeEvent-oldURL&gt;&lt;a href=#dom-hashchangeevent-oldurl&gt;oldURL&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;a href=#url&gt;URL&lt;/a&gt; of the &lt;a href=#session-history-entry&gt;session history
+    entry&lt;/a&gt; that was previously current.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-HashChangeEvent-newURL&gt;&lt;a href=#dom-hashchangeevent-newurl&gt;newURL&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;a href=#url&gt;URL&lt;/a&gt; of the &lt;a href=#session-history-entry&gt;session history
+    entry&lt;/a&gt; that is now current.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;div class=impl&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-hashchangeevent-inithashchangeevent title=dom-HashChangeEvent-initHashChangeEvent&gt;&lt;code&gt;initHashChangeEvent()&lt;/code&gt;&lt;/dfn&gt;
+  method must initialize the event in a manner analogous to the
+  similarly-named method in the DOM Events interfaces. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-hashchangeevent-oldurl title=dom-HashChangeEvent-oldURL&gt;&lt;code&gt;oldURL&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents context information for the event, specifically
+  the URL of the &lt;a href=#session-history-entry&gt;session history entry&lt;/a&gt; that was traversed
+  from.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-hashchangeevent-newurl title=dom-HashChangeEvent-newURL&gt;&lt;code&gt;newURL&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents context information for the event, specifically
+  the URL of the &lt;a href=#session-history-entry&gt;session history entry&lt;/a&gt; that was traversed
+  to.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+
+
   &lt;h4 id=unloading-documents&gt;&lt;span class=secno&gt;6.11.10 &lt;/span&gt;Unloading documents&lt;/h4&gt;
 
   &lt;div class=impl&gt;
@@ -57588,6 +57671,8 @@
   &lt;/div&gt;
 
 
+  &lt;div class=impl&gt;
+
   &lt;h4 id=aborting-a-document-load&gt;&lt;span class=secno&gt;6.11.11 &lt;/span&gt;Aborting a document load&lt;/h4&gt;
 
   &lt;p&gt;If the user cancels any instance of the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; in the context of a
@@ -57600,8 +57685,10 @@
   &lt;!-- I'd love to make this more precise, anyone have any suggestions
   on what it should say? --&gt;
 
+  &lt;/div&gt;
 
 
+
   &lt;h3 id=links&gt;&lt;span class=secno&gt;6.12 &lt;/span&gt;Links&lt;/h3&gt;
 
 
@@ -65471,7 +65558,7 @@
 
 
 
-  &lt;h3 id=event-definitions&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Event definitions&lt;/h3&gt;
+  &lt;h3 id=event-definitions-0&gt;&lt;span class=secno&gt;10.1 &lt;/span&gt;Event definitions&lt;/h3&gt;
 
   &lt;p&gt;Messages in &lt;a href=#server-sent-events&gt;server-sent events&lt;/a&gt;, &lt;a href=#network&gt;Web
   sockets&lt;/a&gt;, &lt;a href=#crossDocumentMessages&gt;cross-document messaging&lt;/a&gt;, and
@@ -86426,7 +86513,7 @@
 
     &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;onhashchange&lt;/code&gt;
      &lt;td&gt; &lt;code title=handler-window-onhashchange&gt;&lt;a href=#handler-window-onhashchange&gt;body&lt;/a&gt;&lt;/code&gt;
-     &lt;td&gt; &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt; event handler for &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object
+     &lt;td&gt; &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt; event handler for &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object
      &lt;td&gt; &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;Event handler content attribute&lt;/a&gt;
 
     &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;oninput&lt;/code&gt;

Modified: index
===================================================================
--- index	2010-01-28 01:22:24 UTC (rev 4631)
+++ index	2010-01-29 01:31:38 UTC (rev 4632)
@@ -112,7 +112,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;HTML5 (including next generation additions still in development)&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 28 January 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 29 January 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -735,11 +735,10 @@
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#the-session-history-of-browsing-contexts&gt;&lt;span class=secno&gt;6.10.1 &lt;/span&gt;The session history of browsing contexts&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-history-interface&gt;&lt;span class=secno&gt;6.10.2 &lt;/span&gt;The &lt;code&gt;History&lt;/code&gt; interface&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#activating-state-object-entries&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;Activating state object entries&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#the-location-interface&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;The &lt;code&gt;Location&lt;/code&gt; interface&lt;/a&gt;
+     &lt;li&gt;&lt;a href=#the-location-interface&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;The &lt;code&gt;Location&lt;/code&gt; interface&lt;/a&gt;
       &lt;ol&gt;
-       &lt;li&gt;&lt;a href=#security-3&gt;&lt;span class=secno&gt;6.10.4.1 &lt;/span&gt;Security&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#history-notes&gt;&lt;span class=secno&gt;6.10.5 &lt;/span&gt;Implementation notes for session history&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#security-3&gt;&lt;span class=secno&gt;6.10.3.1 &lt;/span&gt;Security&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#history-notes&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;Implementation notes for session history&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#browsing-the-web&gt;&lt;span class=secno&gt;6.11 &lt;/span&gt;Browsing the Web&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#navigating-across-documents&gt;&lt;span class=secno&gt;6.11.1 &lt;/span&gt;Navigating across documents&lt;/a&gt;&lt;/li&gt;
@@ -750,7 +749,9 @@
      &lt;li&gt;&lt;a href=#read-plugin&gt;&lt;span class=secno&gt;6.11.6 &lt;/span&gt;Page load processing model for content that uses plugins&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#read-ua-inline&gt;&lt;span class=secno&gt;6.11.7 &lt;/span&gt;Page load processing model for inline content that doesn't have a DOM&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#scroll-to-fragid&gt;&lt;span class=secno&gt;6.11.8 &lt;/span&gt;Navigating to a fragment identifier&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#history-traversal&gt;&lt;span class=secno&gt;6.11.9 &lt;/span&gt;History traversal&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#history-traversal&gt;&lt;span class=secno&gt;6.11.9 &lt;/span&gt;History traversal&lt;/a&gt;
+      &lt;ol&gt;
+       &lt;li&gt;&lt;a href=#event-definitions&gt;&lt;span class=secno&gt;6.11.9.1 &lt;/span&gt;Event definitions&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#unloading-documents&gt;&lt;span class=secno&gt;6.11.10 &lt;/span&gt;Unloading documents&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#event-definition&gt;&lt;span class=secno&gt;6.11.10.1 &lt;/span&gt;Event definition&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
@@ -841,7 +842,7 @@
    &lt;li&gt;&lt;a href=#editing-apis&gt;&lt;span class=secno&gt;7.11 &lt;/span&gt;Editing APIs&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#comms&gt;&lt;span class=secno&gt;8 &lt;/span&gt;Communication&lt;/a&gt;
   &lt;ol&gt;
-   &lt;li&gt;&lt;a href=#event-definitions&gt;&lt;span class=secno&gt;8.1 &lt;/span&gt;Event definitions&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#event-definitions-0&gt;&lt;span class=secno&gt;8.1 &lt;/span&gt;Event definitions&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#crossDocumentMessages&gt;&lt;span class=secno&gt;8.2 &lt;/span&gt;Cross-document messaging&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#introduction-5&gt;&lt;span class=secno&gt;8.2.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
@@ -9756,21 +9757,20 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Remove any &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; queued by
+   the &lt;a href=#history-traversal-task-source&gt;history traversal task source&lt;/a&gt;.&lt;/li&gt;
+
    &lt;li&gt;Remove any earlier entries that share the same
    &lt;code&gt;Document&lt;/code&gt;.&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt; is false, then add a new
+   entry, just before the last entry, and associate with the new entry
+   the text that was parsed by the previous parser associated with the
+   &lt;code&gt;Document&lt;/code&gt; object, as well as the state of the document
+   at the start of these steps. (This allows the user to step
+   backwards in the session history to see the page before it was
+   blown away by the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt; call.)&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt; is false, then add a new entry,
-    just before the last entry, and assocaite with the new entry the
-    text that was parsed by the previous parser associated with the
-    &lt;code&gt;Document&lt;/code&gt; object, as well as the state of the document
-    at the start of these steps. (This allows the user to step
-    backwards in the session history to see the page before it was
-    blown away by the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt; call.)&lt;/p&gt;
-
-   &lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Finally, set the &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt; to point at
    just before the end of the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; (which at this
    point will be empty).&lt;/li&gt;
@@ -20518,8 +20518,10 @@
   its &lt;code title=attr-object-type&gt;&lt;a href=#attr-object-type&gt;type&lt;/a&gt;&lt;/code&gt; attribute is set,
   changed, or removed: the user agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt;
   to run the following steps to (re)determine what the
-  &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt; element represents:&lt;/p&gt;
-  &lt;!-- Changing the base URL doesn't trigger this. --&gt;
+  &lt;code&gt;&lt;a href=#the-object-element&gt;object&lt;/a&gt;&lt;/code&gt; element represents. The &lt;a href=#task-source&gt;task source&lt;/a&gt;
+  for this &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; is the &lt;a href=#dom-manipulation-task-source&gt;DOM
+  manipulation task source&lt;/a&gt;.&lt;/p&gt; &lt;!-- Changing the base URL
+  doesn't trigger this. --&gt;
 
   &lt;ol&gt;&lt;li&gt;
 
@@ -20870,10 +20872,7 @@
    &lt;a href=#fallback-content&gt;fallback content&lt;/a&gt;. If the element has an instantiated
    &lt;a href=#plugin&gt;plugin&lt;/a&gt;, then unload it.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; above is the &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation
-  task source&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;p id=object-plugin&gt;When the algorithm above instantiates a
+  &lt;/ol&gt;&lt;p id=object-plugin&gt;When the algorithm above instantiates a
   &lt;a href=#plugin&gt;plugin&lt;/a&gt;, the user agent should pass the names and values
   of all the attributes on the element, and &lt;!-- then a parameter
   named &quot;PARAM&quot; whose value is null, and then --&gt; all the names and
@@ -51839,6 +51838,15 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;The &lt;dfn id=history-traversal-task-source&gt;history traversal task source&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This &lt;a href=#task-source&gt;task source&lt;/a&gt; is used to queue calls to &lt;code title=dom-history-back&gt;&lt;a href=#dom-history-back&gt;history.back()&lt;/a&gt;&lt;/code&gt; and similar
+    APIs.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
   &lt;/dl&gt;&lt;/div&gt;
 
 
@@ -52314,7 +52322,7 @@
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onblur title=handler-window-onblur&gt;&lt;code&gt;onblur&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-blur&gt;blur&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onerror title=handler-window-onerror&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-error&gt;error&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onfocus title=handler-window-onfocus&gt;&lt;code&gt;onfocus&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-focus&gt;focus&lt;/code&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onhashchange title=handler-window-onhashchange&gt;&lt;code&gt;onhashchange&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt; &lt;!-- new --&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onhashchange title=handler-window-onhashchange&gt;&lt;code&gt;onhashchange&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt; &lt;!-- new --&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onload title=handler-window-onload&gt;&lt;code&gt;onload&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-load&gt;load&lt;/code&gt; &lt;!-- widely used --&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onmessage title=handler-window-onmessage&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; &lt;!-- new for postMessage --&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-window-onoffline title=handler-window-onoffline&gt;&lt;code&gt;onoffline&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-offline&gt;&lt;a href=#event-offline&gt;offline&lt;/a&gt;&lt;/code&gt; &lt;!-- new --&gt;
@@ -55853,14 +55861,26 @@
 
   &lt;p&gt;The actual entries are not accessible from script.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-history-go title=dom-history-go&gt;&lt;code&gt;go(&lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method causes the UA to run the
-  following steps:&lt;/p&gt;
+  &lt;p&gt;When the &lt;dfn id=dom-history-go title=dom-history-go&gt;&lt;code&gt;go(&lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, if the
+  argument to the method was omitted or has the value zero, the user
+  agent must act as if the &lt;code title=dom-location-reload&gt;&lt;a href=#dom-location-reload&gt;location.reload()&lt;/a&gt;&lt;/code&gt; method was
+  called instead. Otherwise, the user agent must &lt;a href=#traverse-the-history-by-a-delta&gt;traverse the
+  history by a delta&lt;/a&gt; whose value is the value of the method's
+  argument.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the argument to the method was omitted or has the value
-   zero, then act as if the &lt;code title=dom-location-reload&gt;&lt;a href=#dom-location-reload&gt;location.reload()&lt;/a&gt;&lt;/code&gt; method was
-   called instead, and abort these steps.&lt;/p&gt;
+  &lt;p&gt;When the &lt;dfn id=dom-history-back title=dom-history-back&gt;&lt;code&gt;back()&lt;/code&gt;&lt;/dfn&gt;
+  method is invoked, the user agent must &lt;a href=#traverse-the-history-by-a-delta&gt;traverse the history by
+  a delta&lt;/a&gt; &minus;1.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be the argument to the
+  &lt;p&gt;When the &lt;dfn id=dom-history-forward title=dom-history-forward&gt;&lt;code&gt;forward()&lt;/code&gt;&lt;/dfn&gt;method is
+  invoked, the user agent must &lt;a href=#traverse-the-history-by-a-delta&gt;traverse the history by a
+  delta&lt;/a&gt; +1.&lt;/p&gt;
+
+  &lt;p&gt;To &lt;dfn id=traverse-the-history-by-a-delta&gt;traverse the history by a delta&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;, the user agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt;
+  to run the following steps. The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the
+  queued task is the &lt;a href=#history-traversal-task-source&gt;history traversal task source&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be the argument to the
    method.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the index of the &lt;a href=#current-entry-of-the-joint-session-history&gt;current entry of the joint session
@@ -55876,24 +55896,17 @@
    &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; of the &lt;var title=&quot;&quot;&gt;specified
    entry&lt;/var&gt;.&lt;/li&gt;
 
+   &lt;!-- XXX if going to another doc, try to unload the document here
+   (firing beforeunload, unload, pagehide) --&gt;
+
    &lt;li&gt;&lt;p&gt;&lt;a href=#traverse-the-history&gt;Traverse the history&lt;/a&gt; of the &lt;var title=&quot;&quot;&gt;specified browsing context&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/p&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the user navigates through a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;,
   e.g. using a browser's back and forward buttons, the user agent must
-  translate this action into the equivalent invocations of the &lt;code title=dom-history-go&gt;&lt;a href=#dom-history-go&gt;history.go(&lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/a&gt;&lt;/code&gt;
-  method on the various affected &lt;code title=dom-window&gt;&lt;a href=#dom-window&gt;window&lt;/a&gt;&lt;/code&gt; objects.&lt;/p&gt;
+  &lt;a href=#traverse-the-history-by-a-delta&gt;traverse the history by a delta&lt;/a&gt; equivalent to the
+  action specified by the user.&lt;/p&gt;
 
-  &lt;p&gt;Some of the other members of the &lt;code&gt;&lt;a href=#history-0&gt;History&lt;/a&gt;&lt;/code&gt; interface
-  are defined in terms of the &lt;code title=dom-history-go&gt;&lt;a href=#dom-history-go&gt;go()&lt;/a&gt;&lt;/code&gt;
-  method, as follows:&lt;/p&gt;
-
-  &lt;table&gt;&lt;tr&gt;&lt;th&gt;Member&lt;/th&gt;
-    &lt;th&gt;Definition&lt;/th&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-history-back title=dom-history-back&gt;&lt;code&gt;back()&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Must do the same as &lt;code title=dom-history-go&gt;&lt;a href=#dom-history-go&gt;go(-1)&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
-   &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-history-forward title=dom-history-forward&gt;&lt;code&gt;forward()&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Must do the same as &lt;code title=dom-history-go&gt;&lt;a href=#dom-history-go&gt;go(1)&lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
-   &lt;/table&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-history-pushstate title=dom-history-pushState&gt;&lt;code&gt;pushState(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;title&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method adds a state object entry to
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-history-pushstate title=dom-history-pushState&gt;&lt;code&gt;pushState(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;title&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method adds a state object entry to
   the history.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-history-replacestate title=dom-history-replaceState&gt;&lt;code&gt;replaceState(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;title&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method updates the state object,
@@ -55925,12 +55938,12 @@
 
      &lt;li&gt;If the &lt;a href=#origin&gt;origin&lt;/a&gt; of the resulting &lt;a href=#absolute-url&gt;absolute
      URL&lt;/a&gt; is not the same as the &lt;a href=#origin&gt;origin&lt;/a&gt; of the
-     &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;code title=&quot;script's browsing
-     context&quot;&gt;&lt;a href=&quot;#script's-browsing-context&quot;&gt;browsing context, and either the &lt;span title=url-path&gt;&lt;path&gt;&lt;/span&gt; or &lt;span title=url-query&gt;&lt;query&gt;&lt;/span&gt; components of the two
-     &lt;span title=URL&gt;URLs&lt;/span&gt; comparedi in the previous step
-     differ, raise a &lt;code&gt;SECURITY_ERR&lt;/code&gt; exception and abort
+     &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
+     context&quot;&gt;browsing context&lt;/a&gt;, and either the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; or &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components of the two
+     &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; comparedi in the previous step
+     differ, raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception and abort
      these steps. (This prevents sandboxed content from spoofing other
-     pages on the same origin.)&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;
+     pages on the same origin.)&lt;/li&gt;
 
     &lt;/ol&gt;&lt;p&gt;For the purposes of the comparisons in the above substeps, the
     &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; and &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components can only be the
@@ -55956,6 +55969,9 @@
 
      &lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;Remove any &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; queued
+     by the &lt;a href=#history-traversal-task-source&gt;history traversal task source&lt;/a&gt;.&lt;/li&gt;
+
      &lt;li&gt;&lt;p&gt;Add a state object entry to the session history, after the
      &lt;a href=#current-entry&gt;current entry&lt;/a&gt;, with &lt;var title=&quot;&quot;&gt;cloned data&lt;/var&gt; as
      the state object, the given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title,
@@ -55985,7 +56001,7 @@
 
     &lt;p class=note&gt;Since this is neither a &lt;a href=#navigate title=navigate&gt;navigation&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing
     context&lt;/a&gt; nor a &lt;a href=#traverse-the-history title=&quot;traverse the history&quot;&gt;history
-    traversal&lt;/a&gt;, it does not cause a &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt; event to be fired.&lt;/p&gt;
+    traversal&lt;/a&gt;, it does not cause a &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt; event to be fired.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -56100,78 +56116,8 @@
 
 
 
-  &lt;h4 id=activating-state-object-entries&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;&lt;dfn title=&quot;activate the state object&quot;&gt;Activating state object entries&lt;/dfn&gt;&lt;/h4&gt;
+  &lt;h4 id=the-location-interface&gt;&lt;span class=secno&gt;6.10.3 &lt;/span&gt;The &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
-  &lt;div class=impl&gt;
-
-  &lt;p&gt;When an entry in the session history is activated (which happens
-  during &lt;a href=#traverse-the-history title=&quot;traverse the history&quot;&gt;session history
-  traversal&lt;/a&gt;), the user agent must run the following steps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;!-- only called for the first entry of a Document set and for
-  state object entries, not for frag id change entries --&gt;&lt;li&gt;&lt;p&gt;If the entry is a &lt;a href=#state-object&gt;state object&lt;/a&gt; entry, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be a &lt;a href=#structured-clone&gt;structured clone&lt;/a&gt; of that
-   state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
-   null.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Run the appropriate steps according to the conditions
-    described:&lt;/p&gt;
-
-    &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; is set to the
-     string &quot;complete&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Synchronously fire a &lt;dfn id=event-popstate title=event-popstate&gt;&lt;code&gt;popstate&lt;/code&gt;&lt;/dfn&gt; event on the
-     &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the &lt;code&gt;Document&lt;/code&gt;, using
-     the &lt;code&gt;&lt;a href=#popstateevent&gt;PopStateEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt; attribute set to the
-     value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble but
-     not be cancelable and has no default action.&lt;/dd&gt;
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Let the &lt;code&gt;Document&lt;/code&gt;'s &lt;dfn id=pending-state-object&gt;pending state
-     object&lt;/dfn&gt; be &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. (If there was already
-     a &lt;a href=#pending-state-object&gt;pending state object&lt;/a&gt;, the previous one is
-     discarded.)&lt;/p&gt;
-
-     &lt;p class=note&gt;The event will then be fired just after the &lt;code title=event-load&gt;load&lt;/code&gt; event.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#pending-state-object&gt;pending state object&lt;/a&gt; must be initially null.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;/div&gt;
-
-  &lt;pre class=idl&gt;interface &lt;dfn id=popstateevent&gt;PopStateEvent&lt;/dfn&gt; : Event {
-  readonly attribute any &lt;a href=#dom-popstateevent-state title=dom-PopStateEvent-state&gt;state&lt;/a&gt;;
-  void &lt;a href=#dom-popstateevent-initpopstateevent title=dom-PopStateEvent-initPopStateEvent&gt;initPopStateEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any stateArg);
-};&lt;/pre&gt;
-
-  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Returns the information that was provided to &lt;code title=dom-history-pushState&gt;&lt;a href=#dom-history-pushstate&gt;pushState()&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-history-replaceState&gt;&lt;a href=#dom-history-replacestate&gt;replaceState()&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;&lt;div class=impl&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-popstateevent-initpopstateevent title=dom-PopStateEvent-initPopStateEvent&gt;&lt;code&gt;initPopStateEvent()&lt;/code&gt;&lt;/dfn&gt;
-  method must initialize the event in a manner analogous to the
-  similarly-named method in the DOM Events interfaces. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=dom-popstateevent-state title=dom-PopStateEvent-state&gt;&lt;code&gt;state&lt;/code&gt;&lt;/dfn&gt;
-  attribute represents the context information for the event, or null,
-  if the state represented is the initial state of the
-  &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-
-  &lt;h4 id=the-location-interface&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;The &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
-
   &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; object in a &lt;a href=#browsing-context&gt;browsing
   context&lt;/a&gt;'s session history is associated with a unique
   instance of a &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
@@ -56378,7 +56324,7 @@
 
   &lt;div class=impl&gt;
 
-  &lt;h5 id=security-3&gt;&lt;span class=secno&gt;6.10.4.1 &lt;/span&gt;Security&lt;/h5&gt;
+  &lt;h5 id=security-3&gt;&lt;span class=secno&gt;6.10.3.1 &lt;/span&gt;Security&lt;/h5&gt;
 
   &lt;p&gt;User agents must raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception whenever
   any of the members of a &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; object are accessed by
@@ -56401,7 +56347,7 @@
 
   &lt;div class=impl&gt;
 
-  &lt;h4 id=history-notes&gt;&lt;span class=secno&gt;6.10.5 &lt;/span&gt;Implementation notes for session history&lt;/h4&gt;
+  &lt;h4 id=history-notes&gt;&lt;span class=secno&gt;6.10.4 &lt;/span&gt;Implementation notes for session history&lt;/h4&gt;
   &lt;!-- don't change the ID without updating multiple internal links --&gt;
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
@@ -56839,6 +56785,12 @@
 
        &lt;/li&gt;
 
+       &lt;li&gt;&lt;p&gt;Remove any &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt;
+       queued by the &lt;a href=#history-traversal-task-source&gt;history traversal task
+       source&lt;/a&gt;.&lt;/li&gt; &lt;!-- so the network is racing
+       history.back(), in the case of setting location.href=&quot;&quot; and
+       then calling history.back() --&gt;
+
        &lt;li&gt;&lt;p&gt;Append a new entry at the end of the &lt;code&gt;&lt;a href=#history-0&gt;History&lt;/a&gt;&lt;/code&gt;
        object representing the new resource and its
        &lt;code&gt;Document&lt;/code&gt; object and related state.&lt;/li&gt;
@@ -57126,6 +57078,9 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Remove any &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; queued by
+   the &lt;a href=#history-traversal-task-source&gt;history traversal task source&lt;/a&gt;.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Append a new entry at the end of the &lt;code&gt;&lt;a href=#history-0&gt;History&lt;/a&gt;&lt;/code&gt;
    object representing the new resource and its &lt;code&gt;Document&lt;/code&gt;
    object and related state. Its &lt;a href=#url&gt;URL&lt;/a&gt; must be set to the
@@ -57196,9 +57151,14 @@
   document&lt;/a&gt;, if that is an element; otherwise there is no
   &lt;i&gt;&lt;a href=#target-element&gt;target element&lt;/a&gt;&lt;/i&gt;. &lt;a href=#refsSELECTORS&gt;[SELECTORS]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;/div&gt;
 
-  &lt;h4 id=history-traversal&gt;&lt;span class=secno&gt;6.11.9 &lt;/span&gt;History traversal&lt;/h4&gt;
 
+
+  &lt;h4 id=history-traversal&gt;&lt;span class=secno&gt;6.11.9 &lt;/span&gt;History traversal&lt;/h4&gt; &lt;!-- session history --&gt;
+
+  &lt;div class=impl&gt;
+
   &lt;p&gt;When a user agent is required to &lt;dfn id=traverse-the-history&gt;traverse the history&lt;/dfn&gt;
   to a &lt;i&gt;specified entry&lt;/i&gt;, optionally with &lt;a href=#replacement-enabled&gt;replacement
   enabled&lt;/a&gt;, the user agent must act as follows:&lt;/p&gt;
@@ -57215,8 +57175,6 @@
    created. (This can never happen with &lt;a href=#replacement-enabled&gt;replacement
    enabled&lt;/a&gt;.)&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Release the &lt;a href=#storage-mutex&gt;storage mutex&lt;/a&gt;.&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;'s title was not set by the
    &lt;code title=dom-history-pushState&gt;&lt;a href=#dom-history-pushstate&gt;pushState()&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-history-replaceState&gt;&lt;a href=#dom-history-replacestate&gt;replaceState()&lt;/a&gt;&lt;/code&gt; methods,
    then set its title to the value returned by the &lt;code title=dom-document-title&gt;&lt;a href=#document.title&gt;document.title&lt;/a&gt;&lt;/code&gt; IDL
@@ -57297,7 +57255,10 @@
    &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a URL that differs from
    the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;'s only by its fragment identifier,
    and the two share the same &lt;code&gt;Document&lt;/code&gt; object, then let
-   &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true. Otherwise, let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be false.&lt;/li&gt;
+   &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var title=&quot;&quot;&gt;old
+   URL&lt;/var&gt; be the URL of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt; and &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;i&gt;specified
+   entry&lt;/i&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be
+   false.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the traversal was initiated with &lt;dfn id=replacement-enabled&gt;replacement
    enabled&lt;/dfn&gt;, remove the entry immediately before the
@@ -57312,22 +57273,144 @@
    view, for instance the scroll position or values of form fields,
    that it had previously recorded.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is a state object or the
-   first entry for a &lt;code&gt;Document&lt;/code&gt;, the user agent must &lt;a href=#activating-state-object-entries title=&quot;activate the state object&quot;&gt;activate that
-   entry&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is a state object or the first
+    entry for a &lt;code&gt;Document&lt;/code&gt;, the user agent must run the
+    following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the entry is a &lt;a href=#state-object&gt;state object&lt;/a&gt; entry, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be a &lt;a href=#structured-clone&gt;structured clone&lt;/a&gt; of that
+     state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
+     null.&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Run the appropriate steps according to the conditions
+      described:&lt;/p&gt;
+
+      &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; is set to the
+       string &quot;complete&quot;&lt;/dt&gt;
+
+       &lt;dd&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to fire a &lt;code title=event-popstate&gt;&lt;a href=#event-popstate&gt;popstate&lt;/a&gt;&lt;/code&gt; event at the
+       &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the &lt;code&gt;Document&lt;/code&gt;, using
+       the &lt;code&gt;&lt;a href=#popstateevent&gt;PopStateEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt; attribute set to
+       the value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble
+       but not be cancelable and has no default action.&lt;/dd&gt;
+
+       &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+       &lt;dd&gt;&lt;p&gt;Let the &lt;code&gt;Document&lt;/code&gt;'s &lt;dfn id=pending-state-object&gt;pending state
+       object&lt;/dfn&gt; be &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. (If there was already
+       a &lt;a href=#pending-state-object&gt;pending state object&lt;/a&gt;, the previous one is
+       discarded.)&lt;/p&gt;
+
+       &lt;p class=note&gt;The event will then be fired just after the &lt;code title=event-load&gt;load&lt;/code&gt; event.&lt;/dd&gt;
+
+      &lt;/dl&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; is true, then
-   synchronously &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; with the name &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt; at the &lt;a href=#browsing-context&gt;browsing
-   context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object.&lt;/li&gt;
+   &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire a &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt; event at the
+   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object, using
+   the &lt;code&gt;&lt;a href=#hashchangeevent&gt;HashChangeEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-HashChangeEvent-oldURL&gt;&lt;a href=#dom-hashchangeevent-oldurl&gt;oldURL&lt;/a&gt;&lt;/code&gt; attribute set to
+   &lt;var title=&quot;&quot;&gt;old URL&lt;/var&gt; and the &lt;code title=dom-HashChangeEvent-newURL&gt;&lt;a href=#dom-hashchangeevent-newurl&gt;newURL&lt;/a&gt;&lt;/code&gt; attribute set to
+   &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt;. This event must bubble but not be
+   cancelable and has no default action.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Release the &lt;a href=#storage-mutex&gt;storage mutex&lt;/a&gt; again.&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;The &lt;a href=#current-entry&gt;current entry&lt;/a&gt; is now the &lt;i&gt;specified
    entry&lt;/i&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;/div&gt;
+  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#pending-state-object&gt;pending state object&lt;/a&gt; must be initially null.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the tasks mentioned above is the
+  &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task source&lt;/a&gt;.&lt;/p&gt;
 
+
+  &lt;h5 id=event-definitions&gt;&lt;span class=secno&gt;6.11.9.1 &lt;/span&gt;Event definitions&lt;/h5&gt;
+
+  &lt;/div&gt;
+
+  &lt;p&gt;The &lt;dfn id=event-popstate title=event-popstate&gt;&lt;code&gt;popstate&lt;/code&gt;&lt;/dfn&gt; event
+  is fired when navigating to a &lt;a href=#session-history-entry&gt;session history entry&lt;/a&gt;
+  that represents a state object.&lt;/p&gt;
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=popstateevent&gt;PopStateEvent&lt;/dfn&gt; : Event {
+  readonly attribute any &lt;a href=#dom-popstateevent-state title=dom-PopStateEvent-state&gt;state&lt;/a&gt;;
+  void &lt;a href=#dom-popstateevent-initpopstateevent title=dom-PopStateEvent-initPopStateEvent&gt;initPopStateEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any stateArg);
+};&lt;/pre&gt;
+
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the information that was provided to &lt;code title=dom-history-pushState&gt;&lt;a href=#dom-history-pushstate&gt;pushState()&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-history-replaceState&gt;&lt;a href=#dom-history-replacestate&gt;replaceState()&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;div class=impl&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-popstateevent-initpopstateevent title=dom-PopStateEvent-initPopStateEvent&gt;&lt;code&gt;initPopStateEvent()&lt;/code&gt;&lt;/dfn&gt;
+  method must initialize the event in a manner analogous to the
+  similarly-named method in the DOM Events interfaces. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-popstateevent-state title=dom-PopStateEvent-state&gt;&lt;code&gt;state&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents the context information for the event, or null,
+  if the state represented is the initial state of the
+  &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+  &lt;hr&gt;&lt;p&gt;The &lt;dfn id=event-hashchange title=event-hashchange&gt;&lt;code&gt;hashchange&lt;/code&gt;&lt;/dfn&gt;
+  event is fired when navigating to a &lt;a href=#session-history-entry&gt;session history
+  entry&lt;/a&gt; whose &lt;a href=#url&gt;URL&lt;/a&gt; differs from that of the
+  previous one only in the fragment identifier.&lt;/p&gt;
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=hashchangeevent&gt;HashChangeEvent&lt;/dfn&gt; : Event {
+  readonly attribute any &lt;a href=#dom-hashchangeevent-oldurl title=dom-HashChangeEvent-oldURL&gt;oldURL&lt;/a&gt;;
+  readonly attribute any &lt;a href=#dom-hashchangeevent-newurl title=dom-HashChangeEvent-newURL&gt;newURL&lt;/a&gt;;
+  void &lt;a href=#dom-hashchangeevent-inithashchangeevent title=dom-HashChangeEvent-initHashChangeEvent&gt;initHashChangeEvent&lt;/a&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString oldURLArg, in DOMString newURLArg);
+};&lt;/pre&gt;
+
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-HashChangeEvent-oldURL&gt;&lt;a href=#dom-hashchangeevent-oldurl&gt;oldURL&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;a href=#url&gt;URL&lt;/a&gt; of the &lt;a href=#session-history-entry&gt;session history
+    entry&lt;/a&gt; that was previously current.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=dom-HashChangeEvent-newURL&gt;&lt;a href=#dom-hashchangeevent-newurl&gt;newURL&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;a href=#url&gt;URL&lt;/a&gt; of the &lt;a href=#session-history-entry&gt;session history
+    entry&lt;/a&gt; that is now current.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;div class=impl&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-hashchangeevent-inithashchangeevent title=dom-HashChangeEvent-initHashChangeEvent&gt;&lt;code&gt;initHashChangeEvent()&lt;/code&gt;&lt;/dfn&gt;
+  method must initialize the event in a manner analogous to the
+  similarly-named method in the DOM Events interfaces. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-hashchangeevent-oldurl title=dom-HashChangeEvent-oldURL&gt;&lt;code&gt;oldURL&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents context information for the event, specifically
+  the URL of the &lt;a href=#session-history-entry&gt;session history entry&lt;/a&gt; that was traversed
+  from.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-hashchangeevent-newurl title=dom-HashChangeEvent-newURL&gt;&lt;code&gt;newURL&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents context information for the event, specifically
+  the URL of the &lt;a href=#session-history-entry&gt;session history entry&lt;/a&gt; that was traversed
+  to.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+
+
   &lt;h4 id=unloading-documents&gt;&lt;span class=secno&gt;6.11.10 &lt;/span&gt;Unloading documents&lt;/h4&gt;
 
   &lt;div class=impl&gt;
@@ -57502,6 +57585,8 @@
   &lt;/div&gt;
 
 
+  &lt;div class=impl&gt;
+
   &lt;h4 id=aborting-a-document-load&gt;&lt;span class=secno&gt;6.11.11 &lt;/span&gt;Aborting a document load&lt;/h4&gt;
 
   &lt;p&gt;If the user cancels any instance of the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; in the context of a
@@ -57514,8 +57599,10 @@
   &lt;!-- I'd love to make this more precise, anyone have any suggestions
   on what it should say? --&gt;
 
+  &lt;/div&gt;
 
 
+
   &lt;h3 id=links&gt;&lt;span class=secno&gt;6.12 &lt;/span&gt;Links&lt;/h3&gt;
 
 
@@ -62659,7 +62746,7 @@
 
 
 
-  &lt;h3 id=event-definitions&gt;&lt;span class=secno&gt;8.1 &lt;/span&gt;Event definitions&lt;/h3&gt;
+  &lt;h3 id=event-definitions-0&gt;&lt;span class=secno&gt;8.1 &lt;/span&gt;Event definitions&lt;/h3&gt;
 
   &lt;p&gt;Messages in &lt;span&gt;server-sent events&lt;/span&gt;, &lt;span&gt;Web
   sockets&lt;/span&gt;, &lt;a href=#crossDocumentMessages&gt;cross-document messaging&lt;/a&gt;, and
@@ -80776,7 +80863,7 @@
 
     &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;onhashchange&lt;/code&gt;
      &lt;td&gt; &lt;code title=handler-window-onhashchange&gt;&lt;a href=#handler-window-onhashchange&gt;body&lt;/a&gt;&lt;/code&gt;
-     &lt;td&gt; &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt; event handler for &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object
+     &lt;td&gt; &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt; event handler for &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object
      &lt;td&gt; &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;Event handler content attribute&lt;/a&gt;
 
     &lt;tr&gt;&lt;th&gt; &lt;code title=&quot;&quot;&gt;oninput&lt;/code&gt;
@@ -81369,8 +81456,8 @@
      &lt;td&gt; &lt;code&gt;Event&lt;/code&gt;
      &lt;td&gt; Fired at form controls when the user changes the value of a control on the form
 
-    &lt;tr&gt;&lt;td&gt; &lt;code title=event-hashchange&gt;hashchange&lt;/code&gt;
-     &lt;td&gt; &lt;code&gt;Event&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt; &lt;code title=event-hashchange&gt;&lt;a href=#event-hashchange&gt;hashchange&lt;/a&gt;&lt;/code&gt;
+     &lt;td&gt; &lt;code&gt;&lt;a href=#hashchangeevent&gt;HashChangeEvent&lt;/a&gt;&lt;/code&gt;
      &lt;td&gt; Fired at the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; when the fragment identifier part of &lt;a href=&quot;#the-document's-current-address&quot;&gt;the document's current address&lt;/a&gt; changes
 
     &lt;tr&gt;&lt;td&gt; &lt;code title=event-input&gt;input&lt;/code&gt;

Modified: source
===================================================================
--- source	2010-01-28 01:22:24 UTC (rev 4631)
+++ source	2010-01-29 01:31:38 UTC (rev 4632)
@@ -10107,22 +10107,21 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Remove any &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; queued by
+   the &lt;span&gt;history traversal task source&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;Remove any earlier entries that share the same
    &lt;code&gt;Document&lt;/code&gt;.&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt; is false, then add a new
+   entry, just before the last entry, and associate with the new entry
+   the text that was parsed by the previous parser associated with the
+   &lt;code&gt;Document&lt;/code&gt; object, as well as the state of the document
+   at the start of these steps. (This allows the user to step
+   backwards in the session history to see the page before it was
+   blown away by the &lt;code
+   title=&quot;dom-document-open&quot;&gt;document.open()&lt;/code&gt; call.)&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;replace&lt;/var&gt; is false, then add a new entry,
-    just before the last entry, and assocaite with the new entry the
-    text that was parsed by the previous parser associated with the
-    &lt;code&gt;Document&lt;/code&gt; object, as well as the state of the document
-    at the start of these steps. (This allows the user to step
-    backwards in the session history to see the page before it was
-    blown away by the &lt;code
-    title=&quot;dom-document-open&quot;&gt;document.open()&lt;/code&gt; call.)&lt;/p&gt;
-
-   &lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;Finally, set the &lt;span&gt;insertion point&lt;/span&gt; to point at
    just before the end of the &lt;span&gt;input stream&lt;/span&gt; (which at this
    point will be empty).&lt;/p&gt;&lt;/li&gt;
@@ -21997,8 +21996,10 @@
   its &lt;code title=&quot;attr-object-type&quot;&gt;type&lt;/code&gt; attribute is set,
   changed, or removed: the user agent must &lt;span&gt;queue a task&lt;/span&gt;
   to run the following steps to (re)determine what the
-  &lt;code&gt;object&lt;/code&gt; element represents:&lt;/p&gt;
-  &lt;!-- Changing the base URL doesn't trigger this. --&gt;
+  &lt;code&gt;object&lt;/code&gt; element represents. The &lt;span&gt;task source&lt;/span&gt;
+  for this &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; is the &lt;span&gt;DOM
+  manipulation task source&lt;/span&gt;.&lt;/p&gt; &lt;!-- Changing the base URL
+  doesn't trigger this. --&gt;
 
   &lt;ol&gt;
 
@@ -22386,10 +22387,6 @@
 
   &lt;/ol&gt;
 
-  &lt;p&gt;The &lt;span&gt;task source&lt;/span&gt; for the &lt;span
-  title=&quot;concept-task&quot;&gt;task&lt;/span&gt; above is the &lt;span&gt;DOM manipulation
-  task source&lt;/span&gt;.&lt;/p&gt;
-
   &lt;p id=&quot;object-plugin&quot;&gt;When the algorithm above instantiates a
   &lt;span&gt;plugin&lt;/span&gt;, the user agent should pass the names and values
   of all the attributes on the element, and &lt;!-- then a parameter
@@ -58520,6 +58517,16 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;The &lt;dfn&gt;history traversal task source&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This &lt;span&gt;task source&lt;/span&gt; is used to queue calls to &lt;code
+    title=&quot;dom-history-back&quot;&gt;history.back()&lt;/code&gt; and similar
+    APIs.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
   &lt;/dl&gt;
 
   &lt;/div&gt;
@@ -63189,17 +63196,31 @@
 
   &lt;p&gt;The actual entries are not accessible from script.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-history-go&quot;&gt;&lt;code&gt;go(&lt;var
-  title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method causes the UA to run the
-  following steps:&lt;/p&gt;
+  &lt;p&gt;When the &lt;dfn title=&quot;dom-history-go&quot;&gt;&lt;code&gt;go(&lt;var
+  title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method is invoked, if the
+  argument to the method was omitted or has the value zero, the user
+  agent must act as if the &lt;code
+  title=&quot;dom-location-reload&quot;&gt;location.reload()&lt;/code&gt; method was
+  called instead. Otherwise, the user agent must &lt;span&gt;traverse the
+  history by a delta&lt;/span&gt; whose value is the value of the method's
+  argument.&lt;/p&gt;
 
+  &lt;p&gt;When the &lt;dfn title=&quot;dom-history-back&quot;&gt;&lt;code&gt;back()&lt;/code&gt;&lt;/dfn&gt;
+  method is invoked, the user agent must &lt;span&gt;traverse the history by
+  a delta&lt;/span&gt; &amp;#x2212;1.&lt;/p&gt;
+
+  &lt;p&gt;When the &lt;dfn
+  title=&quot;dom-history-forward&quot;&gt;&lt;code&gt;forward()&lt;/code&gt;&lt;/dfn&gt;method is
+  invoked, the user agent must &lt;span&gt;traverse the history by a
+  delta&lt;/span&gt; +1.&lt;/p&gt;
+
+  &lt;p&gt;To &lt;dfn&gt;traverse the history by a delta&lt;/dfn&gt; &lt;var
+  title=&quot;&quot;&gt;delta&lt;/var&gt;, the user agent must &lt;span&gt;queue a task&lt;/span&gt;
+  to run the following steps. The &lt;span&gt;task source&lt;/span&gt; for the
+  queued task is the &lt;span&gt;history traversal task source&lt;/span&gt;.&lt;/p&gt;
+
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;If the argument to the method was omitted or has the value
-   zero, then act as if the &lt;code
-   title=&quot;dom-location-reload&quot;&gt;location.reload()&lt;/code&gt; method was
-   called instead, and abort these steps.&lt;/p&gt;
-
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;delta&lt;/var&gt; be the argument to the
    method.&lt;/p&gt;&lt;/li&gt;
 
@@ -63217,6 +63238,9 @@
    &lt;span&gt;browsing context&lt;/span&gt; of the &lt;var title=&quot;&quot;&gt;specified
    entry&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;!-- XXX if going to another doc, try to unload the document here
+   (firing beforeunload, unload, pagehide) --&gt;
+
    &lt;li&gt;&lt;p&gt;&lt;span&gt;Traverse the history&lt;/span&gt; of the &lt;var
    title=&quot;&quot;&gt;specified browsing context&lt;/var&gt; to the &lt;var
    title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/p&gt;
@@ -63225,30 +63249,9 @@
 
   &lt;p&gt;When the user navigates through a &lt;span&gt;browsing context&lt;/span&gt;,
   e.g. using a browser's back and forward buttons, the user agent must
-  translate this action into the equivalent invocations of the &lt;code
-  title=&quot;dom-history-go&quot;&gt;history.go(&lt;var title=&quot;&quot;&gt;delta&lt;/var&gt;)&lt;/code&gt;
-  method on the various affected &lt;code
-  title=&quot;dom-window&quot;&gt;window&lt;/code&gt; objects.&lt;/p&gt;
+  &lt;span&gt;traverse the history by a delta&lt;/span&gt; equivalent to the
+  action specified by the user.&lt;/p&gt;
 
-  &lt;p&gt;Some of the other members of the &lt;code&gt;History&lt;/code&gt; interface
-  are defined in terms of the &lt;code title=&quot;dom-history-go&quot;&gt;go()&lt;/code&gt;
-  method, as follows:&lt;/p&gt;
-
-  &lt;table&gt;
-   &lt;tr&gt;
-    &lt;th&gt;Member&lt;/th&gt;
-    &lt;th&gt;Definition&lt;/th&gt;
-   &lt;/tr&gt;
-   &lt;tr&gt;
-    &lt;td&gt;&lt;dfn title=&quot;dom-history-back&quot;&gt;&lt;code&gt;back()&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Must do the same as &lt;code title=&quot;dom-history-go&quot;&gt;go(-1)&lt;/code&gt;&lt;/td&gt;
-   &lt;/tr&gt;
-   &lt;tr&gt;
-    &lt;td&gt;&lt;dfn title=&quot;dom-history-forward&quot;&gt;&lt;code&gt;forward()&lt;/code&gt;&lt;/dfn&gt;&lt;/td&gt;
-    &lt;td&gt;Must do the same as &lt;code title=&quot;dom-history-go&quot;&gt;go(1)&lt;/code&gt;&lt;/td&gt;
-   &lt;/tr&gt;
-  &lt;/table&gt;
-
   &lt;hr&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-history-pushState&quot;&gt;&lt;code&gt;pushState(&lt;var
@@ -63296,7 +63299,7 @@
 
      &lt;li&gt;If the &lt;span&gt;origin&lt;/span&gt; of the resulting &lt;span&gt;absolute
      URL&lt;/span&gt; is not the same as the &lt;span&gt;origin&lt;/span&gt; of the
-     &lt;span&gt;entry script&lt;/span&gt;'s &lt;code title=&quot;script's browsing
+     &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's browsing
      context&quot;&gt;browsing context&lt;/span&gt;, and either the &lt;span
      title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; or &lt;span
      title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; components of the two
@@ -63336,6 +63339,9 @@
 
      &lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;Remove any &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; queued
+     by the &lt;span&gt;history traversal task source&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
      &lt;li&gt;&lt;p&gt;Add a state object entry to the session history, after the
      &lt;span&gt;current entry&lt;/span&gt;, with &lt;var title=&quot;&quot;&gt;cloned data&lt;/var&gt; as
      the state object, the given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title,
@@ -63491,98 +63497,6 @@
 
 
 
-  &lt;h4&gt;&lt;dfn title=&quot;activate the state object&quot;&gt;Activating state object entries&lt;/dfn&gt;&lt;/h4&gt;
-
-  &lt;div class=&quot;impl&quot;&gt;
-
-  &lt;p&gt;When an entry in the session history is activated (which happens
-  during &lt;span title=&quot;traverse the history&quot;&gt;session history
-  traversal&lt;/span&gt;), the user agent must run the following steps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;!-- only called for the first entry of a Document set and for
-  state object entries, not for frag id change entries --&gt;
-
-   &lt;li&gt;&lt;p&gt;If the entry is a &lt;span&gt;state object&lt;/span&gt; entry, let &lt;var
-   title=&quot;&quot;&gt;state&lt;/var&gt; be a &lt;span&gt;structured clone&lt;/span&gt; of that
-   state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
-   null.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Run the appropriate steps according to the conditions
-    described:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the &lt;span&gt;current document readiness&lt;/span&gt; is set to the
-     string &quot;complete&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Synchronously fire a &lt;dfn
-     title=&quot;event-popstate&quot;&gt;&lt;code&gt;popstate&lt;/code&gt;&lt;/dfn&gt; event on the
-     &lt;code&gt;Window&lt;/code&gt; object of the &lt;code&gt;Document&lt;/code&gt;, using
-     the &lt;code&gt;PopStateEvent&lt;/code&gt; interface, with the &lt;code
-     title=&quot;dom-PopStateEvent-state&quot;&gt;state&lt;/code&gt; attribute set to the
-     value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble but
-     not be cancelable and has no default action.&lt;/p&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;Let the &lt;code&gt;Document&lt;/code&gt;'s &lt;dfn&gt;pending state
-     object&lt;/dfn&gt; be &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. (If there was already
-     a &lt;span&gt;pending state object&lt;/span&gt;, the previous one is
-     discarded.)&lt;/p&gt;
-
-     &lt;p class=&quot;note&quot;&gt;The event will then be fired just after the &lt;code
-     title=&quot;event-load&quot;&gt;load&lt;/code&gt; event.&lt;/p&gt;&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;The &lt;span&gt;pending state object&lt;/span&gt; must be initially null.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;/div&gt;
-
-  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;PopStateEvent&lt;/dfn&gt; : Event {
-  readonly attribute any &lt;span title=&quot;dom-PopStateEvent-state&quot;&gt;state&lt;/span&gt;;
-  void &lt;span title=&quot;dom-PopStateEvent-initPopStateEvent&quot;&gt;initPopStateEvent&lt;/span&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any stateArg);
-};&lt;/pre&gt;
-
-  &lt;dl class=&quot;domintro&quot;&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=&quot;dom-PopStateEvent-state&quot;&gt;state&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Returns the information that was provided to &lt;code
-    title=&quot;dom-history-pushState&quot;&gt;pushState()&lt;/code&gt; or &lt;code
-    title=&quot;dom-history-replaceState&quot;&gt;replaceState()&lt;/code&gt;.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;
-
-  &lt;div class=&quot;impl&quot;&gt;
-
-  &lt;p&gt;The &lt;dfn
-  title=&quot;dom-PopStateEvent-initPopStateEvent&quot;&gt;&lt;code&gt;initPopStateEvent()&lt;/code&gt;&lt;/dfn&gt;
-  method must initialize the event in a manner analogous to the
-  similarly-named method in the DOM Events interfaces. &lt;a
-  href=&quot;#refsDOMEVENTS&quot;&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn title=&quot;dom-PopStateEvent-state&quot;&gt;&lt;code&gt;state&lt;/code&gt;&lt;/dfn&gt;
-  attribute represents the context information for the event, or null,
-  if the state represented is the initial state of the
-  &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-
   &lt;h4&gt;The &lt;code&gt;Location&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; object in a &lt;span&gt;browsing
@@ -64352,6 +64266,12 @@
 
        &lt;/li&gt;
 
+       &lt;li&gt;&lt;p&gt;Remove any &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt;
+       queued by the &lt;span&gt;history traversal task
+       source&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt; &lt;!-- so the network is racing
+       history.back(), in the case of setting location.href=&quot;&quot; and
+       then calling history.back() --&gt;
+
        &lt;li&gt;&lt;p&gt;Append a new entry at the end of the &lt;code&gt;History&lt;/code&gt;
        object representing the new resource and its
        &lt;code&gt;Document&lt;/code&gt; object and related state.&lt;/p&gt;&lt;/li&gt;
@@ -64670,6 +64590,9 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Remove any &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; queued by
+   the &lt;span&gt;history traversal task source&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Append a new entry at the end of the &lt;code&gt;History&lt;/code&gt;
    object representing the new resource and its &lt;code&gt;Document&lt;/code&gt;
    object and related state. Its &lt;span&gt;URL&lt;/span&gt; must be set to the
@@ -64755,9 +64678,14 @@
   document&lt;/span&gt;, if that is an element; otherwise there is no
   &lt;i&gt;target element&lt;/i&gt;. &lt;a href=&quot;#refsSELECTORS&quot;&gt;[SELECTORS]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;/div&gt;
 
-  &lt;h4&gt;History traversal&lt;/h4&gt;
 
+
+  &lt;h4&gt;History traversal&lt;/h4&gt; &lt;!-- session history --&gt;
+
+  &lt;div class=&quot;impl&quot;&gt;
+
   &lt;p&gt;When a user agent is required to &lt;dfn&gt;traverse the history&lt;/dfn&gt;
   to a &lt;i&gt;specified entry&lt;/i&gt;, optionally with &lt;span&gt;replacement
   enabled&lt;/span&gt;, the user agent must act as follows:&lt;/p&gt;
@@ -64776,8 +64704,6 @@
    created. (This can never happen with &lt;span&gt;replacement
    enabled&lt;/span&gt;.)&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Release the &lt;span&gt;storage mutex&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;If the &lt;span&gt;current entry&lt;/span&gt;'s title was not set by the
    &lt;code title=&quot;dom-history-pushState&quot;&gt;pushState()&lt;/code&gt; or &lt;code
    title=&quot;dom-history-replaceState&quot;&gt;replaceState()&lt;/code&gt; methods,
@@ -64874,8 +64800,11 @@
    &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a URL that differs from
    the &lt;span&gt;current entry&lt;/span&gt;'s only by its fragment identifier,
    and the two share the same &lt;code&gt;Document&lt;/code&gt; object, then let
-   &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true. Otherwise, let &lt;var
-   title=&quot;&quot;&gt;hash changed&lt;/var&gt; be false.&lt;/p&gt;&lt;/li&gt;
+   &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var title=&quot;&quot;&gt;old
+   URL&lt;/var&gt; be the URL of the &lt;span&gt;current entry&lt;/span&gt; and &lt;var
+   title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;i&gt;specified
+   entry&lt;/i&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be
+   false.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the traversal was initiated with &lt;dfn&gt;replacement
    enabled&lt;/dfn&gt;, remove the entry immediately before the
@@ -64890,26 +64819,179 @@
    view, for instance the scroll position or values of form fields,
    that it had previously recorded.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is a state object or the
-   first entry for a &lt;code&gt;Document&lt;/code&gt;, the user agent must &lt;span
-   title=&quot;activate the state object&quot;&gt;activate that
-   entry&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is a state object or the first
+    entry for a &lt;code&gt;Document&lt;/code&gt;, the user agent must run the
+    following substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;If the entry is a &lt;span&gt;state object&lt;/span&gt; entry, let &lt;var
+     title=&quot;&quot;&gt;state&lt;/var&gt; be a &lt;span&gt;structured clone&lt;/span&gt; of that
+     state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
+     null.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Run the appropriate steps according to the conditions
+      described:&lt;/p&gt;
+
+      &lt;dl class=&quot;switch&quot;&gt;
+
+       &lt;dt&gt;If the &lt;span&gt;current document readiness&lt;/span&gt; is set to the
+       string &quot;complete&quot;&lt;/dt&gt;
+
+       &lt;dd&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to fire a &lt;code
+       title=&quot;event-popstate&quot;&gt;popstate&lt;/code&gt; event at the
+       &lt;code&gt;Window&lt;/code&gt; object of the &lt;code&gt;Document&lt;/code&gt;, using
+       the &lt;code&gt;PopStateEvent&lt;/code&gt; interface, with the &lt;code
+       title=&quot;dom-PopStateEvent-state&quot;&gt;state&lt;/code&gt; attribute set to
+       the value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble
+       but not be cancelable and has no default action.&lt;/p&gt;&lt;/dd&gt;
+
+       &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+       &lt;dd&gt;&lt;p&gt;Let the &lt;code&gt;Document&lt;/code&gt;'s &lt;dfn&gt;pending state
+       object&lt;/dfn&gt; be &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. (If there was already
+       a &lt;span&gt;pending state object&lt;/span&gt;, the previous one is
+       discarded.)&lt;/p&gt;
+
+       &lt;p class=&quot;note&quot;&gt;The event will then be fired just after the &lt;code
+       title=&quot;event-load&quot;&gt;load&lt;/code&gt; event.&lt;/p&gt;&lt;/dd&gt;
+
+      &lt;/dl&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; is true, then
-   synchronously &lt;span&gt;fire a simple event&lt;/span&gt; with the name &lt;code
-   title=&quot;event-hashchange&quot;&gt;hashchange&lt;/code&gt; at the &lt;span&gt;browsing
-   context&lt;/span&gt;'s &lt;code&gt;Window&lt;/code&gt; object.&lt;/p&gt;&lt;/li&gt;
+   &lt;span&gt;queue a task&lt;/span&gt; to fire a &lt;code
+   title=&quot;event-hashchange&quot;&gt;hashchange&lt;/code&gt; event at the
+   &lt;span&gt;browsing context&lt;/span&gt;'s &lt;code&gt;Window&lt;/code&gt; object, using
+   the &lt;code&gt;HashChangeEvent&lt;/code&gt; interface, with the &lt;code
+   title=&quot;dom-HashChangeEvent-oldURL&quot;&gt;oldURL&lt;/code&gt; attribute set to
+   &lt;var title=&quot;&quot;&gt;old URL&lt;/var&gt; and the &lt;code
+   title=&quot;dom-HashChangeEvent-newURL&quot;&gt;newURL&lt;/code&gt; attribute set to
+   &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt;. This event must bubble but not be
+   cancelable and has no default action.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Release the &lt;span&gt;storage mutex&lt;/span&gt; again.&lt;/p&gt;&lt;/li&gt;
-
    &lt;li&gt;&lt;p&gt;The &lt;span&gt;current entry&lt;/span&gt; is now the &lt;i&gt;specified
    entry&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
+  &lt;p&gt;The &lt;span&gt;pending state object&lt;/span&gt; must be initially null.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;span&gt;task source&lt;/span&gt; for the tasks mentioned above is the
+  &lt;span&gt;DOM manipulation task source&lt;/span&gt;.&lt;/p&gt;
+
+
+  &lt;h5&gt;Event definitions&lt;/h5&gt;
+
   &lt;/div&gt;
 
+  &lt;p&gt;The &lt;dfn title=&quot;event-popstate&quot;&gt;&lt;code&gt;popstate&lt;/code&gt;&lt;/dfn&gt; event
+  is fired when navigating to a &lt;span&gt;session history entry&lt;/span&gt;
+  that represents a state object.&lt;/p&gt;
 
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;PopStateEvent&lt;/dfn&gt; : Event {
+  readonly attribute any &lt;span title=&quot;dom-PopStateEvent-state&quot;&gt;state&lt;/span&gt;;
+  void &lt;span title=&quot;dom-PopStateEvent-initPopStateEvent&quot;&gt;initPopStateEvent&lt;/span&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in any stateArg);
+};&lt;/pre&gt;
+
+  &lt;dl class=&quot;domintro&quot;&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=&quot;dom-PopStateEvent-state&quot;&gt;state&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the information that was provided to &lt;code
+    title=&quot;dom-history-pushState&quot;&gt;pushState()&lt;/code&gt; or &lt;code
+    title=&quot;dom-history-replaceState&quot;&gt;replaceState()&lt;/code&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;div class=&quot;impl&quot;&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-PopStateEvent-initPopStateEvent&quot;&gt;&lt;code&gt;initPopStateEvent()&lt;/code&gt;&lt;/dfn&gt;
+  method must initialize the event in a manner analogous to the
+  similarly-named method in the DOM Events interfaces. &lt;a
+  href=&quot;#refsDOMEVENTS&quot;&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;dom-PopStateEvent-state&quot;&gt;&lt;code&gt;state&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents the context information for the event, or null,
+  if the state represented is the initial state of the
+  &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The &lt;dfn title=&quot;event-hashchange&quot;&gt;&lt;code&gt;hashchange&lt;/code&gt;&lt;/dfn&gt;
+  event is fired when navigating to a &lt;span&gt;session history
+  entry&lt;/span&gt; whose &lt;span&gt;URL&lt;/span&gt; differs from that of the
+  previous one only in the fragment identifier.&lt;/p&gt;
+
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;HashChangeEvent&lt;/dfn&gt; : Event {
+  readonly attribute any &lt;span title=&quot;dom-HashChangeEvent-oldURL&quot;&gt;oldURL&lt;/span&gt;;
+  readonly attribute any &lt;span title=&quot;dom-HashChangeEvent-newURL&quot;&gt;newURL&lt;/span&gt;;
+  void &lt;span title=&quot;dom-HashChangeEvent-initHashChangeEvent&quot;&gt;initHashChangeEvent&lt;/span&gt;(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in DOMString oldURLArg, in DOMString newURLArg);
+};&lt;/pre&gt;
+
+  &lt;dl class=&quot;domintro&quot;&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=&quot;dom-HashChangeEvent-oldURL&quot;&gt;oldURL&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;span&gt;URL&lt;/span&gt; of the &lt;span&gt;session history
+    entry&lt;/span&gt; that was previously current.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;event&lt;/var&gt; . &lt;code title=&quot;dom-HashChangeEvent-newURL&quot;&gt;newURL&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;span&gt;URL&lt;/span&gt; of the &lt;span&gt;session history
+    entry&lt;/span&gt; that is now current.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;div class=&quot;impl&quot;&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HashChangeEvent-initHashChangeEvent&quot;&gt;&lt;code&gt;initHashChangeEvent()&lt;/code&gt;&lt;/dfn&gt;
+  method must initialize the event in a manner analogous to the
+  similarly-named method in the DOM Events interfaces. &lt;a
+  href=&quot;#refsDOMEVENTS&quot;&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HashChangeEvent-oldURL&quot;&gt;&lt;code&gt;oldURL&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents context information for the event, specifically
+  the URL of the &lt;span&gt;session history entry&lt;/span&gt; that was traversed
+  from.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-HashChangeEvent-newURL&quot;&gt;&lt;code&gt;newURL&lt;/code&gt;&lt;/dfn&gt;
+  attribute represents context information for the event, specifically
+  the URL of the &lt;span&gt;session history entry&lt;/span&gt; that was traversed
+  to.&lt;/p&gt;
+
+  &lt;/div&gt;
+
+
+
   &lt;h4&gt;Unloading documents&lt;/h4&gt;
 
   &lt;div class=&quot;impl&quot;&gt;
@@ -65125,6 +65207,8 @@
   &lt;/div&gt;
 
 
+  &lt;div class=&quot;impl&quot;&gt;
+
   &lt;h4&gt;Aborting a document load&lt;/h4&gt;
 
   &lt;p&gt;If the user cancels any instance of the &lt;span
@@ -65138,8 +65222,10 @@
   &lt;!-- I'd love to make this more precise, anyone have any suggestions
   on what it should say? --&gt;
 
+  &lt;/div&gt;
 
 
+
   &lt;h3 id=&quot;links&quot;&gt;Links&lt;/h3&gt;
 
 
@@ -97235,7 +97321,7 @@
 
     &lt;tr&gt;
      &lt;td&gt; &lt;code title=&quot;event-hashchange&quot;&gt;hashchange&lt;/code&gt;
-     &lt;td&gt; &lt;code&gt;Event&lt;/code&gt;
+     &lt;td&gt; &lt;code&gt;HashChangeEvent&lt;/code&gt;
      &lt;td&gt; Fired at the &lt;code&gt;Window&lt;/code&gt; when the fragment identifier part of &lt;span&gt;the document's current address&lt;/span&gt; changes
 
     &lt;tr&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011499.html">[html5] r4631 - [giowt] (0) Update to new DC term.
</A></li>
	<LI>Next message: <A HREF="011501.html">[html5] r4633 - [giowt] (0) Microdata: Make the RDF output not	generate duplicate blank nodes fo [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11500">[ date ]</a>
              <a href="thread.html#11500">[ thread ]</a>
              <a href="subject.html#11500">[ subject ]</a>
              <a href="author.html#11500">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
