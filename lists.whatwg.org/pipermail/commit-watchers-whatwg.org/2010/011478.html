<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r4610 - [acgiowt] (0) Change how itemref='' is processed to	prevent infinite loops in th [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4610%20-%20%5Bacgiowt%5D%20%280%29%20Change%20how%20itemref%3D%27%27%20is%20processed%20to%0A%09prevent%20infinite%20loops%20in%20th%20%5B...%5D&In-Reply-To=%3C20100118125535.A06DA805806D%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011477.html">
   <LINK REL="Next"  HREF="011479.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r4610 - [acgiowt] (0) Change how itemref='' is processed to	prevent infinite loops in th [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4610%20-%20%5Bacgiowt%5D%20%280%29%20Change%20how%20itemref%3D%27%27%20is%20processed%20to%0A%09prevent%20infinite%20loops%20in%20th%20%5B...%5D&In-Reply-To=%3C20100118125535.A06DA805806D%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r4610 - [acgiowt] (0) Change how itemref='' is processed to	prevent infinite loops in th [...]">whatwg at whatwg.org
       </A><BR>
    <I>Mon Jan 18 04:55:35 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="011477.html">[html5] r4609 - [acgiowt] (0) Reverting itemref='' change to fix it	(it broke itemref='' referen [...]
</A></li>
        <LI>Next message: <A HREF="011479.html">[html5] r4611 - [e] (0) uncooked example copypasta
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11478">[ date ]</a>
              <a href="thread.html#11478">[ thread ]</a>
              <a href="subject.html#11478">[ subject ]</a>
              <a href="author.html#11478">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-01-18 04:55:33 -0800 (Mon, 18 Jan 2010)
New Revision: 4610

Modified:
   complete.html
   index
   source
Log:
[acgiowt] (0) Change how itemref='' is processed to prevent infinite loops in the algorithms that handle microdata. (Mark II)

Modified: complete.html
===================================================================
--- complete.html	2010-01-18 11:08:58 UTC (rev 4609)
+++ complete.html	2010-01-18 12:55:33 UTC (rev 4610)
@@ -621,27 +621,28 @@
      &lt;li&gt;&lt;a href=#items&gt;&lt;span class=secno&gt;5.2.2 &lt;/span&gt;Items&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#names:-the-itemprop-attribute&gt;&lt;span class=secno&gt;5.2.3 &lt;/span&gt;Names: the &lt;code&gt;itemprop&lt;/code&gt; attribute&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#values&gt;&lt;span class=secno&gt;5.2.4 &lt;/span&gt;Values&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#associating-names-with-items&gt;&lt;span class=secno&gt;5.2.5 &lt;/span&gt;Associating names with items&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#examples-1&gt;&lt;span class=secno&gt;5.2.6 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#associating-names-with-items&gt;&lt;span class=secno&gt;5.2.5 &lt;/span&gt;Associating names with items&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#microdata-dom-api&gt;&lt;span class=secno&gt;5.3 &lt;/span&gt;Microdata DOM API&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#mdvocabs&gt;&lt;span class=secno&gt;5.4 &lt;/span&gt;Microdata vocabularies&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#vcard&gt;&lt;span class=secno&gt;5.4.1 &lt;/span&gt;vCard&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#conversion-to-vcard&gt;&lt;span class=secno&gt;5.4.1.1 &lt;/span&gt;Conversion to vCard&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#examples-2&gt;&lt;span class=secno&gt;5.4.1.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#examples-1&gt;&lt;span class=secno&gt;5.4.1.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#vevent&gt;&lt;span class=secno&gt;5.4.2 &lt;/span&gt;vEvent&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#conversion-to-icalendar&gt;&lt;span class=secno&gt;5.4.2.1 &lt;/span&gt;Conversion to iCalendar&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#examples-3&gt;&lt;span class=secno&gt;5.4.2.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#examples-2&gt;&lt;span class=secno&gt;5.4.2.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#licensing-works&gt;&lt;span class=secno&gt;5.4.3 &lt;/span&gt;Licensing works&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#conversion-to-rdf&gt;&lt;span class=secno&gt;5.4.3.1 &lt;/span&gt;Conversion to RDF&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#examples-4&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#examples-3&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#converting-html-to-other-formats&gt;&lt;span class=secno&gt;5.5 &lt;/span&gt;Converting HTML to other formats&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#json&gt;&lt;span class=secno&gt;5.5.1 &lt;/span&gt;JSON&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#rdf&gt;&lt;span class=secno&gt;5.5.2 &lt;/span&gt;RDF&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#rdf&gt;&lt;span class=secno&gt;5.5.2 &lt;/span&gt;RDF&lt;/a&gt;
+      &lt;ol&gt;
+       &lt;li&gt;&lt;a href=#examples-4&gt;&lt;span class=secno&gt;5.5.2.1 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#atom&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Atom&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#browsers&gt;&lt;span class=secno&gt;6 &lt;/span&gt;Web browsers&lt;/a&gt;
   &lt;ol&gt;
@@ -45473,9 +45474,8 @@
 
   &lt;p&gt;The &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, if
   specified, must have a value that is an &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;unordered set of
-  unique space-separated tokens&lt;/a&gt; consisting of &lt;a href=#concept-id title=concept-ID&gt;IDs&lt;/a&gt; of elements in the same document; for
-  each one, the element's nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified, if any,
-  must not be the element with the referencing &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute specified.&lt;/p&gt;
+  unique space-separated tokens&lt;/a&gt; consisting of &lt;a href=#concept-id title=concept-ID&gt;IDs&lt;/a&gt; of elements in the same &lt;a href=#home-subtree&gt;home
+  subtree&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute must not
   be specified on elements that do not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified.&lt;/p&gt;
@@ -45661,126 +45661,175 @@
 
   &lt;h4 id=associating-names-with-items&gt;&lt;span class=secno&gt;5.2.5 &lt;/span&gt;Associating names with items&lt;/h4&gt;
 
-  &lt;p&gt;To find &lt;dfn id=the-properties-of-an-item&gt;the properties of an item&lt;/dfn&gt;, the user agent must
-  run the following steps:&lt;/p&gt;
+  &lt;p&gt;To find &lt;dfn id=the-properties-of-an-item&gt;the properties of an item&lt;/dfn&gt; defined by the
+  element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, the user agent must try to
+  &lt;a href=#crawl-the-properties&gt;crawl the properties&lt;/a&gt; of the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, with an empty list as the value of &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;: if this fails, then &lt;a href=#the-properties-of-an-item title=&quot;the
+  properties of an item&quot;&gt;the properties of the item&lt;/a&gt; defined by
+  the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is an empty list; otherwise, it
+  is the returned list.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute.&lt;/li&gt;
+  &lt;p&gt;To &lt;dfn id=crawl-the-properties&gt;crawl the properties&lt;/dfn&gt; of an element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; with a list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, the user
+  agent must run the following steps:&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; be a stack of elements
-   initially containing the child elements of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, if any. This list will be the one that holds
-   the elements that still need to be crawled.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is in &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, then the algorithm fails; abort these
+   steps.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt; be an empty list of
-   elements. This list will be the result of the algorithm: a list of
-   elements with properties that apply to &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;a href=#collect-all-the-elements-in-the-item&gt;Collect all the elements in the item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, and let &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; be the
+   result.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, &lt;a href=#split-a-string-on-spaces title=&quot;split a
-   string on spaces&quot;&gt;split the value of that &lt;code title=attr-itemref&gt;itemref&lt;/code&gt; attribute on spaces&lt;/a&gt;. For
-   each resulting token, &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an
-   element in the document with the &lt;a href=#concept-id title=concept-ID&gt;ID&lt;/a&gt;
-   &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then push the first such element onto &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is in &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;, then the algorithm fails; abort these
+   steps.&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If any elements are listed in &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;
+   more than once, then the algorithm fails; abort these
+   steps.&lt;/li&gt;
 
-    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;, run the following substeps:&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Remove any elements from &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; that do
+   not have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute
+   specified.&lt;/li&gt;
 
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;'s nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified, if
-     any, or null otherwise.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new memory&lt;/var&gt; be a new list consisting
+   of the old list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; with the addition of
+   &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If one of the other elements in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;
-     is also &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;
-     (i.e. remove duplicates).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;For each element in &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; that has an
+   &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified,
+   &lt;a href=#crawl-the-properties&gt;crawl the properties&lt;/a&gt; of the element, with &lt;var title=&quot;&quot;&gt;new memory&lt;/var&gt; as the memory. If this fails, then this
+   instance of the algorithm fails as well; abort these steps. (If it
+   succeeds, the return value is discarded.)&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; is an ancestor element of &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element is &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;
-     from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; (since &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; will be reached anyway as part of
-     processing &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; in &lt;a href=#tree-order&gt;tree
+   order&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; is an ancestor element of &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, and either &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; is
-     null or that element also has &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; as its
-     nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified, then
-     remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; (since &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; will
-     be reached anyway as part of processing &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/li&gt;
 
-    &lt;/ol&gt;&lt;/li&gt;
+  &lt;/ol&gt;&lt;p&gt;To &lt;dfn id=collect-all-the-elements-in-the-item&gt;collect all the elements in the item&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, the user agent must run these steps:&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; in &lt;a href=#tree-order&gt;tree
-   order&lt;/a&gt;.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; be empty lists of elements.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Pop the top element from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; be that
+   &lt;li&gt;&lt;p&gt;Add all the children elements of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; to
+   &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, &lt;a href=#split-a-string-on-spaces title=&quot;split a
+   string on spaces&quot;&gt;split the value of that &lt;code title=attr-itemref&gt;itemref&lt;/code&gt; attribute on spaces&lt;/a&gt;. For
+   each resulting token &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an element
+   in the &lt;a href=#home-subtree&gt;home subtree&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; with
+   the &lt;a href=#concept-id title=concept-ID&gt;ID&lt;/a&gt; &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then
+   add the first such element to &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Remove an element from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; be that
    element.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; has an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute, then append &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child elements, then:
-   push all the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; onto
-   &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so the first
-   child of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be
-   popped from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute, then: add all
+   the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;i&gt;End of loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; is not
    empty, return to the step marked &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;. That is the list of
-   &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;properties of the
-   item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. By definition, this list is
-   in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;A document must not contain any elements that have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute that would not be
+  &lt;/ol&gt;&lt;p&gt;An &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; is a &lt;dfn id=top-level-microdata-items title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/dfn&gt; if
+  its element does not have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
+
+  &lt;p&gt;An &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; is a &lt;dfn id=used-microdata-items title=&quot;used
+  microdata items&quot;&gt;used microdata item&lt;/dfn&gt; if it is a &lt;a href=#top-level-microdata-items title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/a&gt;,
+  or if it has an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt;
+  attribute and would be &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;found
+  to be the property&lt;/a&gt; of an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; that is itself a &lt;a href=#used-microdata-items title=&quot;used
+  microdata items&quot;&gt;used microdata item&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;A document must not contain any &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; that are not &lt;a href=#used-microdata-items&gt;used microdata
+  items&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;A document must not contain any elements that have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute that would not be
   found to be a property of any of the &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; in that document were their &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;properties&lt;/a&gt; all to be
   determined.&lt;/p&gt;
 
-  &lt;p&gt;An &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; is a &lt;dfn id=top-level-microdata-items title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/dfn&gt; if
-  its element does not have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
+  &lt;p&gt;A document must not contain any &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; for which &lt;a href=#crawl-the-properties title=&quot;crawl the
+  properties&quot;&gt;crawling the properties&lt;/a&gt; of the element, with an
+  empty list as the value of &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, fails.&lt;/p&gt;
 
+  &lt;p class=note&gt;The algorithms in this section are especially
+  inefficient, in the interests of keeping them easy to
+  understand. Implementors are strongly encouraged to refactor and
+  optimise them in their user agents.&lt;/p&gt;
 
-  &lt;h4 id=examples-1&gt;&lt;span class=secno&gt;5.2.6 &lt;/span&gt;Examples&lt;/h4&gt;
+  &lt;div class=example&gt;
 
-  &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
-  statements:&lt;/p&gt;
+   &lt;p&gt;In this example, a single license statement is applied to two
+   works, using &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; from the
+   items representing the works:&lt;/p&gt;
 
-  &lt;pre&gt;&lt;dl itemscope
-    itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Work">http://purl.org/vocab/frbr/core#Work</A>&quot;
-    itemid=&quot;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N">http://purl.oreilly.com/works/45U8QJGZSQKDH8N</A>&quot;&gt;
- &lt;dt&gt;Title&lt;/dt&gt;
- &lt;dd&gt;&lt;cite itemprop=&quot;<A HREF="http://purl.org/dc/terms/title">http://purl.org/dc/terms/title</A>&quot;&gt;Just a Geek&lt;/cite&gt;&lt;/dd&gt;
- &lt;dt&gt;By&lt;/dt&gt;
- &lt;dd&gt;&lt;span itemprop=&quot;<A HREF="http://purl.org/dc/terms/creator">http://purl.org/dc/terms/creator</A>&quot;&gt;Wil Wheaton&lt;/span&gt;&lt;/dd&gt;
- &lt;dt&gt;Format&lt;/dt&gt;
- &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
-     itemscope
-     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
-     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&quot;&gt;
-  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/BOOK">http://purl.oreilly.com/product-types/BOOK</A>&quot;&gt;
-  Print
- &lt;/dd&gt;
- &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
-     itemscope
-     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
-     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&quot;&gt;
-  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&quot;&gt;
-  Ebook
- &lt;/dd&gt;
-&lt;/dl&gt;&lt;/pre&gt;
+   &lt;pre&gt;&lt;!DOCTYPE HTML&gt;
+&lt;html&gt;
+ &lt;head&gt;
+  &lt;title&gt;Photo gallery&lt;/title&gt;
+ &lt;/head&gt;
+ &lt;body&gt;
+  &lt;h1&gt;My photos&lt;/h1&gt;
+  &lt;figure itemscope itemtype=&quot;<A HREF="http://n.whatwg.org/work">http://n.whatwg.org/work</A>&quot; itemref=&quot;licenses&quot;&gt;
+   &lt;img itemprop=&quot;work&quot; src=&quot;images/house.jpeg&quot; alt=&quot;A white house, boarded up, sits in a forest.&quot;&gt;
+   &lt;figcaption itemprop=&quot;title&quot;&gt;The house I found.&lt;/figcaption&gt;
+  &lt;/figure&gt;
+  &lt;figure itemscope itemtype=&quot;<A HREF="http://n.whatwg.org/work">http://n.whatwg.org/work</A>&quot; itemref=&quot;licenses&quot;&gt;
+   &lt;img itemprop=&quot;work&quot; src=&quot;images/mailbox.jpeg&quot; alt=&quot;Outside the house is a mailbox. It has a leaflet inside.&quot;&gt;
+   &lt;figcaption itemprop=&quot;title&quot;&gt;The mailbox.&lt;/figcaption&gt;
+  &lt;/figure&gt;
+  &lt;footer&gt;
+   &lt;p id=&quot;licenses&quot;&gt;All images licensed under the &lt;a itemprop=&quot;license&quot;
+   href=&quot;<A HREF="http://www.opensource.org/licenses/mit-license.php">http://www.opensource.org/licenses/mit-license.php</A>&quot;&gt;MIT
+   license&lt;/a&gt;.&lt;/p&gt;
+  &lt;/footer&gt;
+ &lt;/body&gt;
+&lt;/html&gt;&lt;/pre&gt;
 
-  &lt;p&gt;This is equivalent to the following Turtle:&lt;/p&gt;
+   &lt;p&gt;The above results in two items with the type &quot;&lt;code title=&quot;&quot;&gt;<A HREF="http://n.whatwg.org/work&lt;/code">http://n.whatwg.org/work&lt;/code</A>&gt;&quot;, one with:&lt;/p&gt;
 
-  &lt;pre&gt;@prefix dc: &lt;<A HREF="http://purl.org/dc/terms/&amp;gt;">http://purl.org/dc/terms/&gt;</A> .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">- at prefix</A> frbr: &lt;<A HREF="http://purl.org/vocab/frbr/core#&amp;gt;">http://purl.org/vocab/frbr/core#&gt;</A> .
+   &lt;dl class=brief&gt;&lt;dt&gt;work
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;images/house.jpeg&lt;/code&gt;
+    &lt;dt&gt;title
+    &lt;dd&gt;The house I found.
+    &lt;dt&gt;license
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.opensource.org/licenses/mit-license.php&lt;/code">http://www.opensource.org/licenses/mit-license.php&lt;/code</A>&gt;
+   &lt;/dl&gt;&lt;p&gt;...and one with:&lt;/p&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N&amp;gt;">http://purl.oreilly.com/works/45U8QJGZSQKDH8N&gt;</A> a frbr:Work ;
-     dc:creator &quot;Wil Wheaton&quot;@en ;
-     dc:title &quot;Just a Geek&quot;@en ;
-     frbr:realization &lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK&amp;gt;,">http://purl.oreilly.com/products/9780596007683.BOOK&gt;,</A>
-         &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> . 
+   &lt;dl class=brief&gt;&lt;dt&gt;work
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;images/mailbox.jpeg&lt;/code&gt;
+    &lt;dt&gt;title
+    &lt;dd&gt;The mailbox.
+    &lt;dt&gt;license
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.opensource.org/licenses/mit-license.php&lt;/code">http://www.opensource.org/licenses/mit-license.php&lt;/code</A>&gt;
+   &lt;/dl&gt;&lt;/div&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK&amp;gt;">http://purl.oreilly.com/products/9780596007683.BOOK&gt;</A> a frbr:Expression ;
-     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/BOOK&amp;gt;">http://purl.oreilly.com/product-types/BOOK&gt;</A> . 
+  &lt;div class=example&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> a frbr:Expression ;
-     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK&amp;gt;">http://purl.oreilly.com/product-types/EBOOK&gt;</A> .&lt;/pre&gt;
+   &lt;p&gt;In the following invalid example, the items are all empty,
+   because the &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute on
+   the inner nested item indirectly references the same element twice
+   in the same item:&lt;/p&gt;
 
+   &lt;pre class=bad&gt;&lt;!-- invalid example - do not copy --&gt;
+&lt;div itemscope&gt;
+ &lt;span itemprop=&quot;example&quot;&gt;This is &lt;em&gt;not&lt;/em&gt; a property of the
+ &lt;code&gt;div&lt;/code&gt; element.&lt;/span&gt;
+ &lt;p itemprop=&quot;demo&quot; itemscope itemref=&quot;test thing&quot;&gt; &lt;!-- &quot;thing&quot; is a descendant
+                   of &quot;test&quot;, which leads to it being included twice, which is invalid --&gt;
+  &lt;span itemprop=&quot;sample&quot;&gt;This isn't part of anything either.&lt;/span&gt;
+ &lt;/p&gt;
+&lt;/div&gt;
+&lt;p id=&quot;test&quot;&gt;
+ &lt;span id=&quot;thing&quot;&gt;(this element is referenced twice by the
+ &lt;code&gt;p&lt;/code&gt; above, causing all the items that involve that
+ &lt;code&gt;itemref=&quot;&quot;&lt;/code&gt; attribute to act as if they had no
+ properties.)&lt;/span&gt;
+&lt;/p&gt;&lt;/pre&gt;
 
+  &lt;/div&gt;
 
+
+
   &lt;h3 id=microdata-dom-api&gt;&lt;span class=secno&gt;5.3 &lt;/span&gt;Microdata DOM API&lt;/h3&gt;
 
 
@@ -47590,7 +47639,7 @@
 
 
 
-  &lt;h5 id=examples-2&gt;&lt;span class=secno&gt;5.4.1.2 &lt;/span&gt;Examples&lt;/h5&gt;
+  &lt;h5 id=examples-1&gt;&lt;span class=secno&gt;5.4.1.2 &lt;/span&gt;Examples&lt;/h5&gt;
 
   &lt;div class=example&gt;
 
@@ -48401,7 +48450,7 @@
 
 
 
-  &lt;h5 id=examples-3&gt;&lt;span class=secno&gt;5.4.2.2 &lt;/span&gt;Examples&lt;/h5&gt;
+  &lt;h5 id=examples-2&gt;&lt;span class=secno&gt;5.4.2.2 &lt;/span&gt;Examples&lt;/h5&gt;
 
 &lt;!-- get more from <A HREF="http://www.ietf.org/rfc/rfc2445.txt">http://www.ietf.org/rfc/rfc2445.txt</A> --&gt;
 
@@ -48584,7 +48633,7 @@
 
 
 
-  &lt;h5 id=examples-4&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Examples&lt;/h5&gt;
+  &lt;h5 id=examples-3&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Examples&lt;/h5&gt;
 
   &lt;div class=example&gt;
 
@@ -48927,8 +48976,58 @@
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;h4 id=atom&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Atom&lt;/h4&gt;
+  &lt;/ol&gt;&lt;h5 id=examples-4&gt;&lt;span class=secno&gt;5.5.2.1 &lt;/span&gt;Examples&lt;/h5&gt;
 
+  &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
+  statements:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;dl itemscope
+    itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Work">http://purl.org/vocab/frbr/core#Work</A>&quot;
+    itemid=&quot;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N">http://purl.oreilly.com/works/45U8QJGZSQKDH8N</A>&quot;&gt;
+ &lt;dt&gt;Title&lt;/dt&gt;
+ &lt;dd&gt;&lt;cite itemprop=&quot;<A HREF="http://purl.org/dc/terms/title">http://purl.org/dc/terms/title</A>&quot;&gt;Just a Geek&lt;/cite&gt;&lt;/dd&gt;
+ &lt;dt&gt;By&lt;/dt&gt;
+ &lt;dd&gt;&lt;span itemprop=&quot;<A HREF="http://purl.org/dc/terms/creator">http://purl.org/dc/terms/creator</A>&quot;&gt;Wil Wheaton&lt;/span&gt;&lt;/dd&gt;
+ &lt;dt&gt;Format&lt;/dt&gt;
+ &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
+     itemscope
+     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
+     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&quot;&gt;
+  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/BOOK">http://purl.oreilly.com/product-types/BOOK</A>&quot;&gt;
+  Print
+ &lt;/dd&gt;
+ &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
+     itemscope
+     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
+     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&quot;&gt;
+  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&quot;&gt;
+  Ebook
+ &lt;/dd&gt;
+&lt;/dl&gt;&lt;/pre&gt;
+
+  &lt;p&gt;This is equivalent to the following Turtle:&lt;/p&gt;
+
+  &lt;pre&gt;@prefix dc: &lt;<A HREF="http://purl.org/dc/terms/&amp;gt;">http://purl.org/dc/terms/&gt;</A> .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> frbr: &lt;<A HREF="http://purl.org/vocab/frbr/core#&amp;gt;">http://purl.org/vocab/frbr/core#&gt;</A> .
+
+&lt;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N&amp;gt;">http://purl.oreilly.com/works/45U8QJGZSQKDH8N&gt;</A> a frbr:Work ;
+     dc:creator &quot;Wil Wheaton&quot;@en ;
+     dc:title &quot;Just a Geek&quot;@en ;
+     frbr:realization &lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK&amp;gt;,">http://purl.oreilly.com/products/9780596007683.BOOK&gt;,</A>
+         &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> . 
+
+&lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK&amp;gt;">http://purl.oreilly.com/products/9780596007683.BOOK&gt;</A> a frbr:Expression ;
+     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/BOOK&amp;gt;">http://purl.oreilly.com/product-types/BOOK&gt;</A> . 
+
+&lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> a frbr:Expression ;
+     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK&amp;gt;">http://purl.oreilly.com/product-types/EBOOK&gt;</A> .&lt;/pre&gt;
+
+
+
+
+
+  &lt;h4 id=atom&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Atom&lt;/h4&gt;
+
   &lt;p&gt;Given a &lt;code&gt;Document&lt;/code&gt; &lt;var title=&quot;&quot;&gt;source&lt;/var&gt;, a user
   agent may run the following algorithm to &lt;dfn id=extracting-atom title=&quot;extracting
   Atom&quot;&gt;extract an Atom feed&lt;/dfn&gt;. This is not the only algorithm

Modified: index
===================================================================
--- index	2010-01-18 11:08:58 UTC (rev 4609)
+++ index	2010-01-18 12:55:33 UTC (rev 4610)
@@ -628,27 +628,28 @@
      &lt;li&gt;&lt;a href=#items&gt;&lt;span class=secno&gt;5.2.2 &lt;/span&gt;Items&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#names:-the-itemprop-attribute&gt;&lt;span class=secno&gt;5.2.3 &lt;/span&gt;Names: the &lt;code&gt;itemprop&lt;/code&gt; attribute&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#values&gt;&lt;span class=secno&gt;5.2.4 &lt;/span&gt;Values&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#associating-names-with-items&gt;&lt;span class=secno&gt;5.2.5 &lt;/span&gt;Associating names with items&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#examples-1&gt;&lt;span class=secno&gt;5.2.6 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#associating-names-with-items&gt;&lt;span class=secno&gt;5.2.5 &lt;/span&gt;Associating names with items&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#microdata-dom-api&gt;&lt;span class=secno&gt;5.3 &lt;/span&gt;Microdata DOM API&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#mdvocabs&gt;&lt;span class=secno&gt;5.4 &lt;/span&gt;Microdata vocabularies&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#vcard&gt;&lt;span class=secno&gt;5.4.1 &lt;/span&gt;vCard&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#conversion-to-vcard&gt;&lt;span class=secno&gt;5.4.1.1 &lt;/span&gt;Conversion to vCard&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#examples-2&gt;&lt;span class=secno&gt;5.4.1.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#examples-1&gt;&lt;span class=secno&gt;5.4.1.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#vevent&gt;&lt;span class=secno&gt;5.4.2 &lt;/span&gt;vEvent&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#conversion-to-icalendar&gt;&lt;span class=secno&gt;5.4.2.1 &lt;/span&gt;Conversion to iCalendar&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#examples-3&gt;&lt;span class=secno&gt;5.4.2.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#examples-2&gt;&lt;span class=secno&gt;5.4.2.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#licensing-works&gt;&lt;span class=secno&gt;5.4.3 &lt;/span&gt;Licensing works&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#conversion-to-rdf&gt;&lt;span class=secno&gt;5.4.3.1 &lt;/span&gt;Conversion to RDF&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#examples-4&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#examples-3&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#converting-html-to-other-formats&gt;&lt;span class=secno&gt;5.5 &lt;/span&gt;Converting HTML to other formats&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#json&gt;&lt;span class=secno&gt;5.5.1 &lt;/span&gt;JSON&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#rdf&gt;&lt;span class=secno&gt;5.5.2 &lt;/span&gt;RDF&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#rdf&gt;&lt;span class=secno&gt;5.5.2 &lt;/span&gt;RDF&lt;/a&gt;
+      &lt;ol&gt;
+       &lt;li&gt;&lt;a href=#examples-4&gt;&lt;span class=secno&gt;5.5.2.1 &lt;/span&gt;Examples&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#atom&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Atom&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#browsers&gt;&lt;span class=secno&gt;6 &lt;/span&gt;Web browsers&lt;/a&gt;
   &lt;ol&gt;
@@ -45373,9 +45374,8 @@
 
   &lt;p&gt;The &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, if
   specified, must have a value that is an &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;unordered set of
-  unique space-separated tokens&lt;/a&gt; consisting of &lt;a href=#concept-id title=concept-ID&gt;IDs&lt;/a&gt; of elements in the same document; for
-  each one, the element's nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified, if any,
-  must not be the element with the referencing &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute specified.&lt;/p&gt;
+  unique space-separated tokens&lt;/a&gt; consisting of &lt;a href=#concept-id title=concept-ID&gt;IDs&lt;/a&gt; of elements in the same &lt;a href=#home-subtree&gt;home
+  subtree&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute must not
   be specified on elements that do not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified.&lt;/p&gt;
@@ -45561,126 +45561,175 @@
 
   &lt;h4 id=associating-names-with-items&gt;&lt;span class=secno&gt;5.2.5 &lt;/span&gt;Associating names with items&lt;/h4&gt;
 
-  &lt;p&gt;To find &lt;dfn id=the-properties-of-an-item&gt;the properties of an item&lt;/dfn&gt;, the user agent must
-  run the following steps:&lt;/p&gt;
+  &lt;p&gt;To find &lt;dfn id=the-properties-of-an-item&gt;the properties of an item&lt;/dfn&gt; defined by the
+  element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, the user agent must try to
+  &lt;a href=#crawl-the-properties&gt;crawl the properties&lt;/a&gt; of the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, with an empty list as the value of &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;: if this fails, then &lt;a href=#the-properties-of-an-item title=&quot;the
+  properties of an item&quot;&gt;the properties of the item&lt;/a&gt; defined by
+  the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is an empty list; otherwise, it
+  is the returned list.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the element with the &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute.&lt;/li&gt;
+  &lt;p&gt;To &lt;dfn id=crawl-the-properties&gt;crawl the properties&lt;/dfn&gt; of an element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; with a list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, the user
+  agent must run the following steps:&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; be a stack of elements
-   initially containing the child elements of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, if any. This list will be the one that holds
-   the elements that still need to be crawled.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is in &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, then the algorithm fails; abort these
+   steps.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt; be an empty list of
-   elements. This list will be the result of the algorithm: a list of
-   elements with properties that apply to &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;a href=#collect-all-the-elements-in-the-item&gt;Collect all the elements in the item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, and let &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; be the
+   result.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, &lt;a href=#split-a-string-on-spaces title=&quot;split a
-   string on spaces&quot;&gt;split the value of that &lt;code title=attr-itemref&gt;itemref&lt;/code&gt; attribute on spaces&lt;/a&gt;. For
-   each resulting token, &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an
-   element in the document with the &lt;a href=#concept-id title=concept-ID&gt;ID&lt;/a&gt;
-   &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then push the first such element onto &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is in &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;, then the algorithm fails; abort these
+   steps.&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If any elements are listed in &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;
+   more than once, then the algorithm fails; abort these
+   steps.&lt;/li&gt;
 
-    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;, run the following substeps:&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Remove any elements from &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; that do
+   not have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute
+   specified.&lt;/li&gt;
 
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;'s nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified, if
-     any, or null otherwise.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new memory&lt;/var&gt; be a new list consisting
+   of the old list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; with the addition of
+   &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If one of the other elements in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;
-     is also &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;
-     (i.e. remove duplicates).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;For each element in &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; that has an
+   &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified,
+   &lt;a href=#crawl-the-properties&gt;crawl the properties&lt;/a&gt; of the element, with &lt;var title=&quot;&quot;&gt;new memory&lt;/var&gt; as the memory. If this fails, then this
+   instance of the algorithm fails as well; abort these steps. (If it
+   succeeds, the return value is discarded.)&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; is an ancestor element of &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element is &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;
-     from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; (since &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; will be reached anyway as part of
-     processing &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; in &lt;a href=#tree-order&gt;tree
+   order&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; is an ancestor element of &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, and either &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; is
-     null or that element also has &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; as its
-     nearest ancestor element with an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute specified, then
-     remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; (since &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; will
-     be reached anyway as part of processing &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/li&gt;
 
-    &lt;/ol&gt;&lt;/li&gt;
+  &lt;/ol&gt;&lt;p&gt;To &lt;dfn id=collect-all-the-elements-in-the-item&gt;collect all the elements in the item&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, the user agent must run these steps:&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; in &lt;a href=#tree-order&gt;tree
-   order&lt;/a&gt;.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; be empty lists of elements.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Pop the top element from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; be that
+   &lt;li&gt;&lt;p&gt;Add all the children elements of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; to
+   &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute, &lt;a href=#split-a-string-on-spaces title=&quot;split a
+   string on spaces&quot;&gt;split the value of that &lt;code title=attr-itemref&gt;itemref&lt;/code&gt; attribute on spaces&lt;/a&gt;. For
+   each resulting token &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an element
+   in the &lt;a href=#home-subtree&gt;home subtree&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; with
+   the &lt;a href=#concept-id title=concept-ID&gt;ID&lt;/a&gt; &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then
+   add the first such element to &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Remove an element from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; be that
    element.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; has an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute, then append &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute, and &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child elements, then:
-   push all the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; onto
-   &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;, in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so the first
-   child of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be
-   popped from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does not have an &lt;code title=attr-itemscope&gt;&lt;a href=#attr-itemscope&gt;itemscope&lt;/a&gt;&lt;/code&gt; attribute, then: add all
+   the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;i&gt;End of loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; is not
    empty, return to the step marked &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;. That is the list of
-   &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;properties of the
-   item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. By definition, this list is
-   in &lt;a href=#tree-order&gt;tree order&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;A document must not contain any elements that have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute that would not be
+  &lt;/ol&gt;&lt;p&gt;An &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; is a &lt;dfn id=top-level-microdata-items title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/dfn&gt; if
+  its element does not have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
+
+  &lt;p&gt;An &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; is a &lt;dfn id=used-microdata-items title=&quot;used
+  microdata items&quot;&gt;used microdata item&lt;/dfn&gt; if it is a &lt;a href=#top-level-microdata-items title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/a&gt;,
+  or if it has an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt;
+  attribute and would be &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;found
+  to be the property&lt;/a&gt; of an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; that is itself a &lt;a href=#used-microdata-items title=&quot;used
+  microdata items&quot;&gt;used microdata item&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;A document must not contain any &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; that are not &lt;a href=#used-microdata-items&gt;used microdata
+  items&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;A document must not contain any elements that have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute that would not be
   found to be a property of any of the &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; in that document were their &lt;a href=#the-properties-of-an-item title=&quot;the properties of an item&quot;&gt;properties&lt;/a&gt; all to be
   determined.&lt;/p&gt;
 
-  &lt;p&gt;An &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt; is a &lt;dfn id=top-level-microdata-items title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/dfn&gt; if
-  its element does not have an &lt;code title=attr-itemprop&gt;&lt;a href=#names:-the-itemprop-attribute&gt;itemprop&lt;/a&gt;&lt;/code&gt; attribute.&lt;/p&gt;
+  &lt;p&gt;A document must not contain any &lt;a href=#concept-item title=concept-item&gt;items&lt;/a&gt; for which &lt;a href=#crawl-the-properties title=&quot;crawl the
+  properties&quot;&gt;crawling the properties&lt;/a&gt; of the element, with an
+  empty list as the value of &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, fails.&lt;/p&gt;
 
+  &lt;p class=note&gt;The algorithms in this section are especially
+  inefficient, in the interests of keeping them easy to
+  understand. Implementors are strongly encouraged to refactor and
+  optimise them in their user agents.&lt;/p&gt;
 
-  &lt;h4 id=examples-1&gt;&lt;span class=secno&gt;5.2.6 &lt;/span&gt;Examples&lt;/h4&gt;
+  &lt;div class=example&gt;
 
-  &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
-  statements:&lt;/p&gt;
+   &lt;p&gt;In this example, a single license statement is applied to two
+   works, using &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; from the
+   items representing the works:&lt;/p&gt;
 
-  &lt;pre&gt;&lt;dl itemscope
-    itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Work">http://purl.org/vocab/frbr/core#Work</A>&quot;
-    itemid=&quot;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N">http://purl.oreilly.com/works/45U8QJGZSQKDH8N</A>&quot;&gt;
- &lt;dt&gt;Title&lt;/dt&gt;
- &lt;dd&gt;&lt;cite itemprop=&quot;<A HREF="http://purl.org/dc/terms/title">http://purl.org/dc/terms/title</A>&quot;&gt;Just a Geek&lt;/cite&gt;&lt;/dd&gt;
- &lt;dt&gt;By&lt;/dt&gt;
- &lt;dd&gt;&lt;span itemprop=&quot;<A HREF="http://purl.org/dc/terms/creator">http://purl.org/dc/terms/creator</A>&quot;&gt;Wil Wheaton&lt;/span&gt;&lt;/dd&gt;
- &lt;dt&gt;Format&lt;/dt&gt;
- &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
-     itemscope
-     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
-     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&quot;&gt;
-  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/BOOK">http://purl.oreilly.com/product-types/BOOK</A>&quot;&gt;
-  Print
- &lt;/dd&gt;
- &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
-     itemscope
-     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
-     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&quot;&gt;
-  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&quot;&gt;
-  Ebook
- &lt;/dd&gt;
-&lt;/dl&gt;&lt;/pre&gt;
+   &lt;pre&gt;&lt;!DOCTYPE HTML&gt;
+&lt;html&gt;
+ &lt;head&gt;
+  &lt;title&gt;Photo gallery&lt;/title&gt;
+ &lt;/head&gt;
+ &lt;body&gt;
+  &lt;h1&gt;My photos&lt;/h1&gt;
+  &lt;figure itemscope itemtype=&quot;<A HREF="http://n.whatwg.org/work">http://n.whatwg.org/work</A>&quot; itemref=&quot;licenses&quot;&gt;
+   &lt;img itemprop=&quot;work&quot; src=&quot;images/house.jpeg&quot; alt=&quot;A white house, boarded up, sits in a forest.&quot;&gt;
+   &lt;figcaption itemprop=&quot;title&quot;&gt;The house I found.&lt;/figcaption&gt;
+  &lt;/figure&gt;
+  &lt;figure itemscope itemtype=&quot;<A HREF="http://n.whatwg.org/work">http://n.whatwg.org/work</A>&quot; itemref=&quot;licenses&quot;&gt;
+   &lt;img itemprop=&quot;work&quot; src=&quot;images/mailbox.jpeg&quot; alt=&quot;Outside the house is a mailbox. It has a leaflet inside.&quot;&gt;
+   &lt;figcaption itemprop=&quot;title&quot;&gt;The mailbox.&lt;/figcaption&gt;
+  &lt;/figure&gt;
+  &lt;footer&gt;
+   &lt;p id=&quot;licenses&quot;&gt;All images licensed under the &lt;a itemprop=&quot;license&quot;
+   href=&quot;<A HREF="http://www.opensource.org/licenses/mit-license.php">http://www.opensource.org/licenses/mit-license.php</A>&quot;&gt;MIT
+   license&lt;/a&gt;.&lt;/p&gt;
+  &lt;/footer&gt;
+ &lt;/body&gt;
+&lt;/html&gt;&lt;/pre&gt;
 
-  &lt;p&gt;This is equivalent to the following Turtle:&lt;/p&gt;
+   &lt;p&gt;The above results in two items with the type &quot;&lt;code title=&quot;&quot;&gt;<A HREF="http://n.whatwg.org/work&lt;/code">http://n.whatwg.org/work&lt;/code</A>&gt;&quot;, one with:&lt;/p&gt;
 
-  &lt;pre&gt;@prefix dc: &lt;<A HREF="http://purl.org/dc/terms/&amp;gt;">http://purl.org/dc/terms/&gt;</A> .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">- at prefix</A> frbr: &lt;<A HREF="http://purl.org/vocab/frbr/core#&amp;gt;">http://purl.org/vocab/frbr/core#&gt;</A> .
+   &lt;dl class=brief&gt;&lt;dt&gt;work
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;images/house.jpeg&lt;/code&gt;
+    &lt;dt&gt;title
+    &lt;dd&gt;The house I found.
+    &lt;dt&gt;license
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.opensource.org/licenses/mit-license.php&lt;/code">http://www.opensource.org/licenses/mit-license.php&lt;/code</A>&gt;
+   &lt;/dl&gt;&lt;p&gt;...and one with:&lt;/p&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N&amp;gt;">http://purl.oreilly.com/works/45U8QJGZSQKDH8N&gt;</A> a frbr:Work ;
-     dc:creator &quot;Wil Wheaton&quot;@en ;
-     dc:title &quot;Just a Geek&quot;@en ;
-     frbr:realization &lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK&amp;gt;,">http://purl.oreilly.com/products/9780596007683.BOOK&gt;,</A>
-         &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> . 
+   &lt;dl class=brief&gt;&lt;dt&gt;work
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;images/mailbox.jpeg&lt;/code&gt;
+    &lt;dt&gt;title
+    &lt;dd&gt;The mailbox.
+    &lt;dt&gt;license
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.opensource.org/licenses/mit-license.php&lt;/code">http://www.opensource.org/licenses/mit-license.php&lt;/code</A>&gt;
+   &lt;/dl&gt;&lt;/div&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK&amp;gt;">http://purl.oreilly.com/products/9780596007683.BOOK&gt;</A> a frbr:Expression ;
-     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/BOOK&amp;gt;">http://purl.oreilly.com/product-types/BOOK&gt;</A> . 
+  &lt;div class=example&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> a frbr:Expression ;
-     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK&amp;gt;">http://purl.oreilly.com/product-types/EBOOK&gt;</A> .&lt;/pre&gt;
+   &lt;p&gt;In the following invalid example, the items are all empty,
+   because the &lt;code title=attr-itemref&gt;&lt;a href=#attr-itemref&gt;itemref&lt;/a&gt;&lt;/code&gt; attribute on
+   the inner nested item indirectly references the same element twice
+   in the same item:&lt;/p&gt;
 
+   &lt;pre class=bad&gt;&lt;!-- invalid example - do not copy --&gt;
+&lt;div itemscope&gt;
+ &lt;span itemprop=&quot;example&quot;&gt;This is &lt;em&gt;not&lt;/em&gt; a property of the
+ &lt;code&gt;div&lt;/code&gt; element.&lt;/span&gt;
+ &lt;p itemprop=&quot;demo&quot; itemscope itemref=&quot;test thing&quot;&gt; &lt;!-- &quot;thing&quot; is a descendant
+                   of &quot;test&quot;, which leads to it being included twice, which is invalid --&gt;
+  &lt;span itemprop=&quot;sample&quot;&gt;This isn't part of anything either.&lt;/span&gt;
+ &lt;/p&gt;
+&lt;/div&gt;
+&lt;p id=&quot;test&quot;&gt;
+ &lt;span id=&quot;thing&quot;&gt;(this element is referenced twice by the
+ &lt;code&gt;p&lt;/code&gt; above, causing all the items that involve that
+ &lt;code&gt;itemref=&quot;&quot;&lt;/code&gt; attribute to act as if they had no
+ properties.)&lt;/span&gt;
+&lt;/p&gt;&lt;/pre&gt;
 
+  &lt;/div&gt;
 
+
+
   &lt;h3 id=microdata-dom-api&gt;&lt;span class=secno&gt;5.3 &lt;/span&gt;Microdata DOM API&lt;/h3&gt;
 
 
@@ -47490,7 +47539,7 @@
 
 
 
-  &lt;h5 id=examples-2&gt;&lt;span class=secno&gt;5.4.1.2 &lt;/span&gt;Examples&lt;/h5&gt;
+  &lt;h5 id=examples-1&gt;&lt;span class=secno&gt;5.4.1.2 &lt;/span&gt;Examples&lt;/h5&gt;
 
   &lt;div class=example&gt;
 
@@ -48301,7 +48350,7 @@
 
 
 
-  &lt;h5 id=examples-3&gt;&lt;span class=secno&gt;5.4.2.2 &lt;/span&gt;Examples&lt;/h5&gt;
+  &lt;h5 id=examples-2&gt;&lt;span class=secno&gt;5.4.2.2 &lt;/span&gt;Examples&lt;/h5&gt;
 
 &lt;!-- get more from <A HREF="http://www.ietf.org/rfc/rfc2445.txt">http://www.ietf.org/rfc/rfc2445.txt</A> --&gt;
 
@@ -48484,7 +48533,7 @@
 
 
 
-  &lt;h5 id=examples-4&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Examples&lt;/h5&gt;
+  &lt;h5 id=examples-3&gt;&lt;span class=secno&gt;5.4.3.2 &lt;/span&gt;Examples&lt;/h5&gt;
 
   &lt;div class=example&gt;
 
@@ -48827,8 +48876,58 @@
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;h4 id=atom&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Atom&lt;/h4&gt;
+  &lt;/ol&gt;&lt;h5 id=examples-4&gt;&lt;span class=secno&gt;5.5.2.1 &lt;/span&gt;Examples&lt;/h5&gt;
 
+  &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
+  statements:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;dl itemscope
+    itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Work">http://purl.org/vocab/frbr/core#Work</A>&quot;
+    itemid=&quot;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N">http://purl.oreilly.com/works/45U8QJGZSQKDH8N</A>&quot;&gt;
+ &lt;dt&gt;Title&lt;/dt&gt;
+ &lt;dd&gt;&lt;cite itemprop=&quot;<A HREF="http://purl.org/dc/terms/title">http://purl.org/dc/terms/title</A>&quot;&gt;Just a Geek&lt;/cite&gt;&lt;/dd&gt;
+ &lt;dt&gt;By&lt;/dt&gt;
+ &lt;dd&gt;&lt;span itemprop=&quot;<A HREF="http://purl.org/dc/terms/creator">http://purl.org/dc/terms/creator</A>&quot;&gt;Wil Wheaton&lt;/span&gt;&lt;/dd&gt;
+ &lt;dt&gt;Format&lt;/dt&gt;
+ &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
+     itemscope
+     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
+     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&quot;&gt;
+  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/BOOK">http://purl.oreilly.com/product-types/BOOK</A>&quot;&gt;
+  Print
+ &lt;/dd&gt;
+ &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
+     itemscope
+     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
+     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&quot;&gt;
+  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&quot;&gt;
+  Ebook
+ &lt;/dd&gt;
+&lt;/dl&gt;&lt;/pre&gt;
+
+  &lt;p&gt;This is equivalent to the following Turtle:&lt;/p&gt;
+
+  &lt;pre&gt;@prefix dc: &lt;<A HREF="http://purl.org/dc/terms/&amp;gt;">http://purl.org/dc/terms/&gt;</A> .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> frbr: &lt;<A HREF="http://purl.org/vocab/frbr/core#&amp;gt;">http://purl.org/vocab/frbr/core#&gt;</A> .
+
+&lt;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N&amp;gt;">http://purl.oreilly.com/works/45U8QJGZSQKDH8N&gt;</A> a frbr:Work ;
+     dc:creator &quot;Wil Wheaton&quot;@en ;
+     dc:title &quot;Just a Geek&quot;@en ;
+     frbr:realization &lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK&amp;gt;,">http://purl.oreilly.com/products/9780596007683.BOOK&gt;,</A>
+         &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> . 
+
+&lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK&amp;gt;">http://purl.oreilly.com/products/9780596007683.BOOK&gt;</A> a frbr:Expression ;
+     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/BOOK&amp;gt;">http://purl.oreilly.com/product-types/BOOK&gt;</A> . 
+
+&lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> a frbr:Expression ;
+     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK&amp;gt;">http://purl.oreilly.com/product-types/EBOOK&gt;</A> .&lt;/pre&gt;
+
+
+
+
+
+  &lt;h4 id=atom&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Atom&lt;/h4&gt;
+
   &lt;p&gt;Given a &lt;code&gt;Document&lt;/code&gt; &lt;var title=&quot;&quot;&gt;source&lt;/var&gt;, a user
   agent may run the following algorithm to &lt;dfn id=extracting-atom title=&quot;extracting
   Atom&quot;&gt;extract an Atom feed&lt;/dfn&gt;. This is not the only algorithm

Modified: source
===================================================================
--- source	2010-01-18 11:08:58 UTC (rev 4609)
+++ source	2010-01-18 12:55:33 UTC (rev 4610)
@@ -50661,11 +50661,8 @@
   &lt;p&gt;The &lt;code title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute, if
   specified, must have a value that is an &lt;span&gt;unordered set of
   unique space-separated tokens&lt;/span&gt; consisting of &lt;span
-  title=&quot;concept-ID&quot;&gt;IDs&lt;/span&gt; of elements in the same document; for
-  each one, the element's nearest ancestor element with an &lt;code
-  title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute specified, if any,
-  must not be the element with the referencing &lt;code
-  title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute specified.&lt;/p&gt;
+  title=&quot;concept-ID&quot;&gt;IDs&lt;/span&gt; of elements in the same &lt;span&gt;home
+  subtree&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;code title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute must not
   be specified on elements that do not have an &lt;code
@@ -50872,102 +50869,116 @@
 
   &lt;h4&gt;Associating names with items&lt;/h4&gt;
 
-  &lt;p&gt;To find &lt;dfn&gt;the properties of an item&lt;/dfn&gt;, the user agent must
-  run the following steps:&lt;/p&gt;
+  &lt;p&gt;To find &lt;dfn&gt;the properties of an item&lt;/dfn&gt; defined by the
+  element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, the user agent must try to
+  &lt;span&gt;crawl the properties&lt;/span&gt; of the element &lt;var
+  title=&quot;&quot;&gt;root&lt;/var&gt;, with an empty list as the value of &lt;var
+  title=&quot;&quot;&gt;memory&lt;/var&gt;: if this fails, then &lt;span title=&quot;the
+  properties of an item&quot;&gt;the properties of the item&lt;/span&gt; defined by
+  the element &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is an empty list; otherwise, it
+  is the returned list.&lt;/p&gt;
 
+  &lt;p&gt;To &lt;dfn&gt;crawl the properties&lt;/dfn&gt; of an element &lt;var
+  title=&quot;&quot;&gt;root&lt;/var&gt; with a list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, the user
+  agent must run the following steps:&lt;/p&gt;
+
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the element with the &lt;code
-   title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is in &lt;var
+   title=&quot;&quot;&gt;memory&lt;/var&gt;, then the algorithm fails; abort these
+   steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; be a stack of elements
-   initially containing the child elements of &lt;var
-   title=&quot;&quot;&gt;root&lt;/var&gt;, if any. This list will be the one that holds
-   the elements that still need to be crawled.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Collect all the elements in the item&lt;/span&gt; &lt;var
+   title=&quot;&quot;&gt;root&lt;/var&gt;, and let &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; be the
+   result.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt; be an empty list of
-   elements. This list will be the result of the algorithm: a list of
-   elements with properties that apply to &lt;var
-   title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; is in &lt;var
+   title=&quot;&quot;&gt;results&lt;/var&gt;, then the algorithm fails; abort these
+   steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code
-   title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute, &lt;span title=&quot;split a
-   string on spaces&quot;&gt;split the value of that &lt;code
-   title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute on spaces&lt;/span&gt;. For
-   each resulting token, &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an
-   element in the document with the &lt;span title=&quot;concept-ID&quot;&gt;ID&lt;/span&gt;
-   &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then push the first such element onto &lt;var
-   title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If any elements are listed in &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;
+   more than once, then the algorithm fails; abort these
+   steps.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;Remove any elements from &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; that do
+   not have an &lt;code title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; attribute
+   specified.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; in &lt;var
-    title=&quot;&quot;&gt;pending&lt;/var&gt;, run the following substeps:&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new memory&lt;/var&gt; be a new list consisting
+   of the old list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; with the addition of
+   &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;ol&gt;
+   &lt;li&gt;&lt;p&gt;For each element in &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; that has an
+   &lt;code title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute specified,
+   &lt;span&gt;crawl the properties&lt;/span&gt; of the element, with &lt;var
+   title=&quot;&quot;&gt;new memory&lt;/var&gt; as the memory. If this fails, then this
+   instance of the algorithm fails as well; abort these steps. (If it
+   succeeds, the return value is discarded.)&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; be &lt;var
-     title=&quot;&quot;&gt;candidate&lt;/var&gt;'s nearest ancestor element with an &lt;code
-     title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute specified, if
-     any, or null otherwise.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; in &lt;span&gt;tree
+   order&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If one of the other elements in &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;
-     is also &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;, then remove &lt;var
-     title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;
-     (i.e. remove duplicates).&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var
-     title=&quot;&quot;&gt;pending&lt;/var&gt; is an ancestor element of &lt;var
-     title=&quot;&quot;&gt;candidate&lt;/var&gt;, and that element is &lt;var
-     title=&quot;&quot;&gt;scope&lt;/var&gt;, then remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt;
-     from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; (since &lt;var
-     title=&quot;&quot;&gt;candidate&lt;/var&gt; will be reached anyway as part of
-     processing &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
+  &lt;/ol&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if one of the other elements in &lt;var
-     title=&quot;&quot;&gt;pending&lt;/var&gt; is an ancestor element of &lt;var
-     title=&quot;&quot;&gt;candidate&lt;/var&gt;, and either &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; is
-     null or that element also has &lt;var title=&quot;&quot;&gt;scope&lt;/var&gt; as its
-     nearest ancestor element with an &lt;code
-     title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute specified, then
-     remove &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; from &lt;var
-     title=&quot;&quot;&gt;pending&lt;/var&gt; (since &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; will
-     be reached anyway as part of processing &lt;var
-     title=&quot;&quot;&gt;scope&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
+  &lt;p&gt;To &lt;dfn&gt;collect all the elements in the item&lt;/dfn&gt; &lt;var
+  title=&quot;&quot;&gt;root&lt;/var&gt;, the user agent must run these steps:&lt;/p&gt;
 
-    &lt;/ol&gt;
+  &lt;ol&gt;
 
-   &lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;results&lt;/var&gt; and &lt;var
+   title=&quot;&quot;&gt;pending&lt;/var&gt; be empty lists of elements.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; in &lt;span&gt;tree
-   order&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Add all the children elements of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; to
+   &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Pop the top element from &lt;var
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has an &lt;code
+   title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute, &lt;span title=&quot;split a
+   string on spaces&quot;&gt;split the value of that &lt;code
+   title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute on spaces&lt;/span&gt;. For
+   each resulting token &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, if there is an element
+   in the &lt;span&gt;home subtree&lt;/span&gt; of &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; with
+   the &lt;span title=&quot;concept-ID&quot;&gt;ID&lt;/span&gt; &lt;var title=&quot;&quot;&gt;ID&lt;/var&gt;, then
+   add the first such element to &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: Remove an element from &lt;var
    title=&quot;&quot;&gt;pending&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; be that
    element.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; has an &lt;code
-   title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; attribute, then append &lt;var
-   title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var
+   title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; does not have an &lt;code
-   title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute, and &lt;var
-   title=&quot;&quot;&gt;current&lt;/var&gt; is an element with child elements, then:
-   push all the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; onto
-   &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;, in &lt;span&gt;tree order&lt;/span&gt; (so the first
-   child of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; will be the next element to be
-   popped from &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
+   title=&quot;attr-itemscope&quot;&gt;itemscope&lt;/code&gt; attribute, then: add all
+   the child elements of &lt;var title=&quot;&quot;&gt;current&lt;/var&gt; to &lt;var
+   title=&quot;&quot;&gt;pending&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;i&gt;End of loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;pending&lt;/var&gt; is not
    empty, return to the step marked &lt;i&gt;loop&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;properties&lt;/var&gt;. That is the list of
-   &lt;span title=&quot;the properties of an item&quot;&gt;properties of the
-   item&lt;/span&gt; &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;. By definition, this list is
-   in &lt;span&gt;tree order&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;results&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
+  &lt;p&gt;An &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; is a &lt;dfn
+  title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/dfn&gt; if
+  its element does not have an &lt;code
+  title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; attribute.&lt;/p&gt;
+
+  &lt;p&gt;An &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; is a &lt;dfn title=&quot;used
+  microdata items&quot;&gt;used microdata item&lt;/dfn&gt; if it is a &lt;span
+  title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/span&gt;,
+  or if it has an &lt;code title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt;
+  attribute and would be &lt;span title=&quot;the properties of an item&quot;&gt;found
+  to be the property&lt;/span&gt; of an &lt;span
+  title=&quot;concept-item&quot;&gt;item&lt;/span&gt; that is itself a &lt;span title=&quot;used
+  microdata items&quot;&gt;used microdata item&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;p&gt;A document must not contain any &lt;span
+  title=&quot;concept-item&quot;&gt;items&lt;/span&gt; that are not &lt;span&gt;used microdata
+  items&lt;/span&gt;.&lt;/p&gt;
+
   &lt;p&gt;A document must not contain any elements that have an &lt;code
   title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; attribute that would not be
   found to be a property of any of the &lt;span
@@ -50975,60 +50986,97 @@
   title=&quot;the properties of an item&quot;&gt;properties&lt;/span&gt; all to be
   determined.&lt;/p&gt;
 
-  &lt;p&gt;An &lt;span title=&quot;concept-item&quot;&gt;item&lt;/span&gt; is a &lt;dfn
-  title=&quot;top-level microdata items&quot;&gt;top-level microdata item&lt;/dfn&gt; if
-  its element does not have an &lt;code
-  title=&quot;attr-itemprop&quot;&gt;itemprop&lt;/code&gt; attribute.&lt;/p&gt;
+  &lt;p&gt;A document must not contain any &lt;span
+  title=&quot;concept-item&quot;&gt;items&lt;/span&gt; for which &lt;span title=&quot;crawl the
+  properties&quot;&gt;crawling the properties&lt;/span&gt; of the element, with an
+  empty list as the value of &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, fails.&lt;/p&gt;
 
+  &lt;p class=&quot;note&quot;&gt;The algorithms in this section are especially
+  inefficient, in the interests of keeping them easy to
+  understand. Implementors are strongly encouraged to refactor and
+  optimise them in their user agents.&lt;/p&gt;
 
-  &lt;h4&gt;Examples&lt;/h4&gt;
+  &lt;div class=&quot;example&quot;&gt;
 
-  &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
-  statements:&lt;/p&gt;
+   &lt;p&gt;In this example, a single license statement is applied to two
+   works, using &lt;code title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; from the
+   items representing the works:&lt;/p&gt;
 
-  &lt;pre&gt;&lt;dl itemscope
-    itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Work">http://purl.org/vocab/frbr/core#Work</A>&quot;
-    itemid=&quot;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N">http://purl.oreilly.com/works/45U8QJGZSQKDH8N</A>&quot;&gt;
- &lt;dt&gt;Title&lt;/dt&gt;
- &lt;dd&gt;&lt;cite itemprop=&quot;<A HREF="http://purl.org/dc/terms/title">http://purl.org/dc/terms/title</A>&quot;&gt;Just a Geek&lt;/cite&gt;&lt;/dd&gt;
- &lt;dt&gt;By&lt;/dt&gt;
- &lt;dd&gt;&lt;span itemprop=&quot;<A HREF="http://purl.org/dc/terms/creator">http://purl.org/dc/terms/creator</A>&quot;&gt;Wil Wheaton&lt;/span&gt;&lt;/dd&gt;
- &lt;dt&gt;Format&lt;/dt&gt;
- &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
-     itemscope
-     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
-     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&quot;&gt;
-  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/BOOK">http://purl.oreilly.com/product-types/BOOK</A>&quot;&gt;
-  Print
- &lt;/dd&gt;
- &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
-     itemscope
-     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
-     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&quot;&gt;
-  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&quot;&gt;
-  Ebook
- &lt;/dd&gt;
-&lt;/dl&gt;&lt;/pre&gt;
+   &lt;pre&gt;&lt;!DOCTYPE HTML&gt;
+&lt;html&gt;
+ &lt;head&gt;
+  &lt;title&gt;Photo gallery&lt;/title&gt;
+ &lt;/head&gt;
+ &lt;body&gt;
+  &lt;h1&gt;My photos&lt;/h1&gt;
+  &lt;figure itemscope itemtype=&quot;<A HREF="http://n.whatwg.org/work">http://n.whatwg.org/work</A>&quot; itemref=&quot;licenses&quot;&gt;
+   &lt;img itemprop=&quot;work&quot; src=&quot;images/house.jpeg&quot; alt=&quot;A white house, boarded up, sits in a forest.&quot;&gt;
+   &lt;figcaption itemprop=&quot;title&quot;&gt;The house I found.&lt;/figcaption&gt;
+  &lt;/figure&gt;
+  &lt;figure itemscope itemtype=&quot;<A HREF="http://n.whatwg.org/work">http://n.whatwg.org/work</A>&quot; itemref=&quot;licenses&quot;&gt;
+   &lt;img itemprop=&quot;work&quot; src=&quot;images/mailbox.jpeg&quot; alt=&quot;Outside the house is a mailbox. It has a leaflet inside.&quot;&gt;
+   &lt;figcaption itemprop=&quot;title&quot;&gt;The mailbox.&lt;/figcaption&gt;
+  &lt;/figure&gt;
+  &lt;footer&gt;
+   &lt;p id=&quot;licenses&quot;&gt;All images licensed under the &lt;a itemprop=&quot;license&quot;
+   href=&quot;<A HREF="http://www.opensource.org/licenses/mit-license.php">http://www.opensource.org/licenses/mit-license.php</A>&quot;&gt;MIT
+   license&lt;/a&gt;.&lt;/p&gt;
+  &lt;/footer&gt;
+ &lt;/body&gt;
+&lt;/html&gt;&lt;/pre&gt;
 
-  &lt;p&gt;This is equivalent to the following Turtle:&lt;/p&gt;
+   &lt;p&gt;The above results in two items with the type &quot;&lt;code
+   title=&quot;&quot;&gt;<A HREF="http://n.whatwg.org/work&lt;/code">http://n.whatwg.org/work&lt;/code</A>&gt;&quot;, one with:&lt;/p&gt;
 
-  &lt;pre&gt;@prefix dc: &lt;<A HREF="http://purl.org/dc/terms/">http://purl.org/dc/terms/</A>&gt; .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">- at prefix</A> frbr: &lt;<A HREF="http://purl.org/vocab/frbr/core#">http://purl.org/vocab/frbr/core#</A>&gt; .
+   &lt;dl class=&quot;brief&quot;&gt;
+    &lt;dt&gt;work
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;images/house.jpeg&lt;/code&gt;
+    &lt;dt&gt;title
+    &lt;dd&gt;The house I found.
+    &lt;dt&gt;license
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.opensource.org/licenses/mit-license.php&lt;/code">http://www.opensource.org/licenses/mit-license.php&lt;/code</A>&gt;
+   &lt;/dl&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N">http://purl.oreilly.com/works/45U8QJGZSQKDH8N</A>&gt; a frbr:Work ;
-     dc:creator &quot;Wil Wheaton&quot;@en ;
-     dc:title &quot;Just a Geek&quot;@en ;
-     frbr:realization &lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&gt;,
-         &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&gt; . 
+   &lt;p&gt;...and one with:&lt;/p&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&gt; a frbr:Expression ;
-     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/BOOK">http://purl.oreilly.com/product-types/BOOK</A>&gt; . 
+   &lt;dl class=&quot;brief&quot;&gt;
+    &lt;dt&gt;work
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;images/mailbox.jpeg&lt;/code&gt;
+    &lt;dt&gt;title
+    &lt;dd&gt;The mailbox.
+    &lt;dt&gt;license
+    &lt;dd&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.opensource.org/licenses/mit-license.php&lt;/code">http://www.opensource.org/licenses/mit-license.php&lt;/code</A>&gt;
+   &lt;/dl&gt;
 
-&lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&gt; a frbr:Expression ;
-     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&gt; .&lt;/pre&gt;
+  &lt;/div&gt;
 
+  &lt;div class=&quot;example&quot;&gt;
 
+   &lt;p&gt;In the following invalid example, the items are all empty,
+   because the &lt;code title=&quot;attr-itemref&quot;&gt;itemref&lt;/code&gt; attribute on
+   the inner nested item indirectly references the same element twice
+   in the same item:&lt;/p&gt;
 
+   &lt;pre class=&quot;bad&quot;&gt;&lt;!-- invalid example - do not copy --&gt;
+&lt;div itemscope&gt;
+ &lt;span itemprop=&quot;example&quot;&gt;This is &lt;em&gt;not&lt;/em&gt; a property of the
+ &lt;code&gt;div&lt;/code&gt; element.&lt;/span&gt;
+ &lt;p itemprop=&quot;demo&quot; itemscope itemref=&quot;test thing&quot;&gt; &lt;!-- &quot;thing&quot; is a descendant
+                   of &quot;test&quot;, which leads to it being included twice, which is invalid --&gt;
+  &lt;span itemprop=&quot;sample&quot;&gt;This isn't part of anything either.&lt;/span&gt;
+ &lt;/p&gt;
+&lt;/div&gt;
+&lt;p id=&quot;test&quot;&gt;
+ &lt;span id=&quot;thing&quot;&gt;(this element is referenced twice by the
+ &lt;code&gt;p&lt;/code&gt; above, causing all the items that involve that
+ &lt;code&gt;itemref=&quot;&quot;&lt;/code&gt; attribute to act as if they had no
+ properties.)&lt;/span&gt;
+&lt;/p&gt;&lt;/pre&gt;
+
+  &lt;/div&gt;
+
+
+
   &lt;h3&gt;Microdata DOM API&lt;/h3&gt;
 
 &lt;!--END html--&gt;&lt;!--END complete--&gt;
@@ -55047,8 +55095,57 @@
 
   &lt;/ol&gt;
 
+
+  &lt;h5&gt;Examples&lt;/h5&gt;
+
+  &lt;p&gt;Here is an example of some HTML using Microdata to express RDF
+  statements:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;dl itemscope
+    itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Work">http://purl.org/vocab/frbr/core#Work</A>&quot;
+    itemid=&quot;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N">http://purl.oreilly.com/works/45U8QJGZSQKDH8N</A>&quot;&gt;
+ &lt;dt&gt;Title&lt;/dt&gt;
+ &lt;dd&gt;&lt;cite itemprop=&quot;<A HREF="http://purl.org/dc/terms/title">http://purl.org/dc/terms/title</A>&quot;&gt;Just a Geek&lt;/cite&gt;&lt;/dd&gt;
+ &lt;dt&gt;By&lt;/dt&gt;
+ &lt;dd&gt;&lt;span itemprop=&quot;<A HREF="http://purl.org/dc/terms/creator">http://purl.org/dc/terms/creator</A>&quot;&gt;Wil Wheaton&lt;/span&gt;&lt;/dd&gt;
+ &lt;dt&gt;Format&lt;/dt&gt;
+ &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
+     itemscope
+     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
+     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&quot;&gt;
+  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/BOOK">http://purl.oreilly.com/product-types/BOOK</A>&quot;&gt;
+  Print
+ &lt;/dd&gt;
+ &lt;dd itemprop=&quot;<A HREF="http://purl.org/vocab/frbr/core#realization">http://purl.org/vocab/frbr/core#realization</A>&quot;
+     itemscope
+     itemtype=&quot;<A HREF="http://purl.org/vocab/frbr/core#Expression">http://purl.org/vocab/frbr/core#Expression</A>&quot;
+     itemid=&quot;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&quot;&gt;
+  &lt;link itemprop=&quot;<A HREF="http://purl.org/dc/terms/type">http://purl.org/dc/terms/type</A>&quot; href=&quot;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&quot;&gt;
+  Ebook
+ &lt;/dd&gt;
+&lt;/dl&gt;&lt;/pre&gt;
+
+  &lt;p&gt;This is equivalent to the following Turtle:&lt;/p&gt;
+
+  &lt;pre&gt;@prefix dc: &lt;<A HREF="http://purl.org/dc/terms/">http://purl.org/dc/terms/</A>&gt; .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> frbr: &lt;<A HREF="http://purl.org/vocab/frbr/core#">http://purl.org/vocab/frbr/core#</A>&gt; .
+
+&lt;<A HREF="http://purl.oreilly.com/works/45U8QJGZSQKDH8N">http://purl.oreilly.com/works/45U8QJGZSQKDH8N</A>&gt; a frbr:Work ;
+     dc:creator &quot;Wil Wheaton&quot;@en ;
+     dc:title &quot;Just a Geek&quot;@en ;
+     frbr:realization &lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&gt;,
+         &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&gt; . 
+
+&lt;<A HREF="http://purl.oreilly.com/products/9780596007683.BOOK">http://purl.oreilly.com/products/9780596007683.BOOK</A>&gt; a frbr:Expression ;
+     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/BOOK">http://purl.oreilly.com/product-types/BOOK</A>&gt; . 
+
+&lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&gt; a frbr:Expression ;
+     dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&gt; .&lt;/pre&gt;
+
 &lt;!--END microdata--&gt;&lt;!--START w3c-html--&gt;
 
+
+
   &lt;h4&gt;Atom&lt;/h4&gt;
 
   &lt;p&gt;Given a &lt;code&gt;Document&lt;/code&gt; &lt;var title=&quot;&quot;&gt;source&lt;/var&gt;, a user


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011477.html">[html5] r4609 - [acgiowt] (0) Reverting itemref='' change to fix it	(it broke itemref='' referen [...]
</A></li>
	<LI>Next message: <A HREF="011479.html">[html5] r4611 - [e] (0) uncooked example copypasta
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11478">[ date ]</a>
              <a href="thread.html#11478">[ thread ]</a>
              <a href="subject.html#11478">[ subject ]</a>
              <a href="author.html#11478">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
