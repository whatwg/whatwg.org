<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r5409 - [e] (0) Transferred the Web Sockets Protocol to Ian	Fette.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5409%20-%20%5Be%5D%20%280%29%20Transferred%20the%20Web%20Sockets%20Protocol%20to%20Ian%0A%09Fette.&In-Reply-To=%3C20100902100033.3F1A01C84006%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012276.html">
   <LINK REL="Next"  HREF="012278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r5409 - [e] (0) Transferred the Web Sockets Protocol to Ian	Fette.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5409%20-%20%5Be%5D%20%280%29%20Transferred%20the%20Web%20Sockets%20Protocol%20to%20Ian%0A%09Fette.&In-Reply-To=%3C20100902100033.3F1A01C84006%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r5409 - [e] (0) Transferred the Web Sockets Protocol to Ian	Fette.">whatwg at whatwg.org
       </A><BR>
    <I>Thu Sep  2 03:00:33 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="012276.html">[html5] r5408 - [] (0) minor changes to ConnectionPeer to reflect	some feedback on requirements
</A></li>
        <LI>Next message: <A HREF="012278.html">[html5] r5410 - [e] (0) typos
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12277">[ date ]</a>
              <a href="thread.html#12277">[ thread ]</a>
              <a href="subject.html#12277">[ subject ]</a>
              <a href="author.html#12277">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-09-02 03:00:31 -0700 (Thu, 02 Sep 2010)
New Revision: 5409

Modified:
   complete.html
   index
   source
Log:
[e] (0) Transferred the Web Sockets Protocol to Ian Fette.

Modified: complete.html
===================================================================
--- complete.html	2010-09-01 21:49:50 UTC (rev 5408)
+++ complete.html	2010-09-02 10:00:31 UTC (rev 5409)
@@ -209,7 +209,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;Web Applications 1.0&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 1 September 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 2 September 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -1032,65 +1032,10 @@
      &lt;li&gt;&lt;a href=#feedback-from-the-protocol&gt;&lt;span class=secno&gt;10.3.3 &lt;/span&gt;Feedback from the protocol&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#event-definitions-1&gt;&lt;span class=secno&gt;10.3.3.1 &lt;/span&gt;Event definitions&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#garbage-collection-1&gt;&lt;span class=secno&gt;10.3.3.2 &lt;/span&gt;Garbage collection&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#websocket-protocol title=&quot;The WebSocket protocol enables
-  two-way communication between a user agent running untrusted code
-  running in a controlled environment to a remote host that has
-  opted-in to communications from that code. The security model used
-  for this is the Origin-based security model commonly used by Web
-  browsers. The protocol consists of an initial handshake followed by
-  basic message framing, layered over TCP. The goal of this technology
-  is to provide a mechanism for browser-based applications that need
-  two-way communication with servers that does not rely on opening
-  multiple HTTP connections (e.g. using XMLHttpRequest or
-  &lt;iframe&gt;s and long polling).&quot;&gt;&lt;span class=secno&gt;10.3.4 &lt;/span&gt;The WebSocket protocol&lt;/a&gt;
-      &lt;ol&gt;
-       &lt;li&gt;&lt;a href=#introduction-8&gt;&lt;span class=secno&gt;10.3.4.1 &lt;/span&gt;Introduction&lt;/a&gt;
-        &lt;ol&gt;
-         &lt;li&gt;&lt;a href=#background-0&gt;&lt;span class=secno&gt;10.3.4.1.1 &lt;/span&gt;Background&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#protocol-overview&gt;&lt;span class=secno&gt;10.3.4.1.2 &lt;/span&gt;Protocol overview&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#opening-handshake&gt;&lt;span class=secno&gt;10.3.4.1.3 &lt;/span&gt;Opening handshake&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#closing-handshake&gt;&lt;span class=secno&gt;10.3.4.1.4 &lt;/span&gt;Closing handshake&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#design-philosophy&gt;&lt;span class=secno&gt;10.3.4.1.5 &lt;/span&gt;Design philosophy&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#security-model&gt;&lt;span class=secno&gt;10.3.4.1.6 &lt;/span&gt;Security model&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#relationship-to-tcp-and-http&gt;&lt;span class=secno&gt;10.3.4.1.7 &lt;/span&gt;Relationship to TCP and HTTP&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#establishing-a-connection&gt;&lt;span class=secno&gt;10.3.4.1.8 &lt;/span&gt;Establishing a connection&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#subprotocols-using-the-websocket-protocol&gt;&lt;span class=secno&gt;10.3.4.1.9 &lt;/span&gt;Subprotocols using the WebSocket protocol&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#terminology-1&gt;&lt;span class=secno&gt;10.3.4.2 &lt;/span&gt;Terminology&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#websocket-urls&gt;&lt;span class=secno&gt;10.3.4.3 &lt;/span&gt;WebSocket URLs&lt;/a&gt;
-        &lt;ol&gt;
-         &lt;li&gt;&lt;a href=#parsing-websocket-urls&gt;&lt;span class=secno&gt;10.3.4.3.1 &lt;/span&gt;Parsing WebSocket URLs&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#constructing-websocket-urls&gt;&lt;span class=secno&gt;10.3.4.3.2 &lt;/span&gt;Constructing WebSocket URLs&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#client-side-requirements&gt;&lt;span class=secno&gt;10.3.4.4 &lt;/span&gt;Client-side requirements&lt;/a&gt;
-        &lt;ol&gt;
-         &lt;li&gt;&lt;a href=#opening-handshake-0&gt;&lt;span class=secno&gt;10.3.4.4.1 &lt;/span&gt;Opening handshake&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#data-framing&gt;&lt;span class=secno&gt;10.3.4.4.2 &lt;/span&gt;Data framing&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#handling-errors-in-utf-8-from-the-server&gt;&lt;span class=secno&gt;10.3.4.4.3 &lt;/span&gt;Handling errors in UTF-8 from the server&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#server-side-requirements&gt;&lt;span class=secno&gt;10.3.4.5 &lt;/span&gt;Server-side requirements&lt;/a&gt;
-        &lt;ol&gt;
-         &lt;li&gt;&lt;a href=&quot;#reading-the-client's-opening-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.5.1 &lt;/span&gt;Reading the client's opening handshake&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=&quot;#sending-the-server's-opening-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.5.2 &lt;/span&gt;Sending the server's opening handshake&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#ws-sd-framing&gt;&lt;span class=secno&gt;10.3.4.5.3 &lt;/span&gt;Data framing&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#handling-errors-in-utf-8-from-the-client&gt;&lt;span class=secno&gt;10.3.4.5.4 &lt;/span&gt;Handling errors in UTF-8 from the client&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#closing-the-connection&gt;&lt;span class=secno&gt;10.3.4.6 &lt;/span&gt;Closing the connection&lt;/a&gt;
-        &lt;ol&gt;
-         &lt;li&gt;&lt;a href=#client-initiated-closure&gt;&lt;span class=secno&gt;10.3.4.6.1 &lt;/span&gt;Client-initiated closure&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#server-initiated-closure&gt;&lt;span class=secno&gt;10.3.4.6.2 &lt;/span&gt;Server-initiated closure&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#closure&gt;&lt;span class=secno&gt;10.3.4.6.3 &lt;/span&gt;Closure&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#security-considerations&gt;&lt;span class=secno&gt;10.3.4.7 &lt;/span&gt;Security considerations&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#iana-considerations-0&gt;&lt;span class=secno&gt;10.3.4.8 &lt;/span&gt;IANA considerations&lt;/a&gt;
-        &lt;ol&gt;
-         &lt;li&gt;&lt;a href=#registration-of-ws:-scheme&gt;&lt;span class=secno&gt;10.3.4.8.1 &lt;/span&gt;Registration of &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; scheme&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#registration-of-wss:-scheme&gt;&lt;span class=secno&gt;10.3.4.8.2 &lt;/span&gt;Registration of &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; scheme&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#registration-of-the-websocket-http-upgrade-keyword&gt;&lt;span class=secno&gt;10.3.4.8.3 &lt;/span&gt;Registration of the &quot;&lt;code title=&quot;&quot;&gt;WebSocket&lt;/code&gt;&quot; HTTP Upgrade keyword&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;&lt;span class=secno&gt;10.3.4.8.4 &lt;/span&gt;&lt;code&gt;Sec-WebSocket-Key1&lt;/code&gt; and &lt;code&gt;Sec-WebSocket-Key2&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#sec-websocket-location&gt;&lt;span class=secno&gt;10.3.4.8.5 &lt;/span&gt;&lt;code&gt;Sec-WebSocket-Location&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#sec-websocket-origin&gt;&lt;span class=secno&gt;10.3.4.8.6 &lt;/span&gt;&lt;code&gt;Sec-WebSocket-Origin&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#sec-websocket-protocol&gt;&lt;span class=secno&gt;10.3.4.8.7 &lt;/span&gt;&lt;code&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#using-the-websocket-protocol-from-other-specifications&gt;&lt;span class=secno&gt;10.3.4.9 &lt;/span&gt;Using the WebSocket protocol from other specifications&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#garbage-collection-1&gt;&lt;span class=secno&gt;10.3.3.2 &lt;/span&gt;Garbage collection&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#web-messaging&gt;&lt;span class=secno&gt;10.4 &lt;/span&gt;Cross-document messaging&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-9&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-8&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#security-postmsg&gt;&lt;span class=secno&gt;10.4.2 &lt;/span&gt;Security&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#authors&gt;&lt;span class=secno&gt;10.4.2.1 &lt;/span&gt;Authors&lt;/a&gt;&lt;/li&gt;
@@ -1098,14 +1043,14 @@
      &lt;li&gt;&lt;a href=#posting-messages&gt;&lt;span class=secno&gt;10.4.3 &lt;/span&gt;Posting messages&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#channel-messaging&gt;&lt;span class=secno&gt;10.5 &lt;/span&gt;Channel messaging&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-10&gt;&lt;span class=secno&gt;10.5.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-9&gt;&lt;span class=secno&gt;10.5.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#message-channels&gt;&lt;span class=secno&gt;10.5.2 &lt;/span&gt;Message channels&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#message-ports&gt;&lt;span class=secno&gt;10.5.3 &lt;/span&gt;Message ports&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#ports-and-garbage-collection&gt;&lt;span class=secno&gt;10.5.3.1 &lt;/span&gt;Ports and garbage collection&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#webstorage&gt;&lt;span class=secno&gt;11 &lt;/span&gt;Web storage&lt;/a&gt;
   &lt;ol&gt;
-   &lt;li&gt;&lt;a href=#introduction-11&gt;&lt;span class=secno&gt;11.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#introduction-10&gt;&lt;span class=secno&gt;11.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#storage&gt;&lt;span class=secno&gt;11.2 &lt;/span&gt;The API&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#the-storage-interface&gt;&lt;span class=secno&gt;11.2.1 &lt;/span&gt;The &lt;code&gt;Storage&lt;/code&gt; interface&lt;/a&gt;&lt;/li&gt;
@@ -1281,10 +1226,10 @@
    &lt;li&gt;&lt;a href=#parsing-xhtml-fragments&gt;&lt;span class=secno&gt;13.4 &lt;/span&gt;Parsing XHTML fragments&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=#rendering&gt;&lt;span class=secno&gt;14 &lt;/span&gt;Rendering&lt;/a&gt;
   &lt;ol&gt;
-   &lt;li&gt;&lt;a href=#introduction-12&gt;&lt;span class=secno&gt;14.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;a href=#introduction-11&gt;&lt;span class=secno&gt;14.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#the-css-user-agent-style-sheet-and-presentational-hints&gt;&lt;span class=secno&gt;14.2 &lt;/span&gt;The CSS user agent style sheet and presentational hints&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-13&gt;&lt;span class=secno&gt;14.2.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-12&gt;&lt;span class=secno&gt;14.2.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#display-types&gt;&lt;span class=secno&gt;14.2.2 &lt;/span&gt;Display types&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#margins-and-padding&gt;&lt;span class=secno&gt;14.2.3 &lt;/span&gt;Margins and padding&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#alignment&gt;&lt;span class=secno&gt;14.2.4 &lt;/span&gt;Alignment&lt;/a&gt;&lt;/li&gt;
@@ -1310,7 +1255,7 @@
      &lt;li&gt;&lt;a href=#toolbars-0&gt;&lt;span class=secno&gt;14.3.6 &lt;/span&gt;Toolbars&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#bindings&gt;&lt;span class=secno&gt;14.4 &lt;/span&gt;Bindings&lt;/a&gt;
     &lt;ol&gt;
-     &lt;li&gt;&lt;a href=#introduction-14&gt;&lt;span class=secno&gt;14.4.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#introduction-13&gt;&lt;span class=secno&gt;14.4.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-button-element-0&gt;&lt;span class=secno&gt;14.4.2 &lt;/span&gt;The &lt;code&gt;button&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-details-element-0&gt;&lt;span class=secno&gt;14.4.3 &lt;/span&gt;The &lt;code&gt;details&lt;/code&gt; element&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#the-input-element-as-a-text-entry-widget&gt;&lt;span class=secno&gt;14.4.4 &lt;/span&gt;The &lt;code&gt;input&lt;/code&gt; element as a text entry widget&lt;/a&gt;&lt;/li&gt;
@@ -61638,7 +61583,7 @@
    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;var title=concept-document-salvageable&gt;salvageable&lt;/var&gt; state to
    false. &lt;a href=#refsWEBSQL&gt;[WEBSQL]&lt;/a&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#close-the-websocket-connection&gt;Close the WebSocket connection&lt;/a&gt; of any
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Close the WebSocket connection&lt;/span&gt; of any
    &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; objects that were created by the &lt;code title=dom-WebSocket&gt;&lt;a href=#dom-websocket&gt;WebSocket()&lt;/a&gt;&lt;/code&gt; constructor visible on the
    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object. If this
    affected any &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; objects, the set
@@ -73169,11 +73114,10 @@
   &lt;p&gt;When the &lt;code&gt;WebSocket()&lt;/code&gt; constructor is invoked, the UA
   must run these steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;!-- beware, this is very similar to the steps for what happens
-   during a redirect, in the protocol section --&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;#parse-a-websocket-url's-components&quot;&gt;Parse a WebSocket URL's components&lt;/a&gt; from the
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from the
    &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;. If
    this fails, throw a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception and abort
-   these steps.&lt;/li&gt;
+   these steps. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -73217,17 +73161,17 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;a href=#establish-a-websocket-connection&gt;Establish a WebSocket connection&lt;/a&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; (if one was
+    &lt;p&gt;&lt;span&gt;Establish a WebSocket connection&lt;/span&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; (if one was
     specified), from &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, with the flag &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as
     the resource name, with &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; as the
-    (possibly empty) list of protocols, and with the &lt;var title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag set.&lt;/p&gt;
+    (possibly empty) list of protocols, and with the &lt;var title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag set. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;p class=note&gt;If the &quot;&lt;a href=#establish-a-websocket-connection&gt;establish a WebSocket
-    connection&lt;/a&gt;&quot; algorithm fails, it triggers the &quot;&lt;a href=#fail-the-websocket-connection&gt;fail
-    the WebSocket connection&lt;/a&gt;&quot; algorithm, which then invokes
-    the &quot;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt;&quot; algorithm,
-    which then establishes that the &quot;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
-    closed&lt;/a&gt;&quot;, which fires the &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
+    &lt;p class=note&gt;If the &quot;&lt;span&gt;establish a WebSocket
+    connection&lt;/span&gt;&quot; algorithm fails, it triggers the &quot;&lt;span&gt;fail
+    the WebSocket connection&lt;/span&gt;&quot; algorithm, which then invokes
+    the &quot;&lt;span&gt;close the WebSocket connection&lt;/span&gt;&quot; algorithm,
+    which then establishes that the &quot;&lt;span&gt;WebSocket connection is
+    closed&lt;/span&gt;&quot;, which fires the &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -73251,7 +73195,7 @@
 
    &lt;dt&gt;&lt;dfn id=dom-websocket-open title=dom-WebSocket-OPEN&gt;&lt;code&gt;OPEN&lt;/code&gt;&lt;/dfn&gt; (numeric value 1)&lt;/dt&gt;
 
-   &lt;dd&gt;The &lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt; and communication is possible.&lt;/dd&gt;
+   &lt;dd&gt;The &lt;span&gt;WebSocket connection is established&lt;/span&gt; and communication is possible.&lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn id=dom-websocket-closing title=dom-WebSocket-CLOSING&gt;&lt;code&gt;CLOSING&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)&lt;/dt&gt;
 
@@ -73265,8 +73209,8 @@
   &lt;code title=dom-WebSocket-CONNECTING&gt;&lt;a href=#dom-websocket-connecting&gt;CONNECTING&lt;/a&gt;&lt;/code&gt; (0).&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-websocket-protocol title=dom-WebSocket-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt; attribute
-  must initially return the empty string. After the &lt;a href=#websocket-connection-is-established&gt;WebSocket
-  connection is established&lt;/a&gt;, its value might change, as defined
+  must initially return the empty string. After the &lt;span&gt;WebSocket
+  connection is established&lt;/span&gt;, its value might change, as defined
   below.&lt;/p&gt;
 
   &lt;p class=note&gt;The &lt;code title=dom-WebSocket-protocol&gt;&lt;a href=#dom-websocket-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt; attribute returns the
@@ -73280,14 +73224,14 @@
   raise an &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception. Otherwise, if the
   &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; argument has any unpaired surrogates, then
   it must raise &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt;. If the connection is
-  established, and the string has no unpaired surrogates, and &lt;a href=#the-websocket-closing-handshake-has-started title=&quot;the WebSocket closing handshake has started&quot;&gt;the WebSocket
-  closing handshake has not yet started&lt;/a&gt;, then the user agent
-  must &lt;a href=#send-data-using-the-websocket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/a&gt;;
+  established, and the string has no unpaired surrogates, and &lt;span title=&quot;the WebSocket closing handshake has started&quot;&gt;the WebSocket
+  closing handshake has not yet started&lt;/span&gt;, then the user agent
+  must &lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/span&gt;;
   if the data cannot be sent, e.g. because it would need to be
-  buffered but the buffer is full, the user agent must &lt;a href=#close-the-websocket-connection&gt;close the
-  WebSocket connection&lt;/a&gt;. Any invokation of this method that does
+  buffered but the buffer is full, the user agent must &lt;span&gt;close the
+  WebSocket connection&lt;/span&gt;. Any invokation of this method that does
   not raise an exception must increase the &lt;code title=dom-WebSocket-bufferedAmount&gt;&lt;a href=#dom-websocket-bufferedamount&gt;bufferedAmount&lt;/a&gt;&lt;/code&gt; attribute
-  by the number of bytes needed to express the argument as UTF-8.&lt;/p&gt;
+  by the number of bytes needed to express the argument as UTF-8. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-websocket-close title=dom-WebSocket-close&gt;&lt;code&gt;close()&lt;/code&gt;&lt;/dfn&gt;
   method must run the first matching steps from the following list:&lt;/p&gt;
@@ -73305,37 +73249,37 @@
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;If the WebSocket connection is not yet &lt;a href=#websocket-connection-is-established title=&quot;WebSocket
-   connection is established&quot;&gt;established&lt;/a&gt;&lt;/dt&gt;
+   &lt;dt&gt;If the WebSocket connection is not yet &lt;span title=&quot;WebSocket
+   connection is established&quot;&gt;established&lt;/span&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;a href=#fail-the-websocket-connection&gt;Fail the WebSocket connection&lt;/a&gt; and set the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's
-    value to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt;
-    (2).&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt; and set the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's
+    value to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2).
+    &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;p class=note&gt;The &quot;&lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt;&quot;
-    algorithm invokes the &quot;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket
-    connection&lt;/a&gt;&quot; algorithm, which then establishes that the
-    &quot;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is closed&lt;/a&gt;&quot;, which fires the
+    &lt;p class=note&gt;The &quot;&lt;span&gt;fail the WebSocket connection&lt;/span&gt;&quot;
+    algorithm invokes the &quot;&lt;span&gt;close the WebSocket
+    connection&lt;/span&gt;&quot; algorithm, which then establishes that the
+    &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, which fires the
     &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;a href=#the-websocket-closing-handshake-has-started title=&quot;the WebSocket closing handshake has
-   started&quot;&gt;started&lt;/a&gt;&lt;/dt&gt;
+   &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;span title=&quot;the WebSocket closing handshake has
+   started&quot;&gt;started&lt;/span&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;a href=#start-the-websocket-closing-handshake&gt;Start the WebSocket closing handshake&lt;/a&gt; and set the
+    &lt;p&gt;&lt;span&gt;Start the WebSocket closing handshake&lt;/span&gt; and set the
     &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt;
-    attribute's value to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2).&lt;/p&gt;
+    attribute's value to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2). &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;p class=note&gt;The &quot;&lt;a href=#start-the-websocket-closing-handshake&gt;start the WebSocket closing
-    handshake&lt;/a&gt;&quot; algorithm eventually invokes the &quot;&lt;a href=#close-the-websocket-connection&gt;close
-    the WebSocket connection&lt;/a&gt;&quot; algorithm, which then establishes
-    that the &quot;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is closed&lt;/a&gt;&quot;, which
+    &lt;p class=note&gt;The &quot;&lt;span&gt;start the WebSocket closing
+    handshake&lt;/span&gt;&quot; algorithm eventually invokes the &quot;&lt;span&gt;close
+    the WebSocket connection&lt;/span&gt;&quot; algorithm, which then establishes
+    that the &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, which
     fires the &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -73349,10 +73293,10 @@
     value to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt;
     (2).&lt;/p&gt;
 
-    &lt;p class=note&gt;&lt;a href=#the-websocket-closing-handshake-has-started&gt;The WebSocket closing handshake has
-    started&lt;/a&gt;, and will eventually invokethe &quot;&lt;a href=#close-the-websocket-connection&gt;close the
-    WebSocket connection&lt;/a&gt;&quot; algorithm, which will establish that
-    the &quot;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is closed&lt;/a&gt;&quot;, and thus the
+    &lt;p class=note&gt;&lt;span&gt;The WebSocket closing handshake has
+    started&lt;/span&gt;, and will eventually invokethe &quot;&lt;span&gt;close the
+    WebSocket connection&lt;/span&gt;&quot; algorithm, which will establish that
+    the &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, and thus the
     &lt;code title=event-close&gt;close&lt;/code&gt; event will fire, &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -73406,40 +73350,40 @@
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-websocket-onclose title=handler-WebSocket-onclose&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-close&gt;close&lt;/code&gt;
   &lt;/table&gt;&lt;h4 id=feedback-from-the-protocol&gt;&lt;span class=secno&gt;10.3.3 &lt;/span&gt;Feedback from the protocol&lt;/h4&gt;
 
-  &lt;p&gt;When the &lt;i&gt;&lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;&lt;/i&gt;, the user
+  &lt;p&gt;When the &lt;i&gt;WebSocket connection is established&lt;/i&gt;, the user
   agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to first change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
-  to &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt; (1); &lt;a href=#apply-the-cookies&gt;apply the
-  cookies&lt;/a&gt; that were collected in the &lt;var title=&quot;&quot;&gt;list of
-  cookies&lt;/var&gt; when the &lt;a href=#websocket-connection-is-established title=&quot;WebSocket connection is
-  established&quot;&gt;connection was established&lt;/a&gt;; change the &lt;code title=dom-WebSocket-protocol&gt;&lt;a href=#dom-websocket-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt; attribute's value to
-  the &lt;a href=#selected-websocket-subprotocol&gt;selected WebSocket subprotocol&lt;/a&gt;, if there is one;
-  and then &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-open&gt;open&lt;/code&gt; at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt;
-  object.&lt;/p&gt;
+  to &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt; (1); &lt;span&gt;apply the
+  cookies&lt;/span&gt; that were collected in the &lt;var title=&quot;&quot;&gt;list of
+  cookies&lt;/var&gt; when the &lt;span title=&quot;WebSocket connection is
+  established&quot;&gt;connection was established&lt;/span&gt;; change the &lt;code title=dom-WebSocket-protocol&gt;&lt;a href=#dom-websocket-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt; attribute's value to
+  the &lt;span&gt;selected WebSocket subprotocol&lt;/span&gt;, if there is one;
+  and then &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-open&gt;open&lt;/code&gt; at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object.
+  &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;When &lt;i&gt;&lt;a href=#a-websocket-message-has-been-received&gt;a WebSocket message has been received&lt;/a&gt;&lt;/i&gt; with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, the user agent must create an event that uses
+  &lt;p&gt;When &lt;i&gt;a WebSocket message has been received&lt;/i&gt; with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, the user agent must create an event that uses
   the &lt;code&gt;&lt;a href=#messageevent&gt;MessageEvent&lt;/a&gt;&lt;/code&gt; interface, with the event name &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt;, which does not bubble, is not
   cancelable, has no default action, and whose &lt;code title=dom-MessageEvent-data&gt;&lt;a href=#dom-messageevent-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute is set to &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, and &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to check to see
   if the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt;
   attribute's value is &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt;
   (1) or &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2), and
-  if so, dispatch the event at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+  if so, dispatch the event at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;When &lt;i&gt;&lt;a href=#a-websocket-error-has-been-detected&gt;a WebSocket error has been detected&lt;/a&gt;&lt;/i&gt;, the user agent
+  &lt;p&gt;When &lt;i&gt;a WebSocket error has been detected&lt;/i&gt;, the user agent
   must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to check to see if the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
   is &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt; (1) or &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2), and if so,
   &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt; at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt;
-  object.&lt;/p&gt;
+  object. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;When &lt;i&gt;&lt;a href=#the-websocket-closing-handshake-has-started&gt;the WebSocket closing handshake has started&lt;/a&gt;&lt;/i&gt;, the user
+  &lt;p&gt;When &lt;i&gt;the WebSocket closing handshake has started&lt;/i&gt;, the user
   agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
   to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2). (If the
   &lt;code title=dom-WebSocket-close&gt;&lt;a href=#dom-websocket-close&gt;close()&lt;/a&gt;&lt;/code&gt; method was called,
   the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt;
   attribute's value will already be set to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2) when this task
-  runs.)&lt;/p&gt;
+  runs.) &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p id=closeWebSocket&gt;When the &lt;i&gt;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
-  closed&lt;/a&gt;&lt;/i&gt;, possibly &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;, the user agent must
+  &lt;p id=closeWebSocket&gt;When the &lt;i&gt;WebSocket connection is
+  closed&lt;/i&gt;, possibly &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;, the user agent must
   create an event that uses the &lt;code&gt;&lt;a href=#closeevent&gt;CloseEvent&lt;/a&gt;&lt;/code&gt; interface,
   with the event name &lt;code title=event-close&gt;close&lt;/code&gt;, which
   does not bubble, is not cancelable, has no default action, and whose
@@ -73448,7 +73392,7 @@
   false otherwise; and &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to first change the
   &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's
   value to &lt;code title=dom-WebSocket-CLOSED&gt;&lt;a href=#dom-websocket-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), and
-  then dispatch the event at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+  then dispatch the event at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for all &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; &lt;a href=#queue-a-task title=&quot;queue a
   task&quot;&gt;queued&lt;/a&gt; in this section is the &lt;dfn id=websocket-task-source&gt;WebSocket task
@@ -73486,2788 +73430,25 @@
   the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; started executing a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; must not be garbage collected if
   there are any event listeners registered for &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; events, &lt;code title=event-error&gt;error&lt;/code&gt; events, or &lt;code title=event-close&gt;close&lt;/code&gt; events.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object with &lt;a href=#websocket-connection-is-established title=&quot;WebSocket
-  connection is established&quot;&gt;an established connection&lt;/a&gt; that has
+  &lt;p&gt;A &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object with &lt;span title=&quot;WebSocket
+  connection is established&quot;&gt;an established connection&lt;/span&gt; that has
   data queued to be transmitted to the network must not be garbage
-  collected.&lt;/p&gt;
+  collected. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;If a &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object is garbage collected while its
-  connection is still open, the user agent must &lt;a href=#close-the-websocket-connection&gt;close the
-  WebSocket connection&lt;/a&gt;.&lt;/p&gt;
+  connection is still open, the user agent must &lt;span&gt;close the
+  WebSocket connection&lt;/span&gt;. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
 
   
 
-  
+  &lt;/div&gt;&lt;!--data-component--&gt;
 
-  &lt;h4 id=websocket-protocol title=&quot;The WebSocket protocol enables
-  two-way communication between a user agent running untrusted code
-  running in a controlled environment to a remote host that has
-  opted-in to communications from that code. The security model used
-  for this is the Origin-based security model commonly used by Web
-  browsers. The protocol consists of an initial handshake followed by
-  basic message framing, layered over TCP. The goal of this technology
-  is to provide a mechanism for browser-based applications that need
-  two-way communication with servers that does not rely on opening
-  multiple HTTP connections (e.g. using XMLHttpRequest or
-  &lt;iframe&gt;s and long polling).&quot;&gt;&lt;span class=secno&gt;10.3.4 &lt;/span&gt;The WebSocket protocol&lt;/h4&gt;
-
-
-  &lt;h5 id=introduction-8&gt;&lt;span class=secno&gt;10.3.4.1 &lt;/span&gt;Introduction&lt;/h5&gt;
-
-  &lt;h6 id=background-0&gt;&lt;span class=secno&gt;10.3.4.1.1 &lt;/span&gt;Background&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;Historically, creating an instant messenger chat client as a Web
-  application has required an abuse of HTTP to poll the server for
-  updates while sending upstream notifications as distinct HTTP
-  calls.&lt;/p&gt;
-
-  &lt;p&gt;This results in a variety of problems:&lt;/p&gt;
-
-  &lt;ul&gt;&lt;li&gt;The server is forced to use a number of different underlying
-   TCP connections for each client: one for sending information to the
-   client, and a new one for each incoming message.&lt;/li&gt;
-
-   &lt;li&gt;The wire protocol has a high overhead, with each
-   client-to-server message having an HTTP header.&lt;/li&gt;
-
-   &lt;li&gt;The client-side script is forced to maintain a mapping from the
-   outgoing connections to the incoming connection to track
-   replies.&lt;/li&gt;
-
-  &lt;/ul&gt;&lt;p&gt;A simpler solution would be to use a single TCP connection for
-  traffic in both directions. This is what the WebSocket protocol
-  provides. Combined with the WebSocket API, it provides an
-  alternative to HTTP polling for two-way communication from a Web
-  page to a remote server.
-  &lt;/p&gt;
-
-  &lt;p&gt;The same technique can be used for a variety of Web applications,
-  for instance games, stock tickers, multiuser applications with
-  simultaneous editing, and user interfaces exposing server-side
-  services in real time.&lt;/p&gt;
-
-
-
-  &lt;h6 id=protocol-overview&gt;&lt;span class=secno&gt;10.3.4.1.2 &lt;/span&gt;Protocol overview&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The protocol has two parts: a handshake, and then the data
-  transfer.&lt;/p&gt;
-
-  &lt;p&gt;The handshake from the client looks as follows:&lt;/p&gt;
-
-  &lt;pre&gt;GET /demo HTTP/1.1
-Host: example.com
-Connection: Upgrade
-Sec-WebSocket-Key2: 12998 5 Y3 1  .P00
-Sec-WebSocket-Protocol: sample
-Upgrade: WebSocket
-Sec-WebSocket-Key1: 4 @1  46546xW%0l 1 5
-Origin: <A HREF="http://example.com">http://example.com</A>
-
-^n:ds[4U&lt;/pre&gt;
-
-  &lt;p&gt;The handshake from the server looks as follows:&lt;/p&gt;
-
-  &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake
-Upgrade: WebSocket
-Connection: Upgrade
-Sec-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
-Sec-WebSocket-Location: <A HREF="ws://example.com/demo">ws://example.com/demo</A>
-Sec-WebSocket-Protocol: sample
-
-8jKS'y:G*Co,Wxa-&lt;/pre&gt;
-
-  &lt;p&gt;The leading line from the client follows the Request-Line
-  format. The leading line from the server follows the Status-Line
-  format. The Request-Line and Status-Line productions are defined in
-  the HTTP specification.&lt;/p&gt;
-
-  &lt;p&gt;After the leading line in both cases come an unordered
-  &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; set of fields, one per line,
-  that each match the following non-normative ABNF:
-  &lt;a href=#refsABNF&gt;[ABNF]&lt;/a&gt;
-
-  &lt;/p&gt;
-
-  &lt;pre&gt;field         = 1*name-char colon [ space ] *any-char cr lf
-colon         = %x003A ; U+003A COLON (:)
-space         = %x0020 ; U+0020 SPACE
-cr            = %x000D ; U+000D CARRIAGE RETURN (CR)
-lf            = %x000A ; U+000A LINE FEED (LF)
-name-char     = %x0000-0009 / %x000B-000C / %x000E-0039 / %x003B-10FFFF
-                ; a Unicode character other than U+000A LINE FEED (LF), U+000D CARRIAGE RETURN (CR), or U+003A COLON (:)
-any-char      = %x0000-0009 / %x000B-000C / %x000E-10FFFF
-                ; a Unicode character other than U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR)&lt;/pre&gt;
-
-  &lt;p class=note&gt;The character set for the above ABNF is Unicode. The
-  fields themselves are encoded as UTF-8.&lt;/p&gt;
-
-  &lt;p&gt;Lines that don't match the above production cause the connection
-  to be aborted.&lt;/p&gt;
-
-  &lt;p&gt;Finally, after the last field, the client sends 10 bytes
-  starting with 0x0D 0x0A and followed by 8 random bytes, part of a
-  challenge, and the server sends 18 bytes starting with 0x0D 0x0A and
-  followed by 16 bytes consisting of a challenge response. The details
-  of this challenge and other parts of the handshake are described in
-  the next section.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;p&gt;Once the client and server have both sent their handshakes, and
-  if the handshake was successful, then the data transfer part
-  starts. This is a two-way communication channel where each side can,
-  independently from the other, send data at will.&lt;/p&gt;
-
-  &lt;p&gt;Data is sent in the form of UTF-8 text. Each frame of data starts
-  with a 0xFF byte identifying the frame type, followed by the number
-  of bytes in the data expressed as a big-endian 64 bit unsigned
-  integer, followed by the UTF-8 data.&lt;/p&gt;
-
-  &lt;p class=note&gt;The length is the number of UTF-8 &lt;em&gt;bytes&lt;/em&gt;,
-  and not the number of characters. For example, the string
-  &quot;H&#822;e&#860;&#824;&#1161;ll&#801;o&#821;&#856;&#822;&quot;
-  has 13 Unicode code points, but is 21 bytes long.&lt;/p&gt;&lt;!-- Zalgo --&gt;
-
-  &lt;p&gt;The WebSocket protocol uses this framing so that specifications
-  that use the WebSocket protocol can expose such connections using
-  an event-based mechanism instead of requiring users of those
-  specifications to implement buffering and piecing together of
-  messages manually.&lt;/p&gt;
-
-  &lt;p&gt;To close the connection cleanly, a frame consisting of just nine
-  0x00 bytes in a row is sent from one peer to ask that the other peer
-  close the connection. That corresponds to a frame type of 0x00
-  followed by a length of zero, indicating an empty frame.&lt;/p&gt;
-
-  &lt;p&gt;In addition to the 0x00 and 0xFF frame types, other types might
-  in future be defined, to support binary data, fragmentation,
-  compression, multiplexing, or other features.&lt;/p&gt;
-
-  &lt;p&gt;The wire format for the data transfer part is described by the
-  &lt;code title=&quot;&quot;&gt;frames&lt;/code&gt; production of the following
-  non-normative ABNF.
-  &lt;a href=#refsABNF&gt;[ABNF]&lt;/a&gt;
-
-  &lt;/p&gt;
-
-  &lt;pre&gt;frames        = *frame
-frame         = frame-type frame-length data
-frame-type    = OCTET
-frame-length  = 8OCTET
-data          = *OCTET ; count must match the given length&lt;/pre&gt;
-
-  &lt;p class=note&gt;The above ABNF is intended for a binary octet
-  environment.&lt;/p&gt;
-
-  &lt;p class=warning&gt;At this time, the WebSocket protocol cannot be
-  used to send binary data. Using any of the frame types other than
-  0x00 and 0xFF is invalid. All other frame types are reserved for
-  future use by future versions of this protocol.&lt;/p&gt;
-
-
-
-  &lt;h6 id=opening-handshake&gt;&lt;span class=secno&gt;10.3.4.1.3 &lt;/span&gt;Opening handshake&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The opening handshake is intended to be compatible with
-  HTTP-based server-side software, so that a single port can be used
-  by both HTTP clients talking to that server and WebSocket clients
-  talking to that server. To this end, the WebSocket client's
-  handshake appears to HTTP servers to be a regular GET request with
-  an Upgrade offer:&lt;/p&gt;
-
-  &lt;pre&gt;GET / HTTP/1.1
-Upgrade: WebSocket
-Connection: Upgrade&lt;/pre&gt;
-
-  &lt;p&gt;Fields in the handshake are sent by the client in a random order;
-  the order is not meaningful.&lt;/p&gt;
-
-  &lt;p&gt;Additional fields are used to select options in the WebSocket
-  protocol. The only options available in this version are the
-  subprotocol selector, &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;,
-  and &lt;code title=http-cookie&gt;Cookie&lt;/code&gt;, which can used for
-  sending cookies to the server (e.g. as an authentication
-  mechanism). The &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;
-  field takes a space-separated list of strings:&lt;/p&gt;
-
-  &lt;pre&gt;Sec-WebSocket-Protocol: org.example.chat wsxmpp ACME.COM-IM-2&lt;/pre&gt;
-
-  &lt;p&gt;This field indicates the subprotocols (the application-level
-  protocol layered over the WebSocket protocol) that the client can
-  use. The server reports which subprotocol it is going to use in its
-  handshake response.&lt;/p&gt;
-
-  &lt;p&gt;The other fields in the handshake are all security-related.  The
-  &lt;code title=http-host&gt;Host&lt;/code&gt; field is used to protect against
-  DNS rebinding attacks and to allow multiple domains to be served
-  from one IP address.&lt;/p&gt;
-
-  &lt;pre&gt;Host: example.com&lt;/pre&gt;
-
-  &lt;p&gt;The server includes the hostname in the &lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;Sec-WebSocket-Location&lt;/a&gt;&lt;/code&gt;
-  field of its handshake, so that both the client and the server can
-  verify that they agree on which host is in use.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;code title=http-origin&gt;Origin&lt;/code&gt; field is used to
-  protect against unauthorized cross-origin use of a WebSocket server
-  by scripts using the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; API in a Web
-  browser. The server specifies which origin it is willing to receive
-  requests from by including a &lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;Sec-WebSocket-Origin&lt;/a&gt;&lt;/code&gt; field
-  with that origin. If multiple origins are authorized, the server
-  echoes the value in the &lt;code title=http-origin&gt;Origin&lt;/code&gt;
-  field of the client's handshake.&lt;/p&gt;
-
-  &lt;pre&gt;Origin: <A HREF="http://example.com&lt;/pre">http://example.com&lt;/pre</A>&gt;
-
-  &lt;p&gt;Finally, the server has to prove to the client that it received
-  the client's WebSocket handshake, so that the server doesn't accept
-  connections that are not WebSocket connections. This prevents an
-  attacker from tricking a WebSocket server by sending it
-  carefully-crafted packets using &lt;code&gt;XMLHttpRequest&lt;/code&gt; or a
-  &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; submission.&lt;/p&gt;
-
-  &lt;p&gt;To prove that the handshake was received, the server has to take
-  three pieces of information and combine them to form a response. The
-  first two pieces of information come from the &lt;code title=http-sec-websocket-key&gt;Sec-WebSocket-Key1&lt;/code&gt; and &lt;code title=http-sec-websocket-key&gt;Sec-WebSocket-Key2&lt;/code&gt; fields in
-  the client handshake:&lt;/p&gt;
-
-  &lt;pre&gt;Sec-WebSocket-Key1: 18x 6]8vM;54 *(5:  {   U1]8  z [  8
-Sec-WebSocket-Key2: 1_ tx7X d  &lt;  nw  334J702) 7]o}` 0&lt;/pre&gt;
-
-  &lt;p&gt;For each of these fields, the server has to take the digits from
-  the value to obtain a number (in this case 1868545188 and 1733470270
-  respectively), then divide that number by the number of spaces
-  characters in the value (in this case 12 and 10) to obtain a 32-bit
-  number (155712099 and 173347027). These two resulting numbers are
-  then used in the server handshake, as described below.&lt;/p&gt;
-
-  &lt;p&gt;The counting of spaces is intended to make it impossible to
-  smuggle this field into the resource name; making this even harder
-  is the presence of &lt;em&gt;two&lt;/em&gt; such fields, and the use of a
-  newline as the only reliable indicator that the end of the key has
-  been reached. The use of random characters interspersed with the
-  spaces and the numbers ensures that the implementor actually looks
-  for spaces and newlines, instead of being treating any character
-  like a space, which would make it again easy to smuggle the fields
-  into the path and trick the server. Finally, &lt;em&gt;dividing&lt;/em&gt; by
-  this number of spaces is intended to make sure that even the most
-  na&iuml;ve of implementations will check for spaces, since if ther
-  server does not verify that there are some spaces, the server will
-  try to divide by zero, which is usually fatal (a correct handshake
-  will always have at least one space).
-
-  &lt;p&gt;The third piece of information is given after the fields, in the
-  last eight bytes of the handshake, expressed here as they would be
-  seen if interpreted as UTF-8:&lt;/p&gt;
-
-  &lt;pre&gt;Tm[K T2u&lt;/pre&gt;
-
-  &lt;p&gt;The concatenation of the number obtained from processing the
-  &lt;code title=http-sec-websocket-key&gt;Sec-WebSocket-Key1&lt;/code&gt;
-  field, expressed as a big-endian 32-bit number, the number
-  obtained from processing the &lt;code title=http-sec-websocket-key&gt;Sec-WebSocket-Key2&lt;/code&gt; field,
-  again expressed as a big-endian 32-bit number, and finally the
-  eight bytes at the end of the handshake, form a 128 bit string whose
-  MD5 sum is then used by the server to prove that it read the
-  handshake.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;p&gt;The handshake from the server is much simpler than the client
-  handshake. The first line is an HTTP Status-Line, with the status
-  code 101 (the HTTP version and reason phrase aren't important):&lt;/p&gt;
-
-  &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake&lt;/pre&gt;
-
-  &lt;p&gt;The fields follow. Two of the fields are just for compatibility
-  with HTTP:&lt;/p&gt;
-
-  &lt;pre&gt;Upgrade: WebSocket
-Connection: Upgrade&lt;/pre&gt;
-
-  &lt;p&gt;Two of the fields are part of the security model described
-  above, echoing the origin and stating the exact host, port, resource
-  name, and whether the connection is expected to be encrypted:&lt;/p&gt;
-
-  &lt;pre&gt;Sec-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
-Sec-WebSocket-Location: <A HREF="ws://example.com/&lt;/pre">ws://example.com/&lt;/pre</A>&gt;
-
-  &lt;p&gt;These fields are checked by the Web browser when it is acting as
-  a &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; client for scripted pages. A server that
-  only handles one origin and only serves one resource can therefore
-  just return hard-coded values and does not need to parse the
-  client's handshake to verify the correctness of the values.&lt;/p&gt;
-
-  &lt;p&gt;Option fields can also be included. In this version of the
-  protocol, the main option field is &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;,
-  which indicates the subprotocol that the server speaks. Web browsers
-  verify that the server specified one of the values that was
-  specified in the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; constructor, so a server
-  that speaks multiple subprotocols has to make sure it selects one
-  based on the client's handshake and specifies the right one in its
-  handshake.&lt;/p&gt;
-
-  &lt;pre&gt;Sec-WebSocket-Protocol: org.example.chat&lt;/pre&gt;
-
-  &lt;p&gt;The server can also set cookie-related option fields to
-  &lt;em&gt;set&lt;/em&gt; cookies, as in HTTP.&lt;/p&gt;
-
-  &lt;p&gt;After the fields, the server sends the aforementioned MD5 sum, a
-  16 byte (128 bit) value, shown here as if interpreted as UTF-8:&lt;/p&gt;
-
-  &lt;pre&gt;fQJ,fN/4F4!~K~MH&lt;/pre&gt;
-
-  &lt;p&gt;This value depends on what the client sends, as described
-  above. If it doesn't match what the client is expecting, the client
-  would disconnect.&lt;/p&gt;
-
-  &lt;p&gt;Having part of the handshake appear after the fields ensures
-  that both the server and the client verify that the connection is
-  not being interrupted by an HTTP intermediary such as a
-  man-in-the-middle cache or proxy.&lt;/p&gt;
-
-
-  &lt;h6 id=closing-handshake&gt;&lt;span class=secno&gt;10.3.4.1.4 &lt;/span&gt;Closing handshake&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The closing handshake is far simpler than the opening handshake.&lt;/p&gt;
-
-  &lt;p&gt;Either peer can send a 0xFF frame with length 0x00 to begin the
-  closing handshake. Upon receiving a 0xFF frame, the other peer
-  sends an identical 0xFF frame in acknowledgement, if it hasn't
-  already sent one. Upon receiving &lt;em&gt;that&lt;/em&gt; 0xFF frame, the first
-  peer then closes the connection, safe in the knowledge that no
-  further data is forthcoming.&lt;/p&gt;
-
-  &lt;p&gt;After sending a 0xFF frame, a peer does not send any further
-  data; after receiving a 0xFF frame, a peer discards any further
-  data received.&lt;/p&gt;
-
-  &lt;p&gt;It is safe for both peers to initiate this handshake
-  simultaneously.&lt;/p&gt;
-
-  &lt;p&gt;The closing handshake is intended to replace the TCP closing
-  handshake (FIN/ACK), on the basis that the TCP closing handshake is
-  not always reliable end-to-end, especially in the presence of
-  man-in-the-middle proxies and other intermediaries.&lt;/p&gt;
-
-
-
-  &lt;h6 id=design-philosophy&gt;&lt;span class=secno&gt;10.3.4.1.5 &lt;/span&gt;Design philosophy&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The WebSocket protocol is designed on the principle that there
-  should be minimal framing (the only framing that exists is to make
-  the protocol frame-based instead of stream-based, and to support a
-  distinction between Unicode text and binary frames). It is expected
-  that metadata would be layered on top of WebSocket by the
-  application layer, in the same way that metadata is layered on top
-  of TCP by the application layer (HTTP).&lt;/p&gt;
-
-  &lt;p&gt;Conceptually, WebSocket is really just a layer on top of TCP
-  that adds a Web &quot;origin&quot;-based security model for browsers; adds an
-  addressing and subprotocol naming mechanism to support multiple
-  services on one port and multiple host names on one IP address;
-  layers a framing mechanism on top of TCP to get back to the IP
-  packet mechanism that TCP is built on, but without length
-  limits; and reimplements the closing handshake in-band.
-
-  Other than that, it adds nothing. Basically it is intended
-  to be as close to just exposing raw TCP to script as possible
-  given the constraints of the Web. It's also designed in such a way
-  that its servers can share a port with HTTP servers, by having its
-  handshake be a valid HTTP Upgrade handshake also.&lt;/p&gt;
-
-  &lt;p&gt;The protocol is intended to be extensible; future versions will
-  likely introduce a mechanism to compress data and might support
-  sending binary data. To do this, future versions of this protocol
-  are likely to introduce option fields that clients can send in its
-  handshake to announce support for a feature (such as compression),
-  to which the server can react by including a similar option field in
-  &lt;em&gt;its&lt;/em&gt; handshake.&lt;/p&gt;
-
-
-  &lt;h6 id=security-model&gt;&lt;span class=secno&gt;10.3.4.1.6 &lt;/span&gt;Security model&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The WebSocket protocol uses the origin model used by Web
-  browsers to restrict which Web pages can contact a WebSocket server
-  when the WebSocket protocol is used from a Web page. Naturally,
-  when the WebSocket protocol is used by a dedicated client directly
-  (i.e. not from a Web page through a Web browser), the origin model
-  is not useful, as the client can provide any arbitrary origin
-  string.&lt;/p&gt;
-
-  &lt;p&gt;This protocol is intended to fail to establish a connection with
-  servers of pre-existing protocols like SMTP or HTTP, while allowing
-  HTTP servers to opt-in to supporting this protocol if desired. This
-  is achieved by having a strict and elaborate handshake, and by
-  limiting the data that can be inserted into the connection before
-  the handshake is finished (thus limiting how much the server can be
-  influenced).&lt;/p&gt;
-
-  &lt;p&gt;It is similarly intended to fail to establish a connection when
-  data from other protocols, especially HTTP, is sent to a WebSocket
-  server, for example as might happen if an HTML &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt;
-  were submitted to a WebSocket server. This is primarily achieved by
-  requiring that the server prove that it read the handshake, which it
-  can only do if the handshake contains the appropriate parts which
-  themselves can only be sent by a WebSocket handshake; in
-  particular, fields starting with &lt;code title=&quot;&quot;&gt;Sec-&lt;/code&gt; cannot
-  be set by an attacker from a Web browser, even when using
-  &lt;code&gt;XMLHttpRequest&lt;/code&gt;.&lt;/p&gt;
-
-
-  &lt;h6 id=relationship-to-tcp-and-http&gt;&lt;span class=secno&gt;10.3.4.1.7 &lt;/span&gt;Relationship to TCP and HTTP&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The WebSocket protocol is an independent TCP-based protocol. Its
-  only relationship to HTTP is that its handshake is interpreted by
-  HTTP servers as an Upgrade request.&lt;/p&gt;
-
-  &lt;p&gt;Based on the expert recommendation of the IANA&lt;!-- [IANA #257455]
-  --&gt;, the WebSocket protocol by default uses port 80 for regular
-  WebSocket connections and port 443 for WebSocket connections
-  tunneled over TLS.&lt;/p&gt;
-
-
-
-  &lt;h6 id=establishing-a-connection&gt;&lt;span class=secno&gt;10.3.4.1.8 &lt;/span&gt;Establishing a connection&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;There are several options for establishing a WebSocket connection.&lt;/p&gt;
-
-  &lt;p&gt;On the face of it, the simplest method would seem to be to use
-  port 80 to get a direct connection to a WebSocket server. Port 80
-  traffic, however, will often be intercepted by man-in-the-middle
-  HTTP proxies, which can lead to the connection failing to be
-  established.&lt;/p&gt;
-
-  &lt;p&gt;The most reliable method, therefore, is to use TLS encryption and
-  port 443 to connect directly to a WebSocket server. This has the
-  advantage of being more secure; however, TLS encryption can be
-  computationally expensive.&lt;/p&gt;
-
-  &lt;p&gt;When a connection is to be made to a port that is shared by an
-  HTTP server (a situation that is quite likely to occur with traffic
-  to ports 80 and 443), the connection will appear to the HTTP server
-  to be a regular GET request with an Upgrade offer. In relatively
-  simple setups with just one IP address and a single server for all
-  traffic to a single hostname, this might allow a practical way for
-  systems based on the WebSocket protocol to be deployed. In more
-  elaborate setups (e.g. with load balancers and multiple servers), a
-  dedicated set of hosts for WebSocket connections separate from the
-  HTTP servers is probably easier to manage.&lt;/p&gt;
-
-
-
-  &lt;h6 id=subprotocols-using-the-websocket-protocol&gt;&lt;span class=secno&gt;10.3.4.1.9 &lt;/span&gt;Subprotocols using the WebSocket protocol&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The client can request that the server use a specific subprotocol
-  by including the &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-Websocket-Protocol&lt;/a&gt;&lt;/code&gt;
-  field in its handshake. If it is specified, the server needs to
-  include an equivalent field in its response for the connection to be
-  established.&lt;/p&gt;
-
-  &lt;p&gt;These subprotocol names do not need to be registered, but if a
-  subprotocol is intended to be implemented by multiple independent
-  WebSocket servers, potential clashes with the names of subprotocols
-  defined independently can be avoided by using names that contain the
-  domain name of the subprotocol's originator. For example, if Example
-  Corporation were to create a Chat subprotocol to be implemented by
-  many servers around the Web, they could name it
-  &quot;chat.example.com&quot;. If the Example Organisation called their
-  competing subprotocol &quot;the-example.org-chat-protocol&quot;, then the two
-  subprotocols could be implemented by servers simultaneously, with
-  the server dynamically selecting which subprotocol to use based on
-  the value sent by the client.&lt;/p&gt;
-
-  &lt;p&gt;Subprotocols can be versioned in backwards-incompatible ways by
-  changing the subprotocol name, eg. going from &quot;bookings.example.net&quot;
-  to &quot;bookings.example.net2&quot;. These subprotocols would be considered
-  completely separate by WebSocket clients. Backwards-compatible
-  versioning can be implemented by reusing the same subprotocol string
-  but carefully designing the actual subprotocol to support this kind
-  of extensibility.&lt;/p&gt;
-
-  &lt;p&gt;Subprotocol names are sequences of one or more characters in the
-  range U+0021 to U+007F.&lt;/p&gt;
-
-
-
-  &lt;h5 id=terminology-1&gt;&lt;span class=secno&gt;10.3.4.2 &lt;/span&gt;Terminology&lt;/h5&gt;
-
-
-  &lt;p&gt;When an implementation is required to &lt;i&gt;send&lt;/i&gt; data as part of
-  the WebSocket protocol, the implementation may delay the actual
-  transmission arbitrarily, e.g. buffering data so as to send fewer IP
-  packets.&lt;/p&gt;
-
-
-
-  &lt;h5 id=websocket-urls&gt;&lt;span class=secno&gt;10.3.4.3 &lt;/span&gt;WebSocket URLs&lt;/h5&gt;
-
-  &lt;h6 id=parsing-websocket-urls&gt;&lt;span class=secno&gt;10.3.4.3.1 &lt;/span&gt;Parsing WebSocket URLs&lt;/h6&gt;
-
-  &lt;p&gt;The steps to &lt;dfn id=&quot;parse-a-websocket-url's-components&quot;&gt;parse a WebSocket URL's components&lt;/dfn&gt; from
-  a string &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; are as follows. These steps return
-  either a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a
-  &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-  flag, or they fail.&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; string is not an
-   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, then fail this algorithm. &lt;a href=#refsWEBADDRESSES&gt;[WEBADDRESSES]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; string using the &lt;span&gt;resolve a Web
-    address&lt;/span&gt; algorithm defined by the Web addresses
-    specification, with the &lt;span&gt;URL character encoding&lt;/span&gt; set to
-    UTF-8. &lt;a href=#refsWEBADDRESSES&gt;[WEBADDRESSES]&lt;/a&gt; &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt; &lt;!-- the URL character
-    encoding is used to escape the query component --&gt;
-
-    &lt;p class=note&gt;It doesn't matter what it is resolved relative to,
-    since we already know it is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; at this
-    point.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; does not have a &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component whose value,
-   when &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt;, is either &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot; or &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, then fail this
-   algorithm.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component, then fail
-   this algorithm.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
-   component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; is &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot;,
-   set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to false; otherwise, the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component is &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to
-   true.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the value of the &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII
-   lowercase&lt;/a&gt;.&lt;/li&gt; &lt;!-- at this point this is
-   Punycode-encoded already --&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-port title=url-port&gt;&lt;port&gt;&lt;/a&gt; component, then let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be that component's value; otherwise, there is
-   no explicit &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If there is no explicit &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then: if
-   &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;
-   be 80, otherwise let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be 443.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; be the value of the
-   &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component (which might
-   be empty) of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt; &lt;!-- at this point
-   this is UTF-8 encoded and %-escaped --&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; is the empty string,
-   set it to a single character U+002F SOLIDUS (/).&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, then append a
-   single U+003F QUESTION MARK character (?) to &lt;var title=&quot;&quot;&gt;resource
-   name&lt;/var&gt;, followed by the value of the &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component.&lt;/li&gt; &lt;!-- at
-   this point this is UTF-8 encoded and %-escaped --&gt;
-
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;,
-   &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;h6 id=constructing-websocket-urls&gt;&lt;span class=secno&gt;10.3.4.3.2 &lt;/span&gt;Constructing WebSocket URLs&lt;/h6&gt;
-
-  &lt;p&gt;The steps to &lt;dfn id=construct-a-websocket-url&gt;construct a WebSocket URL&lt;/dfn&gt; from a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag,
-  are as follows:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the empty string.&lt;/li&gt;
-
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag is false, then append
-   the string &quot;&lt;code title=&quot;&quot;&gt;<A HREF="ws://&lt;/code">ws://&lt;/code</A>&gt;&quot; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;. Otherwise, append the string &quot;&lt;code title=&quot;&quot;&gt;<A HREF="wss://&lt;/code">wss://&lt;/code</A>&gt;&quot; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;Append &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag is false and port is
-   not 80, or if the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag is true and
-   port is not 443, then append the string &quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;
-   followed by &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;Append &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;Return &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;h5 id=client-side-requirements&gt;&lt;span class=secno&gt;10.3.4.4 &lt;/span&gt;Client-side requirements&lt;/h5&gt;
-
-  &lt;p&gt;&lt;i&gt;This section only applies to user agents, not to
-  servers.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;User agents running in controlled environments, e.g. browsers on
-  mobile handsets tied to specific carriers, may offload the
-  management of the connection to another agent on the network. In
-  such a situation, the user agent for the purposes of conformance is
-  considered to include both the handset software and any such
-  agents.&lt;/p&gt;
-
-  &lt;p class=note&gt;This specification doesn't currently define a limit
-  to the number of simultaneous connections that a client can
-  establish to a server.&lt;/p&gt;
-
-
-  &lt;h6 id=opening-handshake-0&gt;&lt;span class=secno&gt;10.3.4.4.1 &lt;/span&gt;Opening handshake&lt;/h6&gt;
-
-  &lt;p&gt;When the user agent is to &lt;dfn id=establish-a-websocket-connection&gt;establish a WebSocket
-  connection&lt;/dfn&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on a port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, from an origin whose &lt;a href=#ascii-serialization-of-an-origin title=&quot;ASCII
-  serialization of an origin&quot;&gt;ASCII serialization&lt;/a&gt; is &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, with a flag &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;, with
-  a string giving a &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, with a
-  (possibly empty) list of strings giving the &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt;, and optionally with a &lt;var title=&quot;&quot;&gt;defer
-  cookies&lt;/var&gt; flag, it must run the following steps. The &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; must have been punycode-encoded already if
-  necessary (i.e. it does not contain characters above U+007E). The
-  &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt; must not contain characters in the range
-  U+0041 to U+005A (i.e. LATIN CAPITAL LETTER A to LATIN CAPITAL
-  LETTER Z). The &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; string must be a
-  non-empty string of characters in the range U+0021 to U+007E that
-  starts with a U+002F SOLIDUS character (/). The various strings in
-  &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; must all be non-empty strings with
-  characters in the range U+0021 to U+007E, and must all be unique. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;
-
-    &lt;p&gt;If the user agent already has a WebSocket connection to the
-    remote host (IP address) identified by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;,
-    even if known by another name, wait until that connection has been
-    &lt;a href=#websocket-connection-is-established title=&quot;WebSocket connection is
-    established&quot;&gt;established&lt;/a&gt; or for that connection to have
-    &lt;a href=#fail-the-websocket-connection title=&quot;fail the WebSocket connection&quot;&gt;failed&lt;/a&gt;. If
-    multiple connections to the same IP address are attempted
-    simultaneously, the user agent must serialize them so that there
-    is no more than one connection at a time running through the
-    following steps.&lt;/p&gt;
-
-    &lt;p&gt;If the user agent cannot determine the IP address of the remote
-    host (for example because all communication is being done through
-    a proxy server that performs DNS queries itself), then the user
-    agent must assume for the purposes of this step that each host
-    name refers to a distinct remote host, but should instead limit
-    the total number of simultaneous connections that are not &lt;a href=#websocket-connection-is-established title=&quot;WebSocket connection is established&quot;&gt;established&lt;/a&gt; to
-    a reasonably low number (e.g., in a Web browser, to the number of
-    tabs the user has open).&lt;/p&gt;
-
-    &lt;p class=note&gt;This makes it harder for a script to perform a
-    denial of service attack by just opening a large number of
-    WebSocket connections to a remote host. A server can further
-    reduce the load on itself when attacked by making use of this by
-    pausing before closing the connection, as that will reduce the
-    rate at which the client reconnects.&lt;/p&gt;
-
-    &lt;p class=note&gt;There is no limit to the number of &lt;a href=#websocket-connection-is-established title=&quot;WebSocket connection is established&quot;&gt;established&lt;/a&gt;
-    WebSocket connections a user agent can have with a single remote
-    host. Servers can refuse to connect users with an excessive number
-    of connections, or disconnect resource-hogging users when
-    suffering high load.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;&lt;i&gt;Connect&lt;/i&gt;: If the user agent is configured to use a proxy
-    when using the WebSocket protocol to connect to host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and/or port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then
-    connect to that proxy and ask it to open a TCP connection to
-    the host given by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by
-    &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;div class=example&gt;
-
-     &lt;p&gt;For example, if the user agent uses an HTTP proxy for all
-     traffic, then if it was to try to connect to port 80 on server
-     example.com, it might send the following lines to the proxy
-     server:&lt;/p&gt;
-
-     &lt;pre&gt;CONNECT example.com:80 HTTP/1.1
-Host: example.com&lt;/pre&gt;
-
-     &lt;p&gt;If there was a password, the connection might look like:&lt;/p&gt;
-
-     &lt;pre&gt;CONNECT example.com:80 HTTP/1.1
-Host: example.com
-Proxy-authorization: Basic ZWRuYW1vZGU6bm9jYXBlcyE=&lt;/pre&gt;
-
-    &lt;/div&gt;
-
-    &lt;p&gt;Otherwise, if the user agent is not configured to use a proxy,
-    then open a TCP connection to the host given by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=note&gt;Implementations that do not expose explicit UI for
-    selecting a proxy for WebSocket connections separate from other
-    proxies are encouraged to use a SOCKS proxy for WebSocket
-    connections, if available, or failing that, to prefer the proxy
-    configured for HTTPS connections over the proxy configured for
-    HTTP connections.&lt;/p&gt;
-
-    &lt;p&gt;For the purpose of proxy autoconfiguration scripts, the
-    &lt;a href=#url&gt;URL&lt;/a&gt; to pass the function must be constructed from
-    &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-    flag using the steps to &lt;a href=#construct-a-websocket-url&gt;construct a WebSocket
-    URL&lt;/a&gt;.&lt;/p&gt;
-
-    &lt;p class=note&gt;The WebSocket protocol can be identified in proxy
-    autoconfiguration scripts from the scheme (&quot;&lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt;&quot; for unencrypted connections and &quot;&lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt;&quot; for encrypted connections).&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the connection could not be opened, then &lt;a href=#fail-the-websocket-connection&gt;fail the
-   WebSocket connection&lt;/a&gt; and abort these steps.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is true, perform a TLS handshake
-    over the connection. If this fails (e.g. the server's certificate
-    could not be verified), then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-    connection&lt;/a&gt; and abort these steps. Otherwise, all further
-    communication on this channel must run through the encrypted
-    tunnel. &lt;a href=#refsRFC2246&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;User agents must use the Server Name Indication extension in
-    the TLS handshake. &lt;a href=#refsRFC4366&gt;[RFC4366]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;User agents must use the Next Protocol Negotiation extension in
-    the TLS handshake, selecting the &quot;776562736f636b6574&quot; protocol
-    (&quot;websocket&quot; in UTF-8). &lt;a href=#refsNPN&gt;[NPN]&lt;/a&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send the UTF-8 string &quot;GET&quot; followed by a UTF-8-encoded U+0020
-    SPACE character to the remote side (the server).&lt;/p&gt;
-
-    &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; value, encoded as
-    UTF-8.&lt;/p&gt;
-
-    &lt;p&gt;Send another UTF-8-encoded U+0020 SPACE character, followed by
-    the UTF-8 string &quot;HTTP/1.1&quot;, followed by a UTF-8-encoded U+000D
-    CARRIAGE RETURN U+000A LINE FEED character pair (CRLF).&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; be an empty list of strings.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string &quot;Upgrade:&nbsp;WebSocket&quot; to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string &quot;Connection:&nbsp;Upgrade&quot; to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt; be an empty string.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Append the &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; value, &lt;a href=#converted-to-ascii-lowercase&gt;converted to
-    ASCII lowercase&lt;/a&gt;, to &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 80, or if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is
-    true, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 443, then append a
-    U+003A COLON character (:) followed by the value of &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, expressed as a base-ten integer, to &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string consisting of the concatenation of the string
-    &quot;Host:&quot;, a U+0020 SPACE character, and &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt;, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string consisting of the concatenation of the string
-    &quot;Origin:&quot;, a U+0020 SPACE character, and the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt; value, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; list is empty, then skip
-    this step.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, add the string consisting of the concatenation of
-    the string &quot;Sec-WebSocket-Protocol:&quot;, a U+0020 SPACE character,
-    and the strings in &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt;, maintaining
-    their relative order and each separated from the next by a single
-    U+0020 SPACE character, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-&lt;!--UAS:
-   &lt;li&gt;
-
-    &lt;p&gt;Optionally, add the string consisting of the concatenation of
-    the string &quot;User-Agent:&quot;, a U+0020 SPACE character, and a
-    user-agent defined string, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the client has any &lt;!--(v2-ws-auth) authentication
-    information or--&gt; cookies that would be relevant to a resource
-    accessed over HTTP, if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, or
-    HTTPS, if it is true, on host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as the
-    path (and possibly query parameters), then add to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; any HTTP headers that would be appropriate
-    for that information.
-    &lt;a href=#refsHTTP&gt;[HTTP]&lt;/a&gt;
-    &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt;
-
-    &lt;/p&gt;
-
-    &lt;p&gt;This includes &quot;&lt;code&gt;HttpOnly&lt;/code&gt;&quot; cookies (cookies with the
-    http-only-flag set to true); the WebSocket protocol is not
-    considered a non-HTTP API for the purpose of cookie
-    processing.&lt;/p&gt;
-
-    &lt;p&gt;When one or more HTTP headers are to be added to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; for this step, each header must be added
-    separately, and each header must be added as one entry consisting
-    of the header's name in its canonical case, followed by a U+003A
-    COLON character (:) and a U+0020 SPACE character, followed by the
-    value with no use of continuation lines (i.e. containing no U+000A
-    LINE FEED characters).&lt;/p&gt;
-
-    &lt;!-- (Cookie headers only use one header for multiple cookies.) --&gt;
-
-&lt;!--(v2-ws-auth)
-    &lt;div class=&quot;example&quot;&gt;
-
-     &lt;p&gt;For example, if the server had a username and password that
-     applied to &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/socket&lt;/code">http://example.com/socket&lt;/code</A>&gt;, and
-     the WebSocket was being opened to &lt;code
-     title=&quot;&quot;&gt;<A HREF="ws://example.com/socket&lt;/code">ws://example.com/socket&lt;/code</A>&gt;, it could add them:&lt;/p&gt;
-
-     &lt;pre&gt;Authorization: Basic d2FsbGU6ZXZl&lt;/pre&gt;
-
-    &lt;/div&gt;
---&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a random integer
-    from 1 to 12 inclusive.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a random integer
-    from 1 to 12 inclusive.&lt;/p&gt;
-
-    &lt;p class=example&gt;For example, 5 and 9.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be the largest integer
-    not greater than 4,294,967,295 divided by &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be the largest integer
-    not greater than 4,294,967,295 divided by &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=example&gt;Continuing the example, 858,993,459 and 477,218,588.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a random integer
-    from 0 to &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; inclusive.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a random integer
-    from 0 to &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; inclusive.&lt;/p&gt;
-
-    &lt;p class=example&gt;For example, 777,007,543 and 114,997,259.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be the result of
-    multiplying &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; together.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be the result of
-    multiplying &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; together.&lt;/p&gt;
-
-    &lt;p class=example&gt;Continuing the example, 3,885,037,715 and
-    1,034,975,331.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a string consisting
-    of &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed in base ten
-    using the numerals in the range U+0030 DIGIT ZERO (0) to U+0039
-    DIGIT NINE (9).&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a string consisting
-    of &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;, expressed in base ten
-    using the numerals in the range U+0030 DIGIT ZERO (0) to U+0039
-    DIGIT NINE (9).&lt;/p&gt;
-
-    &lt;p class=example&gt;Continuing the example, &quot;3885037715&quot; and
-    &quot;1034975331&quot;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Insert between one and twelve random characters from
-    the ranges U+0021 to U+002F and U+003A to U+007E into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; at random positions.&lt;/p&gt;
-
-    &lt;p&gt;Insert between one and twelve random characters from
-    the ranges U+0021 to U+002F and U+003A to U+007E into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; at random positions.&lt;/p&gt;
-
-    &lt;p class=note&gt;This corresponds to random printable ASCII
-    characters other than the digits and the U+0020 SPACE
-    character.&lt;/p&gt;
-
-    &lt;p class=example&gt;Continuing the example, this could lead to
-    &quot;P388O503D&amp;ul7{K%gX(%715&quot; and
-    &quot;1N?|kUT0or3o4I97N5-S3O31&quot;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Insert &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; U+0020 SPACE
-    characters into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; at random
-    positions other than the start or end of the string.&lt;/p&gt;
-
-    &lt;p&gt;Insert &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; U+0020 SPACE
-    characters into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; at random
-    positions other than the start or end of the string.&lt;/p&gt;
-
-    &lt;p class=example&gt;Continuing the example, this could lead to
-    &quot;P388&nbsp;O503D&amp;ul7&nbsp;{K%gX(&nbsp;%7&nbsp;&nbsp;15&quot; and
-    &quot;1&nbsp;N&nbsp;?|k&nbsp;UT0or&nbsp;3o&nbsp;&nbsp;4&nbsp;I97N&nbsp;5-S3O&nbsp;31&quot;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string consisting of the concatenation of the string
-    &quot;Sec-WebSocket-Key1:&quot;, a U+0020 SPACE character, and the &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; value, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Add the string consisting of the concatenation of the string
-    &quot;Sec-WebSocket-Key2:&quot;, a U+0020 SPACE character, and the &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; value, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;For each string in &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;, in a random
-    order: send the string, encoded as UTF-8, followed by a
-    UTF-8-encoded U+000D CARRIAGE RETURN U+000A LINE FEED character
-    pair (CRLF). It is important that the fields be output in a
-    random order so that servers not depend on the particular order
-    used by any particular client.&lt;/p&gt;
-
-    &lt;p class=note&gt;Only fields explicitly mentioned in the
-    requirements of this specification are sent. For example, user
-    agents do not send fields such as &lt;code title=http-user-agent&gt;User-Agent&lt;/code&gt;&lt;!--UAS--&gt;, &lt;code title=http-accept-language&gt;Accept-Language&lt;/code&gt;, or &lt;code title=http-content-type&gt;Content-Type&lt;/code&gt; in the WebSocket
-    handshake.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send a UTF-8-encoded U+000D CARRIAGE RETURN U+000A LINE FEED
-    character pair (CRLF).&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;3&lt;/sub&gt;&lt;/var&gt; be a string consisting
-    of eight random bytes (or equivalently, a random 64 bit unsigned
-    integer encoded in big-endian order).&lt;/p&gt;
-
-    &lt;p class=example&gt;For example, 0x47 0x30 0x22 0x2D 0x5A 0x3F 0x47
-    0x58.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;3&lt;/sub&gt;&lt;/var&gt; to the server.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read bytes from the server until either the connection closes,
-    or a 0x0A byte is read. Let &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; be these
-    bytes, including the 0x0A byte.&lt;/p&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; is not at least seven bytes long,
-    or if the last two bytes aren't 0x0D and 0x0A respectively, or if
-    &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; contains any 0x0D bytes other than the
-    penultimate byte, or if &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; does not contain
-    at least two 0x20 bytes, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-    connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
-
-    &lt;p&gt;User agents may apply a timeout to this step, &lt;a href=#fail-the-websocket-connection title=&quot;fail
-    the WebSocket connection&quot;&gt;failing the WebSocket
-    connection&lt;/a&gt; if the server does not send back data in a
-    suitable time period.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; be the substring of &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; that starts from the byte after the first
-    0x20 byte, and ends with the byte before the second 0x20 byte.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-&lt;!--(removed since the next step is even stricter)
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; is not three bytes long, or if any
-    of the bytes in &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; are not in the range 0x30
-    to 0x39, then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort
-    these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
-&lt;!--(v2-redirect or v2-ws-auth) - - then change the text below
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;101&quot;,
-    then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;.&lt;/p&gt;
---&gt;
-&lt;!--(v2-redirect)
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is either
-    &quot;&lt;code title=&quot;&quot;&gt;301&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;302&lt;/code&gt;&quot;, &quot;&lt;code
-    title=&quot;&quot;&gt;303&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;307&lt;/code&gt;&quot;, then let &lt;var
-    title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt;.&lt;/p&gt;
---&gt;
-&lt;!--(v2-ws-auth)
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;&lt;code
-    title=&quot;&quot;&gt;401&lt;/code&gt;&quot;, then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i
-    title=&quot;&quot;&gt;authenticate&lt;/i&gt;.&lt;/p&gt;
---&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;101&quot;,
-    then move to the next step.&lt;/p&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;&lt;code title=&quot;&quot;&gt;407&lt;/code&gt;&quot;, then either close the connection and jump
-    back to step 2, providing appropriate authentication information,
-    or &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt;. 407 is the code
-    used by HTTP meaning &quot;Proxy Authentication Required&quot;. User agents
-    that support proxy authentication must interpret the response as
-    defined by HTTP (e.g. to find and interpret the &lt;code title=http-Proxy-Authenticate&gt;Proxy-Authenticate&lt;/code&gt;
-    header).&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort
-    these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; be a list of name-value
-   pairs, initially empty.&lt;/li&gt;
-
-   &lt;li id=ws-ua-field-loop&gt;&lt;p&gt;&lt;i title=&quot;&quot;&gt;Field&lt;/i&gt;: Let &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be empty byte
-   arrays.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read a byte from the server.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
-    steps.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, handle the byte as described in the appropriate
-    entry below:&lt;/p&gt;
-
-    &lt;dl class=switch&gt;&lt;dt&gt;If the byte is 0x0D (UTF-8 CR)&lt;/dt&gt;
-
-     &lt;dd&gt;If the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte array is empty, then
-     jump to the &lt;a href=#ws-ua-fields-processing&gt;fields
-     processing&lt;/a&gt; step. Otherwise, &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-     connection&lt;/a&gt; and abort these steps.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is 0x0A (UTF-8 LF)&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;a href=#fail-the-websocket-connection&gt;Fail the WebSocket connection&lt;/a&gt; and abort these
-     steps.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is 0x3A (UTF-8 :)&lt;/dt&gt;
-
-     &lt;dd&gt;Move on to the next step.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is in the range 0x41 to 0x5A (UTF-8 A-Z)&lt;/dt&gt;
-
-     &lt;dd&gt;Append a byte whose value is the byte's value plus 0x20 to
-     the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte array and redo this step for
-     the next byte.&lt;/dd&gt;
-
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;Append the byte to the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte
-     array and redo this step for the next byte.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;p class=note&gt;This reads a field name, terminated by a colon,
-    converting upper-case letters in the range A-Z to lowercase, and
-    aborting if a stray CR or LF is found.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;count&lt;/var&gt; equal 0.&lt;/p&gt;
-
-    &lt;p class=note&gt;This is used in the next step to skip past a space
-    character after the colon, if necessary.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read a byte from the server and increment &lt;var title=&quot;&quot;&gt;count&lt;/var&gt; by 1.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
-    steps.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, handle the byte as described in the appropriate
-    entry below:&lt;/p&gt;
-
-    &lt;dl class=switch&gt;&lt;dt&gt;If the byte is 0x20 (UTF-8 space) and &lt;var title=&quot;&quot;&gt;count&lt;/var&gt; equals 1&lt;/dt&gt;
-
-     &lt;dd&gt;Ignore the byte and redo this step for the next byte.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is 0x0D (UTF-8 CR)&lt;/dt&gt;
-
-     &lt;dd&gt;Move on to the next step.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is 0x0A (UTF-8 LF)&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;a href=#fail-the-websocket-connection&gt;Fail the WebSocket connection&lt;/a&gt; and abort these
-     steps.&lt;/dd&gt;
-
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;Append the byte to the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; byte array
-     and redo this step for the next byte.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;p class=note&gt;This reads a field value, terminated by a CRLF,
-    skipping past a single space after the colon if there is one.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read a byte from the server.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before this byte is received, or if
-    the byte is not a 0x0A byte (UTF-8 LF), then &lt;a href=#fail-the-websocket-connection&gt;fail the
-    WebSocket connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
-
-    &lt;p class=note&gt;This skips past the LF byte of the CRLF after the
-    field.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Append an entry to the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list that
-    has the name given by the string obtained by interpreting the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte array as a UTF-8 byte stream and the
-    value given by the string obtained by interpreting the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; byte array as a UTF-8 byte stream.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Return to the &quot;&lt;a href=#ws-ua-field-loop&gt;Field&lt;/a&gt;&quot; step
-    above.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li id=ws-ua-fields-processing&gt;
-
-    &lt;p&gt;&lt;i&gt;Fields processing&lt;/i&gt;: Read a byte from the server.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before this byte is received, or if
-    the byte is not a 0x0A byte (UTF-8 LF), then &lt;a href=#fail-the-websocket-connection&gt;fail the
-    WebSocket connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
-
-    &lt;p class=note&gt;This skips past the LF byte of the CRLF after the
-    blank line after the fields.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt; be empty.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;
-    &lt;!--(v2-redirect or v2-ws-auth) If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;, then: --&gt;
-
-    If there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-upgrade&gt;upgrade&lt;/code&gt;&quot;, or
-
-    if there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-connection&gt;connection&lt;/code&gt;&quot;, or
-
-    if there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;sec-websocket-origin&lt;/a&gt;&lt;/code&gt;&quot;, or
-
-    if there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;sec-websocket-location&lt;/a&gt;&lt;/code&gt;&quot;, or
-
-    if the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; was specified but there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;sec-websocket-protocol&lt;/a&gt;&lt;/code&gt;&quot;, or
-
-    if there are any entries in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list
-    whose names are the empty string, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-    connection&lt;/a&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
-
-    &lt;dl class=switch&gt;&lt;dt&gt;If the entry's name is &quot;&lt;code title=http-upgrade&gt;upgrade&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If the value, &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt;,
-     is not exactly equal to the string &quot;websocket&quot;, then &lt;a href=#fail-the-websocket-connection&gt;fail
-     the WebSocket connection&lt;/a&gt; and abort these steps.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-connection&gt;connection&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If the value, &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt;,
-     is not exactly equal to the string &quot;upgrade&quot;, then &lt;a href=#fail-the-websocket-connection&gt;fail the
-     WebSocket connection&lt;/a&gt; and abort these steps.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;sec-websocket-origin&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If the value is not exactly equal to &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-     connection&lt;/a&gt; and abort these steps. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;sec-websocket-location&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;If the value is not exactly equal to a string obtained from
-      the steps to &lt;a href=#construct-a-websocket-url&gt;construct a WebSocket URL&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-      flag, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort
-      these steps.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;sec-websocket-protocol&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; list was not empty, and
-      the value is not exactly equal to one of the strings in the &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; list, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-      connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
-
-      &lt;p&gt;If the the value contains any characters outside the range
-      U+0021 to U+007F, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-      connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
-
-      &lt;p&gt;Otherwise, let the &lt;dfn id=selected-websocket-subprotocol&gt;selected WebSocket subprotocol&lt;/dfn&gt;
-      be the entry's value.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-setcookie&gt;set-cookie&lt;/code&gt;&quot; or &quot;&lt;code title=http-setcookie2&gt;set-cookie2&lt;/code&gt;&quot; or another
-     cookie-related field name&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;If the relevant specification is supported by the user agent,
-      add the cookie, interpreted as defined by the appropriate
-      specification, to the &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt;, with
-      the resource being the one with the host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, the port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, the path
-      (and possibly query parameters) &lt;var title=&quot;&quot;&gt;resource
-      name&lt;/var&gt;, and the scheme &lt;code title=&quot;&quot;&gt;http&lt;/code&gt; if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false and &lt;code title=&quot;&quot;&gt;https&lt;/code&gt;
-      if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is true.
-      &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt;
-
-      &lt;/p&gt;
-
-      &lt;p&gt;If the relevant specification is not supported by the user
-      agent, then the field must be ignored.&lt;/p&gt;
-
-      &lt;p class=note&gt;The cookies added to the &lt;var title=&quot;&quot;&gt;list of
-      cookies&lt;/var&gt; are discarded if the connection fails to be
-      established. Only if and when the connection is established do
-      the cookies actually get applied.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;!--UAS: 'Server' --&gt;
-
-
-     &lt;dt&gt;Any other name&lt;/dt&gt;
-
-     &lt;dd&gt;Ignore it.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;hr&gt;&lt;!--(v2-redirect)
-redirect support
-we should probably reintroduce this at some point, with the
-multi-origin semantics described in [ORIGIN] applying. (http-origin)
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt;, then:
-    If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;&quot;&gt;location&lt;/code&gt;&quot;, then &lt;span&gt;fail the WebSocket
-    connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;&quot;&gt;location&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;
-
-       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;was secure&lt;/var&gt; have the value of
-       &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from
-       the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain new values for
-       &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
-       title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var
-       title=&quot;&quot;&gt;secure&lt;/var&gt;. If this fails, &lt;span&gt;fail the WebSocket
-       connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;was secure&lt;/var&gt; is true but &lt;var
-       title=&quot;&quot;&gt;secure&lt;/var&gt; is now false, &lt;span&gt;fail the WebSocket
-       connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is a port to which the user
-       agent is configured to block access, then &lt;span&gt;fail the
-       WebSocket connection&lt;/span&gt; and abort these steps. (User agents
-       typically block access to well-known ports like SMTP.)&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Close the connection if the server has not already done
-       so.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;&lt;span&gt;Apply the cookies&lt;/span&gt; in the &lt;var title=&quot;&quot;&gt;list
-       of cookies&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Jump back to the first step of the overall algorithm
-       (the very top of the handshake).&lt;/p&gt;&lt;/li&gt;
-
-      &lt;/ol&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;dt&gt;Any other name&lt;/dt&gt;
-
-     &lt;dd&gt;Ignore it.&lt;/dd&gt;
-
-    &lt;/dl&gt;
---&gt;&lt;!--(v2-ws-auth)
-    &lt;hr&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;authenticate&lt;/i&gt;,
-    then: If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;&quot;&gt;www-authenticate&lt;/code&gt;&quot;, then &lt;span&gt;fail the WebSocket
-    connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;&quot;&gt;www-authenticate&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;&lt;span&gt;Apply the cookies&lt;/span&gt; in the &lt;var title=&quot;&quot;&gt;list of
-      cookies&lt;/var&gt;, then obtain credentials in a manner consistent
-      with the requirements for handling the
-      &lt;code&gt;WWW-Authenticate&lt;/code&gt; header in HTTP, and then close
-      the connection (if the server has not already done so) and jump
-      back to the step labeled &lt;i&gt;connect&lt;/i&gt;, including the relevant
-      authentication headers in the new request.
-      &lt;a href=&quot;#refsHTTP&quot;&gt;[HTTP]&lt;/a&gt;
---&gt;&lt;!--
-      &lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Any other name&lt;/dt&gt;
-
-     &lt;dd&gt;Ignore it.&lt;/dd&gt;
-
-    &lt;/dl&gt;
---&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; be the concatenation of &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed as a big-endian
-    unsigned 32-bit integer, &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;,
-    expressed as a big-endian unsigned 32-bit integer, and the eight
-    bytes of &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;3&lt;/sub&gt;&lt;/var&gt; in the order they
-    were sent on the wire.&lt;/p&gt;
-
-    &lt;!--
-    perl -e 'foreach (@ARGV) { print pack 'N', $_ }' 777007543 114997259 | hexdump -C
-    --&gt;
-
-    &lt;p class=example&gt;Using the examples given earlier, this leads to
-    the 16 bytes 0x2E 0x50 0x31 0xB7 0x06 0xDA 0xB8 0x0B 0x47 0x30
-    0x22 0x2D 0x5A 0x3F 0x47 0x58.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;expected&lt;/var&gt; be the MD5 fingerprint of &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; as a big-endian 128 bit string. &lt;a href=#refsRFC1321&gt;[RFC1321]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;!--
-    perl -e &quot;print pack 'c*', map { hex } @ARGV&quot; 0x2E 0x50 0x31 0xB7 0x06 0xDA 0xB8 0x0B 0x47 0x30 0x22 0x2D 0x5A 0x3F 0x47 0x58 | md5sum -b
-    --&gt;
-
-    &lt;p class=example&gt;Using the examples given earlier, this leads to
-    the 16 bytes 0x30 0x73 0x74 0x33 0x52 0x6C 0x26 0x71 0x2D 0x32
-    0x5A 0x55 0x5E 0x77 0x65 0x75. In UTF-8, these bytes correspond to
-    the string &quot;0st3Rl&amp;q-2ZU^weu&quot;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read sixteen bytes from the server. Let &lt;var title=&quot;&quot;&gt;reply&lt;/var&gt; be those bytes.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before these bytes are received, then
-    &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
-    steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;reply&lt;/var&gt; does not exactly equal &lt;var title=&quot;&quot;&gt;expected&lt;/var&gt;, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-    connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag is not set,
-   &lt;a href=#apply-the-cookies&gt;apply the cookies&lt;/a&gt; in the &lt;var title=&quot;&quot;&gt;list of
-   cookies&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;The &lt;dfn id=websocket-connection-is-established&gt;WebSocket connection is established&lt;/dfn&gt;. Now the
-    user agent must send and receive to and from the connection as
-    described in the next section.&lt;/p&gt;
-
-    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag is set, store the
-    &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt; for use by the component that
-    invoked this algorithm.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;Where the algorithm above requires that a user agent &lt;a href=#fail-the-websocket-connection&gt;fail
-  the WebSocket connection&lt;/a&gt;, the user agent may first read an
-  arbitrary number of further bytes from the connection (and then
-  discard them) before actually &lt;a href=#fail-the-websocket-connection title=&quot;fail the WebSocket
-  connection&quot;&gt;failing the WebSocket connection&lt;/a&gt;. Similarly, if a
-  user agent can show that the bytes read from the connection so far
-  are such that there is no subsequent sequence of bytes that the
-  server can send that would not result in the user agent being
-  required to &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt;, the user
-  agent may immediately &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt;
-  without waiting for those bytes.&lt;/p&gt;
-
-  &lt;p class=note&gt;The previous paragraph is intended to make it
-  conforming for user agents to implement the algorithm in subtlely
-  different ways that are equivalent in all ways except that they
-  terminate the connection at earlier or later points. For example, it
-  enables an implementation to buffer the entire handshake response
-  before checking it, or to verify each field as it is received rather
-  than collecting all the fields and then checking them as a
-  block.&lt;/p&gt;
-
-  &lt;p&gt;When the user agent is to &lt;dfn id=apply-the-cookies&gt;apply the cookies&lt;/dfn&gt; in a &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt;, it must handle each cookie in the
-  &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt; as defined by the appropriate
-  specification.
-  &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt;
-
-  &lt;/p&gt;
-
-
-  &lt;h6 id=data-framing&gt;&lt;span class=secno&gt;10.3.4.4.2 &lt;/span&gt;Data framing&lt;/h6&gt;
-
-  &lt;p&gt;Once a &lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;, the user
-  agent must run through the following state machine for the bytes
-  sent by the server. If at any point during these steps a read is
-  attempted but fails because the &lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
-  closed&lt;/a&gt;, then abort.&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;
-
-    &lt;p&gt;Try to read a byte from the server. Let &lt;var title=&quot;&quot;&gt;frame
-    type&lt;/var&gt; be that byte.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read eight more bytes from the server. Let &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; be the result of interpreting those
-    eight bytes as a big-endian 64 bit unsigned integer.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; bytes from the
-    server. Let &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; be those bytes.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; be false.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; is greater than the length
-    of data the user agent is able to deal with at this time, set &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; to true.&lt;/p&gt;
-
-    &lt;p&gt;User agents should ensure they are always able to deal with
-    lengths up to at least 65536 bytes.&lt;/p&gt;
-
-    &lt;p class=note&gt;The minimum expected supported length will likely
-    be increased in future revisions of this protocol.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; is still false, handle the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte as follows:&lt;/p&gt;
-
-    &lt;dl&gt;&lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is 0x00&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; is not zero, then set
-      &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; to true. Otherwise, run these
-      steps:&lt;/p&gt;
-
-      &lt;ol&gt;&lt;li&gt;If &lt;a href=#the-websocket-closing-handshake-has-started title=&quot;the WebSocket closing handshake has
-       started&quot;&gt;the WebSocket closing handshake has not yet
-       started&lt;/a&gt;, then &lt;a href=#start-the-websocket-closing-handshake&gt;start the WebSocket closing
-       handshake&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;Wait until either &lt;a href=#the-websocket-closing-handshake-has-started&gt;the WebSocket closing handshake
-       has started&lt;/a&gt; or the &lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
-       closed&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;If the &lt;a href=#websocket-connection-is-closed title=&quot;WebSocket connection is
-       closed&quot;&gt;WebSocket connection is not already closed&lt;/a&gt;,
-       then &lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt;: &lt;dfn id=the-websocket-closing-handshake-has-finished&gt;The
-       WebSocket closing handshake has finished&lt;/dfn&gt;. (If the
-       connection closes before this happens, then the closing
-       handshake doesn't finish.)&lt;/li&gt;
-
-       &lt;li&gt;Abort these steps. Any data on the connection after the
-       0x00 frame is discarded.&lt;/li&gt;
-
-      &lt;/ol&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is 0xFF&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;&lt;dfn id=a-websocket-message-has-been-received&gt;A WebSocket message has been received&lt;/dfn&gt; with
-      obtained by interpreting &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; as a UTF-8
-      string.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Otherwise (the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is in the range 0x01 to 0xFE)&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;Set &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; to true.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; is true, then &lt;dfn id=a-websocket-error-has-been-detected&gt;a WebSocket
-    error has been detected&lt;/dfn&gt;. Discard &lt;var title=&quot;&quot;&gt;raw
-    data&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return to the first step to read the next byte.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;If the user agent runs out of resources for buffering incoming
-  data, or hits an artificial resource limit intended to avoid
-  resource starvation, then it must &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-  connection&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;p&gt;Once a &lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;, but
-  before &lt;a href=#the-websocket-closing-handshake-has-started&gt;the WebSocket closing handshake has started&lt;/a&gt;, the
-  user agent must use the following steps to &lt;dfn id=send-data-using-the-websocket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/dfn&gt;:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Encode the text in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using UTF-8 to
-   obtain the byte stream &lt;var title=&quot;&quot;&gt;bytes&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send a 0xFF byte to the server.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send the number of bytes in &lt;var title=&quot;&quot;&gt;bytes&lt;/var&gt;, as a
-   64 bit big-endian unsigned integer, to the server.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; to the server.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;Once &lt;a href=#the-websocket-closing-handshake-has-started&gt;the WebSocket closing handshake has started&lt;/a&gt;,
-  the user agent must not send any further data on the connection.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;p&gt;Once a &lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;, the user
-  agent must use the following steps to &lt;dfn id=start-the-websocket-closing-handshake&gt;start the WebSocket
-  closing handshake&lt;/dfn&gt;. These steps must be run asynchronously
-  relative to whatever algorithm invoked this one.&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;a href=#the-websocket-closing-handshake-has-started&gt;the WebSocket closing handshake has started&lt;/a&gt;,
-   then abort these steps.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send nine 0x00 bytes to the server.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;dfn id=the-websocket-closing-handshake-has-started&gt;The WebSocket closing handshake has started&lt;/dfn&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Wait a user-agent-determined length of time, or until the
-   &lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is closed&lt;/a&gt;.&lt;/p&gt;
-
-   &lt;li&gt;If the &lt;a href=#websocket-connection-is-closed title=&quot;WebSocket connection is closed&quot;&gt;WebSocket
-   connection is not already closed&lt;/a&gt;, then &lt;a href=#close-the-websocket-connection&gt;close the
-   WebSocket connection&lt;/a&gt;. (If this happens, then the closing
-   handshake doesn't finish.)&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p class=note&gt;If the user agent initiates it, the closing
-  handshake &lt;a href=#the-websocket-closing-handshake-has-finished title=&quot;the WebSocket closing handshake has
-  finished&quot;&gt;finishes&lt;/a&gt; once the server returns the 0x00 frame, as
-  described above.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;p&gt;If at any point there is a fatal problem with sending data to the
-  server, the user agent must &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
-  connection&lt;/a&gt;.&lt;/p&gt;
-
-
-  &lt;h6 id=handling-errors-in-utf-8-from-the-server&gt;&lt;span class=secno&gt;10.3.4.4.3 &lt;/span&gt;Handling errors in UTF-8 from the server&lt;/h6&gt;
-
-  &lt;p&gt;When a client is to interpret a byte stream as UTF-8 but finds
-  that the byte stream is not in fact a valid UTF-8 stream, then any
-  bytes or sequences of bytes that are not valid UTF-8 sequences must
-  be interpreted as a U+FFFD REPLACEMENT CHARACTER.&lt;/p&gt;
-
-
-
-  &lt;h5 id=server-side-requirements&gt;&lt;span class=secno&gt;10.3.4.5 &lt;/span&gt;Server-side requirements&lt;/h5&gt;
-
-  &lt;p&gt;&lt;i&gt;This section only applies to servers.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;Servers may offload the management of the connection to other
-  agents on the network, for example load balancers and reverse
-  proxies. In such a situation, the server for the purposes of
-  conformance is considered to include all parts of the server-side
-  infrastructure from the first device to terminate the TCP connection
-  all the way to the server that processes requests and sends
-  responses.&lt;/p&gt;
-
-  &lt;div class=example&gt;
-
-   &lt;p&gt;For example, a data center might have a server that responds to
-   Web Socket requests with an appropriate handshake, and then passes
-   the connection to another server to actually process the data
-   frames. For the purposes of this specification, the &quot;server&quot; is the
-   combination of both computers.&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-  &lt;h6 id=&quot;reading-the-client's-opening-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.5.1 &lt;/span&gt;Reading the client's opening handshake&lt;/h6&gt;
-
-  &lt;p&gt;When a client starts a WebSocket connection, it sends its part of
-  the opening handshake. The server must parse at least part of this
-  handshake in order to obtain the necessary information to generate
-  the server part of the handshake.&lt;/p&gt;
-
-  &lt;p&gt;The client handshake consists of the following parts. If the
-  server, while reading the handshake, finds that the client did not
-  send a handshake that matches the description below, the server
-  should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket connection&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;The three-character UTF-8 string &quot;GET&quot;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;A UTF-8-encoded U+0020 SPACE character (0x20 byte).&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;A string consisting of all the bytes up to the next
-   UTF-8-encoded U+0020 SPACE character (0x20 byte). The result of
-   decoding this string as a UTF-8 string is the name of the resource
-   requested by the server. If the server only supports one resource,
-   then this can safely be ignored; the client verifies that the right
-   resource is supported based on the information included in the
-   server's own handshake. The resource name will begin with U+002F
-   SOLIDUS character (/) and will only include characters in the range
-   U+0021 to U+007E.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;A string of bytes terminated by a UTF-8-encoded U+000D
-   CARRIAGE RETURN U+000A LINE FEED character pair (CRLF). All the
-   characters from the second 0x20 byte up to the first 0x0D 0x0A byte
-   pair in the data from the client can be safely ignored. (It will
-   probably be the string &quot;HTTP/1.1&quot;.)&lt;/p&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;A series of fields.&lt;/p&gt;
-
-    &lt;p&gt;Each field is terminated by a UTF-8-encoded U+000D CARRIAGE
-    RETURN U+000A LINE FEED character pair (CRLF). The end of the
-    fields is denoted by the terminating CRLF pair being followed
-    immediately by another CRLF pair.&lt;/p&gt;
-
-    &lt;p class=note&gt;In other words, the fields start with the first
-    0x0D 0x0A byte pair, end with the first 0x0D 0x0A 0x0D 0x0A byte
-    sequence, and are separate from each other by 0x0D 0x0A byte
-    pairs.&lt;/p&gt;
-
-    &lt;p&gt;The fields are encoded as UTF-8.&lt;/p&gt;
-
-    &lt;p&gt;Each field consists of a name, consisting of one or more
-    characters in the ranges U+0021 to U+0039 and U+003B to U+007E,
-    followed by a U+003A COLON character (:) and a U+0020 SPACE
-    character, followed by zero or more characters forming the
-    value.&lt;/p&gt;
-
-    &lt;p&gt;The expected field names, the meaning of their corresponding
-    values, and the processing servers are required to apply to those
-    fields, are described below, after the description of the client
-    handshake.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;After the first 0x0D 0x0A 0x0D 0x0A byte sequence, indicating
-    the end of the fields, the client sends eight random bytes. These
-    are used in constructing the server handshake.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;The expected field names, and the meaning of their corresponding
-  values, are as follows. Field names must be compared in an
-  &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; manner.&lt;/p&gt;
-
-  &lt;dl&gt;&lt;dt&gt;&lt;code title=http-upgrade&gt;Upgrade&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Invariant part of the handshake. Will always have a value that
-    is an &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the string
-    &quot;WebSocket&quot;.&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
-    connection&lt;/a&gt; if this field is absent or has a different
-    value, to avoid vulnerability to cross-protocol attacks.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=http-connection&gt;Connection&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Invariant part of the handshake. Will always have a value that
-    is an &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the string
-    &quot;Upgrade&quot;.&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
-    connection&lt;/a&gt; if this field is absent or has a different
-    value, to avoid vulnerability to cross-protocol attacks.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=http-host&gt;Host&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The value gives the hostname that the client intended to use
-    when opening the WebSocket. It would be of interest in particular
-    to virtual hosting environments, where one server might serve
-    multiple hosts, and might therefore want to return different
-    data.&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
-    connection&lt;/a&gt; if this field is absent or has a value that
-    does not match the server's host name, to avoid vulnerability to
-    cross-protocol attacks and DNS rebinding attacks.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=http-origin&gt;Origin&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The value gives the scheme, hostname, and port (if it's not the
-    default port for the given scheme) of the page that asked the
-    client to open the WebSocket. It would be interesting if the
-    server's operator had deals with operators of other sites, since
-    the server could then decide how to respond (or indeed,
-    &lt;em&gt;whether&lt;/em&gt; to respond) based on which site was requesting a
-    connection. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
-    connection&lt;/a&gt; if this field is absent or has a value that
-    does not match one of the origins the server is expecting to
-    communicate with, to avoid vulnerability to cross-protocol attacks
-    and cross-site scripting attacks.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The value gives the names of subprotocols that the client is
-    willing to use, as a space-separated list in the order that the
-    client prefers the protocols. It would be interesting if the
-    server supports multiple protocols or protocol versions.&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server may &lt;a href=#abort-the-websocket-connection&gt;abort the
-    WebSocket connection&lt;/a&gt; if the field is absent but the
-    conventions for communicating with the server are such that the
-    field is expected; and the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
-    connection&lt;/a&gt; if the field does not contain a value that does
-    matches one of the subprotocols that the server supports, to avoid
-    integrity errors once the connection is established.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=http-sec-websocket-key1&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key1&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
-   &lt;dt&gt;&lt;code title=http-sec-websocket-key2&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key2&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The values provide the information required for computing the
-    server's handshake, as described in the next section.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;!--UAS: 'User-Agent' --&gt;
-
-   &lt;dt&gt;Other fields&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Other fields can be used, such as &quot;&lt;code title=&quot;&quot;&gt;Cookie&lt;/code&gt;&quot;&lt;!--(v2-ws-auth) or
-    &quot;&lt;code&gt;Authorization&lt;/code&gt;&quot;--&gt;, for authentication
-    purposes. Their semantics are equivalent to the semantics of the
-    HTTP headers with the same names.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;&lt;p&gt;Unrecognized fields can be safely ignored, and are probably
-  either the result of intermediaries injecting fields unrelated to
-  the operation of the WebSocket protocol, or clients that support
-  future versions of the protocol offering options that the server
-  doesn't support.&lt;/p&gt;
-
-
-  &lt;h6 id=&quot;sending-the-server's-opening-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.5.2 &lt;/span&gt;Sending the server's opening handshake&lt;/h6&gt;
-
-  &lt;p&gt;When a client establishes a WebSocket connection to a server, the
-  server must run the following steps.&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;
-
-    &lt;p&gt;If the server supports encryption, perform a TLS handshake over
-    the connection. If this fails (e.g. the client indicated a host
-    name in the extended client hello &quot;server_name&quot; extension that the
-    server does not host), then close the connection; otherwise, all
-    further communication for the connection (including the server
-    handshake) must run through the encrypted tunnel. &lt;a href=#refsRFC2246&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Servers must support the Next Protocol Negotiation extension in
-    the TLS handshake, advertising support for the
-    &quot;776562736f636b6574&quot; protocol (&quot;websocket&quot; in UTF-8). &lt;a href=#refsNPN&gt;[NPN]&lt;/a&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Establish the following information:&lt;/p&gt;
-
-    &lt;dl&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;host&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The host name or IP address of the WebSocket server, as it is
-     to be addressed by clients. The host name must be
-     punycode-encoded if necessary. If the server can respond to
-     requests to multiple hosts (e.g. in a virtual hosting
-     environment), then the value should be derived from the client's
-     handshake, specifically from the &quot;&lt;code title=http-host&gt;Host&lt;/code&gt;&quot; field. The &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; value must be lowercase (not containing
-     characters in the range U+0041 LATIN CAPITAL LETTER A to U+005A
-     LATIN CAPITAL LETTER Z).&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The port number on which the server expected and/or received
-     the connection.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;An identifier for the service provided by the server. If the
-     server provides multiple services, then the value should be
-     derived from the resource name given in the client's
-     handshake.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;secure flag&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;True if the connection is encrypted or if the server expected
-     it to be encrypted; false otherwise.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The &lt;a href=#ascii-serialization-of-an-origin title=&quot;ASCII serialization of an origin&quot;&gt;ASCII
-     serialization&lt;/a&gt; of the origin that the server is willing to
-     communicate with, &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt;. If
-     the server can respond to requests from multiple origins (or
-     indeed, all origins), then the value should be derived from the
-     client's handshake, specifically from the &quot;&lt;code title=http-origin&gt;Origin&lt;/code&gt;&quot; field. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;Either null, or a string representing the subprotocol the
-     server is ready to use. If the server supports multiple
-     subprotocols, then the value should be derived from the client's
-     handshake, specifically from the &quot;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;&quot;
-     field. The absence of such a field is equivalent to the null
-     value. The empty string is not the same as the null value for
-     these purposes.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The value of the &quot;&lt;code title=http-sec-websocket-key1&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key1&lt;/a&gt;&lt;/code&gt;&quot;
-     field in the client's handshake.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The value of the &quot;&lt;code title=http-sec-websocket-key2&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key2&lt;/a&gt;&lt;/code&gt;&quot;
-     field in the client's handshake.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;3&lt;/sub&gt;&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The eight random bytes sent after the first 0x0D 0x0A 0x0D
-     0x0A sequence in the client's handshake.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; be the string that results
-    from &lt;a href=#construct-a-websocket-url title=&quot;construct a WebSocket URL&quot;&gt;constructing a
-    WebSocket URL&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure flag&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; be the digits (characters
-    in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9)) in
-    &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, interpreted as a base ten integer,
-    ignoring all other characters in &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; be the digits (characters
-    in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9)) in
-    &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, interpreted as a base ten integer,
-    ignoring all other characters in &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;If either &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;
-    or &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; is greater
-    than 4,294,967,295, then &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
-    connection&lt;/a&gt;. This is a symptom of an attack.&lt;/p&gt;
-
-    &lt;p class=note&gt;If the client is a conforming client, then both
-    &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; will fit in
-    unsigned 32-bit integers.&lt;/p&gt;
-
-    &lt;div class=example&gt;
-
-     &lt;p&gt;For example, assume that the client handshake was:&lt;/p&gt;
-
-     &lt;pre&gt;GET / HTTP/1.1
-Connection: Upgrade
-Host: example.com
-Upgrade: WebSocket
-Sec-WebSocket-Key1: 3e6b263&nbsp;&nbsp;4&nbsp;17&nbsp;80
-Origin: <A HREF="http://example.com">http://example.com</A>
-Sec-WebSocket-Key2: 17&nbsp;&nbsp;9&nbsp;G`ZD9&nbsp;&nbsp;&nbsp;2&nbsp;2b&nbsp;7X&nbsp;3&nbsp;/r90
-
-WjN}|M(6&lt;/pre&gt;
-
-     &lt;p&gt;The &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; would be the number
-     3,626,341,780, and the &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; would be
-     the number 1,799,227,390.&lt;/p&gt;
-
-     &lt;p&gt;In this example, incidentally, &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;3&lt;/sub&gt;&lt;/var&gt; is
-     &quot;WjN}|M(6&quot;, or 0x57 0x6A 0x4E 0x7D 0x7C 0x4D 0x28 0x36.&lt;/p&gt;
-
-    &lt;/div&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; be the number of U+0020 SPACE
-    characters in &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; be the number of U+0020 SPACE
-    characters in &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;If either &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; or
-    &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; is zero, then
-    &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket connection&lt;/a&gt;. This is a symptom of
-    a cross-protocol attack.&lt;/p&gt;
-
-    &lt;p class=note&gt;If the client is a conforming client, then both
-    &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; will easily fit in
-    unsigned 32-bit integers (indeed, they won't be greater than
-    12).&lt;/p&gt;
-
-    &lt;p class=example&gt;In the example above, &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; would be 4 and &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;
-    would be 10.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; is not an integral multiple
-    of &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, then &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
-    connection&lt;/a&gt;.&lt;/p&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; is not an integral multiple
-    of &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, then &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
-    connection&lt;/a&gt;.&lt;/p&gt;
-
-    &lt;p class=note&gt;This can only happen if the client is not a
-    conforming WebSocket client.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; divided by &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; divided by &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=example&gt;In the example above, &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;
-    would be 906,585,445 and &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; would be
-    179,922,739.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; be the concatenation of &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed as a
-    big-endian unsigned 32-bit integer, &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, expressed as a big-endian unsigned 32-bit
-    integer, and the eight bytes of &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;3&lt;/sub&gt;&lt;/var&gt; in the order they were sent on the
-    wire.&lt;/p&gt;
-
-    &lt;!--
-    perl -e 'foreach (@ARGV) { print pack 'N', $_ }' 906585445 179922739 | hexdump -C
-    --&gt;
-
-    &lt;p class=example&gt;In the example above, this would be the 16
-    bytes 0x36 0x09 0x65 0x65 0x0A 0xB9 0x67 0x33 0x57 0x6A 0x4E 0x7D
-    0x7C 0x4D 0x28 0x36.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;response&lt;/var&gt; be the MD5 fingerprint of &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; as a big-endian 128 bit string. &lt;a href=#refsRFC1321&gt;[RFC1321]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;!--
-    perl -e &quot;print pack 'c*', map { hex } @ARGV&quot; 0x36 0x09 0x65 0x65 0x0A 0xB9 0x67 0x33 0x57 0x6A 0x4E 0x7D 0x7C 0x4D 0x28 0x36 | md5sum -b
-    --&gt;
-
-    &lt;p class=example&gt;In the example above, this would be the 16
-    bytes 0x6E 0x60 0x39 0x65 0x42 0x6B 0x39 0x7A 0x24 0x52 0x38 0x70
-    0x4F 0x74 0x56 0x62, or &quot;n`9eBk9z$R8pOtVb&quot; in UTF-8.
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send the following line, terminated by the two characters
-    U+000D CARRIAGE RETURN and U+000A LINE FEED (CRLF) and encoded as
-    UTF-8, to the client:&lt;/p&gt;
-
-    &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake&lt;/pre&gt;
-
-    &lt;p&gt;This line may be sent differently if necessary, but must match
-    the Status-Line production defined in the HTTP specification, with
-    the Status-Code having the value 101.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send the following fields to the client. Each field must be
-    sent as a line consisting of the field name, which must be an
-    &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the field name in
-    the list below, followed by a U+003A COLON character (:) and a
-    U+0020 SPACE character, followed by the field value as specified
-    in the list below, followed by the two characters U+000D CARRIAGE
-    RETURN and U+000A LINE FEED (CRLF). The lines must be encoded as
-    UTF-8. The lines may be sent in any order.&lt;/p&gt;
-
-    &lt;dl&gt;&lt;dt&gt;&lt;code title=http-upgrade&gt;Upgrade&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The value must be the string &quot;WebSocket&quot;.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;code title=http-connection&gt;Connection&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The value must be the string &quot;Upgrade&quot;.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;Sec-WebSocket-Location&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The value must be &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;Sec-WebSocket-Origin&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The value must be &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;This field must be included if &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is not null, and must not be included
-      if &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is null.&lt;/p&gt;
-
-      &lt;p&gt;If included, the value must be &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;p&gt;Optionally, include &quot;&lt;code title=http-setcookie&gt;Set-Cookie&lt;/code&gt;&quot;, &quot;&lt;code title=http-setcookie2&gt;Set-Cookie2&lt;/code&gt;&quot;, or other
-    cookie-related fields, with values equal to the values that would
-    be used for the identically named HTTP headers.
-     &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt;
-
-    &lt;/p&gt;
-
-    &lt;!--UAS: optionally, include 'Server:' field --&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send two bytes 0x0D 0x0A (UTF-8 CRLF).&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send &lt;var title=&quot;&quot;&gt;response&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;This completes the server's handshake. If the server finishes
-  these steps without &lt;a href=#abort-the-websocket-connection title=&quot;abort the WebSocket
-  connection&quot;&gt;aborting the WebSocket connection&lt;/a&gt;, and if the
-  client does not then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt;,
-  then the connection is established and the server may begin and
-  receiving sending data, as described in the next section.&lt;/p&gt;
-
-
-
-  &lt;h6 id=ws-sd-framing&gt;&lt;span class=secno&gt;10.3.4.5.3 &lt;/span&gt;Data framing&lt;/h6&gt;
-
-  &lt;p&gt;The server must run through the following steps to process the
-  bytes sent by the client. If at any point during these steps a read
-  is attempted but fails because the &lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
-  closed&lt;/a&gt;, then abort.&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;
-
-    &lt;p&gt;Try to read a byte from the client. Let &lt;var title=&quot;&quot;&gt;frame
-    type&lt;/var&gt; be that byte.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read eight more bytes from the client. Let &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; be the result of interpreting those
-    eight bytes as a big-endian 64 bit unsigned integer.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; bytes from the
-    client. Let &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; be those bytes.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; is greater than the length
-    of data the server is able to deal with at this time, the server
-    may abort these steps and either immediately disconnect from the
-    client or set the &lt;var title=&quot;&quot;&gt;client terminated&lt;/var&gt;
-    flag. Alternatively, the server may just discard this frame and
-    jump back to the first step.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Handle the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte as follows:&lt;/p&gt;
-
-    &lt;dl&gt;&lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is 0x00 and the &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; is 0&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;Set the &lt;var title=&quot;&quot;&gt;client terminated&lt;/var&gt; flag and abort
-      these steps. All further data sent by the client should be
-      discarded.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is 0xFF&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;Interpret &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; as a UTF-8 string, and
-      apply whatever server-specific processing is to occur for the
-      resulting string (the message from the client).&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;The server may abort these steps and either immediately
-      disconnect from the client or set the &lt;var title=&quot;&quot;&gt;client
-      terminated&lt;/var&gt; flag.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return to the first step to read the next byte.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The server must run through the following steps to send strings
-  to the client:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Encode the text using UTF-8 to obtain the byte stream &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send a 0xFF byte to the client.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send the number of bytes in &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt;, as
-   a 64 bit big-endian unsigned integer, to the client.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; to the client.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;At any time, the server may decide to terminate the WebSocket
-  connection by running through the following steps. These steps
-  should be run when the &lt;var title=&quot;&quot;&gt;client terminated&lt;/var&gt; flag is
-  set, if they aren't already running.&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Send nine 0x00 bytes to the client to indicate the start of
-   the closing handshake.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Wait until the &lt;var title=&quot;&quot;&gt;client terminated&lt;/var&gt; flag
-   has been set, or until a server-defined timeout expires.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;a href=#close-the-websocket-connection&gt;Close the WebSocket connection&lt;/a&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;Once these steps have started, the server must not send any
-  further data to the client. The nine 0x00 bytes indicate the end of
-  the server's data, and further bytes will be discarded by the
-  client.&lt;/p&gt;
-
-
-  &lt;h6 id=handling-errors-in-utf-8-from-the-client&gt;&lt;span class=secno&gt;10.3.4.5.4 &lt;/span&gt;Handling errors in UTF-8 from the client&lt;/h6&gt;
-
-  &lt;p&gt;When a server is to interpret a byte stream as UTF-8 but finds
-  that the byte stream is not in fact a valid UTF-8 stream, behavior
-  is undefined. A server could close the connection, convert invalid
-  byte sequences to U+FFFD REPLACEMENT CHARACTERs, store the data
-  verbatim, or perform application-specific processing. Subprotocols
-  layered on the WebSocket protocol might define specific behavior
-  for servers.&lt;/p&gt;
-
-
-
-  &lt;h5 id=closing-the-connection&gt;&lt;span class=secno&gt;10.3.4.6 &lt;/span&gt;Closing the connection&lt;/h5&gt;
-
-  &lt;h6 id=client-initiated-closure&gt;&lt;span class=secno&gt;10.3.4.6.1 &lt;/span&gt;Client-initiated closure&lt;/h6&gt;
-
-  &lt;p&gt;Certain algorithms require the user agent to &lt;dfn id=fail-the-websocket-connection&gt;fail the
-  WebSocket connection&lt;/dfn&gt;. To do so, the user agent must
-  &lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt;, and may report the
-  problem to the user (which would be especially useful for
-  developers).&lt;/p&gt;
-
-  &lt;p&gt;Except as indicated above or as specified by the application
-  layer (e.g. a script using the WebSocket API), user agents should
-  not close the connection.&lt;/p&gt;
-
-  &lt;p&gt;User agents must not convey any failure information to scripts in
-  a way that would allow a script to distinguish the following
-  situations:&lt;/p&gt;
-
-  &lt;ul&gt;&lt;li&gt;A server whose host name could not be resolved.&lt;/li&gt;
-
-   &lt;li&gt;A server to which packets could not successfully be
-   routed.&lt;/li&gt;
-
-   &lt;li&gt;A server that refused the connection on the specified
-   port.&lt;/li&gt;
-
-   &lt;li&gt;A server that did not complete the opening handshake
-   (e.g. because it was not a WebSocket server).&lt;/li&gt;
-
-   &lt;li&gt;A WebSocket server that sent a correct opening handshake, but
-   that specified options that caused the client to drop the
-   connection (e.g. the server specified an origin that differed from
-   the script's).&lt;/li&gt;
-
-   &lt;li&gt;A WebSocket server that abruptly closed the connection after
-   successfully completing the opening handshake.&lt;/li&gt;
-
-  &lt;/ul&gt;&lt;h6 id=server-initiated-closure&gt;&lt;span class=secno&gt;10.3.4.6.2 &lt;/span&gt;Server-initiated closure&lt;/h6&gt;
-
-  &lt;p&gt;Certain algorithms require or recommend that the server
-  &lt;dfn id=abort-the-websocket-connection&gt;abort the WebSocket connection&lt;/dfn&gt; during the opening
-  handshake. To do so, the server must simply &lt;a href=#close-the-websocket-connection&gt;close the
-  WebSocket connection&lt;/a&gt;.&lt;/p&gt;
-
-
-  &lt;h6 id=closure&gt;&lt;span class=secno&gt;10.3.4.6.3 &lt;/span&gt;Closure&lt;/h6&gt;
-
-  &lt;p&gt;To &lt;dfn id=close-the-websocket-connection&gt;close the WebSocket connection&lt;/dfn&gt;, the user agent or
-  server must close the TCP connection, using whatever mechanism
-  possible (e.g. either the TCP RST or FIN mechanisms). When a user
-  agent notices that the server has closed its connection, it must
-  immediately close its side of the connection also. Whether the user
-  agent or the server closes the connection first, it is said that the
-  &lt;dfn id=websocket-connection-is-closed&gt;WebSocket connection is closed&lt;/dfn&gt;. If the connection was
-  closed after the client &lt;a href=#the-websocket-closing-handshake-has-finished title=&quot;the WebSocket closing handshake
-  has finished&quot;&gt;finished the WebSocket closing handshake&lt;/a&gt;, then
-  the WebSocket connection is said to have been closed &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;.&lt;/p&gt;
-
-  &lt;p&gt;Servers may &lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt; whenever
-  desired. User agents should not &lt;a href=#close-the-websocket-connection&gt;close the WebSocket
-  connection&lt;/a&gt; arbitrarily.&lt;/p&gt;
-
-
-  &lt;h5 id=security-considerations&gt;&lt;span class=secno&gt;10.3.4.7 &lt;/span&gt;Security considerations&lt;/h5&gt;
-
-  &lt;p&gt;While this protocol is intended to be used by scripts in Web
-  pages, it can also be used directly by hosts. Such hosts are acting
-  on their own behalf, and can therefore send fake &quot;Origin&quot; fields,
-  misleading the server. Servers should therefore be careful about
-  assuming that they are talking directly to scripts from known
-  origins, and must consider that they might be accessed in unexpected
-  ways. In particular, a server should not trust that any input is
-  valid.&lt;/p&gt;
-
-  &lt;p class=example&gt;For example, if the server uses input as part of
-  SQL queries, all input text should be escaped before being passed to
-  the SQL server, lest the server be susceptible to SQL injection.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;p&gt;Servers that are not intended to process input from any Web page
-  but only for certain sites should verify the &quot;Origin&quot; field is an
-  origin they expect, and should only respond with the corresponding
-  &quot;Sec-WebSocket-Origin&quot; if it is an accepted origin. Servers that
-  only accept input from one origin can just send back that value in
-  the &quot;Sec-WebSocket-Origin&quot; field, without bothering to check the
-  client's value.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;p&gt;If at any time a server is faced with data that it does not
-  understand, or that violates some criteria by which the server
-  determines safety of input, or when the server sees a handshake that
-  does not correspond to the values the server is expecting
-  (e.g. incorrect path or origin), the server should just
-  disconnect. It is always safe to disconnect.&lt;/p&gt;
-
-  &lt;hr&gt;&lt;p&gt;The biggest security risk when sending text data using this
-  protocol is sending data using the wrong encoding. If an attacker
-  can trick the server into sending data encoded as ISO-8859-1
-  verbatim (for instance), rather than encoded as UTF-8, then the
-  attacker could inject arbitrary frames into the data stream.&lt;/p&gt;
-
-
-  &lt;h5 id=iana-considerations-0&gt;&lt;span class=secno&gt;10.3.4.8 &lt;/span&gt;IANA considerations&lt;/h5&gt;
-
-  &lt;h6 id=registration-of-ws:-scheme&gt;&lt;span class=secno&gt;10.3.4.8.1 &lt;/span&gt;Registration of &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; scheme&lt;/h6&gt;
-
-  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; URL identifies a WebSocket server
-  and resource name.&lt;/p&gt;
-
-  &lt;dl&gt;&lt;dt&gt;URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;ws&lt;/dd&gt;
-
-   &lt;dt&gt;Status.&lt;/dt&gt;
-   &lt;dd&gt;Permanent.&lt;/dd&gt;
-
-   &lt;dt&gt;URI scheme syntax.&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;In ABNF terms using the terminals from the URI specifications:
-    &lt;a href=#refsABNF&gt;[ABNF]&lt;/a&gt;
-
-    &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;
-    &lt;/p&gt;
-    &lt;pre&gt;&quot;ws&quot; &quot;:&quot; hier-part [ &quot;?&quot; query ]&lt;/pre&gt;
-    &lt;p&gt;The path and query components form the resource name sent to
-    the server to identify the kind of service desired. Other
-    components have the meanings described in RFC3986.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;URI scheme semantics.&lt;/dt&gt;
-   &lt;dd&gt;The only operation for this scheme is to open a connection
-   using the WebSocket protocol.&lt;/dd&gt;
-
-   &lt;dt&gt;Encoding considerations.&lt;/dt&gt;
-   &lt;dd&gt;
-
-    &lt;p&gt;Characters in the host component that are excluded by the
-    syntax defined above must be converted from Unicode to ASCII by
-    applying the IDNA ToASCII algorithm to the Unicode host name, with
-    both the AllowUnassigned and UseSTD3ASCIIRules flags set, and
-    using the result of this algorithm as the host in the URI. &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Characters in other components that are excluded by the syntax
-    defined above must be converted from Unicode to ASCII by first
-    encoding the characters as UTF-8 and then replacing the
-    corresponding bytes using their percent-encoded form as defined in
-    the URI and IRI specification. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;Applications/protocols that use this URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;WebSocket protocol.&lt;/dd&gt;
-
-   &lt;dt&gt;Interoperability considerations.&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-
-   &lt;dt&gt;Security considerations.&lt;/dt&gt;
-   &lt;dd&gt;See &quot;Security considerations&quot; section above.&lt;/dd&gt;
-
-   &lt;dt&gt;Contact.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;Author/Change controller.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;References.&lt;/dt&gt;
-   &lt;dd&gt;This document.&lt;/dd&gt;
-
-  &lt;/dl&gt;&lt;h6 id=registration-of-wss:-scheme&gt;&lt;span class=secno&gt;10.3.4.8.2 &lt;/span&gt;Registration of &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; scheme&lt;/h6&gt;
-
-  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; URL identifies a WebSocket server
-  and resource name, and indicates that traffic over that connection
-  is to be encrypted.&lt;/p&gt;
-
-  &lt;dl&gt;&lt;dt&gt;URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;wss&lt;/dd&gt;
-
-   &lt;dt&gt;Status.&lt;/dt&gt;
-   &lt;dd&gt;Permanent.&lt;/dd&gt;
-
-   &lt;dt&gt;URI scheme syntax.&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;In ABNF terms using the terminals from the URI specifications:
-    &lt;a href=#refsABNF&gt;[ABNF]&lt;/a&gt;
-
-    &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-    &lt;pre&gt;&quot;wss&quot; &quot;:&quot; hier-part [ &quot;?&quot; query ]&lt;/pre&gt;
-    &lt;p&gt;The path and query components form the resource name sent to
-    the server to identify the kind of service desired. Other
-    components have the meanings described in RFC3986.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;URI scheme semantics.&lt;/dt&gt;
-   &lt;dd&gt;The only operation for this scheme is to open a connection
-   using the WebSocket protocol, encrypted using TLS.&lt;/dd&gt;
-
-   &lt;dt&gt;Encoding considerations.&lt;/dt&gt;
-   &lt;dd&gt;
-
-    &lt;p&gt;Characters in the host component that are excluded by the
-    syntax defined above must be converted from Unicode to ASCII by
-    applying the IDNA ToASCII algorithm to the Unicode host name, with
-    both the AllowUnassigned and UseSTD3ASCIIRules flags set, and
-    using the result of this algorithm as the host in the URI. &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Characters in other components that are excluded by the syntax
-    defined above must be converted from Unicode to ASCII by first
-    encoding the characters as UTF-8 and then replacing the
-    corresponding bytes using their percent-encoded form as defined in
-    the URI and IRI specification. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;Applications/protocols that use this URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;WebSocket protocol over TLS.&lt;/dd&gt;
-
-   &lt;dt&gt;Interoperability considerations.&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-
-   &lt;dt&gt;Security considerations.&lt;/dt&gt;
-   &lt;dd&gt;See &quot;Security considerations&quot; section above.&lt;/dd&gt;
-
-   &lt;dt&gt;Contact.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;Author/Change controller.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;References.&lt;/dt&gt;
-   &lt;dd&gt;This document.&lt;/dd&gt;
-
-  &lt;/dl&gt;&lt;h6 id=registration-of-the-websocket-http-upgrade-keyword&gt;&lt;span class=secno&gt;10.3.4.8.3 &lt;/span&gt;Registration of the &quot;&lt;code title=&quot;&quot;&gt;WebSocket&lt;/code&gt;&quot; HTTP Upgrade keyword&lt;/h6&gt;
-
-  &lt;dl&gt;&lt;dt&gt;Name of token.&lt;/dt&gt;
-   &lt;dd&gt;WebSocket&lt;/dd&gt;
-
-   &lt;dt&gt;Author/Change controller.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;Contact.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;References.&lt;/dt&gt;
-   &lt;dd&gt;This document.&lt;/dd&gt;
-
-  &lt;/dl&gt;&lt;h6 id=sec-websocket-key1-and-sec-websocket-key2&gt;&lt;span class=secno&gt;10.3.4.8.4 &lt;/span&gt;&lt;dfn title=http-sec-websocket-key1&gt;&lt;code&gt;Sec-WebSocket-Key1&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn title=http-sec-websocket-key2&gt;&lt;code&gt;Sec-WebSocket-Key2&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
-
-  &lt;p&gt;This section describes two header fields for registration in the
-  Permanent Message Header Field Registry.  &lt;a href=#refsRFC3864&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Key1&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;&lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Key2&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;&lt;p&gt;The &lt;code title=http-sec-websocket-key1&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key1&lt;/a&gt;&lt;/code&gt; and &lt;code title=http-sec-websocket-key2&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key2&lt;/a&gt;&lt;/code&gt; headers
-  are used in the WebSocket handshake. They are sent from the client
-  to the server to provide part of the information used by the server
-  to prove that it received a valid WebSocket handshake. This helps
-  ensure that the server does not accept connections from
-  non-Web-Socket clients (e.g. HTTP clients) that are being abused to
-  send data to unsuspecting WebSocket servers.&lt;/p&gt;
-
-
-  &lt;h6 id=sec-websocket-location&gt;&lt;span class=secno&gt;10.3.4.8.5 &lt;/span&gt;&lt;dfn title=http-sec-websocket-location&gt;&lt;code&gt;Sec-WebSocket-Location&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
-
-  &lt;p&gt;This section describes a header field for registration in the
-  Permanent Message Header Field Registry.  &lt;a href=#refsRFC3864&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Location&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;&lt;p&gt;The &lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;Sec-WebSocket-Location&lt;/a&gt;&lt;/code&gt;
-  header is used in the WebSocket handshake. It is sent from the
-  server to the client to confirm the &lt;a href=#url&gt;URL&lt;/a&gt; of the
-  connection. This enables the client to verify that the connection
-  was established to the right server, port, and path, instead of
-  relying on the server to verify that the requested host, port, and
-  path are correct.&lt;/p&gt;
-
-
-  &lt;h6 id=sec-websocket-origin&gt;&lt;span class=secno&gt;10.3.4.8.6 &lt;/span&gt;&lt;dfn title=http-sec-websocket-origin&gt;&lt;code&gt;Sec-WebSocket-Origin&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
-
-  &lt;p&gt;This section describes a header field for registration in the
-  Permanent Message Header Field Registry.  &lt;a href=#refsRFC3864&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Origin&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;&lt;p&gt;The &lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;Sec-WebSocket-Origin&lt;/a&gt;&lt;/code&gt; header
-  is used in the WebSocket handshake. It is sent from the server to
-  the client to confirm the &lt;a href=#origin&gt;origin&lt;/a&gt; of the script that
-  opened the connection. This enables user agents to verify that the
-  server is willing to serve the script that opened the
-  connection.&lt;/p&gt;
-
-
-  &lt;h6 id=sec-websocket-protocol&gt;&lt;span class=secno&gt;10.3.4.8.7 &lt;/span&gt;&lt;dfn title=http-sec-websocket-protocol&gt;&lt;code&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
-
-  &lt;p&gt;This section describes a header field for registration in the
-  Permanent Message Header Field Registry.  &lt;a href=#refsRFC3864&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Protocol&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;&lt;p&gt;The &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;
-  header is used in the WebSocket handshake. It is sent from the
-  client to the server and back from the server to the client to
-  confirm the subprotocol of the connection. This enables scripts to
-  both select a subprotocol and be sure that the server agreed to
-  serve that subprotocol.&lt;/p&gt;
-
-
-
-
-  &lt;h5 id=using-the-websocket-protocol-from-other-specifications&gt;&lt;span class=secno&gt;10.3.4.9 &lt;/span&gt;Using the WebSocket protocol from other specifications&lt;/h5&gt;
-
-  &lt;p&gt;The WebSocket protocol is intended to be used by another
-  specification to provide a generic mechanism for dynamic
-  author-defined content, e.g. in a specification defining a scripted
-  API.&lt;/p&gt;
-
-  &lt;p&gt;Such a specification first needs to &quot;&lt;a href=#establish-a-websocket-connection&gt;establish a WebSocket
-  connection&lt;/a&gt;&quot;, providing that algorithm with:&lt;/p&gt;
-
-  &lt;ul&gt;&lt;li&gt;The destination, consisting of a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and a
-   &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, which allows for multiple
-   services to be identified at one host and port.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag, which is true if the
-   connection is to be encrypted, and false otherwise.&lt;/li&gt;
-
-   &lt;li&gt;An &lt;a href=#ascii-serialization-of-an-origin&gt;ASCII serialization of an origin&lt;/a&gt; that is being
-   made responsible for the connection. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;Optionally a string identifying a &lt;span&gt;protocol&lt;/span&gt; that is
-   to be layered over the WebSocket connection.&lt;/li&gt;
-
-  &lt;/ul&gt;&lt;p&gt;The &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag
-  are usually obtained from a &lt;a href=#url&gt;URL&lt;/a&gt; using the steps to
-  &lt;a href=&quot;#parse-a-websocket-url's-components&quot;&gt;parse a WebSocket URL's components&lt;/a&gt;. These steps fail
-  if the URL does not specify a WebSocket.&lt;/p&gt;
-
-  &lt;p&gt;If a connection can be established, then it is said that the
-  &quot;&lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;&quot;.&lt;/p&gt;
-
-  &lt;p&gt;If at any time the connection is to be closed, then the
-  specification needs to use the &quot;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket
-  connection&lt;/a&gt;&quot; algorithm.&lt;/p&gt;
-
-  &lt;p&gt;When the connection is closed, for any reason including failure
-  to establish the connection in the first place, it is said that the
-  &quot;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is closed&lt;/a&gt;&quot;.&lt;/p&gt;
-
-  &lt;p&gt;While a connection is open, the specification will need to handle
-  the cases when &quot;&lt;a href=#a-websocket-message-has-been-received&gt;a WebSocket message has been received&lt;/a&gt;&quot;
-  with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;.&lt;/p&gt;
-
-  &lt;p&gt;To send some text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; to an open connection,
-  the specification needs to &quot;&lt;a href=#send-data-using-the-websocket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;
-  using the WebSocket&lt;/a&gt;&quot;.&lt;/p&gt;
-
-
   
 
-  &lt;/div&gt;&lt;!--data-component--&gt;
 
 
 
-
   &lt;div data-component=&quot;Web Messaging (editor: Ian Hickson)&quot;&gt;
 
   
@@ -76293,7 +73474,7 @@
   &lt;/div&gt;
 
 
-  &lt;h4 id=introduction-9&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-8&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
@@ -76518,7 +73699,7 @@
 
   &lt;h3 id=channel-messaging&gt;&lt;span class=secno&gt;10.5 &lt;/span&gt;&lt;dfn&gt;Channel messaging&lt;/dfn&gt;&lt;/h3&gt;
 
-  &lt;h4 id=introduction-10&gt;&lt;span class=secno&gt;10.5.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-9&gt;&lt;span class=secno&gt;10.5.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
@@ -76968,7 +74149,7 @@
 
 
 
-  &lt;h3 id=introduction-11&gt;&lt;span class=secno&gt;11.1 &lt;/span&gt;Introduction&lt;/h3&gt;
+  &lt;h3 id=introduction-10&gt;&lt;span class=secno&gt;11.1 &lt;/span&gt;Introduction&lt;/h3&gt;
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
@@ -86829,7 +84010,7 @@
   lead to this experience.&lt;/i&gt;&lt;/p&gt;
 
 
-  &lt;h3 id=introduction-12&gt;&lt;span class=secno&gt;14.1 &lt;/span&gt;Introduction&lt;/h3&gt;
+  &lt;h3 id=introduction-11&gt;&lt;span class=secno&gt;14.1 &lt;/span&gt;Introduction&lt;/h3&gt;
 
   &lt;p&gt;In general, user agents are expected to support CSS, and many of
   the suggestions in this section are expressed in CSS terms. User
@@ -86867,7 +84048,7 @@
 
   &lt;h3 id=the-css-user-agent-style-sheet-and-presentational-hints&gt;&lt;span class=secno&gt;14.2 &lt;/span&gt;The CSS user agent style sheet and presentational hints&lt;/h3&gt;
 
-  &lt;h4 id=introduction-13&gt;&lt;span class=secno&gt;14.2.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-12&gt;&lt;span class=secno&gt;14.2.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;The CSS rules given in these subsections are, except where
   otherwise specified, expected to be used as part of the user-agent
@@ -88998,7 +86179,7 @@
 
   &lt;h3 id=bindings&gt;&lt;span class=secno&gt;14.4 &lt;/span&gt;Bindings&lt;/h3&gt;
 
-  &lt;h4 id=introduction-14&gt;&lt;span class=secno&gt;14.4.1 &lt;/span&gt;Introduction&lt;/h4&gt;
+  &lt;h4 id=introduction-13&gt;&lt;span class=secno&gt;14.4.1 &lt;/span&gt;Introduction&lt;/h4&gt;
 
   &lt;p&gt;A number of elements have their rendering defined in terms of the
   'binding' property. &lt;a href=#refsBECSS&gt;[BECSS]&lt;/a&gt;&lt;/p&gt;
@@ -95291,11 +92472,6 @@
    &lt;dd&gt;(Non-normative) &lt;cite&gt;&lt;a href=<A HREF="https://developer.mozilla.org/en/Gecko_Plugin_API_Reference">https://developer.mozilla.org/en/Gecko_Plugin_API_Reference</A>&gt;Gecko
    Plugin API Reference&lt;/a&gt;&lt;/cite&gt;. Mozilla.&lt;/dd&gt;
 
-   &lt;dt id=refsNPN&gt;[NPN]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/draft-agl-tls-nextprotoneg">http://tools.ietf.org/html/draft-agl-tls-nextprotoneg</A>&gt;Transport
-   Layer Security (TLS) Next Protocol Negotiation
-   Extension&lt;/a&gt;&lt;/cite&gt;, A. Langley. IETF.&lt;/dd&gt;
-
    &lt;dt id=refsOPENSEARCH&gt;[OPENSEARCH]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.opensearch.org/Specifications/OpenSearch/1.1#Autodiscovery_in_HTML.2FXHTML">http://www.opensearch.org/Specifications/OpenSearch/1.1#Autodiscovery_in_HTML.2FXHTML</A>&gt;Autodiscovery
    in HTML/XHTML&lt;/a&gt;&lt;/cite&gt;. In &lt;cite&gt;OpenSearch 1.1 Draft 4&lt;/cite&gt;,
@@ -95342,10 +92518,6 @@
    Names - Concepts and Facilities&lt;/a&gt;&lt;/cite&gt;, P. Mockapetris. IETF,
    November 1987.&lt;/dd&gt;
 
-   &lt;dt id=refsRFC1321&gt;[RFC1321]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc1321.txt">http://www.ietf.org/rfc/rfc1321.txt</A>&gt;The MD5
-   Message-Digest Algorithm&lt;/a&gt;&lt;/cite&gt;, R. Rivest. IETF.&lt;/dd&gt;
-
    &lt;dt id=refsRFC1345&gt;[RFC1345]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc1345.txt">http://www.ietf.org/rfc/rfc1345.txt</A>&gt;Character Mnemonics
    and Character Sets&lt;/a&gt;&lt;/cite&gt;, K. Simonsen. IETF.&lt;/dd&gt;
@@ -95394,10 +92566,6 @@
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc2237.txt">http://www.ietf.org/rfc/rfc2237.txt</A>&gt;Japanese Character
    Encoding for Internet Messages&lt;/a&gt;&lt;/cite&gt;, K. Tamaru. IETF.&lt;/dd&gt;
 
-   &lt;dt id=refsRFC2246&gt;[RFC2246]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc2246.txt">http://www.ietf.org/rfc/rfc2246.txt</A>&gt;The TLS Protocol
-   Version 1.0&lt;/a&gt;&lt;/cite&gt;, T. Dierks, C. Allen. IETF.&lt;/dd&gt;
-
    &lt;dt id=refsRFC2313&gt;[RFC2313]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc2313.txt">http://www.ietf.org/rfc/rfc2313.txt</A>&gt;PKCS #1:
    RSA Encryption&lt;/a&gt;&lt;/cite&gt;, B. Kaliski. IETF.&lt;/dd&gt;
@@ -95482,11 +92650,6 @@
    &lt;dd&gt;(Non-normative) &lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc4329.txt">http://www.ietf.org/rfc/rfc4329.txt</A>&gt;Scripting Media
    Types&lt;/a&gt;&lt;/cite&gt;, B. H&ouml;hrmann. IETF.&lt;/dd&gt;
 
-   &lt;dt id=refsRFC4366&gt;[RFC4366]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc4366.txt">http://www.ietf.org/rfc/rfc4366.txt</A>&gt;Transport
-   Layer Security (TLS) Extensions&lt;/a&gt;&lt;/cite&gt;, S. Blake-Wilson,
-   M. Nystrom, D. Hopwood, J. Mikkelsen, T. Wright. IETF.&lt;/dd&gt;
-
    &lt;dt id=refsRFC4770&gt;[RFC4770]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc4770.txt">http://www.ietf.org/rfc/rfc4770.txt</A>&gt;vCard Extensions for
    Instant Messaging (IM)&lt;/a&gt;&lt;/cite&gt;, C. Jennings, J. Reschke. IETF.&lt;/dd&gt;
@@ -95574,11 +92737,6 @@
    Guidelines (WCAG) 2.0&lt;/a&gt;&lt;/cite&gt;, B. Caldwell, M. Cooper, L. Reid,
    G. Vanderheiden. W3C.&lt;/dd&gt;
 
-   &lt;dt id=refsWEBADDRESSES&gt;[WEBADDRESSES]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.w3.org/html/wg/href/draft">http://www.w3.org/html/wg/href/draft</A>&gt;Web
-   addresses in HTML5&lt;/a&gt;&lt;/cite&gt;, D. Connolly,
-   C. Sperberg-McQueen.&lt;/dd&gt;
-
    &lt;dt id=refsWEBGL&gt;[WEBGL]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/doc/spec/WebGL-spec.html">https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/doc/spec/WebGL-spec.html</A>&gt;WebGL
    Specification&lt;/a&gt;&lt;/cite&gt;, C. Marrin. Khronos Group.&lt;/dd&gt;
@@ -95617,6 +92775,10 @@
    &lt;dt id=refsWIN949&gt;[WIN949]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.microsoft.com/globaldev/reference/dbcs/949.mspx">http://www.microsoft.com/globaldev/reference/dbcs/949.mspx</A>&gt;Windows Codepage 949&lt;/a&gt;&lt;/cite&gt;. Microsoft.&lt;/dd&gt;
 
+   &lt;dt id=refsWSP&gt;[WSP]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol">http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol</A>&gt;The
+   WebSocket protocol&lt;/a&gt;&lt;/cite&gt;, I. Fette. IETF.&lt;/dd&gt;
+
    &lt;dt id=refsX121&gt;[X121]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;Recommendation X.121 &mdash; International Numbering Plan for
    Public Data Networks&lt;/cite&gt;, CCITT Blue Book, Fascicle VIII.3,

Modified: index
===================================================================
--- index	2010-09-01 21:49:50 UTC (rev 5408)
+++ index	2010-09-02 10:00:31 UTC (rev 5409)
@@ -213,7 +213,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;HTML5 (including next generation additions still in development)&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 1 September 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 2 September 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -70096,11 +70096,9 @@
   &lt;/div&gt;
 
 
-  &lt;/div&gt;&lt;!--data-component--&gt;
 
 
 
-
   &lt;div data-component=&quot;Web Messaging (editor: Ian Hickson)&quot;&gt;
 
   
@@ -89638,4 +89636,4 @@
           hand corner.&quot; src=&quot;sample-datetime-ui-3&quot;&gt;&lt;/li&gt;
 --&gt;
 
- 
+ &lt;/div&gt;

Modified: source
===================================================================
--- source	2010-09-01 21:49:50 UTC (rev 5408)
+++ source	2010-09-02 10:00:31 UTC (rev 5409)
@@ -82243,7 +82243,7 @@
 
   &lt;div data-component=&quot;WebSocket API (editor: Ian Hickson)&quot;&gt;
 
-&lt;!--START websocket--&gt;&lt;!--START websocket-api--&gt;
+&lt;!--START websocket-api--&gt;
 
   &lt;h4 id=&quot;network-intro&quot;&gt;Introduction&lt;/h4&gt;
 
@@ -82307,15 +82307,12 @@
 
   &lt;ol&gt;
 
-   &lt;!-- beware, this is very similar to the steps for what happens
-   during a redirect, in the protocol section --&gt;
-
    &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from the
    &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain &lt;var
    title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
    title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;. If
    this fails, throw a &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception and abort
-   these steps.&lt;/p&gt;&lt;/li&gt;
+   these steps. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -82368,7 +82365,8 @@
     title=&quot;&quot;&gt;secure&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as
     the resource name, with &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; as the
     (possibly empty) list of protocols, and with the &lt;var
-    title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag set.&lt;/p&gt;
+    title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag set. &lt;a
+    href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;If the &quot;&lt;span&gt;establish a WebSocket
     connection&lt;/span&gt;&quot; algorithm fails, it triggers the &quot;&lt;span&gt;fail
@@ -82453,7 +82451,8 @@
   WebSocket connection&lt;/span&gt;. Any invokation of this method that does
   not raise an exception must increase the &lt;code
   title=&quot;dom-WebSocket-bufferedAmount&quot;&gt;bufferedAmount&lt;/code&gt; attribute
-  by the number of bytes needed to express the argument as UTF-8.&lt;/p&gt;
+  by the number of bytes needed to express the argument as UTF-8. &lt;a
+  href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-WebSocket-close&quot;&gt;&lt;code&gt;close()&lt;/code&gt;&lt;/dfn&gt;
   method must run the first matching steps from the following list:&lt;/p&gt;
@@ -82478,14 +82477,15 @@
 
 
    &lt;dt&gt;If the WebSocket connection is not yet &lt;span title=&quot;WebSocket
-   connection is established&quot;&gt;established&lt;/span&gt;&lt;/dt&gt;
+   connection is established&quot;&gt;established&lt;/span&gt; &lt;a
+   href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt; and set the &lt;code
     title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's
-    value to &lt;code title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt;
-    (2).&lt;/p&gt;
+    value to &lt;code title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2).
+    &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;The &quot;&lt;span&gt;fail the WebSocket connection&lt;/span&gt;&quot;
     algorithm invokes the &quot;&lt;span&gt;close the WebSocket
@@ -82499,14 +82499,15 @@
 
    &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;span
    title=&quot;the WebSocket closing handshake has
-   started&quot;&gt;started&lt;/span&gt;&lt;/dt&gt;
+   started&quot;&gt;started&lt;/span&gt; &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;&lt;span&gt;Start the WebSocket closing handshake&lt;/span&gt; and set the
     &lt;code title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt;
     attribute's value to &lt;code
-    title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2).&lt;/p&gt;
+    title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2). &lt;a
+    href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;The &quot;&lt;span&gt;start the WebSocket closing
     handshake&lt;/span&gt;&quot; algorithm eventually invokes the &quot;&lt;span&gt;close
@@ -82612,8 +82613,8 @@
   title=&quot;dom-WebSocket-protocol&quot;&gt;protocol&lt;/code&gt; attribute's value to
   the &lt;span&gt;selected WebSocket subprotocol&lt;/span&gt;, if there is one;
   and then &lt;span&gt;fire a simple event&lt;/span&gt; named &lt;code
-  title=&quot;event-open&quot;&gt;open&lt;/code&gt; at the &lt;code&gt;WebSocket&lt;/code&gt;
-  object.&lt;/p&gt;
+  title=&quot;event-open&quot;&gt;open&lt;/code&gt; at the &lt;code&gt;WebSocket&lt;/code&gt; object.
+  &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;When &lt;i&gt;a WebSocket message has been received&lt;/i&gt; with text &lt;var
   title=&quot;&quot;&gt;data&lt;/var&gt;, the user agent must create an event that uses
@@ -82625,7 +82626,8 @@
   if the &lt;code title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt;
   attribute's value is &lt;code title=&quot;dom-WebSocket-OPEN&quot;&gt;OPEN&lt;/code&gt;
   (1) or &lt;code title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2), and
-  if so, dispatch the event at the &lt;code&gt;WebSocket&lt;/code&gt; object.&lt;/p&gt;
+  if so, dispatch the event at the &lt;code&gt;WebSocket&lt;/code&gt; object. &lt;a
+  href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;When &lt;i&gt;a WebSocket error has been detected&lt;/i&gt;, the user agent
   must &lt;span&gt;queue a task&lt;/span&gt; to check to see if the &lt;code
@@ -82634,7 +82636,7 @@
   title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2), and if so,
   &lt;span&gt;fire a simple event&lt;/span&gt; named &lt;code
   title=&quot;event-error&quot;&gt;error&lt;/code&gt; at the &lt;code&gt;WebSocket&lt;/code&gt;
-  object.&lt;/p&gt;
+  object. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;When &lt;i&gt;the WebSocket closing handshake has started&lt;/i&gt;, the user
   agent must &lt;span&gt;queue a task&lt;/span&gt; to change the &lt;code
@@ -82644,7 +82646,7 @@
   the &lt;code title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt;
   attribute's value will already be set to &lt;code
   title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2) when this task
-  runs.)&lt;/p&gt;
+  runs.) &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p id=&quot;closeWebSocket&quot;&gt;When the &lt;i&gt;WebSocket connection is
   closed&lt;/i&gt;, possibly &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;, the user agent must
@@ -82656,7 +82658,8 @@
   false otherwise; and &lt;span&gt;queue a task&lt;/span&gt; to first change the
   &lt;code title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's
   value to &lt;code title=&quot;dom-WebSocket-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3), and
-  then dispatch the event at the &lt;code&gt;WebSocket&lt;/code&gt; object.&lt;/p&gt;
+  then dispatch the event at the &lt;code&gt;WebSocket&lt;/code&gt; object. &lt;a
+  href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;span&gt;task source&lt;/span&gt; for all &lt;span
   title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; &lt;span title=&quot;queue a
@@ -82711,3169 +82714,22 @@
   &lt;p&gt;A &lt;code&gt;WebSocket&lt;/code&gt; object with &lt;span title=&quot;WebSocket
   connection is established&quot;&gt;an established connection&lt;/span&gt; that has
   data queued to be transmitted to the network must not be garbage
-  collected.&lt;/p&gt;
+  collected. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;If a &lt;code&gt;WebSocket&lt;/code&gt; object is garbage collected while its
   connection is still open, the user agent must &lt;span&gt;close the
-  WebSocket connection&lt;/span&gt;.&lt;/p&gt;
+  WebSocket connection&lt;/span&gt;. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
 
   &lt;!--END websocket-api--&gt;
 
-  &lt;!--START websocket-protocol--&gt;
+  &lt;/div&gt;&lt;!--data-component--&gt;
 
-  &lt;h4 id=&quot;websocket-protocol&quot; title=&quot;The WebSocket protocol enables
-  two-way communication between a user agent running untrusted code
-  running in a controlled environment to a remote host that has
-  opted-in to communications from that code. The security model used
-  for this is the Origin-based security model commonly used by Web
-  browsers. The protocol consists of an initial handshake followed by
-  basic message framing, layered over TCP. The goal of this technology
-  is to provide a mechanism for browser-based applications that need
-  two-way communication with servers that does not rely on opening
-  multiple HTTP connections (e.g. using XMLHttpRequest or
-  &lt;iframe&gt;s and long polling).&quot;&gt;The WebSocket protocol&lt;/h4&gt;
-
-
-  &lt;h5&gt;Introduction&lt;/h5&gt;
-
-  &lt;h6&gt;Background&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;Historically, creating an instant messenger chat client as a Web
-  application has required an abuse of HTTP to poll the server for
-  updates while sending upstream notifications as distinct HTTP
-  calls.&lt;/p&gt;
-
-  &lt;p&gt;This results in a variety of problems:&lt;/p&gt;
-
-  &lt;ul&gt;
-
-   &lt;li&gt;The server is forced to use a number of different underlying
-   TCP connections for each client: one for sending information to the
-   client, and a new one for each incoming message.&lt;/li&gt;
-
-   &lt;li&gt;The wire protocol has a high overhead, with each
-   client-to-server message having an HTTP header.&lt;/li&gt;
-
-   &lt;li&gt;The client-side script is forced to maintain a mapping from the
-   outgoing connections to the incoming connection to track
-   replies.&lt;/li&gt;
-
-  &lt;/ul&gt;
-
-  &lt;p&gt;A simpler solution would be to use a single TCP connection for
-  traffic in both directions. This is what the WebSocket protocol
-  provides. Combined with the WebSocket API, it provides an
-  alternative to HTTP polling for two-way communication from a Web
-  page to a remote server.
-  &lt;!--END complete--&gt;&lt;!--END epub--&gt;
-  &lt;a href=&quot;#refsWSAPI&quot;&gt;[WSAPI]&lt;/a&gt;
-  &lt;!--START complete--&gt;&lt;!--START epub--&gt;
-  &lt;/p&gt;
-
-  &lt;p&gt;The same technique can be used for a variety of Web applications,
-  for instance games, stock tickers, multiuser applications with
-  simultaneous editing, and user interfaces exposing server-side
-  services in real time.&lt;/p&gt;
-
-
-
-  &lt;h6&gt;Protocol overview&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The protocol has two parts: a handshake, and then the data
-  transfer.&lt;/p&gt;
-
-  &lt;p&gt;The handshake from the client looks as follows:&lt;/p&gt;
-
-  &lt;pre&gt;GET /demo HTTP/1.1
-Host: example.com
-Connection: Upgrade
-Sec-WebSocket-Key2: 12998 5 Y3 1  .P00
-Sec-WebSocket-Protocol: sample
-Upgrade: WebSocket
-Sec-WebSocket-Key1: 4 @1  46546xW%0l 1 5
-Origin: <A HREF="http://example.com">http://example.com</A>
-
-^n:ds[4U&lt;/pre&gt;
-
-  &lt;p&gt;The handshake from the server looks as follows:&lt;/p&gt;
-
-  &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake
-Upgrade: WebSocket
-Connection: Upgrade
-Sec-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
-Sec-WebSocket-Location: <A HREF="ws://example.com/demo">ws://example.com/demo</A>
-Sec-WebSocket-Protocol: sample
-
-8jKS'y:G*Co,Wxa-&lt;/pre&gt;
-
-  &lt;p&gt;The leading line from the client follows the Request-Line
-  format. The leading line from the server follows the Status-Line
-  format. The Request-Line and Status-Line productions are defined in
-  the HTTP specification.&lt;/p&gt;
-
-  &lt;p&gt;After the leading line in both cases come an unordered
-  &lt;span&gt;ASCII case-insensitive&lt;/span&gt; set of fields, one per line,
-  that each match the following non-normative ABNF:
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-  &lt;a href=&quot;#refsRFC5234&quot;&gt;[RFC5234]&lt;/a&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;
-  &lt;a href=&quot;#refsABNF&quot;&gt;[ABNF]&lt;/a&gt;
-&lt;!--START websocket-protocol--&gt;
-  &lt;/p&gt;
-
-  &lt;pre&gt;field         = 1*name-char colon [ space ] *any-char cr lf
-colon         = %x003A ; U+003A COLON (:)
-space         = %x0020 ; U+0020 SPACE
-cr            = %x000D ; U+000D CARRIAGE RETURN (CR)
-lf            = %x000A ; U+000A LINE FEED (LF)
-name-char     = %x0000-0009 / %x000B-000C / %x000E-0039 / %x003B-10FFFF
-                ; a Unicode character other than U+000A LINE FEED (LF), U+000D CARRIAGE RETURN (CR), or U+003A COLON (:)
-any-char      = %x0000-0009 / %x000B-000C / %x000E-10FFFF
-                ; a Unicode character other than U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR)&lt;/pre&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The character set for the above ABNF is Unicode. The
-  fields themselves are encoded as UTF-8.&lt;/p&gt;
-
-  &lt;p&gt;Lines that don't match the above production cause the connection
-  to be aborted.&lt;/p&gt;
-
-  &lt;p&gt;Finally, after the last field, the client sends 10 bytes
-  starting with 0x0D 0x0A and followed by 8 random bytes, part of a
-  challenge, and the server sends 18 bytes starting with 0x0D 0x0A and
-  followed by 16 bytes consisting of a challenge response. The details
-  of this challenge and other parts of the handshake are described in
-  the next section.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;Once the client and server have both sent their handshakes, and
-  if the handshake was successful, then the data transfer part
-  starts. This is a two-way communication channel where each side can,
-  independently from the other, send data at will.&lt;/p&gt;
-
-  &lt;p&gt;Data is sent in the form of UTF-8 text. Each frame of data starts
-  with a 0xFF byte identifying the frame type, followed by the number
-  of bytes in the data expressed as a big-endian 64 bit unsigned
-  integer, followed by the UTF-8 data.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The length is the number of UTF-8 &lt;em&gt;bytes&lt;/em&gt;,
-  and not the number of characters. For example, the string
-  &quot;H&amp;#x0336;e&amp;#x035c;&amp;#x0338;&amp;#x0489;ll&amp;#x0321;o&amp;#x0335;&amp;#x0358;&amp;#x0336;&quot;
-  has 13 Unicode code points, but is 21 bytes long.&lt;/p&gt;&lt;!-- Zalgo --&gt;
-
-  &lt;p&gt;The WebSocket protocol uses this framing so that specifications
-  that use the WebSocket protocol can expose such connections using
-  an event-based mechanism instead of requiring users of those
-  specifications to implement buffering and piecing together of
-  messages manually.&lt;/p&gt;
-
-  &lt;p&gt;To close the connection cleanly, a frame consisting of just nine
-  0x00 bytes in a row is sent from one peer to ask that the other peer
-  close the connection. That corresponds to a frame type of 0x00
-  followed by a length of zero, indicating an empty frame.&lt;/p&gt;
-
-  &lt;p&gt;In addition to the 0x00 and 0xFF frame types, other types might
-  in future be defined, to support binary data, fragmentation,
-  compression, multiplexing, or other features.&lt;/p&gt;
-
-  &lt;p&gt;The wire format for the data transfer part is described by the
-  &lt;code title=&quot;&quot;&gt;frames&lt;/code&gt; production of the following
-  non-normative ABNF.
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-  &lt;a href=&quot;#refsRFC5234&quot;&gt;[RFC5234]&lt;/a&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;
-  &lt;a href=&quot;#refsABNF&quot;&gt;[ABNF]&lt;/a&gt;
-&lt;!--START websocket-protocol--&gt;
-  &lt;/p&gt;
-
-  &lt;pre&gt;frames        = *frame
-frame         = frame-type frame-length data
-frame-type    = OCTET
-frame-length  = 8OCTET
-data          = *OCTET ; count must match the given length&lt;/pre&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The above ABNF is intended for a binary octet
-  environment.&lt;/p&gt;
-
-  &lt;p class=&quot;warning&quot;&gt;At this time, the WebSocket protocol cannot be
-  used to send binary data. Using any of the frame types other than
-  0x00 and 0xFF is invalid. All other frame types are reserved for
-  future use by future versions of this protocol.&lt;/p&gt;
-
-
-
-  &lt;h6&gt;Opening handshake&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The opening handshake is intended to be compatible with
-  HTTP-based server-side software, so that a single port can be used
-  by both HTTP clients talking to that server and WebSocket clients
-  talking to that server. To this end, the WebSocket client's
-  handshake appears to HTTP servers to be a regular GET request with
-  an Upgrade offer:&lt;/p&gt;
-
-  &lt;pre&gt;GET / HTTP/1.1
-Upgrade: WebSocket
-Connection: Upgrade&lt;/pre&gt;
-
-  &lt;p&gt;Fields in the handshake are sent by the client in a random order;
-  the order is not meaningful.&lt;/p&gt;
-
-  &lt;p&gt;Additional fields are used to select options in the WebSocket
-  protocol. The only options available in this version are the
-  subprotocol selector, &lt;code
-  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;,
-  and &lt;code title=&quot;http-cookie&quot;&gt;Cookie&lt;/code&gt;, which can used for
-  sending cookies to the server (e.g. as an authentication
-  mechanism). The &lt;code
-  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;
-  field takes a space-separated list of strings:&lt;/p&gt;
-
-  &lt;pre&gt;Sec-WebSocket-Protocol: org.example.chat wsxmpp ACME.COM-IM-2&lt;/pre&gt;
-
-  &lt;p&gt;This field indicates the subprotocols (the application-level
-  protocol layered over the WebSocket protocol) that the client can
-  use. The server reports which subprotocol it is going to use in its
-  handshake response.&lt;/p&gt;
-
-  &lt;p&gt;The other fields in the handshake are all security-related.  The
-  &lt;code title=&quot;http-host&quot;&gt;Host&lt;/code&gt; field is used to protect against
-  DNS rebinding attacks and to allow multiple domains to be served
-  from one IP address.&lt;/p&gt;
-
-  &lt;pre&gt;Host: example.com&lt;/pre&gt;
-
-  &lt;p&gt;The server includes the hostname in the &lt;code
-  title=&quot;http-sec-websocket-location&quot;&gt;Sec-WebSocket-Location&lt;/code&gt;
-  field of its handshake, so that both the client and the server can
-  verify that they agree on which host is in use.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;code title=&quot;http-origin&quot;&gt;Origin&lt;/code&gt; field is used to
-  protect against unauthorized cross-origin use of a WebSocket server
-  by scripts using the &lt;code&gt;WebSocket&lt;/code&gt; API in a Web
-  browser. The server specifies which origin it is willing to receive
-  requests from by including a &lt;code
-  title=&quot;http-sec-websocket-origin&quot;&gt;Sec-WebSocket-Origin&lt;/code&gt; field
-  with that origin. If multiple origins are authorized, the server
-  echoes the value in the &lt;code title=&quot;http-origin&quot;&gt;Origin&lt;/code&gt;
-  field of the client's handshake.&lt;/p&gt;
-
-  &lt;pre&gt;Origin: <A HREF="http://example.com&lt;/pre">http://example.com&lt;/pre</A>&gt;
-
-  &lt;p&gt;Finally, the server has to prove to the client that it received
-  the client's WebSocket handshake, so that the server doesn't accept
-  connections that are not WebSocket connections. This prevents an
-  attacker from tricking a WebSocket server by sending it
-  carefully-crafted packets using &lt;code&gt;XMLHttpRequest&lt;/code&gt; or a
-  &lt;code&gt;form&lt;/code&gt; submission.&lt;/p&gt;
-
-  &lt;p&gt;To prove that the handshake was received, the server has to take
-  three pieces of information and combine them to form a response. The
-  first two pieces of information come from the &lt;code
-  title=&quot;http-sec-websocket-key&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt; and &lt;code
-  title=&quot;http-sec-websocket-key&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt; fields in
-  the client handshake:&lt;/p&gt;
-
-  &lt;pre&gt;Sec-WebSocket-Key1: 18x 6]8vM;54 *(5:  {   U1]8  z [  8
-Sec-WebSocket-Key2: 1_ tx7X d  &lt;  nw  334J702) 7]o}` 0&lt;/pre&gt;
-
-  &lt;p&gt;For each of these fields, the server has to take the digits from
-  the value to obtain a number (in this case 1868545188 and 1733470270
-  respectively), then divide that number by the number of spaces
-  characters in the value (in this case 12 and 10) to obtain a 32-bit
-  number (155712099 and 173347027). These two resulting numbers are
-  then used in the server handshake, as described below.&lt;/p&gt;
-
-  &lt;p&gt;The counting of spaces is intended to make it impossible to
-  smuggle this field into the resource name; making this even harder
-  is the presence of &lt;em&gt;two&lt;/em&gt; such fields, and the use of a
-  newline as the only reliable indicator that the end of the key has
-  been reached. The use of random characters interspersed with the
-  spaces and the numbers ensures that the implementor actually looks
-  for spaces and newlines, instead of being treating any character
-  like a space, which would make it again easy to smuggle the fields
-  into the path and trick the server. Finally, &lt;em&gt;dividing&lt;/em&gt; by
-  this number of spaces is intended to make sure that even the most
-  na&iuml;ve of implementations will check for spaces, since if ther
-  server does not verify that there are some spaces, the server will
-  try to divide by zero, which is usually fatal (a correct handshake
-  will always have at least one space).
-
-  &lt;p&gt;The third piece of information is given after the fields, in the
-  last eight bytes of the handshake, expressed here as they would be
-  seen if interpreted as UTF-8:&lt;/p&gt;
-
-  &lt;pre&gt;Tm[K T2u&lt;/pre&gt;
-
-  &lt;p&gt;The concatenation of the number obtained from processing the
-  &lt;code title=&quot;http-sec-websocket-key&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt;
-  field, expressed as a big-endian 32-bit number, the number
-  obtained from processing the &lt;code
-  title=&quot;http-sec-websocket-key&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt; field,
-  again expressed as a big-endian 32-bit number, and finally the
-  eight bytes at the end of the handshake, form a 128 bit string whose
-  MD5 sum is then used by the server to prove that it read the
-  handshake.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;The handshake from the server is much simpler than the client
-  handshake. The first line is an HTTP Status-Line, with the status
-  code 101 (the HTTP version and reason phrase aren't important):&lt;/p&gt;
-
-  &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake&lt;/pre&gt;
-
-  &lt;p&gt;The fields follow. Two of the fields are just for compatibility
-  with HTTP:&lt;/p&gt;
-
-  &lt;pre&gt;Upgrade: WebSocket
-Connection: Upgrade&lt;/pre&gt;
-
-  &lt;p&gt;Two of the fields are part of the security model described
-  above, echoing the origin and stating the exact host, port, resource
-  name, and whether the connection is expected to be encrypted:&lt;/p&gt;
-
-  &lt;pre&gt;Sec-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
-Sec-WebSocket-Location: <A HREF="ws://example.com/&lt;/pre">ws://example.com/&lt;/pre</A>&gt;
-
-  &lt;p&gt;These fields are checked by the Web browser when it is acting as
-  a &lt;code&gt;WebSocket&lt;/code&gt; client for scripted pages. A server that
-  only handles one origin and only serves one resource can therefore
-  just return hard-coded values and does not need to parse the
-  client's handshake to verify the correctness of the values.&lt;/p&gt;
-
-  &lt;p&gt;Option fields can also be included. In this version of the
-  protocol, the main option field is &lt;code
-  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;,
-  which indicates the subprotocol that the server speaks. Web browsers
-  verify that the server specified one of the values that was
-  specified in the &lt;code&gt;WebSocket&lt;/code&gt; constructor, so a server
-  that speaks multiple subprotocols has to make sure it selects one
-  based on the client's handshake and specifies the right one in its
-  handshake.&lt;/p&gt;
-
-  &lt;pre&gt;Sec-WebSocket-Protocol: org.example.chat&lt;/pre&gt;
-
-  &lt;p&gt;The server can also set cookie-related option fields to
-  &lt;em&gt;set&lt;/em&gt; cookies, as in HTTP.&lt;/p&gt;
-
-  &lt;p&gt;After the fields, the server sends the aforementioned MD5 sum, a
-  16 byte (128 bit) value, shown here as if interpreted as UTF-8:&lt;/p&gt;
-
-  &lt;pre&gt;fQJ,fN/4F4!~K~MH&lt;/pre&gt;
-
-  &lt;p&gt;This value depends on what the client sends, as described
-  above. If it doesn't match what the client is expecting, the client
-  would disconnect.&lt;/p&gt;
-
-  &lt;p&gt;Having part of the handshake appear after the fields ensures
-  that both the server and the client verify that the connection is
-  not being interrupted by an HTTP intermediary such as a
-  man-in-the-middle cache or proxy.&lt;/p&gt;
-
-
-  &lt;h6&gt;Closing handshake&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The closing handshake is far simpler than the opening handshake.&lt;/p&gt;
-
-  &lt;p&gt;Either peer can send a 0xFF frame with length 0x00 to begin the
-  closing handshake. Upon receiving a 0xFF frame, the other peer
-  sends an identical 0xFF frame in acknowledgement, if it hasn't
-  already sent one. Upon receiving &lt;em&gt;that&lt;/em&gt; 0xFF frame, the first
-  peer then closes the connection, safe in the knowledge that no
-  further data is forthcoming.&lt;/p&gt;
-
-  &lt;p&gt;After sending a 0xFF frame, a peer does not send any further
-  data; after receiving a 0xFF frame, a peer discards any further
-  data received.&lt;/p&gt;
-
-  &lt;p&gt;It is safe for both peers to initiate this handshake
-  simultaneously.&lt;/p&gt;
-
-  &lt;p&gt;The closing handshake is intended to replace the TCP closing
-  handshake (FIN/ACK), on the basis that the TCP closing handshake is
-  not always reliable end-to-end, especially in the presence of
-  man-in-the-middle proxies and other intermediaries.&lt;/p&gt;
-
-
-
-  &lt;h6&gt;Design philosophy&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The WebSocket protocol is designed on the principle that there
-  should be minimal framing (the only framing that exists is to make
-  the protocol frame-based instead of stream-based, and to support a
-  distinction between Unicode text and binary frames). It is expected
-  that metadata would be layered on top of WebSocket by the
-  application layer, in the same way that metadata is layered on top
-  of TCP by the application layer (HTTP).&lt;/p&gt;
-
-  &lt;p&gt;Conceptually, WebSocket is really just a layer on top of TCP
-  that adds a Web &quot;origin&quot;-based security model for browsers; adds an
-  addressing and subprotocol naming mechanism to support multiple
-  services on one port and multiple host names on one IP address;
-  layers a framing mechanism on top of TCP to get back to the IP
-  packet mechanism that TCP is built on, but without length
-  limits; and reimplements the closing handshake in-band.
-
-  Other than that, it adds nothing. Basically it is intended
-  to be as close to just exposing raw TCP to script as possible
-  given the constraints of the Web. It's also designed in such a way
-  that its servers can share a port with HTTP servers, by having its
-  handshake be a valid HTTP Upgrade handshake also.&lt;/p&gt;
-
-  &lt;p&gt;The protocol is intended to be extensible; future versions will
-  likely introduce a mechanism to compress data and might support
-  sending binary data. To do this, future versions of this protocol
-  are likely to introduce option fields that clients can send in its
-  handshake to announce support for a feature (such as compression),
-  to which the server can react by including a similar option field in
-  &lt;em&gt;its&lt;/em&gt; handshake.&lt;/p&gt;
-
-
-  &lt;h6&gt;Security model&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The WebSocket protocol uses the origin model used by Web
-  browsers to restrict which Web pages can contact a WebSocket server
-  when the WebSocket protocol is used from a Web page. Naturally,
-  when the WebSocket protocol is used by a dedicated client directly
-  (i.e. not from a Web page through a Web browser), the origin model
-  is not useful, as the client can provide any arbitrary origin
-  string.&lt;/p&gt;
-
-  &lt;p&gt;This protocol is intended to fail to establish a connection with
-  servers of pre-existing protocols like SMTP or HTTP, while allowing
-  HTTP servers to opt-in to supporting this protocol if desired. This
-  is achieved by having a strict and elaborate handshake, and by
-  limiting the data that can be inserted into the connection before
-  the handshake is finished (thus limiting how much the server can be
-  influenced).&lt;/p&gt;
-
-  &lt;p&gt;It is similarly intended to fail to establish a connection when
-  data from other protocols, especially HTTP, is sent to a WebSocket
-  server, for example as might happen if an HTML &lt;code&gt;form&lt;/code&gt;
-  were submitted to a WebSocket server. This is primarily achieved by
-  requiring that the server prove that it read the handshake, which it
-  can only do if the handshake contains the appropriate parts which
-  themselves can only be sent by a WebSocket handshake; in
-  particular, fields starting with &lt;code title=&quot;&quot;&gt;Sec-&lt;/code&gt; cannot
-  be set by an attacker from a Web browser, even when using
-  &lt;code&gt;XMLHttpRequest&lt;/code&gt;.&lt;/p&gt;
-
-
-  &lt;h6&gt;Relationship to TCP and HTTP&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The WebSocket protocol is an independent TCP-based protocol. Its
-  only relationship to HTTP is that its handshake is interpreted by
-  HTTP servers as an Upgrade request.&lt;/p&gt;
-
-  &lt;p&gt;Based on the expert recommendation of the IANA&lt;!-- [IANA #257455]
-  --&gt;, the WebSocket protocol by default uses port 80 for regular
-  WebSocket connections and port 443 for WebSocket connections
-  tunneled over TLS.&lt;/p&gt;
-
-
-
-  &lt;h6&gt;Establishing a connection&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;There are several options for establishing a WebSocket connection.&lt;/p&gt;
-
-  &lt;p&gt;On the face of it, the simplest method would seem to be to use
-  port 80 to get a direct connection to a WebSocket server. Port 80
-  traffic, however, will often be intercepted by man-in-the-middle
-  HTTP proxies, which can lead to the connection failing to be
-  established.&lt;/p&gt;
-
-  &lt;p&gt;The most reliable method, therefore, is to use TLS encryption and
-  port 443 to connect directly to a WebSocket server. This has the
-  advantage of being more secure; however, TLS encryption can be
-  computationally expensive.&lt;/p&gt;
-
-  &lt;p&gt;When a connection is to be made to a port that is shared by an
-  HTTP server (a situation that is quite likely to occur with traffic
-  to ports 80 and 443), the connection will appear to the HTTP server
-  to be a regular GET request with an Upgrade offer. In relatively
-  simple setups with just one IP address and a single server for all
-  traffic to a single hostname, this might allow a practical way for
-  systems based on the WebSocket protocol to be deployed. In more
-  elaborate setups (e.g. with load balancers and multiple servers), a
-  dedicated set of hosts for WebSocket connections separate from the
-  HTTP servers is probably easier to manage.&lt;/p&gt;
-
-
-
-  &lt;h6&gt;Subprotocols using the WebSocket protocol&lt;/h6&gt;
-
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;The client can request that the server use a specific subprotocol
-  by including the &lt;code
-  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-Websocket-Protocol&lt;/code&gt;
-  field in its handshake. If it is specified, the server needs to
-  include an equivalent field in its response for the connection to be
-  established.&lt;/p&gt;
-
-  &lt;p&gt;These subprotocol names do not need to be registered, but if a
-  subprotocol is intended to be implemented by multiple independent
-  WebSocket servers, potential clashes with the names of subprotocols
-  defined independently can be avoided by using names that contain the
-  domain name of the subprotocol's originator. For example, if Example
-  Corporation were to create a Chat subprotocol to be implemented by
-  many servers around the Web, they could name it
-  &quot;chat.example.com&quot;. If the Example Organisation called their
-  competing subprotocol &quot;the-example.org-chat-protocol&quot;, then the two
-  subprotocols could be implemented by servers simultaneously, with
-  the server dynamically selecting which subprotocol to use based on
-  the value sent by the client.&lt;/p&gt;
-
-  &lt;p&gt;Subprotocols can be versioned in backwards-incompatible ways by
-  changing the subprotocol name, eg. going from &quot;bookings.example.net&quot;
-  to &quot;bookings.example.net2&quot;. These subprotocols would be considered
-  completely separate by WebSocket clients. Backwards-compatible
-  versioning can be implemented by reusing the same subprotocol string
-  but carefully designing the actual subprotocol to support this kind
-  of extensibility.&lt;/p&gt;
-
-  &lt;p&gt;Subprotocol names are sequences of one or more characters in the
-  range U+0021 to U+007F.&lt;/p&gt;
-
-
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-  &lt;!--BOILERPLATE middle-ietf-conformance--&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;
-
-  &lt;h5&gt;Terminology&lt;/h5&gt;
-
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-  &lt;p&gt;&lt;dfn title=&quot;converted to ASCII lowercase&quot;&gt;Converting a string to
-  ASCII lowercase&lt;/dfn&gt; means replacing all characters in the range
-  U+0041 to U+005A (i.e. LATIN CAPITAL LETTER A to LATIN CAPITAL
-  LETTER Z) with the corresponding characters in the range U+0061
-  to U+007A (i.e. LATIN SMALL LETTER A to LATIN SMALL LETTER Z).&lt;/p&gt;
-
-  &lt;p&gt;Comparing two strings in an &lt;dfn&gt;ASCII case-insensitive&lt;/dfn&gt;
-  manner means comparing them exactly, code point for code point, except
-  that the characters in the range U+0041 to U+005A (i.e. LATIN
-  CAPITAL LETTER A to LATIN CAPITAL LETTER Z) and the corresponding
-  characters in the range U+0061 to U+007A (i.e. LATIN SMALL LETTER A
-  to LATIN SMALL LETTER Z) are considered to also match.&lt;/p&gt;
-
-  &lt;p&gt;The term &quot;URL&quot; is used in this section in a manner consistent
-  with the terminology used in HTML, namely, to denote a string that
-  might or might not be a valid URI or IRI and to which certain error
-  handling behaviors will be applied when the string is parsed. &lt;a
-  href=&quot;#refsHTML&quot;&gt;[HTML]&lt;/a&gt;&lt;/p&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;
-
-  &lt;p&gt;When an implementation is required to &lt;i&gt;send&lt;/i&gt; data as part of
-  the WebSocket protocol, the implementation may delay the actual
-  transmission arbitrarily, e.g. buffering data so as to send fewer IP
-  packets.&lt;/p&gt;
-
-
-
-  &lt;h5&gt;WebSocket URLs&lt;/h5&gt;
-
-  &lt;h6&gt;Parsing WebSocket URLs&lt;/h6&gt;
-
-  &lt;p&gt;The steps to &lt;dfn&gt;parse a WebSocket URL's components&lt;/dfn&gt; from
-  a string &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; are as follows. These steps return
-  either a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a
-  &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-  flag, or they fail.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; string is not an
-   &lt;span&gt;absolute URL&lt;/span&gt;, then fail this algorithm. &lt;a
-   href=&quot;#refsWEBADDRESSES&quot;&gt;[WEBADDRESSES]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the &lt;var
-    title=&quot;&quot;&gt;url&lt;/var&gt; string using the &lt;span&gt;resolve a Web
-    address&lt;/span&gt; algorithm defined by the Web addresses
-    specification, with the &lt;span&gt;URL character encoding&lt;/span&gt; set to
-    UTF-8. &lt;a href=&quot;#refsWEBADDRESSES&quot;&gt;[WEBADDRESSES]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt; &lt;!-- the URL character
-    encoding is used to escape the query component --&gt;
-
-    &lt;p class=&quot;note&quot;&gt;It doesn't matter what it is resolved relative to,
-    since we already know it is an &lt;span&gt;absolute URL&lt;/span&gt; at this
-    point.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; does not have a &lt;span
-   title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component whose value,
-   when &lt;span&gt;converted to ASCII lowercase&lt;/span&gt;, is either &quot;&lt;code
-   title=&quot;&quot;&gt;ws&lt;/code&gt;&quot; or &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, then fail this
-   algorithm.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;span
-   title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component, then fail
-   this algorithm.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt;
-   component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; is &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot;,
-   set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to false; otherwise, the &lt;span
-   title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component is &quot;&lt;code
-   title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to
-   true.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the value of the &lt;span
-   title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt; component of &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;, &lt;span&gt;converted to ASCII
-   lowercase&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt; &lt;!-- at this point this is
-   Punycode-encoded already --&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;span
-   title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/span&gt; component, then let &lt;var
-   title=&quot;&quot;&gt;port&lt;/var&gt; be that component's value; otherwise, there is
-   no explicit &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If there is no explicit &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then: if
-   &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;
-   be 80, otherwise let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be 443.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; be the value of the
-   &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component (which might
-   be empty) of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt; &lt;!-- at this point
-   this is UTF-8 encoded and %-escaped --&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; is the empty string,
-   set it to a single character U+002F SOLIDUS (/).&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;span
-   title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component, then append a
-   single U+003F QUESTION MARK character (?) to &lt;var title=&quot;&quot;&gt;resource
-   name&lt;/var&gt;, followed by the value of the &lt;span
-   title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component.&lt;/p&gt;&lt;/li&gt; &lt;!-- at
-   this point this is UTF-8 encoded and %-escaped --&gt;
-
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;,
-   &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var
-   title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-
-  &lt;h6&gt;Constructing WebSocket URLs&lt;/h6&gt;
-
-  &lt;p&gt;The steps to &lt;dfn&gt;construct a WebSocket URL&lt;/dfn&gt; from a &lt;var
-  title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a &lt;var
-  title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag,
-  are as follows:&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the empty string.&lt;/li&gt;
-
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag is false, then append
-   the string &quot;&lt;code title=&quot;&quot;&gt;<A HREF="ws://&lt;/code">ws://&lt;/code</A>&gt;&quot; to &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;. Otherwise, append the string &quot;&lt;code
-   title=&quot;&quot;&gt;<A HREF="wss://&lt;/code">wss://&lt;/code</A>&gt;&quot; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;Append &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; to &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag is false and port is
-   not 80, or if the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag is true and
-   port is not 443, then append the string &quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot;
-   followed by &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; to &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;Append &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; to &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;Return &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-
-  &lt;h5&gt;Client-side requirements&lt;/h5&gt;
-
-  &lt;p&gt;&lt;i&gt;This section only applies to user agents, not to
-  servers.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;User agents running in controlled environments, e.g. browsers on
-  mobile handsets tied to specific carriers, may offload the
-  management of the connection to another agent on the network. In
-  such a situation, the user agent for the purposes of conformance is
-  considered to include both the handset software and any such
-  agents.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;This specification doesn't currently define a limit
-  to the number of simultaneous connections that a client can
-  establish to a server.&lt;/p&gt;
-
-
-  &lt;h6&gt;Opening handshake&lt;/h6&gt;
-
-  &lt;p&gt;When the user agent is to &lt;dfn&gt;establish a WebSocket
-  connection&lt;/dfn&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on a port &lt;var
-  title=&quot;&quot;&gt;port&lt;/var&gt;, from an origin whose &lt;span title=&quot;ASCII
-  serialization of an origin&quot;&gt;ASCII serialization&lt;/span&gt; is &lt;var
-  title=&quot;&quot;&gt;origin&lt;/var&gt;, with a flag &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;, with
-  a string giving a &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, with a
-  (possibly empty) list of strings giving the &lt;var
-  title=&quot;&quot;&gt;protocols&lt;/var&gt;, and optionally with a &lt;var title=&quot;&quot;&gt;defer
-  cookies&lt;/var&gt; flag, it must run the following steps. The &lt;var
-  title=&quot;&quot;&gt;host&lt;/var&gt; must have been punycode-encoded already if
-  necessary (i.e. it does not contain characters above U+007E). The
-  &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt; must not contain characters in the range
-  U+0041 to U+005A (i.e. LATIN CAPITAL LETTER A to LATIN CAPITAL
-  LETTER Z). The &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; string must be a
-  non-empty string of characters in the range U+0021 to U+007E that
-  starts with a U+002F SOLIDUS character (/). The various strings in
-  &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; must all be non-empty strings with
-  characters in the range U+0021 to U+007E, and must all be unique. &lt;a
-  href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the user agent already has a WebSocket connection to the
-    remote host (IP address) identified by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;,
-    even if known by another name, wait until that connection has been
-    &lt;span title=&quot;WebSocket connection is
-    established&quot;&gt;established&lt;/span&gt; or for that connection to have
-    &lt;span title=&quot;fail the WebSocket connection&quot;&gt;failed&lt;/span&gt;. If
-    multiple connections to the same IP address are attempted
-    simultaneously, the user agent must serialize them so that there
-    is no more than one connection at a time running through the
-    following steps.&lt;/p&gt;
-
-    &lt;p&gt;If the user agent cannot determine the IP address of the remote
-    host (for example because all communication is being done through
-    a proxy server that performs DNS queries itself), then the user
-    agent must assume for the purposes of this step that each host
-    name refers to a distinct remote host, but should instead limit
-    the total number of simultaneous connections that are not &lt;span
-    title=&quot;WebSocket connection is established&quot;&gt;established&lt;/span&gt; to
-    a reasonably low number (e.g., in a Web browser, to the number of
-    tabs the user has open).&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This makes it harder for a script to perform a
-    denial of service attack by just opening a large number of
-    WebSocket connections to a remote host. A server can further
-    reduce the load on itself when attacked by making use of this by
-    pausing before closing the connection, as that will reduce the
-    rate at which the client reconnects.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;There is no limit to the number of &lt;span
-    title=&quot;WebSocket connection is established&quot;&gt;established&lt;/span&gt;
-    WebSocket connections a user agent can have with a single remote
-    host. Servers can refuse to connect users with an excessive number
-    of connections, or disconnect resource-hogging users when
-    suffering high load.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;&lt;i&gt;Connect&lt;/i&gt;: If the user agent is configured to use a proxy
-    when using the WebSocket protocol to connect to host &lt;var
-    title=&quot;&quot;&gt;host&lt;/var&gt; and/or port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then
-    connect to that proxy and ask it to open a TCP connection to
-    the host given by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by
-    &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;div class=&quot;example&quot;&gt;
-
-     &lt;p&gt;For example, if the user agent uses an HTTP proxy for all
-     traffic, then if it was to try to connect to port 80 on server
-     example.com, it might send the following lines to the proxy
-     server:&lt;/p&gt;
-
-     &lt;pre&gt;CONNECT example.com:80 HTTP/1.1
-Host: example.com&lt;/pre&gt;
-
-     &lt;p&gt;If there was a password, the connection might look like:&lt;/p&gt;
-
-     &lt;pre&gt;CONNECT example.com:80 HTTP/1.1
-Host: example.com
-Proxy-authorization: Basic ZWRuYW1vZGU6bm9jYXBlcyE=&lt;/pre&gt;
-
-    &lt;/div&gt;
-
-    &lt;p&gt;Otherwise, if the user agent is not configured to use a proxy,
-    then open a TCP connection to the host given by &lt;var
-    title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by &lt;var
-    title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;Implementations that do not expose explicit UI for
-    selecting a proxy for WebSocket connections separate from other
-    proxies are encouraged to use a SOCKS proxy for WebSocket
-    connections, if available, or failing that, to prefer the proxy
-    configured for HTTPS connections over the proxy configured for
-    HTTP connections.&lt;/p&gt;
-
-    &lt;p&gt;For the purpose of proxy autoconfiguration scripts, the
-    &lt;span&gt;URL&lt;/span&gt; to pass the function must be constructed from
-    &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-    flag using the steps to &lt;span&gt;construct a WebSocket
-    URL&lt;/span&gt;.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;The WebSocket protocol can be identified in proxy
-    autoconfiguration scripts from the scheme (&quot;&lt;code
-    title=&quot;&quot;&gt;ws:&lt;/code&gt;&quot; for unencrypted connections and &quot;&lt;code
-    title=&quot;&quot;&gt;wss:&lt;/code&gt;&quot; for encrypted connections).&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the connection could not be opened, then &lt;span&gt;fail the
-   WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is true, perform a TLS handshake
-    over the connection. If this fails (e.g. the server's certificate
-    could not be verified), then &lt;span&gt;fail the WebSocket
-    connection&lt;/span&gt; and abort these steps. Otherwise, all further
-    communication on this channel must run through the encrypted
-    tunnel. &lt;a href=&quot;#refsRFC2246&quot;&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;User agents must use the Server Name Indication extension in
-    the TLS handshake. &lt;a href=&quot;#refsRFC4366&quot;&gt;[RFC4366]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;User agents must use the Next Protocol Negotiation extension in
-    the TLS handshake, selecting the &quot;776562736f636b6574&quot; protocol
-    (&quot;websocket&quot; in UTF-8). &lt;a href=&quot;#refsNPN&quot;&gt;[NPN]&lt;/a&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send the UTF-8 string &quot;GET&quot; followed by a UTF-8-encoded U+0020
-    SPACE character to the remote side (the server).&lt;/p&gt;
-
-    &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; value, encoded as
-    UTF-8.&lt;/p&gt;
-
-    &lt;p&gt;Send another UTF-8-encoded U+0020 SPACE character, followed by
-    the UTF-8 string &quot;HTTP/1.1&quot;, followed by a UTF-8-encoded U+000D
-    CARRIAGE RETURN U+000A LINE FEED character pair (CRLF).&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; be an empty list of strings.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string &quot;Upgrade:&nbsp;WebSocket&quot; to &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string &quot;Connection:&nbsp;Upgrade&quot; to &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt; be an empty string.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Append the &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; value, &lt;span&gt;converted to
-    ASCII lowercase&lt;/span&gt;, to &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, and &lt;var
-    title=&quot;&quot;&gt;port&lt;/var&gt; is not 80, or if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is
-    true, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 443, then append a
-    U+003A COLON character (:) followed by the value of &lt;var
-    title=&quot;&quot;&gt;port&lt;/var&gt;, expressed as a base-ten integer, to &lt;var
-    title=&quot;&quot;&gt;hostport&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string consisting of the concatenation of the string
-    &quot;Host:&quot;, a U+0020 SPACE character, and &lt;var
-    title=&quot;&quot;&gt;hostport&lt;/var&gt;, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string consisting of the concatenation of the string
-    &quot;Origin:&quot;, a U+0020 SPACE character, and the &lt;var
-    title=&quot;&quot;&gt;origin&lt;/var&gt; value, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; list is empty, then skip
-    this step.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, add the string consisting of the concatenation of
-    the string &quot;Sec-WebSocket-Protocol:&quot;, a U+0020 SPACE character,
-    and the strings in &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt;, maintaining
-    their relative order and each separated from the next by a single
-    U+0020 SPACE character, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-&lt;!--UAS:
-   &lt;li&gt;
-
-    &lt;p&gt;Optionally, add the string consisting of the concatenation of
-    the string &quot;User-Agent:&quot;, a U+0020 SPACE character, and a
-    user-agent defined string, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the client has any &lt;!--(v2-ws-auth) authentication
-    information or--&gt; cookies that would be relevant to a resource
-    accessed over HTTP, if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, or
-    HTTPS, if it is true, on host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, port &lt;var
-    title=&quot;&quot;&gt;port&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as the
-    path (and possibly query parameters), then add to &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; any HTTP headers that would be appropriate
-    for that information.
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-    &lt;a href=&quot;#refsRFC2616&quot;&gt;[RFC2616]&lt;/a&gt;
-    &lt;a href=&quot;#refsRFC2109&quot;&gt;[RFC2109]&lt;/a&gt;
-    &lt;a href=&quot;#refsRFC2965&quot;&gt;[RFC2965]&lt;/a&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;
-    &lt;a href=&quot;#refsHTTP&quot;&gt;[HTTP]&lt;/a&gt;
-    &lt;a href=&quot;#refsCOOKIES&quot;&gt;[COOKIES]&lt;/a&gt;
-&lt;!--START websocket-protocol--&gt;
-    &lt;/p&gt;
-
-    &lt;p&gt;This includes &quot;&lt;code&gt;HttpOnly&lt;/code&gt;&quot; cookies (cookies with the
-    http-only-flag set to true); the WebSocket protocol is not
-    considered a non-HTTP API for the purpose of cookie
-    processing.&lt;/p&gt;
-
-    &lt;p&gt;When one or more HTTP headers are to be added to &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; for this step, each header must be added
-    separately, and each header must be added as one entry consisting
-    of the header's name in its canonical case, followed by a U+003A
-    COLON character (:) and a U+0020 SPACE character, followed by the
-    value with no use of continuation lines (i.e. containing no U+000A
-    LINE FEED characters).&lt;/p&gt;
-
-    &lt;!-- (Cookie headers only use one header for multiple cookies.) --&gt;
-
-&lt;!--(v2-ws-auth)
-    &lt;div class=&quot;example&quot;&gt;
-
-     &lt;p&gt;For example, if the server had a username and password that
-     applied to &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/socket&lt;/code">http://example.com/socket&lt;/code</A>&gt;, and
-     the WebSocket was being opened to &lt;code
-     title=&quot;&quot;&gt;<A HREF="ws://example.com/socket&lt;/code">ws://example.com/socket&lt;/code</A>&gt;, it could add them:&lt;/p&gt;
-
-     &lt;pre&gt;Authorization: Basic d2FsbGU6ZXZl&lt;/pre&gt;
-
-    &lt;/div&gt;
---&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a random integer
-    from 1 to 12 inclusive.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a random integer
-    from 1 to 12 inclusive.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;For example, 5 and 9.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be the largest integer
-    not greater than 4,294,967,295 divided by &lt;var
-    title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be the largest integer
-    not greater than 4,294,967,295 divided by &lt;var
-    title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;Continuing the example, 858,993,459 and 477,218,588.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a random integer
-    from 0 to &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; inclusive.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a random integer
-    from 0 to &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; inclusive.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;For example, 777,007,543 and 114,997,259.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be the result of
-    multiplying &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var
-    title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; together.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be the result of
-    multiplying &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; and &lt;var
-    title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; together.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;Continuing the example, 3,885,037,715 and
-    1,034,975,331.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a string consisting
-    of &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed in base ten
-    using the numerals in the range U+0030 DIGIT ZERO (0) to U+0039
-    DIGIT NINE (9).&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a string consisting
-    of &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;, expressed in base ten
-    using the numerals in the range U+0030 DIGIT ZERO (0) to U+0039
-    DIGIT NINE (9).&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;Continuing the example, &quot;3885037715&quot; and
-    &quot;1034975331&quot;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Insert between one and twelve random characters from
-    the ranges U+0021 to U+002F and U+003A to U+007E into &lt;var
-    title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; at random positions.&lt;/p&gt;
-
-    &lt;p&gt;Insert between one and twelve random characters from
-    the ranges U+0021 to U+002F and U+003A to U+007E into &lt;var
-    title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; at random positions.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This corresponds to random printable ASCII
-    characters other than the digits and the U+0020 SPACE
-    character.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;Continuing the example, this could lead to
-    &quot;P388O503D&amp;ul7{K%gX(%715&quot; and
-    &quot;1N?|kUT0or3o4I97N5-S3O31&quot;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Insert &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; U+0020 SPACE
-    characters into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; at random
-    positions other than the start or end of the string.&lt;/p&gt;
-
-    &lt;p&gt;Insert &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; U+0020 SPACE
-    characters into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; at random
-    positions other than the start or end of the string.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;Continuing the example, this could lead to
-    &quot;P388&nbsp;O503D&amp;ul7&nbsp;{K%gX(&nbsp;%7&nbsp;&nbsp;15&quot; and
-    &quot;1&nbsp;N&nbsp;?|k&nbsp;UT0or&nbsp;3o&nbsp;&nbsp;4&nbsp;I97N&nbsp;5-S3O&nbsp;31&quot;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Add the string consisting of the concatenation of the string
-    &quot;Sec-WebSocket-Key1:&quot;, a U+0020 SPACE character, and the &lt;var
-    title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; value, to &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Add the string consisting of the concatenation of the string
-    &quot;Sec-WebSocket-Key2:&quot;, a U+0020 SPACE character, and the &lt;var
-    title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; value, to &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;For each string in &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;, in a random
-    order: send the string, encoded as UTF-8, followed by a
-    UTF-8-encoded U+000D CARRIAGE RETURN U+000A LINE FEED character
-    pair (CRLF). It is important that the fields be output in a
-    random order so that servers not depend on the particular order
-    used by any particular client.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;Only fields explicitly mentioned in the
-    requirements of this specification are sent. For example, user
-    agents do not send fields such as &lt;code
-    title=&quot;http-user-agent&quot;&gt;User-Agent&lt;/code&gt;&lt;!--UAS--&gt;, &lt;code
-    title=&quot;http-accept-language&quot;&gt;Accept-Language&lt;/code&gt;, or &lt;code
-    title=&quot;http-content-type&quot;&gt;Content-Type&lt;/code&gt; in the WebSocket
-    handshake.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send a UTF-8-encoded U+000D CARRIAGE RETURN U+000A LINE FEED
-    character pair (CRLF).&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;3&lt;/sub&gt;&lt;/var&gt; be a string consisting
-    of eight random bytes (or equivalently, a random 64 bit unsigned
-    integer encoded in big-endian order).&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;For example, 0x47 0x30 0x22 0x2D 0x5A 0x3F 0x47
-    0x58.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;3&lt;/sub&gt;&lt;/var&gt; to the server.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read bytes from the server until either the connection closes,
-    or a 0x0A byte is read. Let &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; be these
-    bytes, including the 0x0A byte.&lt;/p&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; is not at least seven bytes long,
-    or if the last two bytes aren't 0x0D and 0x0A respectively, or if
-    &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; contains any 0x0D bytes other than the
-    penultimate byte, or if &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; does not contain
-    at least two 0x20 bytes, then &lt;span&gt;fail the WebSocket
-    connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
-
-    &lt;p&gt;User agents may apply a timeout to this step, &lt;span title=&quot;fail
-    the WebSocket connection&quot;&gt;failing the WebSocket
-    connection&lt;/span&gt; if the server does not send back data in a
-    suitable time period.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; be the substring of &lt;var
-    title=&quot;&quot;&gt;field&lt;/var&gt; that starts from the byte after the first
-    0x20 byte, and ends with the byte before the second 0x20 byte.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-&lt;!--(removed since the next step is even stricter)
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; is not three bytes long, or if any
-    of the bytes in &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; are not in the range 0x30
-    to 0x39, then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort
-    these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
-&lt;!--(v2-redirect or v2-ws-auth) - - then change the text below
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;101&quot;,
-    then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;.&lt;/p&gt;
---&gt;
-&lt;!--(v2-redirect)
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is either
-    &quot;&lt;code title=&quot;&quot;&gt;301&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;302&lt;/code&gt;&quot;, &quot;&lt;code
-    title=&quot;&quot;&gt;303&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;307&lt;/code&gt;&quot;, then let &lt;var
-    title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt;.&lt;/p&gt;
---&gt;
-&lt;!--(v2-ws-auth)
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;&lt;code
-    title=&quot;&quot;&gt;401&lt;/code&gt;&quot;, then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i
-    title=&quot;&quot;&gt;authenticate&lt;/i&gt;.&lt;/p&gt;
---&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;101&quot;,
-    then move to the next step.&lt;/p&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;&lt;code
-    title=&quot;&quot;&gt;407&lt;/code&gt;&quot;, then either close the connection and jump
-    back to step 2, providing appropriate authentication information,
-    or &lt;span&gt;fail the WebSocket connection&lt;/span&gt;. 407 is the code
-    used by HTTP meaning &quot;Proxy Authentication Required&quot;. User agents
-    that support proxy authentication must interpret the response as
-    defined by HTTP (e.g. to find and interpret the &lt;code
-    title=&quot;http-Proxy-Authenticate&quot;&gt;Proxy-Authenticate&lt;/code&gt;
-    header).&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort
-    these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; be a list of name-value
-   pairs, initially empty.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li id=&quot;ws-ua-field-loop&quot;&gt;&lt;p&gt;&lt;i title=&quot;&quot;&gt;Field&lt;/i&gt;: Let &lt;var
-   title=&quot;&quot;&gt;name&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be empty byte
-   arrays.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read a byte from the server.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
-    steps.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, handle the byte as described in the appropriate
-    entry below:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the byte is 0x0D (UTF-8 CR)&lt;/dt&gt;
-
-     &lt;dd&gt;If the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte array is empty, then
-     jump to the &lt;a href=&quot;#ws-ua-fields-processing&quot;&gt;fields
-     processing&lt;/a&gt; step. Otherwise, &lt;span&gt;fail the WebSocket
-     connection&lt;/span&gt; and abort these steps.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is 0x0A (UTF-8 LF)&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt; and abort these
-     steps.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is 0x3A (UTF-8 :)&lt;/dt&gt;
-
-     &lt;dd&gt;Move on to the next step.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is in the range 0x41 to 0x5A (UTF-8 A-Z)&lt;/dt&gt;
-
-     &lt;dd&gt;Append a byte whose value is the byte's value plus 0x20 to
-     the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte array and redo this step for
-     the next byte.&lt;/dd&gt;
-
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;Append the byte to the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte
-     array and redo this step for the next byte.&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This reads a field name, terminated by a colon,
-    converting upper-case letters in the range A-Z to lowercase, and
-    aborting if a stray CR or LF is found.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;count&lt;/var&gt; equal 0.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This is used in the next step to skip past a space
-    character after the colon, if necessary.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read a byte from the server and increment &lt;var
-    title=&quot;&quot;&gt;count&lt;/var&gt; by 1.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
-    steps.&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, handle the byte as described in the appropriate
-    entry below:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the byte is 0x20 (UTF-8 space) and &lt;var title=&quot;&quot;&gt;count&lt;/var&gt; equals 1&lt;/dt&gt;
-
-     &lt;dd&gt;Ignore the byte and redo this step for the next byte.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is 0x0D (UTF-8 CR)&lt;/dt&gt;
-
-     &lt;dd&gt;Move on to the next step.&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the byte is 0x0A (UTF-8 LF)&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt; and abort these
-     steps.&lt;/dd&gt;
-
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;Append the byte to the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; byte array
-     and redo this step for the next byte.&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This reads a field value, terminated by a CRLF,
-    skipping past a single space after the colon if there is one.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read a byte from the server.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before this byte is received, or if
-    the byte is not a 0x0A byte (UTF-8 LF), then &lt;span&gt;fail the
-    WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This skips past the LF byte of the CRLF after the
-    field.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Append an entry to the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list that
-    has the name given by the string obtained by interpreting the &lt;var
-    title=&quot;&quot;&gt;name&lt;/var&gt; byte array as a UTF-8 byte stream and the
-    value given by the string obtained by interpreting the &lt;var
-    title=&quot;&quot;&gt;value&lt;/var&gt; byte array as a UTF-8 byte stream.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Return to the &quot;&lt;a href=&quot;#ws-ua-field-loop&quot;&gt;Field&lt;/a&gt;&quot; step
-    above.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li id=&quot;ws-ua-fields-processing&quot;&gt;
-
-    &lt;p&gt;&lt;i&gt;Fields processing&lt;/i&gt;: Read a byte from the server.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before this byte is received, or if
-    the byte is not a 0x0A byte (UTF-8 LF), then &lt;span&gt;fail the
-    WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This skips past the LF byte of the CRLF after the
-    blank line after the fields.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let the &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt; be empty.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;
-    &lt;!--(v2-redirect or v2-ws-auth) If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;, then: --&gt;
-
-    If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;http-upgrade&quot;&gt;upgrade&lt;/code&gt;&quot;, or
-
-    if there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;http-connection&quot;&gt;connection&lt;/code&gt;&quot;, or
-
-    if there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;http-sec-websocket-origin&quot;&gt;sec-websocket-origin&lt;/code&gt;&quot;, or
-
-    if there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;http-sec-websocket-location&quot;&gt;sec-websocket-location&lt;/code&gt;&quot;, or
-
-    if the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; was specified but there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;http-sec-websocket-protocol&quot;&gt;sec-websocket-protocol&lt;/code&gt;&quot;, or
-
-    if there are any entries in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list
-    whose names are the empty string, then &lt;span&gt;fail the WebSocket
-    connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-upgrade&quot;&gt;upgrade&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If the value, &lt;span&gt;converted to ASCII lowercase&lt;/span&gt;,
-     is not exactly equal to the string &quot;websocket&quot;, then &lt;span&gt;fail
-     the WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-connection&quot;&gt;connection&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If the value, &lt;span&gt;converted to ASCII lowercase&lt;/span&gt;,
-     is not exactly equal to the string &quot;upgrade&quot;, then &lt;span&gt;fail the
-     WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-sec-websocket-origin&quot;&gt;sec-websocket-origin&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If the value is not exactly equal to &lt;var
-     title=&quot;&quot;&gt;origin&lt;/var&gt;, then &lt;span&gt;fail the WebSocket
-     connection&lt;/span&gt; and abort these steps. &lt;a
-     href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-sec-websocket-location&quot;&gt;sec-websocket-location&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;If the value is not exactly equal to a string obtained from
-      the steps to &lt;span&gt;construct a WebSocket URL&lt;/span&gt; from &lt;var
-      title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
-      title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-      flag, then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort
-      these steps.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-sec-websocket-protocol&quot;&gt;sec-websocket-protocol&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; list was not empty, and
-      the value is not exactly equal to one of the strings in the &lt;var
-      title=&quot;&quot;&gt;protocols&lt;/var&gt; list, then &lt;span&gt;fail the WebSocket
-      connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
-
-      &lt;p&gt;If the the value contains any characters outside the range
-      U+0021 to U+007F, then &lt;span&gt;fail the WebSocket
-      connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
-
-      &lt;p&gt;Otherwise, let the &lt;dfn&gt;selected WebSocket subprotocol&lt;/dfn&gt;
-      be the entry's value.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-setcookie&quot;&gt;set-cookie&lt;/code&gt;&quot; or &quot;&lt;code
-     title=&quot;http-setcookie2&quot;&gt;set-cookie2&lt;/code&gt;&quot; or another
-     cookie-related field name&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;If the relevant specification is supported by the user agent,
-      add the cookie, interpreted as defined by the appropriate
-      specification, to the &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt;, with
-      the resource being the one with the host &lt;var
-      title=&quot;&quot;&gt;host&lt;/var&gt;, the port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, the path
-      (and possibly query parameters) &lt;var title=&quot;&quot;&gt;resource
-      name&lt;/var&gt;, and the scheme &lt;code title=&quot;&quot;&gt;http&lt;/code&gt; if &lt;var
-      title=&quot;&quot;&gt;secure&lt;/var&gt; is false and &lt;code title=&quot;&quot;&gt;https&lt;/code&gt;
-      if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is true.
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-      &lt;a href=&quot;#refsRFC2109&quot;&gt;[RFC2109]&lt;/a&gt;
-      &lt;a href=&quot;#refsRFC2965&quot;&gt;[RFC2965]&lt;/a&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;
-      &lt;a href=&quot;#refsCOOKIES&quot;&gt;[COOKIES]&lt;/a&gt;
-&lt;!--START websocket-protocol--&gt;
-      &lt;/p&gt;
-
-      &lt;p&gt;If the relevant specification is not supported by the user
-      agent, then the field must be ignored.&lt;/p&gt;
-
-      &lt;p class=&quot;note&quot;&gt;The cookies added to the &lt;var title=&quot;&quot;&gt;list of
-      cookies&lt;/var&gt; are discarded if the connection fails to be
-      established. Only if and when the connection is established do
-      the cookies actually get applied.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;!--UAS: 'Server' --&gt;
-
-
-     &lt;dt&gt;Any other name&lt;/dt&gt;
-
-     &lt;dd&gt;Ignore it.&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-    &lt;hr&gt;
-&lt;!--(v2-redirect)
-redirect support
-we should probably reintroduce this at some point, with the
-multi-origin semantics described in [ORIGIN] applying. (http-origin)
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt;, then:
-    If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;&quot;&gt;location&lt;/code&gt;&quot;, then &lt;span&gt;fail the WebSocket
-    connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;&quot;&gt;location&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;
-
-       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;was secure&lt;/var&gt; have the value of
-       &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from
-       the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain new values for
-       &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
-       title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var
-       title=&quot;&quot;&gt;secure&lt;/var&gt;. If this fails, &lt;span&gt;fail the WebSocket
-       connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;was secure&lt;/var&gt; is true but &lt;var
-       title=&quot;&quot;&gt;secure&lt;/var&gt; is now false, &lt;span&gt;fail the WebSocket
-       connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is a port to which the user
-       agent is configured to block access, then &lt;span&gt;fail the
-       WebSocket connection&lt;/span&gt; and abort these steps. (User agents
-       typically block access to well-known ports like SMTP.)&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Close the connection if the server has not already done
-       so.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;&lt;span&gt;Apply the cookies&lt;/span&gt; in the &lt;var title=&quot;&quot;&gt;list
-       of cookies&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;Jump back to the first step of the overall algorithm
-       (the very top of the handshake).&lt;/p&gt;&lt;/li&gt;
-
-      &lt;/ol&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;dt&gt;Any other name&lt;/dt&gt;
-
-     &lt;dd&gt;Ignore it.&lt;/dd&gt;
-
-    &lt;/dl&gt;
---&gt;
-
-&lt;!--(v2-ws-auth)
-    &lt;hr&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;authenticate&lt;/i&gt;,
-    then: If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;&quot;&gt;www-authenticate&lt;/code&gt;&quot;, then &lt;span&gt;fail the WebSocket
-    connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
-
-    &lt;dl class=&quot;switch&quot;&gt;
-
-     &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;&quot;&gt;www-authenticate&lt;/code&gt;&quot;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;&lt;span&gt;Apply the cookies&lt;/span&gt; in the &lt;var title=&quot;&quot;&gt;list of
-      cookies&lt;/var&gt;, then obtain credentials in a manner consistent
-      with the requirements for handling the
-      &lt;code&gt;WWW-Authenticate&lt;/code&gt; header in HTTP, and then close
-      the connection (if the server has not already done so) and jump
-      back to the step labeled &lt;i&gt;connect&lt;/i&gt;, including the relevant
-      authentication headers in the new request.
---&gt;&lt;!--END complete--&gt;&lt;!--END epub--&gt;&lt;!--
-      &lt;a href=&quot;#refsRFC2616&quot;&gt;[RFC2616]&lt;/a&gt;
---&gt;&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;&lt;!--
-      &lt;a href=&quot;#refsHTTP&quot;&gt;[HTTP]&lt;/a&gt;
---&gt;&lt;!--START websocket-protocol--&gt;&lt;!--
-      &lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Any other name&lt;/dt&gt;
-
-     &lt;dd&gt;Ignore it.&lt;/dd&gt;
-
-    &lt;/dl&gt;
---&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; be the concatenation of &lt;var
-    title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed as a big-endian
-    unsigned 32-bit integer, &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;,
-    expressed as a big-endian unsigned 32-bit integer, and the eight
-    bytes of &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;3&lt;/sub&gt;&lt;/var&gt; in the order they
-    were sent on the wire.&lt;/p&gt;
-
-    &lt;!--
-    perl -e 'foreach (@ARGV) { print pack 'N', $_ }' 777007543 114997259 | hexdump -C
-    --&gt;
-
-    &lt;p class=&quot;example&quot;&gt;Using the examples given earlier, this leads to
-    the 16 bytes 0x2E 0x50 0x31 0xB7 0x06 0xDA 0xB8 0x0B 0x47 0x30
-    0x22 0x2D 0x5A 0x3F 0x47 0x58.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;expected&lt;/var&gt; be the MD5 fingerprint of &lt;var
-    title=&quot;&quot;&gt;challenge&lt;/var&gt; as a big-endian 128 bit string. &lt;a
-    href=&quot;#refsRFC1321&quot;&gt;[RFC1321]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;!--
-    perl -e &quot;print pack 'c*', map { hex } @ARGV&quot; 0x2E 0x50 0x31 0xB7 0x06 0xDA 0xB8 0x0B 0x47 0x30 0x22 0x2D 0x5A 0x3F 0x47 0x58 | md5sum -b
-    --&gt;
-
-    &lt;p class=&quot;example&quot;&gt;Using the examples given earlier, this leads to
-    the 16 bytes 0x30 0x73 0x74 0x33 0x52 0x6C 0x26 0x71 0x2D 0x32
-    0x5A 0x55 0x5E 0x77 0x65 0x75. In UTF-8, these bytes correspond to
-    the string &quot;0st3Rl&amp;q-2ZU^weu&quot;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Read sixteen bytes from the server. Let &lt;var
-    title=&quot;&quot;&gt;reply&lt;/var&gt; be those bytes.&lt;/p&gt;
-
-    &lt;p&gt;If the connection closes before these bytes are received, then
-    &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
-    steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;reply&lt;/var&gt; does not exactly equal &lt;var
-    title=&quot;&quot;&gt;expected&lt;/var&gt;, then &lt;span&gt;fail the WebSocket
-    connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag is not set,
-   &lt;span&gt;apply the cookies&lt;/span&gt; in the &lt;var title=&quot;&quot;&gt;list of
-   cookies&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;The &lt;dfn&gt;WebSocket connection is established&lt;/dfn&gt;. Now the
-    user agent must send and receive to and from the connection as
-    described in the next section.&lt;/p&gt;
-
-    &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag is set, store the
-    &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt; for use by the component that
-    invoked this algorithm.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;Where the algorithm above requires that a user agent &lt;span&gt;fail
-  the WebSocket connection&lt;/span&gt;, the user agent may first read an
-  arbitrary number of further bytes from the connection (and then
-  discard them) before actually &lt;span title=&quot;fail the WebSocket
-  connection&quot;&gt;failing the WebSocket connection&lt;/span&gt;. Similarly, if a
-  user agent can show that the bytes read from the connection so far
-  are such that there is no subsequent sequence of bytes that the
-  server can send that would not result in the user agent being
-  required to &lt;span&gt;fail the WebSocket connection&lt;/span&gt;, the user
-  agent may immediately &lt;span&gt;fail the WebSocket connection&lt;/span&gt;
-  without waiting for those bytes.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The previous paragraph is intended to make it
-  conforming for user agents to implement the algorithm in subtlely
-  different ways that are equivalent in all ways except that they
-  terminate the connection at earlier or later points. For example, it
-  enables an implementation to buffer the entire handshake response
-  before checking it, or to verify each field as it is received rather
-  than collecting all the fields and then checking them as a
-  block.&lt;/p&gt;
-
-  &lt;p&gt;When the user agent is to &lt;dfn&gt;apply the cookies&lt;/dfn&gt; in a &lt;var
-  title=&quot;&quot;&gt;list of cookies&lt;/var&gt;, it must handle each cookie in the
-  &lt;var title=&quot;&quot;&gt;list of cookies&lt;/var&gt; as defined by the appropriate
-  specification.
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-  &lt;a href=&quot;#refsRFC2109&quot;&gt;[RFC2109]&lt;/a&gt;
-  &lt;a href=&quot;#refsRFC2965&quot;&gt;[RFC2965]&lt;/a&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;
-  &lt;a href=&quot;#refsCOOKIES&quot;&gt;[COOKIES]&lt;/a&gt;
-&lt;!--START websocket-protocol--&gt;
-  &lt;/p&gt;
-
-
-  &lt;h6&gt;Data framing&lt;/h6&gt;
-
-  &lt;p&gt;Once a &lt;span&gt;WebSocket connection is established&lt;/span&gt;, the user
-  agent must run through the following state machine for the bytes
-  sent by the server. If at any point during these steps a read is
-  attempted but fails because the &lt;span&gt;WebSocket connection is
-  closed&lt;/span&gt;, then abort.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read a byte from the server. Let &lt;var title=&quot;&quot;&gt;frame
-    type&lt;/var&gt; be that byte.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read eight more bytes from the server. Let &lt;var
-    title=&quot;&quot;&gt;frame length&lt;/var&gt; be the result of interpreting those
-    eight bytes as a big-endian 64 bit unsigned integer.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; bytes from the
-    server. Let &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; be those bytes.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; be false.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; is greater than the length
-    of data the user agent is able to deal with at this time, set &lt;var
-    title=&quot;&quot;&gt;error&lt;/var&gt; to true.&lt;/p&gt;
-
-    &lt;p&gt;User agents should ensure they are always able to deal with
-    lengths up to at least 65536 bytes.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;The minimum expected supported length will likely
-    be increased in future revisions of this protocol.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; is still false, handle the &lt;var
-    title=&quot;&quot;&gt;frame type&lt;/var&gt; byte as follows:&lt;/p&gt;
-
-    &lt;dl&gt;
-
-     &lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is 0x00&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; is not zero, then set
-      &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; to true. Otherwise, run these
-      steps:&lt;/p&gt;
-
-      &lt;ol&gt;
-
-       &lt;li&gt;If &lt;span title=&quot;the WebSocket closing handshake has
-       started&quot;&gt;the WebSocket closing handshake has not yet
-       started&lt;/span&gt;, then &lt;span&gt;start the WebSocket closing
-       handshake&lt;/span&gt;.&lt;/li&gt;
-
-       &lt;li&gt;Wait until either &lt;span&gt;the WebSocket closing handshake
-       has started&lt;/span&gt; or the &lt;span&gt;WebSocket connection is
-       closed&lt;/span&gt;.&lt;/li&gt;
-
-       &lt;li&gt;If the &lt;span title=&quot;WebSocket connection is
-       closed&quot;&gt;WebSocket connection is not already closed&lt;/span&gt;,
-       then &lt;span&gt;close the WebSocket connection&lt;/span&gt;: &lt;dfn&gt;The
-       WebSocket closing handshake has finished&lt;/dfn&gt;. (If the
-       connection closes before this happens, then the closing
-       handshake doesn't finish.)&lt;/li&gt;
-
-       &lt;li&gt;Abort these steps. Any data on the connection after the
-       0x00 frame is discarded.&lt;/li&gt;
-
-      &lt;/ol&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is 0xFF&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;&lt;dfn&gt;A WebSocket message has been received&lt;/dfn&gt; with
-      obtained by interpreting &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; as a UTF-8
-      string.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Otherwise (the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is in the range 0x01 to 0xFE)&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;Set &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; to true.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; is true, then &lt;dfn&gt;a WebSocket
-    error has been detected&lt;/dfn&gt;. Discard &lt;var title=&quot;&quot;&gt;raw
-    data&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return to the first step to read the next byte.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;If the user agent runs out of resources for buffering incoming
-  data, or hits an artificial resource limit intended to avoid
-  resource starvation, then it must &lt;span&gt;fail the WebSocket
-  connection&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;Once a &lt;span&gt;WebSocket connection is established&lt;/span&gt;, but
-  before &lt;span&gt;the WebSocket closing handshake has started&lt;/span&gt;, the
-  user agent must use the following steps to &lt;dfn&gt;send &lt;var
-  title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/dfn&gt;:&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Encode the text in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using UTF-8 to
-   obtain the byte stream &lt;var title=&quot;&quot;&gt;bytes&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send a 0xFF byte to the server.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send the number of bytes in &lt;var title=&quot;&quot;&gt;bytes&lt;/var&gt;, as a
-   64 bit big-endian unsigned integer, to the server.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; to the server.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;Once &lt;span&gt;the WebSocket closing handshake has started&lt;/span&gt;,
-  the user agent must not send any further data on the connection.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;Once a &lt;span&gt;WebSocket connection is established&lt;/span&gt;, the user
-  agent must use the following steps to &lt;dfn&gt;start the WebSocket
-  closing handshake&lt;/dfn&gt;. These steps must be run asynchronously
-  relative to whatever algorithm invoked this one.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;span&gt;the WebSocket closing handshake has started&lt;/span&gt;,
-   then abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send nine 0x00 bytes to the server.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;dfn&gt;The WebSocket closing handshake has started&lt;/dfn&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Wait a user-agent-determined length of time, or until the
-   &lt;span&gt;WebSocket connection is closed&lt;/span&gt;.&lt;/p&gt;
-
-   &lt;li&gt;If the &lt;span title=&quot;WebSocket connection is closed&quot;&gt;WebSocket
-   connection is not already closed&lt;/span&gt;, then &lt;span&gt;close the
-   WebSocket connection&lt;/span&gt;. (If this happens, then the closing
-   handshake doesn't finish.)&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p class=&quot;note&quot;&gt;If the user agent initiates it, the closing
-  handshake &lt;span title=&quot;the WebSocket closing handshake has
-  finished&quot;&gt;finishes&lt;/span&gt; once the server returns the 0x00 frame, as
-  described above.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;If at any point there is a fatal problem with sending data to the
-  server, the user agent must &lt;span&gt;fail the WebSocket
-  connection&lt;/span&gt;.&lt;/p&gt;
-
-
-  &lt;h6&gt;Handling errors in UTF-8 from the server&lt;/h6&gt;
-
-  &lt;p&gt;When a client is to interpret a byte stream as UTF-8 but finds
-  that the byte stream is not in fact a valid UTF-8 stream, then any
-  bytes or sequences of bytes that are not valid UTF-8 sequences must
-  be interpreted as a U+FFFD REPLACEMENT CHARACTER.&lt;/p&gt;
-
-
-
-  &lt;h5&gt;Server-side requirements&lt;/h5&gt;
-
-  &lt;p&gt;&lt;i&gt;This section only applies to servers.&lt;/i&gt;&lt;/p&gt;
-
-  &lt;p&gt;Servers may offload the management of the connection to other
-  agents on the network, for example load balancers and reverse
-  proxies. In such a situation, the server for the purposes of
-  conformance is considered to include all parts of the server-side
-  infrastructure from the first device to terminate the TCP connection
-  all the way to the server that processes requests and sends
-  responses.&lt;/p&gt;
-
-  &lt;div class=&quot;example&quot;&gt;
-
-   &lt;p&gt;For example, a data center might have a server that responds to
-   Web Socket requests with an appropriate handshake, and then passes
-   the connection to another server to actually process the data
-   frames. For the purposes of this specification, the &quot;server&quot; is the
-   combination of both computers.&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-  &lt;h6&gt;Reading the client's opening handshake&lt;/h6&gt;
-
-  &lt;p&gt;When a client starts a WebSocket connection, it sends its part of
-  the opening handshake. The server must parse at least part of this
-  handshake in order to obtain the necessary information to generate
-  the server part of the handshake.&lt;/p&gt;
-
-  &lt;p&gt;The client handshake consists of the following parts. If the
-  server, while reading the handshake, finds that the client did not
-  send a handshake that matches the description below, the server
-  should &lt;span&gt;abort the WebSocket connection&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;The three-character UTF-8 string &quot;GET&quot;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;A UTF-8-encoded U+0020 SPACE character (0x20 byte).&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;A string consisting of all the bytes up to the next
-   UTF-8-encoded U+0020 SPACE character (0x20 byte). The result of
-   decoding this string as a UTF-8 string is the name of the resource
-   requested by the server. If the server only supports one resource,
-   then this can safely be ignored; the client verifies that the right
-   resource is supported based on the information included in the
-   server's own handshake. The resource name will begin with U+002F
-   SOLIDUS character (/) and will only include characters in the range
-   U+0021 to U+007E.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;A string of bytes terminated by a UTF-8-encoded U+000D
-   CARRIAGE RETURN U+000A LINE FEED character pair (CRLF). All the
-   characters from the second 0x20 byte up to the first 0x0D 0x0A byte
-   pair in the data from the client can be safely ignored. (It will
-   probably be the string &quot;HTTP/1.1&quot;.)&lt;/p&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;A series of fields.&lt;/p&gt;
-
-    &lt;p&gt;Each field is terminated by a UTF-8-encoded U+000D CARRIAGE
-    RETURN U+000A LINE FEED character pair (CRLF). The end of the
-    fields is denoted by the terminating CRLF pair being followed
-    immediately by another CRLF pair.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;In other words, the fields start with the first
-    0x0D 0x0A byte pair, end with the first 0x0D 0x0A 0x0D 0x0A byte
-    sequence, and are separate from each other by 0x0D 0x0A byte
-    pairs.&lt;/p&gt;
-
-    &lt;p&gt;The fields are encoded as UTF-8.&lt;/p&gt;
-
-    &lt;p&gt;Each field consists of a name, consisting of one or more
-    characters in the ranges U+0021 to U+0039 and U+003B to U+007E,
-    followed by a U+003A COLON character (:) and a U+0020 SPACE
-    character, followed by zero or more characters forming the
-    value.&lt;/p&gt;
-
-    &lt;p&gt;The expected field names, the meaning of their corresponding
-    values, and the processing servers are required to apply to those
-    fields, are described below, after the description of the client
-    handshake.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;After the first 0x0D 0x0A 0x0D 0x0A byte sequence, indicating
-    the end of the fields, the client sends eight random bytes. These
-    are used in constructing the server handshake.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;The expected field names, and the meaning of their corresponding
-  values, are as follows. Field names must be compared in an
-  &lt;span&gt;ASCII case-insensitive&lt;/span&gt; manner.&lt;/p&gt;
-
-  &lt;dl&gt;
-
-   &lt;dt&gt;&lt;code title=&quot;http-upgrade&quot;&gt;Upgrade&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Invariant part of the handshake. Will always have a value that
-    is an &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the string
-    &quot;WebSocket&quot;.&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server should &lt;span&gt;abort the WebSocket
-    connection&lt;/span&gt; if this field is absent or has a different
-    value, to avoid vulnerability to cross-protocol attacks.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=&quot;http-connection&quot;&gt;Connection&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Invariant part of the handshake. Will always have a value that
-    is an &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the string
-    &quot;Upgrade&quot;.&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server should &lt;span&gt;abort the WebSocket
-    connection&lt;/span&gt; if this field is absent or has a different
-    value, to avoid vulnerability to cross-protocol attacks.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=&quot;http-host&quot;&gt;Host&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The value gives the hostname that the client intended to use
-    when opening the WebSocket. It would be of interest in particular
-    to virtual hosting environments, where one server might serve
-    multiple hosts, and might therefore want to return different
-    data.&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server should &lt;span&gt;abort the WebSocket
-    connection&lt;/span&gt; if this field is absent or has a value that
-    does not match the server's host name, to avoid vulnerability to
-    cross-protocol attacks and DNS rebinding attacks.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=&quot;http-origin&quot;&gt;Origin&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The value gives the scheme, hostname, and port (if it's not the
-    default port for the given scheme) of the page that asked the
-    client to open the WebSocket. It would be interesting if the
-    server's operator had deals with operators of other sites, since
-    the server could then decide how to respond (or indeed,
-    &lt;em&gt;whether&lt;/em&gt; to respond) based on which site was requesting a
-    connection. &lt;a href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server should &lt;span&gt;abort the WebSocket
-    connection&lt;/span&gt; if this field is absent or has a value that
-    does not match one of the origins the server is expecting to
-    communicate with, to avoid vulnerability to cross-protocol attacks
-    and cross-site scripting attacks.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The value gives the names of subprotocols that the client is
-    willing to use, as a space-separated list in the order that the
-    client prefers the protocols. It would be interesting if the
-    server supports multiple protocols or protocol versions.&lt;/p&gt;
-
-    &lt;p&gt;Can be safely ignored, though the server may &lt;span&gt;abort the
-    WebSocket connection&lt;/span&gt; if the field is absent but the
-    conventions for communicating with the server are such that the
-    field is expected; and the server should &lt;span&gt;abort the WebSocket
-    connection&lt;/span&gt; if the field does not contain a value that does
-    matches one of the subprotocols that the server supports, to avoid
-    integrity errors once the connection is established.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-key1&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt;&lt;/dt&gt;
-   &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-key2&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt;&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;The values provide the information required for computing the
-    server's handshake, as described in the next section.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;!--UAS: 'User-Agent' --&gt;
-
-   &lt;dt&gt;Other fields&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Other fields can be used, such as &quot;&lt;code
-    title=&quot;&quot;&gt;Cookie&lt;/code&gt;&quot;&lt;!--(v2-ws-auth) or
-    &quot;&lt;code&gt;Authorization&lt;/code&gt;&quot;--&gt;, for authentication
-    purposes. Their semantics are equivalent to the semantics of the
-    HTTP headers with the same names.&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;
-
-  &lt;p&gt;Unrecognized fields can be safely ignored, and are probably
-  either the result of intermediaries injecting fields unrelated to
-  the operation of the WebSocket protocol, or clients that support
-  future versions of the protocol offering options that the server
-  doesn't support.&lt;/p&gt;
-
-
-  &lt;h6&gt;Sending the server's opening handshake&lt;/h6&gt;
-
-  &lt;p&gt;When a client establishes a WebSocket connection to a server, the
-  server must run the following steps.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the server supports encryption, perform a TLS handshake over
-    the connection. If this fails (e.g. the client indicated a host
-    name in the extended client hello &quot;server_name&quot; extension that the
-    server does not host), then close the connection; otherwise, all
-    further communication for the connection (including the server
-    handshake) must run through the encrypted tunnel. &lt;a
-    href=&quot;#refsRFC2246&quot;&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Servers must support the Next Protocol Negotiation extension in
-    the TLS handshake, advertising support for the
-    &quot;776562736f636b6574&quot; protocol (&quot;websocket&quot; in UTF-8). &lt;a
-    href=&quot;#refsNPN&quot;&gt;[NPN]&lt;/a&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Establish the following information:&lt;/p&gt;
-
-    &lt;dl&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;host&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The host name or IP address of the WebSocket server, as it is
-     to be addressed by clients. The host name must be
-     punycode-encoded if necessary. If the server can respond to
-     requests to multiple hosts (e.g. in a virtual hosting
-     environment), then the value should be derived from the client's
-     handshake, specifically from the &quot;&lt;code
-     title=&quot;http-host&quot;&gt;Host&lt;/code&gt;&quot; field. The &lt;var
-     title=&quot;&quot;&gt;host&lt;/var&gt; value must be lowercase (not containing
-     characters in the range U+0041 LATIN CAPITAL LETTER A to U+005A
-     LATIN CAPITAL LETTER Z).&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The port number on which the server expected and/or received
-     the connection.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;An identifier for the service provided by the server. If the
-     server provides multiple services, then the value should be
-     derived from the resource name given in the client's
-     handshake.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;secure flag&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;True if the connection is encrypted or if the server expected
-     it to be encrypted; false otherwise.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The &lt;span title=&quot;ASCII serialization of an origin&quot;&gt;ASCII
-     serialization&lt;/span&gt; of the origin that the server is willing to
-     communicate with, &lt;span&gt;converted to ASCII lowercase&lt;/span&gt;. If
-     the server can respond to requests from multiple origins (or
-     indeed, all origins), then the value should be derived from the
-     client's handshake, specifically from the &quot;&lt;code
-     title=&quot;http-origin&quot;&gt;Origin&lt;/code&gt;&quot; field. &lt;a
-     href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;Either null, or a string representing the subprotocol the
-     server is ready to use. If the server supports multiple
-     subprotocols, then the value should be derived from the client's
-     handshake, specifically from the &quot;&lt;code
-     title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;&quot;
-     field. The absence of such a field is equivalent to the null
-     value. The empty string is not the same as the null value for
-     these purposes.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The value of the &quot;&lt;code
-     title=&quot;http-sec-websocket-key1&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt;&quot;
-     field in the client's handshake.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The value of the &quot;&lt;code
-     title=&quot;http-sec-websocket-key2&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt;&quot;
-     field in the client's handshake.&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;3&lt;/sub&gt;&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The eight random bytes sent after the first 0x0D 0x0A 0x0D
-     0x0A sequence in the client's handshake.&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; be the string that results
-    from &lt;span title=&quot;construct a WebSocket URL&quot;&gt;constructing a
-    WebSocket URL&lt;/span&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var
-    title=&quot;&quot;&gt;secure flag&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; be the digits (characters
-    in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9)) in
-    &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, interpreted as a base ten integer,
-    ignoring all other characters in &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; be the digits (characters
-    in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9)) in
-    &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, interpreted as a base ten integer,
-    ignoring all other characters in &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;If either &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;
-    or &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; is greater
-    than 4,294,967,295, then &lt;span&gt;abort the WebSocket
-    connection&lt;/span&gt;. This is a symptom of an attack.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;If the client is a conforming client, then both
-    &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var
-    title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; will fit in
-    unsigned 32-bit integers.&lt;/p&gt;
-
-    &lt;div class=&quot;example&quot;&gt;
-
-     &lt;p&gt;For example, assume that the client handshake was:&lt;/p&gt;
-
-     &lt;pre&gt;GET / HTTP/1.1
-Connection: Upgrade
-Host: example.com
-Upgrade: WebSocket
-Sec-WebSocket-Key1: 3e6b263&nbsp;&nbsp;4&nbsp;17&nbsp;80
-Origin: <A HREF="http://example.com">http://example.com</A>
-Sec-WebSocket-Key2: 17&nbsp;&nbsp;9&nbsp;G`ZD9&nbsp;&nbsp;&nbsp;2&nbsp;2b&nbsp;7X&nbsp;3&nbsp;/r90
-
-WjN}|M(6&lt;/pre&gt;
-
-     &lt;p&gt;The &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; would be the number
-     3,626,341,780, and the &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; would be
-     the number 1,799,227,390.&lt;/p&gt;
-
-     &lt;p&gt;In this example, incidentally, &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;3&lt;/sub&gt;&lt;/var&gt; is
-     &quot;WjN}|M(6&quot;, or 0x57 0x6A 0x4E 0x7D 0x7C 0x4D 0x28 0x36.&lt;/p&gt;
-
-    &lt;/div&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; be the number of U+0020 SPACE
-    characters in &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; be the number of U+0020 SPACE
-    characters in &lt;var title=&quot;&quot;&gt;key&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;If either &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; or
-    &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; is zero, then
-    &lt;span&gt;abort the WebSocket connection&lt;/span&gt;. This is a symptom of
-    a cross-protocol attack.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;If the client is a conforming client, then both
-    &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var
-    title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; will easily fit in
-    unsigned 32-bit integers (indeed, they won't be greater than
-    12).&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;In the example above, &lt;var
-    title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; would be 4 and &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;
-    would be 10.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; is not an integral multiple
-    of &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, then &lt;span&gt;abort the WebSocket
-    connection&lt;/span&gt;.&lt;/p&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; is not an integral multiple
-    of &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, then &lt;span&gt;abort the WebSocket
-    connection&lt;/span&gt;.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This can only happen if the client is not a
-    conforming WebSocket client.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; be &lt;var
-    title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt; divided by &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; be &lt;var
-    title=&quot;&quot;&gt;key-number&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; divided by &lt;var title=&quot;&quot;&gt;spaces&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;In the example above, &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;
-    would be 906,585,445 and &lt;var title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt; would be
-    179,922,739.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; be the concatenation of &lt;var
-    title=&quot;&quot;&gt;part&lt;sub title=&quot;&quot;&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed as a
-    big-endian unsigned 32-bit integer, &lt;var title=&quot;&quot;&gt;part&lt;sub
-    title=&quot;&quot;&gt;2&lt;/sub&gt;&lt;/var&gt;, expressed as a big-endian unsigned 32-bit
-    integer, and the eight bytes of &lt;var title=&quot;&quot;&gt;key&lt;sub
-    title=&quot;&quot;&gt;3&lt;/sub&gt;&lt;/var&gt; in the order they were sent on the
-    wire.&lt;/p&gt;
-
-    &lt;!--
-    perl -e 'foreach (@ARGV) { print pack 'N', $_ }' 906585445 179922739 | hexdump -C
-    --&gt;
-
-    &lt;p class=&quot;example&quot;&gt;In the example above, this would be the 16
-    bytes 0x36 0x09 0x65 0x65 0x0A 0xB9 0x67 0x33 0x57 0x6A 0x4E 0x7D
-    0x7C 0x4D 0x28 0x36.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;response&lt;/var&gt; be the MD5 fingerprint of &lt;var
-    title=&quot;&quot;&gt;challenge&lt;/var&gt; as a big-endian 128 bit string. &lt;a
-    href=&quot;#refsRFC1321&quot;&gt;[RFC1321]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;!--
-    perl -e &quot;print pack 'c*', map { hex } @ARGV&quot; 0x36 0x09 0x65 0x65 0x0A 0xB9 0x67 0x33 0x57 0x6A 0x4E 0x7D 0x7C 0x4D 0x28 0x36 | md5sum -b
-    --&gt;
-
-    &lt;p class=&quot;example&quot;&gt;In the example above, this would be the 16
-    bytes 0x6E 0x60 0x39 0x65 0x42 0x6B 0x39 0x7A 0x24 0x52 0x38 0x70
-    0x4F 0x74 0x56 0x62, or &quot;n`9eBk9z$R8pOtVb&quot; in UTF-8.
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send the following line, terminated by the two characters
-    U+000D CARRIAGE RETURN and U+000A LINE FEED (CRLF) and encoded as
-    UTF-8, to the client:&lt;/p&gt;
-
-    &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake&lt;/pre&gt;
-
-    &lt;p&gt;This line may be sent differently if necessary, but must match
-    the Status-Line production defined in the HTTP specification, with
-    the Status-Code having the value 101.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send the following fields to the client. Each field must be
-    sent as a line consisting of the field name, which must be an
-    &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the field name in
-    the list below, followed by a U+003A COLON character (:) and a
-    U+0020 SPACE character, followed by the field value as specified
-    in the list below, followed by the two characters U+000D CARRIAGE
-    RETURN and U+000A LINE FEED (CRLF). The lines must be encoded as
-    UTF-8. The lines may be sent in any order.&lt;/p&gt;
-
-    &lt;dl&gt;
-
-     &lt;dt&gt;&lt;code title=&quot;http-upgrade&quot;&gt;Upgrade&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The value must be the string &quot;WebSocket&quot;.&lt;/p&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;code title=&quot;http-connection&quot;&gt;Connection&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The value must be the string &quot;Upgrade&quot;.&lt;/p&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-location&quot;&gt;Sec-WebSocket-Location&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The value must be &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;&lt;/p&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-origin&quot;&gt;Sec-WebSocket-Origin&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The value must be &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/p&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;This field must be included if &lt;var
-      title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is not null, and must not be included
-      if &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is null.&lt;/p&gt;
-
-      &lt;p&gt;If included, the value must be &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-    &lt;p&gt;Optionally, include &quot;&lt;code
-    title=&quot;http-setcookie&quot;&gt;Set-Cookie&lt;/code&gt;&quot;, &quot;&lt;code
-    title=&quot;http-setcookie2&quot;&gt;Set-Cookie2&lt;/code&gt;&quot;, or other
-    cookie-related fields, with values equal to the values that would
-    be used for the identically named HTTP headers.
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-     &lt;a href=&quot;#refsRFC2109&quot;&gt;[RFC2109]&lt;/a&gt;
-     &lt;a href=&quot;#refsRFC2965&quot;&gt;[RFC2965]&lt;/a&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;
-     &lt;a href=&quot;#refsCOOKIES&quot;&gt;[COOKIES]&lt;/a&gt;
-&lt;!--START websocket-protocol--&gt;
-    &lt;/p&gt;
-
-    &lt;!--UAS: optionally, include 'Server:' field --&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send two bytes 0x0D 0x0A (UTF-8 CRLF).&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Send &lt;var title=&quot;&quot;&gt;response&lt;/var&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;This completes the server's handshake. If the server finishes
-  these steps without &lt;span title=&quot;abort the WebSocket
-  connection&quot;&gt;aborting the WebSocket connection&lt;/span&gt;, and if the
-  client does not then &lt;span&gt;fail the WebSocket connection&lt;/span&gt;,
-  then the connection is established and the server may begin and
-  receiving sending data, as described in the next section.&lt;/p&gt;
-
-
-
-  &lt;h6 id=&quot;ws-sd-framing&quot;&gt;Data framing&lt;/h6&gt;
-
-  &lt;p&gt;The server must run through the following steps to process the
-  bytes sent by the client. If at any point during these steps a read
-  is attempted but fails because the &lt;span&gt;WebSocket connection is
-  closed&lt;/span&gt;, then abort.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read a byte from the client. Let &lt;var title=&quot;&quot;&gt;frame
-    type&lt;/var&gt; be that byte.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read eight more bytes from the client. Let &lt;var
-    title=&quot;&quot;&gt;frame length&lt;/var&gt; be the result of interpreting those
-    eight bytes as a big-endian 64 bit unsigned integer.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Try to read &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; bytes from the
-    client. Let &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; be those bytes.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; is greater than the length
-    of data the server is able to deal with at this time, the server
-    may abort these steps and either immediately disconnect from the
-    client or set the &lt;var title=&quot;&quot;&gt;client terminated&lt;/var&gt;
-    flag. Alternatively, the server may just discard this frame and
-    jump back to the first step.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Handle the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte as follows:&lt;/p&gt;
-
-    &lt;dl&gt;
-
-     &lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is 0x00 and the &lt;var title=&quot;&quot;&gt;frame length&lt;/var&gt; is 0&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;Set the &lt;var title=&quot;&quot;&gt;client terminated&lt;/var&gt; flag and abort
-      these steps. All further data sent by the client should be
-      discarded.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;If the &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; byte is 0xFF&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;Interpret &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; as a UTF-8 string, and
-      apply whatever server-specific processing is to occur for the
-      resulting string (the message from the client).&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;The server may abort these steps and either immediately
-      disconnect from the client or set the &lt;var title=&quot;&quot;&gt;client
-      terminated&lt;/var&gt; flag.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return to the first step to read the next byte.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;The server must run through the following steps to send strings
-  to the client:&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Encode the text using UTF-8 to obtain the byte stream &lt;var
-   title=&quot;&quot;&gt;raw data&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send a 0xFF byte to the client.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send the number of bytes in &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt;, as
-   a 64 bit big-endian unsigned integer, to the client.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Send &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; to the client.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;At any time, the server may decide to terminate the WebSocket
-  connection by running through the following steps. These steps
-  should be run when the &lt;var title=&quot;&quot;&gt;client terminated&lt;/var&gt; flag is
-  set, if they aren't already running.&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Send nine 0x00 bytes to the client to indicate the start of
-   the closing handshake.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Wait until the &lt;var title=&quot;&quot;&gt;client terminated&lt;/var&gt; flag
-   has been set, or until a server-defined timeout expires.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Close the WebSocket connection&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;Once these steps have started, the server must not send any
-  further data to the client. The nine 0x00 bytes indicate the end of
-  the server's data, and further bytes will be discarded by the
-  client.&lt;/p&gt;
-
-
-  &lt;h6&gt;Handling errors in UTF-8 from the client&lt;/h6&gt;
-
-  &lt;p&gt;When a server is to interpret a byte stream as UTF-8 but finds
-  that the byte stream is not in fact a valid UTF-8 stream, behavior
-  is undefined. A server could close the connection, convert invalid
-  byte sequences to U+FFFD REPLACEMENT CHARACTERs, store the data
-  verbatim, or perform application-specific processing. Subprotocols
-  layered on the WebSocket protocol might define specific behavior
-  for servers.&lt;/p&gt;
-
-
-
-  &lt;h5&gt;Closing the connection&lt;/h5&gt;
-
-  &lt;h6&gt;Client-initiated closure&lt;/h6&gt;
-
-  &lt;p&gt;Certain algorithms require the user agent to &lt;dfn&gt;fail the
-  WebSocket connection&lt;/dfn&gt;. To do so, the user agent must
-  &lt;span&gt;close the WebSocket connection&lt;/span&gt;, and may report the
-  problem to the user (which would be especially useful for
-  developers).&lt;/p&gt;
-
-  &lt;p&gt;Except as indicated above or as specified by the application
-  layer (e.g. a script using the WebSocket API), user agents should
-  not close the connection.&lt;/p&gt;
-
-  &lt;p&gt;User agents must not convey any failure information to scripts in
-  a way that would allow a script to distinguish the following
-  situations:&lt;/p&gt;
-
-  &lt;ul&gt;
-
-   &lt;li&gt;A server whose host name could not be resolved.&lt;/li&gt;
-
-   &lt;li&gt;A server to which packets could not successfully be
-   routed.&lt;/li&gt;
-
-   &lt;li&gt;A server that refused the connection on the specified
-   port.&lt;/li&gt;
-
-   &lt;li&gt;A server that did not complete the opening handshake
-   (e.g. because it was not a WebSocket server).&lt;/li&gt;
-
-   &lt;li&gt;A WebSocket server that sent a correct opening handshake, but
-   that specified options that caused the client to drop the
-   connection (e.g. the server specified an origin that differed from
-   the script's).&lt;/li&gt;
-
-   &lt;li&gt;A WebSocket server that abruptly closed the connection after
-   successfully completing the opening handshake.&lt;/li&gt;
-
-  &lt;/ul&gt;
-
-
-  &lt;h6&gt;Server-initiated closure&lt;/h6&gt;
-
-  &lt;p&gt;Certain algorithms require or recommend that the server
-  &lt;dfn&gt;abort the WebSocket connection&lt;/dfn&gt; during the opening
-  handshake. To do so, the server must simply &lt;span&gt;close the
-  WebSocket connection&lt;/span&gt;.&lt;/p&gt;
-
-
-  &lt;h6&gt;Closure&lt;/h6&gt;
-
-  &lt;p&gt;To &lt;dfn&gt;close the WebSocket connection&lt;/dfn&gt;, the user agent or
-  server must close the TCP connection, using whatever mechanism
-  possible (e.g. either the TCP RST or FIN mechanisms). When a user
-  agent notices that the server has closed its connection, it must
-  immediately close its side of the connection also. Whether the user
-  agent or the server closes the connection first, it is said that the
-  &lt;dfn&gt;WebSocket connection is closed&lt;/dfn&gt;. If the connection was
-  closed after the client &lt;span title=&quot;the WebSocket closing handshake
-  has finished&quot;&gt;finished the WebSocket closing handshake&lt;/span&gt;, then
-  the WebSocket connection is said to have been closed &lt;i
-  title=&quot;&quot;&gt;cleanly&lt;/i&gt;.&lt;/p&gt;
-
-  &lt;p&gt;Servers may &lt;span&gt;close the WebSocket connection&lt;/span&gt; whenever
-  desired. User agents should not &lt;span&gt;close the WebSocket
-  connection&lt;/span&gt; arbitrarily.&lt;/p&gt;
-
-
-  &lt;h5&gt;Security considerations&lt;/h5&gt;
-
-  &lt;p&gt;While this protocol is intended to be used by scripts in Web
-  pages, it can also be used directly by hosts. Such hosts are acting
-  on their own behalf, and can therefore send fake &quot;Origin&quot; fields,
-  misleading the server. Servers should therefore be careful about
-  assuming that they are talking directly to scripts from known
-  origins, and must consider that they might be accessed in unexpected
-  ways. In particular, a server should not trust that any input is
-  valid.&lt;/p&gt;
-
-  &lt;p class=&quot;example&quot;&gt;For example, if the server uses input as part of
-  SQL queries, all input text should be escaped before being passed to
-  the SQL server, lest the server be susceptible to SQL injection.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;Servers that are not intended to process input from any Web page
-  but only for certain sites should verify the &quot;Origin&quot; field is an
-  origin they expect, and should only respond with the corresponding
-  &quot;Sec-WebSocket-Origin&quot; if it is an accepted origin. Servers that
-  only accept input from one origin can just send back that value in
-  the &quot;Sec-WebSocket-Origin&quot; field, without bothering to check the
-  client's value.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;If at any time a server is faced with data that it does not
-  understand, or that violates some criteria by which the server
-  determines safety of input, or when the server sees a handshake that
-  does not correspond to the values the server is expecting
-  (e.g. incorrect path or origin), the server should just
-  disconnect. It is always safe to disconnect.&lt;/p&gt;
-
-  &lt;hr&gt;
-
-  &lt;p&gt;The biggest security risk when sending text data using this
-  protocol is sending data using the wrong encoding. If an attacker
-  can trick the server into sending data encoded as ISO-8859-1
-  verbatim (for instance), rather than encoded as UTF-8, then the
-  attacker could inject arbitrary frames into the data stream.&lt;/p&gt;
-
-
-  &lt;h5&gt;IANA considerations&lt;/h5&gt;
-
-  &lt;h6&gt;Registration of &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; scheme&lt;/h6&gt;
-
-  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; URL identifies a WebSocket server
-  and resource name.&lt;/p&gt;
-
-  &lt;dl&gt;
-
-   &lt;dt&gt;URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;ws&lt;/dd&gt;
-
-   &lt;dt&gt;Status.&lt;/dt&gt;
-   &lt;dd&gt;Permanent.&lt;/dd&gt;
-
-   &lt;dt&gt;URI scheme syntax.&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;In ABNF terms using the terminals from the URI specifications:
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-    &lt;a href=&quot;#refsRFC5234&quot;&gt;[RFC5234]&lt;/a&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;
-    &lt;a href=&quot;#refsABNF&quot;&gt;[ABNF]&lt;/a&gt;
-&lt;!--START websocket-protocol--&gt;
-    &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;
-    &lt;/p&gt;
-    &lt;pre&gt;&quot;ws&quot; &quot;:&quot; hier-part [ &quot;?&quot; query ]&lt;/pre&gt;
-    &lt;p&gt;The path and query components form the resource name sent to
-    the server to identify the kind of service desired. Other
-    components have the meanings described in RFC3986.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;URI scheme semantics.&lt;/dt&gt;
-   &lt;dd&gt;The only operation for this scheme is to open a connection
-   using the WebSocket protocol.&lt;/dd&gt;
-
-   &lt;dt&gt;Encoding considerations.&lt;/dt&gt;
-   &lt;dd&gt;
-
-    &lt;p&gt;Characters in the host component that are excluded by the
-    syntax defined above must be converted from Unicode to ASCII by
-    applying the IDNA ToASCII algorithm to the Unicode host name, with
-    both the AllowUnassigned and UseSTD3ASCIIRules flags set, and
-    using the result of this algorithm as the host in the URI. &lt;a
-    href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Characters in other components that are excluded by the syntax
-    defined above must be converted from Unicode to ASCII by first
-    encoding the characters as UTF-8 and then replacing the
-    corresponding bytes using their percent-encoded form as defined in
-    the URI and IRI specification. &lt;a
-    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;Applications/protocols that use this URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;WebSocket protocol.&lt;/dd&gt;
-
-   &lt;dt&gt;Interoperability considerations.&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-
-   &lt;dt&gt;Security considerations.&lt;/dt&gt;
-   &lt;dd&gt;See &quot;Security considerations&quot; section above.&lt;/dd&gt;
-
-   &lt;dt&gt;Contact.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;Author/Change controller.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;References.&lt;/dt&gt;
-   &lt;dd&gt;This document.&lt;/dd&gt;
-
-  &lt;/dl&gt;
-
-
-  &lt;h6&gt;Registration of &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; scheme&lt;/h6&gt;
-
-  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; URL identifies a WebSocket server
-  and resource name, and indicates that traffic over that connection
-  is to be encrypted.&lt;/p&gt;
-
-  &lt;dl&gt;
-
-   &lt;dt&gt;URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;wss&lt;/dd&gt;
-
-   &lt;dt&gt;Status.&lt;/dt&gt;
-   &lt;dd&gt;Permanent.&lt;/dd&gt;
-
-   &lt;dt&gt;URI scheme syntax.&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;In ABNF terms using the terminals from the URI specifications:
-&lt;!--END complete--&gt;&lt;!--END epub--&gt;
-    &lt;a href=&quot;#refsRFC5234&quot;&gt;[RFC5234]&lt;/a&gt;
-&lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--END websocket-protocol--&gt;
-    &lt;a href=&quot;#refsABNF&quot;&gt;[ABNF]&lt;/a&gt;
-&lt;!--START websocket-protocol--&gt;
-    &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-    &lt;pre&gt;&quot;wss&quot; &quot;:&quot; hier-part [ &quot;?&quot; query ]&lt;/pre&gt;
-    &lt;p&gt;The path and query components form the resource name sent to
-    the server to identify the kind of service desired. Other
-    components have the meanings described in RFC3986.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;URI scheme semantics.&lt;/dt&gt;
-   &lt;dd&gt;The only operation for this scheme is to open a connection
-   using the WebSocket protocol, encrypted using TLS.&lt;/dd&gt;
-
-   &lt;dt&gt;Encoding considerations.&lt;/dt&gt;
-   &lt;dd&gt;
-
-    &lt;p&gt;Characters in the host component that are excluded by the
-    syntax defined above must be converted from Unicode to ASCII by
-    applying the IDNA ToASCII algorithm to the Unicode host name, with
-    both the AllowUnassigned and UseSTD3ASCIIRules flags set, and
-    using the result of this algorithm as the host in the URI. &lt;a
-    href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Characters in other components that are excluded by the syntax
-    defined above must be converted from Unicode to ASCII by first
-    encoding the characters as UTF-8 and then replacing the
-    corresponding bytes using their percent-encoded form as defined in
-    the URI and IRI specification. &lt;a
-    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/dd&gt;
-
-   &lt;dt&gt;Applications/protocols that use this URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;WebSocket protocol over TLS.&lt;/dd&gt;
-
-   &lt;dt&gt;Interoperability considerations.&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-
-   &lt;dt&gt;Security considerations.&lt;/dt&gt;
-   &lt;dd&gt;See &quot;Security considerations&quot; section above.&lt;/dd&gt;
-
-   &lt;dt&gt;Contact.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;Author/Change controller.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;References.&lt;/dt&gt;
-   &lt;dd&gt;This document.&lt;/dd&gt;
-
-  &lt;/dl&gt;
-
-
-  &lt;h6&gt;Registration of the &quot;&lt;code title=&quot;&quot;&gt;WebSocket&lt;/code&gt;&quot; HTTP Upgrade keyword&lt;/h6&gt;
-
-  &lt;dl&gt;
-
-   &lt;dt&gt;Name of token.&lt;/dt&gt;
-   &lt;dd&gt;WebSocket&lt;/dd&gt;
-
-   &lt;dt&gt;Author/Change controller.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;Contact.&lt;/dt&gt;
-   &lt;dd&gt;Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">ian at hixie.ch</A>&gt;&lt;/dd&gt;
-
-   &lt;dt&gt;References.&lt;/dt&gt;
-   &lt;dd&gt;This document.&lt;/dd&gt;
-
-  &lt;/dl&gt;
-
-
-
-  &lt;h6&gt;&lt;dfn title=&quot;http-sec-websocket-key1&quot;&gt;&lt;code&gt;Sec-WebSocket-Key1&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn title=&quot;http-sec-websocket-key2&quot;&gt;&lt;code&gt;Sec-WebSocket-Key2&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
-
-  &lt;p&gt;This section describes two header fields for registration in the
-  Permanent Message Header Field Registry.  &lt;a
-  href=&quot;#refsRFC3864&quot;&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;dl&gt;
-   &lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Key1&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;
-
-  &lt;dl&gt;
-   &lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Key2&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;
-
-  &lt;p&gt;The &lt;code
-  title=&quot;http-sec-websocket-key1&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt; and &lt;code
-  title=&quot;http-sec-websocket-key2&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt; headers
-  are used in the WebSocket handshake. They are sent from the client
-  to the server to provide part of the information used by the server
-  to prove that it received a valid WebSocket handshake. This helps
-  ensure that the server does not accept connections from
-  non-Web-Socket clients (e.g. HTTP clients) that are being abused to
-  send data to unsuspecting WebSocket servers.&lt;/p&gt;
-
-
-  &lt;h6&gt;&lt;dfn title=&quot;http-sec-websocket-location&quot;&gt;&lt;code&gt;Sec-WebSocket-Location&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
-
-  &lt;p&gt;This section describes a header field for registration in the
-  Permanent Message Header Field Registry.  &lt;a
-  href=&quot;#refsRFC3864&quot;&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;dl&gt;
-   &lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Location&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;
-
-  &lt;p&gt;The &lt;code
-  title=&quot;http-sec-websocket-location&quot;&gt;Sec-WebSocket-Location&lt;/code&gt;
-  header is used in the WebSocket handshake. It is sent from the
-  server to the client to confirm the &lt;span&gt;URL&lt;/span&gt; of the
-  connection. This enables the client to verify that the connection
-  was established to the right server, port, and path, instead of
-  relying on the server to verify that the requested host, port, and
-  path are correct.&lt;/p&gt;
-
-
-  &lt;h6&gt;&lt;dfn title=&quot;http-sec-websocket-origin&quot;&gt;&lt;code&gt;Sec-WebSocket-Origin&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
-
-  &lt;p&gt;This section describes a header field for registration in the
-  Permanent Message Header Field Registry.  &lt;a
-  href=&quot;#refsRFC3864&quot;&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;dl&gt;
-   &lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Origin&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;
-
-  &lt;p&gt;The &lt;code
-  title=&quot;http-sec-websocket-origin&quot;&gt;Sec-WebSocket-Origin&lt;/code&gt; header
-  is used in the WebSocket handshake. It is sent from the server to
-  the client to confirm the &lt;span&gt;origin&lt;/span&gt; of the script that
-  opened the connection. This enables user agents to verify that the
-  server is willing to serve the script that opened the
-  connection.&lt;/p&gt;
-
-
-  &lt;h6&gt;&lt;dfn title=&quot;http-sec-websocket-protocol&quot;&gt;&lt;code&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
-
-  &lt;p&gt;This section describes a header field for registration in the
-  Permanent Message Header Field Registry.  &lt;a
-  href=&quot;#refsRFC3864&quot;&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;dl&gt;
-   &lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;Sec-WebSocket-Protocol&lt;/dd&gt;
-   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
-   &lt;dd&gt;http&lt;/dd&gt;
-   &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
-   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
-   &lt;dd&gt;IETF&lt;/dd&gt;
-   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
-   &lt;dd&gt;
-    This document is the relevant specification.
-   &lt;/dd&gt;
-   &lt;dt&gt;Related information&lt;/dt&gt;
-   &lt;dd&gt;None.&lt;/dd&gt;
-  &lt;/dl&gt;
-
-  &lt;p&gt;The &lt;code
-  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;
-  header is used in the WebSocket handshake. It is sent from the
-  client to the server and back from the server to the client to
-  confirm the subprotocol of the connection. This enables scripts to
-  both select a subprotocol and be sure that the server agreed to
-  serve that subprotocol.&lt;/p&gt;
-
-
-
-
-  &lt;h5&gt;Using the WebSocket protocol from other specifications&lt;/h5&gt;
-
-  &lt;p&gt;The WebSocket protocol is intended to be used by another
-  specification to provide a generic mechanism for dynamic
-  author-defined content, e.g. in a specification defining a scripted
-  API.&lt;/p&gt;
-
-  &lt;p&gt;Such a specification first needs to &quot;&lt;span&gt;establish a WebSocket
-  connection&lt;/span&gt;&quot;, providing that algorithm with:&lt;/p&gt;
-
-  &lt;ul&gt;
-
-   &lt;li&gt;The destination, consisting of a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and a
-   &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, which allows for multiple
-   services to be identified at one host and port.&lt;/li&gt;
-
-   &lt;li&gt;A &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag, which is true if the
-   connection is to be encrypted, and false otherwise.&lt;/li&gt;
-
-   &lt;li&gt;An &lt;span&gt;ASCII serialization of an origin&lt;/span&gt; that is being
-   made responsible for the connection. &lt;a
-   href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;Optionally a string identifying a &lt;span&gt;protocol&lt;/span&gt; that is
-   to be layered over the WebSocket connection.&lt;/li&gt;
-
-  &lt;/ul&gt;
-
-  &lt;p&gt;The &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
-  title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag
-  are usually obtained from a &lt;span&gt;URL&lt;/span&gt; using the steps to
-  &lt;span&gt;parse a WebSocket URL's components&lt;/span&gt;. These steps fail
-  if the URL does not specify a WebSocket.&lt;/p&gt;
-
-  &lt;p&gt;If a connection can be established, then it is said that the
-  &quot;&lt;span&gt;WebSocket connection is established&lt;/span&gt;&quot;.&lt;/p&gt;
-
-  &lt;p&gt;If at any time the connection is to be closed, then the
-  specification needs to use the &quot;&lt;span&gt;close the WebSocket
-  connection&lt;/span&gt;&quot; algorithm.&lt;/p&gt;
-
-  &lt;p&gt;When the connection is closed, for any reason including failure
-  to establish the connection in the first place, it is said that the
-  &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;.&lt;/p&gt;
-
-  &lt;p&gt;While a connection is open, the specification will need to handle
-  the cases when &quot;&lt;span&gt;a WebSocket message has been received&lt;/span&gt;&quot;
-  with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;.&lt;/p&gt;
-
-  &lt;p&gt;To send some text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; to an open connection,
-  the specification needs to &quot;&lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;
-  using the WebSocket&lt;/span&gt;&quot;.&lt;/p&gt;
-
-
-  &lt;!--END complete--&gt;&lt;!--END epub--&gt;
-
-  &lt;h5&gt;Acknowledgements&lt;/h5&gt;
-
-  &lt;p&gt;The WebSocket protocol is the result of many years of
-  development, and as such hundreds of people have contributed to the
-  specification during its lifetime. Unfortunately, since the
-  specification started as nothing but a minor section of the larger
-  WHATWG Web Applications 1.0 specification, and later the HTML5
-  specification, no record was kept of who exactly contributed to what
-  ended up becoming this specification as opposed to who contributed
-  to other parts of that document.&lt;/p&gt;
-
-  &lt;p&gt;The reader is therefore referred to the Acknowledgements section
-  of the WHATWG HTML specification for a full list of all
-  contributions that have been made to the source document from which
-  this specification is generated. &lt;a href=&quot;#refsHTML&quot;&gt;[HTML]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;!--END websocket-protocol--&gt;
-  &lt;!--END websocket--&gt;
-
-  &lt;!--START complete--&gt;&lt;!--START epub--&gt;
   &lt;!--START html--&gt;
 
-  &lt;/div&gt;&lt;!--data-component--&gt;
 
 
 
-
   &lt;div data-component=&quot;Web Messaging (editor: Ian Hickson)&quot;&gt;
 
   &lt;!--START postmsg--&gt;
@@ -109662,13 +106518,10 @@
    &lt;dt id=&quot;refsWIN949&quot;&gt;[WIN949]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.microsoft.com/globaldev/reference/dbcs/949.mspx">http://www.microsoft.com/globaldev/reference/dbcs/949.mspx</A>&quot;&gt;Windows Codepage 949&lt;/a&gt;&lt;/cite&gt;. Microsoft.&lt;/dd&gt;
 
-   &lt;dt id=&quot;refsWSAPI&quot;&gt;[WSAPI]&lt;/dt&gt;
-   &lt;!--
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</A>&quot;&gt;WebSocket
-   API&lt;/a&gt;&lt;/cite&gt;, I. Hickson. W3C.&lt;/dd&gt;
-   --&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&quot;&gt;WebSocket
-   API&lt;/a&gt;&lt;/cite&gt;, I. Hickson. W3C.&lt;/dd&gt;
+   &lt;dt id=&quot;refsWSP&quot;&gt;[WSP]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a
+   href=&quot;<A HREF="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol">http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol</A>&quot;&gt;The
+   WebSocket protocol&lt;/a&gt;&lt;/cite&gt;, I. Fette. IETF.&lt;/dd&gt;
 
    &lt;dt id=&quot;refsX121&quot;&gt;[X121]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;Recommendation X.121 &mdash; International Numbering Plan for


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012276.html">[html5] r5408 - [] (0) minor changes to ConnectionPeer to reflect	some feedback on requirements
</A></li>
	<LI>Next message: <A HREF="012278.html">[html5] r5410 - [e] (0) typos
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12277">[ date ]</a>
              <a href="thread.html#12277">[ thread ]</a>
              <a href="subject.html#12277">[ subject ]</a>
              <a href="author.html#12277">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
