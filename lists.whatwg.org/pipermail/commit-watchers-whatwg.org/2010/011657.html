<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r4789 - [giow] (0) Make 'Referer' work correctly for	scripts in shared workers. (For som [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4789%20-%20%5Bgiow%5D%20%280%29%20Make%20%27Referer%27%20work%20correctly%20for%0A%09scripts%20in%20shared%20workers.%20%28For%20som%20%5B...%5D&In-Reply-To=%3C20100223015308.3927B1C85130%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011656.html">
   <LINK REL="Next"  HREF="011658.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r4789 - [giow] (0) Make 'Referer' work correctly for	scripts in shared workers. (For som [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4789%20-%20%5Bgiow%5D%20%280%29%20Make%20%27Referer%27%20work%20correctly%20for%0A%09scripts%20in%20shared%20workers.%20%28For%20som%20%5B...%5D&In-Reply-To=%3C20100223015308.3927B1C85130%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r4789 - [giow] (0) Make 'Referer' work correctly for	scripts in shared workers. (For som [...]">whatwg at whatwg.org
       </A><BR>
    <I>Mon Feb 22 17:53:08 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="011656.html">[html5] r4788 - [e] (0) update the straw man dataTransfer.items	proposal
</A></li>
        <LI>Next message: <A HREF="011658.html">[html5] r4790 - [e] (0) xref errors Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=9020
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11657">[ date ]</a>
              <a href="thread.html#11657">[ thread ]</a>
              <a href="subject.html#11657">[ subject ]</a>
              <a href="author.html#11657">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-02-22 17:53:06 -0800 (Mon, 22 Feb 2010)
New Revision: 4789

Modified:
   complete.html
   index
   source
Log:
[giow] (0) Make 'Referer' work correctly for scripts in shared workers. (For some definition of 'correctly' -- it uses the URL of the document that actually created the script. Arguably it should use the URL of the script itself. However, this doesn't change that, it just makes it not leak the URL of documents that that document's browsing context is navigated to.)

Modified: complete.html
===================================================================
--- complete.html	2010-02-22 23:54:26 UTC (rev 4788)
+++ complete.html	2010-02-23 01:53:06 UTC (rev 4789)
@@ -157,7 +157,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;Web Applications 1.0&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 22 February 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 23 February 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -5247,9 +5247,8 @@
 
      &lt;dt&gt;When fetching resources in response to a call to an API&lt;/dt&gt;
 
-     &lt;dd&gt;The &lt;a href=#active-document&gt;active document&lt;/a&gt; of the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's
-     browsing context&quot;&gt;browsing context&lt;/a&gt; of the &lt;a href=#entry-script&gt;entry
-     script&lt;/a&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+     document&quot;&gt;document&lt;/a&gt;.&lt;/dd&gt;
 
     &lt;/dl&gt;&lt;p&gt;Remove any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
     component from the generated &lt;i&gt;address of the resource from which
@@ -6801,8 +6800,7 @@
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created by a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; using the &lt;code title=dom-DOMImplementation-createDocument&gt;createDocument()&lt;/code&gt;
   or &lt;code title=dom-DOMHTMLImplementation-createHTMLDocument&gt;&lt;a href=#dom-domhtmlimplementation-createhtmldocument&gt;createHTMLDocument()&lt;/a&gt;&lt;/code&gt;
   APIs, &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; is the same as &lt;a href=&quot;#the-document's-address&quot;&gt;the
-  document's address&lt;/a&gt; of the &lt;a href=#active-document&gt;active document&lt;/a&gt; of the
-  &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;.&lt;/p&gt;
+  document's address&lt;/a&gt; of the &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;&lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects are assumed to be &lt;dfn id=xml-documents&gt;XML
   documents&lt;/dfn&gt; unless they are flagged as being &lt;dfn id=html-documents&gt;HTML
@@ -10020,9 +10018,9 @@
    UTF-16.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Change &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; to the
-   &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
-   context&quot;&gt;browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;'s
-   &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt;.&lt;/li&gt;
+   &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+   document&quot;&gt;document&lt;/a&gt;'s &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's
+   address&quot;&gt;address&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Create a new &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; and associate it with
    the document. This is a &lt;dfn id=script-created-parser&gt;script-created parser&lt;/dfn&gt; (meaning
@@ -52905,6 +52903,11 @@
   &lt;a href=#view title=view&gt;views&lt;/a&gt; and their &lt;code&gt;AbstractView&lt;/code&gt;
   objects.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; has a strong
+  reference to its &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing
+  context&lt;/a&gt; and its &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+  document&quot;&gt;document&lt;/a&gt;.&lt;/p&gt;
+
   &lt;p&gt;When a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is to &lt;dfn id=discard-a-document&gt;discard a
   &lt;code&gt;Document&lt;/code&gt;&lt;/dfn&gt;, the user agent must run the following
   steps:&lt;/p&gt;
@@ -53907,11 +53910,9 @@
 
      &lt;li&gt;If the &lt;a href=#origin&gt;origin&lt;/a&gt; of the resulting &lt;a href=#absolute-url&gt;absolute
      URL&lt;/a&gt; is not the same as the &lt;a href=#origin&gt;origin&lt;/a&gt; of the
-     &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
-     context&quot;&gt;browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;,
-     and either the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; or
-     &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components of the
-     two &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; compared in the previous step
+     &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+     document&quot;&gt;document&lt;/a&gt;, and either the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; or &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components of the two
+     &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; compared in the previous step
      differ, raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception and abort
      these steps. (This prevents sandboxed content from spoofing other
      pages on the same origin.)&lt;/li&gt;
@@ -57773,6 +57774,19 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;A relationship with the &lt;dfn id=&quot;script's-document&quot;&gt;script's document&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;A &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that is assigned responsibility for
+    actions taken by the script.&lt;/p&gt;
+
+    &lt;p class=example&gt;When a script &lt;a href=#fetch title=fetch&gt;fetches&lt;/a&gt; a resource, the &lt;a href=&quot;#the-document's-current-address&quot; title=&quot;the
+    document's current address&quot;&gt;current address&lt;/a&gt; of the
+    &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt; will be used to set the &lt;code title=http-referer&gt;Referer&lt;/code&gt; (sic) header.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;A &lt;dfn id=&quot;script's-url-character-encoding&quot; title=&quot;script's URL character encoding&quot;&gt;URL character encoding&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -57857,9 +57871,10 @@
    entry-point&lt;/a&gt;&lt;/i&gt; is the entry-point for that code.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set up the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global object&lt;/a&gt;, the
-   &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL
-   character encoding&lt;/a&gt;, and the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt;
-   from the settings passed to this algorithm.&lt;/li&gt;
+   &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, the &lt;a href=&quot;#script's-document&quot;&gt;script's
+   document&lt;/a&gt;, the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character encoding&lt;/a&gt;,
+   and the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt; from the settings passed to
+   this algorithm.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;a href=#jump-to-a-code-entry-point title=&quot;jump to a code entry-point&quot;&gt;Jump&lt;/a&gt; to the
    &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;i&gt;&lt;a href=#initial-code-entry-point&gt;initial code
@@ -58026,8 +58041,7 @@
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, then it is the &lt;a href=#browsing-context&gt;browsing
   context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt; at the time the task
   was queued; if the task was queued by or for a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; then the document is the
-  &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active
-  document&lt;/a&gt; at the time the task was queued.&lt;/p&gt;
+  &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;A user agent is required to have one &lt;dfn id=storage-mutex&gt;storage
   mutex&lt;/dfn&gt;. This mutex is used to control access to shared state
@@ -58437,10 +58451,11 @@
    to null and abort these steps.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set up the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global object&lt;/a&gt;, the
-   &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL
-   character encoding&lt;/a&gt;, and the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt;
-   from &lt;a href=#the-script-settings-determined-from-the-node&gt;the script settings determined from the node&lt;/a&gt; on
-   which the attribute is being set.&lt;/li&gt;
+   &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, the &lt;a href=&quot;#script's-document&quot;&gt;script's
+   document&lt;/a&gt;, the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character encoding&lt;/a&gt;,
+   and the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt; from &lt;a href=#the-script-settings-determined-from-the-node&gt;the script
+   settings determined from the node&lt;/a&gt; on which the attribute is
+   being set.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
    handler&lt;/a&gt; to the aforementioned function.&lt;/li&gt;
@@ -59054,13 +59069,14 @@
 
     &lt;p&gt;Otherwise, if the &lt;a href=#method-context&gt;method context&lt;/a&gt; is a
     &lt;code&gt;&lt;a href=#workerutils&gt;WorkerUtils&lt;/a&gt;&lt;/code&gt; object, let &lt;var title=&quot;&quot;&gt;global
-    object&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;character encoding&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;base
-    URL&lt;/var&gt; be the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global object&lt;/a&gt;,
-    &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL
-    character encoding&lt;/a&gt;, and &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt;
-    (respectively) of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;
-    that the &lt;a href=#run-a-worker&gt;run a worker&lt;/a&gt; algorithm created when it
-    created the &lt;a href=#method-context&gt;method context&lt;/a&gt;.&lt;/p&gt;
+    object&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;document&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;character encoding&lt;/var&gt;,
+    and &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; be the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global
+    object&lt;/a&gt;, &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;,
+    &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt;, &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character
+    encoding&lt;/a&gt;, and &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt; (respectively)
+    of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that the
+    &lt;a href=#run-a-worker&gt;run a worker&lt;/a&gt; algorithm created when it created the
+    &lt;a href=#method-context&gt;method context&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, act as described in the specification that defines
     that the &lt;code&gt;&lt;a href=#windowtimers&gt;WindowTimers&lt;/a&gt;&lt;/code&gt; interface is implemented by
@@ -59069,13 +59085,7 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that checks
-   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt;
-   has been cleared, and if it has not, &lt;a href=#create-a-script title=&quot;create a
-   script&quot;&gt;creates a script&lt;/a&gt; using &lt;var title=&quot;&quot;&gt;script
-   source&lt;/var&gt; as the script source, &lt;var title=&quot;&quot;&gt;scripting
-   language&lt;/var&gt; as the scripting language, &lt;var title=&quot;&quot;&gt;global
-   object&lt;/var&gt; as the global object, &lt;var title=&quot;&quot;&gt;browsing
-   context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;character
+   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt; has been cleared, and if it has not, &lt;a href=#create-a-script title=&quot;create a script&quot;&gt;creates a script&lt;/a&gt; using &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, &lt;var title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting language, &lt;var title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; as the document, &lt;var title=&quot;&quot;&gt;character
    encoding&lt;/var&gt; as the URL character encoding, and &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; as the base URL.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the above methods are to &lt;dfn id=get-the-timeout&gt;get the timeout&lt;/dfn&gt;, they
@@ -64972,9 +64982,12 @@
   &lt;h4 id=processing-model-3&gt;&lt;span class=secno&gt;9.2.5 &lt;/span&gt;Processing model&lt;/h4&gt;
 
   &lt;p&gt;When a user agent is to &lt;dfn id=run-a-worker&gt;run a worker&lt;/dfn&gt; for a script with
-  &lt;a href=#url&gt;URL&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, a browsing context &lt;var title=&quot;&quot;&gt;owner browsing context&lt;/var&gt;, an origin &lt;var title=&quot;&quot;&gt;owner
-  origin&lt;/var&gt;, and with global scope &lt;var title=&quot;&quot;&gt;worker global
-  scope&lt;/var&gt;, it must run the following steps:&lt;/p&gt;
+  &lt;a href=#url&gt;URL&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, a &lt;a href=#browsing-context&gt;browsing
+  context&lt;/a&gt; &lt;var title=&quot;&quot;&gt;owner browsing context&lt;/var&gt;, a
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; &lt;var title=&quot;&quot;&gt;owner document&lt;/var&gt;, an
+  &lt;a href=#origin&gt;origin&lt;/a&gt; &lt;var title=&quot;&quot;&gt;owner origin&lt;/var&gt;, and with
+  global scope &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;, it must run
+  the following steps:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;
 
@@ -65036,6 +65049,9 @@
 
     &lt;p&gt;Set the &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;owner browsing context&lt;/var&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Set the &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;owner
+    document&lt;/var&gt;.&lt;/p&gt;
+
     &lt;p&gt;Set the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character encoding&lt;/a&gt; to
     UTF-8. (This is just used for encoding non-ASCII characters in the
     query component of URLs.)&lt;/p&gt;
@@ -65446,7 +65462,9 @@
     &lt;p&gt;&lt;a href=#run-a-worker&gt;Run a worker&lt;/a&gt; for the resulting &lt;a href=#absolute-url&gt;absolute
     URL&lt;/a&gt;, with the &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt; of the
     script that invoked the method as the &lt;var title=&quot;&quot;&gt;owner browsing
-    context&lt;/var&gt;, with the &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;a href=#entry-script&gt;entry
+    context&lt;/var&gt;, with the &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt; of the
+    script that invoked the method as the &lt;var title=&quot;&quot;&gt;owner
+    document&lt;/var&gt;, with the &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;a href=#entry-script&gt;entry
     script&lt;/a&gt; as the &lt;var title=&quot;&quot;&gt;owner origin&lt;/var&gt;, and with
     &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; as the global scope.&lt;/p&gt;
 
@@ -65652,7 +65670,9 @@
     &lt;p&gt;&lt;a href=#run-a-worker&gt;Run a worker&lt;/a&gt; for &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt;,
     with the &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt; of the script that
     invoked the method as the &lt;var title=&quot;&quot;&gt;owner browsing
-    context&lt;/var&gt;, with the &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;a href=#entry-script&gt;entry
+    context&lt;/var&gt;, with the &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt; of the
+    script that invoked the method as the &lt;var title=&quot;&quot;&gt;owner
+    document&lt;/var&gt;, with the &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;a href=#entry-script&gt;entry
     script&lt;/a&gt; as the &lt;var title=&quot;&quot;&gt;owner origin&lt;/var&gt;, and with
     &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; as the global scope.&lt;/p&gt;
 
@@ -69048,9 +69068,8 @@
     literal U+002F SOLIDUS character (/), and the
     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object on which
     the method was invoked does not have the &lt;a href=#same-origin&gt;same origin&lt;/a&gt;
-    as the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
-    context&quot;&gt;browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;,
-    then abort these steps silently.&lt;/p&gt;
+    as the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+    document&quot;&gt;document&lt;/a&gt;, then abort these steps silently.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument is
     an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, and the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the
@@ -69165,9 +69184,8 @@
     literal U+002F SOLIDUS character (/), and the
     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object on which
     the method was invoked does not have the &lt;a href=#same-origin&gt;same origin&lt;/a&gt;
-    as the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
-    context&quot;&gt;browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;,
-    then abort these steps silently.&lt;/p&gt;
+    as the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+    document&quot;&gt;document&lt;/a&gt;, then abort these steps silently.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument is
     an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, and the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the

Modified: index
===================================================================
--- index	2010-02-22 23:54:26 UTC (rev 4788)
+++ index	2010-02-23 01:53:06 UTC (rev 4789)
@@ -161,7 +161,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;HTML5 (including next generation additions still in development)&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 22 February 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 23 February 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -5151,9 +5151,8 @@
 
      &lt;dt&gt;When fetching resources in response to a call to an API&lt;/dt&gt;
 
-     &lt;dd&gt;The &lt;a href=#active-document&gt;active document&lt;/a&gt; of the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's
-     browsing context&quot;&gt;browsing context&lt;/a&gt; of the &lt;a href=#entry-script&gt;entry
-     script&lt;/a&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+     document&quot;&gt;document&lt;/a&gt;.&lt;/dd&gt;
 
     &lt;/dl&gt;&lt;p&gt;Remove any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
     component from the generated &lt;i&gt;address of the resource from which
@@ -6705,8 +6704,7 @@
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created by a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; using the &lt;code title=dom-DOMImplementation-createDocument&gt;createDocument()&lt;/code&gt;
   or &lt;code title=dom-DOMHTMLImplementation-createHTMLDocument&gt;&lt;a href=#dom-domhtmlimplementation-createhtmldocument&gt;createHTMLDocument()&lt;/a&gt;&lt;/code&gt;
   APIs, &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; is the same as &lt;a href=&quot;#the-document's-address&quot;&gt;the
-  document's address&lt;/a&gt; of the &lt;a href=#active-document&gt;active document&lt;/a&gt; of the
-  &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;.&lt;/p&gt;
+  document's address&lt;/a&gt; of the &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;&lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects are assumed to be &lt;dfn id=xml-documents&gt;XML
   documents&lt;/dfn&gt; unless they are flagged as being &lt;dfn id=html-documents&gt;HTML
@@ -9924,9 +9922,9 @@
    UTF-16.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Change &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; to the
-   &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
-   context&quot;&gt;browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;'s
-   &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt;.&lt;/li&gt;
+   &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+   document&quot;&gt;document&lt;/a&gt;'s &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's
+   address&quot;&gt;address&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Create a new &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; and associate it with
    the document. This is a &lt;dfn id=script-created-parser&gt;script-created parser&lt;/dfn&gt; (meaning
@@ -52812,6 +52810,11 @@
   &lt;a href=#view title=view&gt;views&lt;/a&gt; and their &lt;code&gt;AbstractView&lt;/code&gt;
   objects.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; has a strong
+  reference to its &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing
+  context&lt;/a&gt; and its &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+  document&quot;&gt;document&lt;/a&gt;.&lt;/p&gt;
+
   &lt;p&gt;When a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is to &lt;dfn id=discard-a-document&gt;discard a
   &lt;code&gt;Document&lt;/code&gt;&lt;/dfn&gt;, the user agent must run the following
   steps:&lt;/p&gt;
@@ -53814,11 +53817,9 @@
 
      &lt;li&gt;If the &lt;a href=#origin&gt;origin&lt;/a&gt; of the resulting &lt;a href=#absolute-url&gt;absolute
      URL&lt;/a&gt; is not the same as the &lt;a href=#origin&gt;origin&lt;/a&gt; of the
-     &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
-     context&quot;&gt;browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;,
-     and either the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; or
-     &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components of the
-     two &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; compared in the previous step
+     &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+     document&quot;&gt;document&lt;/a&gt;, and either the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; or &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components of the two
+     &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; compared in the previous step
      differ, raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception and abort
      these steps. (This prevents sandboxed content from spoofing other
      pages on the same origin.)&lt;/li&gt;
@@ -57695,6 +57696,19 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;A relationship with the &lt;dfn id=&quot;script's-document&quot;&gt;script's document&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;A &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that is assigned responsibility for
+    actions taken by the script.&lt;/p&gt;
+
+    &lt;p class=example&gt;When a script &lt;a href=#fetch title=fetch&gt;fetches&lt;/a&gt; a resource, the &lt;a href=&quot;#the-document's-current-address&quot; title=&quot;the
+    document's current address&quot;&gt;current address&lt;/a&gt; of the
+    &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt; will be used to set the &lt;code title=http-referer&gt;Referer&lt;/code&gt; (sic) header.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;A &lt;dfn id=&quot;script's-url-character-encoding&quot; title=&quot;script's URL character encoding&quot;&gt;URL character encoding&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -57779,9 +57793,10 @@
    entry-point&lt;/a&gt;&lt;/i&gt; is the entry-point for that code.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set up the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global object&lt;/a&gt;, the
-   &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL
-   character encoding&lt;/a&gt;, and the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt;
-   from the settings passed to this algorithm.&lt;/li&gt;
+   &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, the &lt;a href=&quot;#script's-document&quot;&gt;script's
+   document&lt;/a&gt;, the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character encoding&lt;/a&gt;,
+   and the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt; from the settings passed to
+   this algorithm.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;a href=#jump-to-a-code-entry-point title=&quot;jump to a code entry-point&quot;&gt;Jump&lt;/a&gt; to the
    &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;i&gt;&lt;a href=#initial-code-entry-point&gt;initial code
@@ -57953,8 +57968,7 @@
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, then it is the &lt;a href=#browsing-context&gt;browsing
   context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt; at the time the task
   was queued; if the task was queued by or for a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; then the document is the
-  &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active
-  document&lt;/a&gt; at the time the task was queued.&lt;/p&gt;
+  &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;A user agent is required to have one &lt;dfn id=storage-mutex&gt;storage
   mutex&lt;/dfn&gt;. This mutex is used to control access to shared state
@@ -58364,10 +58378,11 @@
    to null and abort these steps.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set up the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global object&lt;/a&gt;, the
-   &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL
-   character encoding&lt;/a&gt;, and the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt;
-   from &lt;a href=#the-script-settings-determined-from-the-node&gt;the script settings determined from the node&lt;/a&gt; on
-   which the attribute is being set.&lt;/li&gt;
+   &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, the &lt;a href=&quot;#script's-document&quot;&gt;script's
+   document&lt;/a&gt;, the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character encoding&lt;/a&gt;,
+   and the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt; from &lt;a href=#the-script-settings-determined-from-the-node&gt;the script
+   settings determined from the node&lt;/a&gt; on which the attribute is
+   being set.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
    handler&lt;/a&gt; to the aforementioned function.&lt;/li&gt;
@@ -58981,13 +58996,14 @@
 
     &lt;p&gt;Otherwise, if the &lt;a href=#method-context&gt;method context&lt;/a&gt; is a
     &lt;code&gt;WorkerUtils&lt;/code&gt; object, let &lt;var title=&quot;&quot;&gt;global
-    object&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;character encoding&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;base
-    URL&lt;/var&gt; be the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global object&lt;/a&gt;,
-    &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;, &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL
-    character encoding&lt;/a&gt;, and &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt;
-    (respectively) of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;
-    that the &lt;span&gt;run a worker&lt;/span&gt; algorithm created when it
-    created the &lt;a href=#method-context&gt;method context&lt;/a&gt;.&lt;/p&gt;
+    object&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;document&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;character encoding&lt;/var&gt;,
+    and &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; be the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global
+    object&lt;/a&gt;, &lt;a href=&quot;#script's-browsing-context&quot;&gt;script's browsing context&lt;/a&gt;,
+    &lt;a href=&quot;#script's-document&quot;&gt;script's document&lt;/a&gt;, &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character
+    encoding&lt;/a&gt;, and &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt; (respectively)
+    of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that the
+    &lt;span&gt;run a worker&lt;/span&gt; algorithm created when it created the
+    &lt;a href=#method-context&gt;method context&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, act as described in the specification that defines
     that the &lt;code&gt;&lt;a href=#windowtimers&gt;WindowTimers&lt;/a&gt;&lt;/code&gt; interface is implemented by
@@ -58996,13 +59012,7 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that checks
-   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt;
-   has been cleared, and if it has not, &lt;a href=#create-a-script title=&quot;create a
-   script&quot;&gt;creates a script&lt;/a&gt; using &lt;var title=&quot;&quot;&gt;script
-   source&lt;/var&gt; as the script source, &lt;var title=&quot;&quot;&gt;scripting
-   language&lt;/var&gt; as the scripting language, &lt;var title=&quot;&quot;&gt;global
-   object&lt;/var&gt; as the global object, &lt;var title=&quot;&quot;&gt;browsing
-   context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;character
+   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt; has been cleared, and if it has not, &lt;a href=#create-a-script title=&quot;create a script&quot;&gt;creates a script&lt;/a&gt; using &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, &lt;var title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting language, &lt;var title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; as the document, &lt;var title=&quot;&quot;&gt;character
    encoding&lt;/var&gt; as the URL character encoding, and &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; as the base URL.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the above methods are to &lt;dfn id=get-the-timeout&gt;get the timeout&lt;/dfn&gt;, they
@@ -64073,9 +64083,8 @@
     literal U+002F SOLIDUS character (/), and the
     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object on which
     the method was invoked does not have the &lt;a href=#same-origin&gt;same origin&lt;/a&gt;
-    as the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
-    context&quot;&gt;browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;,
-    then abort these steps silently.&lt;/p&gt;
+    as the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+    document&quot;&gt;document&lt;/a&gt;, then abort these steps silently.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument is
     an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, and the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the
@@ -64190,9 +64199,8 @@
     literal U+002F SOLIDUS character (/), and the
     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object on which
     the method was invoked does not have the &lt;a href=#same-origin&gt;same origin&lt;/a&gt;
-    as the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing
-    context&quot;&gt;browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;,
-    then abort these steps silently.&lt;/p&gt;
+    as the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
+    document&quot;&gt;document&lt;/a&gt;, then abort these steps silently.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument is
     an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, and the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the

Modified: source
===================================================================
--- source	2010-02-22 23:54:26 UTC (rev 4788)
+++ source	2010-02-23 01:53:06 UTC (rev 4789)
@@ -4781,9 +4781,8 @@
 
      &lt;dt&gt;When fetching resources in response to a call to an API&lt;/dt&gt;
 
-     &lt;dd&gt;The &lt;span&gt;active document&lt;/span&gt; of the &lt;span title=&quot;script's
-     browsing context&quot;&gt;browsing context&lt;/span&gt; of the &lt;span&gt;entry
-     script&lt;/span&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's
+     document&quot;&gt;document&lt;/span&gt;.&lt;/dd&gt;
 
     &lt;/dl&gt;
 
@@ -6573,8 +6572,7 @@
   or &lt;code
   title=&quot;dom-DOMHTMLImplementation-createHTMLDocument&quot;&gt;createHTMLDocument()&lt;/code&gt;
   APIs, &lt;span&gt;the document's address&lt;/span&gt; is the same as &lt;span&gt;the
-  document's address&lt;/span&gt; of the &lt;span&gt;active document&lt;/span&gt; of the
-  &lt;span&gt;script's browsing context&lt;/span&gt;.&lt;/p&gt;
+  document's address&lt;/span&gt; of the &lt;span&gt;script's document&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;&lt;code&gt;Document&lt;/code&gt; objects are assumed to be &lt;dfn&gt;XML
   documents&lt;/dfn&gt; unless they are flagged as being &lt;dfn&gt;HTML
@@ -10259,9 +10257,9 @@
    UTF-16.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Change &lt;span&gt;the document's address&lt;/span&gt; to the
-   &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's browsing
-   context&quot;&gt;browsing context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt;'s
-   &lt;span title=&quot;the document's address&quot;&gt;address&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's
+   document&quot;&gt;document&lt;/span&gt;'s &lt;span title=&quot;the document's
+   address&quot;&gt;address&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Create a new &lt;span&gt;HTML parser&lt;/span&gt; and associate it with
    the document. This is a &lt;dfn&gt;script-created parser&lt;/dfn&gt; (meaning
@@ -59562,6 +59560,11 @@
   &lt;span title=&quot;view&quot;&gt;views&lt;/span&gt; and their &lt;code&gt;AbstractView&lt;/code&gt;
   objects.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; has a strong
+  reference to its &lt;span title=&quot;script's browsing context&quot;&gt;browsing
+  context&lt;/span&gt; and its &lt;span title=&quot;script's
+  document&quot;&gt;document&lt;/span&gt;.&lt;/p&gt;
+
   &lt;p&gt;When a &lt;span&gt;browsing context&lt;/span&gt; is to &lt;dfn&gt;discard a
   &lt;code&gt;Document&lt;/code&gt;&lt;/dfn&gt;, the user agent must run the following
   steps:&lt;/p&gt;
@@ -60715,11 +60718,11 @@
 
      &lt;li&gt;If the &lt;span&gt;origin&lt;/span&gt; of the resulting &lt;span&gt;absolute
      URL&lt;/span&gt; is not the same as the &lt;span&gt;origin&lt;/span&gt; of the
-     &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's browsing
-     context&quot;&gt;browsing context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt;,
-     and either the &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; or
-     &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; components of the
-     two &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt; compared in the previous step
+     &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's
+     document&quot;&gt;document&lt;/span&gt;, and either the &lt;span
+     title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; or &lt;span
+     title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; components of the two
+     &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt; compared in the previous step
      differ, raise a &lt;code&gt;SECURITY_ERR&lt;/code&gt; exception and abort
      these steps. (This prevents sandboxed content from spoofing other
      pages on the same origin.)&lt;/li&gt;
@@ -65229,6 +65232,21 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;A relationship with the &lt;dfn&gt;script's document&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;A &lt;code&gt;Document&lt;/code&gt; that is assigned responsibility for
+    actions taken by the script.&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;When a script &lt;span
+    title=&quot;fetch&quot;&gt;fetches&lt;/span&gt; a resource, the &lt;span title=&quot;the
+    document's current address&quot;&gt;current address&lt;/span&gt; of the
+    &lt;span&gt;script's document&lt;/span&gt; will be used to set the &lt;code
+    title=&quot;http-referer&quot;&gt;Referer&lt;/code&gt; (sic) header.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;A &lt;dfn title=&quot;script's URL character encoding&quot;&gt;URL character encoding&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -65325,9 +65343,10 @@
    entry-point&lt;/i&gt; is the entry-point for that code.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set up the &lt;span&gt;script's global object&lt;/span&gt;, the
-   &lt;span&gt;script's browsing context&lt;/span&gt;, the &lt;span&gt;script's URL
-   character encoding&lt;/span&gt;, and the &lt;span&gt;script's base URL&lt;/span&gt;
-   from the settings passed to this algorithm.&lt;/p&gt;&lt;/li&gt;
+   &lt;span&gt;script's browsing context&lt;/span&gt;, the &lt;span&gt;script's
+   document&lt;/span&gt;, the &lt;span&gt;script's URL character encoding&lt;/span&gt;,
+   and the &lt;span&gt;script's base URL&lt;/span&gt; from the settings passed to
+   this algorithm.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&lt;span title=&quot;jump to a code entry-point&quot;&gt;Jump&lt;/span&gt; to the
    &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt;'s &lt;i&gt;initial code
@@ -65524,8 +65543,7 @@
   context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt; at the time the task
   was queued; if the task was queued by or for a &lt;span
   title=&quot;concept-script&quot;&gt;script&lt;/span&gt; then the document is the
-  &lt;span&gt;script's browsing context&lt;/span&gt;'s &lt;span&gt;active
-  document&lt;/span&gt; at the time the task was queued.&lt;/p&gt;
+  &lt;span&gt;script's document&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;A user agent is required to have one &lt;dfn&gt;storage
   mutex&lt;/dfn&gt;. This mutex is used to control access to shared state
@@ -66016,10 +66034,11 @@
    to null and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set up the &lt;span&gt;script's global object&lt;/span&gt;, the
-   &lt;span&gt;script's browsing context&lt;/span&gt;, the &lt;span&gt;script's URL
-   character encoding&lt;/span&gt;, and the &lt;span&gt;script's base URL&lt;/span&gt;
-   from &lt;span&gt;the script settings determined from the node&lt;/span&gt; on
-   which the attribute is being set.&lt;/p&gt;&lt;/li&gt;
+   &lt;span&gt;script's browsing context&lt;/span&gt;, the &lt;span&gt;script's
+   document&lt;/span&gt;, the &lt;span&gt;script's URL character encoding&lt;/span&gt;,
+   and the &lt;span&gt;script's base URL&lt;/span&gt; from &lt;span&gt;the script
+   settings determined from the node&lt;/span&gt; on which the attribute is
+   being set.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set the corresponding &lt;span title=&quot;event handlers&quot;&gt;event
    handler&lt;/span&gt; to the aforementioned function.&lt;/p&gt;&lt;/li&gt;
@@ -66745,13 +66764,14 @@
     &lt;p&gt;Otherwise, if the &lt;span&gt;method context&lt;/span&gt; is a
     &lt;code&gt;WorkerUtils&lt;/code&gt; object, let &lt;var title=&quot;&quot;&gt;global
     object&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt;, &lt;var
-    title=&quot;&quot;&gt;character encoding&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;base
-    URL&lt;/var&gt; be the &lt;span&gt;script's global object&lt;/span&gt;,
-    &lt;span&gt;script's browsing context&lt;/span&gt;, &lt;span&gt;script's URL
-    character encoding&lt;/span&gt;, and &lt;span&gt;script's base URL&lt;/span&gt;
-    (respectively) of the &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt;
-    that the &lt;span&gt;run a worker&lt;/span&gt; algorithm created when it
-    created the &lt;span&gt;method context&lt;/span&gt;.&lt;/p&gt;
+    title=&quot;&quot;&gt;document&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;character encoding&lt;/var&gt;,
+    and &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; be the &lt;span&gt;script's global
+    object&lt;/span&gt;, &lt;span&gt;script's browsing context&lt;/span&gt;,
+    &lt;span&gt;script's document&lt;/span&gt;, &lt;span&gt;script's URL character
+    encoding&lt;/span&gt;, and &lt;span&gt;script's base URL&lt;/span&gt; (respectively)
+    of the &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that the
+    &lt;span&gt;run a worker&lt;/span&gt; algorithm created when it created the
+    &lt;span&gt;method context&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, act as described in the specification that defines
     that the &lt;code&gt;WindowTimers&lt;/code&gt; interface is implemented by
@@ -66760,13 +66780,14 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return a &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; that checks
-   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt;
-   has been cleared, and if it has not, &lt;span title=&quot;create a
-   script&quot;&gt;creates a script&lt;/span&gt; using &lt;var title=&quot;&quot;&gt;script
-   source&lt;/var&gt; as the script source, &lt;var title=&quot;&quot;&gt;scripting
-   language&lt;/var&gt; as the scripting language, &lt;var title=&quot;&quot;&gt;global
-   object&lt;/var&gt; as the global object, &lt;var title=&quot;&quot;&gt;browsing
-   context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;character
+   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var
+   title=&quot;&quot;&gt;list&lt;/var&gt; has been cleared, and if it has not, &lt;span
+   title=&quot;create a script&quot;&gt;creates a script&lt;/span&gt; using &lt;var
+   title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, &lt;var
+   title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting language, &lt;var
+   title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object, &lt;var
+   title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var
+   title=&quot;&quot;&gt;document&lt;/var&gt; as the document, &lt;var title=&quot;&quot;&gt;character
    encoding&lt;/var&gt; as the URL character encoding, and &lt;var
    title=&quot;&quot;&gt;base URL&lt;/var&gt; as the base URL.&lt;/p&gt;&lt;/li&gt;
 
@@ -72921,10 +72942,12 @@
   &lt;h4&gt;Processing model&lt;/h4&gt;
 
   &lt;p&gt;When a user agent is to &lt;dfn&gt;run a worker&lt;/dfn&gt; for a script with
-  &lt;span&gt;URL&lt;/span&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, a browsing context &lt;var
-  title=&quot;&quot;&gt;owner browsing context&lt;/var&gt;, an origin &lt;var title=&quot;&quot;&gt;owner
-  origin&lt;/var&gt;, and with global scope &lt;var title=&quot;&quot;&gt;worker global
-  scope&lt;/var&gt;, it must run the following steps:&lt;/p&gt;
+  &lt;span&gt;URL&lt;/span&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, a &lt;span&gt;browsing
+  context&lt;/span&gt; &lt;var title=&quot;&quot;&gt;owner browsing context&lt;/var&gt;, a
+  &lt;code&gt;Document&lt;/code&gt; &lt;var title=&quot;&quot;&gt;owner document&lt;/var&gt;, an
+  &lt;span&gt;origin&lt;/span&gt; &lt;var title=&quot;&quot;&gt;owner origin&lt;/var&gt;, and with
+  global scope &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt;, it must run
+  the following steps:&lt;/p&gt;
 
   &lt;ol&gt;
 
@@ -72998,6 +73021,9 @@
     &lt;p&gt;Set the &lt;span&gt;script's browsing context&lt;/span&gt; to &lt;var
     title=&quot;&quot;&gt;owner browsing context&lt;/var&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Set the &lt;span&gt;script's document&lt;/span&gt; to &lt;var title=&quot;&quot;&gt;owner
+    document&lt;/var&gt;.&lt;/p&gt;
+
     &lt;p&gt;Set the &lt;span&gt;script's URL character encoding&lt;/span&gt; to
     UTF-8. (This is just used for encoding non-ASCII characters in the
     query component of URLs.)&lt;/p&gt;
@@ -73484,7 +73510,9 @@
     &lt;p&gt;&lt;span&gt;Run a worker&lt;/span&gt; for the resulting &lt;span&gt;absolute
     URL&lt;/span&gt;, with the &lt;span&gt;script's browsing context&lt;/span&gt; of the
     script that invoked the method as the &lt;var title=&quot;&quot;&gt;owner browsing
-    context&lt;/var&gt;, with the &lt;span&gt;origin&lt;/span&gt; of the &lt;span&gt;entry
+    context&lt;/var&gt;, with the &lt;span&gt;script's document&lt;/span&gt; of the
+    script that invoked the method as the &lt;var title=&quot;&quot;&gt;owner
+    document&lt;/var&gt;, with the &lt;span&gt;origin&lt;/span&gt; of the &lt;span&gt;entry
     script&lt;/span&gt; as the &lt;var title=&quot;&quot;&gt;owner origin&lt;/var&gt;, and with
     &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; as the global scope.&lt;/p&gt;
 
@@ -73730,7 +73758,9 @@
     &lt;p&gt;&lt;span&gt;Run a worker&lt;/span&gt; for &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt;,
     with the &lt;span&gt;script's browsing context&lt;/span&gt; of the script that
     invoked the method as the &lt;var title=&quot;&quot;&gt;owner browsing
-    context&lt;/var&gt;, with the &lt;span&gt;origin&lt;/span&gt; of the &lt;span&gt;entry
+    context&lt;/var&gt;, with the &lt;span&gt;script's document&lt;/span&gt; of the
+    script that invoked the method as the &lt;var title=&quot;&quot;&gt;owner
+    document&lt;/var&gt;, with the &lt;span&gt;origin&lt;/span&gt; of the &lt;span&gt;entry
     script&lt;/span&gt; as the &lt;var title=&quot;&quot;&gt;owner origin&lt;/var&gt;, and with
     &lt;var title=&quot;&quot;&gt;worker global scope&lt;/var&gt; as the global scope.&lt;/p&gt;
 
@@ -77645,9 +77675,8 @@
     literal U+002F SOLIDUS character (/), and the
     &lt;code&gt;Document&lt;/code&gt; of the &lt;code&gt;Window&lt;/code&gt; object on which
     the method was invoked does not have the &lt;span&gt;same origin&lt;/span&gt;
-    as the &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's browsing
-    context&quot;&gt;browsing context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt;,
-    then abort these steps silently.&lt;/p&gt;
+    as the &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's
+    document&quot;&gt;document&lt;/span&gt;, then abort these steps silently.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument is
     an &lt;span&gt;absolute URL&lt;/span&gt;, and the &lt;code&gt;Document&lt;/code&gt; of the
@@ -77783,9 +77812,8 @@
     literal U+002F SOLIDUS character (/), and the
     &lt;code&gt;Document&lt;/code&gt; of the &lt;code&gt;Window&lt;/code&gt; object on which
     the method was invoked does not have the &lt;span&gt;same origin&lt;/span&gt;
-    as the &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's browsing
-    context&quot;&gt;browsing context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt;,
-    then abort these steps silently.&lt;/p&gt;
+    as the &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's
+    document&quot;&gt;document&lt;/span&gt;, then abort these steps silently.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, if the &lt;var title=&quot;&quot;&gt;targetOrigin&lt;/var&gt; argument is
     an &lt;span&gt;absolute URL&lt;/span&gt;, and the &lt;code&gt;Document&lt;/code&gt; of the


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011656.html">[html5] r4788 - [e] (0) update the straw man dataTransfer.items	proposal
</A></li>
	<LI>Next message: <A HREF="011658.html">[html5] r4790 - [e] (0) xref errors Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=9020
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11657">[ date ]</a>
              <a href="thread.html#11657">[ thread ]</a>
              <a href="subject.html#11657">[ subject ]</a>
              <a href="author.html#11657">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
