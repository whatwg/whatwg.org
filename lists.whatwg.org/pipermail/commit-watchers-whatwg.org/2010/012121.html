<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r5253 - [t] (0) Make &lt;title&gt; and &lt;subtitle&gt; in the Atom	conversion contain markup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5253%20-%20%5Bt%5D%20%280%29%20Make%20%3Ctitle%3E%20and%20%3Csubtitle%3E%20in%20the%20Atom%0A%09conversion%20contain%20markup&In-Reply-To=%3C20100809191107.4618E1C84006%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012120.html">
   <LINK REL="Next"  HREF="012122.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r5253 - [t] (0) Make &lt;title&gt; and &lt;subtitle&gt; in the Atom	conversion contain markup</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5253%20-%20%5Bt%5D%20%280%29%20Make%20%3Ctitle%3E%20and%20%3Csubtitle%3E%20in%20the%20Atom%0A%09conversion%20contain%20markup&In-Reply-To=%3C20100809191107.4618E1C84006%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r5253 - [t] (0) Make &lt;title&gt; and &lt;subtitle&gt; in the Atom	conversion contain markup">whatwg at whatwg.org
       </A><BR>
    <I>Mon Aug  9 12:11:07 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="012120.html">[html5] r5252 - [t] (0) Make relative URLs work when moved to Atom	feeds.
</A></li>
        <LI>Next message: <A HREF="012122.html">[html5] r5254 - [giow] (1) Make HTMLInputElement.files not throw	when called at a bogus time.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12121">[ date ]</a>
              <a href="thread.html#12121">[ thread ]</a>
              <a href="subject.html#12121">[ subject ]</a>
              <a href="author.html#12121">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-08-09 12:11:05 -0700 (Mon, 09 Aug 2010)
New Revision: 5253

Modified:
   complete.html
   index
   source
Log:
[t] (0) Make &lt;title&gt; and &lt;subtitle&gt; in the Atom conversion contain markup

Modified: complete.html
===================================================================
--- complete.html	2010-08-09 18:35:45 UTC (rev 5252)
+++ complete.html	2010-08-09 19:11:05 UTC (rev 5253)
@@ -56931,8 +56931,8 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;subheading text&lt;/var&gt; be the empty
-   string.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; be an empty
+   list.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; be the first element of
    &lt;a href=#heading-content&gt;heading content&lt;/a&gt; whose nearest ancestor of
@@ -56949,10 +56949,9 @@
 
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-      &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of &lt;a href=#the-title-element&gt;the &lt;code&gt;title&lt;/code&gt;
-      element&lt;/a&gt;, if there is one, or the empty string
-      otherwise.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants
+      &lt;a href=#the-title-element&gt;the &lt;code&gt;title&lt;/code&gt; element&lt;/a&gt;, if there is one, or
+      an empty list otherwise.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -56961,18 +56960,18 @@
      &lt;dd&gt;
 
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; contains no child
-      &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; elements, let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty string.&lt;/p&gt;
+      &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; elements, let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty list.&lt;/p&gt;
 
       &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt; be a list of
       all the &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; element children
       of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;, sorted first by descending
       &lt;a href=#rank&gt;rank&lt;/a&gt; and then in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so
       &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;s first, then &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h2&lt;/a&gt;&lt;/code&gt;s, etc, with each
-      group in the order they appear in the document). Then, let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of
-      the first entry in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;, and if
-      there are multiple entries, let &lt;var title=&quot;&quot;&gt;subheading
-      text&lt;/var&gt; be the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of the second entry
-      in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
+      group in the order they appear in the document). Then, let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants of the first
+      entry in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;, and if there are
+      multiple entries, let &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; be
+      the descendants of the second entry in &lt;var title=&quot;&quot;&gt;headings
+      list&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -56980,8 +56979,8 @@
 
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-      &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants of
+      &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -56989,21 +56988,75 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Append a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
-    namespace&lt;/a&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;
-    whose contents is a text node with its data set to &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; and
+    their descendants into an environment that has &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting disabled&lt;/a&gt;, has no
+    &lt;a href=#plugin title=plugin&gt;plugins&lt;/a&gt;, and fails any attempt to
+    &lt;a href=#fetch title=fetch&gt;fetch&lt;/a&gt; any resources. Let &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; be a new
+    &lt;code&gt;&lt;a href=#documentfragment&gt;DocumentFragment&lt;/a&gt;&lt;/code&gt; containing the resulting cloned
+    nodes, preserving their relative order.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;subheading text&lt;/var&gt; is not the empty string,
-    append a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
-    namespace&lt;/a&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;
-    whose contents is a text node with its data set to &lt;var title=&quot;&quot;&gt;subheading text&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;If the document being converted is an &lt;a href=#html-documents title=&quot;HTML
+    documents&quot;&gt;HTML document&lt;/a&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+    be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
+    namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose
+    value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+    result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment serialization
+    algorithm&lt;/a&gt; on &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; to
+    &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root
+    element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, the document being converted is an &lt;a href=#xml-documents title=&quot;XML
+    documents&quot;&gt;XML document&lt;/a&gt;: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a
+    &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
+    namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose
+    value is the string &quot;&lt;code title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the child nodes of the &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; node to that
+    &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element, preserving their relative order. Append
+    &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; is not an empty list,
+    run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;
+
+      &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt;
+      and their descendants into an environment that has &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting disabled&lt;/a&gt;, has no
+      &lt;a href=#plugin title=plugin&gt;plugins&lt;/a&gt;, and fails any attempt to
+      &lt;a href=#fetch title=fetch&gt;fetch&lt;/a&gt; any resources. Let &lt;var title=&quot;&quot;&gt;cloned subheading content&lt;/var&gt; be a new
+      &lt;code&gt;&lt;a href=#documentfragment&gt;DocumentFragment&lt;/a&gt;&lt;/code&gt; containing the resulting cloned
+      nodes, preserving their relative order.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the document being converted is an &lt;a href=#html-documents title=&quot;HTML
+      documents&quot;&gt;HTML document&lt;/a&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+      be a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
+      namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute
+      whose value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+      result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment serialization
+      algorithm&lt;/a&gt; on &lt;var title=&quot;&quot;&gt;cloned subheading
+      content&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the document being converted is an &lt;a href=#xml-documents title=&quot;XML documents&quot;&gt;XML document&lt;/a&gt;: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in
+      the &lt;a href=#atom-namespace&gt;Atom namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose value is the string &quot;&lt;code title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a
+      &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the
+      child nodes of the &lt;var title=&quot;&quot;&gt;cloned subheading content&lt;/var&gt;
+      node to that &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element, preserving their relative
+      order. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;global update date&lt;/var&gt; have no
    value.&lt;/li&gt;
 
@@ -57045,8 +57098,8 @@
 
        &lt;dd&gt;
 
-        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty
-        string.&lt;/p&gt;
+        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty
+        list.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -57055,7 +57108,7 @@
        &lt;dd&gt;
 
         &lt;p&gt;If &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; contains no child
-        &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; elements, let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty string.&lt;/p&gt;
+        &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; elements, let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty list.&lt;/p&gt;
 
         &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt; be a list
         of all the &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; element
@@ -57064,8 +57117,7 @@
         order&lt;/a&gt; (so &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;s first, then
         &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h2&lt;/a&gt;&lt;/code&gt;s, etc, with each group in the order they
         appear in the document). Then, let &lt;var title=&quot;&quot;&gt;heading
-        text&lt;/var&gt; be the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of the first entry
-        in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
+        content&lt;/var&gt; be the descendants of the first entry in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -57073,8 +57125,8 @@
 
        &lt;dd&gt;
 
-        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-        &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
+        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants
+        of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -57082,14 +57134,38 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;Append a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the
-      &lt;a href=#atom-namespace&gt;Atom namespace&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt; whose
-      contents is a text node with its data set to &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; and
+      their descendants into an environment that has &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting disabled&lt;/a&gt;, has no
+      &lt;a href=#plugin title=plugin&gt;plugins&lt;/a&gt;, and fails any attempt to
+      &lt;a href=#fetch title=fetch&gt;fetch&lt;/a&gt; any resources. Let &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; be a new
+      &lt;code&gt;&lt;a href=#documentfragment&gt;DocumentFragment&lt;/a&gt;&lt;/code&gt; containing the resulting cloned
+      nodes, preserving their relative order.&lt;/p&gt;
 
      &lt;/li&gt;
 
+     &lt;li&gt;
+
+      &lt;p&gt;If the document being converted is an &lt;a href=#html-documents title=&quot;HTML
+      documents&quot;&gt;HTML document&lt;/a&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+      be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
+      namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute
+      whose value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+      result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment serialization
+      algorithm&lt;/a&gt; on &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt;
+      to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the document being converted is an &lt;a href=#xml-documents title=&quot;XML documents&quot;&gt;XML document&lt;/a&gt;: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the
+      &lt;a href=#atom-namespace&gt;Atom namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt;
+      attribute whose value is the string &quot;&lt;code title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a
+      &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the
+      child nodes of the &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt;
+      node to that &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element, preserving their relative
+      order. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
      &lt;!-- &lt;atom:author&gt; is required either at the feed level (above)
-     or the entry level (here) but we don't provide it --&gt;
+     or the entry level (here) but we don't provide it here --&gt;
 
      &lt;li&gt;
 
@@ -85483,8 +85559,9 @@
 
   &lt;p&gt;The following steps form the &lt;dfn id=html-fragment-serialization-algorithm&gt;HTML fragment serialization
   algorithm&lt;/dfn&gt;. The algorithm takes as input a DOM
-  &lt;code&gt;&lt;a href=#element&gt;Element&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, referred to as &lt;var title=&quot;&quot;&gt;the node&lt;/var&gt;, and either returns a string or raises an
-  exception.&lt;/p&gt;
+  &lt;code&gt;&lt;a href=#element&gt;Element&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, or
+  &lt;code&gt;&lt;a href=#documentfragment&gt;DocumentFragment&lt;/a&gt;&lt;/code&gt; referred to as &lt;var title=&quot;&quot;&gt;the
+  node&lt;/var&gt;, and either returns a string or raises an exception.&lt;/p&gt;
 
   &lt;p class=note&gt;This algorithm serializes the &lt;em&gt;children&lt;/em&gt; of
   the node being serialized, not the node itself.&lt;/p&gt;

Modified: index
===================================================================
--- index	2010-08-09 18:35:45 UTC (rev 5252)
+++ index	2010-08-09 19:11:05 UTC (rev 5253)
@@ -56858,8 +56858,8 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;subheading text&lt;/var&gt; be the empty
-   string.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; be an empty
+   list.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; be the first element of
    &lt;a href=#heading-content&gt;heading content&lt;/a&gt; whose nearest ancestor of
@@ -56876,10 +56876,9 @@
 
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-      &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of &lt;a href=#the-title-element&gt;the &lt;code&gt;title&lt;/code&gt;
-      element&lt;/a&gt;, if there is one, or the empty string
-      otherwise.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants
+      &lt;a href=#the-title-element&gt;the &lt;code&gt;title&lt;/code&gt; element&lt;/a&gt;, if there is one, or
+      an empty list otherwise.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -56888,18 +56887,18 @@
      &lt;dd&gt;
 
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; contains no child
-      &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; elements, let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty string.&lt;/p&gt;
+      &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; elements, let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty list.&lt;/p&gt;
 
       &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt; be a list of
       all the &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; element children
       of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;, sorted first by descending
       &lt;a href=#rank&gt;rank&lt;/a&gt; and then in &lt;a href=#tree-order&gt;tree order&lt;/a&gt; (so
       &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;s first, then &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h2&lt;/a&gt;&lt;/code&gt;s, etc, with each
-      group in the order they appear in the document). Then, let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of
-      the first entry in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;, and if
-      there are multiple entries, let &lt;var title=&quot;&quot;&gt;subheading
-      text&lt;/var&gt; be the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of the second entry
-      in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
+      group in the order they appear in the document). Then, let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants of the first
+      entry in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;, and if there are
+      multiple entries, let &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; be
+      the descendants of the second entry in &lt;var title=&quot;&quot;&gt;headings
+      list&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -56907,8 +56906,8 @@
 
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-      &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants of
+      &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -56916,21 +56915,75 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Append a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
-    namespace&lt;/a&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;
-    whose contents is a text node with its data set to &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; and
+    their descendants into an environment that has &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting disabled&lt;/a&gt;, has no
+    &lt;a href=#plugin title=plugin&gt;plugins&lt;/a&gt;, and fails any attempt to
+    &lt;a href=#fetch title=fetch&gt;fetch&lt;/a&gt; any resources. Let &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; be a new
+    &lt;code&gt;&lt;a href=#documentfragment&gt;DocumentFragment&lt;/a&gt;&lt;/code&gt; containing the resulting cloned
+    nodes, preserving their relative order.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;subheading text&lt;/var&gt; is not the empty string,
-    append a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
-    namespace&lt;/a&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;
-    whose contents is a text node with its data set to &lt;var title=&quot;&quot;&gt;subheading text&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;If the document being converted is an &lt;a href=#html-documents title=&quot;HTML
+    documents&quot;&gt;HTML document&lt;/a&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+    be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
+    namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose
+    value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+    result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment serialization
+    algorithm&lt;/a&gt; on &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; to
+    &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root
+    element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, the document being converted is an &lt;a href=#xml-documents title=&quot;XML
+    documents&quot;&gt;XML document&lt;/a&gt;: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a
+    &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
+    namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose
+    value is the string &quot;&lt;code title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the child nodes of the &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; node to that
+    &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element, preserving their relative order. Append
+    &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; is not an empty list,
+    run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;
+
+      &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt;
+      and their descendants into an environment that has &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting disabled&lt;/a&gt;, has no
+      &lt;a href=#plugin title=plugin&gt;plugins&lt;/a&gt;, and fails any attempt to
+      &lt;a href=#fetch title=fetch&gt;fetch&lt;/a&gt; any resources. Let &lt;var title=&quot;&quot;&gt;cloned subheading content&lt;/var&gt; be a new
+      &lt;code&gt;&lt;a href=#documentfragment&gt;DocumentFragment&lt;/a&gt;&lt;/code&gt; containing the resulting cloned
+      nodes, preserving their relative order.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the document being converted is an &lt;a href=#html-documents title=&quot;HTML
+      documents&quot;&gt;HTML document&lt;/a&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+      be a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
+      namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute
+      whose value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+      result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment serialization
+      algorithm&lt;/a&gt; on &lt;var title=&quot;&quot;&gt;cloned subheading
+      content&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the document being converted is an &lt;a href=#xml-documents title=&quot;XML documents&quot;&gt;XML document&lt;/a&gt;: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in
+      the &lt;a href=#atom-namespace&gt;Atom namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose value is the string &quot;&lt;code title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a
+      &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the
+      child nodes of the &lt;var title=&quot;&quot;&gt;cloned subheading content&lt;/var&gt;
+      node to that &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element, preserving their relative
+      order. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;global update date&lt;/var&gt; have no
    value.&lt;/li&gt;
 
@@ -56972,8 +57025,8 @@
 
        &lt;dd&gt;
 
-        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty
-        string.&lt;/p&gt;
+        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty
+        list.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -56982,7 +57035,7 @@
        &lt;dd&gt;
 
         &lt;p&gt;If &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; contains no child
-        &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; elements, let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty string.&lt;/p&gt;
+        &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; elements, let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty list.&lt;/p&gt;
 
         &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt; be a list
         of all the &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;&ndash;&lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h6&lt;/a&gt;&lt;/code&gt; element
@@ -56991,8 +57044,7 @@
         order&lt;/a&gt; (so &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h1&lt;/a&gt;&lt;/code&gt;s first, then
         &lt;code&gt;&lt;a href=#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements&gt;h2&lt;/a&gt;&lt;/code&gt;s, etc, with each group in the order they
         appear in the document). Then, let &lt;var title=&quot;&quot;&gt;heading
-        text&lt;/var&gt; be the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of the first entry
-        in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
+        content&lt;/var&gt; be the descendants of the first entry in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -57000,8 +57052,8 @@
 
        &lt;dd&gt;
 
-        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-        &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
+        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants
+        of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -57009,14 +57061,38 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;Append a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the
-      &lt;a href=#atom-namespace&gt;Atom namespace&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt; whose
-      contents is a text node with its data set to &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; and
+      their descendants into an environment that has &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting disabled&lt;/a&gt;, has no
+      &lt;a href=#plugin title=plugin&gt;plugins&lt;/a&gt;, and fails any attempt to
+      &lt;a href=#fetch title=fetch&gt;fetch&lt;/a&gt; any resources. Let &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; be a new
+      &lt;code&gt;&lt;a href=#documentfragment&gt;DocumentFragment&lt;/a&gt;&lt;/code&gt; containing the resulting cloned
+      nodes, preserving their relative order.&lt;/p&gt;
 
      &lt;/li&gt;
 
+     &lt;li&gt;
+
+      &lt;p&gt;If the document being converted is an &lt;a href=#html-documents title=&quot;HTML
+      documents&quot;&gt;HTML document&lt;/a&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+      be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#atom-namespace&gt;Atom
+      namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute
+      whose value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+      result of running the &lt;a href=#html-fragment-serialization-algorithm&gt;HTML fragment serialization
+      algorithm&lt;/a&gt; on &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt;
+      to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the document being converted is an &lt;a href=#xml-documents title=&quot;XML documents&quot;&gt;XML document&lt;/a&gt;: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the
+      &lt;a href=#atom-namespace&gt;Atom namespace&lt;/a&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt;
+      attribute whose value is the string &quot;&lt;code title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a
+      &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the
+      child nodes of the &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt;
+      node to that &lt;code&gt;&lt;a href=#the-div-element&gt;div&lt;/a&gt;&lt;/code&gt; element, preserving their relative
+      order. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
      &lt;!-- &lt;atom:author&gt; is required either at the feed level (above)
-     or the entry level (here) but we don't provide it --&gt;
+     or the entry level (here) but we don't provide it here --&gt;
 
      &lt;li&gt;
 
@@ -78594,8 +78670,9 @@
 
   &lt;p&gt;The following steps form the &lt;dfn id=html-fragment-serialization-algorithm&gt;HTML fragment serialization
   algorithm&lt;/dfn&gt;. The algorithm takes as input a DOM
-  &lt;code&gt;&lt;a href=#element&gt;Element&lt;/a&gt;&lt;/code&gt; or &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, referred to as &lt;var title=&quot;&quot;&gt;the node&lt;/var&gt;, and either returns a string or raises an
-  exception.&lt;/p&gt;
+  &lt;code&gt;&lt;a href=#element&gt;Element&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, or
+  &lt;code&gt;&lt;a href=#documentfragment&gt;DocumentFragment&lt;/a&gt;&lt;/code&gt; referred to as &lt;var title=&quot;&quot;&gt;the
+  node&lt;/var&gt;, and either returns a string or raises an exception.&lt;/p&gt;
 
   &lt;p class=note&gt;This algorithm serializes the &lt;em&gt;children&lt;/em&gt; of
   the node being serialized, not the node itself.&lt;/p&gt;

Modified: source
===================================================================
--- source	2010-08-09 18:35:45 UTC (rev 5252)
+++ source	2010-08-09 19:11:05 UTC (rev 5253)
@@ -64217,8 +64217,8 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;subheading text&lt;/var&gt; be the empty
-   string.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; be an empty
+   list.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; be the first element of
    &lt;span&gt;heading content&lt;/span&gt; whose nearest ancestor of
@@ -64237,10 +64237,9 @@
 
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-      &lt;code&gt;textContent&lt;/code&gt; of &lt;span&gt;the &lt;code&gt;title&lt;/code&gt;
-      element&lt;/span&gt;, if there is one, or the empty string
-      otherwise.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants
+      &lt;span&gt;the &lt;code&gt;title&lt;/code&gt; element&lt;/span&gt;, if there is one, or
+      an empty list otherwise.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -64250,7 +64249,7 @@
 
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; contains no child
       &lt;code&gt;h1&lt;/code&gt;&ndash;&lt;code&gt;h6&lt;/code&gt; elements, let &lt;var
-      title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty string.&lt;/p&gt;
+      title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty list.&lt;/p&gt;
 
       &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt; be a list of
       all the &lt;code&gt;h1&lt;/code&gt;&ndash;&lt;code&gt;h6&lt;/code&gt; element children
@@ -64258,11 +64257,11 @@
       &lt;span&gt;rank&lt;/span&gt; and then in &lt;span&gt;tree order&lt;/span&gt; (so
       &lt;code&gt;h1&lt;/code&gt;s first, then &lt;code&gt;h2&lt;/code&gt;s, etc, with each
       group in the order they appear in the document). Then, let &lt;var
-      title=&quot;&quot;&gt;heading text&lt;/var&gt; be the &lt;code&gt;textContent&lt;/code&gt; of
-      the first entry in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;, and if
-      there are multiple entries, let &lt;var title=&quot;&quot;&gt;subheading
-      text&lt;/var&gt; be the &lt;code&gt;textContent&lt;/code&gt; of the second entry
-      in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
+      title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants of the first
+      entry in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;, and if there are
+      multiple entries, let &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; be
+      the descendants of the second entry in &lt;var title=&quot;&quot;&gt;headings
+      list&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -64270,8 +64269,8 @@
 
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-      &lt;code&gt;textContent&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants of
+      &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -64281,23 +64280,96 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Append a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;span&gt;Atom
-    namespace&lt;/span&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;
-    whose contents is a text node with its data set to &lt;var
-    title=&quot;&quot;&gt;heading text&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; and
+    their descendants into an environment that has &lt;span
+    title=&quot;concept-bc-noscript&quot;&gt;scripting disabled&lt;/span&gt;, has no
+    &lt;span title=&quot;plugin&quot;&gt;plugins&lt;/span&gt;, and fails any attempt to
+    &lt;span title=&quot;fetch&quot;&gt;fetch&lt;/span&gt; any resources. Let &lt;var
+    title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; be a new
+    &lt;code&gt;DocumentFragment&lt;/code&gt; containing the resulting cloned
+    nodes, preserving their relative order.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;subheading text&lt;/var&gt; is not the empty string,
-    append a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in the &lt;span&gt;Atom
-    namespace&lt;/span&gt; to the root element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;
-    whose contents is a text node with its data set to &lt;var
-    title=&quot;&quot;&gt;subheading text&lt;/var&gt;.&lt;/p&gt;
+    &lt;p&gt;If the document being converted is an &lt;span title=&quot;HTML
+    documents&quot;&gt;HTML document&lt;/span&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+    be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;span&gt;Atom
+    namespace&lt;/span&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose
+    value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var
+    title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+    result of running the &lt;span&gt;HTML fragment serialization
+    algorithm&lt;/span&gt; on &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; to
+    &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root
+    element of &lt;var title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
 
+    &lt;p&gt;Otherwise, the document being converted is an &lt;span title=&quot;XML
+    documents&quot;&gt;XML document&lt;/span&gt;: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a
+    &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;span&gt;Atom
+    namespace&lt;/span&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose
+    value is the string &quot;&lt;code title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var
+    title=&quot;&quot;&gt;x&lt;/var&gt;. Append a &lt;code&gt;div&lt;/code&gt; element to &lt;var
+    title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the child nodes of the &lt;var
+    title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; node to that
+    &lt;code&gt;div&lt;/code&gt; element, preserving their relative order. Append
+    &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var
+    title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt; is not an empty list,
+    run these substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;subheading content&lt;/var&gt;
+      and their descendants into an environment that has &lt;span
+      title=&quot;concept-bc-noscript&quot;&gt;scripting disabled&lt;/span&gt;, has no
+      &lt;span title=&quot;plugin&quot;&gt;plugins&lt;/span&gt;, and fails any attempt to
+      &lt;span title=&quot;fetch&quot;&gt;fetch&lt;/span&gt; any resources. Let &lt;var
+      title=&quot;&quot;&gt;cloned subheading content&lt;/var&gt; be a new
+      &lt;code&gt;DocumentFragment&lt;/code&gt; containing the resulting cloned
+      nodes, preserving their relative order.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If the document being converted is an &lt;span title=&quot;HTML
+      documents&quot;&gt;HTML document&lt;/span&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+      be a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in the &lt;span&gt;Atom
+      namespace&lt;/span&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute
+      whose value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var
+      title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+      result of running the &lt;span&gt;HTML fragment serialization
+      algorithm&lt;/span&gt; on &lt;var title=&quot;&quot;&gt;cloned subheading
+      content&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var
+      title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var
+      title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the document being converted is an &lt;span
+      title=&quot;XML documents&quot;&gt;XML document&lt;/span&gt;: Let &lt;var
+      title=&quot;&quot;&gt;x&lt;/var&gt; be a &lt;code title=&quot;&quot;&gt;subtitle&lt;/code&gt; element in
+      the &lt;span&gt;Atom namespace&lt;/span&gt;. Add a &lt;code
+      title=&quot;&quot;&gt;type&lt;/code&gt; attribute whose value is the string &quot;&lt;code
+      title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a
+      &lt;code&gt;div&lt;/code&gt; element to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the
+      child nodes of the &lt;var title=&quot;&quot;&gt;cloned subheading content&lt;/var&gt;
+      node to that &lt;code&gt;div&lt;/code&gt; element, preserving their relative
+      order. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to the root element of &lt;var
+      title=&quot;&quot;&gt;R&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;global update date&lt;/var&gt; have no
    value.&lt;/p&gt;&lt;/li&gt;
 
@@ -64347,8 +64419,8 @@
 
        &lt;dd&gt;
 
-        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty
-        string.&lt;/p&gt;
+        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty
+        list.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -64358,7 +64430,7 @@
 
         &lt;p&gt;If &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt; contains no child
         &lt;code&gt;h1&lt;/code&gt;&ndash;&lt;code&gt;h6&lt;/code&gt; elements, let &lt;var
-        title=&quot;&quot;&gt;heading text&lt;/var&gt; be the empty string.&lt;/p&gt;
+        title=&quot;&quot;&gt;heading content&lt;/var&gt; be an empty list.&lt;/p&gt;
 
         &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt; be a list
         of all the &lt;code&gt;h1&lt;/code&gt;&ndash;&lt;code&gt;h6&lt;/code&gt; element
@@ -64367,8 +64439,8 @@
         order&lt;/span&gt; (so &lt;code&gt;h1&lt;/code&gt;s first, then
         &lt;code&gt;h2&lt;/code&gt;s, etc, with each group in the order they
         appear in the document). Then, let &lt;var title=&quot;&quot;&gt;heading
-        text&lt;/var&gt; be the &lt;code&gt;textContent&lt;/code&gt; of the first entry
-        in &lt;var title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
+        content&lt;/var&gt; be the descendants of the first entry in &lt;var
+        title=&quot;&quot;&gt;headings list&lt;/var&gt;.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -64376,8 +64448,8 @@
 
        &lt;dd&gt;
 
-        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading text&lt;/var&gt; be the
-        &lt;code&gt;textContent&lt;/code&gt; of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
+        &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; be the descendants
+        of &lt;var title=&quot;&quot;&gt;heading&lt;/var&gt;.&lt;/p&gt;
 
        &lt;/dd&gt;
 
@@ -64387,15 +64459,46 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;Append a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the
-      &lt;span&gt;Atom namespace&lt;/span&gt; to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt; whose
-      contents is a text node with its data set to &lt;var
-      title=&quot;&quot;&gt;heading text&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Clone the nodes in &lt;var title=&quot;&quot;&gt;heading content&lt;/var&gt; and
+      their descendants into an environment that has &lt;span
+      title=&quot;concept-bc-noscript&quot;&gt;scripting disabled&lt;/span&gt;, has no
+      &lt;span title=&quot;plugin&quot;&gt;plugins&lt;/span&gt;, and fails any attempt to
+      &lt;span title=&quot;fetch&quot;&gt;fetch&lt;/span&gt; any resources. Let &lt;var
+      title=&quot;&quot;&gt;cloned heading content&lt;/var&gt; be a new
+      &lt;code&gt;DocumentFragment&lt;/code&gt; containing the resulting cloned
+      nodes, preserving their relative order.&lt;/p&gt;
 
      &lt;/li&gt;
 
+     &lt;li&gt;
+
+      &lt;p&gt;If the document being converted is an &lt;span title=&quot;HTML
+      documents&quot;&gt;HTML document&lt;/span&gt;, then: Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;
+      be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;span&gt;Atom
+      namespace&lt;/span&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt; attribute
+      whose value is the string &quot;&lt;code title=&quot;&quot;&gt;html&lt;/code&gt;&quot; to &lt;var
+      title=&quot;&quot;&gt;x&lt;/var&gt;. Append a text node with its data set to the
+      result of running the &lt;span&gt;HTML fragment serialization
+      algorithm&lt;/span&gt; on &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt;
+      to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to &lt;var
+      title=&quot;&quot;&gt;E&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the document being converted is an &lt;span
+      title=&quot;XML documents&quot;&gt;XML document&lt;/span&gt;: Let &lt;var
+      title=&quot;&quot;&gt;x&lt;/var&gt; be a &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the
+      &lt;span&gt;Atom namespace&lt;/span&gt;. Add a &lt;code title=&quot;&quot;&gt;type&lt;/code&gt;
+      attribute whose value is the string &quot;&lt;code
+      title=&quot;&quot;&gt;xhtml&lt;/code&gt;&quot; to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Append a
+      &lt;code&gt;div&lt;/code&gt; element to &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;. Move all the
+      child nodes of the &lt;var title=&quot;&quot;&gt;cloned heading content&lt;/var&gt;
+      node to that &lt;code&gt;div&lt;/code&gt; element, preserving their relative
+      order. Append &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; to &lt;var
+      title=&quot;&quot;&gt;E&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
      &lt;!-- &lt;atom:author&gt; is required either at the feed level (above)
-     or the entry level (here) but we don't provide it --&gt;
+     or the entry level (here) but we don't provide it here --&gt;
 
      &lt;li&gt;
 
@@ -97474,9 +97577,9 @@
 
   &lt;p&gt;The following steps form the &lt;dfn&gt;HTML fragment serialization
   algorithm&lt;/dfn&gt;. The algorithm takes as input a DOM
-  &lt;code&gt;Element&lt;/code&gt; or &lt;code&gt;Document&lt;/code&gt;, referred to as &lt;var
-  title=&quot;&quot;&gt;the node&lt;/var&gt;, and either returns a string or raises an
-  exception.&lt;/p&gt;
+  &lt;code&gt;Element&lt;/code&gt;, &lt;code&gt;Document&lt;/code&gt;, or
+  &lt;code&gt;DocumentFragment&lt;/code&gt; referred to as &lt;var title=&quot;&quot;&gt;the
+  node&lt;/var&gt;, and either returns a string or raises an exception.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;This algorithm serializes the &lt;em&gt;children&lt;/em&gt; of
   the node being serialized, not the node itself.&lt;/p&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012120.html">[html5] r5252 - [t] (0) Make relative URLs work when moved to Atom	feeds.
</A></li>
	<LI>Next message: <A HREF="012122.html">[html5] r5254 - [giow] (1) Make HTMLInputElement.files not throw	when called at a bogus time.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12121">[ date ]</a>
              <a href="thread.html#12121">[ thread ]</a>
              <a href="subject.html#12121">[ subject ]</a>
              <a href="author.html#12121">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
