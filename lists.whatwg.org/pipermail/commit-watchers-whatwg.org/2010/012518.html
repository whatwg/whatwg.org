<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r5651 - [giow] (0) dropzone 4/5,	part 2/2: DataTransferItem. Fixing http://www.w3.org/Bu [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5651%20-%20%5Bgiow%5D%20%280%29%20dropzone%204/5%2C%0A%09part%202/2%3A%20DataTransferItem.%20Fixing%20http%3A//www.w3.org/Bu%20%5B...%5D&In-Reply-To=%3C20101029220313.E94D2805817A%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012517.html">
   <LINK REL="Next"  HREF="012519.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r5651 - [giow] (0) dropzone 4/5,	part 2/2: DataTransferItem. Fixing http://www.w3.org/Bu [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5651%20-%20%5Bgiow%5D%20%280%29%20dropzone%204/5%2C%0A%09part%202/2%3A%20DataTransferItem.%20Fixing%20http%3A//www.w3.org/Bu%20%5B...%5D&In-Reply-To=%3C20101029220313.E94D2805817A%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r5651 - [giow] (0) dropzone 4/5,	part 2/2: DataTransferItem. Fixing http://www.w3.org/Bu [...]">whatwg at whatwg.org
       </A><BR>
    <I>Fri Oct 29 15:03:13 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="012517.html">[html5] r5650 - [giow] (0) dropzone 4/5, part 1: DataTransferItems	(WIP); also contains some Web [...]
</A></li>
        <LI>Next message: <A HREF="012519.html">[html5] r5652 - [giow] (0) dropzone 4/5, part, um,	3/2: some bits I somehow missed in the previo [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12518">[ date ]</a>
              <a href="thread.html#12518">[ thread ]</a>
              <a href="subject.html#12518">[ subject ]</a>
              <a href="author.html#12518">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-10-29 15:03:12 -0700 (Fri, 29 Oct 2010)
New Revision: 5651

Modified:
   complete.html
   index
   source
Log:
[giow] (0) dropzone 4/5, part 2/2: DataTransferItem.
Fixing <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=10712">http://www.w3.org/Bugs/Public/show_bug.cgi?id=10712</A>

Modified: complete.html
===================================================================
--- complete.html	2010-10-29 18:59:03 UTC (rev 5650)
+++ complete.html	2010-10-29 22:03:12 UTC (rev 5651)
@@ -65723,7 +65723,7 @@
 
   &lt;h3 id=dnd&gt;&lt;span class=secno&gt;8.7 &lt;/span&gt;&lt;dfn&gt;Drag and drop&lt;/dfn&gt;&lt;/h3&gt;
 
-&lt;!-- v2 ideas for drag and drop:
+&lt;!-- v2: ideas for drag and drop:
 
      * being able to animate a drop target:
 
@@ -65761,10 +65761,18 @@
 
        Ack: Ben Laurie (@g)
 
-     * Promises. Should be able to say &quot;if you accept this drop, then
-       I can provide the File object that corresponds to it
-       eventually&quot;.
+     Other things listed below:
+      DND-v2: more native support: text/html from selections, etc
+      DND-v3: add Blob support
+      DND-v4: add structured clone support
+      DND-v5: add promises (should be able to say &quot;if you accept this
+              drop, then I can provide the File object that
+              corresponds to it eventually&quot;)
 
+         DataTransferPromise.type = 'string' or 'file' or 'blob' or 'data'
+                            .onneeddata - can wait until this fires to provide data
+                            .setData() - call this once you have data, must be the right type
+
 --&gt;
 
   &lt;p&gt;This section defines an event-based drag-and-drop mechanism.&lt;/p&gt;
@@ -65917,24 +65925,10 @@
    items representing the dragged data, each consisting of the
    following information:&lt;/p&gt;
 
-    &lt;dl&gt;&lt;dt&gt;&lt;dfn id=the-drag-data-item-type-string&gt;The drag data item type string&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;dl&gt;&lt;dt&gt;&lt;dfn id=the-drag-data-item-kind&gt;The drag data item kind&lt;/dfn&gt;&lt;/dt&gt;
 
      &lt;dd&gt;
 
-      &lt;p&gt;A Unicode string giving the type or format of the data,
-      generally given by a &lt;a href=#mime-type&gt;MIME type&lt;/a&gt;. Some values that
-      are not &lt;a href=#mime-type title=&quot;MIME type&quot;&gt;MIME types&lt;/a&gt; are
-      special-cased for legacy reasons. The API does not enforce the
-      use of &lt;a href=#mime-type title=&quot;MIME type&quot;&gt;MIME types&lt;/a&gt;; other values
-      can be used as well. In all cases, however, the values are all
-      &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt; by the API.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;&lt;dfn id=the-drag-data-item-kind&gt;The drag data item kind&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
       &lt;p&gt;The kind of data:&lt;/p&gt;
 
       &lt;dl&gt;&lt;dt&gt;&lt;i&gt;Plain Unicode string&lt;/i&gt;&lt;/dt&gt;
@@ -65942,17 +65936,19 @@
         &lt;p&gt;Text.&lt;/p&gt;
        &lt;/dd&gt;
 
+&lt;!-- DND-v3:
        &lt;dt&gt;&lt;i&gt;Blob&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;Binary data.&lt;/p&gt;
        &lt;/dd&gt;
+--&gt;
 
        &lt;dt&gt;&lt;i&gt;File&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;Binary data with a file name.&lt;/p&gt;
        &lt;/dd&gt;
 
-&lt;!-- v2:
+&lt;!-- DND-v4:
        &lt;dt&gt;&lt;i&gt;Structured object&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;An object that will be cloned using the &lt;span&gt;structured clone&lt;/span&gt; algorithm.&lt;/p&gt;
@@ -65961,14 +65957,32 @@
 
       &lt;/dl&gt;&lt;/dd&gt;
 
+     &lt;dt&gt;&lt;dfn id=the-drag-data-item-type-string&gt;The drag data item type string&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;A Unicode string giving the type or format of the data,
+      generally given by a &lt;a href=#mime-type&gt;MIME type&lt;/a&gt;. Some values that
+      are not &lt;a href=#mime-type title=&quot;MIME type&quot;&gt;MIME types&lt;/a&gt; are
+      special-cased for legacy reasons. The API does not enforce the
+      use of &lt;a href=#mime-type title=&quot;MIME type&quot;&gt;MIME types&lt;/a&gt;; other values
+      can be used as well. In all cases, however, the values are all
+      &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt; by the API.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
      &lt;dt&gt;The actual data&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;A Unicode or binary string, optionally with a file name
-     (itself a Unicode string), &lt;!-- (v2:) or an object, --&gt; as per
+     (itself a Unicode string), &lt;!-- (DND-v4:) or an object, --&gt; as per
      &lt;a href=#the-drag-data-item-kind&gt;the drag data item kind&lt;/a&gt;.&lt;/dd&gt;
 
-    &lt;/dl&gt;&lt;/li&gt;
+    &lt;/dl&gt;&lt;p&gt;The &lt;a href=#drag-data-store-item-list&gt;drag data store item list&lt;/a&gt; is ordered in the
+    order that the items were added to the list; most recently added
+    last.&lt;/p&gt;
 
+   &lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;The following information, used to generate the UI feedback
@@ -66325,10 +66339,10 @@
 
    &lt;li&gt;&lt;p&gt;For each item in the &lt;a href=#drag-data-store-item-list&gt;drag data store item list&lt;/a&gt;
    &lt;!-- in some order...? --&gt; whose &lt;a href=#the-drag-data-item-kind title=&quot;the drag data item
-   kind&quot;&gt;kind&lt;/a&gt; is &lt;i&gt;File&lt;/i&gt; (not &lt;i&gt;Blob&lt;/i&gt;), add the item's
-   data (the file, in particular its name and contents, as well as its
-   &lt;a href=#the-drag-data-item-type-string title=&quot;the drag data item type string&quot;&gt;type&lt;/a&gt;) to the
-   list &lt;var title=&quot;&quot;&gt;L&lt;/var&gt;.&lt;/li&gt;
+   kind&quot;&gt;kind&lt;/a&gt; is &lt;i&gt;File&lt;/i&gt; &lt;!-- DND-v3: (not &lt;i&gt;Blob&lt;/i&gt;) --&gt;,
+   add the item's data (the file, in particular its name and contents,
+   as well as its &lt;a href=#the-drag-data-item-type-string title=&quot;the drag data item type
+   string&quot;&gt;type&lt;/a&gt;) to the list &lt;var title=&quot;&quot;&gt;L&lt;/var&gt;.&lt;/li&gt;
 
    &lt;!-- &lt;li&gt;&lt;p&gt;Sort the list...?&lt;/p&gt;&lt;/li&gt; --&gt;
 
@@ -66396,16 +66410,15 @@
 
   &lt;pre class=idl&gt;interface &lt;dfn id=datatransferitems&gt;DataTransferItems&lt;/dfn&gt; {
   readonly attribute unsigned long &lt;a href=#dom-datatransferitems-length title=dom-DataTransferItems-length&gt;length&lt;/a&gt;;
-  &lt;a href=#dom-datatransferitems-item title=dom-DataTransferItems-item&gt;getter&lt;/a&gt; &lt;span&gt;DataTransferItem&lt;/span&gt; (in unsigned long index);
+  &lt;a href=#dom-datatransferitems-item title=dom-DataTransferItems-item&gt;getter&lt;/a&gt; &lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt; (in unsigned long index);
   &lt;a href=#dom-datatransferitems-removeitem title=dom-DataTransferItems-removeItem&gt;deleter&lt;/a&gt; void (in unsigned long index);
   void &lt;a href=#dom-datatransferitems-clear title=dom-DataTransferItems-clear&gt;clear&lt;/a&gt;();
 
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=dom-DataTransferItems-add&gt;add&lt;/span&gt;(in DOMString data, in DOMString type);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=dom-DataTransferItems-add&gt;add&lt;/span&gt;(in &lt;span&gt;Blob&lt;/span&gt; data);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=dom-DataTransferItems-add&gt;add&lt;/span&gt;(in &lt;span&gt;File&lt;/span&gt; data);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=dom-DataTransferItems-add&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferItem&lt;/span&gt; data);&lt;!--
-v2:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in any data, in DOMString type);--&gt;&lt;!--
-v3:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferPromise&lt;/span&gt; data);--&gt;
+  &lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt; &lt;a href=#dom-datatransferitems-add title=dom-DataTransferItems-add&gt;add&lt;/a&gt;(in DOMString data, in DOMString type);&lt;!--
+DND-v3:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;Blob&lt;/span&gt; data);--&gt;
+  &lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt; &lt;a href=#dom-datatransferitems-add title=dom-DataTransferItems-add&gt;add&lt;/a&gt;(in &lt;span&gt;File&lt;/span&gt; data);&lt;!--
+DND-v4:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in any data, in DOMString type);--&gt;&lt;!--
+DND-v5:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferPromise&lt;/span&gt; data);--&gt;
 };&lt;/pre&gt;
 
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-length&gt;&lt;a href=#dom-datatransferitems-length&gt;length&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
@@ -66417,7 +66430,7 @@
 
    &lt;dd&gt;
 
-    &lt;p&gt;Returns the &lt;code&gt;DataTransferItem&lt;/code&gt; object representing the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th entry in the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;Returns the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object representing the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th entry in the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -66440,13 +66453,13 @@
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-add&gt;add&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/dt&gt;
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-add&gt;add&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-add&gt;&lt;a href=#dom-datatransferitems-add&gt;add&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-add&gt;&lt;a href=#dom-datatransferitems-add&gt;add&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;)&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;Adds a new entry for the given data to the &lt;a href=#drag-data-store&gt;drag data
-    store&lt;/a&gt;. If the data is plain text &lt;!-- v2: or an object --&gt;
+    store&lt;/a&gt;. If the data is plain text &lt;!-- DND-v4: or an object --&gt;
     then a &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; string has to be provided
     also.&lt;/p&gt;
 
@@ -66461,12 +66474,12 @@
   When the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object's
   &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object is &lt;em&gt;not&lt;/em&gt; associated with a
   &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;, the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt;
-  object's &lt;i&gt;mode&lt;/i&gt; is &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;a href=#drag-data-store&gt;drag data
-  store&lt;/a&gt; referenced in this section (which is used only when the
-  &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object is not in the &lt;i&gt;disabled
-  mode&lt;/i&gt;) is the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt; with which the
-  &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt;
-  object is associated.&lt;/p&gt;
+  object's &lt;i&gt;mode&lt;/i&gt; is the &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;a href=#drag-data-store&gt;drag
+  data store&lt;/a&gt; referenced in this section (which is used only
+  when the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object is not in the
+  &lt;i&gt;disabled mode&lt;/i&gt;) is the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt; with which
+  the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object's
+  &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object is associated.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-datatransferitems-length title=dom-DataTransferItems-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
   attribute must return zero if the object is in the &lt;i&gt;disabled
@@ -66485,7 +66498,11 @@
   &lt;p&gt;To &lt;dfn id=dom-datatransferitems-item title=dom-DataTransferItems-item&gt;determine the value of
   an indexed property&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; of a
   &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object, the user agent must return a
-  &lt;code&gt;DataTransferItem&lt;/code&gt; object representing the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th item in the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;.&lt;/p&gt;
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object representing the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th item in the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;. The
+  same object must be returned each time. The
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object must be associated with the
+  same &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object as the
+  &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object when it is created.&lt;/p&gt;
 
   &lt;p&gt;To &lt;dfn id=dom-datatransferitems-removeitem title=dom-DataTransferItems-removeItem&gt;delete an
   existing indexed property&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; of a
@@ -66505,41 +66522,246 @@
   items from the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;. Otherwise, it must do
   nothing.&lt;/p&gt;
 
-  &lt;/div&gt;
+  &lt;p&gt;The &lt;dfn id=dom-datatransferitems-add title=dom-DataTransferItems-add&gt;&lt;code&gt;add()&lt;/code&gt;&lt;/dfn&gt; method
+  must run the following steps:&lt;/p&gt;
 
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object is not in the
+   &lt;i title=concept-dnd-rw&gt;&lt;a href=#concept-dnd-rw&gt;read/write mode&lt;/a&gt;&lt;/i&gt;, return null and
+   abort these steps.&lt;/li&gt;
 
-  &lt;h5 id=the-datatransferitem-interface&gt;&lt;span class=secno&gt;8.7.3.2 &lt;/span&gt;The &lt;code&gt;DataTransferItem&lt;/code&gt; interface&lt;/h5&gt;
+   &lt;li&gt;
 
-  &lt;p class=XXX&gt;...&lt;/p&gt;
+  &lt;/ol&gt;&lt;/div&gt;
 
-&lt;!--
 
-         DataTransferItem.kind = 'string', 'file', 'blob', 'data'?, ...
-                         .type = MIME type
-                         .getTextData(function callback (data)) - throws if kind is not 'string'
-                         .getRawData(function callback (data)) - throws if kind is not 'data'
-                         .getBlob() - returns File or Blob (which are async anyway); throws if kind is 'data'
+  &lt;h5 id=the-datatransferitem-interface&gt;&lt;span class=secno&gt;8.7.3.2 &lt;/span&gt;The &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; interface&lt;/h5&gt;
 
-         DataTransferPromise.type = 'string' or 'file' or 'blob' or 'data'
-                            .onneeddata - can wait until this fires to provide data
-                            .setData() - call this once you have data, must be the right type
+  &lt;p&gt;Each &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object is associated with a
+  &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=datatransferitem&gt;DataTransferItem&lt;/dfn&gt; {
+    readonly attribute DOMString &lt;a href=#dom-datatransferitem-kind title=dom-DataTransferItem-kind&gt;kind&lt;/a&gt;;
+    readonly attribute DOMString &lt;a href=#dom-datatransferitem-type title=dom-DataTransferItem-type&gt;type&lt;/a&gt;;
+    void &lt;span title=dom-DataTransferItem-getAsText&gt;getAsText&lt;/span&gt;(in &lt;a href=#functionstringcallback&gt;FunctionStringCallback&lt;/a&gt; callback);&lt;!--
+DND-v3:    &lt;span&gt;Blob&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;getAsBlob&lt;/span&gt;();--&gt;
+    &lt;span&gt;File&lt;/span&gt; &lt;a href=#dom-datatransferitem-getasfile title=dom-DataTransferItem-getAsFile&gt;getAsFile&lt;/a&gt;();&lt;!--
+DND-v4:    void &lt;span title=&quot;dom-DataTransferItem-getAsObject&quot;&gt;getAsObject&lt;/span&gt;(in &lt;span&gt;FunctionObjectCallback&lt;/span&gt; callback);--&gt;
+};
+
+[Callback=FunctionOnly, NoInterfaceObject]
+interface &lt;dfn id=functionstringcallback&gt;FunctionStringCallback&lt;/dfn&gt; {
+  void &lt;span title=dom-FunctionStringCallback-handleEvent&gt;handleEvent&lt;/span&gt;(in DOMString data);
+};&lt;!--
+
+// DND-v4:
+[Callback=FunctionOnly, NoInterfaceObject]
+interface &lt;dfn&gt;FunctionObjectCallback&lt;/dfn&gt; {
+  void &lt;span title=&quot;dom-FunctionObjectCallback-handleEvent&quot;&gt;handleEvent&lt;/span&gt;(in DOMString data);
+};--&gt;&lt;/pre&gt;
+
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=dom-DataTransferItem-kind&gt;&lt;a href=#dom-datatransferitem-kind&gt;kind&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;span&gt;drag data item kind&lt;/span&gt;, one of: &quot;string&quot;,
+    &lt;!-- DND-v3: &quot;blob&quot;, --&gt; &quot;file&quot;&lt;!-- DND-v4: , &quot;object&quot; --&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=dom-DataTransferItem-type&gt;&lt;a href=#dom-datatransferitem-type&gt;type&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;span&gt;drag data item type string&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=dom-DataTransferItem-getAsString&gt;&lt;a href=#dom-datatransferitem-getasstring&gt;getAsString&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Invokes the callback with the string data as the argument, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Plain Unicode string&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+&lt;!-- DND-v3:
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;getAsBlob&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns a &lt;code&gt;Blob&lt;/code&gt; object, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt; or &lt;i&gt;File&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
 --&gt;
 
-&lt;!-- xxx mention that if an item is removed from a data store, DataTransferItem objects become unusable --&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=dom-DataTransferItem-getAsFile&gt;&lt;a href=#dom-datatransferitem-getasfile&gt;getAsFile&lt;/a&gt;&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
+    &lt;p&gt;Returns a &lt;code&gt;File&lt;/code&gt; object, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;.&lt;/p&gt;
 
-&lt;!--
+   &lt;/dd&gt;
 
-XXX DND WIP
+&lt;!-- DND-v4:
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-getAsFile&quot;&gt;getAsFile&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
-plan:
- 4. expose model with new API
- 5. add dropzone=&quot;...&quot; feature
+    &lt;p&gt;Invokes the callback with the cloned object data as the argument, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Plain Unicode string&lt;/i&gt; or &lt;i&gt;Object&lt;/i&gt;.&lt;/p&gt;
 
+   &lt;/dd&gt;
 --&gt;
 
+  &lt;/dl&gt;&lt;div class=impl&gt;
 
+  &lt;p&gt;While the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's
+  &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object is associated with a &lt;a href=#drag-data-store&gt;drag
+  data store&lt;/a&gt; and that &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;'s &lt;span&gt;drag
+  drop store item list&lt;/span&gt; still contains the item that the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object represents, the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's &lt;i&gt;mode&lt;/i&gt; is the same as
+  the &lt;a href=#drag-data-store-mode&gt;drag data store mode&lt;/a&gt;. When the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt;
+  object is &lt;em&gt;not&lt;/em&gt; associated with a &lt;a href=#drag-data-store&gt;drag data
+  store&lt;/a&gt;, or if the item that the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt;
+  object represents has been removed from the relevant &lt;span&gt;drag drop
+  store item list&lt;/span&gt;, the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's
+  &lt;i&gt;mode&lt;/i&gt; is the &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;a href=#drag-data-store&gt;drag data
+  store&lt;/a&gt; referenced in this section (which is used only when the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object is not in the &lt;i&gt;disabled
+  mode&lt;/i&gt;) is the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt; with which the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt;
+  object is associated.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;dfn id=dom-datatransferitem-kind title=dom-DataTransferItem-kind&gt;&lt;code&gt;kind&lt;/code&gt;&lt;/dfn&gt; attribute
+  must return the empty string if the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt;
+  object is in the &lt;i&gt;disabled mode&lt;/i&gt;; otherwise it must return the
+  string given in the cell from the second column of the following
+  table from the row whose cell in the first column contains &lt;a href=#the-drag-data-item-kind&gt;the
+  drag data item kind&lt;/a&gt; of the item represented by the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object:&lt;/p&gt;
+
+  &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; Kind &lt;th&gt; String
+   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt; &lt;i&gt;Plain Unicode string&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;string&lt;/code&gt;&quot;
+&lt;!-- DND-v3:    &lt;tr&gt; &lt;td&gt; &lt;i&gt;Blob&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;blob&lt;/code&gt;&quot;--&gt;
+    &lt;tr&gt;&lt;td&gt; &lt;i&gt;File&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;file&lt;/code&gt;&quot;
+&lt;!-- DND-v4:    &lt;tr&gt; &lt;td&gt; &lt;i&gt;Object&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;object&lt;/code&gt;&quot;--&gt;
+  &lt;/table&gt;&lt;p&gt;The &lt;dfn id=dom-datatransferitem-type title=dom-DataTransferItem-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt; attribute
+  must return the empty string if the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt;
+  object is in the &lt;i&gt;disabled mode&lt;/i&gt;; otherwise it must return
+  &lt;a href=#the-drag-data-item-type-string&gt;the drag data item type string&lt;/a&gt; of the item represented
+  by the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-datatransferitem-getasstring title=dom-DataTransferItem-getAsString&gt;&lt;code&gt;getAsString(&lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; is null, abort these
+   steps.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object is not in the &lt;i title=concept-dnd-rw&gt;&lt;a href=#concept-dnd-rw&gt;read/write mode&lt;/a&gt;&lt;/i&gt; or the &lt;i title=concept-dnd-ro&gt;&lt;a href=#concept-dnd-ro&gt;read-only mode&lt;/a&gt;&lt;/i&gt;, abort these steps. The
+   callback is never invoked.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is not &lt;i&gt;Plain
+   Unicode string&lt;/i&gt;, abort these steps. The callback is never
+   invoked.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Otherwise, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;, passing the actual data of the item
+   represented by the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object as the
+   argument.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;!--DND-v3:
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;&lt;code&gt;getAsBlob()&lt;/code&gt;&lt;/dfn&gt;
+  method must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i
+   title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt; or the &lt;i
+   title=&quot;concept-dnd-ro&quot;&gt;read-only mode&lt;/i&gt;, return null and abort
+   these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+--&gt;&lt;!--DND-v4:
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Object&lt;/i&gt;,
+    return null.&lt;/p&gt;&lt;/li&gt;
+--&gt;&lt;!--DND-v3:
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;, then
+    return a new &lt;code&gt;File&lt;/code&gt; object representing the actual data
+    of the item represented by the &lt;code&gt;DataTransferItem&lt;/code&gt;
+    object.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Unicode Data
+    string&lt;/i&gt;, then return a new &lt;code&gt;Blob&lt;/code&gt; object
+    representing the actual data of the item represented by the
+    &lt;code&gt;DataTransferItem&lt;/code&gt; object, with the &lt;code
+    title=&quot;dom-Blob-type&quot;&gt;type&lt;/code&gt; of the &lt;code&gt;Blob&lt;/code&gt; being
+    &lt;span&gt;the drag data item type string&lt;/span&gt; and with the binary
+    data of the &lt;code&gt;Blob&lt;/code&gt; object being the Unicode string
+    encoded as UTF-8. &lt;a href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt;;
+    return a new &lt;code&gt;Blob&lt;/code&gt; object representing the actual data
+    of the item represented by the &lt;code&gt;DataTransferItem&lt;/code&gt;
+    object.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+--&gt;&lt;p&gt;The &lt;dfn id=dom-datatransferitem-getasfile title=dom-DataTransferItem-getAsFile&gt;&lt;code&gt;getAsFile()&lt;/code&gt;&lt;/dfn&gt;
+  method must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object is not in the &lt;i title=concept-dnd-rw&gt;&lt;a href=#concept-dnd-rw&gt;read/write mode&lt;/a&gt;&lt;/i&gt; or the &lt;i title=concept-dnd-ro&gt;&lt;a href=#concept-dnd-ro&gt;read-only mode&lt;/a&gt;&lt;/i&gt;, return null and abort
+   these steps.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is not &lt;i&gt;File&lt;/i&gt;,
+   then return null and abort these steps.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;File&lt;/code&gt; object representing the
+   actual data of the item represented by the
+   &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;/ol&gt;&lt;!--DND-v4:
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-getAsObject&quot;&gt;&lt;code&gt;getAsObject(&lt;var
+  title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i
+   title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt; or the &lt;i
+   title=&quot;concept-dnd-ro&quot;&gt;read-only mode&lt;/i&gt;, return null and abort
+   these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; be the actual data of the item
+    represented by the &lt;code&gt;DataTransferItem&lt;/code&gt; object.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Unicode Data
+    string&lt;/i&gt;, then &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code
+    title=&quot;&quot;&gt;DOMString&lt;/code&gt; containing the actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code&gt;Blob&lt;/code&gt; representing the
+    actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code&gt;File&lt;/code&gt; representing the
+    actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Object&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is the object that is the actual
+    data.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var
+   title=&quot;&quot;&gt;callback&lt;/var&gt;, passing a &lt;span&gt;structured clone&lt;/span&gt; of
+   &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; as the argument.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+--&gt;&lt;/div&gt;
+
+
+
   &lt;h4 id=the-dragevent-interface&gt;&lt;span class=secno&gt;8.7.4 &lt;/span&gt;The &lt;code&gt;&lt;a href=#dragevent&gt;DragEvent&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;p&gt;The drag-and-drop processing model involves several events. They
@@ -66791,7 +67013,7 @@
 
    &lt;/li&gt;
 
-   &lt;!-- v2: text/html as an export format --&gt;
+   &lt;!-- DND-v2: text/html as an export format --&gt;
 
 &lt;!--MD--&gt;
 
@@ -66815,37 +67037,8 @@
     &lt;/dl&gt;&lt;/li&gt;
 
 
-&lt;!-- v2: deal with multiple vCards --&gt;
-&lt;!--
    &lt;li&gt;
 
-    (if you put this back, don't forget to update this text as above)
-
-    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
-    and &lt;span title=&quot;extracting a vCard&quot;&gt;extract the vCard data from
-    those nodes&lt;/span&gt;, and then must add the resulting string to the
-    &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
-    member, associated with the &lt;code
-    title=&quot;&quot;&gt;text/directory;profile=vcard&lt;/code&gt; format.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    (if you put this back, don't forget to update this text as above)
-
-    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
-    and &lt;span title=&quot;extracting vEvent data&quot;&gt;extract the vEvent data
-    from those nodes&lt;/span&gt;, and then must add the resulting string to
-    the &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
-    member, associated with the &lt;code
-    title=&quot;&quot;&gt;text/calendar;component=vevent&lt;/code&gt; format.&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
     &lt;p&gt;Run the following substeps:&lt;/p&gt;
 
     &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; be an empty list of &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/a&gt;.&lt;/li&gt;
@@ -66865,7 +67058,7 @@
        &lt;dd&gt;Add to &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; the result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the element's &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; content attribute relative to
        the element.&lt;/dd&gt;
 
-       &lt;!-- v2: more --&gt;
+       &lt;!-- DND-v2: more --&gt;
 
       &lt;/dl&gt;&lt;/li&gt;
 
@@ -67374,6 +67567,11 @@
 
   &lt;h4 id=the-draggable-attribute&gt;&lt;span class=secno&gt;8.7.7 &lt;/span&gt;The &lt;dfn title=attr-draggable&gt;&lt;code&gt;draggable&lt;/code&gt;&lt;/dfn&gt; attribute&lt;/h4&gt;
 
+&lt;!--
+XXX DND WIP plan:
+ 5. add dropzone=&quot;...&quot; feature
+--&gt;
+
   &lt;p&gt;All &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; may have the &lt;code title=attr-draggable&gt;&lt;a href=#the-draggable-attribute&gt;draggable&lt;/a&gt;&lt;/code&gt; content attribute set. The
   &lt;code title=attr-draggable&gt;&lt;a href=#the-draggable-attribute&gt;draggable&lt;/a&gt;&lt;/code&gt; attribute is an
   &lt;a href=#enumerated-attribute&gt;enumerated attribute&lt;/a&gt;. It has three states. The first

Modified: index
===================================================================
--- index	2010-10-29 18:59:03 UTC (rev 5650)
+++ index	2010-10-29 22:03:12 UTC (rev 5651)
@@ -65729,7 +65729,7 @@
 
   &lt;h3 id=dnd&gt;&lt;span class=secno&gt;8.7 &lt;/span&gt;&lt;dfn&gt;Drag and drop&lt;/dfn&gt;&lt;/h3&gt;
 
-&lt;!-- v2 ideas for drag and drop:
+&lt;!-- v2: ideas for drag and drop:
 
      * being able to animate a drop target:
 
@@ -65767,10 +65767,18 @@
 
        Ack: Ben Laurie (@g)
 
-     * Promises. Should be able to say &quot;if you accept this drop, then
-       I can provide the File object that corresponds to it
-       eventually&quot;.
+     Other things listed below:
+      DND-v2: more native support: text/html from selections, etc
+      DND-v3: add Blob support
+      DND-v4: add structured clone support
+      DND-v5: add promises (should be able to say &quot;if you accept this
+              drop, then I can provide the File object that
+              corresponds to it eventually&quot;)
 
+         DataTransferPromise.type = 'string' or 'file' or 'blob' or 'data'
+                            .onneeddata - can wait until this fires to provide data
+                            .setData() - call this once you have data, must be the right type
+
 --&gt;
 
   &lt;p&gt;This section defines an event-based drag-and-drop mechanism.&lt;/p&gt;
@@ -65923,24 +65931,10 @@
    items representing the dragged data, each consisting of the
    following information:&lt;/p&gt;
 
-    &lt;dl&gt;&lt;dt&gt;&lt;dfn id=the-drag-data-item-type-string&gt;The drag data item type string&lt;/dfn&gt;&lt;/dt&gt;
+    &lt;dl&gt;&lt;dt&gt;&lt;dfn id=the-drag-data-item-kind&gt;The drag data item kind&lt;/dfn&gt;&lt;/dt&gt;
 
      &lt;dd&gt;
 
-      &lt;p&gt;A Unicode string giving the type or format of the data,
-      generally given by a &lt;a href=#mime-type&gt;MIME type&lt;/a&gt;. Some values that
-      are not &lt;a href=#mime-type title=&quot;MIME type&quot;&gt;MIME types&lt;/a&gt; are
-      special-cased for legacy reasons. The API does not enforce the
-      use of &lt;a href=#mime-type title=&quot;MIME type&quot;&gt;MIME types&lt;/a&gt;; other values
-      can be used as well. In all cases, however, the values are all
-      &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt; by the API.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;&lt;dfn id=the-drag-data-item-kind&gt;The drag data item kind&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
       &lt;p&gt;The kind of data:&lt;/p&gt;
 
       &lt;dl&gt;&lt;dt&gt;&lt;i&gt;Plain Unicode string&lt;/i&gt;&lt;/dt&gt;
@@ -65948,17 +65942,19 @@
         &lt;p&gt;Text.&lt;/p&gt;
        &lt;/dd&gt;
 
+&lt;!-- DND-v3:
        &lt;dt&gt;&lt;i&gt;Blob&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;Binary data.&lt;/p&gt;
        &lt;/dd&gt;
+--&gt;
 
        &lt;dt&gt;&lt;i&gt;File&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;Binary data with a file name.&lt;/p&gt;
        &lt;/dd&gt;
 
-&lt;!-- v2:
+&lt;!-- DND-v4:
        &lt;dt&gt;&lt;i&gt;Structured object&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;An object that will be cloned using the &lt;span&gt;structured clone&lt;/span&gt; algorithm.&lt;/p&gt;
@@ -65967,14 +65963,32 @@
 
       &lt;/dl&gt;&lt;/dd&gt;
 
+     &lt;dt&gt;&lt;dfn id=the-drag-data-item-type-string&gt;The drag data item type string&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;A Unicode string giving the type or format of the data,
+      generally given by a &lt;a href=#mime-type&gt;MIME type&lt;/a&gt;. Some values that
+      are not &lt;a href=#mime-type title=&quot;MIME type&quot;&gt;MIME types&lt;/a&gt; are
+      special-cased for legacy reasons. The API does not enforce the
+      use of &lt;a href=#mime-type title=&quot;MIME type&quot;&gt;MIME types&lt;/a&gt;; other values
+      can be used as well. In all cases, however, the values are all
+      &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt; by the API.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
      &lt;dt&gt;The actual data&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;A Unicode or binary string, optionally with a file name
-     (itself a Unicode string), &lt;!-- (v2:) or an object, --&gt; as per
+     (itself a Unicode string), &lt;!-- (DND-v4:) or an object, --&gt; as per
      &lt;a href=#the-drag-data-item-kind&gt;the drag data item kind&lt;/a&gt;.&lt;/dd&gt;
 
-    &lt;/dl&gt;&lt;/li&gt;
+    &lt;/dl&gt;&lt;p&gt;The &lt;a href=#drag-data-store-item-list&gt;drag data store item list&lt;/a&gt; is ordered in the
+    order that the items were added to the list; most recently added
+    last.&lt;/p&gt;
 
+   &lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;The following information, used to generate the UI feedback
@@ -66331,10 +66345,10 @@
 
    &lt;li&gt;&lt;p&gt;For each item in the &lt;a href=#drag-data-store-item-list&gt;drag data store item list&lt;/a&gt;
    &lt;!-- in some order...? --&gt; whose &lt;a href=#the-drag-data-item-kind title=&quot;the drag data item
-   kind&quot;&gt;kind&lt;/a&gt; is &lt;i&gt;File&lt;/i&gt; (not &lt;i&gt;Blob&lt;/i&gt;), add the item's
-   data (the file, in particular its name and contents, as well as its
-   &lt;a href=#the-drag-data-item-type-string title=&quot;the drag data item type string&quot;&gt;type&lt;/a&gt;) to the
-   list &lt;var title=&quot;&quot;&gt;L&lt;/var&gt;.&lt;/li&gt;
+   kind&quot;&gt;kind&lt;/a&gt; is &lt;i&gt;File&lt;/i&gt; &lt;!-- DND-v3: (not &lt;i&gt;Blob&lt;/i&gt;) --&gt;,
+   add the item's data (the file, in particular its name and contents,
+   as well as its &lt;a href=#the-drag-data-item-type-string title=&quot;the drag data item type
+   string&quot;&gt;type&lt;/a&gt;) to the list &lt;var title=&quot;&quot;&gt;L&lt;/var&gt;.&lt;/li&gt;
 
    &lt;!-- &lt;li&gt;&lt;p&gt;Sort the list...?&lt;/p&gt;&lt;/li&gt; --&gt;
 
@@ -66402,16 +66416,15 @@
 
   &lt;pre class=idl&gt;interface &lt;dfn id=datatransferitems&gt;DataTransferItems&lt;/dfn&gt; {
   readonly attribute unsigned long &lt;a href=#dom-datatransferitems-length title=dom-DataTransferItems-length&gt;length&lt;/a&gt;;
-  &lt;a href=#dom-datatransferitems-item title=dom-DataTransferItems-item&gt;getter&lt;/a&gt; &lt;span&gt;DataTransferItem&lt;/span&gt; (in unsigned long index);
+  &lt;a href=#dom-datatransferitems-item title=dom-DataTransferItems-item&gt;getter&lt;/a&gt; &lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt; (in unsigned long index);
   &lt;a href=#dom-datatransferitems-removeitem title=dom-DataTransferItems-removeItem&gt;deleter&lt;/a&gt; void (in unsigned long index);
   void &lt;a href=#dom-datatransferitems-clear title=dom-DataTransferItems-clear&gt;clear&lt;/a&gt;();
 
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=dom-DataTransferItems-add&gt;add&lt;/span&gt;(in DOMString data, in DOMString type);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=dom-DataTransferItems-add&gt;add&lt;/span&gt;(in &lt;span&gt;Blob&lt;/span&gt; data);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=dom-DataTransferItems-add&gt;add&lt;/span&gt;(in &lt;span&gt;File&lt;/span&gt; data);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=dom-DataTransferItems-add&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferItem&lt;/span&gt; data);&lt;!--
-v2:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in any data, in DOMString type);--&gt;&lt;!--
-v3:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferPromise&lt;/span&gt; data);--&gt;
+  &lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt; &lt;a href=#dom-datatransferitems-add title=dom-DataTransferItems-add&gt;add&lt;/a&gt;(in DOMString data, in DOMString type);&lt;!--
+DND-v3:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;Blob&lt;/span&gt; data);--&gt;
+  &lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt; &lt;a href=#dom-datatransferitems-add title=dom-DataTransferItems-add&gt;add&lt;/a&gt;(in &lt;span&gt;File&lt;/span&gt; data);&lt;!--
+DND-v4:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in any data, in DOMString type);--&gt;&lt;!--
+DND-v5:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferPromise&lt;/span&gt; data);--&gt;
 };&lt;/pre&gt;
 
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-length&gt;&lt;a href=#dom-datatransferitems-length&gt;length&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
@@ -66423,7 +66436,7 @@
 
    &lt;dd&gt;
 
-    &lt;p&gt;Returns the &lt;code&gt;DataTransferItem&lt;/code&gt; object representing the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th entry in the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;Returns the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object representing the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th entry in the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -66446,13 +66459,13 @@
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-add&gt;add&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/dt&gt;
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-add&gt;add&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-add&gt;&lt;a href=#dom-datatransferitems-add&gt;add&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;items&lt;/var&gt; . &lt;code title=dom-DataTransferItems-add&gt;&lt;a href=#dom-datatransferitems-add&gt;add&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;)&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;Adds a new entry for the given data to the &lt;a href=#drag-data-store&gt;drag data
-    store&lt;/a&gt;. If the data is plain text &lt;!-- v2: or an object --&gt;
+    store&lt;/a&gt;. If the data is plain text &lt;!-- DND-v4: or an object --&gt;
     then a &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; string has to be provided
     also.&lt;/p&gt;
 
@@ -66467,12 +66480,12 @@
   When the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object's
   &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object is &lt;em&gt;not&lt;/em&gt; associated with a
   &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;, the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt;
-  object's &lt;i&gt;mode&lt;/i&gt; is &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;a href=#drag-data-store&gt;drag data
-  store&lt;/a&gt; referenced in this section (which is used only when the
-  &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object is not in the &lt;i&gt;disabled
-  mode&lt;/i&gt;) is the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt; with which the
-  &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt;
-  object is associated.&lt;/p&gt;
+  object's &lt;i&gt;mode&lt;/i&gt; is the &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;a href=#drag-data-store&gt;drag
+  data store&lt;/a&gt; referenced in this section (which is used only
+  when the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object is not in the
+  &lt;i&gt;disabled mode&lt;/i&gt;) is the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt; with which
+  the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object's
+  &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object is associated.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-datatransferitems-length title=dom-DataTransferItems-length&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
   attribute must return zero if the object is in the &lt;i&gt;disabled
@@ -66491,7 +66504,11 @@
   &lt;p&gt;To &lt;dfn id=dom-datatransferitems-item title=dom-DataTransferItems-item&gt;determine the value of
   an indexed property&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; of a
   &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object, the user agent must return a
-  &lt;code&gt;DataTransferItem&lt;/code&gt; object representing the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th item in the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;.&lt;/p&gt;
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object representing the &lt;var title=&quot;&quot;&gt;i&lt;/var&gt;th item in the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;. The
+  same object must be returned each time. The
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object must be associated with the
+  same &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object as the
+  &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object when it is created.&lt;/p&gt;
 
   &lt;p&gt;To &lt;dfn id=dom-datatransferitems-removeitem title=dom-DataTransferItems-removeItem&gt;delete an
   existing indexed property&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; of a
@@ -66511,41 +66528,246 @@
   items from the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;. Otherwise, it must do
   nothing.&lt;/p&gt;
 
-  &lt;/div&gt;
+  &lt;p&gt;The &lt;dfn id=dom-datatransferitems-add title=dom-DataTransferItems-add&gt;&lt;code&gt;add()&lt;/code&gt;&lt;/dfn&gt; method
+  must run the following steps:&lt;/p&gt;
 
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#datatransferitems&gt;DataTransferItems&lt;/a&gt;&lt;/code&gt; object is not in the
+   &lt;i title=concept-dnd-rw&gt;&lt;a href=#concept-dnd-rw&gt;read/write mode&lt;/a&gt;&lt;/i&gt;, return null and
+   abort these steps.&lt;/li&gt;
 
-  &lt;h5 id=the-datatransferitem-interface&gt;&lt;span class=secno&gt;8.7.3.2 &lt;/span&gt;The &lt;code&gt;DataTransferItem&lt;/code&gt; interface&lt;/h5&gt;
+   &lt;li&gt;
 
-  &lt;p class=XXX&gt;...&lt;/p&gt;
+  &lt;/ol&gt;&lt;/div&gt;
 
-&lt;!--
 
-         DataTransferItem.kind = 'string', 'file', 'blob', 'data'?, ...
-                         .type = MIME type
-                         .getTextData(function callback (data)) - throws if kind is not 'string'
-                         .getRawData(function callback (data)) - throws if kind is not 'data'
-                         .getBlob() - returns File or Blob (which are async anyway); throws if kind is 'data'
+  &lt;h5 id=the-datatransferitem-interface&gt;&lt;span class=secno&gt;8.7.3.2 &lt;/span&gt;The &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; interface&lt;/h5&gt;
 
-         DataTransferPromise.type = 'string' or 'file' or 'blob' or 'data'
-                            .onneeddata - can wait until this fires to provide data
-                            .setData() - call this once you have data, must be the right type
+  &lt;p&gt;Each &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object is associated with a
+  &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;pre class=idl&gt;interface &lt;dfn id=datatransferitem&gt;DataTransferItem&lt;/dfn&gt; {
+    readonly attribute DOMString &lt;a href=#dom-datatransferitem-kind title=dom-DataTransferItem-kind&gt;kind&lt;/a&gt;;
+    readonly attribute DOMString &lt;a href=#dom-datatransferitem-type title=dom-DataTransferItem-type&gt;type&lt;/a&gt;;
+    void &lt;span title=dom-DataTransferItem-getAsText&gt;getAsText&lt;/span&gt;(in &lt;a href=#functionstringcallback&gt;FunctionStringCallback&lt;/a&gt; callback);&lt;!--
+DND-v3:    &lt;span&gt;Blob&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;getAsBlob&lt;/span&gt;();--&gt;
+    &lt;span&gt;File&lt;/span&gt; &lt;a href=#dom-datatransferitem-getasfile title=dom-DataTransferItem-getAsFile&gt;getAsFile&lt;/a&gt;();&lt;!--
+DND-v4:    void &lt;span title=&quot;dom-DataTransferItem-getAsObject&quot;&gt;getAsObject&lt;/span&gt;(in &lt;span&gt;FunctionObjectCallback&lt;/span&gt; callback);--&gt;
+};
+
+[Callback=FunctionOnly, NoInterfaceObject]
+interface &lt;dfn id=functionstringcallback&gt;FunctionStringCallback&lt;/dfn&gt; {
+  void &lt;span title=dom-FunctionStringCallback-handleEvent&gt;handleEvent&lt;/span&gt;(in DOMString data);
+};&lt;!--
+
+// DND-v4:
+[Callback=FunctionOnly, NoInterfaceObject]
+interface &lt;dfn&gt;FunctionObjectCallback&lt;/dfn&gt; {
+  void &lt;span title=&quot;dom-FunctionObjectCallback-handleEvent&quot;&gt;handleEvent&lt;/span&gt;(in DOMString data);
+};--&gt;&lt;/pre&gt;
+
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=dom-DataTransferItem-kind&gt;&lt;a href=#dom-datatransferitem-kind&gt;kind&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;span&gt;drag data item kind&lt;/span&gt;, one of: &quot;string&quot;,
+    &lt;!-- DND-v3: &quot;blob&quot;, --&gt; &quot;file&quot;&lt;!-- DND-v4: , &quot;object&quot; --&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=dom-DataTransferItem-type&gt;&lt;a href=#dom-datatransferitem-type&gt;type&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;span&gt;drag data item type string&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=dom-DataTransferItem-getAsString&gt;&lt;a href=#dom-datatransferitem-getasstring&gt;getAsString&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Invokes the callback with the string data as the argument, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Plain Unicode string&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+&lt;!-- DND-v3:
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;getAsBlob&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns a &lt;code&gt;Blob&lt;/code&gt; object, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt; or &lt;i&gt;File&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
 --&gt;
 
-&lt;!-- xxx mention that if an item is removed from a data store, DataTransferItem objects become unusable --&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=dom-DataTransferItem-getAsFile&gt;&lt;a href=#dom-datatransferitem-getasfile&gt;getAsFile&lt;/a&gt;&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
+    &lt;p&gt;Returns a &lt;code&gt;File&lt;/code&gt; object, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;.&lt;/p&gt;
 
-&lt;!--
+   &lt;/dd&gt;
 
-XXX DND WIP
+&lt;!-- DND-v4:
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-getAsFile&quot;&gt;getAsFile&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
-plan:
- 4. expose model with new API
- 5. add dropzone=&quot;...&quot; feature
+    &lt;p&gt;Invokes the callback with the cloned object data as the argument, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Plain Unicode string&lt;/i&gt; or &lt;i&gt;Object&lt;/i&gt;.&lt;/p&gt;
 
+   &lt;/dd&gt;
 --&gt;
 
+  &lt;/dl&gt;&lt;div class=impl&gt;
 
+  &lt;p&gt;While the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's
+  &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt; object is associated with a &lt;a href=#drag-data-store&gt;drag
+  data store&lt;/a&gt; and that &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt;'s &lt;span&gt;drag
+  drop store item list&lt;/span&gt; still contains the item that the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object represents, the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's &lt;i&gt;mode&lt;/i&gt; is the same as
+  the &lt;a href=#drag-data-store-mode&gt;drag data store mode&lt;/a&gt;. When the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt;
+  object is &lt;em&gt;not&lt;/em&gt; associated with a &lt;a href=#drag-data-store&gt;drag data
+  store&lt;/a&gt;, or if the item that the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt;
+  object represents has been removed from the relevant &lt;span&gt;drag drop
+  store item list&lt;/span&gt;, the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's
+  &lt;i&gt;mode&lt;/i&gt; is the &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;a href=#drag-data-store&gt;drag data
+  store&lt;/a&gt; referenced in this section (which is used only when the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object is not in the &lt;i&gt;disabled
+  mode&lt;/i&gt;) is the &lt;a href=#drag-data-store&gt;drag data store&lt;/a&gt; with which the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object's &lt;code&gt;&lt;a href=#datatransfer&gt;DataTransfer&lt;/a&gt;&lt;/code&gt;
+  object is associated.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;dfn id=dom-datatransferitem-kind title=dom-DataTransferItem-kind&gt;&lt;code&gt;kind&lt;/code&gt;&lt;/dfn&gt; attribute
+  must return the empty string if the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt;
+  object is in the &lt;i&gt;disabled mode&lt;/i&gt;; otherwise it must return the
+  string given in the cell from the second column of the following
+  table from the row whose cell in the first column contains &lt;a href=#the-drag-data-item-kind&gt;the
+  drag data item kind&lt;/a&gt; of the item represented by the
+  &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object:&lt;/p&gt;
+
+  &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; Kind &lt;th&gt; String
+   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt; &lt;i&gt;Plain Unicode string&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;string&lt;/code&gt;&quot;
+&lt;!-- DND-v3:    &lt;tr&gt; &lt;td&gt; &lt;i&gt;Blob&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;blob&lt;/code&gt;&quot;--&gt;
+    &lt;tr&gt;&lt;td&gt; &lt;i&gt;File&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;file&lt;/code&gt;&quot;
+&lt;!-- DND-v4:    &lt;tr&gt; &lt;td&gt; &lt;i&gt;Object&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;object&lt;/code&gt;&quot;--&gt;
+  &lt;/table&gt;&lt;p&gt;The &lt;dfn id=dom-datatransferitem-type title=dom-DataTransferItem-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt; attribute
+  must return the empty string if the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt;
+  object is in the &lt;i&gt;disabled mode&lt;/i&gt;; otherwise it must return
+  &lt;a href=#the-drag-data-item-type-string&gt;the drag data item type string&lt;/a&gt; of the item represented
+  by the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn id=dom-datatransferitem-getasstring title=dom-DataTransferItem-getAsString&gt;&lt;code&gt;getAsString(&lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; is null, abort these
+   steps.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object is not in the &lt;i title=concept-dnd-rw&gt;&lt;a href=#concept-dnd-rw&gt;read/write mode&lt;/a&gt;&lt;/i&gt; or the &lt;i title=concept-dnd-ro&gt;&lt;a href=#concept-dnd-ro&gt;read-only mode&lt;/a&gt;&lt;/i&gt;, abort these steps. The
+   callback is never invoked.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is not &lt;i&gt;Plain
+   Unicode string&lt;/i&gt;, abort these steps. The callback is never
+   invoked.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Otherwise, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;, passing the actual data of the item
+   represented by the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object as the
+   argument.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;!--DND-v3:
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;&lt;code&gt;getAsBlob()&lt;/code&gt;&lt;/dfn&gt;
+  method must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i
+   title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt; or the &lt;i
+   title=&quot;concept-dnd-ro&quot;&gt;read-only mode&lt;/i&gt;, return null and abort
+   these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+--&gt;&lt;!--DND-v4:
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Object&lt;/i&gt;,
+    return null.&lt;/p&gt;&lt;/li&gt;
+--&gt;&lt;!--DND-v3:
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;, then
+    return a new &lt;code&gt;File&lt;/code&gt; object representing the actual data
+    of the item represented by the &lt;code&gt;DataTransferItem&lt;/code&gt;
+    object.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Unicode Data
+    string&lt;/i&gt;, then return a new &lt;code&gt;Blob&lt;/code&gt; object
+    representing the actual data of the item represented by the
+    &lt;code&gt;DataTransferItem&lt;/code&gt; object, with the &lt;code
+    title=&quot;dom-Blob-type&quot;&gt;type&lt;/code&gt; of the &lt;code&gt;Blob&lt;/code&gt; being
+    &lt;span&gt;the drag data item type string&lt;/span&gt; and with the binary
+    data of the &lt;code&gt;Blob&lt;/code&gt; object being the Unicode string
+    encoded as UTF-8. &lt;a href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt;;
+    return a new &lt;code&gt;Blob&lt;/code&gt; object representing the actual data
+    of the item represented by the &lt;code&gt;DataTransferItem&lt;/code&gt;
+    object.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+--&gt;&lt;p&gt;The &lt;dfn id=dom-datatransferitem-getasfile title=dom-DataTransferItem-getAsFile&gt;&lt;code&gt;getAsFile()&lt;/code&gt;&lt;/dfn&gt;
+  method must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object is not in the &lt;i title=concept-dnd-rw&gt;&lt;a href=#concept-dnd-rw&gt;read/write mode&lt;/a&gt;&lt;/i&gt; or the &lt;i title=concept-dnd-ro&gt;&lt;a href=#concept-dnd-ro&gt;read-only mode&lt;/a&gt;&lt;/i&gt;, return null and abort
+   these steps.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is not &lt;i&gt;File&lt;/i&gt;,
+   then return null and abort these steps.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;File&lt;/code&gt; object representing the
+   actual data of the item represented by the
+   &lt;code&gt;&lt;a href=#datatransferitem&gt;DataTransferItem&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;/ol&gt;&lt;!--DND-v4:
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-getAsObject&quot;&gt;&lt;code&gt;getAsObject(&lt;var
+  title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i
+   title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt; or the &lt;i
+   title=&quot;concept-dnd-ro&quot;&gt;read-only mode&lt;/i&gt;, return null and abort
+   these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; be the actual data of the item
+    represented by the &lt;code&gt;DataTransferItem&lt;/code&gt; object.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Unicode Data
+    string&lt;/i&gt;, then &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code
+    title=&quot;&quot;&gt;DOMString&lt;/code&gt; containing the actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code&gt;Blob&lt;/code&gt; representing the
+    actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code&gt;File&lt;/code&gt; representing the
+    actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Object&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is the object that is the actual
+    data.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var
+   title=&quot;&quot;&gt;callback&lt;/var&gt;, passing a &lt;span&gt;structured clone&lt;/span&gt; of
+   &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; as the argument.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+--&gt;&lt;/div&gt;
+
+
+
   &lt;h4 id=the-dragevent-interface&gt;&lt;span class=secno&gt;8.7.4 &lt;/span&gt;The &lt;code&gt;&lt;a href=#dragevent&gt;DragEvent&lt;/a&gt;&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;p&gt;The drag-and-drop processing model involves several events. They
@@ -66797,7 +67019,7 @@
 
    &lt;/li&gt;
 
-   &lt;!-- v2: text/html as an export format --&gt;
+   &lt;!-- DND-v2: text/html as an export format --&gt;
 
 &lt;!--MD--&gt;
 
@@ -66821,37 +67043,8 @@
     &lt;/dl&gt;&lt;/li&gt;
 
 
-&lt;!-- v2: deal with multiple vCards --&gt;
-&lt;!--
    &lt;li&gt;
 
-    (if you put this back, don't forget to update this text as above)
-
-    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
-    and &lt;span title=&quot;extracting a vCard&quot;&gt;extract the vCard data from
-    those nodes&lt;/span&gt;, and then must add the resulting string to the
-    &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
-    member, associated with the &lt;code
-    title=&quot;&quot;&gt;text/directory;profile=vcard&lt;/code&gt; format.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    (if you put this back, don't forget to update this text as above)
-
-    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
-    and &lt;span title=&quot;extracting vEvent data&quot;&gt;extract the vEvent data
-    from those nodes&lt;/span&gt;, and then must add the resulting string to
-    the &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
-    member, associated with the &lt;code
-    title=&quot;&quot;&gt;text/calendar;component=vevent&lt;/code&gt; format.&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
     &lt;p&gt;Run the following substeps:&lt;/p&gt;
 
     &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; be an empty list of &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/a&gt;.&lt;/li&gt;
@@ -66871,7 +67064,7 @@
        &lt;dd&gt;Add to &lt;var title=&quot;&quot;&gt;urls&lt;/var&gt; the result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the element's &lt;code title=attr-img-src&gt;&lt;a href=#attr-img-src&gt;src&lt;/a&gt;&lt;/code&gt; content attribute relative to
        the element.&lt;/dd&gt;
 
-       &lt;!-- v2: more --&gt;
+       &lt;!-- DND-v2: more --&gt;
 
       &lt;/dl&gt;&lt;/li&gt;
 
@@ -67380,6 +67573,11 @@
 
   &lt;h4 id=the-draggable-attribute&gt;&lt;span class=secno&gt;8.7.7 &lt;/span&gt;The &lt;dfn title=attr-draggable&gt;&lt;code&gt;draggable&lt;/code&gt;&lt;/dfn&gt; attribute&lt;/h4&gt;
 
+&lt;!--
+XXX DND WIP plan:
+ 5. add dropzone=&quot;...&quot; feature
+--&gt;
+
   &lt;p&gt;All &lt;a href=#html-elements&gt;HTML elements&lt;/a&gt; may have the &lt;code title=attr-draggable&gt;&lt;a href=#the-draggable-attribute&gt;draggable&lt;/a&gt;&lt;/code&gt; content attribute set. The
   &lt;code title=attr-draggable&gt;&lt;a href=#the-draggable-attribute&gt;draggable&lt;/a&gt;&lt;/code&gt; attribute is an
   &lt;a href=#enumerated-attribute&gt;enumerated attribute&lt;/a&gt;. It has three states. The first

Modified: source
===================================================================
--- source	2010-10-29 18:59:03 UTC (rev 5650)
+++ source	2010-10-29 22:03:12 UTC (rev 5651)
@@ -74883,7 +74883,7 @@
 
   &lt;h3 id=&quot;dnd&quot;&gt;&lt;dfn&gt;Drag and drop&lt;/dfn&gt;&lt;/h3&gt;
 
-&lt;!-- v2 ideas for drag and drop:
+&lt;!-- v2: ideas for drag and drop:
 
      * being able to animate a drop target:
 
@@ -74921,10 +74921,18 @@
 
        Ack: Ben Laurie (@g)
 
-     * Promises. Should be able to say &quot;if you accept this drop, then
-       I can provide the File object that corresponds to it
-       eventually&quot;.
+     Other things listed below:
+      DND-v2: more native support: text/html from selections, etc
+      DND-v3: add Blob support
+      DND-v4: add structured clone support
+      DND-v5: add promises (should be able to say &quot;if you accept this
+              drop, then I can provide the File object that
+              corresponds to it eventually&quot;)
 
+         DataTransferPromise.type = 'string' or 'file' or 'blob' or 'data'
+                            .onneeddata - can wait until this fires to provide data
+                            .setData() - call this once you have data, must be the right type
+
 --&gt;
 
   &lt;p&gt;This section defines an event-based drag-and-drop mechanism.&lt;/p&gt;
@@ -75089,20 +75097,6 @@
 
     &lt;dl&gt;
 
-     &lt;dt&gt;&lt;dfn&gt;The drag data item type string&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;A Unicode string giving the type or format of the data,
-      generally given by a &lt;span&gt;MIME type&lt;/span&gt;. Some values that
-      are not &lt;span title=&quot;MIME type&quot;&gt;MIME types&lt;/span&gt; are
-      special-cased for legacy reasons. The API does not enforce the
-      use of &lt;span title=&quot;MIME type&quot;&gt;MIME types&lt;/span&gt;; other values
-      can be used as well. In all cases, however, the values are all
-      &lt;span&gt;converted to ASCII lowercase&lt;/span&gt; by the API.&lt;/p&gt;
-
-     &lt;/dd&gt;
-
      &lt;dt&gt;&lt;dfn&gt;The drag data item kind&lt;/dfn&gt;&lt;/dt&gt;
 
      &lt;dd&gt;
@@ -75116,17 +75110,19 @@
         &lt;p&gt;Text.&lt;/p&gt;
        &lt;/dd&gt;
 
+&lt;!-- DND-v3:
        &lt;dt&gt;&lt;i&gt;Blob&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;Binary data.&lt;/p&gt;
        &lt;/dd&gt;
+--&gt;
 
        &lt;dt&gt;&lt;i&gt;File&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;Binary data with a file name.&lt;/p&gt;
        &lt;/dd&gt;
 
-&lt;!-- v2:
+&lt;!-- DND-v4:
        &lt;dt&gt;&lt;i&gt;Structured object&lt;/i&gt;&lt;/dt&gt;
        &lt;dd&gt;
         &lt;p&gt;An object that will be cloned using the &lt;span&gt;structured clone&lt;/span&gt; algorithm.&lt;/p&gt;
@@ -75137,14 +75133,32 @@
 
      &lt;/dd&gt;
 
+     &lt;dt&gt;&lt;dfn&gt;The drag data item type string&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;A Unicode string giving the type or format of the data,
+      generally given by a &lt;span&gt;MIME type&lt;/span&gt;. Some values that
+      are not &lt;span title=&quot;MIME type&quot;&gt;MIME types&lt;/span&gt; are
+      special-cased for legacy reasons. The API does not enforce the
+      use of &lt;span title=&quot;MIME type&quot;&gt;MIME types&lt;/span&gt;; other values
+      can be used as well. In all cases, however, the values are all
+      &lt;span&gt;converted to ASCII lowercase&lt;/span&gt; by the API.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
      &lt;dt&gt;The actual data&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;A Unicode or binary string, optionally with a file name
-     (itself a Unicode string), &lt;!-- (v2:) or an object, --&gt; as per
+     (itself a Unicode string), &lt;!-- (DND-v4:) or an object, --&gt; as per
      &lt;span&gt;the drag data item kind&lt;/span&gt;.&lt;/p&gt;&lt;/dd&gt;
 
     &lt;/dl&gt;
 
+    &lt;p&gt;The &lt;span&gt;drag data store item list&lt;/span&gt; is ordered in the
+    order that the items were added to the list; most recently added
+    last.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
@@ -75587,10 +75601,10 @@
 
    &lt;li&gt;&lt;p&gt;For each item in the &lt;span&gt;drag data store item list&lt;/span&gt;
    &lt;!-- in some order...? --&gt; whose &lt;span title=&quot;the drag data item
-   kind&quot;&gt;kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt; (not &lt;i&gt;Blob&lt;/i&gt;), add the item's
-   data (the file, in particular its name and contents, as well as its
-   &lt;span title=&quot;the drag data item type string&quot;&gt;type&lt;/span&gt;) to the
-   list &lt;var title=&quot;&quot;&gt;L&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   kind&quot;&gt;kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt; &lt;!-- DND-v3: (not &lt;i&gt;Blob&lt;/i&gt;) --&gt;,
+   add the item's data (the file, in particular its name and contents,
+   as well as its &lt;span title=&quot;the drag data item type
+   string&quot;&gt;type&lt;/span&gt;) to the list &lt;var title=&quot;&quot;&gt;L&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;!-- &lt;li&gt;&lt;p&gt;Sort the list...?&lt;/p&gt;&lt;/li&gt; --&gt;
 
@@ -75682,12 +75696,11 @@
   &lt;span title=&quot;dom-DataTransferItems-removeItem&quot;&gt;deleter&lt;/span&gt; void (in unsigned long index);
   void &lt;span title=&quot;dom-DataTransferItems-clear&quot;&gt;clear&lt;/span&gt;();
 
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in DOMString data, in DOMString type);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;Blob&lt;/span&gt; data);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;File&lt;/span&gt; data);
-  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferItem&lt;/span&gt; data);&lt;!--
-v2:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in any data, in DOMString type);--&gt;&lt;!--
-v3:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferPromise&lt;/span&gt; data);--&gt;
+  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in DOMString data, in DOMString type);&lt;!--
+DND-v3:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;Blob&lt;/span&gt; data);--&gt;
+  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;File&lt;/span&gt; data);&lt;!--
+DND-v4:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in any data, in DOMString type);--&gt;&lt;!--
+DND-v5:  &lt;span&gt;DataTransferItem&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItems-add&quot;&gt;add&lt;/span&gt;(in &lt;span&gt;DataTransferPromise&lt;/span&gt; data);--&gt;
 };&lt;/pre&gt;
 
   &lt;dl class=&quot;domintro&quot;&gt;
@@ -75730,7 +75743,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;Adds a new entry for the given data to the &lt;span&gt;drag data
-    store&lt;/span&gt;. If the data is plain text &lt;!-- v2: or an object --&gt;
+    store&lt;/span&gt;. If the data is plain text &lt;!-- DND-v4: or an object --&gt;
     then a &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; string has to be provided
     also.&lt;/p&gt;
 
@@ -75747,12 +75760,12 @@
   When the &lt;code&gt;DataTransferItems&lt;/code&gt; object's
   &lt;code&gt;DataTransfer&lt;/code&gt; object is &lt;em&gt;not&lt;/em&gt; associated with a
   &lt;span&gt;drag data store&lt;/span&gt;, the &lt;code&gt;DataTransferItems&lt;/code&gt;
-  object's &lt;i&gt;mode&lt;/i&gt; is &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;span&gt;drag data
-  store&lt;/span&gt; referenced in this section (which is used only when the
-  &lt;code&gt;DataTransferItems&lt;/code&gt; object is not in the &lt;i&gt;disabled
-  mode&lt;/i&gt;) is the &lt;span&gt;drag data store&lt;/span&gt; with which the
-  &lt;code&gt;DataTransferItems&lt;/code&gt; object's &lt;code&gt;DataTransfer&lt;/code&gt;
-  object is associated.&lt;/p&gt;
+  object's &lt;i&gt;mode&lt;/i&gt; is the &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;span&gt;drag
+  data store&lt;/span&gt; referenced in this section (which is used only
+  when the &lt;code&gt;DataTransferItems&lt;/code&gt; object is not in the
+  &lt;i&gt;disabled mode&lt;/i&gt;) is the &lt;span&gt;drag data store&lt;/span&gt; with which
+  the &lt;code&gt;DataTransferItems&lt;/code&gt; object's
+  &lt;code&gt;DataTransfer&lt;/code&gt; object is associated.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-DataTransferItems-length&quot;&gt;&lt;code&gt;length&lt;/code&gt;&lt;/dfn&gt;
@@ -75773,7 +75786,11 @@
   an indexed property&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; of a
   &lt;code&gt;DataTransferItems&lt;/code&gt; object, the user agent must return a
   &lt;code&gt;DataTransferItem&lt;/code&gt; object representing the &lt;var
-  title=&quot;&quot;&gt;i&lt;/var&gt;th item in the &lt;span&gt;drag data store&lt;/span&gt;.&lt;/p&gt;
+  title=&quot;&quot;&gt;i&lt;/var&gt;th item in the &lt;span&gt;drag data store&lt;/span&gt;. The
+  same object must be returned each time. The
+  &lt;code&gt;DataTransferItem&lt;/code&gt; object must be associated with the
+  same &lt;code&gt;DataTransfer&lt;/code&gt; object as the
+  &lt;code&gt;DataTransferItems&lt;/code&gt; object when it is created.&lt;/p&gt;
 
   &lt;p&gt;To &lt;dfn title=&quot;dom-DataTransferItems-removeItem&quot;&gt;delete an
   existing indexed property&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;i&lt;/var&gt; of a
@@ -75799,41 +75816,282 @@
   items from the &lt;span&gt;drag data store&lt;/span&gt;. Otherwise, it must do
   nothing.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItems-add&quot;&gt;&lt;code&gt;add()&lt;/code&gt;&lt;/dfn&gt; method
+  must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItems&lt;/code&gt; object is not in the
+   &lt;i title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt;, return null and
+   abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+  &lt;/ol&gt;
+
   &lt;/div&gt;
 
 
   &lt;h5&gt;The &lt;code&gt;DataTransferItem&lt;/code&gt; interface&lt;/h5&gt;
 
-  &lt;p class=&quot;XXX&quot;&gt;...&lt;/p&gt;
+  &lt;p&gt;Each &lt;code&gt;DataTransferItem&lt;/code&gt; object is associated with a
+  &lt;code&gt;DataTransfer&lt;/code&gt; object.&lt;/p&gt;
 
-&lt;!--
+  &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;DataTransferItem&lt;/dfn&gt; {
+    readonly attribute DOMString &lt;span title=&quot;dom-DataTransferItem-kind&quot;&gt;kind&lt;/span&gt;;
+    readonly attribute DOMString &lt;span title=&quot;dom-DataTransferItem-type&quot;&gt;type&lt;/span&gt;;
+    void &lt;span title=&quot;dom-DataTransferItem-getAsText&quot;&gt;getAsText&lt;/span&gt;(in &lt;span&gt;FunctionStringCallback&lt;/span&gt; callback);&lt;!--
+DND-v3:    &lt;span&gt;Blob&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;getAsBlob&lt;/span&gt;();--&gt;
+    &lt;span&gt;File&lt;/span&gt; &lt;span title=&quot;dom-DataTransferItem-getAsFile&quot;&gt;getAsFile&lt;/span&gt;();&lt;!--
+DND-v4:    void &lt;span title=&quot;dom-DataTransferItem-getAsObject&quot;&gt;getAsObject&lt;/span&gt;(in &lt;span&gt;FunctionObjectCallback&lt;/span&gt; callback);--&gt;
+};
 
-         DataTransferItem.kind = 'string', 'file', 'blob', 'data'?, ...
-                         .type = MIME type
-                         .getTextData(function callback (data)) - throws if kind is not 'string'
-                         .getRawData(function callback (data)) - throws if kind is not 'data'
-                         .getBlob() - returns File or Blob (which are async anyway); throws if kind is 'data'
+[Callback=FunctionOnly, NoInterfaceObject]
+interface &lt;dfn&gt;FunctionStringCallback&lt;/dfn&gt; {
+  void &lt;span title=&quot;dom-FunctionStringCallback-handleEvent&quot;&gt;handleEvent&lt;/span&gt;(in DOMString data);
+};&lt;!--
 
-         DataTransferPromise.type = 'string' or 'file' or 'blob' or 'data'
-                            .onneeddata - can wait until this fires to provide data
-                            .setData() - call this once you have data, must be the right type
+// DND-v4:
+[Callback=FunctionOnly, NoInterfaceObject]
+interface &lt;dfn&gt;FunctionObjectCallback&lt;/dfn&gt; {
+  void &lt;span title=&quot;dom-FunctionObjectCallback-handleEvent&quot;&gt;handleEvent&lt;/span&gt;(in DOMString data);
+};--&gt;&lt;/pre&gt;
+
+  &lt;dl class=&quot;domintro&quot;&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-kind&quot;&gt;kind&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;span&gt;drag data item kind&lt;/span&gt;, one of: &quot;string&quot;,
+    &lt;!-- DND-v3: &quot;blob&quot;, --&gt; &quot;file&quot;&lt;!-- DND-v4: , &quot;object&quot; --&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-type&quot;&gt;type&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns the &lt;span&gt;drag data item type string&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-getAsString&quot;&gt;getAsString&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Invokes the callback with the string data as the argument, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Plain Unicode string&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+&lt;!-- DND-v3:
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;getAsBlob&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
+
+    &lt;p&gt;Returns a &lt;code&gt;Blob&lt;/code&gt; object, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt; or &lt;i&gt;File&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;/dd&gt;
 --&gt;
 
-&lt;!-- xxx mention that if an item is removed from a data store, DataTransferItem objects become unusable --&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-getAsFile&quot;&gt;getAsFile&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
+    &lt;p&gt;Returns a &lt;code&gt;File&lt;/code&gt; object, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;.&lt;/p&gt;
 
-&lt;!--
+   &lt;/dd&gt;
 
-XXX DND WIP
+&lt;!-- DND-v4:
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;file&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; . &lt;code title=&quot;dom-DataTransferItem-getAsFile&quot;&gt;getAsFile&lt;/code&gt;()&lt;/dt&gt;
+   &lt;dd&gt;
 
-plan:
- 4. expose model with new API
- 5. add dropzone=&quot;...&quot; feature
+    &lt;p&gt;Invokes the callback with the cloned object data as the argument, if the &lt;span&gt;drag data item kind&lt;/span&gt; is &lt;i&gt;Plain Unicode string&lt;/i&gt; or &lt;i&gt;Object&lt;/i&gt;.&lt;/p&gt;
 
+   &lt;/dd&gt;
 --&gt;
 
+  &lt;/dl&gt;
 
+  &lt;div class=&quot;impl&quot;&gt;
 
+  &lt;p&gt;While the &lt;code&gt;DataTransferItem&lt;/code&gt; object's
+  &lt;code&gt;DataTransfer&lt;/code&gt; object is associated with a &lt;span&gt;drag
+  data store&lt;/span&gt; and that &lt;span&gt;drag data store&lt;/span&gt;'s &lt;span&gt;drag
+  drop store item list&lt;/span&gt; still contains the item that the
+  &lt;code&gt;DataTransferItem&lt;/code&gt; object represents, the
+  &lt;code&gt;DataTransferItem&lt;/code&gt; object's &lt;i&gt;mode&lt;/i&gt; is the same as
+  the &lt;span&gt;drag data store mode&lt;/span&gt;. When the
+  &lt;code&gt;DataTransferItem&lt;/code&gt; object's &lt;code&gt;DataTransfer&lt;/code&gt;
+  object is &lt;em&gt;not&lt;/em&gt; associated with a &lt;span&gt;drag data
+  store&lt;/span&gt;, or if the item that the &lt;code&gt;DataTransferItem&lt;/code&gt;
+  object represents has been removed from the relevant &lt;span&gt;drag drop
+  store item list&lt;/span&gt;, the &lt;code&gt;DataTransferItem&lt;/code&gt; object's
+  &lt;i&gt;mode&lt;/i&gt; is the &lt;i&gt;disabled mode&lt;/i&gt;. The &lt;span&gt;drag data
+  store&lt;/span&gt; referenced in this section (which is used only when the
+  &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i&gt;disabled
+  mode&lt;/i&gt;) is the &lt;span&gt;drag data store&lt;/span&gt; with which the
+  &lt;code&gt;DataTransferItem&lt;/code&gt; object's &lt;code&gt;DataTransfer&lt;/code&gt;
+  object is associated.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-kind&quot;&gt;&lt;code&gt;kind&lt;/code&gt;&lt;/dfn&gt; attribute
+  must return the empty string if the &lt;code&gt;DataTransferItem&lt;/code&gt;
+  object is in the &lt;i&gt;disabled mode&lt;/i&gt;; otherwise it must return the
+  string given in the cell from the second column of the following
+  table from the row whose cell in the first column contains &lt;span&gt;the
+  drag data item kind&lt;/span&gt; of the item represented by the
+  &lt;code&gt;DataTransferItem&lt;/code&gt; object:&lt;/p&gt;
+
+  &lt;table&gt;
+   &lt;thead&gt;
+    &lt;tr&gt; &lt;th&gt; Kind &lt;th&gt; String
+   &lt;tbody&gt;
+    &lt;tr&gt; &lt;td&gt; &lt;i&gt;Plain Unicode string&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;string&lt;/code&gt;&quot;
+&lt;!-- DND-v3:    &lt;tr&gt; &lt;td&gt; &lt;i&gt;Blob&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;blob&lt;/code&gt;&quot;--&gt;
+    &lt;tr&gt; &lt;td&gt; &lt;i&gt;File&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;file&lt;/code&gt;&quot;
+&lt;!-- DND-v4:    &lt;tr&gt; &lt;td&gt; &lt;i&gt;Object&lt;/i&gt; &lt;td&gt; &quot;&lt;code title=&quot;&quot;&gt;object&lt;/code&gt;&quot;--&gt;
+  &lt;/table&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-type&quot;&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt; attribute
+  must return the empty string if the &lt;code&gt;DataTransferItem&lt;/code&gt;
+  object is in the &lt;i&gt;disabled mode&lt;/i&gt;; otherwise it must return
+  &lt;span&gt;the drag data item type string&lt;/span&gt; of the item represented
+  by the &lt;code&gt;DataTransferItem&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-getAsString&quot;&gt;&lt;code&gt;getAsString(&lt;var
+  title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; is null, abort these
+   steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i
+   title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt; or the &lt;i
+   title=&quot;concept-dnd-ro&quot;&gt;read-only mode&lt;/i&gt;, abort these steps. The
+   callback is never invoked.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is not &lt;i&gt;Plain
+   Unicode string&lt;/i&gt;, abort these steps. The callback is never
+   invoked.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Otherwise, &lt;span&gt;queue a task&lt;/span&gt; to invoke &lt;var
+   title=&quot;&quot;&gt;callback&lt;/var&gt;, passing the actual data of the item
+   represented by the &lt;code&gt;DataTransferItem&lt;/code&gt; object as the
+   argument.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+&lt;!--DND-v3:
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-getAsBlob&quot;&gt;&lt;code&gt;getAsBlob()&lt;/code&gt;&lt;/dfn&gt;
+  method must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i
+   title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt; or the &lt;i
+   title=&quot;concept-dnd-ro&quot;&gt;read-only mode&lt;/i&gt;, return null and abort
+   these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+--&gt;&lt;!--DND-v4:
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Object&lt;/i&gt;,
+    return null.&lt;/p&gt;&lt;/li&gt;
+--&gt;&lt;!--DND-v3:
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;, then
+    return a new &lt;code&gt;File&lt;/code&gt; object representing the actual data
+    of the item represented by the &lt;code&gt;DataTransferItem&lt;/code&gt;
+    object.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Unicode Data
+    string&lt;/i&gt;, then return a new &lt;code&gt;Blob&lt;/code&gt; object
+    representing the actual data of the item represented by the
+    &lt;code&gt;DataTransferItem&lt;/code&gt; object, with the &lt;code
+    title=&quot;dom-Blob-type&quot;&gt;type&lt;/code&gt; of the &lt;code&gt;Blob&lt;/code&gt; being
+    &lt;span&gt;the drag data item type string&lt;/span&gt; and with the binary
+    data of the &lt;code&gt;Blob&lt;/code&gt; object being the Unicode string
+    encoded as UTF-8. &lt;a href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt;;
+    return a new &lt;code&gt;Blob&lt;/code&gt; object representing the actual data
+    of the item represented by the &lt;code&gt;DataTransferItem&lt;/code&gt;
+    object.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+--&gt;
+
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-getAsFile&quot;&gt;&lt;code&gt;getAsFile()&lt;/code&gt;&lt;/dfn&gt;
+  method must run the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i
+   title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt; or the &lt;i
+   title=&quot;concept-dnd-ro&quot;&gt;read-only mode&lt;/i&gt;, return null and abort
+   these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is not &lt;i&gt;File&lt;/i&gt;,
+   then return null and abort these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;File&lt;/code&gt; object representing the
+   actual data of the item represented by the
+   &lt;code&gt;DataTransferItem&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;/ol&gt;
+
+&lt;!--DND-v4:
+  &lt;p&gt;The &lt;dfn
+  title=&quot;dom-DataTransferItem-getAsObject&quot;&gt;&lt;code&gt;getAsObject(&lt;var
+  title=&quot;&quot;&gt;callback&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must run the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;DataTransferItem&lt;/code&gt; object is not in the &lt;i
+   title=&quot;concept-dnd-rw&quot;&gt;read/write mode&lt;/i&gt; or the &lt;i
+   title=&quot;concept-dnd-ro&quot;&gt;read-only mode&lt;/i&gt;, return null and abort
+   these steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; be the actual data of the item
+    represented by the &lt;code&gt;DataTransferItem&lt;/code&gt; object.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Unicode Data
+    string&lt;/i&gt;, then &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code
+    title=&quot;&quot;&gt;DOMString&lt;/code&gt; containing the actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Blob&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code&gt;Blob&lt;/code&gt; representing the
+    actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;File&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is a &lt;code&gt;File&lt;/code&gt; representing the
+    actual data.&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span&gt;data drag item kind&lt;/span&gt; is &lt;i&gt;Object&lt;/i&gt;, then
+    &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; is the object that is the actual
+    data.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var
+   title=&quot;&quot;&gt;callback&lt;/var&gt;, passing a &lt;span&gt;structured clone&lt;/span&gt; of
+   &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; as the argument.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+--&gt;
+
+  &lt;/div&gt;
+
+
+
   &lt;h4&gt;The &lt;code&gt;DragEvent&lt;/code&gt; interface&lt;/h4&gt;
 
   &lt;p&gt;The drag-and-drop processing model involves several events. They
@@ -76147,7 +76405,7 @@
 
    &lt;/li&gt;
 
-   &lt;!-- v2: text/html as an export format --&gt;
+   &lt;!-- DND-v2: text/html as an export format --&gt;
 
 &lt;!--END w3c-html--&gt;&lt;!--MD--&gt;
 
@@ -76182,37 +76440,8 @@
 
 &lt;!--START complete--&gt;&lt;!--START epub--&gt;&lt;!--START html--&gt;
 
-&lt;!-- v2: deal with multiple vCards --&gt;
-&lt;!--
    &lt;li&gt;
 
-    (if you put this back, don't forget to update this text as above)
-
-    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
-    and &lt;span title=&quot;extracting a vCard&quot;&gt;extract the vCard data from
-    those nodes&lt;/span&gt;, and then must add the resulting string to the
-    &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
-    member, associated with the &lt;code
-    title=&quot;&quot;&gt;text/directory;profile=vcard&lt;/code&gt; format.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    (if you put this back, don't forget to update this text as above)
-
-    &lt;p&gt;The user agent must take the &lt;span&gt;list of dragged nodes&lt;/span&gt;
-    and &lt;span title=&quot;extracting vEvent data&quot;&gt;extract the vEvent data
-    from those nodes&lt;/span&gt;, and then must add the resulting string to
-    the &lt;code title=&quot;dom-DragEvent-dataTransfer&quot;&gt;dataTransfer&lt;/code&gt;
-    member, associated with the &lt;code
-    title=&quot;&quot;&gt;text/calendar;component=vevent&lt;/code&gt; format.&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
     &lt;p&gt;Run the following substeps:&lt;/p&gt;
 
     &lt;ol&gt;
@@ -76243,7 +76472,7 @@
        title=&quot;attr-img-src&quot;&gt;src&lt;/code&gt; content attribute relative to
        the element.&lt;/dd&gt;
 
-       &lt;!-- v2: more --&gt;
+       &lt;!-- DND-v2: more --&gt;
 
       &lt;/dl&gt;
 
@@ -76894,6 +77123,11 @@
 
   &lt;h4&gt;The &lt;dfn title=&quot;attr-draggable&quot;&gt;&lt;code&gt;draggable&lt;/code&gt;&lt;/dfn&gt; attribute&lt;/h4&gt;
 
+&lt;!--
+XXX DND WIP plan:
+ 5. add dropzone=&quot;...&quot; feature
+--&gt;
+
   &lt;p&gt;All &lt;span&gt;HTML elements&lt;/span&gt; may have the &lt;code
   title=&quot;attr-draggable&quot;&gt;draggable&lt;/code&gt; content attribute set. The
   &lt;code title=&quot;attr-draggable&quot;&gt;draggable&lt;/code&gt; attribute is an


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012517.html">[html5] r5650 - [giow] (0) dropzone 4/5, part 1: DataTransferItems	(WIP); also contains some Web [...]
</A></li>
	<LI>Next message: <A HREF="012519.html">[html5] r5652 - [giow] (0) dropzone 4/5, part, um,	3/2: some bits I somehow missed in the previo [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12518">[ date ]</a>
              <a href="thread.html#12518">[ thread ]</a>
              <a href="subject.html#12518">[ subject ]</a>
              <a href="author.html#12518">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
