<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r4814 - [giowt] (0) First draft of possible change to the	WebSocket handshake. Also, mak [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4814%20-%20%5Bgiowt%5D%20%280%29%20First%20draft%20of%20possible%20change%20to%20the%0A%09WebSocket%20handshake.%20Also%2C%20mak%20%5B...%5D&In-Reply-To=%3C20100302090145.C5ABE1C85130%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011681.html">
   <LINK REL="Next"  HREF="011683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r4814 - [giowt] (0) First draft of possible change to the	WebSocket handshake. Also, mak [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4814%20-%20%5Bgiowt%5D%20%280%29%20First%20draft%20of%20possible%20change%20to%20the%0A%09WebSocket%20handshake.%20Also%2C%20mak%20%5B...%5D&In-Reply-To=%3C20100302090145.C5ABE1C85130%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r4814 - [giowt] (0) First draft of possible change to the	WebSocket handshake. Also, mak [...]">whatwg at whatwg.org
       </A><BR>
    <I>Tue Mar  2 01:01:45 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="011681.html">[html5] r4813 - [e] (0) Make this more readable. Fixing	http://www.w3.org/Bugs/Public/show_bug.c [...]
</A></li>
        <LI>Next message: <A HREF="011683.html">[html5] r4815 - [e] (0) abnf typos
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11682">[ date ]</a>
              <a href="thread.html#11682">[ thread ]</a>
              <a href="subject.html#11682">[ subject ]</a>
              <a href="author.html#11682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-03-02 01:01:43 -0800 (Tue, 02 Mar 2010)
New Revision: 4814

Modified:
   complete.html
   index
   source
Log:
[giowt] (0) First draft of possible change to the WebSocket handshake. Also, make the protocol and API be consistently called WebSocket.

Modified: complete.html
===================================================================
--- complete.html	2010-02-25 10:55:53 UTC (rev 4813)
+++ complete.html	2010-03-02 09:01:43 UTC (rev 4814)
@@ -157,7 +157,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;Web Applications 1.0&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 25 February 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 2 March 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -946,7 +946,7 @@
      &lt;li&gt;&lt;a href=#feedback-from-the-protocol&gt;&lt;span class=secno&gt;10.3.3 &lt;/span&gt;Feedback from the protocol&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#garbage-collection-1&gt;&lt;span class=secno&gt;10.3.3.1 &lt;/span&gt;Garbage collection&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#websocket-protocol title=&quot;The Web Socket protocol enables
+     &lt;li&gt;&lt;a href=#websocket-protocol title=&quot;The WebSocket protocol enables
   two-way communication between a user agent running untrusted code
   running in a controlled environment to a remote host that has
   opted-in to communications from that code. The security model used
@@ -956,46 +956,48 @@
   is to provide a mechanism for browser-based applications that need
   two-way communication with servers that does not rely on opening
   multiple HTTP connections (e.g. using XMLHttpRequest or
-  &lt;iframe&gt;s and long polling).&quot;&gt;&lt;span class=secno&gt;10.3.4 &lt;/span&gt;The Web Socket protocol&lt;/a&gt;
+  &lt;iframe&gt;s and long polling).&quot;&gt;&lt;span class=secno&gt;10.3.4 &lt;/span&gt;The WebSocket protocol&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#introduction-7&gt;&lt;span class=secno&gt;10.3.4.1 &lt;/span&gt;Introduction&lt;/a&gt;
         &lt;ol&gt;
          &lt;li&gt;&lt;a href=#background-0&gt;&lt;span class=secno&gt;10.3.4.1.1 &lt;/span&gt;Background&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=#protocol-overview&gt;&lt;span class=secno&gt;10.3.4.1.2 &lt;/span&gt;Protocol overview&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#design-philosophy&gt;&lt;span class=secno&gt;10.3.4.1.3 &lt;/span&gt;Design philosophy&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#security-model&gt;&lt;span class=secno&gt;10.3.4.1.4 &lt;/span&gt;Security model&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#relationship-to-tcp/ip-and-http&gt;&lt;span class=secno&gt;10.3.4.1.5 &lt;/span&gt;Relationship to TCP/IP and HTTP&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#establishing-a-connection&gt;&lt;span class=secno&gt;10.3.4.1.6 &lt;/span&gt;Establishing a connection&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#writing-a-simple-web-socket-server&gt;&lt;span class=secno&gt;10.3.4.1.7 &lt;/span&gt;Writing a simple Web Socket server&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#subprotocols-using-the-web-socket-protocol&gt;&lt;span class=secno&gt;10.3.4.1.8 &lt;/span&gt;Subprotocols using the Web Socket protocol&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#handshake&gt;&lt;span class=secno&gt;10.3.4.1.3 &lt;/span&gt;Handshake&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#design-philosophy&gt;&lt;span class=secno&gt;10.3.4.1.4 &lt;/span&gt;Design philosophy&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#security-model&gt;&lt;span class=secno&gt;10.3.4.1.5 &lt;/span&gt;Security model&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#relationship-to-tcp-and-http&gt;&lt;span class=secno&gt;10.3.4.1.6 &lt;/span&gt;Relationship to TCP and HTTP&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#establishing-a-connection&gt;&lt;span class=secno&gt;10.3.4.1.7 &lt;/span&gt;Establishing a connection&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#subprotocols-using-the-websocket-protocol&gt;&lt;span class=secno&gt;10.3.4.1.8 &lt;/span&gt;Subprotocols using the WebSocket protocol&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=#terminology-1&gt;&lt;span class=secno&gt;10.3.4.1.9 &lt;/span&gt;Terminology&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#web-socket-urls&gt;&lt;span class=secno&gt;10.3.4.2 &lt;/span&gt;Web Socket URLs&lt;/a&gt;
+       &lt;li&gt;&lt;a href=#websocket-urls&gt;&lt;span class=secno&gt;10.3.4.2 &lt;/span&gt;WebSocket URLs&lt;/a&gt;
         &lt;ol&gt;
-         &lt;li&gt;&lt;a href=#parsing-web-socket-urls&gt;&lt;span class=secno&gt;10.3.4.2.1 &lt;/span&gt;Parsing Web Socket URLs&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#constructing-web-socket-urls&gt;&lt;span class=secno&gt;10.3.4.2.2 &lt;/span&gt;Constructing Web Socket URLs&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#parsing-websocket-urls&gt;&lt;span class=secno&gt;10.3.4.2.1 &lt;/span&gt;Parsing WebSocket URLs&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#constructing-websocket-urls&gt;&lt;span class=secno&gt;10.3.4.2.2 &lt;/span&gt;Constructing WebSocket URLs&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#client-side-requirements&gt;&lt;span class=secno&gt;10.3.4.3 &lt;/span&gt;Client-side requirements&lt;/a&gt;
         &lt;ol&gt;
-         &lt;li&gt;&lt;a href=#handshake&gt;&lt;span class=secno&gt;10.3.4.3.1 &lt;/span&gt;Handshake&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#handshake-0&gt;&lt;span class=secno&gt;10.3.4.3.1 &lt;/span&gt;Handshake&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=#data-framing&gt;&lt;span class=secno&gt;10.3.4.3.2 &lt;/span&gt;Data framing&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#closing-the-connection&gt;&lt;span class=secno&gt;10.3.4.3.3 &lt;/span&gt;Closing the connection&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#failing-the-connection&gt;&lt;span class=secno&gt;10.3.4.3.3 &lt;/span&gt;Failing the connection&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=#handling-errors-in-utf-8&gt;&lt;span class=secno&gt;10.3.4.3.4 &lt;/span&gt;Handling errors in UTF-8&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#server-side-requirements&gt;&lt;span class=secno&gt;10.3.4.4 &lt;/span&gt;Server-side requirements&lt;/a&gt;
         &lt;ol&gt;
-         &lt;li&gt;&lt;a href=&quot;#sending-the-server's-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.4.1 &lt;/span&gt;Sending the server's handshake&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=&quot;#reading-the-client's-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.4.2 &lt;/span&gt;Reading the client's handshake&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=&quot;#reading-the-client's-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.4.1 &lt;/span&gt;Reading the client's handshake&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=&quot;#sending-the-server's-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.4.2 &lt;/span&gt;Sending the server's handshake&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=#ws-sd-framing&gt;&lt;span class=secno&gt;10.3.4.4.3 &lt;/span&gt;Data framing&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#handling-errors-in-utf-8-0&gt;&lt;span class=secno&gt;10.3.4.4.4 &lt;/span&gt;Handling errors in UTF-8&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#closing-the-connection-0&gt;&lt;span class=secno&gt;10.3.4.5 &lt;/span&gt;Closing the connection&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#aborting-the-connection&gt;&lt;span class=secno&gt;10.3.4.4.4 &lt;/span&gt;Aborting the connection&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#handling-errors-in-utf-8-0&gt;&lt;span class=secno&gt;10.3.4.4.5 &lt;/span&gt;Handling errors in UTF-8&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#closing-the-connection&gt;&lt;span class=secno&gt;10.3.4.5 &lt;/span&gt;Closing the connection&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#security-considerations&gt;&lt;span class=secno&gt;10.3.4.6 &lt;/span&gt;Security considerations&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#iana-considerations-0&gt;&lt;span class=secno&gt;10.3.4.7 &lt;/span&gt;IANA considerations&lt;/a&gt;
         &lt;ol&gt;
          &lt;li&gt;&lt;a href=#registration-of-ws:-scheme&gt;&lt;span class=secno&gt;10.3.4.7.1 &lt;/span&gt;Registration of &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; scheme&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=#registration-of-wss:-scheme&gt;&lt;span class=secno&gt;10.3.4.7.2 &lt;/span&gt;Registration of &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; scheme&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=#registration-of-the-websocket-http-upgrade-keyword&gt;&lt;span class=secno&gt;10.3.4.7.3 &lt;/span&gt;Registration of the &quot;&lt;code title=&quot;&quot;&gt;WebSocket&lt;/code&gt;&quot; HTTP Upgrade keyword&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#websocket-origin&gt;&lt;span class=secno&gt;10.3.4.7.4 &lt;/span&gt;&lt;code&gt;WebSocket-Origin&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#websocket-protocol-0&gt;&lt;span class=secno&gt;10.3.4.7.5 &lt;/span&gt;&lt;code&gt;WebSocket-Protocol&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
-         &lt;li&gt;&lt;a href=#websocket-location&gt;&lt;span class=secno&gt;10.3.4.7.6 &lt;/span&gt;&lt;code&gt;WebSocket-Location&lt;/code&gt;&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#using-the-web-socket-protocol-from-other-specifications&gt;&lt;span class=secno&gt;10.3.4.8 &lt;/span&gt;Using the Web Socket protocol from other specifications&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;&lt;span class=secno&gt;10.3.4.7.4 &lt;/span&gt;&lt;code&gt;Sec-WebSocket-Key1&lt;/code&gt; and &lt;code&gt;Sec-WebSocket-Key2&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#sec-websocket-location&gt;&lt;span class=secno&gt;10.3.4.7.5 &lt;/span&gt;&lt;code&gt;Sec-WebSocket-Location&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#sec-websocket-origin&gt;&lt;span class=secno&gt;10.3.4.7.6 &lt;/span&gt;&lt;code&gt;Sec-WebSocket-Origin&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
+         &lt;li&gt;&lt;a href=#sec-websocket-protocol&gt;&lt;span class=secno&gt;10.3.4.7.7 &lt;/span&gt;&lt;code&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#using-the-websocket-protocol-from-other-specifications&gt;&lt;span class=secno&gt;10.3.4.8 &lt;/span&gt;Using the WebSocket protocol from other specifications&lt;/a&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#crossDocumentMessages&gt;&lt;span class=secno&gt;10.4 &lt;/span&gt;Cross-document messaging&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#introduction-8&gt;&lt;span class=secno&gt;10.4.1 &lt;/span&gt;Introduction&lt;/a&gt;&lt;/li&gt;
@@ -38446,16 +38448,16 @@
    character not followed by a U+000A LINE FEED (LF) character, and
    every occurrence of a U+000A LINE FEED (LF) character not preceded
    by a U+000D CARRIAGE RETURN (CR) character, by a two-character
-   string consisting of a U+000D CARRIAGE RETURN - U+000A LINE FEED
+   string consisting of a U+000D CARRIAGE RETURN U+000A LINE FEED
    (CRLF) character pair.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the element's &lt;code title=attr-textarea-wrap&gt;&lt;a href=#attr-textarea-wrap&gt;wrap&lt;/a&gt;&lt;/code&gt; attribute is in the &lt;a href=#attr-textarea-wrap-hard-state title=attr-textarea-wrap-hard-state&gt;Hard&lt;/a&gt; state, insert
-   U+000D CARRIAGE RETURN - U+000A LINE FEED (CRLF) character pairs
+   U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF) character pairs
    into the string using a UA-defined algorithm so that each line has
    no more than &lt;a href=#attr-textarea-cols-value title=attr-textarea-cols-value&gt;character
    width&lt;/a&gt; characters. For the purposes of this requirement,
    lines are delimited by the start of the string, the end of the
-   string, and U+000D CARRIAGE RETURN - U+000A LINE FEED (CRLF)
+   string, and U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF)
    character pairs.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;/div&gt;
@@ -55650,7 +55652,7 @@
    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;var title=concept-document-salvageable&gt;salvageable&lt;/var&gt; state to
    false. &lt;a href=#refsWEBSQL&gt;[WEBSQL]&lt;/a&gt; &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#close-the-web-socket-connection&gt;Close the Web Socket connection&lt;/a&gt; of any
+   &lt;li&gt;&lt;p&gt;&lt;a href=#close-the-websocket-connection&gt;Close the WebSocket connection&lt;/a&gt; of any
    &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; objects that were created by the &lt;code title=dom-WebSocket&gt;&lt;a href=#dom-websocket&gt;WebSocket()&lt;/a&gt;&lt;/code&gt; constructor visible on the
    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object. If this
    affected any &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; objects, the set
@@ -66956,7 +66958,7 @@
   must run these steps:&lt;/p&gt;
 
   &lt;ol&gt;&lt;!-- beware, this is very similar to the steps for what happens
-   during a redirect, in the protocol section --&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;#parse-a-web-socket-url's-components&quot;&gt;Parse a Web Socket URL's components&lt;/a&gt; from the
+   during a redirect, in the protocol section --&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;#parse-a-websocket-url's-components&quot;&gt;Parse a WebSocket URL's components&lt;/a&gt; from the
    &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;. If
    this fails, throw a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception and abort
    these steps.&lt;/li&gt;
@@ -66985,16 +66987,16 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;a href=#establish-a-web-socket-connection&gt;Establish a Web Socket connection&lt;/a&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; (if one was
+    &lt;p&gt;&lt;a href=#establish-a-websocket-connection&gt;Establish a WebSocket connection&lt;/a&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; (if one was
     specified), from &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, with the flag &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as
     the resource name, and with &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; as the
     protocol (if it is present).&lt;/p&gt;
 
-    &lt;p class=note&gt;If the &quot;&lt;a href=#establish-a-web-socket-connection&gt;establish a Web Socket
-    connection&lt;/a&gt;&quot; algorithm fails, it triggers the &quot;&lt;a href=#fail-the-web-socket-connection&gt;fail
-    the Web Socket connection&lt;/a&gt;&quot; algorithm, which then invokes
-    the &quot;&lt;a href=#close-the-web-socket-connection&gt;close the Web Socket connection&lt;/a&gt;&quot; algorithm,
-    which then establishes that the &quot;&lt;a href=#web-socket-connection-is-closed&gt;Web Socket connection is
+    &lt;p class=note&gt;If the &quot;&lt;a href=#establish-a-websocket-connection&gt;establish a WebSocket
+    connection&lt;/a&gt;&quot; algorithm fails, it triggers the &quot;&lt;a href=#fail-the-websocket-connection&gt;fail
+    the WebSocket connection&lt;/a&gt;&quot; algorithm, which then invokes
+    the &quot;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt;&quot; algorithm,
+    which then establishes that the &quot;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
     closed&lt;/a&gt;&quot;, which fires the &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -67019,7 +67021,7 @@
 
    &lt;dt&gt;&lt;dfn id=dom-websocket-open title=dom-WebSocket-OPEN&gt;&lt;code&gt;OPEN&lt;/code&gt;&lt;/dfn&gt; (numeric value 1)&lt;/dt&gt;
 
-   &lt;dd&gt;The &lt;a href=#web-socket-connection-is-established&gt;Web Socket connection is established&lt;/a&gt; and communication is possible.&lt;/dd&gt;
+   &lt;dd&gt;The &lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt; and communication is possible.&lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn id=dom-websocket-closed title=dom-WebSocket-CLOSED&gt;&lt;code&gt;CLOSED&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)&lt;/dt&gt;
 
@@ -67034,17 +67036,17 @@
   raise an &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception. If the &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; argument has any unpaired surrogates, then it
   must raise &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt;. If the connection is
   established, and the string has no unpaired surrogates, then the
-  user agent must &lt;a href=#send-data-using-the-web-socket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the Web
-  Socket&lt;/a&gt;. If the data cannot be sent, e.g. because it would
+  user agent must &lt;a href=#send-data-using-the-websocket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the
+  WebSocket&lt;/a&gt;. If the data cannot be sent, e.g. because it would
   need to be buffered but the buffer is full, the user agent must
-  &lt;a href=#close-the-web-socket-connection&gt;close the Web Socket connection&lt;/a&gt;. The method must then
+  &lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt;. The method must then
   return true if the connection is still established (and the data was
   queued or sent successfully), or false if the connection is closed
   (e.g. because the user agent just had a buffer overflow and failed
   to send the data).&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-websocket-close title=dom-WebSocket-close&gt;&lt;code&gt;close()&lt;/code&gt;&lt;/dfn&gt;
-  method must &lt;a href=#close-the-web-socket-connection&gt;close the Web Socket connection&lt;/a&gt; or
+  method must &lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt; or
   connection attempt, if any, and change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
   to &lt;code title=dom-WebSocket-CLOSED&gt;&lt;a href=#dom-websocket-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (2). If the
   connection is already closed, it must do nothing.&lt;/p&gt;
@@ -67094,13 +67096,13 @@
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-websocket-onclose title=handler-WebSocket-onclose&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-close&gt;close&lt;/code&gt;
   &lt;/table&gt;&lt;h4 id=feedback-from-the-protocol&gt;&lt;span class=secno&gt;10.3.3 &lt;/span&gt;Feedback from the protocol&lt;/h4&gt;
 
-  &lt;p&gt;When the &lt;i&gt;&lt;a href=#web-socket-connection-is-established&gt;Web Socket connection is established&lt;/a&gt;&lt;/i&gt;, the user
+  &lt;p&gt;When the &lt;i&gt;&lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;&lt;/i&gt;, the user
   agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to first change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
   to &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt; (1), and then
   &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-open&gt;open&lt;/code&gt; at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt;
   object.&lt;/p&gt;
 
-  &lt;p&gt;When &lt;i&gt;a Web Socket message has been received&lt;/i&gt; with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, the user agent must create an event that uses
+  &lt;p&gt;When &lt;i&gt;&lt;a href=#a-websocket-message-has-been-received&gt;a WebSocket message has been received&lt;/a&gt;&lt;/i&gt; with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, the user agent must create an event that uses
   the &lt;code&gt;&lt;a href=#messageevent&gt;MessageEvent&lt;/a&gt;&lt;/code&gt; interface, with the event name &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt;, which does not bubble, is not
   cancelable, has no default action, and whose &lt;code title=dom-MessageEvent-data&gt;&lt;a href=#dom-messageevent-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute is set to &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, and &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to check to see
   if the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt;
@@ -67108,7 +67110,7 @@
   (1), and if so, dispatch the event at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt;
   object.&lt;/p&gt;
 
-  &lt;p id=closeWebSocket&gt;When the &lt;i&gt;&lt;a href=#web-socket-connection-is-closed&gt;Web Socket connection is
+  &lt;p id=closeWebSocket&gt;When the &lt;i&gt;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
   closed&lt;/a&gt;&lt;/i&gt;, the user agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to first
   change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt;
   attribute's value to &lt;code title=dom-WebSocket-CLOSED&gt;&lt;a href=#dom-websocket-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (2), and then &lt;a href=#fire-a-simple-event&gt;fire
@@ -67119,7 +67121,7 @@
   runs.)&lt;/p&gt;
 
   &lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for all &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; &lt;a href=#queue-a-task title=&quot;queue a
-  task&quot;&gt;queued&lt;/a&gt; in this section is the &lt;dfn id=web-socket-task-source&gt;Web Socket task
+  task&quot;&gt;queued&lt;/a&gt; in this section is the &lt;dfn id=websocket-task-source&gt;WebSocket task
   source&lt;/dfn&gt;.&lt;/p&gt;
 
 
@@ -67130,15 +67132,14 @@
   &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; events.&lt;/p&gt;
 
   &lt;p&gt;If a &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object is garbage collected while its
-  connection is still open, the user agent must &lt;a href=#close-the-web-socket-connection&gt;close the Web
-  Socket connection&lt;/a&gt;.&lt;/p&gt;
+  connection is still open, the user agent must &lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt;.&lt;/p&gt;
 
 
   
 
   
 
-  &lt;h4 id=websocket-protocol title=&quot;The Web Socket protocol enables
+  &lt;h4 id=websocket-protocol title=&quot;The WebSocket protocol enables
   two-way communication between a user agent running untrusted code
   running in a controlled environment to a remote host that has
   opted-in to communications from that code. The security model used
@@ -67148,7 +67149,7 @@
   is to provide a mechanism for browser-based applications that need
   two-way communication with servers that does not rely on opening
   multiple HTTP connections (e.g. using XMLHttpRequest or
-  &lt;iframe&gt;s and long polling).&quot;&gt;&lt;span class=secno&gt;10.3.4 &lt;/span&gt;The Web Socket protocol&lt;/h4&gt;
+  &lt;iframe&gt;s and long polling).&quot;&gt;&lt;span class=secno&gt;10.3.4 &lt;/span&gt;The WebSocket protocol&lt;/h4&gt;
 
 
   &lt;h5 id=introduction-7&gt;&lt;span class=secno&gt;10.3.4.1 &lt;/span&gt;Introduction&lt;/h5&gt;
@@ -67176,8 +67177,8 @@
    replies.&lt;/li&gt;
 
   &lt;/ul&gt;&lt;p&gt;A simpler solution would be to use a single TCP connection for
-  traffic in both directions. This is what the Web Socket protocol
-  provides. Combined with the Web Socket API, it provides an
+  traffic in both directions. This is what the WebSocket protocol
+  provides. Combined with the WebSocket API, it provides an
   alternative to HTTP polling for two-way communication from a Web
   page to a remote server.
   &lt;/p&gt;
@@ -67199,25 +67200,35 @@
   &lt;p&gt;The handshake from the client looks as follows:&lt;/p&gt;
 
   &lt;pre&gt;GET /demo HTTP/1.1
+Host: example.com
+Connection: Upgrade
+Sec-WebSocket-Key2: 12998 5 Y3 1  .P00
+Sec-WebSocket-Protocol: sample
 Upgrade: WebSocket
-Connection: Upgrade
-Host: example.com
+Sec-WebSocket-Key1: 4 @1  46546xW%0l 1 5
 Origin: <A HREF="http://example.com">http://example.com</A>
-WebSocket-Protocol: sample&lt;/pre&gt;
 
+^n:ds[4U&lt;/pre&gt;
+
   &lt;p&gt;The handshake from the server looks as follows:&lt;/p&gt;
 
-  &lt;pre&gt;HTTP/1.1 101 Web Socket Protocol Handshake
+  &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake
 Upgrade: WebSocket
 Connection: Upgrade
-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
-WebSocket-Location: <A HREF="ws://example.com/demo">ws://example.com/demo</A>
-WebSocket-Protocol: sample&lt;/pre&gt;
+Sec-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
+Sec-WebSocket-Location: <A HREF="ws://example.com/demo">ws://example.com/demo</A>
+Sec-WebSocket-Protocol: sample
 
-  &lt;p&gt;The first three lines in each case are hard-coded (the exact case
-  and order matters); the remainder are an unordered &lt;a href=#ascii-case-insensitive&gt;ASCII
-  case-insensitive&lt;/a&gt; set of fields, one per line, that match the
-  following non-normative ABNF:
+8jKS'y:G*Co,Wxa-&lt;/pre&gt;
+
+  &lt;p&gt;The leading line from the client follows the Request-Line
+  format. The leading line from the server follows the Status-Line
+  format. The Request-Line and Status-Line productions are defined in
+  the HTTP specification.&lt;/p&gt;
+
+  &lt;p&gt;After the leading line in both cases come an unordered
+  &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; set of fields, one per line,
+  that each match the following non-normative ABNF:
   &lt;a href=#refsABNF&gt;[ABNF]&lt;/a&gt;
 
   &lt;/p&gt;
@@ -67232,13 +67243,20 @@
 any-char      = %x0000-0009 / %x000B-000C / %x000E-10FFFF
                 ; a Unicode character other than U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR)&lt;/pre&gt;
 
+  &lt;p class=note&gt;The character set for the above ABNF is Unicode. The
+  fields themselves are encoded as UTF-8.&lt;/p&gt;
+
   &lt;p&gt;Lines that don't match the above production cause the connection
   to be aborted.&lt;/p&gt;
 
-  &lt;p class=note&gt;The character set for the above ABNF is Unicode. The
-  headers themselves are encoded as UTF-8.&lt;/p&gt;
+  &lt;p&gt;Finally, after the last field, the client sends 10 bytes
+  starting with 0x0D 0x0A and followed by 8 random bytes, part of a
+  challenge, and the server sends 18 bytes starting with 0x0D 0x0A and
+  followed by 16 bytes consisting of a challenge response. The details
+  of this challenge and other parts of the handshake are described in
+  the next section.&lt;/p&gt;
 
-  &lt;p&gt;Once the client and server have both sent their handshakes, and
+  &lt;hr&gt;&lt;p&gt;Once the client and server have both sent their handshakes, and
   if the handshake was successful, then the data transfer part
   starts. This is a two-way communication channel where each side can,
   independently from the other, send data at will.&lt;/p&gt;
@@ -67247,12 +67265,14 @@
   with a 0x00 byte and ends with a 0xFF byte, with the UTF-8 text in
   between.&lt;/p&gt;
 
-  &lt;p&gt;The Web Socket protocol uses this framing so that specifications
-  that use the Web Socket protocol can expose such connections using
+  &lt;p&gt;The WebSocket protocol uses this framing so that specifications
+  that use the WebSocket protocol can expose such connections using
   an event-based mechanism instead of requiring users of those
   specifications to implement buffering and piecing together of
   messages manually.&lt;/p&gt;
 
+  &lt;!-- XXX Close Handshake --&gt;
+
   &lt;p&gt;The protocol is designed to support other frame types in
   future. Instead of the 0x00 byte, other bytes might in future be
   defined. Frames denoted by bytes that do not have the high bit set
@@ -67272,6 +67292,7 @@
 
   &lt;/p&gt;
 
+  &lt;!-- XXX Close Handshake --&gt;
   &lt;pre&gt;; the wire protocol as allowed by this specification
 frames        = *frame
 frame         = text-frame
@@ -67289,6 +67310,11 @@
   &lt;p class=note&gt;The above ABNF is intended for a binary octet
   environment.&lt;/p&gt;
 
+  &lt;!-- XXX Close Handshake --&gt;
+  &lt;p class=warning&gt;At this time, the WebSocket protocol cannot be
+  used to send binary data. Using any of the frame types other than
+  0x00 is invalid.&lt;/p&gt;
+
   &lt;hr&gt;&lt;p&gt;The following diagrams summarise the protocol:&lt;/p&gt;
 
   &lt;pre&gt;Handshake
@@ -67301,41 +67327,202 @@
    `-- (0x80 to 0xFF) --&gt; Length --&gt; Data... -------&gt;-'&lt;/pre&gt;
 
 
-  &lt;h6 id=design-philosophy&gt;&lt;span class=secno&gt;10.3.4.1.3 &lt;/span&gt;Design philosophy&lt;/h6&gt;
 
+
+  &lt;h6 id=handshake&gt;&lt;span class=secno&gt;10.3.4.1.3 &lt;/span&gt;Handshake&lt;/h6&gt;
+
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
-  &lt;p&gt;The Web Socket protocol is designed on the principle that there
+  &lt;p&gt;The handshake is intended to be compatible with HTTP-based
+  server-side software, so that a single port can be used by both HTTP
+  clients talking to that server and WebSocket clients talking to that
+  server. To this end, the WebSocket client's handshake appears to
+  HTTP servers to be a regular GET request with an Upgrade offer:&lt;/p&gt;
+
+  &lt;pre&gt;GET /resource HTTP/1.1
+Upgrade: WebSocket
+Connection: Upgrade&lt;/pre&gt;
+
+  &lt;p&gt;Additional fields are used to select options in the WebSocket
+  protocol. The only option available in this version is the
+  subprotocol selector, &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;:&lt;/p&gt;
+
+  &lt;pre&gt;Sec-WebSocket-Protocol: chat&lt;/pre&gt;
+
+  &lt;p&gt;This field indicates the subprotocol (the application-level
+  protocol layered over the WebSocket protocol) that the client
+  intends to use. The server echoes this field in its handshake to
+  indicate that it supports that subprotocol.&lt;/p&gt;
+
+  &lt;p&gt;The remainder of the handshake is all security-related. First,
+  the &lt;code title=http-host&gt;Host&lt;/code&gt; field is used to protect
+  against DNS rebinding attacks and to allow multiple domains to be
+  served from one IP address.&lt;/p&gt;
+
+  &lt;pre&gt;Host: example.com&lt;/pre&gt;
+
+  &lt;p&gt;The server includes the hostname in the &lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;Sec-WebSocket-Location&lt;/a&gt;&lt;/code&gt;
+  field of its handshake, so that both the client and the server can
+  verify that they agree on which host is in use.&lt;/p&gt;
+
+  &lt;p&gt;Second, the &lt;code title=http-origin&gt;Origin&lt;/code&gt; field is
+  used to protect against unauthorized cross-origin use of a WebSocket
+  server by scripts using the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; API in a Web
+  browser. The server specifies which origin it is willing to receive
+  requests from by including a &lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;Sec-WebSocket-Origin&lt;/a&gt;&lt;/code&gt; field
+  with that origin. If multiple origins are authorized, the server
+  echoes the value in the &lt;code title=http-origin&gt;Origin&lt;/code&gt;
+  field of the client's handshake.&lt;/p&gt;
+
+  &lt;pre&gt;Origin: <A HREF="http://example.com&lt;/pre">http://example.com&lt;/pre</A>&gt;
+
+  &lt;p&gt;Finally, the server has to prove to the client that it received
+  the client's WebSocket handshake, so that the server doesn't accept
+  connections that are not WebSocket connections. This prevents an
+  attacker from tricking a WebSocket server by sending it
+  carefully-crafted packets using &lt;code&gt;XMLHttpRequest&lt;/code&gt; or a
+  &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; submission.&lt;/p&gt;
+
+  &lt;p&gt;To prove that the handshake was received, the server has to take
+  three pieces of information and combine them to form a response. The
+  first two pieces of information come from the &lt;code title=http-sec-websocket-key&gt;Sec-WebSocket-Key1&lt;/code&gt; and &lt;code title=http-sec-websocket-key&gt;Sec-WebSocket-Key2&lt;/code&gt; fields in
+  the client handshake:&lt;/p&gt;
+
+  &lt;pre&gt;Sec-WebSocket-Key1: 18x 6]8vM;54 *(5:  {   U1]8  z [  8
+Sec-WebSocket-Key2: 1_ tx7X d  &lt;  nw  334J702) 7]o}` 0&lt;/pre&gt;
+
+  &lt;p&gt;For each of these fields, the server has to take the digits from
+  the value to obtain a number (in this case 1868545188 and 1733470270
+  respectively), then divide that number by the number of spaces
+  characters in the value (in this case 12 and 10) to obtain a 32-bit
+  number (155712099 and 173347027). These two resulting numbers are
+  then used in the server handshake, as described below.&lt;/p&gt;
+
+  &lt;p&gt;The counting of spaces is intended to make it impossible to
+  smuggle this field into the resource name; making this even harder
+  is the presence of &lt;em&gt;two&lt;/em&gt; such fields, and the use of a
+  newline as the only reliable indicator that the end of the key has
+  been reached. The use of random characters interspersed with the
+  spaces and the numbers ensures that the implementor actually looks
+  for spaces and newlines, instead of being treating any character
+  like a space, which would make it again easy to smuggle the fields
+  into the path and trick the server. Finally, &lt;em&gt;dividing&lt;/em&gt; by
+  this number of spaces is intended to make sure that even the most
+  na&iuml;ve of implementations will check for spaces, since if ther
+  server does not verify that there are some spaces, the server will
+  try to divide by zero, which is usually fatal (a correct handshake
+  will always have at least one space).
+
+  &lt;p&gt;The third piece of information is given after the fields, in the
+  last eight bytes of the handshake, expressed here as they would be
+  seen if interpreted as ASCII:&lt;/p&gt;
+
+  &lt;pre&gt;Tm[K T2u&lt;/pre&gt;
+
+  &lt;p&gt;The concatenation of the number obtained from processing the
+  &lt;code title=http-sec-websocket-key&gt;Sec-WebSocket-Key1&lt;/code&gt;
+  field, expressed as a little-endian 32 bit number, the number
+  obtained from processing the &lt;code title=http-sec-websocket-key&gt;Sec-WebSocket-Key2&lt;/code&gt; field,
+  again expressed as a little-endian 32 bit number, and finally the
+  eight bytes at the end of the handshake, form a 128 bit string whose
+  MD5 sum is then used by the server to prove that it read the
+  handshake.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;The handshake from the server is much simpler than the client
+  handshake. The first line is an HTTP Status-Line, with the status
+  code 101 (the HTTP version and reason phrase aren't important):&lt;/p&gt;
+
+  &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake&lt;/pre&gt;
+
+  &lt;p&gt;The fields follow. Two of the fields are just for compatibility
+  with HTTP:&lt;/p&gt;
+
+  &lt;pre&gt;Upgrade: WebSocket
+Connection: Upgrade&lt;/pre&gt;
+
+  &lt;p&gt;Two of the fields are part of the security model described
+  above, echoing the origin and stating the exact host, port, resource
+  name, and whether the connection is expected to be encrypted:&lt;/p&gt;
+
+  &lt;pre&gt;Sec-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
+Sec-WebSocket-Location: <A HREF="ws://example.com/demo&lt;/pre">ws://example.com/demo&lt;/pre</A>&gt;
+
+  &lt;p&gt;These fields are checked by the Web browser when it is acting as
+  a &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; client for scripted pages. A server that
+  only handles one origin and only serves one resource can therefore
+  just return hard-coded values and does not need to parse the
+  client's handshake to verify the correctness of the values.&lt;/p&gt;
+
+  &lt;p&gt;Option fields can also be included. In this version of the
+  protocol, the only option field is &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;,
+  which indicates the subprotocol that the server speaks. Web browsers
+  verify that the server included the same value as was specified in
+  the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; constructor, so a server that speaks
+  multiple subprotocols has to make sure it selects one based on the
+  client's handshake and specifies the right one in its handshake.&lt;/p&gt;
+
+  &lt;pre&gt;Sec-WebSocket-Protocol: chat&lt;/pre&gt;
+
+  &lt;p&gt;After the fields, the server sends the aforementioned MD5 sum, a
+  16 byte (128 bit) value, shown here as if interpreted as ASCII:&lt;/p&gt;
+
+  &lt;pre&gt;fQJ,fN/4F4!~K~MH&lt;/pre&gt;
+
+  &lt;p&gt;This value depends on what the client sends, as described
+  above. If it doesn't match what the client is expecting, the client
+  would disconnect.&lt;/p&gt;
+
+  &lt;p&gt;Having part of the handshake appear after the fields ensures
+  that both the server and the client verify that the connection is
+  not being interrupted by an HTTP intermediary such as a
+  man-in-the-middle cache or proxy.&lt;/p&gt;
+
+
+
+  &lt;h6 id=design-philosophy&gt;&lt;span class=secno&gt;10.3.4.1.4 &lt;/span&gt;Design philosophy&lt;/h6&gt;
+
+  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
+
+  &lt;p&gt;The WebSocket protocol is designed on the principle that there
   should be minimal framing (the only framing that exists is to make
   the protocol frame-based instead of stream-based, and to support a
   distinction between Unicode text and binary frames). It is expected
-  that metadata would be layered on top of Web Socket by the
+  that metadata would be layered on top of WebSocket by the
   application layer, in the same way that metadata is layered on top
-  of TCP/IP by the application layer (HTTP).&lt;/p&gt;
+  of TCP by the application layer (HTTP).&lt;/p&gt;
 
-  &lt;p&gt;Conceptually, Web Socket is really just a layer on top of TCP/IP
+  &lt;p&gt;Conceptually, WebSocket is really just a layer on top of TCP
   that adds a Web &quot;origin&quot;-based security model for browsers; adds an
   addressing and protocol naming mechanism to support multiple
   services on one port and multiple host names on one IP address; and
   layers a framing mechanism on top of TCP to get back to the IP
   packet mechanism that TCP is built on, but without length
-  limits. Other than that, it adds nothing. Basically it is intended
-  to be as close to just exposing raw TCP/IP to script as possible
+  limits.
+
+  &lt;!-- XXX Close Handshake --&gt;
+
+  Other than that, it adds nothing. Basically it is intended
+  to be as close to just exposing raw TCP to script as possible
   given the constraints of the Web. It's also designed in such a way
   that its servers can share a port with HTTP servers, by having its
   handshake be a valid HTTP Upgrade handshake also.&lt;/p&gt;
 
+  &lt;p&gt;The protocol is intended to be extensible; future versions will
+  likely introduce a mechanism to compress data and might support
+  sending binary data.&lt;/p&gt;
 
-  &lt;h6 id=security-model&gt;&lt;span class=secno&gt;10.3.4.1.4 &lt;/span&gt;Security model&lt;/h6&gt;
 
+  &lt;h6 id=security-model&gt;&lt;span class=secno&gt;10.3.4.1.5 &lt;/span&gt;Security model&lt;/h6&gt;
+
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
-  &lt;p&gt;The Web Socket protocol uses the origin model used by Web
-  browsers to restrict which Web pages can contact a Web Socket server
-  when the Web Socket protocol is used from a Web page. Naturally,
-  when the Web Socket protocol is used directly (not from a Web page),
-  the origin model is not useful, as the client can provide any
-  arbitrary origin string.&lt;/p&gt;
+  &lt;p&gt;The WebSocket protocol uses the origin model used by Web
+  browsers to restrict which Web pages can contact a WebSocket server
+  when the WebSocket protocol is used from a Web page. Naturally,
+  when the WebSocket protocol is used by a dedicated client directly
+  (i.e. not from a Web page through a Web browser), the origin model
+  is not useful, as the client can provide any arbitrary origin
+  string.&lt;/p&gt;
 
   &lt;p&gt;This protocol is intended to fail to establish a connection with
   servers of pre-existing protocols like SMTP or HTTP, while allowing
@@ -67345,34 +67532,45 @@
   the handshake is finished (thus limiting how much the server can be
   influenced).&lt;/p&gt;
 
+  &lt;p&gt;It is similarly intended to fail to establish a connection when
+  data from other protocols, especially HTTP, is sent to a WebSocket
+  server, for example as might happen if an HTML &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt;
+  were submitted to a WebSocket server. This is primarily achieved by
+  requiring that the server prove that it read the handshake, which it
+  can only do if the handshake contains the appropriate parts which
+  themselves can only be sent by a WebSocket handshake; in
+  particular, fields starting with &lt;code title=&quot;&quot;&gt;Sec-&lt;/code&gt; cannot
+  be set by an attacker from a Web browser, even when using
+  &lt;code&gt;XMLHttpRequest&lt;/code&gt;.&lt;/p&gt;
 
-  &lt;h6 id=relationship-to-tcp/ip-and-http&gt;&lt;span class=secno&gt;10.3.4.1.5 &lt;/span&gt;Relationship to TCP/IP and HTTP&lt;/h6&gt;
 
+  &lt;h6 id=relationship-to-tcp-and-http&gt;&lt;span class=secno&gt;10.3.4.1.6 &lt;/span&gt;Relationship to TCP and HTTP&lt;/h6&gt;
+
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
-  &lt;p&gt;The Web Socket protocol is an independent TCP-based protocol. Its
+  &lt;p&gt;The WebSocket protocol is an independent TCP-based protocol. Its
   only relationship to HTTP is that its handshake is interpreted by
   HTTP servers as an Upgrade request.&lt;/p&gt;
 
   &lt;p&gt;Based on the expert recommendation of the IANA&lt;!-- [IANA #257455]
-  --&gt;, the Web Socket protocol by default uses port 80 for regular Web
-  Socket connections and port 443 for Web Socket connections tunneled
+  --&gt;, the WebSocket protocol by default uses port 80 for regular WebSocket connections and port 443 for WebSocket connections tunneled
   over TLS.&lt;/p&gt;
 
 
-  &lt;h6 id=establishing-a-connection&gt;&lt;span class=secno&gt;10.3.4.1.6 &lt;/span&gt;Establishing a connection&lt;/h6&gt;
+  &lt;h6 id=establishing-a-connection&gt;&lt;span class=secno&gt;10.3.4.1.7 &lt;/span&gt;Establishing a connection&lt;/h6&gt;
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
-  &lt;p&gt;There are several options for establishing a Web Socket connection.&lt;/p&gt;
+  &lt;p&gt;There are several options for establishing a WebSocket connection.&lt;/p&gt;
 
   &lt;p&gt;On the face of it, the simplest method would seem to be to use
-  port 80 to get a direct connection to a Web Socket server. Port 80
-  traffic, however, will often be intercepted by HTTP proxies, which
-  can lead to the connection failing to be established.&lt;/p&gt;
+  port 80 to get a direct connection to a WebSocket server. Port 80
+  traffic, however, will often be intercepted by man-in-the-middle
+  HTTP proxies, which can lead to the connection failing to be
+  established.&lt;/p&gt;
 
   &lt;p&gt;The most reliable method, therefore, is to use TLS encryption and
-  port 443 to connect directly to a Web Socket server. This has the
+  port 443 to connect directly to a WebSocket server. This has the
   advantage of being more secure; however, TLS encryption can be
   computationally expensive.&lt;/p&gt;
 
@@ -67382,94 +67580,26 @@
   to be a regular GET request with an Upgrade offer. In relatively
   simple setups with just one IP address and a single server for all
   traffic to a single hostname, this might allow a practical way for
-  systems based on the Web Socket protocol to be deployed. In more
+  systems based on the WebSocket protocol to be deployed. In more
   elaborate setups (e.g. with load balancers and multiple servers), a
-  dedicated set of hosts for Web Socket connections separate from the
+  dedicated set of hosts for WebSocket connections separate from the
   HTTP servers is probably easier to manage.&lt;/p&gt;
 
 
-  &lt;h6 id=writing-a-simple-web-socket-server&gt;&lt;span class=secno&gt;10.3.4.1.7 &lt;/span&gt;Writing a simple Web Socket server&lt;/h6&gt;
 
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
+  &lt;h6 id=subprotocols-using-the-websocket-protocol&gt;&lt;span class=secno&gt;10.3.4.1.8 &lt;/span&gt;Subprotocols using the WebSocket protocol&lt;/h6&gt;
 
-  &lt;p&gt;If the Web Socket protocol is being used to provide a feature for
-  a specific site, then the handshake can be hard-coded, and the data
-  provided by the client in the handshake can be safely ignored. This
-  section describes an implementation strategy for this case.&lt;/p&gt;
-
-  &lt;p&gt;Listen on a port for TCP/IP. Upon receiving a connection request,
-  open a connection and send the following bytes back to the
-  client:&lt;/p&gt;
-
-  &lt;pre&gt;48 54 54 50 2F 31 2E 31  20 31 30 31 20 57 65 62
-20 53 6F 63 6B 65 74 20  50 72 6F 74 6F 63 6F 6C
-20 48 61 6E 64 73 68 61  6B 65 0D 0A 55 70 67 72
-61 64 65 3A 20 57 65 62  53 6F 63 6B 65 74 0D 0A
-43 6F 6E 6E 65 63 74 69  6F 6E 3A 20 55 70 67 72
-61 64 65 0D 0A 57 65 62  53 6F 63 6B 65 74 2D 4F
-72 69 67 69 6E 3A 20&lt;/pre&gt;
-
-  &lt;p&gt;Send the &lt;a href=#ascii-serialization-of-an-origin title=&quot;ASCII serialization of an origin&quot;&gt;ASCII
-  serialization&lt;/a&gt; of the origin from which the server is willing
-  to accept connections. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;div class=example&gt;
-   &lt;p&gt;For example: &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com&lt;/code">http://example.com&lt;/code</A>&gt;&lt;/p&gt;
-  &lt;/div&gt;
-
-  &lt;p&gt;Continue by sending the following bytes back to the client:&lt;/p&gt;
-
-  &lt;pre&gt;0D 0A 57 65 62 53 6F 63  6B 65 74 2D 4C 6F 63 61
-74 69 6F 6E 3A 20&lt;/pre&gt;
-
-  &lt;p&gt;Send the &lt;a href=#url&gt;URL&lt;/a&gt; of the Web Socket script.&lt;/p&gt;
-
-  &lt;div class=example&gt;
-   &lt;p&gt;For example: &lt;code title=&quot;&quot;&gt;<A HREF="ws://example.com/demo&lt;/code">ws://example.com/demo&lt;/code</A>&gt;&lt;/p&gt;
-  &lt;/div&gt;
-
-  &lt;p&gt;Finish the handshake by sending the four bytes 0x0D 0x0A 0x0D
-  0x0A to the client. Then, read data &lt;em&gt;from&lt;/em&gt; the client until
-  four bytes 0x0D 0x0A 0x0D 0x0A are read.&lt;/p&gt;
-
-  &lt;p class=note&gt;User agents will drop the connection after the
-  handshake if the origin and URL sent as part of the algorithm above
-  don't match what the client sent to the server, to protect the
-  server from third-party scripts. This is why the server has to send
-  these strings: to confirm which origins and URLs the server is
-  willing to service.&lt;/p&gt;
-
-  &lt;p&gt;At this point, there are two concerns: receiving frames and
-  sending frames.&lt;/p&gt;
-
-  &lt;p&gt;To receive a frame, read a byte, verify that it is a 0x00 byte,
-  then read bytes until you find a 0xFF byte, and interpret all the
-  bytes between the 0x00 and 0xFF bytes as a UTF-8 string (the frame
-  payload, or message). This process can be repeated as necessary. If
-  at any point the first byte of one of these sequences is not 0x00,
-  then an error has occurred, and closing the connection is the
-  appropriate response.&lt;/p&gt;
-
-  &lt;p&gt;To send a frame, first send a 0x00 byte, then send the message as
-  a UTF-8 string, then send a 0xFF byte. Again, this process can be
-  repeated as necessary.&lt;/p&gt;
-
-  &lt;p&gt;The connection can be closed as desired.&lt;/p&gt;
-
-
-  &lt;h6 id=subprotocols-using-the-web-socket-protocol&gt;&lt;span class=secno&gt;10.3.4.1.8 &lt;/span&gt;Subprotocols using the Web Socket protocol&lt;/h6&gt;
-
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
   &lt;p&gt;The client can request that the server use a specific subprotocol
-  by including the &lt;code title=http-websocket-protocol&gt;&lt;a href=#websocket-protocol-0&gt;Websocket-Protocol&lt;/a&gt;&lt;/code&gt; header in
-  its handshake. If it is specified, the server needs to include the
-  same header and value in its response for the connection to be
-  established.&lt;/p&gt;
+  by including the &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-Websocket-Protocol&lt;/a&gt;&lt;/code&gt;
+  field in its handshake. If it is specified, the server needs to
+  include the same field and value in its response for the connection
+  to be established.&lt;/p&gt;
 
   &lt;p&gt;These subprotocol names do not need to be registered, but if a
   subprotocol is intended to be implemented by multiple independent
-  Web Socket servers, potential clashes with the names of subprotocols
+  WebSocket servers, potential clashes with the names of subprotocols
   defined independently can be avoided by using names that contain the
   domain name of the subprotocol's originator. For example, if Example
   Corporation were to create a Chat subprotocol to be implemented by
@@ -67483,7 +67613,7 @@
   &lt;p&gt;Subprotocols can be versioned in backwards-incompatible ways by
   changing the subprotocol name, eg. going from &quot;bookings.example.net&quot;
   to &quot;bookings.example.net2&quot;. These subprotocols would be considered
-  completely separate by Web Socket clients. Backwards-compatible
+  completely separate by WebSocket clients. Backwards-compatible
   versioning can be implemented by reusing the same subprotocol string
   but carefully designing the actual subprotocol to support this kind
   of extensibility.&lt;/p&gt;
@@ -67494,16 +67624,16 @@
 
 
   &lt;p&gt;When an implementation is required to &lt;i&gt;send&lt;/i&gt; data as part of
-  the Web Socket protocol, the implementation may delay the actual
+  the WebSocket protocol, the implementation may delay the actual
   transmission arbitrarily, e.g. buffering data so as to send fewer IP
   packets.&lt;/p&gt;
 
 
-  &lt;h5 id=web-socket-urls&gt;&lt;span class=secno&gt;10.3.4.2 &lt;/span&gt;Web Socket URLs&lt;/h5&gt;
+  &lt;h5 id=websocket-urls&gt;&lt;span class=secno&gt;10.3.4.2 &lt;/span&gt;WebSocket URLs&lt;/h5&gt;
 
-  &lt;h6 id=parsing-web-socket-urls&gt;&lt;span class=secno&gt;10.3.4.2.1 &lt;/span&gt;Parsing Web Socket URLs&lt;/h6&gt;
+  &lt;h6 id=parsing-websocket-urls&gt;&lt;span class=secno&gt;10.3.4.2.1 &lt;/span&gt;Parsing WebSocket URLs&lt;/h6&gt;
 
-  &lt;p&gt;The steps to &lt;dfn id=&quot;parse-a-web-socket-url's-components&quot;&gt;parse a Web Socket URL's components&lt;/dfn&gt; from
+  &lt;p&gt;The steps to &lt;dfn id=&quot;parse-a-websocket-url's-components&quot;&gt;parse a WebSocket URL's components&lt;/dfn&gt; from
   a string &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; are as follows. These steps return
   either a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a
   &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
@@ -67565,9 +67695,9 @@
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;,
    &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;h6 id=constructing-web-socket-urls&gt;&lt;span class=secno&gt;10.3.4.2.2 &lt;/span&gt;Constructing Web Socket URLs&lt;/h6&gt;
+  &lt;/ol&gt;&lt;h6 id=constructing-websocket-urls&gt;&lt;span class=secno&gt;10.3.4.2.2 &lt;/span&gt;Constructing WebSocket URLs&lt;/h6&gt;
 
-  &lt;p&gt;The steps to &lt;dfn id=construct-a-web-socket-url&gt;construct a Web Socket URL&lt;/dfn&gt; from a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag,
+  &lt;p&gt;The steps to &lt;dfn id=construct-a-websocket-url&gt;construct a WebSocket URL&lt;/dfn&gt; from a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag,
   are as follows:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the empty string.&lt;/li&gt;
@@ -67596,9 +67726,9 @@
   establish to a server.&lt;/p&gt;
 
 
-  &lt;h6 id=handshake&gt;&lt;span class=secno&gt;10.3.4.3.1 &lt;/span&gt;Handshake&lt;/h6&gt;
+  &lt;h6 id=handshake-0&gt;&lt;span class=secno&gt;10.3.4.3.1 &lt;/span&gt;Handshake&lt;/h6&gt;
 
-  &lt;p&gt;When the user agent is to &lt;dfn id=establish-a-web-socket-connection&gt;establish a Web Socket
+  &lt;p&gt;When the user agent is to &lt;dfn id=establish-a-websocket-connection&gt;establish a WebSocket
   connection&lt;/dfn&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on a port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, from an origin whose &lt;a href=#ascii-serialization-of-an-origin title=&quot;ASCII
   serialization of an origin&quot;&gt;ASCII serialization&lt;/a&gt; is &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, with a flag &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;, with
   a string giving a &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and optionally
@@ -67613,19 +67743,18 @@
 
   &lt;ol&gt;&lt;li&gt;
 
-    &lt;p&gt;If the user agent already has a Web Socket connection to the
+    &lt;p&gt;If the user agent already has a WebSocket connection to the
     remote host (IP address) identified by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;,
     even if known by another name, wait until that connection has been
-    &lt;a href=#web-socket-connection-is-established title=&quot;Web Socket connection is
+    &lt;a href=#websocket-connection-is-established title=&quot;WebSocket connection is
     established&quot;&gt;established&lt;/a&gt; or for that connection to have
-    &lt;a href=#fail-the-web-socket-connection title=&quot;fail the Web Socket connection&quot;&gt;failed&lt;/a&gt;.&lt;/p&gt;
+    &lt;a href=#fail-the-websocket-connection title=&quot;fail the WebSocket connection&quot;&gt;failed&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p class=note&gt;This makes it harder for a script to perform a
-    denial of service attack by just opening a large number of Web
-    Socket connections to a remote host.&lt;/p&gt;
+    denial of service attack by just opening a large number of WebSocket connections to a remote host.&lt;/p&gt;
 
-    &lt;p class=note&gt;There is no limit to the number of &lt;a href=#web-socket-connection-is-established title=&quot;Web Socket connection is established&quot;&gt;established&lt;/a&gt;
-    Web Socket connections a user agent can have with a single remote
+    &lt;p class=note&gt;There is no limit to the number of &lt;a href=#websocket-connection-is-established title=&quot;WebSocket connection is established&quot;&gt;established&lt;/a&gt;
+    WebSocket connections a user agent can have with a single remote
     host. Servers can refuse to connect users with an excessive number
     of connections, or disconnect resource-hogging users when
     suffering high load.&lt;/p&gt;
@@ -67635,8 +67764,8 @@
    &lt;li&gt;
 
     &lt;p&gt;&lt;i&gt;Connect&lt;/i&gt;: If the user agent is configured to use a proxy
-    when using the Web Socket protocol to connect to host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and/or port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then
-    connect to that proxy and ask it to open a TCP/IP connection to
+    when using the WebSocket protocol to connect to host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and/or port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then
+    connect to that proxy and ask it to open a TCP connection to
     the host given by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by
     &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
 
@@ -67659,11 +67788,11 @@
     &lt;/div&gt;
 
     &lt;p&gt;Otherwise, if the user agent is not configured to use a proxy,
-    then open a TCP/IP connection to the host given by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
+    then open a TCP connection to the host given by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
 
     &lt;p class=note&gt;Implementations that do not expose explicit UI for
-    selecting a proxy for Web Socket connections separate from other
-    proxies are encouraged to use a SOCKS proxy for Web Socket
+    selecting a proxy for WebSocket connections separate from other
+    proxies are encouraged to use a SOCKS proxy for WebSocket
     connections, if available, or failing that, to prefer the proxy
     configured for HTTPS connections over the proxy configured for
     HTTP connections.&lt;/p&gt;
@@ -67671,22 +67800,22 @@
     &lt;p&gt;For the purpose of proxy autoconfiguration scripts, the
     &lt;a href=#url&gt;URL&lt;/a&gt; to pass the function must be constructed from
     &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-    flag using the steps to &lt;a href=#construct-a-web-socket-url&gt;construct a Web Socket
+    flag using the steps to &lt;a href=#construct-a-websocket-url&gt;construct a WebSocket
     URL&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p class=note&gt;The Web Socket protocol can be identified in proxy
+    &lt;p class=note&gt;The WebSocket protocol can be identified in proxy
     autoconfiguration scripts from the scheme (&quot;&lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt;&quot; for unencrypted connections and &quot;&lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt;&quot; for encrypted connections).&lt;/p&gt;
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the connection could not be opened, then &lt;a href=#fail-the-web-socket-connection&gt;fail the
-   Web Socket connection&lt;/a&gt; and abort these steps.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the connection could not be opened, then &lt;a href=#fail-the-websocket-connection&gt;fail the
+   WebSocket connection&lt;/a&gt; and abort these steps.&lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is true, perform a TLS handshake
     over the connection. If this fails (e.g. the server's certificate
-    could not be verified), then &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket
+    could not be verified), then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
     connection&lt;/a&gt; and abort these steps. Otherwise, all further
     communication on this channel must run through the encrypted
     tunnel. &lt;a href=#refsRFC2246&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
@@ -67698,89 +67827,80 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Send the following bytes to the remote side (the server):&lt;/p&gt;
+    &lt;p&gt;Send the UTF-8 string &quot;GET&quot; followed by a UTF-8-encoded U+0020
+    SPACE character to the remote side (the server).&lt;/p&gt;
 
-    &lt;pre&gt;47 45 54 20&lt;/pre&gt;
-
     &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; value, encoded as
-    ANSI_X3.4-1968 (US-ASCII). &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    UTF-8.&lt;/p&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Send another UTF-8-encoded U+0020 SPACE character, followed by
+    the UTF-8 string &quot;HTTP/1.1&quot;, followed by a UTF-8-encoded U+000D
+    CARRIAGE RETURN U+000A LINE FEED character pair (CRLF).&lt;/p&gt;
 
-    &lt;pre&gt;20 48 54 54 50 2F 31 2E  31 0D 0A 55 70 67 72 61
-64 65 3A 20 57 65 62 53  6F 63 6B 65 74 0D 0A 43
-6F 6E 6E 65 63 74 69 6F  6E 3A 20 55 70 67 72 61
-64 65 0D 0A&lt;/pre&gt;
+   &lt;/li&gt;
 
-    &lt;p class=note&gt;The string &quot;GET&nbsp;&quot;, the path,
-    &quot;&nbsp;HTTP/1.1&quot;, CRLF, the string &quot;Upgrade:&nbsp;WebSocket&quot;,
-    CRLF, and the string &quot;Connection:&nbsp;Upgrade&quot;, CRLF.&lt;/p&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; be an empty list of strings.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Add the string &quot;Upgrade:&nbsp;WebSocket&quot; to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;pre&gt;48 6F 73 74 3A 20&lt;/pre&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; value, &lt;a href=#converted-to-ascii-lowercase&gt;converted to
-    ASCII lowercase&lt;/a&gt;, and encoded as ANSI_X3.4-1968
-    (US-ASCII). &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 80, or if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is
-    true, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 443, then send an 0x3A
-    byte (ASCII :) followed by the value of &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;,
-    expressed as a base-ten integer, encoded as ANSI_X3.4-1968
-    (US-ASCII). &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Add the string &quot;Connection:&nbsp;Upgrade&quot; to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;pre&gt;0D 0A&lt;/pre&gt;
+   &lt;li&gt;
 
-    &lt;p class=note&gt;The string &quot;Host:&nbsp;&quot;, the host, and CRLF.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt; be an empty string.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Append the &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; value, &lt;a href=#converted-to-ascii-lowercase&gt;converted to
+    ASCII lowercase&lt;/a&gt;, to &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;pre&gt;4F 72 69 67 69 6E 3A 20&lt;/pre&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt; value, &lt;a href=#converted-to-ascii-lowercase&gt;converted to
-    ASCII lowercase&lt;/a&gt;, encoded as ANSI_X3.4-1968 (US-ASCII). &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt; &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p class=note&gt;The &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt; value is a string
-    that was passed to this algorithm.&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 80, or if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is
+    true, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 443, then append a
+    U+003A COLON character (:) followed by the value of &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, expressed as a base-ten integer, to &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;pre&gt;0D 0A&lt;/pre&gt;
+   &lt;li&gt;
 
-    &lt;p class=note&gt;The string &quot;Origin:&nbsp;&quot;, the origin, and CRLF.&lt;/p&gt; &lt;!-- http-origin --&gt;
+    &lt;p&gt;Add the string consisting of the concatenation of the string
+    &quot;Host:&quot;, a U+0020 SPACE character, and &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt;, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If there is no &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt;, then skip this step.&lt;/p&gt;
+    &lt;p&gt;Add the string consisting of the concatenation of the string
+    &quot;Origin:&quot;, a U+0020 SPACE character, and the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt; value, &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII
+    lowercase&lt;/a&gt;, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, send the following bytes:&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;pre&gt;57 65 62 53 6F 63 6B 65  74 2D 50 72 6F 74 6F 63
-6F 6C 3A 20&lt;/pre&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; value, encoded as
-    ANSI_X3.4-1968 (US-ASCII). &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;If there is no &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt;, then skip this step.&lt;/p&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Otherwise, add the string consisting of the concatenation of
+    the string &quot;Sec-WebSocket-Protocol:&quot;, a U+0020 SPACE character,
+    and the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; value, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;pre&gt;0d 0a&lt;/pre&gt;
-
-    &lt;p class=note&gt;The string &quot;WebSocket-Protocol:&nbsp;&quot;, the
-    protocol, and CRLF.&lt;/p&gt;
-
    &lt;/li&gt;
 
    &lt;li&gt;
@@ -67789,30 +67909,25 @@
     information or--&gt; cookies that would be relevant to a resource
     accessed over HTTP, if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, or
     HTTPS, if it is true, on host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as the
-    path (and possibly query parameters), then HTTP headers that would
-    be appropriate for that information should be sent at this point.
+    path (and possibly query parameters), then add to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; any HTTP headers that would be appropriate
+    for that information.
     &lt;a href=#refsHTTP&gt;[HTTP]&lt;/a&gt;
     &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt;
 
     &lt;/p&gt;
 
     &lt;p&gt;This includes &quot;&lt;code&gt;HttpOnly&lt;/code&gt;&quot; cookies (cookies with the
-    http-only-flag set to true); the Web Socket protocol is not
-    considered a non-HTTP API.&lt;/p&gt;
+    http-only-flag set to true); the WebSocket protocol is not
+    considered a non-HTTP API for the purpose of cookie
+    processing.&lt;/p&gt;
 
-    &lt;p&gt;Each header must be on a line of its own (each ending with a
-    CRLF sequence). For the purposes of this step, each header must
-    not be split into multiple lines (despite HTTP otherwise allowing
-    this with continuation lines).&lt;/p&gt;
-
 &lt;!--(v2-ws-auth)
     &lt;div class=&quot;example&quot;&gt;
 
      &lt;p&gt;For example, if the server had a username and password that
      applied to &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/socket&lt;/code">http://example.com/socket&lt;/code</A>&gt;, and
-     the Web Socket was being opened to &lt;code
-     title=&quot;&quot;&gt;<A HREF="ws://example.com/socket&lt;/code">ws://example.com/socket&lt;/code</A>&gt;, it could send
-     them:&lt;/p&gt;
+     the WebSocket was being opened to &lt;code
+     title=&quot;&quot;&gt;<A HREF="ws://example.com/socket&lt;/code">ws://example.com/socket&lt;/code</A>&gt;, it could add them:&lt;/p&gt;
 
      &lt;pre&gt;Authorization: Basic d2FsbGU6ZXZl&lt;/pre&gt;
 
@@ -67823,119 +67938,221 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a random integer
+    from 1 to 12 inclusive.&lt;/p&gt;
 
-    &lt;pre&gt;0d 0a&lt;/pre&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a random integer
+    from 1 to 12 inclusive.&lt;/p&gt;
 
-    &lt;p class=note&gt;Just a CRLF (a blank line).&lt;/p&gt;
+    &lt;p class=example&gt;For example, 5 and 9.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Read bytes from the server until either the connection closes,
-    or a 0x0A byte is read. Let &lt;var title=&quot;&quot;&gt;header&lt;/var&gt; be these
-    bytes, including the 0x0A byte.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be the largest integer
+    not greater than 4,294,967,295 divided by &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;header&lt;/var&gt; is not at least two bytes long,
-    or if the last two bytes aren't 0x0D and 0x0A respectively, then
-    &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and abort these
-    steps.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be the largest integer
+    not greater than 4,294,967,295 divided by &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;User agents may apply a timeout to this step, &lt;a href=#fail-the-web-socket-connection title=&quot;fail
-    the Web Socket connection&quot;&gt;failing the Web Socket
-    connection&lt;/a&gt; if the server does not send back data in a
-    suitable time period.&lt;/p&gt;
+    &lt;p class=example&gt;Continuing the example, 858,993,459 and 477,218,588.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;header&lt;/var&gt; consists of 44 bytes that exactly
-    match the following, then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a random integer
+    from 0 to &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; inclusive.&lt;/p&gt;
 
-    &lt;pre&gt;48 54 54 50 2F 31 2E 31  20 31 30 31 20 57 65 62
-20 53 6F 63 6B 65 74 20  50 72 6F 74 6F 63 6F 6C
-20 48 61 6E 64 73 68 61  6B 65 0D 0A&lt;/pre&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a random integer
+    from 0 to &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; inclusive.&lt;/p&gt;
 
-    &lt;p class=note&gt;The string
-    &quot;HTTP/1.1&nbsp;101&nbsp;Web&nbsp;Socket&nbsp;Protocol&nbsp;Handshake&quot;
-    followed by a CRLF pair.&lt;/p&gt;
+    &lt;p class=example&gt;For example, 777,007,543 and 114,997,259.&lt;/p&gt;
 
-    &lt;p class=note&gt;Note that this means that if a server responds
-    with a Web Socket handshake but with the string &quot;HTTP/1.0&quot; or
-    &quot;HTTP/1.2&quot; at the front, a normal Web Socket connection will not
-    be established.&lt;/p&gt; &lt;!-- we might update this as HTTP is updated,
-    depending on whether it remains compatible or whatnot --&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; be the substring of
-    &lt;var title=&quot;&quot;&gt;header&lt;/var&gt; that starts from the byte after the
-    first 0x20 byte, and ends with the byte before the second 0x20
-    byte. If there are not at least two 0x20 bytes in &lt;var title=&quot;&quot;&gt;header&lt;/var&gt;, then &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket
-    connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
+   &lt;li&gt;
 
-&lt;!--(v2-redirect)
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as ANSI_X3.4-1968
-    (US-ASCII), is either &quot;&lt;code title=&quot;&quot;&gt;301&lt;/code&gt;&quot;, &quot;&lt;code
-    title=&quot;&quot;&gt;302&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;303&lt;/code&gt;&quot;, &quot;&lt;code
-    title=&quot;&quot;&gt;307&lt;/code&gt;&quot;, then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i
-    title=&quot;&quot;&gt;redirect&lt;/i&gt;. &lt;a href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
---&gt;
-&lt;!--(v2-ws-auth)
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as ANSI_X3.4-1968
-    (US-ASCII), is &quot;&lt;code title=&quot;&quot;&gt;401&lt;/code&gt;&quot;, then let &lt;var
-    title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;authenticate&lt;/i&gt;. &lt;a
-    href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
---&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be the result of
+    multiplying &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; together.&lt;/p&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as ANSI_X3.4-1968
-    (US-ASCII), is &quot;&lt;code title=&quot;&quot;&gt;407&lt;/code&gt;&quot;, then either close the
-    connection and jump back to step 2, providing appropriate
-    authentication information, or &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket
-    connection&lt;/a&gt;. 407 is the code used by HTTP meaning &quot;Proxy
-    Authentication Required&quot;. User agents that support proxy
-    authentication must interpret the response as defined by HTTP
-    (e.g. to find and interpret the &lt;code title=http-Proxy-Authenticate&gt;Proxy-Authenticate&lt;/code&gt;
-    header). &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be the result of
+    multiplying &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; together.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and
-    abort these steps.&lt;/p&gt;
+    &lt;p class=example&gt;Continuing the example, 3,885,037,715 and
+    1,034,975,331.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;, then
-    read 41 bytes from the server.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a string consisting
+    of &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed in base ten
+    using the numerals in the range U+0030 DIGIT ZERO (0) to U+0039
+    DIGIT NINE (9).&lt;/p&gt;
 
-    &lt;p&gt;If the connection closes before 41 bytes are received, or if
-    the 41 bytes aren't exactly equal to the following bytes, then
-    &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and abort these
-    steps.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a string consisting
+    of &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;, expressed in base ten
+    using the numerals in the range U+0030 DIGIT ZERO (0) to U+0039
+    DIGIT NINE (9).&lt;/p&gt;
 
-    &lt;pre&gt;55 70 67 72 61 64 65 3A  20 57 65 62 53 6F 63 6B
-65 74 0D 0A 43 6F 6E 6E  65 63 74 69 6F 6E 3A 20
-55 70 67 72 61 64 65 0D  0A&lt;/pre&gt;
+    &lt;p class=example&gt;Continuing the example, &quot;3885037715&quot; and
+    &quot;1034975331&quot;.&lt;/p&gt;
 
-    &lt;p class=note&gt;The string &quot;Upgrade:&nbsp;WebSocket&quot;, CRLF, the
-    string &quot;Connection:&nbsp;Upgrade&quot;, CRLF.&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;User agents may apply a timeout to this step, &lt;a href=#fail-the-web-socket-connection title=&quot;fail
-    the Web Socket connection&quot;&gt;failing the Web Socket
-    connection&lt;/a&gt; if the server does not respond with the above
-    bytes within a suitable time period.&lt;/p&gt;
+   &lt;li&gt;
 
-&lt;!--(v2-ws-auth) (v2-redirect)
-    &lt;p class=&quot;note&quot;&gt;This step is skipped if &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt;
-    is &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt; or &lt;i title=&quot;&quot;&gt;authenticate&lt;/i&gt;.&lt;/p&gt;
+    &lt;p&gt;Insert &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; U+0020 SPACE
+    characters into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; at random
+    positions.&lt;/p&gt;
+
+    &lt;p&gt;Insert &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; U+0020 SPACE
+    characters into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; at random
+    positions.&lt;/p&gt;
+
+    &lt;p class=example&gt;Continuing the example, this could lead to
+    &quot;388&nbsp;5037&nbsp;&nbsp;7&nbsp;&nbsp;15&quot; and
+    &quot;1&nbsp;&nbsp;&nbsp;0&nbsp;3&nbsp;&nbsp;4&nbsp;97&nbsp;53&nbsp;31&quot;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Insert between one and twelve random characters from
+    the ranges U+0021 to U+002F and U+003A to U+007E into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; at random positions.&lt;/p&gt;
+
+    &lt;p&gt;Insert between one and twelve random characters from
+    the ranges U+0021 to U+002F and U+003A to U+007E into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; at random positions.&lt;/p&gt;
+
+    &lt;p class=note&gt;This corresponds to random printable ASCII
+    characters other than the digits and the U+0020 SPACE
+    character.&lt;/p&gt;
+
+    &lt;p class=example&gt;Continuing the example, this could lead to
+    &quot;388P&nbsp;O503D&amp;ul7&nbsp;{K%gX(&nbsp;%7&nbsp;&nbsp;15&quot; and
+    &quot;1&nbsp;N&nbsp;?|k&nbsp;UT0or&nbsp;3o&nbsp;&nbsp;4&nbsp;I97N&nbsp;5-S3O&nbsp;31&quot;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Add the string consisting of the concatenation of the string
+    &quot;Sec-WebSocket-Key1:&quot;, a U+0020 SPACE character, and the &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; value, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Add the string consisting of the concatenation of the string
+    &quot;Sec-WebSocket-Key2:&quot;, a U+0020 SPACE character, and the &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; value, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each string in &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;, in a random
+    order: send the string, encoded as UTF-8, followed by a
+    UTF-8-encoded U+000D CARRIAGE RETURN U+000A LINE FEED character
+    pair (CRLF). It is important that the fields be output in a
+    random order so that servers not depend on the particular order
+    used by any particular client.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send a UTF-8-encoded U+000D CARRIAGE RETURN U+000A LINE FEED
+    character pair (CRLF).&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key3&lt;/var&gt; be a string consisting of eight
+    random bytes (or equivalently, a random 64 bit integer encoded in
+    little-endian order).&lt;/p&gt;
+
+    &lt;p class=example&gt;For example, 0x47 0x30 0x22 0x2D 0x5A 0x3F 0x47
+    0x58.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send &lt;var title=&quot;&quot;&gt;key3&lt;/var&gt; to the server.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Read bytes from the server until either the connection closes,
+    or a 0x0A byte is read. Let &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; be these
+    bytes, including the 0x0A byte.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; is not at least seven bytes long,
+    or if the last two bytes aren't 0x0D and 0x0A respectively, or if
+    it does not contain at least two 0x20 bytes, then &lt;a href=#fail-the-websocket-connection&gt;fail the
+    WebSocket connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
+
+    &lt;p&gt;User agents may apply a timeout to this step, &lt;a href=#fail-the-websocket-connection title=&quot;fail
+    the WebSocket connection&quot;&gt;failing the WebSocket
+    connection&lt;/a&gt; if the server does not send back data in a
+    suitable time period.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; be the substring of &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; that starts from the byte after the first
+    0x20 byte, and ends with the byte before the second 0x20 byte.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; is not three bytes long, or if any
+    of the bytes in &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; are not in the range 0x30
+    to 0x39, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort
+    these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+&lt;!--(v2-redirect or v2-ws-auth) - - then change the text below
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;101&quot;,
+    then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;.&lt;/p&gt;
 --&gt;
+&lt;!--(v2-redirect)
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is either
+    &quot;&lt;code title=&quot;&quot;&gt;301&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;302&lt;/code&gt;&quot;, &quot;&lt;code
+    title=&quot;&quot;&gt;303&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;307&lt;/code&gt;&quot;, then let &lt;var
+    title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt;.&lt;/p&gt;
+--&gt;
+&lt;!--(v2-ws-auth)
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;&lt;code
+    title=&quot;&quot;&gt;401&lt;/code&gt;&quot;, then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i
+    title=&quot;&quot;&gt;authenticate&lt;/i&gt;.&lt;/p&gt;
+--&gt;
 
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;101&quot;,
+    then move to the next step.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;&lt;code title=&quot;&quot;&gt;407&lt;/code&gt;&quot;, then either close the connection and jump
+    back to step 2, providing appropriate authentication information,
+    or &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt;. 407 is the code
+    used by HTTP meaning &quot;Proxy Authentication Required&quot;. User agents
+    that support proxy authentication must interpret the response as
+    defined by HTTP (e.g. to find and interpret the &lt;code title=http-Proxy-Authenticate&gt;Proxy-Authenticate&lt;/code&gt;
+    header).&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort
+    these steps.&lt;/p&gt;
+
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; be a list of name-value
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; be a list of name-value
    pairs, initially empty.&lt;/li&gt;
 
-   &lt;li id=ws-ua-header-loop&gt;&lt;p&gt;&lt;i title=&quot;&quot;&gt;Header&lt;/i&gt;: Let &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be empty byte
+   &lt;li id=ws-ua-field-loop&gt;&lt;p&gt;&lt;i title=&quot;&quot;&gt;Field&lt;/i&gt;: Let &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be empty byte
    arrays.&lt;/li&gt;
 
    &lt;li&gt;
@@ -67943,7 +68160,7 @@
     &lt;p&gt;Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and abort these
+    &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
     steps.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, handle the byte as described in the appropriate
@@ -67952,14 +68169,14 @@
     &lt;dl class=switch&gt;&lt;dt&gt;If the byte is 0x0D (ASCII CR)&lt;/dt&gt;
 
      &lt;dd&gt;If the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte array is empty, then
-     jump to the &lt;a href=#ws-ua-headers-processing&gt;headers
-     processing&lt;/a&gt; step. Otherwise, &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket
+     jump to the &lt;a href=#ws-ua-fields-processing&gt;fields
+     processing&lt;/a&gt; step. Otherwise, &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
      connection&lt;/a&gt; and abort these steps.&lt;/dd&gt;
 
 
      &lt;dt&gt;If the byte is 0x0A (ASCII LF)&lt;/dt&gt;
 
-     &lt;dd&gt;&lt;a href=#fail-the-web-socket-connection&gt;Fail the Web Socket connection&lt;/a&gt; and abort these
+     &lt;dd&gt;&lt;a href=#fail-the-websocket-connection&gt;Fail the WebSocket connection&lt;/a&gt; and abort these
      steps.&lt;/dd&gt;
 
 
@@ -67980,7 +68197,7 @@
      &lt;dd&gt;Append the byte to the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte
      array and redo this step for the next byte.&lt;/dd&gt;
 
-    &lt;/dl&gt;&lt;p class=note&gt;This reads a header name, terminated by a colon,
+    &lt;/dl&gt;&lt;p class=note&gt;This reads a field name, terminated by a colon,
     converting upper-case ASCII letters to lowercase, and aborting if
     a stray CR or LF is found.&lt;/p&gt;
 
@@ -67991,7 +68208,7 @@
     &lt;p&gt;Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and abort these
+    &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
     steps.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, handle the byte as described in the appropriate
@@ -68017,7 +68234,7 @@
     &lt;p&gt;Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and abort these
+    &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
     steps.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, handle the byte as described in the appropriate
@@ -68030,7 +68247,7 @@
 
      &lt;dt&gt;If the byte is 0x0A (ASCII LF)&lt;/dt&gt;
 
-     &lt;dd&gt;&lt;a href=#fail-the-web-socket-connection&gt;Fail the Web Socket connection&lt;/a&gt; and abort these
+     &lt;dd&gt;&lt;a href=#fail-the-websocket-connection&gt;Fail the WebSocket connection&lt;/a&gt; and abort these
      steps.&lt;/dd&gt;
 
 
@@ -68039,7 +68256,7 @@
      &lt;dd&gt;Append the byte to the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; byte array
      and redo this step for the next byte.&lt;/dd&gt;
 
-    &lt;/dl&gt;&lt;p class=note&gt;This reads a header value, terminated by a
+    &lt;/dl&gt;&lt;p class=note&gt;This reads a field value, terminated by a
     CRLF.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -68049,17 +68266,16 @@
     &lt;p&gt;Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, or if
-    the byte is not a 0x0A byte (ASCII LF), then &lt;a href=#fail-the-web-socket-connection&gt;fail the Web
-    Socket connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
+    the byte is not a 0x0A byte (ASCII LF), then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
 
     &lt;p class=note&gt;This skips past the LF byte of the CRLF after the
-    header.&lt;/p&gt;
+    field.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Append an entry to the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list that
+    &lt;p&gt;Append an entry to the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list that
     has the name given by the string obtained by interpreting the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte array as a UTF-8 byte stream and the
     value given by the string obtained by interpreting the &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; byte array as a UTF-8 byte stream.&lt;/p&gt;
 
@@ -68067,69 +68283,87 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Return to the &quot;&lt;a href=#ws-ua-header-loop&gt;Header&lt;/a&gt;&quot; step
+    &lt;p&gt;Return to the &quot;&lt;a href=#ws-ua-field-loop&gt;Field&lt;/a&gt;&quot; step
     above.&lt;/p&gt;
 
    &lt;/li&gt;
 
-   &lt;li id=ws-ua-headers-processing&gt;
+   &lt;li id=ws-ua-fields-processing&gt;
 
-    &lt;p&gt;&lt;i&gt;Headers processing&lt;/i&gt;: Read a byte from the server.&lt;/p&gt;
+    &lt;p&gt;&lt;i&gt;Fields processing&lt;/i&gt;: Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, or if
-    the byte is not a 0x0A byte (ASCII LF), then &lt;a href=#fail-the-web-socket-connection&gt;fail the Web
-    Socket connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
+    the byte is not a 0x0A byte (ASCII LF), then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
 
     &lt;p class=note&gt;This skips past the LF byte of the CRLF after the
-    blank line after the headers.&lt;/p&gt;
+    blank line after the fields.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;, then: If
-    there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt;
-    list whose name is &quot;&lt;code title=http-websocket-origin&gt;&lt;a href=#websocket-origin&gt;websocket-origin&lt;/a&gt;&lt;/code&gt;&quot;, or if
-    there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt;
-    list whose name is &quot;&lt;code title=http-websocket-location&gt;&lt;a href=#websocket-location&gt;websocket-location&lt;/a&gt;&lt;/code&gt;&quot;, or if
-    the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; was specified but there is not
-    exactly one entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list whose
-    name is &quot;&lt;code title=http-websocket-protocol&gt;&lt;a href=#websocket-protocol-0&gt;websocket-protocol&lt;/a&gt;&lt;/code&gt;&quot;, or if
-    there are any entries in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list
-    whose names are the empty string, then &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket
+    &lt;p&gt;
+    &lt;!--(v2-redirect or v2-ws-auth) If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;, then: --&gt;
+
+    If there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-upgrade&gt;upgrade&lt;/code&gt;&quot;, or
+
+    if there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-connection&gt;connection&lt;/code&gt;&quot;, or
+
+    if there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;sec-websocket-origin&lt;/a&gt;&lt;/code&gt;&quot;, or
+
+    if there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;sec-websocket-location&lt;/a&gt;&lt;/code&gt;&quot;, or
+
+    if the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; was specified but there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;sec-websocket-protocol&lt;/a&gt;&lt;/code&gt;&quot;, or
+
+    if there are any entries in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list
+    whose names are the empty string, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
     connection&lt;/a&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list as follows:&lt;/p&gt;
+    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
 
-    &lt;dl class=switch&gt;&lt;dt&gt;If the entry's name is &quot;&lt;code title=http-websocket-origin&gt;&lt;a href=#websocket-origin&gt;websocket-origin&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
+    &lt;dl class=switch&gt;&lt;dt&gt;If the entry's name is &quot;&lt;code title=http-upgrade&gt;upgrade&lt;/code&gt;&quot;&lt;/dt&gt;
 
+     &lt;dd&gt;&lt;p&gt;If the value is not exactly equal to the string
+     &quot;WebSocket&quot;, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and
+     abort these steps.&lt;/dd&gt;
+
+
+     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-connection&gt;connection&lt;/code&gt;&quot;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;If the value, &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt;,
+     is not exactly equal to the string &quot;upgrade&quot;, then &lt;a href=#fail-the-websocket-connection&gt;fail the
+     WebSocket connection&lt;/a&gt; and abort these steps.&lt;/dd&gt;
+
+
+     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;sec-websocket-origin&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
+
      &lt;dd&gt;&lt;p&gt;If the value is not exactly equal to &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt;,
-     then &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and abort these
+     then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
      steps. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/dd&gt;
 
 
-     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-websocket-location&gt;&lt;a href=#websocket-location&gt;websocket-location&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
+     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;sec-websocket-location&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
 
      &lt;dd&gt;
 
       &lt;p&gt;If the value is not exactly equal to a string obtained from
-      the steps to &lt;a href=#construct-a-web-socket-url&gt;construct a Web Socket URL&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-      flag, then &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and abort
+      the steps to &lt;a href=#construct-a-websocket-url&gt;construct a WebSocket URL&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
+      flag, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort
       these steps.&lt;/p&gt;
 
      &lt;/dd&gt;
 
 
-     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-websocket-protocol&gt;&lt;a href=#websocket-protocol-0&gt;websocket-protocol&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
+     &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;sec-websocket-protocol&lt;/a&gt;&lt;/code&gt;&quot;&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;If there was a &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; specified, and
      the value is not exactly equal to &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt;,
-     then &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/a&gt; and abort these
+     then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
      steps. (If no &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; was specified, the
-     header is ignored.)&lt;/dd&gt;
+     field is ignored.)&lt;/dd&gt;
 
 
      &lt;dt&gt;If the entry's name is &quot;&lt;code title=http-setcookie&gt;set-cookie&lt;/code&gt;&quot; or &quot;&lt;code title=http-setcookie2&gt;set-cookie2&lt;/code&gt;&quot; or another
-     cookie-related header name&lt;/dt&gt;
+     cookie-related field name&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;Handle the cookie as defined by the appropriate
      specification, with the resource being the one with the host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, the port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, the path
@@ -68152,10 +68386,10 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt;, then:
     If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;headers&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;&quot;&gt;location&lt;/code&gt;&quot;, then &lt;span&gt;fail the Web Socket
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;&quot;&gt;location&lt;/code&gt;&quot;, then &lt;span&gt;fail the WebSocket
     connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list as follows:&lt;/p&gt;
+    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
 
     &lt;dl class=&quot;switch&quot;&gt;
 
@@ -68169,20 +68403,20 @@
        &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;was secure&lt;/var&gt; have the value of
        &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-       &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a Web Socket URL's components&lt;/span&gt; from
+       &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from
        the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain new values for
        &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
        title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var
-       title=&quot;&quot;&gt;secure&lt;/var&gt;. If this fails, &lt;span&gt;fail the Web Socket
+       title=&quot;&quot;&gt;secure&lt;/var&gt;. If this fails, &lt;span&gt;fail the WebSocket
        connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
        &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;was secure&lt;/var&gt; is true but &lt;var
-       title=&quot;&quot;&gt;secure&lt;/var&gt; is now false, &lt;span&gt;fail the Web Socket
+       title=&quot;&quot;&gt;secure&lt;/var&gt; is now false, &lt;span&gt;fail the WebSocket
        connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
        &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is a port to which the user
-       agent is configured to block access, then &lt;span&gt;fail the Web
-       Socket connection&lt;/span&gt; and abort these steps. (User agents
+       agent is configured to block access, then &lt;span&gt;fail the
+       WebSocket connection&lt;/span&gt; and abort these steps. (User agents
        typically block access to well-known ports like SMTP.)&lt;/p&gt;&lt;/li&gt;
 
        &lt;li&gt;&lt;p&gt;Close the connection if the server has not already done
@@ -68206,10 +68440,10 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;authenticate&lt;/i&gt;,
     then: If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;headers&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;&quot;&gt;www-authenticate&lt;/code&gt;&quot;, then &lt;span&gt;fail the Web Socket
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;&quot;&gt;www-authenticate&lt;/code&gt;&quot;, then &lt;span&gt;fail the WebSocket
     connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list as follows:&lt;/p&gt;
+    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
 
     &lt;dl class=&quot;switch&quot;&gt;
 
@@ -68235,7 +68469,56 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;The &lt;dfn id=web-socket-connection-is-established&gt;Web Socket connection is established&lt;/dfn&gt;. Now the
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; be the concatenation of &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed as a little-endian 32
+    bit integer, &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;, expressed as
+    a little-endian 32 bit integer, and the eight bytes of &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;3&lt;/sub&gt;&lt;/var&gt; in the order they were sent on the
+    wire.&lt;/p&gt;
+
+    &lt;!--
+    perl -e 'foreach (@ARGV) { print pack 'N', $_ }' 777007543 114997259 | hexdump -C
+    --&gt;
+
+    &lt;p class=example&gt;Using the examples given earlier, this leads to
+    the 16 bytes 0x2E 0x50 0x31 0xB7 0x06 0xDA 0xB8 0x0B 0x47 0x30
+    0x22 0x2D 0x5A 0x3F 0x47 0x58.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;expected&lt;/var&gt; be the MD5 fingerprint of &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; as a little-endian 128 bit string. &lt;a href=#refsRFC1321&gt;[RFC1321]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;!--
+    perl -e &quot;print pack 'c*', map { hex } @ARGV&quot; 0x2E 0x50 0x31 0xB7 0x06 0xDA 0xB8 0x0B 0x47 0x30 0x22 0x2D 0x5A 0x3F 0x47 0x58 | md5sum -b
+    --&gt;
+
+    &lt;p class=example&gt;Using the examples given earlier, this leads to
+    the 16 bytes 0x30 0x73 0x74 0x33 0x52 0x6C 0x26 0x71 0x2D 0x32
+    0x5A 0x55 0x5E 0x77 0x65 0x75. In ASCII, these bytes correspond to
+    the string &quot;0st3Rl&amp;q-2ZU^weu&quot;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Read sixteen bytes from the server. Let &lt;var title=&quot;&quot;&gt;reply&lt;/var&gt; be those bytes.&lt;/p&gt;
+
+    &lt;p&gt;If the connection closes before these bytes are received, then
+    &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt; and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;reply&lt;/var&gt; does not exactly equal &lt;var title=&quot;&quot;&gt;expected&lt;/var&gt;, then &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
+    connection&lt;/a&gt; and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;The &lt;dfn id=websocket-connection-is-established&gt;WebSocket connection is established&lt;/dfn&gt;. Now the
     user agent must send and receive to and from the connection as
     described in the next section.&lt;/p&gt;
 
@@ -68243,7 +68526,7 @@
 
   &lt;/ol&gt;&lt;h6 id=data-framing&gt;&lt;span class=secno&gt;10.3.4.3.2 &lt;/span&gt;Data framing&lt;/h6&gt;
 
-  &lt;p&gt;Once a &lt;a href=#web-socket-connection-is-established&gt;Web Socket connection is established&lt;/a&gt;, the
+  &lt;p&gt;Once a &lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;, the
   user agent must run through the following state machine for the
   bytes sent by the server.&lt;/p&gt;
 
@@ -68252,7 +68535,7 @@
     &lt;p&gt;Try to read a byte from the server. Let &lt;var title=&quot;&quot;&gt;frame
     type&lt;/var&gt; be that byte.&lt;/p&gt;
 
-    &lt;p&gt;If no byte could be read because the &lt;a href=#web-socket-connection-is-closed&gt;Web Socket
+    &lt;p&gt;If no byte could be read because the &lt;a href=#websocket-connection-is-closed&gt;WebSocket
     connection is closed&lt;/a&gt;, then abort.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -68267,7 +68550,7 @@
      &lt;dd&gt;
 
       &lt;p&gt;Run these steps. If at any point during these steps a read is
-      attempted but fails because the &lt;a href=#web-socket-connection-is-closed&gt;Web Socket connection is
+      attempted but fails because the &lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
       closed&lt;/a&gt;, then abort.&lt;/p&gt;
 
       &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;length&lt;/var&gt; be zero.&lt;/li&gt;
@@ -68299,7 +68582,7 @@
      &lt;dd&gt;
 
       &lt;p&gt;Run these steps. If at any point during these steps a read is
-      attempted but fails because the &lt;a href=#web-socket-connection-is-closed&gt;Web Socket connection is
+      attempted but fails because the &lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
       closed&lt;/a&gt;, then abort.&lt;/p&gt;
 
       &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; be an empty byte array.&lt;/li&gt;
@@ -68312,8 +68595,8 @@
        &lt;li&gt;&lt;p&gt;Interpret &lt;var title=&quot;&quot;&gt;raw data&lt;/var&gt; as a UTF-8
        string, and store that string in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;.&lt;/p&gt;
 
-       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; is 0x00, then &lt;dfn id=a-message-has-been-received&gt;a
-       message has been received&lt;/dfn&gt; with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;. Otherwise, discard the data.&lt;/li&gt;
+       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; is 0x00, then &lt;dfn id=a-websocket-message-has-been-received&gt;a
+       WebSocket message has been received&lt;/dfn&gt; with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;. Otherwise, discard the data.&lt;/li&gt;
 
       &lt;/ol&gt;&lt;/dd&gt;
 
@@ -68324,11 +68607,11 @@
   &lt;/ol&gt;&lt;p&gt;If the user agent is faced with content that is too large to be
   handled appropriately, runs out of resources for buffering incoming
   data, or hits an artificial resource limit intended to avoid
-  resource starvation, then it must &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket
+  resource starvation, then it must &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
   connection&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;hr&gt;&lt;p&gt;Once a &lt;a href=#web-socket-connection-is-established&gt;Web Socket connection is established&lt;/a&gt;, the
-  user agent must use the following steps to &lt;dfn id=send-data-using-the-web-socket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the Web Socket&lt;/dfn&gt;:&lt;/p&gt;
+  &lt;hr&gt;&lt;p&gt;Once a &lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;, the
+  user agent must use the following steps to &lt;dfn id=send-data-using-the-websocket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/dfn&gt;:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Send a 0x00 byte to the server.&lt;/li&gt;
 
@@ -68338,7 +68621,7 @@
    &lt;li&gt;&lt;p&gt;Send a 0xFF byte to the server.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;If at any point there is a fatal problem with sending data to the
-  server, the user agent must &lt;a href=#fail-the-web-socket-connection&gt;fail the Web Socket
+  server, the user agent must &lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
   connection&lt;/a&gt;.&lt;/p&gt;
 
   &lt;!-- v2: People often request the ability to send binary blobs over
@@ -68347,17 +68630,17 @@
   data. --&gt;
 
 
-  &lt;h6 id=closing-the-connection&gt;&lt;span class=secno&gt;10.3.4.3.3 &lt;/span&gt;Closing the connection&lt;/h6&gt;
+  &lt;h6 id=failing-the-connection&gt;&lt;span class=secno&gt;10.3.4.3.3 &lt;/span&gt;Failing the connection&lt;/h6&gt;
 
-  &lt;p&gt;To &lt;dfn id=fail-the-web-socket-connection&gt;fail the Web Socket connection&lt;/dfn&gt;, the user agent must
-  &lt;a href=#close-the-web-socket-connection&gt;close the Web Socket connection&lt;/a&gt;, and may report the
+  &lt;p&gt;To &lt;dfn id=fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/dfn&gt;, the user agent must
+  &lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt;, and may report the
   problem to the user (which would be especially useful for
   developers). However, user agents must not convey the failure
   information to the script that attempted the connection in a way
-  distinguishable from the Web Socket being closed normally.&lt;/p&gt;
+  distinguishable from the WebSocket being closed normally.&lt;/p&gt;
 
   &lt;p&gt;Except as indicated above or as specified by the application
-  layer (e.g. a script using the Web Socket API), user agents should
+  layer (e.g. a script using the WebSocket API), user agents should
   not close the connection.&lt;/p&gt;
 
 
@@ -68373,190 +68656,172 @@
   &lt;h5 id=server-side-requirements&gt;&lt;span class=secno&gt;10.3.4.4 &lt;/span&gt;Server-side requirements&lt;/h5&gt;
 
   &lt;p&gt;&lt;i&gt;This section only applies to servers.&lt;/i&gt;&lt;/p&gt;
-  
 
-  &lt;h6 id=&quot;sending-the-server's-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.4.1 &lt;/span&gt;Sending the server's handshake&lt;/h6&gt;
 
-  &lt;p&gt;When a client establishes a Web Socket connection to a server,
-  the server must either close the connection or send the server
-  handshake. Servers may read part or all of the client's handshake
-  (as described in the next section) before closing the connection or
-  sending all of their side of the handshake; indeed, in some cases
-  this is necessary as the server might need to use some of the
-  information in the client's handshake to construct it's own
-  handshake.&lt;/p&gt;
+  &lt;h6 id=&quot;reading-the-client's-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.4.1 &lt;/span&gt;Reading the client's handshake&lt;/h6&gt;
 
-  &lt;p&gt;If the server supports encryption, then the server must perform a
-  TLS handshake over the connection before sending the server
-  handshake. If this fails (e.g. the client indicated a host name in
-  the extended client hello &quot;server_name&quot; extension that the server
-  does not host), then the server must close the connection;
-  otherwise, all further communication for the connection (including
-  the server handshake) must run through the encrypted tunnel. &lt;a href=#refsRFC2246&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
+  &lt;p&gt;When a client starts a WebSocket connection, it sends its part of
+  the handshake. The server must parse at least part of this handshake
+  in order to obtain the necessary information to generate the server
+  part of the handshake.&lt;/p&gt;
 
-  &lt;p&gt;To send the server handshake, the server must first establish the
-  following information:&lt;/p&gt;
+  &lt;p&gt;The client handshake consists of the following parts. If the
+  server, while reading the handshake, finds that the client did not
+  send a handshake that matches the description below, the server
+  should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket connection&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;dl&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/dt&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;The three-character UTF-8 string &quot;GET&quot;.&lt;/li&gt;
 
-   &lt;dd&gt;The &lt;a href=#ascii-serialization-of-an-origin title=&quot;ASCII serialization of an origin&quot;&gt;ASCII
-   serialization&lt;/a&gt; of the origin that the server is willing to
-   communicate with. If the server can respond to requests from
-   multiple origins (or indeed, all origins), then the value should be
-   derived from the client's handshake, specifically from the &quot;Origin&quot;
-   field. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/dd&gt;
+   &lt;li&gt;&lt;p&gt;A UTF-8-encoded U+0020 SPACE character (0x20 byte).&lt;/li&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;host&lt;/var&gt;&lt;/dt&gt;
+   &lt;li&gt;&lt;p&gt;A string consisting of all the bytes up to the next
+   UTF-8-encoded U+0020 SPACE character (0x20 byte). The result of
+   decoding this string as a UTF-8 string is the name of the resource
+   requested by the server. If the server only supports one resource,
+   then this can safely be ignored; the client verifies that the right
+   resource is supported based on the information included in the
+   server's own handshake. The resource name will begin with U+002F
+   SOLIDUS character (/) and will only include characters in the range
+   U+0021 to U+007E.&lt;/li&gt;
 
-   &lt;dd&gt;The host name or IP address of the Web Socket server, as it is
-   to be addressed by clients. The host name must be punycode-encoded
-   if necessary. If the server can respond to requests to multiple
-   hosts (e.g. in a virtual hosting environment), then the value
-   should be derived from the client's handshake, specifically from
-   the &quot;Host&quot; field.&lt;/dd&gt;
+   &lt;li&gt;&lt;p&gt;A string of bytes terminated by a UTF-8-encoded U+000D
+   CARRIAGE RETURN U+000A LINE FEED character pair (CRLF). All the
+   characters from the second 0x20 byte up to the first 0x0D 0x0A byte
+   pair in the data from the client can be safely ignored. (It will
+   probably be the string &quot;HTTP/1.1&quot;.)&lt;/p&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt;&lt;/dt&gt;
+   &lt;li&gt;
 
-   &lt;dd&gt;The port number on which the server expected and/or received
-   the connection.&lt;/dd&gt;
+    &lt;p&gt;A series of fields.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;&lt;/dt&gt;
+    &lt;p&gt;Each field is terminated by a UTF-8-encoded U+000D CARRIAGE
+    RETURN U+000A LINE FEED character pair (CRLF). The end of the
+    fields is denoted by the terminating CRLF pair being followed
+    immediately by another CRLF pair.&lt;/p&gt;
 
-   &lt;dd&gt;An identifier for the service provided by the server. If the
-   server provides multiple services, then the value should be derived
-   from the client's handshake, specifically from the &quot;Host&quot;
-   field.&lt;/dd&gt;
+    &lt;p class=note&gt;In other words, the fields start with the first
+    0x0D 0x0A byte pair and end with the first 0x0D 0x0A 0x0D 0x0A
+    byte sequence.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;secure flag&lt;/var&gt;&lt;dt&gt;
+    &lt;p&gt;The fields are encoded as UTF-8.&lt;/p&gt;
 
-   &lt;/dt&gt;&lt;dd&gt;True if the connection is encrypted or if the server expected
-   it to be encrypted; false otherwise.&lt;/dd&gt;
+    &lt;p&gt;Each field consists of a name, consisting of one or more
+    characters in the range U+0021 to U+007E, followed by a U+003A
+    COLON character (:) and a U+0020 SPACE character, followed by zero
+    or more characters forming the value.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/dt&gt;
+    &lt;p&gt;The expected field names, the meaning of their corresponding
+    values, and the processing servers are required to apply to those
+    fields, are described below, after the description of the client
+    handshake.&lt;/p&gt;
 
-   &lt;dd&gt;Either null, or a string representing the subprotocol the
-   server is ready to use. If the server supports multiple
-   subprotocols, then the value should be derived from the client's
-   handshake, specifically from the &quot;WebSocket-Protocol&quot; field. The
-   absence of such a field is equivalent to the null value. The empty
-   string is not the same as the null value for these purposes.&lt;/dd&gt;
+   &lt;/li&gt;
 
-  &lt;/dl&gt;&lt;p&gt;Having established this information, the server must start the
-  handshake. The initial part of the server's handshake is invariant,
-  and must consist of the following bytes:&lt;/p&gt;
+   &lt;li&gt;
 
-  &lt;pre&gt;48 54 54 50 2F 31 2E 31  20 31 30 31 20 57 65 62
-20 53 6F 63 6B 65 74 20  50 72 6F 74 6F 63 6F 6C
-20 48 61 6E 64 73 68 61  6B 65 0D 0A 55 70 67 72
-61 64 65 3A 20 57 65 62  53 6F 63 6B 65 74 0D 0A
-43 6F 6E 6E 65 63 74 69  6F 6E 3A 20 55 70 67 72
-61 64 65 0D 0A 57 65 62  53 6F 63 6B 65 74 2D 4F
-72 69 67 69 6E 3A 20&lt;/pre&gt;
+    &lt;p&gt;After the first 0x0D 0x0A 0x0D 0x0A byte sequence, indicating
+    the end of the fields, the client sends eight random bytes. These
+    are used in constructing the server handshake.&lt;/p&gt;
 
-  &lt;p&gt;These bytes must be the first bytes sent on the TCP connection by
-  the server. They must be followed by the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;
-  string, encoded as ANSI_X3.4-1968 (US-ASCII), followed by the
-  following bytes: &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+   &lt;/li&gt;
 
-  &lt;pre&gt;0D 0A 57 65 62 53 6F 63  6B 65 74 2D 4C 6F 63 61
-74 69 6F 6E 3A 20&lt;/pre&gt;
+  &lt;/ol&gt;&lt;p&gt;The expected field names, and the meaning of their corresponding
+  values, are as follows. Field names must be compared in an
+  &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; manner.&lt;/p&gt;
 
-  &lt;p&gt;The server must then send the string that results from &lt;a href=#construct-a-web-socket-url title=&quot;construct a Web Socket URL&quot;&gt;constructing a Web Socket
-  URL&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;,
-  &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure
-  flag&lt;/var&gt;, encoded as ANSI_X3.4-1968 (US-ASCII). &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+  &lt;dl&gt;&lt;dt&gt;&lt;code title=http-upgrade&gt;Upgrade&lt;/code&gt;&lt;/dt&gt;
 
-  &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is not null, then the
-  server must then send the following bytes:&lt;/p&gt;
+   &lt;dd&gt;
 
-  &lt;pre&gt;0D 0A 57 65 62 53 6F 63  6B 65 74 2D 50 72 6F 74
-6F 63 6F 6C 3A 20&lt;/pre&gt;
+    &lt;p&gt;Invariant part of the handshake. Will always have a value that
+    is an &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the string
+    &quot;WebSocket&quot;.&lt;/p&gt;
 
-  &lt;p&gt;...followed by the &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; string,
-  encoded as ANSI_X3.4-1968 (US-ASCII). &lt;a href=#refsRFC1345&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Can be safely ignored, though the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
+    connection&lt;/a&gt; if this field is absent or has a different
+    value, to avoid vulnerability to cross-protocol attacks.&lt;/p&gt;
 
-  &lt;p&gt;Finally, the server must end its side of the handshake by sending
-  the four bytes 0x0D 0x0A 0x0D 0x0A to the client.&lt;/p&gt;
+   &lt;/dd&gt;
 
+   &lt;dt&gt;&lt;code title=http-connection&gt;Connection&lt;/code&gt;&lt;/dt&gt;
 
-  &lt;h6 id=&quot;reading-the-client's-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.4.2 &lt;/span&gt;Reading the client's handshake&lt;/h6&gt;
-
-  &lt;p&gt;When a client starts a Web Socket connection, it sends its part
-  of the handshake. This consists of a number of fields separated by
-  CRLF pairs (bytes 0x0D 0x0A).&lt;/p&gt;
-
-  &lt;p&gt;The first field consists of three tokens separated by space
-  characters (byte 0x20). The first token is the string &quot;GET&quot;, the
-  middle token is the resource name, and the third is the string
-  &quot;HTTP/1.1&quot;.&lt;/p&gt;
-
-  &lt;p&gt;If the first field does not have three tokens, or if the first
-  and third tokens aren't the strings given in the previous paragraph,
-  or if the second token doesn't begin with U+002F SOLIDUS character
-  (/), the server should abort the connection: it either represents an
-  errorneous Web Socket client or a connection from a client expecting
-  another protocol altogether.&lt;/p&gt;
-
-  &lt;p&gt;The subsequent fields consist of a string representing a name, a
-  colon and a space (bytes 0x3A 0x20), and a string representing a
-  value. The possible names, and the meaning of their corresponding
-  values, are as follows:&lt;/p&gt;
-
-  &lt;dl&gt;&lt;dt&gt;Upgrade (bytes 55 70 67 72 61 64 65; always the first name-value pair)&lt;/dt&gt;
-
    &lt;dd&gt;
 
-    &lt;p&gt;Invariant part of the handshake. Will always have a value
-    consisting of bytes 57 65 62 53 6F 63 6B 65 74.&lt;/p&gt;
+    &lt;p&gt;Invariant part of the handshake. Will always have a value that
+    is an &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the string
+    &quot;Upgrade&quot;.&lt;/p&gt;
 
-   &lt;/dd&gt;
+    &lt;p&gt;Can be safely ignored, though the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
+    connection&lt;/a&gt; if this field is absent or has a different
+    value, to avoid vulnerability to cross-protocol attacks.&lt;/p&gt;
 
-   &lt;dt&gt;Connection (bytes 43 6F 6E 6E 65 63 74 69 6F 6E; always the second name-value pair)&lt;/dt&gt;
-
-   &lt;dd&gt;
-
-    &lt;p&gt;Invariant part of the handshake. Will always have a value
-    consisting of bytes 55 70 67 72 61 64 65.&lt;/p&gt;
-
    &lt;/dd&gt;
  
-   &lt;dt&gt;Host (bytes 48 6F 73 74; always the third name-value pair)&lt;/dt&gt;
+   &lt;dt&gt;&lt;code title=http-host&gt;Host&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;The value gives the hostname that the client intended to use
-    when opening the Web Socket. It would be of interest in particular
+    when opening the WebSocket. It would be of interest in particular
     to virtual hosting environments, where one server might serve
     multiple hosts, and might therefore want to return different
-    data. The value must be interpreted as UTF-8.&lt;/p&gt;
+    data.&lt;/p&gt;
 
+    &lt;p&gt;Can be safely ignored, though the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
+    connection&lt;/a&gt; if this field is absent or has a value that
+    does not match the server's host name, to avoid vulnerability to
+    cross-protocol attacks and DNS rebinding attacks.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;Origin (bytes 4F 72 69 67 69 6E; always the fourth name-value pair)&lt;/dt&gt; &lt;!-- http-origin --&gt;
+   &lt;dt&gt;&lt;code title=http-origin&gt;Origin&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;The value gives the scheme, hostname, and port (if it's not the
     default port for the given scheme) of the page that asked the
-    client to open the Web Socket. It would be interesting if the
+    client to open the WebSocket. It would be interesting if the
     server's operator had deals with operators of other sites, since
     the server could then decide how to respond (or indeed,
     &lt;em&gt;whether&lt;/em&gt; to respond) based on which site was requesting a
-    connection. The value must be interpreted as UTF-8.&lt;/p&gt;
+    connection. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;
 
+    &lt;p&gt;Can be safely ignored, though the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
+    connection&lt;/a&gt; if this field is absent or has a value that
+    does not match one of the origins the server is expecting to
+    communicate with, to avoid vulnerability to cross-protocol attacks
+    and cross-site scripting attacks.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;WebSocket-Protocol (bytes 57 65 62 53 6F 63 6B 65 74 2D 50 72 6F 74 6F 63 6F 6C; optional, if present, will be the fifth name-value pair)&lt;/dt&gt; &lt;!-- http-websocket-protocol --&gt;
+   &lt;dt&gt;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;The value gives the name of a subprotocol that the client is
     intending to select. It would be interesting if the server
-    supports multiple protocols or protocol versions. The value must
-    be interpreted as UTF-8.&lt;/p&gt;
+    supports multiple protocols or protocol versions.&lt;/p&gt;
 
+    &lt;p&gt;Can be safely ignored, though the server may &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
+    connection&lt;/a&gt; if the field is absent but the conventions for
+    communicating with the server are such that the field is
+    expected; and the server should &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket connection&lt;/a&gt;
+    if the field has a value that does not match one of the
+    subprotocols that the server supports, to avoid integrity errors
+    once the connection is established.&lt;/p&gt;
+
    &lt;/dd&gt;
 
+   &lt;dt&gt;&lt;code title=http-sec-websocket-key1&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key1&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;code title=http-sec-websocket-key2&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key2&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The values provide the information required for computing the
+    server's handshake, as described in the next section.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;Other fields&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -68572,33 +68837,307 @@
     connect (e.g. because they are on an intranet firewalled from the
     public Internet), then the server should also verify that the
     client's handshake includes the invariant &quot;Upgrade&quot; and
-    &quot;Connection&quot; parts of the handshake. Otherwise, an attacker could
-    trick a client into sending Web Socket frames to a server
+    &quot;Connection&quot; parts of the handshake, and should send the server's
+    handshake before changing any user data. Otherwise, an attacker
+    could trick a client into sending WebSocket frames to a server
     (e.g. using &lt;code&gt;XMLHttpRequest&lt;/code&gt;) and cause the server to
     perform actions on behalf of the user without the user's
-    consent.&lt;/p&gt;
+    consent. (Sending the server's handshake ensures that the frames
+    were not sent as part of a cross-protocol attack, since other
+    protocols do not send the necessary components in the client's
+    initial handshake for forming the server's handshake.)&lt;/p&gt;
 
    &lt;/dd&gt;
 
-  &lt;/dl&gt;&lt;p&gt;A final field consisting of the empty string (two consecutive
-  CRLF pairs) indicates the end of the client's handshake.&lt;/p&gt;
+  &lt;/dl&gt;&lt;p&gt;Unrecognised fields can be safely ignored, and are probably
+  either the result of intermediaries injecting fields unrelated to
+  the operation of the WebSocket protocol, or clients that support
+  future versions of the protocol offering options that the server
+  doesn't support.&lt;/p&gt;
 
-  &lt;p&gt;Any fields that lack the colon-space separator must at a minimum
-  be discarded and may cause the server to disconnect.&lt;/p&gt;
+  
+  &lt;h6 id=&quot;sending-the-server's-handshake&quot;&gt;&lt;span class=secno&gt;10.3.4.4.2 &lt;/span&gt;Sending the server's handshake&lt;/h6&gt;
 
-  &lt;p&gt;Whether the server does or does not read the client handshake, it
-  must at a minimum read (and optionally discard) bytes until it has
-  read the first sequence of four bytes 0x0A 0x0D 0x0A 0x0D, which
-  signals the end of the client handshake. Servers may do this before
-  or after sending their handshake, but must do it before reading
-  frames from the client as described in the next section.&lt;/p&gt;
+  &lt;p&gt;When a client establishes a WebSocket connection to a server, the
+  server must run the following steps.&lt;/p&gt;
 
+  &lt;ol&gt;&lt;li&gt;
 
+    &lt;p&gt;If the server supports encryption, perform a TLS handshake over
+    the connection. If this fails (e.g. the client indicated a host
+    name in the extended client hello &quot;server_name&quot; extension that the
+    server does not host), then close the connection; otherwise, all
+    further communication for the connection (including the server
+    handshake) must run through the encrypted tunnel. &lt;a href=#refsRFC2246&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Establish the following information:&lt;/p&gt;
+
+    &lt;dl&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;host&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The host name or IP address of the WebSocket server, as it is
+     to be addressed by clients. The host name must be
+     punycode-encoded if necessary. If the server can respond to
+     requests to multiple hosts (e.g. in a virtual hosting
+     environment), then the value should be derived from the client's
+     handshake, specifically from the &quot;&lt;code title=http-host&gt;Host&lt;/code&gt;&quot; field.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The port number on which the server expected and/or received
+     the connection.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;An identifier for the service provided by the server. If the
+     server provides multiple services, then the value should be
+     derived from the resource name given in the client's
+     handshake.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;secure flag&lt;/var&gt;&lt;dt&gt;
+
+     &lt;/dt&gt;&lt;dd&gt;True if the connection is encrypted or if the server expected
+     it to be encrypted; false otherwise.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The &lt;a href=#ascii-serialization-of-an-origin title=&quot;ASCII serialization of an origin&quot;&gt;ASCII
+     serialization&lt;/a&gt; of the origin that the server is willing to
+     communicate with. If the server can respond to requests from
+     multiple origins (or indeed, all origins), then the value should
+     be derived from the client's handshake, specifically from the
+     &quot;&lt;code title=http-origin&gt;Origin&lt;/code&gt;&quot; field. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Either null, or a string representing the subprotocol the
+     server is ready to use. If the server supports multiple
+     subprotocols, then the value should be derived from the client's
+     handshake, specifically from the &quot;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;&quot;
+     field. The absence of such a field is equivalent to the null
+     value. The empty string is not the same as the null value for
+     these purposes.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key1&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The value of the &quot;&lt;code title=http-sec-websocket-key1&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key1&lt;/a&gt;&lt;/code&gt;&quot;
+     field in the client's handshake.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key2&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The value of the &quot;&lt;code title=http-sec-websocket-key2&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key2&lt;/a&gt;&lt;/code&gt;&quot;
+     field in the client's handshake.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key3&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The eight random bytes sent after the first 0x0D 0x0A 0x0D
+     0x0A sequence in the client's handshake.&lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; be the string that results
+    from &lt;a href=#construct-a-websocket-url title=&quot;construct a WebSocket URL&quot;&gt;constructing a
+    WebSocket URL&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure flag&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key1-number&lt;/var&gt; be the digits (characters
+    in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9)) in
+    &lt;var title=&quot;&quot;&gt;key1&lt;/var&gt;, interpreted as a base ten integer,
+    ignoring all other characters in &lt;var title=&quot;&quot;&gt;key1&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key2-number&lt;/var&gt; be the digits (characters
+    in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9)) in
+    &lt;var title=&quot;&quot;&gt;key2&lt;/var&gt;, interpreted as a base ten integer,
+    ignoring all other characters in &lt;var title=&quot;&quot;&gt;key2&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;div class=example&gt;
+
+     &lt;p&gt;For example, assume that the client handshake was:&lt;/p&gt;
+
+     &lt;pre&gt;GET / HTTP/1.1
+Connection: Upgrade
+Host: example.com
+Upgrade: WebSocket
+Sec-WebSocket-Key1: 3e6b263&nbsp;&nbsp;4&nbsp;17&nbsp;80
+Origin: <A HREF="http://example.com">http://example.com</A>
+Sec-WebSocket-Key2: 17&nbsp;&nbsp;9&nbsp;G`ZD9&nbsp;&nbsp;&nbsp;2&nbsp;2b&nbsp;7X&nbsp;3&nbsp;/r90
+
+WjN}|M(6&lt;/pre&gt;
+
+     &lt;p&gt;The &lt;var title=&quot;&quot;&gt;key1-number&lt;/var&gt; would be the number
+     3,626,341,780, and the &lt;var title=&quot;&quot;&gt;key2-number&lt;/var&gt; would be
+     the number 1,799,227,390.&lt;/p&gt;
+
+     &lt;p&gt;In this example, incidentally, &lt;var title=&quot;&quot;&gt;key3&lt;/var&gt; is
+     &quot;WjN}|M(6&quot;, or 0x57 0x6A 0x4E 0x7D 0x7C 0x4D 0x28 0x36.&lt;/p&gt;
+
+    &lt;/div&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt; be the number of U+0020 SPACE
+    characters in &lt;var title=&quot;&quot;&gt;key1&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt; be the number of U+0020 SPACE
+    characters in &lt;var title=&quot;&quot;&gt;key2&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If either &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt; or &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt; is zero, then &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
+    connection&lt;/a&gt;. This is a symptom of a cross-protocol
+    attack.&lt;/p&gt;
+
+    &lt;p class=example&gt;In the example above, &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt; would be 4 and &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt;
+    would be 10.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;key1-number&lt;/var&gt; is not an integral multiple
+    of &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt;, then &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
+    connection&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;key2-number&lt;/var&gt; is not an integral multiple
+    of &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt;, then &lt;a href=#abort-the-websocket-connection&gt;abort the WebSocket
+    connection&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p class=note&gt;This can only happen if the client is not a
+    conforming WebSocket client.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part1&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;key1-number&lt;/var&gt; divided by &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part2&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;key2-number&lt;/var&gt; divided by &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p class=example&gt;In the example above, &lt;var title=&quot;&quot;&gt;part1&lt;/var&gt;
+    would be 906,585,445 and &lt;var title=&quot;&quot;&gt;part2&lt;/var&gt; would be
+    179,922,739.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; be the concatenation of &lt;var title=&quot;&quot;&gt;part1&lt;/var&gt;, expressed as a little-endian 32 bit integer,
+    &lt;var title=&quot;&quot;&gt;part2&lt;/var&gt;, expressed as a little-endian 32 bit
+    integer, and the eight bytes of &lt;var title=&quot;&quot;&gt;key3&lt;/var&gt; in the
+    order they were sent on the wire.&lt;/p&gt;
+
+    &lt;!--
+    perl -e 'foreach (@ARGV) { print pack 'N', $_ }' 906585445 179922739 | hexdump -C
+    --&gt;
+
+    &lt;p class=example&gt;In the example above, this would be the 16
+    bytes 0x36 0x09 0x65 0x65 0x0A 0xB9 0x67 0x33 0x57 0x6A 0x4E 0x7D
+    0x7C 0x4D 0x28 0x36.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;response&lt;/var&gt; be the MD5 fingerprint of &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; as a little-endian 128 bit string. &lt;a href=#refsRFC1321&gt;[RFC1321]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;!--
+    perl -e &quot;print pack 'c*', map { hex } @ARGV&quot; 0x36 0x09 0x65 0x65 0x0A 0xB9 0x67 0x33 0x57 0x6A 0x4E 0x7D 0x7C 0x4D 0x28 0x36 | md5sum -b
+    --&gt;
+
+    &lt;p class=example&gt;In the example above, this would be the 16
+    bytes 0x6E 0x60 0x39 0x65 0x42 0x6B 0x39 0x7A 0x24 0x52 0x38 0x70
+    0x4F 0x74 0x56 0x62, or &quot;n`9eBk9z$R8pOtVb&quot; in ASCII.
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send the following line, terminated by the two characters
+    U+000D CARRIAGE RETURN and U+000A LINE FEED (CRLF) and encoded as
+    UTF-8, to the client:&lt;/p&gt;
+
+    &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake&lt;/pre&gt;
+
+    &lt;p&gt;This line may be sent differently if necessary, but must match
+    the Status-Line production defined in the HTTP specification, with
+    the Status-Code having the value 101.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send the following fields to the client. Each field must be
+    sent as a line consisting of the field name, which must be an
+    &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt; match for the field name in
+    the list below, followed by a U+003A COLON character (:) and a
+    U+0020 SPACE character, followed by the field value as specified
+    in the list below, followed by the two characters U+000D CARRIAGE
+    RETURN and U+000A LINE FEED (CRLF). The lines must be encoded as
+    UTF-8. The lines may be sent in any order.&lt;/p&gt;
+
+    &lt;dl&gt;&lt;dt&gt;&lt;code title=http-upgrade&gt;Upgrade&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The value must be the string &quot;WebSocket&quot;.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=http-connection&gt;Connection&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The value must be the string &quot;Upgrade&quot;.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;Sec-WebSocket-Location&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The value must be &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;Sec-WebSocket-Origin&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The value must be &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;This field must be included if &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is not null, and must not be included
+      if &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is null.&lt;/p&gt;
+
+      &lt;p&gt;If included, the value must be &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send two bytes 0x0D 0x0A (ASCII CRLF).&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send &lt;var title=&quot;&quot;&gt;response&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;This completes the server's handshake. If the server finishes
+  these steps without &lt;a href=#abort-the-websocket-connection title=&quot;abort the WebSocket
+  connection&quot;&gt;aborting the WebSocket connection&lt;/a&gt;, and if the
+  client does not then &lt;a href=#fail-the-connection&gt;fail the connection&lt;/a&gt;, then the
+  connection is established and the server may begin and receiving
+  sending data, as described in the next section.&lt;/p&gt;
+
+
+
   &lt;h6 id=ws-sd-framing&gt;&lt;span class=secno&gt;10.3.4.4.3 &lt;/span&gt;Data framing&lt;/h6&gt;
 
   &lt;p&gt;The server must run through the following steps to process the
   bytes sent by the client.  If at any point during these steps a read
-  is attempted but fails because the &lt;a href=#web-socket-connection-is-closed&gt;Web Socket connection is
+  is attempted but fails because the &lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is
   closed&lt;/a&gt;, then abort.&lt;/p&gt;
 
   &lt;ol&gt;&lt;li id=wd-sd-frame&gt;&lt;p&gt;&lt;i title=&quot;&quot;&gt;Frame&lt;/i&gt;: Read a byte from the
@@ -68665,30 +69204,39 @@
    &lt;li&gt;&lt;p&gt;Send a 0xFF byte to the client to indicate the end of the
    message.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;h6 id=handling-errors-in-utf-8-0&gt;&lt;span class=secno&gt;10.3.4.4.4 &lt;/span&gt;Handling errors in UTF-8&lt;/h6&gt;
+  &lt;/ol&gt;&lt;h6 id=aborting-the-connection&gt;&lt;span class=secno&gt;10.3.4.4.4 &lt;/span&gt;Aborting the connection&lt;/h6&gt;
 
+  &lt;p&gt;To &lt;dfn id=abort-the-websocket-connection&gt;abort the WebSocket connection&lt;/dfn&gt; during the
+  handshake, the server must &lt;a href=#close-the-websocket-connection&gt;close the WebSocket
+  connection&lt;/a&gt;.&lt;/p&gt;
+
+
+  &lt;h6 id=handling-errors-in-utf-8-0&gt;&lt;span class=secno&gt;10.3.4.4.5 &lt;/span&gt;Handling errors in UTF-8&lt;/h6&gt;
+
   &lt;p&gt;When a server is to interpret a byte stream as UTF-8 but finds
   that the byte stream is not in fact a valid UTF-8 stream, behaviour
   is undefined. A server could close the connection, convert invalid
   byte sequences to U+FFFD REPLACEMENT CHARACTERs, store the data
   verbatim, or perform application-specific processing. Subprotocols
-  layered on the Web Socket protocol might define specific behavior
+  layered on the WebSocket protocol might define specific behavior
   for servers.&lt;/p&gt;
 
 
 
-  &lt;h5 id=closing-the-connection-0&gt;&lt;span class=secno&gt;10.3.4.5 &lt;/span&gt;Closing the connection&lt;/h5&gt;
+  &lt;h5 id=closing-the-connection&gt;&lt;span class=secno&gt;10.3.4.5 &lt;/span&gt;Closing the connection&lt;/h5&gt;
 
-  &lt;p&gt;To &lt;dfn id=close-the-web-socket-connection&gt;close the Web Socket connection&lt;/dfn&gt;, either the user
-  agent or the server closes the TCP/IP connection. There is no
+  &lt;p&gt;To &lt;dfn id=close-the-websocket-connection&gt;close the WebSocket connection&lt;/dfn&gt;, either the user
+  agent or the server closes the TCP connection. There is no
   closing handshake. When a user agent notices that the server has
   closed its connection, it must immediately close its side of the
   connection also. Whether the user agent or the server closes the
-  connection first, it is said that the &lt;dfn id=web-socket-connection-is-closed&gt;Web Socket connection is
+  connection first, it is said that the &lt;dfn id=websocket-connection-is-closed&gt;WebSocket connection is
   closed&lt;/dfn&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Servers may &lt;a href=#close-the-web-socket-connection&gt;close the Web Socket connection&lt;/a&gt; whenever
-  desired. User agents should not &lt;a href=#close-the-web-socket-connection&gt;close the Web Socket
+  &lt;!-- XXX Close Handshake but NOT for FAILing or ABORTing --&gt;
+
+  &lt;p&gt;Servers may &lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt; whenever
+  desired. User agents should not &lt;a href=#close-the-websocket-connection&gt;close the WebSocket
   connection&lt;/a&gt; arbitrarily.&lt;/p&gt;
 
 
@@ -68697,7 +69245,7 @@
 
   &lt;p&gt;While this protocol is intended to be used by scripts in Web
   pages, it can also be used directly by hosts. Such hosts are acting
-  on their own behalf, and can therefore send fake &quot;Origin&quot; headers,
+  on their own behalf, and can therefore send fake &quot;Origin&quot; fields,
   misleading the server. Servers should therefore be careful about
   assuming that they are talking directly to scripts from known
   origins, and must consider that they might be accessed in unexpected
@@ -68709,12 +69257,12 @@
   the SQL server, lest the server be susceptible to SQL injection.&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;Servers that are not intended to process input from any Web page
-  but only for certain sites should verify the &quot;Origin&quot; header is an
+  but only for certain sites should verify the &quot;Origin&quot; field is an
   origin they expect, and should only respond with the corresponding
-  &quot;WebSocket-Origin&quot; if it is an accepted origin. Servers that only
-  accept input from one origin can just send back that value in the
-  &quot;WebSocket-Origin&quot; header, without bothering to check the client's
-  value.&lt;/p&gt;
+  &quot;Sec-WebSocket-Origin&quot; if it is an accepted origin. Servers that
+  only accept input from one origin can just send back that value in
+  the &quot;Sec-WebSocket-Origin&quot; field, without bothering to check the
+  client's value.&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;If at any time a server is faced with data that it does not
   understand, or that violates some criteria by which the server
@@ -68734,7 +69282,7 @@
 
   &lt;h6 id=registration-of-ws:-scheme&gt;&lt;span class=secno&gt;10.3.4.7.1 &lt;/span&gt;Registration of &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; scheme&lt;/h6&gt;
 
-  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; URL identifies a Web Socket server
+  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; URL identifies a WebSocket server
   and resource name.&lt;/p&gt;
 
   &lt;dl&gt;&lt;dt&gt;URI scheme name.&lt;/dt&gt;
@@ -68758,7 +69306,7 @@
 
    &lt;dt&gt;URI scheme semantics.&lt;/dt&gt;
    &lt;dd&gt;The only operation for this scheme is to open a connection
-   using the Web Socket protocol.&lt;/dd&gt;
+   using the WebSocket protocol.&lt;/dd&gt;
 
    &lt;dt&gt;Encoding considerations.&lt;/dt&gt;
    &lt;dd&gt;
@@ -68778,7 +69326,7 @@
    &lt;/dd&gt;
 
    &lt;dt&gt;Applications/protocols that use this URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;Web Socket protocol.&lt;/dd&gt;
+   &lt;dd&gt;WebSocket protocol.&lt;/dd&gt;
 
    &lt;dt&gt;Interoperability considerations.&lt;/dt&gt;
    &lt;dd&gt;None.&lt;/dd&gt;
@@ -68797,7 +69345,7 @@
 
   &lt;/dl&gt;&lt;h6 id=registration-of-wss:-scheme&gt;&lt;span class=secno&gt;10.3.4.7.2 &lt;/span&gt;Registration of &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; scheme&lt;/h6&gt;
 
-  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; URL identifies a Web Socket server
+  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; URL identifies a WebSocket server
   and resource name, and indicates that traffic over that connection
   is to be encrypted.&lt;/p&gt;
 
@@ -68821,7 +69369,7 @@
 
    &lt;dt&gt;URI scheme semantics.&lt;/dt&gt;
    &lt;dd&gt;The only operation for this scheme is to open a connection
-   using the Web Socket protocol, encrypted using TLS.&lt;/dd&gt;
+   using the WebSocket protocol, encrypted using TLS.&lt;/dd&gt;
 
    &lt;dt&gt;Encoding considerations.&lt;/dt&gt;
    &lt;dd&gt;
@@ -68841,7 +69389,7 @@
    &lt;/dd&gt;
 
    &lt;dt&gt;Applications/protocols that use this URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;Web Socket protocol over TLS.&lt;/dd&gt;
+   &lt;dd&gt;WebSocket protocol over TLS.&lt;/dd&gt;
 
    &lt;dt&gt;Interoperability considerations.&lt;/dt&gt;
    &lt;dd&gt;None.&lt;/dd&gt;
@@ -68872,17 +69420,59 @@
    &lt;dt&gt;References.&lt;/dt&gt;
    &lt;dd&gt;This document.&lt;/dd&gt;
 
-  &lt;/dl&gt;&lt;h6 id=websocket-origin&gt;&lt;span class=secno&gt;10.3.4.7.4 &lt;/span&gt;&lt;dfn title=http-websocket-origin&gt;&lt;code&gt;WebSocket-Origin&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
+  &lt;/dl&gt;&lt;h6 id=sec-websocket-key1-and-sec-websocket-key2&gt;&lt;span class=secno&gt;10.3.4.7.4 &lt;/span&gt;&lt;dfn title=http-sec-websocket-key1&gt;&lt;code&gt;Sec-WebSocket-Key1&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn title=http-sec-websocket-key2&gt;&lt;code&gt;Sec-WebSocket-Key2&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
 
+  &lt;p&gt;This section describes two header fields for registration in the
+  Permanent Message Header Field Registry.  &lt;a href=#refsRFC3864&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
+   &lt;dd&gt;Sec-WebSocket-Key1&lt;/dd&gt;
+   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
+   &lt;dd&gt;http&lt;/dd&gt;
+   &lt;dt&gt;Status&lt;/dt&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
+   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
+   &lt;dd&gt;IETF&lt;/dd&gt;
+   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
+   &lt;dd&gt;
+    This document is the relevant specification.
+   &lt;/dd&gt;
+   &lt;dt&gt;Related information&lt;/dt&gt;
+   &lt;dd&gt;None.&lt;/dd&gt;   
+  &lt;/dl&gt;&lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
+   &lt;dd&gt;Sec-WebSocket-Key2&lt;/dd&gt;
+   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
+   &lt;dd&gt;http&lt;/dd&gt;
+   &lt;dt&gt;Status&lt;/dt&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
+   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
+   &lt;dd&gt;IETF&lt;/dd&gt;
+   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
+   &lt;dd&gt;
+    This document is the relevant specification.
+   &lt;/dd&gt;
+   &lt;dt&gt;Related information&lt;/dt&gt;
+   &lt;dd&gt;None.&lt;/dd&gt;   
+  &lt;/dl&gt;&lt;p&gt;The &lt;code title=http-sec-websocket-key1&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key1&lt;/a&gt;&lt;/code&gt; and &lt;code title=http-sec-websocket-key2&gt;&lt;a href=#sec-websocket-key1-and-sec-websocket-key2&gt;Sec-WebSocket-Key2&lt;/a&gt;&lt;/code&gt; headers
+  are used in the WebSocket handshake. They are sent from the client
+  to the server to provide part of the information used by the server
+  to prove that it received a valid WebSocket handshake. This helps
+  ensure that the server does not accept connections from
+  non-Web-Socket clients (e.g. HTTP clients) that are being abused to
+  send data to unsuspecting WebSocket servers.&lt;/p&gt;
+
+
+  &lt;h6 id=sec-websocket-location&gt;&lt;span class=secno&gt;10.3.4.7.5 &lt;/span&gt;&lt;dfn title=http-sec-websocket-location&gt;&lt;code&gt;Sec-WebSocket-Location&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
+
   &lt;p&gt;This section describes a header field for registration in the
   Permanent Message Header Field Registry.  &lt;a href=#refsRFC3864&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
 
   &lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;WebSocket-Origin&lt;/dd&gt;
+   &lt;dd&gt;Sec-WebSocket-Location&lt;/dd&gt;
    &lt;dt&gt;Applicable protocol&lt;/dt&gt;
    &lt;dd&gt;http&lt;/dd&gt;
    &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside Web Socket handshake&lt;/dd&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
    &lt;dt&gt;Author/Change controller&lt;/dt&gt;
    &lt;dd&gt;IETF&lt;/dd&gt;
    &lt;dt&gt;Specification document(s)&lt;/dt&gt;
@@ -68891,24 +69481,26 @@
    &lt;/dd&gt;
    &lt;dt&gt;Related information&lt;/dt&gt;
    &lt;dd&gt;None.&lt;/dd&gt;   
-  &lt;/dl&gt;&lt;p&gt;The &lt;code&gt;WebSocket-Origin&lt;/code&gt; header is used in the Web
-  Socket handshake. It is sent from the server to the client to
-  confirm the &lt;a href=#origin&gt;origin&lt;/a&gt; of the script that opened the
-  connection. This enables user agents to verify that the server is
-  willing to serve the script that opened the connection.&lt;/p&gt;
+  &lt;/dl&gt;&lt;p&gt;The &lt;code title=http-sec-websocket-location&gt;&lt;a href=#sec-websocket-location&gt;Sec-WebSocket-Location&lt;/a&gt;&lt;/code&gt;
+  header is used in the WebSocket handshake. It is sent from the
+  server to the client to confirm the &lt;a href=#url&gt;URL&lt;/a&gt; of the
+  connection. This enables the client to verify that the connection
+  was established to the right server, port, and path, instead of
+  relying on the server to verify that the requested host, port, and
+  path are correct.&lt;/p&gt;
 
 
-  &lt;h6 id=websocket-protocol-0&gt;&lt;span class=secno&gt;10.3.4.7.5 &lt;/span&gt;&lt;dfn title=http-websocket-protocol&gt;&lt;code&gt;WebSocket-Protocol&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
+  &lt;h6 id=sec-websocket-origin&gt;&lt;span class=secno&gt;10.3.4.7.6 &lt;/span&gt;&lt;dfn title=http-sec-websocket-origin&gt;&lt;code&gt;Sec-WebSocket-Origin&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
 
   &lt;p&gt;This section describes a header field for registration in the
   Permanent Message Header Field Registry.  &lt;a href=#refsRFC3864&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
 
   &lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;WebSocket-Protocol&lt;/dd&gt;
+   &lt;dd&gt;Sec-WebSocket-Origin&lt;/dd&gt;
    &lt;dt&gt;Applicable protocol&lt;/dt&gt;
    &lt;dd&gt;http&lt;/dd&gt;
    &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside Web Socket handshake&lt;/dd&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
    &lt;dt&gt;Author/Change controller&lt;/dt&gt;
    &lt;dd&gt;IETF&lt;/dd&gt;
    &lt;dt&gt;Specification document(s)&lt;/dt&gt;
@@ -68917,24 +69509,25 @@
    &lt;/dd&gt;
    &lt;dt&gt;Related information&lt;/dt&gt;
    &lt;dd&gt;None.&lt;/dd&gt;   
-  &lt;/dl&gt;&lt;p&gt;The &lt;code&gt;WebSocket-Protocol&lt;/code&gt; header is used in the Web
-  Socket handshake. It is sent from the client to the server and back
-  from the server to the client to confirm the subprotocol of the
-  connection. This enables scripts to both select a subprotocol and be
-  sure that the server agreed to serve that subprotocol.&lt;/p&gt;
+  &lt;/dl&gt;&lt;p&gt;The &lt;code title=http-sec-websocket-origin&gt;&lt;a href=#sec-websocket-origin&gt;Sec-WebSocket-Origin&lt;/a&gt;&lt;/code&gt; header
+  is used in the WebSocket handshake. It is sent from the server to
+  the client to confirm the &lt;a href=#origin&gt;origin&lt;/a&gt; of the script that
+  opened the connection. This enables user agents to verify that the
+  server is willing to serve the script that opened the
+  connection.&lt;/p&gt;
 
 
-  &lt;h6 id=websocket-location&gt;&lt;span class=secno&gt;10.3.4.7.6 &lt;/span&gt;&lt;dfn title=http-websocket-location&gt;&lt;code&gt;WebSocket-Location&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
+  &lt;h6 id=sec-websocket-protocol&gt;&lt;span class=secno&gt;10.3.4.7.7 &lt;/span&gt;&lt;dfn title=http-sec-websocket-protocol&gt;&lt;code&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
 
   &lt;p&gt;This section describes a header field for registration in the
   Permanent Message Header Field Registry.  &lt;a href=#refsRFC3864&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
 
   &lt;dl&gt;&lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;WebSocket-Location&lt;/dd&gt;
+   &lt;dd&gt;Sec-WebSocket-Protocol&lt;/dd&gt;
    &lt;dt&gt;Applicable protocol&lt;/dt&gt;
    &lt;dd&gt;http&lt;/dd&gt;
    &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside Web Socket handshake&lt;/dd&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
    &lt;dt&gt;Author/Change controller&lt;/dt&gt;
    &lt;dd&gt;IETF&lt;/dd&gt;
    &lt;dt&gt;Specification document(s)&lt;/dt&gt;
@@ -68943,24 +69536,24 @@
    &lt;/dd&gt;
    &lt;dt&gt;Related information&lt;/dt&gt;
    &lt;dd&gt;None.&lt;/dd&gt;   
-  &lt;/dl&gt;&lt;p&gt;The &lt;code&gt;WebSocket-Location&lt;/code&gt; header is used in the Web
-  Socket handshake. It is sent from the server to the client to
-  confirm the &lt;a href=#url&gt;URL&lt;/a&gt; of the connection. This enables the
-  client to verify that the connection was established to the right
-  server, port, and path, instead of relying on the server to verify
-  that the requested host, port, and path are correct.&lt;/p&gt;
+  &lt;/dl&gt;&lt;p&gt;The &lt;code title=http-sec-websocket-protocol&gt;&lt;a href=#sec-websocket-protocol&gt;Sec-WebSocket-Protocol&lt;/a&gt;&lt;/code&gt;
+  header is used in the WebSocket handshake. It is sent from the
+  client to the server and back from the server to the client to
+  confirm the subprotocol of the connection. This enables scripts to
+  both select a subprotocol and be sure that the server agreed to
+  serve that subprotocol.&lt;/p&gt;
 
 
 
 
-  &lt;h5 id=using-the-web-socket-protocol-from-other-specifications&gt;&lt;span class=secno&gt;10.3.4.8 &lt;/span&gt;Using the Web Socket protocol from other specifications&lt;/h5&gt;
+  &lt;h5 id=using-the-websocket-protocol-from-other-specifications&gt;&lt;span class=secno&gt;10.3.4.8 &lt;/span&gt;Using the WebSocket protocol from other specifications&lt;/h5&gt;
 
-  &lt;p&gt;The Web Socket protocol is intended to be used by another
+  &lt;p&gt;The WebSocket protocol is intended to be used by another
   specification to provide a generic mechanism for dynamic
   author-defined content, e.g. in a specification defining a scripted
   API.&lt;/p&gt;
 
-  &lt;p&gt;Such a specification first needs to &quot;&lt;a href=#establish-a-web-socket-connection&gt;establish a Web Socket
+  &lt;p&gt;Such a specification first needs to &quot;&lt;a href=#establish-a-websocket-connection&gt;establish a WebSocket
   connection&lt;/a&gt;&quot;, providing that algorithm with:&lt;/p&gt;
 
   &lt;ul&gt;&lt;li&gt;The destination, consisting of a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and a
@@ -68976,31 +69569,31 @@
    made responsible for the connection. &lt;a href=#refsORIGIN&gt;[ORIGIN]&lt;/a&gt;&lt;/li&gt;
 
    &lt;li&gt;Optionally a string identifying a &lt;span&gt;protocol&lt;/span&gt; that is
-   to be layered over the Web Socket connection.&lt;/li&gt;
+   to be layered over the WebSocket connection.&lt;/li&gt;
 
   &lt;/ul&gt;&lt;p&gt;The &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag
   are usually obtained from a &lt;a href=#url&gt;URL&lt;/a&gt; using the steps to
-  &lt;a href=&quot;#parse-a-web-socket-url's-components&quot;&gt;parse a Web Socket URL's components&lt;/a&gt;. These steps fail
-  if the URL does not specify a Web Socket.&lt;/p&gt;
+  &lt;a href=&quot;#parse-a-websocket-url's-components&quot;&gt;parse a WebSocket URL's components&lt;/a&gt;. These steps fail
+  if the URL does not specify a WebSocket.&lt;/p&gt;
 
   &lt;p&gt;If a connection can be established, then it is said that the
-  &quot;&lt;a href=#web-socket-connection-is-established&gt;Web Socket connection is established&lt;/a&gt;&quot;.&lt;/p&gt;
+  &quot;&lt;a href=#websocket-connection-is-established&gt;WebSocket connection is established&lt;/a&gt;&quot;.&lt;/p&gt;
 
   &lt;p&gt;If at any time the connection is to be closed, then the
-  specification needs to use the &quot;&lt;a href=#close-the-web-socket-connection&gt;close the Web Socket
+  specification needs to use the &quot;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket
   connection&lt;/a&gt;&quot; algorithm.&lt;/p&gt;
 
   &lt;p&gt;When the connection is closed, for any reason including failure
   to establish the connection in the first place, it is said that the
-  &quot;&lt;a href=#web-socket-connection-is-closed&gt;Web Socket connection is closed&lt;/a&gt;&quot;.&lt;/p&gt;
+  &quot;&lt;a href=#websocket-connection-is-closed&gt;WebSocket connection is closed&lt;/a&gt;&quot;.&lt;/p&gt;
 
   &lt;p&gt;While a connection is open, the specification will need to handle
-  the cases when &quot;&lt;span&gt;a Web Socket message has been received&lt;/span&gt;&quot;
+  the cases when &quot;&lt;a href=#a-websocket-message-has-been-received&gt;a WebSocket message has been received&lt;/a&gt;&quot;
   with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;.&lt;/p&gt;
 
   &lt;p&gt;To send some text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; to an open connection,
-  the specification needs to &quot;&lt;a href=#send-data-using-the-web-socket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;
-  using the Web Socket&lt;/a&gt;&quot;.&lt;/p&gt;
+  the specification needs to &quot;&lt;a href=#send-data-using-the-websocket&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;
+  using the WebSocket&lt;/a&gt;&quot;.&lt;/p&gt;
 
 
   
@@ -89106,6 +89699,10 @@
    Names - Concepts and Facilities&lt;/a&gt;&lt;/cite&gt;, P. Mockapetris. IETF,
    November 1987.&lt;/dd&gt;
 
+   &lt;dt id=refsRFC1321&gt;[RFC1321]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc1321.txt">http://www.ietf.org/rfc/rfc1321.txt</A>&gt;The MD5
+   Message-Digest Algorithm&lt;/a&gt;&lt;/cite&gt;, R. Rivest. IETF.&lt;/dd&gt;
+
    &lt;dt id=refsRFC1345&gt;[RFC1345]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.ietf.org/rfc/rfc1345.txt">http://www.ietf.org/rfc/rfc1345.txt</A>&gt;Character Mnemonics
    and Character Sets&lt;/a&gt;&lt;/cite&gt;, K. Simonsen. IETF.&lt;/dd&gt;

Modified: index
===================================================================
--- index	2010-02-25 10:55:53 UTC (rev 4813)
+++ index	2010-03-02 09:01:43 UTC (rev 4814)
@@ -161,7 +161,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG src=/images/logo&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;HTML5 (including next generation additions still in development)&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 25 February 2010&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Draft Standard &mdash; 2 March 2010&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -1195,10 +1195,10 @@
 
   &lt;ul class=brief&gt;&lt;li&gt;&lt;a href=<A HREF="http://www.whatwg.org/specs/web-workers/current-work/">http://www.whatwg.org/specs/web-workers/current-work/</A>&gt;Web Workers&lt;/a&gt;
    &lt;li&gt;&lt;a href=<A HREF="http://dev.w3.org/html5/webstorage/">http://dev.w3.org/html5/webstorage/</A>&gt;Web Storage&lt;/a&gt;
-   &lt;li&gt;&lt;a href=<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&gt;Web Sockets API&lt;/a&gt;
-   &lt;li&gt;&lt;a href=<A HREF="http://www.whatwg.org/specs/web-socket-protocol/">http://www.whatwg.org/specs/web-socket-protocol/</A>&gt;Web Sockets protocol&lt;/a&gt;
+   &lt;li&gt;&lt;a href=<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&gt;WebSocket API&lt;/a&gt;
+   &lt;li&gt;&lt;a href=<A HREF="http://www.whatwg.org/specs/web-socket-protocol/">http://www.whatwg.org/specs/web-socket-protocol/</A>&gt;WebSocket protocol&lt;/a&gt;
 &lt;!--
-   &lt;li&gt;&lt;a href=&quot;<A HREF="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol">http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol</A>&quot;&gt;Web Sockets protocol&lt;/a&gt;
+   &lt;li&gt;&lt;a href=&quot;<A HREF="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol">http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol</A>&quot;&gt;WebSocket protocol&lt;/a&gt;
 --&gt;
    &lt;li&gt;&lt;a href=<A HREF="http://dev.w3.org/html5/eventsource/">http://dev.w3.org/html5/eventsource/</A>&gt;Server-sent Events&lt;/a&gt;
    &lt;li&gt;&lt;a href=<A HREF="http://dev.w3.org/html5/webdatabase/">http://dev.w3.org/html5/webdatabase/</A>&gt;Web SQL Database&lt;/a&gt;
@@ -38353,16 +38353,16 @@
    character not followed by a U+000A LINE FEED (LF) character, and
    every occurrence of a U+000A LINE FEED (LF) character not preceded
    by a U+000D CARRIAGE RETURN (CR) character, by a two-character
-   string consisting of a U+000D CARRIAGE RETURN - U+000A LINE FEED
+   string consisting of a U+000D CARRIAGE RETURN U+000A LINE FEED
    (CRLF) character pair.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the element's &lt;code title=attr-textarea-wrap&gt;&lt;a href=#attr-textarea-wrap&gt;wrap&lt;/a&gt;&lt;/code&gt; attribute is in the &lt;a href=#attr-textarea-wrap-hard-state title=attr-textarea-wrap-hard-state&gt;Hard&lt;/a&gt; state, insert
-   U+000D CARRIAGE RETURN - U+000A LINE FEED (CRLF) character pairs
+   U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF) character pairs
    into the string using a UA-defined algorithm so that each line has
    no more than &lt;a href=#attr-textarea-cols-value title=attr-textarea-cols-value&gt;character
    width&lt;/a&gt; characters. For the purposes of this requirement,
    lines are delimited by the start of the string, the end of the
-   string, and U+000D CARRIAGE RETURN - U+000A LINE FEED (CRLF)
+   string, and U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF)
    character pairs.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;/div&gt;
@@ -55557,7 +55557,7 @@
    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;var title=concept-document-salvageable&gt;salvageable&lt;/var&gt; state to
    false. &lt;a href=#refsWEBSQL&gt;[WEBSQL]&lt;/a&gt; &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Close the Web Socket connection&lt;/span&gt; of any
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Close the WebSocket connection&lt;/span&gt; of any
    &lt;code&gt;WebSocket&lt;/code&gt; objects that were created by the &lt;code title=dom-WebSocket&gt;WebSocket()&lt;/code&gt; constructor visible on the
    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object. If this
    affected any &lt;code&gt;WebSocket&lt;/code&gt; objects, the set
@@ -83792,10 +83792,10 @@
 
    &lt;dt id=refsWEBSOCKET&gt;[WEBSOCKET]&lt;/dt&gt;
    &lt;!--
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</A>&quot;&gt;The Web Sockets
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</A>&quot;&gt;The WebSocket
    API&lt;/a&gt;&lt;/cite&gt;, I. Hickson. W3C.&lt;/dd&gt;
    --&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&gt;The Web Sockets
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&gt;The WebSocket
    API&lt;/a&gt;&lt;/cite&gt;, I. Hickson. W3C.&lt;/dd&gt;
 
    &lt;dt id=refsWEBSQL&gt;[WEBSQL]&lt;/dt&gt;

Modified: source
===================================================================
--- source	2010-02-25 10:55:53 UTC (rev 4813)
+++ source	2010-03-02 09:01:43 UTC (rev 4814)
@@ -71,10 +71,10 @@
   &lt;ul class=&quot;brief&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;<A HREF="http://www.whatwg.org/specs/web-workers/current-work/">http://www.whatwg.org/specs/web-workers/current-work/</A>&quot;&gt;Web Workers&lt;/a&gt;
    &lt;li&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/webstorage/">http://dev.w3.org/html5/webstorage/</A>&quot;&gt;Web Storage&lt;/a&gt;
-   &lt;li&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&quot;&gt;Web Sockets API&lt;/a&gt;
-   &lt;li&gt;&lt;a href=&quot;<A HREF="http://www.whatwg.org/specs/web-socket-protocol/">http://www.whatwg.org/specs/web-socket-protocol/</A>&quot;&gt;Web Sockets protocol&lt;/a&gt;
+   &lt;li&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&quot;&gt;WebSocket API&lt;/a&gt;
+   &lt;li&gt;&lt;a href=&quot;<A HREF="http://www.whatwg.org/specs/web-socket-protocol/">http://www.whatwg.org/specs/web-socket-protocol/</A>&quot;&gt;WebSocket protocol&lt;/a&gt;
 &lt;!--
-   &lt;li&gt;&lt;a href=&quot;<A HREF="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol">http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol</A>&quot;&gt;Web Sockets protocol&lt;/a&gt;
+   &lt;li&gt;&lt;a href=&quot;<A HREF="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol">http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol</A>&quot;&gt;WebSocket protocol&lt;/a&gt;
 --&gt;
    &lt;li&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/eventsource/">http://dev.w3.org/html5/eventsource/</A>&quot;&gt;Server-sent Events&lt;/a&gt;
    &lt;li&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/webdatabase/">http://dev.w3.org/html5/webdatabase/</A>&quot;&gt;Web SQL Database&lt;/a&gt;
@@ -42805,18 +42805,18 @@
    character not followed by a U+000A LINE FEED (LF) character, and
    every occurrence of a U+000A LINE FEED (LF) character not preceded
    by a U+000D CARRIAGE RETURN (CR) character, by a two-character
-   string consisting of a U+000D CARRIAGE RETURN - U+000A LINE FEED
+   string consisting of a U+000D CARRIAGE RETURN U+000A LINE FEED
    (CRLF) character pair.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the element's &lt;code
    title=&quot;attr-textarea-wrap&quot;&gt;wrap&lt;/code&gt; attribute is in the &lt;span
    title=&quot;attr-textarea-wrap-hard-state&quot;&gt;Hard&lt;/span&gt; state, insert
-   U+000D CARRIAGE RETURN - U+000A LINE FEED (CRLF) character pairs
+   U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF) character pairs
    into the string using a UA-defined algorithm so that each line has
    no more than &lt;span title=&quot;attr-textarea-cols-value&quot;&gt;character
    width&lt;/span&gt; characters. For the purposes of this requirement,
    lines are delimited by the start of the string, the end of the
-   string, and U+000D CARRIAGE RETURN - U+000A LINE FEED (CRLF)
+   string, and U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF)
    character pairs.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
@@ -62761,7 +62761,7 @@
    title=&quot;concept-document-salvageable&quot;&gt;salvageable&lt;/var&gt; state to
    false. &lt;a href=&quot;#refsWEBSQL&quot;&gt;[WEBSQL]&lt;/a&gt; &lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Close the Web Socket connection&lt;/span&gt; of any
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Close the WebSocket connection&lt;/span&gt; of any
    &lt;code&gt;WebSocket&lt;/code&gt; objects that were created by the &lt;code
    title=&quot;dom-WebSocket&quot;&gt;WebSocket()&lt;/code&gt; constructor visible on the
    &lt;code&gt;Document&lt;/code&gt;'s &lt;code&gt;Window&lt;/code&gt; object. If this
@@ -75263,7 +75263,7 @@
    &lt;!-- beware, this is very similar to the steps for what happens
    during a redirect, in the protocol section --&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a Web Socket URL's components&lt;/span&gt; from the
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from the
    &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain &lt;var
    title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
    title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;. If
@@ -75295,18 +75295,18 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;span&gt;Establish a Web Socket connection&lt;/span&gt; to a host &lt;var
+    &lt;p&gt;&lt;span&gt;Establish a WebSocket connection&lt;/span&gt; to a host &lt;var
     title=&quot;&quot;&gt;host&lt;/var&gt;, on port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; (if one was
     specified), from &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, with the flag &lt;var
     title=&quot;&quot;&gt;secure&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as
     the resource name, and with &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; as the
     protocol (if it is present).&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;If the &quot;&lt;span&gt;establish a Web Socket
+    &lt;p class=&quot;note&quot;&gt;If the &quot;&lt;span&gt;establish a WebSocket
     connection&lt;/span&gt;&quot; algorithm fails, it triggers the &quot;&lt;span&gt;fail
-    the Web Socket connection&lt;/span&gt;&quot; algorithm, which then invokes
-    the &quot;&lt;span&gt;close the Web Socket connection&lt;/span&gt;&quot; algorithm,
-    which then establishes that the &quot;&lt;span&gt;Web Socket connection is
+    the WebSocket connection&lt;/span&gt;&quot; algorithm, which then invokes
+    the &quot;&lt;span&gt;close the WebSocket connection&lt;/span&gt;&quot; algorithm,
+    which then establishes that the &quot;&lt;span&gt;WebSocket connection is
     closed&lt;/span&gt;&quot;, which fires the &lt;code
     title=&quot;event-close&quot;&gt;close&lt;/code&gt; event &lt;a
     href=&quot;#closeWebSocket&quot;&gt;as described below&lt;/a&gt;.&lt;/p&gt;
@@ -75340,7 +75340,7 @@
 
    &lt;dt&gt;&lt;dfn title=&quot;dom-WebSocket-OPEN&quot;&gt;&lt;code&gt;OPEN&lt;/code&gt;&lt;/dfn&gt; (numeric value 1)&lt;/dt&gt;
 
-   &lt;dd&gt;The &lt;span&gt;Web Socket connection is established&lt;/span&gt; and communication is possible.&lt;/dd&gt;
+   &lt;dd&gt;The &lt;span&gt;WebSocket connection is established&lt;/span&gt; and communication is possible.&lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn title=&quot;dom-WebSocket-CLOSED&quot;&gt;&lt;code&gt;CLOSED&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)&lt;/dt&gt;
 
@@ -75361,17 +75361,17 @@
   title=&quot;&quot;&gt;data&lt;/var&gt; argument has any unpaired surrogates, then it
   must raise &lt;code&gt;SYNTAX_ERR&lt;/code&gt;. If the connection is
   established, and the string has no unpaired surrogates, then the
-  user agent must &lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the Web
-  Socket&lt;/span&gt;. If the data cannot be sent, e.g. because it would
+  user agent must &lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the
+  WebSocket&lt;/span&gt;. If the data cannot be sent, e.g. because it would
   need to be buffered but the buffer is full, the user agent must
-  &lt;span&gt;close the Web Socket connection&lt;/span&gt;. The method must then
+  &lt;span&gt;close the WebSocket connection&lt;/span&gt;. The method must then
   return true if the connection is still established (and the data was
   queued or sent successfully), or false if the connection is closed
   (e.g. because the user agent just had a buffer overflow and failed
   to send the data).&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn title=&quot;dom-WebSocket-close&quot;&gt;&lt;code&gt;close()&lt;/code&gt;&lt;/dfn&gt;
-  method must &lt;span&gt;close the Web Socket connection&lt;/span&gt; or
+  method must &lt;span&gt;close the WebSocket connection&lt;/span&gt; or
   connection attempt, if any, and change the &lt;code
   title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's value
   to &lt;code title=&quot;dom-WebSocket-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (2). If the
@@ -75437,7 +75437,7 @@
 
   &lt;h4&gt;Feedback from the protocol&lt;/h4&gt;
 
-  &lt;p&gt;When the &lt;i&gt;Web Socket connection is established&lt;/i&gt;, the user
+  &lt;p&gt;When the &lt;i&gt;WebSocket connection is established&lt;/i&gt;, the user
   agent must &lt;span&gt;queue a task&lt;/span&gt; to first change the &lt;code
   title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's value
   to &lt;code title=&quot;dom-WebSocket-OPEN&quot;&gt;OPEN&lt;/code&gt; (1), and then
@@ -75445,7 +75445,7 @@
   title=&quot;event-open&quot;&gt;open&lt;/code&gt; at the &lt;code&gt;WebSocket&lt;/code&gt;
   object.&lt;/p&gt;
 
-  &lt;p&gt;When &lt;i&gt;a Web Socket message has been received&lt;/i&gt; with text &lt;var
+  &lt;p&gt;When &lt;i&gt;a WebSocket message has been received&lt;/i&gt; with text &lt;var
   title=&quot;&quot;&gt;data&lt;/var&gt;, the user agent must create an event that uses
   the &lt;code&gt;MessageEvent&lt;/code&gt; interface, with the event name &lt;code
   title=&quot;event-message&quot;&gt;message&lt;/code&gt;, which does not bubble, is not
@@ -75457,7 +75457,7 @@
   (1), and if so, dispatch the event at the &lt;code&gt;WebSocket&lt;/code&gt;
   object.&lt;/p&gt;
 
-  &lt;p id=&quot;closeWebSocket&quot;&gt;When the &lt;i&gt;Web Socket connection is
+  &lt;p id=&quot;closeWebSocket&quot;&gt;When the &lt;i&gt;WebSocket connection is
   closed&lt;/i&gt;, the user agent must &lt;span&gt;queue a task&lt;/span&gt; to first
   change the &lt;code title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt;
   attribute's value to &lt;code
@@ -75472,7 +75472,7 @@
 
   &lt;p&gt;The &lt;span&gt;task source&lt;/span&gt; for all &lt;span
   title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; &lt;span title=&quot;queue a
-  task&quot;&gt;queued&lt;/span&gt; in this section is the &lt;dfn&gt;Web Socket task
+  task&quot;&gt;queued&lt;/span&gt; in this section is the &lt;dfn&gt;WebSocket task
   source&lt;/dfn&gt;.&lt;/p&gt;
 
 
@@ -75483,15 +75483,14 @@
   &lt;code title=&quot;event-message&quot;&gt;message&lt;/code&gt; events.&lt;/p&gt;
 
   &lt;p&gt;If a &lt;code&gt;WebSocket&lt;/code&gt; object is garbage collected while its
-  connection is still open, the user agent must &lt;span&gt;close the Web
-  Socket connection&lt;/span&gt;.&lt;/p&gt;
+  connection is still open, the user agent must &lt;span&gt;close the WebSocket connection&lt;/span&gt;.&lt;/p&gt;
 
 
   &lt;!--END websocket-api--&gt;
 
   &lt;!--START websocket-protocol--&gt;
 
-  &lt;h4 id=&quot;websocket-protocol&quot; title=&quot;The Web Socket protocol enables
+  &lt;h4 id=&quot;websocket-protocol&quot; title=&quot;The WebSocket protocol enables
   two-way communication between a user agent running untrusted code
   running in a controlled environment to a remote host that has
   opted-in to communications from that code. The security model used
@@ -75501,7 +75500,7 @@
   is to provide a mechanism for browser-based applications that need
   two-way communication with servers that does not rely on opening
   multiple HTTP connections (e.g. using XMLHttpRequest or
-  &lt;iframe&gt;s and long polling).&quot;&gt;The Web Socket protocol&lt;/h4&gt;
+  &lt;iframe&gt;s and long polling).&quot;&gt;The WebSocket protocol&lt;/h4&gt;
 
 
   &lt;h5&gt;Introduction&lt;/h5&gt;
@@ -75533,8 +75532,8 @@
   &lt;/ul&gt;
 
   &lt;p&gt;A simpler solution would be to use a single TCP connection for
-  traffic in both directions. This is what the Web Socket protocol
-  provides. Combined with the Web Socket API, it provides an
+  traffic in both directions. This is what the WebSocket protocol
+  provides. Combined with the WebSocket API, it provides an
   alternative to HTTP polling for two-way communication from a Web
   page to a remote server.
   &lt;!--END complete--&gt;
@@ -75559,25 +75558,35 @@
   &lt;p&gt;The handshake from the client looks as follows:&lt;/p&gt;
 
   &lt;pre&gt;GET /demo HTTP/1.1
+Host: example.com
+Connection: Upgrade
+Sec-WebSocket-Key2: 12998 5 Y3 1  .P00
+Sec-WebSocket-Protocol: sample
 Upgrade: WebSocket
-Connection: Upgrade
-Host: example.com
+Sec-WebSocket-Key1: 4 @1  46546xW%0l 1 5
 Origin: <A HREF="http://example.com">http://example.com</A>
-WebSocket-Protocol: sample&lt;/pre&gt;
 
+^n:ds[4U&lt;/pre&gt;
+
   &lt;p&gt;The handshake from the server looks as follows:&lt;/p&gt;
 
-  &lt;pre&gt;HTTP/1.1 101 Web Socket Protocol Handshake
+  &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake
 Upgrade: WebSocket
 Connection: Upgrade
-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
-WebSocket-Location: <A HREF="ws://example.com/demo">ws://example.com/demo</A>
-WebSocket-Protocol: sample&lt;/pre&gt;
+Sec-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
+Sec-WebSocket-Location: <A HREF="ws://example.com/demo">ws://example.com/demo</A>
+Sec-WebSocket-Protocol: sample
 
-  &lt;p&gt;The first three lines in each case are hard-coded (the exact case
-  and order matters); the remainder are an unordered &lt;span&gt;ASCII
-  case-insensitive&lt;/span&gt; set of fields, one per line, that match the
-  following non-normative ABNF:
+8jKS'y:G*Co,Wxa-&lt;/pre&gt;
+
+  &lt;p&gt;The leading line from the client follows the Request-Line
+  format. The leading line from the server follows the Status-Line
+  format. The Request-Line and Status-Line productions are defined in
+  the HTTP specification.&lt;/p&gt;
+
+  &lt;p&gt;After the leading line in both cases come an unordered
+  &lt;span&gt;ASCII case-insensitive&lt;/span&gt; set of fields, one per line,
+  that each match the following non-normative ABNF:
 &lt;!--END complete--&gt;
   &lt;a href=&quot;#refsRFC5234&quot;&gt;[RFC5234]&lt;/a&gt;
 &lt;!--START complete--&gt;&lt;!--END websocket-protocol--&gt;
@@ -75595,12 +75604,21 @@
 any-char      = %x0000-0009 / %x000B-000C / %x000E-10FFFF
                 ; a Unicode character other than U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR)&lt;/pre&gt;
 
+  &lt;p class=&quot;note&quot;&gt;The character set for the above ABNF is Unicode. The
+  fields themselves are encoded as UTF-8.&lt;/p&gt;
+
   &lt;p&gt;Lines that don't match the above production cause the connection
   to be aborted.&lt;/p&gt;
 
-  &lt;p class=&quot;note&quot;&gt;The character set for the above ABNF is Unicode. The
-  headers themselves are encoded as UTF-8.&lt;/p&gt;
+  &lt;p&gt;Finally, after the last field, the client sends 10 bytes
+  starting with 0x0D 0x0A and followed by 8 random bytes, part of a
+  challenge, and the server sends 18 bytes starting with 0x0D 0x0A and
+  followed by 16 bytes consisting of a challenge response. The details
+  of this challenge and other parts of the handshake are described in
+  the next section.&lt;/p&gt;
 
+  &lt;hr&gt;
+
   &lt;p&gt;Once the client and server have both sent their handshakes, and
   if the handshake was successful, then the data transfer part
   starts. This is a two-way communication channel where each side can,
@@ -75610,12 +75628,14 @@
   with a 0x00 byte and ends with a 0xFF byte, with the UTF-8 text in
   between.&lt;/p&gt;
 
-  &lt;p&gt;The Web Socket protocol uses this framing so that specifications
-  that use the Web Socket protocol can expose such connections using
+  &lt;p&gt;The WebSocket protocol uses this framing so that specifications
+  that use the WebSocket protocol can expose such connections using
   an event-based mechanism instead of requiring users of those
   specifications to implement buffering and piecing together of
   messages manually.&lt;/p&gt;
 
+  &lt;!-- XXX Close Handshake --&gt;
+
   &lt;p&gt;The protocol is designed to support other frame types in
   future. Instead of the 0x00 byte, other bytes might in future be
   defined. Frames denoted by bytes that do not have the high bit set
@@ -75638,6 +75658,7 @@
 &lt;!--START websocket-protocol--&gt;
   &lt;/p&gt;
 
+  &lt;!-- XXX Close Handshake --&gt;
   &lt;pre&gt;; the wire protocol as allowed by this specification
 frames        = *frame
 frame         = text-frame
@@ -75656,6 +75677,11 @@
   &lt;p class=&quot;note&quot;&gt;The above ABNF is intended for a binary octet
   environment.&lt;/p&gt;
 
+  &lt;!-- XXX Close Handshake --&gt;
+  &lt;p class=&quot;warning&quot;&gt;At this time, the WebSocket protocol cannot be
+  used to send binary data. Using any of the frame types other than
+  0x00 is invalid.&lt;/p&gt;
+
   &lt;hr&gt;
 
   &lt;p&gt;The following diagrams summarise the protocol:&lt;/p&gt;
@@ -75670,41 +75696,211 @@
    `-- (0x80 to 0xFF) --&gt; Length --&gt; Data... -------&gt;-'&lt;/pre&gt;
 
 
+
+
+  &lt;h6&gt;Handshake&lt;/h6&gt;
+
+  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
+
+  &lt;p&gt;The handshake is intended to be compatible with HTTP-based
+  server-side software, so that a single port can be used by both HTTP
+  clients talking to that server and WebSocket clients talking to that
+  server. To this end, the WebSocket client's handshake appears to
+  HTTP servers to be a regular GET request with an Upgrade offer:&lt;/p&gt;
+
+  &lt;pre&gt;GET /resource HTTP/1.1
+Upgrade: WebSocket
+Connection: Upgrade&lt;/pre&gt;
+
+  &lt;p&gt;Additional fields are used to select options in the WebSocket
+  protocol. The only option available in this version is the
+  subprotocol selector, &lt;code
+  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;:&lt;/p&gt;
+
+  &lt;pre&gt;Sec-WebSocket-Protocol: chat&lt;/pre&gt;
+
+  &lt;p&gt;This field indicates the subprotocol (the application-level
+  protocol layered over the WebSocket protocol) that the client
+  intends to use. The server echoes this field in its handshake to
+  indicate that it supports that subprotocol.&lt;/p&gt;
+
+  &lt;p&gt;The remainder of the handshake is all security-related. First,
+  the &lt;code title=&quot;http-host&quot;&gt;Host&lt;/code&gt; field is used to protect
+  against DNS rebinding attacks and to allow multiple domains to be
+  served from one IP address.&lt;/p&gt;
+
+  &lt;pre&gt;Host: example.com&lt;/pre&gt;
+
+  &lt;p&gt;The server includes the hostname in the &lt;code
+  title=&quot;http-sec-websocket-location&quot;&gt;Sec-WebSocket-Location&lt;/code&gt;
+  field of its handshake, so that both the client and the server can
+  verify that they agree on which host is in use.&lt;/p&gt;
+
+  &lt;p&gt;Second, the &lt;code title=&quot;http-origin&quot;&gt;Origin&lt;/code&gt; field is
+  used to protect against unauthorized cross-origin use of a WebSocket
+  server by scripts using the &lt;code&gt;WebSocket&lt;/code&gt; API in a Web
+  browser. The server specifies which origin it is willing to receive
+  requests from by including a &lt;code
+  title=&quot;http-sec-websocket-origin&quot;&gt;Sec-WebSocket-Origin&lt;/code&gt; field
+  with that origin. If multiple origins are authorized, the server
+  echoes the value in the &lt;code title=&quot;http-origin&quot;&gt;Origin&lt;/code&gt;
+  field of the client's handshake.&lt;/p&gt;
+
+  &lt;pre&gt;Origin: <A HREF="http://example.com&lt;/pre">http://example.com&lt;/pre</A>&gt;
+
+  &lt;p&gt;Finally, the server has to prove to the client that it received
+  the client's WebSocket handshake, so that the server doesn't accept
+  connections that are not WebSocket connections. This prevents an
+  attacker from tricking a WebSocket server by sending it
+  carefully-crafted packets using &lt;code&gt;XMLHttpRequest&lt;/code&gt; or a
+  &lt;code&gt;form&lt;/code&gt; submission.&lt;/p&gt;
+
+  &lt;p&gt;To prove that the handshake was received, the server has to take
+  three pieces of information and combine them to form a response. The
+  first two pieces of information come from the &lt;code
+  title=&quot;http-sec-websocket-key&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt; and &lt;code
+  title=&quot;http-sec-websocket-key&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt; fields in
+  the client handshake:&lt;/p&gt;
+
+  &lt;pre&gt;Sec-WebSocket-Key1: 18x 6]8vM;54 *(5:  {   U1]8  z [  8
+Sec-WebSocket-Key2: 1_ tx7X d  &lt;  nw  334J702) 7]o}` 0&lt;/pre&gt;
+
+  &lt;p&gt;For each of these fields, the server has to take the digits from
+  the value to obtain a number (in this case 1868545188 and 1733470270
+  respectively), then divide that number by the number of spaces
+  characters in the value (in this case 12 and 10) to obtain a 32-bit
+  number (155712099 and 173347027). These two resulting numbers are
+  then used in the server handshake, as described below.&lt;/p&gt;
+
+  &lt;p&gt;The counting of spaces is intended to make it impossible to
+  smuggle this field into the resource name; making this even harder
+  is the presence of &lt;em&gt;two&lt;/em&gt; such fields, and the use of a
+  newline as the only reliable indicator that the end of the key has
+  been reached. The use of random characters interspersed with the
+  spaces and the numbers ensures that the implementor actually looks
+  for spaces and newlines, instead of being treating any character
+  like a space, which would make it again easy to smuggle the fields
+  into the path and trick the server. Finally, &lt;em&gt;dividing&lt;/em&gt; by
+  this number of spaces is intended to make sure that even the most
+  na&iuml;ve of implementations will check for spaces, since if ther
+  server does not verify that there are some spaces, the server will
+  try to divide by zero, which is usually fatal (a correct handshake
+  will always have at least one space).
+
+  &lt;p&gt;The third piece of information is given after the fields, in the
+  last eight bytes of the handshake, expressed here as they would be
+  seen if interpreted as ASCII:&lt;/p&gt;
+
+  &lt;pre&gt;Tm[K T2u&lt;/pre&gt;
+
+  &lt;p&gt;The concatenation of the number obtained from processing the
+  &lt;code title=&quot;http-sec-websocket-key&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt;
+  field, expressed as a little-endian 32 bit number, the number
+  obtained from processing the &lt;code
+  title=&quot;http-sec-websocket-key&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt; field,
+  again expressed as a little-endian 32 bit number, and finally the
+  eight bytes at the end of the handshake, form a 128 bit string whose
+  MD5 sum is then used by the server to prove that it read the
+  handshake.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;The handshake from the server is much simpler than the client
+  handshake. The first line is an HTTP Status-Line, with the status
+  code 101 (the HTTP version and reason phrase aren't important):&lt;/p&gt;
+
+  &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake&lt;/pre&gt;
+
+  &lt;p&gt;The fields follow. Two of the fields are just for compatibility
+  with HTTP:&lt;/p&gt;
+
+  &lt;pre&gt;Upgrade: WebSocket
+Connection: Upgrade&lt;/pre&gt;
+
+  &lt;p&gt;Two of the fields are part of the security model described
+  above, echoing the origin and stating the exact host, port, resource
+  name, and whether the connection is expected to be encrypted:&lt;/p&gt;
+
+  &lt;pre&gt;Sec-WebSocket-Origin: <A HREF="http://example.com">http://example.com</A>
+Sec-WebSocket-Location: <A HREF="ws://example.com/demo&lt;/pre">ws://example.com/demo&lt;/pre</A>&gt;
+
+  &lt;p&gt;These fields are checked by the Web browser when it is acting as
+  a &lt;code&gt;WebSocket&lt;/code&gt; client for scripted pages. A server that
+  only handles one origin and only serves one resource can therefore
+  just return hard-coded values and does not need to parse the
+  client's handshake to verify the correctness of the values.&lt;/p&gt;
+
+  &lt;p&gt;Option fields can also be included. In this version of the
+  protocol, the only option field is &lt;code
+  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;,
+  which indicates the subprotocol that the server speaks. Web browsers
+  verify that the server included the same value as was specified in
+  the &lt;code&gt;WebSocket&lt;/code&gt; constructor, so a server that speaks
+  multiple subprotocols has to make sure it selects one based on the
+  client's handshake and specifies the right one in its handshake.&lt;/p&gt;
+
+  &lt;pre&gt;Sec-WebSocket-Protocol: chat&lt;/pre&gt;
+
+  &lt;p&gt;After the fields, the server sends the aforementioned MD5 sum, a
+  16 byte (128 bit) value, shown here as if interpreted as ASCII:&lt;/p&gt;
+
+  &lt;pre&gt;fQJ,fN/4F4!~K~MH&lt;/pre&gt;
+
+  &lt;p&gt;This value depends on what the client sends, as described
+  above. If it doesn't match what the client is expecting, the client
+  would disconnect.&lt;/p&gt;
+
+  &lt;p&gt;Having part of the handshake appear after the fields ensures
+  that both the server and the client verify that the connection is
+  not being interrupted by an HTTP intermediary such as a
+  man-in-the-middle cache or proxy.&lt;/p&gt;
+
+
+
   &lt;h6&gt;Design philosophy&lt;/h6&gt;
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
-  &lt;p&gt;The Web Socket protocol is designed on the principle that there
+  &lt;p&gt;The WebSocket protocol is designed on the principle that there
   should be minimal framing (the only framing that exists is to make
   the protocol frame-based instead of stream-based, and to support a
   distinction between Unicode text and binary frames). It is expected
-  that metadata would be layered on top of Web Socket by the
+  that metadata would be layered on top of WebSocket by the
   application layer, in the same way that metadata is layered on top
-  of TCP/IP by the application layer (HTTP).&lt;/p&gt;
+  of TCP by the application layer (HTTP).&lt;/p&gt;
 
-  &lt;p&gt;Conceptually, Web Socket is really just a layer on top of TCP/IP
+  &lt;p&gt;Conceptually, WebSocket is really just a layer on top of TCP
   that adds a Web &quot;origin&quot;-based security model for browsers; adds an
   addressing and protocol naming mechanism to support multiple
   services on one port and multiple host names on one IP address; and
   layers a framing mechanism on top of TCP to get back to the IP
   packet mechanism that TCP is built on, but without length
-  limits. Other than that, it adds nothing. Basically it is intended
-  to be as close to just exposing raw TCP/IP to script as possible
+  limits.
+
+  &lt;!-- XXX Close Handshake --&gt;
+
+  Other than that, it adds nothing. Basically it is intended
+  to be as close to just exposing raw TCP to script as possible
   given the constraints of the Web. It's also designed in such a way
   that its servers can share a port with HTTP servers, by having its
   handshake be a valid HTTP Upgrade handshake also.&lt;/p&gt;
 
+  &lt;p&gt;The protocol is intended to be extensible; future versions will
+  likely introduce a mechanism to compress data and might support
+  sending binary data.&lt;/p&gt;
 
+
   &lt;h6&gt;Security model&lt;/h6&gt;
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
-  &lt;p&gt;The Web Socket protocol uses the origin model used by Web
-  browsers to restrict which Web pages can contact a Web Socket server
-  when the Web Socket protocol is used from a Web page. Naturally,
-  when the Web Socket protocol is used directly (not from a Web page),
-  the origin model is not useful, as the client can provide any
-  arbitrary origin string.&lt;/p&gt;
+  &lt;p&gt;The WebSocket protocol uses the origin model used by Web
+  browsers to restrict which Web pages can contact a WebSocket server
+  when the WebSocket protocol is used from a Web page. Naturally,
+  when the WebSocket protocol is used by a dedicated client directly
+  (i.e. not from a Web page through a Web browser), the origin model
+  is not useful, as the client can provide any arbitrary origin
+  string.&lt;/p&gt;
 
   &lt;p&gt;This protocol is intended to fail to establish a connection with
   servers of pre-existing protocols like SMTP or HTTP, while allowing
@@ -75714,18 +75910,28 @@
   the handshake is finished (thus limiting how much the server can be
   influenced).&lt;/p&gt;
 
+  &lt;p&gt;It is similarly intended to fail to establish a connection when
+  data from other protocols, especially HTTP, is sent to a WebSocket
+  server, for example as might happen if an HTML &lt;code&gt;form&lt;/code&gt;
+  were submitted to a WebSocket server. This is primarily achieved by
+  requiring that the server prove that it read the handshake, which it
+  can only do if the handshake contains the appropriate parts which
+  themselves can only be sent by a WebSocket handshake; in
+  particular, fields starting with &lt;code title=&quot;&quot;&gt;Sec-&lt;/code&gt; cannot
+  be set by an attacker from a Web browser, even when using
+  &lt;code&gt;XMLHttpRequest&lt;/code&gt;.&lt;/p&gt;
 
-  &lt;h6&gt;Relationship to TCP/IP and HTTP&lt;/h6&gt;
 
+  &lt;h6&gt;Relationship to TCP and HTTP&lt;/h6&gt;
+
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
-  &lt;p&gt;The Web Socket protocol is an independent TCP-based protocol. Its
+  &lt;p&gt;The WebSocket protocol is an independent TCP-based protocol. Its
   only relationship to HTTP is that its handshake is interpreted by
   HTTP servers as an Upgrade request.&lt;/p&gt;
 
   &lt;p&gt;Based on the expert recommendation of the IANA&lt;!-- [IANA #257455]
-  --&gt;, the Web Socket protocol by default uses port 80 for regular Web
-  Socket connections and port 443 for Web Socket connections tunneled
+  --&gt;, the WebSocket protocol by default uses port 80 for regular WebSocket connections and port 443 for WebSocket connections tunneled
   over TLS.&lt;/p&gt;
 
 
@@ -75733,15 +75939,16 @@
 
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
-  &lt;p&gt;There are several options for establishing a Web Socket connection.&lt;/p&gt;
+  &lt;p&gt;There are several options for establishing a WebSocket connection.&lt;/p&gt;
 
   &lt;p&gt;On the face of it, the simplest method would seem to be to use
-  port 80 to get a direct connection to a Web Socket server. Port 80
-  traffic, however, will often be intercepted by HTTP proxies, which
-  can lead to the connection failing to be established.&lt;/p&gt;
+  port 80 to get a direct connection to a WebSocket server. Port 80
+  traffic, however, will often be intercepted by man-in-the-middle
+  HTTP proxies, which can lead to the connection failing to be
+  established.&lt;/p&gt;
 
   &lt;p&gt;The most reliable method, therefore, is to use TLS encryption and
-  port 443 to connect directly to a Web Socket server. This has the
+  port 443 to connect directly to a WebSocket server. This has the
   advantage of being more secure; however, TLS encryption can be
   computationally expensive.&lt;/p&gt;
 
@@ -75751,95 +75958,27 @@
   to be a regular GET request with an Upgrade offer. In relatively
   simple setups with just one IP address and a single server for all
   traffic to a single hostname, this might allow a practical way for
-  systems based on the Web Socket protocol to be deployed. In more
+  systems based on the WebSocket protocol to be deployed. In more
   elaborate setups (e.g. with load balancers and multiple servers), a
-  dedicated set of hosts for Web Socket connections separate from the
+  dedicated set of hosts for WebSocket connections separate from the
   HTTP servers is probably easier to manage.&lt;/p&gt;
 
 
-  &lt;h6&gt;Writing a simple Web Socket server&lt;/h6&gt;
 
-  &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
+  &lt;h6&gt;Subprotocols using the WebSocket protocol&lt;/h6&gt;
 
-  &lt;p&gt;If the Web Socket protocol is being used to provide a feature for
-  a specific site, then the handshake can be hard-coded, and the data
-  provided by the client in the handshake can be safely ignored. This
-  section describes an implementation strategy for this case.&lt;/p&gt;
-
-  &lt;p&gt;Listen on a port for TCP/IP. Upon receiving a connection request,
-  open a connection and send the following bytes back to the
-  client:&lt;/p&gt;
-
-  &lt;pre&gt;48 54 54 50 2F 31 2E 31  20 31 30 31 20 57 65 62
-20 53 6F 63 6B 65 74 20  50 72 6F 74 6F 63 6F 6C
-20 48 61 6E 64 73 68 61  6B 65 0D 0A 55 70 67 72
-61 64 65 3A 20 57 65 62  53 6F 63 6B 65 74 0D 0A
-43 6F 6E 6E 65 63 74 69  6F 6E 3A 20 55 70 67 72
-61 64 65 0D 0A 57 65 62  53 6F 63 6B 65 74 2D 4F
-72 69 67 69 6E 3A 20&lt;/pre&gt;
-
-  &lt;p&gt;Send the &lt;span title=&quot;ASCII serialization of an origin&quot;&gt;ASCII
-  serialization&lt;/span&gt; of the origin from which the server is willing
-  to accept connections. &lt;a href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;div class=&quot;example&quot;&gt;
-   &lt;p&gt;For example: &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com&lt;/code">http://example.com&lt;/code</A>&gt;&lt;/p&gt;
-  &lt;/div&gt;
-
-  &lt;p&gt;Continue by sending the following bytes back to the client:&lt;/p&gt;
-
-  &lt;pre&gt;0D 0A 57 65 62 53 6F 63  6B 65 74 2D 4C 6F 63 61
-74 69 6F 6E 3A 20&lt;/pre&gt;
-
-  &lt;p&gt;Send the &lt;span&gt;URL&lt;/span&gt; of the Web Socket script.&lt;/p&gt;
-
-  &lt;div class=&quot;example&quot;&gt;
-   &lt;p&gt;For example: &lt;code title=&quot;&quot;&gt;<A HREF="ws://example.com/demo&lt;/code">ws://example.com/demo&lt;/code</A>&gt;&lt;/p&gt;
-  &lt;/div&gt;
-
-  &lt;p&gt;Finish the handshake by sending the four bytes 0x0D 0x0A 0x0D
-  0x0A to the client. Then, read data &lt;em&gt;from&lt;/em&gt; the client until
-  four bytes 0x0D 0x0A 0x0D 0x0A are read.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;User agents will drop the connection after the
-  handshake if the origin and URL sent as part of the algorithm above
-  don't match what the client sent to the server, to protect the
-  server from third-party scripts. This is why the server has to send
-  these strings: to confirm which origins and URLs the server is
-  willing to service.&lt;/p&gt;
-
-  &lt;p&gt;At this point, there are two concerns: receiving frames and
-  sending frames.&lt;/p&gt;
-
-  &lt;p&gt;To receive a frame, read a byte, verify that it is a 0x00 byte,
-  then read bytes until you find a 0xFF byte, and interpret all the
-  bytes between the 0x00 and 0xFF bytes as a UTF-8 string (the frame
-  payload, or message). This process can be repeated as necessary. If
-  at any point the first byte of one of these sequences is not 0x00,
-  then an error has occurred, and closing the connection is the
-  appropriate response.&lt;/p&gt;
-
-  &lt;p&gt;To send a frame, first send a 0x00 byte, then send the message as
-  a UTF-8 string, then send a 0xFF byte. Again, this process can be
-  repeated as necessary.&lt;/p&gt;
-
-  &lt;p&gt;The connection can be closed as desired.&lt;/p&gt;
-
-
-  &lt;h6&gt;Subprotocols using the Web Socket protocol&lt;/h6&gt;
-
   &lt;p&gt;&lt;i&gt;This section is non-normative.&lt;/i&gt;&lt;/p&gt;
 
   &lt;p&gt;The client can request that the server use a specific subprotocol
   by including the &lt;code
-  title=&quot;http-websocket-protocol&quot;&gt;Websocket-Protocol&lt;/code&gt; header in
-  its handshake. If it is specified, the server needs to include the
-  same header and value in its response for the connection to be
-  established.&lt;/p&gt;
+  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-Websocket-Protocol&lt;/code&gt;
+  field in its handshake. If it is specified, the server needs to
+  include the same field and value in its response for the connection
+  to be established.&lt;/p&gt;
 
   &lt;p&gt;These subprotocol names do not need to be registered, but if a
   subprotocol is intended to be implemented by multiple independent
-  Web Socket servers, potential clashes with the names of subprotocols
+  WebSocket servers, potential clashes with the names of subprotocols
   defined independently can be avoided by using names that contain the
   domain name of the subprotocol's originator. For example, if Example
   Corporation were to create a Chat subprotocol to be implemented by
@@ -75853,7 +75992,7 @@
   &lt;p&gt;Subprotocols can be versioned in backwards-incompatible ways by
   changing the subprotocol name, eg. going from &quot;bookings.example.net&quot;
   to &quot;bookings.example.net2&quot;. These subprotocols would be considered
-  completely separate by Web Socket clients. Backwards-compatible
+  completely separate by WebSocket clients. Backwards-compatible
   versioning can be implemented by reusing the same subprotocol string
   but carefully designing the actual subprotocol to support this kind
   of extensibility.&lt;/p&gt;
@@ -75872,6 +76011,13 @@
   LETTER Z) with the corresponding characters in the range U+0061
   to U+007A (i.e. LATIN SMALL LETTER A to LATIN SMALL LETTER Z).&lt;/p&gt;
 
+  &lt;p&gt;Comparing two strings in an &lt;dfn&gt;ASCII case-insensitive&lt;/dfn&gt;
+  manner means comparing them exactly, code point for code point, except
+  that the characters in the range U+0041 to U+005A (i.e. LATIN
+  CAPITAL LETTER A to LATIN CAPITAL LETTER Z) and the corresponding
+  characters in the range U+0061 to U+007A (i.e. LATIN SMALL LETTER A
+  to LATIN SMALL LETTER Z) are considered to also match.&lt;/p&gt;
+
   &lt;p&gt;The term &quot;URL&quot; is used in this section in a manner consistent
   with the terminology used in HTML, namely, to denote a string that
   might or might not be a valid URI or IRI and to which certain error
@@ -75880,16 +76026,16 @@
 &lt;!--START complete--&gt;
 
   &lt;p&gt;When an implementation is required to &lt;i&gt;send&lt;/i&gt; data as part of
-  the Web Socket protocol, the implementation may delay the actual
+  the WebSocket protocol, the implementation may delay the actual
   transmission arbitrarily, e.g. buffering data so as to send fewer IP
   packets.&lt;/p&gt;
 
 
-  &lt;h5&gt;Web Socket URLs&lt;/h5&gt;
+  &lt;h5&gt;WebSocket URLs&lt;/h5&gt;
 
-  &lt;h6&gt;Parsing Web Socket URLs&lt;/h6&gt;
+  &lt;h6&gt;Parsing WebSocket URLs&lt;/h6&gt;
 
-  &lt;p&gt;The steps to &lt;dfn&gt;parse a Web Socket URL's components&lt;/dfn&gt; from
+  &lt;p&gt;The steps to &lt;dfn&gt;parse a WebSocket URL's components&lt;/dfn&gt; from
   a string &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; are as follows. These steps return
   either a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a
   &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
@@ -75971,9 +76117,9 @@
   &lt;/ol&gt;
 
 
-  &lt;h6&gt;Constructing Web Socket URLs&lt;/h6&gt;
+  &lt;h6&gt;Constructing WebSocket URLs&lt;/h6&gt;
 
-  &lt;p&gt;The steps to &lt;dfn&gt;construct a Web Socket URL&lt;/dfn&gt; from a &lt;var
+  &lt;p&gt;The steps to &lt;dfn&gt;construct a WebSocket URL&lt;/dfn&gt; from a &lt;var
   title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a &lt;var
   title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag,
   are as follows:&lt;/p&gt;
@@ -76016,7 +76162,7 @@
 
   &lt;h6&gt;Handshake&lt;/h6&gt;
 
-  &lt;p&gt;When the user agent is to &lt;dfn&gt;establish a Web Socket
+  &lt;p&gt;When the user agent is to &lt;dfn&gt;establish a WebSocket
   connection&lt;/dfn&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on a port &lt;var
   title=&quot;&quot;&gt;port&lt;/var&gt;, from an origin whose &lt;span title=&quot;ASCII
   serialization of an origin&quot;&gt;ASCII serialization&lt;/span&gt; is &lt;var
@@ -76035,20 +76181,19 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the user agent already has a Web Socket connection to the
+    &lt;p&gt;If the user agent already has a WebSocket connection to the
     remote host (IP address) identified by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;,
     even if known by another name, wait until that connection has been
-    &lt;span title=&quot;Web Socket connection is
+    &lt;span title=&quot;WebSocket connection is
     established&quot;&gt;established&lt;/span&gt; or for that connection to have
-    &lt;span title=&quot;fail the Web Socket connection&quot;&gt;failed&lt;/span&gt;.&lt;/p&gt;
+    &lt;span title=&quot;fail the WebSocket connection&quot;&gt;failed&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;This makes it harder for a script to perform a
-    denial of service attack by just opening a large number of Web
-    Socket connections to a remote host.&lt;/p&gt;
+    denial of service attack by just opening a large number of WebSocket connections to a remote host.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;There is no limit to the number of &lt;span
-    title=&quot;Web Socket connection is established&quot;&gt;established&lt;/span&gt;
-    Web Socket connections a user agent can have with a single remote
+    title=&quot;WebSocket connection is established&quot;&gt;established&lt;/span&gt;
+    WebSocket connections a user agent can have with a single remote
     host. Servers can refuse to connect users with an excessive number
     of connections, or disconnect resource-hogging users when
     suffering high load.&lt;/p&gt;
@@ -76058,9 +76203,9 @@
    &lt;li&gt;
 
     &lt;p&gt;&lt;i&gt;Connect&lt;/i&gt;: If the user agent is configured to use a proxy
-    when using the Web Socket protocol to connect to host &lt;var
+    when using the WebSocket protocol to connect to host &lt;var
     title=&quot;&quot;&gt;host&lt;/var&gt; and/or port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then
-    connect to that proxy and ask it to open a TCP/IP connection to
+    connect to that proxy and ask it to open a TCP connection to
     the host given by &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by
     &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
 
@@ -76083,13 +76228,13 @@
     &lt;/div&gt;
 
     &lt;p&gt;Otherwise, if the user agent is not configured to use a proxy,
-    then open a TCP/IP connection to the host given by &lt;var
+    then open a TCP connection to the host given by &lt;var
     title=&quot;&quot;&gt;host&lt;/var&gt; and the port given by &lt;var
     title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;Implementations that do not expose explicit UI for
-    selecting a proxy for Web Socket connections separate from other
-    proxies are encouraged to use a SOCKS proxy for Web Socket
+    selecting a proxy for WebSocket connections separate from other
+    proxies are encouraged to use a SOCKS proxy for WebSocket
     connections, if available, or failing that, to prefer the proxy
     configured for HTTPS connections over the proxy configured for
     HTTP connections.&lt;/p&gt;
@@ -76098,10 +76243,10 @@
     &lt;span&gt;URL&lt;/span&gt; to pass the function must be constructed from
     &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
     title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-    flag using the steps to &lt;span&gt;construct a Web Socket
+    flag using the steps to &lt;span&gt;construct a WebSocket
     URL&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The Web Socket protocol can be identified in proxy
+    &lt;p class=&quot;note&quot;&gt;The WebSocket protocol can be identified in proxy
     autoconfiguration scripts from the scheme (&quot;&lt;code
     title=&quot;&quot;&gt;ws:&lt;/code&gt;&quot; for unencrypted connections and &quot;&lt;code
     title=&quot;&quot;&gt;wss:&lt;/code&gt;&quot; for encrypted connections).&lt;/p&gt;
@@ -76109,13 +76254,13 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the connection could not be opened, then &lt;span&gt;fail the
-   Web Socket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
+   WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is true, perform a TLS handshake
     over the connection. If this fails (e.g. the server's certificate
-    could not be verified), then &lt;span&gt;fail the Web Socket
+    could not be verified), then &lt;span&gt;fail the WebSocket
     connection&lt;/span&gt; and abort these steps. Otherwise, all further
     communication on this channel must run through the encrypted
     tunnel. &lt;a href=&quot;#refsRFC2246&quot;&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
@@ -76127,94 +76272,88 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Send the following bytes to the remote side (the server):&lt;/p&gt;
+    &lt;p&gt;Send the UTF-8 string &quot;GET&quot; followed by a UTF-8-encoded U+0020
+    SPACE character to the remote side (the server).&lt;/p&gt;
 
-    &lt;pre&gt;47 45 54 20&lt;/pre&gt;
-
     &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; value, encoded as
-    ANSI_X3.4-1968 (US-ASCII). &lt;a
-    href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    UTF-8.&lt;/p&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Send another UTF-8-encoded U+0020 SPACE character, followed by
+    the UTF-8 string &quot;HTTP/1.1&quot;, followed by a UTF-8-encoded U+000D
+    CARRIAGE RETURN U+000A LINE FEED character pair (CRLF).&lt;/p&gt;
 
-    &lt;pre&gt;20 48 54 54 50 2F 31 2E  31 0D 0A 55 70 67 72 61
-64 65 3A 20 57 65 62 53  6F 63 6B 65 74 0D 0A 43
-6F 6E 6E 65 63 74 69 6F  6E 3A 20 55 70 67 72 61
-64 65 0D 0A&lt;/pre&gt;
+   &lt;/li&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The string &quot;GET&nbsp;&quot;, the path,
-    &quot;&nbsp;HTTP/1.1&quot;, CRLF, the string &quot;Upgrade:&nbsp;WebSocket&quot;,
-    CRLF, and the string &quot;Connection:&nbsp;Upgrade&quot;, CRLF.&lt;/p&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; be an empty list of strings.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Add the string &quot;Upgrade:&nbsp;WebSocket&quot; to &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;pre&gt;48 6F 73 74 3A 20&lt;/pre&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; value, &lt;span&gt;converted to
-    ASCII lowercase&lt;/span&gt;, and encoded as ANSI_X3.4-1968
-    (US-ASCII). &lt;a href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, and &lt;var
-    title=&quot;&quot;&gt;port&lt;/var&gt; is not 80, or if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is
-    true, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 443, then send an 0x3A
-    byte (ASCII :) followed by the value of &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;,
-    expressed as a base-ten integer, encoded as ANSI_X3.4-1968
-    (US-ASCII). &lt;a href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Add the string &quot;Connection:&nbsp;Upgrade&quot; to &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;pre&gt;0D 0A&lt;/pre&gt;
+   &lt;li&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The string &quot;Host:&nbsp;&quot;, the host, and CRLF.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt; be an empty string.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Append the &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; value, &lt;span&gt;converted to
+    ASCII lowercase&lt;/span&gt;, to &lt;var title=&quot;&quot;&gt;hostport&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;pre&gt;4F 72 69 67 69 6E 3A 20&lt;/pre&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt; value, &lt;span&gt;converted to
-    ASCII lowercase&lt;/span&gt;, encoded as ANSI_X3.4-1968 (US-ASCII). &lt;a
-    href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+   &lt;li&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt; value is a string
-    that was passed to this algorithm.&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, and &lt;var
+    title=&quot;&quot;&gt;port&lt;/var&gt; is not 80, or if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is
+    true, and &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is not 443, then append a
+    U+003A COLON character (:) followed by the value of &lt;var
+    title=&quot;&quot;&gt;port&lt;/var&gt;, expressed as a base-ten integer, to &lt;var
+    title=&quot;&quot;&gt;hostport&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;pre&gt;0D 0A&lt;/pre&gt;
+   &lt;li&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The string &quot;Origin:&nbsp;&quot;, the origin, and CRLF.&lt;/p&gt; &lt;!-- http-origin --&gt;
+    &lt;p&gt;Add the string consisting of the concatenation of the string
+    &quot;Host:&quot;, a U+0020 SPACE character, and &lt;var
+    title=&quot;&quot;&gt;hostport&lt;/var&gt;, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If there is no &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt;, then skip this step.&lt;/p&gt;
+    &lt;p&gt;Add the string consisting of the concatenation of the string
+    &quot;Origin:&quot;, a U+0020 SPACE character, and the &lt;var
+    title=&quot;&quot;&gt;origin&lt;/var&gt; value, &lt;span&gt;converted to ASCII
+    lowercase&lt;/span&gt;, to &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, send the following bytes:&lt;/p&gt;
+   &lt;/li&gt;
 
-    &lt;pre&gt;57 65 62 53 6F 63 6B 65  74 2D 50 72 6F 74 6F 63
-6F 6C 3A 20&lt;/pre&gt;
+   &lt;li&gt;
 
-    &lt;p&gt;Send the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; value, encoded as
-    ANSI_X3.4-1968 (US-ASCII). &lt;a
-    href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;If there is no &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt;, then skip this step.&lt;/p&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Otherwise, add the string consisting of the concatenation of
+    the string &quot;Sec-WebSocket-Protocol:&quot;, a U+0020 SPACE character,
+    and the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; value, to &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;pre&gt;0d 0a&lt;/pre&gt;
-
-    &lt;p class=&quot;note&quot;&gt;The string &quot;WebSocket-Protocol:&nbsp;&quot;, the
-    protocol, and CRLF.&lt;/p&gt;
-
    &lt;/li&gt;
 
    &lt;li&gt;
@@ -76224,8 +76363,9 @@
     accessed over HTTP, if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is false, or
     HTTPS, if it is true, on host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, port &lt;var
     title=&quot;&quot;&gt;port&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as the
-    path (and possibly query parameters), then HTTP headers that would
-    be appropriate for that information should be sent at this point.
+    path (and possibly query parameters), then add to &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt; any HTTP headers that would be appropriate
+    for that information.
 &lt;!--END complete--&gt;
     &lt;a href=&quot;#refsRFC2616&quot;&gt;[RFC2616]&lt;/a&gt;
     &lt;a href=&quot;#refsRFC2109&quot;&gt;[RFC2109]&lt;/a&gt;
@@ -76237,22 +76377,17 @@
     &lt;/p&gt;
 
     &lt;p&gt;This includes &quot;&lt;code&gt;HttpOnly&lt;/code&gt;&quot; cookies (cookies with the
-    http-only-flag set to true); the Web Socket protocol is not
-    considered a non-HTTP API.&lt;/p&gt;
+    http-only-flag set to true); the WebSocket protocol is not
+    considered a non-HTTP API for the purpose of cookie
+    processing.&lt;/p&gt;
 
-    &lt;p&gt;Each header must be on a line of its own (each ending with a
-    CRLF sequence). For the purposes of this step, each header must
-    not be split into multiple lines (despite HTTP otherwise allowing
-    this with continuation lines).&lt;/p&gt;
-
 &lt;!--(v2-ws-auth)
     &lt;div class=&quot;example&quot;&gt;
 
      &lt;p&gt;For example, if the server had a username and password that
      applied to &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/socket&lt;/code">http://example.com/socket&lt;/code</A>&gt;, and
-     the Web Socket was being opened to &lt;code
-     title=&quot;&quot;&gt;<A HREF="ws://example.com/socket&lt;/code">ws://example.com/socket&lt;/code</A>&gt;, it could send
-     them:&lt;/p&gt;
+     the WebSocket was being opened to &lt;code
+     title=&quot;&quot;&gt;<A HREF="ws://example.com/socket&lt;/code">ws://example.com/socket&lt;/code</A>&gt;, it could add them:&lt;/p&gt;
 
      &lt;pre&gt;Authorization: Basic d2FsbGU6ZXZl&lt;/pre&gt;
 
@@ -76263,122 +76398,234 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Send the following bytes:&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a random integer
+    from 1 to 12 inclusive.&lt;/p&gt;
 
-    &lt;pre&gt;0d 0a&lt;/pre&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a random integer
+    from 1 to 12 inclusive.&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;Just a CRLF (a blank line).&lt;/p&gt;
+    &lt;p class=&quot;example&quot;&gt;For example, 5 and 9.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Read bytes from the server until either the connection closes,
-    or a 0x0A byte is read. Let &lt;var title=&quot;&quot;&gt;header&lt;/var&gt; be these
-    bytes, including the 0x0A byte.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be the largest integer
+    not greater than 4,294,967,295 divided by &lt;var
+    title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;header&lt;/var&gt; is not at least two bytes long,
-    or if the last two bytes aren't 0x0D and 0x0A respectively, then
-    &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and abort these
-    steps.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be the largest integer
+    not greater than 4,294,967,295 divided by &lt;var
+    title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p&gt;User agents may apply a timeout to this step, &lt;span title=&quot;fail
-    the Web Socket connection&quot;&gt;failing the Web Socket
-    connection&lt;/span&gt; if the server does not send back data in a
-    suitable time period.&lt;/p&gt;
+    &lt;p class=&quot;example&quot;&gt;Continuing the example, 858,993,459 and 477,218,588.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;header&lt;/var&gt; consists of 44 bytes that exactly
-    match the following, then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i
-    title=&quot;&quot;&gt;normal&lt;/i&gt;.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a random integer
+    from 0 to &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; inclusive.&lt;/p&gt;
 
-    &lt;pre&gt;48 54 54 50 2F 31 2E 31  20 31 30 31 20 57 65 62
-20 53 6F 63 6B 65 74 20  50 72 6F 74 6F 63 6F 6C
-20 48 61 6E 64 73 68 61  6B 65 0D 0A&lt;/pre&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a random integer
+    from 0 to &lt;var title=&quot;&quot;&gt;max&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; inclusive.&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The string
-    &quot;HTTP/1.1&nbsp;101&nbsp;Web&nbsp;Socket&nbsp;Protocol&nbsp;Handshake&quot;
-    followed by a CRLF pair.&lt;/p&gt;
+    &lt;p class=&quot;example&quot;&gt;For example, 777,007,543 and 114,997,259.&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;Note that this means that if a server responds
-    with a Web Socket handshake but with the string &quot;HTTP/1.0&quot; or
-    &quot;HTTP/1.2&quot; at the front, a normal Web Socket connection will not
-    be established.&lt;/p&gt; &lt;!-- we might update this as HTTP is updated,
-    depending on whether it remains compatible or whatnot --&gt;
+   &lt;/li&gt;
 
-    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; be the substring of
-    &lt;var title=&quot;&quot;&gt;header&lt;/var&gt; that starts from the byte after the
-    first 0x20 byte, and ends with the byte before the second 0x20
-    byte. If there are not at least two 0x20 bytes in &lt;var
-    title=&quot;&quot;&gt;header&lt;/var&gt;, then &lt;span&gt;fail the Web Socket
-    connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
+   &lt;li&gt;
 
-&lt;!--(v2-redirect)
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as ANSI_X3.4-1968
-    (US-ASCII), is either &quot;&lt;code title=&quot;&quot;&gt;301&lt;/code&gt;&quot;, &quot;&lt;code
-    title=&quot;&quot;&gt;302&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;303&lt;/code&gt;&quot;, &quot;&lt;code
-    title=&quot;&quot;&gt;307&lt;/code&gt;&quot;, then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i
-    title=&quot;&quot;&gt;redirect&lt;/i&gt;. &lt;a href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
---&gt;
-&lt;!--(v2-ws-auth)
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as ANSI_X3.4-1968
-    (US-ASCII), is &quot;&lt;code title=&quot;&quot;&gt;401&lt;/code&gt;&quot;, then let &lt;var
-    title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;authenticate&lt;/i&gt;. &lt;a
-    href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
---&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be the result of
+    multiplying &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; and &lt;var
+    title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; together.&lt;/p&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as ANSI_X3.4-1968
-    (US-ASCII), is &quot;&lt;code title=&quot;&quot;&gt;407&lt;/code&gt;&quot;, then either close the
-    connection and jump back to step 2, providing appropriate
-    authentication information, or &lt;span&gt;fail the Web Socket
-    connection&lt;/span&gt;. 407 is the code used by HTTP meaning &quot;Proxy
-    Authentication Required&quot;. User agents that support proxy
-    authentication must interpret the response as defined by HTTP
-    (e.g. to find and interpret the &lt;code
-    title=&quot;http-Proxy-Authenticate&quot;&gt;Proxy-Authenticate&lt;/code&gt;
-    header). &lt;a href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be the result of
+    multiplying &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; and &lt;var
+    title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; together.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and
-    abort these steps.&lt;/p&gt;
+    &lt;p class=&quot;example&quot;&gt;Continuing the example, 3,885,037,715 and
+    1,034,975,331.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;, then
-    read 41 bytes from the server.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; be a string consisting
+    of &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed in base ten
+    using the numerals in the range U+0030 DIGIT ZERO (0) to U+0039
+    DIGIT NINE (9).&lt;/p&gt;
 
-    &lt;p&gt;If the connection closes before 41 bytes are received, or if
-    the 41 bytes aren't exactly equal to the following bytes, then
-    &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and abort these
-    steps.&lt;/p&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; be a string consisting
+    of &lt;var title=&quot;&quot;&gt;product&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;, expressed in base ten
+    using the numerals in the range U+0030 DIGIT ZERO (0) to U+0039
+    DIGIT NINE (9).&lt;/p&gt;
 
-    &lt;pre&gt;55 70 67 72 61 64 65 3A  20 57 65 62 53 6F 63 6B
-65 74 0D 0A 43 6F 6E 6E  65 63 74 69 6F 6E 3A 20
-55 70 67 72 61 64 65 0D  0A&lt;/pre&gt;
+    &lt;p class=&quot;example&quot;&gt;Continuing the example, &quot;3885037715&quot; and
+    &quot;1034975331&quot;.&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;The string &quot;Upgrade:&nbsp;WebSocket&quot;, CRLF, the
-    string &quot;Connection:&nbsp;Upgrade&quot;, CRLF.&lt;/p&gt;
+   &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;Insert &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; U+0020 SPACE
+    characters into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; at random
+    positions.&lt;/p&gt;
+
+    &lt;p&gt;Insert &lt;var title=&quot;&quot;&gt;spaces&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; U+0020 SPACE
+    characters into &lt;var title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; at random
+    positions.&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;Continuing the example, this could lead to
+    &quot;388&nbsp;5037&nbsp;&nbsp;7&nbsp;&nbsp;15&quot; and
+    &quot;1&nbsp;&nbsp;&nbsp;0&nbsp;3&nbsp;&nbsp;4&nbsp;97&nbsp;53&nbsp;31&quot;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Insert between one and twelve random characters from
+    the ranges U+0021 to U+002F and U+003A to U+007E into &lt;var
+    title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; at random positions.&lt;/p&gt;
+
+    &lt;p&gt;Insert between one and twelve random characters from
+    the ranges U+0021 to U+002F and U+003A to U+007E into &lt;var
+    title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; at random positions.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;This corresponds to random printable ASCII
+    characters other than the digits and the U+0020 SPACE
+    character.&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;Continuing the example, this could lead to
+    &quot;388P&nbsp;O503D&amp;ul7&nbsp;{K%gX(&nbsp;%7&nbsp;&nbsp;15&quot; and
+    &quot;1&nbsp;N&nbsp;?|k&nbsp;UT0or&nbsp;3o&nbsp;&nbsp;4&nbsp;I97N&nbsp;5-S3O&nbsp;31&quot;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Add the string consisting of the concatenation of the string
+    &quot;Sec-WebSocket-Key1:&quot;, a U+0020 SPACE character, and the &lt;var
+    title=&quot;&quot;&gt;key&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt; value, to &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Add the string consisting of the concatenation of the string
+    &quot;Sec-WebSocket-Key2:&quot;, a U+0020 SPACE character, and the &lt;var
+    title=&quot;&quot;&gt;key&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt; value, to &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;For each string in &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt;, in a random
+    order: send the string, encoded as UTF-8, followed by a
+    UTF-8-encoded U+000D CARRIAGE RETURN U+000A LINE FEED character
+    pair (CRLF). It is important that the fields be output in a
+    random order so that servers not depend on the particular order
+    used by any particular client.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send a UTF-8-encoded U+000D CARRIAGE RETURN U+000A LINE FEED
+    character pair (CRLF).&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key3&lt;/var&gt; be a string consisting of eight
+    random bytes (or equivalently, a random 64 bit integer encoded in
+    little-endian order).&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;For example, 0x47 0x30 0x22 0x2D 0x5A 0x3F 0x47
+    0x58.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send &lt;var title=&quot;&quot;&gt;key3&lt;/var&gt; to the server.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Read bytes from the server until either the connection closes,
+    or a 0x0A byte is read. Let &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; be these
+    bytes, including the 0x0A byte.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;field&lt;/var&gt; is not at least seven bytes long,
+    or if the last two bytes aren't 0x0D and 0x0A respectively, or if
+    it does not contain at least two 0x20 bytes, then &lt;span&gt;fail the
+    WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
+
     &lt;p&gt;User agents may apply a timeout to this step, &lt;span title=&quot;fail
-    the Web Socket connection&quot;&gt;failing the Web Socket
-    connection&lt;/span&gt; if the server does not respond with the above
-    bytes within a suitable time period.&lt;/p&gt;
+    the WebSocket connection&quot;&gt;failing the WebSocket
+    connection&lt;/span&gt; if the server does not send back data in a
+    suitable time period.&lt;/p&gt;
 
-&lt;!--(v2-ws-auth) (v2-redirect)
-    &lt;p class=&quot;note&quot;&gt;This step is skipped if &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt;
-    is &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt; or &lt;i title=&quot;&quot;&gt;authenticate&lt;/i&gt;.&lt;/p&gt;
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; be the substring of &lt;var
+    title=&quot;&quot;&gt;field&lt;/var&gt; that starts from the byte after the first
+    0x20 byte, and ends with the byte before the second 0x20 byte.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; is not three bytes long, or if any
+    of the bytes in &lt;var title=&quot;&quot;&gt;code&lt;/var&gt; are not in the range 0x30
+    to 0x39, then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort
+    these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+&lt;!--(v2-redirect or v2-ws-auth) - - then change the text below
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;101&quot;,
+    then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;.&lt;/p&gt;
 --&gt;
+&lt;!--(v2-redirect)
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is either
+    &quot;&lt;code title=&quot;&quot;&gt;301&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;302&lt;/code&gt;&quot;, &quot;&lt;code
+    title=&quot;&quot;&gt;303&lt;/code&gt;&quot;, &quot;&lt;code title=&quot;&quot;&gt;307&lt;/code&gt;&quot;, then let &lt;var
+    title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt;.&lt;/p&gt;
+--&gt;
+&lt;!--(v2-ws-auth)
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;&lt;code
+    title=&quot;&quot;&gt;401&lt;/code&gt;&quot;, then let &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; be &lt;i
+    title=&quot;&quot;&gt;authenticate&lt;/i&gt;.&lt;/p&gt;
+--&gt;
 
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;101&quot;,
+    then move to the next step.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;code&lt;/var&gt;, interpreted as UTF-8, is &quot;&lt;code
+    title=&quot;&quot;&gt;407&lt;/code&gt;&quot;, then either close the connection and jump
+    back to step 2, providing appropriate authentication information,
+    or &lt;span&gt;fail the WebSocket connection&lt;/span&gt;. 407 is the code
+    used by HTTP meaning &quot;Proxy Authentication Required&quot;. User agents
+    that support proxy authentication must interpret the response as
+    defined by HTTP (e.g. to find and interpret the &lt;code
+    title=&quot;http-Proxy-Authenticate&quot;&gt;Proxy-Authenticate&lt;/code&gt;
+    header).&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort
+    these steps.&lt;/p&gt;
+
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; be a list of name-value
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; be a list of name-value
    pairs, initially empty.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li id=&quot;ws-ua-header-loop&quot;&gt;&lt;p&gt;&lt;i title=&quot;&quot;&gt;Header&lt;/i&gt;: Let &lt;var
+   &lt;li id=&quot;ws-ua-field-loop&quot;&gt;&lt;p&gt;&lt;i title=&quot;&quot;&gt;Field&lt;/i&gt;: Let &lt;var
    title=&quot;&quot;&gt;name&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be empty byte
    arrays.&lt;/p&gt;&lt;/li&gt;
 
@@ -76387,7 +76634,7 @@
     &lt;p&gt;Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and abort these
+    &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
     steps.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, handle the byte as described in the appropriate
@@ -76398,14 +76645,14 @@
      &lt;dt&gt;If the byte is 0x0D (ASCII CR)&lt;/dt&gt;
 
      &lt;dd&gt;If the &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; byte array is empty, then
-     jump to the &lt;a href=&quot;#ws-ua-headers-processing&quot;&gt;headers
-     processing&lt;/a&gt; step. Otherwise, &lt;span&gt;fail the Web Socket
+     jump to the &lt;a href=&quot;#ws-ua-fields-processing&quot;&gt;fields
+     processing&lt;/a&gt; step. Otherwise, &lt;span&gt;fail the WebSocket
      connection&lt;/span&gt; and abort these steps.&lt;/dd&gt;
 
 
      &lt;dt&gt;If the byte is 0x0A (ASCII LF)&lt;/dt&gt;
 
-     &lt;dd&gt;&lt;span&gt;Fail the Web Socket connection&lt;/span&gt; and abort these
+     &lt;dd&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt; and abort these
      steps.&lt;/dd&gt;
 
 
@@ -76428,7 +76675,7 @@
 
     &lt;/dl&gt;
 
-    &lt;p class=&quot;note&quot;&gt;This reads a header name, terminated by a colon,
+    &lt;p class=&quot;note&quot;&gt;This reads a field name, terminated by a colon,
     converting upper-case ASCII letters to lowercase, and aborting if
     a stray CR or LF is found.&lt;/p&gt;
 
@@ -76439,7 +76686,7 @@
     &lt;p&gt;Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and abort these
+    &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
     steps.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, handle the byte as described in the appropriate
@@ -76469,7 +76716,7 @@
     &lt;p&gt;Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, then
-    &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and abort these
+    &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
     steps.&lt;/p&gt;
 
     &lt;p&gt;Otherwise, handle the byte as described in the appropriate
@@ -76484,7 +76731,7 @@
 
      &lt;dt&gt;If the byte is 0x0A (ASCII LF)&lt;/dt&gt;
 
-     &lt;dd&gt;&lt;span&gt;Fail the Web Socket connection&lt;/span&gt; and abort these
+     &lt;dd&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt; and abort these
      steps.&lt;/dd&gt;
 
 
@@ -76495,7 +76742,7 @@
 
     &lt;/dl&gt;
 
-    &lt;p class=&quot;note&quot;&gt;This reads a header value, terminated by a
+    &lt;p class=&quot;note&quot;&gt;This reads a field value, terminated by a
     CRLF.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -76505,17 +76752,16 @@
     &lt;p&gt;Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, or if
-    the byte is not a 0x0A byte (ASCII LF), then &lt;span&gt;fail the Web
-    Socket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
+    the byte is not a 0x0A byte (ASCII LF), then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;This skips past the LF byte of the CRLF after the
-    header.&lt;/p&gt;
+    field.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Append an entry to the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list that
+    &lt;p&gt;Append an entry to the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list that
     has the name given by the string obtained by interpreting the &lt;var
     title=&quot;&quot;&gt;name&lt;/var&gt; byte array as a UTF-8 byte stream and the
     value given by the string obtained by interpreting the &lt;var
@@ -76525,82 +76771,109 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Return to the &quot;&lt;a href=&quot;#ws-ua-header-loop&quot;&gt;Header&lt;/a&gt;&quot; step
+    &lt;p&gt;Return to the &quot;&lt;a href=&quot;#ws-ua-field-loop&quot;&gt;Field&lt;/a&gt;&quot; step
     above.&lt;/p&gt;
 
    &lt;/li&gt;
 
-   &lt;li id=&quot;ws-ua-headers-processing&quot;&gt;
+   &lt;li id=&quot;ws-ua-fields-processing&quot;&gt;
 
-    &lt;p&gt;&lt;i&gt;Headers processing&lt;/i&gt;: Read a byte from the server.&lt;/p&gt;
+    &lt;p&gt;&lt;i&gt;Fields processing&lt;/i&gt;: Read a byte from the server.&lt;/p&gt;
 
     &lt;p&gt;If the connection closes before this byte is received, or if
-    the byte is not a 0x0A byte (ASCII LF), then &lt;span&gt;fail the Web
-    Socket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
+    the byte is not a 0x0A byte (ASCII LF), then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;This skips past the LF byte of the CRLF after the
-    blank line after the headers.&lt;/p&gt;
+    blank line after the fields.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;, then: If
-    there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt;
-    list whose name is &quot;&lt;code
-    title=&quot;http-websocket-origin&quot;&gt;websocket-origin&lt;/code&gt;&quot;, or if
-    there is not exactly one entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt;
-    list whose name is &quot;&lt;code
-    title=&quot;http-websocket-location&quot;&gt;websocket-location&lt;/code&gt;&quot;, or if
-    the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; was specified but there is not
-    exactly one entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list whose
-    name is &quot;&lt;code
-    title=&quot;http-websocket-protocol&quot;&gt;websocket-protocol&lt;/code&gt;&quot;, or if
-    there are any entries in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list
-    whose names are the empty string, then &lt;span&gt;fail the Web Socket
+    &lt;p&gt;
+    &lt;!--(v2-redirect or v2-ws-auth) If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;normal&lt;/i&gt;, then: --&gt;
+
+    If there is not exactly one entry in the &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;http-upgrade&quot;&gt;upgrade&lt;/code&gt;&quot;, or
+
+    if there is not exactly one entry in the &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;http-connection&quot;&gt;connection&lt;/code&gt;&quot;, or
+
+    if there is not exactly one entry in the &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;http-sec-websocket-origin&quot;&gt;sec-websocket-origin&lt;/code&gt;&quot;, or
+
+    if there is not exactly one entry in the &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;http-sec-websocket-location&quot;&gt;sec-websocket-location&lt;/code&gt;&quot;, or
+
+    if the &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; was specified but there is not exactly one entry in the &lt;var
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;http-sec-websocket-protocol&quot;&gt;sec-websocket-protocol&lt;/code&gt;&quot;, or
+
+    if there are any entries in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list
+    whose names are the empty string, then &lt;span&gt;fail the WebSocket
     connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list as follows:&lt;/p&gt;
+    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
 
     &lt;dl class=&quot;switch&quot;&gt;
 
      &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-websocket-origin&quot;&gt;websocket-origin&lt;/code&gt;&quot;&lt;/dt&gt;
+     title=&quot;http-upgrade&quot;&gt;upgrade&lt;/code&gt;&quot;&lt;/dt&gt;
 
+     &lt;dd&gt;&lt;p&gt;If the value is not exactly equal to the string
+     &quot;WebSocket&quot;, then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and
+     abort these steps.&lt;/p&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;If the entry's name is &quot;&lt;code
+     title=&quot;http-connection&quot;&gt;connection&lt;/code&gt;&quot;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;If the value, &lt;span&gt;converted to ASCII lowercase&lt;/span&gt;,
+     is not exactly equal to the string &quot;upgrade&quot;, then &lt;span&gt;fail the
+     WebSocket connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;If the entry's name is &quot;&lt;code
+     title=&quot;http-sec-websocket-origin&quot;&gt;sec-websocket-origin&lt;/code&gt;&quot;&lt;/dt&gt;
+
      &lt;dd&gt;&lt;p&gt;If the value is not exactly equal to &lt;var
      title=&quot;&quot;&gt;origin&lt;/var&gt;, &lt;span&gt;converted to ASCII lowercase&lt;/span&gt;,
-     then &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and abort these
+     then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
      steps. &lt;a href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;&lt;/dd&gt;
 
 
      &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-websocket-location&quot;&gt;websocket-location&lt;/code&gt;&quot;&lt;/dt&gt;
+     title=&quot;http-sec-websocket-location&quot;&gt;sec-websocket-location&lt;/code&gt;&quot;&lt;/dt&gt;
 
      &lt;dd&gt;
 
       &lt;p&gt;If the value is not exactly equal to a string obtained from
-      the steps to &lt;span&gt;construct a Web Socket URL&lt;/span&gt; from &lt;var
+      the steps to &lt;span&gt;construct a WebSocket URL&lt;/span&gt; from &lt;var
       title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
       title=&quot;&quot;&gt;resource name&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;
-      flag, then &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and abort
+      flag, then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort
       these steps.&lt;/p&gt;
 
      &lt;/dd&gt;
 
 
      &lt;dt&gt;If the entry's name is &quot;&lt;code
-     title=&quot;http-websocket-protocol&quot;&gt;websocket-protocol&lt;/code&gt;&quot;&lt;/dt&gt;
+     title=&quot;http-sec-websocket-protocol&quot;&gt;sec-websocket-protocol&lt;/code&gt;&quot;&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;If there was a &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; specified, and
      the value is not exactly equal to &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt;,
-     then &lt;span&gt;fail the Web Socket connection&lt;/span&gt; and abort these
+     then &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
      steps. (If no &lt;var title=&quot;&quot;&gt;protocol&lt;/var&gt; was specified, the
-     header is ignored.)&lt;/p&gt;&lt;/dd&gt;
+     field is ignored.)&lt;/p&gt;&lt;/dd&gt;
 
 
      &lt;dt&gt;If the entry's name is &quot;&lt;code
      title=&quot;http-setcookie&quot;&gt;set-cookie&lt;/code&gt;&quot; or &quot;&lt;code
      title=&quot;http-setcookie2&quot;&gt;set-cookie2&lt;/code&gt;&quot; or another
-     cookie-related header name&lt;/dt&gt;
+     cookie-related field name&lt;/dt&gt;
 
      &lt;dd&gt;&lt;p&gt;Handle the cookie as defined by the appropriate
      specification, with the resource being the one with the host &lt;var
@@ -76632,10 +76905,10 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;redirect&lt;/i&gt;, then:
     If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;headers&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;&quot;&gt;location&lt;/code&gt;&quot;, then &lt;span&gt;fail the Web Socket
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;&quot;&gt;location&lt;/code&gt;&quot;, then &lt;span&gt;fail the WebSocket
     connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list as follows:&lt;/p&gt;
+    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
 
     &lt;dl class=&quot;switch&quot;&gt;
 
@@ -76649,20 +76922,20 @@
        &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;was secure&lt;/var&gt; have the value of
        &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-       &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a Web Socket URL's components&lt;/span&gt; from
+       &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from
        the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain new values for
        &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
        title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var
-       title=&quot;&quot;&gt;secure&lt;/var&gt;. If this fails, &lt;span&gt;fail the Web Socket
+       title=&quot;&quot;&gt;secure&lt;/var&gt;. If this fails, &lt;span&gt;fail the WebSocket
        connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
        &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;was secure&lt;/var&gt; is true but &lt;var
-       title=&quot;&quot;&gt;secure&lt;/var&gt; is now false, &lt;span&gt;fail the Web Socket
+       title=&quot;&quot;&gt;secure&lt;/var&gt; is now false, &lt;span&gt;fail the WebSocket
        connection&lt;/span&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
        &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; is a port to which the user
-       agent is configured to block access, then &lt;span&gt;fail the Web
-       Socket connection&lt;/span&gt; and abort these steps. (User agents
+       agent is configured to block access, then &lt;span&gt;fail the
+       WebSocket connection&lt;/span&gt; and abort these steps. (User agents
        typically block access to well-known ports like SMTP.)&lt;/p&gt;&lt;/li&gt;
 
        &lt;li&gt;&lt;p&gt;Close the connection if the server has not already done
@@ -76688,10 +76961,10 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &lt;i title=&quot;&quot;&gt;authenticate&lt;/i&gt;,
     then: If there is not exactly one entry in the &lt;var
-    title=&quot;&quot;&gt;headers&lt;/var&gt; list whose name is &quot;&lt;code
-    title=&quot;&quot;&gt;www-authenticate&lt;/code&gt;&quot;, then &lt;span&gt;fail the Web Socket
+    title=&quot;&quot;&gt;fields&lt;/var&gt; list whose name is &quot;&lt;code
+    title=&quot;&quot;&gt;www-authenticate&lt;/code&gt;&quot;, then &lt;span&gt;fail the WebSocket
     connection&lt;/span&gt; and abort these steps. Otherwise, handle each
-    entry in the &lt;var title=&quot;&quot;&gt;headers&lt;/var&gt; list as follows:&lt;/p&gt;
+    entry in the &lt;var title=&quot;&quot;&gt;fields&lt;/var&gt; list as follows:&lt;/p&gt;
 
     &lt;dl class=&quot;switch&quot;&gt;
 
@@ -76722,7 +76995,62 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;The &lt;dfn&gt;Web Socket connection is established&lt;/dfn&gt;. Now the
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; be the concatenation of &lt;var
+    title=&quot;&quot;&gt;number&lt;sub&gt;1&lt;/sub&gt;&lt;/var&gt;, expressed as a little-endian 32
+    bit integer, &lt;var title=&quot;&quot;&gt;number&lt;sub&gt;2&lt;/sub&gt;&lt;/var&gt;, expressed as
+    a little-endian 32 bit integer, and the eight bytes of &lt;var
+    title=&quot;&quot;&gt;key&lt;sub&gt;3&lt;/sub&gt;&lt;/var&gt; in the order they were sent on the
+    wire.&lt;/p&gt;
+
+    &lt;!--
+    perl -e 'foreach (@ARGV) { print pack 'N', $_ }' 777007543 114997259 | hexdump -C
+    --&gt;
+
+    &lt;p class=&quot;example&quot;&gt;Using the examples given earlier, this leads to
+    the 16 bytes 0x2E 0x50 0x31 0xB7 0x06 0xDA 0xB8 0x0B 0x47 0x30
+    0x22 0x2D 0x5A 0x3F 0x47 0x58.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;expected&lt;/var&gt; be the MD5 fingerprint of &lt;var
+    title=&quot;&quot;&gt;challenge&lt;/var&gt; as a little-endian 128 bit string. &lt;a
+    href=&quot;#refsRFC1321&quot;&gt;[RFC1321]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;!--
+    perl -e &quot;print pack 'c*', map { hex } @ARGV&quot; 0x2E 0x50 0x31 0xB7 0x06 0xDA 0xB8 0x0B 0x47 0x30 0x22 0x2D 0x5A 0x3F 0x47 0x58 | md5sum -b
+    --&gt;
+
+    &lt;p class=&quot;example&quot;&gt;Using the examples given earlier, this leads to
+    the 16 bytes 0x30 0x73 0x74 0x33 0x52 0x6C 0x26 0x71 0x2D 0x32
+    0x5A 0x55 0x5E 0x77 0x65 0x75. In ASCII, these bytes correspond to
+    the string &quot;0st3Rl&amp;q-2ZU^weu&quot;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Read sixteen bytes from the server. Let &lt;var
+    title=&quot;&quot;&gt;reply&lt;/var&gt; be those bytes.&lt;/p&gt;
+
+    &lt;p&gt;If the connection closes before these bytes are received, then
+    &lt;span&gt;fail the WebSocket connection&lt;/span&gt; and abort these
+    steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;reply&lt;/var&gt; does not exactly equal &lt;var
+    title=&quot;&quot;&gt;expected&lt;/var&gt;, then &lt;span&gt;fail the WebSocket
+    connection&lt;/span&gt; and abort these steps.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;The &lt;dfn&gt;WebSocket connection is established&lt;/dfn&gt;. Now the
     user agent must send and receive to and from the connection as
     described in the next section.&lt;/p&gt;
 
@@ -76733,7 +77061,7 @@
 
   &lt;h6&gt;Data framing&lt;/h6&gt;
 
-  &lt;p&gt;Once a &lt;span&gt;Web Socket connection is established&lt;/span&gt;, the
+  &lt;p&gt;Once a &lt;span&gt;WebSocket connection is established&lt;/span&gt;, the
   user agent must run through the following state machine for the
   bytes sent by the server.&lt;/p&gt;
 
@@ -76744,7 +77072,7 @@
     &lt;p&gt;Try to read a byte from the server. Let &lt;var title=&quot;&quot;&gt;frame
     type&lt;/var&gt; be that byte.&lt;/p&gt;
 
-    &lt;p&gt;If no byte could be read because the &lt;span&gt;Web Socket
+    &lt;p&gt;If no byte could be read because the &lt;span&gt;WebSocket
     connection is closed&lt;/span&gt;, then abort.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -76762,7 +77090,7 @@
      &lt;dd&gt;
 
       &lt;p&gt;Run these steps. If at any point during these steps a read is
-      attempted but fails because the &lt;span&gt;Web Socket connection is
+      attempted but fails because the &lt;span&gt;WebSocket connection is
       closed&lt;/span&gt;, then abort.&lt;/p&gt;
 
       &lt;ol&gt;
@@ -76801,7 +77129,7 @@
      &lt;dd&gt;
 
       &lt;p&gt;Run these steps. If at any point during these steps a read is
-      attempted but fails because the &lt;span&gt;Web Socket connection is
+      attempted but fails because the &lt;span&gt;WebSocket connection is
       closed&lt;/span&gt;, then abort.&lt;/p&gt;
 
       &lt;ol&gt;
@@ -76820,7 +77148,7 @@
        string, and store that string in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;.&lt;/p&gt;
 
        &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;frame type&lt;/var&gt; is 0x00, then &lt;dfn&gt;a
-       message has been received&lt;/dfn&gt; with text &lt;var
+       WebSocket message has been received&lt;/dfn&gt; with text &lt;var
        title=&quot;&quot;&gt;data&lt;/var&gt;. Otherwise, discard the data.&lt;/p&gt;&lt;/li&gt;
 
       &lt;/ol&gt;
@@ -76838,14 +77166,14 @@
   &lt;p&gt;If the user agent is faced with content that is too large to be
   handled appropriately, runs out of resources for buffering incoming
   data, or hits an artificial resource limit intended to avoid
-  resource starvation, then it must &lt;span&gt;fail the Web Socket
+  resource starvation, then it must &lt;span&gt;fail the WebSocket
   connection&lt;/span&gt;.&lt;/p&gt;
 
   &lt;hr&gt;
 
-  &lt;p&gt;Once a &lt;span&gt;Web Socket connection is established&lt;/span&gt;, the
+  &lt;p&gt;Once a &lt;span&gt;WebSocket connection is established&lt;/span&gt;, the
   user agent must use the following steps to &lt;dfn&gt;send &lt;var
-  title=&quot;&quot;&gt;data&lt;/var&gt; using the Web Socket&lt;/dfn&gt;:&lt;/p&gt;
+  title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/dfn&gt;:&lt;/p&gt;
 
   &lt;ol&gt;
 
@@ -76859,7 +77187,7 @@
   &lt;/ol&gt;
 
   &lt;p&gt;If at any point there is a fatal problem with sending data to the
-  server, the user agent must &lt;span&gt;fail the Web Socket
+  server, the user agent must &lt;span&gt;fail the WebSocket
   connection&lt;/span&gt;.&lt;/p&gt;
 
   &lt;!-- v2: People often request the ability to send binary blobs over
@@ -76868,17 +77196,17 @@
   data. --&gt;
 
 
-  &lt;h6&gt;Closing the connection&lt;/h6&gt;
+  &lt;h6&gt;Failing the connection&lt;/h6&gt;
 
-  &lt;p&gt;To &lt;dfn&gt;fail the Web Socket connection&lt;/dfn&gt;, the user agent must
-  &lt;span&gt;close the Web Socket connection&lt;/span&gt;, and may report the
+  &lt;p&gt;To &lt;dfn&gt;fail the WebSocket connection&lt;/dfn&gt;, the user agent must
+  &lt;span&gt;close the WebSocket connection&lt;/span&gt;, and may report the
   problem to the user (which would be especially useful for
   developers). However, user agents must not convey the failure
   information to the script that attempted the connection in a way
-  distinguishable from the Web Socket being closed normally.&lt;/p&gt;
+  distinguishable from the WebSocket being closed normally.&lt;/p&gt;
 
   &lt;p&gt;Except as indicated above or as specified by the application
-  layer (e.g. a script using the Web Socket API), user agents should
+  layer (e.g. a script using the WebSocket API), user agents should
   not close the connection.&lt;/p&gt;
 
 
@@ -76894,200 +77222,178 @@
   &lt;h5&gt;Server-side requirements&lt;/h5&gt;
 
   &lt;p&gt;&lt;i&gt;This section only applies to servers.&lt;/i&gt;&lt;/p&gt;
-  
 
-  &lt;h6&gt;Sending the server's handshake&lt;/h6&gt;
 
-  &lt;p&gt;When a client establishes a Web Socket connection to a server,
-  the server must either close the connection or send the server
-  handshake. Servers may read part or all of the client's handshake
-  (as described in the next section) before closing the connection or
-  sending all of their side of the handshake; indeed, in some cases
-  this is necessary as the server might need to use some of the
-  information in the client's handshake to construct it's own
-  handshake.&lt;/p&gt;
+  &lt;h6&gt;Reading the client's handshake&lt;/h6&gt;
 
-  &lt;p&gt;If the server supports encryption, then the server must perform a
-  TLS handshake over the connection before sending the server
-  handshake. If this fails (e.g. the client indicated a host name in
-  the extended client hello &quot;server_name&quot; extension that the server
-  does not host), then the server must close the connection;
-  otherwise, all further communication for the connection (including
-  the server handshake) must run through the encrypted tunnel. &lt;a
-  href=&quot;#refsRFC2246&quot;&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
+  &lt;p&gt;When a client starts a WebSocket connection, it sends its part of
+  the handshake. The server must parse at least part of this handshake
+  in order to obtain the necessary information to generate the server
+  part of the handshake.&lt;/p&gt;
 
-  &lt;p&gt;To send the server handshake, the server must first establish the
-  following information:&lt;/p&gt;
+  &lt;p&gt;The client handshake consists of the following parts. If the
+  server, while reading the handshake, finds that the client did not
+  send a handshake that matches the description below, the server
+  should &lt;span&gt;abort the WebSocket connection&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;dl&gt;
+  &lt;ol&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/dt&gt;
+   &lt;li&gt;&lt;p&gt;The three-character UTF-8 string &quot;GET&quot;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dd&gt;The &lt;span title=&quot;ASCII serialization of an origin&quot;&gt;ASCII
-   serialization&lt;/span&gt; of the origin that the server is willing to
-   communicate with. If the server can respond to requests from
-   multiple origins (or indeed, all origins), then the value should be
-   derived from the client's handshake, specifically from the &quot;Origin&quot;
-   field. &lt;a href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/dd&gt;
+   &lt;li&gt;&lt;p&gt;A UTF-8-encoded U+0020 SPACE character (0x20 byte).&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;host&lt;/var&gt;&lt;/dt&gt;
+   &lt;li&gt;&lt;p&gt;A string consisting of all the bytes up to the next
+   UTF-8-encoded U+0020 SPACE character (0x20 byte). The result of
+   decoding this string as a UTF-8 string is the name of the resource
+   requested by the server. If the server only supports one resource,
+   then this can safely be ignored; the client verifies that the right
+   resource is supported based on the information included in the
+   server's own handshake. The resource name will begin with U+002F
+   SOLIDUS character (/) and will only include characters in the range
+   U+0021 to U+007E.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;dd&gt;The host name or IP address of the Web Socket server, as it is
-   to be addressed by clients. The host name must be punycode-encoded
-   if necessary. If the server can respond to requests to multiple
-   hosts (e.g. in a virtual hosting environment), then the value
-   should be derived from the client's handshake, specifically from
-   the &quot;Host&quot; field.&lt;/dd&gt;
+   &lt;li&gt;&lt;p&gt;A string of bytes terminated by a UTF-8-encoded U+000D
+   CARRIAGE RETURN U+000A LINE FEED character pair (CRLF). All the
+   characters from the second 0x20 byte up to the first 0x0D 0x0A byte
+   pair in the data from the client can be safely ignored. (It will
+   probably be the string &quot;HTTP/1.1&quot;.)&lt;/p&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt;&lt;/dt&gt;
+   &lt;li&gt;
 
-   &lt;dd&gt;The port number on which the server expected and/or received
-   the connection.&lt;/dd&gt;
+    &lt;p&gt;A series of fields.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;&lt;/dt&gt;
+    &lt;p&gt;Each field is terminated by a UTF-8-encoded U+000D CARRIAGE
+    RETURN U+000A LINE FEED character pair (CRLF). The end of the
+    fields is denoted by the terminating CRLF pair being followed
+    immediately by another CRLF pair.&lt;/p&gt;
 
-   &lt;dd&gt;An identifier for the service provided by the server. If the
-   server provides multiple services, then the value should be derived
-   from the client's handshake, specifically from the &quot;Host&quot;
-   field.&lt;/dd&gt;
+    &lt;p class=&quot;note&quot;&gt;In other words, the fields start with the first
+    0x0D 0x0A byte pair and end with the first 0x0D 0x0A 0x0D 0x0A
+    byte sequence.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;secure flag&lt;/var&gt;&lt;dt&gt;
+    &lt;p&gt;The fields are encoded as UTF-8.&lt;/p&gt;
 
-   &lt;dd&gt;True if the connection is encrypted or if the server expected
-   it to be encrypted; false otherwise.&lt;/dd&gt;
+    &lt;p&gt;Each field consists of a name, consisting of one or more
+    characters in the range U+0021 to U+007E, followed by a U+003A
+    COLON character (:) and a U+0020 SPACE character, followed by zero
+    or more characters forming the value.&lt;/p&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/dt&gt;
+    &lt;p&gt;The expected field names, the meaning of their corresponding
+    values, and the processing servers are required to apply to those
+    fields, are described below, after the description of the client
+    handshake.&lt;/p&gt;
 
-   &lt;dd&gt;Either null, or a string representing the subprotocol the
-   server is ready to use. If the server supports multiple
-   subprotocols, then the value should be derived from the client's
-   handshake, specifically from the &quot;WebSocket-Protocol&quot; field. The
-   absence of such a field is equivalent to the null value. The empty
-   string is not the same as the null value for these purposes.&lt;/dd&gt;
+   &lt;/li&gt;
 
-  &lt;/dl&gt;
+   &lt;li&gt;
 
-  &lt;p&gt;Having established this information, the server must start the
-  handshake. The initial part of the server's handshake is invariant,
-  and must consist of the following bytes:&lt;/p&gt;
+    &lt;p&gt;After the first 0x0D 0x0A 0x0D 0x0A byte sequence, indicating
+    the end of the fields, the client sends eight random bytes. These
+    are used in constructing the server handshake.&lt;/p&gt;
 
-  &lt;pre&gt;48 54 54 50 2F 31 2E 31  20 31 30 31 20 57 65 62
-20 53 6F 63 6B 65 74 20  50 72 6F 74 6F 63 6F 6C
-20 48 61 6E 64 73 68 61  6B 65 0D 0A 55 70 67 72
-61 64 65 3A 20 57 65 62  53 6F 63 6B 65 74 0D 0A
-43 6F 6E 6E 65 63 74 69  6F 6E 3A 20 55 70 67 72
-61 64 65 0D 0A 57 65 62  53 6F 63 6B 65 74 2D 4F
-72 69 67 69 6E 3A 20&lt;/pre&gt;
+   &lt;/li&gt;
 
-  &lt;p&gt;These bytes must be the first bytes sent on the TCP connection by
-  the server. They must be followed by the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;
-  string, encoded as ANSI_X3.4-1968 (US-ASCII), followed by the
-  following bytes: &lt;a href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
+  &lt;/ol&gt;
 
-  &lt;pre&gt;0D 0A 57 65 62 53 6F 63  6B 65 74 2D 4C 6F 63 61
-74 69 6F 6E 3A 20&lt;/pre&gt;
+  &lt;p&gt;The expected field names, and the meaning of their corresponding
+  values, are as follows. Field names must be compared in an
+  &lt;span&gt;ASCII case-insensitive&lt;/span&gt; manner.&lt;/p&gt;
 
-  &lt;p&gt;The server must then send the string that results from &lt;span
-  title=&quot;construct a Web Socket URL&quot;&gt;constructing a Web Socket
-  URL&lt;/span&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;,
-  &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure
-  flag&lt;/var&gt;, encoded as ANSI_X3.4-1968 (US-ASCII). &lt;a
-  href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is not null, then the
-  server must then send the following bytes:&lt;/p&gt;
-
-  &lt;pre&gt;0D 0A 57 65 62 53 6F 63  6B 65 74 2D 50 72 6F 74
-6F 63 6F 6C 3A 20&lt;/pre&gt;
-
-  &lt;p&gt;...followed by the &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; string,
-  encoded as ANSI_X3.4-1968 (US-ASCII). &lt;a
-  href=&quot;#refsRFC1345&quot;&gt;[RFC1345]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;Finally, the server must end its side of the handshake by sending
-  the four bytes 0x0D 0x0A 0x0D 0x0A to the client.&lt;/p&gt;
-
-
-  &lt;h6&gt;Reading the client's handshake&lt;/h6&gt;
-
-  &lt;p&gt;When a client starts a Web Socket connection, it sends its part
-  of the handshake. This consists of a number of fields separated by
-  CRLF pairs (bytes 0x0D 0x0A).&lt;/p&gt;
-
-  &lt;p&gt;The first field consists of three tokens separated by space
-  characters (byte 0x20). The first token is the string &quot;GET&quot;, the
-  middle token is the resource name, and the third is the string
-  &quot;HTTP/1.1&quot;.&lt;/p&gt;
-
-  &lt;p&gt;If the first field does not have three tokens, or if the first
-  and third tokens aren't the strings given in the previous paragraph,
-  or if the second token doesn't begin with U+002F SOLIDUS character
-  (/), the server should abort the connection: it either represents an
-  errorneous Web Socket client or a connection from a client expecting
-  another protocol altogether.&lt;/p&gt;
-
-  &lt;p&gt;The subsequent fields consist of a string representing a name, a
-  colon and a space (bytes 0x3A 0x20), and a string representing a
-  value. The possible names, and the meaning of their corresponding
-  values, are as follows:&lt;/p&gt;
-
   &lt;dl&gt;
 
-   &lt;dt&gt;Upgrade (bytes 55 70 67 72 61 64 65; always the first name-value pair)&lt;/dt&gt;
+   &lt;dt&gt;&lt;code title=&quot;http-upgrade&quot;&gt;Upgrade&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Invariant part of the handshake. Will always have a value
-    consisting of bytes 57 65 62 53 6F 63 6B 65 74.&lt;/p&gt;
+    &lt;p&gt;Invariant part of the handshake. Will always have a value that
+    is an &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the string
+    &quot;WebSocket&quot;.&lt;/p&gt;
 
+    &lt;p&gt;Can be safely ignored, though the server should &lt;span&gt;abort the WebSocket
+    connection&lt;/span&gt; if this field is absent or has a different
+    value, to avoid vulnerability to cross-protocol attacks.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;Connection (bytes 43 6F 6E 6E 65 63 74 69 6F 6E; always the second name-value pair)&lt;/dt&gt;
+   &lt;dt&gt;&lt;code title=&quot;http-connection&quot;&gt;Connection&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Invariant part of the handshake. Will always have a value
-    consisting of bytes 55 70 67 72 61 64 65.&lt;/p&gt;
+    &lt;p&gt;Invariant part of the handshake. Will always have a value that
+    is an &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the string
+    &quot;Upgrade&quot;.&lt;/p&gt;
 
+    &lt;p&gt;Can be safely ignored, though the server should &lt;span&gt;abort the WebSocket
+    connection&lt;/span&gt; if this field is absent or has a different
+    value, to avoid vulnerability to cross-protocol attacks.&lt;/p&gt;
+
    &lt;/dd&gt;
  
-   &lt;dt&gt;Host (bytes 48 6F 73 74; always the third name-value pair)&lt;/dt&gt;
+   &lt;dt&gt;&lt;code title=&quot;http-host&quot;&gt;Host&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;The value gives the hostname that the client intended to use
-    when opening the Web Socket. It would be of interest in particular
+    when opening the WebSocket. It would be of interest in particular
     to virtual hosting environments, where one server might serve
     multiple hosts, and might therefore want to return different
-    data. The value must be interpreted as UTF-8.&lt;/p&gt;
+    data.&lt;/p&gt;
 
+    &lt;p&gt;Can be safely ignored, though the server should &lt;span&gt;abort the WebSocket
+    connection&lt;/span&gt; if this field is absent or has a value that
+    does not match the server's host name, to avoid vulnerability to
+    cross-protocol attacks and DNS rebinding attacks.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;Origin (bytes 4F 72 69 67 69 6E; always the fourth name-value pair)&lt;/dt&gt; &lt;!-- http-origin --&gt;
+   &lt;dt&gt;&lt;code title=&quot;http-origin&quot;&gt;Origin&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;The value gives the scheme, hostname, and port (if it's not the
     default port for the given scheme) of the page that asked the
-    client to open the Web Socket. It would be interesting if the
+    client to open the WebSocket. It would be interesting if the
     server's operator had deals with operators of other sites, since
     the server could then decide how to respond (or indeed,
     &lt;em&gt;whether&lt;/em&gt; to respond) based on which site was requesting a
-    connection. The value must be interpreted as UTF-8.&lt;/p&gt;
+    connection. &lt;a href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/p&gt;
 
+    &lt;p&gt;Can be safely ignored, though the server should &lt;span&gt;abort the WebSocket
+    connection&lt;/span&gt; if this field is absent or has a value that
+    does not match one of the origins the server is expecting to
+    communicate with, to avoid vulnerability to cross-protocol attacks
+    and cross-site scripting attacks.&lt;/p&gt;
+
    &lt;/dd&gt;
 
-   &lt;dt&gt;WebSocket-Protocol (bytes 57 65 62 53 6F 63 6B 65 74 2D 50 72 6F 74 6F 63 6F 6C; optional, if present, will be the fifth name-value pair)&lt;/dt&gt; &lt;!-- http-websocket-protocol --&gt;
+   &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;The value gives the name of a subprotocol that the client is
     intending to select. It would be interesting if the server
-    supports multiple protocols or protocol versions. The value must
-    be interpreted as UTF-8.&lt;/p&gt;
+    supports multiple protocols or protocol versions.&lt;/p&gt;
 
+    &lt;p&gt;Can be safely ignored, though the server may &lt;span&gt;abort the WebSocket
+    connection&lt;/span&gt; if the field is absent but the conventions for
+    communicating with the server are such that the field is
+    expected; and the server should &lt;span&gt;abort the WebSocket connection&lt;/span&gt;
+    if the field has a value that does not match one of the
+    subprotocols that the server supports, to avoid integrity errors
+    once the connection is established.&lt;/p&gt;
+
    &lt;/dd&gt;
 
+   &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-key1&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt;&lt;/dt&gt;
+   &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-key2&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The values provide the information required for computing the
+    server's handshake, as described in the next section.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;Other fields&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -77104,35 +77410,337 @@
     connect (e.g. because they are on an intranet firewalled from the
     public Internet), then the server should also verify that the
     client's handshake includes the invariant &quot;Upgrade&quot; and
-    &quot;Connection&quot; parts of the handshake. Otherwise, an attacker could
-    trick a client into sending Web Socket frames to a server
+    &quot;Connection&quot; parts of the handshake, and should send the server's
+    handshake before changing any user data. Otherwise, an attacker
+    could trick a client into sending WebSocket frames to a server
     (e.g. using &lt;code&gt;XMLHttpRequest&lt;/code&gt;) and cause the server to
     perform actions on behalf of the user without the user's
-    consent.&lt;/p&gt;
+    consent. (Sending the server's handshake ensures that the frames
+    were not sent as part of a cross-protocol attack, since other
+    protocols do not send the necessary components in the client's
+    initial handshake for forming the server's handshake.)&lt;/p&gt;
 
    &lt;/dd&gt;
 
   &lt;/dl&gt;
 
-  &lt;p&gt;A final field consisting of the empty string (two consecutive
-  CRLF pairs) indicates the end of the client's handshake.&lt;/p&gt;
+  &lt;p&gt;Unrecognised fields can be safely ignored, and are probably
+  either the result of intermediaries injecting fields unrelated to
+  the operation of the WebSocket protocol, or clients that support
+  future versions of the protocol offering options that the server
+  doesn't support.&lt;/p&gt;
 
-  &lt;p&gt;Any fields that lack the colon-space separator must at a minimum
-  be discarded and may cause the server to disconnect.&lt;/p&gt;
+  
+  &lt;h6&gt;Sending the server's handshake&lt;/h6&gt;
 
-  &lt;p&gt;Whether the server does or does not read the client handshake, it
-  must at a minimum read (and optionally discard) bytes until it has
-  read the first sequence of four bytes 0x0A 0x0D 0x0A 0x0D, which
-  signals the end of the client handshake. Servers may do this before
-  or after sending their handshake, but must do it before reading
-  frames from the client as described in the next section.&lt;/p&gt;
+  &lt;p&gt;When a client establishes a WebSocket connection to a server, the
+  server must run the following steps.&lt;/p&gt;
 
+  &lt;ol&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;If the server supports encryption, perform a TLS handshake over
+    the connection. If this fails (e.g. the client indicated a host
+    name in the extended client hello &quot;server_name&quot; extension that the
+    server does not host), then close the connection; otherwise, all
+    further communication for the connection (including the server
+    handshake) must run through the encrypted tunnel. &lt;a
+    href=&quot;#refsRFC2246&quot;&gt;[RFC2246]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Establish the following information:&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;host&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The host name or IP address of the WebSocket server, as it is
+     to be addressed by clients. The host name must be
+     punycode-encoded if necessary. If the server can respond to
+     requests to multiple hosts (e.g. in a virtual hosting
+     environment), then the value should be derived from the client's
+     handshake, specifically from the &quot;&lt;code
+     title=&quot;http-host&quot;&gt;Host&lt;/code&gt;&quot; field.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;port&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The port number on which the server expected and/or received
+     the connection.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;An identifier for the service provided by the server. If the
+     server provides multiple services, then the value should be
+     derived from the resource name given in the client's
+     handshake.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;secure flag&lt;/var&gt;&lt;dt&gt;
+
+     &lt;dd&gt;True if the connection is encrypted or if the server expected
+     it to be encrypted; false otherwise.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The &lt;span title=&quot;ASCII serialization of an origin&quot;&gt;ASCII
+     serialization&lt;/span&gt; of the origin that the server is willing to
+     communicate with. If the server can respond to requests from
+     multiple origins (or indeed, all origins), then the value should
+     be derived from the client's handshake, specifically from the
+     &quot;&lt;code title=&quot;http-origin&quot;&gt;Origin&lt;/code&gt;&quot; field. &lt;a
+     href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;Either null, or a string representing the subprotocol the
+     server is ready to use. If the server supports multiple
+     subprotocols, then the value should be derived from the client's
+     handshake, specifically from the &quot;&lt;code
+     title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;&quot;
+     field. The absence of such a field is equivalent to the null
+     value. The empty string is not the same as the null value for
+     these purposes.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key1&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The value of the &quot;&lt;code
+     title=&quot;http-sec-websocket-key1&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt;&quot;
+     field in the client's handshake.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key2&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The value of the &quot;&lt;code
+     title=&quot;http-sec-websocket-key2&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt;&quot;
+     field in the client's handshake.&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;var title=&quot;&quot;&gt;key3&lt;/var&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;The eight random bytes sent after the first 0x0D 0x0A 0x0D
+     0x0A sequence in the client's handshake.&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; be the string that results
+    from &lt;span title=&quot;construct a WebSocket URL&quot;&gt;constructing a
+    WebSocket URL&lt;/span&gt; from &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var
+    title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var
+    title=&quot;&quot;&gt;secure flag&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key1-number&lt;/var&gt; be the digits (characters
+    in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9)) in
+    &lt;var title=&quot;&quot;&gt;key1&lt;/var&gt;, interpreted as a base ten integer,
+    ignoring all other characters in &lt;var title=&quot;&quot;&gt;key1&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;key2-number&lt;/var&gt; be the digits (characters
+    in the range U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9)) in
+    &lt;var title=&quot;&quot;&gt;key2&lt;/var&gt;, interpreted as a base ten integer,
+    ignoring all other characters in &lt;var title=&quot;&quot;&gt;key2&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;div class=&quot;example&quot;&gt;
+
+     &lt;p&gt;For example, assume that the client handshake was:&lt;/p&gt;
+
+     &lt;pre&gt;GET / HTTP/1.1
+Connection: Upgrade
+Host: example.com
+Upgrade: WebSocket
+Sec-WebSocket-Key1: 3e6b263&nbsp;&nbsp;4&nbsp;17&nbsp;80
+Origin: <A HREF="http://example.com">http://example.com</A>
+Sec-WebSocket-Key2: 17&nbsp;&nbsp;9&nbsp;G`ZD9&nbsp;&nbsp;&nbsp;2&nbsp;2b&nbsp;7X&nbsp;3&nbsp;/r90
+
+WjN}|M(6&lt;/pre&gt;
+
+     &lt;p&gt;The &lt;var title=&quot;&quot;&gt;key1-number&lt;/var&gt; would be the number
+     3,626,341,780, and the &lt;var title=&quot;&quot;&gt;key2-number&lt;/var&gt; would be
+     the number 1,799,227,390.&lt;/p&gt;
+
+     &lt;p&gt;In this example, incidentally, &lt;var title=&quot;&quot;&gt;key3&lt;/var&gt; is
+     &quot;WjN}|M(6&quot;, or 0x57 0x6A 0x4E 0x7D 0x7C 0x4D 0x28 0x36.&lt;/p&gt;
+
+    &lt;/div&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt; be the number of U+0020 SPACE
+    characters in &lt;var title=&quot;&quot;&gt;key1&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt; be the number of U+0020 SPACE
+    characters in &lt;var title=&quot;&quot;&gt;key2&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If either &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt; or &lt;var
+    title=&quot;&quot;&gt;spaces2&lt;/var&gt; is zero, then &lt;span&gt;abort the WebSocket
+    connection&lt;/span&gt;. This is a symptom of a cross-protocol
+    attack.&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;In the example above, &lt;var
+    title=&quot;&quot;&gt;spaces1&lt;/var&gt; would be 4 and &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt;
+    would be 10.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;key1-number&lt;/var&gt; is not an integral multiple
+    of &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt;, then &lt;span&gt;abort the WebSocket
+    connection&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;key2-number&lt;/var&gt; is not an integral multiple
+    of &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt;, then &lt;span&gt;abort the WebSocket
+    connection&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;This can only happen if the client is not a
+    conforming WebSocket client.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part1&lt;/var&gt; be &lt;var
+    title=&quot;&quot;&gt;key1-number&lt;/var&gt; divided by &lt;var title=&quot;&quot;&gt;spaces1&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part2&lt;/var&gt; be &lt;var
+    title=&quot;&quot;&gt;key2-number&lt;/var&gt; divided by &lt;var title=&quot;&quot;&gt;spaces2&lt;/var&gt;.&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;In the example above, &lt;var title=&quot;&quot;&gt;part1&lt;/var&gt;
+    would be 906,585,445 and &lt;var title=&quot;&quot;&gt;part2&lt;/var&gt; would be
+    179,922,739.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;challenge&lt;/var&gt; be the concatenation of &lt;var
+    title=&quot;&quot;&gt;part1&lt;/var&gt;, expressed as a little-endian 32 bit integer,
+    &lt;var title=&quot;&quot;&gt;part2&lt;/var&gt;, expressed as a little-endian 32 bit
+    integer, and the eight bytes of &lt;var title=&quot;&quot;&gt;key3&lt;/var&gt; in the
+    order they were sent on the wire.&lt;/p&gt;
+
+    &lt;!--
+    perl -e 'foreach (@ARGV) { print pack 'N', $_ }' 906585445 179922739 | hexdump -C
+    --&gt;
+
+    &lt;p class=&quot;example&quot;&gt;In the example above, this would be the 16
+    bytes 0x36 0x09 0x65 0x65 0x0A 0xB9 0x67 0x33 0x57 0x6A 0x4E 0x7D
+    0x7C 0x4D 0x28 0x36.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;response&lt;/var&gt; be the MD5 fingerprint of &lt;var
+    title=&quot;&quot;&gt;challenge&lt;/var&gt; as a little-endian 128 bit string. &lt;a
+    href=&quot;#refsRFC1321&quot;&gt;[RFC1321]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;!--
+    perl -e &quot;print pack 'c*', map { hex } @ARGV&quot; 0x36 0x09 0x65 0x65 0x0A 0xB9 0x67 0x33 0x57 0x6A 0x4E 0x7D 0x7C 0x4D 0x28 0x36 | md5sum -b
+    --&gt;
+
+    &lt;p class=&quot;example&quot;&gt;In the example above, this would be the 16
+    bytes 0x6E 0x60 0x39 0x65 0x42 0x6B 0x39 0x7A 0x24 0x52 0x38 0x70
+    0x4F 0x74 0x56 0x62, or &quot;n`9eBk9z$R8pOtVb&quot; in ASCII.
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send the following line, terminated by the two characters
+    U+000D CARRIAGE RETURN and U+000A LINE FEED (CRLF) and encoded as
+    UTF-8, to the client:&lt;/p&gt;
+
+    &lt;pre&gt;HTTP/1.1 101 WebSocket Protocol Handshake&lt;/pre&gt;
+
+    &lt;p&gt;This line may be sent differently if necessary, but must match
+    the Status-Line production defined in the HTTP specification, with
+    the Status-Code having the value 101.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send the following fields to the client. Each field must be
+    sent as a line consisting of the field name, which must be an
+    &lt;span&gt;ASCII case-insensitive&lt;/span&gt; match for the field name in
+    the list below, followed by a U+003A COLON character (:) and a
+    U+0020 SPACE character, followed by the field value as specified
+    in the list below, followed by the two characters U+000D CARRIAGE
+    RETURN and U+000A LINE FEED (CRLF). The lines must be encoded as
+    UTF-8. The lines may be sent in any order.&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;http-upgrade&quot;&gt;Upgrade&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The value must be the string &quot;WebSocket&quot;.&lt;/p&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;http-connection&quot;&gt;Connection&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The value must be the string &quot;Upgrade&quot;.&lt;/p&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-location&quot;&gt;Sec-WebSocket-Location&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The value must be &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;&lt;/p&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-origin&quot;&gt;Sec-WebSocket-Origin&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The value must be &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;&lt;/p&gt;&lt;/dd&gt;
+
+     &lt;dt&gt;&lt;code title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;This field must be included if &lt;var
+      title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is not null, and must not be included
+      if &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt; is null.&lt;/p&gt;
+
+      &lt;p&gt;If included, the value must be &lt;var title=&quot;&quot;&gt;subprotocol&lt;/var&gt;&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send two bytes 0x0D 0x0A (ASCII CRLF).&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Send &lt;var title=&quot;&quot;&gt;response&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p&gt;This completes the server's handshake. If the server finishes
+  these steps without &lt;span title=&quot;abort the WebSocket
+  connection&quot;&gt;aborting the WebSocket connection&lt;/span&gt;, and if the
+  client does not then &lt;span&gt;fail the connection&lt;/span&gt;, then the
+  connection is established and the server may begin and receiving
+  sending data, as described in the next section.&lt;/p&gt;
+
+
+
   &lt;h6 id=&quot;ws-sd-framing&quot;&gt;Data framing&lt;/h6&gt;
 
   &lt;p&gt;The server must run through the following steps to process the
   bytes sent by the client.  If at any point during these steps a read
-  is attempted but fails because the &lt;span&gt;Web Socket connection is
+  is attempted but fails because the &lt;span&gt;WebSocket connection is
   closed&lt;/span&gt;, then abort.&lt;/p&gt;
 
   &lt;ol&gt;
@@ -77226,6 +77834,13 @@
   &lt;/ol&gt;
 
 
+  &lt;h6&gt;Aborting the connection&lt;/h6&gt;
+
+  &lt;p&gt;To &lt;dfn&gt;abort the WebSocket connection&lt;/dfn&gt; during the
+  handshake, the server must &lt;span&gt;close the WebSocket
+  connection&lt;/span&gt;.&lt;/p&gt;
+
+
   &lt;h6&gt;Handling errors in UTF-8&lt;/h6&gt;
 
   &lt;p&gt;When a server is to interpret a byte stream as UTF-8 but finds
@@ -77233,23 +77848,25 @@
   is undefined. A server could close the connection, convert invalid
   byte sequences to U+FFFD REPLACEMENT CHARACTERs, store the data
   verbatim, or perform application-specific processing. Subprotocols
-  layered on the Web Socket protocol might define specific behavior
+  layered on the WebSocket protocol might define specific behavior
   for servers.&lt;/p&gt;
 
 
 
   &lt;h5&gt;Closing the connection&lt;/h5&gt;
 
-  &lt;p&gt;To &lt;dfn&gt;close the Web Socket connection&lt;/dfn&gt;, either the user
-  agent or the server closes the TCP/IP connection. There is no
+  &lt;p&gt;To &lt;dfn&gt;close the WebSocket connection&lt;/dfn&gt;, either the user
+  agent or the server closes the TCP connection. There is no
   closing handshake. When a user agent notices that the server has
   closed its connection, it must immediately close its side of the
   connection also. Whether the user agent or the server closes the
-  connection first, it is said that the &lt;dfn&gt;Web Socket connection is
+  connection first, it is said that the &lt;dfn&gt;WebSocket connection is
   closed&lt;/dfn&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Servers may &lt;span&gt;close the Web Socket connection&lt;/span&gt; whenever
-  desired. User agents should not &lt;span&gt;close the Web Socket
+  &lt;!-- XXX Close Handshake but NOT for FAILing or ABORTing --&gt;
+
+  &lt;p&gt;Servers may &lt;span&gt;close the WebSocket connection&lt;/span&gt; whenever
+  desired. User agents should not &lt;span&gt;close the WebSocket
   connection&lt;/span&gt; arbitrarily.&lt;/p&gt;
 
 
@@ -77258,7 +77875,7 @@
 
   &lt;p&gt;While this protocol is intended to be used by scripts in Web
   pages, it can also be used directly by hosts. Such hosts are acting
-  on their own behalf, and can therefore send fake &quot;Origin&quot; headers,
+  on their own behalf, and can therefore send fake &quot;Origin&quot; fields,
   misleading the server. Servers should therefore be careful about
   assuming that they are talking directly to scripts from known
   origins, and must consider that they might be accessed in unexpected
@@ -77272,12 +77889,12 @@
   &lt;hr&gt;
 
   &lt;p&gt;Servers that are not intended to process input from any Web page
-  but only for certain sites should verify the &quot;Origin&quot; header is an
+  but only for certain sites should verify the &quot;Origin&quot; field is an
   origin they expect, and should only respond with the corresponding
-  &quot;WebSocket-Origin&quot; if it is an accepted origin. Servers that only
-  accept input from one origin can just send back that value in the
-  &quot;WebSocket-Origin&quot; header, without bothering to check the client's
-  value.&lt;/p&gt;
+  &quot;Sec-WebSocket-Origin&quot; if it is an accepted origin. Servers that
+  only accept input from one origin can just send back that value in
+  the &quot;Sec-WebSocket-Origin&quot; field, without bothering to check the
+  client's value.&lt;/p&gt;
 
   &lt;hr&gt;
 
@@ -77301,7 +77918,7 @@
 
   &lt;h6&gt;Registration of &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; scheme&lt;/h6&gt;
 
-  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; URL identifies a Web Socket server
+  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;ws:&lt;/code&gt; URL identifies a WebSocket server
   and resource name.&lt;/p&gt;
 
   &lt;dl&gt;
@@ -77330,7 +77947,7 @@
 
    &lt;dt&gt;URI scheme semantics.&lt;/dt&gt;
    &lt;dd&gt;The only operation for this scheme is to open a connection
-   using the Web Socket protocol.&lt;/dd&gt;
+   using the WebSocket protocol.&lt;/dd&gt;
 
    &lt;dt&gt;Encoding considerations.&lt;/dt&gt;
    &lt;dd&gt;
@@ -77353,7 +77970,7 @@
    &lt;/dd&gt;
 
    &lt;dt&gt;Applications/protocols that use this URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;Web Socket protocol.&lt;/dd&gt;
+   &lt;dd&gt;WebSocket protocol.&lt;/dd&gt;
 
    &lt;dt&gt;Interoperability considerations.&lt;/dt&gt;
    &lt;dd&gt;None.&lt;/dd&gt;
@@ -77375,7 +77992,7 @@
 
   &lt;h6&gt;Registration of &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; scheme&lt;/h6&gt;
 
-  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; URL identifies a Web Socket server
+  &lt;p&gt;A &lt;code title=&quot;&quot;&gt;wss:&lt;/code&gt; URL identifies a WebSocket server
   and resource name, and indicates that traffic over that connection
   is to be encrypted.&lt;/p&gt;
 
@@ -77404,7 +78021,7 @@
 
    &lt;dt&gt;URI scheme semantics.&lt;/dt&gt;
    &lt;dd&gt;The only operation for this scheme is to open a connection
-   using the Web Socket protocol, encrypted using TLS.&lt;/dd&gt;
+   using the WebSocket protocol, encrypted using TLS.&lt;/dd&gt;
 
    &lt;dt&gt;Encoding considerations.&lt;/dt&gt;
    &lt;dd&gt;
@@ -77427,7 +78044,7 @@
    &lt;/dd&gt;
 
    &lt;dt&gt;Applications/protocols that use this URI scheme name.&lt;/dt&gt;
-   &lt;dd&gt;Web Socket protocol over TLS.&lt;/dd&gt;
+   &lt;dd&gt;WebSocket protocol over TLS.&lt;/dd&gt;
 
    &lt;dt&gt;Interoperability considerations.&lt;/dt&gt;
    &lt;dd&gt;None.&lt;/dd&gt;
@@ -77467,19 +78084,70 @@
 
 
 
-  &lt;h6&gt;&lt;dfn title=&quot;http-websocket-origin&quot;&gt;&lt;code&gt;WebSocket-Origin&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
+  &lt;h6&gt;&lt;dfn title=&quot;http-sec-websocket-key1&quot;&gt;&lt;code&gt;Sec-WebSocket-Key1&lt;/code&gt;&lt;/dfn&gt; and &lt;dfn title=&quot;http-sec-websocket-key2&quot;&gt;&lt;code&gt;Sec-WebSocket-Key2&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
 
+  &lt;p&gt;This section describes two header fields for registration in the
+  Permanent Message Header Field Registry.  &lt;a
+  href=&quot;#refsRFC3864&quot;&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;dl&gt;
+   &lt;dt&gt;Header field name&lt;/dt&gt;
+   &lt;dd&gt;Sec-WebSocket-Key1&lt;/dd&gt;
+   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
+   &lt;dd&gt;http&lt;/dd&gt;
+   &lt;dt&gt;Status&lt;/dt&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
+   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
+   &lt;dd&gt;IETF&lt;/dd&gt;
+   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
+   &lt;dd&gt;
+    This document is the relevant specification.
+   &lt;/dd&gt;
+   &lt;dt&gt;Related information&lt;/dt&gt;
+   &lt;dd&gt;None.&lt;/dd&gt;   
+  &lt;/dl&gt;
+
+  &lt;dl&gt;
+   &lt;dt&gt;Header field name&lt;/dt&gt;
+   &lt;dd&gt;Sec-WebSocket-Key2&lt;/dd&gt;
+   &lt;dt&gt;Applicable protocol&lt;/dt&gt;
+   &lt;dd&gt;http&lt;/dd&gt;
+   &lt;dt&gt;Status&lt;/dt&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
+   &lt;dt&gt;Author/Change controller&lt;/dt&gt;
+   &lt;dd&gt;IETF&lt;/dd&gt;
+   &lt;dt&gt;Specification document(s)&lt;/dt&gt;
+   &lt;dd&gt;
+    This document is the relevant specification.
+   &lt;/dd&gt;
+   &lt;dt&gt;Related information&lt;/dt&gt;
+   &lt;dd&gt;None.&lt;/dd&gt;   
+  &lt;/dl&gt;
+
+  &lt;p&gt;The &lt;code
+  title=&quot;http-sec-websocket-key1&quot;&gt;Sec-WebSocket-Key1&lt;/code&gt; and &lt;code
+  title=&quot;http-sec-websocket-key2&quot;&gt;Sec-WebSocket-Key2&lt;/code&gt; headers
+  are used in the WebSocket handshake. They are sent from the client
+  to the server to provide part of the information used by the server
+  to prove that it received a valid WebSocket handshake. This helps
+  ensure that the server does not accept connections from
+  non-Web-Socket clients (e.g. HTTP clients) that are being abused to
+  send data to unsuspecting WebSocket servers.&lt;/p&gt;
+
+
+  &lt;h6&gt;&lt;dfn title=&quot;http-sec-websocket-location&quot;&gt;&lt;code&gt;Sec-WebSocket-Location&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
+
   &lt;p&gt;This section describes a header field for registration in the
   Permanent Message Header Field Registry.  &lt;a
   href=&quot;#refsRFC3864&quot;&gt;[RFC3864]&lt;/a&gt;&lt;/p&gt;
 
   &lt;dl&gt;
    &lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;WebSocket-Origin&lt;/dd&gt;
+   &lt;dd&gt;Sec-WebSocket-Location&lt;/dd&gt;
    &lt;dt&gt;Applicable protocol&lt;/dt&gt;
    &lt;dd&gt;http&lt;/dd&gt;
    &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside Web Socket handshake&lt;/dd&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
    &lt;dt&gt;Author/Change controller&lt;/dt&gt;
    &lt;dd&gt;IETF&lt;/dd&gt;
    &lt;dt&gt;Specification document(s)&lt;/dt&gt;
@@ -77490,14 +78158,17 @@
    &lt;dd&gt;None.&lt;/dd&gt;   
   &lt;/dl&gt;
 
-  &lt;p&gt;The &lt;code&gt;WebSocket-Origin&lt;/code&gt; header is used in the Web
-  Socket handshake. It is sent from the server to the client to
-  confirm the &lt;span&gt;origin&lt;/span&gt; of the script that opened the
-  connection. This enables user agents to verify that the server is
-  willing to serve the script that opened the connection.&lt;/p&gt;
+  &lt;p&gt;The &lt;code
+  title=&quot;http-sec-websocket-location&quot;&gt;Sec-WebSocket-Location&lt;/code&gt;
+  header is used in the WebSocket handshake. It is sent from the
+  server to the client to confirm the &lt;span&gt;URL&lt;/span&gt; of the
+  connection. This enables the client to verify that the connection
+  was established to the right server, port, and path, instead of
+  relying on the server to verify that the requested host, port, and
+  path are correct.&lt;/p&gt;
 
 
-  &lt;h6&gt;&lt;dfn title=&quot;http-websocket-protocol&quot;&gt;&lt;code&gt;WebSocket-Protocol&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
+  &lt;h6&gt;&lt;dfn title=&quot;http-sec-websocket-origin&quot;&gt;&lt;code&gt;Sec-WebSocket-Origin&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
 
   &lt;p&gt;This section describes a header field for registration in the
   Permanent Message Header Field Registry.  &lt;a
@@ -77505,11 +78176,11 @@
 
   &lt;dl&gt;
    &lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;WebSocket-Protocol&lt;/dd&gt;
+   &lt;dd&gt;Sec-WebSocket-Origin&lt;/dd&gt;
    &lt;dt&gt;Applicable protocol&lt;/dt&gt;
    &lt;dd&gt;http&lt;/dd&gt;
    &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside Web Socket handshake&lt;/dd&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
    &lt;dt&gt;Author/Change controller&lt;/dt&gt;
    &lt;dd&gt;IETF&lt;/dd&gt;
    &lt;dt&gt;Specification document(s)&lt;/dt&gt;
@@ -77520,14 +78191,16 @@
    &lt;dd&gt;None.&lt;/dd&gt;   
   &lt;/dl&gt;
 
-  &lt;p&gt;The &lt;code&gt;WebSocket-Protocol&lt;/code&gt; header is used in the Web
-  Socket handshake. It is sent from the client to the server and back
-  from the server to the client to confirm the subprotocol of the
-  connection. This enables scripts to both select a subprotocol and be
-  sure that the server agreed to serve that subprotocol.&lt;/p&gt;
+  &lt;p&gt;The &lt;code
+  title=&quot;http-sec-websocket-origin&quot;&gt;Sec-WebSocket-Origin&lt;/code&gt; header
+  is used in the WebSocket handshake. It is sent from the server to
+  the client to confirm the &lt;span&gt;origin&lt;/span&gt; of the script that
+  opened the connection. This enables user agents to verify that the
+  server is willing to serve the script that opened the
+  connection.&lt;/p&gt;
 
 
-  &lt;h6&gt;&lt;dfn title=&quot;http-websocket-location&quot;&gt;&lt;code&gt;WebSocket-Location&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
+  &lt;h6&gt;&lt;dfn title=&quot;http-sec-websocket-protocol&quot;&gt;&lt;code&gt;Sec-WebSocket-Protocol&lt;/code&gt;&lt;/dfn&gt;&lt;/h6&gt;
 
   &lt;p&gt;This section describes a header field for registration in the
   Permanent Message Header Field Registry.  &lt;a
@@ -77535,11 +78208,11 @@
 
   &lt;dl&gt;
    &lt;dt&gt;Header field name&lt;/dt&gt;
-   &lt;dd&gt;WebSocket-Location&lt;/dd&gt;
+   &lt;dd&gt;Sec-WebSocket-Protocol&lt;/dd&gt;
    &lt;dt&gt;Applicable protocol&lt;/dt&gt;
    &lt;dd&gt;http&lt;/dd&gt;
    &lt;dt&gt;Status&lt;/dt&gt;
-   &lt;dd&gt;reserved; do not use outside Web Socket handshake&lt;/dd&gt;
+   &lt;dd&gt;reserved; do not use outside WebSocket handshake&lt;/dd&gt;
    &lt;dt&gt;Author/Change controller&lt;/dt&gt;
    &lt;dd&gt;IETF&lt;/dd&gt;
    &lt;dt&gt;Specification document(s)&lt;/dt&gt;
@@ -77550,24 +78223,25 @@
    &lt;dd&gt;None.&lt;/dd&gt;   
   &lt;/dl&gt;
 
-  &lt;p&gt;The &lt;code&gt;WebSocket-Location&lt;/code&gt; header is used in the Web
-  Socket handshake. It is sent from the server to the client to
-  confirm the &lt;span&gt;URL&lt;/span&gt; of the connection. This enables the
-  client to verify that the connection was established to the right
-  server, port, and path, instead of relying on the server to verify
-  that the requested host, port, and path are correct.&lt;/p&gt;
+  &lt;p&gt;The &lt;code
+  title=&quot;http-sec-websocket-protocol&quot;&gt;Sec-WebSocket-Protocol&lt;/code&gt;
+  header is used in the WebSocket handshake. It is sent from the
+  client to the server and back from the server to the client to
+  confirm the subprotocol of the connection. This enables scripts to
+  both select a subprotocol and be sure that the server agreed to
+  serve that subprotocol.&lt;/p&gt;
 
 
 
 
-  &lt;h5&gt;Using the Web Socket protocol from other specifications&lt;/h5&gt;
+  &lt;h5&gt;Using the WebSocket protocol from other specifications&lt;/h5&gt;
 
-  &lt;p&gt;The Web Socket protocol is intended to be used by another
+  &lt;p&gt;The WebSocket protocol is intended to be used by another
   specification to provide a generic mechanism for dynamic
   author-defined content, e.g. in a specification defining a scripted
   API.&lt;/p&gt;
 
-  &lt;p&gt;Such a specification first needs to &quot;&lt;span&gt;establish a Web Socket
+  &lt;p&gt;Such a specification first needs to &quot;&lt;span&gt;establish a WebSocket
   connection&lt;/span&gt;&quot;, providing that algorithm with:&lt;/p&gt;
 
   &lt;ul&gt;
@@ -77586,41 +78260,41 @@
    href=&quot;#refsORIGIN&quot;&gt;[ORIGIN]&lt;/a&gt;&lt;/li&gt;
 
    &lt;li&gt;Optionally a string identifying a &lt;span&gt;protocol&lt;/span&gt; that is
-   to be layered over the Web Socket connection.&lt;/li&gt;
+   to be layered over the WebSocket connection.&lt;/li&gt;
 
   &lt;/ul&gt;
 
   &lt;p&gt;The &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
   title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag
   are usually obtained from a &lt;span&gt;URL&lt;/span&gt; using the steps to
-  &lt;span&gt;parse a Web Socket URL's components&lt;/span&gt;. These steps fail
-  if the URL does not specify a Web Socket.&lt;/p&gt;
+  &lt;span&gt;parse a WebSocket URL's components&lt;/span&gt;. These steps fail
+  if the URL does not specify a WebSocket.&lt;/p&gt;
 
   &lt;p&gt;If a connection can be established, then it is said that the
-  &quot;&lt;span&gt;Web Socket connection is established&lt;/span&gt;&quot;.&lt;/p&gt;
+  &quot;&lt;span&gt;WebSocket connection is established&lt;/span&gt;&quot;.&lt;/p&gt;
 
   &lt;p&gt;If at any time the connection is to be closed, then the
-  specification needs to use the &quot;&lt;span&gt;close the Web Socket
+  specification needs to use the &quot;&lt;span&gt;close the WebSocket
   connection&lt;/span&gt;&quot; algorithm.&lt;/p&gt;
 
   &lt;p&gt;When the connection is closed, for any reason including failure
   to establish the connection in the first place, it is said that the
-  &quot;&lt;span&gt;Web Socket connection is closed&lt;/span&gt;&quot;.&lt;/p&gt;
+  &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;.&lt;/p&gt;
 
   &lt;p&gt;While a connection is open, the specification will need to handle
-  the cases when &quot;&lt;span&gt;a Web Socket message has been received&lt;/span&gt;&quot;
+  the cases when &quot;&lt;span&gt;a WebSocket message has been received&lt;/span&gt;&quot;
   with text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;.&lt;/p&gt;
 
   &lt;p&gt;To send some text &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; to an open connection,
   the specification needs to &quot;&lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;
-  using the Web Socket&lt;/span&gt;&quot;.&lt;/p&gt;
+  using the WebSocket&lt;/span&gt;&quot;.&lt;/p&gt;
 
 
   &lt;!--END complete--&gt;
 
   &lt;h5&gt;Acknowledgements&lt;/h5&gt;
 
-  &lt;p&gt;The Web Socket protocol is the result of many years of
+  &lt;p&gt;The WebSocket protocol is the result of many years of
   development, and as such hundreds of people have contributed to the
   specification during its lifetime. Unfortunately, since the
   specification started as nothing but a minor section of the larger
@@ -99785,6 +100459,10 @@
    Names - Concepts and Facilities&lt;/a&gt;&lt;/cite&gt;, P. Mockapetris. IETF,
    November 1987.&lt;/dd&gt;
 
+   &lt;dt id=&quot;refsRFC1321&quot;&gt;[RFC1321]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.ietf.org/rfc/rfc1321.txt">http://www.ietf.org/rfc/rfc1321.txt</A>&quot;&gt;The MD5
+   Message-Digest Algorithm&lt;/a&gt;&lt;/cite&gt;, R. Rivest. IETF.&lt;/dd&gt;
+
    &lt;dt id=&quot;refsRFC1345&quot;&gt;[RFC1345]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.ietf.org/rfc/rfc1345.txt">http://www.ietf.org/rfc/rfc1345.txt</A>&quot;&gt;Character Mnemonics
    and Character Sets&lt;/a&gt;&lt;/cite&gt;, K. Simonsen. IETF.&lt;/dd&gt;
@@ -100059,10 +100737,10 @@
 
    &lt;dt id=&quot;refsWEBSOCKET&quot;&gt;[WEBSOCKET]&lt;/dt&gt;
    &lt;!--
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</A>&quot;&gt;The Web Sockets
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</A>&quot;&gt;The WebSocket
    API&lt;/a&gt;&lt;/cite&gt;, I. Hickson. W3C.&lt;/dd&gt;
    --&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&quot;&gt;The Web Sockets
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&quot;&gt;The WebSocket
    API&lt;/a&gt;&lt;/cite&gt;, I. Hickson. W3C.&lt;/dd&gt;
 
    &lt;dt id=&quot;refsWEBSQL&quot;&gt;[WEBSQL]&lt;/dt&gt;
@@ -100105,10 +100783,10 @@
 
    &lt;dt id=&quot;refsWSAPI&quot;&gt;[WSAPI]&lt;/dt&gt;
    &lt;!--
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</A>&quot;&gt;Web Sockets
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</A>&quot;&gt;WebSocket
    API&lt;/a&gt;&lt;/cite&gt;, I. Hickson. W3C.&lt;/dd&gt;
    --&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&quot;&gt;Web Sockets
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</A>&quot;&gt;WebSocket
    API&lt;/a&gt;&lt;/cite&gt;, I. Hickson. W3C.&lt;/dd&gt;
 
    &lt;dt id=&quot;refsX121&quot;&gt;[X121]&lt;/dt&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011681.html">[html5] r4813 - [e] (0) Make this more readable. Fixing	http://www.w3.org/Bugs/Public/show_bug.c [...]
</A></li>
	<LI>Next message: <A HREF="011683.html">[html5] r4815 - [e] (0) abnf typos
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11682">[ date ]</a>
              <a href="thread.html#11682">[ thread ]</a>
              <a href="subject.html#11682">[ subject ]</a>
              <a href="author.html#11682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
