<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r5147 - [giow] (0) Captions - Stage 21.1: rendering: the	beginning.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5147%20-%20%5Bgiow%5D%20%280%29%20Captions%20-%20Stage%2021.1%3A%20rendering%3A%20the%0A%09beginning.&In-Reply-To=%3C20100709192959.ECFCD1C8C003%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012016.html">
   <LINK REL="Next"  HREF="012018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r5147 - [giow] (0) Captions - Stage 21.1: rendering: the	beginning.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5147%20-%20%5Bgiow%5D%20%280%29%20Captions%20-%20Stage%2021.1%3A%20rendering%3A%20the%0A%09beginning.&In-Reply-To=%3C20100709192959.ECFCD1C8C003%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r5147 - [giow] (0) Captions - Stage 21.1: rendering: the	beginning.">whatwg at whatwg.org
       </A><BR>
    <I>Fri Jul  9 12:29:59 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="012016.html">[html5] r5146 - [e] (0) xref
</A></li>
        <LI>Next message: <A HREF="012018.html">[html5] r5148 - [giow] (0) Captions - Stage 21.2: rendering: wip.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12017">[ date ]</a>
              <a href="thread.html#12017">[ thread ]</a>
              <a href="subject.html#12017">[ subject ]</a>
              <a href="author.html#12017">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-07-09 12:29:58 -0700 (Fri, 09 Jul 2010)
New Revision: 5147

Modified:
   complete.html
   index
   source
Log:
[giow] (0) Captions - Stage 21.1: rendering: the beginning.

Modified: complete.html
===================================================================
--- complete.html	2010-07-09 00:26:29 UTC (rev 5146)
+++ complete.html	2010-07-09 19:29:58 UTC (rev 5147)
@@ -23132,6 +23132,14 @@
   particular playback position is defined by the video stream's
   format.&lt;/p&gt;
 
+&lt;!--TT--&gt;
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt; element also &lt;a href=#represents&gt;represents&lt;/a&gt; any
+  &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;timed track cues&lt;/a&gt; whose
+  &lt;a href=#timed-track-cue-active-flag&gt;timed track cue active flag&lt;/a&gt; is set and whose
+  &lt;a href=#timed-track&gt;timed track&lt;/a&gt; is in the &lt;a href=#timed-track-showing title=&quot;timed track
+  showing&quot;&gt;showing&lt;/a&gt; mode.&lt;/p&gt;
+&lt;!--TT--&gt;
+
   &lt;p&gt;In addition to the above, the user agent may provide messages to
   the user (such as &quot;buffering&quot;, &quot;no video loaded&quot;, &quot;error&quot;, or more
   detailed information) by overlaying text or icons on the video or
@@ -25691,12 +25699,15 @@
   agent must run the following steps. If the &lt;a href=#current-playback-position&gt;current playback
   position&lt;/a&gt; changes while the steps are running, then the user
   agent must wait for the steps to complete, and then must immediately
-  rerun the steps. (These steps are thus run as often as possible or
-  needed &mdash; if one iteration takes a long time, this can cause
-  certain &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; to be skipped over
-  as the user agent rushes ahead to &quot;catch up&quot;.)&lt;/p&gt;
+  rerun the steps.
+&lt;!--TT--&gt;
+  (These steps are thus run as often as possible or needed &mdash; if
+  one iteration takes a long time, this can cause certain &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; to be skipped over as the user
+  agent rushes ahead to &quot;catch up&quot;.)
+&lt;!--TT--&gt;
+  &lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt; be an ordered list of
+  &lt;ol&gt;&lt;!--TT--&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt; be an ordered list of
    &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt;, initialized to contain
    all the &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; of all the &lt;a href=#timed-track-hidden title=&quot;timed track hidden&quot;&gt;hidden&lt;/a&gt; or &lt;a href=#timed-track-showing title=&quot;timed
    track showing&quot;&gt;showing&lt;/a&gt; &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
@@ -25713,6 +25724,7 @@
    tracks&lt;/a&gt; of the &lt;a href=#media-element&gt;media element&lt;/a&gt; that are not
    present in &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt;, also in &lt;a href=#timed-track-cue-order&gt;timed
    track cue order&lt;/a&gt;.&lt;/li&gt;
+&lt;!--TT--&gt;
 
    &lt;li&gt;&lt;p&gt;If the time was reached through the usual monotonic increase
    of the current playback position during normal playback, and if the
@@ -25732,6 +25744,7 @@
    not any more frequent than the user agent can comfortably handle
    while decoding the video.&lt;/li&gt;
 
+&lt;!--TT--&gt;
    &lt;li&gt;&lt;p&gt;If all of the &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; in
    &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt; have their &lt;a href=#timed-track-cue-active-flag&gt;timed track cue
    active flag&lt;/a&gt; set, and none of the &lt;a href=#timed-track-cue title=&quot;timed track
@@ -25789,13 +25802,20 @@
    active flag&lt;/a&gt; of all the &lt;a href=#timed-track-cue title=&quot;timed track
    cue&quot;&gt;cues&lt;/a&gt; in the &lt;var title=&quot;&quot;&gt;other cues&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Run the rules for rendering the cues of each of the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;affected
-   tracks&lt;/var&gt; that are &lt;a href=#timed-track-showing title=&quot;timed track
-   showing&quot;&gt;showing&lt;/a&gt; (e.g., for &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
-   tracks&lt;/a&gt; based on &lt;a href=#websrt&gt;WebSRT&lt;/a&gt;, the &lt;a href=#rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for
-   updating the display of WebSRT timed tracks&lt;/a&gt;).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Run the &lt;a href=#rules-for-updating-the-timed-track-rendering&gt;rules for updating the timed track
+   rendering&lt;/a&gt; of each of the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+   tracks&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;affected tracks&lt;/var&gt; that are &lt;a href=#timed-track-showing title=&quot;timed track showing&quot;&gt;showing&lt;/a&gt; (e.g., for &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; based on
+   &lt;a href=#websrt&gt;WebSRT&lt;/a&gt;, the &lt;a href=#rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for updating the display of
+   WebSRT timed tracks&lt;/a&gt;).&lt;/li&gt;
+&lt;!--TT--&gt;
 
-  &lt;/ol&gt;&lt;p&gt;When a &lt;a href=#media-element&gt;media element&lt;/a&gt; is &lt;a href=#remove-an-element-from-a-document title=&quot;remove an
+  &lt;/ol&gt;&lt;!--TT--&gt;&lt;p&gt;For the purposes of the algorithm above, a &lt;a href=#timed-track-cue&gt;timed track
+  cue&lt;/a&gt; is considered to of a &lt;a href=#timed-track&gt;timed track&lt;/a&gt; only if it
+  is listed in the &lt;a href=#timed-track-list-of-cues&gt;timed track list of cues&lt;/a&gt;, not merely
+  if it is associated with the &lt;a href=#timed-track&gt;timed track&lt;/a&gt;.&lt;/p&gt;
+&lt;!--TT--&gt;
+
+  &lt;p&gt;When a &lt;a href=#media-element&gt;media element&lt;/a&gt; is &lt;a href=#remove-an-element-from-a-document title=&quot;remove an
   element from a document&quot;&gt;removed from a
   &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;, if the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s
   &lt;code title=dom-media-networkState&gt;&lt;a href=#dom-media-networkstate&gt;networkState&lt;/a&gt;&lt;/code&gt; attribute
@@ -26296,9 +26316,28 @@
 
   &lt;dl&gt;&lt;dt&gt;The &lt;dfn id=timed-track-cue-active-flag title=&quot;timed track cue active flag&quot;&gt;active flag&lt;/dfn&gt;
    &lt;dd&gt;
-    &lt;p&gt;This flag must be initially unset. It is used to ensure events
-    are fired appropriately when the cue becomes active or
-    inactive.&lt;/p&gt;
+
+    &lt;p&gt;This flag must be initially unset.  The flag is used to ensure
+    events are fired appropriately when the cue becomes active or
+    inactive, and to make sure the right cues are rendered.&lt;/p&gt;
+
+    &lt;p&gt;The user agent must synchronously unset this flag whenever the
+    &lt;a href=#timed-track-cue&gt;timed track cue&lt;/a&gt; is removed from its &lt;a href=#timed-track&gt;timed
+    track&lt;/a&gt;'s &lt;a href=#timed-track-list-of-cues&gt;timed track list of cues&lt;/a&gt;; whenever the
+    &lt;a href=#timed-track&gt;timed track&lt;/a&gt; itself is removed from its &lt;a href=#media-element&gt;media
+    element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt; or has its
+    &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; changed to &lt;a href=#timed-track-disabled title=&quot;timed track
+    disabled&quot;&gt;disabled&lt;/a&gt;; and whenever the &lt;a href=#media-element&gt;media
+    element&lt;/a&gt;'s &lt;code title=dom-media-readyState&gt;&lt;a href=#dom-media-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; is changed back to
+    &lt;code title=dom-media-HAVE_NOTHING&gt;&lt;a href=#dom-media-have_nothing&gt;HAVE_NOTHING&lt;/a&gt;&lt;/code&gt;. When the
+    flag is unset in this way for one or more cues in &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; that were &lt;a href=#timed-track-showing title=&quot;timed track showing&quot;&gt;showing&lt;/a&gt; prior to the relevant
+    incident, the user agent must, after having unset the flag for all
+    the affected cues, apply the &lt;a href=#rules-for-updating-the-timed-track-rendering&gt;rules for updating the timed
+    track rendering&lt;/a&gt; of those &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+    tracks&lt;/a&gt; (e.g., for &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+    tracks&lt;/a&gt; based on &lt;a href=#websrt&gt;WebSRT&lt;/a&gt;, the &lt;a href=#rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for
+    updating the display of WebSRT timed tracks&lt;/a&gt;).&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;The &lt;dfn id=timed-track-cue-display-state title=&quot;timed track cue display state&quot;&gt;display state&lt;/dfn&gt;
@@ -26888,11 +26927,6 @@
     track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object represents to
     the &lt;a href=#timed-track-disabled&gt;timed track disabled&lt;/a&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; was previously the
-    &lt;a href=#timed-track-showing&gt;timed track showing&lt;/a&gt; mode, then apply the rules for
-    updating the timed track rendering of the &lt;a href=#media-element&gt;media
-    element&lt;/a&gt; appropriate for the &lt;a href=#timed-track&gt;timed track&lt;/a&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
    &lt;dt&gt;If the new value is 1&lt;/dt&gt;
@@ -26903,11 +26937,6 @@
     track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object represents to
     the &lt;a href=#timed-track-hidden&gt;timed track hidden&lt;/a&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; was previously the
-    &lt;a href=#timed-track-showing&gt;timed track showing&lt;/a&gt; mode, then apply the rules for
-    updating the timed track rendering of the &lt;a href=#media-element&gt;media
-    element&lt;/a&gt; appropriate for the &lt;a href=#timed-track&gt;timed track&lt;/a&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
    &lt;dt&gt;If the new value is 2&lt;/dt&gt;
@@ -26918,10 +26947,6 @@
     track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object represents to
     the &lt;a href=#timed-track-showing&gt;timed track showing&lt;/a&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;Apply the rules for updating the timed track rendering of the
-    &lt;a href=#media-element&gt;media element&lt;/a&gt; appropriate for the &lt;a href=#timed-track&gt;timed
-    track&lt;/a&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
   &lt;/dl&gt;&lt;p&gt;If the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; of the &lt;a href=#timed-track&gt;timed
@@ -26948,17 +26973,15 @@
   &lt;code&gt;&lt;a href=#timedtrackcuelist&gt;TimedTrackCueList&lt;/a&gt;&lt;/code&gt; object that represents the subset of
   the &lt;a href=#timed-track-list-of-cues&gt;timed track list of cues&lt;/a&gt; of the &lt;a href=#timed-track&gt;timed
   track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object represents
-  whose &lt;a href=#timed-track-cue-start-time title=&quot;timed track cue start time&quot;&gt;start times&lt;/a&gt;
-  occur before the &lt;a href=#current-playback-position-when-the-script-started&gt;current playback position when the script
-  started&lt;/a&gt; and whose &lt;a href=#timed-track-cue-end-time title=&quot;timed track cue end time&quot;&gt;end
-  times&lt;/a&gt; occur after the &lt;a href=#current-playback-position-when-the-script-started&gt;current playback position when
-  the script started&lt;/a&gt;, in &lt;a href=#timed-track-cue-order&gt;timed track cue
-  order&lt;/a&gt;. Otherwise, it must return null. When an object is
-  returned, the same object must be returned each time.&lt;/p&gt;
+  whose &lt;a href=#active-flag-was-set-when-the-script-started&gt;active flag was set when the script started&lt;/a&gt;, in
+  &lt;a href=#timed-track-cue-order&gt;timed track cue order&lt;/a&gt;. Otherwise, it must return
+  null. When an object is returned, the same object must be returned
+  each time.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=current-playback-position-when-the-script-started&gt;current playback position when the script started&lt;/dfn&gt;
-  is whatever the &lt;a href=#current-playback-position&gt;current playback position&lt;/a&gt; was the last
-  time the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; reached step 1.&lt;/p&gt;
+  &lt;p&gt;A &lt;a href=#timed-track-cue&gt;timed track cue&lt;/a&gt;'s &lt;dfn id=active-flag-was-set-when-the-script-started&gt;active flag was set when
+  the script started&lt;/dfn&gt; if its &lt;a href=#timed-track-cue-active-flag&gt;timed track cue active
+  flag&lt;/a&gt; was set the last time the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;
+  reached step 1.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -28797,11 +28820,7 @@
   user interface to the user&lt;/dfn&gt;. This user interface should include
   features to begin playback, pause playback, seek to an arbitrary
   position in the content (if the content supports arbitrary seeking),
-  change the volume, change the display of closed captions
-
-  &lt;!-- XXX update this to mention timed tracks --&gt;
-
-  or embedded
+  change the volume, change the display of closed captions or embedded
   sign-language tracks, select different audio tracks or turn on audio
   descriptions, and show the media content in manners more suitable to
   the user (e.g. full-screen video or in an independent resizable
@@ -86339,23 +86358,69 @@
 
   &lt;h5 id=websrt-cue-text-rendering-rules&gt;&lt;span class=secno&gt;14.3.2.1 &lt;/span&gt;&lt;dfn&gt;WebSRT cue text rendering rules&lt;/dfn&gt;&lt;/h5&gt;
 
-  &lt;p class=XXX&gt;The &lt;dfn id=rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for updating the display of WebSRT timed tracks&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn id=rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for updating the display of WebSRT timed
+  tracks&lt;/dfn&gt; render the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+  tracks&lt;/a&gt; of a &lt;a href=#media-element&gt;media element&lt;/a&gt; (specifically, a
+  &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt; element) by applying the steps below. All the
+  &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; that use these rules
+  for a given &lt;a href=#media-element&gt;media element&lt;/a&gt; are rendered together, to
+  avoid overlapping subtitles from multiple tracks.&lt;/p&gt;
 
-  &lt;!--
+  &lt;p&gt;The output of the steps below is a set of CSS boxes that covers
+  the rendering area of the &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
 
-   list of active WebSRT or WebSRT-compatible cues and their positions
-   (different than a track's list of active cues)
+  &lt;p&gt;The rules are as follows:&lt;/p&gt;
 
-   steps to run each time the current playback position changes, for
-   positioning:
-    - determine what cues are to be removed now
-    - remove them
-    - determine what cues are to be added now
-    - for each one:
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;a href=#media-element&gt;media element&lt;/a&gt; is an &lt;code&gt;&lt;a href=#audio&gt;audio&lt;/a&gt;&lt;/code&gt;
+   element, abort these steps. There is nothing to render.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty list of
+   absolutely positioned CSS block boxes.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;tracks&lt;/var&gt; be the subset of the
+   &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt; that
+   have as their &lt;a href=#rules-for-updating-the-timed-track-rendering&gt;rules for updating the timed track
+   rendering&lt;/a&gt; these &lt;a href=#rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for updating the display of
+   WebSRT timed tracks&lt;/a&gt;, and whose &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt;
+   is &lt;a href=#timed-track-showing title=&quot;timed track showing&quot;&gt;showing&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; be an empty list of &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;timed track cues&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each track &lt;var title=&quot;&quot;&gt;track&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;tracks&lt;/var&gt;, append to &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; all the
+   &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;track&lt;/var&gt;'s &lt;a href=#timed-track-list-of-cues title=&quot;timed track list of cues&quot;&gt;list
+   of cues&lt;/a&gt; that have their &lt;a href=#timed-track-cue-active-flag&gt;timed track cue active
+   flag&lt;/a&gt; set.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; in &lt;a href=#timed-track-cue-order&gt;timed track cue
+    order&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p class=note&gt;If the tracks and cues in the previous steps were
+    added to the lists in the same order as the lists from which they
+    were sourced, the &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; list will already be in
+    &lt;a href=#timed-track-cue-order&gt;timed track cue order&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each &lt;a href=#timed-track-cue&gt;timed track cue&lt;/a&gt; &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt;: if &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;a href=#timed-track-cue-display-state&gt;timed track cue display state&lt;/a&gt; has
+   a set of CSS boxes, then add those boxes to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, and remove &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p class=XXX&gt;...&lt;/p&gt;
+
+  &lt;!--XXX
+      for each cue in cues:
        - find default position per <A HREF="http://damowmow.com/temp/srtspec">http://damowmow.com/temp/srtspec</A>
        - shunt it around to fit the current active ones
        - add it to the list
+  --&gt;
 
+   &lt;/li&gt;
+
+  &lt;/ol&gt;&lt;!-- XXX
+
    rules for rendering the list of active cues:
     - for each segment, decide if it's before or after the current
       playback position.
@@ -86368,10 +86433,8 @@
    propagate towards the end of the segment so that it reaches the end
    of the segment when the next segment becomes &quot;before&quot;.
 
-  --&gt;
+  --&gt;&lt;h5 id=css-extensions&gt;&lt;span class=secno&gt;14.3.2.2 &lt;/span&gt;CSS extensions&lt;/h5&gt;
 
-  &lt;h5 id=css-extensions&gt;&lt;span class=secno&gt;14.3.2.2 &lt;/span&gt;CSS extensions&lt;/h5&gt;
-
   &lt;p class=note&gt;This section is intended to be moved to a CSS
   specification once an editor is found to run with it.&lt;/p&gt;
 

Modified: index
===================================================================
--- index	2010-07-09 00:26:29 UTC (rev 5146)
+++ index	2010-07-09 19:29:58 UTC (rev 5147)
@@ -23059,6 +23059,14 @@
   particular playback position is defined by the video stream's
   format.&lt;/p&gt;
 
+&lt;!--TT--&gt;
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt; element also &lt;a href=#represents&gt;represents&lt;/a&gt; any
+  &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;timed track cues&lt;/a&gt; whose
+  &lt;a href=#timed-track-cue-active-flag&gt;timed track cue active flag&lt;/a&gt; is set and whose
+  &lt;a href=#timed-track&gt;timed track&lt;/a&gt; is in the &lt;a href=#timed-track-showing title=&quot;timed track
+  showing&quot;&gt;showing&lt;/a&gt; mode.&lt;/p&gt;
+&lt;!--TT--&gt;
+
   &lt;p&gt;In addition to the above, the user agent may provide messages to
   the user (such as &quot;buffering&quot;, &quot;no video loaded&quot;, &quot;error&quot;, or more
   detailed information) by overlaying text or icons on the video or
@@ -25618,12 +25626,15 @@
   agent must run the following steps. If the &lt;a href=#current-playback-position&gt;current playback
   position&lt;/a&gt; changes while the steps are running, then the user
   agent must wait for the steps to complete, and then must immediately
-  rerun the steps. (These steps are thus run as often as possible or
-  needed &mdash; if one iteration takes a long time, this can cause
-  certain &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; to be skipped over
-  as the user agent rushes ahead to &quot;catch up&quot;.)&lt;/p&gt;
+  rerun the steps.
+&lt;!--TT--&gt;
+  (These steps are thus run as often as possible or needed &mdash; if
+  one iteration takes a long time, this can cause certain &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; to be skipped over as the user
+  agent rushes ahead to &quot;catch up&quot;.)
+&lt;!--TT--&gt;
+  &lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt; be an ordered list of
+  &lt;ol&gt;&lt;!--TT--&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt; be an ordered list of
    &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt;, initialized to contain
    all the &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; of all the &lt;a href=#timed-track-hidden title=&quot;timed track hidden&quot;&gt;hidden&lt;/a&gt; or &lt;a href=#timed-track-showing title=&quot;timed
    track showing&quot;&gt;showing&lt;/a&gt; &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
@@ -25640,6 +25651,7 @@
    tracks&lt;/a&gt; of the &lt;a href=#media-element&gt;media element&lt;/a&gt; that are not
    present in &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt;, also in &lt;a href=#timed-track-cue-order&gt;timed
    track cue order&lt;/a&gt;.&lt;/li&gt;
+&lt;!--TT--&gt;
 
    &lt;li&gt;&lt;p&gt;If the time was reached through the usual monotonic increase
    of the current playback position during normal playback, and if the
@@ -25659,6 +25671,7 @@
    not any more frequent than the user agent can comfortably handle
    while decoding the video.&lt;/li&gt;
 
+&lt;!--TT--&gt;
    &lt;li&gt;&lt;p&gt;If all of the &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; in
    &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt; have their &lt;a href=#timed-track-cue-active-flag&gt;timed track cue
    active flag&lt;/a&gt; set, and none of the &lt;a href=#timed-track-cue title=&quot;timed track
@@ -25716,13 +25729,20 @@
    active flag&lt;/a&gt; of all the &lt;a href=#timed-track-cue title=&quot;timed track
    cue&quot;&gt;cues&lt;/a&gt; in the &lt;var title=&quot;&quot;&gt;other cues&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Run the rules for rendering the cues of each of the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;affected
-   tracks&lt;/var&gt; that are &lt;a href=#timed-track-showing title=&quot;timed track
-   showing&quot;&gt;showing&lt;/a&gt; (e.g., for &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
-   tracks&lt;/a&gt; based on &lt;a href=#websrt&gt;WebSRT&lt;/a&gt;, the &lt;a href=#rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for
-   updating the display of WebSRT timed tracks&lt;/a&gt;).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Run the &lt;a href=#rules-for-updating-the-timed-track-rendering&gt;rules for updating the timed track
+   rendering&lt;/a&gt; of each of the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+   tracks&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;affected tracks&lt;/var&gt; that are &lt;a href=#timed-track-showing title=&quot;timed track showing&quot;&gt;showing&lt;/a&gt; (e.g., for &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; based on
+   &lt;a href=#websrt&gt;WebSRT&lt;/a&gt;, the &lt;a href=#rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for updating the display of
+   WebSRT timed tracks&lt;/a&gt;).&lt;/li&gt;
+&lt;!--TT--&gt;
 
-  &lt;/ol&gt;&lt;p&gt;When a &lt;a href=#media-element&gt;media element&lt;/a&gt; is &lt;a href=#remove-an-element-from-a-document title=&quot;remove an
+  &lt;/ol&gt;&lt;!--TT--&gt;&lt;p&gt;For the purposes of the algorithm above, a &lt;a href=#timed-track-cue&gt;timed track
+  cue&lt;/a&gt; is considered to of a &lt;a href=#timed-track&gt;timed track&lt;/a&gt; only if it
+  is listed in the &lt;a href=#timed-track-list-of-cues&gt;timed track list of cues&lt;/a&gt;, not merely
+  if it is associated with the &lt;a href=#timed-track&gt;timed track&lt;/a&gt;.&lt;/p&gt;
+&lt;!--TT--&gt;
+
+  &lt;p&gt;When a &lt;a href=#media-element&gt;media element&lt;/a&gt; is &lt;a href=#remove-an-element-from-a-document title=&quot;remove an
   element from a document&quot;&gt;removed from a
   &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;, if the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s
   &lt;code title=dom-media-networkState&gt;&lt;a href=#dom-media-networkstate&gt;networkState&lt;/a&gt;&lt;/code&gt; attribute
@@ -26223,9 +26243,28 @@
 
   &lt;dl&gt;&lt;dt&gt;The &lt;dfn id=timed-track-cue-active-flag title=&quot;timed track cue active flag&quot;&gt;active flag&lt;/dfn&gt;
    &lt;dd&gt;
-    &lt;p&gt;This flag must be initially unset. It is used to ensure events
-    are fired appropriately when the cue becomes active or
-    inactive.&lt;/p&gt;
+
+    &lt;p&gt;This flag must be initially unset.  The flag is used to ensure
+    events are fired appropriately when the cue becomes active or
+    inactive, and to make sure the right cues are rendered.&lt;/p&gt;
+
+    &lt;p&gt;The user agent must synchronously unset this flag whenever the
+    &lt;a href=#timed-track-cue&gt;timed track cue&lt;/a&gt; is removed from its &lt;a href=#timed-track&gt;timed
+    track&lt;/a&gt;'s &lt;a href=#timed-track-list-of-cues&gt;timed track list of cues&lt;/a&gt;; whenever the
+    &lt;a href=#timed-track&gt;timed track&lt;/a&gt; itself is removed from its &lt;a href=#media-element&gt;media
+    element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt; or has its
+    &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; changed to &lt;a href=#timed-track-disabled title=&quot;timed track
+    disabled&quot;&gt;disabled&lt;/a&gt;; and whenever the &lt;a href=#media-element&gt;media
+    element&lt;/a&gt;'s &lt;code title=dom-media-readyState&gt;&lt;a href=#dom-media-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; is changed back to
+    &lt;code title=dom-media-HAVE_NOTHING&gt;&lt;a href=#dom-media-have_nothing&gt;HAVE_NOTHING&lt;/a&gt;&lt;/code&gt;. When the
+    flag is unset in this way for one or more cues in &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; that were &lt;a href=#timed-track-showing title=&quot;timed track showing&quot;&gt;showing&lt;/a&gt; prior to the relevant
+    incident, the user agent must, after having unset the flag for all
+    the affected cues, apply the &lt;a href=#rules-for-updating-the-timed-track-rendering&gt;rules for updating the timed
+    track rendering&lt;/a&gt; of those &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+    tracks&lt;/a&gt; (e.g., for &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+    tracks&lt;/a&gt; based on &lt;a href=#websrt&gt;WebSRT&lt;/a&gt;, the &lt;a href=#rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for
+    updating the display of WebSRT timed tracks&lt;/a&gt;).&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;The &lt;dfn id=timed-track-cue-display-state title=&quot;timed track cue display state&quot;&gt;display state&lt;/dfn&gt;
@@ -26815,11 +26854,6 @@
     track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object represents to
     the &lt;a href=#timed-track-disabled&gt;timed track disabled&lt;/a&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; was previously the
-    &lt;a href=#timed-track-showing&gt;timed track showing&lt;/a&gt; mode, then apply the rules for
-    updating the timed track rendering of the &lt;a href=#media-element&gt;media
-    element&lt;/a&gt; appropriate for the &lt;a href=#timed-track&gt;timed track&lt;/a&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
    &lt;dt&gt;If the new value is 1&lt;/dt&gt;
@@ -26830,11 +26864,6 @@
     track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object represents to
     the &lt;a href=#timed-track-hidden&gt;timed track hidden&lt;/a&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; was previously the
-    &lt;a href=#timed-track-showing&gt;timed track showing&lt;/a&gt; mode, then apply the rules for
-    updating the timed track rendering of the &lt;a href=#media-element&gt;media
-    element&lt;/a&gt; appropriate for the &lt;a href=#timed-track&gt;timed track&lt;/a&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
    &lt;dt&gt;If the new value is 2&lt;/dt&gt;
@@ -26845,10 +26874,6 @@
     track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object represents to
     the &lt;a href=#timed-track-showing&gt;timed track showing&lt;/a&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;Apply the rules for updating the timed track rendering of the
-    &lt;a href=#media-element&gt;media element&lt;/a&gt; appropriate for the &lt;a href=#timed-track&gt;timed
-    track&lt;/a&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
   &lt;/dl&gt;&lt;p&gt;If the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; of the &lt;a href=#timed-track&gt;timed
@@ -26875,17 +26900,15 @@
   &lt;code&gt;&lt;a href=#timedtrackcuelist&gt;TimedTrackCueList&lt;/a&gt;&lt;/code&gt; object that represents the subset of
   the &lt;a href=#timed-track-list-of-cues&gt;timed track list of cues&lt;/a&gt; of the &lt;a href=#timed-track&gt;timed
   track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object represents
-  whose &lt;a href=#timed-track-cue-start-time title=&quot;timed track cue start time&quot;&gt;start times&lt;/a&gt;
-  occur before the &lt;a href=#current-playback-position-when-the-script-started&gt;current playback position when the script
-  started&lt;/a&gt; and whose &lt;a href=#timed-track-cue-end-time title=&quot;timed track cue end time&quot;&gt;end
-  times&lt;/a&gt; occur after the &lt;a href=#current-playback-position-when-the-script-started&gt;current playback position when
-  the script started&lt;/a&gt;, in &lt;a href=#timed-track-cue-order&gt;timed track cue
-  order&lt;/a&gt;. Otherwise, it must return null. When an object is
-  returned, the same object must be returned each time.&lt;/p&gt;
+  whose &lt;a href=#active-flag-was-set-when-the-script-started&gt;active flag was set when the script started&lt;/a&gt;, in
+  &lt;a href=#timed-track-cue-order&gt;timed track cue order&lt;/a&gt;. Otherwise, it must return
+  null. When an object is returned, the same object must be returned
+  each time.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=current-playback-position-when-the-script-started&gt;current playback position when the script started&lt;/dfn&gt;
-  is whatever the &lt;a href=#current-playback-position&gt;current playback position&lt;/a&gt; was the last
-  time the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; reached step 1.&lt;/p&gt;
+  &lt;p&gt;A &lt;a href=#timed-track-cue&gt;timed track cue&lt;/a&gt;'s &lt;dfn id=active-flag-was-set-when-the-script-started&gt;active flag was set when
+  the script started&lt;/dfn&gt; if its &lt;a href=#timed-track-cue-active-flag&gt;timed track cue active
+  flag&lt;/a&gt; was set the last time the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;
+  reached step 1.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -28724,11 +28747,7 @@
   user interface to the user&lt;/dfn&gt;. This user interface should include
   features to begin playback, pause playback, seek to an arbitrary
   position in the content (if the content supports arbitrary seeking),
-  change the volume, change the display of closed captions
-
-  &lt;!-- XXX update this to mention timed tracks --&gt;
-
-  or embedded
+  change the volume, change the display of closed captions or embedded
   sign-language tracks, select different audio tracks or turn on audio
   descriptions, and show the media content in manners more suitable to
   the user (e.g. full-screen video or in an independent resizable
@@ -79580,23 +79599,69 @@
 
   &lt;h5 id=websrt-cue-text-rendering-rules&gt;&lt;span class=secno&gt;12.3.2.1 &lt;/span&gt;&lt;dfn&gt;WebSRT cue text rendering rules&lt;/dfn&gt;&lt;/h5&gt;
 
-  &lt;p class=XXX&gt;The &lt;dfn id=rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for updating the display of WebSRT timed tracks&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn id=rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for updating the display of WebSRT timed
+  tracks&lt;/dfn&gt; render the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+  tracks&lt;/a&gt; of a &lt;a href=#media-element&gt;media element&lt;/a&gt; (specifically, a
+  &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt; element) by applying the steps below. All the
+  &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; that use these rules
+  for a given &lt;a href=#media-element&gt;media element&lt;/a&gt; are rendered together, to
+  avoid overlapping subtitles from multiple tracks.&lt;/p&gt;
 
-  &lt;!--
+  &lt;p&gt;The output of the steps below is a set of CSS boxes that covers
+  the rendering area of the &lt;code&gt;&lt;a href=#video&gt;video&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
 
-   list of active WebSRT or WebSRT-compatible cues and their positions
-   (different than a track's list of active cues)
+  &lt;p&gt;The rules are as follows:&lt;/p&gt;
 
-   steps to run each time the current playback position changes, for
-   positioning:
-    - determine what cues are to be removed now
-    - remove them
-    - determine what cues are to be added now
-    - for each one:
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;a href=#media-element&gt;media element&lt;/a&gt; is an &lt;code&gt;&lt;a href=#audio&gt;audio&lt;/a&gt;&lt;/code&gt;
+   element, abort these steps. There is nothing to render.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty list of
+   absolutely positioned CSS block boxes.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;tracks&lt;/var&gt; be the subset of the
+   &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt; that
+   have as their &lt;a href=#rules-for-updating-the-timed-track-rendering&gt;rules for updating the timed track
+   rendering&lt;/a&gt; these &lt;a href=#rules-for-updating-the-display-of-websrt-timed-tracks&gt;rules for updating the display of
+   WebSRT timed tracks&lt;/a&gt;, and whose &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt;
+   is &lt;a href=#timed-track-showing title=&quot;timed track showing&quot;&gt;showing&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; be an empty list of &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;timed track cues&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each track &lt;var title=&quot;&quot;&gt;track&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;tracks&lt;/var&gt;, append to &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; all the
+   &lt;a href=#timed-track-cue title=&quot;timed track cue&quot;&gt;cues&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;track&lt;/var&gt;'s &lt;a href=#timed-track-list-of-cues title=&quot;timed track list of cues&quot;&gt;list
+   of cues&lt;/a&gt; that have their &lt;a href=#timed-track-cue-active-flag&gt;timed track cue active
+   flag&lt;/a&gt; set.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; in &lt;a href=#timed-track-cue-order&gt;timed track cue
+    order&lt;/a&gt;.&lt;/p&gt;
+
+    &lt;p class=note&gt;If the tracks and cues in the previous steps were
+    added to the lists in the same order as the lists from which they
+    were sourced, the &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; list will already be in
+    &lt;a href=#timed-track-cue-order&gt;timed track cue order&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each &lt;a href=#timed-track-cue&gt;timed track cue&lt;/a&gt; &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt;: if &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;a href=#timed-track-cue-display-state&gt;timed track cue display state&lt;/a&gt; has
+   a set of CSS boxes, then add those boxes to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, and remove &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt; from &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p class=XXX&gt;...&lt;/p&gt;
+
+  &lt;!--XXX
+      for each cue in cues:
        - find default position per <A HREF="http://damowmow.com/temp/srtspec">http://damowmow.com/temp/srtspec</A>
        - shunt it around to fit the current active ones
        - add it to the list
+  --&gt;
 
+   &lt;/li&gt;
+
+  &lt;/ol&gt;&lt;!-- XXX
+
    rules for rendering the list of active cues:
     - for each segment, decide if it's before or after the current
       playback position.
@@ -79609,10 +79674,8 @@
    propagate towards the end of the segment so that it reaches the end
    of the segment when the next segment becomes &quot;before&quot;.
 
-  --&gt;
+  --&gt;&lt;h5 id=css-extensions&gt;&lt;span class=secno&gt;12.3.2.2 &lt;/span&gt;CSS extensions&lt;/h5&gt;
 
-  &lt;h5 id=css-extensions&gt;&lt;span class=secno&gt;12.3.2.2 &lt;/span&gt;CSS extensions&lt;/h5&gt;
-
   &lt;p class=note&gt;This section is intended to be moved to a CSS
   specification once an editor is found to run with it.&lt;/p&gt;
 

Modified: source
===================================================================
--- source	2010-07-09 00:26:29 UTC (rev 5146)
+++ source	2010-07-09 19:29:58 UTC (rev 5147)
@@ -24732,6 +24732,14 @@
   particular playback position is defined by the video stream's
   format.&lt;/p&gt;
 
+&lt;!--END w3c-html--&gt;&lt;!--TT--&gt;
+  &lt;p&gt;The &lt;code&gt;video&lt;/code&gt; element also &lt;span&gt;represents&lt;/span&gt; any
+  &lt;span title=&quot;timed track cue&quot;&gt;timed track cues&lt;/span&gt; whose
+  &lt;span&gt;timed track cue active flag&lt;/span&gt; is set and whose
+  &lt;span&gt;timed track&lt;/span&gt; is in the &lt;span title=&quot;timed track
+  showing&quot;&gt;showing&lt;/span&gt; mode.&lt;/p&gt;
+&lt;!--START w3c-html--&gt;&lt;!--TT--&gt;
+
   &lt;p&gt;In addition to the above, the user agent may provide messages to
   the user (such as &quot;buffering&quot;, &quot;no video loaded&quot;, &quot;error&quot;, or more
   detailed information) by overlaying text or icons on the video or
@@ -27772,13 +27780,18 @@
   agent must run the following steps. If the &lt;span&gt;current playback
   position&lt;/span&gt; changes while the steps are running, then the user
   agent must wait for the steps to complete, and then must immediately
-  rerun the steps. (These steps are thus run as often as possible or
-  needed &mdash; if one iteration takes a long time, this can cause
-  certain &lt;span title=&quot;timed track cue&quot;&gt;cues&lt;/span&gt; to be skipped over
-  as the user agent rushes ahead to &quot;catch up&quot;.)&lt;/p&gt;
+  rerun the steps.
+&lt;!--END w3c-html--&gt;&lt;!--TT--&gt;
+  (These steps are thus run as often as possible or needed &mdash; if
+  one iteration takes a long time, this can cause certain &lt;span
+  title=&quot;timed track cue&quot;&gt;cues&lt;/span&gt; to be skipped over as the user
+  agent rushes ahead to &quot;catch up&quot;.)
+&lt;!--START w3c-html--&gt;&lt;!--TT--&gt;
+  &lt;/p&gt;
 
   &lt;ol&gt;
 
+&lt;!--END w3c-html--&gt;&lt;!--TT--&gt;
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt; be an ordered list of
    &lt;span title=&quot;timed track cue&quot;&gt;cues&lt;/span&gt;, initialized to contain
    all the &lt;span title=&quot;timed track cue&quot;&gt;cues&lt;/span&gt; of all the &lt;span
@@ -27800,6 +27813,7 @@
    tracks&lt;/span&gt; of the &lt;span&gt;media element&lt;/span&gt; that are not
    present in &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt;, also in &lt;span&gt;timed
    track cue order&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+&lt;!--START w3c-html--&gt;&lt;!--TT--&gt;
 
    &lt;li&gt;&lt;p&gt;If the time was reached through the usual monotonic increase
    of the current playback position during normal playback, and if the
@@ -27821,6 +27835,7 @@
    not any more frequent than the user agent can comfortably handle
    while decoding the video.&lt;/p&gt;&lt;/li&gt;
 
+&lt;!--END w3c-html--&gt;&lt;!--TT--&gt;
    &lt;li&gt;&lt;p&gt;If all of the &lt;span title=&quot;timed track cue&quot;&gt;cues&lt;/span&gt; in
    &lt;var title=&quot;&quot;&gt;current cues&lt;/var&gt; have their &lt;span&gt;timed track cue
    active flag&lt;/span&gt; set, and none of the &lt;span title=&quot;timed track
@@ -27886,15 +27901,24 @@
    active flag&lt;/span&gt; of all the &lt;span title=&quot;timed track
    cue&quot;&gt;cues&lt;/span&gt; in the &lt;var title=&quot;&quot;&gt;other cues&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Run the rules for rendering the cues of each of the &lt;span
-   title=&quot;timed track&quot;&gt;timed tracks&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;affected
-   tracks&lt;/var&gt; that are &lt;span title=&quot;timed track
-   showing&quot;&gt;showing&lt;/span&gt; (e.g., for &lt;span title=&quot;timed track&quot;&gt;timed
-   tracks&lt;/span&gt; based on &lt;span&gt;WebSRT&lt;/span&gt;, the &lt;span&gt;rules for
-   updating the display of WebSRT timed tracks&lt;/span&gt;).&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Run the &lt;span&gt;rules for updating the timed track
+   rendering&lt;/span&gt; of each of the &lt;span title=&quot;timed track&quot;&gt;timed
+   tracks&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;affected tracks&lt;/var&gt; that are &lt;span
+   title=&quot;timed track showing&quot;&gt;showing&lt;/span&gt; (e.g., for &lt;span
+   title=&quot;timed track&quot;&gt;timed tracks&lt;/span&gt; based on
+   &lt;span&gt;WebSRT&lt;/span&gt;, the &lt;span&gt;rules for updating the display of
+   WebSRT timed tracks&lt;/span&gt;).&lt;/p&gt;&lt;/li&gt;
+&lt;!--START w3c-html--&gt;&lt;!--TT--&gt;
 
   &lt;/ol&gt;
 
+&lt;!--END w3c-html--&gt;&lt;!--TT--&gt;
+  &lt;p&gt;For the purposes of the algorithm above, a &lt;span&gt;timed track
+  cue&lt;/span&gt; is considered to of a &lt;span&gt;timed track&lt;/span&gt; only if it
+  is listed in the &lt;span&gt;timed track list of cues&lt;/span&gt;, not merely
+  if it is associated with the &lt;span&gt;timed track&lt;/span&gt;.&lt;/p&gt;
+&lt;!--START w3c-html--&gt;&lt;!--TT--&gt;
+
   &lt;p&gt;When a &lt;span&gt;media element&lt;/span&gt; is &lt;span title=&quot;remove an
   element from a document&quot;&gt;removed from a
   &lt;code&gt;Document&lt;/code&gt;&lt;/span&gt;, if the &lt;span&gt;media element&lt;/span&gt;'s
@@ -28460,9 +28484,31 @@
 
    &lt;dt&gt;The &lt;dfn title=&quot;timed track cue active flag&quot;&gt;active flag&lt;/dfn&gt;
    &lt;dd&gt;
-    &lt;p&gt;This flag must be initially unset. It is used to ensure events
-    are fired appropriately when the cue becomes active or
-    inactive.&lt;/p&gt;
+
+    &lt;p&gt;This flag must be initially unset.  The flag is used to ensure
+    events are fired appropriately when the cue becomes active or
+    inactive, and to make sure the right cues are rendered.&lt;/p&gt;
+
+    &lt;p&gt;The user agent must synchronously unset this flag whenever the
+    &lt;span&gt;timed track cue&lt;/span&gt; is removed from its &lt;span&gt;timed
+    track&lt;/span&gt;'s &lt;span&gt;timed track list of cues&lt;/span&gt;; whenever the
+    &lt;span&gt;timed track&lt;/span&gt; itself is removed from its &lt;span&gt;media
+    element&lt;/span&gt;'s &lt;span&gt;list of timed tracks&lt;/span&gt; or has its
+    &lt;span&gt;timed track mode&lt;/span&gt; changed to &lt;span title=&quot;timed track
+    disabled&quot;&gt;disabled&lt;/span&gt;; and whenever the &lt;span&gt;media
+    element&lt;/span&gt;'s &lt;code
+    title=&quot;dom-media-readyState&quot;&gt;readyState&lt;/code&gt; is changed back to
+    &lt;code title=&quot;dom-media-HAVE_NOTHING&quot;&gt;HAVE_NOTHING&lt;/code&gt;. When the
+    flag is unset in this way for one or more cues in &lt;span
+    title=&quot;timed track&quot;&gt;timed tracks&lt;/span&gt; that were &lt;span
+    title=&quot;timed track showing&quot;&gt;showing&lt;/span&gt; prior to the relevant
+    incident, the user agent must, after having unset the flag for all
+    the affected cues, apply the &lt;span&gt;rules for updating the timed
+    track rendering&lt;/span&gt; of those &lt;span title=&quot;timed track&quot;&gt;timed
+    tracks&lt;/span&gt; (e.g., for &lt;span title=&quot;timed track&quot;&gt;timed
+    tracks&lt;/span&gt; based on &lt;span&gt;WebSRT&lt;/span&gt;, the &lt;span&gt;rules for
+    updating the display of WebSRT timed tracks&lt;/span&gt;).&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;The &lt;dfn title=&quot;timed track cue display state&quot;&gt;display state&lt;/dfn&gt;
@@ -29135,11 +29181,6 @@
     track&lt;/span&gt; that the &lt;code&gt;TimedTrack&lt;/code&gt; object represents to
     the &lt;span&gt;timed track disabled&lt;/span&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;span&gt;timed track mode&lt;/span&gt; was previously the
-    &lt;span&gt;timed track showing&lt;/span&gt; mode, then apply the rules for
-    updating the timed track rendering of the &lt;span&gt;media
-    element&lt;/span&gt; appropriate for the &lt;span&gt;timed track&lt;/span&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
    &lt;dt&gt;If the new value is 1&lt;/dt&gt;
@@ -29150,11 +29191,6 @@
     track&lt;/span&gt; that the &lt;code&gt;TimedTrack&lt;/code&gt; object represents to
     the &lt;span&gt;timed track hidden&lt;/span&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;span&gt;timed track mode&lt;/span&gt; was previously the
-    &lt;span&gt;timed track showing&lt;/span&gt; mode, then apply the rules for
-    updating the timed track rendering of the &lt;span&gt;media
-    element&lt;/span&gt; appropriate for the &lt;span&gt;timed track&lt;/span&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
    &lt;dt&gt;If the new value is 2&lt;/dt&gt;
@@ -29165,10 +29201,6 @@
     track&lt;/span&gt; that the &lt;code&gt;TimedTrack&lt;/code&gt; object represents to
     the &lt;span&gt;timed track showing&lt;/span&gt; mode.&lt;/p&gt;
 
-    &lt;p&gt;Apply the rules for updating the timed track rendering of the
-    &lt;span&gt;media element&lt;/span&gt; appropriate for the &lt;span&gt;timed
-    track&lt;/span&gt;.&lt;/p&gt;
-
    &lt;/dd&gt;
 
   &lt;/dl&gt;
@@ -29199,17 +29231,15 @@
   &lt;code&gt;TimedTrackCueList&lt;/code&gt; object that represents the subset of
   the &lt;span&gt;timed track list of cues&lt;/span&gt; of the &lt;span&gt;timed
   track&lt;/span&gt; that the &lt;code&gt;TimedTrack&lt;/code&gt; object represents
-  whose &lt;span title=&quot;timed track cue start time&quot;&gt;start times&lt;/span&gt;
-  occur before the &lt;span&gt;current playback position when the script
-  started&lt;/span&gt; and whose &lt;span title=&quot;timed track cue end time&quot;&gt;end
-  times&lt;/span&gt; occur after the &lt;span&gt;current playback position when
-  the script started&lt;/span&gt;, in &lt;span&gt;timed track cue
-  order&lt;/span&gt;. Otherwise, it must return null. When an object is
-  returned, the same object must be returned each time.&lt;/p&gt;
+  whose &lt;span&gt;active flag was set when the script started&lt;/span&gt;, in
+  &lt;span&gt;timed track cue order&lt;/span&gt;. Otherwise, it must return
+  null. When an object is returned, the same object must be returned
+  each time.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn&gt;current playback position when the script started&lt;/dfn&gt;
-  is whatever the &lt;span&gt;current playback position&lt;/span&gt; was the last
-  time the &lt;span&gt;event loop&lt;/span&gt; reached step 1.&lt;/p&gt;
+  &lt;p&gt;A &lt;span&gt;timed track cue&lt;/span&gt;'s &lt;dfn&gt;active flag was set when
+  the script started&lt;/dfn&gt; if its &lt;span&gt;timed track cue active
+  flag&lt;/span&gt; was set the last time the &lt;span&gt;event loop&lt;/span&gt;
+  reached step 1.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -31444,11 +31474,7 @@
   user interface to the user&lt;/dfn&gt;. This user interface should include
   features to begin playback, pause playback, seek to an arbitrary
   position in the content (if the content supports arbitrary seeking),
-  change the volume, change the display of closed captions
-
-  &lt;!-- XXX update this to mention timed tracks --&gt;
-
-  or embedded
+  change the volume, change the display of closed captions or embedded
   sign-language tracks, select different audio tracks or turn on audio
   descriptions, and show the media content in manners more suitable to
   the user (e.g. full-screen video or in an independent resizable
@@ -98489,23 +98515,80 @@
 
   &lt;h5&gt;&lt;dfn&gt;WebSRT cue text rendering rules&lt;/dfn&gt;&lt;/h5&gt;
 
-  &lt;p class=&quot;XXX&quot;&gt;The &lt;dfn&gt;rules for updating the display of WebSRT timed tracks&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn&gt;rules for updating the display of WebSRT timed
+  tracks&lt;/dfn&gt; render the &lt;span title=&quot;timed track&quot;&gt;timed
+  tracks&lt;/span&gt; of a &lt;span&gt;media element&lt;/span&gt; (specifically, a
+  &lt;code&gt;video&lt;/code&gt; element) by applying the steps below. All the
+  &lt;span title=&quot;timed track&quot;&gt;timed tracks&lt;/span&gt; that use these rules
+  for a given &lt;span&gt;media element&lt;/span&gt; are rendered together, to
+  avoid overlapping subtitles from multiple tracks.&lt;/p&gt;
 
-  &lt;!--
+  &lt;p&gt;The output of the steps below is a set of CSS boxes that covers
+  the rendering area of the &lt;code&gt;video&lt;/code&gt; element.&lt;/p&gt;
 
-   list of active WebSRT or WebSRT-compatible cues and their positions
-   (different than a track's list of active cues)
+  &lt;p&gt;The rules are as follows:&lt;/p&gt;
 
-   steps to run each time the current playback position changes, for
-   positioning:
-    - determine what cues are to be removed now
-    - remove them
-    - determine what cues are to be added now
-    - for each one:
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;span&gt;media element&lt;/span&gt; is an &lt;code&gt;audio&lt;/code&gt;
+   element, abort these steps. There is nothing to render.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty list of
+   absolutely positioned CSS block boxes.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;tracks&lt;/var&gt; be the subset of the
+   &lt;span&gt;media element&lt;/span&gt;'s &lt;span&gt;list of timed tracks&lt;/span&gt; that
+   have as their &lt;span&gt;rules for updating the timed track
+   rendering&lt;/span&gt; these &lt;span&gt;rules for updating the display of
+   WebSRT timed tracks&lt;/span&gt;, and whose &lt;span&gt;timed track mode&lt;/span&gt;
+   is &lt;span title=&quot;timed track showing&quot;&gt;showing&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; be an empty list of &lt;span
+   title=&quot;timed track cue&quot;&gt;timed track cues&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each track &lt;var title=&quot;&quot;&gt;track&lt;/var&gt; in &lt;var
+   title=&quot;&quot;&gt;tracks&lt;/var&gt;, append to &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; all the
+   &lt;span title=&quot;timed track cue&quot;&gt;cues&lt;/span&gt; from &lt;var
+   title=&quot;&quot;&gt;track&lt;/var&gt;'s &lt;span title=&quot;timed track list of cues&quot;&gt;list
+   of cues&lt;/span&gt; that have their &lt;span&gt;timed track cue active
+   flag&lt;/span&gt; set.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Sort &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; in &lt;span&gt;timed track cue
+    order&lt;/span&gt;.&lt;/p&gt;
+
+    &lt;p class=&quot;note&quot;&gt;If the tracks and cues in the previous steps were
+    added to the lists in the same order as the lists from which they
+    were sourced, the &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt; list will already be in
+    &lt;span&gt;timed track cue order&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;For each &lt;span&gt;timed track cue&lt;/span&gt; &lt;var
+   title=&quot;&quot;&gt;cue&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;cues&lt;/var&gt;: if &lt;var
+   title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;span&gt;timed track cue display state&lt;/span&gt; has
+   a set of CSS boxes, then add those boxes to &lt;var
+   title=&quot;&quot;&gt;output&lt;/var&gt;, and remove &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt; from &lt;var
+   title=&quot;&quot;&gt;cues&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p class=&quot;XXX&quot;&gt;...&lt;/p&gt;
+
+  &lt;!--XXX
+      for each cue in cues:
        - find default position per <A HREF="http://damowmow.com/temp/srtspec">http://damowmow.com/temp/srtspec</A>
        - shunt it around to fit the current active ones
        - add it to the list
+  --&gt;
 
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;!-- XXX
+
    rules for rendering the list of active cues:
     - for each segment, decide if it's before or after the current
       playback position.


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012016.html">[html5] r5146 - [e] (0) xref
</A></li>
	<LI>Next message: <A HREF="012018.html">[html5] r5148 - [giow] (0) Captions - Stage 21.2: rendering: wip.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12017">[ date ]</a>
              <a href="thread.html#12017">[ thread ]</a>
              <a href="subject.html#12017">[ subject ]</a>
              <a href="author.html#12017">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
