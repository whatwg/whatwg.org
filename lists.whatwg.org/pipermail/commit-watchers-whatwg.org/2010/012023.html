<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r5153 - [giow] (0) Captions - Stage 21.6: rendering:	avoiding cue collisions; supporting [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5153%20-%20%5Bgiow%5D%20%280%29%20Captions%20-%20Stage%2021.6%3A%20rendering%3A%0A%09avoiding%20cue%20collisions%3B%20supporting%20%5B...%5D&In-Reply-To=%3C20100713081920.0A5251C8C003%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012022.html">
   <LINK REL="Next"  HREF="012024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r5153 - [giow] (0) Captions - Stage 21.6: rendering:	avoiding cue collisions; supporting [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5153%20-%20%5Bgiow%5D%20%280%29%20Captions%20-%20Stage%2021.6%3A%20rendering%3A%0A%09avoiding%20cue%20collisions%3B%20supporting%20%5B...%5D&In-Reply-To=%3C20100713081920.0A5251C8C003%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r5153 - [giow] (0) Captions - Stage 21.6: rendering:	avoiding cue collisions; supporting [...]">whatwg at whatwg.org
       </A><BR>
    <I>Tue Jul 13 01:19:19 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="012022.html">[html5] r5152 - [giow] (0) Captions - Stage 21.5: rendering:	default positioning, make the backg [...]
</A></li>
        <LI>Next message: <A HREF="012024.html">[html5] r5154 - [giow] (0) Captions - Stage 22: rendering: the CSS	extensions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12023">[ date ]</a>
              <a href="thread.html#12023">[ thread ]</a>
              <a href="subject.html#12023">[ subject ]</a>
              <a href="author.html#12023">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-07-13 01:19:18 -0700 (Tue, 13 Jul 2010)
New Revision: 5153

Modified:
   complete.html
   index
   source
Log:
[giow] (0) Captions - Stage 21.6: rendering: avoiding cue collisions; supporting the line-based positioning

Modified: complete.html
===================================================================
--- complete.html	2010-07-13 01:30:15 UTC (rev 5152)
+++ complete.html	2010-07-13 08:19:18 UTC (rev 5153)
@@ -86472,7 +86472,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86487,7 +86486,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86506,7 +86504,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; is less than or equal to 50&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; multiplied by two.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86525,7 +86522,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; is greater than &lt;!-- or equal to --&gt; 50&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the result of subtracting &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; from 100 and then multiplying the result by two.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86554,7 +86550,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86565,7 +86560,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86574,7 +86568,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86583,7 +86576,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86591,7 +86583,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'ltr'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86599,7 +86590,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position-reverse&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;x-position-reverse&lt;/var&gt; subtracted from 100.&lt;/p&gt;
@@ -86609,7 +86599,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86624,14 +86613,12 @@
 
       &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be zero.&lt;/p&gt;
        &lt;/dd&gt;
 
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86640,7 +86627,6 @@
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is set&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be zero.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86649,7 +86635,6 @@
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is not set&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -86712,6 +86697,9 @@
 
      &lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;If there are no line boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;,
+     skip the remainder of these substeps for &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;. The cue is ignored.&lt;/li&gt;
+
      &lt;li&gt;
 
       &lt;p&gt;Adjust the positions of &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; according
@@ -86721,30 +86709,208 @@
 
        &lt;dd&gt;
 
-        &lt;p class=XXX&gt;determine the block-direction position of the
-        first line, then slide the line away from the reference edge
-        until it fits, or if that goes off the edge slide it in the
-        other direction; sliding must snap to multiples of the height
-        of the first line box.&lt;/p&gt;
+        &lt;p&gt;Many of the steps in this algorithm vary according to the
+        &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt;. Steps labeled
+        &quot;&lt;strong&gt;Horizontal&lt;/strong&gt;&quot; must be followed only when the
+        &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing
+        direction&quot;&gt;horizontal&lt;/a&gt;, steps labeled
+        &quot;&lt;strong&gt;Vertical&lt;/strong&gt;&quot; must be followed when the
+        &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is either &lt;a href=#timed-track-cue-vertical-growing-left-writing-direction title=&quot;timed track cue vertical growing left writing
+        direction&quot;&gt;vertical growing left&lt;/a&gt; or &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed
+        track cue vertical growing right writing direction&quot;&gt;vertical
+        growing right&lt;/a&gt;, steps labeled &quot;&lt;strong&gt;Vertical Growing
+        Left&lt;/strong&gt;&quot; must be followed only when the &lt;a href=#timed-track-cue-writing-direction&gt;timed
+        track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-left-writing-direction title=&quot;timed track
+        cue vertical growing left writing direction&quot;&gt;vertical growing
+        left&lt;/a&gt;, and steps labeled &quot;&lt;strong&gt;Vertical Growing
+        Right&lt;/strong&gt;&quot; must be followed only when the &lt;a href=#timed-track-cue-writing-direction&gt;timed
+        track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track
+        cue vertical growing right writing direction&quot;&gt;vertical growing
+        right&lt;/a&gt;.&lt;/p&gt;
 
-       &lt;/dd&gt;
+        &lt;ol&gt;&lt;li&gt;
 
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Let &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          be the height of the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Let &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          be the width of the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is zero, then jump to the
+         step labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;line position&lt;/var&gt; be the
+         &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;strong&gt;Vertical Growing Left&lt;/strong&gt;: Add one to
+         &lt;var title=&quot;&quot;&gt;line position&lt;/var&gt; then negate it.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; be the result of
+         multiplying &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;line
+         position&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;strong&gt;Vertical Growing Left&lt;/strong&gt;: Decrease &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; by the width of the bounding box of
+         the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;, then increase &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; by &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;line
+          position&lt;/var&gt; is less than zero then increase &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; by the height of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and negate &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; (so its value is now minus the height of
+          the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;).&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;line
+          position&lt;/var&gt; is less than zero then increase &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; by the width of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and negate &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; down by the distance given by &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; right by the distance given by &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Default&lt;/i&gt;: Remember the position of all the boxes in
+         &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; as their &lt;var title=&quot;&quot;&gt;default
+         position&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; be false.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Step loop&lt;/i&gt;: If none of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; would overlap any of the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, and all the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; are within the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then jump to the step
+         labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          is negative and the top of the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now above the top of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, or if &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is positive and the bottom of the first
+          line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now below the
+          bottom of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area,
+          jump to the step labeled &lt;i&gt;switch direction&lt;/i&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative and the left edge of the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now to the left of the left edge of
+          the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, or if &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is positive and the right edge of the
+          first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now to the
+          right of the right edge of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s
+          rendering area, jump to the step labeled &lt;i&gt;switch
+          direction&lt;/i&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; down by the distance given by &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;. (If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative, then this will actually result in an upwards
+          movement of the boxes in absolute terms.)&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; right by the distance given by &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;. (If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative, then this will actually result in a leftwards
+          movement of the boxes in absolute terms.)&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;step
+         loop&lt;/i&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Switch direction&lt;/i&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; back to their &lt;var title=&quot;&quot;&gt;default
+         position&lt;/var&gt; as determined in the step above labeled
+         &lt;i&gt;default&lt;/i&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; is true, jump to the step
+         labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Negate &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; to true.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;step
+         loop&lt;/i&gt;.&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
        &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
 
-        &lt;p class=XXX&gt;position the box according to the given
-        position information, and then spiral around clockwise until
-        no overlap is found&lt;/p&gt;
+        &lt;ol&gt;&lt;li&gt;
 
-       &lt;/dd&gt;
+          &lt;p&gt;Set up &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; as
+          follows:&lt;/p&gt;
 
+          &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
+                  and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'ltr'&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given by the &lt;a href=#timed-track-cue-line-position&gt;timed
+            track cue line position&lt;/a&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
+                  and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; subtracted from
+            100, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given
+            by the &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-left-writing-direction title=&quot;timed track cue vertical growing left writing direction&quot;&gt;vertical growing left&lt;/a&gt;&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt; subtracted from
+            100, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given
+            by the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given by the &lt;a href=#timed-track-cue-text-position&gt;timed
+            track cue text position&lt;/a&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+          &lt;/dl&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Position the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; such
+         that the point &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;% along the width of the
+         bounding box of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is
+         &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;% of the way across the width of the
+         &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and the point
+         &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;% along the height of the bounding box
+         of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;% of the way across the height of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, while maintaining the
+         relative positions of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         to each other.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If none of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         would overlap any of the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;,
+         and all the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; are within
+         the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then jump to
+         the step labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If there is a position to which the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; can be moved while maintaining the
+         relative positions of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         to each other such that none of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; would overlap any of the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, and all the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; would be within the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then move the boxes in
+         &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; to the closest such position to
+         their current position, and then jump to the step labeled
+         &lt;i&gt;done positioning&lt;/i&gt; below. If there are multiple such
+         positions that are equidistant from their current position,
+         use the highest one amongst them; if there are several at
+         that height, then use the leftmost one amongst them.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Otherwise, jump to the step labeled &lt;i&gt;done
+         positioning&lt;/i&gt; below. (The boxes will unfortunately
+         overlap.)&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
       &lt;/dl&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If there are any line boxes in the (possibly now
-     repositioned) &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; that do not completely
-     fit inside &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, remove
-     those offending line boxes from &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;i&gt;Done positioning&lt;/i&gt;: If there are any line boxes in
+     the (possibly now repositioned) &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; that do
+     not completely fit inside &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering
+     area, remove those offending line boxes from &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;a href=#timed-track-cue-display-state&gt;timed track cue
      display state&lt;/a&gt; have the CSS boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/li&gt;

Modified: index
===================================================================
--- index	2010-07-13 01:30:15 UTC (rev 5152)
+++ index	2010-07-13 08:19:18 UTC (rev 5153)
@@ -79713,7 +79713,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79728,7 +79727,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79747,7 +79745,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; is less than or equal to 50&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; multiplied by two.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79766,7 +79763,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; is greater than &lt;!-- or equal to --&gt; 50&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the result of subtracting &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; from 100 and then multiplying the result by two.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79795,7 +79791,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79806,7 +79801,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79815,7 +79809,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-start-alignment title=&quot;timed track cue start alignment&quot;&gt;start&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79824,7 +79817,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-end-alignment title=&quot;timed track cue end alignment&quot;&gt;end&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79832,7 +79824,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'ltr'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79840,7 +79831,6 @@
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position-reverse&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;x-position-reverse&lt;/var&gt; subtracted from 100.&lt;/p&gt;
@@ -79850,7 +79840,6 @@
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-alignment&gt;timed track cue alignment&lt;/a&gt; is &lt;a href=#timed-track-cue-middle-alignment title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/a&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79865,14 +79854,12 @@
 
       &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be zero.&lt;/p&gt;
        &lt;/dd&gt;
 
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79881,7 +79868,6 @@
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is set&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be zero.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79890,7 +79876,6 @@
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is not set&lt;/dt&gt;
        &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;,
               and the &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -79953,6 +79938,9 @@
 
      &lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;If there are no line boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;,
+     skip the remainder of these substeps for &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;. The cue is ignored.&lt;/li&gt;
+
      &lt;li&gt;
 
       &lt;p&gt;Adjust the positions of &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; according
@@ -79962,30 +79950,208 @@
 
        &lt;dd&gt;
 
-        &lt;p class=XXX&gt;determine the block-direction position of the
-        first line, then slide the line away from the reference edge
-        until it fits, or if that goes off the edge slide it in the
-        other direction; sliding must snap to multiples of the height
-        of the first line box.&lt;/p&gt;
+        &lt;p&gt;Many of the steps in this algorithm vary according to the
+        &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt;. Steps labeled
+        &quot;&lt;strong&gt;Horizontal&lt;/strong&gt;&quot; must be followed only when the
+        &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing
+        direction&quot;&gt;horizontal&lt;/a&gt;, steps labeled
+        &quot;&lt;strong&gt;Vertical&lt;/strong&gt;&quot; must be followed when the
+        &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is either &lt;a href=#timed-track-cue-vertical-growing-left-writing-direction title=&quot;timed track cue vertical growing left writing
+        direction&quot;&gt;vertical growing left&lt;/a&gt; or &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed
+        track cue vertical growing right writing direction&quot;&gt;vertical
+        growing right&lt;/a&gt;, steps labeled &quot;&lt;strong&gt;Vertical Growing
+        Left&lt;/strong&gt;&quot; must be followed only when the &lt;a href=#timed-track-cue-writing-direction&gt;timed
+        track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-left-writing-direction title=&quot;timed track
+        cue vertical growing left writing direction&quot;&gt;vertical growing
+        left&lt;/a&gt;, and steps labeled &quot;&lt;strong&gt;Vertical Growing
+        Right&lt;/strong&gt;&quot; must be followed only when the &lt;a href=#timed-track-cue-writing-direction&gt;timed
+        track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track
+        cue vertical growing right writing direction&quot;&gt;vertical growing
+        right&lt;/a&gt;.&lt;/p&gt;
 
-       &lt;/dd&gt;
+        &lt;ol&gt;&lt;li&gt;
 
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Let &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          be the height of the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Let &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          be the width of the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is zero, then jump to the
+         step labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;line position&lt;/var&gt; be the
+         &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;strong&gt;Vertical Growing Left&lt;/strong&gt;: Add one to
+         &lt;var title=&quot;&quot;&gt;line position&lt;/var&gt; then negate it.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; be the result of
+         multiplying &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;line
+         position&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;strong&gt;Vertical Growing Left&lt;/strong&gt;: Decrease &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; by the width of the bounding box of
+         the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;, then increase &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; by &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;line
+          position&lt;/var&gt; is less than zero then increase &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; by the height of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and negate &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; (so its value is now minus the height of
+          the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;).&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;line
+          position&lt;/var&gt; is less than zero then increase &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; by the width of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and negate &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; down by the distance given by &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; right by the distance given by &lt;var title=&quot;&quot;&gt;position&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Default&lt;/i&gt;: Remember the position of all the boxes in
+         &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; as their &lt;var title=&quot;&quot;&gt;default
+         position&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; be false.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Step loop&lt;/i&gt;: If none of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; would overlap any of the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, and all the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; are within the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then jump to the step
+         labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          is negative and the top of the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now above the top of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, or if &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is positive and the bottom of the first
+          line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now below the
+          bottom of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area,
+          jump to the step labeled &lt;i&gt;switch direction&lt;/i&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative and the left edge of the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now to the left of the left edge of
+          the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, or if &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is positive and the right edge of the
+          first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now to the
+          right of the right edge of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s
+          rendering area, jump to the step labeled &lt;i&gt;switch
+          direction&lt;/i&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; down by the distance given by &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;. (If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative, then this will actually result in an upwards
+          movement of the boxes in absolute terms.)&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; right by the distance given by &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;. (If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative, then this will actually result in a leftwards
+          movement of the boxes in absolute terms.)&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;step
+         loop&lt;/i&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Switch direction&lt;/i&gt;: Move all the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; back to their &lt;var title=&quot;&quot;&gt;default
+         position&lt;/var&gt; as determined in the step above labeled
+         &lt;i&gt;default&lt;/i&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; is true, jump to the step
+         labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Negate &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; to true.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;step
+         loop&lt;/i&gt;.&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
        &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;a href=#timed-track-cue-snap-to-lines-flag&gt;timed track cue snap-to-lines flag&lt;/a&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
 
-        &lt;p class=XXX&gt;position the box according to the given
-        position information, and then spiral around clockwise until
-        no overlap is found&lt;/p&gt;
+        &lt;ol&gt;&lt;li&gt;
 
-       &lt;/dd&gt;
+          &lt;p&gt;Set up &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; as
+          follows:&lt;/p&gt;
 
+          &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
+                  and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'ltr'&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given by the &lt;a href=#timed-track-cue-line-position&gt;timed
+            track cue line position&lt;/a&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/a&gt;,
+                  and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt; subtracted from
+            100, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given
+            by the &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-left-writing-direction title=&quot;timed track cue vertical growing left writing direction&quot;&gt;vertical growing left&lt;/a&gt;&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt; subtracted from
+            100, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given
+            by the &lt;a href=#timed-track-cue-text-position&gt;timed track cue text position&lt;/a&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;a href=#timed-track-cue-writing-direction&gt;timed track cue writing direction&lt;/a&gt; is &lt;a href=#timed-track-cue-vertical-growing-right-writing-direction title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/a&gt;&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;a href=#timed-track-cue-line-position&gt;timed track cue line position&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given by the &lt;a href=#timed-track-cue-text-position&gt;timed
+            track cue text position&lt;/a&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+          &lt;/dl&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Position the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; such
+         that the point &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;% along the width of the
+         bounding box of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is
+         &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;% of the way across the width of the
+         &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and the point
+         &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;% along the height of the bounding box
+         of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;% of the way across the height of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, while maintaining the
+         relative positions of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         to each other.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If none of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         would overlap any of the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;,
+         and all the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; are within
+         the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then jump to
+         the step labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If there is a position to which the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; can be moved while maintaining the
+         relative positions of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         to each other such that none of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; would overlap any of the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;, and all the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; would be within the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then move the boxes in
+         &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; to the closest such position to
+         their current position, and then jump to the step labeled
+         &lt;i&gt;done positioning&lt;/i&gt; below. If there are multiple such
+         positions that are equidistant from their current position,
+         use the highest one amongst them; if there are several at
+         that height, then use the leftmost one amongst them.&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Otherwise, jump to the step labeled &lt;i&gt;done
+         positioning&lt;/i&gt; below. (The boxes will unfortunately
+         overlap.)&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;/dd&gt;
+
       &lt;/dl&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If there are any line boxes in the (possibly now
-     repositioned) &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; that do not completely
-     fit inside &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, remove
-     those offending line boxes from &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;i&gt;Done positioning&lt;/i&gt;: If there are any line boxes in
+     the (possibly now repositioned) &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; that do
+     not completely fit inside &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering
+     area, remove those offending line boxes from &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;a href=#timed-track-cue-display-state&gt;timed track cue
      display state&lt;/a&gt; have the CSS boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/li&gt;

Modified: source
===================================================================
--- source	2010-07-13 01:30:15 UTC (rev 5152)
+++ source	2010-07-13 08:19:18 UTC (rev 5153)
@@ -98649,7 +98649,6 @@
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue start alignment&quot;&gt;start&lt;/span&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue start alignment&quot;&gt;start&lt;/span&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98664,7 +98663,6 @@
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue end alignment&quot;&gt;end&lt;/span&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue end alignment&quot;&gt;end&lt;/span&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98683,7 +98681,6 @@
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/span&gt;,
               and the &lt;span&gt;timed track cue text position&lt;/span&gt; is less than or equal to 50&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt; multiplied by two.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98702,7 +98699,6 @@
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/span&gt;,
               and the &lt;span&gt;timed track cue text position&lt;/span&gt; is greater than &lt;!-- or equal to --&gt; 50&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;maximum size&lt;/var&gt; be the result of subtracting &lt;span&gt;timed track cue text position&lt;/span&gt; from 100 and then multiplying the result by two.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98739,7 +98735,6 @@
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/span&gt;,
               the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue end alignment&quot;&gt;end&lt;/span&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98750,7 +98745,6 @@
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/span&gt;,
               the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue start alignment&quot;&gt;start&lt;/span&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98759,7 +98753,6 @@
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue start alignment&quot;&gt;start&lt;/span&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue start alignment&quot;&gt;start&lt;/span&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98768,7 +98761,6 @@
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue end alignment&quot;&gt;end&lt;/span&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue end alignment&quot;&gt;end&lt;/span&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt; subtracted from 100.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98776,7 +98768,6 @@
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/span&gt;,
               the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/span&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'ltr'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98784,7 +98775,6 @@
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/span&gt;,
               the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/span&gt;,
               and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position-reverse&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;x-position-reverse&lt;/var&gt; subtracted from 100.&lt;/p&gt;
@@ -98794,7 +98784,6 @@
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/span&gt;&lt;/dt&gt;
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               and the &lt;span&gt;timed track cue alignment&lt;/span&gt; is &lt;span title=&quot;timed track cue middle alignment&quot;&gt;middle&lt;/span&gt;&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;span&gt;timed track cue text position&lt;/span&gt; minus half of &lt;var title=&quot;&quot;&gt;size&lt;/var&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98814,14 +98803,12 @@
 
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/span&gt;,
               and the &lt;span&gt;timed track cue snap-to-lines flag&lt;/span&gt; is set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be zero.&lt;/p&gt;
        &lt;/dd&gt;
 
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/span&gt;,
               and the &lt;span&gt;timed track cue snap-to-lines flag&lt;/span&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;y-position&lt;/var&gt; be the &lt;span&gt;timed track cue line position&lt;/span&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98830,7 +98817,6 @@
               and the &lt;span&gt;timed track cue snap-to-lines flag&lt;/span&gt; is set&lt;/dt&gt;
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               and the &lt;span&gt;timed track cue snap-to-lines flag&lt;/span&gt; is set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be zero.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98839,7 +98825,6 @@
               and the &lt;span&gt;timed track cue snap-to-lines flag&lt;/span&gt; is not set&lt;/dt&gt;
        &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;,
               and the &lt;span&gt;timed track cue snap-to-lines flag&lt;/span&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
         &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x-position&lt;/var&gt; be the &lt;span&gt;timed track cue line position&lt;/span&gt;.&lt;/p&gt;
        &lt;/dd&gt;
@@ -98913,6 +98898,10 @@
 
      &lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;If there are no line boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;,
+     skip the remainder of these substeps for &lt;var
+     title=&quot;&quot;&gt;cue&lt;/var&gt;. The cue is ignored.&lt;/p&gt;&lt;/li&gt;
+
      &lt;li&gt;
 
       &lt;p&gt;Adjust the positions of &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; according
@@ -98924,32 +98913,261 @@
 
        &lt;dd&gt;
 
-        &lt;p class=&quot;XXX&quot;&gt;determine the block-direction position of the
-        first line, then slide the line away from the reference edge
-        until it fits, or if that goes off the edge slide it in the
-        other direction; sliding must snap to multiples of the height
-        of the first line box.&lt;/p&gt;
+        &lt;p&gt;Many of the steps in this algorithm vary according to the
+        &lt;span&gt;timed track cue writing direction&lt;/span&gt;. Steps labeled
+        &quot;&lt;strong&gt;Horizontal&lt;/strong&gt;&quot; must be followed only when the
+        &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span
+        title=&quot;timed track cue horizontal writing
+        direction&quot;&gt;horizontal&lt;/span&gt;, steps labeled
+        &quot;&lt;strong&gt;Vertical&lt;/strong&gt;&quot; must be followed when the
+        &lt;span&gt;timed track cue writing direction&lt;/span&gt; is either &lt;span
+        title=&quot;timed track cue vertical growing left writing
+        direction&quot;&gt;vertical growing left&lt;/span&gt; or &lt;span title=&quot;timed
+        track cue vertical growing right writing direction&quot;&gt;vertical
+        growing right&lt;/span&gt;, steps labeled &quot;&lt;strong&gt;Vertical Growing
+        Left&lt;/strong&gt;&quot; must be followed only when the &lt;span&gt;timed
+        track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track
+        cue vertical growing left writing direction&quot;&gt;vertical growing
+        left&lt;/span&gt;, and steps labeled &quot;&lt;strong&gt;Vertical Growing
+        Right&lt;/strong&gt;&quot; must be followed only when the &lt;span&gt;timed
+        track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track
+        cue vertical growing right writing direction&quot;&gt;vertical growing
+        right&lt;/span&gt;.&lt;/p&gt;
 
+        &lt;ol&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Let &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          be the height of the first line box in &lt;var
+          title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Let &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          be the width of the first line box in &lt;var
+          title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is zero, then jump to the
+         step labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;line position&lt;/var&gt; be the
+         &lt;span&gt;timed track cue line position&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;strong&gt;Vertical Growing Left&lt;/strong&gt;: Add one to
+         &lt;var title=&quot;&quot;&gt;line position&lt;/var&gt; then negate it.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; be the result of
+         multiplying &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;line
+         position&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;strong&gt;Vertical Growing Left&lt;/strong&gt;: Decrease &lt;var
+         title=&quot;&quot;&gt;position&lt;/var&gt; by the width of the bounding box of
+         the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;, then increase &lt;var
+         title=&quot;&quot;&gt;position&lt;/var&gt; by &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;line
+          position&lt;/var&gt; is less than zero then increase &lt;var
+          title=&quot;&quot;&gt;position&lt;/var&gt; by the height of the &lt;var
+          title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and negate &lt;var
+          title=&quot;&quot;&gt;step&lt;/var&gt; (so its value is now minus the height of
+          the first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;).&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;line
+          position&lt;/var&gt; is less than zero then increase &lt;var
+          title=&quot;&quot;&gt;position&lt;/var&gt; by the width of the &lt;var
+          title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and negate &lt;var
+          title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Move all the boxes in &lt;var
+          title=&quot;&quot;&gt;boxes&lt;/var&gt; down by the distance given by &lt;var
+          title=&quot;&quot;&gt;position&lt;/var&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Move all the boxes in &lt;var
+          title=&quot;&quot;&gt;boxes&lt;/var&gt; right by the distance given by &lt;var
+          title=&quot;&quot;&gt;position&lt;/var&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Default&lt;/i&gt;: Remember the position of all the boxes in
+         &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; as their &lt;var title=&quot;&quot;&gt;default
+         position&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; be false.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Step loop&lt;/i&gt;: If none of the boxes in &lt;var
+         title=&quot;&quot;&gt;boxes&lt;/var&gt; would overlap any of the boxes in &lt;var
+         title=&quot;&quot;&gt;output&lt;/var&gt;, and all the boxes in &lt;var
+         title=&quot;&quot;&gt;output&lt;/var&gt; are within the &lt;var
+         title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then jump to the step
+         labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;
+          is negative and the top of the first line box in &lt;var
+          title=&quot;&quot;&gt;boxes&lt;/var&gt; is now above the top of the &lt;var
+          title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, or if &lt;var
+          title=&quot;&quot;&gt;step&lt;/var&gt; is positive and the bottom of the first
+          line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now below the
+          bottom of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area,
+          jump to the step labeled &lt;i&gt;switch direction&lt;/i&gt;.&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative and the left edge of the first line box in &lt;var
+          title=&quot;&quot;&gt;boxes&lt;/var&gt; is now to the left of the left edge of
+          the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, or if &lt;var
+          title=&quot;&quot;&gt;step&lt;/var&gt; is positive and the right edge of the
+          first line box in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is now to the
+          right of the right edge of the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s
+          rendering area, jump to the step labeled &lt;i&gt;switch
+          direction&lt;/i&gt;.&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;
+
+          &lt;p&gt;&lt;strong&gt;Horizontal&lt;/strong&gt;: Move all the boxes in &lt;var
+          title=&quot;&quot;&gt;boxes&lt;/var&gt; down by the distance given by &lt;var
+          title=&quot;&quot;&gt;step&lt;/var&gt;. (If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative, then this will actually result in an upwards
+          movement of the boxes in absolute terms.)&lt;/p&gt;
+
+          &lt;p&gt;&lt;strong&gt;Vertical&lt;/strong&gt;: Move all the boxes in &lt;var
+          title=&quot;&quot;&gt;boxes&lt;/var&gt; right by the distance given by &lt;var
+          title=&quot;&quot;&gt;step&lt;/var&gt;. (If &lt;var title=&quot;&quot;&gt;step&lt;/var&gt; is
+          negative, then this will actually result in a leftwards
+          movement of the boxes in absolute terms.)&lt;/p&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;step
+         loop&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;&lt;i&gt;Switch direction&lt;/i&gt;: Move all the boxes in &lt;var
+         title=&quot;&quot;&gt;boxes&lt;/var&gt; back to their &lt;var title=&quot;&quot;&gt;default
+         position&lt;/var&gt; as determined in the step above labeled
+         &lt;i&gt;default&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; is true, jump to the step
+         labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Negate &lt;var title=&quot;&quot;&gt;step&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;switched&lt;/var&gt; to true.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;step
+         loop&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+        &lt;/ol&gt;
+
        &lt;/dd&gt;
 
        &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;span&gt;timed track cue snap-to-lines flag&lt;/span&gt; is not set&lt;/dt&gt;
-
        &lt;dd&gt;
 
-        &lt;p class=&quot;XXX&quot;&gt;position the box according to the given
-        position information, and then spiral around clockwise until
-        no overlap is found&lt;/p&gt;
+        &lt;ol&gt;
 
+         &lt;li&gt;
+
+          &lt;p&gt;Set up &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; as
+          follows:&lt;/p&gt;
+
+          &lt;dl class=&quot;switch&quot;&gt;
+
+           &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/span&gt;,
+                  and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'ltr'&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;span&gt;timed track cue text position&lt;/span&gt;, and let &lt;var
+            title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given by the &lt;span&gt;timed
+            track cue line position&lt;/span&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal writing direction&quot;&gt;horizontal&lt;/span&gt;,
+                  and &lt;var title=&quot;&quot;&gt;direction&lt;/var&gt; is 'rtl'&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;span&gt;timed track cue text position&lt;/span&gt; subtracted from
+            100, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given
+            by the &lt;span&gt;timed track cue line position&lt;/span&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing left writing direction&quot;&gt;vertical growing left&lt;/span&gt;&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;span&gt;timed track cue line position&lt;/span&gt; subtracted from
+            100, and let &lt;var title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given
+            by the &lt;span&gt;timed track cue text position&lt;/span&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+           &lt;dt&gt;If the &lt;span&gt;timed track cue writing direction&lt;/span&gt; is &lt;span title=&quot;timed track cue vertical growing right writing direction&quot;&gt;vertical growing right&lt;/span&gt;&lt;/dt&gt;
+           &lt;dd&gt;
+            &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;x&lt;/var&gt; be a percentage given by the
+            &lt;span&gt;timed track cue line position&lt;/span&gt;, and let &lt;var
+            title=&quot;&quot;&gt;y&lt;/var&gt; be a percentage given by the &lt;span&gt;timed
+            track cue text position&lt;/span&gt;.&lt;/p&gt;
+           &lt;/dd&gt;
+
+          &lt;/dl&gt;
+
+         &lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Position the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; such
+         that the point &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;% along the width of the
+         bounding box of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is
+         &lt;var title=&quot;&quot;&gt;x&lt;/var&gt;% of the way across the width of the
+         &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, and the point
+         &lt;var title=&quot;&quot;&gt;y&lt;/var&gt;% along the height of the bounding box
+         of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; is &lt;var
+         title=&quot;&quot;&gt;y&lt;/var&gt;% of the way across the height of the &lt;var
+         title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, while maintaining the
+         relative positions of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         to each other.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If none of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         would overlap any of the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;,
+         and all the boxes in &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; are within
+         the &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then jump to
+         the step labeled &lt;i&gt;done positioning&lt;/i&gt; below.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;If there is a position to which the boxes in &lt;var
+         title=&quot;&quot;&gt;boxes&lt;/var&gt; can be moved while maintaining the
+         relative positions of the boxes in &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt;
+         to each other such that none of the boxes in &lt;var
+         title=&quot;&quot;&gt;boxes&lt;/var&gt; would overlap any of the boxes in &lt;var
+         title=&quot;&quot;&gt;output&lt;/var&gt;, and all the boxes in &lt;var
+         title=&quot;&quot;&gt;output&lt;/var&gt; would be within the &lt;var
+         title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, then move the boxes in
+         &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; to the closest such position to
+         their current position, and then jump to the step labeled
+         &lt;i&gt;done positioning&lt;/i&gt; below. If there are multiple such
+         positions that are equidistant from their current position,
+         use the highest one amongst them; if there are several at
+         that height, then use the leftmost one amongst them.&lt;/p&gt;&lt;/li&gt;
+
+         &lt;li&gt;&lt;p&gt;Otherwise, jump to the step labeled &lt;i&gt;done
+         positioning&lt;/i&gt; below. (The boxes will unfortunately
+         overlap.)&lt;/p&gt;&lt;/li&gt;
+
+        &lt;/ol&gt;
+
        &lt;/dd&gt;
 
       &lt;/dl&gt;
 
      &lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If there are any line boxes in the (possibly now
-     repositioned) &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; that do not completely
-     fit inside &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering area, remove
-     those offending line boxes from &lt;var
+     &lt;li&gt;&lt;p&gt;&lt;i&gt;Done positioning&lt;/i&gt;: If there are any line boxes in
+     the (possibly now repositioned) &lt;var title=&quot;&quot;&gt;boxes&lt;/var&gt; that do
+     not completely fit inside &lt;var title=&quot;&quot;&gt;video&lt;/var&gt;'s rendering
+     area, remove those offending line boxes from &lt;var
      title=&quot;&quot;&gt;boxes&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cue&lt;/var&gt;'s &lt;span&gt;timed track cue


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012022.html">[html5] r5152 - [giow] (0) Captions - Stage 21.5: rendering:	default positioning, make the backg [...]
</A></li>
	<LI>Next message: <A HREF="012024.html">[html5] r5154 - [giow] (0) Captions - Stage 22: rendering: the CSS	extensions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12023">[ date ]</a>
              <a href="thread.html#12023">[ thread ]</a>
              <a href="subject.html#12023">[ subject ]</a>
              <a href="author.html#12023">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
