<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r5110 - [giow] (0) Captions - Stage 11.2: minor fixes and	steps towards completion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5110%20-%20%5Bgiow%5D%20%280%29%20Captions%20-%20Stage%2011.2%3A%20minor%20fixes%20and%0A%09steps%20towards%20completion&In-Reply-To=%3C20100624220514.2B33C1C8C003%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011979.html">
   <LINK REL="Next"  HREF="011981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r5110 - [giow] (0) Captions - Stage 11.2: minor fixes and	steps towards completion</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5110%20-%20%5Bgiow%5D%20%280%29%20Captions%20-%20Stage%2011.2%3A%20minor%20fixes%20and%0A%09steps%20towards%20completion&In-Reply-To=%3C20100624220514.2B33C1C8C003%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r5110 - [giow] (0) Captions - Stage 11.2: minor fixes and	steps towards completion">whatwg at whatwg.org
       </A><BR>
    <I>Thu Jun 24 15:05:14 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="011979.html">[html5] r5109 - [e] (0) Update list of differences.
</A></li>
        <LI>Next message: <A HREF="011981.html">[html5] r5111 - [giow] (0) Captions - Stage 11.3: completed the	external timed track download pr [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11980">[ date ]</a>
              <a href="thread.html#11980">[ thread ]</a>
              <a href="subject.html#11980">[ subject ]</a>
              <a href="author.html#11980">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-06-24 15:05:12 -0700 (Thu, 24 Jun 2010)
New Revision: 5110

Modified:
   complete.html
   index
   source
Log:
[giow] (0) Captions - Stage 11.2: minor fixes and steps towards completion

Modified: complete.html
===================================================================
--- complete.html	2010-06-24 06:51:45 UTC (rev 5109)
+++ complete.html	2010-06-24 22:05:12 UTC (rev 5110)
@@ -26098,17 +26098,27 @@
     timed track&lt;/a&gt; can change dynamically, either because the
     &lt;a href=#timed-track&gt;timed track&lt;/a&gt; has &lt;a href=#timed-track-not-loaded title=&quot;timed track not
     loaded&quot;&gt;not yet been loaded&lt;/a&gt; or is still &lt;a href=#timed-track-loading title=&quot;timed
-    track loading&quot;&gt;loading&lt;/a&gt;, or in the case of a &lt;a href=#timed-track&gt;timed
-    track&lt;/a&gt; corresponding to a &lt;code&gt;&lt;a href=#mutabletimedtrack&gt;MutableTimedTrack&lt;/a&gt;&lt;/code&gt;
-    object, where individual cues can be added or removed
-    dynamically using the API.&lt;/p&gt;
+    track loading&quot;&gt;loading&lt;/a&gt;, or because the the &lt;a href=#timed-track&gt;timed
+    track&lt;/a&gt; corresponds to a &lt;code&gt;&lt;a href=#mutabletimedtrack&gt;MutableTimedTrack&lt;/a&gt;&lt;/code&gt;
+    object, whose API allows individual cues can be added or removed
+    dynamically.&lt;/p&gt;
 
    &lt;/dd&gt;
 
   &lt;/dl&gt;&lt;p&gt;Each &lt;a href=#timed-track&gt;timed track&lt;/a&gt; has a corresponding
   &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;dfn id=timed-track-cue&gt;timed track cue&lt;/dfn&gt; is the unit of time-sensitive data
+  &lt;p&gt;The &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; of a
+  &lt;a href=#media-element&gt;media element&lt;/a&gt; are &lt;dfn id=the-timed-tracks-are-ready title=&quot;the timed tracks are
+  ready&quot;&gt;ready&lt;/dfn&gt; if all the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+  tracks&lt;/a&gt; whose &lt;a href=#timed-track-mode title=&quot;timed track mode&quot;&gt;mode&lt;/a&gt; was
+  not in the &lt;a href=#timed-track-disabled title=&quot;timed track disabled&quot;&gt;disabled&lt;/a&gt; state
+  when the element's &lt;a href=#concept-media-load-algorithm title=concept-media-load-algorithm&gt;resource selection
+  algorithm&lt;/a&gt; last started now have a &lt;a href=#timed-track-readiness-state&gt;timed track readiness
+  state&lt;/a&gt; of &lt;a href=#timed-track-loaded title=&quot;timed track loaded&quot;&gt;loaded&lt;/a&gt; or
+  &lt;a href=#timed-track-failed-to-load title=&quot;timed track failed to load&quot;&gt;failed to load&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;A &lt;dfn id=timed-track-cue&gt;timed track cue&lt;/dfn&gt; is the unit of time-sensitive data
   in a &lt;a href=#timed-track&gt;timed track&lt;/a&gt;, corresponding for instance for
   subtitles and captions to the text that appears at a particular time
   and disappears at another time.&lt;/p&gt;
@@ -26152,6 +26162,22 @@
     line extends vertically and is positioned horizontally, with
     consecutive lines displayed to the left of each other&lt;!-- used for
     mongolian --&gt;).&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;a href=#timed-track-cue-writing-direction title=&quot;timed track cue writing direction&quot;&gt;writing
+    direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal
+    writing direction&quot;&gt;horizontal&lt;/a&gt;, then &lt;a href=#timed-track-cue-line-position title=&quot;timed
+    track cue line position&quot;&gt;line position&lt;/a&gt; percentages are
+    relative to the height of the video, and &lt;a href=#timed-track-cue-text-position title=&quot;timed track
+    cue text position&quot;&gt;text position&lt;/a&gt; and &lt;a href=#timed-track-cue-size title=&quot;timed
+    track cue size&quot;&gt;size&lt;/a&gt; percentages are relative to the width
+    of the video.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, &lt;a href=#timed-track-cue-line-position title=&quot;timed track cue line position&quot;&gt;line
+    position&lt;/a&gt; percentages are relative to the width of the
+    video, and &lt;a href=#timed-track-cue-text-position title=&quot;timed track cue text position&quot;&gt;text
+    position&lt;/a&gt; and &lt;a href=#timed-track-cue-size title=&quot;timed track cue size&quot;&gt;size&lt;/a&gt;
+    percentages are relative to the height of the video.&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn id=timed-track-cue-snap-to-lines-flag title=&quot;timed track cue snap-to-lines flag&quot;&gt;A snap-to-lines flag&lt;/dfn&gt;
@@ -26219,17 +26245,7 @@
   cue&lt;/a&gt; is associated with a particular &lt;a href=#timed-track&gt;timed track&lt;/a&gt;,
   the association is permanent.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; of a
-  &lt;a href=#media-element&gt;media element&lt;/a&gt; are &lt;dfn id=the-timed-tracks-are-ready title=&quot;the timed tracks are
-  ready&quot;&gt;ready&lt;/dfn&gt; if all the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
-  tracks&lt;/a&gt; whose &lt;a href=#timed-track-mode title=&quot;timed track mode&quot;&gt;mode&lt;/a&gt; was
-  not in the &lt;a href=#timed-track-disabled title=&quot;timed track disabled&quot;&gt;disabled&lt;/a&gt; state
-  when the element's &lt;a href=#concept-media-load-algorithm title=concept-media-load-algorithm&gt;resource selection
-  algorithm&lt;/a&gt; last started now have a &lt;a href=#timed-track-readiness-state&gt;timed track readiness
-  state&lt;/a&gt; of &lt;a href=#timed-track-loaded title=&quot;timed track loaded&quot;&gt;loaded&lt;/a&gt; or
-  &lt;a href=#timed-track-failed-to-load title=&quot;timed track failed to load&quot;&gt;failed to load&lt;/a&gt;.&lt;/p&gt;
 
-
   &lt;h6 id=sourcing-in-band-timed-tracks&gt;&lt;span class=secno&gt;4.8.10.10.2 &lt;/span&gt;Sourcing in-band timed tracks&lt;/h6&gt;
 
   &lt;p&gt;A &lt;dfn id=media-resource-specific-timed-track&gt;media-resource-specific timed track&lt;/dfn&gt; is a &lt;a href=#timed-track&gt;timed
@@ -26306,8 +26322,9 @@
   &lt;h6 id=sourcing-out-of-band-timed-tracks&gt;&lt;span class=secno&gt;4.8.10.10.3 &lt;/span&gt;Sourcing out-of-band timed tracks&lt;/h6&gt;
 
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is created, it must be
-  associated with a new &lt;a href=#timed-track&gt;timed track&lt;/a&gt; and its corresponding
-  new &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+  associated with a new &lt;a href=#timed-track&gt;timed track&lt;/a&gt; (with its value set
+  as defined below) and its corresponding new &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt;
+  object.&lt;/p&gt;
 
   &lt;p&gt;The &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; is determined from the state of
   the element's &lt;code title=attr-track-kind&gt;&lt;a href=#attr-track-kind&gt;kind&lt;/a&gt;&lt;/code&gt; attribute
@@ -26341,25 +26358,68 @@
   &lt;p class=note&gt;Changes to the &lt;a href=#track-url&gt;track URL&lt;/a&gt; are handled in
   the algorithm below.&lt;/p&gt;
 
-  &lt;p class=XXX&gt;...cues...&lt;/p&gt;
+  &lt;p&gt;The &lt;a href=#timed-track-list-of-cues&gt;timed track list of cues&lt;/a&gt; is initially empty. It
+  is dynamically modified when the referenced file is parsed.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's parent element changes and
-  the new parent is a &lt;a href=#media-element&gt;media element&lt;/a&gt;, then add the
-  &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's corresponding &lt;a href=#timed-track&gt;timed track&lt;/a&gt;
-  to the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed
+  the new parent is a &lt;a href=#media-element&gt;media element&lt;/a&gt;, then the user agent
+  must add the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's corresponding &lt;a href=#timed-track&gt;timed
+  track&lt;/a&gt; to the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed
   tracks&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's parent element changes and
-  the old parent was a &lt;a href=#media-element&gt;media element&lt;/a&gt;, then remove the
-  &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's corresponding &lt;a href=#timed-track&gt;timed track&lt;/a&gt;
-  from the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed
-  tracks&lt;/a&gt;.&lt;/p&gt;
+  the old parent was a &lt;a href=#media-element&gt;media element&lt;/a&gt;, then the user agent
+  must remove the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's corresponding
+  &lt;a href=#timed-track&gt;timed track&lt;/a&gt; from the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s
+  &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;a href=#timed-track&gt;timed track&lt;/a&gt; corresponding to a
   &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is added to a &lt;a href=#media-element&gt;media
-  element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt;, &lt;span class=XXX&gt;update the mode appropriately&lt;/span&gt;.&lt;/p&gt;
+  element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt;, the user agent
+  must set the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; appropriately, as
+  determined by the following conditions:&lt;/p&gt;
 
-  &lt;p&gt;When a &lt;a href=#timed-track&gt;timed track&lt;/a&gt; corresponding to a
+  &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; is &lt;code title=dom-TimedTrack-kind-subtitles&gt;&lt;a href=#dom-timedtrack-kind-subtitles&gt;subtitles&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-TimedTrack-kind-captions&gt;&lt;a href=#dom-timedtrack-kind-captions&gt;captions&lt;/a&gt;&lt;/code&gt; and the user
+   has indicated an interest in having a track with this &lt;a href=#timed-track-kind&gt;timed
+   track kind&lt;/a&gt;, &lt;a href=#timed-track-language&gt;timed track language&lt;/a&gt;, and
+   &lt;a href=#timed-track-label&gt;timed track label&lt;/a&gt; enabled, and there is no other
+   &lt;a href=#timed-track&gt;timed track&lt;/a&gt; in the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s
+   &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt; with a &lt;a href=#timed-track-kind&gt;timed track
+   kind&lt;/a&gt; of either &lt;code title=dom-TimedTrack-kind-subtitles&gt;&lt;a href=#dom-timedtrack-kind-subtitles&gt;subtitles&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-TimedTrack-kind-captions&gt;&lt;a href=#dom-timedtrack-kind-captions&gt;captions&lt;/a&gt;&lt;/code&gt; whose
+   &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; is &lt;a href=#timed-track-showing title=&quot;timed track
+   showing&quot;&gt;showing&lt;/a&gt;&lt;/dt&gt;
+
+   &lt;dt&gt;If the &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; is &lt;code title=dom-TimedTrack-kind-descriptions&gt;&lt;a href=#dom-timedtrack-kind-descriptions&gt;descriptions&lt;/a&gt;&lt;/code&gt; and
+   the user has indicated an interest in having text descriptions with
+   this &lt;a href=#timed-track-language&gt;timed track language&lt;/a&gt; and &lt;a href=#timed-track-label&gt;timed track
+   label&lt;/a&gt; enabled, and there is no other &lt;a href=#timed-track&gt;timed
+   track&lt;/a&gt; in the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of
+   timed tracks&lt;/a&gt; with a &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; of &lt;code title=dom-TimedTrack-kind-descriptions&gt;&lt;a href=#dom-timedtrack-kind-descriptions&gt;descriptions&lt;/a&gt;&lt;/code&gt; whose
+   &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; is &lt;a href=#timed-track-showing title=&quot;timed track
+   showing&quot;&gt;showing&lt;/a&gt;&lt;/dt&gt;
+
+   &lt;dt&gt;If the &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; is &lt;code title=dom-TimedTrack-kind-chapters&gt;&lt;a href=#dom-timedtrack-kind-chapters&gt;chapters&lt;/a&gt;&lt;/code&gt; and the
+   &lt;a href=#timed-track-language&gt;timed track language&lt;/a&gt; is one that the user agent has
+   reason to believe is appropriate for the user, and there is no
+   other &lt;a href=#timed-track&gt;timed track&lt;/a&gt; in the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s
+   &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt; with a &lt;a href=#timed-track-kind&gt;timed track
+   kind&lt;/a&gt; of &lt;code title=dom-TimedTrack-kind-chapters&gt;&lt;a href=#dom-timedtrack-kind-chapters&gt;chapters&lt;/a&gt;&lt;/code&gt; whose
+   &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; is &lt;a href=#timed-track-showing title=&quot;timed track
+   showing&quot;&gt;showing&lt;/a&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Let the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; be &lt;a href=#timed-track-showing title=&quot;timed
+    track showing&quot;&gt;showing&lt;/a&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+   &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Let the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; be &lt;a href=#timed-track-disabled title=&quot;timed
+    track disabled&quot;&gt;disabled&lt;/a&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;p&gt;When a &lt;a href=#timed-track&gt;timed track&lt;/a&gt; corresponding to a
   &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is created with &lt;a href=#timed-track-mode&gt;timed track
   mode&lt;/a&gt; set to &lt;a href=#timed-track-hidden title=&quot;timed track hidden&quot;&gt;hidden&lt;/a&gt; or
   &lt;a href=#timed-track-showing title=&quot;timed track showing&quot;&gt;showing&lt;/a&gt;, and when a
@@ -26368,8 +26428,11 @@
   changes its &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; to &lt;a href=#timed-track-hidden title=&quot;timed
   track hidden&quot;&gt;hidden&lt;/a&gt; or &lt;a href=#timed-track-showing title=&quot;timed track
   showing&quot;&gt;showing&lt;/a&gt; for the first time, the user agent must
-  immediately and synchronously run the 
-  following steps:&lt;/p&gt;
+  immediately and synchronously run the following algorithm. This
+  algorithm interacts closely with the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;
+  mechanism; in particular, it has a &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt;
+  (which is triggered as part of the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;
+  algorithm). The step in that section is marked with &#8987;.&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Set the &lt;a href=#timed-track-readiness-state&gt;timed track readiness state&lt;/a&gt; to &lt;a href=#timed-track-loading title=&quot;timed track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
 
@@ -26392,9 +26455,17 @@
     &lt;p&gt;The &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; &lt;a href=#queue-a-task title=&quot;queue
     a task&quot;&gt;queued&lt;/a&gt; by the &lt;a href=#fetch title=fetch&gt;fetching
     algorithm&lt;/a&gt; on the &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; to
-    process the data as it is being fetched must &lt;span class=XXX&gt;...this is where cross-origin checks go&lt;/span&gt;.&lt;/p&gt;
+    process the data as it is being fetched must run the following
+    steps:&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; fails for
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;span class=XXX&gt;...this is where cross-origin checks
+     go...&lt;/span&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p class=XXX&gt;determine format...&lt;/li&gt;
+
+     &lt;li&gt;&lt;p class=XXX&gt;hand off to appropriate parser...&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; fails for
     any reason (network error, the server returns an error code, the
     cross-origin checks mentioned above fail, etc), or if &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; is the empty string, then &lt;a href=#queue-a-task&gt;queue a
     task&lt;/a&gt; to first change the &lt;a href=#timed-track-readiness-state&gt;timed track readiness state&lt;/a&gt;
@@ -26448,6 +26519,24 @@
    hidden&quot;&gt;hidden&lt;/a&gt; or &lt;a href=#timed-track-showing title=&quot;timed track
    showing&quot;&gt;showing&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#timed-track-readiness-state&gt;timed track readiness state&lt;/a&gt; is
+   no longer set to &lt;a href=#timed-track-loading title=&quot;timed track
+   loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#await-a-stable-state&gt;Await a stable state&lt;/a&gt;. The &lt;a href=#synchronous-section&gt;synchronous
+   section&lt;/a&gt; consists of the following step. (The step in the
+   &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; is marked with &#8987;.)&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&#8987; Set the &lt;a href=#timed-track-readiness-state&gt;timed track readiness state&lt;/a&gt; to
+   &lt;a href=#timed-track-loading title=&quot;timed track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;!-- if you add more, change the grammar of the sentences above to
+   be plural with respect to the number of synchronous steps (both in
+   the step above and in the intro to the whole algorithm) --&gt;
+
+   &lt;li&gt;&lt;p&gt;End the &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt;, continuing the
+   remaining steps asynchronously.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;download&lt;/i&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;/div&gt;

Modified: index
===================================================================
--- index	2010-06-24 06:51:45 UTC (rev 5109)
+++ index	2010-06-24 22:05:12 UTC (rev 5110)
@@ -1269,7 +1269,7 @@
    present in the W3C version due to the W3C HTML working group not
    wanting the examples to be quite so brutally honest, as documented
    in &lt;a href=<A HREF="http://lists.w3.org/Archives/Public/public-html/2010Jun/0562.html">http://lists.w3.org/Archives/Public/public-html/2010Jun/0562.html</A>&gt;this
-   working group decision from June 2010&lt;/a&gt;.
+   working group decision from June 2010&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;The W3C version omits a paragraph of implementation advice
    because of &lt;a href=<A HREF="http://lists.w3.org/Archives/Public/public-html/2010Jun/0001.html">http://lists.w3.org/Archives/Public/public-html/2010Jun/0001.html</A>&gt;a
@@ -26031,17 +26031,27 @@
     timed track&lt;/a&gt; can change dynamically, either because the
     &lt;a href=#timed-track&gt;timed track&lt;/a&gt; has &lt;a href=#timed-track-not-loaded title=&quot;timed track not
     loaded&quot;&gt;not yet been loaded&lt;/a&gt; or is still &lt;a href=#timed-track-loading title=&quot;timed
-    track loading&quot;&gt;loading&lt;/a&gt;, or in the case of a &lt;a href=#timed-track&gt;timed
-    track&lt;/a&gt; corresponding to a &lt;code&gt;&lt;a href=#mutabletimedtrack&gt;MutableTimedTrack&lt;/a&gt;&lt;/code&gt;
-    object, where individual cues can be added or removed
-    dynamically using the API.&lt;/p&gt;
+    track loading&quot;&gt;loading&lt;/a&gt;, or because the the &lt;a href=#timed-track&gt;timed
+    track&lt;/a&gt; corresponds to a &lt;code&gt;&lt;a href=#mutabletimedtrack&gt;MutableTimedTrack&lt;/a&gt;&lt;/code&gt;
+    object, whose API allows individual cues can be added or removed
+    dynamically.&lt;/p&gt;
 
    &lt;/dd&gt;
 
   &lt;/dl&gt;&lt;p&gt;Each &lt;a href=#timed-track&gt;timed track&lt;/a&gt; has a corresponding
   &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;dfn id=timed-track-cue&gt;timed track cue&lt;/dfn&gt; is the unit of time-sensitive data
+  &lt;p&gt;The &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; of a
+  &lt;a href=#media-element&gt;media element&lt;/a&gt; are &lt;dfn id=the-timed-tracks-are-ready title=&quot;the timed tracks are
+  ready&quot;&gt;ready&lt;/dfn&gt; if all the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
+  tracks&lt;/a&gt; whose &lt;a href=#timed-track-mode title=&quot;timed track mode&quot;&gt;mode&lt;/a&gt; was
+  not in the &lt;a href=#timed-track-disabled title=&quot;timed track disabled&quot;&gt;disabled&lt;/a&gt; state
+  when the element's &lt;a href=#concept-media-load-algorithm title=concept-media-load-algorithm&gt;resource selection
+  algorithm&lt;/a&gt; last started now have a &lt;a href=#timed-track-readiness-state&gt;timed track readiness
+  state&lt;/a&gt; of &lt;a href=#timed-track-loaded title=&quot;timed track loaded&quot;&gt;loaded&lt;/a&gt; or
+  &lt;a href=#timed-track-failed-to-load title=&quot;timed track failed to load&quot;&gt;failed to load&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;A &lt;dfn id=timed-track-cue&gt;timed track cue&lt;/dfn&gt; is the unit of time-sensitive data
   in a &lt;a href=#timed-track&gt;timed track&lt;/a&gt;, corresponding for instance for
   subtitles and captions to the text that appears at a particular time
   and disappears at another time.&lt;/p&gt;
@@ -26085,6 +26095,22 @@
     line extends vertically and is positioned horizontally, with
     consecutive lines displayed to the left of each other&lt;!-- used for
     mongolian --&gt;).&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;a href=#timed-track-cue-writing-direction title=&quot;timed track cue writing direction&quot;&gt;writing
+    direction&lt;/a&gt; is &lt;a href=#timed-track-cue-horizontal-writing-direction title=&quot;timed track cue horizontal
+    writing direction&quot;&gt;horizontal&lt;/a&gt;, then &lt;a href=#timed-track-cue-line-position title=&quot;timed
+    track cue line position&quot;&gt;line position&lt;/a&gt; percentages are
+    relative to the height of the video, and &lt;a href=#timed-track-cue-text-position title=&quot;timed track
+    cue text position&quot;&gt;text position&lt;/a&gt; and &lt;a href=#timed-track-cue-size title=&quot;timed
+    track cue size&quot;&gt;size&lt;/a&gt; percentages are relative to the width
+    of the video.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, &lt;a href=#timed-track-cue-line-position title=&quot;timed track cue line position&quot;&gt;line
+    position&lt;/a&gt; percentages are relative to the width of the
+    video, and &lt;a href=#timed-track-cue-text-position title=&quot;timed track cue text position&quot;&gt;text
+    position&lt;/a&gt; and &lt;a href=#timed-track-cue-size title=&quot;timed track cue size&quot;&gt;size&lt;/a&gt;
+    percentages are relative to the height of the video.&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn id=timed-track-cue-snap-to-lines-flag title=&quot;timed track cue snap-to-lines flag&quot;&gt;A snap-to-lines flag&lt;/dfn&gt;
@@ -26152,17 +26178,7 @@
   cue&lt;/a&gt; is associated with a particular &lt;a href=#timed-track&gt;timed track&lt;/a&gt;,
   the association is permanent.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed tracks&lt;/a&gt; of a
-  &lt;a href=#media-element&gt;media element&lt;/a&gt; are &lt;dfn id=the-timed-tracks-are-ready title=&quot;the timed tracks are
-  ready&quot;&gt;ready&lt;/dfn&gt; if all the &lt;a href=#timed-track title=&quot;timed track&quot;&gt;timed
-  tracks&lt;/a&gt; whose &lt;a href=#timed-track-mode title=&quot;timed track mode&quot;&gt;mode&lt;/a&gt; was
-  not in the &lt;a href=#timed-track-disabled title=&quot;timed track disabled&quot;&gt;disabled&lt;/a&gt; state
-  when the element's &lt;a href=#concept-media-load-algorithm title=concept-media-load-algorithm&gt;resource selection
-  algorithm&lt;/a&gt; last started now have a &lt;a href=#timed-track-readiness-state&gt;timed track readiness
-  state&lt;/a&gt; of &lt;a href=#timed-track-loaded title=&quot;timed track loaded&quot;&gt;loaded&lt;/a&gt; or
-  &lt;a href=#timed-track-failed-to-load title=&quot;timed track failed to load&quot;&gt;failed to load&lt;/a&gt;.&lt;/p&gt;
 
-
   &lt;h6 id=sourcing-in-band-timed-tracks&gt;&lt;span class=secno&gt;4.8.10.10.2 &lt;/span&gt;Sourcing in-band timed tracks&lt;/h6&gt;
 
   &lt;p&gt;A &lt;dfn id=media-resource-specific-timed-track&gt;media-resource-specific timed track&lt;/dfn&gt; is a &lt;a href=#timed-track&gt;timed
@@ -26239,8 +26255,9 @@
   &lt;h6 id=sourcing-out-of-band-timed-tracks&gt;&lt;span class=secno&gt;4.8.10.10.3 &lt;/span&gt;Sourcing out-of-band timed tracks&lt;/h6&gt;
 
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is created, it must be
-  associated with a new &lt;a href=#timed-track&gt;timed track&lt;/a&gt; and its corresponding
-  new &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+  associated with a new &lt;a href=#timed-track&gt;timed track&lt;/a&gt; (with its value set
+  as defined below) and its corresponding new &lt;code&gt;&lt;a href=#timedtrack&gt;TimedTrack&lt;/a&gt;&lt;/code&gt;
+  object.&lt;/p&gt;
 
   &lt;p&gt;The &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; is determined from the state of
   the element's &lt;code title=attr-track-kind&gt;&lt;a href=#attr-track-kind&gt;kind&lt;/a&gt;&lt;/code&gt; attribute
@@ -26274,25 +26291,68 @@
   &lt;p class=note&gt;Changes to the &lt;a href=#track-url&gt;track URL&lt;/a&gt; are handled in
   the algorithm below.&lt;/p&gt;
 
-  &lt;p class=XXX&gt;...cues...&lt;/p&gt;
+  &lt;p&gt;The &lt;a href=#timed-track-list-of-cues&gt;timed track list of cues&lt;/a&gt; is initially empty. It
+  is dynamically modified when the referenced file is parsed.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's parent element changes and
-  the new parent is a &lt;a href=#media-element&gt;media element&lt;/a&gt;, then add the
-  &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's corresponding &lt;a href=#timed-track&gt;timed track&lt;/a&gt;
-  to the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed
+  the new parent is a &lt;a href=#media-element&gt;media element&lt;/a&gt;, then the user agent
+  must add the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's corresponding &lt;a href=#timed-track&gt;timed
+  track&lt;/a&gt; to the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed
   tracks&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's parent element changes and
-  the old parent was a &lt;a href=#media-element&gt;media element&lt;/a&gt;, then remove the
-  &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's corresponding &lt;a href=#timed-track&gt;timed track&lt;/a&gt;
-  from the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed
-  tracks&lt;/a&gt;.&lt;/p&gt;
+  the old parent was a &lt;a href=#media-element&gt;media element&lt;/a&gt;, then the user agent
+  must remove the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element's corresponding
+  &lt;a href=#timed-track&gt;timed track&lt;/a&gt; from the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s
+  &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;a href=#timed-track&gt;timed track&lt;/a&gt; corresponding to a
   &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is added to a &lt;a href=#media-element&gt;media
-  element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt;, &lt;span class=XXX&gt;update the mode appropriately&lt;/span&gt;.&lt;/p&gt;
+  element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt;, the user agent
+  must set the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; appropriately, as
+  determined by the following conditions:&lt;/p&gt;
 
-  &lt;p&gt;When a &lt;a href=#timed-track&gt;timed track&lt;/a&gt; corresponding to a
+  &lt;dl class=switch&gt;&lt;dt&gt;If the &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; is &lt;code title=dom-TimedTrack-kind-subtitles&gt;&lt;a href=#dom-timedtrack-kind-subtitles&gt;subtitles&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-TimedTrack-kind-captions&gt;&lt;a href=#dom-timedtrack-kind-captions&gt;captions&lt;/a&gt;&lt;/code&gt; and the user
+   has indicated an interest in having a track with this &lt;a href=#timed-track-kind&gt;timed
+   track kind&lt;/a&gt;, &lt;a href=#timed-track-language&gt;timed track language&lt;/a&gt;, and
+   &lt;a href=#timed-track-label&gt;timed track label&lt;/a&gt; enabled, and there is no other
+   &lt;a href=#timed-track&gt;timed track&lt;/a&gt; in the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s
+   &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt; with a &lt;a href=#timed-track-kind&gt;timed track
+   kind&lt;/a&gt; of either &lt;code title=dom-TimedTrack-kind-subtitles&gt;&lt;a href=#dom-timedtrack-kind-subtitles&gt;subtitles&lt;/a&gt;&lt;/code&gt; or &lt;code title=dom-TimedTrack-kind-captions&gt;&lt;a href=#dom-timedtrack-kind-captions&gt;captions&lt;/a&gt;&lt;/code&gt; whose
+   &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; is &lt;a href=#timed-track-showing title=&quot;timed track
+   showing&quot;&gt;showing&lt;/a&gt;&lt;/dt&gt;
+
+   &lt;dt&gt;If the &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; is &lt;code title=dom-TimedTrack-kind-descriptions&gt;&lt;a href=#dom-timedtrack-kind-descriptions&gt;descriptions&lt;/a&gt;&lt;/code&gt; and
+   the user has indicated an interest in having text descriptions with
+   this &lt;a href=#timed-track-language&gt;timed track language&lt;/a&gt; and &lt;a href=#timed-track-label&gt;timed track
+   label&lt;/a&gt; enabled, and there is no other &lt;a href=#timed-track&gt;timed
+   track&lt;/a&gt; in the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;a href=#list-of-timed-tracks&gt;list of
+   timed tracks&lt;/a&gt; with a &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; of &lt;code title=dom-TimedTrack-kind-descriptions&gt;&lt;a href=#dom-timedtrack-kind-descriptions&gt;descriptions&lt;/a&gt;&lt;/code&gt; whose
+   &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; is &lt;a href=#timed-track-showing title=&quot;timed track
+   showing&quot;&gt;showing&lt;/a&gt;&lt;/dt&gt;
+
+   &lt;dt&gt;If the &lt;a href=#timed-track-kind&gt;timed track kind&lt;/a&gt; is &lt;code title=dom-TimedTrack-kind-chapters&gt;&lt;a href=#dom-timedtrack-kind-chapters&gt;chapters&lt;/a&gt;&lt;/code&gt; and the
+   &lt;a href=#timed-track-language&gt;timed track language&lt;/a&gt; is one that the user agent has
+   reason to believe is appropriate for the user, and there is no
+   other &lt;a href=#timed-track&gt;timed track&lt;/a&gt; in the &lt;a href=#media-element&gt;media element&lt;/a&gt;'s
+   &lt;a href=#list-of-timed-tracks&gt;list of timed tracks&lt;/a&gt; with a &lt;a href=#timed-track-kind&gt;timed track
+   kind&lt;/a&gt; of &lt;code title=dom-TimedTrack-kind-chapters&gt;&lt;a href=#dom-timedtrack-kind-chapters&gt;chapters&lt;/a&gt;&lt;/code&gt; whose
+   &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; is &lt;a href=#timed-track-showing title=&quot;timed track
+   showing&quot;&gt;showing&lt;/a&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Let the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; be &lt;a href=#timed-track-showing title=&quot;timed
+    track showing&quot;&gt;showing&lt;/a&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+   &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Let the &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; be &lt;a href=#timed-track-disabled title=&quot;timed
+    track disabled&quot;&gt;disabled&lt;/a&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;p&gt;When a &lt;a href=#timed-track&gt;timed track&lt;/a&gt; corresponding to a
   &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is created with &lt;a href=#timed-track-mode&gt;timed track
   mode&lt;/a&gt; set to &lt;a href=#timed-track-hidden title=&quot;timed track hidden&quot;&gt;hidden&lt;/a&gt; or
   &lt;a href=#timed-track-showing title=&quot;timed track showing&quot;&gt;showing&lt;/a&gt;, and when a
@@ -26301,8 +26361,11 @@
   changes its &lt;a href=#timed-track-mode&gt;timed track mode&lt;/a&gt; to &lt;a href=#timed-track-hidden title=&quot;timed
   track hidden&quot;&gt;hidden&lt;/a&gt; or &lt;a href=#timed-track-showing title=&quot;timed track
   showing&quot;&gt;showing&lt;/a&gt; for the first time, the user agent must
-  immediately and synchronously run the 
-  following steps:&lt;/p&gt;
+  immediately and synchronously run the following algorithm. This
+  algorithm interacts closely with the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;
+  mechanism; in particular, it has a &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt;
+  (which is triggered as part of the &lt;a href=#event-loop&gt;event loop&lt;/a&gt;
+  algorithm). The step in that section is marked with &#8987;.&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Set the &lt;a href=#timed-track-readiness-state&gt;timed track readiness state&lt;/a&gt; to &lt;a href=#timed-track-loading title=&quot;timed track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
 
@@ -26325,9 +26388,17 @@
     &lt;p&gt;The &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; &lt;a href=#queue-a-task title=&quot;queue
     a task&quot;&gt;queued&lt;/a&gt; by the &lt;a href=#fetch title=fetch&gt;fetching
     algorithm&lt;/a&gt; on the &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; to
-    process the data as it is being fetched must &lt;span class=XXX&gt;...this is where cross-origin checks go&lt;/span&gt;.&lt;/p&gt;
+    process the data as it is being fetched must run the following
+    steps:&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; fails for
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;span class=XXX&gt;...this is where cross-origin checks
+     go...&lt;/span&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p class=XXX&gt;determine format...&lt;/li&gt;
+
+     &lt;li&gt;&lt;p class=XXX&gt;hand off to appropriate parser...&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; fails for
     any reason (network error, the server returns an error code, the
     cross-origin checks mentioned above fail, etc), or if &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; is the empty string, then &lt;a href=#queue-a-task&gt;queue a
     task&lt;/a&gt; to first change the &lt;a href=#timed-track-readiness-state&gt;timed track readiness state&lt;/a&gt;
@@ -26381,6 +26452,24 @@
    hidden&quot;&gt;hidden&lt;/a&gt; or &lt;a href=#timed-track-showing title=&quot;timed track
    showing&quot;&gt;showing&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#timed-track-readiness-state&gt;timed track readiness state&lt;/a&gt; is
+   no longer set to &lt;a href=#timed-track-loading title=&quot;timed track
+   loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#await-a-stable-state&gt;Await a stable state&lt;/a&gt;. The &lt;a href=#synchronous-section&gt;synchronous
+   section&lt;/a&gt; consists of the following step. (The step in the
+   &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; is marked with &#8987;.)&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&#8987; Set the &lt;a href=#timed-track-readiness-state&gt;timed track readiness state&lt;/a&gt; to
+   &lt;a href=#timed-track-loading title=&quot;timed track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;!-- if you add more, change the grammar of the sentences above to
+   be plural with respect to the number of synchronous steps (both in
+   the step above and in the intro to the whole algorithm) --&gt;
+
+   &lt;li&gt;&lt;p&gt;End the &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt;, continuing the
+   remaining steps asynchronously.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;download&lt;/i&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;/div&gt;

Modified: source
===================================================================
--- source	2010-06-24 06:51:45 UTC (rev 5109)
+++ source	2010-06-24 22:05:12 UTC (rev 5110)
@@ -66,7 +66,7 @@
    wanting the examples to be quite so brutally honest, as documented
    in &lt;a
    href=&quot;<A HREF="http://lists.w3.org/Archives/Public/public-html/2010Jun/0562.html">http://lists.w3.org/Archives/Public/public-html/2010Jun/0562.html</A>&quot;&gt;this
-   working group decision from June 2010&lt;/a&gt;.&lt;/p&gt;
+   working group decision from June 2010&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;The W3C version omits a paragraph of implementation advice
    because of &lt;a
@@ -28238,10 +28238,10 @@
     timed track&lt;/span&gt; can change dynamically, either because the
     &lt;span&gt;timed track&lt;/span&gt; has &lt;span title=&quot;timed track not
     loaded&quot;&gt;not yet been loaded&lt;/span&gt; or is still &lt;span title=&quot;timed
-    track loading&quot;&gt;loading&lt;/span&gt;, or in the case of a &lt;span&gt;timed
-    track&lt;/span&gt; corresponding to a &lt;code&gt;MutableTimedTrack&lt;/code&gt;
-    object, where individual cues can be added or removed
-    dynamically using the API.&lt;/p&gt;
+    track loading&quot;&gt;loading&lt;/span&gt;, or because the the &lt;span&gt;timed
+    track&lt;/span&gt; corresponds to a &lt;code&gt;MutableTimedTrack&lt;/code&gt;
+    object, whose API allows individual cues can be added or removed
+    dynamically.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -28250,6 +28250,19 @@
   &lt;p&gt;Each &lt;span&gt;timed track&lt;/span&gt; has a corresponding
   &lt;code&gt;TimedTrack&lt;/code&gt; object.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;span title=&quot;timed track&quot;&gt;timed tracks&lt;/span&gt; of a
+  &lt;span&gt;media element&lt;/span&gt; are &lt;dfn title=&quot;the timed tracks are
+  ready&quot;&gt;ready&lt;/dfn&gt; if all the &lt;span title=&quot;timed track&quot;&gt;timed
+  tracks&lt;/span&gt; whose &lt;span title=&quot;timed track mode&quot;&gt;mode&lt;/span&gt; was
+  not in the &lt;span title=&quot;timed track disabled&quot;&gt;disabled&lt;/span&gt; state
+  when the element's &lt;span
+  title=&quot;concept-media-load-algorithm&quot;&gt;resource selection
+  algorithm&lt;/span&gt; last started now have a &lt;span&gt;timed track readiness
+  state&lt;/span&gt; of &lt;span title=&quot;timed track loaded&quot;&gt;loaded&lt;/span&gt; or
+  &lt;span title=&quot;timed track failed to load&quot;&gt;failed to load&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;
+
   &lt;p&gt;A &lt;dfn&gt;timed track cue&lt;/dfn&gt; is the unit of time-sensitive data
   in a &lt;span&gt;timed track&lt;/span&gt;, corresponding for instance for
   subtitles and captions to the text that appears at a particular time
@@ -28296,6 +28309,22 @@
     line extends vertically and is positioned horizontally, with
     consecutive lines displayed to the left of each other&lt;!-- used for
     mongolian --&gt;).&lt;/p&gt;
+
+    &lt;p&gt;If the &lt;span title=&quot;timed track cue writing direction&quot;&gt;writing
+    direction&lt;/span&gt; is &lt;span title=&quot;timed track cue horizontal
+    writing direction&quot;&gt;horizontal&lt;/span&gt;, then &lt;span title=&quot;timed
+    track cue line position&quot;&gt;line position&lt;/span&gt; percentages are
+    relative to the height of the video, and &lt;span title=&quot;timed track
+    cue text position&quot;&gt;text position&lt;/span&gt; and &lt;span title=&quot;timed
+    track cue size&quot;&gt;size&lt;/span&gt; percentages are relative to the width
+    of the video.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, &lt;span title=&quot;timed track cue line position&quot;&gt;line
+    position&lt;/span&gt; percentages are relative to the width of the
+    video, and &lt;span title=&quot;timed track cue text position&quot;&gt;text
+    position&lt;/span&gt; and &lt;span title=&quot;timed track cue size&quot;&gt;size&lt;/span&gt;
+    percentages are relative to the height of the video.&lt;/p&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn title=&quot;timed track cue snap-to-lines flag&quot;&gt;A snap-to-lines flag&lt;/dfn&gt;
@@ -28367,18 +28396,7 @@
   cue&lt;/span&gt; is associated with a particular &lt;span&gt;timed track&lt;/span&gt;,
   the association is permanent.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;span title=&quot;timed track&quot;&gt;timed tracks&lt;/span&gt; of a
-  &lt;span&gt;media element&lt;/span&gt; are &lt;dfn title=&quot;the timed tracks are
-  ready&quot;&gt;ready&lt;/dfn&gt; if all the &lt;span title=&quot;timed track&quot;&gt;timed
-  tracks&lt;/span&gt; whose &lt;span title=&quot;timed track mode&quot;&gt;mode&lt;/span&gt; was
-  not in the &lt;span title=&quot;timed track disabled&quot;&gt;disabled&lt;/span&gt; state
-  when the element's &lt;span
-  title=&quot;concept-media-load-algorithm&quot;&gt;resource selection
-  algorithm&lt;/span&gt; last started now have a &lt;span&gt;timed track readiness
-  state&lt;/span&gt; of &lt;span title=&quot;timed track loaded&quot;&gt;loaded&lt;/span&gt; or
-  &lt;span title=&quot;timed track failed to load&quot;&gt;failed to load&lt;/span&gt;.&lt;/p&gt;
 
-
   &lt;h6&gt;Sourcing in-band timed tracks&lt;/h6&gt;
 
   &lt;p&gt;A &lt;dfn&gt;media-resource-specific timed track&lt;/dfn&gt; is a &lt;span&gt;timed
@@ -28461,8 +28479,9 @@
   &lt;h6&gt;Sourcing out-of-band timed tracks&lt;/h6&gt;
 
   &lt;p&gt;When a &lt;code&gt;track&lt;/code&gt; element is created, it must be
-  associated with a new &lt;span&gt;timed track&lt;/span&gt; and its corresponding
-  new &lt;code&gt;TimedTrack&lt;/code&gt; object.&lt;/p&gt;
+  associated with a new &lt;span&gt;timed track&lt;/span&gt; (with its value set
+  as defined below) and its corresponding new &lt;code&gt;TimedTrack&lt;/code&gt;
+  object.&lt;/p&gt;
 
   &lt;p&gt;The &lt;span&gt;timed track kind&lt;/span&gt; is determined from the state of
   the element's &lt;code title=&quot;attr-track-kind&quot;&gt;kind&lt;/code&gt; attribute
@@ -28509,25 +28528,79 @@
   &lt;p class=&quot;note&quot;&gt;Changes to the &lt;span&gt;track URL&lt;/span&gt; are handled in
   the algorithm below.&lt;/p&gt;
 
-  &lt;p class=&quot;XXX&quot;&gt;...cues...&lt;/p&gt;
+  &lt;p&gt;The &lt;span&gt;timed track list of cues&lt;/span&gt; is initially empty. It
+  is dynamically modified when the referenced file is parsed.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;code&gt;track&lt;/code&gt; element's parent element changes and
-  the new parent is a &lt;span&gt;media element&lt;/span&gt;, then add the
-  &lt;code&gt;track&lt;/code&gt; element's corresponding &lt;span&gt;timed track&lt;/span&gt;
-  to the &lt;span&gt;media element&lt;/span&gt;'s &lt;span&gt;list of timed
+  the new parent is a &lt;span&gt;media element&lt;/span&gt;, then the user agent
+  must add the &lt;code&gt;track&lt;/code&gt; element's corresponding &lt;span&gt;timed
+  track&lt;/span&gt; to the &lt;span&gt;media element&lt;/span&gt;'s &lt;span&gt;list of timed
   tracks&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;code&gt;track&lt;/code&gt; element's parent element changes and
-  the old parent was a &lt;span&gt;media element&lt;/span&gt;, then remove the
-  &lt;code&gt;track&lt;/code&gt; element's corresponding &lt;span&gt;timed track&lt;/span&gt;
-  from the &lt;span&gt;media element&lt;/span&gt;'s &lt;span&gt;list of timed
-  tracks&lt;/span&gt;.&lt;/p&gt;
+  the old parent was a &lt;span&gt;media element&lt;/span&gt;, then the user agent
+  must remove the &lt;code&gt;track&lt;/code&gt; element's corresponding
+  &lt;span&gt;timed track&lt;/span&gt; from the &lt;span&gt;media element&lt;/span&gt;'s
+  &lt;span&gt;list of timed tracks&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p&gt;When a &lt;span&gt;timed track&lt;/span&gt; corresponding to a
   &lt;code&gt;track&lt;/code&gt; element is added to a &lt;span&gt;media
-  element&lt;/span&gt;'s &lt;span&gt;list of timed tracks&lt;/span&gt;, &lt;span
-  class=&quot;XXX&quot;&gt;update the mode appropriately&lt;/span&gt;.&lt;/p&gt;
+  element&lt;/span&gt;'s &lt;span&gt;list of timed tracks&lt;/span&gt;, the user agent
+  must set the &lt;span&gt;timed track mode&lt;/span&gt; appropriately, as
+  determined by the following conditions:&lt;/p&gt;
 
+  &lt;dl class=&quot;switch&quot;&gt;
+
+   &lt;dt&gt;If the &lt;span&gt;timed track kind&lt;/span&gt; is &lt;code
+   title=&quot;dom-TimedTrack-kind-subtitles&quot;&gt;subtitles&lt;/code&gt; or &lt;code
+   title=&quot;dom-TimedTrack-kind-captions&quot;&gt;captions&lt;/code&gt; and the user
+   has indicated an interest in having a track with this &lt;span&gt;timed
+   track kind&lt;/span&gt;, &lt;span&gt;timed track language&lt;/span&gt;, and
+   &lt;span&gt;timed track label&lt;/span&gt; enabled, and there is no other
+   &lt;span&gt;timed track&lt;/span&gt; in the &lt;span&gt;media element&lt;/span&gt;'s
+   &lt;span&gt;list of timed tracks&lt;/span&gt; with a &lt;span&gt;timed track
+   kind&lt;/span&gt; of either &lt;code
+   title=&quot;dom-TimedTrack-kind-subtitles&quot;&gt;subtitles&lt;/code&gt; or &lt;code
+   title=&quot;dom-TimedTrack-kind-captions&quot;&gt;captions&lt;/code&gt; whose
+   &lt;span&gt;timed track mode&lt;/span&gt; is &lt;span title=&quot;timed track
+   showing&quot;&gt;showing&lt;/span&gt;&lt;/dt&gt;
+
+   &lt;dt&gt;If the &lt;span&gt;timed track kind&lt;/span&gt; is &lt;code
+   title=&quot;dom-TimedTrack-kind-descriptions&quot;&gt;descriptions&lt;/code&gt; and
+   the user has indicated an interest in having text descriptions with
+   this &lt;span&gt;timed track language&lt;/span&gt; and &lt;span&gt;timed track
+   label&lt;/span&gt; enabled, and there is no other &lt;span&gt;timed
+   track&lt;/span&gt; in the &lt;span&gt;media element&lt;/span&gt;'s &lt;span&gt;list of
+   timed tracks&lt;/span&gt; with a &lt;span&gt;timed track kind&lt;/span&gt; of &lt;code
+   title=&quot;dom-TimedTrack-kind-descriptions&quot;&gt;descriptions&lt;/code&gt; whose
+   &lt;span&gt;timed track mode&lt;/span&gt; is &lt;span title=&quot;timed track
+   showing&quot;&gt;showing&lt;/span&gt;&lt;/dt&gt;
+
+   &lt;dt&gt;If the &lt;span&gt;timed track kind&lt;/span&gt; is &lt;code
+   title=&quot;dom-TimedTrack-kind-chapters&quot;&gt;chapters&lt;/code&gt; and the
+   &lt;span&gt;timed track language&lt;/span&gt; is one that the user agent has
+   reason to believe is appropriate for the user, and there is no
+   other &lt;span&gt;timed track&lt;/span&gt; in the &lt;span&gt;media element&lt;/span&gt;'s
+   &lt;span&gt;list of timed tracks&lt;/span&gt; with a &lt;span&gt;timed track
+   kind&lt;/span&gt; of &lt;code
+   title=&quot;dom-TimedTrack-kind-chapters&quot;&gt;chapters&lt;/code&gt; whose
+   &lt;span&gt;timed track mode&lt;/span&gt; is &lt;span title=&quot;timed track
+   showing&quot;&gt;showing&lt;/span&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Let the &lt;span&gt;timed track mode&lt;/span&gt; be &lt;span title=&quot;timed
+    track showing&quot;&gt;showing&lt;/span&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+   &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+   &lt;dd&gt;
+    &lt;p&gt;Let the &lt;span&gt;timed track mode&lt;/span&gt; be &lt;span title=&quot;timed
+    track disabled&quot;&gt;disabled&lt;/span&gt;.&lt;/p&gt;
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;
+
   &lt;p&gt;When a &lt;span&gt;timed track&lt;/span&gt; corresponding to a
   &lt;code&gt;track&lt;/code&gt; element is created with &lt;span&gt;timed track
   mode&lt;/span&gt; set to &lt;span title=&quot;timed track hidden&quot;&gt;hidden&lt;/span&gt; or
@@ -28538,8 +28611,11 @@
   changes its &lt;span&gt;timed track mode&lt;/span&gt; to &lt;span title=&quot;timed
   track hidden&quot;&gt;hidden&lt;/span&gt; or &lt;span title=&quot;timed track
   showing&quot;&gt;showing&lt;/span&gt; for the first time, the user agent must
-  immediately and synchronously run the 
-  following steps:&lt;/p&gt;
+  immediately and synchronously run the following algorithm. This
+  algorithm interacts closely with the &lt;span&gt;event loop&lt;/span&gt;
+  mechanism; in particular, it has a &lt;span&gt;synchronous section&lt;/span&gt;
+  (which is triggered as part of the &lt;span&gt;event loop&lt;/span&gt;
+  algorithm). The step in that section is marked with &amp;#x231B;.&lt;/p&gt;
 
   &lt;ol&gt;
 
@@ -28565,9 +28641,20 @@
     &lt;p&gt;The &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt; &lt;span title=&quot;queue
     a task&quot;&gt;queued&lt;/span&gt; by the &lt;span title=&quot;fetch&quot;&gt;fetching
     algorithm&lt;/span&gt; on the &lt;span&gt;networking task source&lt;/span&gt; to
-    process the data as it is being fetched must &lt;span
-    class=&quot;XXX&quot;&gt;...this is where cross-origin checks go&lt;/span&gt;.&lt;/p&gt;
+    process the data as it is being fetched must run the following
+    steps:&lt;/p&gt;
 
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span class=&quot;XXX&quot;&gt;...this is where cross-origin checks
+     go...&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p class=&quot;XXX&quot;&gt;determine format...&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p class=&quot;XXX&quot;&gt;hand off to appropriate parser...&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
     &lt;p&gt;If the &lt;span title=&quot;fetch&quot;&gt;fetching algorithm&lt;/span&gt; fails for
     any reason (network error, the server returns an error code, the
     cross-origin checks mentioned above fail, etc), or if &lt;var
@@ -28636,6 +28723,24 @@
    hidden&quot;&gt;hidden&lt;/span&gt; or &lt;span title=&quot;timed track
    showing&quot;&gt;showing&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Wait until the &lt;span&gt;timed track readiness state&lt;/span&gt; is
+   no longer set to &lt;span title=&quot;timed track
+   loading&quot;&gt;loading&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Await a stable state&lt;/span&gt;. The &lt;span&gt;synchronous
+   section&lt;/span&gt; consists of the following step. (The step in the
+   &lt;span&gt;synchronous section&lt;/span&gt; is marked with &amp;#x231B;.)&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&amp;#x231B; Set the &lt;span&gt;timed track readiness state&lt;/span&gt; to
+   &lt;span title=&quot;timed track loading&quot;&gt;loading&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;!-- if you add more, change the grammar of the sentences above to
+   be plural with respect to the number of synchronous steps (both in
+   the step above and in the intro to the whole algorithm) --&gt;
+
+   &lt;li&gt;&lt;p&gt;End the &lt;span&gt;synchronous section&lt;/span&gt;, continuing the
+   remaining steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;download&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011979.html">[html5] r5109 - [e] (0) Update list of differences.
</A></li>
	<LI>Next message: <A HREF="011981.html">[html5] r5111 - [giow] (0) Captions - Stage 11.3: completed the	external timed track download pr [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11980">[ date ]</a>
              <a href="thread.html#11980">[ thread ]</a>
              <a href="subject.html#11980">[ subject ]</a>
              <a href="author.html#11980">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
