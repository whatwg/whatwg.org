<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r4633 - [giowt] (0) Microdata: Make the RDF output not	generate duplicate blank nodes fo [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4633%20-%20%5Bgiowt%5D%20%280%29%20Microdata%3A%20Make%20the%20RDF%20output%20not%0A%09generate%20duplicate%20blank%20nodes%20fo%20%5B...%5D&In-Reply-To=%3C20100129085249.E9EE01C84004%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011500.html">
   <LINK REL="Next"  HREF="011502.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r4633 - [giowt] (0) Microdata: Make the RDF output not	generate duplicate blank nodes fo [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r4633%20-%20%5Bgiowt%5D%20%280%29%20Microdata%3A%20Make%20the%20RDF%20output%20not%0A%09generate%20duplicate%20blank%20nodes%20fo%20%5B...%5D&In-Reply-To=%3C20100129085249.E9EE01C84004%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r4633 - [giowt] (0) Microdata: Make the RDF output not	generate duplicate blank nodes fo [...]">whatwg at whatwg.org
       </A><BR>
    <I>Fri Jan 29 00:52:49 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="011500.html">[html5] r4632 - [agiow] (2) Make history traversal unrelated to	history truncation always async. [...]
</A></li>
        <LI>Next message: <A HREF="011502.html">[html5] r4634 - [e] (0) Make the microdata spec stand slightly more	alone.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11501">[ date ]</a>
              <a href="thread.html#11501">[ thread ]</a>
              <a href="subject.html#11501">[ subject ]</a>
              <a href="author.html#11501">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2010-01-29 00:52:47 -0800 (Fri, 29 Jan 2010)
New Revision: 4633

Modified:
   complete.html
   index
   source
Log:
[giowt] (0) Microdata: Make the RDF output not generate duplicate blank nodes for un-named items referenced twice. Make it generate triples for blank nodes that are properties of nodes with types.

Modified: complete.html
===================================================================
--- complete.html	2010-01-29 01:31:38 UTC (rev 4632)
+++ complete.html	2010-01-29 08:52:47 UTC (rev 4633)
@@ -49040,6 +49040,13 @@
 
    &lt;li&gt;
 
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; be a mapping of items to
+    subjects, initially empty.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;For each element that is also a &lt;a href=#top-level-microdata-items title=&quot;top-level
     microdata items&quot;&gt;top-level microdata item&lt;/a&gt;, run the
     following steps:&lt;/p&gt;
@@ -49047,8 +49054,7 @@
     &lt;ol&gt;&lt;li&gt;
 
       &lt;p&gt;&lt;a href=#generate-the-triples-for-an-item title=&quot;generate the triples for an item&quot;&gt;Generate the
-      triples for the item&lt;/a&gt;. Let &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; be the
-      subject returned.&lt;/p&gt;
+      triples for the item&lt;/a&gt;. Pass a reference to &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; as the item/subject list. Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the subject returned.&lt;/p&gt;
 
      &lt;/li&gt;
 
@@ -49058,111 +49064,172 @@
 
       &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;a href=&quot;#the-document's-current-address&quot;&gt;the document's current address&lt;/a&gt;
        &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item&lt;/code">http://www.w3.org/1999/xhtml/microdata#item&lt;/code</A>&gt;
-       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;
+       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;
       &lt;/dl&gt;&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the user agent is to &lt;dfn id=generate-the-triples-for-an-item&gt;generate the triples for an
-  item&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, it must follow the following
+  item&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, given a reference to an
+  item/subject list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, and optionally given a
+  fallback type &lt;var title=&quot;&quot;&gt;fallback type&lt;/var&gt; and property name
+  &lt;var title=&quot;&quot;&gt;fallback name&lt;/var&gt;, it must follow the following
   steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has a &lt;a href=#global-identifier&gt;global
-   identifier&lt;/a&gt; and that &lt;a href=#global-identifier&gt;global identifier&lt;/a&gt; is an
-   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be that
-   &lt;a href=#global-identifier&gt;global identifier&lt;/a&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a new blank node.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is an entry for &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, then let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be the
+   subject of that entry. Otherwise, if &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has a
+   &lt;a href=#global-identifier&gt;global identifier&lt;/a&gt; and that &lt;a href=#global-identifier&gt;global
+   identifier&lt;/a&gt; is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be that &lt;a href=#global-identifier&gt;global
+   identifier&lt;/a&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a
+   new blank node.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Add a mapping from &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, if there
+   isn't one already.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has an &lt;a href=#item-type&gt;item type&lt;/a&gt;
    and that &lt;a href=#item-type&gt;item type&lt;/a&gt; is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;,
    let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; be that &lt;a href=#item-type&gt;item
    type&lt;/a&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; be the empty
    string.&lt;/li&gt;
 
+   &lt;!-- The special characters used in URLs beyond this point are
+   intended to make it so that a different type/name combination
+   couldn't generate the same string. &quot;:&quot; and &quot;%20&quot; are used because
+   they can't be put in /name/ when all this is used. --&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not the empty string, generate
-    the following triple:&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not the empty string, run the
+    following steps:&lt;/p&gt;
 
-    &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-     &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code">http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code</A>&gt;
-     &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
-    &lt;/dl&gt;&lt;/li&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Generate the following triple:&lt;/p&gt;
 
+      &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
+       &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code">http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code</A>&gt;
+       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
+      &lt;/dl&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not contain a U+0023
+     NUMBER SIGN character (#), then append a U+0023 NUMBER SIGN
+     character (#) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not have a U+003A COLON
+     character (:) after its U+0023 NUMBER SIGN character (#), append
+     a U+003A COLON character (:) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string, but &lt;var title=&quot;&quot;&gt;fallback type&lt;/var&gt; is not, run the following
+    substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; have the value of &lt;var title=&quot;&quot;&gt;fallback type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not contain a U+0023
+     NUMBER SIGN character (#), then append a U+0023 NUMBER SIGN
+     character (#) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;!-- Special characters beyond this point have to be something
+     not in /name/ when this is used below, so either &quot;:&quot;, %20, %0D,
+     or %0A. This is so that a different type/name combination
+     couldn't generate the same string. --&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not have a U+003A COLON
+     character (:) after its U+0023 NUMBER SIGN character (#), append
+     a U+003A COLON character (:) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not a
+     U+003A COLON character (:), append a U+0025 PERCENT SIGN
+     character (%), a U+0032 DIGIT TWO character (2), and a U+0030
+     DIGIT ZERO character (0) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;fallback name&lt;/var&gt; to
+     &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;fallback name&lt;/var&gt; that are not valid in the
+     &lt;ifragment&gt; production of the IRI syntax being
+     %-escaped. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
     more &lt;a href=#property-names&gt;property names&lt;/a&gt; and is one of &lt;a href=#the-properties-of-an-item title=&quot;the
     properties of an item&quot;&gt;the properties of the item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, in the order those elements are given by the
     algorithm that returns &lt;a href=#the-properties-of-an-item&gt;the properties of an item&lt;/a&gt;, run
-    the following substeps:&lt;/p&gt;
+    the following substep:&lt;/p&gt;
 
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;property value&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;.&lt;/li&gt;
+    &lt;ol&gt;&lt;li&gt;
 
-     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, then &lt;a href=#generate-the-triples-for-an-item title=&quot;generate the
-     triples for an item&quot;&gt;generate the triples&lt;/a&gt; for &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;, and then replace &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-     with the subject returned from those steps.&lt;/li&gt;
+      &lt;p&gt;For each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;a href=#property-names&gt;property names&lt;/a&gt;, run the
+      following substeps:&lt;/p&gt;
 
-     &lt;!-- could support &lt;time&gt; here somehow, though we'd have to
-     reserialise it, check if the &lt;time&gt; was valid, check if it had a
-     date, a time, a timezone, etc. --&gt;
+      &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is not an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, then
+       abort these substeps.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not one of
-     the &lt;a href=#url-property-elements&gt;URL property elements&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be a plain literal, with the language
-     information set from the &lt;a href=#language&gt;language&lt;/a&gt; of the element, if
-     it is not unknown.&lt;/li&gt;
+       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;property value&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;.&lt;/li&gt;
 
-     &lt;li&gt;
+       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, then &lt;a href=#generate-the-triples-for-an-item title=&quot;generate
+       the triples for an item&quot;&gt;generate the triples&lt;/a&gt; for &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;. Pass a reference to &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; as the item/subject list, and pass &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; as the fallback type and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the fallback property name. Replace &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; by the subject returned from those
+       steps.&lt;/li&gt;
 
-      &lt;p&gt;For each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;a href=#property-names&gt;property names&lt;/a&gt;, run the
-      appropriate substeps from the following list:&lt;/p&gt;
+       &lt;!-- could support &lt;time&gt; here somehow, though we'd have to
+       reserialise it, check if the &lt;time&gt; was valid, check if it had a
+       date, a time, a timezone, etc. --&gt;
 
-      &lt;dl&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is an &lt;a href=#absolute-url&gt;absolute
-       URL&lt;/a&gt;&lt;/dt&gt;
+       &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not one of
+       the &lt;a href=#url-property-elements&gt;URL property elements&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be a plain literal, with the language
+       information set from the &lt;a href=#language&gt;language&lt;/a&gt; of the element, if
+       it is not unknown.&lt;/li&gt;
 
-       &lt;dd&gt;
+       &lt;li&gt;
 
-        &lt;p&gt;Generate the following triple:&lt;/p&gt;
+        &lt;dl&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is an &lt;a href=#absolute-url&gt;absolute
+         URL&lt;/a&gt;&lt;/dt&gt;
 
-        &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-         &lt;dt&gt;predicate &lt;dd&gt; &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
-         &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-        &lt;/dl&gt;&lt;/dd&gt;
+         &lt;dd&gt;
 
-       &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; contains no U+003A COLON
-       character (:)&lt;/dt&gt;
+          &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;.&lt;/p&gt;
 
-       &lt;dd&gt;
+         &lt;/dd&gt;
 
-        &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string, then
-         abort these substeps.&lt;/li&gt;
+         &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; contains no U+003A COLON
+         characters (:)&lt;/dt&gt;
 
-         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; have the same value
-         as &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+         &lt;dd&gt;
 
-         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; does not contain a
-         U+0023 NUMBER SIGN character (#), then append a U+0023 NUMBER
-         SIGN character (#) to &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;.&lt;/li&gt;
+          &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
 
-         &lt;li&gt;&lt;p&gt;Append a U+003A COLON character (:) to &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;.&lt;/li&gt; &lt;!-- has to be something
-         not in /name/, so &quot;:&quot;, so that a different type/name
-         combination couldn't generate the same string --&gt;
+           &lt;li&gt;&lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; is
+           not a U+003A COLON character (:), append a U+0025 PERCENT
+           SIGN character (%), a U+0032 DIGIT TWO character (2), and a
+           U+0030 DIGIT ZERO character (0) to &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;.&lt;/li&gt;
 
-         &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; that are not valid in the &lt;ifragment&gt;
-         production of the IRI syntax being %-escaped.&lt;/li&gt;
+           &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; that are not valid in the
+           &lt;ifragment&gt; production of the IRI syntax being
+           %-escaped. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
 
-         &lt;li&gt;
+           &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; be the
+           concatenation of the string &quot;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#&lt;/code">http://www.w3.org/1999/xhtml/microdata#&lt;/code</A>&gt;&quot;
+           and &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; that are not valid in the &lt;ifragment&gt;
+           production of the IRI syntax being %-escaped. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt; &lt;!-- this ensures
+           you can't use a URL to get the same effect --&gt;
 
-          &lt;p&gt;Generate the following triple:&lt;/p&gt;
+          &lt;/ol&gt;&lt;/dd&gt;
 
-          &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-           &lt;dt&gt;predicate &lt;dd&gt; the concatenation of the string &quot;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#&lt;/code">http://www.w3.org/1999/xhtml/microdata#&lt;/code</A>&gt;&quot; and &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; that are not valid in the &lt;ifragment&gt; production of the IRI syntax being %-escaped &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;
-           &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-          &lt;/dl&gt;&lt;/li&gt;
+        &lt;/dl&gt;&lt;/li&gt;
 
-        &lt;/ol&gt;&lt;/dd&gt;
+       &lt;li&gt;
 
-      &lt;/dl&gt;&lt;/li&gt;
+        &lt;p&gt;Generate the following triple:&lt;/p&gt;
 
+        &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
+         &lt;dt&gt;predicate &lt;dd&gt; &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;
+         &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
+        &lt;/dl&gt;&lt;/li&gt;
+
+      &lt;/ol&gt;&lt;/li&gt;
+
     &lt;/ol&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;.&lt;/li&gt;
@@ -49213,10 +49280,45 @@
 &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> a frbr:Expression ;
      dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK&amp;gt;">http://purl.oreilly.com/product-types/EBOOK&gt;</A> .&lt;/pre&gt;
 
+  &lt;hr&gt;&lt;p&gt;The following snippet of HTML has microdata for two people with
+  the same address:&lt;/p&gt;
 
+  &lt;pre&gt;&lt;p&gt;
+ Both
+ &lt;span itemscope itemtype=&quot;<A HREF="http://microformats.org/profile/hcard">http://microformats.org/profile/hcard</A>&quot; itemref=&quot;home&quot;&gt;&lt;span itemprop=&quot;fn&quot;&gt;Princeton&lt;/span&gt;&lt;/span&gt;
+ and
+ &lt;span itemscope itemtype=&quot;<A HREF="http://microformats.org/profile/hcard">http://microformats.org/profile/hcard</A>&quot; itemref=&quot;home&quot;&gt;&lt;span itemprop=&quot;fn&quot;&gt;Trekkie&lt;/span&gt;&lt;/span&gt;
+ live at
+ &lt;span id=&quot;dome&quot; itemprop=&quot;adr&quot; itemscope&gt;&lt;span itemprop=&quot;street-address&quot;&gt;Avenue Q&lt;/span&gt;.&lt;/span&gt;
+&lt;/p&gt;&lt;/pre&gt;
 
+  &lt;p&gt;...generates these triples expressed in Turtle (including a
+  triple that in this case is expressed twice, though that is not
+  meaningful in RDF):&lt;/p&gt;
 
+  &lt;pre class=turtle&gt;@prefix rdf: &lt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#&amp;gt;">http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</A> .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> dct: &lt;<A HREF="http://purl.org/dc/terms/&amp;gt;">http://purl.org/dc/terms/&gt;</A> .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> hcard: &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#http%3A%2F%2Fmicroformats.org%2Fprofile%2Fhcard%23%3A&amp;gt;">http://www.w3.org/1999/xhtml/microdata#http%3A%2F%2Fmicroformats.org%2Fprofile%2Fhcard%23%3A&gt;</A> .
 
+&lt;&gt; &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item&amp;gt;">http://www.w3.org/1999/xhtml/microdata#item&gt;</A> _:n0 ;
+   &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item&amp;gt;">http://www.w3.org/1999/xhtml/microdata#item&gt;</A> _:n1 .
+_:n0 rdf:type &lt;<A HREF="http://microformats.org/profile/hcard&amp;gt;">http://microformats.org/profile/hcard&gt;</A> ;
+     hcard:fn &quot;Princeton&quot; ;
+     hcard:adr _:n2 .
+_:n1 rdf:type &lt;<A HREF="http://microformats.org/profile/hcard&amp;gt;">http://microformats.org/profile/hcard&gt;</A> ;
+     hcard:fn &quot;Trekkie&quot; ;
+     hcard:adr _:n2 .
+_:n2 hcard:adr%20street-address &quot;Avenue Q&quot; ;
+     hcard:adr%20street-address &quot;Avenue Q&quot; .&lt;/pre&gt;
+
+
+
+
+
+
+
+
+
   &lt;h4 id=atom&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Atom&lt;/h4&gt;
 
   &lt;p&gt;Given a &lt;code&gt;Document&lt;/code&gt; &lt;var title=&quot;&quot;&gt;source&lt;/var&gt;, a user

Modified: index
===================================================================
--- index	2010-01-29 01:31:38 UTC (rev 4632)
+++ index	2010-01-29 08:52:47 UTC (rev 4633)
@@ -48940,6 +48940,13 @@
 
    &lt;li&gt;
 
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; be a mapping of items to
+    subjects, initially empty.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;For each element that is also a &lt;a href=#top-level-microdata-items title=&quot;top-level
     microdata items&quot;&gt;top-level microdata item&lt;/a&gt;, run the
     following steps:&lt;/p&gt;
@@ -48947,8 +48954,7 @@
     &lt;ol&gt;&lt;li&gt;
 
       &lt;p&gt;&lt;a href=#generate-the-triples-for-an-item title=&quot;generate the triples for an item&quot;&gt;Generate the
-      triples for the item&lt;/a&gt;. Let &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; be the
-      subject returned.&lt;/p&gt;
+      triples for the item&lt;/a&gt;. Pass a reference to &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; as the item/subject list. Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the subject returned.&lt;/p&gt;
 
      &lt;/li&gt;
 
@@ -48958,111 +48964,172 @@
 
       &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;a href=&quot;#the-document's-current-address&quot;&gt;the document's current address&lt;/a&gt;
        &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item&lt;/code">http://www.w3.org/1999/xhtml/microdata#item&lt;/code</A>&gt;
-       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;
+       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;
       &lt;/dl&gt;&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the user agent is to &lt;dfn id=generate-the-triples-for-an-item&gt;generate the triples for an
-  item&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, it must follow the following
+  item&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, given a reference to an
+  item/subject list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, and optionally given a
+  fallback type &lt;var title=&quot;&quot;&gt;fallback type&lt;/var&gt; and property name
+  &lt;var title=&quot;&quot;&gt;fallback name&lt;/var&gt;, it must follow the following
   steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has a &lt;a href=#global-identifier&gt;global
-   identifier&lt;/a&gt; and that &lt;a href=#global-identifier&gt;global identifier&lt;/a&gt; is an
-   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be that
-   &lt;a href=#global-identifier&gt;global identifier&lt;/a&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a new blank node.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is an entry for &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, then let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be the
+   subject of that entry. Otherwise, if &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has a
+   &lt;a href=#global-identifier&gt;global identifier&lt;/a&gt; and that &lt;a href=#global-identifier&gt;global
+   identifier&lt;/a&gt; is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be that &lt;a href=#global-identifier&gt;global
+   identifier&lt;/a&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a
+   new blank node.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Add a mapping from &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, if there
+   isn't one already.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has an &lt;a href=#item-type&gt;item type&lt;/a&gt;
    and that &lt;a href=#item-type&gt;item type&lt;/a&gt; is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;,
    let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; be that &lt;a href=#item-type&gt;item
    type&lt;/a&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; be the empty
    string.&lt;/li&gt;
 
+   &lt;!-- The special characters used in URLs beyond this point are
+   intended to make it so that a different type/name combination
+   couldn't generate the same string. &quot;:&quot; and &quot;%20&quot; are used because
+   they can't be put in /name/ when all this is used. --&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not the empty string, generate
-    the following triple:&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not the empty string, run the
+    following steps:&lt;/p&gt;
 
-    &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-     &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code">http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code</A>&gt;
-     &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
-    &lt;/dl&gt;&lt;/li&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Generate the following triple:&lt;/p&gt;
 
+      &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
+       &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code">http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code</A>&gt;
+       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
+      &lt;/dl&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not contain a U+0023
+     NUMBER SIGN character (#), then append a U+0023 NUMBER SIGN
+     character (#) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not have a U+003A COLON
+     character (:) after its U+0023 NUMBER SIGN character (#), append
+     a U+003A COLON character (:) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string, but &lt;var title=&quot;&quot;&gt;fallback type&lt;/var&gt; is not, run the following
+    substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; have the value of &lt;var title=&quot;&quot;&gt;fallback type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not contain a U+0023
+     NUMBER SIGN character (#), then append a U+0023 NUMBER SIGN
+     character (#) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;!-- Special characters beyond this point have to be something
+     not in /name/ when this is used below, so either &quot;:&quot;, %20, %0D,
+     or %0A. This is so that a different type/name combination
+     couldn't generate the same string. --&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not have a U+003A COLON
+     character (:) after its U+0023 NUMBER SIGN character (#), append
+     a U+003A COLON character (:) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not a
+     U+003A COLON character (:), append a U+0025 PERCENT SIGN
+     character (%), a U+0032 DIGIT TWO character (2), and a U+0030
+     DIGIT ZERO character (0) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;fallback name&lt;/var&gt; to
+     &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;fallback name&lt;/var&gt; that are not valid in the
+     &lt;ifragment&gt; production of the IRI syntax being
+     %-escaped. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
     more &lt;a href=#property-names&gt;property names&lt;/a&gt; and is one of &lt;a href=#the-properties-of-an-item title=&quot;the
     properties of an item&quot;&gt;the properties of the item&lt;/a&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, in the order those elements are given by the
     algorithm that returns &lt;a href=#the-properties-of-an-item&gt;the properties of an item&lt;/a&gt;, run
-    the following substeps:&lt;/p&gt;
+    the following substep:&lt;/p&gt;
 
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;property value&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;.&lt;/li&gt;
+    &lt;ol&gt;&lt;li&gt;
 
-     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, then &lt;a href=#generate-the-triples-for-an-item title=&quot;generate the
-     triples for an item&quot;&gt;generate the triples&lt;/a&gt; for &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;, and then replace &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-     with the subject returned from those steps.&lt;/li&gt;
+      &lt;p&gt;For each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;a href=#property-names&gt;property names&lt;/a&gt;, run the
+      following substeps:&lt;/p&gt;
 
-     &lt;!-- could support &lt;time&gt; here somehow, though we'd have to
-     reserialise it, check if the &lt;time&gt; was valid, check if it had a
-     date, a time, a timezone, etc. --&gt;
+      &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is not an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, then
+       abort these substeps.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not one of
-     the &lt;a href=#url-property-elements&gt;URL property elements&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be a plain literal, with the language
-     information set from the &lt;a href=#language&gt;language&lt;/a&gt; of the element, if
-     it is not unknown.&lt;/li&gt;
+       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the &lt;a href=#concept-property-value title=concept-property-value&gt;property value&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;.&lt;/li&gt;
 
-     &lt;li&gt;
+       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is an &lt;a href=#concept-item title=concept-item&gt;item&lt;/a&gt;, then &lt;a href=#generate-the-triples-for-an-item title=&quot;generate
+       the triples for an item&quot;&gt;generate the triples&lt;/a&gt; for &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;. Pass a reference to &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; as the item/subject list, and pass &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; as the fallback type and &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; as the fallback property name. Replace &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; by the subject returned from those
+       steps.&lt;/li&gt;
 
-      &lt;p&gt;For each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;a href=#property-names&gt;property names&lt;/a&gt;, run the
-      appropriate substeps from the following list:&lt;/p&gt;
+       &lt;!-- could support &lt;time&gt; here somehow, though we'd have to
+       reserialise it, check if the &lt;time&gt; was valid, check if it had a
+       date, a time, a timezone, etc. --&gt;
 
-      &lt;dl&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is an &lt;a href=#absolute-url&gt;absolute
-       URL&lt;/a&gt;&lt;/dt&gt;
+       &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not one of
+       the &lt;a href=#url-property-elements&gt;URL property elements&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be a plain literal, with the language
+       information set from the &lt;a href=#language&gt;language&lt;/a&gt; of the element, if
+       it is not unknown.&lt;/li&gt;
 
-       &lt;dd&gt;
+       &lt;li&gt;
 
-        &lt;p&gt;Generate the following triple:&lt;/p&gt;
+        &lt;dl&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is an &lt;a href=#absolute-url&gt;absolute
+         URL&lt;/a&gt;&lt;/dt&gt;
 
-        &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-         &lt;dt&gt;predicate &lt;dd&gt; &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
-         &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-        &lt;/dl&gt;&lt;/dd&gt;
+         &lt;dd&gt;
 
-       &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; contains no U+003A COLON
-       character (:)&lt;/dt&gt;
+          &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;.&lt;/p&gt;
 
-       &lt;dd&gt;
+         &lt;/dd&gt;
 
-        &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string, then
-         abort these substeps.&lt;/li&gt;
+         &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; contains no U+003A COLON
+         characters (:)&lt;/dt&gt;
 
-         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; have the same value
-         as &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
+         &lt;dd&gt;
 
-         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; does not contain a
-         U+0023 NUMBER SIGN character (#), then append a U+0023 NUMBER
-         SIGN character (#) to &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;.&lt;/li&gt;
+          &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/li&gt;
 
-         &lt;li&gt;&lt;p&gt;Append a U+003A COLON character (:) to &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;.&lt;/li&gt; &lt;!-- has to be something
-         not in /name/, so &quot;:&quot;, so that a different type/name
-         combination couldn't generate the same string --&gt;
+           &lt;li&gt;&lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; is
+           not a U+003A COLON character (:), append a U+0025 PERCENT
+           SIGN character (%), a U+0032 DIGIT TWO character (2), and a
+           U+0030 DIGIT ZERO character (0) to &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;.&lt;/li&gt;
 
-         &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; that are not valid in the &lt;ifragment&gt;
-         production of the IRI syntax being %-escaped.&lt;/li&gt;
+           &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; that are not valid in the
+           &lt;ifragment&gt; production of the IRI syntax being
+           %-escaped. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
 
-         &lt;li&gt;
+           &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; be the
+           concatenation of the string &quot;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#&lt;/code">http://www.w3.org/1999/xhtml/microdata#&lt;/code</A>&gt;&quot;
+           and &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; that are not valid in the &lt;ifragment&gt;
+           production of the IRI syntax being %-escaped. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt; &lt;!-- this ensures
+           you can't use a URL to get the same effect --&gt;
 
-          &lt;p&gt;Generate the following triple:&lt;/p&gt;
+          &lt;/ol&gt;&lt;/dd&gt;
 
-          &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-           &lt;dt&gt;predicate &lt;dd&gt; the concatenation of the string &quot;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#&lt;/code">http://www.w3.org/1999/xhtml/microdata#&lt;/code</A>&gt;&quot; and &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; that are not valid in the &lt;ifragment&gt; production of the IRI syntax being %-escaped &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;
-           &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-          &lt;/dl&gt;&lt;/li&gt;
+        &lt;/dl&gt;&lt;/li&gt;
 
-        &lt;/ol&gt;&lt;/dd&gt;
+       &lt;li&gt;
 
-      &lt;/dl&gt;&lt;/li&gt;
+        &lt;p&gt;Generate the following triple:&lt;/p&gt;
 
+        &lt;dl class=triple&gt;&lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
+         &lt;dt&gt;predicate &lt;dd&gt; &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;
+         &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
+        &lt;/dl&gt;&lt;/li&gt;
+
+      &lt;/ol&gt;&lt;/li&gt;
+
     &lt;/ol&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;.&lt;/li&gt;
@@ -49113,10 +49180,45 @@
 &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK&amp;gt;">http://purl.oreilly.com/products/9780596802189.EBOOK&gt;</A> a frbr:Expression ;
      dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK&amp;gt;">http://purl.oreilly.com/product-types/EBOOK&gt;</A> .&lt;/pre&gt;
 
+  &lt;hr&gt;&lt;p&gt;The following snippet of HTML has microdata for two people with
+  the same address:&lt;/p&gt;
 
+  &lt;pre&gt;&lt;p&gt;
+ Both
+ &lt;span itemscope itemtype=&quot;<A HREF="http://microformats.org/profile/hcard">http://microformats.org/profile/hcard</A>&quot; itemref=&quot;home&quot;&gt;&lt;span itemprop=&quot;fn&quot;&gt;Princeton&lt;/span&gt;&lt;/span&gt;
+ and
+ &lt;span itemscope itemtype=&quot;<A HREF="http://microformats.org/profile/hcard">http://microformats.org/profile/hcard</A>&quot; itemref=&quot;home&quot;&gt;&lt;span itemprop=&quot;fn&quot;&gt;Trekkie&lt;/span&gt;&lt;/span&gt;
+ live at
+ &lt;span id=&quot;dome&quot; itemprop=&quot;adr&quot; itemscope&gt;&lt;span itemprop=&quot;street-address&quot;&gt;Avenue Q&lt;/span&gt;.&lt;/span&gt;
+&lt;/p&gt;&lt;/pre&gt;
 
+  &lt;p&gt;...generates these triples expressed in Turtle (including a
+  triple that in this case is expressed twice, though that is not
+  meaningful in RDF):&lt;/p&gt;
 
+  &lt;pre class=turtle&gt;@prefix rdf: &lt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#&amp;gt;">http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</A> .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> dct: &lt;<A HREF="http://purl.org/dc/terms/&amp;gt;">http://purl.org/dc/terms/&gt;</A> .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> hcard: &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#http%3A%2F%2Fmicroformats.org%2Fprofile%2Fhcard%23%3A&amp;gt;">http://www.w3.org/1999/xhtml/microdata#http%3A%2F%2Fmicroformats.org%2Fprofile%2Fhcard%23%3A&gt;</A> .
 
+&lt;&gt; &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item&amp;gt;">http://www.w3.org/1999/xhtml/microdata#item&gt;</A> _:n0 ;
+   &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item&amp;gt;">http://www.w3.org/1999/xhtml/microdata#item&gt;</A> _:n1 .
+_:n0 rdf:type &lt;<A HREF="http://microformats.org/profile/hcard&amp;gt;">http://microformats.org/profile/hcard&gt;</A> ;
+     hcard:fn &quot;Princeton&quot; ;
+     hcard:adr _:n2 .
+_:n1 rdf:type &lt;<A HREF="http://microformats.org/profile/hcard&amp;gt;">http://microformats.org/profile/hcard&gt;</A> ;
+     hcard:fn &quot;Trekkie&quot; ;
+     hcard:adr _:n2 .
+_:n2 hcard:adr%20street-address &quot;Avenue Q&quot; ;
+     hcard:adr%20street-address &quot;Avenue Q&quot; .&lt;/pre&gt;
+
+
+
+
+
+
+
+
+
   &lt;h4 id=atom&gt;&lt;span class=secno&gt;5.5.3 &lt;/span&gt;Atom&lt;/h4&gt;
 
   &lt;p&gt;Given a &lt;code&gt;Document&lt;/code&gt; &lt;var title=&quot;&quot;&gt;source&lt;/var&gt;, a user

Modified: source
===================================================================
--- source	2010-01-29 01:31:38 UTC (rev 4632)
+++ source	2010-01-29 08:52:47 UTC (rev 4633)
@@ -55146,6 +55146,13 @@
 
    &lt;li&gt;
 
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt; be a mapping of items to
+    subjects, initially empty.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;For each element that is also a &lt;span title=&quot;top-level
     microdata items&quot;&gt;top-level microdata item&lt;/span&gt;, run the
     following steps:&lt;/p&gt;
@@ -55155,8 +55162,9 @@
      &lt;li&gt;
 
       &lt;p&gt;&lt;span title=&quot;generate the triples for an item&quot;&gt;Generate the
-      triples for the item&lt;/span&gt;. Let &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; be the
-      subject returned.&lt;/p&gt;
+      triples for the item&lt;/span&gt;. Pass a reference to &lt;var
+      title=&quot;&quot;&gt;memory&lt;/var&gt; as the item/subject list. Let &lt;var
+      title=&quot;&quot;&gt;result&lt;/var&gt; be the subject returned.&lt;/p&gt;
 
      &lt;/li&gt;
 
@@ -55167,7 +55175,7 @@
       &lt;dl class=&quot;triple&quot;&gt;
        &lt;dt&gt;subject   &lt;dd&gt; &lt;span&gt;the document's current address&lt;/span&gt;
        &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item&lt;/code">http://www.w3.org/1999/xhtml/microdata#item&lt;/code</A>&gt;
-       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;
+       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;
       &lt;/dl&gt;
 
      &lt;/li&gt;
@@ -55179,135 +55187,222 @@
   &lt;/ol&gt;
 
   &lt;p&gt;When the user agent is to &lt;dfn&gt;generate the triples for an
-  item&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, it must follow the following
+  item&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;item&lt;/var&gt;, given a reference to an
+  item/subject list &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, and optionally given a
+  fallback type &lt;var title=&quot;&quot;&gt;fallback type&lt;/var&gt; and property name
+  &lt;var title=&quot;&quot;&gt;fallback name&lt;/var&gt;, it must follow the following
   steps:&lt;/p&gt;
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has a &lt;span&gt;global
-   identifier&lt;/span&gt; and that &lt;span&gt;global identifier&lt;/span&gt; is an
-   &lt;span&gt;absolute URL&lt;/span&gt;, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be that
-   &lt;span&gt;global identifier&lt;/span&gt;. Otherwise, let &lt;var
-   title=&quot;&quot;&gt;subject&lt;/var&gt; be a new blank node.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If there is an entry for &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; in &lt;var
+   title=&quot;&quot;&gt;memory&lt;/var&gt;, then let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be the
+   subject of that entry. Otherwise, if &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has a
+   &lt;span&gt;global identifier&lt;/span&gt; and that &lt;span&gt;global
+   identifier&lt;/span&gt; is an &lt;span&gt;absolute URL&lt;/span&gt;, let &lt;var
+   title=&quot;&quot;&gt;subject&lt;/var&gt; be that &lt;span&gt;global
+   identifier&lt;/span&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt; be a
+   new blank node.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Add a mapping from &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; to &lt;var
+   title=&quot;&quot;&gt;subject&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;memory&lt;/var&gt;, if there
+   isn't one already.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;item&lt;/var&gt; has an &lt;span&gt;item type&lt;/span&gt;
    and that &lt;span&gt;item type&lt;/span&gt; is an &lt;span&gt;absolute URL&lt;/span&gt;,
    let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; be that &lt;span&gt;item
    type&lt;/span&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; be the empty
    string.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;!-- The special characters used in URLs beyond this point are
+   intended to make it so that a different type/name combination
+   couldn't generate the same string. &quot;:&quot; and &quot;%20&quot; are used because
+   they can't be put in /name/ when all this is used. --&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not the empty string, generate
-    the following triple:&lt;/p&gt;
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not the empty string, run the
+    following steps:&lt;/p&gt;
 
-    &lt;dl class=&quot;triple&quot;&gt;
-     &lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-     &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code">http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code</A>&gt;
-     &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
-    &lt;/dl&gt;
+    &lt;ol&gt;
 
+     &lt;li&gt;&lt;p&gt;Generate the following triple:&lt;/p&gt;
+
+      &lt;dl class=&quot;triple&quot;&gt;
+       &lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
+       &lt;dt&gt;predicate &lt;dd&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code">http://www.w3.org/1999/02/22-rdf-syntax-ns#type&lt;/code</A>&gt;
+       &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
+      &lt;/dl&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not contain a U+0023
+     NUMBER SIGN character (#), then append a U+0023 NUMBER SIGN
+     character (#) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not have a U+003A COLON
+     character (:) after its U+0023 NUMBER SIGN character (#), append
+     a U+003A COLON character (:) to &lt;var
+     title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;
 
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string, but &lt;var
+    title=&quot;&quot;&gt;fallback type&lt;/var&gt; is not, run the following
+    substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; have the value of &lt;var
+     title=&quot;&quot;&gt;fallback type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not contain a U+0023
+     NUMBER SIGN character (#), then append a U+0023 NUMBER SIGN
+     character (#) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;!-- Special characters beyond this point have to be something
+     not in /name/ when this is used below, so either &quot;:&quot;, %20, %0D,
+     or %0A. This is so that a different type/name combination
+     couldn't generate the same string. --&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; does not have a U+003A COLON
+     character (:) after its U+0023 NUMBER SIGN character (#), append
+     a U+003A COLON character (:) to &lt;var
+     title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is not a
+     U+003A COLON character (:), append a U+0025 PERCENT SIGN
+     character (%), a U+0032 DIGIT TWO character (2), and a U+0030
+     DIGIT ZERO character (0) to &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;fallback name&lt;/var&gt; to
+     &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;, with any characters in &lt;var
+     title=&quot;&quot;&gt;fallback name&lt;/var&gt; that are not valid in the
+     &lt;ifragment&gt; production of the IRI syntax being
+     %-escaped. &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;For each element &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; that has one or
     more &lt;span&gt;property names&lt;/span&gt; and is one of &lt;span title=&quot;the
     properties of an item&quot;&gt;the properties of the item&lt;/span&gt; &lt;var
     title=&quot;&quot;&gt;item&lt;/var&gt;, in the order those elements are given by the
     algorithm that returns &lt;span&gt;the properties of an item&lt;/span&gt;, run
-    the following substeps:&lt;/p&gt;
+    the following substep:&lt;/p&gt;
 
     &lt;ol&gt;
 
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the &lt;span
-     title=&quot;concept-property-value&quot;&gt;property value&lt;/span&gt; of &lt;var
-     title=&quot;&quot;&gt;element&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;
 
-     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is an &lt;span
-     title=&quot;concept-item&quot;&gt;item&lt;/span&gt;, then &lt;span title=&quot;generate the
-     triples for an item&quot;&gt;generate the triples&lt;/span&gt; for &lt;var
-     title=&quot;&quot;&gt;value&lt;/var&gt;, and then replace &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-     with the subject returned from those steps.&lt;/p&gt;&lt;/li&gt;
+      &lt;p&gt;For each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; in &lt;var
+      title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;span&gt;property names&lt;/span&gt;, run the
+      following substeps:&lt;/p&gt;
 
-     &lt;!-- could support &lt;time&gt; here somehow, though we'd have to
-     reserialise it, check if the &lt;time&gt; was valid, check if it had a
-     date, a time, a timezone, etc. --&gt;
+      &lt;ol&gt;
 
-     &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not one of
-     the &lt;span&gt;URL property elements&lt;/span&gt;, let &lt;var
-     title=&quot;&quot;&gt;value&lt;/var&gt; be a plain literal, with the language
-     information set from the &lt;span&gt;language&lt;/span&gt; of the element, if
-     it is not unknown.&lt;/p&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string and &lt;var
+       title=&quot;&quot;&gt;name&lt;/var&gt; is not an &lt;span&gt;absolute URL&lt;/span&gt;, then
+       abort these substeps.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;
+       &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; be the &lt;span
+       title=&quot;concept-property-value&quot;&gt;property value&lt;/span&gt; of &lt;var
+       title=&quot;&quot;&gt;element&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-      &lt;p&gt;For each name &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; in &lt;var
-      title=&quot;&quot;&gt;element&lt;/var&gt;'s &lt;span&gt;property names&lt;/span&gt;, run the
-      appropriate substeps from the following list:&lt;/p&gt;
+       &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; is an &lt;span
+       title=&quot;concept-item&quot;&gt;item&lt;/span&gt;, then &lt;span title=&quot;generate
+       the triples for an item&quot;&gt;generate the triples&lt;/span&gt; for &lt;var
+       title=&quot;&quot;&gt;value&lt;/var&gt;. Pass a reference to &lt;var
+       title=&quot;&quot;&gt;memory&lt;/var&gt; as the item/subject list, and pass &lt;var
+       title=&quot;&quot;&gt;type&lt;/var&gt; as the fallback type and &lt;var
+       title=&quot;&quot;&gt;name&lt;/var&gt; as the fallback property name. Replace &lt;var
+       title=&quot;&quot;&gt;value&lt;/var&gt; by the subject returned from those
+       steps.&lt;/p&gt;&lt;/li&gt;
 
-      &lt;dl&gt;
+       &lt;!-- could support &lt;time&gt; here somehow, though we'd have to
+       reserialise it, check if the &lt;time&gt; was valid, check if it had a
+       date, a time, a timezone, etc. --&gt;
 
-       &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is an &lt;span&gt;absolute
-       URL&lt;/span&gt;&lt;/dt&gt;
+       &lt;li&gt;&lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not one of
+       the &lt;span&gt;URL property elements&lt;/span&gt;, let &lt;var
+       title=&quot;&quot;&gt;value&lt;/var&gt; be a plain literal, with the language
+       information set from the &lt;span&gt;language&lt;/span&gt; of the element, if
+       it is not unknown.&lt;/p&gt;&lt;/li&gt;
 
-       &lt;dd&gt;
+       &lt;li&gt;
 
-        &lt;p&gt;Generate the following triple:&lt;/p&gt;
+        &lt;dl&gt;
 
-        &lt;dl class=&quot;triple&quot;&gt;
-         &lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-         &lt;dt&gt;predicate &lt;dd&gt; &lt;var title=&quot;&quot;&gt;name&lt;/var&gt;
-         &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-        &lt;/dl&gt;
+         &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; is an &lt;span&gt;absolute
+         URL&lt;/span&gt;&lt;/dt&gt;
 
-       &lt;/dd&gt;
+         &lt;dd&gt;
 
-       &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; contains no U+003A COLON
-       character (:)&lt;/dt&gt;
+          &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; be &lt;var
+          title=&quot;&quot;&gt;name&lt;/var&gt;.&lt;/p&gt;
 
-       &lt;dd&gt;
+         &lt;/dd&gt;
 
-        &lt;ol&gt;
+         &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; contains no U+003A COLON
+         characters (:)&lt;/dt&gt;
 
-         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; is the empty string, then
-         abort these substeps.&lt;/p&gt;&lt;/li&gt;
+         &lt;dd&gt;
 
-         &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; have the same value
-         as &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+          &lt;ol&gt;
 
-         &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; does not contain a
-         U+0023 NUMBER SIGN character (#), then append a U+0023 NUMBER
-         SIGN character (#) to &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+           &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; be &lt;var
+           title=&quot;&quot;&gt;type&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-         &lt;li&gt;&lt;p&gt;Append a U+003A COLON character (:) to &lt;var
-         title=&quot;&quot;&gt;predicate&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt; &lt;!-- has to be something
-         not in /name/, so &quot;:&quot;, so that a different type/name
-         combination couldn't generate the same string --&gt;
+           &lt;li&gt;&lt;p&gt;If the last character of &lt;var title=&quot;&quot;&gt;s&lt;/var&gt; is
+           not a U+003A COLON character (:), append a U+0025 PERCENT
+           SIGN character (%), a U+0032 DIGIT TWO character (2), and a
+           U+0030 DIGIT ZERO character (0) to &lt;var
+           title=&quot;&quot;&gt;s&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-         &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; to &lt;var
-         title=&quot;&quot;&gt;predicate&lt;/var&gt;, with any characters in &lt;var
-         title=&quot;&quot;&gt;name&lt;/var&gt; that are not valid in the &lt;ifragment&gt;
-         production of the IRI syntax being %-escaped.&lt;/p&gt;&lt;/li&gt;
+           &lt;li&gt;&lt;p&gt;Append the value of &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; to &lt;var
+           title=&quot;&quot;&gt;s&lt;/var&gt;, with any characters in &lt;var
+           title=&quot;&quot;&gt;name&lt;/var&gt; that are not valid in the
+           &lt;ifragment&gt; production of the IRI syntax being
+           %-escaped. &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
-         &lt;li&gt;
+           &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; be the
+           concatenation of the string &quot;&lt;code
+           title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#&lt;/code">http://www.w3.org/1999/xhtml/microdata#&lt;/code</A>&gt;&quot;
+           and &lt;var title=&quot;&quot;&gt;s&lt;/var&gt;, with any characters in &lt;var
+           title=&quot;&quot;&gt;s&lt;/var&gt; that are not valid in the &lt;ifragment&gt;
+           production of the IRI syntax being %-escaped. &lt;a
+           href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt; &lt;!-- this ensures
+           you can't use a URL to get the same effect --&gt;
 
-          &lt;p&gt;Generate the following triple:&lt;/p&gt;
+          &lt;/ol&gt;
 
-          &lt;dl class=&quot;triple&quot;&gt;
-           &lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
-           &lt;dt&gt;predicate &lt;dd&gt; the concatenation of the string &quot;&lt;code title=&quot;&quot;&gt;<A HREF="http://www.w3.org/1999/xhtml/microdata#&lt;/code">http://www.w3.org/1999/xhtml/microdata#&lt;/code</A>&gt;&quot; and &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;, with any characters in &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt; that are not valid in the &lt;ifragment&gt; production of the IRI syntax being %-escaped &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;
-           &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
-          &lt;/dl&gt;
+         &lt;/dd&gt;
 
-         &lt;/li&gt;
+        &lt;/dl&gt;
 
-        &lt;/ol&gt;
+       &lt;/li&gt;
 
-       &lt;/dd&gt;
+       &lt;li&gt;
 
-      &lt;/dl&gt;
+        &lt;p&gt;Generate the following triple:&lt;/p&gt;
 
+        &lt;dl class=&quot;triple&quot;&gt;
+         &lt;dt&gt;subject   &lt;dd&gt; &lt;var title=&quot;&quot;&gt;subject&lt;/var&gt;
+         &lt;dt&gt;predicate &lt;dd&gt; &lt;var title=&quot;&quot;&gt;predicate&lt;/var&gt;
+         &lt;dt&gt;object    &lt;dd&gt; &lt;var title=&quot;&quot;&gt;value&lt;/var&gt;
+        &lt;/dl&gt;
+
+       &lt;/li&gt;
+
+      &lt;/ol&gt;
+
      &lt;/li&gt;
 
     &lt;/ol&gt;
@@ -55365,6 +55460,43 @@
 &lt;<A HREF="http://purl.oreilly.com/products/9780596802189.EBOOK">http://purl.oreilly.com/products/9780596802189.EBOOK</A>&gt; a frbr:Expression ;
      dc:type &lt;<A HREF="http://purl.oreilly.com/product-types/EBOOK">http://purl.oreilly.com/product-types/EBOOK</A>&gt; .&lt;/pre&gt;
 
+  &lt;hr&gt;
+
+  &lt;p&gt;The following snippet of HTML has microdata for two people with
+  the same address:&lt;/p&gt;
+
+  &lt;pre&gt;&lt;p&gt;
+ Both
+ &lt;span itemscope itemtype=&quot;<A HREF="http://microformats.org/profile/hcard">http://microformats.org/profile/hcard</A>&quot; itemref=&quot;home&quot;&gt;&lt;span itemprop=&quot;fn&quot;&gt;Princeton&lt;/span&gt;&lt;/span&gt;
+ and
+ &lt;span itemscope itemtype=&quot;<A HREF="http://microformats.org/profile/hcard">http://microformats.org/profile/hcard</A>&quot; itemref=&quot;home&quot;&gt;&lt;span itemprop=&quot;fn&quot;&gt;Trekkie&lt;/span&gt;&lt;/span&gt;
+ live at
+ &lt;span id=&quot;dome&quot; itemprop=&quot;adr&quot; itemscope&gt;&lt;span itemprop=&quot;street-address&quot;&gt;Avenue Q&lt;/span&gt;.&lt;/span&gt;
+&lt;/p&gt;&lt;/pre&gt;
+
+  &lt;p&gt;...generates these triples expressed in Turtle (including a
+  triple that in this case is expressed twice, though that is not
+  meaningful in RDF):&lt;/p&gt;
+
+  &lt;pre class=&quot;turtle&quot;&gt;@prefix rdf: &lt;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&gt; .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> dct: &lt;<A HREF="http://purl.org/dc/terms/">http://purl.org/dc/terms/</A>&gt; .
<A HREF="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">+ at prefix</A> hcard: &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#http%3A%2F%2Fmicroformats.org%2Fprofile%2Fhcard%23%3A">http://www.w3.org/1999/xhtml/microdata#http%3A%2F%2Fmicroformats.org%2Fprofile%2Fhcard%23%3A</A>&gt; .
+
+&lt;&gt; &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item">http://www.w3.org/1999/xhtml/microdata#item</A>&gt; _:n0 ;
+   &lt;<A HREF="http://www.w3.org/1999/xhtml/microdata#item">http://www.w3.org/1999/xhtml/microdata#item</A>&gt; _:n1 .
+_:n0 rdf:type &lt;<A HREF="http://microformats.org/profile/hcard">http://microformats.org/profile/hcard</A>&gt; ;
+     hcard:fn &quot;Princeton&quot; ;
+     hcard:adr _:n2 .
+_:n1 rdf:type &lt;<A HREF="http://microformats.org/profile/hcard">http://microformats.org/profile/hcard</A>&gt; ;
+     hcard:fn &quot;Trekkie&quot; ;
+     hcard:adr _:n2 .
+_:n2 hcard:adr%20street-address &quot;Avenue Q&quot; ;
+     hcard:adr%20street-address &quot;Avenue Q&quot; .&lt;/pre&gt;
+
+
+
+
+
 &lt;!--END microdata--&gt;&lt;!--START w3c-html--&gt;
 
 


</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011500.html">[html5] r4632 - [agiow] (2) Make history traversal unrelated to	history truncation always async. [...]
</A></li>
	<LI>Next message: <A HREF="011502.html">[html5] r4634 - [e] (0) Make the microdata spec stand slightly more	alone.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11501">[ date ]</a>
              <a href="thread.html#11501">[ thread ]</a>
              <a href="subject.html#11501">[ subject ]</a>
              <a href="author.html#11501">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
