<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r7054 - [giow] (0) sandbox='allow-popups' feature Affected	topics: DOM APIs, HTML
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7054%20-%20%5Bgiow%5D%20%280%29%20sandbox%3D%27allow-popups%27%20feature%20Affected%0A%09topics%3A%20DOM%20APIs%2C%20HTML&In-Reply-To=%3C20120417050228.52624247C150%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013918.html">
   <LINK REL="Next"  HREF="013920.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r7054 - [giow] (0) sandbox='allow-popups' feature Affected	topics: DOM APIs, HTML</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7054%20-%20%5Bgiow%5D%20%280%29%20sandbox%3D%27allow-popups%27%20feature%20Affected%0A%09topics%3A%20DOM%20APIs%2C%20HTML&In-Reply-To=%3C20120417050228.52624247C150%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r7054 - [giow] (0) sandbox='allow-popups' feature Affected	topics: DOM APIs, HTML">whatwg at whatwg.org
       </A><BR>
    <I>Mon Apr 16 22:02:28 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="013918.html">[html5] r7053 - [e] (0) Refactor the sandboxing flags further to	make it even easier to hook int [...]
</A></li>
        <LI>Next message: <A HREF="013920.html">[html5] r7055 - [e] (0) use the term 'isolated' instead of	'unpaired', for consistency. link to  [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13919">[ date ]</a>
              <a href="thread.html#13919">[ thread ]</a>
              <a href="subject.html#13919">[ subject ]</a>
              <a href="author.html#13919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2012-04-16 22:02:26 -0700 (Mon, 16 Apr 2012)
New Revision: 7054

Modified:
   complete.html
   index
   source
Log:
[giow] (0) sandbox='allow-popups' feature
Affected topics: DOM APIs, HTML

Modified: complete.html
===================================================================
--- complete.html	2012-04-13 23:10:03 UTC (rev 7053)
+++ complete.html	2012-04-17 05:02:26 UTC (rev 7054)
@@ -240,7 +240,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 13 April 2012&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 17 April 2012&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -25320,6 +25320,7 @@
   &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;unordered set of unique space-separated tokens&lt;/a&gt; that are
   &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt;. The allowed values are
   &lt;code title=attr-iframe-sandbox-allow-forms&gt;&lt;a href=#attr-iframe-sandbox-allow-forms&gt;allow-forms&lt;/a&gt;&lt;/code&gt;,
+  &lt;code title=attr-iframe-sandbox-allow-popups&gt;&lt;a href=#attr-iframe-sandbox-allow-popups&gt;allow-popups&lt;/a&gt;&lt;/code&gt;,
   &lt;code title=attr-iframe-sandbox-allow-same-origin&gt;&lt;a href=#attr-iframe-sandbox-allow-same-origin&gt;allow-same-origin&lt;/a&gt;&lt;/code&gt;,
   &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt;, and
   &lt;code title=attr-iframe-sandbox-allow-top-navigation&gt;&lt;a href=#attr-iframe-sandbox-allow-top-navigation&gt;allow-top-navigation&lt;/a&gt;&lt;/code&gt;.
@@ -25332,9 +25333,8 @@
   keyword allows the content to be treated as being from the same
   origin instead of forcing it into a unique origin, the &lt;code title=attr-iframe-sandbox-allow-top-navigation&gt;&lt;a href=#attr-iframe-sandbox-allow-top-navigation&gt;allow-top-navigation&lt;/a&gt;&lt;/code&gt;
   keyword allows the content to &lt;a href=#navigate&gt;navigate&lt;/a&gt; its
-  &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;, and the &lt;code title=attr-iframe-sandbox-allow-forms&gt;&lt;a href=#attr-iframe-sandbox-allow-forms&gt;allow-forms&lt;/a&gt;&lt;/code&gt; and &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt;
-  keywords re-enable forms and scripts respectively (though scripts
-  are still prevented from creating popups).&lt;/p&gt;
+  &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;, and the &lt;code title=attr-iframe-sandbox-allow-forms&gt;&lt;a href=#attr-iframe-sandbox-allow-forms&gt;allow-forms&lt;/a&gt;&lt;/code&gt;, &lt;code title=attr-iframe-sandbox-allow-popups&gt;&lt;a href=#attr-iframe-sandbox-allow-popups&gt;allow-popups&lt;/a&gt;&lt;/code&gt; and &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt;
+  keywords re-enable forms, popups, and scripts respectively.&lt;/p&gt;
 
   &lt;p class=warning&gt;Setting both the
   &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt; and
@@ -63805,10 +63805,10 @@
   context&lt;/a&gt; of the one the link or script is in, &quot;new&quot; means a
   new &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; or &lt;a href=#auxiliary-browsing-context&gt;auxiliary
   browsing context&lt;/a&gt; is to be created, subject to various user
-  preferences and user agent policies, &quot;maybe new&quot; means the same as
-  &quot;new&quot; but the requirements for those cases encourage user agents to
-  treat it more like &quot;none&quot;, and &quot;none&quot; means that by default nothing
-  will happen.&lt;/p&gt;
+  preferences and user agent policies, &quot;none&quot; means that nothing will
+  happen, and &quot;maybe new&quot; means the same as &quot;new&quot; if the &quot;&lt;code title=attr-iframe-sandbox-allow-popups&gt;&lt;a href=#attr-iframe-sandbox-allow-popups&gt;allow-popups&lt;/a&gt;&lt;/code&gt;&quot;
+  keyword is also specified on the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute (or if the user
+  overrode the sandboxing), and the same as &quot;none&quot; otherwise.&lt;/p&gt;
 
   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th rowspan=2&gt;Keyword
      &lt;th rowspan=2&gt;Ordinary effect
@@ -64007,20 +64007,30 @@
 
     &lt;dl class=switch&gt;&lt;dt id=sandboxWindowOpen&gt;If the current browsing context's
      &lt;a href=#active-document&gt;active document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag
-     set&lt;/a&gt; has the &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context
-     flag&lt;/a&gt; set.&lt;/dt&gt;
+     set&lt;/a&gt; has the &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing
+     context flag&lt;/a&gt; set.&lt;/dt&gt;
 
-     &lt;dd&gt;&lt;p&gt;The user agent may offer to create a new &lt;a href=#top-level-browsing-context&gt;top-level
-     browsing context&lt;/a&gt; or reuse an existing &lt;a href=#top-level-browsing-context&gt;top-level
-     browsing context&lt;/a&gt;. If the user picks one of those options,
-     then the designated browsing context must be the chosen one (the
-     browsing context's name isn't set to the given browsing context
-     name). The default behaviour (if the user agent doesn't offer the
-     option to the user, or if the user declines to allow a browsing
-     context to be used) there must not be a chosen browsing
-     context.&lt;/dd&gt;
+     &lt;dd&gt;
 
+      &lt;p&gt;Typically, there is no chosen browsing context.&lt;/p&gt;
 
+      &lt;p&gt;The user agent may offer to create a new &lt;a href=#top-level-browsing-context&gt;top-level
+      browsing context&lt;/a&gt; or reuse an existing &lt;a href=#top-level-browsing-context&gt;top-level
+      browsing context&lt;/a&gt;. If the user picks one of those options,
+      then the designated browsing context must be the chosen one (the
+      browsing context's name isn't set to the given browsing context
+      name). The default behaviour (if the user agent doesn't offer
+      the option to the user, or if the user declines to allow a
+      browsing context to be used) must be that there must not be a
+      chosen browsing context.&lt;/p&gt;
+
+      &lt;p class=warning&gt;If this case occurs, it means that an author
+      has explicitly sandboxed the document that is trying to open a
+      link.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+
      &lt;dt id=noopener&gt;If the user agent has been configured such that
      in this instance it will create a new browsing context, and the
      browsing context is being requested as part of &lt;a href=#following-hyperlinks title=&quot;following hyperlinks&quot;&gt;following a hyperlink&lt;/a&gt; whose
@@ -64067,6 +64077,18 @@
     users to configure the user agent to always reuse the current
     browsing context.&lt;/p&gt;
 
+    &lt;p&gt;If the current browsing context's &lt;a href=#active-document&gt;active
+    document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; has the
+    &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context flag&lt;/a&gt; set and
+    chosen browsing context picked above, if any, is a new browsing
+    context (whether top-level or auxiliary), then all the flags that
+    are set in the current browsing context's &lt;a href=#active-document&gt;active
+    document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; when the
+    new browsing context is created must be set in the new browsing
+    context's &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt;, and the current
+    browsing context must be set as the new browsing context's
+    &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/a&gt;.&lt;/p&gt;
+
    &lt;/li&gt;
 
   &lt;/ol&gt;&lt;/div&gt;
@@ -65373,23 +65395,42 @@
     &lt;p&gt;This flag &lt;a href=#sandboxLinks&gt;prevents content from
     navigating browsing contexts other than the sandboxed browsing
     context itself&lt;/a&gt; (or browsing contexts further nested inside
-    it), and the &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; (which is
+    it), &lt;a href=#auxiliary-browsing-context title=&quot;auxiliary browsing context&quot;&gt;auxiliary browsing
+    contexts&lt;/a&gt; (which are protected by the &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed
+    auxiliary navigation browsing context flag&lt;/a&gt; defined next),
+    and the &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; (which is
     protected by the &lt;a href=#sandboxed-top-level-navigation-browsing-context-flag&gt;sandboxed top-level navigation browsing
-    context flag&lt;/a&gt; defined next).&lt;/p&gt;
+    context flag&lt;/a&gt; defined below).&lt;/p&gt;
 
-    &lt;p&gt;This flag also &lt;a href=#sandboxWindowOpen&gt;prevents content
-    from creating new auxiliary browsing contexts&lt;/a&gt;, e.g. using the
-    &lt;code title=attr-hyperlink-target&gt;&lt;a href=#attr-hyperlink-target&gt;target&lt;/a&gt;&lt;/code&gt; attribute, the
-    &lt;code title=dom-open&gt;&lt;a href=#dom-open&gt;window.open()&lt;/a&gt;&lt;/code&gt; method, or the &lt;code title=dom-showModalDialog&gt;&lt;a href=#dom-showmodaldialog&gt;showModalDialog()&lt;/a&gt;&lt;/code&gt; method.&lt;/p&gt;
+    &lt;p&gt;If the &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context
+    flag&lt;/a&gt; is not set, then in certain cases the restrictions
+    nonetheless allow popups (new &lt;a href=#top-level-browsing-context title=&quot;top-level browsing
+    context&quot;&gt;top-level browsing contexts&lt;/a&gt;) to be opened. These
+    &lt;a href=#browsing-context title=&quot;browsing context&quot;&gt;browsing contexts&lt;/a&gt; always
+    have &lt;dfn id=one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/dfn&gt;, set when the
+    browsing context is created, which allows the &lt;a href=#browsing-context&gt;browsing
+    context&lt;/a&gt; that created them to actually navigate them.
+    (Otherwise, the &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context
+    flag&lt;/a&gt; would prevent them from being navigated even if they
+    were opened.)&lt;/p&gt;
 
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;The &lt;dfn id=sandboxed-top-level-navigation-browsing-context-flag&gt;sandboxed top-level navigation browsing context
-   flag&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;The &lt;dfn id=sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context flag&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
+    &lt;p&gt;This flag &lt;a href=#sandboxWindowOpen&gt;prevents content from
+    creating new auxiliary browsing contexts&lt;/a&gt;, e.g. using the &lt;code title=attr-hyperlink-target&gt;&lt;a href=#attr-hyperlink-target&gt;target&lt;/a&gt;&lt;/code&gt; attribute, the &lt;code title=dom-open&gt;&lt;a href=#dom-open&gt;window.open()&lt;/a&gt;&lt;/code&gt; method, or the &lt;code title=dom-showModalDialog&gt;&lt;a href=#dom-showmodaldialog&gt;showModalDialog()&lt;/a&gt;&lt;/code&gt; method.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;The &lt;dfn id=sandboxed-top-level-navigation-browsing-context-flag&gt;sandboxed top-level navigation browsing context flag&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
     &lt;p&gt;This flag &lt;a href=#sandboxLinks&gt;prevents content from
     navigating their &lt;span&gt;top-level browsing context&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
 
@@ -65397,7 +65438,9 @@
     is set, content can navigate its &lt;a href=#top-level-browsing-context&gt;top-level browsing
     context&lt;/a&gt;, but other &lt;a href=#browsing-context title=&quot;browsing context&quot;&gt;browsing
     contexts&lt;/a&gt; are still protected by the &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed
-    navigation browsing context flag&lt;/a&gt; defined above.&lt;/p&gt;
+    navigation browsing context flag&lt;/a&gt; and possibly the
+    &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context
+    flag&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -65494,6 +65537,10 @@
 
     &lt;ul&gt;&lt;li&gt;&lt;p&gt;The &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context flag&lt;/a&gt;&lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;The &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context
+     flag&lt;/a&gt;, unless &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains the &lt;dfn id=attr-iframe-sandbox-allow-popups title=attr-iframe-sandbox-allow-popups&gt;&lt;code&gt;allow-popups&lt;/code&gt;&lt;/dfn&gt;
+     keyword&lt;/li&gt;
+
      &lt;li&gt;&lt;p&gt;The &lt;a href=#sandboxed-top-level-navigation-browsing-context-flag&gt;sandboxed top-level navigation browsing context
      flag&lt;/a&gt;, unless &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains the &lt;dfn id=attr-iframe-sandbox-allow-top-navigation title=attr-iframe-sandbox-allow-top-navigation&gt;&lt;code&gt;allow-top-navigation&lt;/code&gt;&lt;/dfn&gt;
      keyword&lt;/li&gt;
@@ -65552,7 +65599,13 @@
 
     &lt;/ul&gt;&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;Every &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; has an
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;Every &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; has a &lt;dfn id=popup-sandboxing-flag-set&gt;popup
+  sandboxing flag set&lt;/dfn&gt;. When a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is
+  created, its &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt; must be empty.
+  It is populated by &lt;a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name&gt;the rules for choosing a browsing context
+  given a browsing context name&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;Every &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; has an
   &lt;dfn id=iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/dfn&gt;, which is a
   &lt;a href=#sandboxing-flag-set&gt;sandboxing flag set&lt;/a&gt;. Which flags in a &lt;a href=#nested-browsing-context&gt;nested
   browsing context&lt;/a&gt;'s &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag
@@ -66437,10 +66490,8 @@
     &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt; is not one of the &lt;a href=#ancestor-browsing-context title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
     contexts&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being
     navigated, and the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being navigated
-    is not both a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; and one of
-    the &lt;a href=#ancestor-browsing-context title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
-    contexts&lt;/a&gt; of the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;, and
-    the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active
+    is not a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;, and the
+    &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active
     document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; has its
     &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context flag&lt;/a&gt; set, then
     abort these steps.&lt;/p&gt;
@@ -66454,15 +66505,33 @@
     top-level navigation browsing context flag&lt;/a&gt; set, then abort
     these steps.&lt;/p&gt;
 
-    &lt;p&gt;In both cases, the user agent may additionally offer to open
-    the new resource in a new &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;
-    or in the &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; of the
-    &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;, at the user's option, in
-    which case the user agent must &lt;a href=#navigate&gt;navigate&lt;/a&gt;&lt;!--DONAV
+    &lt;p&gt;Otherwise, if the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being navigated
+    is a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;, and is not one of
+    the &lt;a href=#ancestor-browsing-context title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
+    contexts&lt;/a&gt; of the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;, and
+    the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s
+    &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; has its &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed
+    navigation browsing context flag&lt;/a&gt; set, and the &lt;a href=#source-browsing-context&gt;source
+    browsing context&lt;/a&gt; is not the &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed
+    navigator&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being
+    navigated, then abort these steps.&lt;/p&gt; &lt;!-- we do not check the
+    /sandboxed auxiliary navigation browsing context flag/ here,
+    that's only for actually opening the new top-level browsing
+    context. --&gt;
+
+    &lt;p&gt;In all of these cases, the user agent may additionally offer to
+    open the new resource in a new &lt;a href=#top-level-browsing-context&gt;top-level browsing
+    context&lt;/a&gt; or in the &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;
+    of the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;, at the user's option,
+    in which case the user agent must &lt;a href=#navigate&gt;navigate&lt;/a&gt;&lt;!--DONAV
     sandbox manual load--&gt; that designated &lt;a href=#top-level-browsing-context&gt;top-level browsing
     context&lt;/a&gt; to the new resource as if the user had requested it
     independently.&lt;/p&gt;
 
+    &lt;p class=note&gt;Doing so, however, can be dangerous, as it means
+    that the user is overriding the author's explicit request to
+    sandbox the content.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li id=seamlessLinks&gt;&lt;p&gt;If the &lt;a href=#source-browsing-context&gt;source browsing
@@ -66844,6 +66913,11 @@
     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is created:&lt;/p&gt;
 
     &lt;ul&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
+     context&lt;/a&gt; is a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;,
+     then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
+     &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
      context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, then:
      the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
      &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
@@ -72481,10 +72555,13 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the current browsing context's &lt;a href=#active-document&gt;active
-    document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; has its
-    &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context flag&lt;/a&gt; set, then
-    return the empty string and abort these steps.&lt;/p&gt;
+    &lt;p&gt;If the &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt;
+    of the &lt;a href=#active-document&gt;active document&lt;/a&gt;
+    of the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing context&lt;/a&gt;
+    of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method
+    has its
+    &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context flag&lt;/a&gt;
+    set, then return the empty string and abort these steps.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -72538,6 +72615,22 @@
 
    &lt;li&gt;
 
+    &lt;p&gt;Set all the flags
+    in the new browsing context's &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt;
+    that are set in the
+    &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt;
+    of the &lt;a href=#active-document&gt;active document&lt;/a&gt;
+    of the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing context&lt;/a&gt;
+    of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method.
+    The &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing context&lt;/a&gt;
+    of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method
+    must be set as the new browsing context's
+    &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;Let the &lt;a href=#dialog-arguments&gt;dialog arguments&lt;/a&gt; of the new browsing
     context be set to the value of &lt;var title=&quot;&quot;&gt;argument&lt;/var&gt;, or
     the 'undefined' value if the argument was omitted.&lt;/p&gt;
@@ -99696,6 +99789,7 @@
      &lt;td&gt; Security rules for nested content
      &lt;td&gt; &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;Unordered set of unique space-separated tokens&lt;/a&gt;, &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt;, consisting of
           &quot;&lt;code title=attr-iframe-sandbox-allow-forms&gt;&lt;a href=#attr-iframe-sandbox-allow-forms&gt;allow-forms&lt;/a&gt;&lt;/code&gt;&quot;,
+          &quot;&lt;code title=attr-iframe-sandbox-allow-popups&gt;&lt;a href=#attr-iframe-sandbox-allow-popups&gt;allow-popups&lt;/a&gt;&lt;/code&gt;&quot;,
           &quot;&lt;code title=attr-iframe-sandbox-allow-same-origin&gt;&lt;a href=#attr-iframe-sandbox-allow-same-origin&gt;allow-same-origin&lt;/a&gt;&lt;/code&gt;&quot;,
           &quot;&lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt; and
           &quot;&lt;code title=attr-iframe-sandbox-allow-top-navigation&gt;&lt;a href=#attr-iframe-sandbox-allow-top-navigation&gt;allow-top-navigation&lt;/a&gt;&lt;/code&gt;&quot;

Modified: index
===================================================================
--- index	2012-04-13 23:10:03 UTC (rev 7053)
+++ index	2012-04-17 05:02:26 UTC (rev 7054)
@@ -240,7 +240,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 13 April 2012&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 17 April 2012&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -25320,6 +25320,7 @@
   &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;unordered set of unique space-separated tokens&lt;/a&gt; that are
   &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt;. The allowed values are
   &lt;code title=attr-iframe-sandbox-allow-forms&gt;&lt;a href=#attr-iframe-sandbox-allow-forms&gt;allow-forms&lt;/a&gt;&lt;/code&gt;,
+  &lt;code title=attr-iframe-sandbox-allow-popups&gt;&lt;a href=#attr-iframe-sandbox-allow-popups&gt;allow-popups&lt;/a&gt;&lt;/code&gt;,
   &lt;code title=attr-iframe-sandbox-allow-same-origin&gt;&lt;a href=#attr-iframe-sandbox-allow-same-origin&gt;allow-same-origin&lt;/a&gt;&lt;/code&gt;,
   &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt;, and
   &lt;code title=attr-iframe-sandbox-allow-top-navigation&gt;&lt;a href=#attr-iframe-sandbox-allow-top-navigation&gt;allow-top-navigation&lt;/a&gt;&lt;/code&gt;.
@@ -25332,9 +25333,8 @@
   keyword allows the content to be treated as being from the same
   origin instead of forcing it into a unique origin, the &lt;code title=attr-iframe-sandbox-allow-top-navigation&gt;&lt;a href=#attr-iframe-sandbox-allow-top-navigation&gt;allow-top-navigation&lt;/a&gt;&lt;/code&gt;
   keyword allows the content to &lt;a href=#navigate&gt;navigate&lt;/a&gt; its
-  &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;, and the &lt;code title=attr-iframe-sandbox-allow-forms&gt;&lt;a href=#attr-iframe-sandbox-allow-forms&gt;allow-forms&lt;/a&gt;&lt;/code&gt; and &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt;
-  keywords re-enable forms and scripts respectively (though scripts
-  are still prevented from creating popups).&lt;/p&gt;
+  &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;, and the &lt;code title=attr-iframe-sandbox-allow-forms&gt;&lt;a href=#attr-iframe-sandbox-allow-forms&gt;allow-forms&lt;/a&gt;&lt;/code&gt;, &lt;code title=attr-iframe-sandbox-allow-popups&gt;&lt;a href=#attr-iframe-sandbox-allow-popups&gt;allow-popups&lt;/a&gt;&lt;/code&gt; and &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt;
+  keywords re-enable forms, popups, and scripts respectively.&lt;/p&gt;
 
   &lt;p class=warning&gt;Setting both the
   &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt; and
@@ -63805,10 +63805,10 @@
   context&lt;/a&gt; of the one the link or script is in, &quot;new&quot; means a
   new &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; or &lt;a href=#auxiliary-browsing-context&gt;auxiliary
   browsing context&lt;/a&gt; is to be created, subject to various user
-  preferences and user agent policies, &quot;maybe new&quot; means the same as
-  &quot;new&quot; but the requirements for those cases encourage user agents to
-  treat it more like &quot;none&quot;, and &quot;none&quot; means that by default nothing
-  will happen.&lt;/p&gt;
+  preferences and user agent policies, &quot;none&quot; means that nothing will
+  happen, and &quot;maybe new&quot; means the same as &quot;new&quot; if the &quot;&lt;code title=attr-iframe-sandbox-allow-popups&gt;&lt;a href=#attr-iframe-sandbox-allow-popups&gt;allow-popups&lt;/a&gt;&lt;/code&gt;&quot;
+  keyword is also specified on the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute (or if the user
+  overrode the sandboxing), and the same as &quot;none&quot; otherwise.&lt;/p&gt;
 
   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th rowspan=2&gt;Keyword
      &lt;th rowspan=2&gt;Ordinary effect
@@ -64007,20 +64007,30 @@
 
     &lt;dl class=switch&gt;&lt;dt id=sandboxWindowOpen&gt;If the current browsing context's
      &lt;a href=#active-document&gt;active document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag
-     set&lt;/a&gt; has the &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context
-     flag&lt;/a&gt; set.&lt;/dt&gt;
+     set&lt;/a&gt; has the &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing
+     context flag&lt;/a&gt; set.&lt;/dt&gt;
 
-     &lt;dd&gt;&lt;p&gt;The user agent may offer to create a new &lt;a href=#top-level-browsing-context&gt;top-level
-     browsing context&lt;/a&gt; or reuse an existing &lt;a href=#top-level-browsing-context&gt;top-level
-     browsing context&lt;/a&gt;. If the user picks one of those options,
-     then the designated browsing context must be the chosen one (the
-     browsing context's name isn't set to the given browsing context
-     name). The default behaviour (if the user agent doesn't offer the
-     option to the user, or if the user declines to allow a browsing
-     context to be used) there must not be a chosen browsing
-     context.&lt;/dd&gt;
+     &lt;dd&gt;
 
+      &lt;p&gt;Typically, there is no chosen browsing context.&lt;/p&gt;
 
+      &lt;p&gt;The user agent may offer to create a new &lt;a href=#top-level-browsing-context&gt;top-level
+      browsing context&lt;/a&gt; or reuse an existing &lt;a href=#top-level-browsing-context&gt;top-level
+      browsing context&lt;/a&gt;. If the user picks one of those options,
+      then the designated browsing context must be the chosen one (the
+      browsing context's name isn't set to the given browsing context
+      name). The default behaviour (if the user agent doesn't offer
+      the option to the user, or if the user declines to allow a
+      browsing context to be used) must be that there must not be a
+      chosen browsing context.&lt;/p&gt;
+
+      &lt;p class=warning&gt;If this case occurs, it means that an author
+      has explicitly sandboxed the document that is trying to open a
+      link.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+
      &lt;dt id=noopener&gt;If the user agent has been configured such that
      in this instance it will create a new browsing context, and the
      browsing context is being requested as part of &lt;a href=#following-hyperlinks title=&quot;following hyperlinks&quot;&gt;following a hyperlink&lt;/a&gt; whose
@@ -64067,6 +64077,18 @@
     users to configure the user agent to always reuse the current
     browsing context.&lt;/p&gt;
 
+    &lt;p&gt;If the current browsing context's &lt;a href=#active-document&gt;active
+    document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; has the
+    &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context flag&lt;/a&gt; set and
+    chosen browsing context picked above, if any, is a new browsing
+    context (whether top-level or auxiliary), then all the flags that
+    are set in the current browsing context's &lt;a href=#active-document&gt;active
+    document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; when the
+    new browsing context is created must be set in the new browsing
+    context's &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt;, and the current
+    browsing context must be set as the new browsing context's
+    &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/a&gt;.&lt;/p&gt;
+
    &lt;/li&gt;
 
   &lt;/ol&gt;&lt;/div&gt;
@@ -65373,23 +65395,42 @@
     &lt;p&gt;This flag &lt;a href=#sandboxLinks&gt;prevents content from
     navigating browsing contexts other than the sandboxed browsing
     context itself&lt;/a&gt; (or browsing contexts further nested inside
-    it), and the &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; (which is
+    it), &lt;a href=#auxiliary-browsing-context title=&quot;auxiliary browsing context&quot;&gt;auxiliary browsing
+    contexts&lt;/a&gt; (which are protected by the &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed
+    auxiliary navigation browsing context flag&lt;/a&gt; defined next),
+    and the &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; (which is
     protected by the &lt;a href=#sandboxed-top-level-navigation-browsing-context-flag&gt;sandboxed top-level navigation browsing
-    context flag&lt;/a&gt; defined next).&lt;/p&gt;
+    context flag&lt;/a&gt; defined below).&lt;/p&gt;
 
-    &lt;p&gt;This flag also &lt;a href=#sandboxWindowOpen&gt;prevents content
-    from creating new auxiliary browsing contexts&lt;/a&gt;, e.g. using the
-    &lt;code title=attr-hyperlink-target&gt;&lt;a href=#attr-hyperlink-target&gt;target&lt;/a&gt;&lt;/code&gt; attribute, the
-    &lt;code title=dom-open&gt;&lt;a href=#dom-open&gt;window.open()&lt;/a&gt;&lt;/code&gt; method, or the &lt;code title=dom-showModalDialog&gt;&lt;a href=#dom-showmodaldialog&gt;showModalDialog()&lt;/a&gt;&lt;/code&gt; method.&lt;/p&gt;
+    &lt;p&gt;If the &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context
+    flag&lt;/a&gt; is not set, then in certain cases the restrictions
+    nonetheless allow popups (new &lt;a href=#top-level-browsing-context title=&quot;top-level browsing
+    context&quot;&gt;top-level browsing contexts&lt;/a&gt;) to be opened. These
+    &lt;a href=#browsing-context title=&quot;browsing context&quot;&gt;browsing contexts&lt;/a&gt; always
+    have &lt;dfn id=one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/dfn&gt;, set when the
+    browsing context is created, which allows the &lt;a href=#browsing-context&gt;browsing
+    context&lt;/a&gt; that created them to actually navigate them.
+    (Otherwise, the &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context
+    flag&lt;/a&gt; would prevent them from being navigated even if they
+    were opened.)&lt;/p&gt;
 
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;The &lt;dfn id=sandboxed-top-level-navigation-browsing-context-flag&gt;sandboxed top-level navigation browsing context
-   flag&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;The &lt;dfn id=sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context flag&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
+    &lt;p&gt;This flag &lt;a href=#sandboxWindowOpen&gt;prevents content from
+    creating new auxiliary browsing contexts&lt;/a&gt;, e.g. using the &lt;code title=attr-hyperlink-target&gt;&lt;a href=#attr-hyperlink-target&gt;target&lt;/a&gt;&lt;/code&gt; attribute, the &lt;code title=dom-open&gt;&lt;a href=#dom-open&gt;window.open()&lt;/a&gt;&lt;/code&gt; method, or the &lt;code title=dom-showModalDialog&gt;&lt;a href=#dom-showmodaldialog&gt;showModalDialog()&lt;/a&gt;&lt;/code&gt; method.&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;The &lt;dfn id=sandboxed-top-level-navigation-browsing-context-flag&gt;sandboxed top-level navigation browsing context flag&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
     &lt;p&gt;This flag &lt;a href=#sandboxLinks&gt;prevents content from
     navigating their &lt;span&gt;top-level browsing context&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
 
@@ -65397,7 +65438,9 @@
     is set, content can navigate its &lt;a href=#top-level-browsing-context&gt;top-level browsing
     context&lt;/a&gt;, but other &lt;a href=#browsing-context title=&quot;browsing context&quot;&gt;browsing
     contexts&lt;/a&gt; are still protected by the &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed
-    navigation browsing context flag&lt;/a&gt; defined above.&lt;/p&gt;
+    navigation browsing context flag&lt;/a&gt; and possibly the
+    &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context
+    flag&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -65494,6 +65537,10 @@
 
     &lt;ul&gt;&lt;li&gt;&lt;p&gt;The &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context flag&lt;/a&gt;&lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;The &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context
+     flag&lt;/a&gt;, unless &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains the &lt;dfn id=attr-iframe-sandbox-allow-popups title=attr-iframe-sandbox-allow-popups&gt;&lt;code&gt;allow-popups&lt;/code&gt;&lt;/dfn&gt;
+     keyword&lt;/li&gt;
+
      &lt;li&gt;&lt;p&gt;The &lt;a href=#sandboxed-top-level-navigation-browsing-context-flag&gt;sandboxed top-level navigation browsing context
      flag&lt;/a&gt;, unless &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains the &lt;dfn id=attr-iframe-sandbox-allow-top-navigation title=attr-iframe-sandbox-allow-top-navigation&gt;&lt;code&gt;allow-top-navigation&lt;/code&gt;&lt;/dfn&gt;
      keyword&lt;/li&gt;
@@ -65552,7 +65599,13 @@
 
     &lt;/ul&gt;&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;Every &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; has an
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;Every &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; has a &lt;dfn id=popup-sandboxing-flag-set&gt;popup
+  sandboxing flag set&lt;/dfn&gt;. When a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is
+  created, its &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt; must be empty.
+  It is populated by &lt;a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name&gt;the rules for choosing a browsing context
+  given a browsing context name&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;Every &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; has an
   &lt;dfn id=iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/dfn&gt;, which is a
   &lt;a href=#sandboxing-flag-set&gt;sandboxing flag set&lt;/a&gt;. Which flags in a &lt;a href=#nested-browsing-context&gt;nested
   browsing context&lt;/a&gt;'s &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag
@@ -66437,10 +66490,8 @@
     &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt; is not one of the &lt;a href=#ancestor-browsing-context title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
     contexts&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being
     navigated, and the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being navigated
-    is not both a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; and one of
-    the &lt;a href=#ancestor-browsing-context title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
-    contexts&lt;/a&gt; of the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;, and
-    the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active
+    is not a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;, and the
+    &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active
     document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; has its
     &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context flag&lt;/a&gt; set, then
     abort these steps.&lt;/p&gt;
@@ -66454,15 +66505,33 @@
     top-level navigation browsing context flag&lt;/a&gt; set, then abort
     these steps.&lt;/p&gt;
 
-    &lt;p&gt;In both cases, the user agent may additionally offer to open
-    the new resource in a new &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;
-    or in the &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; of the
-    &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;, at the user's option, in
-    which case the user agent must &lt;a href=#navigate&gt;navigate&lt;/a&gt;&lt;!--DONAV
+    &lt;p&gt;Otherwise, if the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being navigated
+    is a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;, and is not one of
+    the &lt;a href=#ancestor-browsing-context title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
+    contexts&lt;/a&gt; of the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;, and
+    the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s
+    &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; has its &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed
+    navigation browsing context flag&lt;/a&gt; set, and the &lt;a href=#source-browsing-context&gt;source
+    browsing context&lt;/a&gt; is not the &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed
+    navigator&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being
+    navigated, then abort these steps.&lt;/p&gt; &lt;!-- we do not check the
+    /sandboxed auxiliary navigation browsing context flag/ here,
+    that's only for actually opening the new top-level browsing
+    context. --&gt;
+
+    &lt;p&gt;In all of these cases, the user agent may additionally offer to
+    open the new resource in a new &lt;a href=#top-level-browsing-context&gt;top-level browsing
+    context&lt;/a&gt; or in the &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;
+    of the &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt;, at the user's option,
+    in which case the user agent must &lt;a href=#navigate&gt;navigate&lt;/a&gt;&lt;!--DONAV
     sandbox manual load--&gt; that designated &lt;a href=#top-level-browsing-context&gt;top-level browsing
     context&lt;/a&gt; to the new resource as if the user had requested it
     independently.&lt;/p&gt;
 
+    &lt;p class=note&gt;Doing so, however, can be dangerous, as it means
+    that the user is overriding the author's explicit request to
+    sandbox the content.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li id=seamlessLinks&gt;&lt;p&gt;If the &lt;a href=#source-browsing-context&gt;source browsing
@@ -66844,6 +66913,11 @@
     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is created:&lt;/p&gt;
 
     &lt;ul&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
+     context&lt;/a&gt; is a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;,
+     then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
+     &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
      context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, then:
      the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
      &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
@@ -72481,10 +72555,13 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the current browsing context's &lt;a href=#active-document&gt;active
-    document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; has its
-    &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context flag&lt;/a&gt; set, then
-    return the empty string and abort these steps.&lt;/p&gt;
+    &lt;p&gt;If the &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt;
+    of the &lt;a href=#active-document&gt;active document&lt;/a&gt;
+    of the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing context&lt;/a&gt;
+    of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method
+    has its
+    &lt;a href=#sandboxed-auxiliary-navigation-browsing-context-flag&gt;sandboxed auxiliary navigation browsing context flag&lt;/a&gt;
+    set, then return the empty string and abort these steps.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -72538,6 +72615,22 @@
 
    &lt;li&gt;
 
+    &lt;p&gt;Set all the flags
+    in the new browsing context's &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt;
+    that are set in the
+    &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt;
+    of the &lt;a href=#active-document&gt;active document&lt;/a&gt;
+    of the &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing context&lt;/a&gt;
+    of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method.
+    The &lt;a href=&quot;#script's-browsing-context&quot; title=&quot;script's browsing context&quot;&gt;browsing context&lt;/a&gt;
+    of the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that invoked the method
+    must be set as the new browsing context's
+    &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;Let the &lt;a href=#dialog-arguments&gt;dialog arguments&lt;/a&gt; of the new browsing
     context be set to the value of &lt;var title=&quot;&quot;&gt;argument&lt;/var&gt;, or
     the 'undefined' value if the argument was omitted.&lt;/p&gt;
@@ -99696,6 +99789,7 @@
      &lt;td&gt; Security rules for nested content
      &lt;td&gt; &lt;a href=#unordered-set-of-unique-space-separated-tokens&gt;Unordered set of unique space-separated tokens&lt;/a&gt;, &lt;a href=#ascii-case-insensitive&gt;ASCII case-insensitive&lt;/a&gt;, consisting of
           &quot;&lt;code title=attr-iframe-sandbox-allow-forms&gt;&lt;a href=#attr-iframe-sandbox-allow-forms&gt;allow-forms&lt;/a&gt;&lt;/code&gt;&quot;,
+          &quot;&lt;code title=attr-iframe-sandbox-allow-popups&gt;&lt;a href=#attr-iframe-sandbox-allow-popups&gt;allow-popups&lt;/a&gt;&lt;/code&gt;&quot;,
           &quot;&lt;code title=attr-iframe-sandbox-allow-same-origin&gt;&lt;a href=#attr-iframe-sandbox-allow-same-origin&gt;allow-same-origin&lt;/a&gt;&lt;/code&gt;&quot;,
           &quot;&lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt; and
           &quot;&lt;code title=attr-iframe-sandbox-allow-top-navigation&gt;&lt;a href=#attr-iframe-sandbox-allow-top-navigation&gt;allow-top-navigation&lt;/a&gt;&lt;/code&gt;&quot;

Modified: source
===================================================================
--- source	2012-04-13 23:10:03 UTC (rev 7053)
+++ source	2012-04-17 05:02:26 UTC (rev 7054)
@@ -27200,6 +27200,7 @@
   &lt;span&gt;unordered set of unique space-separated tokens&lt;/span&gt; that are
   &lt;span&gt;ASCII case-insensitive&lt;/span&gt;. The allowed values are
   &lt;code title=&quot;attr-iframe-sandbox-allow-forms&quot;&gt;allow-forms&lt;/code&gt;,
+  &lt;code title=&quot;attr-iframe-sandbox-allow-popups&quot;&gt;allow-popups&lt;/code&gt;,
   &lt;code title=&quot;attr-iframe-sandbox-allow-same-origin&quot;&gt;allow-same-origin&lt;/code&gt;,
   &lt;code title=&quot;attr-iframe-sandbox-allow-scripts&quot;&gt;allow-scripts&lt;/code&gt;, and
   &lt;code title=&quot;attr-iframe-sandbox-allow-top-navigation&quot;&gt;allow-top-navigation&lt;/code&gt;.
@@ -27215,10 +27216,10 @@
   title=&quot;attr-iframe-sandbox-allow-top-navigation&quot;&gt;allow-top-navigation&lt;/code&gt;
   keyword allows the content to &lt;span&gt;navigate&lt;/span&gt; its
   &lt;span&gt;top-level browsing context&lt;/span&gt;, and the &lt;code
-  title=&quot;attr-iframe-sandbox-allow-forms&quot;&gt;allow-forms&lt;/code&gt; and &lt;code
+  title=&quot;attr-iframe-sandbox-allow-forms&quot;&gt;allow-forms&lt;/code&gt;, &lt;code
+  title=&quot;attr-iframe-sandbox-allow-popups&quot;&gt;allow-popups&lt;/code&gt; and &lt;code
   title=&quot;attr-iframe-sandbox-allow-scripts&quot;&gt;allow-scripts&lt;/code&gt;
-  keywords re-enable forms and scripts respectively (though scripts
-  are still prevented from creating popups).&lt;/p&gt;
+  keywords re-enable forms, popups, and scripts respectively.&lt;/p&gt;
 
   &lt;p class=&quot;warning&quot;&gt;Setting both the
   &lt;code title=&quot;attr-iframe-sandbox-allow-scripts&quot;&gt;allow-scripts&lt;/code&gt; and
@@ -74720,10 +74721,12 @@
   context&lt;/span&gt; of the one the link or script is in, &quot;new&quot; means a
   new &lt;span&gt;top-level browsing context&lt;/span&gt; or &lt;span&gt;auxiliary
   browsing context&lt;/span&gt; is to be created, subject to various user
-  preferences and user agent policies, &quot;maybe new&quot; means the same as
-  &quot;new&quot; but the requirements for those cases encourage user agents to
-  treat it more like &quot;none&quot;, and &quot;none&quot; means that by default nothing
-  will happen.&lt;/p&gt;
+  preferences and user agent policies, &quot;none&quot; means that nothing will
+  happen, and &quot;maybe new&quot; means the same as &quot;new&quot; if the &quot;&lt;code
+  title=&quot;attr-iframe-sandbox-allow-popups&quot;&gt;allow-popups&lt;/code&gt;&quot;
+  keyword is also specified on the &lt;code
+  title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt; attribute (or if the user
+  overrode the sandboxing), and the same as &quot;none&quot; otherwise.&lt;/p&gt;
 
   &lt;table&gt;
    &lt;thead&gt;
@@ -74965,20 +74968,30 @@
 
      &lt;dt id=&quot;sandboxWindowOpen&quot;&gt;If the current browsing context's
      &lt;span&gt;active document&lt;/span&gt;'s &lt;span&gt;active sandboxing flag
-     set&lt;/span&gt; has the &lt;span&gt;sandboxed navigation browsing context
-     flag&lt;/span&gt; set.&lt;/dt&gt;
+     set&lt;/span&gt; has the &lt;span&gt;sandboxed auxiliary navigation browsing
+     context flag&lt;/span&gt; set.&lt;/dt&gt;
 
-     &lt;dd&gt;&lt;p&gt;The user agent may offer to create a new &lt;span&gt;top-level
-     browsing context&lt;/span&gt; or reuse an existing &lt;span&gt;top-level
-     browsing context&lt;/span&gt;. If the user picks one of those options,
-     then the designated browsing context must be the chosen one (the
-     browsing context's name isn't set to the given browsing context
-     name). The default behaviour (if the user agent doesn't offer the
-     option to the user, or if the user declines to allow a browsing
-     context to be used) there must not be a chosen browsing
-     context.&lt;/p&gt;&lt;/dd&gt;
+     &lt;dd&gt;
 
+      &lt;p&gt;Typically, there is no chosen browsing context.&lt;/p&gt;
 
+      &lt;p&gt;The user agent may offer to create a new &lt;span&gt;top-level
+      browsing context&lt;/span&gt; or reuse an existing &lt;span&gt;top-level
+      browsing context&lt;/span&gt;. If the user picks one of those options,
+      then the designated browsing context must be the chosen one (the
+      browsing context's name isn't set to the given browsing context
+      name). The default behaviour (if the user agent doesn't offer
+      the option to the user, or if the user declines to allow a
+      browsing context to be used) must be that there must not be a
+      chosen browsing context.&lt;/p&gt;
+
+      &lt;p class=&quot;warning&quot;&gt;If this case occurs, it means that an author
+      has explicitly sandboxed the document that is trying to open a
+      link.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+
      &lt;dt id=&quot;noopener&quot;&gt;If the user agent has been configured such that
      in this instance it will create a new browsing context, and the
      browsing context is being requested as part of &lt;span
@@ -75034,6 +75047,18 @@
     users to configure the user agent to always reuse the current
     browsing context.&lt;/p&gt;
 
+    &lt;p&gt;If the current browsing context's &lt;span&gt;active
+    document&lt;/span&gt;'s &lt;span&gt;active sandboxing flag set&lt;/span&gt; has the
+    &lt;span&gt;sandboxed navigation browsing context flag&lt;/span&gt; set and
+    chosen browsing context picked above, if any, is a new browsing
+    context (whether top-level or auxiliary), then all the flags that
+    are set in the current browsing context's &lt;span&gt;active
+    document&lt;/span&gt;'s &lt;span&gt;active sandboxing flag set&lt;/span&gt; when the
+    new browsing context is created must be set in the new browsing
+    context's &lt;span&gt;popup sandboxing flag set&lt;/span&gt;, and the current
+    browsing context must be set as the new browsing context's
+    &lt;span&gt;one permitted sandboxed navigator&lt;/span&gt;.&lt;/p&gt;
+
    &lt;/li&gt;
 
   &lt;/ol&gt;
@@ -76524,21 +76549,42 @@
     &lt;p&gt;This flag &lt;a href=&quot;#sandboxLinks&quot;&gt;prevents content from
     navigating browsing contexts other than the sandboxed browsing
     context itself&lt;/a&gt; (or browsing contexts further nested inside
-    it), and the &lt;span&gt;top-level browsing context&lt;/span&gt; (which is
+    it), &lt;span title=&quot;auxiliary browsing context&quot;&gt;auxiliary browsing
+    contexts&lt;/span&gt; (which are protected by the &lt;span&gt;sandboxed
+    auxiliary navigation browsing context flag&lt;/span&gt; defined next),
+    and the &lt;span&gt;top-level browsing context&lt;/span&gt; (which is
     protected by the &lt;span&gt;sandboxed top-level navigation browsing
-    context flag&lt;/span&gt; defined next).&lt;/p&gt;
+    context flag&lt;/span&gt; defined below).&lt;/p&gt;
 
-    &lt;p&gt;This flag also &lt;a href=&quot;#sandboxWindowOpen&quot;&gt;prevents content
-    from creating new auxiliary browsing contexts&lt;/a&gt;, e.g. using the
-    &lt;code title=&quot;attr-hyperlink-target&quot;&gt;target&lt;/code&gt; attribute, the
-    &lt;code title=&quot;dom-open&quot;&gt;window.open()&lt;/code&gt; method, or the &lt;code
+    &lt;p&gt;If the &lt;span&gt;sandboxed auxiliary navigation browsing context
+    flag&lt;/span&gt; is not set, then in certain cases the restrictions
+    nonetheless allow popups (new &lt;span title=&quot;top-level browsing
+    context&quot;&gt;top-level browsing contexts&lt;/span&gt;) to be opened. These
+    &lt;span title=&quot;browsing context&quot;&gt;browsing contexts&lt;/span&gt; always
+    have &lt;dfn&gt;one permitted sandboxed navigator&lt;/dfn&gt;, set when the
+    browsing context is created, which allows the &lt;span&gt;browsing
+    context&lt;/span&gt; that created them to actually navigate them.
+    (Otherwise, the &lt;span&gt;sandboxed navigation browsing context
+    flag&lt;/span&gt; would prevent them from being navigated even if they
+    were opened.)&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;The &lt;dfn&gt;sandboxed auxiliary navigation browsing context flag&lt;/dfn&gt;&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This flag &lt;a href=&quot;#sandboxWindowOpen&quot;&gt;prevents content from
+    creating new auxiliary browsing contexts&lt;/a&gt;, e.g. using the &lt;code
+    title=&quot;attr-hyperlink-target&quot;&gt;target&lt;/code&gt; attribute, the &lt;code
+    title=&quot;dom-open&quot;&gt;window.open()&lt;/code&gt; method, or the &lt;code
     title=&quot;dom-showModalDialog&quot;&gt;showModalDialog()&lt;/code&gt; method.&lt;/p&gt;
 
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;The &lt;dfn&gt;sandboxed top-level navigation browsing context
-   flag&lt;/dfn&gt;&lt;/dt&gt;
+   &lt;dt&gt;The &lt;dfn&gt;sandboxed top-level navigation browsing context flag&lt;/dfn&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
@@ -76550,7 +76596,9 @@
     is set, content can navigate its &lt;span&gt;top-level browsing
     context&lt;/span&gt;, but other &lt;span title=&quot;browsing context&quot;&gt;browsing
     contexts&lt;/span&gt; are still protected by the &lt;span&gt;sandboxed
-    navigation browsing context flag&lt;/span&gt; defined above.&lt;/p&gt;
+    navigation browsing context flag&lt;/span&gt; and possibly the
+    &lt;span&gt;sandboxed auxiliary navigation browsing context
+    flag&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -76668,6 +76716,11 @@
 
      &lt;li&gt;&lt;p&gt;The &lt;span&gt;sandboxed navigation browsing context flag&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;The &lt;span&gt;sandboxed auxiliary navigation browsing context
+     flag&lt;/span&gt;, unless &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains the &lt;dfn
+     title=&quot;attr-iframe-sandbox-allow-popups&quot;&gt;&lt;code&gt;allow-popups&lt;/code&gt;&lt;/dfn&gt;
+     keyword&lt;/p&gt;&lt;/li&gt;
+
      &lt;li&gt;&lt;p&gt;The &lt;span&gt;sandboxed top-level navigation browsing context
      flag&lt;/span&gt;, unless &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains the &lt;dfn
      title=&quot;attr-iframe-sandbox-allow-top-navigation&quot;&gt;&lt;code&gt;allow-top-navigation&lt;/code&gt;&lt;/dfn&gt;
@@ -76738,6 +76791,12 @@
 
   &lt;hr&gt;
 
+  &lt;p&gt;Every &lt;span&gt;top-level browsing context&lt;/span&gt; has a &lt;dfn&gt;popup
+  sandboxing flag set&lt;/dfn&gt;. When a &lt;span&gt;browsing context&lt;/span&gt; is
+  created, its &lt;span&gt;popup sandboxing flag set&lt;/span&gt; must be empty.
+  It is populated by &lt;span&gt;the rules for choosing a browsing context
+  given a browsing context name&lt;/span&gt;.&lt;/p&gt;
+
   &lt;p&gt;Every &lt;span&gt;nested browsing context&lt;/span&gt; has an
   &lt;dfn&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/dfn&gt;, which is a
   &lt;span&gt;sandboxing flag set&lt;/span&gt;. Which flags in a &lt;span&gt;nested
@@ -77741,10 +77800,8 @@
     title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
     contexts&lt;/span&gt; of the &lt;span&gt;browsing context&lt;/span&gt; being
     navigated, and the &lt;span&gt;browsing context&lt;/span&gt; being navigated
-    is not both a &lt;span&gt;top-level browsing context&lt;/span&gt; and one of
-    the &lt;span title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
-    contexts&lt;/span&gt; of the &lt;span&gt;source browsing context&lt;/span&gt;, and
-    the &lt;span&gt;source browsing context&lt;/span&gt;'s &lt;span&gt;active
+    is not a &lt;span&gt;top-level browsing context&lt;/span&gt;, and the
+    &lt;span&gt;source browsing context&lt;/span&gt;'s &lt;span&gt;active
     document&lt;/span&gt;'s &lt;span&gt;active sandboxing flag set&lt;/span&gt; has its
     &lt;span&gt;sandboxed navigation browsing context flag&lt;/span&gt; set, then
     abort these steps.&lt;/p&gt;
@@ -77754,19 +77811,37 @@
     &lt;span title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
     contexts&lt;/span&gt; of the &lt;span&gt;source browsing context&lt;/span&gt;, and
     the &lt;span&gt;source browsing context&lt;/span&gt;'s &lt;code&gt;Document&lt;/code&gt;'s
-    &lt;Span&gt;active sandboxing flag set&lt;/span&gt; has its &lt;span&gt;sandboxed
+    &lt;span&gt;active sandboxing flag set&lt;/span&gt; has its &lt;span&gt;sandboxed
     top-level navigation browsing context flag&lt;/span&gt; set, then abort
     these steps.&lt;/p&gt;
 
-    &lt;p&gt;In both cases, the user agent may additionally offer to open
-    the new resource in a new &lt;span&gt;top-level browsing context&lt;/span&gt;
-    or in the &lt;span&gt;top-level browsing context&lt;/span&gt; of the
-    &lt;span&gt;source browsing context&lt;/span&gt;, at the user's option, in
-    which case the user agent must &lt;span&gt;navigate&lt;/span&gt;&lt;!--DONAV
+    &lt;p&gt;Otherwise, if the &lt;span&gt;browsing context&lt;/span&gt; being navigated
+    is a &lt;span&gt;top-level browsing context&lt;/span&gt;, and is not one of
+    the &lt;span title=&quot;ancestor browsing context&quot;&gt;ancestor browsing
+    contexts&lt;/span&gt; of the &lt;span&gt;source browsing context&lt;/span&gt;, and
+    the &lt;span&gt;source browsing context&lt;/span&gt;'s &lt;code&gt;Document&lt;/code&gt;'s
+    &lt;span&gt;active sandboxing flag set&lt;/span&gt; has its &lt;span&gt;sandboxed
+    navigation browsing context flag&lt;/span&gt; set, and the &lt;span&gt;source
+    browsing context&lt;/span&gt; is not the &lt;span&gt;one permitted sandboxed
+    navigator&lt;/span&gt; of the &lt;span&gt;browsing context&lt;/span&gt; being
+    navigated, then abort these steps.&lt;/p&gt; &lt;!-- we do not check the
+    /sandboxed auxiliary navigation browsing context flag/ here,
+    that's only for actually opening the new top-level browsing
+    context. --&gt;
+
+    &lt;p&gt;In all of these cases, the user agent may additionally offer to
+    open the new resource in a new &lt;span&gt;top-level browsing
+    context&lt;/span&gt; or in the &lt;span&gt;top-level browsing context&lt;/span&gt;
+    of the &lt;span&gt;source browsing context&lt;/span&gt;, at the user's option,
+    in which case the user agent must &lt;span&gt;navigate&lt;/span&gt;&lt;!--DONAV
     sandbox manual load--&gt; that designated &lt;span&gt;top-level browsing
     context&lt;/span&gt; to the new resource as if the user had requested it
     independently.&lt;/p&gt;
 
+    &lt;p class=&quot;note&quot;&gt;Doing so, however, can be dangerous, as it means
+    that the user is overriding the author's explicit request to
+    sandbox the content.&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li id=&quot;seamlessLinks&quot;&gt;&lt;p&gt;If the &lt;span&gt;source browsing
@@ -78188,6 +78263,11 @@
     &lt;ul&gt;
 
      &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing
+     context&lt;/span&gt; is a &lt;span&gt;top-level browsing context&lt;/span&gt;,
+     then: the flags set on the &lt;span&gt;browsing context&lt;/span&gt;'s
+     &lt;span&gt;popup sandboxing flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing
      context&lt;/span&gt; is a &lt;span&gt;nested browsing context&lt;/span&gt;, then:
      the flags set on the &lt;span&gt;browsing context&lt;/span&gt;'s
      &lt;span&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -84787,10 +84867,13 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the current browsing context's &lt;span&gt;active
-    document&lt;/span&gt;'s &lt;span&gt;active sandboxing flag set&lt;/span&gt; has its
-    &lt;span&gt;sandboxed navigation browsing context flag&lt;/span&gt; set, then
-    return the empty string and abort these steps.&lt;/p&gt;
+    &lt;p&gt;If the &lt;span&gt;active sandboxing flag set&lt;/span&gt;
+    of the &lt;span&gt;active document&lt;/span&gt;
+    of the &lt;span title=&quot;script's browsing context&quot;&gt;browsing context&lt;/span&gt;
+    of the &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that invoked the method
+    has its
+    &lt;span&gt;sandboxed auxiliary navigation browsing context flag&lt;/span&gt;
+    set, then return the empty string and abort these steps.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -84852,6 +84935,22 @@
 
    &lt;li&gt;
 
+    &lt;p&gt;Set all the flags
+    in the new browsing context's &lt;span&gt;popup sandboxing flag set&lt;/span&gt;
+    that are set in the
+    &lt;span&gt;active sandboxing flag set&lt;/span&gt;
+    of the &lt;span&gt;active document&lt;/span&gt;
+    of the &lt;span title=&quot;script's browsing context&quot;&gt;browsing context&lt;/span&gt;
+    of the &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that invoked the method.
+    The &lt;span title=&quot;script's browsing context&quot;&gt;browsing context&lt;/span&gt;
+    of the &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; that invoked the method
+    must be set as the new browsing context's
+    &lt;span&gt;one permitted sandboxed navigator&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;Let the &lt;span&gt;dialog arguments&lt;/span&gt; of the new browsing
     context be set to the value of &lt;var title=&quot;&quot;&gt;argument&lt;/var&gt;, or
     the 'undefined' value if the argument was omitted.&lt;/p&gt;
@@ -116532,6 +116631,7 @@
      &lt;td&gt; Security rules for nested content
      &lt;td&gt; &lt;span&gt;Unordered set of unique space-separated tokens&lt;/span&gt;, &lt;span&gt;ASCII case-insensitive&lt;/span&gt;, consisting of
           &quot;&lt;code title=&quot;attr-iframe-sandbox-allow-forms&quot;&gt;allow-forms&lt;/code&gt;&quot;,
+          &quot;&lt;code title=&quot;attr-iframe-sandbox-allow-popups&quot;&gt;allow-popups&lt;/code&gt;&quot;,
           &quot;&lt;code title=&quot;attr-iframe-sandbox-allow-same-origin&quot;&gt;allow-same-origin&lt;/code&gt;&quot;,
           &quot;&lt;code title=&quot;attr-iframe-sandbox-allow-scripts&quot;&gt;allow-scripts&lt;/code&gt; and
           &quot;&lt;code title=&quot;attr-iframe-sandbox-allow-top-navigation&quot;&gt;allow-top-navigation&lt;/code&gt;&quot;


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013918.html">[html5] r7053 - [e] (0) Refactor the sandboxing flags further to	make it even easier to hook int [...]
</A></li>
	<LI>Next message: <A HREF="013920.html">[html5] r7055 - [e] (0) use the term 'isolated' instead of	'unpaired', for consistency. link to  [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13919">[ date ]</a>
              <a href="thread.html#13919">[ thread ]</a>
              <a href="subject.html#13919">[ subject ]</a>
              <a href="author.html#13919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
