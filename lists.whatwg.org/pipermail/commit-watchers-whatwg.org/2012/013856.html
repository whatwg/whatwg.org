<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r6991 - / images
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6991%20-%20/%20images&In-Reply-To=%3C20120213224812.47EDE1CFC013%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013855.html">
   <LINK REL="Next"  HREF="013857.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r6991 - / images</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6991%20-%20/%20images&In-Reply-To=%3C20120213224812.47EDE1CFC013%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r6991 - / images">whatwg at whatwg.org
       </A><BR>
    <I>Mon Feb 13 14:48:12 PST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="013855.html">[html5] r6990 - [e] (0) Factor out the prescan algorithm for reuse	in other specs. Fixing https: [...]
</A></li>
        <LI>Next message: <A HREF="013857.html">[html5] r6992 - [e] (0) Move a section so that the character	encoding requirements are closer to [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13856">[ date ]</a>
              <a href="thread.html#13856">[ thread ]</a>
              <a href="subject.html#13856">[ subject ]</a>
              <a href="author.html#13856">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2012-02-13 14:48:10 -0800 (Mon, 13 Feb 2012)
New Revision: 6991

Modified:
   complete.html
   images/parsing-model-overview.png
   index
   source
Log:
[giow] (2) Rejig the wording of the character encoding section to make it more precise and in particular to not make CR processing require look-ahead.
Affected topics: HTML, HTML Syntax and Parsing

Modified: complete.html
===================================================================
--- complete.html	2012-02-13 21:06:58 UTC (rev 6990)
+++ complete.html	2012-02-13 22:48:10 UTC (rev 6991)
@@ -1115,7 +1115,7 @@
    &lt;li&gt;&lt;a href=#parsing&gt;&lt;span class=secno&gt;12.2 &lt;/span&gt;Parsing HTML documents&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#overview-of-the-parsing-model&gt;&lt;span class=secno&gt;12.2.1 &lt;/span&gt;Overview of the parsing model&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#the-input-stream&gt;&lt;span class=secno&gt;12.2.2 &lt;/span&gt;The input stream&lt;/a&gt;
+     &lt;li&gt;&lt;a href=#the-input-byte-stream&gt;&lt;span class=secno&gt;12.2.2 &lt;/span&gt;The input byte stream&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#determining-the-character-encoding&gt;&lt;span class=secno&gt;12.2.2.1 &lt;/span&gt;Determining the character encoding&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#character-encodings-0&gt;&lt;span class=secno&gt;12.2.2.2 &lt;/span&gt;Character encodings&lt;/a&gt;&lt;/li&gt;
@@ -13639,7 +13639,7 @@
 
     &lt;p&gt;If the document has an &lt;a href=#active-parser&gt;active parser&lt;/a&gt; that isn't a
     &lt;a href=#script-created-parser&gt;script-created parser&lt;/a&gt;, and the &lt;a href=#insertion-point&gt;insertion
-    point&lt;/a&gt; associated with that parser's &lt;a href=#the-input-stream&gt;input
+    point&lt;/a&gt; associated with that parser's &lt;a href=#input-stream&gt;input
     stream&lt;/a&gt; is not undefined (that is, it &lt;em&gt;does&lt;/em&gt; point to
     somewhere in the input stream), then the method does
     nothing. Abort these steps and return the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
@@ -13783,7 +13783,7 @@
    entry.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Finally, set the &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt; to point at
-   just before the end of the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; (which at this
+   just before the end of the &lt;a href=#input-stream&gt;input stream&lt;/a&gt; (which at this
    point will be empty).&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; on which the method was
@@ -13833,7 +13833,7 @@
    with the document, then abort these steps.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Insert an &lt;a href=#explicit-eof-character&gt;explicit &quot;EOF&quot; character&lt;/a&gt; at the end
-   of the parser's &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt;.&lt;/li&gt;
+   of the parser's &lt;a href=#input-stream&gt;input stream&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If there is a &lt;a href=#pending-parsing-blocking-script&gt;pending parsing-blocking script&lt;/a&gt;,
    then abort these steps.&lt;/li&gt;
@@ -13922,14 +13922,14 @@
     the user &lt;a href=#refused-to-allow-the-document-to-be-unloaded&gt;refused to allow the document to be
     unloaded&lt;/a&gt;, then abort these steps. Otherwise, the
     &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt; will point at just before the end of
-    the (empty) &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt;.&lt;/p&gt;
+    the (empty) &lt;a href=#input-stream&gt;input stream&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Insert the string consisting of the concatenation of all the
-    arguments to the method into the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; just
+    arguments to the method into the &lt;a href=#input-stream&gt;input stream&lt;/a&gt; just
     before the &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -64273,12 +64273,12 @@
   an &lt;a href=#html-documents title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt;, set its &lt;a href=#concept-document-content-type title=concept-document-content-type&gt;content type&lt;/a&gt; to &quot;&lt;code title=&quot;&quot;&gt;text/html&lt;/code&gt;&quot;, create an &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt;, and
   associate it with the document. Each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that the &lt;a href=#networking-task-source&gt;networking task
   source&lt;/a&gt; places on the &lt;a href=#task-queue&gt;task queue&lt;/a&gt; while the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; runs must then fill the
-  parser's &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; with the fetched bytes and cause
-  the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; to perform the appropriate processing
-  of the input stream.&lt;/p&gt;
+  parser's &lt;a href=#the-input-byte-stream&gt;input byte stream&lt;/a&gt; with the fetched bytes and
+  cause the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; to perform the appropriate
+  processing of the input stream.&lt;/p&gt;
 
-  &lt;p class=note&gt;The &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; converts bytes into
-  characters for use in the &lt;a href=#tokenization title=tokenization&gt;tokenizer&lt;/a&gt;. This process relies, in part,
+  &lt;p class=note&gt;The &lt;a href=#the-input-byte-stream&gt;input byte stream&lt;/a&gt; converts bytes
+  into characters for use in the &lt;a href=#tokenization title=tokenization&gt;tokenizer&lt;/a&gt;. This process relies, in part,
   on character encoding information found in the real &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the resource;
   the &quot;sniffed type&quot; is not used for this purpose.&lt;/p&gt;
 
@@ -64377,9 +64377,9 @@
   state&lt;/a&gt;. Each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that the
   &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; places on the &lt;a href=#task-queue&gt;task
   queue&lt;/a&gt; while the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt;
-  runs must then fill the parser's &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; with the
-  fetched bytes and cause the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; to perform the
-  appropriate processing of the input stream.&lt;/p&gt;
+  runs must then fill the parser's &lt;a href=#the-input-byte-stream&gt;input byte stream&lt;/a&gt; with
+  the fetched bytes and cause the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; to perform
+  the appropriate processing of the input stream.&lt;/p&gt;
 
   &lt;p&gt;The rules for how to convert the bytes of the plain text document
   into actual characters, and the rules for actually rendering the
@@ -81111,13 +81111,13 @@
 
   &lt;h4 id=overview-of-the-parsing-model&gt;&lt;span class=secno&gt;12.2.1 &lt;/span&gt;Overview of the parsing model&lt;/h4&gt;
 
-  &lt;p class=overview&gt;&lt;object data=images/parsing-model-overview.svg height=450 width=345&gt;&lt;img alt=&quot;&quot; height=450 src=<A HREF="http://images.whatwg.org/parsing-model-overview.png">http://images.whatwg.org/parsing-model-overview.png</A> width=345&gt;&lt;/object&gt;&lt;/p&gt;
+  &lt;p class=overview&gt;&lt;object data=images/parsing-model-overview.svg height=535 width=345&gt;&lt;img alt=&quot;&quot; height=450 src=<A HREF="http://images.whatwg.org/parsing-model-overview.png">http://images.whatwg.org/parsing-model-overview.png</A> width=345&gt;&lt;/object&gt;&lt;/p&gt;
 
   &lt;p&gt;The input to the HTML parsing process consists of a stream of
-  Unicode code points, which is passed through a
-  &lt;a href=#tokenization&gt;tokenization&lt;/a&gt; stage followed by a &lt;a href=#tree-construction&gt;tree
-  construction&lt;/a&gt; stage. The output is a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
-  object.&lt;/p&gt;
+  &lt;a href=#unicode-code-point title=&quot;Unicode code point&quot;&gt;Unicode code points&lt;/a&gt;, which
+  is passed through a &lt;a href=#tokenization&gt;tokenization&lt;/a&gt; stage followed by a
+  &lt;a href=#tree-construction&gt;tree construction&lt;/a&gt; stage. The output is a
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
   &lt;p class=note&gt;Implementations that &lt;a href=#non-scripted&gt;do not
   support scripting&lt;/a&gt; do not have to actually create a DOM
@@ -81157,22 +81157,51 @@
   &lt;/div&gt;
 
 
+
   &lt;div class=impl&gt;
 
-  &lt;h4 id=the-input-stream&gt;&lt;span class=secno&gt;12.2.2 &lt;/span&gt;The &lt;dfn&gt;input stream&lt;/dfn&gt;&lt;/h4&gt;
+  &lt;h4 id=the-input-byte-stream&gt;&lt;span class=secno&gt;12.2.2 &lt;/span&gt;The &lt;dfn&gt;input byte stream&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;The stream of Unicode code points that comprises the input to the
   tokenization stage will be initially seen by the user agent as a
   stream of bytes (typically coming over the network or from the local
   file system). The bytes encode the actual characters according to a
-  particular &lt;em&gt;character encoding&lt;/em&gt;, which the user agent must
-  use to decode the bytes into characters.&lt;/p&gt;
+  particular &lt;i&gt;character encoding&lt;/i&gt;, which the user agent must use
+  to decode the bytes into characters.&lt;/p&gt;
 
   &lt;p class=note&gt;For XML documents, the algorithm user agents must
   use to determine the character encoding is given by the XML
   specification. This section does not apply to XML documents. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;The &lt;a href=#encoding-sniffing-algorithm&gt;encoding sniffing algorithm&lt;/a&gt; defined below is
+  used to determine the character encoding.&lt;/p&gt;
 
+  &lt;p&gt;Given an encoding, the bytes in the &lt;a href=#the-input-byte-stream&gt;input byte
+  stream&lt;/a&gt; must be converted to Unicode code points for the
+  tokenizer's &lt;a href=#input-stream&gt;input stream&lt;/a&gt;, as described by the rules for
+  that encoding, except that the leading U+FEFF BYTE ORDER MARK
+  character, if any, must not be stripped by the encoding layer (it is
+  stripped by the rule below).&lt;/p&gt; &lt;!-- this is to prevent two leading
+  BOMs from being both stripped, once by the decoder, and once by the
+  parser --&gt;
+
+  &lt;p&gt;Bytes or sequences of bytes in the original byte stream that
+  could not be converted to Unicode code points must be converted to
+  U+FFFD REPLACEMENT CHARACTERs. Specifically, if the encoding is
+  UTF-8, the bytes must be &lt;a href=#decoded-as-utf-8,-with-error-handling title=&quot;decoded as UTF-8, with error
+  handling&quot;&gt;decoded with the error handling&lt;/a&gt; defined in this
+  specification.&lt;/p&gt;
+
+  &lt;p class=note&gt;Bytes or sequences of bytes in the original byte
+  stream that did not conform to the encoding specification (e.g.
+  invalid UTF-8 byte sequences in a UTF-8 input byte stream) are
+  errors that conformance checkers are expected to report.&lt;/p&gt;
+
+  &lt;p&gt;Any byte or sequence of bytes in the original byte stream that is
+  &lt;a href=#misinterpreted-for-compatibility&gt;misinterpreted for compatibility&lt;/a&gt; is a &lt;a href=#parse-error&gt;parse
+  error&lt;/a&gt;.&lt;/p&gt;
+
+
   &lt;h5 id=determining-the-character-encoding&gt;&lt;span class=secno&gt;12.2.2.1 &lt;/span&gt;Determining the character encoding&lt;/h5&gt;
 
   &lt;p&gt;In some cases, it might be impractical to unambiguously determine
@@ -81428,7 +81457,7 @@
   &lt;/ol&gt;&lt;p&gt;The &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt; must immediately
   be set to the value returned from this algorithm, at the same time
   as the user agent uses the returned value to select the decoder to
-  use for the input stream.&lt;/p&gt;
+  use for the input byte stream.&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;When an algorithm requires a user agent to &lt;dfn id=prescan-a-byte-stream-to-determine-its-encoding&gt;prescan a byte
   stream to determine its encoding&lt;/dfn&gt;, given some defined &lt;var title=&quot;&quot;&gt;end condition&lt;/var&gt;, then it must run the following steps.
@@ -81438,7 +81467,7 @@
   &lt;ol&gt;&lt;li&gt;
 
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; be a pointer to a byte in the
-    input stream, initially pointing at the first byte. If at any
+    input byte stream, initially pointing at the first byte. If at any
     point during these steps the user agent either runs out of bytes
     or reaches its &lt;var title=&quot;&quot;&gt;end condition&lt;/var&gt;, then abort the
     &lt;a href=#prescan-a-byte-stream-to-determine-its-encoding&gt;prescan a byte stream to determine its encoding&lt;/a&gt;
@@ -81575,8 +81604,8 @@
     &lt;/dl&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;i&gt;Next byte&lt;/i&gt;: Move &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; so it
-   points at the next byte in the input stream, and return to the step
-   above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
+   points at the next byte in the input byte stream, and return to the
+   step above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the &lt;a href=#prescan-a-byte-stream-to-determine-its-encoding&gt;prescan a byte stream to determine its
   encoding&lt;/a&gt; algorithm says to &lt;dfn id=concept-get-attributes-when-sniffing title=concept-get-attributes-when-sniffing&gt;get an attribute&lt;/dfn&gt;,
@@ -81851,32 +81880,12 @@
 
   &lt;h5 id=preprocessing-the-input-stream&gt;&lt;span class=secno&gt;12.2.2.3 &lt;/span&gt;Preprocessing the input stream&lt;/h5&gt;
 
-  &lt;p&gt;Given an encoding, the bytes in the input stream must be
-  converted to Unicode code points for the tokenizer, as described by
-  the rules for that encoding, except that the leading U+FEFF BYTE
-  ORDER MARK character, if any, must not be stripped by the encoding
-  layer (it is stripped by the rule below).&lt;/p&gt; &lt;!-- this is to
-  prevent two leading BOMs from being both stripped, once by the
-  decoder, and once by the parser --&gt;
+  &lt;p&gt;The &lt;dfn id=input-stream&gt;input stream&lt;/dfn&gt; consists of the characters pushed
+  into it as the &lt;a href=#the-input-byte-stream&gt;input byte stream&lt;/a&gt; is decoded or from the
+  various APIs that directly manipulate the input stream.&lt;/p&gt;
 
-  &lt;p&gt;Bytes or sequences of bytes in the original byte stream that
-  could not be converted to Unicode code points must be converted to
-  U+FFFD REPLACEMENT CHARACTERs. Specifically, if the encoding is
-  UTF-8, the bytes must be &lt;a href=#decoded-as-utf-8,-with-error-handling title=&quot;decoded as UTF-8, with error
-  handling&quot;&gt;decoded with the error handling&lt;/a&gt; defined in this
-  specification.&lt;/p&gt;
-
-  &lt;p class=note&gt;Bytes or sequences of bytes in the original byte
-  stream that did not conform to the encoding specification
-  (e.g. invalid UTF-8 byte sequences in a UTF-8 input stream) are
-  errors that conformance checkers are expected to report.&lt;/p&gt;
-
-  &lt;p&gt;Any byte or sequence of bytes in the original byte stream that is
-  &lt;a href=#misinterpreted-for-compatibility&gt;misinterpreted for compatibility&lt;/a&gt; is a &lt;a href=#parse-error&gt;parse
-  error&lt;/a&gt;.&lt;/p&gt;
-
   &lt;p&gt;One leading U+FEFF BYTE ORDER MARK character must be ignored if
-  any are present.&lt;/p&gt;
+  any are present in the &lt;a href=#input-stream&gt;input stream&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p class=note&gt;The requirement to strip a U+FEFF BYTE ORDER MARK
   character regardless of whether that character was used to determine
@@ -81898,18 +81907,18 @@
   undefined Unicode characters (noncharacters).&lt;/p&gt;
 
   &lt;p&gt;U+000D CARRIAGE RETURN (CR) characters and U+000A LINE FEED (LF)
-  characters are treated specially. Any CR characters that are
-  followed by LF characters must be removed, and any CR characters not
-  followed by LF characters must be converted to LF characters. Thus,
-  newlines in HTML DOMs are represented by LF characters, and there
-  are never any CR characters in the input to the
-  &lt;a href=#tokenization&gt;tokenization&lt;/a&gt; stage.&lt;/p&gt;
+  characters are treated specially. All CR characters must be
+  converted to LF characters, and any LF characters that immediately
+  follow a CR character must be ignored. Thus, newlines in HTML DOMs
+  are represented by LF characters, and there are never any CR
+  characters in the input to the &lt;a href=#tokenization&gt;tokenization&lt;/a&gt; stage.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=next-input-character&gt;next input character&lt;/dfn&gt; is the first character in the
-  input stream that has not yet been &lt;dfn id=consumed&gt;consumed&lt;/dfn&gt;. Initially,
-  the &lt;i&gt;&lt;a href=#next-input-character&gt;next input character&lt;/a&gt;&lt;/i&gt; is the first character in the
-  input. The &lt;dfn id=current-input-character&gt;current input character&lt;/dfn&gt; is the last character
-  to have been &lt;i&gt;&lt;a href=#consumed&gt;consumed&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
+  &lt;a href=#input-stream&gt;input stream&lt;/a&gt; that has not yet been &lt;dfn id=consumed&gt;consumed&lt;/dfn&gt;
+  or explicit ignored by the requirements in this section. Initially,
+  the &lt;i&gt;&lt;a href=#next-input-character&gt;next input character&lt;/a&gt;&lt;/i&gt; is the first character in the input.
+  The &lt;dfn id=current-input-character&gt;current input character&lt;/dfn&gt; is the last character to have
+  been &lt;i&gt;&lt;a href=#consumed&gt;consumed&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=insertion-point&gt;insertion point&lt;/dfn&gt; is the position (just before a
   character or just before the end of the input stream) where content
@@ -81920,9 +81929,9 @@
   undefined.&lt;/p&gt;
 
   &lt;p&gt;The &quot;EOF&quot; character in the tables below is a conceptual character
-  representing the end of the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt;. If the parser
+  representing the end of the &lt;a href=#input-stream&gt;input stream&lt;/a&gt;. If the parser
   is a &lt;a href=#script-created-parser&gt;script-created parser&lt;/a&gt;, then the end of the
-  &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; is reached when an &lt;dfn id=explicit-eof-character&gt;explicit &quot;EOF&quot;
+  &lt;a href=#input-stream&gt;input stream&lt;/a&gt; is reached when an &lt;dfn id=explicit-eof-character&gt;explicit &quot;EOF&quot;
   character&lt;/dfn&gt; (inserted by the &lt;code title=dom-document-close&gt;&lt;a href=#dom-document-close&gt;document.close()&lt;/a&gt;&lt;/code&gt; method) is
   consumed. Otherwise, the &quot;EOF&quot; character is not a real character in
   the stream, but rather the lack of any further characters.&lt;/p&gt;
@@ -88477,7 +88486,7 @@
   &lt;/ol&gt;&lt;p&gt;When the user agent is to &lt;dfn id=abort-a-parser&gt;abort a parser&lt;/dfn&gt;, it must run
   the following steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Throw away any pending content in the &lt;a href=#the-input-stream&gt;input
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Throw away any pending content in the &lt;a href=#input-stream&gt;input
    stream&lt;/a&gt;, and discard any future content that would have been
    added to it.&lt;/li&gt;
 
@@ -89291,7 +89300,7 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Place into the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; for the &lt;a href=#html-parser&gt;HTML
+    &lt;p&gt;Place into the &lt;a href=#input-stream&gt;input stream&lt;/a&gt; for the &lt;a href=#html-parser&gt;HTML
     parser&lt;/a&gt; just created the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;. The
     encoding &lt;a href=#concept-encoding-confidence title=concept-encoding-confidence&gt;confidence&lt;/a&gt; is
     &lt;i&gt;irrelevant&lt;/i&gt;.&lt;/p&gt;

Modified: images/parsing-model-overview.png
===================================================================
(Binary files differ)

Modified: index
===================================================================
--- index	2012-02-13 21:06:58 UTC (rev 6990)
+++ index	2012-02-13 22:48:10 UTC (rev 6991)
@@ -1115,7 +1115,7 @@
    &lt;li&gt;&lt;a href=#parsing&gt;&lt;span class=secno&gt;12.2 &lt;/span&gt;Parsing HTML documents&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#overview-of-the-parsing-model&gt;&lt;span class=secno&gt;12.2.1 &lt;/span&gt;Overview of the parsing model&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#the-input-stream&gt;&lt;span class=secno&gt;12.2.2 &lt;/span&gt;The input stream&lt;/a&gt;
+     &lt;li&gt;&lt;a href=#the-input-byte-stream&gt;&lt;span class=secno&gt;12.2.2 &lt;/span&gt;The input byte stream&lt;/a&gt;
       &lt;ol&gt;
        &lt;li&gt;&lt;a href=#determining-the-character-encoding&gt;&lt;span class=secno&gt;12.2.2.1 &lt;/span&gt;Determining the character encoding&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#character-encodings-0&gt;&lt;span class=secno&gt;12.2.2.2 &lt;/span&gt;Character encodings&lt;/a&gt;&lt;/li&gt;
@@ -13639,7 +13639,7 @@
 
     &lt;p&gt;If the document has an &lt;a href=#active-parser&gt;active parser&lt;/a&gt; that isn't a
     &lt;a href=#script-created-parser&gt;script-created parser&lt;/a&gt;, and the &lt;a href=#insertion-point&gt;insertion
-    point&lt;/a&gt; associated with that parser's &lt;a href=#the-input-stream&gt;input
+    point&lt;/a&gt; associated with that parser's &lt;a href=#input-stream&gt;input
     stream&lt;/a&gt; is not undefined (that is, it &lt;em&gt;does&lt;/em&gt; point to
     somewhere in the input stream), then the method does
     nothing. Abort these steps and return the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
@@ -13783,7 +13783,7 @@
    entry.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Finally, set the &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt; to point at
-   just before the end of the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; (which at this
+   just before the end of the &lt;a href=#input-stream&gt;input stream&lt;/a&gt; (which at this
    point will be empty).&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; on which the method was
@@ -13833,7 +13833,7 @@
    with the document, then abort these steps.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Insert an &lt;a href=#explicit-eof-character&gt;explicit &quot;EOF&quot; character&lt;/a&gt; at the end
-   of the parser's &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt;.&lt;/li&gt;
+   of the parser's &lt;a href=#input-stream&gt;input stream&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If there is a &lt;a href=#pending-parsing-blocking-script&gt;pending parsing-blocking script&lt;/a&gt;,
    then abort these steps.&lt;/li&gt;
@@ -13922,14 +13922,14 @@
     the user &lt;a href=#refused-to-allow-the-document-to-be-unloaded&gt;refused to allow the document to be
     unloaded&lt;/a&gt;, then abort these steps. Otherwise, the
     &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt; will point at just before the end of
-    the (empty) &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt;.&lt;/p&gt;
+    the (empty) &lt;a href=#input-stream&gt;input stream&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Insert the string consisting of the concatenation of all the
-    arguments to the method into the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; just
+    arguments to the method into the &lt;a href=#input-stream&gt;input stream&lt;/a&gt; just
     before the &lt;a href=#insertion-point&gt;insertion point&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
@@ -64273,12 +64273,12 @@
   an &lt;a href=#html-documents title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt;, set its &lt;a href=#concept-document-content-type title=concept-document-content-type&gt;content type&lt;/a&gt; to &quot;&lt;code title=&quot;&quot;&gt;text/html&lt;/code&gt;&quot;, create an &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt;, and
   associate it with the document. Each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that the &lt;a href=#networking-task-source&gt;networking task
   source&lt;/a&gt; places on the &lt;a href=#task-queue&gt;task queue&lt;/a&gt; while the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; runs must then fill the
-  parser's &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; with the fetched bytes and cause
-  the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; to perform the appropriate processing
-  of the input stream.&lt;/p&gt;
+  parser's &lt;a href=#the-input-byte-stream&gt;input byte stream&lt;/a&gt; with the fetched bytes and
+  cause the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; to perform the appropriate
+  processing of the input stream.&lt;/p&gt;
 
-  &lt;p class=note&gt;The &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; converts bytes into
-  characters for use in the &lt;a href=#tokenization title=tokenization&gt;tokenizer&lt;/a&gt;. This process relies, in part,
+  &lt;p class=note&gt;The &lt;a href=#the-input-byte-stream&gt;input byte stream&lt;/a&gt; converts bytes
+  into characters for use in the &lt;a href=#tokenization title=tokenization&gt;tokenizer&lt;/a&gt;. This process relies, in part,
   on character encoding information found in the real &lt;a href=#content-type title=Content-Type&gt;Content-Type metadata&lt;/a&gt; of the resource;
   the &quot;sniffed type&quot; is not used for this purpose.&lt;/p&gt;
 
@@ -64377,9 +64377,9 @@
   state&lt;/a&gt;. Each &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that the
   &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; places on the &lt;a href=#task-queue&gt;task
   queue&lt;/a&gt; while the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt;
-  runs must then fill the parser's &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; with the
-  fetched bytes and cause the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; to perform the
-  appropriate processing of the input stream.&lt;/p&gt;
+  runs must then fill the parser's &lt;a href=#the-input-byte-stream&gt;input byte stream&lt;/a&gt; with
+  the fetched bytes and cause the &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; to perform
+  the appropriate processing of the input stream.&lt;/p&gt;
 
   &lt;p&gt;The rules for how to convert the bytes of the plain text document
   into actual characters, and the rules for actually rendering the
@@ -81111,13 +81111,13 @@
 
   &lt;h4 id=overview-of-the-parsing-model&gt;&lt;span class=secno&gt;12.2.1 &lt;/span&gt;Overview of the parsing model&lt;/h4&gt;
 
-  &lt;p class=overview&gt;&lt;object data=images/parsing-model-overview.svg height=450 width=345&gt;&lt;img alt=&quot;&quot; height=450 src=<A HREF="http://images.whatwg.org/parsing-model-overview.png">http://images.whatwg.org/parsing-model-overview.png</A> width=345&gt;&lt;/object&gt;&lt;/p&gt;
+  &lt;p class=overview&gt;&lt;object data=images/parsing-model-overview.svg height=535 width=345&gt;&lt;img alt=&quot;&quot; height=450 src=<A HREF="http://images.whatwg.org/parsing-model-overview.png">http://images.whatwg.org/parsing-model-overview.png</A> width=345&gt;&lt;/object&gt;&lt;/p&gt;
 
   &lt;p&gt;The input to the HTML parsing process consists of a stream of
-  Unicode code points, which is passed through a
-  &lt;a href=#tokenization&gt;tokenization&lt;/a&gt; stage followed by a &lt;a href=#tree-construction&gt;tree
-  construction&lt;/a&gt; stage. The output is a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
-  object.&lt;/p&gt;
+  &lt;a href=#unicode-code-point title=&quot;Unicode code point&quot;&gt;Unicode code points&lt;/a&gt;, which
+  is passed through a &lt;a href=#tokenization&gt;tokenization&lt;/a&gt; stage followed by a
+  &lt;a href=#tree-construction&gt;tree construction&lt;/a&gt; stage. The output is a
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
   &lt;p class=note&gt;Implementations that &lt;a href=#non-scripted&gt;do not
   support scripting&lt;/a&gt; do not have to actually create a DOM
@@ -81157,22 +81157,51 @@
   &lt;/div&gt;
 
 
+
   &lt;div class=impl&gt;
 
-  &lt;h4 id=the-input-stream&gt;&lt;span class=secno&gt;12.2.2 &lt;/span&gt;The &lt;dfn&gt;input stream&lt;/dfn&gt;&lt;/h4&gt;
+  &lt;h4 id=the-input-byte-stream&gt;&lt;span class=secno&gt;12.2.2 &lt;/span&gt;The &lt;dfn&gt;input byte stream&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;The stream of Unicode code points that comprises the input to the
   tokenization stage will be initially seen by the user agent as a
   stream of bytes (typically coming over the network or from the local
   file system). The bytes encode the actual characters according to a
-  particular &lt;em&gt;character encoding&lt;/em&gt;, which the user agent must
-  use to decode the bytes into characters.&lt;/p&gt;
+  particular &lt;i&gt;character encoding&lt;/i&gt;, which the user agent must use
+  to decode the bytes into characters.&lt;/p&gt;
 
   &lt;p class=note&gt;For XML documents, the algorithm user agents must
   use to determine the character encoding is given by the XML
   specification. This section does not apply to XML documents. &lt;a href=#refsXML&gt;[XML]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;The &lt;a href=#encoding-sniffing-algorithm&gt;encoding sniffing algorithm&lt;/a&gt; defined below is
+  used to determine the character encoding.&lt;/p&gt;
 
+  &lt;p&gt;Given an encoding, the bytes in the &lt;a href=#the-input-byte-stream&gt;input byte
+  stream&lt;/a&gt; must be converted to Unicode code points for the
+  tokenizer's &lt;a href=#input-stream&gt;input stream&lt;/a&gt;, as described by the rules for
+  that encoding, except that the leading U+FEFF BYTE ORDER MARK
+  character, if any, must not be stripped by the encoding layer (it is
+  stripped by the rule below).&lt;/p&gt; &lt;!-- this is to prevent two leading
+  BOMs from being both stripped, once by the decoder, and once by the
+  parser --&gt;
+
+  &lt;p&gt;Bytes or sequences of bytes in the original byte stream that
+  could not be converted to Unicode code points must be converted to
+  U+FFFD REPLACEMENT CHARACTERs. Specifically, if the encoding is
+  UTF-8, the bytes must be &lt;a href=#decoded-as-utf-8,-with-error-handling title=&quot;decoded as UTF-8, with error
+  handling&quot;&gt;decoded with the error handling&lt;/a&gt; defined in this
+  specification.&lt;/p&gt;
+
+  &lt;p class=note&gt;Bytes or sequences of bytes in the original byte
+  stream that did not conform to the encoding specification (e.g.
+  invalid UTF-8 byte sequences in a UTF-8 input byte stream) are
+  errors that conformance checkers are expected to report.&lt;/p&gt;
+
+  &lt;p&gt;Any byte or sequence of bytes in the original byte stream that is
+  &lt;a href=#misinterpreted-for-compatibility&gt;misinterpreted for compatibility&lt;/a&gt; is a &lt;a href=#parse-error&gt;parse
+  error&lt;/a&gt;.&lt;/p&gt;
+
+
   &lt;h5 id=determining-the-character-encoding&gt;&lt;span class=secno&gt;12.2.2.1 &lt;/span&gt;Determining the character encoding&lt;/h5&gt;
 
   &lt;p&gt;In some cases, it might be impractical to unambiguously determine
@@ -81428,7 +81457,7 @@
   &lt;/ol&gt;&lt;p&gt;The &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt; must immediately
   be set to the value returned from this algorithm, at the same time
   as the user agent uses the returned value to select the decoder to
-  use for the input stream.&lt;/p&gt;
+  use for the input byte stream.&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;When an algorithm requires a user agent to &lt;dfn id=prescan-a-byte-stream-to-determine-its-encoding&gt;prescan a byte
   stream to determine its encoding&lt;/dfn&gt;, given some defined &lt;var title=&quot;&quot;&gt;end condition&lt;/var&gt;, then it must run the following steps.
@@ -81438,7 +81467,7 @@
   &lt;ol&gt;&lt;li&gt;
 
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; be a pointer to a byte in the
-    input stream, initially pointing at the first byte. If at any
+    input byte stream, initially pointing at the first byte. If at any
     point during these steps the user agent either runs out of bytes
     or reaches its &lt;var title=&quot;&quot;&gt;end condition&lt;/var&gt;, then abort the
     &lt;a href=#prescan-a-byte-stream-to-determine-its-encoding&gt;prescan a byte stream to determine its encoding&lt;/a&gt;
@@ -81575,8 +81604,8 @@
     &lt;/dl&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;i&gt;Next byte&lt;/i&gt;: Move &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; so it
-   points at the next byte in the input stream, and return to the step
-   above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
+   points at the next byte in the input byte stream, and return to the
+   step above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the &lt;a href=#prescan-a-byte-stream-to-determine-its-encoding&gt;prescan a byte stream to determine its
   encoding&lt;/a&gt; algorithm says to &lt;dfn id=concept-get-attributes-when-sniffing title=concept-get-attributes-when-sniffing&gt;get an attribute&lt;/dfn&gt;,
@@ -81851,32 +81880,12 @@
 
   &lt;h5 id=preprocessing-the-input-stream&gt;&lt;span class=secno&gt;12.2.2.3 &lt;/span&gt;Preprocessing the input stream&lt;/h5&gt;
 
-  &lt;p&gt;Given an encoding, the bytes in the input stream must be
-  converted to Unicode code points for the tokenizer, as described by
-  the rules for that encoding, except that the leading U+FEFF BYTE
-  ORDER MARK character, if any, must not be stripped by the encoding
-  layer (it is stripped by the rule below).&lt;/p&gt; &lt;!-- this is to
-  prevent two leading BOMs from being both stripped, once by the
-  decoder, and once by the parser --&gt;
+  &lt;p&gt;The &lt;dfn id=input-stream&gt;input stream&lt;/dfn&gt; consists of the characters pushed
+  into it as the &lt;a href=#the-input-byte-stream&gt;input byte stream&lt;/a&gt; is decoded or from the
+  various APIs that directly manipulate the input stream.&lt;/p&gt;
 
-  &lt;p&gt;Bytes or sequences of bytes in the original byte stream that
-  could not be converted to Unicode code points must be converted to
-  U+FFFD REPLACEMENT CHARACTERs. Specifically, if the encoding is
-  UTF-8, the bytes must be &lt;a href=#decoded-as-utf-8,-with-error-handling title=&quot;decoded as UTF-8, with error
-  handling&quot;&gt;decoded with the error handling&lt;/a&gt; defined in this
-  specification.&lt;/p&gt;
-
-  &lt;p class=note&gt;Bytes or sequences of bytes in the original byte
-  stream that did not conform to the encoding specification
-  (e.g. invalid UTF-8 byte sequences in a UTF-8 input stream) are
-  errors that conformance checkers are expected to report.&lt;/p&gt;
-
-  &lt;p&gt;Any byte or sequence of bytes in the original byte stream that is
-  &lt;a href=#misinterpreted-for-compatibility&gt;misinterpreted for compatibility&lt;/a&gt; is a &lt;a href=#parse-error&gt;parse
-  error&lt;/a&gt;.&lt;/p&gt;
-
   &lt;p&gt;One leading U+FEFF BYTE ORDER MARK character must be ignored if
-  any are present.&lt;/p&gt;
+  any are present in the &lt;a href=#input-stream&gt;input stream&lt;/a&gt;.&lt;/p&gt;
 
   &lt;p class=note&gt;The requirement to strip a U+FEFF BYTE ORDER MARK
   character regardless of whether that character was used to determine
@@ -81898,18 +81907,18 @@
   undefined Unicode characters (noncharacters).&lt;/p&gt;
 
   &lt;p&gt;U+000D CARRIAGE RETURN (CR) characters and U+000A LINE FEED (LF)
-  characters are treated specially. Any CR characters that are
-  followed by LF characters must be removed, and any CR characters not
-  followed by LF characters must be converted to LF characters. Thus,
-  newlines in HTML DOMs are represented by LF characters, and there
-  are never any CR characters in the input to the
-  &lt;a href=#tokenization&gt;tokenization&lt;/a&gt; stage.&lt;/p&gt;
+  characters are treated specially. All CR characters must be
+  converted to LF characters, and any LF characters that immediately
+  follow a CR character must be ignored. Thus, newlines in HTML DOMs
+  are represented by LF characters, and there are never any CR
+  characters in the input to the &lt;a href=#tokenization&gt;tokenization&lt;/a&gt; stage.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=next-input-character&gt;next input character&lt;/dfn&gt; is the first character in the
-  input stream that has not yet been &lt;dfn id=consumed&gt;consumed&lt;/dfn&gt;. Initially,
-  the &lt;i&gt;&lt;a href=#next-input-character&gt;next input character&lt;/a&gt;&lt;/i&gt; is the first character in the
-  input. The &lt;dfn id=current-input-character&gt;current input character&lt;/dfn&gt; is the last character
-  to have been &lt;i&gt;&lt;a href=#consumed&gt;consumed&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
+  &lt;a href=#input-stream&gt;input stream&lt;/a&gt; that has not yet been &lt;dfn id=consumed&gt;consumed&lt;/dfn&gt;
+  or explicit ignored by the requirements in this section. Initially,
+  the &lt;i&gt;&lt;a href=#next-input-character&gt;next input character&lt;/a&gt;&lt;/i&gt; is the first character in the input.
+  The &lt;dfn id=current-input-character&gt;current input character&lt;/dfn&gt; is the last character to have
+  been &lt;i&gt;&lt;a href=#consumed&gt;consumed&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=insertion-point&gt;insertion point&lt;/dfn&gt; is the position (just before a
   character or just before the end of the input stream) where content
@@ -81920,9 +81929,9 @@
   undefined.&lt;/p&gt;
 
   &lt;p&gt;The &quot;EOF&quot; character in the tables below is a conceptual character
-  representing the end of the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt;. If the parser
+  representing the end of the &lt;a href=#input-stream&gt;input stream&lt;/a&gt;. If the parser
   is a &lt;a href=#script-created-parser&gt;script-created parser&lt;/a&gt;, then the end of the
-  &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; is reached when an &lt;dfn id=explicit-eof-character&gt;explicit &quot;EOF&quot;
+  &lt;a href=#input-stream&gt;input stream&lt;/a&gt; is reached when an &lt;dfn id=explicit-eof-character&gt;explicit &quot;EOF&quot;
   character&lt;/dfn&gt; (inserted by the &lt;code title=dom-document-close&gt;&lt;a href=#dom-document-close&gt;document.close()&lt;/a&gt;&lt;/code&gt; method) is
   consumed. Otherwise, the &quot;EOF&quot; character is not a real character in
   the stream, but rather the lack of any further characters.&lt;/p&gt;
@@ -88477,7 +88486,7 @@
   &lt;/ol&gt;&lt;p&gt;When the user agent is to &lt;dfn id=abort-a-parser&gt;abort a parser&lt;/dfn&gt;, it must run
   the following steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Throw away any pending content in the &lt;a href=#the-input-stream&gt;input
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Throw away any pending content in the &lt;a href=#input-stream&gt;input
    stream&lt;/a&gt;, and discard any future content that would have been
    added to it.&lt;/li&gt;
 
@@ -89291,7 +89300,7 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;Place into the &lt;a href=#the-input-stream&gt;input stream&lt;/a&gt; for the &lt;a href=#html-parser&gt;HTML
+    &lt;p&gt;Place into the &lt;a href=#input-stream&gt;input stream&lt;/a&gt; for the &lt;a href=#html-parser&gt;HTML
     parser&lt;/a&gt; just created the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;. The
     encoding &lt;a href=#concept-encoding-confidence title=concept-encoding-confidence&gt;confidence&lt;/a&gt; is
     &lt;i&gt;irrelevant&lt;/i&gt;.&lt;/p&gt;

Modified: source
===================================================================
--- source	2012-02-13 21:06:58 UTC (rev 6990)
+++ source	2012-02-13 22:48:10 UTC (rev 6991)
@@ -75132,12 +75132,12 @@
   title=&quot;concept-task&quot;&gt;task&lt;/span&gt; that the &lt;span&gt;networking task
   source&lt;/span&gt; places on the &lt;span&gt;task queue&lt;/span&gt; while the &lt;span
   title=&quot;fetch&quot;&gt;fetching algorithm&lt;/span&gt; runs must then fill the
-  parser's &lt;span&gt;input stream&lt;/span&gt; with the fetched bytes and cause
-  the &lt;span&gt;HTML parser&lt;/span&gt; to perform the appropriate processing
-  of the input stream.&lt;/p&gt;
+  parser's &lt;span&gt;input byte stream&lt;/span&gt; with the fetched bytes and
+  cause the &lt;span&gt;HTML parser&lt;/span&gt; to perform the appropriate
+  processing of the input stream.&lt;/p&gt;
 
-  &lt;p class=&quot;note&quot;&gt;The &lt;span&gt;input stream&lt;/span&gt; converts bytes into
-  characters for use in the &lt;span
+  &lt;p class=&quot;note&quot;&gt;The &lt;span&gt;input byte stream&lt;/span&gt; converts bytes
+  into characters for use in the &lt;span
   title=&quot;tokenization&quot;&gt;tokenizer&lt;/span&gt;. This process relies, in part,
   on character encoding information found in the real &lt;span
   title=&quot;Content-Type&quot;&gt;Content-Type metadata&lt;/span&gt; of the resource;
@@ -75249,9 +75249,9 @@
   state&lt;/span&gt;. Each &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; that the
   &lt;span&gt;networking task source&lt;/span&gt; places on the &lt;span&gt;task
   queue&lt;/span&gt; while the &lt;span title=&quot;fetch&quot;&gt;fetching algorithm&lt;/span&gt;
-  runs must then fill the parser's &lt;span&gt;input stream&lt;/span&gt; with the
-  fetched bytes and cause the &lt;span&gt;HTML parser&lt;/span&gt; to perform the
-  appropriate processing of the input stream.&lt;/p&gt;
+  runs must then fill the parser's &lt;span&gt;input byte stream&lt;/span&gt; with
+  the fetched bytes and cause the &lt;span&gt;HTML parser&lt;/span&gt; to perform
+  the appropriate processing of the input stream.&lt;/p&gt;
 
   &lt;p&gt;The rules for how to convert the bytes of the plain text document
   into actual characters, and the rules for actually rendering the
@@ -94069,13 +94069,13 @@
 
   &lt;h4&gt;Overview of the parsing model&lt;/h4&gt;
 
-  &lt;p class=&quot;overview&quot;&gt;&lt;object data=&quot;images/parsing-model-overview.svg&quot; width=&quot;345&quot; height=&quot;450&quot;&gt;&lt;img src=&quot;images/parsing-model-overview.png&quot; width=&quot;345&quot; height=&quot;450&quot; alt=&quot;&quot;&gt;&lt;/object&gt;&lt;/p&gt;
+  &lt;p class=&quot;overview&quot;&gt;&lt;object data=&quot;images/parsing-model-overview.svg&quot; width=&quot;345&quot; height=&quot;535&quot;&gt;&lt;img src=&quot;images/parsing-model-overview.png&quot; width=&quot;345&quot; height=&quot;450&quot; alt=&quot;&quot;&gt;&lt;/object&gt;&lt;/p&gt;
 
   &lt;p&gt;The input to the HTML parsing process consists of a stream of
-  Unicode code points, which is passed through a
-  &lt;span&gt;tokenization&lt;/span&gt; stage followed by a &lt;span&gt;tree
-  construction&lt;/span&gt; stage. The output is a &lt;code&gt;Document&lt;/code&gt;
-  object.&lt;/p&gt;
+  &lt;span title=&quot;Unicode code point&quot;&gt;Unicode code points&lt;/span&gt;, which
+  is passed through a &lt;span&gt;tokenization&lt;/span&gt; stage followed by a
+  &lt;span&gt;tree construction&lt;/span&gt; stage. The output is a
+  &lt;code&gt;Document&lt;/code&gt; object.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;Implementations that &lt;a href=&quot;#non-scripted&quot;&gt;do not
   support scripting&lt;/a&gt; do not have to actually create a DOM
@@ -94116,23 +94116,52 @@
   &lt;/div&gt;
 
 
+
   &lt;div class=&quot;impl&quot;&gt;
 
-  &lt;h4&gt;The &lt;dfn&gt;input stream&lt;/dfn&gt;&lt;/h4&gt;
+  &lt;h4&gt;The &lt;dfn&gt;input byte stream&lt;/dfn&gt;&lt;/h4&gt;
 
   &lt;p&gt;The stream of Unicode code points that comprises the input to the
   tokenization stage will be initially seen by the user agent as a
   stream of bytes (typically coming over the network or from the local
   file system). The bytes encode the actual characters according to a
-  particular &lt;em&gt;character encoding&lt;/em&gt;, which the user agent must
-  use to decode the bytes into characters.&lt;/p&gt;
+  particular &lt;i&gt;character encoding&lt;/i&gt;, which the user agent must use
+  to decode the bytes into characters.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;For XML documents, the algorithm user agents must
   use to determine the character encoding is given by the XML
   specification. This section does not apply to XML documents. &lt;a
   href=&quot;#refsXML&quot;&gt;[XML]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;The &lt;span&gt;encoding sniffing algorithm&lt;/span&gt; defined below is
+  used to determine the character encoding.&lt;/p&gt;
 
+  &lt;p&gt;Given an encoding, the bytes in the &lt;span&gt;input byte
+  stream&lt;/span&gt; must be converted to Unicode code points for the
+  tokenizer's &lt;span&gt;input stream&lt;/span&gt;, as described by the rules for
+  that encoding, except that the leading U+FEFF BYTE ORDER MARK
+  character, if any, must not be stripped by the encoding layer (it is
+  stripped by the rule below).&lt;/p&gt; &lt;!-- this is to prevent two leading
+  BOMs from being both stripped, once by the decoder, and once by the
+  parser --&gt;
+
+  &lt;p&gt;Bytes or sequences of bytes in the original byte stream that
+  could not be converted to Unicode code points must be converted to
+  U+FFFD REPLACEMENT CHARACTERs. Specifically, if the encoding is
+  UTF-8, the bytes must be &lt;span title=&quot;decoded as UTF-8, with error
+  handling&quot;&gt;decoded with the error handling&lt;/span&gt; defined in this
+  specification.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;Bytes or sequences of bytes in the original byte
+  stream that did not conform to the encoding specification (e.g.
+  invalid UTF-8 byte sequences in a UTF-8 input byte stream) are
+  errors that conformance checkers are expected to report.&lt;/p&gt;
+
+  &lt;p&gt;Any byte or sequence of bytes in the original byte stream that is
+  &lt;span&gt;misinterpreted for compatibility&lt;/span&gt; is a &lt;span&gt;parse
+  error&lt;/span&gt;.&lt;/p&gt;
+
+
   &lt;h5&gt;Determining the character encoding&lt;/h5&gt;
 
   &lt;p&gt;In some cases, it might be impractical to unambiguously determine
@@ -94451,7 +94480,7 @@
   &lt;p&gt;The &lt;span&gt;document's character encoding&lt;/span&gt; must immediately
   be set to the value returned from this algorithm, at the same time
   as the user agent uses the returned value to select the decoder to
-  use for the input stream.&lt;/p&gt;
+  use for the input byte stream.&lt;/p&gt;
 
   &lt;hr&gt;
 
@@ -94466,7 +94495,7 @@
    &lt;li&gt;
 
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; be a pointer to a byte in the
-    input stream, initially pointing at the first byte. If at any
+    input byte stream, initially pointing at the first byte. If at any
     point during these steps the user agent either runs out of bytes
     or reaches its &lt;var title=&quot;&quot;&gt;end condition&lt;/var&gt;, then abort the
     &lt;span&gt;prescan a byte stream to determine its encoding&lt;/span&gt;
@@ -94630,8 +94659,8 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;i&gt;Next byte&lt;/i&gt;: Move &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; so it
-   points at the next byte in the input stream, and return to the step
-   above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
+   points at the next byte in the input byte stream, and return to the
+   step above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;
 
@@ -94970,32 +94999,12 @@
 
   &lt;h5&gt;Preprocessing the input stream&lt;/h5&gt;
 
-  &lt;p&gt;Given an encoding, the bytes in the input stream must be
-  converted to Unicode code points for the tokenizer, as described by
-  the rules for that encoding, except that the leading U+FEFF BYTE
-  ORDER MARK character, if any, must not be stripped by the encoding
-  layer (it is stripped by the rule below).&lt;/p&gt; &lt;!-- this is to
-  prevent two leading BOMs from being both stripped, once by the
-  decoder, and once by the parser --&gt;
+  &lt;p&gt;The &lt;dfn&gt;input stream&lt;/dfn&gt; consists of the characters pushed
+  into it as the &lt;span&gt;input byte stream&lt;/span&gt; is decoded or from the
+  various APIs that directly manipulate the input stream.&lt;/p&gt;
 
-  &lt;p&gt;Bytes or sequences of bytes in the original byte stream that
-  could not be converted to Unicode code points must be converted to
-  U+FFFD REPLACEMENT CHARACTERs. Specifically, if the encoding is
-  UTF-8, the bytes must be &lt;span title=&quot;decoded as UTF-8, with error
-  handling&quot;&gt;decoded with the error handling&lt;/span&gt; defined in this
-  specification.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;Bytes or sequences of bytes in the original byte
-  stream that did not conform to the encoding specification
-  (e.g. invalid UTF-8 byte sequences in a UTF-8 input stream) are
-  errors that conformance checkers are expected to report.&lt;/p&gt;
-
-  &lt;p&gt;Any byte or sequence of bytes in the original byte stream that is
-  &lt;span&gt;misinterpreted for compatibility&lt;/span&gt; is a &lt;span&gt;parse
-  error&lt;/span&gt;.&lt;/p&gt;
-
   &lt;p&gt;One leading U+FEFF BYTE ORDER MARK character must be ignored if
-  any are present.&lt;/p&gt;
+  any are present in the &lt;span&gt;input stream&lt;/span&gt;.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;The requirement to strip a U+FEFF BYTE ORDER MARK
   character regardless of whether that character was used to determine
@@ -95017,18 +95026,18 @@
   undefined Unicode characters (noncharacters).&lt;/p&gt;
 
   &lt;p&gt;U+000D CARRIAGE RETURN (CR) characters and U+000A LINE FEED (LF)
-  characters are treated specially. Any CR characters that are
-  followed by LF characters must be removed, and any CR characters not
-  followed by LF characters must be converted to LF characters. Thus,
-  newlines in HTML DOMs are represented by LF characters, and there
-  are never any CR characters in the input to the
-  &lt;span&gt;tokenization&lt;/span&gt; stage.&lt;/p&gt;
+  characters are treated specially. All CR characters must be
+  converted to LF characters, and any LF characters that immediately
+  follow a CR character must be ignored. Thus, newlines in HTML DOMs
+  are represented by LF characters, and there are never any CR
+  characters in the input to the &lt;span&gt;tokenization&lt;/span&gt; stage.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn&gt;next input character&lt;/dfn&gt; is the first character in the
-  input stream that has not yet been &lt;dfn&gt;consumed&lt;/dfn&gt;. Initially,
-  the &lt;i&gt;next input character&lt;/i&gt; is the first character in the
-  input. The &lt;dfn&gt;current input character&lt;/dfn&gt; is the last character
-  to have been &lt;i&gt;consumed&lt;/i&gt;.&lt;/p&gt;
+  &lt;span&gt;input stream&lt;/span&gt; that has not yet been &lt;dfn&gt;consumed&lt;/dfn&gt;
+  or explicit ignored by the requirements in this section. Initially,
+  the &lt;i&gt;next input character&lt;/i&gt; is the first character in the input.
+  The &lt;dfn&gt;current input character&lt;/dfn&gt; is the last character to have
+  been &lt;i&gt;consumed&lt;/i&gt;.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn&gt;insertion point&lt;/dfn&gt; is the position (just before a
   character or just before the end of the input stream) where content


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013855.html">[html5] r6990 - [e] (0) Factor out the prescan algorithm for reuse	in other specs. Fixing https: [...]
</A></li>
	<LI>Next message: <A HREF="013857.html">[html5] r6992 - [e] (0) Move a section so that the character	encoding requirements are closer to [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13856">[ date ]</a>
              <a href="thread.html#13856">[ thread ]</a>
              <a href="subject.html#13856">[ subject ]</a>
              <a href="author.html#13856">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
