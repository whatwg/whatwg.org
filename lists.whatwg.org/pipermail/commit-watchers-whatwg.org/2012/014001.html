<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r7136 - [giow] (0) Add a feature to appcache to make it	possible to mark a cache as pref [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7136%20-%20%5Bgiow%5D%20%280%29%20Add%20a%20feature%20to%20appcache%20to%20make%20it%0A%09possible%20to%20mark%20a%20cache%20as%20pref%20%5B...%5D&In-Reply-To=%3C20120614224813.B31161CFC024%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014000.html">
   <LINK REL="Next"  HREF="014002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r7136 - [giow] (0) Add a feature to appcache to make it	possible to mark a cache as pref [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7136%20-%20%5Bgiow%5D%20%280%29%20Add%20a%20feature%20to%20appcache%20to%20make%20it%0A%09possible%20to%20mark%20a%20cache%20as%20pref%20%5B...%5D&In-Reply-To=%3C20120614224813.B31161CFC024%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r7136 - [giow] (0) Add a feature to appcache to make it	possible to mark a cache as pref [...]">whatwg at whatwg.org
       </A><BR>
    <I>Thu Jun 14 15:48:13 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="014000.html">[html5] r7135 - [e] (0) Fix some typos or copypasta. Fixing	https://www.w3.org/Bugs/Public/show_ [...]
</A></li>
        <LI>Next message: <A HREF="014002.html">[html5] r7137 - [e] (0) fix json error Affected topics: HTML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14001">[ date ]</a>
              <a href="thread.html#14001">[ thread ]</a>
              <a href="subject.html#14001">[ subject ]</a>
              <a href="author.html#14001">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2012-06-14 15:48:12 -0700 (Thu, 14 Jun 2012)
New Revision: 7136

Modified:
   complete.html
   index
   source
Log:
[giow] (0) Add a feature to appcache to make it possible to mark a cache as preferring online resources than cached resources.
Affected topics: HTML, Offline Web Applications

Modified: complete.html
===================================================================
--- complete.html	2012-06-14 20:56:53 UTC (rev 7135)
+++ complete.html	2012-06-14 22:48:12 UTC (rev 7136)
@@ -1542,6 +1542,7 @@
    &lt;li&gt;Some predefined &lt;a href=#mdvocabs&gt;Microdata vocabularies&lt;/a&gt;.&lt;/li&gt;
    &lt;li&gt;The &lt;code&gt;&lt;a href=#the-data-element&gt;data&lt;/a&gt;&lt;/code&gt; element for marking up machine-readable data.&lt;/li&gt;&lt;!--DATA--&gt;&lt;!--FORK--&gt;
    &lt;li&gt;The &lt;code title=scheme-http+aes&gt;&lt;a href=#http+aes-scheme&gt;http+aes:&lt;/a&gt;&lt;/code&gt; and &lt;code title=scheme-http+aes&gt;&lt;a href=#http+aes-scheme&gt;https+aes:&lt;/a&gt;&lt;/code&gt; schemes.&lt;/li&gt;&lt;!--FORK--&gt;
+   &lt;li&gt;The &lt;a href=#application-cache&gt;application cache&lt;/a&gt; feature's &lt;a href=#concept-appcache-mode-prefer-online title=concept-appcache-mode-prefer-online&gt;prefer-online&lt;/a&gt; mode.&lt;/li&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
   &lt;/ul&gt;&lt;!--
   &lt;p&gt;Features that are part of the WHATWG HTML Living Standard
   specification but that are currently published as separate
@@ -36507,7 +36508,7 @@
 
   &lt;!-- this is filler to make sure the TCP packet boundary doesn't fall in the middle of one of the NCRs below --&gt;
   &lt;!-- (because otherwise the parser in anolis screws it up) --&gt;
-  &lt;p&gt;&lt;img alt=&quot;The top of the em square is roughly at the top of the glyphs in a font, the hanging baseline is where some glyphs like &#2310; are anchored, the middle is half-way between the top of the em square and the bottom of the em square, the alphabetic baseline is where characters like &quot; height=300 src=<A HREF="http://images.whatwg.org/baselines.png">http://images.whatwg.org/baselines.png</A> width=738&gt;x00C1;, &yuml;, f, and &Omega; are anchored, the ideographic baseline is where glyphs like &#31169; and &#36948; are anchored, and the bottom of the em square is roughly at the bottom of the glyphs in a font. The top and bottom of the bounding box can be far from these baselines, due to glyphs extending far outside the em square.&quot;&gt;&lt;/p&gt;
+  &lt;p&gt;&lt;img alt=&quot;The top of the em square is roughly at the top of the glyphs in a font, the hanging baseline is where some glyphs like &#2310; are anchored, the middle is half-way between the top of the em square and the bottom of the em square, the alphabetic baseline is where characters like &Aacute;, &yuml;, f, and &Omega; are anchored, the ideographic baseline is where glyphs like &#31169; and &#36948; are anchored, and the bottom of the em square is roughly at the bottom of the glyphs in a font. The top and bottom of the bounding box can be far from these baselines, due to glyphs extending far outside the em square.&quot; height=300 src=<A HREF="http://images.whatwg.org/baselines.png">http://images.whatwg.org/baselines.png</A> width=738&gt;&lt;/p&gt;
 
   &lt;p&gt;The keywords map to these alignment points as follows:&lt;/p&gt;
 
@@ -67795,9 +67796,10 @@
     application caches&lt;/a&gt; that are identified by a URL with the
     &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the URL in question, and that have
     this URL as one of their entries, excluding entries marked as
-    &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, then get
-    the resource from the &lt;a href=#concept-appcache-selection title=concept-appcache-selection&gt;most appropriate application
-    cache&lt;/a&gt; of those that match.&lt;/p&gt;
+    &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, and whose
+    &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;mode&lt;/a&gt; is &lt;a href=#concept-appcache-mode-fast title=concept-appcache-mode-fast&gt;fast&lt;/a&gt;, then get the
+    resource from the &lt;a href=#concept-appcache-selection title=concept-appcache-selection&gt;most
+    appropriate application cache&lt;/a&gt; of those that match.&lt;/p&gt;
 
     &lt;p class=example&gt;For example, imagine an HTML page with an
     associated application cache displaying an image and a form, where
@@ -67921,8 +67923,43 @@
 
    &lt;/li&gt;
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
    &lt;li&gt;
 
+    &lt;p&gt;If the resource was not fetched from an &lt;a href=#application-cache&gt;application
+    cache&lt;/a&gt;, and was to be fetched using HTTP GET &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt;, and
+
+    there are &lt;a href=#relevant-application-cache title=&quot;relevant application cache&quot;&gt;relevant
+    application caches&lt;/a&gt; that are identified by a URL with the
+    &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the URL in question, and that have
+    this URL as one of their entries, excluding entries marked as
+    &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, and whose
+    &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;mode&lt;/a&gt; is &lt;a href=#concept-appcache-mode-prefer-online title=concept-appcache-mode-prefer-online&gt;prefer-online&lt;/a&gt;,
+    and the user didn't cancel the navigation attempt during the
+    earlier step, and the navigation attempt failed (e.g. the server
+    returned a 4xx or 5xx status code &lt;a href=#concept-http-equivalent-codes title=concept-http-equivalent-codes&gt;or equivalent&lt;/a&gt;, or
+    there was a DNS error), then:&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; be the resource identified by
+    the URL in question from the &lt;a href=#concept-appcache-selection title=concept-appcache-selection&gt;most appropriate application
+    cache&lt;/a&gt; of those that match.&lt;/p&gt; &lt;!-- note that a redirect
+    can never reach this point as it is handled earlier, meaning that
+    a captive portal captures URLs in &quot;prefer-online&quot; caches and you
+    can't ever get to the cached resource of a prefer-online cache if
+    you have a captive portal --&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; is not marked as &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, then the user
+    agent must discard the failed load and instead continue along
+    these steps using &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; as the resource.
+    The user agent may indicate to the user that the original page
+    load failed, and that the page used was a previously cached
+    resource.&lt;/p&gt;
+
+   &lt;/li&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;&lt;i&gt;Resource handling&lt;/i&gt;: If the resource's out-of-band
     metadata (e.g. HTTP headers), not counting any &lt;a href=#content-type title=Content-Type&gt;type information&lt;/a&gt; (such as the
     Content-Type HTTP header), requires some sort of processing that
@@ -69392,7 +69429,7 @@
      &lt;td&gt; The user agent will try fetching the files again momentarily.
   &lt;/table&gt;&lt;div class=impl&gt;
 
-  &lt;h4 id=appcache&gt;&lt;span class=secno&gt;6.7.2 &lt;/span&gt;Application caches&lt;/h4&gt;
+  &lt;h4 id=appcache&gt;&lt;span class=secno&gt;6.7.2 &lt;/span&gt;Application caches&lt;/h4&gt; &lt;!--APPCACHE--&gt;
 
   &lt;p&gt;An &lt;dfn id=application-cache&gt;application cache&lt;/dfn&gt; is a set of cached resources
   consisting of:&lt;/p&gt;
@@ -69486,6 +69523,21 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;A &lt;dfn id=concept-appcache-mode title=concept-appcache-mode&gt;cache mode flag&lt;/dfn&gt;,
+    which is 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    either
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    in the &lt;dfn id=concept-appcache-mode-fast title=concept-appcache-mode-fast&gt;&lt;i&gt;fast&lt;/i&gt;&lt;/dfn&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    state or the &lt;dfn id=concept-appcache-mode-prefer-online title=concept-appcache-mode-prefer-online&gt;&lt;i&gt;prefer-online&lt;/i&gt;&lt;/dfn&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    state.&lt;/p&gt;
+
+   &lt;/li&gt;
+
   &lt;/ul&gt;&lt;p&gt;Each &lt;a href=#application-cache&gt;application cache&lt;/a&gt; has a &lt;dfn id=concept-appcache-completeness title=concept-appcache-completeness&gt;completeness flag&lt;/dfn&gt;, which is
   either &lt;i&gt;complete&lt;/i&gt; or &lt;i&gt;incomplete&lt;/i&gt;.&lt;/p&gt;
 
@@ -69734,7 +69786,8 @@
 
    &lt;dt&gt;A section header
    &lt;dd&gt;
-    &lt;p&gt;Section headers change the current section. There are three
+
+    &lt;p&gt;Section headers change the current section. There are four
     possible section headers:
 
     &lt;dl&gt;&lt;dt&gt;&lt;code&gt;CACHE:&lt;/code&gt;
@@ -69746,6 +69799,11 @@
      &lt;dt&gt;&lt;code&gt;NETWORK:&lt;/code&gt;
      &lt;dd&gt;Switches to the &lt;dfn id=concept-appcache-manifest-network title=concept-appcache-manifest-network&gt;online whitelist section&lt;/dfn&gt;.
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+     &lt;dt&gt;&lt;code&gt;SETTINGS:&lt;/code&gt;
+     &lt;dd&gt;Switches to the &lt;dfn id=concept-appcache-manifest-settings title=concept-appcache-manifest-settings&gt;settings section&lt;/dfn&gt;.
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
     &lt;/dl&gt;&lt;p&gt;Section header lines must consist of zero or more U+0020 SPACE
     and U+0009 CHARACTER TABULATION (tab) characters, followed by one
     of the names above (including the U+003A COLON character (:))
@@ -69786,6 +69844,27 @@
     and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION
     (tab) characters.&lt;/p&gt;
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    &lt;p&gt;When the current section is the &lt;a href=#concept-appcache-manifest-settings title=concept-appcache-manifest-settings&gt;settings
+    section&lt;/a&gt;, data lines must consist of zero or more U+0020
+    SPACE and U+0009 CHARACTER TABULATION (tab) characters, a &lt;a href=#concept-appcache-manifest-setting title=concept-appcache-manifest-setting&gt;setting&lt;/a&gt;, and then
+    zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
+    characters.&lt;/p&gt;
+
+    &lt;p&gt;Currently only one &lt;dfn id=concept-appcache-manifest-setting title=concept-appcache-manifest-setting&gt;setting&lt;/dfn&gt; is
+    defined:&lt;/p&gt;
+
+    &lt;dl&gt;&lt;dt&gt;The cache mode setting&lt;/dt&gt;
+
+     &lt;dd&gt;This consists of the string &quot;&lt;code title=&quot;&quot;&gt;prefer-online&lt;/code&gt;&quot;. It sets the &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;cache mode&lt;/a&gt; to &lt;a href=#concept-appcache-mode-prefer-online title=concept-appcache-mode-prefer-online&gt;prefer-online&lt;/a&gt;.
+     (The &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;cache mode&lt;/a&gt;
+     defaults to &lt;a href=#concept-appcache-mode-fast title=concept-appcache-mode-fast&gt;fast&lt;/a&gt;.)&lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;p&gt;Within a &lt;a href=#concept-appcache-manifest-settings title=concept-appcache-manifest-settings&gt;settings
+    section&lt;/a&gt;, each &lt;a href=#concept-appcache-manifest-setting title=concept-appcache-manifest-setting&gt;setting&lt;/a&gt; must
+    occur no more than once.&lt;/p&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
 &lt;!--
     &lt;p class=&quot;note&quot;&gt;The URLs in data lines can't be empty strings,
     since those would be relative URLs to the manifest itself. Such
@@ -69870,6 +69949,8 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;online whitelist wildcard flag&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;blocking&lt;/i&gt;. &lt;!--
    concept-appcache-onlinewhitelist-wildcard --&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache mode flag&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;fast&lt;/i&gt;. &lt;!-- concept-appcache-mode-fast --&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; be the decoded text of the
    manifest's byte stream.&lt;/li&gt;
 
@@ -69936,6 +70017,12 @@
    &quot;NETWORK&quot; followed by a U+003A COLON character (:)), then set &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;online whitelist&quot; and jump back to the step
    labeled &quot;start of line&quot;.&lt;/li&gt;
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;SETTINGS:&quot; (the word
+   &quot;SETTINGS&quot; followed by a U+003A COLON character (:)), then set &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;settings&quot; and jump back to the step labeled
+   &quot;start of line&quot;.&lt;/li&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; ends with a U+003A COLON
    character (:), then set &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;unknown&quot; and
    jump back to the step labeled &quot;start of line&quot;.&lt;/li&gt;
@@ -70062,6 +70149,22 @@
 
      &lt;/dd&gt;
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;settings&quot;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains a single token, and
+      that token is a &lt;a href=#case-sensitive&gt;case-sensitive&lt;/a&gt; match for the string
+      &quot;&lt;code title=&quot;&quot;&gt;prefer-online&lt;/code&gt;&quot;, then set &lt;var title=&quot;&quot;&gt;cache mode flag&lt;/var&gt; to &lt;i title=&quot;&quot;&gt;prefer-online&lt;/i&gt;
+      and jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the line is an unsupported setting: do nothing;
+      the line is ignored.&lt;/p&gt;
+
+     &lt;/dd&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
      &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;unknown&quot;&lt;/dt&gt;
 
      &lt;dd&gt;
@@ -70077,8 +70180,9 @@
    reached.)&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; list, the &lt;var title=&quot;&quot;&gt;fallback URLs&lt;/var&gt; mapping, the &lt;var title=&quot;&quot;&gt;online
-   whitelist namespaces&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;online whitelist
-   wildcard flag&lt;/var&gt;.&lt;/li&gt;
+   whitelist namespaces&lt;/var&gt;, the &lt;var title=&quot;&quot;&gt;online whitelist
+   wildcard flag&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;cache mode
+   flag&lt;/var&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;div class=note&gt;
 
@@ -70273,8 +70377,8 @@
     obtaining a list of &lt;a href=#concept-appcache-explicit title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt;, &lt;a href=#concept-appcache-fallback title=concept-appcache-fallback&gt;fallback entries&lt;/a&gt; and the
     &lt;a href=#concept-appcache-fallback-ns title=concept-appcache-fallback-ns&gt;fallback
     namespaces&lt;/a&gt; that map to them, entries for the &lt;a href=#concept-appcache-onlinewhitelist title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt;,
-    and a value for the &lt;a href=#concept-appcache-onlinewhitelist-wildcard title=concept-appcache-onlinewhitelist-wildcard&gt;online whitelist
-    wildcard flag&lt;/a&gt;.&lt;/p&gt;
+    and values for the &lt;a href=#concept-appcache-onlinewhitelist-wildcard title=concept-appcache-onlinewhitelist-wildcard&gt;online whitelist
+    wildcard flag&lt;/a&gt; and the &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;cache mode flag&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p class=note&gt;The &lt;a href=#mime-type&gt;MIME type&lt;/a&gt; of the resource is
     ignored &mdash; it is assumed to be
@@ -70666,6 +70770,8 @@
    &lt;li&gt;&lt;p&gt;Store the value of the new &lt;a href=#concept-appcache-onlinewhitelist-wildcard title=concept-appcache-onlinewhitelist-wildcard&gt;online whitelist
    wildcard flag&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Store the value of the new &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;cache mode flag&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;For each entry in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;'s &lt;a href=#concept-appcache-pending-masters title=concept-appcache-pending-masters&gt;list of pending master
@@ -70968,6 +71074,15 @@
     the &lt;a href=#concept-appcache-master title=concept-appcache-master&gt;master&lt;/a&gt;
     resource.&lt;/p&gt;
 
+    &lt;p&gt;If there are &lt;a href=#relevant-application-cache title=&quot;relevant application cache&quot;&gt;relevant
+    application caches&lt;/a&gt; that are identified by a URL with the
+    &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the URL of &lt;var title=&quot;&quot;&gt;document&lt;/var&gt;, and that have this URL as one of their
+    entries, excluding entries marked as &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, then the user
+    agent should use the &lt;a href=#concept-appcache-selection title=concept-appcache-selection&gt;most
+    appropriate application cache&lt;/a&gt; of those that match as an
+    HTTP cache for any subresource loads. User agents may also have
+    other caches in place that are also honored.&lt;/p&gt;
+
    &lt;/dd&gt;
 
 

Modified: index
===================================================================
--- index	2012-06-14 20:56:53 UTC (rev 7135)
+++ index	2012-06-14 22:48:12 UTC (rev 7136)
@@ -1542,6 +1542,7 @@
    &lt;li&gt;Some predefined &lt;a href=#mdvocabs&gt;Microdata vocabularies&lt;/a&gt;.&lt;/li&gt;
    &lt;li&gt;The &lt;code&gt;&lt;a href=#the-data-element&gt;data&lt;/a&gt;&lt;/code&gt; element for marking up machine-readable data.&lt;/li&gt;&lt;!--DATA--&gt;&lt;!--FORK--&gt;
    &lt;li&gt;The &lt;code title=scheme-http+aes&gt;&lt;a href=#http+aes-scheme&gt;http+aes:&lt;/a&gt;&lt;/code&gt; and &lt;code title=scheme-http+aes&gt;&lt;a href=#http+aes-scheme&gt;https+aes:&lt;/a&gt;&lt;/code&gt; schemes.&lt;/li&gt;&lt;!--FORK--&gt;
+   &lt;li&gt;The &lt;a href=#application-cache&gt;application cache&lt;/a&gt; feature's &lt;a href=#concept-appcache-mode-prefer-online title=concept-appcache-mode-prefer-online&gt;prefer-online&lt;/a&gt; mode.&lt;/li&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
   &lt;/ul&gt;&lt;!--
   &lt;p&gt;Features that are part of the WHATWG HTML Living Standard
   specification but that are currently published as separate
@@ -36507,7 +36508,7 @@
 
   &lt;!-- this is filler to make sure the TCP packet boundary doesn't fall in the middle of one of the NCRs below --&gt;
   &lt;!-- (because otherwise the parser in anolis screws it up) --&gt;
-  &lt;p&gt;&lt;img alt=&quot;The top of the em square is roughly at the top of the glyphs in a font, the hanging baseline is where some glyphs like &#2310; are anchored, the middle is half-way between the top of the em square and the bottom of the em square, the alphabetic baseline is where characters like &quot; height=300 src=<A HREF="http://images.whatwg.org/baselines.png">http://images.whatwg.org/baselines.png</A> width=738&gt;x00C1;, &yuml;, f, and &Omega; are anchored, the ideographic baseline is where glyphs like &#31169; and &#36948; are anchored, and the bottom of the em square is roughly at the bottom of the glyphs in a font. The top and bottom of the bounding box can be far from these baselines, due to glyphs extending far outside the em square.&quot;&gt;&lt;/p&gt;
+  &lt;p&gt;&lt;img alt=&quot;The top of the em square is roughly at the top of the glyphs in a font, the hanging baseline is where some glyphs like &#2310; are anchored, the middle is half-way between the top of the em square and the bottom of the em square, the alphabetic baseline is where characters like &Aacute;, &yuml;, f, and &Omega; are anchored, the ideographic baseline is where glyphs like &#31169; and &#36948; are anchored, and the bottom of the em square is roughly at the bottom of the glyphs in a font. The top and bottom of the bounding box can be far from these baselines, due to glyphs extending far outside the em square.&quot; height=300 src=<A HREF="http://images.whatwg.org/baselines.png">http://images.whatwg.org/baselines.png</A> width=738&gt;&lt;/p&gt;
 
   &lt;p&gt;The keywords map to these alignment points as follows:&lt;/p&gt;
 
@@ -67795,9 +67796,10 @@
     application caches&lt;/a&gt; that are identified by a URL with the
     &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the URL in question, and that have
     this URL as one of their entries, excluding entries marked as
-    &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, then get
-    the resource from the &lt;a href=#concept-appcache-selection title=concept-appcache-selection&gt;most appropriate application
-    cache&lt;/a&gt; of those that match.&lt;/p&gt;
+    &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, and whose
+    &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;mode&lt;/a&gt; is &lt;a href=#concept-appcache-mode-fast title=concept-appcache-mode-fast&gt;fast&lt;/a&gt;, then get the
+    resource from the &lt;a href=#concept-appcache-selection title=concept-appcache-selection&gt;most
+    appropriate application cache&lt;/a&gt; of those that match.&lt;/p&gt;
 
     &lt;p class=example&gt;For example, imagine an HTML page with an
     associated application cache displaying an image and a form, where
@@ -67921,8 +67923,43 @@
 
    &lt;/li&gt;
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
    &lt;li&gt;
 
+    &lt;p&gt;If the resource was not fetched from an &lt;a href=#application-cache&gt;application
+    cache&lt;/a&gt;, and was to be fetched using HTTP GET &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt;, and
+
+    there are &lt;a href=#relevant-application-cache title=&quot;relevant application cache&quot;&gt;relevant
+    application caches&lt;/a&gt; that are identified by a URL with the
+    &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the URL in question, and that have
+    this URL as one of their entries, excluding entries marked as
+    &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, and whose
+    &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;mode&lt;/a&gt; is &lt;a href=#concept-appcache-mode-prefer-online title=concept-appcache-mode-prefer-online&gt;prefer-online&lt;/a&gt;,
+    and the user didn't cancel the navigation attempt during the
+    earlier step, and the navigation attempt failed (e.g. the server
+    returned a 4xx or 5xx status code &lt;a href=#concept-http-equivalent-codes title=concept-http-equivalent-codes&gt;or equivalent&lt;/a&gt;, or
+    there was a DNS error), then:&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; be the resource identified by
+    the URL in question from the &lt;a href=#concept-appcache-selection title=concept-appcache-selection&gt;most appropriate application
+    cache&lt;/a&gt; of those that match.&lt;/p&gt; &lt;!-- note that a redirect
+    can never reach this point as it is handled earlier, meaning that
+    a captive portal captures URLs in &quot;prefer-online&quot; caches and you
+    can't ever get to the cached resource of a prefer-online cache if
+    you have a captive portal --&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; is not marked as &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, then the user
+    agent must discard the failed load and instead continue along
+    these steps using &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; as the resource.
+    The user agent may indicate to the user that the original page
+    load failed, and that the page used was a previously cached
+    resource.&lt;/p&gt;
+
+   &lt;/li&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;&lt;i&gt;Resource handling&lt;/i&gt;: If the resource's out-of-band
     metadata (e.g. HTTP headers), not counting any &lt;a href=#content-type title=Content-Type&gt;type information&lt;/a&gt; (such as the
     Content-Type HTTP header), requires some sort of processing that
@@ -69392,7 +69429,7 @@
      &lt;td&gt; The user agent will try fetching the files again momentarily.
   &lt;/table&gt;&lt;div class=impl&gt;
 
-  &lt;h4 id=appcache&gt;&lt;span class=secno&gt;6.7.2 &lt;/span&gt;Application caches&lt;/h4&gt;
+  &lt;h4 id=appcache&gt;&lt;span class=secno&gt;6.7.2 &lt;/span&gt;Application caches&lt;/h4&gt; &lt;!--APPCACHE--&gt;
 
   &lt;p&gt;An &lt;dfn id=application-cache&gt;application cache&lt;/dfn&gt; is a set of cached resources
   consisting of:&lt;/p&gt;
@@ -69486,6 +69523,21 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;A &lt;dfn id=concept-appcache-mode title=concept-appcache-mode&gt;cache mode flag&lt;/dfn&gt;,
+    which is 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    either
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    in the &lt;dfn id=concept-appcache-mode-fast title=concept-appcache-mode-fast&gt;&lt;i&gt;fast&lt;/i&gt;&lt;/dfn&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    state or the &lt;dfn id=concept-appcache-mode-prefer-online title=concept-appcache-mode-prefer-online&gt;&lt;i&gt;prefer-online&lt;/i&gt;&lt;/dfn&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    state.&lt;/p&gt;
+
+   &lt;/li&gt;
+
   &lt;/ul&gt;&lt;p&gt;Each &lt;a href=#application-cache&gt;application cache&lt;/a&gt; has a &lt;dfn id=concept-appcache-completeness title=concept-appcache-completeness&gt;completeness flag&lt;/dfn&gt;, which is
   either &lt;i&gt;complete&lt;/i&gt; or &lt;i&gt;incomplete&lt;/i&gt;.&lt;/p&gt;
 
@@ -69734,7 +69786,8 @@
 
    &lt;dt&gt;A section header
    &lt;dd&gt;
-    &lt;p&gt;Section headers change the current section. There are three
+
+    &lt;p&gt;Section headers change the current section. There are four
     possible section headers:
 
     &lt;dl&gt;&lt;dt&gt;&lt;code&gt;CACHE:&lt;/code&gt;
@@ -69746,6 +69799,11 @@
      &lt;dt&gt;&lt;code&gt;NETWORK:&lt;/code&gt;
      &lt;dd&gt;Switches to the &lt;dfn id=concept-appcache-manifest-network title=concept-appcache-manifest-network&gt;online whitelist section&lt;/dfn&gt;.
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+     &lt;dt&gt;&lt;code&gt;SETTINGS:&lt;/code&gt;
+     &lt;dd&gt;Switches to the &lt;dfn id=concept-appcache-manifest-settings title=concept-appcache-manifest-settings&gt;settings section&lt;/dfn&gt;.
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
     &lt;/dl&gt;&lt;p&gt;Section header lines must consist of zero or more U+0020 SPACE
     and U+0009 CHARACTER TABULATION (tab) characters, followed by one
     of the names above (including the U+003A COLON character (:))
@@ -69786,6 +69844,27 @@
     and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION
     (tab) characters.&lt;/p&gt;
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    &lt;p&gt;When the current section is the &lt;a href=#concept-appcache-manifest-settings title=concept-appcache-manifest-settings&gt;settings
+    section&lt;/a&gt;, data lines must consist of zero or more U+0020
+    SPACE and U+0009 CHARACTER TABULATION (tab) characters, a &lt;a href=#concept-appcache-manifest-setting title=concept-appcache-manifest-setting&gt;setting&lt;/a&gt;, and then
+    zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
+    characters.&lt;/p&gt;
+
+    &lt;p&gt;Currently only one &lt;dfn id=concept-appcache-manifest-setting title=concept-appcache-manifest-setting&gt;setting&lt;/dfn&gt; is
+    defined:&lt;/p&gt;
+
+    &lt;dl&gt;&lt;dt&gt;The cache mode setting&lt;/dt&gt;
+
+     &lt;dd&gt;This consists of the string &quot;&lt;code title=&quot;&quot;&gt;prefer-online&lt;/code&gt;&quot;. It sets the &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;cache mode&lt;/a&gt; to &lt;a href=#concept-appcache-mode-prefer-online title=concept-appcache-mode-prefer-online&gt;prefer-online&lt;/a&gt;.
+     (The &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;cache mode&lt;/a&gt;
+     defaults to &lt;a href=#concept-appcache-mode-fast title=concept-appcache-mode-fast&gt;fast&lt;/a&gt;.)&lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;p&gt;Within a &lt;a href=#concept-appcache-manifest-settings title=concept-appcache-manifest-settings&gt;settings
+    section&lt;/a&gt;, each &lt;a href=#concept-appcache-manifest-setting title=concept-appcache-manifest-setting&gt;setting&lt;/a&gt; must
+    occur no more than once.&lt;/p&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
 &lt;!--
     &lt;p class=&quot;note&quot;&gt;The URLs in data lines can't be empty strings,
     since those would be relative URLs to the manifest itself. Such
@@ -69870,6 +69949,8 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;online whitelist wildcard flag&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;blocking&lt;/i&gt;. &lt;!--
    concept-appcache-onlinewhitelist-wildcard --&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache mode flag&lt;/var&gt; be &lt;i title=&quot;&quot;&gt;fast&lt;/i&gt;. &lt;!-- concept-appcache-mode-fast --&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; be the decoded text of the
    manifest's byte stream.&lt;/li&gt;
 
@@ -69936,6 +70017,12 @@
    &quot;NETWORK&quot; followed by a U+003A COLON character (:)), then set &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;online whitelist&quot; and jump back to the step
    labeled &quot;start of line&quot;.&lt;/li&gt;
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;SETTINGS:&quot; (the word
+   &quot;SETTINGS&quot; followed by a U+003A COLON character (:)), then set &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;settings&quot; and jump back to the step labeled
+   &quot;start of line&quot;.&lt;/li&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; ends with a U+003A COLON
    character (:), then set &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;unknown&quot; and
    jump back to the step labeled &quot;start of line&quot;.&lt;/li&gt;
@@ -70062,6 +70149,22 @@
 
      &lt;/dd&gt;
 
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;settings&quot;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains a single token, and
+      that token is a &lt;a href=#case-sensitive&gt;case-sensitive&lt;/a&gt; match for the string
+      &quot;&lt;code title=&quot;&quot;&gt;prefer-online&lt;/code&gt;&quot;, then set &lt;var title=&quot;&quot;&gt;cache mode flag&lt;/var&gt; to &lt;i title=&quot;&quot;&gt;prefer-online&lt;/i&gt;
+      and jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the line is an unsupported setting: do nothing;
+      the line is ignored.&lt;/p&gt;
+
+     &lt;/dd&gt;
+&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
      &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;unknown&quot;&lt;/dt&gt;
 
      &lt;dd&gt;
@@ -70077,8 +70180,9 @@
    reached.)&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; list, the &lt;var title=&quot;&quot;&gt;fallback URLs&lt;/var&gt; mapping, the &lt;var title=&quot;&quot;&gt;online
-   whitelist namespaces&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;online whitelist
-   wildcard flag&lt;/var&gt;.&lt;/li&gt;
+   whitelist namespaces&lt;/var&gt;, the &lt;var title=&quot;&quot;&gt;online whitelist
+   wildcard flag&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;cache mode
+   flag&lt;/var&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;div class=note&gt;
 
@@ -70273,8 +70377,8 @@
     obtaining a list of &lt;a href=#concept-appcache-explicit title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt;, &lt;a href=#concept-appcache-fallback title=concept-appcache-fallback&gt;fallback entries&lt;/a&gt; and the
     &lt;a href=#concept-appcache-fallback-ns title=concept-appcache-fallback-ns&gt;fallback
     namespaces&lt;/a&gt; that map to them, entries for the &lt;a href=#concept-appcache-onlinewhitelist title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt;,
-    and a value for the &lt;a href=#concept-appcache-onlinewhitelist-wildcard title=concept-appcache-onlinewhitelist-wildcard&gt;online whitelist
-    wildcard flag&lt;/a&gt;.&lt;/p&gt;
+    and values for the &lt;a href=#concept-appcache-onlinewhitelist-wildcard title=concept-appcache-onlinewhitelist-wildcard&gt;online whitelist
+    wildcard flag&lt;/a&gt; and the &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;cache mode flag&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p class=note&gt;The &lt;a href=#mime-type&gt;MIME type&lt;/a&gt; of the resource is
     ignored &mdash; it is assumed to be
@@ -70666,6 +70770,8 @@
    &lt;li&gt;&lt;p&gt;Store the value of the new &lt;a href=#concept-appcache-onlinewhitelist-wildcard title=concept-appcache-onlinewhitelist-wildcard&gt;online whitelist
    wildcard flag&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Store the value of the new &lt;a href=#concept-appcache-mode title=concept-appcache-mode&gt;cache mode flag&lt;/a&gt; in &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;For each entry in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;'s &lt;a href=#concept-appcache-pending-masters title=concept-appcache-pending-masters&gt;list of pending master
@@ -70968,6 +71074,15 @@
     the &lt;a href=#concept-appcache-master title=concept-appcache-master&gt;master&lt;/a&gt;
     resource.&lt;/p&gt;
 
+    &lt;p&gt;If there are &lt;a href=#relevant-application-cache title=&quot;relevant application cache&quot;&gt;relevant
+    application caches&lt;/a&gt; that are identified by a URL with the
+    &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the URL of &lt;var title=&quot;&quot;&gt;document&lt;/var&gt;, and that have this URL as one of their
+    entries, excluding entries marked as &lt;a href=#concept-appcache-foreign title=concept-appcache-foreign&gt;foreign&lt;/a&gt;, then the user
+    agent should use the &lt;a href=#concept-appcache-selection title=concept-appcache-selection&gt;most
+    appropriate application cache&lt;/a&gt; of those that match as an
+    HTTP cache for any subresource loads. User agents may also have
+    other caches in place that are also honored.&lt;/p&gt;
+
    &lt;/dd&gt;
 
 

Modified: source
===================================================================
--- source	2012-06-14 20:56:53 UTC (rev 7135)
+++ source	2012-06-14 22:48:12 UTC (rev 7136)
@@ -272,6 +272,7 @@
    &lt;li&gt;Some predefined &lt;a href=&quot;#mdvocabs&quot;&gt;Microdata vocabularies&lt;/a&gt;.&lt;/li&gt;
    &lt;li&gt;The &lt;code&gt;data&lt;/code&gt; element for marking up machine-readable data.&lt;/li&gt;&lt;!--DATA--&gt;&lt;!--FORK--&gt;
    &lt;li&gt;The &lt;code title=&quot;scheme-http+aes&quot;&gt;http+aes:&lt;/code&gt; and &lt;code title=&quot;scheme-http+aes&quot;&gt;https+aes:&lt;/code&gt; schemes.&lt;/li&gt;&lt;!--FORK--&gt;
+   &lt;li&gt;The &lt;span&gt;application cache&lt;/span&gt; feature's &lt;span title=&quot;concept-appcache-mode-prefer-online&quot;&gt;prefer-online&lt;/span&gt; mode.&lt;/li&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
   &lt;/ul&gt;
 
 &lt;!--
@@ -79415,10 +79416,11 @@
     application caches&lt;/span&gt; that are identified by a URL with the
     &lt;span&gt;same origin&lt;/span&gt; as the URL in question, and that have
     this URL as one of their entries, excluding entries marked as
-    &lt;span title=&quot;concept-appcache-foreign&quot;&gt;foreign&lt;/span&gt;, then get
-    the resource from the &lt;span
-    title=&quot;concept-appcache-selection&quot;&gt;most appropriate application
-    cache&lt;/span&gt; of those that match.&lt;/p&gt;
+    &lt;span title=&quot;concept-appcache-foreign&quot;&gt;foreign&lt;/span&gt;, and whose
+    &lt;span title=&quot;concept-appcache-mode&quot;&gt;mode&lt;/span&gt; is &lt;span
+    title=&quot;concept-appcache-mode-fast&quot;&gt;fast&lt;/span&gt;, then get the
+    resource from the &lt;span title=&quot;concept-appcache-selection&quot;&gt;most
+    appropriate application cache&lt;/span&gt; of those that match.&lt;/p&gt;
 
     &lt;p class=&quot;example&quot;&gt;For example, imagine an HTML page with an
     associated application cache displaying an image and a form, where
@@ -79551,8 +79553,48 @@
 
    &lt;/li&gt;
 
+&lt;!--END w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
    &lt;li&gt;
 
+    &lt;p&gt;If the resource was not fetched from an &lt;span&gt;application
+    cache&lt;/span&gt;, and was to be fetched using HTTP GET &lt;span
+    title=&quot;concept-http-equivalent-get&quot;&gt;or equivalent&lt;/span&gt;, and
+
+    there are &lt;span title=&quot;relevant application cache&quot;&gt;relevant
+    application caches&lt;/span&gt; that are identified by a URL with the
+    &lt;span&gt;same origin&lt;/span&gt; as the URL in question, and that have
+    this URL as one of their entries, excluding entries marked as
+    &lt;span title=&quot;concept-appcache-foreign&quot;&gt;foreign&lt;/span&gt;, and whose
+    &lt;span title=&quot;concept-appcache-mode&quot;&gt;mode&lt;/span&gt; is &lt;span
+    title=&quot;concept-appcache-mode-prefer-online&quot;&gt;prefer-online&lt;/span&gt;,
+    and the user didn't cancel the navigation attempt during the
+    earlier step, and the navigation attempt failed (e.g. the server
+    returned a 4xx or 5xx status code &lt;span
+    title=&quot;concept-http-equivalent-codes&quot;&gt;or equivalent&lt;/span&gt;, or
+    there was a DNS error), then:&lt;/p&gt;
+
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; be the resource identified by
+    the URL in question from the &lt;span
+    title=&quot;concept-appcache-selection&quot;&gt;most appropriate application
+    cache&lt;/span&gt; of those that match.&lt;/p&gt; &lt;!-- note that a redirect
+    can never reach this point as it is handled earlier, meaning that
+    a captive portal captures URLs in &quot;prefer-online&quot; caches and you
+    can't ever get to the cached resource of a prefer-online cache if
+    you have a captive portal --&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; is not marked as &lt;span
+    title=&quot;concept-appcache-foreign&quot;&gt;foreign&lt;/span&gt;, then the user
+    agent must discard the failed load and instead continue along
+    these steps using &lt;var title=&quot;&quot;&gt;candidate&lt;/var&gt; as the resource.
+    The user agent may indicate to the user that the original page
+    load failed, and that the page used was a previously cached
+    resource.&lt;/p&gt;
+
+   &lt;/li&gt;
+&lt;!--START w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;&lt;i&gt;Resource handling&lt;/i&gt;: If the resource's out-of-band
     metadata (e.g. HTTP headers), not counting any &lt;span
     title=&quot;Content-Type&quot;&gt;type information&lt;/span&gt; (such as the
@@ -81232,7 +81274,7 @@
 
   &lt;div class=&quot;impl&quot;&gt;
 
-  &lt;h4 id=&quot;appcache&quot;&gt;Application caches&lt;/h4&gt;
+  &lt;h4 id=&quot;appcache&quot;&gt;Application caches&lt;/h4&gt; &lt;!--APPCACHE--&gt;
 
   &lt;p&gt;An &lt;dfn&gt;application cache&lt;/dfn&gt; is a set of cached resources
   consisting of:&lt;/p&gt;
@@ -81348,6 +81390,22 @@
 
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;A &lt;dfn title=&quot;concept-appcache-mode&quot;&gt;cache mode flag&lt;/dfn&gt;,
+    which is 
+&lt;!--END w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    either
+&lt;!--START w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    in the &lt;dfn title=&quot;concept-appcache-mode-fast&quot;&gt;&lt;i&gt;fast&lt;/i&gt;&lt;/dfn&gt;
+&lt;!--END w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    state or the &lt;dfn
+    title=&quot;concept-appcache-mode-prefer-online&quot;&gt;&lt;i&gt;prefer-online&lt;/i&gt;&lt;/dfn&gt;
+&lt;!--START w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    state.&lt;/p&gt;
+
+   &lt;/li&gt;
+
   &lt;/ul&gt;
 
   &lt;p&gt;Each &lt;span&gt;application cache&lt;/span&gt; has a &lt;dfn
@@ -81636,7 +81694,8 @@
 
    &lt;dt&gt;A section header
    &lt;dd&gt;
-    &lt;p&gt;Section headers change the current section. There are three
+
+    &lt;p&gt;Section headers change the current section. There are four
     possible section headers:
 
     &lt;dl&gt;
@@ -81650,6 +81709,11 @@
      &lt;dt&gt;&lt;code&gt;NETWORK:&lt;/code&gt;
      &lt;dd&gt;Switches to the &lt;dfn title=&quot;concept-appcache-manifest-network&quot;&gt;online whitelist section&lt;/dfn&gt;.
 
+&lt;!--END w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+     &lt;dt&gt;&lt;code&gt;SETTINGS:&lt;/code&gt;
+     &lt;dd&gt;Switches to the &lt;dfn title=&quot;concept-appcache-manifest-settings&quot;&gt;settings section&lt;/dfn&gt;.
+&lt;!--START w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
     &lt;/dl&gt;
 
     &lt;p&gt;Section header lines must consist of zero or more U+0020 SPACE
@@ -81695,6 +81759,40 @@
     and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION
     (tab) characters.&lt;/p&gt;
 
+&lt;!--END w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+    &lt;p&gt;When the current section is the &lt;span
+    title=&quot;concept-appcache-manifest-settings&quot;&gt;settings
+    section&lt;/span&gt;, data lines must consist of zero or more U+0020
+    SPACE and U+0009 CHARACTER TABULATION (tab) characters, a &lt;span
+    title=&quot;concept-appcache-manifest-setting&quot;&gt;setting&lt;/span&gt;, and then
+    zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
+    characters.&lt;/p&gt;
+
+    &lt;p&gt;Currently only one &lt;dfn
+    title=&quot;concept-appcache-manifest-setting&quot;&gt;setting&lt;/dfn&gt; is
+    defined:&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt;The cache mode setting&lt;/dt&gt;
+
+     &lt;dd&gt;This consists of the string &quot;&lt;code
+     title=&quot;&quot;&gt;prefer-online&lt;/code&gt;&quot;. It sets the &lt;span
+     title=&quot;concept-appcache-mode&quot;&gt;cache mode&lt;/span&gt; to &lt;span
+     title=&quot;concept-appcache-mode-prefer-online&quot;&gt;prefer-online&lt;/span&gt;.
+     (The &lt;span title=&quot;concept-appcache-mode&quot;&gt;cache mode&lt;/span&gt;
+     defaults to &lt;span
+     title=&quot;concept-appcache-mode-fast&quot;&gt;fast&lt;/span&gt;.)&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+    &lt;p&gt;Within a &lt;span
+    title=&quot;concept-appcache-manifest-settings&quot;&gt;settings
+    section&lt;/span&gt;, each &lt;span
+    title=&quot;concept-appcache-manifest-setting&quot;&gt;setting&lt;/span&gt; must
+    occur no more than once.&lt;/p&gt;
+&lt;!--START w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
 &lt;!--
     &lt;p class=&quot;note&quot;&gt;The URLs in data lines can't be empty strings,
     since those would be relative URLs to the manifest itself. Such
@@ -81796,6 +81894,9 @@
    title=&quot;&quot;&gt;blocking&lt;/i&gt;. &lt;!--
    concept-appcache-onlinewhitelist-wildcard --&gt;&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;cache mode flag&lt;/var&gt; be &lt;i
+   title=&quot;&quot;&gt;fast&lt;/i&gt;. &lt;!-- concept-appcache-mode-fast --&gt;&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; be the decoded text of the
    manifest's byte stream.&lt;/p&gt;&lt;/li&gt;
 
@@ -81869,6 +81970,13 @@
    title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;online whitelist&quot; and jump back to the step
    labeled &quot;start of line&quot;.&lt;/p&gt;&lt;/li&gt;
 
+&lt;!--END w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; equals &quot;SETTINGS:&quot; (the word
+   &quot;SETTINGS&quot; followed by a U+003A COLON character (:)), then set &lt;var
+   title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;settings&quot; and jump back to the step labeled
+   &quot;start of line&quot;.&lt;/p&gt;&lt;/li&gt;
+&lt;!--START w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; ends with a U+003A COLON
    character (:), then set &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; to &quot;unknown&quot; and
    jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;&lt;/li&gt;
@@ -82019,6 +82127,23 @@
 
      &lt;/dd&gt;
 
+&lt;!--END w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+     &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;settings&quot;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;tokens&lt;/var&gt; contains a single token, and
+      that token is a &lt;span&gt;case-sensitive&lt;/span&gt; match for the string
+      &quot;&lt;code title=&quot;&quot;&gt;prefer-online&lt;/code&gt;&quot;, then set &lt;var
+      title=&quot;&quot;&gt;cache mode flag&lt;/var&gt; to &lt;i title=&quot;&quot;&gt;prefer-online&lt;/i&gt;
+      and jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, the line is an unsupported setting: do nothing;
+      the line is ignored.&lt;/p&gt;
+
+     &lt;/dd&gt;
+&lt;!--START w3c-html--&gt;&lt;!--FORK--&gt;&lt;!--APPCACHE-PREFER-ONLINE--&gt;
+
      &lt;dt&gt;If &lt;var title=&quot;&quot;&gt;mode&lt;/var&gt; is &quot;unknown&quot;&lt;/dt&gt;
 
      &lt;dd&gt;
@@ -82037,8 +82162,9 @@
 
    &lt;li&gt;&lt;p&gt;Return the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; list, the &lt;var
    title=&quot;&quot;&gt;fallback URLs&lt;/var&gt; mapping, the &lt;var title=&quot;&quot;&gt;online
-   whitelist namespaces&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;online whitelist
-   wildcard flag&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   whitelist namespaces&lt;/var&gt;, the &lt;var title=&quot;&quot;&gt;online whitelist
+   wildcard flag&lt;/var&gt;, and the &lt;var title=&quot;&quot;&gt;cache mode
+   flag&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
@@ -82281,9 +82407,10 @@
     &lt;span title=&quot;concept-appcache-fallback-ns&quot;&gt;fallback
     namespaces&lt;/span&gt; that map to them, entries for the &lt;span
     title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/span&gt;,
-    and a value for the &lt;span
+    and values for the &lt;span
     title=&quot;concept-appcache-onlinewhitelist-wildcard&quot;&gt;online whitelist
-    wildcard flag&lt;/span&gt;.&lt;/p&gt;
+    wildcard flag&lt;/span&gt; and the &lt;span
+    title=&quot;concept-appcache-mode&quot;&gt;cache mode flag&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;The &lt;span&gt;MIME type&lt;/span&gt; of the resource is
     ignored &mdash; it is assumed to be
@@ -82741,6 +82868,10 @@
    title=&quot;concept-appcache-onlinewhitelist-wildcard&quot;&gt;online whitelist
    wildcard flag&lt;/span&gt; in &lt;var title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Store the value of the new &lt;span
+   title=&quot;concept-appcache-mode&quot;&gt;cache mode flag&lt;/span&gt; in &lt;var
+   title=&quot;&quot;&gt;new cache&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;For each entry in &lt;var title=&quot;&quot;&gt;cache group&lt;/var&gt;'s &lt;span
@@ -83106,6 +83237,17 @@
     the &lt;span title=&quot;concept-appcache-master&quot;&gt;master&lt;/span&gt;
     resource.&lt;/p&gt;
 
+    &lt;p&gt;If there are &lt;span title=&quot;relevant application cache&quot;&gt;relevant
+    application caches&lt;/span&gt; that are identified by a URL with the
+    &lt;span&gt;same origin&lt;/span&gt; as the URL of &lt;var
+    title=&quot;&quot;&gt;document&lt;/var&gt;, and that have this URL as one of their
+    entries, excluding entries marked as &lt;span
+    title=&quot;concept-appcache-foreign&quot;&gt;foreign&lt;/span&gt;, then the user
+    agent should use the &lt;span title=&quot;concept-appcache-selection&quot;&gt;most
+    appropriate application cache&lt;/span&gt; of those that match as an
+    HTTP cache for any subresource loads. User agents may also have
+    other caches in place that are also honored.&lt;/p&gt;
+
    &lt;/dd&gt;
 
 


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014000.html">[html5] r7135 - [e] (0) Fix some typos or copypasta. Fixing	https://www.w3.org/Bugs/Public/show_ [...]
</A></li>
	<LI>Next message: <A HREF="014002.html">[html5] r7137 - [e] (0) fix json error Affected topics: HTML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14001">[ date ]</a>
              <a href="thread.html#14001">[ thread ]</a>
              <a href="subject.html#14001">[ subject ]</a>
              <a href="author.html#14001">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
