<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r7326 - [giow] (1) &lt;track&gt; loading algorithm updates (part	1) Affected topics: Video Tex [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7326%20-%20%5Bgiow%5D%20%281%29%20%3Ctrack%3E%20loading%20algorithm%20updates%20%28part%0A%091%29%20Affected%20topics%3A%20Video%20Tex%20%5B...%5D&In-Reply-To=%3C20120907215228.C886A9C7C1F5%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014188.html">
   <LINK REL="Next"  HREF="014190.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r7326 - [giow] (1) &lt;track&gt; loading algorithm updates (part	1) Affected topics: Video Tex [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7326%20-%20%5Bgiow%5D%20%281%29%20%3Ctrack%3E%20loading%20algorithm%20updates%20%28part%0A%091%29%20Affected%20topics%3A%20Video%20Tex%20%5B...%5D&In-Reply-To=%3C20120907215228.C886A9C7C1F5%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r7326 - [giow] (1) &lt;track&gt; loading algorithm updates (part	1) Affected topics: Video Tex [...]">whatwg at whatwg.org
       </A><BR>
    <I>Fri Sep  7 14:52:28 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="014188.html">[html5] r7325 - [e] (0) Remove an unnecessary and confusing	conformance statement. Affected topi [...]
</A></li>
        <LI>Next message: <A HREF="014190.html">[html5] r7327 - [giow] (1) Reform the processing model around	loading of text tracks to solve a [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14189">[ date ]</a>
              <a href="thread.html#14189">[ thread ]</a>
              <a href="subject.html#14189">[ subject ]</a>
              <a href="author.html#14189">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2012-09-07 14:52:27 -0700 (Fri, 07 Sep 2012)
New Revision: 7326

Modified:
   complete.html
   index
   source
Log:
[giow] (1) &lt;track&gt; loading algorithm updates (part 1)
Affected topics: Video Text Tracks, Video and Audio

Modified: complete.html
===================================================================
--- complete.html	2012-09-07 04:07:48 UTC (rev 7325)
+++ complete.html	2012-09-07 21:52:27 UTC (rev 7326)
@@ -33513,7 +33513,7 @@
 
   &lt;p&gt;&lt;dfn&gt;Ducking&lt;/dfn&gt; is the process of reducing the volume of one
   audio track when another audio track is playing, for example
-  occasionally reducing the volume of a the soundtrack to allow the
+  occasionally reducing the volume of a soundtrack to allow the
   viewer to hear an intermittent commentary track.&lt;/p&gt;
 
   (add an &quot;autoduck&quot; attribute that reduces the volume of other media
@@ -34056,6 +34056,10 @@
    label in that data, then the &lt;a href=#text-track-label title=&quot;text track
    label&quot;&gt;label&lt;/a&gt; must be set to the empty string.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Associate the &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt; with the
+   &lt;a href=#rules-for-updating-the-text-track-rendering&gt;rules for updating the text track rendering&lt;/a&gt;
+   appropriate for the format in question.&lt;/p&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;If the new &lt;a href=#text-track&gt;text track&lt;/a&gt;'s &lt;a href=#text-track-kind title=&quot;text track
@@ -34140,15 +34144,12 @@
    to load the whole media file just to start playing the first
    frame... --&gt;
 
+   &lt;!-- XXX-MODE-HEURISTIC --&gt;
    &lt;li&gt;&lt;p&gt;Set the new &lt;a href=#text-track&gt;text track&lt;/a&gt;'s &lt;a href=#text-track-mode title=&quot;text
    track mode&quot;&gt;mode&lt;/a&gt; to the mode consistent with the user's
    preferences and the requirements of the relevant specification for
    the data.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Leave the &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt; empty, and
-   associate with it the &lt;a href=#rules-for-updating-the-text-track-rendering&gt;rules for updating the text track
-   rendering&lt;/a&gt; appropriate for the format in question.&lt;/p&gt;
-
    &lt;li&gt;&lt;p&gt;Add the new &lt;a href=#text-track&gt;text track&lt;/a&gt; to the &lt;a href=#media-element&gt;media
    element&lt;/a&gt;'s &lt;a href=#list-of-text-tracks&gt;list of text tracks&lt;/a&gt;.&lt;/li&gt;
 
@@ -34326,34 +34327,36 @@
   &lt;/dl&gt;&lt;p&gt;When a &lt;a href=#text-track&gt;text track&lt;/a&gt; corresponding to a
   &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is created with &lt;a href=#text-track-mode&gt;text track
   mode&lt;/a&gt; set to &lt;a href=#text-track-hidden title=&quot;text track hidden&quot;&gt;hidden&lt;/a&gt;,
-  &lt;a href=#text-track-showing title=&quot;text track showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by default&quot;&gt;showing by default&lt;/a&gt;,
-  and when a &lt;a href=#text-track&gt;text track&lt;/a&gt; corresponding to a
-  &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is created with &lt;a href=#text-track-mode&gt;text track
-  mode&lt;/a&gt; set to &lt;a href=#text-track-disabled title=&quot;text track
-  disabled&quot;&gt;disabled&lt;/a&gt; and subsequently changes its &lt;a href=#text-track-mode&gt;text
-  track mode&lt;/a&gt; to &lt;a href=#text-track-hidden title=&quot;text track hidden&quot;&gt;hidden&lt;/a&gt;,
-  &lt;a href=#text-track-showing title=&quot;text track showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by default&quot;&gt;showing by default&lt;/a&gt; for
-  the first time, the user agent must immediately and synchronously
-  run the following algorithm. This algorithm interacts closely with
-  the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; mechanism; in particular, it has a
-  &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; (which is triggered as part of the
-  &lt;a href=#event-loop&gt;event loop&lt;/a&gt; algorithm). The step in that section is
-  marked with &#8987;.&lt;/p&gt;
+  &lt;a href=#text-track-showing title=&quot;text track showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by default&quot;&gt;showing by default&lt;/a&gt;, and
+  when a &lt;a href=#text-track&gt;text track&lt;/a&gt; corresponding to a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt;
+  element is created with &lt;a href=#text-track-mode&gt;text track mode&lt;/a&gt; set to &lt;a href=#text-track-disabled title=&quot;text track disabled&quot;&gt;disabled&lt;/a&gt; and subsequently changes
+  its &lt;a href=#text-track-mode&gt;text track mode&lt;/a&gt; to &lt;a href=#text-track-hidden title=&quot;text track
+  hidden&quot;&gt;hidden&lt;/a&gt;, &lt;a href=#text-track-showing title=&quot;text track
+  showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by
+  default&quot;&gt;showing by default&lt;/a&gt; for the first time, the user
+  agent must asynchronously run the following
+  algorithm. This algorithm interacts closely with the &lt;a href=#event-loop&gt;event
+  loop&lt;/a&gt; mechanism; in particular, it has a &lt;a href=#synchronous-section&gt;synchronous
+  section&lt;/a&gt; (which is triggered as part of the &lt;a href=#event-loop&gt;event
+  loop&lt;/a&gt; algorithm). The steps in that section are marked with
+  &#8987;.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Set the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; to &lt;a href=#text-track-loading title=&quot;text track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;i&gt;Top&lt;/i&gt;: &lt;a href=#await-a-stable-state&gt;Await a stable state&lt;/a&gt;. The
+   &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; consists of the following steps.
+   (The steps in the &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; are marked with
+   &#8987;.)&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the &lt;a href=#track-url&gt;track URL&lt;/a&gt; of
-   the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&#8987; Set the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; to
+   &lt;a href=#text-track-loading title=&quot;text track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Asynchronously run the remaining steps, while continuing
-   with whatever task was responsible for creating the &lt;a href=#text-track&gt;text
-   track&lt;/a&gt; or changing the &lt;a href=#text-track-mode&gt;text track
-   mode&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&#8987; Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the &lt;a href=#track-url&gt;track
+   URL&lt;/a&gt; of the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;End the &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt;, continuing the
+   remaining steps asynchronously.&lt;/li&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;&lt;i&gt;Download&lt;/i&gt;: At this point, the text track is downloaded.&lt;/p&gt;
-
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; is not the empty string, perform a
     &lt;a href=#potentially-cors-enabled-fetch&gt;potentially CORS-enabled fetch&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, with the &lt;i&gt;mode&lt;/i&gt; being the state of the
     &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;code title=attr-media-crossorigin&gt;&lt;a href=#attr-media-crossorigin&gt;crossorigin&lt;/a&gt;&lt;/code&gt; content
@@ -34372,14 +34375,20 @@
     algorithm&lt;/a&gt; on the &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; to
     process the data as it is being fetched must &lt;!--&lt;span
     title=&quot;Content-Type sniffing&quot;&gt;--&gt;determine the &lt;!--sniffed--&gt; type
-    of a the resource&lt;!--&lt;/span&gt;--&gt;. If the &lt;!--sniffed--&gt; type of the
+    of the resource&lt;!--&lt;/span&gt;--&gt;. If the &lt;!--sniffed--&gt; type of the
     resource is not a supported text track format, the load will fail,
     as described below. Otherwise, the resource's data must be passed
     to the appropriate parser (e.g. the &lt;a href=#webvtt-parser&gt;WebVTT parser&lt;/a&gt;&lt;!--
     if the file starts with the &quot;&lt;code title=&quot;&quot;&gt;WEBVTT&lt;/code&gt;&quot;
     signature--&gt;) as it is received, with the &lt;a href=#text-track-list-of-cues&gt;text track list of
-    cues&lt;/a&gt; being used for that parser's output. &lt;a href=#refsWEBVTT&gt;[WEBVTT]&lt;/a&gt;&lt;/p&gt;
+    cues&lt;/a&gt; being used for that parser's output. &lt;a href=#refsWEBVTT&gt;[WEBVTT]&lt;/a&gt;&lt;/p&gt;&lt;!-- see also critical block
+    below, and the word &quot;sniffed&quot; in the paragraph after that --&gt;
 
+    &lt;p class=note&gt;The appropriate parser will synchronously (during
+    these &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt;) and incrementally (as each such
+    task is run with whatever data has been received from the network)
+    update the &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt;.&lt;/p&gt;
+
     &lt;p class=critical&gt;This specification does not currently say
     whether or how to check the MIME types of text tracks, or whether
     or how to perform file type sniffing using the actual file data.
@@ -34396,15 +34405,29 @@
     &lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; fails for
     any reason (network error, the server returns an error code, a
     cross-origin check fails, etc), if &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; is the
-    empty string, or if the sniffed type of the resource is not a
-    supported text track format, then &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to
-    first change the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; to &lt;a href=#text-track-failed-to-load title=&quot;text track failed to load&quot;&gt;failed to load&lt;/a&gt; and then
-    &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt; at the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt;
-    element; and then, once that &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; is &lt;a href=#queue-a-task title=&quot;queue a
-    task&quot;&gt;queued&lt;/a&gt;, move on to the step below labeled
-    &lt;i&gt;monitoring&lt;/i&gt;.&lt;/p&gt;
+    empty string, or if the &lt;!--sniffed--&gt; type of the resource is not a
+    supported text track format, then run these steps:
 
-    &lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; does not
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to first change the &lt;a href=#text-track-readiness-state&gt;text
+     track readiness state&lt;/a&gt; to &lt;a href=#text-track-failed-to-load title=&quot;text track failed to
+     load&quot;&gt;failed to load&lt;/a&gt; and then &lt;a href=#fire-a-simple-event&gt;fire a simple
+     event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt; at the
+     &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; is
+     no longer set to &lt;a href=#text-track-loading title=&quot;text track
+     loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#track-url&gt;track URL&lt;/a&gt; is no longer equal
+     to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the &lt;a href=#text-track-mode&gt;text
+     track mode&lt;/a&gt; is set to &lt;a href=#text-track-hidden title=&quot;text track
+     hidden&quot;&gt;hidden&lt;/a&gt;, &lt;a href=#text-track-showing title=&quot;text track
+     showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by
+     default&quot;&gt;showing by default&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; does not
     fail, then the final &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that
     is &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queued&lt;/a&gt; by the
     &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; must run the following
@@ -34419,17 +34442,24 @@
       event&lt;/a&gt; named &lt;code title=event-load&gt;load&lt;/code&gt; at the
       &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
 
-      &lt;p&gt;If the file was not successfully processed, e.g. the format
-      in question is an XML format and the file contained a
+      &lt;p&gt;Otherwise, the file was not successfully processed (e.g. the
+      format in question is an XML format and the file contained a
       well-formedness error that the XML specification requires be
-      detected and reported to the application, then &lt;a href=#fire-a-simple-event&gt;fire a
-      simple event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt;
-      at the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+      detected and reported to the application); &lt;a href=#fire-a-simple-event&gt;fire a simple
+      event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt; at the
+      &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
 
      &lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Jump to the step below labeled &lt;i&gt;monitoring&lt;/i&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#track-url&gt;track URL&lt;/a&gt; is no longer equal
+     to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the &lt;a href=#text-track-mode&gt;text
+     track mode&lt;/a&gt; is set to &lt;a href=#text-track-hidden title=&quot;text track
+     hidden&quot;&gt;hidden&lt;/a&gt;, &lt;a href=#text-track-showing title=&quot;text track
+     showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by
+     default&quot;&gt;showing by default&lt;/a&gt;.&lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/li&gt;
+
     &lt;/ol&gt;&lt;p&gt;If, while the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; is
     active, either:&lt;/p&gt;
 
@@ -34449,49 +34479,26 @@
 
     &lt;ol&gt;&lt;li&gt;&lt;p&gt;Abort the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt;,
      discarding any pending &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt;
-     generated by that algorithm.&lt;/li&gt;
+     generated by that algorithm (and in particular, not adding any
+     cues to the &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt; after the moment
+     the URL changed).&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the new &lt;a href=#track-url&gt;track
-     URL&lt;/a&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Jump back to the top of the step labeled
-     &lt;i&gt;download&lt;/i&gt;.&lt;/li&gt;
-
     &lt;/ol&gt;&lt;p&gt;Until one of the above circumstances occurs, the user agent
     must remain on this step.&lt;/p&gt;
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Monitoring&lt;/i&gt;: Wait until the &lt;a href=#track-url&gt;track URL&lt;/a&gt; is
-   no longer equal to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the
-   &lt;a href=#text-track-mode&gt;text track mode&lt;/a&gt; is set to &lt;a href=#text-track-hidden title=&quot;text track
-   hidden&quot;&gt;hidden&lt;/a&gt;, &lt;a href=#text-track-showing title=&quot;text track
-   showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by
-   default&quot;&gt;showing by default&lt;/a&gt;.&lt;/li&gt;
+  &lt;/ol&gt;&lt;p&gt;Whenever a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element has its &lt;code title=attr-track-src&gt;&lt;a href=#attr-track-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute set, changed, or
+  removed, the user agent must synchronously empty the element's
+  &lt;a href=#text-track&gt;text track&lt;/a&gt;'s &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt;.
+  (This also causes the algorithm above to stop adding cues from the
+  resource being obtained using the previously given URL, if any.)&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; is
-   no longer set to &lt;a href=#text-track-loading title=&quot;text track
-   loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+  &lt;/div&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#await-a-stable-state&gt;Await a stable state&lt;/a&gt;. The &lt;a href=#synchronous-section&gt;synchronous
-   section&lt;/a&gt; consists of the following step. (The step in the
-   &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; is marked with &#8987;.)&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&#8987; Set the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; to
-   &lt;a href=#text-track-loading title=&quot;text track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
-
-   &lt;!-- if you add more, change the grammar of the sentences above to
-   be plural with respect to the number of synchronous steps (both in
-   the step above and in the intro to the whole algorithm) --&gt;
-
-   &lt;li&gt;&lt;p&gt;End the &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt;, continuing the
-   remaining steps asynchronously.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;download&lt;/i&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;/div&gt;
-
-
   &lt;div class=impl&gt;
 
   &lt;h6 id=guidelines-for-exposing-cues-in-various-formats-as-text-track-cues&gt;&lt;span class=secno&gt;4.8.10.12.4 &lt;/span&gt;&lt;dfn&gt;Guidelines for exposing cues&lt;/dfn&gt; in various formats as
@@ -34715,7 +34722,7 @@
   &lt;a href=#text-track&gt;text track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#texttrack&gt;TextTrack&lt;/a&gt;&lt;/code&gt; object
   represents.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-texttrack-inbandmetadatatrackdispatchtype title=dom-TextTrack-inBandMetadataTrackDispatchType&gt;inBandMetadataTrackDispatchType&lt;code&gt;&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn id=dom-texttrack-inbandmetadatatrackdispatchtype title=dom-TextTrack-inBandMetadataTrackDispatchType&gt;&lt;code&gt;inBandMetadataTrackDispatchType&lt;/code&gt;&lt;/dfn&gt;
   attribute must return the &lt;a href=#text-track-in-band-metadata-track-dispatch-type&gt;text track in-band metadata track
   dispatch type&lt;/a&gt; of the &lt;a href=#text-track&gt;text track&lt;/a&gt; that the
   &lt;code&gt;&lt;a href=#texttrack&gt;TextTrack&lt;/a&gt;&lt;/code&gt; object represents.&lt;/p&gt;

Modified: index
===================================================================
--- index	2012-09-07 04:07:48 UTC (rev 7325)
+++ index	2012-09-07 21:52:27 UTC (rev 7326)
@@ -33513,7 +33513,7 @@
 
   &lt;p&gt;&lt;dfn&gt;Ducking&lt;/dfn&gt; is the process of reducing the volume of one
   audio track when another audio track is playing, for example
-  occasionally reducing the volume of a the soundtrack to allow the
+  occasionally reducing the volume of a soundtrack to allow the
   viewer to hear an intermittent commentary track.&lt;/p&gt;
 
   (add an &quot;autoduck&quot; attribute that reduces the volume of other media
@@ -34056,6 +34056,10 @@
    label in that data, then the &lt;a href=#text-track-label title=&quot;text track
    label&quot;&gt;label&lt;/a&gt; must be set to the empty string.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Associate the &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt; with the
+   &lt;a href=#rules-for-updating-the-text-track-rendering&gt;rules for updating the text track rendering&lt;/a&gt;
+   appropriate for the format in question.&lt;/p&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;If the new &lt;a href=#text-track&gt;text track&lt;/a&gt;'s &lt;a href=#text-track-kind title=&quot;text track
@@ -34140,15 +34144,12 @@
    to load the whole media file just to start playing the first
    frame... --&gt;
 
+   &lt;!-- XXX-MODE-HEURISTIC --&gt;
    &lt;li&gt;&lt;p&gt;Set the new &lt;a href=#text-track&gt;text track&lt;/a&gt;'s &lt;a href=#text-track-mode title=&quot;text
    track mode&quot;&gt;mode&lt;/a&gt; to the mode consistent with the user's
    preferences and the requirements of the relevant specification for
    the data.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Leave the &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt; empty, and
-   associate with it the &lt;a href=#rules-for-updating-the-text-track-rendering&gt;rules for updating the text track
-   rendering&lt;/a&gt; appropriate for the format in question.&lt;/p&gt;
-
    &lt;li&gt;&lt;p&gt;Add the new &lt;a href=#text-track&gt;text track&lt;/a&gt; to the &lt;a href=#media-element&gt;media
    element&lt;/a&gt;'s &lt;a href=#list-of-text-tracks&gt;list of text tracks&lt;/a&gt;.&lt;/li&gt;
 
@@ -34326,34 +34327,36 @@
   &lt;/dl&gt;&lt;p&gt;When a &lt;a href=#text-track&gt;text track&lt;/a&gt; corresponding to a
   &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is created with &lt;a href=#text-track-mode&gt;text track
   mode&lt;/a&gt; set to &lt;a href=#text-track-hidden title=&quot;text track hidden&quot;&gt;hidden&lt;/a&gt;,
-  &lt;a href=#text-track-showing title=&quot;text track showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by default&quot;&gt;showing by default&lt;/a&gt;,
-  and when a &lt;a href=#text-track&gt;text track&lt;/a&gt; corresponding to a
-  &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element is created with &lt;a href=#text-track-mode&gt;text track
-  mode&lt;/a&gt; set to &lt;a href=#text-track-disabled title=&quot;text track
-  disabled&quot;&gt;disabled&lt;/a&gt; and subsequently changes its &lt;a href=#text-track-mode&gt;text
-  track mode&lt;/a&gt; to &lt;a href=#text-track-hidden title=&quot;text track hidden&quot;&gt;hidden&lt;/a&gt;,
-  &lt;a href=#text-track-showing title=&quot;text track showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by default&quot;&gt;showing by default&lt;/a&gt; for
-  the first time, the user agent must immediately and synchronously
-  run the following algorithm. This algorithm interacts closely with
-  the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; mechanism; in particular, it has a
-  &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; (which is triggered as part of the
-  &lt;a href=#event-loop&gt;event loop&lt;/a&gt; algorithm). The step in that section is
-  marked with &#8987;.&lt;/p&gt;
+  &lt;a href=#text-track-showing title=&quot;text track showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by default&quot;&gt;showing by default&lt;/a&gt;, and
+  when a &lt;a href=#text-track&gt;text track&lt;/a&gt; corresponding to a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt;
+  element is created with &lt;a href=#text-track-mode&gt;text track mode&lt;/a&gt; set to &lt;a href=#text-track-disabled title=&quot;text track disabled&quot;&gt;disabled&lt;/a&gt; and subsequently changes
+  its &lt;a href=#text-track-mode&gt;text track mode&lt;/a&gt; to &lt;a href=#text-track-hidden title=&quot;text track
+  hidden&quot;&gt;hidden&lt;/a&gt;, &lt;a href=#text-track-showing title=&quot;text track
+  showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by
+  default&quot;&gt;showing by default&lt;/a&gt; for the first time, the user
+  agent must asynchronously run the following
+  algorithm. This algorithm interacts closely with the &lt;a href=#event-loop&gt;event
+  loop&lt;/a&gt; mechanism; in particular, it has a &lt;a href=#synchronous-section&gt;synchronous
+  section&lt;/a&gt; (which is triggered as part of the &lt;a href=#event-loop&gt;event
+  loop&lt;/a&gt; algorithm). The steps in that section are marked with
+  &#8987;.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Set the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; to &lt;a href=#text-track-loading title=&quot;text track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;i&gt;Top&lt;/i&gt;: &lt;a href=#await-a-stable-state&gt;Await a stable state&lt;/a&gt;. The
+   &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; consists of the following steps.
+   (The steps in the &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; are marked with
+   &#8987;.)&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the &lt;a href=#track-url&gt;track URL&lt;/a&gt; of
-   the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&#8987; Set the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; to
+   &lt;a href=#text-track-loading title=&quot;text track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Asynchronously run the remaining steps, while continuing
-   with whatever task was responsible for creating the &lt;a href=#text-track&gt;text
-   track&lt;/a&gt; or changing the &lt;a href=#text-track-mode&gt;text track
-   mode&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&#8987; Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the &lt;a href=#track-url&gt;track
+   URL&lt;/a&gt; of the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;End the &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt;, continuing the
+   remaining steps asynchronously.&lt;/li&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;&lt;i&gt;Download&lt;/i&gt;: At this point, the text track is downloaded.&lt;/p&gt;
-
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; is not the empty string, perform a
     &lt;a href=#potentially-cors-enabled-fetch&gt;potentially CORS-enabled fetch&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, with the &lt;i&gt;mode&lt;/i&gt; being the state of the
     &lt;a href=#media-element&gt;media element&lt;/a&gt;'s &lt;code title=attr-media-crossorigin&gt;&lt;a href=#attr-media-crossorigin&gt;crossorigin&lt;/a&gt;&lt;/code&gt; content
@@ -34372,14 +34375,20 @@
     algorithm&lt;/a&gt; on the &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; to
     process the data as it is being fetched must &lt;!--&lt;span
     title=&quot;Content-Type sniffing&quot;&gt;--&gt;determine the &lt;!--sniffed--&gt; type
-    of a the resource&lt;!--&lt;/span&gt;--&gt;. If the &lt;!--sniffed--&gt; type of the
+    of the resource&lt;!--&lt;/span&gt;--&gt;. If the &lt;!--sniffed--&gt; type of the
     resource is not a supported text track format, the load will fail,
     as described below. Otherwise, the resource's data must be passed
     to the appropriate parser (e.g. the &lt;a href=#webvtt-parser&gt;WebVTT parser&lt;/a&gt;&lt;!--
     if the file starts with the &quot;&lt;code title=&quot;&quot;&gt;WEBVTT&lt;/code&gt;&quot;
     signature--&gt;) as it is received, with the &lt;a href=#text-track-list-of-cues&gt;text track list of
-    cues&lt;/a&gt; being used for that parser's output. &lt;a href=#refsWEBVTT&gt;[WEBVTT]&lt;/a&gt;&lt;/p&gt;
+    cues&lt;/a&gt; being used for that parser's output. &lt;a href=#refsWEBVTT&gt;[WEBVTT]&lt;/a&gt;&lt;/p&gt;&lt;!-- see also critical block
+    below, and the word &quot;sniffed&quot; in the paragraph after that --&gt;
 
+    &lt;p class=note&gt;The appropriate parser will synchronously (during
+    these &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt;) and incrementally (as each such
+    task is run with whatever data has been received from the network)
+    update the &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt;.&lt;/p&gt;
+
     &lt;p class=critical&gt;This specification does not currently say
     whether or how to check the MIME types of text tracks, or whether
     or how to perform file type sniffing using the actual file data.
@@ -34396,15 +34405,29 @@
     &lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; fails for
     any reason (network error, the server returns an error code, a
     cross-origin check fails, etc), if &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; is the
-    empty string, or if the sniffed type of the resource is not a
-    supported text track format, then &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to
-    first change the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; to &lt;a href=#text-track-failed-to-load title=&quot;text track failed to load&quot;&gt;failed to load&lt;/a&gt; and then
-    &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt; at the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt;
-    element; and then, once that &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; is &lt;a href=#queue-a-task title=&quot;queue a
-    task&quot;&gt;queued&lt;/a&gt;, move on to the step below labeled
-    &lt;i&gt;monitoring&lt;/i&gt;.&lt;/p&gt;
+    empty string, or if the &lt;!--sniffed--&gt; type of the resource is not a
+    supported text track format, then run these steps:
 
-    &lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; does not
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to first change the &lt;a href=#text-track-readiness-state&gt;text
+     track readiness state&lt;/a&gt; to &lt;a href=#text-track-failed-to-load title=&quot;text track failed to
+     load&quot;&gt;failed to load&lt;/a&gt; and then &lt;a href=#fire-a-simple-event&gt;fire a simple
+     event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt; at the
+     &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; is
+     no longer set to &lt;a href=#text-track-loading title=&quot;text track
+     loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#track-url&gt;track URL&lt;/a&gt; is no longer equal
+     to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the &lt;a href=#text-track-mode&gt;text
+     track mode&lt;/a&gt; is set to &lt;a href=#text-track-hidden title=&quot;text track
+     hidden&quot;&gt;hidden&lt;/a&gt;, &lt;a href=#text-track-showing title=&quot;text track
+     showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by
+     default&quot;&gt;showing by default&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;p&gt;If the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; does not
     fail, then the final &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that
     is &lt;a href=#queue-a-task title=&quot;queue a task&quot;&gt;queued&lt;/a&gt; by the
     &lt;a href=#networking-task-source&gt;networking task source&lt;/a&gt; must run the following
@@ -34419,17 +34442,24 @@
       event&lt;/a&gt; named &lt;code title=event-load&gt;load&lt;/code&gt; at the
       &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
 
-      &lt;p&gt;If the file was not successfully processed, e.g. the format
-      in question is an XML format and the file contained a
+      &lt;p&gt;Otherwise, the file was not successfully processed (e.g. the
+      format in question is an XML format and the file contained a
       well-formedness error that the XML specification requires be
-      detected and reported to the application, then &lt;a href=#fire-a-simple-event&gt;fire a
-      simple event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt;
-      at the &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+      detected and reported to the application); &lt;a href=#fire-a-simple-event&gt;fire a simple
+      event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt; at the
+      &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
 
      &lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Jump to the step below labeled &lt;i&gt;monitoring&lt;/i&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#track-url&gt;track URL&lt;/a&gt; is no longer equal
+     to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the &lt;a href=#text-track-mode&gt;text
+     track mode&lt;/a&gt; is set to &lt;a href=#text-track-hidden title=&quot;text track
+     hidden&quot;&gt;hidden&lt;/a&gt;, &lt;a href=#text-track-showing title=&quot;text track
+     showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by
+     default&quot;&gt;showing by default&lt;/a&gt;.&lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/li&gt;
+
     &lt;/ol&gt;&lt;p&gt;If, while the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt; is
     active, either:&lt;/p&gt;
 
@@ -34449,49 +34479,26 @@
 
     &lt;ol&gt;&lt;li&gt;&lt;p&gt;Abort the &lt;a href=#fetch title=fetch&gt;fetching algorithm&lt;/a&gt;,
      discarding any pending &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt;
-     generated by that algorithm.&lt;/li&gt;
+     generated by that algorithm (and in particular, not adding any
+     cues to the &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt; after the moment
+     the URL changed).&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the new &lt;a href=#track-url&gt;track
-     URL&lt;/a&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Jump back to the top of the step labeled
-     &lt;i&gt;download&lt;/i&gt;.&lt;/li&gt;
-
     &lt;/ol&gt;&lt;p&gt;Until one of the above circumstances occurs, the user agent
     must remain on this step.&lt;/p&gt;
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Monitoring&lt;/i&gt;: Wait until the &lt;a href=#track-url&gt;track URL&lt;/a&gt; is
-   no longer equal to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the
-   &lt;a href=#text-track-mode&gt;text track mode&lt;/a&gt; is set to &lt;a href=#text-track-hidden title=&quot;text track
-   hidden&quot;&gt;hidden&lt;/a&gt;, &lt;a href=#text-track-showing title=&quot;text track
-   showing&quot;&gt;showing&lt;/a&gt;, or &lt;a href=#text-track-showing-by-default title=&quot;text track showing by
-   default&quot;&gt;showing by default&lt;/a&gt;.&lt;/li&gt;
+  &lt;/ol&gt;&lt;p&gt;Whenever a &lt;code&gt;&lt;a href=#the-track-element&gt;track&lt;/a&gt;&lt;/code&gt; element has its &lt;code title=attr-track-src&gt;&lt;a href=#attr-track-src&gt;src&lt;/a&gt;&lt;/code&gt; attribute set, changed, or
+  removed, the user agent must synchronously empty the element's
+  &lt;a href=#text-track&gt;text track&lt;/a&gt;'s &lt;a href=#text-track-list-of-cues&gt;text track list of cues&lt;/a&gt;.
+  (This also causes the algorithm above to stop adding cues from the
+  resource being obtained using the previously given URL, if any.)&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Wait until the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; is
-   no longer set to &lt;a href=#text-track-loading title=&quot;text track
-   loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
+  &lt;/div&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#await-a-stable-state&gt;Await a stable state&lt;/a&gt;. The &lt;a href=#synchronous-section&gt;synchronous
-   section&lt;/a&gt; consists of the following step. (The step in the
-   &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; is marked with &#8987;.)&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&#8987; Set the &lt;a href=#text-track-readiness-state&gt;text track readiness state&lt;/a&gt; to
-   &lt;a href=#text-track-loading title=&quot;text track loading&quot;&gt;loading&lt;/a&gt;.&lt;/li&gt;
-
-   &lt;!-- if you add more, change the grammar of the sentences above to
-   be plural with respect to the number of synchronous steps (both in
-   the step above and in the intro to the whole algorithm) --&gt;
-
-   &lt;li&gt;&lt;p&gt;End the &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt;, continuing the
-   remaining steps asynchronously.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;download&lt;/i&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;/div&gt;
-
-
   &lt;div class=impl&gt;
 
   &lt;h6 id=guidelines-for-exposing-cues-in-various-formats-as-text-track-cues&gt;&lt;span class=secno&gt;4.8.10.12.4 &lt;/span&gt;&lt;dfn&gt;Guidelines for exposing cues&lt;/dfn&gt; in various formats as
@@ -34715,7 +34722,7 @@
   &lt;a href=#text-track&gt;text track&lt;/a&gt; that the &lt;code&gt;&lt;a href=#texttrack&gt;TextTrack&lt;/a&gt;&lt;/code&gt; object
   represents.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-texttrack-inbandmetadatatrackdispatchtype title=dom-TextTrack-inBandMetadataTrackDispatchType&gt;inBandMetadataTrackDispatchType&lt;code&gt;&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;dfn id=dom-texttrack-inbandmetadatatrackdispatchtype title=dom-TextTrack-inBandMetadataTrackDispatchType&gt;&lt;code&gt;inBandMetadataTrackDispatchType&lt;/code&gt;&lt;/dfn&gt;
   attribute must return the &lt;a href=#text-track-in-band-metadata-track-dispatch-type&gt;text track in-band metadata track
   dispatch type&lt;/a&gt; of the &lt;a href=#text-track&gt;text track&lt;/a&gt; that the
   &lt;code&gt;&lt;a href=#texttrack&gt;TextTrack&lt;/a&gt;&lt;/code&gt; object represents.&lt;/p&gt;

Modified: source
===================================================================
--- source	2012-09-07 04:07:48 UTC (rev 7325)
+++ source	2012-09-07 21:52:27 UTC (rev 7326)
@@ -36693,7 +36693,7 @@
 
   &lt;p&gt;&lt;dfn&gt;Ducking&lt;/dfn&gt; is the process of reducing the volume of one
   audio track when another audio track is playing, for example
-  occasionally reducing the volume of a the soundtrack to allow the
+  occasionally reducing the volume of a soundtrack to allow the
   viewer to hear an intermittent commentary track.&lt;/p&gt;
 
   (add an &quot;autoduck&quot; attribute that reduces the volume of other media
@@ -37293,6 +37293,10 @@
    label in that data, then the &lt;span title=&quot;text track
    label&quot;&gt;label&lt;/span&gt; must be set to the empty string.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Associate the &lt;span&gt;text track list of cues&lt;/span&gt; with the
+   &lt;span&gt;rules for updating the text track rendering&lt;/span&gt;
+   appropriate for the format in question.&lt;/p&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;If the new &lt;span&gt;text track&lt;/span&gt;'s &lt;span title=&quot;text track
@@ -37392,15 +37396,12 @@
    to load the whole media file just to start playing the first
    frame... --&gt;
 
+   &lt;!-- XXX-MODE-HEURISTIC --&gt;
    &lt;li&gt;&lt;p&gt;Set the new &lt;span&gt;text track&lt;/span&gt;'s &lt;span title=&quot;text
    track mode&quot;&gt;mode&lt;/span&gt; to the mode consistent with the user's
    preferences and the requirements of the relevant specification for
    the data.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Leave the &lt;span&gt;text track list of cues&lt;/span&gt; empty, and
-   associate with it the &lt;span&gt;rules for updating the text track
-   rendering&lt;/span&gt; appropriate for the format in question.&lt;/p&gt;
-
    &lt;li&gt;&lt;p&gt;Add the new &lt;span&gt;text track&lt;/span&gt; to the &lt;span&gt;media
    element&lt;/span&gt;'s &lt;span&gt;list of text tracks&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
@@ -37613,38 +37614,39 @@
   &lt;code&gt;track&lt;/code&gt; element is created with &lt;span&gt;text track
   mode&lt;/span&gt; set to &lt;span title=&quot;text track hidden&quot;&gt;hidden&lt;/span&gt;,
   &lt;span title=&quot;text track showing&quot;&gt;showing&lt;/span&gt;, or &lt;span
-  title=&quot;text track showing by default&quot;&gt;showing by default&lt;/span&gt;,
-  and when a &lt;span&gt;text track&lt;/span&gt; corresponding to a
-  &lt;code&gt;track&lt;/code&gt; element is created with &lt;span&gt;text track
-  mode&lt;/span&gt; set to &lt;span title=&quot;text track
-  disabled&quot;&gt;disabled&lt;/span&gt; and subsequently changes its &lt;span&gt;text
-  track mode&lt;/span&gt; to &lt;span title=&quot;text track hidden&quot;&gt;hidden&lt;/span&gt;,
-  &lt;span title=&quot;text track showing&quot;&gt;showing&lt;/span&gt;, or &lt;span
-  title=&quot;text track showing by default&quot;&gt;showing by default&lt;/span&gt; for
-  the first time, the user agent must immediately and synchronously
-  run the following algorithm. This algorithm interacts closely with
-  the &lt;span&gt;event loop&lt;/span&gt; mechanism; in particular, it has a
-  &lt;span&gt;synchronous section&lt;/span&gt; (which is triggered as part of the
-  &lt;span&gt;event loop&lt;/span&gt; algorithm). The step in that section is
-  marked with &amp;#x231B;.&lt;/p&gt;
+  title=&quot;text track showing by default&quot;&gt;showing by default&lt;/span&gt;, and
+  when a &lt;span&gt;text track&lt;/span&gt; corresponding to a &lt;code&gt;track&lt;/code&gt;
+  element is created with &lt;span&gt;text track mode&lt;/span&gt; set to &lt;span
+  title=&quot;text track disabled&quot;&gt;disabled&lt;/span&gt; and subsequently changes
+  its &lt;span&gt;text track mode&lt;/span&gt; to &lt;span title=&quot;text track
+  hidden&quot;&gt;hidden&lt;/span&gt;, &lt;span title=&quot;text track
+  showing&quot;&gt;showing&lt;/span&gt;, or &lt;span title=&quot;text track showing by
+  default&quot;&gt;showing by default&lt;/span&gt; for the first time, the user
+  agent must asynchronously run the following
+  algorithm. This algorithm interacts closely with the &lt;span&gt;event
+  loop&lt;/span&gt; mechanism; in particular, it has a &lt;span&gt;synchronous
+  section&lt;/span&gt; (which is triggered as part of the &lt;span&gt;event
+  loop&lt;/span&gt; algorithm). The steps in that section are marked with
+  &amp;#x231B;.&lt;/p&gt;
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;Set the &lt;span&gt;text track readiness state&lt;/span&gt; to &lt;span
-   title=&quot;text track loading&quot;&gt;loading&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Top&lt;/i&gt;: &lt;span&gt;Await a stable state&lt;/span&gt;. The
+   &lt;span&gt;synchronous section&lt;/span&gt; consists of the following steps.
+   (The steps in the &lt;span&gt;synchronous section&lt;/span&gt; are marked with
+   &amp;#x231B;.)&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the &lt;span&gt;track URL&lt;/span&gt; of
-   the &lt;code&gt;track&lt;/code&gt; element.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&amp;#x231B; Set the &lt;span&gt;text track readiness state&lt;/span&gt; to
+   &lt;span title=&quot;text track loading&quot;&gt;loading&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Asynchronously run the remaining steps, while continuing
-   with whatever task was responsible for creating the &lt;span&gt;text
-   track&lt;/span&gt; or changing the &lt;span&gt;text track
-   mode&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&amp;#x231B; Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the &lt;span&gt;track
+   URL&lt;/span&gt; of the &lt;code&gt;track&lt;/code&gt; element.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;End the &lt;span&gt;synchronous section&lt;/span&gt;, continuing the
+   remaining steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;&lt;i&gt;Download&lt;/i&gt;: At this point, the text track is downloaded.&lt;/p&gt;
-
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; is not the empty string, perform a
     &lt;span&gt;potentially CORS-enabled fetch&lt;/span&gt; of &lt;var
     title=&quot;&quot;&gt;URL&lt;/var&gt;, with the &lt;i&gt;mode&lt;/i&gt; being the state of the
@@ -37665,14 +37667,22 @@
     algorithm&lt;/span&gt; on the &lt;span&gt;networking task source&lt;/span&gt; to
     process the data as it is being fetched must &lt;!--&lt;span
     title=&quot;Content-Type sniffing&quot;&gt;--&gt;determine the &lt;!--sniffed--&gt; type
-    of a the resource&lt;!--&lt;/span&gt;--&gt;. If the &lt;!--sniffed--&gt; type of the
+    of the resource&lt;!--&lt;/span&gt;--&gt;. If the &lt;!--sniffed--&gt; type of the
     resource is not a supported text track format, the load will fail,
     as described below. Otherwise, the resource's data must be passed
     to the appropriate parser (e.g. the &lt;span&gt;WebVTT parser&lt;/span&gt;&lt;!--
     if the file starts with the &quot;&lt;code title=&quot;&quot;&gt;WEBVTT&lt;/code&gt;&quot;
     signature--&gt;) as it is received, with the &lt;span&gt;text track list of
-    cues&lt;/span&gt; being used for that parser's output. &lt;a href=&quot;#refsWEBVTT&quot;&gt;[WEBVTT]&lt;/a&gt;&lt;/p&gt;
+    cues&lt;/span&gt; being used for that parser's output. &lt;a
+    href=&quot;#refsWEBVTT&quot;&gt;[WEBVTT]&lt;/a&gt;&lt;/p&gt;&lt;!-- see also critical block
+    below, and the word &quot;sniffed&quot; in the paragraph after that --&gt;
 
+    &lt;p class=&quot;note&quot;&gt;The appropriate parser will synchronously (during
+    these &lt;span&gt;networking task source&lt;/span&gt; &lt;span
+    title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt;) and incrementally (as each such
+    task is run with whatever data has been received from the network)
+    update the &lt;span&gt;text track list of cues&lt;/span&gt;.&lt;/p&gt;
+
     &lt;p class=&quot;critical&quot;&gt;This specification does not currently say
     whether or how to check the MIME types of text tracks, or whether
     or how to perform file type sniffing using the actual file data.
@@ -37689,17 +37699,32 @@
     &lt;p&gt;If the &lt;span title=&quot;fetch&quot;&gt;fetching algorithm&lt;/span&gt; fails for
     any reason (network error, the server returns an error code, a
     cross-origin check fails, etc), if &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; is the
-    empty string, or if the sniffed type of the resource is not a
-    supported text track format, then &lt;span&gt;queue a task&lt;/span&gt; to
-    first change the &lt;span&gt;text track readiness state&lt;/span&gt; to &lt;span
-    title=&quot;text track failed to load&quot;&gt;failed to load&lt;/span&gt; and then
-    &lt;span&gt;fire a simple event&lt;/span&gt; named &lt;code
-    title=&quot;event-error&quot;&gt;error&lt;/code&gt; at the &lt;code&gt;track&lt;/code&gt;
-    element; and then, once that &lt;span
-    title=&quot;concept-task&quot;&gt;task&lt;/span&gt; is &lt;span title=&quot;queue a
-    task&quot;&gt;queued&lt;/span&gt;, move on to the step below labeled
-    &lt;i&gt;monitoring&lt;/i&gt;.&lt;/p&gt;
+    empty string, or if the &lt;!--sniffed--&gt; type of the resource is not a
+    supported text track format, then run these steps:
 
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to first change the &lt;span&gt;text
+     track readiness state&lt;/span&gt; to &lt;span title=&quot;text track failed to
+     load&quot;&gt;failed to load&lt;/span&gt; and then &lt;span&gt;fire a simple
+     event&lt;/span&gt; named &lt;code title=&quot;event-error&quot;&gt;error&lt;/code&gt; at the
+     &lt;code&gt;track&lt;/code&gt; element.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;span&gt;text track readiness state&lt;/span&gt; is
+     no longer set to &lt;span title=&quot;text track
+     loading&quot;&gt;loading&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;span&gt;track URL&lt;/span&gt; is no longer equal
+     to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the &lt;span&gt;text
+     track mode&lt;/span&gt; is set to &lt;span title=&quot;text track
+     hidden&quot;&gt;hidden&lt;/span&gt;, &lt;span title=&quot;text track
+     showing&quot;&gt;showing&lt;/span&gt;, or &lt;span title=&quot;text track showing by
+     default&quot;&gt;showing by default&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
     &lt;p&gt;If the &lt;span title=&quot;fetch&quot;&gt;fetching algorithm&lt;/span&gt; does not
     fail, then the final &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; that
     is &lt;span title=&quot;queue a task&quot;&gt;queued&lt;/span&gt; by the
@@ -37717,17 +37742,24 @@
       event&lt;/span&gt; named &lt;code title=&quot;event-load&quot;&gt;load&lt;/code&gt; at the
       &lt;code&gt;track&lt;/code&gt; element.&lt;/p&gt;
 
-      &lt;p&gt;If the file was not successfully processed, e.g. the format
-      in question is an XML format and the file contained a
+      &lt;p&gt;Otherwise, the file was not successfully processed (e.g. the
+      format in question is an XML format and the file contained a
       well-formedness error that the XML specification requires be
-      detected and reported to the application, then &lt;span&gt;fire a
-      simple event&lt;/span&gt; named &lt;code title=&quot;event-error&quot;&gt;error&lt;/code&gt;
-      at the &lt;code&gt;track&lt;/code&gt; element.&lt;/p&gt;
+      detected and reported to the application); &lt;span&gt;fire a simple
+      event&lt;/span&gt; named &lt;code title=&quot;event-error&quot;&gt;error&lt;/code&gt; at the
+      &lt;code&gt;track&lt;/code&gt; element.&lt;/p&gt;
 
      &lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Jump to the step below labeled &lt;i&gt;monitoring&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Wait until the &lt;span&gt;track URL&lt;/span&gt; is no longer equal
+     to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the &lt;span&gt;text
+     track mode&lt;/span&gt; is set to &lt;span title=&quot;text track
+     hidden&quot;&gt;hidden&lt;/span&gt;, &lt;span title=&quot;text track
+     showing&quot;&gt;showing&lt;/span&gt;, or &lt;span title=&quot;text track showing by
+     default&quot;&gt;showing by default&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
+     &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
     &lt;/ol&gt;
 
     &lt;p&gt;If, while the &lt;span title=&quot;fetch&quot;&gt;fetching algorithm&lt;/span&gt; is
@@ -37757,14 +37789,12 @@
 
      &lt;li&gt;&lt;p&gt;Abort the &lt;span title=&quot;fetch&quot;&gt;fetching algorithm&lt;/span&gt;,
      discarding any pending &lt;span title=&quot;concept-task&quot;&gt;tasks&lt;/span&gt;
-     generated by that algorithm.&lt;/p&gt;&lt;/li&gt;
+     generated by that algorithm (and in particular, not adding any
+     cues to the &lt;span&gt;text track list of cues&lt;/span&gt; after the moment
+     the URL changed).&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt; be the new &lt;span&gt;track
-     URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;top&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Jump back to the top of the step labeled
-     &lt;i&gt;download&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
-
     &lt;/ol&gt;
 
     &lt;p&gt;Until one of the above circumstances occurs, the user agent
@@ -37772,35 +37802,15 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Monitoring&lt;/i&gt;: Wait until the &lt;span&gt;track URL&lt;/span&gt; is
-   no longer equal to &lt;var title=&quot;&quot;&gt;URL&lt;/var&gt;, at the same time as the
-   &lt;span&gt;text track mode&lt;/span&gt; is set to &lt;span title=&quot;text track
-   hidden&quot;&gt;hidden&lt;/span&gt;, &lt;span title=&quot;text track
-   showing&quot;&gt;showing&lt;/span&gt;, or &lt;span title=&quot;text track showing by
-   default&quot;&gt;showing by default&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+  &lt;/ol&gt;
 
-   &lt;li&gt;&lt;p&gt;Wait until the &lt;span&gt;text track readiness state&lt;/span&gt; is
-   no longer set to &lt;span title=&quot;text track
-   loading&quot;&gt;loading&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+  &lt;p&gt;Whenever a &lt;code&gt;track&lt;/code&gt; element has its &lt;code
+  title=&quot;attr-track-src&quot;&gt;src&lt;/code&gt; attribute set, changed, or
+  removed, the user agent must synchronously empty the element's
+  &lt;span&gt;text track&lt;/span&gt;'s &lt;span&gt;text track list of cues&lt;/span&gt;.
+  (This also causes the algorithm above to stop adding cues from the
+  resource being obtained using the previously given URL, if any.)&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Await a stable state&lt;/span&gt;. The &lt;span&gt;synchronous
-   section&lt;/span&gt; consists of the following step. (The step in the
-   &lt;span&gt;synchronous section&lt;/span&gt; is marked with &amp;#x231B;.)&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&amp;#x231B; Set the &lt;span&gt;text track readiness state&lt;/span&gt; to
-   &lt;span title=&quot;text track loading&quot;&gt;loading&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;!-- if you add more, change the grammar of the sentences above to
-   be plural with respect to the number of synchronous steps (both in
-   the step above and in the intro to the whole algorithm) --&gt;
-
-   &lt;li&gt;&lt;p&gt;End the &lt;span&gt;synchronous section&lt;/span&gt;, continuing the
-   remaining steps asynchronously.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;download&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
   &lt;/div&gt;
 
 
@@ -38049,7 +38059,7 @@
   represents.&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn
-  title=&quot;dom-TextTrack-inBandMetadataTrackDispatchType&quot;&gt;inBandMetadataTrackDispatchType&lt;code&gt;&lt;/code&gt;&lt;/dfn&gt;
+  title=&quot;dom-TextTrack-inBandMetadataTrackDispatchType&quot;&gt;&lt;code&gt;inBandMetadataTrackDispatchType&lt;/code&gt;&lt;/dfn&gt;
   attribute must return the &lt;span&gt;text track in-band metadata track
   dispatch type&lt;/span&gt; of the &lt;span&gt;text track&lt;/span&gt; that the
   &lt;code&gt;TextTrack&lt;/code&gt; object represents.&lt;/p&gt;


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014188.html">[html5] r7325 - [e] (0) Remove an unnecessary and confusing	conformance statement. Affected topi [...]
</A></li>
	<LI>Next message: <A HREF="014190.html">[html5] r7327 - [giow] (1) Reform the processing model around	loading of text tracks to solve a [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14189">[ date ]</a>
              <a href="thread.html#14189">[ thread ]</a>
              <a href="subject.html#14189">[ subject ]</a>
              <a href="author.html#14189">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
