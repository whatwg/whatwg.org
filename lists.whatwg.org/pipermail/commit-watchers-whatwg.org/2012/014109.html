<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r7244 - [acgiow] (0) Update &lt;ruby&gt;,	including examples showing how each use case is addr [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7244%20-%20%5Bacgiow%5D%20%280%29%20Update%20%3Cruby%3E%2C%0A%09including%20examples%20showing%20how%20each%20use%20case%20is%20addr%20%5B...%5D&In-Reply-To=%3C20120820215842.C088E247C154%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014108.html">
   <LINK REL="Next"  HREF="014110.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r7244 - [acgiow] (0) Update &lt;ruby&gt;,	including examples showing how each use case is addr [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7244%20-%20%5Bacgiow%5D%20%280%29%20Update%20%3Cruby%3E%2C%0A%09including%20examples%20showing%20how%20each%20use%20case%20is%20addr%20%5B...%5D&In-Reply-To=%3C20120820215842.C088E247C154%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r7244 - [acgiow] (0) Update &lt;ruby&gt;,	including examples showing how each use case is addr [...]">whatwg at whatwg.org
       </A><BR>
    <I>Mon Aug 20 14:58:41 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="014108.html">[html5] r7243 - [giow] (2) All the browsers disagree,	so we'll reward the one that makes the mos [...]
</A></li>
        <LI>Next message: <A HREF="014110.html">[html5] r7245 - [e] (0) additional example Affected topics: HTML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14109">[ date ]</a>
              <a href="thread.html#14109">[ thread ]</a>
              <a href="subject.html#14109">[ subject ]</a>
              <a href="author.html#14109">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2012-08-20 14:58:38 -0700 (Mon, 20 Aug 2012)
New Revision: 7244

Modified:
   complete.html
   index
   source
Log:
[acgiow] (0) Update &lt;ruby&gt;, including examples showing how each use case is addressed.
Affected topics: Canvas, DOM APIs, HTML, HTML Syntax and Parsing, Rendering

Modified: complete.html
===================================================================
--- complete.html	2012-08-10 19:49:38 UTC (rev 7243)
+++ complete.html	2012-08-20 21:58:38 UTC (rev 7244)
@@ -246,7 +246,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 10 August 2012&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 20 August 2012&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -3995,7 +3995,7 @@
      &lt;li&gt;The concept of &lt;dfn id=base-url-change-steps&gt;base URL change steps&lt;/dfn&gt; and the definition of what happens when an element is &lt;dfn id=affected-by-a-base-url-change&gt;affected by a base URL change&lt;/dfn&gt;&lt;/li&gt;
      &lt;li&gt;The concept of an element's &lt;dfn id=concept-id title=concept-id&gt;unique identifier (ID)&lt;/dfn&gt;&lt;/li&gt;
 
-     &lt;li&gt;The concept of a DOM &lt;dfn id=concept-range title=concept-range&gt;range&lt;/dfn&gt;.&lt;/li&gt;
+     &lt;li&gt;The concept of a DOM &lt;dfn id=concept-range title=concept-range&gt;range&lt;/dfn&gt;, and the terms &lt;dfn id=concept-range-start title=concept-range-start&gt;start&lt;/dfn&gt;, &lt;dfn id=concept-range-end title=concept-range-end&gt;end&lt;/dfn&gt;, and &lt;dfn id=concept-range-bp title=concept-range-bp&gt;boundary point&lt;/dfn&gt; as applied to ranges.&lt;/li&gt;
 
      &lt;li&gt;&lt;dfn id=mutationobserver&gt;&lt;code&gt;MutationObserver&lt;/code&gt;&lt;/dfn&gt; interface&lt;/li&gt;
      &lt;li&gt;The &lt;dfn id=mutationobserver-scripting-environment&gt;&lt;code&gt;MutationObserver&lt;/code&gt; &lt;var title=&quot;&quot;&gt;scripting environment&lt;/var&gt;&lt;/dfn&gt; concept&lt;/li&gt;
@@ -22693,7 +22693,7 @@
    &lt;dt&gt;&lt;a href=#element-dfn-contexts title=element-dfn-contexts&gt;Contexts in which this element can be used&lt;/a&gt;:&lt;/dt&gt;
    &lt;dd&gt;Where &lt;a href=#phrasing-content&gt;phrasing content&lt;/a&gt; is expected.&lt;/dd&gt;
    &lt;dt&gt;&lt;a href=#element-dfn-content-model title=element-dfn-content-model&gt;Content model&lt;/a&gt;:&lt;/dt&gt;
-   &lt;dd&gt;One or more groups of: &lt;a href=#phrasing-content&gt;phrasing content&lt;/a&gt; followed either by a single &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element, or an &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element, and another &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element.&lt;/dd&gt;
+   &lt;dd&gt;See prose.&lt;/dd&gt;
    &lt;dt&gt;&lt;a href=#element-dfn-attributes title=element-dfn-attributes&gt;Content attributes&lt;/a&gt;:&lt;/dt&gt;
    &lt;dd&gt;&lt;a href=#global-attributes&gt;Global attributes&lt;/a&gt;&lt;/dd&gt;
    &lt;dt&gt;&lt;a href=#element-dfn-dom title=element-dfn-dom&gt;DOM interface&lt;/a&gt;:&lt;/dt&gt;&lt;!--TOPIC:DOM APIs--&gt;
@@ -22705,14 +22705,373 @@
   pronunciation or to include other annotations. In Japanese, this
   form of typography is also known as &lt;i&gt;furigana&lt;/i&gt;.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element &lt;a href=#represents&gt;represents&lt;/a&gt; the spans of
-  phrasing content it contains, ignoring all the child &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt;
-  and &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; elements and their descendants. Those spans of
-  phrasing content have associated annotations created using the
-  &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+  &lt;p&gt;The content model of &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; elements consists of one
+  or more of the following sequences:&lt;/p&gt;
 
-  &lt;div class=example&gt;
+  &lt;ol class=brief&gt;&lt;li&gt;One or the other of the following:
+    &lt;ul class=brief&gt;&lt;li&gt;&lt;a href=#phrasing-content&gt;Phrasing content&lt;/a&gt;, but with no &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; elements and with no &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element descendants
+     &lt;li&gt;A single &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element, but with no further &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element descendants
+    &lt;/ul&gt;&lt;li&gt;One or the other of the following:
+    &lt;ul class=brief&gt;&lt;li&gt;One or more &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements
+     &lt;li&gt;An &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element followed by one or more &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements, each of which is itself followed by an &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element
+    &lt;/ul&gt;&lt;/ol&gt;&lt;!-- ( ( phrasing-content | &lt;ruby&gt; ) ( &lt;rt&gt;+ | &lt;rp&gt; ( &lt;rt&gt; &lt;rp&gt; )+ ) )+ // with further ruby descendant restrictions --&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements can be used
+  for a variety of kinds of annotations, including in particular those
+  described below. For more details on Japanese Ruby in particular,
+  and how to render Ruby for Japanese, see &lt;cite&gt;Requirements for
+  Japanese Text Layout&lt;/cite&gt;. &lt;a href=#refsJLREQ&gt;[JLREQ]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p class=note&gt;At the time of writing, CSS does not yet provide a
+  way to fully control the rendering of the HTML &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt;
+  element. It is hoped that CSS will be extended to support the styles
+  described below in due course.&lt;/p&gt;
+
+  &lt;!-- examples in the following list are mostly based on those in <A HREF="http://www.w3.org/International/datespace/2010/02/jlreq-examples/">http://www.w3.org/International/datespace/2010/02/jlreq-examples/</A> --&gt;
+
+  &lt;dl&gt;&lt;dt&gt;Mono-ruby for individual base characters
+
+   &lt;dd&gt;
+
+    &lt;p&gt;One or more hiragana or katakana characters (the ruby
+    annotation) are placed with each ideographic character (the base
+    text). This is used to provide readings of kanji characters.
+
+    &lt;div class=example&gt; &lt;!-- B as in BASE --&gt;
+     &lt;pre&gt;&lt;ruby&gt;B&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;In this example, notice how each annotation corresponds to a single base character.
+     &lt;pre&gt;&lt;ruby&gt;&#21531;&lt;rt&gt;&#12367;&#12435;&lt;/ruby&gt;&lt;ruby&gt;&#23376;&lt;rt&gt;&#12375;&lt;/ruby&gt;&#12399;&lt;ruby&gt;&#21644;&lt;rt&gt;&#12431;&lt;/ruby&gt;&#12375;&#12390;&lt;ruby&gt;&#21516;&lt;rt&gt;&#12393;&#12358;&lt;/ruby&gt;&#12380;&#12378;&#12290;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#21531;&lt;rt&gt;&#12367;&#12435;&lt;/ruby&gt;&lt;ruby&gt;&#23376;&lt;rt&gt;&#12375;&lt;/ruby&gt;&#12399;&lt;ruby&gt;&#21644;&lt;rt&gt;&#12431;&lt;/ruby&gt;&#12375;&#12390;&lt;ruby&gt;&#21516;&lt;rt&gt;&#12393;&#12358;&lt;/ruby&gt;&#12380;&#12378;&#12290;
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Mono-ruby for compound words (jukugo)
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This is similar to the previous case: each ideographic
+    character in the compound word (the base text) has its reading
+    given in hiragana or katakana characters (the ruby annotation).
+    The difference is that the base text segments form a compound word
+    rather than being separate from each other.
+
+    &lt;div class=example&gt; &lt;!-- B as in BASE --&gt;
+     &lt;pre&gt;&lt;ruby&gt;B&lt;rt&gt;annotation&lt;/rt&gt;B&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;In this example, notice again how each annotation corresponds to a single base character. In this example, each compound word (jukugo) corresponds to a single &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+     &lt;p&gt;The rendering here is expected to be that each annotation be placed over (or next to, in vertical text) the corresponding base character, with the annotations not overhanging any of the adjacent characters.&lt;/p&gt;
+     &lt;pre&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/ruby&gt;&#12377;&#12427;
+
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Jukugo-ruby
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This is semantically identical to the previous case (each
+    individual ideographic character in the base compound word has its
+    reading given in an annotation in hiragana or katakana
+    characters), but the rendering is the more complicated Jukugo Ruby
+    rendering.
+
+    &lt;div class=example&gt;
+     &lt;p&gt;This is the same example as above for mono-ruby for compound words. The different rendering is expected to be achieved using different styling (e.g. in CSS), and is not shown here.&lt;/p&gt;
+     &lt;pre&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;&lt;/pre&gt;
+     &lt;!-- Once CSS is updated to describe this, invoke the CSS and unhide this --&gt;
+     &lt;!--
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;
+     --&gt;
+    &lt;/div&gt;
+
+    &lt;p class=note&gt;For more details on &lt;a href=<A HREF="http://www.w3.org/TR/jlreq/#positioning_of_jukugoruby">http://www.w3.org/TR/jlreq/#positioning_of_jukugoruby</A>&gt;Jukugo
+    Ruby rendering&lt;/a&gt;, see Appendix F in the &lt;cite&gt;Requirements for
+    Japanese Text Layout&lt;/cite&gt;. &lt;a href=#refsJLREQ&gt;[JLREQ]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Group ruby for describing meanings
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The annotation describes the meaning of the base text, rather
+    than (or in addition to) the pronunciation. As such, both the base
+    text and the annotation can be multiple characters long.
+
+    &lt;div class=example&gt;
+     &lt;pre&gt;&lt;ruby&gt;BASE&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;Here a compound ideographic word has its corresponding katakana given as an annotation.
+     &lt;pre&gt;&lt;ruby&gt;&#22659;&#30028;&#38754;&lt;rt&gt;&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12540;&#12473;&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#22659;&#30028;&#38754;&lt;rt&gt;&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12540;&#12473;&lt;/ruby&gt;&lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;Here a compound ideographic word has its translation in English provided as an annotation.
+     &lt;pre&gt;&lt;ruby lang=&quot;ja&quot;&gt;&#32232;&#38598;&#32773;&lt;rt lang=&quot;en&quot;&gt;editor&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p&gt;&lt;ruby lang=ja&gt;&#32232;&#38598;&#32773;&lt;rt lang=en&gt;editor&lt;/ruby&gt;&lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Group ruby for Jukuji readings
+
+   &lt;dd&gt;
+
+    &lt;p&gt;A phonetic reading that corresponds to multiple base
+    characters, because a one-to-one mapping would be difficult. (In
+    English, the words &quot;Colonel&quot; and &quot;Lieutenant&quot; are examples of
+    words where a direct mapping of pronunciation to individual
+    letters is, in some dialects, rather unclear.)
+
+    &lt;div class=example&gt;
+     &lt;p&gt;In this example, the name of a species of flowers has a phonetic reading provided using group ruby:
+     &lt;pre&gt;&lt;ruby&gt;&#32043;&#38525;&#33457;&lt;rt&gt;&#12354;&#12376;&#12373;&#12356;&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#32043;&#38525;&#33457;&lt;rt&gt;&#12354;&#12376;&#12373;&#12356;&lt;/ruby&gt;&lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Text with both phonetic and semantic annotations (double-sided ruby)
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Sometimes, ruby styles described above are combined.
+
+    &lt;div class=example&gt;
+     &lt;pre&gt;&lt;ruby&gt;BASE&lt;rt&gt;annotation 1&lt;rt&gt;annotation 2&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;pre&gt;&lt;ruby&gt;&lt;ruby&gt;B&lt;rt&gt;a&lt;/rt&gt;A&lt;rt&gt;n&lt;/rt&gt;S&lt;rt&gt;t&lt;/rt&gt;E&lt;rt&gt;n&lt;/rt&gt;&lt;/ruby&gt;&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;Here both a phonetic reading and the meaning are given in ruby annotations. The annotation on the nested &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element gives a mono-ruby phonetic annotation for each base character, while the annotation in the &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element that is a child of the outer &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element gives the meaning using hiragana.
+     &lt;pre&gt;&lt;ruby&gt;&lt;ruby&gt;&#26481;&lt;rt&gt;&#12392;&#12358;&lt;/rt&gt;&#21335;&lt;rt&gt;&#12394;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&lt;rt&gt;&#12383;&#12388;&#12415;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&#26041;&#35282;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&lt;ruby&gt;&#26481;&lt;rt&gt;&#12392;&#12358;&lt;/rt&gt;&#21335;&lt;rt&gt;&#12394;&#12435;&lt;/ruby&gt;&lt;rt&gt;&#12383;&#12388;&#12415;&lt;/ruby&gt;&#12398;&#26041;&#35282;
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;hr&gt;&lt;p&gt;Within a &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element that does not have a
+  &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element ancestor, content is segmented and
+  segments are placed into three categories: base text segments,
+  annotation segments, and ignored segments. Ignored segments do not
+  form part of the document's semantics (they consist of some
+  &lt;a href=#inter-element-whitespace&gt;inter-element whitespace&lt;/a&gt; and &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; elements,
+  the latter of which are used for legacy user agents that do not
+  support ruby at all). Base text segments can overlap (with a limit
+  of two segments overlapping any one position in the DOM, and with
+  any segment having an earlier start point than an overlapping
+  segment also having an equal or later end point, and any segment
+  have a later end point than an overlapping segment also having an
+  equal or earlier start point&lt;!-- if anyone can find a better way of
+  phrasing this parenthetical, do let me know! --&gt;). Annotation
+  segments correspond to &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements. Each annotation
+  segment can be associated with a base text segment, and each base
+  text segment can have annotation segments associated with it. (In a
+  conforming document, each base text segment is associated with at
+  least one annotation segment, and each annotation segment is
+  associated with one base text segment.) A &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element
+  &lt;a href=#represents&gt;represents&lt;/a&gt; the union of the segments of base text it
+  contains, along with the mapping from those base text segments to
+  annotation segments. Segments are described in terms of DOM ranges;
+  annotation segment ranges always consist of exactly one element. &lt;a href=#refsDOMCORE&gt;[DOMCORE]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;At any particular time, the segmentation and categorisation of
+  content of a &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element is the result that would be
+  obtained from running the following algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base text segments&lt;/var&gt; be an empty list
+   of base text segments, each potentially with a list of base text
+   subsegments.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;annotation segments&lt;/var&gt; be an empty list
+   of annotation segments, each potentially being associated with a
+   base text segment or subsegment.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt;
+   element for which the algorithm is being run.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has a &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element
+   ancestor, then jump to the step labeled &lt;i&gt;end&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be 0.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parent start index&lt;/var&gt; be null.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; be null.&lt;/li&gt;
+
+
+   &lt;!-- This is spaghetti code. If someone can work out a way to
+   phrase this that is as unambiguous but maps more cleanly to
+   structured code, please let me know. --&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Start mode&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; is equal to
+   or greater than the number of child nodes in &lt;var title=&quot;&quot;&gt;current
+   parent&lt;/var&gt;, then jump to the step labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; or
+   &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, jump to the step labeled &lt;i&gt;annotation
+   mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;!-- if we get here then the first node in a ruby element or after
+   an &lt;rt&gt; or &lt;rp&gt; is something we want in a base text --&gt;
+   
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; to the value of &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Base mode&lt;/i&gt;: If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in
+   &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is a &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element,
+   and if &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is the same element as
+   &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, then &lt;a href=#push-a-ruby-level&gt;push a ruby level&lt;/a&gt; and
+   then jump to the step labeled &lt;i&gt;start mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; or
+   &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, then &lt;a href=#set-the-current-base-text&gt;set the current base
+   text&lt;/a&gt; and then jump to the step labeled &lt;i&gt;annotation
+   mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; by one.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Base mode post-increment&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; is equal to or greater than the number of
+   child nodes in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, then jump to the
+   step labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;base mode&lt;/i&gt;.&lt;/li&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode&lt;/i&gt;: If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th
+   node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt;
+   element, then &lt;a href=#push-a-ruby-annotation&gt;push a ruby annotation&lt;/a&gt; and jump to the
+   step labeled &lt;i&gt;annotation mode increment&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, jump
+   to the step labeled &lt;i&gt;annotation mode increment&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is not a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node, or
+   is a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node that is not &lt;a href=#inter-element-whitespace&gt;inter-element
+   whitespace&lt;/a&gt;, then jump to the step labeled &lt;i&gt;base
+   mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;!-- index points at whitespace --&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode increment&lt;/i&gt;: Let &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; plus
+   one.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode white-space skipper&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; is equal to the number of child
+   nodes in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; then jump to the step
+   labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element or an
+   &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, then set &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; and jump to the step labeled
+   &lt;i&gt;annotation mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is not a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node, or
+   is a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node that is not &lt;a href=#inter-element-whitespace&gt;inter-element
+   whitespace&lt;/a&gt;, then jump to the step labeled &lt;i&gt;base mode&lt;/i&gt;
+   (without further incrementing &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;, so the
+   &lt;a href=#inter-element-whitespace&gt;inter-element whitespace&lt;/a&gt; seen so far becomes part of
+   the next base text segment).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; by
+   one.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;annotation mode white-space
+   skipper&lt;/i&gt;.&lt;/li&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End mode&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is
+   not the same element as &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, then &lt;a href=#pop-a-ruby-level&gt;pop a
+   ruby level&lt;/a&gt; and jump to the step labeled &lt;i&gt;base mode
+   post-increment&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var title=&quot;&quot;&gt;base text segments&lt;/var&gt;
+   and &lt;var title=&quot;&quot;&gt;annotation segments&lt;/var&gt;. Any content of the
+   &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element not described by segments in either of
+   thost lists is implicitly in an &lt;i&gt;ignored segment&lt;/i&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above say to &lt;dfn id=set-the-current-base-text&gt;set the current base text&lt;/dfn&gt;,
+  it means to run the following steps at that point in the
+  algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;text range&lt;/var&gt; a DOM range whose &lt;a href=#concept-range-start title=concept-range-start&gt;start&lt;/a&gt; is the &lt;a href=#concept-range-bp title=concept-range-bp&gt;boundary point&lt;/a&gt; (&lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt;) and
+   whose &lt;a href=#concept-range-end title=concept-range-end&gt;end&lt;/a&gt; is the &lt;a href=#concept-range-bp title=concept-range-bp&gt;boundary point&lt;/a&gt; (&lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new text segment&lt;/var&gt; be a base text
+   segment described by the range &lt;var title=&quot;&quot;&gt;annotation
+   range&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new text segment&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;base text segments&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;new text segment&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above say to &lt;dfn id=push-a-ruby-level&gt;push a ruby level&lt;/dfn&gt;, it
+  means to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current
+   parent&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be 0.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt; to the value of
+   &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above say to &lt;dfn id=pop-a-ruby-level&gt;pop a ruby level&lt;/dfn&gt;, it means
+  to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be the position of &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; by one.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; to the value of
+   &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt; be null.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above say to &lt;dfn id=push-a-ruby-annotation&gt;push a ruby annotation&lt;/dfn&gt;, it
+  means to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;rt&lt;/var&gt; be the &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element
+   that is the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node of &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;annotation range&lt;/var&gt; a DOM range whose
+   &lt;a href=#concept-range-start title=concept-range-start&gt;start&lt;/a&gt; is the &lt;a href=#concept-range-bp title=concept-range-bp&gt;boundary point&lt;/a&gt; (&lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;) and whose
+   &lt;a href=#concept-range-end title=concept-range-end&gt;end&lt;/a&gt; is the &lt;a href=#concept-range-bp title=concept-range-bp&gt;boundary point&lt;/a&gt; (&lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; plus one)
+   (i.e. that contains only &lt;var title=&quot;&quot;&gt;rt&lt;/var&gt;).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; be an
+   annotation segment described by the range &lt;var title=&quot;&quot;&gt;annotation
+   range&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; is not null,
+   associate &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; with &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;annotation segments&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;div class=example&gt;
+
    &lt;!-- this is the hiragana for the word &quot;kanji&quot; (&quot;chinese character&quot;) in japanese --&gt;
    &lt;!-- in japanese, ruby-like typography is called &quot;furigana&quot; --&gt;
 
@@ -22731,7 +23090,7 @@
 
   &lt;div class=example&gt;
 
-   &lt;!-- this is the bopomofo for the word &quot;hanzi&quot; (&quot;chinese character&quot;) in traditional chinese, as used in taiwan --&gt;
+   &lt;!-- this is the zhuyin fuhao (aka bopomofo) for the word &quot;hanzi&quot; (&quot;chinese character&quot;) in traditional chinese, as used in taiwan --&gt;
 
    &lt;p&gt;In this example, each ideograph in the traditional Chinese text
    &lt;span lang=zh-TW title=&quot;&quot;&gt;&#28450;&#23383;&lt;/span&gt; is annotated
@@ -22763,7 +23122,22 @@
 
   &lt;!-- Note: Examples are 32px/16px Stone Sans Sem ITC TT --&gt;
 
+  &lt;div class=example&gt;
 
+   &lt;p&gt;In this more contrived example, the acronym &quot;HTML&quot; has four
+   annotations: one for the whole acronym, briefly describing what it
+   is, one for the letters &quot;HT&quot; expanding them to &quot;Hypertext&quot;, one for
+   the letter &quot;M&quot; expanding it to &quot;Markup&quot;, and one for the letter &quot;L&quot;
+   expanding it to &quot;Language&quot;.&lt;/p&gt;
+
+   &lt;pre&gt;&lt;ruby&gt;
+ &lt;ruby&gt;HT&lt;rt&gt;Hypertext&lt;/rt&gt;M&lt;rt&gt;Markup&lt;/rt&gt;L&lt;rt&gt;Language&lt;/rt&gt;&lt;/ruby&gt;
+ &lt;rt&gt;An abstract language for describing documents and applications
+&lt;/ruby&gt;&lt;/pre&gt;
+
+  &lt;/div&gt;
+
+
   &lt;h4 id=the-rt-element&gt;&lt;span class=secno&gt;4.6.22 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;rt&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
   &lt;dl class=element&gt;&lt;dt&gt;&lt;a href=#element-dfn-categories title=element-dfn-categories&gt;Categories&lt;/a&gt;:&lt;/dt&gt;
@@ -36736,7 +37110,7 @@
 
     &lt;/dl&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is greater than &lt;var title=&quot;&quot;&gt;width&lt;/var&gt;, then jump to the step labeld
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is greater than &lt;var title=&quot;&quot;&gt;width&lt;/var&gt;, then jump to the step labeled
    &lt;i&gt;joins&lt;/i&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;segment length&lt;/var&gt; is greater than zero,
@@ -87991,7 +88365,7 @@
 
    &lt;li&gt;&lt;i&gt;Next byte&lt;/i&gt;: Move &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; so it
    points at the next byte in the input byte stream, and return to the
-   step above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
+   step above labeled &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the &lt;a href=#prescan-a-byte-stream-to-determine-its-encoding&gt;prescan a byte stream to determine its
   encoding&lt;/a&gt; algorithm says to &lt;dfn id=concept-get-attributes-when-sniffing title=concept-get-attributes-when-sniffing&gt;get an attribute&lt;/dfn&gt;,
@@ -96482,6 +96856,16 @@
   &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; elements are expected to be wrapped in anonymous
   boxes whose 'display' property has the value 'ruby-base'. &lt;a href=#refsCSSRUBY&gt;[CSSRUBY]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;When a particular part of a ruby has more than one annotation,
+  the annotations should be distributed on both sides of the base text
+  so as to minimise the stacking of ruby annotations on one side.&lt;/p&gt;
+
+  &lt;p class=note&gt;When it becomes possible to do so, the preceding
+  requirement will be updated to be expressed in terms of CSS ruby.
+  (Currently, CSS ruby does not handle nested &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt;
+  elements or multiple sequential &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements, which is
+  how this semantic is expressed.)&lt;/p&gt;
+
   &lt;p&gt;User agents that do not support correct ruby rendering are
   expected to render parentheses around the text of &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt;
   elements in the absence of &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
@@ -96691,7 +97075,6 @@
 :root:lang(ee),       :not(:lang(ee)) &gt; :lang(ee)             { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
 :root:lang(el),       :not(:lang(el)) &gt; :lang(el)             { quotes: '\00ab' '\00bb' '\201c' '\201d' } /* &laquo; &raquo; &ldquo; &rdquo; */
 :root:lang(en),       :not(:lang(en)) &gt; :lang(en)             { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
-:root:lang(en-GB),    :not(:lang(en-GB)) &gt; :lang(en-GB)       { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
 :root:lang(es),       :not(:lang(es)) &gt; :lang(es)             { quotes: '\201c' '\201d' '\00ab' '\00bb' } /* &ldquo; &rdquo; &laquo; &raquo; */
 :root:lang(et),       :not(:lang(et)) &gt; :lang(et)             { quotes: '\201e' '\201c' '\201a' '\2018' } /* &bdquo; &ldquo; &sbquo; &lsquo; */
 :root:lang(eu),       :not(:lang(eu)) &gt; :lang(eu)             { quotes: '\201c' '\201d' '\00ab' '\00bb' } /* &ldquo; &rdquo; &laquo; &raquo; */
@@ -96773,7 +97156,7 @@
 :root:lang(ses),      :not(:lang(ses)) &gt; :lang(ses)           { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
 :root:lang(sg),       :not(:lang(sg)) &gt; :lang(sg)             { quotes: '\00ab' '\00bb' '\201c' '\201d' } /* &laquo; &raquo; &ldquo; &rdquo; */
 :root:lang(shi),      :not(:lang(shi)) &gt; :lang(shi)           { quotes: '\00ab' '\00bb' '\201e' '\201d' } /* &laquo; &raquo; &bdquo; &rdquo; */
-:root:lang(shi-Tfng), :not(:lang(shi-Tfng)) &gt; :lang(shi-Tfng) { quotes: '\00ab' '\00bb' '\201e' '\201d' } /* &laquo; &raquo; &bdquo; &rdquo; */
+:root:lang(shi-Latn), :not(:lang(shi-Latn)) &gt; :lang(shi-Latn) { quotes: '\00ab' '\00bb' '\201e' '\201d' } /* &laquo; &raquo; &bdquo; &rdquo; */
 :root:lang(si),       :not(:lang(si)) &gt; :lang(si)             { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
 :root:lang(sk),       :not(:lang(sk)) &gt; :lang(sk)             { quotes: '\201e' '\201c' '\201a' '\2018' } /* &bdquo; &ldquo; &sbquo; &lsquo; */
 :root:lang(sl),       :not(:lang(sl)) &gt; :lang(sl)             { quotes: '\201e' '\201c' '\201a' '\2018' } /* &bdquo; &ldquo; &sbquo; &lsquo; */
@@ -104469,6 +104852,9 @@
    character sets &mdash; Part 11: Latin/Thai
    alphabet&lt;/a&gt;&lt;/cite&gt;. ISO.&lt;/dd&gt;
 
+   &lt;dt id=refsJLREQ&gt;[JLREQ]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.w3.org/TR/jlreq/">http://www.w3.org/TR/jlreq/</A>&gt;Requirements for Japanese Text Layout&lt;/a&gt;&lt;/cite&gt;. W3C.&lt;/dd&gt; &lt;!-- too many editors to list --&gt;
+
    &lt;dt id=refsJPEG&gt;[JPEG]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.w3.org/Graphics/JPEG/jfif3.pdf">http://www.w3.org/Graphics/JPEG/jfif3.pdf</A>&gt;JPEG File Interchange Format&lt;/a&gt;&lt;/cite&gt;, E. Hamilton.&lt;/dd&gt;
 
@@ -105148,6 +105534,7 @@
   Ivan Enderlin,
   Ivo Emanuel Gon&ccedil;alves,
   J. King,
+  Jacob Davies,
   Jacques Distler,
   Jake Verbaten,
   James Craig,

Modified: index
===================================================================
--- index	2012-08-10 19:49:38 UTC (rev 7243)
+++ index	2012-08-20 21:58:38 UTC (rev 7244)
@@ -246,7 +246,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 10 August 2012&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 20 August 2012&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -3995,7 +3995,7 @@
      &lt;li&gt;The concept of &lt;dfn id=base-url-change-steps&gt;base URL change steps&lt;/dfn&gt; and the definition of what happens when an element is &lt;dfn id=affected-by-a-base-url-change&gt;affected by a base URL change&lt;/dfn&gt;&lt;/li&gt;
      &lt;li&gt;The concept of an element's &lt;dfn id=concept-id title=concept-id&gt;unique identifier (ID)&lt;/dfn&gt;&lt;/li&gt;
 
-     &lt;li&gt;The concept of a DOM &lt;dfn id=concept-range title=concept-range&gt;range&lt;/dfn&gt;.&lt;/li&gt;
+     &lt;li&gt;The concept of a DOM &lt;dfn id=concept-range title=concept-range&gt;range&lt;/dfn&gt;, and the terms &lt;dfn id=concept-range-start title=concept-range-start&gt;start&lt;/dfn&gt;, &lt;dfn id=concept-range-end title=concept-range-end&gt;end&lt;/dfn&gt;, and &lt;dfn id=concept-range-bp title=concept-range-bp&gt;boundary point&lt;/dfn&gt; as applied to ranges.&lt;/li&gt;
 
      &lt;li&gt;&lt;dfn id=mutationobserver&gt;&lt;code&gt;MutationObserver&lt;/code&gt;&lt;/dfn&gt; interface&lt;/li&gt;
      &lt;li&gt;The &lt;dfn id=mutationobserver-scripting-environment&gt;&lt;code&gt;MutationObserver&lt;/code&gt; &lt;var title=&quot;&quot;&gt;scripting environment&lt;/var&gt;&lt;/dfn&gt; concept&lt;/li&gt;
@@ -22693,7 +22693,7 @@
    &lt;dt&gt;&lt;a href=#element-dfn-contexts title=element-dfn-contexts&gt;Contexts in which this element can be used&lt;/a&gt;:&lt;/dt&gt;
    &lt;dd&gt;Where &lt;a href=#phrasing-content&gt;phrasing content&lt;/a&gt; is expected.&lt;/dd&gt;
    &lt;dt&gt;&lt;a href=#element-dfn-content-model title=element-dfn-content-model&gt;Content model&lt;/a&gt;:&lt;/dt&gt;
-   &lt;dd&gt;One or more groups of: &lt;a href=#phrasing-content&gt;phrasing content&lt;/a&gt; followed either by a single &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element, or an &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element, and another &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element.&lt;/dd&gt;
+   &lt;dd&gt;See prose.&lt;/dd&gt;
    &lt;dt&gt;&lt;a href=#element-dfn-attributes title=element-dfn-attributes&gt;Content attributes&lt;/a&gt;:&lt;/dt&gt;
    &lt;dd&gt;&lt;a href=#global-attributes&gt;Global attributes&lt;/a&gt;&lt;/dd&gt;
    &lt;dt&gt;&lt;a href=#element-dfn-dom title=element-dfn-dom&gt;DOM interface&lt;/a&gt;:&lt;/dt&gt;&lt;!--TOPIC:DOM APIs--&gt;
@@ -22705,14 +22705,373 @@
   pronunciation or to include other annotations. In Japanese, this
   form of typography is also known as &lt;i&gt;furigana&lt;/i&gt;.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element &lt;a href=#represents&gt;represents&lt;/a&gt; the spans of
-  phrasing content it contains, ignoring all the child &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt;
-  and &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; elements and their descendants. Those spans of
-  phrasing content have associated annotations created using the
-  &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+  &lt;p&gt;The content model of &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; elements consists of one
+  or more of the following sequences:&lt;/p&gt;
 
-  &lt;div class=example&gt;
+  &lt;ol class=brief&gt;&lt;li&gt;One or the other of the following:
+    &lt;ul class=brief&gt;&lt;li&gt;&lt;a href=#phrasing-content&gt;Phrasing content&lt;/a&gt;, but with no &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; elements and with no &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element descendants
+     &lt;li&gt;A single &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element, but with no further &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element descendants
+    &lt;/ul&gt;&lt;li&gt;One or the other of the following:
+    &lt;ul class=brief&gt;&lt;li&gt;One or more &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements
+     &lt;li&gt;An &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element followed by one or more &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements, each of which is itself followed by an &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element
+    &lt;/ul&gt;&lt;/ol&gt;&lt;!-- ( ( phrasing-content | &lt;ruby&gt; ) ( &lt;rt&gt;+ | &lt;rp&gt; ( &lt;rt&gt; &lt;rp&gt; )+ ) )+ // with further ruby descendant restrictions --&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; and &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements can be used
+  for a variety of kinds of annotations, including in particular those
+  described below. For more details on Japanese Ruby in particular,
+  and how to render Ruby for Japanese, see &lt;cite&gt;Requirements for
+  Japanese Text Layout&lt;/cite&gt;. &lt;a href=#refsJLREQ&gt;[JLREQ]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p class=note&gt;At the time of writing, CSS does not yet provide a
+  way to fully control the rendering of the HTML &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt;
+  element. It is hoped that CSS will be extended to support the styles
+  described below in due course.&lt;/p&gt;
+
+  &lt;!-- examples in the following list are mostly based on those in <A HREF="http://www.w3.org/International/datespace/2010/02/jlreq-examples/">http://www.w3.org/International/datespace/2010/02/jlreq-examples/</A> --&gt;
+
+  &lt;dl&gt;&lt;dt&gt;Mono-ruby for individual base characters
+
+   &lt;dd&gt;
+
+    &lt;p&gt;One or more hiragana or katakana characters (the ruby
+    annotation) are placed with each ideographic character (the base
+    text). This is used to provide readings of kanji characters.
+
+    &lt;div class=example&gt; &lt;!-- B as in BASE --&gt;
+     &lt;pre&gt;&lt;ruby&gt;B&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;In this example, notice how each annotation corresponds to a single base character.
+     &lt;pre&gt;&lt;ruby&gt;&#21531;&lt;rt&gt;&#12367;&#12435;&lt;/ruby&gt;&lt;ruby&gt;&#23376;&lt;rt&gt;&#12375;&lt;/ruby&gt;&#12399;&lt;ruby&gt;&#21644;&lt;rt&gt;&#12431;&lt;/ruby&gt;&#12375;&#12390;&lt;ruby&gt;&#21516;&lt;rt&gt;&#12393;&#12358;&lt;/ruby&gt;&#12380;&#12378;&#12290;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#21531;&lt;rt&gt;&#12367;&#12435;&lt;/ruby&gt;&lt;ruby&gt;&#23376;&lt;rt&gt;&#12375;&lt;/ruby&gt;&#12399;&lt;ruby&gt;&#21644;&lt;rt&gt;&#12431;&lt;/ruby&gt;&#12375;&#12390;&lt;ruby&gt;&#21516;&lt;rt&gt;&#12393;&#12358;&lt;/ruby&gt;&#12380;&#12378;&#12290;
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Mono-ruby for compound words (jukugo)
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This is similar to the previous case: each ideographic
+    character in the compound word (the base text) has its reading
+    given in hiragana or katakana characters (the ruby annotation).
+    The difference is that the base text segments form a compound word
+    rather than being separate from each other.
+
+    &lt;div class=example&gt; &lt;!-- B as in BASE --&gt;
+     &lt;pre&gt;&lt;ruby&gt;B&lt;rt&gt;annotation&lt;/rt&gt;B&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;In this example, notice again how each annotation corresponds to a single base character. In this example, each compound word (jukugo) corresponds to a single &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element.&lt;/p&gt;
+     &lt;p&gt;The rendering here is expected to be that each annotation be placed over (or next to, in vertical text) the corresponding base character, with the annotations not overhanging any of the adjacent characters.&lt;/p&gt;
+     &lt;pre&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/ruby&gt;&#12377;&#12427;
+
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Jukugo-ruby
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This is semantically identical to the previous case (each
+    individual ideographic character in the base compound word has its
+    reading given in an annotation in hiragana or katakana
+    characters), but the rendering is the more complicated Jukugo Ruby
+    rendering.
+
+    &lt;div class=example&gt;
+     &lt;p&gt;This is the same example as above for mono-ruby for compound words. The different rendering is expected to be achieved using different styling (e.g. in CSS), and is not shown here.&lt;/p&gt;
+     &lt;pre&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;&lt;/pre&gt;
+     &lt;!-- Once CSS is updated to describe this, invoke the CSS and unhide this --&gt;
+     &lt;!--
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;
+     --&gt;
+    &lt;/div&gt;
+
+    &lt;p class=note&gt;For more details on &lt;a href=<A HREF="http://www.w3.org/TR/jlreq/#positioning_of_jukugoruby">http://www.w3.org/TR/jlreq/#positioning_of_jukugoruby</A>&gt;Jukugo
+    Ruby rendering&lt;/a&gt;, see Appendix F in the &lt;cite&gt;Requirements for
+    Japanese Text Layout&lt;/cite&gt;. &lt;a href=#refsJLREQ&gt;[JLREQ]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Group ruby for describing meanings
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The annotation describes the meaning of the base text, rather
+    than (or in addition to) the pronunciation. As such, both the base
+    text and the annotation can be multiple characters long.
+
+    &lt;div class=example&gt;
+     &lt;pre&gt;&lt;ruby&gt;BASE&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;Here a compound ideographic word has its corresponding katakana given as an annotation.
+     &lt;pre&gt;&lt;ruby&gt;&#22659;&#30028;&#38754;&lt;rt&gt;&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12540;&#12473;&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#22659;&#30028;&#38754;&lt;rt&gt;&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12540;&#12473;&lt;/ruby&gt;&lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;Here a compound ideographic word has its translation in English provided as an annotation.
+     &lt;pre&gt;&lt;ruby lang=&quot;ja&quot;&gt;&#32232;&#38598;&#32773;&lt;rt lang=&quot;en&quot;&gt;editor&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p&gt;&lt;ruby lang=ja&gt;&#32232;&#38598;&#32773;&lt;rt lang=en&gt;editor&lt;/ruby&gt;&lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Group ruby for Jukuji readings
+
+   &lt;dd&gt;
+
+    &lt;p&gt;A phonetic reading that corresponds to multiple base
+    characters, because a one-to-one mapping would be difficult. (In
+    English, the words &quot;Colonel&quot; and &quot;Lieutenant&quot; are examples of
+    words where a direct mapping of pronunciation to individual
+    letters is, in some dialects, rather unclear.)
+
+    &lt;div class=example&gt;
+     &lt;p&gt;In this example, the name of a species of flowers has a phonetic reading provided using group ruby:
+     &lt;pre&gt;&lt;ruby&gt;&#32043;&#38525;&#33457;&lt;rt&gt;&#12354;&#12376;&#12373;&#12356;&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#32043;&#38525;&#33457;&lt;rt&gt;&#12354;&#12376;&#12373;&#12356;&lt;/ruby&gt;&lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Text with both phonetic and semantic annotations (double-sided ruby)
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Sometimes, ruby styles described above are combined.
+
+    &lt;div class=example&gt;
+     &lt;pre&gt;&lt;ruby&gt;BASE&lt;rt&gt;annotation 1&lt;rt&gt;annotation 2&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;pre&gt;&lt;ruby&gt;&lt;ruby&gt;B&lt;rt&gt;a&lt;/rt&gt;A&lt;rt&gt;n&lt;/rt&gt;S&lt;rt&gt;t&lt;/rt&gt;E&lt;rt&gt;n&lt;/rt&gt;&lt;/ruby&gt;&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=example&gt;
+     &lt;p&gt;Here both a phonetic reading and the meaning are given in ruby annotations. The annotation on the nested &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element gives a mono-ruby phonetic annotation for each base character, while the annotation in the &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element that is a child of the outer &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element gives the meaning using hiragana.
+     &lt;pre&gt;&lt;ruby&gt;&lt;ruby&gt;&#26481;&lt;rt&gt;&#12392;&#12358;&lt;/rt&gt;&#21335;&lt;rt&gt;&#12394;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&lt;rt&gt;&#12383;&#12388;&#12415;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&#26041;&#35282;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&lt;ruby&gt;&#26481;&lt;rt&gt;&#12392;&#12358;&lt;/rt&gt;&#21335;&lt;rt&gt;&#12394;&#12435;&lt;/ruby&gt;&lt;rt&gt;&#12383;&#12388;&#12415;&lt;/ruby&gt;&#12398;&#26041;&#35282;
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;hr&gt;&lt;p&gt;Within a &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element that does not have a
+  &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element ancestor, content is segmented and
+  segments are placed into three categories: base text segments,
+  annotation segments, and ignored segments. Ignored segments do not
+  form part of the document's semantics (they consist of some
+  &lt;a href=#inter-element-whitespace&gt;inter-element whitespace&lt;/a&gt; and &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; elements,
+  the latter of which are used for legacy user agents that do not
+  support ruby at all). Base text segments can overlap (with a limit
+  of two segments overlapping any one position in the DOM, and with
+  any segment having an earlier start point than an overlapping
+  segment also having an equal or later end point, and any segment
+  have a later end point than an overlapping segment also having an
+  equal or earlier start point&lt;!-- if anyone can find a better way of
+  phrasing this parenthetical, do let me know! --&gt;). Annotation
+  segments correspond to &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements. Each annotation
+  segment can be associated with a base text segment, and each base
+  text segment can have annotation segments associated with it. (In a
+  conforming document, each base text segment is associated with at
+  least one annotation segment, and each annotation segment is
+  associated with one base text segment.) A &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element
+  &lt;a href=#represents&gt;represents&lt;/a&gt; the union of the segments of base text it
+  contains, along with the mapping from those base text segments to
+  annotation segments. Segments are described in terms of DOM ranges;
+  annotation segment ranges always consist of exactly one element. &lt;a href=#refsDOMCORE&gt;[DOMCORE]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;At any particular time, the segmentation and categorisation of
+  content of a &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element is the result that would be
+  obtained from running the following algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base text segments&lt;/var&gt; be an empty list
+   of base text segments, each potentially with a list of base text
+   subsegments.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;annotation segments&lt;/var&gt; be an empty list
+   of annotation segments, each potentially being associated with a
+   base text segment or subsegment.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt;
+   element for which the algorithm is being run.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has a &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element
+   ancestor, then jump to the step labeled &lt;i&gt;end&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be 0.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parent start index&lt;/var&gt; be null.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; be null.&lt;/li&gt;
+
+
+   &lt;!-- This is spaghetti code. If someone can work out a way to
+   phrase this that is as unambiguous but maps more cleanly to
+   structured code, please let me know. --&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Start mode&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; is equal to
+   or greater than the number of child nodes in &lt;var title=&quot;&quot;&gt;current
+   parent&lt;/var&gt;, then jump to the step labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; or
+   &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, jump to the step labeled &lt;i&gt;annotation
+   mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;!-- if we get here then the first node in a ruby element or after
+   an &lt;rt&gt; or &lt;rp&gt; is something we want in a base text --&gt;
+   
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; to the value of &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Base mode&lt;/i&gt;: If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in
+   &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is a &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element,
+   and if &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is the same element as
+   &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, then &lt;a href=#push-a-ruby-level&gt;push a ruby level&lt;/a&gt; and
+   then jump to the step labeled &lt;i&gt;start mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; or
+   &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, then &lt;a href=#set-the-current-base-text&gt;set the current base
+   text&lt;/a&gt; and then jump to the step labeled &lt;i&gt;annotation
+   mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; by one.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Base mode post-increment&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; is equal to or greater than the number of
+   child nodes in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, then jump to the
+   step labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;base mode&lt;/i&gt;.&lt;/li&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode&lt;/i&gt;: If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th
+   node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt;
+   element, then &lt;a href=#push-a-ruby-annotation&gt;push a ruby annotation&lt;/a&gt; and jump to the
+   step labeled &lt;i&gt;annotation mode increment&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, jump
+   to the step labeled &lt;i&gt;annotation mode increment&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is not a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node, or
+   is a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node that is not &lt;a href=#inter-element-whitespace&gt;inter-element
+   whitespace&lt;/a&gt;, then jump to the step labeled &lt;i&gt;base
+   mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;!-- index points at whitespace --&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode increment&lt;/i&gt;: Let &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; plus
+   one.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode white-space skipper&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; is equal to the number of child
+   nodes in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; then jump to the step
+   labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element or an
+   &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; element, then set &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; and jump to the step labeled
+   &lt;i&gt;annotation mode&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is not a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node, or
+   is a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node that is not &lt;a href=#inter-element-whitespace&gt;inter-element
+   whitespace&lt;/a&gt;, then jump to the step labeled &lt;i&gt;base mode&lt;/i&gt;
+   (without further incrementing &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;, so the
+   &lt;a href=#inter-element-whitespace&gt;inter-element whitespace&lt;/a&gt; seen so far becomes part of
+   the next base text segment).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; by
+   one.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;annotation mode white-space
+   skipper&lt;/i&gt;.&lt;/li&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End mode&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is
+   not the same element as &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, then &lt;a href=#pop-a-ruby-level&gt;pop a
+   ruby level&lt;/a&gt; and jump to the step labeled &lt;i&gt;base mode
+   post-increment&lt;/i&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var title=&quot;&quot;&gt;base text segments&lt;/var&gt;
+   and &lt;var title=&quot;&quot;&gt;annotation segments&lt;/var&gt;. Any content of the
+   &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt; element not described by segments in either of
+   thost lists is implicitly in an &lt;i&gt;ignored segment&lt;/i&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above say to &lt;dfn id=set-the-current-base-text&gt;set the current base text&lt;/dfn&gt;,
+  it means to run the following steps at that point in the
+  algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;text range&lt;/var&gt; a DOM range whose &lt;a href=#concept-range-start title=concept-range-start&gt;start&lt;/a&gt; is the &lt;a href=#concept-range-bp title=concept-range-bp&gt;boundary point&lt;/a&gt; (&lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt;) and
+   whose &lt;a href=#concept-range-end title=concept-range-end&gt;end&lt;/a&gt; is the &lt;a href=#concept-range-bp title=concept-range-bp&gt;boundary point&lt;/a&gt; (&lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new text segment&lt;/var&gt; be a base text
+   segment described by the range &lt;var title=&quot;&quot;&gt;annotation
+   range&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new text segment&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;base text segments&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;new text segment&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above say to &lt;dfn id=push-a-ruby-level&gt;push a ruby level&lt;/dfn&gt;, it
+  means to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current
+   parent&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be 0.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt; to the value of
+   &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above say to &lt;dfn id=pop-a-ruby-level&gt;pop a ruby level&lt;/dfn&gt;, it means
+  to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be the position of &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; by one.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; to the value of
+   &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt; be null.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When the steps above say to &lt;dfn id=push-a-ruby-annotation&gt;push a ruby annotation&lt;/dfn&gt;, it
+  means to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;rt&lt;/var&gt; be the &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; element
+   that is the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node of &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;annotation range&lt;/var&gt; a DOM range whose
+   &lt;a href=#concept-range-start title=concept-range-start&gt;start&lt;/a&gt; is the &lt;a href=#concept-range-bp title=concept-range-bp&gt;boundary point&lt;/a&gt; (&lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;) and whose
+   &lt;a href=#concept-range-end title=concept-range-end&gt;end&lt;/a&gt; is the &lt;a href=#concept-range-bp title=concept-range-bp&gt;boundary point&lt;/a&gt; (&lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; plus one)
+   (i.e. that contains only &lt;var title=&quot;&quot;&gt;rt&lt;/var&gt;).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; be an
+   annotation segment described by the range &lt;var title=&quot;&quot;&gt;annotation
+   range&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; is not null,
+   associate &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; with &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;annotation segments&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;div class=example&gt;
+
    &lt;!-- this is the hiragana for the word &quot;kanji&quot; (&quot;chinese character&quot;) in japanese --&gt;
    &lt;!-- in japanese, ruby-like typography is called &quot;furigana&quot; --&gt;
 
@@ -22731,7 +23090,7 @@
 
   &lt;div class=example&gt;
 
-   &lt;!-- this is the bopomofo for the word &quot;hanzi&quot; (&quot;chinese character&quot;) in traditional chinese, as used in taiwan --&gt;
+   &lt;!-- this is the zhuyin fuhao (aka bopomofo) for the word &quot;hanzi&quot; (&quot;chinese character&quot;) in traditional chinese, as used in taiwan --&gt;
 
    &lt;p&gt;In this example, each ideograph in the traditional Chinese text
    &lt;span lang=zh-TW title=&quot;&quot;&gt;&#28450;&#23383;&lt;/span&gt; is annotated
@@ -22763,7 +23122,22 @@
 
   &lt;!-- Note: Examples are 32px/16px Stone Sans Sem ITC TT --&gt;
 
+  &lt;div class=example&gt;
 
+   &lt;p&gt;In this more contrived example, the acronym &quot;HTML&quot; has four
+   annotations: one for the whole acronym, briefly describing what it
+   is, one for the letters &quot;HT&quot; expanding them to &quot;Hypertext&quot;, one for
+   the letter &quot;M&quot; expanding it to &quot;Markup&quot;, and one for the letter &quot;L&quot;
+   expanding it to &quot;Language&quot;.&lt;/p&gt;
+
+   &lt;pre&gt;&lt;ruby&gt;
+ &lt;ruby&gt;HT&lt;rt&gt;Hypertext&lt;/rt&gt;M&lt;rt&gt;Markup&lt;/rt&gt;L&lt;rt&gt;Language&lt;/rt&gt;&lt;/ruby&gt;
+ &lt;rt&gt;An abstract language for describing documents and applications
+&lt;/ruby&gt;&lt;/pre&gt;
+
+  &lt;/div&gt;
+
+
   &lt;h4 id=the-rt-element&gt;&lt;span class=secno&gt;4.6.22 &lt;/span&gt;The &lt;dfn&gt;&lt;code&gt;rt&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
   &lt;dl class=element&gt;&lt;dt&gt;&lt;a href=#element-dfn-categories title=element-dfn-categories&gt;Categories&lt;/a&gt;:&lt;/dt&gt;
@@ -36736,7 +37110,7 @@
 
     &lt;/dl&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is greater than &lt;var title=&quot;&quot;&gt;width&lt;/var&gt;, then jump to the step labeld
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is greater than &lt;var title=&quot;&quot;&gt;width&lt;/var&gt;, then jump to the step labeled
    &lt;i&gt;joins&lt;/i&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;segment length&lt;/var&gt; is greater than zero,
@@ -87991,7 +88365,7 @@
 
    &lt;li&gt;&lt;i&gt;Next byte&lt;/i&gt;: Move &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; so it
    points at the next byte in the input byte stream, and return to the
-   step above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
+   step above labeled &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;When the &lt;a href=#prescan-a-byte-stream-to-determine-its-encoding&gt;prescan a byte stream to determine its
   encoding&lt;/a&gt; algorithm says to &lt;dfn id=concept-get-attributes-when-sniffing title=concept-get-attributes-when-sniffing&gt;get an attribute&lt;/dfn&gt;,
@@ -96482,6 +96856,16 @@
   &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; elements are expected to be wrapped in anonymous
   boxes whose 'display' property has the value 'ruby-base'. &lt;a href=#refsCSSRUBY&gt;[CSSRUBY]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;When a particular part of a ruby has more than one annotation,
+  the annotations should be distributed on both sides of the base text
+  so as to minimise the stacking of ruby annotations on one side.&lt;/p&gt;
+
+  &lt;p class=note&gt;When it becomes possible to do so, the preceding
+  requirement will be updated to be expressed in terms of CSS ruby.
+  (Currently, CSS ruby does not handle nested &lt;code&gt;&lt;a href=#the-ruby-element&gt;ruby&lt;/a&gt;&lt;/code&gt;
+  elements or multiple sequential &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt; elements, which is
+  how this semantic is expressed.)&lt;/p&gt;
+
   &lt;p&gt;User agents that do not support correct ruby rendering are
   expected to render parentheses around the text of &lt;code&gt;&lt;a href=#the-rt-element&gt;rt&lt;/a&gt;&lt;/code&gt;
   elements in the absence of &lt;code&gt;&lt;a href=#the-rp-element&gt;rp&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
@@ -96691,7 +97075,6 @@
 :root:lang(ee),       :not(:lang(ee)) &gt; :lang(ee)             { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
 :root:lang(el),       :not(:lang(el)) &gt; :lang(el)             { quotes: '\00ab' '\00bb' '\201c' '\201d' } /* &laquo; &raquo; &ldquo; &rdquo; */
 :root:lang(en),       :not(:lang(en)) &gt; :lang(en)             { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
-:root:lang(en-GB),    :not(:lang(en-GB)) &gt; :lang(en-GB)       { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
 :root:lang(es),       :not(:lang(es)) &gt; :lang(es)             { quotes: '\201c' '\201d' '\00ab' '\00bb' } /* &ldquo; &rdquo; &laquo; &raquo; */
 :root:lang(et),       :not(:lang(et)) &gt; :lang(et)             { quotes: '\201e' '\201c' '\201a' '\2018' } /* &bdquo; &ldquo; &sbquo; &lsquo; */
 :root:lang(eu),       :not(:lang(eu)) &gt; :lang(eu)             { quotes: '\201c' '\201d' '\00ab' '\00bb' } /* &ldquo; &rdquo; &laquo; &raquo; */
@@ -96773,7 +97156,7 @@
 :root:lang(ses),      :not(:lang(ses)) &gt; :lang(ses)           { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
 :root:lang(sg),       :not(:lang(sg)) &gt; :lang(sg)             { quotes: '\00ab' '\00bb' '\201c' '\201d' } /* &laquo; &raquo; &ldquo; &rdquo; */
 :root:lang(shi),      :not(:lang(shi)) &gt; :lang(shi)           { quotes: '\00ab' '\00bb' '\201e' '\201d' } /* &laquo; &raquo; &bdquo; &rdquo; */
-:root:lang(shi-Tfng), :not(:lang(shi-Tfng)) &gt; :lang(shi-Tfng) { quotes: '\00ab' '\00bb' '\201e' '\201d' } /* &laquo; &raquo; &bdquo; &rdquo; */
+:root:lang(shi-Latn), :not(:lang(shi-Latn)) &gt; :lang(shi-Latn) { quotes: '\00ab' '\00bb' '\201e' '\201d' } /* &laquo; &raquo; &bdquo; &rdquo; */
 :root:lang(si),       :not(:lang(si)) &gt; :lang(si)             { quotes: '\201c' '\201d' '\2018' '\2019' } /* &ldquo; &rdquo; &lsquo; &rsquo; */
 :root:lang(sk),       :not(:lang(sk)) &gt; :lang(sk)             { quotes: '\201e' '\201c' '\201a' '\2018' } /* &bdquo; &ldquo; &sbquo; &lsquo; */
 :root:lang(sl),       :not(:lang(sl)) &gt; :lang(sl)             { quotes: '\201e' '\201c' '\201a' '\2018' } /* &bdquo; &ldquo; &sbquo; &lsquo; */
@@ -104469,6 +104852,9 @@
    character sets &mdash; Part 11: Latin/Thai
    alphabet&lt;/a&gt;&lt;/cite&gt;. ISO.&lt;/dd&gt;
 
+   &lt;dt id=refsJLREQ&gt;[JLREQ]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.w3.org/TR/jlreq/">http://www.w3.org/TR/jlreq/</A>&gt;Requirements for Japanese Text Layout&lt;/a&gt;&lt;/cite&gt;. W3C.&lt;/dd&gt; &lt;!-- too many editors to list --&gt;
+
    &lt;dt id=refsJPEG&gt;[JPEG]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://www.w3.org/Graphics/JPEG/jfif3.pdf">http://www.w3.org/Graphics/JPEG/jfif3.pdf</A>&gt;JPEG File Interchange Format&lt;/a&gt;&lt;/cite&gt;, E. Hamilton.&lt;/dd&gt;
 
@@ -105148,6 +105534,7 @@
   Ivan Enderlin,
   Ivo Emanuel Gon&ccedil;alves,
   J. King,
+  Jacob Davies,
   Jacques Distler,
   Jake Verbaten,
   James Craig,

Modified: source
===================================================================
--- source	2012-08-10 19:49:38 UTC (rev 7243)
+++ source	2012-08-20 21:58:38 UTC (rev 7244)
@@ -2928,7 +2928,7 @@
      &lt;li&gt;The concept of &lt;dfn&gt;base URL change steps&lt;/dfn&gt; and the definition of what happens when an element is &lt;dfn&gt;affected by a base URL change&lt;/dfn&gt;&lt;/li&gt;
      &lt;li&gt;The concept of an element's &lt;dfn title=&quot;concept-id&quot;&gt;unique identifier (ID)&lt;/dfn&gt;&lt;/li&gt;
 
-     &lt;li&gt;The concept of a DOM &lt;dfn title=&quot;concept-range&quot;&gt;range&lt;/dfn&gt;.&lt;/li&gt;
+     &lt;li&gt;The concept of a DOM &lt;dfn title=&quot;concept-range&quot;&gt;range&lt;/dfn&gt;, and the terms &lt;dfn title=&quot;concept-range-start&quot;&gt;start&lt;/dfn&gt;, &lt;dfn title=&quot;concept-range-end&quot;&gt;end&lt;/dfn&gt;, and &lt;dfn title=&quot;concept-range-bp&quot;&gt;boundary point&lt;/dfn&gt; as applied to ranges.&lt;/li&gt;
 
      &lt;li&gt;&lt;dfn&gt;&lt;code&gt;MutationObserver&lt;/code&gt;&lt;/dfn&gt; interface&lt;/li&gt;
      &lt;li&gt;The &lt;dfn&gt;&lt;code&gt;MutationObserver&lt;/code&gt; &lt;var title=&quot;&quot;&gt;scripting environment&lt;/var&gt;&lt;/dfn&gt; concept&lt;/li&gt;
@@ -24310,7 +24310,7 @@
    &lt;dt&gt;&lt;span title=&quot;element-dfn-contexts&quot;&gt;Contexts in which this element can be used&lt;/span&gt;:&lt;/dt&gt;
    &lt;dd&gt;Where &lt;span&gt;phrasing content&lt;/span&gt; is expected.&lt;/dd&gt;
    &lt;dt&gt;&lt;span title=&quot;element-dfn-content-model&quot;&gt;Content model&lt;/span&gt;:&lt;/dt&gt;
-   &lt;dd&gt;One or more groups of: &lt;span&gt;phrasing content&lt;/span&gt; followed either by a single &lt;code&gt;rt&lt;/code&gt; element, or an &lt;code&gt;rp&lt;/code&gt; element, an &lt;code&gt;rt&lt;/code&gt; element, and another &lt;code&gt;rp&lt;/code&gt; element.&lt;/dd&gt;
+   &lt;dd&gt;See prose.&lt;/dd&gt;
    &lt;dt&gt;&lt;span title=&quot;element-dfn-attributes&quot;&gt;Content attributes&lt;/span&gt;:&lt;/dt&gt;
    &lt;dd&gt;&lt;span&gt;Global attributes&lt;/span&gt;&lt;/dd&gt;
    &lt;dt&gt;&lt;span title=&quot;element-dfn-dom&quot;&gt;DOM interface&lt;/span&gt;:&lt;/dt&gt;&lt;!--TOPIC:DOM APIs--&gt;
@@ -24324,12 +24324,444 @@
   pronunciation or to include other annotations. In Japanese, this
   form of typography is also known as &lt;i&gt;furigana&lt;/i&gt;.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;code&gt;ruby&lt;/code&gt; element &lt;span&gt;represents&lt;/span&gt; the spans of
-  phrasing content it contains, ignoring all the child &lt;code&gt;rt&lt;/code&gt;
-  and &lt;code&gt;rp&lt;/code&gt; elements and their descendants. Those spans of
-  phrasing content have associated annotations created using the
-  &lt;code&gt;rt&lt;/code&gt; element.&lt;/p&gt;
+  &lt;p&gt;The content model of &lt;code&gt;ruby&lt;/code&gt; elements consists of one
+  or more of the following sequences:&lt;/p&gt;
 
+  &lt;ol class=&quot;brief&quot;&gt;
+   &lt;li&gt;One or the other of the following:
+    &lt;ul class=&quot;brief&quot;&gt;
+     &lt;li&gt;&lt;span&gt;Phrasing content&lt;/span&gt;, but with no &lt;code&gt;ruby&lt;/code&gt; elements and with no &lt;code&gt;ruby&lt;/code&gt; element descendants
+     &lt;li&gt;A single &lt;code&gt;ruby&lt;/code&gt; element, but with no further &lt;code&gt;ruby&lt;/code&gt; element descendants
+    &lt;/ul&gt;
+   &lt;li&gt;One or the other of the following:
+    &lt;ul class=&quot;brief&quot;&gt;
+     &lt;li&gt;One or more &lt;code&gt;rt&lt;/code&gt; elements
+     &lt;li&gt;An &lt;code&gt;rp&lt;/code&gt; element followed by one or more &lt;code&gt;rt&lt;/code&gt; elements, each of which is itself followed by an &lt;code&gt;rp&lt;/code&gt; element
+    &lt;/ul&gt;
+  &lt;/ol&gt;
+
+  &lt;!-- ( ( phrasing-content | &lt;ruby&gt; ) ( &lt;rt&gt;+ | &lt;rp&gt; ( &lt;rt&gt; &lt;rp&gt; )+ ) )+ // with further ruby descendant restrictions --&gt;
+
+  &lt;p&gt;The &lt;code&gt;ruby&lt;/code&gt; and &lt;code&gt;rt&lt;/code&gt; elements can be used
+  for a variety of kinds of annotations, including in particular those
+  described below. For more details on Japanese Ruby in particular,
+  and how to render Ruby for Japanese, see &lt;cite&gt;Requirements for
+  Japanese Text Layout&lt;/cite&gt;. &lt;a href=&quot;#refsJLREQ&quot;&gt;[JLREQ]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;At the time of writing, CSS does not yet provide a
+  way to fully control the rendering of the HTML &lt;code&gt;ruby&lt;/code&gt;
+  element. It is hoped that CSS will be extended to support the styles
+  described below in due course.&lt;/p&gt;
+
+  &lt;!-- examples in the following list are mostly based on those in <A HREF="http://www.w3.org/International/datespace/2010/02/jlreq-examples/">http://www.w3.org/International/datespace/2010/02/jlreq-examples/</A> --&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;Mono-ruby for individual base characters
+
+   &lt;dd&gt;
+
+    &lt;p&gt;One or more hiragana or katakana characters (the ruby
+    annotation) are placed with each ideographic character (the base
+    text). This is used to provide readings of kanji characters.
+
+    &lt;div class=&quot;example&quot;&gt; &lt;!-- B as in BASE --&gt;
+     &lt;pre&gt;&lt;ruby&gt;B&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;p&gt;In this example, notice how each annotation corresponds to a single base character.
+     &lt;pre&gt;&lt;ruby&gt;&#21531;&lt;rt&gt;&#12367;&#12435;&lt;/ruby&gt;&lt;ruby&gt;&#23376;&lt;rt&gt;&#12375;&lt;/ruby&gt;&#12399;&lt;ruby&gt;&#21644;&lt;rt&gt;&#12431;&lt;/ruby&gt;&#12375;&#12390;&lt;ruby&gt;&#21516;&lt;rt&gt;&#12393;&#12358;&lt;/ruby&gt;&#12380;&#12378;&#12290;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#21531;&lt;rt&gt;&#12367;&#12435;&lt;/ruby&gt;&lt;ruby&gt;&#23376;&lt;rt&gt;&#12375;&lt;/ruby&gt;&#12399;&lt;ruby&gt;&#21644;&lt;rt&gt;&#12431;&lt;/ruby&gt;&#12375;&#12390;&lt;ruby&gt;&#21516;&lt;rt&gt;&#12393;&#12358;&lt;/ruby&gt;&#12380;&#12378;&#12290;
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Mono-ruby for compound words (jukugo)
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This is similar to the previous case: each ideographic
+    character in the compound word (the base text) has its reading
+    given in hiragana or katakana characters (the ruby annotation).
+    The difference is that the base text segments form a compound word
+    rather than being separate from each other.
+
+    &lt;div class=&quot;example&quot;&gt; &lt;!-- B as in BASE --&gt;
+     &lt;pre&gt;&lt;ruby&gt;B&lt;rt&gt;annotation&lt;/rt&gt;B&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;p&gt;In this example, notice again how each annotation corresponds to a single base character. In this example, each compound word (jukugo) corresponds to a single &lt;code&gt;ruby&lt;/code&gt; element.&lt;/p&gt;
+     &lt;p&gt;The rendering here is expected to be that each annotation be placed over (or next to, in vertical text) the corresponding base character, with the annotations not overhanging any of the adjacent characters.&lt;/p&gt;
+     &lt;pre&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;
+
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Jukugo-ruby
+
+   &lt;dd&gt;
+
+    &lt;p&gt;This is semantically identical to the previous case (each
+    individual ideographic character in the base compound word has its
+    reading given in an annotation in hiragana or katakana
+    characters), but the rendering is the more complicated Jukugo Ruby
+    rendering.
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;p&gt;This is the same example as above for mono-ruby for compound words. The different rendering is expected to be achieved using different styling (e.g. in CSS), and is not shown here.&lt;/p&gt;
+     &lt;pre&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;&lt;/pre&gt;
+     &lt;!-- Once CSS is updated to describe this, invoke the CSS and unhide this --&gt;
+     &lt;!--
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#39740;&lt;rt&gt;&#12365;&lt;/rt&gt;&#38272;&lt;rt&gt;&#12418;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&lt;ruby&gt;&#26041;&lt;rt&gt;&#12411;&#12358;&lt;/rt&gt;&#35282;&lt;rt&gt;&#12364;&#12367;&lt;/rt&gt;&lt;/ruby&gt;&#12434;&lt;ruby&gt;&#20957;&lt;rt&gt;&#12366;&#12423;&#12358;&lt;/rt&gt;&#35222;&lt;rt&gt;&#12375;&lt;/rt&gt;&lt;/ruby&gt;&#12377;&#12427;
+     --&gt;
+    &lt;/div&gt;
+
+    &lt;p class=&quot;note&quot;&gt;For more details on &lt;a
+    href=&quot;<A HREF="http://www.w3.org/TR/jlreq/#positioning_of_jukugoruby">http://www.w3.org/TR/jlreq/#positioning_of_jukugoruby</A>&quot;&gt;Jukugo
+    Ruby rendering&lt;/a&gt;, see Appendix F in the &lt;cite&gt;Requirements for
+    Japanese Text Layout&lt;/cite&gt;. &lt;a href=&quot;#refsJLREQ&quot;&gt;[JLREQ]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Group ruby for describing meanings
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The annotation describes the meaning of the base text, rather
+    than (or in addition to) the pronunciation. As such, both the base
+    text and the annotation can be multiple characters long.
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;pre&gt;&lt;ruby&gt;BASE&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;p&gt;Here a compound ideographic word has its corresponding katakana given as an annotation.
+     &lt;pre&gt;&lt;ruby&gt;&#22659;&#30028;&#38754;&lt;rt&gt;&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12540;&#12473;&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#22659;&#30028;&#38754;&lt;rt&gt;&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12540;&#12473;&lt;/ruby&gt;
+    &lt;/div&gt;
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;p&gt;Here a compound ideographic word has its translation in English provided as an annotation.
+     &lt;pre&gt;&lt;ruby lang=&quot;ja&quot;&gt;&#32232;&#38598;&#32773;&lt;rt lang=&quot;en&quot;&gt;editor&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p&gt;&lt;ruby lang=&quot;ja&quot;&gt;&#32232;&#38598;&#32773;&lt;rt lang=&quot;en&quot;&gt;editor&lt;/ruby&gt;
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Group ruby for Jukuji readings
+
+   &lt;dd&gt;
+
+    &lt;p&gt;A phonetic reading that corresponds to multiple base
+    characters, because a one-to-one mapping would be difficult. (In
+    English, the words &quot;Colonel&quot; and &quot;Lieutenant&quot; are examples of
+    words where a direct mapping of pronunciation to individual
+    letters is, in some dialects, rather unclear.)
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;p&gt;In this example, the name of a species of flowers has a phonetic reading provided using group ruby:
+     &lt;pre&gt;&lt;ruby&gt;&#32043;&#38525;&#33457;&lt;rt&gt;&#12354;&#12376;&#12373;&#12356;&lt;/ruby&gt;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&#32043;&#38525;&#33457;&lt;rt&gt;&#12354;&#12376;&#12373;&#12356;&lt;/ruby&gt;
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+
+   &lt;dt&gt;Text with both phonetic and semantic annotations (double-sided ruby)
+
+   &lt;dd&gt;
+
+    &lt;p&gt;Sometimes, ruby styles described above are combined.
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;pre&gt;&lt;ruby&gt;BASE&lt;rt&gt;annotation 1&lt;rt&gt;annotation 2&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;pre&gt;&lt;ruby&gt;&lt;ruby&gt;B&lt;rt&gt;a&lt;/rt&gt;A&lt;rt&gt;n&lt;/rt&gt;S&lt;rt&gt;t&lt;/rt&gt;E&lt;rt&gt;n&lt;/rt&gt;&lt;/ruby&gt;&lt;rt&gt;annotation&lt;/ruby&gt;&lt;/pre&gt;
+    &lt;/div&gt;
+
+    &lt;div class=&quot;example&quot;&gt;
+     &lt;p&gt;Here both a phonetic reading and the meaning are given in ruby annotations. The annotation on the nested &lt;code&gt;ruby&lt;/code&gt; element gives a mono-ruby phonetic annotation for each base character, while the annotation in the &lt;code&gt;rt&lt;/code&gt; element that is a child of the outer &lt;code&gt;ruby&lt;/code&gt; element gives the meaning using hiragana.
+     &lt;pre&gt;&lt;ruby&gt;&lt;ruby&gt;&#26481;&lt;rt&gt;&#12392;&#12358;&lt;/rt&gt;&#21335;&lt;rt&gt;&#12394;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&lt;rt&gt;&#12383;&#12388;&#12415;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&#26041;&#35282;&lt;/pre&gt;
+     &lt;p lang=ja&gt;&lt;ruby&gt;&lt;ruby&gt;&#26481;&lt;rt&gt;&#12392;&#12358;&lt;/rt&gt;&#21335;&lt;rt&gt;&#12394;&#12435;&lt;/rt&gt;&lt;/ruby&gt;&lt;rt&gt;&#12383;&#12388;&#12415;&lt;/rt&gt;&lt;/ruby&gt;&#12398;&#26041;&#35282;
+    &lt;/div&gt;
+
+   &lt;/dd&gt;
+
+  &lt;/dl&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;Within a &lt;code&gt;ruby&lt;/code&gt; element that does not have a
+  &lt;code&gt;ruby&lt;/code&gt; element ancestor, content is segmented and
+  segments are placed into three categories: base text segments,
+  annotation segments, and ignored segments. Ignored segments do not
+  form part of the document's semantics (they consist of some
+  &lt;span&gt;inter-element whitespace&lt;/span&gt; and &lt;code&gt;rp&lt;/code&gt; elements,
+  the latter of which are used for legacy user agents that do not
+  support ruby at all). Base text segments can overlap (with a limit
+  of two segments overlapping any one position in the DOM, and with
+  any segment having an earlier start point than an overlapping
+  segment also having an equal or later end point, and any segment
+  have a later end point than an overlapping segment also having an
+  equal or earlier start point&lt;!-- if anyone can find a better way of
+  phrasing this parenthetical, do let me know! --&gt;). Annotation
+  segments correspond to &lt;code&gt;rt&lt;/code&gt; elements. Each annotation
+  segment can be associated with a base text segment, and each base
+  text segment can have annotation segments associated with it. (In a
+  conforming document, each base text segment is associated with at
+  least one annotation segment, and each annotation segment is
+  associated with one base text segment.) A &lt;code&gt;ruby&lt;/code&gt; element
+  &lt;span&gt;represents&lt;/span&gt; the union of the segments of base text it
+  contains, along with the mapping from those base text segments to
+  annotation segments. Segments are described in terms of DOM ranges;
+  annotation segment ranges always consist of exactly one element. &lt;a
+  href=&quot;#refsDOMCORE&quot;&gt;[DOMCORE]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;At any particular time, the segmentation and categorisation of
+  content of a &lt;code&gt;ruby&lt;/code&gt; element is the result that would be
+  obtained from running the following algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base text segments&lt;/var&gt; be an empty list
+   of base text segments, each potentially with a list of base text
+   subsegments.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;annotation segments&lt;/var&gt; be an empty list
+   of annotation segments, each potentially being associated with a
+   base text segment or subsegment.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; be the &lt;code&gt;ruby&lt;/code&gt;
+   element for which the algorithm is being run.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;root&lt;/var&gt; has a &lt;code&gt;ruby&lt;/code&gt; element
+   ancestor, then jump to the step labeled &lt;i&gt;end&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be &lt;var
+   title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be 0.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parent start index&lt;/var&gt; be null.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; be null.&lt;/p&gt;&lt;/li&gt;
+
+
+   &lt;!-- This is spaghetti code. If someone can work out a way to
+   phrase this that is as unambiguous but maps more cleanly to
+   structured code, please let me know. --&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Start mode&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; is equal to
+   or greater than the number of child nodes in &lt;var title=&quot;&quot;&gt;current
+   parent&lt;/var&gt;, then jump to the step labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;rt&lt;/code&gt; or
+   &lt;code&gt;rp&lt;/code&gt; element, jump to the step labeled &lt;i&gt;annotation
+   mode&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;!-- if we get here then the first node in a ruby element or after
+   an &lt;rt&gt; or &lt;rp&gt; is something we want in a base text --&gt;
+   
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; to the value of &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Base mode&lt;/i&gt;: If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in
+   &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is a &lt;code&gt;ruby&lt;/code&gt; element,
+   and if &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is the same element as
+   &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, then &lt;span&gt;push a ruby level&lt;/span&gt; and
+   then jump to the step labeled &lt;i&gt;start mode&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;rt&lt;/code&gt; or
+   &lt;code&gt;rp&lt;/code&gt; element, then &lt;span&gt;set the current base
+   text&lt;/span&gt; and then jump to the step labeled &lt;i&gt;annotation
+   mode&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; by one.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Base mode post-increment&lt;/i&gt;: If &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt; is equal to or greater than the number of
+   child nodes in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt;, then jump to the
+   step labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Jump back to the step labeled &lt;i&gt;base mode&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode&lt;/i&gt;: If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th
+   node in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;rt&lt;/code&gt;
+   element, then &lt;span&gt;push a ruby annotation&lt;/span&gt; and jump to the
+   step labeled &lt;i&gt;annotation mode increment&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;rp&lt;/code&gt; element, jump
+   to the step labeled &lt;i&gt;annotation mode increment&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt; is not a &lt;code&gt;Text&lt;/code&gt; node, or
+   is a &lt;code&gt;Text&lt;/code&gt; node that is not &lt;span&gt;inter-element
+   whitespace&lt;/span&gt;, then jump to the step labeled &lt;i&gt;base
+   mode&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;!-- index points at whitespace --&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode increment&lt;/i&gt;: Let &lt;var
+   title=&quot;&quot;&gt;lookahead index&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; plus
+   one.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Annotation mode white-space skipper&lt;/i&gt;: If &lt;var
+   title=&quot;&quot;&gt;lookahead index&lt;/var&gt; is equal to the number of child
+   nodes in &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; then jump to the step
+   labeled &lt;i&gt;end mode&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt;th node in &lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt; is an &lt;code&gt;rt&lt;/code&gt; element or an
+   &lt;code&gt;rp&lt;/code&gt; element, then set &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; to &lt;var
+   title=&quot;&quot;&gt;lookahead index&lt;/var&gt; and jump to the step labeled
+   &lt;i&gt;annotation mode&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt;th node in &lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt; is not a &lt;code&gt;Text&lt;/code&gt; node, or
+   is a &lt;code&gt;Text&lt;/code&gt; node that is not &lt;span&gt;inter-element
+   whitespace&lt;/span&gt;, then jump to the step labeled &lt;i&gt;base mode&lt;/i&gt;
+   (without further incrementing &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;, so the
+   &lt;span&gt;inter-element whitespace&lt;/span&gt; seen so far becomes part of
+   the next base text segment).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;lookahead index&lt;/var&gt; by
+   one.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;annotation mode white-space
+   skipper&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End mode&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; is
+   not the same element as &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;, then &lt;span&gt;pop a
+   ruby level&lt;/span&gt; and jump to the step labeled &lt;i&gt;base mode
+   post-increment&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var title=&quot;&quot;&gt;base text segments&lt;/var&gt;
+   and &lt;var title=&quot;&quot;&gt;annotation segments&lt;/var&gt;. Any content of the
+   &lt;code&gt;ruby&lt;/code&gt; element not described by segments in either of
+   thost lists is implicitly in an &lt;i&gt;ignored segment&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+  &lt;p&gt;When the steps above say to &lt;dfn&gt;set the current base text&lt;/dfn&gt;,
+  it means to run the following steps at that point in the
+  algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;text range&lt;/var&gt; a DOM range whose &lt;span
+   title=&quot;concept-range-start&quot;&gt;start&lt;/span&gt; is the &lt;span
+   title=&quot;concept-range-bp&quot;&gt;boundary point&lt;/span&gt; (&lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt;) and
+   whose &lt;span title=&quot;concept-range-end&quot;&gt;end&lt;/span&gt; is the &lt;span
+   title=&quot;concept-range-bp&quot;&gt;boundary point&lt;/span&gt; (&lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new text segment&lt;/var&gt; be a base text
+   segment described by the range &lt;var title=&quot;&quot;&gt;annotation
+   range&lt;/var&gt;.&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new text segment&lt;/var&gt; to &lt;var
+   title=&quot;&quot;&gt;base text segments&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; be &lt;var
+   title=&quot;&quot;&gt;new text segment&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+  &lt;p&gt;When the steps above say to &lt;dfn&gt;push a ruby level&lt;/dfn&gt;, it
+  means to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be the &lt;var
+   title=&quot;&quot;&gt;index&lt;/var&gt;th node in &lt;var title=&quot;&quot;&gt;current
+   parent&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be 0.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt; to the value of
+   &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; be null.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+  &lt;p&gt;When the steps above say to &lt;dfn&gt;pop a ruby level&lt;/dfn&gt;, it means
+  to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; be the position of &lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;current parent&lt;/var&gt; be &lt;var
+   title=&quot;&quot;&gt;root&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Increment &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; by one.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;start index&lt;/var&gt; to the value of
+   &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;saved start index&lt;/var&gt; be null.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+
+  &lt;p&gt;When the steps above say to &lt;dfn&gt;push a ruby annotation&lt;/dfn&gt;, it
+  means to run the following steps at that point in the algorithm:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;rt&lt;/var&gt; be the &lt;code&gt;rt&lt;/code&gt; element
+   that is the &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;th node of &lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;annotation range&lt;/var&gt; a DOM range whose
+   &lt;span title=&quot;concept-range-start&quot;&gt;start&lt;/span&gt; is the &lt;span
+   title=&quot;concept-range-bp&quot;&gt;boundary point&lt;/span&gt; (&lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt;) and whose
+   &lt;span title=&quot;concept-range-end&quot;&gt;end&lt;/span&gt; is the &lt;span
+   title=&quot;concept-range-bp&quot;&gt;boundary point&lt;/span&gt; (&lt;var
+   title=&quot;&quot;&gt;current parent&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;index&lt;/var&gt; plus one)
+   (i.e. that contains only &lt;var title=&quot;&quot;&gt;rt&lt;/var&gt;).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; be an
+   annotation segment described by the range &lt;var title=&quot;&quot;&gt;annotation
+   range&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;current base text&lt;/var&gt; is not null,
+   associate &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; with &lt;var
+   title=&quot;&quot;&gt;current base text&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new annotation segment&lt;/var&gt; to &lt;var
+   title=&quot;&quot;&gt;annotation segments&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
   &lt;div class=&quot;example&quot;&gt;
 
    &lt;!-- this is the hiragana for the word &quot;kanji&quot; (&quot;chinese character&quot;) in japanese --&gt;
@@ -24352,7 +24784,7 @@
 
   &lt;div class=&quot;example&quot;&gt;
 
-   &lt;!-- this is the bopomofo for the word &quot;hanzi&quot; (&quot;chinese character&quot;) in traditional chinese, as used in taiwan --&gt;
+   &lt;!-- this is the zhuyin fuhao (aka bopomofo) for the word &quot;hanzi&quot; (&quot;chinese character&quot;) in traditional chinese, as used in taiwan --&gt;
 
    &lt;p&gt;In this example, each ideograph in the traditional Chinese text
    &lt;span title=&quot;&quot; lang=&quot;zh-TW&quot;&gt;&#28450;&#23383;&lt;/span&gt; is annotated
@@ -24386,7 +24818,22 @@
 
   &lt;!-- Note: Examples are 32px/16px Stone Sans Sem ITC TT --&gt;
 
+  &lt;div class=&quot;example&quot;&gt;
 
+   &lt;p&gt;In this more contrived example, the acronym &quot;HTML&quot; has four
+   annotations: one for the whole acronym, briefly describing what it
+   is, one for the letters &quot;HT&quot; expanding them to &quot;Hypertext&quot;, one for
+   the letter &quot;M&quot; expanding it to &quot;Markup&quot;, and one for the letter &quot;L&quot;
+   expanding it to &quot;Language&quot;.&lt;/p&gt;
+
+   &lt;pre&gt;&lt;ruby&gt;
+ &lt;ruby&gt;HT&lt;rt&gt;Hypertext&lt;/rt&gt;M&lt;rt&gt;Markup&lt;/rt&gt;L&lt;rt&gt;Language&lt;/rt&gt;&lt;/ruby&gt;
+ &lt;rt&gt;An abstract language for describing documents and applications
+&lt;/ruby&gt;&lt;/pre&gt;
+
+  &lt;/div&gt;
+
+
   &lt;h4&gt;The &lt;dfn&gt;&lt;code&gt;rt&lt;/code&gt;&lt;/dfn&gt; element&lt;/h4&gt;
 
   &lt;dl class=&quot;element&quot;&gt;
@@ -42765,7 +43212,7 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is greater than &lt;var
-   title=&quot;&quot;&gt;width&lt;/var&gt;, then jump to the step labeld
+   title=&quot;&quot;&gt;width&lt;/var&gt;, then jump to the step labeled
    &lt;i&gt;joins&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;segment length&lt;/var&gt; is greater than zero,
@@ -102276,7 +102723,7 @@
 
    &lt;li&gt;&lt;i&gt;Next byte&lt;/i&gt;: Move &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; so it
    points at the next byte in the input byte stream, and return to the
-   step above labeld &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
+   step above labeled &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;
 
@@ -111923,6 +112370,16 @@
   boxes whose 'display' property has the value 'ruby-base'. &lt;a
   href=&quot;#refsCSSRUBY&quot;&gt;[CSSRUBY]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;p&gt;When a particular part of a ruby has more than one annotation,
+  the annotations should be distributed on both sides of the base text
+  so as to minimise the stacking of ruby annotations on one side.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;When it becomes possible to do so, the preceding
+  requirement will be updated to be expressed in terms of CSS ruby.
+  (Currently, CSS ruby does not handle nested &lt;code&gt;ruby&lt;/code&gt;
+  elements or multiple sequential &lt;code&gt;rt&lt;/code&gt; elements, which is
+  how this semantic is expressed.)&lt;/p&gt;
+
   &lt;p&gt;User agents that do not support correct ruby rendering are
   expected to render parentheses around the text of &lt;code&gt;rt&lt;/code&gt;
   elements in the absence of &lt;code&gt;rp&lt;/code&gt; elements.&lt;/p&gt;
@@ -122528,6 +122985,9 @@
    character sets &mdash; Part 11: Latin/Thai
    alphabet&lt;/a&gt;&lt;/cite&gt;. ISO.&lt;/dd&gt;
 
+   &lt;dt id=&quot;refsJLREQ&quot;&gt;[JLREQ]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/TR/jlreq/">http://www.w3.org/TR/jlreq/</A>&quot;&gt;Requirements for Japanese Text Layout&lt;/a&gt;&lt;/cite&gt;. W3C.&lt;/dd&gt; &lt;!-- too many editors to list --&gt;
+
    &lt;dt id=&quot;refsJPEG&quot;&gt;[JPEG]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.w3.org/Graphics/JPEG/jfif3.pdf">http://www.w3.org/Graphics/JPEG/jfif3.pdf</A>&quot;&gt;JPEG File Interchange Format&lt;/a&gt;&lt;/cite&gt;, E. Hamilton.&lt;/dd&gt;
 
@@ -123349,6 +123809,7 @@
   Ivan Enderlin,
   Ivo Emanuel Gon&ccedil;alves,
   J. King,
+  Jacob Davies,
   Jacques Distler,
   Jake Verbaten,
   James Craig,


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014108.html">[html5] r7243 - [giow] (2) All the browsers disagree,	so we'll reward the one that makes the mos [...]
</A></li>
	<LI>Next message: <A HREF="014110.html">[html5] r7245 - [e] (0) additional example Affected topics: HTML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14109">[ date ]</a>
              <a href="thread.html#14109">[ thread ]</a>
              <a href="subject.html#14109">[ subject ]</a>
              <a href="author.html#14109">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
