<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r7411 - [giow] (1) Also sandbox the initial about:blank	document of an &lt;iframe sandbox&gt;. [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7411%20-%20%5Bgiow%5D%20%281%29%20Also%20sandbox%20the%20initial%20about%3Ablank%0A%09document%20of%20an%20%3Ciframe%20sandbox%3E.%20%5B...%5D&In-Reply-To=%3C20120926215821.14B18247C006%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014273.html">
   <LINK REL="Next"  HREF="014275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r7411 - [giow] (1) Also sandbox the initial about:blank	document of an &lt;iframe sandbox&gt;. [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7411%20-%20%5Bgiow%5D%20%281%29%20Also%20sandbox%20the%20initial%20about%3Ablank%0A%09document%20of%20an%20%3Ciframe%20sandbox%3E.%20%5B...%5D&In-Reply-To=%3C20120926215821.14B18247C006%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r7411 - [giow] (1) Also sandbox the initial about:blank	document of an &lt;iframe sandbox&gt;. [...]">whatwg at whatwg.org
       </A><BR>
    <I>Wed Sep 26 14:58:21 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="014273.html">[html5] r7410 - [e] (0) Cleanup area of last checkin;	ack for last checkin Fixing https://www.w3 [...]
</A></li>
        <LI>Next message: <A HREF="014275.html">[html5] r7412 - [giow] (3) radio buttons in different DOM trees	can't possibly be related to eac [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14274">[ date ]</a>
              <a href="thread.html#14274">[ thread ]</a>
              <a href="subject.html#14274">[ subject ]</a>
              <a href="author.html#14274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2012-09-26 14:58:19 -0700 (Wed, 26 Sep 2012)
New Revision: 7411

Modified:
   complete.html
   index
   source
Log:
[giow] (1) Also sandbox the initial about:blank document of an &lt;iframe sandbox&gt;. Also, much cleanup.
Affected topics: HTML

Modified: complete.html
===================================================================
--- complete.html	2012-09-26 18:10:58 UTC (rev 7410)
+++ complete.html	2012-09-26 21:58:19 UTC (rev 7411)
@@ -26819,13 +26819,22 @@
   &lt;p class=warning&gt;Setting both the &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt; and &lt;code title=attr-iframe-sandbox-allow-same-origin&gt;&lt;a href=#attr-iframe-sandbox-allow-same-origin&gt;allow-same-origin&lt;/a&gt;&lt;/code&gt; keywords together when the
   embedded page has the &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the page containing the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;
   allows the embedded page to simply remove the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
-  attribute.&lt;/p&gt;
+  attribute and then reload itself, effectively breaking out of the sandbox altogether.&lt;/p&gt;
 
-  &lt;p class=warning&gt;Sandboxing hostile content is of minimal help if an attacker can convince the
-  user to just visit the hostile content directly, rather than in the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;. To limit
-  the damage that can be caused by hostile HTML content, it should be served from a separate
-  dedicated domain.&lt;/p&gt;
+  &lt;p class=warning&gt;These flags only take effect when the &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; of
+  the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; is &lt;a href=#navigate title=navigate&gt;navigated&lt;/a&gt;. Removing them, or removing the
+  entire &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute, has no effect on an
+  already-loaded page.&lt;/p&gt;
 
+  &lt;p class=warning&gt;Potentially hostile files should not be served from the same server as the file
+  containing the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element. Sandboxing hostile content is of minimal help if an
+  attacker can convince the user to just visit the hostile content directly, rather than in the
+  &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;. To limit the damage that can be caused by hostile HTML content, it should be
+  served from a separate dedicated domain. Using a different domain ensures that scripts in the
+  files are unable to attack the site, even if the user is tricked into visiting those pages
+  directly, without the protection of the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
+  attribute.&lt;/p&gt;
+
   &lt;div class=impl&gt;
 
   &lt;!-- v2: Add a new attribute that enables new restrictions, e.g.:
@@ -26835,16 +26844,18 @@
        - block access to 'parent.frames' from sandbox
   --&gt;
 
-  &lt;p&gt;While the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute is set or changed, the
-  user agent must &lt;a href=#parse-a-sandboxing-directive title=&quot;parse a sandboxing directive&quot;&gt;parse the sandboxing directive&lt;/a&gt;
-  using the attribute's value as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; and the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's
-  &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;'s &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt; as the
-  output.&lt;/p&gt;
+  &lt;p&gt;When an &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element with a &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
+  attribute has its &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; created (before the initial
+  &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt; &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created), and when an &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;
+  element's &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute is set or changed while it
+  has a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, the user agent must &lt;a href=#parse-a-sandboxing-directive title=&quot;parse a sandboxing
+  directive&quot;&gt;parse the sandboxing directive&lt;/a&gt; using the attribute's value as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; and the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;'s
+  &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt; as the output.&lt;/p&gt;
 
-  &lt;p class=warning&gt;These flags only take effect when the &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; of
-  the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; is &lt;a href=#navigate title=navigate&gt;navigated&lt;/a&gt;. Removing them, or removing the
-  entire &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute, has no effect on an
-  already-loaded page.&lt;/p&gt;
+  &lt;p&gt;When an &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
+  attribute is removed while it has a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, the user agent must
+  empty the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;'s
+  &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt; as the output.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -26910,19 +26921,7 @@
 
   &lt;/div&gt;
 
-  &lt;p class=note&gt;Potentially hostile files should not be served from the same server as the file
-  containing the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element. Using a different domain ensures that scripts in the
-  files are unable to attack the site, even if the user is tricked into visiting those pages
-  directly, without the protection of the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
-  attribute.&lt;/p&gt;
 
-  &lt;p class=warning&gt;If the &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt;
-  keyword is set along with &lt;code title=attr-iframe-sandbox-allow-same-origin&gt;&lt;a href=#attr-iframe-sandbox-allow-same-origin&gt;allow-same-origin&lt;/a&gt;&lt;/code&gt; keyword, and the file is
-  from the &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, then a
-  script in the &quot;sandboxed&quot; iframe could just reach out, remove the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute, and then reload itself, effectively breaking
-  out of the sandbox altogether.&lt;/p&gt;
-
-
   &lt;hr&gt;&lt;!-- SEAMLESS --&gt;&lt;!-- v2: Might be interesting to have a value on seamless that allowed event propagation of some
   sort, maybe based on the WICD work: <A HREF="http://www.w3.org/TR/WICD/">http://www.w3.org/TR/WICD/</A> --&gt;&lt;p&gt;The &lt;dfn id=attr-iframe-seamless title=attr-iframe-seamless&gt;&lt;code&gt;seamless&lt;/code&gt;&lt;/dfn&gt; attribute is a &lt;a href=#boolean-attribute&gt;boolean
   attribute&lt;/a&gt;. When specified, it indicates that the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's
@@ -67216,14 +67215,15 @@
 
   &lt;div class=impl&gt;
 
-  &lt;p&gt;When a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is first created, it must be
-  created with a single &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; in its session history,
-  whose &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; is
-  &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;, which is marked as being an &lt;a href=#html-documents title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt;, whose &lt;a href=&quot;#document's-character-encoding&quot; title=&quot;document's character encoding&quot;&gt;character encoding&lt;/a&gt; is
-  UTF-8, and which is both &lt;a href=#ready-for-post-load-tasks&gt;ready for post-load tasks&lt;/a&gt; and
-  &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt; immediately. The
-  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; must have a single child &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;
-  node, which itself has a single child &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; node.&lt;/p&gt;
+  &lt;p&gt;When a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is first created, it must be created with a single
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; in its session history, whose &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's
+  address&quot;&gt;address&lt;/a&gt; is &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;, which is marked as being an &lt;a href=#html-documents title=&quot;HTML
+  documents&quot;&gt;HTML document&lt;/a&gt;, whose &lt;a href=&quot;#document's-character-encoding&quot; title=&quot;document's character encoding&quot;&gt;character
+  encoding&lt;/a&gt; is UTF-8, and which is both &lt;a href=#ready-for-post-load-tasks&gt;ready for post-load tasks&lt;/a&gt; and
+  &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt; immediately. The &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; must have a single child
+  &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; node, which itself has a single child &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; node. As soon as this
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created, the user agent must &lt;a href=#implement-the-sandboxing&gt;implement the sandboxing&lt;/a&gt; for
+  it.&lt;/p&gt;
 
   &lt;p class=note&gt;If the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is created
   specifically to be immediately navigated, then that initial
@@ -69571,10 +69571,38 @@
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created, its &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag
   set&lt;/a&gt; must be empty. It is populated by the &lt;a href=#navigate title=navigate&gt;navigation algorithm&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p&gt;Every resource that is obtained by the &lt;a href=#navigate title=navigate&gt;navigation algorithm&lt;/a&gt; has a &lt;dfn id=forced-sandboxing-flag-set&gt;forced
+  sandboxing flag set&lt;/dfn&gt;, which is a &lt;a href=#sandboxing-flag-set&gt;sandboxing flag
+  set&lt;/a&gt;. A resource by default has no flags set in its
+  &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag set&lt;/a&gt;, but other
+  specifications can define that certain flags are set.&lt;/p&gt;
 
+  &lt;p class=note&gt;In particular, the &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag
+  set&lt;/a&gt; is used by the Content Security Policy specification.
+  &lt;a href=#refsCSP&gt;[CSP]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;h3 id=history&gt;&lt;span class=secno&gt;6.5 &lt;/span&gt;Session history and navigation&lt;/h3&gt;
+  &lt;hr&gt;&lt;p&gt;When a user agent is to &lt;dfn id=implement-the-sandboxing&gt;implement the sandboxing&lt;/dfn&gt; for a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, it
+  must populate &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; with the union of
+  the flags that are present in the following &lt;a href=#sandboxing-flag-set title=&quot;sandboxing flag set&quot;&gt;sandboxing flag
+  sets&lt;/a&gt; at the time the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is created:&lt;/p&gt;
 
+  &lt;ul&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is a &lt;a href=#top-level-browsing-context&gt;top-level browsing
+   context&lt;/a&gt;, then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing
+   flag set&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing
+   context&lt;/a&gt;, then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
+   &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing
+   context&lt;/a&gt;, then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;a href=#parent-browsing-context&gt;parent browsing
+   context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The flags set on the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s resource's &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag
+   set&lt;/a&gt;, if it has one.&lt;/li&gt;
+
+  &lt;/ul&gt;&lt;h3 id=history&gt;&lt;span class=secno&gt;6.5 &lt;/span&gt;Session history and navigation&lt;/h3&gt;
+
   &lt;h4 id=the-session-history-of-browsing-contexts&gt;&lt;span class=secno&gt;6.5.1 &lt;/span&gt;The session history of browsing contexts&lt;/h4&gt;
 
   &lt;p&gt;The sequence of &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;s in a &lt;a href=#browsing-context&gt;browsing
@@ -70902,45 +70930,8 @@
      &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object to point to the new
      &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
 
-     &lt;li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#implement-the-sandboxing&gt;Implement the sandboxing&lt;/a&gt; for the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;.&lt;/li&gt;
 
-      &lt;p&gt;Populate &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag
-      set&lt;/a&gt; with the union of the flags that are present in the
-      following &lt;a href=#sandboxing-flag-set title=&quot;sandboxing flag set&quot;&gt;sandboxing flag
-      sets&lt;/a&gt; at the time the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is
-      created:&lt;/p&gt;
-
-      &lt;ul&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
-       context&lt;/a&gt; is a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;,
-       then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
-       &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
-       context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, then:
-       the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
-       &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
-       context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, then:
-       the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;a href=#parent-browsing-context&gt;parent
-       browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;'s
-       &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;The flags set on the resource's &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing
-       flag set&lt;/a&gt;.&lt;/li&gt;
-
-      &lt;/ul&gt;&lt;p&gt;Each resource obtained by this &lt;a href=#navigate title=navigate&gt;navigation algorithm&lt;/a&gt; has a &lt;dfn id=forced-sandboxing-flag-set&gt;forced
-      sandboxing flag set&lt;/dfn&gt;, which is a &lt;a href=#sandboxing-flag-set&gt;sandboxing flag
-      set&lt;/a&gt;. A resource by default has no flags set in its
-      &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag set&lt;/a&gt;, but other
-      specifications can define that certain flags are set.&lt;/p&gt;
-
-      &lt;p class=note&gt;In particular, the &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag
-      set&lt;/a&gt; is used by the Content Security Policy specification.
-      &lt;a href=#refsCSP&gt;[CSP]&lt;/a&gt;&lt;/p&gt;
-
-     &lt;/li&gt;
-
     &lt;/ol&gt;&lt;/li&gt;
 
    &lt;li id=navigate-non-Document&gt;

Modified: index
===================================================================
--- index	2012-09-26 18:10:58 UTC (rev 7410)
+++ index	2012-09-26 21:58:19 UTC (rev 7411)
@@ -26819,13 +26819,22 @@
   &lt;p class=warning&gt;Setting both the &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt; and &lt;code title=attr-iframe-sandbox-allow-same-origin&gt;&lt;a href=#attr-iframe-sandbox-allow-same-origin&gt;allow-same-origin&lt;/a&gt;&lt;/code&gt; keywords together when the
   embedded page has the &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the page containing the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;
   allows the embedded page to simply remove the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
-  attribute.&lt;/p&gt;
+  attribute and then reload itself, effectively breaking out of the sandbox altogether.&lt;/p&gt;
 
-  &lt;p class=warning&gt;Sandboxing hostile content is of minimal help if an attacker can convince the
-  user to just visit the hostile content directly, rather than in the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;. To limit
-  the damage that can be caused by hostile HTML content, it should be served from a separate
-  dedicated domain.&lt;/p&gt;
+  &lt;p class=warning&gt;These flags only take effect when the &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; of
+  the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; is &lt;a href=#navigate title=navigate&gt;navigated&lt;/a&gt;. Removing them, or removing the
+  entire &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute, has no effect on an
+  already-loaded page.&lt;/p&gt;
 
+  &lt;p class=warning&gt;Potentially hostile files should not be served from the same server as the file
+  containing the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element. Sandboxing hostile content is of minimal help if an
+  attacker can convince the user to just visit the hostile content directly, rather than in the
+  &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;. To limit the damage that can be caused by hostile HTML content, it should be
+  served from a separate dedicated domain. Using a different domain ensures that scripts in the
+  files are unable to attack the site, even if the user is tricked into visiting those pages
+  directly, without the protection of the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
+  attribute.&lt;/p&gt;
+
   &lt;div class=impl&gt;
 
   &lt;!-- v2: Add a new attribute that enables new restrictions, e.g.:
@@ -26835,16 +26844,18 @@
        - block access to 'parent.frames' from sandbox
   --&gt;
 
-  &lt;p&gt;While the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute is set or changed, the
-  user agent must &lt;a href=#parse-a-sandboxing-directive title=&quot;parse a sandboxing directive&quot;&gt;parse the sandboxing directive&lt;/a&gt;
-  using the attribute's value as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; and the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's
-  &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;'s &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt; as the
-  output.&lt;/p&gt;
+  &lt;p&gt;When an &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element with a &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
+  attribute has its &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; created (before the initial
+  &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt; &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created), and when an &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;
+  element's &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute is set or changed while it
+  has a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, the user agent must &lt;a href=#parse-a-sandboxing-directive title=&quot;parse a sandboxing
+  directive&quot;&gt;parse the sandboxing directive&lt;/a&gt; using the attribute's value as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; and the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;'s
+  &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt; as the output.&lt;/p&gt;
 
-  &lt;p class=warning&gt;These flags only take effect when the &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt; of
-  the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; is &lt;a href=#navigate title=navigate&gt;navigated&lt;/a&gt;. Removing them, or removing the
-  entire &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute, has no effect on an
-  already-loaded page.&lt;/p&gt;
+  &lt;p&gt;When an &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
+  attribute is removed while it has a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, the user agent must
+  empty the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;'s
+  &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt; as the output.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -26910,19 +26921,7 @@
 
   &lt;/div&gt;
 
-  &lt;p class=note&gt;Potentially hostile files should not be served from the same server as the file
-  containing the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element. Using a different domain ensures that scripts in the
-  files are unable to attack the site, even if the user is tricked into visiting those pages
-  directly, without the protection of the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt;
-  attribute.&lt;/p&gt;
 
-  &lt;p class=warning&gt;If the &lt;code title=attr-iframe-sandbox-allow-scripts&gt;&lt;a href=#attr-iframe-sandbox-allow-scripts&gt;allow-scripts&lt;/a&gt;&lt;/code&gt;
-  keyword is set along with &lt;code title=attr-iframe-sandbox-allow-same-origin&gt;&lt;a href=#attr-iframe-sandbox-allow-same-origin&gt;allow-same-origin&lt;/a&gt;&lt;/code&gt; keyword, and the file is
-  from the &lt;a href=#same-origin&gt;same origin&lt;/a&gt; as the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, then a
-  script in the &quot;sandboxed&quot; iframe could just reach out, remove the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute, and then reload itself, effectively breaking
-  out of the sandbox altogether.&lt;/p&gt;
-
-
   &lt;hr&gt;&lt;!-- SEAMLESS --&gt;&lt;!-- v2: Might be interesting to have a value on seamless that allowed event propagation of some
   sort, maybe based on the WICD work: <A HREF="http://www.w3.org/TR/WICD/">http://www.w3.org/TR/WICD/</A> --&gt;&lt;p&gt;The &lt;dfn id=attr-iframe-seamless title=attr-iframe-seamless&gt;&lt;code&gt;seamless&lt;/code&gt;&lt;/dfn&gt; attribute is a &lt;a href=#boolean-attribute&gt;boolean
   attribute&lt;/a&gt;. When specified, it indicates that the &lt;code&gt;&lt;a href=#the-iframe-element&gt;iframe&lt;/a&gt;&lt;/code&gt; element's
@@ -67216,14 +67215,15 @@
 
   &lt;div class=impl&gt;
 
-  &lt;p&gt;When a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is first created, it must be
-  created with a single &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; in its session history,
-  whose &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; is
-  &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;, which is marked as being an &lt;a href=#html-documents title=&quot;HTML documents&quot;&gt;HTML document&lt;/a&gt;, whose &lt;a href=&quot;#document's-character-encoding&quot; title=&quot;document's character encoding&quot;&gt;character encoding&lt;/a&gt; is
-  UTF-8, and which is both &lt;a href=#ready-for-post-load-tasks&gt;ready for post-load tasks&lt;/a&gt; and
-  &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt; immediately. The
-  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; must have a single child &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt;
-  node, which itself has a single child &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; node.&lt;/p&gt;
+  &lt;p&gt;When a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is first created, it must be created with a single
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; in its session history, whose &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's
+  address&quot;&gt;address&lt;/a&gt; is &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;, which is marked as being an &lt;a href=#html-documents title=&quot;HTML
+  documents&quot;&gt;HTML document&lt;/a&gt;, whose &lt;a href=&quot;#document's-character-encoding&quot; title=&quot;document's character encoding&quot;&gt;character
+  encoding&lt;/a&gt; is UTF-8, and which is both &lt;a href=#ready-for-post-load-tasks&gt;ready for post-load tasks&lt;/a&gt; and
+  &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt; immediately. The &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; must have a single child
+  &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; node, which itself has a single child &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; node. As soon as this
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created, the user agent must &lt;a href=#implement-the-sandboxing&gt;implement the sandboxing&lt;/a&gt; for
+  it.&lt;/p&gt;
 
   &lt;p class=note&gt;If the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is created
   specifically to be immediately navigated, then that initial
@@ -69571,10 +69571,38 @@
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created, its &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag
   set&lt;/a&gt; must be empty. It is populated by the &lt;a href=#navigate title=navigate&gt;navigation algorithm&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p&gt;Every resource that is obtained by the &lt;a href=#navigate title=navigate&gt;navigation algorithm&lt;/a&gt; has a &lt;dfn id=forced-sandboxing-flag-set&gt;forced
+  sandboxing flag set&lt;/dfn&gt;, which is a &lt;a href=#sandboxing-flag-set&gt;sandboxing flag
+  set&lt;/a&gt;. A resource by default has no flags set in its
+  &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag set&lt;/a&gt;, but other
+  specifications can define that certain flags are set.&lt;/p&gt;
 
+  &lt;p class=note&gt;In particular, the &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag
+  set&lt;/a&gt; is used by the Content Security Policy specification.
+  &lt;a href=#refsCSP&gt;[CSP]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;h3 id=history&gt;&lt;span class=secno&gt;6.5 &lt;/span&gt;Session history and navigation&lt;/h3&gt;
+  &lt;hr&gt;&lt;p&gt;When a user agent is to &lt;dfn id=implement-the-sandboxing&gt;implement the sandboxing&lt;/dfn&gt; for a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, it
+  must populate &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt; with the union of
+  the flags that are present in the following &lt;a href=#sandboxing-flag-set title=&quot;sandboxing flag set&quot;&gt;sandboxing flag
+  sets&lt;/a&gt; at the time the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is created:&lt;/p&gt;
 
+  &lt;ul&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is a &lt;a href=#top-level-browsing-context&gt;top-level browsing
+   context&lt;/a&gt;, then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing
+   flag set&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing
+   context&lt;/a&gt;, then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
+   &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing
+   context&lt;/a&gt;, then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;a href=#parent-browsing-context&gt;parent browsing
+   context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The flags set on the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s resource's &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag
+   set&lt;/a&gt;, if it has one.&lt;/li&gt;
+
+  &lt;/ul&gt;&lt;h3 id=history&gt;&lt;span class=secno&gt;6.5 &lt;/span&gt;Session history and navigation&lt;/h3&gt;
+
   &lt;h4 id=the-session-history-of-browsing-contexts&gt;&lt;span class=secno&gt;6.5.1 &lt;/span&gt;The session history of browsing contexts&lt;/h4&gt;
 
   &lt;p&gt;The sequence of &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;s in a &lt;a href=#browsing-context&gt;browsing
@@ -70902,45 +70930,8 @@
      &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object to point to the new
      &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
 
-     &lt;li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#implement-the-sandboxing&gt;Implement the sandboxing&lt;/a&gt; for the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;.&lt;/li&gt;
 
-      &lt;p&gt;Populate &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag
-      set&lt;/a&gt; with the union of the flags that are present in the
-      following &lt;a href=#sandboxing-flag-set title=&quot;sandboxing flag set&quot;&gt;sandboxing flag
-      sets&lt;/a&gt; at the time the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is
-      created:&lt;/p&gt;
-
-      &lt;ul&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
-       context&lt;/a&gt; is a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt;,
-       then: the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
-       &lt;a href=#popup-sandboxing-flag-set&gt;popup sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
-       context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, then:
-       the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
-       &lt;a href=#iframe-sandboxing-flag-set&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing
-       context&lt;/a&gt; is a &lt;a href=#nested-browsing-context&gt;nested browsing context&lt;/a&gt;, then:
-       the flags set on the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;a href=#parent-browsing-context&gt;parent
-       browsing context&lt;/a&gt;'s &lt;a href=#active-document&gt;active document&lt;/a&gt;'s
-       &lt;a href=#active-sandboxing-flag-set&gt;active sandboxing flag set&lt;/a&gt;.&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;The flags set on the resource's &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing
-       flag set&lt;/a&gt;.&lt;/li&gt;
-
-      &lt;/ul&gt;&lt;p&gt;Each resource obtained by this &lt;a href=#navigate title=navigate&gt;navigation algorithm&lt;/a&gt; has a &lt;dfn id=forced-sandboxing-flag-set&gt;forced
-      sandboxing flag set&lt;/dfn&gt;, which is a &lt;a href=#sandboxing-flag-set&gt;sandboxing flag
-      set&lt;/a&gt;. A resource by default has no flags set in its
-      &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag set&lt;/a&gt;, but other
-      specifications can define that certain flags are set.&lt;/p&gt;
-
-      &lt;p class=note&gt;In particular, the &lt;a href=#forced-sandboxing-flag-set&gt;forced sandboxing flag
-      set&lt;/a&gt; is used by the Content Security Policy specification.
-      &lt;a href=#refsCSP&gt;[CSP]&lt;/a&gt;&lt;/p&gt;
-
-     &lt;/li&gt;
-
     &lt;/ol&gt;&lt;/li&gt;
 
    &lt;li id=navigate-non-Document&gt;

Modified: source
===================================================================
--- source	2012-09-26 18:10:58 UTC (rev 7410)
+++ source	2012-09-26 21:58:19 UTC (rev 7411)
@@ -28932,13 +28932,22 @@
   title=&quot;attr-iframe-sandbox-allow-same-origin&quot;&gt;allow-same-origin&lt;/code&gt; keywords together when the
   embedded page has the &lt;span&gt;same origin&lt;/span&gt; as the page containing the &lt;code&gt;iframe&lt;/code&gt;
   allows the embedded page to simply remove the &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt;
-  attribute.&lt;/p&gt;
+  attribute and then reload itself, effectively breaking out of the sandbox altogether.&lt;/p&gt;
 
-  &lt;p class=&quot;warning&quot;&gt;Sandboxing hostile content is of minimal help if an attacker can convince the
-  user to just visit the hostile content directly, rather than in the &lt;code&gt;iframe&lt;/code&gt;. To limit
-  the damage that can be caused by hostile HTML content, it should be served from a separate
-  dedicated domain.&lt;/p&gt;
+  &lt;p class=&quot;warning&quot;&gt;These flags only take effect when the &lt;span&gt;nested browsing context&lt;/span&gt; of
+  the &lt;code&gt;iframe&lt;/code&gt; is &lt;span title=&quot;navigate&quot;&gt;navigated&lt;/span&gt;. Removing them, or removing the
+  entire &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt; attribute, has no effect on an
+  already-loaded page.&lt;/p&gt;
 
+  &lt;p class=&quot;warning&quot;&gt;Potentially hostile files should not be served from the same server as the file
+  containing the &lt;code&gt;iframe&lt;/code&gt; element. Sandboxing hostile content is of minimal help if an
+  attacker can convince the user to just visit the hostile content directly, rather than in the
+  &lt;code&gt;iframe&lt;/code&gt;. To limit the damage that can be caused by hostile HTML content, it should be
+  served from a separate dedicated domain. Using a different domain ensures that scripts in the
+  files are unable to attack the site, even if the user is tricked into visiting those pages
+  directly, without the protection of the &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt;
+  attribute.&lt;/p&gt;
+
   &lt;div class=&quot;impl&quot;&gt;
 
   &lt;!-- v2: Add a new attribute that enables new restrictions, e.g.:
@@ -28948,16 +28957,19 @@
        - block access to 'parent.frames' from sandbox
   --&gt;
 
-  &lt;p&gt;While the &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt; attribute is set or changed, the
-  user agent must &lt;span title=&quot;parse a sandboxing directive&quot;&gt;parse the sandboxing directive&lt;/span&gt;
-  using the attribute's value as the &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; and the &lt;code&gt;iframe&lt;/code&gt; element's
-  &lt;span&gt;nested browsing context&lt;/span&gt;'s &lt;span&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/span&gt; as the
-  output.&lt;/p&gt;
+  &lt;p&gt;When an &lt;code&gt;iframe&lt;/code&gt; element with a &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt;
+  attribute has its &lt;span&gt;nested browsing context&lt;/span&gt; created (before the initial
+  &lt;code&gt;about:blank&lt;/code&gt; &lt;code&gt;Document&lt;/code&gt; is created), and when an &lt;code&gt;iframe&lt;/code&gt;
+  element's &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt; attribute is set or changed while it
+  has a &lt;span&gt;nested browsing context&lt;/span&gt;, the user agent must &lt;span title=&quot;parse a sandboxing
+  directive&quot;&gt;parse the sandboxing directive&lt;/span&gt; using the attribute's value as the &lt;var
+  title=&quot;&quot;&gt;input&lt;/var&gt; and the &lt;code&gt;iframe&lt;/code&gt; element's &lt;span&gt;nested browsing context&lt;/span&gt;'s
+  &lt;span&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/span&gt; as the output.&lt;/p&gt;
 
-  &lt;p class=&quot;warning&quot;&gt;These flags only take effect when the &lt;span&gt;nested browsing context&lt;/span&gt; of
-  the &lt;code&gt;iframe&lt;/code&gt; is &lt;span title=&quot;navigate&quot;&gt;navigated&lt;/span&gt;. Removing them, or removing the
-  entire &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt; attribute, has no effect on an
-  already-loaded page.&lt;/p&gt;
+  &lt;p&gt;When an &lt;code&gt;iframe&lt;/code&gt; element's &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt;
+  attribute is removed while it has a &lt;span&gt;nested browsing context&lt;/span&gt;, the user agent must
+  empty the &lt;code&gt;iframe&lt;/code&gt; element's &lt;span&gt;nested browsing context&lt;/span&gt;'s
+  &lt;span&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/span&gt; as the output.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -29028,21 +29040,7 @@
 
   &lt;/div&gt;
 
-  &lt;p class=&quot;note&quot;&gt;Potentially hostile files should not be served from the same server as the file
-  containing the &lt;code&gt;iframe&lt;/code&gt; element. Using a different domain ensures that scripts in the
-  files are unable to attack the site, even if the user is tricked into visiting those pages
-  directly, without the protection of the &lt;code title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt;
-  attribute.&lt;/p&gt;
 
-  &lt;p class=&quot;warning&quot;&gt;If the &lt;code title=&quot;attr-iframe-sandbox-allow-scripts&quot;&gt;allow-scripts&lt;/code&gt;
-  keyword is set along with &lt;code
-  title=&quot;attr-iframe-sandbox-allow-same-origin&quot;&gt;allow-same-origin&lt;/code&gt; keyword, and the file is
-  from the &lt;span&gt;same origin&lt;/span&gt; as the &lt;code&gt;iframe&lt;/code&gt;'s &lt;code&gt;Document&lt;/code&gt;, then a
-  script in the &quot;sandboxed&quot; iframe could just reach out, remove the &lt;code
-  title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt; attribute, and then reload itself, effectively breaking
-  out of the sandbox altogether.&lt;/p&gt;
-
-
   &lt;hr&gt; &lt;!-- SEAMLESS --&gt;
 
   &lt;!-- v2: Might be interesting to have a value on seamless that allowed event propagation of some
@@ -78684,16 +78682,15 @@
 
   &lt;div class=&quot;impl&quot;&gt;
 
-  &lt;p&gt;When a &lt;span&gt;browsing context&lt;/span&gt; is first created, it must be
-  created with a single &lt;code&gt;Document&lt;/code&gt; in its session history,
-  whose &lt;span title=&quot;the document's address&quot;&gt;address&lt;/span&gt; is
-  &lt;code&gt;about:blank&lt;/code&gt;, which is marked as being an &lt;span
-  title=&quot;HTML documents&quot;&gt;HTML document&lt;/span&gt;, whose &lt;span
-  title=&quot;document's character encoding&quot;&gt;character encoding&lt;/span&gt; is
-  UTF-8, and which is both &lt;span&gt;ready for post-load tasks&lt;/span&gt; and
-  &lt;span&gt;completely loaded&lt;/span&gt; immediately. The
-  &lt;code&gt;Document&lt;/code&gt; must have a single child &lt;code&gt;html&lt;/code&gt;
-  node, which itself has a single child &lt;code&gt;body&lt;/code&gt; node.&lt;/p&gt;
+  &lt;p&gt;When a &lt;span&gt;browsing context&lt;/span&gt; is first created, it must be created with a single
+  &lt;code&gt;Document&lt;/code&gt; in its session history, whose &lt;span title=&quot;the document's
+  address&quot;&gt;address&lt;/span&gt; is &lt;code&gt;about:blank&lt;/code&gt;, which is marked as being an &lt;span title=&quot;HTML
+  documents&quot;&gt;HTML document&lt;/span&gt;, whose &lt;span title=&quot;document's character encoding&quot;&gt;character
+  encoding&lt;/span&gt; is UTF-8, and which is both &lt;span&gt;ready for post-load tasks&lt;/span&gt; and
+  &lt;span&gt;completely loaded&lt;/span&gt; immediately. The &lt;code&gt;Document&lt;/code&gt; must have a single child
+  &lt;code&gt;html&lt;/code&gt; node, which itself has a single child &lt;code&gt;body&lt;/code&gt; node. As soon as this
+  &lt;code&gt;Document&lt;/code&gt; is created, the user agent must &lt;span&gt;implement the sandboxing&lt;/span&gt; for
+  it.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;If the &lt;span&gt;browsing context&lt;/span&gt; is created
   specifically to be immediately navigated, then that initial
@@ -81394,8 +81391,45 @@
   set&lt;/span&gt; must be empty. It is populated by the &lt;span
   title=&quot;navigate&quot;&gt;navigation algorithm&lt;/span&gt;.&lt;/p&gt;
 
+  &lt;p&gt;Every resource that is obtained by the &lt;span
+  title=&quot;navigate&quot;&gt;navigation algorithm&lt;/span&gt; has a &lt;dfn&gt;forced
+  sandboxing flag set&lt;/dfn&gt;, which is a &lt;span&gt;sandboxing flag
+  set&lt;/span&gt;. A resource by default has no flags set in its
+  &lt;span&gt;forced sandboxing flag set&lt;/span&gt;, but other
+  specifications can define that certain flags are set.&lt;/p&gt;
 
+  &lt;p class=&quot;note&quot;&gt;In particular, the &lt;span&gt;forced sandboxing flag
+  set&lt;/span&gt; is used by the Content Security Policy specification.
+  &lt;a href=&quot;#refsCSP&quot;&gt;[CSP]&lt;/a&gt;&lt;/p&gt;
 
+  &lt;hr&gt;
+
+  &lt;p&gt;When a user agent is to &lt;dfn&gt;implement the sandboxing&lt;/dfn&gt; for a &lt;code&gt;Document&lt;/code&gt;, it
+  must populate &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;active sandboxing flag set&lt;/span&gt; with the union of
+  the flags that are present in the following &lt;span title=&quot;sandboxing flag set&quot;&gt;sandboxing flag
+  sets&lt;/span&gt; at the time the &lt;code&gt;Document&lt;/code&gt; object is created:&lt;/p&gt;
+
+  &lt;ul&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing context&lt;/span&gt; is a &lt;span&gt;top-level browsing
+   context&lt;/span&gt;, then: the flags set on the &lt;span&gt;browsing context&lt;/span&gt;'s &lt;span&gt;popup sandboxing
+   flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing context&lt;/span&gt; is a &lt;span&gt;nested browsing
+   context&lt;/span&gt;, then: the flags set on the &lt;span&gt;browsing context&lt;/span&gt;'s
+   &lt;span&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing context&lt;/span&gt; is a &lt;span&gt;nested browsing
+   context&lt;/span&gt;, then: the flags set on the &lt;span&gt;browsing context&lt;/span&gt;'s &lt;span&gt;parent browsing
+   context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt;'s &lt;span&gt;active sandboxing flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;The flags set on the &lt;code&gt;Document&lt;/code&gt;'s resource's &lt;span&gt;forced sandboxing flag
+   set&lt;/span&gt;, if it has one.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ul&gt;
+
+
+
   &lt;h3 id=&quot;history&quot;&gt;Session history and navigation&lt;/h3&gt;
 
   &lt;h4&gt;The session history of browsing contexts&lt;/h4&gt;
@@ -82884,50 +82918,8 @@
      &lt;code&gt;Window&lt;/code&gt; object to point to the new
      &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
 
-     &lt;li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Implement the sandboxing&lt;/span&gt; for the &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;&lt;/li&gt;
 
-      &lt;p&gt;Populate &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;active sandboxing flag
-      set&lt;/span&gt; with the union of the flags that are present in the
-      following &lt;span title=&quot;sandboxing flag set&quot;&gt;sandboxing flag
-      sets&lt;/span&gt; at the time the &lt;code&gt;Document&lt;/code&gt; object is
-      created:&lt;/p&gt;
-
-      &lt;ul&gt;
-
-       &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing
-       context&lt;/span&gt; is a &lt;span&gt;top-level browsing context&lt;/span&gt;,
-       then: the flags set on the &lt;span&gt;browsing context&lt;/span&gt;'s
-       &lt;span&gt;popup sandboxing flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing
-       context&lt;/span&gt; is a &lt;span&gt;nested browsing context&lt;/span&gt;, then:
-       the flags set on the &lt;span&gt;browsing context&lt;/span&gt;'s
-       &lt;span&gt;&lt;code&gt;iframe&lt;/code&gt; sandboxing flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing
-       context&lt;/span&gt; is a &lt;span&gt;nested browsing context&lt;/span&gt;, then:
-       the flags set on the &lt;span&gt;browsing context&lt;/span&gt;'s &lt;span&gt;parent
-       browsing context&lt;/span&gt;'s &lt;span&gt;active document&lt;/span&gt;'s
-       &lt;span&gt;active sandboxing flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-       &lt;li&gt;&lt;p&gt;The flags set on the resource's &lt;span&gt;forced sandboxing
-       flag set&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
-
-      &lt;/ul&gt;
-
-      &lt;p&gt;Each resource obtained by this &lt;span
-      title=&quot;navigate&quot;&gt;navigation algorithm&lt;/span&gt; has a &lt;dfn&gt;forced
-      sandboxing flag set&lt;/dfn&gt;, which is a &lt;span&gt;sandboxing flag
-      set&lt;/span&gt;. A resource by default has no flags set in its
-      &lt;span&gt;forced sandboxing flag set&lt;/span&gt;, but other
-      specifications can define that certain flags are set.&lt;/p&gt;
-
-      &lt;p class=&quot;note&quot;&gt;In particular, the &lt;span&gt;forced sandboxing flag
-      set&lt;/span&gt; is used by the Content Security Policy specification.
-      &lt;a href=&quot;#refsCSP&quot;&gt;[CSP]&lt;/a&gt;&lt;/p&gt;
-
-     &lt;/li&gt;
-
     &lt;/ol&gt;
 
    &lt;/li&gt;


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014273.html">[html5] r7410 - [e] (0) Cleanup area of last checkin;	ack for last checkin Fixing https://www.w3 [...]
</A></li>
	<LI>Next message: <A HREF="014275.html">[html5] r7412 - [giow] (3) radio buttons in different DOM trees	can't possibly be related to eac [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14274">[ date ]</a>
              <a href="thread.html#14274">[ thread ]</a>
              <a href="subject.html#14274">[ subject ]</a>
              <a href="author.html#14274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
