<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r6156 - [giow] (0) Update all the WebSocket terminology to	match the next WSP draft.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6156%20-%20%5Bgiow%5D%20%280%29%20Update%20all%20the%20WebSocket%20terminology%20to%0A%09match%20the%20next%20WSP%20draft.&In-Reply-To=%3C20110527233153.4C33D11C7C00C%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013022.html">
   <LINK REL="Next"  HREF="013024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r6156 - [giow] (0) Update all the WebSocket terminology to	match the next WSP draft.</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6156%20-%20%5Bgiow%5D%20%280%29%20Update%20all%20the%20WebSocket%20terminology%20to%0A%09match%20the%20next%20WSP%20draft.&In-Reply-To=%3C20110527233153.4C33D11C7C00C%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r6156 - [giow] (0) Update all the WebSocket terminology to	match the next WSP draft.">whatwg at whatwg.org
       </A><BR>
    <I>Fri May 27 16:31:53 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013022.html">[html5] r6155 - [giow] (0) Fix how WebSockets close due to	navigation to be more well-defined.
</A></li>
        <LI>Next message: <A HREF="013024.html">[html5] r6157 - [giow] (0) Remove the pointless security check in	AddSearchProvider(). Gecko doe [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13023">[ date ]</a>
              <a href="thread.html#13023">[ thread ]</a>
              <a href="subject.html#13023">[ subject ]</a>
              <a href="author.html#13023">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2011-05-27 16:31:52 -0700 (Fri, 27 May 2011)
New Revision: 6156

Modified:
   complete.html
   index
   source
Log:
[giow] (0) Update all the WebSocket terminology to match the next WSP draft.

Modified: complete.html
===================================================================
--- complete.html	2011-05-27 21:52:47 UTC (rev 6155)
+++ complete.html	2011-05-27 23:31:52 UTC (rev 6156)
@@ -3471,11 +3471,20 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;Cookies&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The following term is defined in the Cookie specification: &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=receives-a-set-cookie-string&gt;Receives a set-cookie-string&lt;/dfn&gt;
+    &lt;/ul&gt;&lt;/dd&gt;
+
    &lt;dt&gt;CORS&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;The following terms are defined in the CORS specification:&lt;/p&gt;
+    &lt;p&gt;The following terms are defined in the CORS specification: &lt;a href=#refsCORS&gt;[CORS]&lt;/a&gt;&lt;/p&gt;
 
     &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=cross-origin-request&gt;cross-origin request&lt;/dfn&gt;
      &lt;li&gt;&lt;dfn id=cross-origin-request-status&gt;cross-origin request status&lt;/dfn&gt;
@@ -3511,6 +3520,38 @@
 
    &lt;/dd&gt;
 
+
+
+   &lt;dt&gt;The WebSocket protocol&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;div data-component=&quot;WebSocket API (editor: Ian Hickson)&quot;&gt;&lt;!--websocket-api--&gt;
+
+    &lt;p&gt;The following terms are defined in the WebSocket protocol
+    specification: &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=&quot;parse-a-websocket-url's-components&quot;&gt;parse a WebSocket URL's components&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=establish-a-websocket-connection&gt;establish a WebSocket connection&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=the-websocket-connection-is-established&gt;the WebSocket connection is established&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=&quot;validate-the-server's-response&quot;&gt;validate the server's response&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=subprotocol-in-use&gt;subprotocol in use&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=&quot;cookies-set-during-the-server's-opening-handshake&quot;&gt;cookies set during the server's opening handshake&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=a-websocket-message-has-been-received&gt;a WebSocket message has been received&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=close-the-websocket-connection&gt;close the WebSocket connection&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=start-the-websocket-closing-handshake&gt;start the WebSocket closing handshake&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=the-websocket-closing-handshake-is-started&gt;the WebSocket closing handshake is started&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=the-websocket-connection-is-closed&gt;the WebSocket connection is closed&lt;/dfn&gt; (possibly &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;)
+     &lt;li&gt;&lt;dfn id=the-websocket-connection-close-code&gt;the WebSocket connection close code&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=the-websocket-connection-close-reason&gt;the WebSocket connection close reason&lt;/dfn&gt;
+
+    &lt;/ul&gt;&lt;/div&gt;&lt;!--data-component--&gt;
+
+   &lt;/dd&gt;
+
+
+
   &lt;/dl&gt;&lt;p&gt;This specification does not &lt;em&gt;require&lt;/em&gt; support of any
   particular network protocol, style sheet language, scripting
   language, or any of the DOM specifications beyond those described
@@ -9082,8 +9123,8 @@
   &lt;a href=#origin&gt;origin&lt;/a&gt; is not a scheme/host/port tuple, the user agent
   must raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception. Otherwise, the
   user agent must &lt;a href=#obtain-the-storage-mutex&gt;obtain the storage mutex&lt;/a&gt; and then act
-  as it would when &lt;span title=&quot;receives a
-  set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/span&gt; for
+  as it would when &lt;a href=#receives-a-set-cookie-string title=&quot;receives a
+  set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/a&gt; for
   &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; via a &quot;non-HTTP&quot; API, consisting
   of the new value encoded as UTF-8. &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt; &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt;
 
@@ -14843,8 +14884,8 @@
 
      &lt;li&gt;&lt;p&gt;&lt;a href=#obtain-the-storage-mutex&gt;Obtain the storage mutex&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Act as if &lt;span title=&quot;receives a
-     set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/span&gt; for
+     &lt;li&gt;&lt;p&gt;Act as if &lt;a href=#receives-a-set-cookie-string title=&quot;receives a
+     set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/a&gt; for
      &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; via a &quot;non-HTTP&quot; API,
      consisting of the value of the element's &lt;code title=attr-meta-content&gt;&lt;a href=#attr-meta-content&gt;content&lt;/a&gt;&lt;/code&gt; attribute encoded as
      UTF-8. &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt; &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt;&lt;/li&gt;
@@ -78840,8 +78881,8 @@
 
   // networking
            attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-websocket-onopen title=handler-WebSocket-onopen&gt;onopen&lt;/a&gt;;
-           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-websocket-onerror title=handler-WebSocket-onerror&gt;onerror&lt;/a&gt;;
-           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-websocket-onclose title=handler-WebSocket-onclose&gt;onclose&lt;/a&gt;;
+&lt;!--           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-WebSocket-onerror&quot;&gt;onerror&lt;/span&gt;;
+--&gt;           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-websocket-onclose title=handler-WebSocket-onclose&gt;onclose&lt;/a&gt;;
   readonly attribute DOMString &lt;a href=#dom-websocket-protocol title=dom-WebSocket-protocol&gt;protocol&lt;/a&gt;;
   void &lt;a href=#dom-websocket-close title=dom-WebSocket-close&gt;close&lt;/a&gt;(in optional unsigned short code, in optional DOMString reason);
 
@@ -78869,10 +78910,10 @@
   &lt;p&gt;When the &lt;code&gt;WebSocket()&lt;/code&gt; constructor is invoked, the UA
   must run these steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from the
-   &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;. If
-   this fails, throw a &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception and abort
-   these steps. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;i&gt;&lt;a href=&quot;#parse-a-websocket-url's-components&quot;&gt;Parse a WebSocket URL's components&lt;/a&gt;&lt;/i&gt; from the &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;,
+   &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and
+   &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;. If this fails, throw a
+   &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception and abort these steps. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -78916,16 +78957,15 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;span&gt;Establish a WebSocket connection&lt;/span&gt; to a host &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, on port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; (if one was
-    specified), from &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, with the flag &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as
-    the resource name, with &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; as the
-    (possibly empty) list of protocols, and with the &lt;var title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag set. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;&lt;i&gt;&lt;a href=#establish-a-websocket-connection&gt;Establish a WebSocket connection&lt;/a&gt;&lt;/i&gt; given the set (&lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;), along
+    with the &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; list and an empty list for
+    the extensions, and &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;p&gt;When the user agent &lt;i&gt;validates the server's response&lt;/i&gt; during
-    the &quot;&lt;span&gt;establish a WebSocket connection&lt;/span&gt;&quot; algorithm, if
-    the status code received from the server is not 101 (e.g. it is a
-    redirect), the user agent must &lt;span&gt;fail the websocket
-    connection&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;When the user agent &lt;i title=&quot;validate the server's
+    response&quot;&gt;&lt;a href=&quot;#validate-the-server's-response&quot;&gt;validates the server's response&lt;/a&gt;&lt;/i&gt; during the
+    &quot;&lt;i&gt;&lt;a href=#establish-a-websocket-connection&gt;establish a WebSocket connection&lt;/a&gt;&lt;/i&gt;&quot; algorithm, if the status
+    code received from the server is not 101 (e.g. it is a redirect),
+    the user agent must &lt;i&gt;&lt;a href=#fail-the-websocket-connection&gt;fail the websocket connection&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
 
     &lt;p class=warning&gt;Following HTTP procedures here could introduce
     serious security problems in a Web browser context. For example,
@@ -78936,12 +78976,11 @@
     even if the script checks that the URL has the right hostname.&lt;/p&gt;
     &lt;!-- <A HREF="http://www.ietf.org/mail-archive/web/hybi/current/msg06951.html">http://www.ietf.org/mail-archive/web/hybi/current/msg06951.html</A> --&gt;
 
-    &lt;p class=note&gt;If the &quot;&lt;span&gt;establish a WebSocket
-    connection&lt;/span&gt;&quot; algorithm fails, it triggers the &quot;&lt;span&gt;fail
-    the WebSocket connection&lt;/span&gt;&quot; algorithm, which then invokes
-    the &quot;&lt;span&gt;close the WebSocket connection&lt;/span&gt;&quot; algorithm,
-    which then establishes that the &quot;&lt;span&gt;WebSocket connection is
-    closed&lt;/span&gt;&quot;, which fires the &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
+    &lt;p class=note&gt;If the &lt;i&gt;&lt;a href=#establish-a-websocket-connection&gt;establish a WebSocket connection&lt;/a&gt;&lt;/i&gt;
+    algorithm fails, it triggers the &lt;i&gt;&lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket
+    connection&lt;/a&gt;&lt;/i&gt; algorithm, which then invokes the &lt;i&gt;&lt;a href=#close-the-websocket-connection&gt;close the
+    WebSocket connection&lt;/a&gt;&lt;/i&gt; algorithm, which then establishes that
+    &lt;i&gt;&lt;a href=#the-websocket-connection-is-closed&gt;the WebSocket connection is closed&lt;/a&gt;&lt;/i&gt;, which fires the &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -78965,7 +79004,7 @@
 
    &lt;dt&gt;&lt;dfn id=dom-websocket-open title=dom-WebSocket-OPEN&gt;&lt;code&gt;OPEN&lt;/code&gt;&lt;/dfn&gt; (numeric value 1)&lt;/dt&gt;
 
-   &lt;dd&gt;The &lt;span&gt;WebSocket connection is established&lt;/span&gt; and communication is possible.&lt;/dd&gt;
+   &lt;dd&gt;&lt;i&gt;&lt;a href=#the-websocket-connection-is-established&gt;The WebSocket connection is established&lt;/a&gt;&lt;/i&gt; and communication is possible.&lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn id=dom-websocket-closing title=dom-WebSocket-CLOSING&gt;&lt;code&gt;CLOSING&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)&lt;/dt&gt;
 
@@ -78979,8 +79018,8 @@
   &lt;code title=dom-WebSocket-CONNECTING&gt;&lt;a href=#dom-websocket-connecting&gt;CONNECTING&lt;/a&gt;&lt;/code&gt; (0).&lt;/p&gt;
 
   &lt;p&gt;The &lt;dfn id=dom-websocket-protocol title=dom-WebSocket-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt; attribute
-  must initially return the empty string. After the &lt;span&gt;WebSocket
-  connection is established&lt;/span&gt;, its value might change, as defined
+  must initially return the empty string. After &lt;i&gt;&lt;a href=#the-websocket-connection-is-established&gt;the WebSocket
+  connection is established&lt;/a&gt;&lt;/i&gt;, its value might change, as defined
   below.&lt;/p&gt;
 
   &lt;p class=note&gt;The &lt;code title=dom-WebSocket-protocol&gt;&lt;a href=#dom-websocket-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt; attribute returns the
@@ -79011,30 +79050,30 @@
      &lt;/dd&gt;
 
 
-     &lt;dt&gt;If the WebSocket connection is not yet &lt;span title=&quot;WebSocket
-     connection is established&quot;&gt;established&lt;/span&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
+     &lt;dt&gt;If the WebSocket connection is not yet &lt;i title=&quot;the
+     WebSocket connection is established&quot;&gt;&lt;a href=#the-websocket-connection-is-established&gt;established&lt;/a&gt;&lt;/i&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
      &lt;dd&gt;
 
-      &lt;p&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt; and set the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's
+      &lt;p&gt;&lt;i&gt;&lt;a href=#fail-the-websocket-connection&gt;Fail the WebSocket connection&lt;/a&gt;&lt;/i&gt; and set the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's
       value to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2).
       &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-      &lt;p class=note&gt;The &quot;&lt;span&gt;fail the WebSocket connection&lt;/span&gt;&quot;
-      algorithm invokes the &quot;&lt;span&gt;close the WebSocket
-      connection&lt;/span&gt;&quot; algorithm, which then establishes that the
-      &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, which fires the
+      &lt;p class=note&gt;The &lt;i&gt;&lt;a href=#fail-the-websocket-connection&gt;fail the WebSocket connection&lt;/a&gt;&lt;/i&gt;
+      algorithm invokes the &lt;i&gt;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket
+      connection&lt;/a&gt;&lt;/i&gt; algorithm, which then establishes that 
+      &lt;i&gt;&lt;a href=#the-websocket-connection-is-closed&gt;the WebSocket connection is closed&lt;/a&gt;&lt;/i&gt;, which fires the
       &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
 
-     &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;span title=&quot;the WebSocket closing handshake has
-     started&quot;&gt;started&lt;/span&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
+     &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;i title=&quot;the WebSocket closing handshake is
+     started&quot;&gt;&lt;a href=#the-websocket-closing-handshake-is-started&gt;started&lt;/a&gt;&lt;/i&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
      &lt;dd&gt;
 
-      &lt;p&gt;&lt;span&gt;Start the WebSocket closing handshake&lt;/span&gt; and set the
+      &lt;p&gt;&lt;i&gt;&lt;a href=#start-the-websocket-closing-handshake&gt;Start the WebSocket closing handshake&lt;/a&gt;&lt;/i&gt; and set the
       &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt;
       attribute's value to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2). &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
@@ -79044,13 +79083,12 @@
 
       &lt;p&gt;If the second argument is also present, then it must be
       encoded as UTF-8 and provided in the Close message after the
-      status code&lt;!--CLOSE CODE--&gt;. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+      status code&lt;!--CLOSE CODE--&gt;. &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-      &lt;p class=note&gt;The &quot;&lt;span&gt;start the WebSocket closing
-      handshake&lt;/span&gt;&quot; algorithm eventually invokes the &quot;&lt;span&gt;close
-      the WebSocket connection&lt;/span&gt;&quot; algorithm, which then establishes
-      that the &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, which
-      fires the &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
+      &lt;p class=note&gt;The &lt;i&gt;&lt;a href=#start-the-websocket-closing-handshake&gt;start the WebSocket closing handshake&lt;/a&gt;&lt;/i&gt;
+      algorithm eventually invokes the &lt;i&gt;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket
+      connection&lt;/a&gt;&lt;/i&gt; algorithm, which then establishes that &lt;i&gt;&lt;a href=#the-websocket-connection-is-closed&gt;the
+      WebSocket connection is closed&lt;/a&gt;&lt;/i&gt;, which fires the &lt;code title=event-close&gt;close&lt;/code&gt; event &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -79063,29 +79101,27 @@
       value to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt;
       (2).&lt;/p&gt;
 
-      &lt;p class=note&gt;&lt;span&gt;The WebSocket closing handshake has
-      started&lt;/span&gt;, and will eventually invokethe &quot;&lt;span&gt;close the
-      WebSocket connection&lt;/span&gt;&quot; algorithm, which will establish that
-      the &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, and thus the
-      &lt;code title=event-close&gt;close&lt;/code&gt; event will fire, &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
+      &lt;p class=note&gt;&lt;i&gt;&lt;a href=#the-websocket-closing-handshake-is-started&gt;The WebSocket closing handshake is
+      started&lt;/a&gt;&lt;/i&gt;, and will eventually invoke the &lt;i&gt;&lt;a href=#close-the-websocket-connection&gt;close the
+      WebSocket connection&lt;/a&gt;&lt;/i&gt; algorithm, which will establish that
+      &lt;i&gt;&lt;a href=#the-websocket-connection-is-closed&gt;the WebSocket connection is closed&lt;/a&gt;&lt;/i&gt;, and thus the &lt;code title=event-close&gt;close&lt;/code&gt; event will fire, &lt;a href=#closeWebSocket&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
     &lt;/dl&gt;&lt;/li&gt;
 
   &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=dom-websocket-bufferedamount title=dom-WebSocket-bufferedAmount&gt;&lt;code&gt;bufferedAmount&lt;/code&gt;&lt;/dfn&gt;
-  attribute must return the number of bytes of UTF-8 text that have
-  been queued using &lt;code title=dom-WebSocket-send&gt;&lt;a href=#dom-websocket-send&gt;send()&lt;/a&gt;&lt;/code&gt; but
-  that, as of the last time the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; started
-  executing a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt;, had not yet been
-  transmitted to the network. (This thus includes any text sent during
-  the execution of the current task, regardless of whether the user
-  agent is able to transmit text asynchronously with script
-  execution.) This does not include framing overhead incurred by the
-  protocol, or buffering done by the operating system or network
-  hardware. If the connection is closed, this attribute's value will
-  only increase with each call to the &lt;code title=dom-WebSocket-send&gt;&lt;a href=#dom-websocket-send&gt;send()&lt;/a&gt;&lt;/code&gt; method (the number does not
-  reset to zero once the connection closes).&lt;/p&gt;
+  attribute must return the number of bytes of application data (UTF-8
+  text and binary data) that have been queued using &lt;code title=dom-WebSocket-send&gt;&lt;a href=#dom-websocket-send&gt;send()&lt;/a&gt;&lt;/code&gt; but that, as of the last
+  time the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; started executing a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt;, had not yet been transmitted to
+  the network. (This thus includes any text sent during the execution
+  of the current task, regardless of whether the user agent is able to
+  transmit text asynchronously with script execution.) This does not
+  include framing overhead incurred by the protocol, or buffering done
+  by the operating system or network hardware. If the connection is
+  closed, this attribute's value will only increase with each call to
+  the &lt;code title=dom-WebSocket-send&gt;&lt;a href=#dom-websocket-send&gt;send()&lt;/a&gt;&lt;/code&gt; method (the
+  number does not reset to zero once the connection closes).&lt;/p&gt;
 
   &lt;div class=example&gt;
 
@@ -79151,17 +79187,18 @@
 
     &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; argument has any unpaired
     surrogates, then raise an &lt;code&gt;&lt;a href=#syntax_err&gt;SYNTAX_ERR&lt;/a&gt;&lt;/code&gt; exception. If
-    the connection is established, and the string has no unpaired
-    surrogates, and &lt;span title=&quot;the WebSocket closing handshake has
-    started&quot;&gt;the WebSocket closing handshake has not yet
-    started&lt;/span&gt;, then the user agent must &lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/span&gt; using a text frame
-    opcode; if the data cannot be sent, e.g. because it would need to
-    be buffered but the buffer is full, the user agent must
-    &lt;span&gt;close the WebSocket connection&lt;/span&gt;. Any invokation of
-    this method with a string argument that does not raise an
-    exception must increase the &lt;code title=dom-WebSocket-bufferedAmount&gt;&lt;a href=#dom-websocket-bufferedamount&gt;bufferedAmount&lt;/a&gt;&lt;/code&gt;
+    &lt;i&gt;&lt;a href=#the-websocket-connection-is-established&gt;the WebSocket connection is established&lt;/a&gt;&lt;/i&gt;, and the
+    string has no unpaired surrogates, and &lt;i title=&quot;the WebSocket
+    closing handshake is started&quot;&gt;&lt;a href=#the-websocket-closing-handshake-is-started&gt;the WebSocket closing handshake has
+    not yet started&lt;/a&gt;&lt;/i&gt;, then the user agent must &lt;i&gt;send a WebSocket
+    Message&lt;/i&gt; comprised of &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using a text
+    frame opcode; if the data cannot be sent, e.g. because it would
+    need to be buffered but the buffer is full, the user agent must
+    &lt;i&gt;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket connection&lt;/a&gt;&lt;/i&gt;. Any invokation of this
+    method with a string argument that does not raise an exception
+    must increase the &lt;code title=dom-WebSocket-bufferedAmount&gt;&lt;a href=#dom-websocket-bufferedamount&gt;bufferedAmount&lt;/a&gt;&lt;/code&gt;
     attribute by the number of bytes needed to express the argument as
-    UTF-8. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+    UTF-8. &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -79170,18 +79207,16 @@
 
    &lt;dd&gt;
 
-    &lt;p&gt;If the connection is established, and &lt;span title=&quot;The
-    WebSocket Closing Handshake is Started&quot;&gt;the WebSocket closing
-    handshake has not yet started&lt;/span&gt;, then the user agent must
-    &lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/span&gt;
-    using a binary frame opcode; if the data cannot be sent, e.g.
-    because it would need to be buffered but the buffer is full, the
-    user agent must &lt;span&gt;close the WebSocket connection&lt;/span&gt;. The
-    data to be sent is the raw data represented by the
-    &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object. &lt;!-- that sentence is meant to invoke
-    &quot;This interface represents immutable raw data.&quot; --&gt; Any invokation
-    of this method with a &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; argument that does not
-    raise an exception must increase the &lt;code title=dom-WebSocket-bufferedAmount&gt;&lt;a href=#dom-websocket-bufferedamount&gt;bufferedAmount&lt;/a&gt;&lt;/code&gt;
+    &lt;p&gt;If &lt;i&gt;&lt;a href=#the-websocket-connection-is-established&gt;the WebSocket connection is established&lt;/a&gt;&lt;/i&gt;, and &lt;i title=&quot;the WebSocket closing handshake is started&quot;&gt;&lt;a href=#the-websocket-closing-handshake-is-started&gt;the WebSocket
+    closing handshake has not yet started&lt;/a&gt;&lt;/i&gt;, then the user agent
+    must &lt;i&gt;send a WebSocket Message&lt;/i&gt; comprised of &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using a binary frame opcode; if the data
+    cannot be sent, e.g. because it would need to be buffered but the
+    buffer is full, the user agent must &lt;i&gt;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket
+    connection&lt;/a&gt;&lt;/i&gt;. The data to be sent is the raw data represented by
+    the &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object. &lt;!-- that sentence is meant to
+    invoke &quot;This interface represents immutable raw data.&quot; --&gt; Any
+    invokation of this method with a &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; argument that
+    does not raise an exception must increase the &lt;code title=dom-WebSocket-bufferedAmount&gt;&lt;a href=#dom-websocket-bufferedamount&gt;bufferedAmount&lt;/a&gt;&lt;/code&gt;
     attribute by the size of the &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object's raw data,
     in bytes. &lt;!-- that sentence is meant to invoke the same as
     Blob.size --&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt; &lt;a href=#refsFILEAPI&gt;[FILEAPI]&lt;/a&gt;&lt;/p&gt;
@@ -79193,19 +79228,18 @@
 
    &lt;dd&gt;
 
-    &lt;p&gt;If the connection is established, and &lt;span title=&quot;The
-    WebSocket Closing Handshake is Started&quot;&gt;the WebSocket closing
-    handshake has not yet started&lt;/span&gt;, then the user agent must
-    &lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/span&gt;
-    using a binary frame opcode; if the data cannot be sent, e.g.
-    because it would need to be buffered but the buffer is full, the
-    user agent must &lt;span&gt;close the WebSocket connection&lt;/span&gt;. The
-    data to be sent is the data stored in the buffer described by the
-    &lt;code&gt;ArrayBuffer&lt;/code&gt; object. &lt;!-- that sentence is meant to
-    invoke &quot;The ArrayBuffer type describes a buffer used to store data
-    for the array buffer views.&quot; at the top of the Typed Array spec
-    --&gt; Any invokation of this method with an &lt;code&gt;ArrayBuffer&lt;/code&gt;
-    argument that does not raise an exception must increase the &lt;code title=dom-WebSocket-bufferedAmount&gt;&lt;a href=#dom-websocket-bufferedamount&gt;bufferedAmount&lt;/a&gt;&lt;/code&gt;
+    &lt;p&gt;If &lt;i&gt;&lt;a href=#the-websocket-connection-is-established&gt;the WebSocket connection is established&lt;/a&gt;&lt;/i&gt;, and &lt;i title=&quot;the WebSocket closing handshake is started&quot;&gt;&lt;a href=#the-websocket-closing-handshake-is-started&gt;the WebSocket
+    closing handshake has not yet started&lt;/a&gt;&lt;/i&gt;, then the user agent
+    must &lt;i&gt;send a WebSocket Message&lt;/i&gt; comprised of &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using a binary frame opcode; if the data
+    cannot be sent, e.g. because it would need to be buffered but the
+    buffer is full, the user agent must &lt;i&gt;&lt;a href=#close-the-websocket-connection&gt;close the WebSocket
+    connection&lt;/a&gt;&lt;/i&gt;. The data to be sent is the data stored in the
+    buffer described by the &lt;code&gt;ArrayBuffer&lt;/code&gt; object. &lt;!-- that
+    sentence is meant to invoke &quot;The ArrayBuffer type describes a
+    buffer used to store data for the array buffer views.&quot; at the top
+    of the Typed Array spec --&gt; Any invokation of this method with an
+    &lt;code&gt;ArrayBuffer&lt;/code&gt; argument that does not raise an exception
+    must increase the &lt;code title=dom-WebSocket-bufferedAmount&gt;&lt;a href=#dom-websocket-bufferedamount&gt;bufferedAmount&lt;/a&gt;&lt;/code&gt;
     attribute by the length of the &lt;code&gt;ArrayBuffer&lt;/code&gt; in bytes.
     &lt;!-- that sentence is meant to invoke the same as
     ArrayBuffer.byteLength --&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt; &lt;a href=#refsTYPEDARRAY&gt;[TYPEDARRAY]&lt;/a&gt;&lt;/p&gt;
@@ -79219,34 +79253,28 @@
   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;Event handler&lt;/a&gt; &lt;th&gt;&lt;a href=#event-handler-event-type&gt;Event handler event type&lt;/a&gt;
    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-websocket-onopen title=handler-WebSocket-onopen&gt;&lt;code&gt;onopen&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-open&gt;open&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-websocket-onmessage title=handler-WebSocket-onmessage&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-websocket-onerror title=handler-WebSocket-onerror&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-error&gt;error&lt;/code&gt;
+&lt;!--    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-WebSocket-onerror&quot;&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-error&quot;&gt;error&lt;/code&gt;--&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-websocket-onclose title=handler-WebSocket-onclose&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-close&gt;close&lt;/code&gt;
   &lt;/table&gt;&lt;h4 id=feedback-from-the-protocol&gt;&lt;span class=secno&gt;11.3.3 &lt;/span&gt;Feedback from the protocol&lt;/h4&gt;
 
-  &lt;p&gt;When the &lt;i&gt;WebSocket connection is established&lt;/i&gt;, the user
-  agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to first change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
-  to &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt; (1); &lt;span&gt;apply the
-  cookies&lt;/span&gt;
-&lt;!--
-Once we have the cookies back:
+  &lt;p&gt;When &lt;i&gt;&lt;a href=#the-websocket-connection-is-established&gt;the WebSocket connection is established&lt;/a&gt;&lt;/i&gt;, the user
+  agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to run these steps:&lt;/p&gt;
 
-     &lt;li&gt;&lt;p&gt;Act as if &lt;span title=&quot;receives a
-     set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/span&gt; for
-     &lt;span&gt;the document's address&lt;/span&gt;,
-     consisting of the value of the element's &lt;code
-     title=&quot;attr-meta-content&quot;&gt;content&lt;/code&gt; attribute encoded as
-     UTF-8. &lt;a href=&quot;#refsCOOKIES&quot;&gt;[COOKIES]&lt;/a&gt; &lt;a
-     href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's
+   value to &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt; (1).&lt;/li&gt;
 
---&gt;
-  that were collected in the &lt;var title=&quot;&quot;&gt;list of
-  cookies&lt;/var&gt; when the &lt;span title=&quot;WebSocket connection is
-  established&quot;&gt;connection was established&lt;/span&gt;; change the &lt;code title=dom-WebSocket-protocol&gt;&lt;a href=#dom-websocket-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt; attribute's value to
-  the &lt;span&gt;selected WebSocket subprotocol&lt;/span&gt;, if there is one;
-  and then &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-open&gt;open&lt;/code&gt; at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object.
-  &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Change the &lt;code title=dom-WebSocket-protocol&gt;&lt;a href=#dom-websocket-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt; attribute's value to
+   the &lt;i&gt;&lt;a href=#subprotocol-in-use&gt;subprotocol in use&lt;/a&gt;&lt;/i&gt;, if is not the null value. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/li&gt;
 
-  &lt;p&gt;When &lt;i&gt;a WebSocket message has been received&lt;/i&gt; with type &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; and data &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, the user
+   &lt;li&gt;&lt;p&gt;Act as if the user agent had &lt;a href=#receives-a-set-cookie-string title=&quot;receives a
+   set-cookie-string&quot;&gt;received a set-cookie-string&lt;/a&gt; for
+   &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt;, consisting of the &lt;i&gt;&lt;a href=&quot;#cookies-set-during-the-server's-opening-handshake&quot;&gt;cookies
+   set during the server's opening handshake&lt;/a&gt;&lt;/i&gt;. &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt; &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#fire-a-simple-event&gt;Fire a simple event&lt;/a&gt; named &lt;code title=event-open&gt;open&lt;/code&gt; at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt;
+   object.&lt;/p&gt;
+
+  &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;When &lt;i&gt;&lt;a href=#a-websocket-message-has-been-received&gt;a WebSocket message has been received&lt;/a&gt;&lt;/i&gt; with type &lt;var title=&quot;&quot;&gt;type&lt;/var&gt; and data &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, the user
   agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to follow these steps: &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;
@@ -79303,13 +79331,16 @@
   back to RAM before running this &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; so as to avoid stalling the main
   thread while it created the &lt;code&gt;ArrayBuffer&lt;/code&gt; object.&lt;/p&gt;
 
+  &lt;hr&gt;&lt;!--
   &lt;p&gt;When &lt;i&gt;a WebSocket error has been detected&lt;/i&gt;, the user agent
-  must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to check to see if the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
-  is &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt; (1) or &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2), and if so,
-  &lt;a href=#fire-a-simple-event&gt;fire a simple event&lt;/a&gt; named &lt;code title=event-error&gt;error&lt;/code&gt; at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt;
-  object. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;When &lt;i&gt;the WebSocket closing handshake has started&lt;/i&gt;, the user
+  must &lt;span&gt;queue a task&lt;/span&gt; to check to see if the &lt;code
+  title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's value
+  is &lt;code title=&quot;dom-WebSocket-OPEN&quot;&gt;OPEN&lt;/code&gt; (1) or &lt;code
+  title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2), and if so,
+  &lt;span&gt;fire a simple event&lt;/span&gt; named &lt;code
+  title=&quot;event-error&quot;&gt;error&lt;/code&gt; at the &lt;code&gt;WebSocket&lt;/code&gt;
+  object. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+--&gt;&lt;p&gt;When &lt;i&gt;&lt;a href=#the-websocket-closing-handshake-is-started&gt;the WebSocket closing handshake is started&lt;/a&gt;&lt;/i&gt;, the user
   agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
   to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2). (If the
   &lt;code title=dom-WebSocket-close&gt;&lt;a href=#dom-websocket-close&gt;close()&lt;/a&gt;&lt;/code&gt; method was called,
@@ -79317,17 +79348,17 @@
   attribute's value will already be set to &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2) when this task
   runs.) &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p id=closeWebSocket&gt;When the &lt;i&gt;WebSocket connection is
-  closed&lt;/i&gt;, possibly &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;, the user agent must
+  &lt;p id=closeWebSocket&gt;When &lt;i&gt;&lt;a href=#the-websocket-connection-is-closed&gt;the WebSocket connection is
+  closed&lt;/a&gt;&lt;/i&gt;, possibly &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;, the user agent must
   create an event that uses the &lt;code&gt;&lt;a href=#closeevent&gt;CloseEvent&lt;/a&gt;&lt;/code&gt; interface,
   with the event name &lt;code title=event-close&gt;close&lt;/code&gt;, which
   does not bubble, is not cancelable, has no default action, whose
   &lt;code title=dom-CloseEvent-wasClean&gt;&lt;a href=#dom-closeevent-wasclean&gt;wasClean&lt;/a&gt;&lt;/code&gt; attribute is
   set to true if the connection closed &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt; and
   false otherwise, whose &lt;code title=dom-CloseEvent-code&gt;&lt;a href=#dom-closeevent-code&gt;code&lt;/a&gt;&lt;/code&gt;
-  attribute is set to the &lt;i&gt;WebSocket connection close code&lt;/i&gt;, and
+  attribute is set to &lt;i&gt;&lt;a href=#the-websocket-connection-close-code&gt;the WebSocket connection close code&lt;/a&gt;&lt;/i&gt;, and
   whose &lt;code title=dom-CloseEvent-reason&gt;&lt;a href=#dom-closeevent-reason&gt;reason&lt;/a&gt;&lt;/code&gt; attribute is
-  set to the &lt;i&gt;WebSocket connection close reason&lt;/i&gt;; and &lt;a href=#queue-a-task&gt;queue
+  set to &lt;i&gt;&lt;a href=#the-websocket-connection-close-reason&gt;the WebSocket connection close reason&lt;/a&gt;&lt;/i&gt;; and &lt;a href=#queue-a-task&gt;queue
   a task&lt;/a&gt; to first change the &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
   to &lt;code title=dom-WebSocket-CLOSED&gt;&lt;a href=#dom-websocket-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), and then
   dispatch the event at the &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
@@ -79371,21 +79402,23 @@
   (0) as of the last time the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; started
   executing a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; must not be
   garbage collected if there are any event listeners registered for
-  &lt;code title=event-open&gt;open&lt;/code&gt; events, &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; events, &lt;code title=event-error&gt;error&lt;/code&gt; events, or &lt;code title=event-close&gt;close&lt;/code&gt; events.&lt;/p&gt;
+  &lt;code title=event-open&gt;open&lt;/code&gt; events, &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; events&lt;!--, &lt;code
+  title=&quot;event-error&quot;&gt;error&lt;/code&gt; events--&gt;, or &lt;code title=event-close&gt;close&lt;/code&gt; events.&lt;/p&gt;
 
   &lt;p&gt;A &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object whose &lt;code title=dom-WebSocket-readyState&gt;&lt;a href=#dom-websocket-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt; attribute's value
   was set to &lt;code title=dom-WebSocket-OPEN&gt;&lt;a href=#dom-websocket-open&gt;OPEN&lt;/a&gt;&lt;/code&gt; (1) or &lt;code title=dom-WebSocket-CLOSING&gt;&lt;a href=#dom-websocket-closing&gt;CLOSING&lt;/a&gt;&lt;/code&gt; (2) as of the last time
   the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; started executing a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; must not be garbage collected if
-  there are any event listeners registered for &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; events, &lt;code title=event-error&gt;error&lt;/code&gt; events, or &lt;code title=event-close&gt;close&lt;/code&gt; events.&lt;/p&gt;
+  there are any event listeners registered for &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt; events&lt;!--, &lt;code
+  title=&quot;event-error&quot;&gt;error&lt;/code&gt; events--&gt;, or &lt;code title=event-close&gt;close&lt;/code&gt; events.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object with &lt;span title=&quot;WebSocket
-  connection is established&quot;&gt;an established connection&lt;/span&gt; that has
+  &lt;p&gt;A &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object with &lt;i title=&quot;the WebSocket
+  connection is established&quot;&gt;&lt;a href=#the-websocket-connection-is-established&gt;an established connection&lt;/a&gt;&lt;/i&gt; that has
   data queued to be transmitted to the network must not be garbage
   collected. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;If a &lt;code&gt;&lt;a href=#websocket&gt;WebSocket&lt;/a&gt;&lt;/code&gt; object is garbage collected while its
-  connection is still open, the user agent must &lt;span&gt;start the
-  WebSocket closing handshake&lt;/span&gt;, with no status code&lt;!--CLOSE
+  connection is still open, the user agent must &lt;i&gt;&lt;a href=#start-the-websocket-closing-handshake&gt;start the
+  WebSocket closing handshake&lt;/a&gt;&lt;/i&gt;, with no status code&lt;!--CLOSE
   CODE--&gt; for the Close message. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;If a user agent is to &lt;dfn id=make-disappear&gt;make disappear&lt;/dfn&gt; a
@@ -79393,22 +79426,22 @@
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object goes away), the user agent must follow
   the first appropriate set of steps from the following list:&lt;/p&gt;
 
-  &lt;dl class=switch&gt;&lt;dt&gt;If the WebSocket connection is not yet &lt;span title=&quot;WebSocket
-   connection is established&quot;&gt;established&lt;/span&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
+  &lt;dl class=switch&gt;&lt;dt&gt;If the WebSocket connection is not yet &lt;i title=&quot;the WebSocket
+   connection is established&quot;&gt;&lt;a href=#the-websocket-connection-is-established&gt;established&lt;/a&gt;&lt;/i&gt; &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt;. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;&lt;i&gt;&lt;a href=#fail-the-websocket-connection&gt;Fail the WebSocket connection&lt;/a&gt;&lt;/i&gt;. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;span title=&quot;the WebSocket closing handshake has started&quot;&gt;started&lt;/span&gt;
+   &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;i title=&quot;the WebSocket closing handshake is started&quot;&gt;&lt;a href=#the-websocket-closing-handshake-is-started&gt;started&lt;/a&gt;&lt;/i&gt;
    &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Start the WebSocket closing handshake&lt;/span&gt;, with the
+    &lt;p&gt;&lt;i&gt;&lt;a href=#start-the-websocket-closing-handshake&gt;Start the WebSocket closing handshake&lt;/a&gt;&lt;/i&gt;, with the
     status code&lt;!--CLOSE CODE--&gt; to use in the WebSocket Close message
     being 1001. &lt;a href=#refsWSP&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 

Modified: index
===================================================================
--- index	2011-05-27 21:52:47 UTC (rev 6155)
+++ index	2011-05-27 23:31:52 UTC (rev 6156)
@@ -3488,11 +3488,20 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;Cookies&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The following term is defined in the Cookie specification: &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=receives-a-set-cookie-string&gt;Receives a set-cookie-string&lt;/dfn&gt;
+    &lt;/ul&gt;&lt;/dd&gt;
+
    &lt;dt&gt;CORS&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;The following terms are defined in the CORS specification:&lt;/p&gt;
+    &lt;p&gt;The following terms are defined in the CORS specification: &lt;a href=#refsCORS&gt;[CORS]&lt;/a&gt;&lt;/p&gt;
 
     &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=cross-origin-request&gt;cross-origin request&lt;/dfn&gt;
      &lt;li&gt;&lt;dfn id=cross-origin-request-status&gt;cross-origin request status&lt;/dfn&gt;
@@ -3528,6 +3537,7 @@
 
    &lt;/dd&gt;
 
+
   &lt;/dl&gt;&lt;p&gt;This specification does not &lt;em&gt;require&lt;/em&gt; support of any
   particular network protocol, style sheet language, scripting
   language, or any of the DOM specifications beyond those described
@@ -9099,8 +9109,8 @@
   &lt;a href=#origin&gt;origin&lt;/a&gt; is not a scheme/host/port tuple, the user agent
   must raise a &lt;code&gt;&lt;a href=#security_err&gt;SECURITY_ERR&lt;/a&gt;&lt;/code&gt; exception. Otherwise, the
   user agent must &lt;a href=#obtain-the-storage-mutex&gt;obtain the storage mutex&lt;/a&gt; and then act
-  as it would when &lt;span title=&quot;receives a
-  set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/span&gt; for
+  as it would when &lt;a href=#receives-a-set-cookie-string title=&quot;receives a
+  set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/a&gt; for
   &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; via a &quot;non-HTTP&quot; API, consisting
   of the new value encoded as UTF-8. &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt; &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt;
 
@@ -14860,8 +14870,8 @@
 
      &lt;li&gt;&lt;p&gt;&lt;a href=#obtain-the-storage-mutex&gt;Obtain the storage mutex&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Act as if &lt;span title=&quot;receives a
-     set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/span&gt; for
+     &lt;li&gt;&lt;p&gt;Act as if &lt;a href=#receives-a-set-cookie-string title=&quot;receives a
+     set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/a&gt; for
      &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; via a &quot;non-HTTP&quot; API,
      consisting of the value of the element's &lt;code title=attr-meta-content&gt;&lt;a href=#attr-meta-content&gt;content&lt;/a&gt;&lt;/code&gt; attribute encoded as
      UTF-8. &lt;a href=#refsCOOKIES&gt;[COOKIES]&lt;/a&gt; &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt;&lt;/li&gt;

Modified: source
===================================================================
--- source	2011-05-27 21:52:47 UTC (rev 6155)
+++ source	2011-05-27 23:31:52 UTC (rev 6156)
@@ -2500,11 +2500,25 @@
 
    &lt;/dd&gt;
 
+   &lt;dt&gt;Cookies&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;p&gt;The following term is defined in the Cookie specification: &lt;a
+    href=&quot;#refsCOOKIES&quot;&gt;[COOKIES]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;ul class=&quot;brief&quot;&gt;
+     &lt;li&gt;&lt;dfn&gt;Receives a set-cookie-string&lt;/dfn&gt;
+    &lt;/ul&gt;
+
+   &lt;/dd&gt;
+
    &lt;dt&gt;CORS&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;The following terms are defined in the CORS specification:&lt;/p&gt;
+    &lt;p&gt;The following terms are defined in the CORS specification: &lt;a
+    href=&quot;#refsCORS&quot;&gt;[CORS]&lt;/a&gt;&lt;/p&gt;
 
     &lt;ul class=&quot;brief&quot;&gt;
      &lt;li&gt;&lt;dfn&gt;cross-origin request&lt;/dfn&gt;
@@ -2545,6 +2559,42 @@
 
    &lt;/dd&gt;
 
+&lt;!--END html--&gt;&lt;!--END dev-html--&gt;&lt;!--END w3c-html--&gt;
+
+   &lt;dt&gt;The WebSocket protocol&lt;/dt&gt;
+
+   &lt;dd&gt;
+
+    &lt;div data-component=&quot;WebSocket API (editor: Ian Hickson)&quot;&gt;&lt;!--websocket-api--&gt;
+
+    &lt;p&gt;The following terms are defined in the WebSocket protocol
+    specification: &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;ul class=&quot;brief&quot;&gt;
+
+     &lt;li&gt;&lt;dfn&gt;parse a WebSocket URL's components&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;establish a WebSocket connection&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;the WebSocket connection is established&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;validate the server's response&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;subprotocol in use&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;cookies set during the server's opening handshake&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;a WebSocket message has been received&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;fail the WebSocket connection&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;close the WebSocket connection&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;start the WebSocket closing handshake&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;the WebSocket closing handshake is started&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;the WebSocket connection is closed&lt;/dfn&gt; (possibly &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;)
+     &lt;li&gt;&lt;dfn&gt;the WebSocket connection close code&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;the WebSocket connection close reason&lt;/dfn&gt;
+
+    &lt;/ul&gt;
+
+    &lt;/div&gt;&lt;!--data-component--&gt;
+
+   &lt;/dd&gt;
+
+&lt;!--START html--&gt;&lt;!--START dev-html--&gt;&lt;!--START w3c-html--&gt;
+
   &lt;/dl&gt;
 
   &lt;p&gt;This specification does not &lt;em&gt;require&lt;/em&gt; support of any
@@ -89482,8 +89532,8 @@
 
   // networking
            attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-WebSocket-onopen&quot;&gt;onopen&lt;/span&gt;;
-           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-WebSocket-onerror&quot;&gt;onerror&lt;/span&gt;;
-           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-WebSocket-onclose&quot;&gt;onclose&lt;/span&gt;;
+&lt;!--           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-WebSocket-onerror&quot;&gt;onerror&lt;/span&gt;;
+--&gt;           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-WebSocket-onclose&quot;&gt;onclose&lt;/span&gt;;
   readonly attribute DOMString &lt;span title=&quot;dom-WebSocket-protocol&quot;&gt;protocol&lt;/span&gt;;
   void &lt;span title=&quot;dom-WebSocket-close&quot;&gt;close&lt;/span&gt;(in optional unsigned short code, in optional DOMString reason);
 
@@ -89515,12 +89565,12 @@
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Parse a WebSocket URL's components&lt;/span&gt; from the
-   &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain &lt;var
-   title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
-   title=&quot;&quot;&gt;resource name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;. If
-   this fails, throw a &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception and abort
-   these steps. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;Parse a WebSocket URL's components&lt;/i&gt; from the &lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt; argument, to obtain &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;,
+   &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and
+   &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;. If this fails, throw a
+   &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception and abort these steps. &lt;a
+   href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -89567,20 +89617,18 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;span&gt;Establish a WebSocket connection&lt;/span&gt; to a host &lt;var
-    title=&quot;&quot;&gt;host&lt;/var&gt;, on port &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; (if one was
-    specified), from &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, with the flag &lt;var
-    title=&quot;&quot;&gt;secure&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; as
-    the resource name, with &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; as the
-    (possibly empty) list of protocols, and with the &lt;var
-    title=&quot;&quot;&gt;defer cookies&lt;/var&gt; flag set. &lt;a
+    &lt;p&gt;&lt;i&gt;Establish a WebSocket connection&lt;/i&gt; given the set (&lt;var
+    title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var
+    title=&quot;&quot;&gt;resource name&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;), along
+    with the &lt;var title=&quot;&quot;&gt;protocols&lt;/var&gt; list and an empty list for
+    the extensions, and &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;. &lt;a
     href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;p&gt;When the user agent &lt;i&gt;validates the server's response&lt;/i&gt; during
-    the &quot;&lt;span&gt;establish a WebSocket connection&lt;/span&gt;&quot; algorithm, if
-    the status code received from the server is not 101 (e.g. it is a
-    redirect), the user agent must &lt;span&gt;fail the websocket
-    connection&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;When the user agent &lt;i title=&quot;validate the server's
+    response&quot;&gt;validates the server's response&lt;/i&gt; during the
+    &quot;&lt;i&gt;establish a WebSocket connection&lt;/i&gt;&quot; algorithm, if the status
+    code received from the server is not 101 (e.g. it is a redirect),
+    the user agent must &lt;i&gt;fail the websocket connection&lt;/i&gt;.&lt;/p&gt;
 
     &lt;p class=&quot;warning&quot;&gt;Following HTTP procedures here could introduce
     serious security problems in a Web browser context. For example,
@@ -89591,12 +89639,11 @@
     even if the script checks that the URL has the right hostname.&lt;/p&gt;
     &lt;!-- <A HREF="http://www.ietf.org/mail-archive/web/hybi/current/msg06951.html">http://www.ietf.org/mail-archive/web/hybi/current/msg06951.html</A> --&gt;
 
-    &lt;p class=&quot;note&quot;&gt;If the &quot;&lt;span&gt;establish a WebSocket
-    connection&lt;/span&gt;&quot; algorithm fails, it triggers the &quot;&lt;span&gt;fail
-    the WebSocket connection&lt;/span&gt;&quot; algorithm, which then invokes
-    the &quot;&lt;span&gt;close the WebSocket connection&lt;/span&gt;&quot; algorithm,
-    which then establishes that the &quot;&lt;span&gt;WebSocket connection is
-    closed&lt;/span&gt;&quot;, which fires the &lt;code
+    &lt;p class=&quot;note&quot;&gt;If the &lt;i&gt;establish a WebSocket connection&lt;/i&gt;
+    algorithm fails, it triggers the &lt;i&gt;fail the WebSocket
+    connection&lt;/i&gt; algorithm, which then invokes the &lt;i&gt;close the
+    WebSocket connection&lt;/i&gt; algorithm, which then establishes that
+    &lt;i&gt;the WebSocket connection is closed&lt;/i&gt;, which fires the &lt;code
     title=&quot;event-close&quot;&gt;close&lt;/code&gt; event &lt;a
     href=&quot;#closeWebSocket&quot;&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
@@ -89629,7 +89676,7 @@
 
    &lt;dt&gt;&lt;dfn title=&quot;dom-WebSocket-OPEN&quot;&gt;&lt;code&gt;OPEN&lt;/code&gt;&lt;/dfn&gt; (numeric value 1)&lt;/dt&gt;
 
-   &lt;dd&gt;The &lt;span&gt;WebSocket connection is established&lt;/span&gt; and communication is possible.&lt;/dd&gt;
+   &lt;dd&gt;&lt;i&gt;The WebSocket connection is established&lt;/i&gt; and communication is possible.&lt;/dd&gt;
 
    &lt;dt&gt;&lt;dfn title=&quot;dom-WebSocket-CLOSING&quot;&gt;&lt;code&gt;CLOSING&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)&lt;/dt&gt;
 
@@ -89647,8 +89694,8 @@
 
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-WebSocket-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt; attribute
-  must initially return the empty string. After the &lt;span&gt;WebSocket
-  connection is established&lt;/span&gt;, its value might change, as defined
+  must initially return the empty string. After &lt;i&gt;the WebSocket
+  connection is established&lt;/i&gt;, its value might change, as defined
   below.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;The &lt;code
@@ -89688,34 +89735,34 @@
      &lt;/dd&gt;
 
 
-     &lt;dt&gt;If the WebSocket connection is not yet &lt;span title=&quot;WebSocket
-     connection is established&quot;&gt;established&lt;/span&gt; &lt;a
+     &lt;dt&gt;If the WebSocket connection is not yet &lt;i title=&quot;the
+     WebSocket connection is established&quot;&gt;established&lt;/i&gt; &lt;a
      href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
      &lt;dd&gt;
 
-      &lt;p&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt; and set the &lt;code
+      &lt;p&gt;&lt;i&gt;Fail the WebSocket connection&lt;/i&gt; and set the &lt;code
       title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's
       value to &lt;code title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2).
       &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-      &lt;p class=&quot;note&quot;&gt;The &quot;&lt;span&gt;fail the WebSocket connection&lt;/span&gt;&quot;
-      algorithm invokes the &quot;&lt;span&gt;close the WebSocket
-      connection&lt;/span&gt;&quot; algorithm, which then establishes that the
-      &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, which fires the
+      &lt;p class=&quot;note&quot;&gt;The &lt;i&gt;fail the WebSocket connection&lt;/i&gt;
+      algorithm invokes the &lt;i&gt;close the WebSocket
+      connection&lt;/i&gt; algorithm, which then establishes that 
+      &lt;i&gt;the WebSocket connection is closed&lt;/i&gt;, which fires the
       &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt; event &lt;a
       href=&quot;#closeWebSocket&quot;&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
 
-     &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;span
-     title=&quot;the WebSocket closing handshake has
-     started&quot;&gt;started&lt;/span&gt; &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
+     &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;i
+     title=&quot;the WebSocket closing handshake is
+     started&quot;&gt;started&lt;/i&gt; &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
      &lt;dd&gt;
 
-      &lt;p&gt;&lt;span&gt;Start the WebSocket closing handshake&lt;/span&gt; and set the
+      &lt;p&gt;&lt;i&gt;Start the WebSocket closing handshake&lt;/i&gt; and set the
       &lt;code title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt;
       attribute's value to &lt;code
       title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2). &lt;a
@@ -89728,13 +89775,14 @@
 
       &lt;p&gt;If the second argument is also present, then it must be
       encoded as UTF-8 and provided in the Close message after the
-      status code&lt;!--CLOSE CODE--&gt;. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+      status code&lt;!--CLOSE CODE--&gt;. &lt;a
+      href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt; &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-      &lt;p class=&quot;note&quot;&gt;The &quot;&lt;span&gt;start the WebSocket closing
-      handshake&lt;/span&gt;&quot; algorithm eventually invokes the &quot;&lt;span&gt;close
-      the WebSocket connection&lt;/span&gt;&quot; algorithm, which then establishes
-      that the &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, which
-      fires the &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt; event &lt;a
+      &lt;p class=&quot;note&quot;&gt;The &lt;i&gt;start the WebSocket closing handshake&lt;/i&gt;
+      algorithm eventually invokes the &lt;i&gt;close the WebSocket
+      connection&lt;/i&gt; algorithm, which then establishes that &lt;i&gt;the
+      WebSocket connection is closed&lt;/i&gt;, which fires the &lt;code
+      title=&quot;event-close&quot;&gt;close&lt;/code&gt; event &lt;a
       href=&quot;#closeWebSocket&quot;&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
@@ -89749,11 +89797,11 @@
       value to &lt;code title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt;
       (2).&lt;/p&gt;
 
-      &lt;p class=&quot;note&quot;&gt;&lt;span&gt;The WebSocket closing handshake has
-      started&lt;/span&gt;, and will eventually invokethe &quot;&lt;span&gt;close the
-      WebSocket connection&lt;/span&gt;&quot; algorithm, which will establish that
-      the &quot;&lt;span&gt;WebSocket connection is closed&lt;/span&gt;&quot;, and thus the
-      &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt; event will fire, &lt;a
+      &lt;p class=&quot;note&quot;&gt;&lt;i&gt;The WebSocket closing handshake is
+      started&lt;/i&gt;, and will eventually invoke the &lt;i&gt;close the
+      WebSocket connection&lt;/i&gt; algorithm, which will establish that
+      &lt;i&gt;the WebSocket connection is closed&lt;/i&gt;, and thus the &lt;code
+      title=&quot;event-close&quot;&gt;close&lt;/code&gt; event will fire, &lt;a
       href=&quot;#closeWebSocket&quot;&gt;as described below&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
@@ -89768,19 +89816,19 @@
 
   &lt;p&gt;The &lt;dfn
   title=&quot;dom-WebSocket-bufferedAmount&quot;&gt;&lt;code&gt;bufferedAmount&lt;/code&gt;&lt;/dfn&gt;
-  attribute must return the number of bytes of UTF-8 text that have
-  been queued using &lt;code title=&quot;dom-WebSocket-send&quot;&gt;send()&lt;/code&gt; but
-  that, as of the last time the &lt;span&gt;event loop&lt;/span&gt; started
-  executing a &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt;, had not yet been
-  transmitted to the network. (This thus includes any text sent during
-  the execution of the current task, regardless of whether the user
-  agent is able to transmit text asynchronously with script
-  execution.) This does not include framing overhead incurred by the
-  protocol, or buffering done by the operating system or network
-  hardware. If the connection is closed, this attribute's value will
-  only increase with each call to the &lt;code
-  title=&quot;dom-WebSocket-send&quot;&gt;send()&lt;/code&gt; method (the number does not
-  reset to zero once the connection closes).&lt;/p&gt;
+  attribute must return the number of bytes of application data (UTF-8
+  text and binary data) that have been queued using &lt;code
+  title=&quot;dom-WebSocket-send&quot;&gt;send()&lt;/code&gt; but that, as of the last
+  time the &lt;span&gt;event loop&lt;/span&gt; started executing a &lt;span
+  title=&quot;concept-task&quot;&gt;task&lt;/span&gt;, had not yet been transmitted to
+  the network. (This thus includes any text sent during the execution
+  of the current task, regardless of whether the user agent is able to
+  transmit text asynchronously with script execution.) This does not
+  include framing overhead incurred by the protocol, or buffering done
+  by the operating system or network hardware. If the connection is
+  closed, this attribute's value will only increase with each call to
+  the &lt;code title=&quot;dom-WebSocket-send&quot;&gt;send()&lt;/code&gt; method (the
+  number does not reset to zero once the connection closes).&lt;/p&gt;
 
   &lt;div class=&quot;example&quot;&gt;
 
@@ -89857,19 +89905,20 @@
 
     &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; argument has any unpaired
     surrogates, then raise an &lt;code&gt;SYNTAX_ERR&lt;/code&gt; exception. If
-    the connection is established, and the string has no unpaired
-    surrogates, and &lt;span title=&quot;the WebSocket closing handshake has
-    started&quot;&gt;the WebSocket closing handshake has not yet
-    started&lt;/span&gt;, then the user agent must &lt;span&gt;send &lt;var
-    title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/span&gt; using a text frame
-    opcode; if the data cannot be sent, e.g. because it would need to
-    be buffered but the buffer is full, the user agent must
-    &lt;span&gt;close the WebSocket connection&lt;/span&gt;. Any invokation of
-    this method with a string argument that does not raise an
-    exception must increase the &lt;code
+    &lt;i&gt;the WebSocket connection is established&lt;/i&gt;, and the
+    string has no unpaired surrogates, and &lt;i title=&quot;the WebSocket
+    closing handshake is started&quot;&gt;the WebSocket closing handshake has
+    not yet started&lt;/i&gt;, then the user agent must &lt;i&gt;send a WebSocket
+    Message&lt;/i&gt; comprised of &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using a text
+    frame opcode; if the data cannot be sent, e.g. because it would
+    need to be buffered but the buffer is full, the user agent must
+    &lt;i&gt;close the WebSocket connection&lt;/i&gt;. Any invokation of this
+    method with a string argument that does not raise an exception
+    must increase the &lt;code
     title=&quot;dom-WebSocket-bufferedAmount&quot;&gt;bufferedAmount&lt;/code&gt;
     attribute by the number of bytes needed to express the argument as
-    UTF-8. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+    UTF-8. &lt;a href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt; &lt;a
+    href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -89878,18 +89927,18 @@
 
    &lt;dd&gt;
 
-    &lt;p&gt;If the connection is established, and &lt;span title=&quot;The
-    WebSocket Closing Handshake is Started&quot;&gt;the WebSocket closing
-    handshake has not yet started&lt;/span&gt;, then the user agent must
-    &lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/span&gt;
-    using a binary frame opcode; if the data cannot be sent, e.g.
-    because it would need to be buffered but the buffer is full, the
-    user agent must &lt;span&gt;close the WebSocket connection&lt;/span&gt;. The
-    data to be sent is the raw data represented by the
-    &lt;code&gt;Blob&lt;/code&gt; object. &lt;!-- that sentence is meant to invoke
-    &quot;This interface represents immutable raw data.&quot; --&gt; Any invokation
-    of this method with a &lt;code&gt;Blob&lt;/code&gt; argument that does not
-    raise an exception must increase the &lt;code
+    &lt;p&gt;If &lt;i&gt;the WebSocket connection is established&lt;/i&gt;, and &lt;i
+    title=&quot;the WebSocket closing handshake is started&quot;&gt;the WebSocket
+    closing handshake has not yet started&lt;/i&gt;, then the user agent
+    must &lt;i&gt;send a WebSocket Message&lt;/i&gt; comprised of &lt;var
+    title=&quot;&quot;&gt;data&lt;/var&gt; using a binary frame opcode; if the data
+    cannot be sent, e.g. because it would need to be buffered but the
+    buffer is full, the user agent must &lt;i&gt;close the WebSocket
+    connection&lt;/i&gt;. The data to be sent is the raw data represented by
+    the &lt;code&gt;Blob&lt;/code&gt; object. &lt;!-- that sentence is meant to
+    invoke &quot;This interface represents immutable raw data.&quot; --&gt; Any
+    invokation of this method with a &lt;code&gt;Blob&lt;/code&gt; argument that
+    does not raise an exception must increase the &lt;code
     title=&quot;dom-WebSocket-bufferedAmount&quot;&gt;bufferedAmount&lt;/code&gt;
     attribute by the size of the &lt;code&gt;Blob&lt;/code&gt; object's raw data,
     in bytes. &lt;!-- that sentence is meant to invoke the same as
@@ -89903,19 +89952,20 @@
 
    &lt;dd&gt;
 
-    &lt;p&gt;If the connection is established, and &lt;span title=&quot;The
-    WebSocket Closing Handshake is Started&quot;&gt;the WebSocket closing
-    handshake has not yet started&lt;/span&gt;, then the user agent must
-    &lt;span&gt;send &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; using the WebSocket&lt;/span&gt;
-    using a binary frame opcode; if the data cannot be sent, e.g.
-    because it would need to be buffered but the buffer is full, the
-    user agent must &lt;span&gt;close the WebSocket connection&lt;/span&gt;. The
-    data to be sent is the data stored in the buffer described by the
-    &lt;code&gt;ArrayBuffer&lt;/code&gt; object. &lt;!-- that sentence is meant to
-    invoke &quot;The ArrayBuffer type describes a buffer used to store data
-    for the array buffer views.&quot; at the top of the Typed Array spec
-    --&gt; Any invokation of this method with an &lt;code&gt;ArrayBuffer&lt;/code&gt;
-    argument that does not raise an exception must increase the &lt;code
+    &lt;p&gt;If &lt;i&gt;the WebSocket connection is established&lt;/i&gt;, and &lt;i
+    title=&quot;the WebSocket closing handshake is started&quot;&gt;the WebSocket
+    closing handshake has not yet started&lt;/i&gt;, then the user agent
+    must &lt;i&gt;send a WebSocket Message&lt;/i&gt; comprised of &lt;var
+    title=&quot;&quot;&gt;data&lt;/var&gt; using a binary frame opcode; if the data
+    cannot be sent, e.g. because it would need to be buffered but the
+    buffer is full, the user agent must &lt;i&gt;close the WebSocket
+    connection&lt;/i&gt;. The data to be sent is the data stored in the
+    buffer described by the &lt;code&gt;ArrayBuffer&lt;/code&gt; object. &lt;!-- that
+    sentence is meant to invoke &quot;The ArrayBuffer type describes a
+    buffer used to store data for the array buffer views.&quot; at the top
+    of the Typed Array spec --&gt; Any invokation of this method with an
+    &lt;code&gt;ArrayBuffer&lt;/code&gt; argument that does not raise an exception
+    must increase the &lt;code
     title=&quot;dom-WebSocket-bufferedAmount&quot;&gt;bufferedAmount&lt;/code&gt;
     attribute by the length of the &lt;code&gt;ArrayBuffer&lt;/code&gt; in bytes.
     &lt;!-- that sentence is meant to invoke the same as
@@ -89938,7 +89988,7 @@
    &lt;tbody&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-WebSocket-onopen&quot;&gt;&lt;code&gt;onopen&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-open&quot;&gt;open&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-WebSocket-onmessage&quot;&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-message&quot;&gt;message&lt;/code&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-WebSocket-onerror&quot;&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-error&quot;&gt;error&lt;/code&gt;
+&lt;!--    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-WebSocket-onerror&quot;&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-error&quot;&gt;error&lt;/code&gt;--&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-WebSocket-onclose&quot;&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt;
   &lt;/table&gt;
 
@@ -89946,32 +89996,36 @@
 
   &lt;h4&gt;Feedback from the protocol&lt;/h4&gt;
 
-  &lt;p&gt;When the &lt;i&gt;WebSocket connection is established&lt;/i&gt;, the user
-  agent must &lt;span&gt;queue a task&lt;/span&gt; to first change the &lt;code
-  title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's value
-  to &lt;code title=&quot;dom-WebSocket-OPEN&quot;&gt;OPEN&lt;/code&gt; (1); &lt;span&gt;apply the
-  cookies&lt;/span&gt;
-&lt;!--
-Once we have the cookies back:
+  &lt;p&gt;When &lt;i&gt;the WebSocket connection is established&lt;/i&gt;, the user
+  agent must &lt;span&gt;queue a task&lt;/span&gt; to run these steps:&lt;/p&gt;
 
-     &lt;li&gt;&lt;p&gt;Act as if &lt;span title=&quot;receives a
-     set-cookie-string&quot;&gt;receiving a set-cookie-string&lt;/span&gt; for
-     &lt;span&gt;the document's address&lt;/span&gt;,
-     consisting of the value of the element's &lt;code
-     title=&quot;attr-meta-content&quot;&gt;content&lt;/code&gt; attribute encoded as
-     UTF-8. &lt;a href=&quot;#refsCOOKIES&quot;&gt;[COOKIES]&lt;/a&gt; &lt;a
-     href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+  &lt;ol&gt;
 
---&gt;
-  that were collected in the &lt;var title=&quot;&quot;&gt;list of
-  cookies&lt;/var&gt; when the &lt;span title=&quot;WebSocket connection is
-  established&quot;&gt;connection was established&lt;/span&gt;; change the &lt;code
-  title=&quot;dom-WebSocket-protocol&quot;&gt;protocol&lt;/code&gt; attribute's value to
-  the &lt;span&gt;selected WebSocket subprotocol&lt;/span&gt;, if there is one;
-  and then &lt;span&gt;fire a simple event&lt;/span&gt; named &lt;code
-  title=&quot;event-open&quot;&gt;open&lt;/code&gt; at the &lt;code&gt;WebSocket&lt;/code&gt; object.
-  &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Change the &lt;code
+   title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's
+   value to &lt;code title=&quot;dom-WebSocket-OPEN&quot;&gt;OPEN&lt;/code&gt; (1).&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Change the &lt;code
+   title=&quot;dom-WebSocket-protocol&quot;&gt;protocol&lt;/code&gt; attribute's value to
+   the &lt;i&gt;subprotocol in use&lt;/i&gt;, if is not the null value. &lt;a
+   href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Act as if the user agent had &lt;span title=&quot;receives a
+   set-cookie-string&quot;&gt;received a set-cookie-string&lt;/span&gt; for
+   &lt;span&gt;the document's address&lt;/span&gt;, consisting of the &lt;i&gt;cookies
+   set during the server's opening handshake&lt;/i&gt;. &lt;a
+   href=&quot;#refsCOOKIES&quot;&gt;[COOKIES]&lt;/a&gt; &lt;a
+   href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt; &lt;a
+   href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Fire a simple event&lt;/span&gt; named &lt;code
+   title=&quot;event-open&quot;&gt;open&lt;/code&gt; at the &lt;code&gt;WebSocket&lt;/code&gt;
+   object.&lt;/p&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
   &lt;p&gt;When &lt;i&gt;a WebSocket message has been received&lt;/i&gt; with type &lt;var
   title=&quot;&quot;&gt;type&lt;/var&gt; and data &lt;var title=&quot;&quot;&gt;data&lt;/var&gt;, the user
   agent must &lt;span&gt;queue a task&lt;/span&gt; to follow these steps: &lt;a
@@ -90047,6 +90101,8 @@
   title=&quot;concept-task&quot;&gt;task&lt;/span&gt; so as to avoid stalling the main
   thread while it created the &lt;code&gt;ArrayBuffer&lt;/code&gt; object.&lt;/p&gt;
 
+  &lt;hr&gt;
+&lt;!--
   &lt;p&gt;When &lt;i&gt;a WebSocket error has been detected&lt;/i&gt;, the user agent
   must &lt;span&gt;queue a task&lt;/span&gt; to check to see if the &lt;code
   title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's value
@@ -90055,8 +90111,8 @@
   &lt;span&gt;fire a simple event&lt;/span&gt; named &lt;code
   title=&quot;event-error&quot;&gt;error&lt;/code&gt; at the &lt;code&gt;WebSocket&lt;/code&gt;
   object. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;When &lt;i&gt;the WebSocket closing handshake has started&lt;/i&gt;, the user
+--&gt;
+  &lt;p&gt;When &lt;i&gt;the WebSocket closing handshake is started&lt;/i&gt;, the user
   agent must &lt;span&gt;queue a task&lt;/span&gt; to change the &lt;code
   title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's value
   to &lt;code title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2). (If the
@@ -90066,7 +90122,7 @@
   title=&quot;dom-WebSocket-CLOSING&quot;&gt;CLOSING&lt;/code&gt; (2) when this task
   runs.) &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p id=&quot;closeWebSocket&quot;&gt;When the &lt;i&gt;WebSocket connection is
+  &lt;p id=&quot;closeWebSocket&quot;&gt;When &lt;i&gt;the WebSocket connection is
   closed&lt;/i&gt;, possibly &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt;, the user agent must
   create an event that uses the &lt;code&gt;CloseEvent&lt;/code&gt; interface,
   with the event name &lt;code title=&quot;event-close&quot;&gt;close&lt;/code&gt;, which
@@ -90074,9 +90130,9 @@
   &lt;code title=&quot;dom-CloseEvent-wasClean&quot;&gt;wasClean&lt;/code&gt; attribute is
   set to true if the connection closed &lt;i title=&quot;&quot;&gt;cleanly&lt;/i&gt; and
   false otherwise, whose &lt;code title=&quot;dom-CloseEvent-code&quot;&gt;code&lt;/code&gt;
-  attribute is set to the &lt;i&gt;WebSocket connection close code&lt;/i&gt;, and
+  attribute is set to &lt;i&gt;the WebSocket connection close code&lt;/i&gt;, and
   whose &lt;code title=&quot;dom-CloseEvent-reason&quot;&gt;reason&lt;/code&gt; attribute is
-  set to the &lt;i&gt;WebSocket connection close reason&lt;/i&gt;; and &lt;span&gt;queue
+  set to &lt;i&gt;the WebSocket connection close reason&lt;/i&gt;; and &lt;span&gt;queue
   a task&lt;/span&gt; to first change the &lt;code
   title=&quot;dom-WebSocket-readyState&quot;&gt;readyState&lt;/code&gt; attribute's value
   to &lt;code title=&quot;dom-WebSocket-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3), and then
@@ -90129,8 +90185,8 @@
   executing a &lt;span title=&quot;concept-task&quot;&gt;task&lt;/span&gt; must not be
   garbage collected if there are any event listeners registered for
   &lt;code title=&quot;event-open&quot;&gt;open&lt;/code&gt; events, &lt;code
-  title=&quot;event-message&quot;&gt;message&lt;/code&gt; events, &lt;code
-  title=&quot;event-error&quot;&gt;error&lt;/code&gt; events, or &lt;code
+  title=&quot;event-message&quot;&gt;message&lt;/code&gt; events&lt;!--, &lt;code
+  title=&quot;event-error&quot;&gt;error&lt;/code&gt; events--&gt;, or &lt;code
   title=&quot;event-close&quot;&gt;close&lt;/code&gt; events.&lt;/p&gt;
 
   &lt;p&gt;A &lt;code&gt;WebSocket&lt;/code&gt; object whose &lt;code
@@ -90140,18 +90196,18 @@
   the &lt;span&gt;event loop&lt;/span&gt; started executing a &lt;span
   title=&quot;concept-task&quot;&gt;task&lt;/span&gt; must not be garbage collected if
   there are any event listeners registered for &lt;code
-  title=&quot;event-message&quot;&gt;message&lt;/code&gt; events, &lt;code
-  title=&quot;event-error&quot;&gt;error&lt;/code&gt; events, or &lt;code
+  title=&quot;event-message&quot;&gt;message&lt;/code&gt; events&lt;!--, &lt;code
+  title=&quot;event-error&quot;&gt;error&lt;/code&gt; events--&gt;, or &lt;code
   title=&quot;event-close&quot;&gt;close&lt;/code&gt; events.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;code&gt;WebSocket&lt;/code&gt; object with &lt;span title=&quot;WebSocket
-  connection is established&quot;&gt;an established connection&lt;/span&gt; that has
+  &lt;p&gt;A &lt;code&gt;WebSocket&lt;/code&gt; object with &lt;i title=&quot;the WebSocket
+  connection is established&quot;&gt;an established connection&lt;/i&gt; that has
   data queued to be transmitted to the network must not be garbage
   collected. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;If a &lt;code&gt;WebSocket&lt;/code&gt; object is garbage collected while its
-  connection is still open, the user agent must &lt;span&gt;start the
-  WebSocket closing handshake&lt;/span&gt;, with no status code&lt;!--CLOSE
+  connection is still open, the user agent must &lt;i&gt;start the
+  WebSocket closing handshake&lt;/i&gt;, with no status code&lt;!--CLOSE
   CODE--&gt; for the Close message. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;hr&gt;
@@ -90163,25 +90219,25 @@
 
   &lt;dl class=&quot;switch&quot;&gt;
 
-   &lt;dt&gt;If the WebSocket connection is not yet &lt;span title=&quot;WebSocket
-   connection is established&quot;&gt;established&lt;/span&gt; &lt;a
+   &lt;dt&gt;If the WebSocket connection is not yet &lt;i title=&quot;the WebSocket
+   connection is established&quot;&gt;established&lt;/i&gt; &lt;a
    href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Fail the WebSocket connection&lt;/span&gt;. &lt;a
+    &lt;p&gt;&lt;i&gt;Fail the WebSocket connection&lt;/i&gt;. &lt;a
     href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;span
-   title=&quot;the WebSocket closing handshake has started&quot;&gt;started&lt;/span&gt;
+   &lt;dt&gt;If the WebSocket closing handshake has not yet been &lt;i
+   title=&quot;the WebSocket closing handshake is started&quot;&gt;started&lt;/i&gt;
    &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Start the WebSocket closing handshake&lt;/span&gt;, with the
+    &lt;p&gt;&lt;i&gt;Start the WebSocket closing handshake&lt;/i&gt;, with the
     status code&lt;!--CLOSE CODE--&gt; to use in the WebSocket Close message
     being 1001. &lt;a href=&quot;#refsWSP&quot;&gt;[WSP]&lt;/a&gt;&lt;/p&gt;
 


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013022.html">[html5] r6155 - [giow] (0) Fix how WebSockets close due to	navigation to be more well-defined.
</A></li>
	<LI>Next message: <A HREF="013024.html">[html5] r6157 - [giow] (0) Remove the pointless security check in	AddSearchProvider(). Gecko doe [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13023">[ date ]</a>
              <a href="thread.html#13023">[ thread ]</a>
              <a href="subject.html#13023">[ subject ]</a>
              <a href="author.html#13023">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
