<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r6007 - [e] (0) apply wg decision Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=8207
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6007%20-%20%5Be%5D%20%280%29%20apply%20wg%20decision%20Fixing%0A%09http%3A//www.w3.org/Bugs/Public/show_bug.cgi%3Fid%3D8207&In-Reply-To=%3C20110414221756.0017A11C7C007%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012873.html">
   <LINK REL="Next"  HREF="012875.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r6007 - [e] (0) apply wg decision Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=8207</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6007%20-%20%5Be%5D%20%280%29%20apply%20wg%20decision%20Fixing%0A%09http%3A//www.w3.org/Bugs/Public/show_bug.cgi%3Fid%3D8207&In-Reply-To=%3C20110414221756.0017A11C7C007%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r6007 - [e] (0) apply wg decision Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=8207">whatwg at whatwg.org
       </A><BR>
    <I>Thu Apr 14 15:17:55 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012873.html">[html5] r6006 - [e] (0) apply wg decision Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=10963
</A></li>
        <LI>Next message: <A HREF="012875.html">[html5] r6008 - [ac] (1) apply wg decision (add the &lt;table	border=1&gt; talisman) Fixing http://www [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12874">[ date ]</a>
              <a href="thread.html#12874">[ thread ]</a>
              <a href="subject.html#12874">[ subject ]</a>
              <a href="author.html#12874">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2011-04-14 15:17:54 -0700 (Thu, 14 Apr 2011)
New Revision: 6007

Modified:
   complete.html
   index
   source
Log:
[e] (0) apply wg decision
Fixing <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=8207">http://www.w3.org/Bugs/Public/show_bug.cgi?id=8207</A>

Modified: complete.html
===================================================================
--- complete.html	2011-04-14 00:58:14 UTC (rev 6006)
+++ complete.html	2011-04-14 22:17:54 UTC (rev 6007)
@@ -372,8 +372,10 @@
    &lt;li&gt;&lt;a href=#urls&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;URLs&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#terminology-0&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Terminology&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Dynamic changes to base URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Interfaces for URL manipulation&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#parsing-urls&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Parsing URLs&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#resolving-urls&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Resolving URLs&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.6.4 &lt;/span&gt;Dynamic changes to base URLs&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.6.5 &lt;/span&gt;Interfaces for URL manipulation&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#fetching-resources&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Fetching resources&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#concept-http-equivalent&gt;&lt;span class=secno&gt;2.7.1 &lt;/span&gt;Protocol concepts&lt;/a&gt;&lt;/li&gt;
@@ -5998,10 +6000,22 @@
 
   &lt;h3 id=urls&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;URLs&lt;/h3&gt;
 
+  &lt;p&gt;This specification defines the term &lt;a href=#url&gt;URL&lt;/a&gt;, and defines
+  various algorithms for dealing with URLs, because for historical
+  reasons the rules defined by the URI and IRI specifications are not
+  a complete description of what HTML user agents need to implement to
+  be compatible with Web content.&lt;/p&gt;
+
+  &lt;p class=note&gt;The term &quot;URL&quot; in this specification is used in a
+  manner distinct from the precise technical meaning it is given in
+  RFC 3986. Readers familiar with that RFC will find it easier to read
+  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
+  herein is really called something else altogether. This is a
+  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+
+
   &lt;h4 id=terminology-0&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Terminology&lt;/h4&gt;
 
-  &lt;!-- see also: svn diff -r3244:3245 source --&gt;
-
   &lt;p&gt;A &lt;dfn id=url&gt;URL&lt;/dfn&gt; is a string used to identify a resource.&lt;/p&gt;
 
   &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is a &lt;dfn id=valid-url&gt;valid URL&lt;/dfn&gt; if at least one of
@@ -6031,24 +6045,155 @@
   whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt; from
   it, it is a &lt;a href=#valid-non-empty-url&gt;valid non-empty URL&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p&gt;This specification defines the URL
+  &lt;dfn id=about:legacy-compat&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;a href=#syntax-doctype title=syntax-doctype&gt;DOCTYPE&lt;/a&gt;s in &lt;a href=#html-documents&gt;HTML
+  documents&lt;/a&gt; when needed for compatibility with XML tools. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;This specification defines the URL
+  &lt;dfn id=about:srcdoc&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
+  &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; of &lt;a href=#an-iframe-srcdoc-document title=&quot;an iframe srcdoc
+  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; documents&lt;/a&gt;. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
+
+
   &lt;div class=impl&gt;
 
+  &lt;h4 id=parsing-urls&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Parsing URLs&lt;/h4&gt;
+
   &lt;p&gt;To &lt;dfn id=parse-a-url&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
-  component parts, the user agent must use the &lt;span class=XXX&gt;parse
-  an address&lt;/span&gt; algorithm defined by the IRI specification. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+  component parts, the user agent must use the following steps:&lt;/p&gt;
 
-  &lt;p&gt;Parsing a URL can fail. If it does not, then it results in the
-  following components, again as defined by the IRI specification:&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Strip leading and trailing &lt;a href=#space-character title=&quot;space
+   character&quot;&gt;space characters&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-host title=url-host&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-port title=url-port&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-hostport title=url-hostport&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-path title=url-path&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-query title=url-query&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-host-specific title=url-host-specific&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/li&gt;
-  &lt;/ul&gt;&lt;hr&gt;&lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
+   &lt;li&gt;
+
+    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC
+    3986, with the following exceptions:&lt;/p&gt;
+
+    &lt;ul&gt;&lt;li&gt;Add all characters with code points less than or equal to
+     U+0020 or greater than or equal to U+007F to the
+     &lt;unreserved&gt; production.&lt;/li&gt;
+
+     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E,
+     U+0060, and U+007B .. U+007D to the &lt;unreserved&gt;
+     production.
+      &lt;!--
+       0022 QUOTATION MARK
+       003C LESS-THAN SIGN
+       003E GREATER-THAN SIGN
+       005B LEFT SQUARE BRACKET
+       005C REVERSE SOLIDUS
+       005D RIGHT SQUARE BRACKET
+       005E CIRCUMFLEX ACCENT
+       0060 GRAVE ACCENT
+       007B LEFT CURLY BRACKET
+       007C VERTICAL LINE
+       007D RIGHT CURLY BRACKET
+      --&gt;
+     &lt;/li&gt;
+
+     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second
+     alternative way of matching the &lt;pct-encoded&gt; production,
+     except when the &lt;pct-encoded&gt; is used in the
+     &lt;reg-name&gt; production.&lt;/li&gt;
+
+     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters
+     allowed in the &lt;fragment&gt; production.&lt;/li&gt;
+
+     &lt;!-- some browsers also have other differences, e.g. Mozilla
+     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
+     is &quot;ftp&quot;. --&gt;
+
+    &lt;/ul&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the
+    &lt;URI-reference&gt; production, even after the above changes are
+    made to the ABNF definitions, then parsing the URL fails with an
+    error. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
+    components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+    defined as follows:&lt;/p&gt;
+
+    &lt;dl&gt;&lt;dt&gt;&lt;dfn id=url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-host title=url-host&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;host&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-port title=url-port&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;port&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-hostport title=url-hostport&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt;
+     component and the port given by the &lt;port&gt; component is
+     different than the default port defined for the protocol given by
+     the &lt;scheme&gt; component, then &lt;hostport&gt; is the
+     substring that starts with the substring matched by the
+     &lt;host&gt; production and ends with the substring matched by the
+     &lt;port&gt; production, and includes the colon in between the
+     two. Otherwise, it is the same as the &lt;host&gt; component.&lt;/p&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-path title=url-path&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;The substring matched by one of the following productions, if
+      one of them was matched:&lt;/p&gt;
+
+      &lt;ul class=brief&gt;&lt;li&gt;&lt;path-abempty&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-absolute&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-noscheme&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-rootless&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-empty&gt;&lt;/li&gt;
+      &lt;/ul&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-query title=url-query&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;query&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-host-specific title=url-host-specific&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring that &lt;em&gt;follows&lt;/em&gt; the substring matched
+     by the &lt;authority&gt; production, or the whole string if the
+     &lt;authority&gt; production wasn't matched.&lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;These parsing rules are a &lt;a href=#willful-violation&gt;willful
+  violation&lt;/a&gt; of RFC 3986 and RFC 3987 (which do not define error
+  handling), motivated by a desire to handle legacy content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;/div&gt;
+
+
+  &lt;h4 id=resolving-urls&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
+
+  &lt;p&gt;Resolving a URL is the process of taking a relative URL and
+  obtaining the absolute URL that it implies.&lt;/p&gt;
+
+  &lt;div class=impl&gt;
+
+  &lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
   relative to either another &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; or an element,
   the user agent must use the following steps. Resolving a URL can
   result in an error, in which case the URL is not resolvable.&lt;/p&gt;
@@ -6150,12 +6295,114 @@
 
     &lt;/ol&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Return the result of applying the &lt;span class=XXX&gt;resolve
-   an address&lt;/span&gt; algorithm defined by the IRI specification to
-   resolve &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; using encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;a href=#parse-a-url title=&quot;parse a URL&quot;&gt;Parse&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;/div&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from expanding any sequences of percent-encoded octets in
+    that component that are valid UTF-8 sequences into Unicode
+    characters as defined by UTF-8.&lt;/p&gt;
+
+    &lt;p&gt;If any percent-encoded octets in that component are not valid
+    UTF-8 sequences, then return an error and abort these steps.&lt;/p&gt;
+
+    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring,
+    with both the AllowUnassigned and UseSTD3ASCIIRules flags
+    set. Replace the matching substring with the result of the ToASCII
+    algorithm.&lt;/p&gt;
+
+    &lt;p&gt;If ToASCII fails to convert one of the components of the
+    string, e.g. because it is too long or because it contains invalid
+    characters, then return an error and abort these steps. &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from applying the following steps to each character other
+    than U+0025 PERCENT SIGN (%) that doesn't match the original
+    &lt;path&gt; production defined in RFC 3986:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;Encode the character into a sequence of octets as defined by
+     UTF-8.&lt;/li&gt;
+
+     &lt;li&gt;Replace the character with the percent-encoded form of those
+     octets. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;div class=example&gt;
+
+     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code title=&quot;&quot;&gt;//example.com/a^b&#9786;c%FFd%z/?e&lt;/code&gt;&quot;, then the
+     &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component's substring
+     would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&#9786;c%FFd%z/&lt;/code&gt;&quot; and the two
+     characters that would have to be escaped would be &quot;&lt;code title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&#9786;&lt;/code&gt;&quot;. The
+     result after this step was applied would therefore be that &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
+
+    &lt;/div&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from applying the following steps to each character other
+    than U+0025 PERCENT SIGN (%) that doesn't match the original
+    &lt;query&gt; production defined in RFC 3986:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;If the character in question cannot be expressed in the
+     encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a
+     single 0x3F octet (an ASCII question mark) and skip the remaining
+     substeps for this character.&lt;/li&gt;
+
+     &lt;li&gt;Encode the character into a sequence of octets as defined by
+     the encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;Replace the character with the percent-encoded form of those
+     octets. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2
+   Relative Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the
+   potentially relative URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and
+   &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URI (&lt;var title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC
+    3987, returning an error and aborting these steps if
+    appropriate. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p class=example&gt;For instance, if an absolute URI that would be
+    returned by the above algorithm violates the restrictions specific
+    to its scheme, e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the
+    &quot;&lt;code title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax,
+    then user agents are to treat this as an error instead.&lt;!-- RFC
+    3986, 3.1 Scheme --&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution
+   algorithm.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a
+   server-based naming authority, replace all U+005C REVERSE SOLIDUS
+   (\) characters in &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS
+   (/) characters.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;Some of the steps in these rules, for example the
+  processing of U+005C REVERSE SOLIDUS (\) characters, are a
+  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986 and RFC 3987, motivated
+  by a desire to handle legacy content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;/div&gt;
+
   &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is an &lt;dfn id=absolute-url&gt;absolute URL&lt;/dfn&gt; if &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; it results in the same output
   regardless of what it is resolved relative to, and that output is
   not a failure.&lt;/p&gt;
@@ -6170,28 +6417,11 @@
   immediately after the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
   component and they are both U+002F SOLIDUS characters (//).&lt;/p&gt;
 
-  &lt;hr&gt;&lt;p&gt;This specification defines the URL
-  &lt;dfn id=about:legacy-compat&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;a href=#syntax-doctype title=syntax-doctype&gt;DOCTYPE&lt;/a&gt;s in &lt;a href=#html-documents&gt;HTML
-  documents&lt;/a&gt; when needed for compatibility with XML tools. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn id=about:srcdoc&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
-  &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; of &lt;a href=#an-iframe-srcdoc-document title=&quot;an iframe srcdoc
-  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; documents&lt;/a&gt;. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p class=note&gt;The term &quot;URL&quot; in this specification is used in a
-  manner distinct from the precise technical meaning it is given in
-  RFC 3986. Readers familiar with that RFC will find it easier to read
-  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
-  herein is really called something else altogether. This is a
-  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-
   &lt;div class=impl&gt;
 
-  &lt;h4 id=dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
+  &lt;h4 id=dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.6.4 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
 
   &lt;p&gt;When an &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attribute
   changes, the attribute's element, and all descendant elements, are
@@ -6264,7 +6494,7 @@
 
 
 
-  &lt;h4 id=interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Interfaces for URL manipulation&lt;/h4&gt;
+  &lt;h4 id=interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.6.5 &lt;/span&gt;Interfaces for URL manipulation&lt;/h4&gt;
 
   &lt;p&gt;An interface that has a complement of &lt;dfn id=url-decomposition-idl-attributes&gt;URL decomposition IDL
   attributes&lt;/dfn&gt; has seven attributes with the following

Modified: index
===================================================================
--- index	2011-04-14 00:58:14 UTC (rev 6006)
+++ index	2011-04-14 22:17:54 UTC (rev 6007)
@@ -380,8 +380,10 @@
    &lt;li&gt;&lt;a href=#urls&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;URLs&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#terminology-0&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Terminology&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Dynamic changes to base URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Interfaces for URL manipulation&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#parsing-urls&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Parsing URLs&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#resolving-urls&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Resolving URLs&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.6.4 &lt;/span&gt;Dynamic changes to base URLs&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.6.5 &lt;/span&gt;Interfaces for URL manipulation&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#fetching-resources&gt;&lt;span class=secno&gt;2.7 &lt;/span&gt;Fetching resources&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#concept-http-equivalent&gt;&lt;span class=secno&gt;2.7.1 &lt;/span&gt;Protocol concepts&lt;/a&gt;&lt;/li&gt;
@@ -6007,10 +6009,22 @@
 
   &lt;h3 id=urls&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;URLs&lt;/h3&gt;
 
+  &lt;p&gt;This specification defines the term &lt;a href=#url&gt;URL&lt;/a&gt;, and defines
+  various algorithms for dealing with URLs, because for historical
+  reasons the rules defined by the URI and IRI specifications are not
+  a complete description of what HTML user agents need to implement to
+  be compatible with Web content.&lt;/p&gt;
+
+  &lt;p class=note&gt;The term &quot;URL&quot; in this specification is used in a
+  manner distinct from the precise technical meaning it is given in
+  RFC 3986. Readers familiar with that RFC will find it easier to read
+  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
+  herein is really called something else altogether. This is a
+  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+
+
   &lt;h4 id=terminology-0&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Terminology&lt;/h4&gt;
 
-  &lt;!-- see also: svn diff -r3244:3245 source --&gt;
-
   &lt;p&gt;A &lt;dfn id=url&gt;URL&lt;/dfn&gt; is a string used to identify a resource.&lt;/p&gt;
 
   &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is a &lt;dfn id=valid-url&gt;valid URL&lt;/dfn&gt; if at least one of
@@ -6040,24 +6054,155 @@
   whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt; from
   it, it is a &lt;a href=#valid-non-empty-url&gt;valid non-empty URL&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p&gt;This specification defines the URL
+  &lt;dfn id=about:legacy-compat&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;a href=#syntax-doctype title=syntax-doctype&gt;DOCTYPE&lt;/a&gt;s in &lt;a href=#html-documents&gt;HTML
+  documents&lt;/a&gt; when needed for compatibility with XML tools. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;This specification defines the URL
+  &lt;dfn id=about:srcdoc&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
+  &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; of &lt;a href=#an-iframe-srcdoc-document title=&quot;an iframe srcdoc
+  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; documents&lt;/a&gt;. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
+
+
   &lt;div class=impl&gt;
 
+  &lt;h4 id=parsing-urls&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Parsing URLs&lt;/h4&gt;
+
   &lt;p&gt;To &lt;dfn id=parse-a-url&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
-  component parts, the user agent must use the &lt;span class=XXX&gt;parse
-  an address&lt;/span&gt; algorithm defined by the IRI specification. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+  component parts, the user agent must use the following steps:&lt;/p&gt;
 
-  &lt;p&gt;Parsing a URL can fail. If it does not, then it results in the
-  following components, again as defined by the IRI specification:&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Strip leading and trailing &lt;a href=#space-character title=&quot;space
+   character&quot;&gt;space characters&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-host title=url-host&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-port title=url-port&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-hostport title=url-hostport&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-path title=url-path&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-query title=url-query&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn id=url-host-specific title=url-host-specific&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/li&gt;
-  &lt;/ul&gt;&lt;hr&gt;&lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
+   &lt;li&gt;
+
+    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC
+    3986, with the following exceptions:&lt;/p&gt;
+
+    &lt;ul&gt;&lt;li&gt;Add all characters with code points less than or equal to
+     U+0020 or greater than or equal to U+007F to the
+     &lt;unreserved&gt; production.&lt;/li&gt;
+
+     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E,
+     U+0060, and U+007B .. U+007D to the &lt;unreserved&gt;
+     production.
+      &lt;!--
+       0022 QUOTATION MARK
+       003C LESS-THAN SIGN
+       003E GREATER-THAN SIGN
+       005B LEFT SQUARE BRACKET
+       005C REVERSE SOLIDUS
+       005D RIGHT SQUARE BRACKET
+       005E CIRCUMFLEX ACCENT
+       0060 GRAVE ACCENT
+       007B LEFT CURLY BRACKET
+       007C VERTICAL LINE
+       007D RIGHT CURLY BRACKET
+      --&gt;
+     &lt;/li&gt;
+
+     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second
+     alternative way of matching the &lt;pct-encoded&gt; production,
+     except when the &lt;pct-encoded&gt; is used in the
+     &lt;reg-name&gt; production.&lt;/li&gt;
+
+     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters
+     allowed in the &lt;fragment&gt; production.&lt;/li&gt;
+
+     &lt;!-- some browsers also have other differences, e.g. Mozilla
+     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
+     is &quot;ftp&quot;. --&gt;
+
+    &lt;/ul&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the
+    &lt;URI-reference&gt; production, even after the above changes are
+    made to the ABNF definitions, then parsing the URL fails with an
+    error. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
+    components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+    defined as follows:&lt;/p&gt;
+
+    &lt;dl&gt;&lt;dt&gt;&lt;dfn id=url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-host title=url-host&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;host&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-port title=url-port&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;port&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-hostport title=url-hostport&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt;
+     component and the port given by the &lt;port&gt; component is
+     different than the default port defined for the protocol given by
+     the &lt;scheme&gt; component, then &lt;hostport&gt; is the
+     substring that starts with the substring matched by the
+     &lt;host&gt; production and ends with the substring matched by the
+     &lt;port&gt; production, and includes the colon in between the
+     two. Otherwise, it is the same as the &lt;host&gt; component.&lt;/p&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-path title=url-path&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;The substring matched by one of the following productions, if
+      one of them was matched:&lt;/p&gt;
+
+      &lt;ul class=brief&gt;&lt;li&gt;&lt;path-abempty&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-absolute&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-noscheme&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-rootless&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-empty&gt;&lt;/li&gt;
+      &lt;/ul&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-query title=url-query&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;query&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn id=url-host-specific title=url-host-specific&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring that &lt;em&gt;follows&lt;/em&gt; the substring matched
+     by the &lt;authority&gt; production, or the whole string if the
+     &lt;authority&gt; production wasn't matched.&lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;These parsing rules are a &lt;a href=#willful-violation&gt;willful
+  violation&lt;/a&gt; of RFC 3986 and RFC 3987 (which do not define error
+  handling), motivated by a desire to handle legacy content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;/div&gt;
+
+
+  &lt;h4 id=resolving-urls&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
+
+  &lt;p&gt;Resolving a URL is the process of taking a relative URL and
+  obtaining the absolute URL that it implies.&lt;/p&gt;
+
+  &lt;div class=impl&gt;
+
+  &lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
   relative to either another &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; or an element,
   the user agent must use the following steps. Resolving a URL can
   result in an error, in which case the URL is not resolvable.&lt;/p&gt;
@@ -6159,12 +6304,114 @@
 
     &lt;/ol&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Return the result of applying the &lt;span class=XXX&gt;resolve
-   an address&lt;/span&gt; algorithm defined by the IRI specification to
-   resolve &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; using encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;a href=#parse-a-url title=&quot;parse a URL&quot;&gt;Parse&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;/div&gt;
+   &lt;li&gt;
 
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from expanding any sequences of percent-encoded octets in
+    that component that are valid UTF-8 sequences into Unicode
+    characters as defined by UTF-8.&lt;/p&gt;
+
+    &lt;p&gt;If any percent-encoded octets in that component are not valid
+    UTF-8 sequences, then return an error and abort these steps.&lt;/p&gt;
+
+    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring,
+    with both the AllowUnassigned and UseSTD3ASCIIRules flags
+    set. Replace the matching substring with the result of the ToASCII
+    algorithm.&lt;/p&gt;
+
+    &lt;p&gt;If ToASCII fails to convert one of the components of the
+    string, e.g. because it is too long or because it contains invalid
+    characters, then return an error and abort these steps. &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from applying the following steps to each character other
+    than U+0025 PERCENT SIGN (%) that doesn't match the original
+    &lt;path&gt; production defined in RFC 3986:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;Encode the character into a sequence of octets as defined by
+     UTF-8.&lt;/li&gt;
+
+     &lt;li&gt;Replace the character with the percent-encoded form of those
+     octets. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;div class=example&gt;
+
+     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code title=&quot;&quot;&gt;//example.com/a^b&#9786;c%FFd%z/?e&lt;/code&gt;&quot;, then the
+     &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component's substring
+     would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&#9786;c%FFd%z/&lt;/code&gt;&quot; and the two
+     characters that would have to be escaped would be &quot;&lt;code title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&#9786;&lt;/code&gt;&quot;. The
+     result after this step was applied would therefore be that &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
+
+    &lt;/div&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from applying the following steps to each character other
+    than U+0025 PERCENT SIGN (%) that doesn't match the original
+    &lt;query&gt; production defined in RFC 3986:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;If the character in question cannot be expressed in the
+     encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a
+     single 0x3F octet (an ASCII question mark) and skip the remaining
+     substeps for this character.&lt;/li&gt;
+
+     &lt;li&gt;Encode the character into a sequence of octets as defined by
+     the encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;Replace the character with the percent-encoded form of those
+     octets. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2
+   Relative Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the
+   potentially relative URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and
+   &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URI (&lt;var title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC
+    3987, returning an error and aborting these steps if
+    appropriate. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p class=example&gt;For instance, if an absolute URI that would be
+    returned by the above algorithm violates the restrictions specific
+    to its scheme, e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the
+    &quot;&lt;code title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax,
+    then user agents are to treat this as an error instead.&lt;!-- RFC
+    3986, 3.1 Scheme --&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution
+   algorithm.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a
+   server-based naming authority, replace all U+005C REVERSE SOLIDUS
+   (\) characters in &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS
+   (/) characters.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;Some of the steps in these rules, for example the
+  processing of U+005C REVERSE SOLIDUS (\) characters, are a
+  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986 and RFC 3987, motivated
+  by a desire to handle legacy content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;/div&gt;
+
   &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is an &lt;dfn id=absolute-url&gt;absolute URL&lt;/dfn&gt; if &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; it results in the same output
   regardless of what it is resolved relative to, and that output is
   not a failure.&lt;/p&gt;
@@ -6179,28 +6426,11 @@
   immediately after the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
   component and they are both U+002F SOLIDUS characters (//).&lt;/p&gt;
 
-  &lt;hr&gt;&lt;p&gt;This specification defines the URL
-  &lt;dfn id=about:legacy-compat&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;a href=#syntax-doctype title=syntax-doctype&gt;DOCTYPE&lt;/a&gt;s in &lt;a href=#html-documents&gt;HTML
-  documents&lt;/a&gt; when needed for compatibility with XML tools. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn id=about:srcdoc&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
-  &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; of &lt;a href=#an-iframe-srcdoc-document title=&quot;an iframe srcdoc
-  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; documents&lt;/a&gt;. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p class=note&gt;The term &quot;URL&quot; in this specification is used in a
-  manner distinct from the precise technical meaning it is given in
-  RFC 3986. Readers familiar with that RFC will find it easier to read
-  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
-  herein is really called something else altogether. This is a
-  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-
   &lt;div class=impl&gt;
 
-  &lt;h4 id=dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.6.2 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
+  &lt;h4 id=dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.6.4 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
 
   &lt;p&gt;When an &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attribute
   changes, the attribute's element, and all descendant elements, are
@@ -6273,7 +6503,7 @@
 
 
 
-  &lt;h4 id=interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.6.3 &lt;/span&gt;Interfaces for URL manipulation&lt;/h4&gt;
+  &lt;h4 id=interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.6.5 &lt;/span&gt;Interfaces for URL manipulation&lt;/h4&gt;
 
   &lt;p&gt;An interface that has a complement of &lt;dfn id=url-decomposition-idl-attributes&gt;URL decomposition IDL
   attributes&lt;/dfn&gt; has seven attributes with the following

Modified: source
===================================================================
--- source	2011-04-14 00:58:14 UTC (rev 6006)
+++ source	2011-04-14 22:17:54 UTC (rev 6007)
@@ -5609,10 +5609,23 @@
 
   &lt;h3&gt;URLs&lt;/h3&gt;
 
+  &lt;p&gt;This specification defines the term &lt;span&gt;URL&lt;/span&gt;, and defines
+  various algorithms for dealing with URLs, because for historical
+  reasons the rules defined by the URI and IRI specifications are not
+  a complete description of what HTML user agents need to implement to
+  be compatible with Web content.&lt;/p&gt;
+
+  &lt;p class=&quot;note&quot;&gt;The term &quot;URL&quot; in this specification is used in a
+  manner distinct from the precise technical meaning it is given in
+  RFC 3986. Readers familiar with that RFC will find it easier to read
+  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
+  herein is really called something else altogether. This is a
+  &lt;span&gt;willful violation&lt;/span&gt; of RFC 3986. &lt;a
+  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+
+
   &lt;h4&gt;Terminology&lt;/h4&gt;
 
-  &lt;!-- see also: svn diff -r3244:3245 source --&gt;
-
   &lt;p&gt;A &lt;dfn&gt;URL&lt;/dfn&gt; is a string used to identify a resource.&lt;/p&gt;
 
   &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is a &lt;dfn&gt;valid URL&lt;/dfn&gt; if at least one of
@@ -5650,29 +5663,176 @@
   whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/span&gt; from
   it, it is a &lt;span&gt;valid non-empty URL&lt;/span&gt;.&lt;/p&gt;
 
+  &lt;p&gt;This specification defines the URL
+  &lt;dfn&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;span
+  title=&quot;syntax-doctype&quot;&gt;DOCTYPE&lt;/span&gt;s in &lt;span&gt;HTML
+  documents&lt;/span&gt; when needed for compatibility with XML tools. &lt;a
+  href=&quot;#refsABOUT&quot;&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;This specification defines the URL
+  &lt;dfn&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
+  &lt;span&gt;the document's address&lt;/span&gt; of &lt;span title=&quot;an iframe srcdoc
+  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code
+  title=&quot;attr-iframe-srcdoc&quot;&gt;srcdoc&lt;/code&gt; documents&lt;/span&gt;. &lt;a
+  href=&quot;#refsABOUT&quot;&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
+
+
   &lt;div class=&quot;impl&quot;&gt;
 
+  &lt;h4&gt;Parsing URLs&lt;/h4&gt;
+
   &lt;p&gt;To &lt;dfn&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
-  component parts, the user agent must use the &lt;span class=&quot;XXX&quot;&gt;parse
-  an address&lt;/span&gt; algorithm defined by the IRI specification. &lt;a
+  component parts, the user agent must use the following steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;Strip leading and trailing &lt;span title=&quot;space
+   character&quot;&gt;space characters&lt;/span&gt; from &lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC
+    3986, with the following exceptions:&lt;/p&gt;
+
+    &lt;ul&gt;
+
+     &lt;li&gt;Add all characters with code points less than or equal to
+     U+0020 or greater than or equal to U+007F to the
+     &lt;unreserved&gt; production.&lt;/li&gt;
+
+     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E,
+     U+0060, and U+007B .. U+007D to the &lt;unreserved&gt;
+     production.
+      &lt;!--
+       0022 QUOTATION MARK
+       003C LESS-THAN SIGN
+       003E GREATER-THAN SIGN
+       005B LEFT SQUARE BRACKET
+       005C REVERSE SOLIDUS
+       005D RIGHT SQUARE BRACKET
+       005E CIRCUMFLEX ACCENT
+       0060 GRAVE ACCENT
+       007B LEFT CURLY BRACKET
+       007C VERTICAL LINE
+       007D RIGHT CURLY BRACKET
+      --&gt;
+     &lt;/li&gt;
+
+     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second
+     alternative way of matching the &lt;pct-encoded&gt; production,
+     except when the &lt;pct-encoded&gt; is used in the
+     &lt;reg-name&gt; production.&lt;/li&gt;
+
+     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters
+     allowed in the &lt;fragment&gt; production.&lt;/li&gt;
+
+     &lt;!-- some browsers also have other differences, e.g. Mozilla
+     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
+     is &quot;ftp&quot;. --&gt;
+
+    &lt;/ul&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the
+    &lt;URI-reference&gt; production, even after the above changes are
+    made to the ABNF definitions, then parsing the URL fails with an
+    error. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
+    components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+    defined as follows:&lt;/p&gt;
+
+    &lt;dl&gt;
+
+     &lt;dt&gt;&lt;dfn title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;host&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;port&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn title=&quot;url-hostport&quot;&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt;
+     component and the port given by the &lt;port&gt; component is
+     different than the default port defined for the protocol given by
+     the &lt;scheme&gt; component, then &lt;hostport&gt; is the
+     substring that starts with the substring matched by the
+     &lt;host&gt; production and ends with the substring matched by the
+     &lt;port&gt; production, and includes the colon in between the
+     two. Otherwise, it is the same as the &lt;host&gt; component.&lt;/p&gt;
+
+
+     &lt;dt&gt;&lt;dfn title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;The substring matched by one of the following productions, if
+      one of them was matched:&lt;/p&gt;
+
+      &lt;ul class=&quot;brief&quot;&gt;
+       &lt;li&gt;&lt;path-abempty&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-absolute&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-noscheme&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-rootless&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;path-empty&gt;&lt;/li&gt;
+      &lt;/ul&gt;
+
+     &lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;query&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
+
+
+     &lt;dt&gt;&lt;dfn title=&quot;url-host-specific&quot;&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/dt&gt;
+
+     &lt;dd&gt;&lt;p&gt;The substring that &lt;em&gt;follows&lt;/em&gt; the substring matched
+     by the &lt;authority&gt; production, or the whole string if the
+     &lt;authority&gt; production wasn't matched.&lt;/p&gt;&lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p class=&quot;note&quot;&gt;These parsing rules are a &lt;span&gt;willful
+  violation&lt;/span&gt; of RFC 3986 and RFC 3987 (which do not define error
+  handling), motivated by a desire to handle legacy content. &lt;a
+  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;Parsing a URL can fail. If it does not, then it results in the
-  following components, again as defined by the IRI specification:&lt;/p&gt;
+  &lt;/div&gt;
 
-  &lt;ul class=&quot;brief&quot;&gt;
-   &lt;li&gt;&lt;dfn title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn title=&quot;url-hostport&quot;&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/li&gt;
-   &lt;li&gt;&lt;dfn title=&quot;url-host-specific&quot;&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/li&gt;
-  &lt;/ul&gt;
 
-  &lt;hr&gt;
+  &lt;h4&gt;Resolving URLs&lt;/h4&gt;
 
+  &lt;p&gt;Resolving a URL is the process of taking a relative URL and
+  obtaining the absolute URL that it implies.&lt;/p&gt;
+
+  &lt;div class=&quot;impl&quot;&gt;
+
   &lt;p&gt;To &lt;dfn&gt;resolve a URL&lt;/dfn&gt; to an &lt;span&gt;absolute URL&lt;/span&gt;
   relative to either another &lt;span&gt;absolute URL&lt;/span&gt; or an element,
   the user agent must use the following steps. Resolving a URL can
@@ -5791,14 +5951,136 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Return the result of applying the &lt;span class=&quot;XXX&quot;&gt;resolve
-   an address&lt;/span&gt; algorithm defined by the IRI specification to
-   resolve &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var
-   title=&quot;&quot;&gt;base&lt;/var&gt; using encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;. &lt;a
-   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;parse a URL&quot;&gt;Parse&lt;/span&gt; &lt;var
+   title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
+    title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from expanding any sequences of percent-encoded octets in
+    that component that are valid UTF-8 sequences into Unicode
+    characters as defined by UTF-8.&lt;/p&gt;
+
+    &lt;p&gt;If any percent-encoded octets in that component are not valid
+    UTF-8 sequences, then return an error and abort these steps.&lt;/p&gt;
+
+    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring,
+    with both the AllowUnassigned and UseSTD3ASCIIRules flags
+    set. Replace the matching substring with the result of the ToASCII
+    algorithm.&lt;/p&gt;
+
+    &lt;p&gt;If ToASCII fails to convert one of the components of the
+    string, e.g. because it is too long or because it contains invalid
+    characters, then return an error and abort these steps. &lt;a
+    href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
+    title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from applying the following steps to each character other
+    than U+0025 PERCENT SIGN (%) that doesn't match the original
+    &lt;path&gt; production defined in RFC 3986:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;Encode the character into a sequence of octets as defined by
+     UTF-8.&lt;/li&gt;
+
+     &lt;li&gt;Replace the character with the percent-encoded form of those
+     octets. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+    &lt;div class=&quot;example&quot;&gt;
+
+     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code
+     title=&quot;&quot;&gt;//example.com/a^b&amp;#x263a;c%FFd%z/?e&lt;/code&gt;&quot;, then the
+     &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component's substring
+     would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&amp;#x263a;c%FFd%z/&lt;/code&gt;&quot; and the two
+     characters that would have to be escaped would be &quot;&lt;code
+     title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&amp;#x263a;&lt;/code&gt;&quot;. The
+     result after this step was applied would therefore be that &lt;var
+     title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code
+     title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
+
+    &lt;/div&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
+    title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component, then replace the
+    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
+    results from applying the following steps to each character other
+    than U+0025 PERCENT SIGN (%) that doesn't match the original
+    &lt;query&gt; production defined in RFC 3986:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;If the character in question cannot be expressed in the
+     encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a
+     single 0x3F octet (an ASCII question mark) and skip the remaining
+     substeps for this character.&lt;/li&gt;
+
+     &lt;li&gt;Encode the character into a sequence of octets as defined by
+     the encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;Replace the character with the percent-encoded form of those
+     octets. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2
+   Relative Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the
+   potentially relative URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and
+   &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URI (&lt;var
+   title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC
+    3987, returning an error and aborting these steps if
+    appropriate. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
+    &lt;p class=&quot;example&quot;&gt;For instance, if an absolute URI that would be
+    returned by the above algorithm violates the restrictions specific
+    to its scheme, e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the
+    &quot;&lt;code title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax,
+    then user agents are to treat this as an error instead.&lt;!-- RFC
+    3986, 3.1 Scheme --&gt;&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var
+   title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution
+   algorithm.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a
+   server-based naming authority, replace all U+005C REVERSE SOLIDUS
+   (\) characters in &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS
+   (/) characters.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
   &lt;/ol&gt;
 
+  &lt;p class=&quot;note&quot;&gt;Some of the steps in these rules, for example the
+  processing of U+005C REVERSE SOLIDUS (\) characters, are a
+  &lt;span&gt;willful violation&lt;/span&gt; of RFC 3986 and RFC 3987, motivated
+  by a desire to handle legacy content. &lt;a
+  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
+  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+
   &lt;/div&gt;
 
   &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is an &lt;dfn&gt;absolute URL&lt;/dfn&gt; if &lt;span
@@ -5818,32 +6100,8 @@
   immediately after the &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt;
   component and they are both U+002F SOLIDUS characters (//).&lt;/p&gt;
 
-  &lt;hr&gt;
 
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;span
-  title=&quot;syntax-doctype&quot;&gt;DOCTYPE&lt;/span&gt;s in &lt;span&gt;HTML
-  documents&lt;/span&gt; when needed for compatibility with XML tools. &lt;a
-  href=&quot;#refsABOUT&quot;&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
-  &lt;span&gt;the document's address&lt;/span&gt; of &lt;span title=&quot;an iframe srcdoc
-  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code
-  title=&quot;attr-iframe-srcdoc&quot;&gt;srcdoc&lt;/code&gt; documents&lt;/span&gt;. &lt;a
-  href=&quot;#refsABOUT&quot;&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The term &quot;URL&quot; in this specification is used in a
-  manner distinct from the precise technical meaning it is given in
-  RFC 3986. Readers familiar with that RFC will find it easier to read
-  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
-  herein is really called something else altogether. This is a
-  &lt;span&gt;willful violation&lt;/span&gt; of RFC 3986. &lt;a
-  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-
   &lt;div class=&quot;impl&quot;&gt;
 
   &lt;h4&gt;Dynamic changes to base URLs&lt;/h4&gt;


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012873.html">[html5] r6006 - [e] (0) apply wg decision Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=10963
</A></li>
	<LI>Next message: <A HREF="012875.html">[html5] r6008 - [ac] (1) apply wg decision (add the &lt;table	border=1&gt; talisman) Fixing http://www [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12874">[ date ]</a>
              <a href="thread.html#12874">[ thread ]</a>
              <a href="subject.html#12874">[ subject ]</a>
              <a href="author.html#12874">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
