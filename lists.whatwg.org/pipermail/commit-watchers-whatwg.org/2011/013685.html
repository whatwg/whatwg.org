<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r6819 - [giow] (2) Tighten up onerror's definition. Fixing	http://www.w3.org/Bugs/Public [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6819%20-%20%5Bgiow%5D%20%282%29%20Tighten%20up%20onerror%27s%20definition.%20Fixing%0A%09http%3A//www.w3.org/Bugs/Public%20%5B...%5D&In-Reply-To=%3C20111110234503.F149E1C8400D%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013684.html">
   <LINK REL="Next"  HREF="013686.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r6819 - [giow] (2) Tighten up onerror's definition. Fixing	http://www.w3.org/Bugs/Public [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6819%20-%20%5Bgiow%5D%20%282%29%20Tighten%20up%20onerror%27s%20definition.%20Fixing%0A%09http%3A//www.w3.org/Bugs/Public%20%5B...%5D&In-Reply-To=%3C20111110234503.F149E1C8400D%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r6819 - [giow] (2) Tighten up onerror's definition. Fixing	http://www.w3.org/Bugs/Public [...]">whatwg at whatwg.org
       </A><BR>
    <I>Thu Nov 10 15:45:03 PST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013684.html">[html5] r6818 - [giow] (2) Change how nested clicks are prevented	to also prevent click() inside [...]
</A></li>
        <LI>Next message: <A HREF="013686.html">[html5] r6820 - [giow] (0) consistency with other APIs Fixing	http://www.w3.org/Bugs/Public/show [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13685">[ date ]</a>
              <a href="thread.html#13685">[ thread ]</a>
              <a href="subject.html#13685">[ subject ]</a>
              <a href="author.html#13685">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2011-11-10 15:45:02 -0800 (Thu, 10 Nov 2011)
New Revision: 6819

Modified:
   complete.html
   index
   source
Log:
[giow] (2) Tighten up onerror's definition.
Fixing <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=14176">http://www.w3.org/Bugs/Public/show_bug.cgi?id=14176</A>

Modified: complete.html
===================================================================
--- complete.html	2011-11-04 17:34:58 UTC (rev 6818)
+++ complete.html	2011-11-10 23:45:02 UTC (rev 6819)
@@ -240,7 +240,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 4 November 2011&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 10 November 2011&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -16098,7 +16098,8 @@
 
         &lt;p&gt;&lt;a href=#create-a-script-from-a-node title=&quot;create a script from a node&quot;&gt;Create a
         script&lt;/a&gt; from the &lt;code&gt;&lt;a href=#the-script-element&gt;script&lt;/a&gt;&lt;/code&gt; element node, using
-        &lt;var&gt;&lt;a href=&quot;#the-script-block's-source&quot;&gt;the script block's source&lt;/a&gt;&lt;/var&gt; and &lt;var&gt;&lt;a href=&quot;#the-script-block's-type&quot;&gt;the script
+        &lt;var&gt;&lt;a href=&quot;#the-script-block's-source&quot;&gt;the script block's source&lt;/a&gt;&lt;/var&gt;, the &lt;a href=#url&gt;URL&lt;/a&gt;
+        from which the script was obtained, and &lt;var&gt;&lt;a href=&quot;#the-script-block's-type&quot;&gt;the script
         block's type&lt;/a&gt;&lt;/var&gt;.&lt;/p&gt;
 
         &lt;p class=note&gt;This is where the script is compiled and
@@ -68008,10 +68009,10 @@
   &lt;h5 id=creating-scripts&gt;&lt;span class=secno&gt;7.1.3.3 &lt;/span&gt;Creating scripts&lt;/h5&gt;
 
   &lt;p&gt;When the specification says that a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; is to be &lt;dfn id=create-a-script title=&quot;create a
-  script&quot;&gt;created&lt;/dfn&gt;, given some script source, its scripting
-  language, a global object, a browsing context, a URL character
-  encoding, and a base URL, the user agent must run the following
-  steps:&lt;/p&gt;
+  script&quot;&gt;created&lt;/dfn&gt;, given some script source, a script source
+  URL, its scripting language, a global object, a browsing context, a
+  URL character encoding, and a base URL, the user agent must run the
+  following steps:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting is
    disabled&lt;/a&gt; for &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; passed to this
@@ -68042,7 +68043,9 @@
     entry-point&quot;&gt;Jump&lt;/a&gt; to the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;i&gt;&lt;a href=#initial-code-entry-point&gt;initial code
     entry-point&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
+    &lt;p&gt;Otherwise, &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; at the script source
+    URL, with the problematic line number, in the script's
+    &lt;a href=#origin&gt;origin&lt;/a&gt;, using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
     handlers&quot;&gt;event handler&lt;/a&gt; of the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global
     object&lt;/a&gt;. If the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; after this, then
     the error may be reported to the user.&lt;/p&gt;
@@ -68050,19 +68053,20 @@
    &lt;/li&gt;
 
   &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;When the user agent is to &lt;dfn id=create-an-impotent-script&gt;create an impotent script&lt;/dfn&gt;,
-  given some script source, its scripting language, and a browsing
-  context, the user agent must &lt;a href=#create-a-script&gt;create a script&lt;/a&gt;, using the
-  given script source and scripting language, using a new empty object
-  as the global object, and using the given browsing context as the
-  browsing context. The URL character encoding and base URL for the
-  resulting &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; are not
-  important as no APIs are exposed to the script.&lt;/p&gt;
+  given some script source and URL, its scripting language, and a
+  browsing context, the user agent must &lt;a href=#create-a-script&gt;create a script&lt;/a&gt;,
+  using the given script source, URL, and scripting language, using a
+  new empty object as the global object, and using the given browsing
+  context as the browsing context. The URL character encoding and base
+  URL for the resulting &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; are
+  not important as no APIs are exposed to the script.&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;When the specification says that a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; is to be &lt;dfn id=create-a-script-from-a-node title=&quot;create a
-  script from a node&quot;&gt;created from a node&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, given some script source and its scripting
-  language, the user agent must &lt;a href=#create-a-script&gt;create a script&lt;/a&gt;, using
-  the given script source and scripting language, and using &lt;a href=#the-script-settings-determined-from-the-node&gt;the
-  script settings determined from the node&lt;/a&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;
+  script from a node&quot;&gt;created from a node&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, given some script source, its URL, and its
+  scripting language, the user agent must &lt;a href=#create-a-script&gt;create a
+  script&lt;/a&gt;, using the given script source, URL, and scripting
+  language, and using &lt;a href=#the-script-settings-determined-from-the-node&gt;the script settings determined from the
+  node&lt;/a&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;
 
   &lt;p&gt;&lt;dfn id=the-script-settings-determined-from-the-node&gt;The script settings determined from the node&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; are computed as follows:&lt;/p&gt;
 
@@ -68125,35 +68129,42 @@
   &lt;h5 id=runtime-script-errors&gt;&lt;span class=secno&gt;7.1.3.5 &lt;/span&gt;Runtime script errors&lt;/h5&gt;
 
   &lt;p&gt;When the user agent is required to &lt;dfn id=report-the-error title=&quot;report the
-  error&quot;&gt;report an error&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; using the
-  &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;onerror&lt;/var&gt;, it must run these steps, after which the
-  error is either &lt;dfn id=concept-error-handled title=concept-error-handled&gt;&lt;i&gt;handled&lt;/i&gt;&lt;/dfn&gt; or &lt;dfn id=concept-error-nothandled title=concept-error-nothandled&gt;&lt;i&gt;not handled&lt;/i&gt;&lt;/dfn&gt;:&lt;/p&gt;
+  error&quot;&gt;report an error&lt;/dfn&gt; at a particular &lt;a href=#url&gt;URL&lt;/a&gt; &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; with a particular line number &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; in a particular origin &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, using the &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
+  handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;onerror&lt;/var&gt;, it must run these steps,
+  after which the error is either &lt;dfn id=concept-error-handled title=concept-error-handled&gt;&lt;i&gt;handled&lt;/i&gt;&lt;/dfn&gt; or &lt;dfn id=concept-error-nothandled title=concept-error-nothandled&gt;&lt;i&gt;not handled&lt;/i&gt;&lt;/dfn&gt;:&lt;/p&gt;
 
   &lt;dl class=switch&gt;&lt;dt&gt;If the value of &lt;var title=&quot;&quot;&gt;onerror&lt;/var&gt; is a
    &lt;code&gt;&lt;a href=#function&gt;Function&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;The function must be invoked with three arguments. The first
-    two arguments passed to the function must be of type
-    &lt;code&gt;DOMString&lt;/code&gt;, and the third must be of type
-    &lt;code&gt;unsigned long&lt;/code&gt;. The first must give the message that
-    the UA is considering reporting, the second must give the
-    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of the resource in which the error
-    occurred, and the third must give the line number in that resource
-    on which the error occurred.&lt;/p&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be a user-agent-defined
+     string describing the error in a helpful manner.&lt;/li&gt;
 
-    &lt;p&gt;If the function returns false, then the error is &lt;i title=concept-error-handled&gt;&lt;a href=#concept-error-handled&gt;handled&lt;/a&gt;&lt;/i&gt;. Otherwise, the error is
-    &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; &lt;a href=#url&gt;URL&lt;/a&gt; does
+     not have a &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt;
+     &lt;a href=#origin&gt;origin&lt;/a&gt; as the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, then set
+     &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; to &quot;&lt;code title=&quot;&quot;&gt;Script
+     error.&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; to the empty
+     string, and set &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; to 0.&lt;/li&gt;
 
-    &lt;p&gt;Any uncaught exceptions thrown or errors caused by this
-    function may be reported to the user immediately after the error
-    that the function was called for; the &lt;a href=#report-the-error title=&quot;report the
-    error&quot;&gt;report an error&lt;/a&gt; algorithm must not be used to handle
-    exceptions thrown or errors caused by this function.&lt;/p&gt;
+     &lt;li&gt;
 
-   &lt;/dd&gt;
+      &lt;p&gt;The function must be invoked with three arguments: &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;
 
+      &lt;p&gt;If the function returns false, then the error is &lt;i title=concept-error-handled&gt;&lt;a href=#concept-error-handled&gt;handled&lt;/a&gt;&lt;/i&gt;. Otherwise, the error is
+      &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Any uncaught exceptions thrown or errors caused by this
+      function may be reported to the user immediately after the error
+      that the function was called for; the &lt;a href=#report-the-error title=&quot;report the
+      error&quot;&gt;report an error&lt;/a&gt; algorithm must not be used to handle
+      exceptions thrown or errors caused by this function.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/dd&gt;
+
    &lt;dt&gt;Otherwise&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -68166,11 +68177,34 @@
 
   &lt;p&gt;Whenever an uncaught runtime script error occurs in one of the
   scripts associated with a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, the user agent must
-  &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
+  &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; at the URL of the resource containing
+  the script (as established when the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; was &lt;a href=#create-a-script title=&quot;create a
+  script&quot;&gt;created&lt;/a&gt;), with the problematic line number in that
+  resource, in the script's &lt;a href=#origin&gt;origin&lt;/a&gt;, using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
   handlers&quot;&gt;event handler&lt;/a&gt; of the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global
   object&lt;/a&gt;. If the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; after this, then
   the error may be reported to the user.&lt;/p&gt;
 
+  &lt;p&gt;The resource containing the script will typically be the file
+  from which the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; was parsed, e.g. for inline
+  &lt;code&gt;&lt;a href=#the-script-element&gt;script&lt;/a&gt;&lt;/code&gt; elements or &lt;a href=#event-handler-content-attributes&gt;event handler content
+  attributes&lt;/a&gt;; or the JavaScript file that the script was in,
+  for external scripts. Even for dynamically-generated scripts, user
+  agents are strongly encouraged to attempt to keep track of the
+  original source of a script. For example, if an external script uses
+  the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; API to
+  insert an inline &lt;code&gt;&lt;a href=#the-script-element&gt;script&lt;/a&gt;&lt;/code&gt; element during parsing, the URL
+  of the resource containing the script would ideally be reported as
+  being the external script, and the line number might ideally be
+  reported as the line with the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; call or where the
+  string passed to that call was first constructed. Naturally,
+  implementing this can be somewhat non-trivial.&lt;/p&gt;
+
+  &lt;p&gt;User agents are similarly encouraged to keep careful track of the
+  original line numbers, even in the face of &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; calls mutating
+  the document as it is parsed, or &lt;a href=#event-handler-content-attributes&gt;event handler content
+  attributes&lt;/a&gt; spanning multiple lines.&lt;/p&gt;
+
   &lt;/div&gt;
 
 
@@ -68514,7 +68548,9 @@
       &lt;p&gt;&lt;a href=#create-a-script-from-a-node title=&quot;create a script from a node&quot;&gt;Create a
       script&lt;/a&gt; from the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; node of the
       &lt;a href=#active-document&gt;active document&lt;/a&gt;, using the aforementioned script
-      source, and assuming the scripting language is JavaScript.&lt;/p&gt;
+      source, the &lt;a href=#url&gt;URL&lt;/a&gt; of the resource where the
+      &lt;code&gt;javascript:&lt;/code&gt; URL, was found, and assuming the
+      scripting language is JavaScript.&lt;/p&gt;
 
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the return value of the
       &lt;i&gt;&lt;a href=#initial-code-entry-point&gt;initial code entry-point&lt;/a&gt;&lt;/i&gt; of this &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;. If an exception was
@@ -68655,6 +68691,13 @@
   requirements, in particular the &lt;code title=handler-MessagePort-onmessage&gt;&lt;a href=#handler-messageport-onmessage&gt;onmessage&lt;/a&gt;&lt;/code&gt; attribute of
   &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects.&lt;/p&gt;
 
+  &lt;p&gt;On getting, &lt;a href=#event-handler-idl-attributes&gt;event handler IDL attributes&lt;/a&gt; must return
+  the value of their corresponding event handlers, except when the
+  value is an &lt;a href=#concept-handler-error title=concept-handler-error&gt;internal error
+  value&lt;/a&gt;, in which case the user agent must set the corresponding
+  event handler to null, and then throw an exception corresponding to
+  the error condition.&lt;/p&gt;
+
   &lt;hr&gt;&lt;/div&gt;
 
   &lt;p&gt;&lt;dfn id=event-handler-content-attributes&gt;Event handler content attributes&lt;/dfn&gt;, when specified, must
@@ -68687,7 +68730,8 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as
     &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects an &lt;i&gt;early error&lt;/i&gt;
-    then abort these steps.&lt;/p&gt;
+    then &lt;a href=#set-the-event-handler-content-attribute-to-an-error&gt;set the event handler content attribute to an
+    error&lt;/a&gt; as defined below, and abort these steps.&lt;/p&gt;
 
     &lt;p class=note&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript
     edition 5 section 13 Function Definition. &lt;i&gt;Early error&lt;/i&gt; is
@@ -68714,7 +68758,9 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var
     title=&quot;&quot;&gt;body&lt;/var&gt; is a &lt;code&gt;SyntaxError&lt;/code&gt; according to the
-    Strict Mode Restrictions, then abort these steps.&lt;/p&gt;
+    Strict Mode Restrictions, then &lt;span&gt;set the event handler content
+    attribute to an error&lt;/span&gt; as defined below, and abort these
+    steps.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in
     ECMAScript edition 5 section 13.1 Strict Mode Restrictions. &lt;a
@@ -68786,8 +68832,18 @@
    &lt;li&gt;&lt;p&gt;Set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
    handler&lt;/a&gt; to the aforementioned function.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;When an event handler content attribute is removed, the user
+  &lt;/ol&gt;&lt;p&gt;When a user agent is required, by the steps above, to &lt;dfn id=set-the-event-handler-content-attribute-to-an-error&gt;set
+  the event handler content attribute to an error&lt;/dfn&gt;, the user
   agent must set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
+  handler&lt;/a&gt; to an &lt;dfn id=concept-handler-error title=concept-handler-error&gt;internal
+  error value&lt;/dfn&gt; representing the error condition, keeping track of
+  the &lt;a href=#url&gt;URL&lt;/a&gt; of the resource where the &lt;a href=#event-handler-content-attributes title=&quot;event
+  handler content attributes&quot;&gt;event handler content attribute&lt;/a&gt;
+  was set, and the relevant line number inside that resource where the
+  error occurred.&lt;/p&gt;
+
+  &lt;p&gt;When an event handler content attribute is removed, the user
+  agent must set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
   handler&lt;/a&gt; to null.&lt;/p&gt;
   &lt;!--
   <A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/saved/245">http://software.hixie.ch/utilities/js/live-dom-viewer/saved/245</A> onload
@@ -68809,9 +68865,8 @@
 
   &lt;hr&gt;&lt;p&gt;When an &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; of an element or object &lt;var title=&quot;&quot;&gt;T&lt;/var&gt;
   implementing the &lt;code&gt;&lt;a href=#eventtarget&gt;EventTarget&lt;/a&gt;&lt;/code&gt; interface is first set to
-  a non-null &lt;code&gt;&lt;a href=#function&gt;Function&lt;/a&gt;&lt;/code&gt; object, the user agent must append
-  an &lt;a href=#concept-event-listener title=concept-event-listener&gt;event listener&lt;/a&gt; to the
-  list of &lt;a href=#concept-event-listener title=concept-event-listener&gt;event listeners&lt;/a&gt;
+  a non-null value, the user agent must append an &lt;a href=#concept-event-listener title=concept-event-listener&gt;event listener&lt;/a&gt; to the list of
+  &lt;a href=#concept-event-listener title=concept-event-listener&gt;event listeners&lt;/a&gt;
   associated with &lt;var title=&quot;&quot;&gt;T&lt;/var&gt; with &lt;i&gt;type&lt;/i&gt; set to the
   &lt;dfn id=event-handler-event-type&gt;event handler event type&lt;/dfn&gt; corresponding to &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;, &lt;i&gt;capture&lt;/i&gt; set to false, and &lt;i&gt;listener&lt;/i&gt;
   set to &lt;a href=#the-event-handler-processing-algorithm&gt;the event handler processing algorithm&lt;/a&gt; defined
@@ -68867,6 +68922,16 @@
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is null, then abort these
    steps.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;a href=#concept-handler-error title=concept-handler-error&gt;internal error value&lt;/a&gt;, then set
+   the &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to null and
+   then &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; at the appropriate URL and with
+   the appropriate line number, as established when the error was
+   detected, in the &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
+   of the node of the &lt;a href=#event-handler-content-attributes title=&quot;event handler content
+   attributes&quot;&gt;event handler content attribute&lt;/a&gt;, using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
+   handlers&quot;&gt;event handler&lt;/a&gt; of the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of
+   that &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, and abort these steps.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s
    value, the &lt;code&gt;&lt;a href=#function&gt;Function&lt;/a&gt;&lt;/code&gt; object that the &lt;a href=#event-handlers title=&quot;event
    handlers&quot;&gt;event handler&lt;/a&gt; was last set to.&lt;/li&gt;
@@ -69681,7 +69746,11 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that checks
-   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt; has been cleared, and if it has not, &lt;a href=#create-a-script title=&quot;create a script&quot;&gt;creates a script&lt;/a&gt; using &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, &lt;var title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting language, &lt;var title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; as the document, &lt;var title=&quot;&quot;&gt;character
+   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt; has been cleared, and if it has not, &lt;a href=#create-a-script title=&quot;create a script&quot;&gt;creates a script&lt;/a&gt; using &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, the
+   &lt;a href=#url&gt;URL&lt;/a&gt; where &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; can be
+   found, &lt;var title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting
+   language, &lt;var title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object,
+   &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; as the document, &lt;var title=&quot;&quot;&gt;character
    encoding&lt;/var&gt; as the URL character encoding, and &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; as the base URL.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for these &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; is the &lt;dfn id=timer-task-source&gt;timer task
@@ -78597,8 +78666,10 @@
   &lt;p&gt;Whenever an uncaught runtime script error occurs in one of the
   worker's scripts, if the error did not occur while handling a
   previous script error, the user agent must &lt;a href=#report-the-error&gt;report the
-  error&lt;/a&gt; using the &lt;code&gt;&lt;a href=#workerglobalscope&gt;WorkerGlobalScope&lt;/a&gt;&lt;/code&gt; object's &lt;code title=handler-WorkerGlobalScope-onerror&gt;&lt;a href=#handler-workerglobalscope-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt;
-  attribute.
+  error&lt;/a&gt; at the &lt;a href=#url&gt;URL&lt;/a&gt; of the resource that contained
+  the script, with the line number where the error occurred, in the
+  &lt;a href=#origin&gt;origin&lt;/a&gt; of the scripts running in the worker, using the
+  &lt;code&gt;&lt;a href=#workerglobalscope&gt;WorkerGlobalScope&lt;/a&gt;&lt;/code&gt; object's &lt;code title=handler-WorkerGlobalScope-onerror&gt;&lt;a href=#handler-workerglobalscope-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; attribute.
   &lt;/p&gt;
 
   &lt;p&gt;For shared workers, if the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; afterwards, or if
@@ -79142,7 +79213,8 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;&lt;a href=#create-a-script&gt;Create a script&lt;/a&gt;, using &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; as the script source and &lt;var title=&quot;&quot;&gt;language&lt;/var&gt; as the scripting language, using the
+      &lt;p&gt;&lt;a href=#create-a-script&gt;Create a script&lt;/a&gt;, using &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; as the script source, the &lt;a href=#url&gt;URL&lt;/a&gt;
+      from which &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; was obtained, and &lt;var title=&quot;&quot;&gt;language&lt;/var&gt; as the scripting language, using the
       same global object, browsing context, URL character encoding,
       base URL, and script group as the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that was created by the
       worker's &lt;a href=#run-a-worker&gt;run a worker&lt;/a&gt; algorithm.&lt;/p&gt;

Modified: index
===================================================================
--- index	2011-11-04 17:34:58 UTC (rev 6818)
+++ index	2011-11-10 23:45:02 UTC (rev 6819)
@@ -240,7 +240,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 4 November 2011&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 10 November 2011&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -16098,7 +16098,8 @@
 
         &lt;p&gt;&lt;a href=#create-a-script-from-a-node title=&quot;create a script from a node&quot;&gt;Create a
         script&lt;/a&gt; from the &lt;code&gt;&lt;a href=#the-script-element&gt;script&lt;/a&gt;&lt;/code&gt; element node, using
-        &lt;var&gt;&lt;a href=&quot;#the-script-block's-source&quot;&gt;the script block's source&lt;/a&gt;&lt;/var&gt; and &lt;var&gt;&lt;a href=&quot;#the-script-block's-type&quot;&gt;the script
+        &lt;var&gt;&lt;a href=&quot;#the-script-block's-source&quot;&gt;the script block's source&lt;/a&gt;&lt;/var&gt;, the &lt;a href=#url&gt;URL&lt;/a&gt;
+        from which the script was obtained, and &lt;var&gt;&lt;a href=&quot;#the-script-block's-type&quot;&gt;the script
         block's type&lt;/a&gt;&lt;/var&gt;.&lt;/p&gt;
 
         &lt;p class=note&gt;This is where the script is compiled and
@@ -68008,10 +68009,10 @@
   &lt;h5 id=creating-scripts&gt;&lt;span class=secno&gt;7.1.3.3 &lt;/span&gt;Creating scripts&lt;/h5&gt;
 
   &lt;p&gt;When the specification says that a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; is to be &lt;dfn id=create-a-script title=&quot;create a
-  script&quot;&gt;created&lt;/dfn&gt;, given some script source, its scripting
-  language, a global object, a browsing context, a URL character
-  encoding, and a base URL, the user agent must run the following
-  steps:&lt;/p&gt;
+  script&quot;&gt;created&lt;/dfn&gt;, given some script source, a script source
+  URL, its scripting language, a global object, a browsing context, a
+  URL character encoding, and a base URL, the user agent must run the
+  following steps:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;a href=#concept-bc-noscript title=concept-bc-noscript&gt;scripting is
    disabled&lt;/a&gt; for &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; passed to this
@@ -68042,7 +68043,9 @@
     entry-point&quot;&gt;Jump&lt;/a&gt; to the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;i&gt;&lt;a href=#initial-code-entry-point&gt;initial code
     entry-point&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
+    &lt;p&gt;Otherwise, &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; at the script source
+    URL, with the problematic line number, in the script's
+    &lt;a href=#origin&gt;origin&lt;/a&gt;, using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
     handlers&quot;&gt;event handler&lt;/a&gt; of the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global
     object&lt;/a&gt;. If the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; after this, then
     the error may be reported to the user.&lt;/p&gt;
@@ -68050,19 +68053,20 @@
    &lt;/li&gt;
 
   &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;When the user agent is to &lt;dfn id=create-an-impotent-script&gt;create an impotent script&lt;/dfn&gt;,
-  given some script source, its scripting language, and a browsing
-  context, the user agent must &lt;a href=#create-a-script&gt;create a script&lt;/a&gt;, using the
-  given script source and scripting language, using a new empty object
-  as the global object, and using the given browsing context as the
-  browsing context. The URL character encoding and base URL for the
-  resulting &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; are not
-  important as no APIs are exposed to the script.&lt;/p&gt;
+  given some script source and URL, its scripting language, and a
+  browsing context, the user agent must &lt;a href=#create-a-script&gt;create a script&lt;/a&gt;,
+  using the given script source, URL, and scripting language, using a
+  new empty object as the global object, and using the given browsing
+  context as the browsing context. The URL character encoding and base
+  URL for the resulting &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; are
+  not important as no APIs are exposed to the script.&lt;/p&gt;
 
   &lt;hr&gt;&lt;p&gt;When the specification says that a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; is to be &lt;dfn id=create-a-script-from-a-node title=&quot;create a
-  script from a node&quot;&gt;created from a node&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, given some script source and its scripting
-  language, the user agent must &lt;a href=#create-a-script&gt;create a script&lt;/a&gt;, using
-  the given script source and scripting language, and using &lt;a href=#the-script-settings-determined-from-the-node&gt;the
-  script settings determined from the node&lt;/a&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;
+  script from a node&quot;&gt;created from a node&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, given some script source, its URL, and its
+  scripting language, the user agent must &lt;a href=#create-a-script&gt;create a
+  script&lt;/a&gt;, using the given script source, URL, and scripting
+  language, and using &lt;a href=#the-script-settings-determined-from-the-node&gt;the script settings determined from the
+  node&lt;/a&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;
 
   &lt;p&gt;&lt;dfn id=the-script-settings-determined-from-the-node&gt;The script settings determined from the node&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; are computed as follows:&lt;/p&gt;
 
@@ -68125,35 +68129,42 @@
   &lt;h5 id=runtime-script-errors&gt;&lt;span class=secno&gt;7.1.3.5 &lt;/span&gt;Runtime script errors&lt;/h5&gt;
 
   &lt;p&gt;When the user agent is required to &lt;dfn id=report-the-error title=&quot;report the
-  error&quot;&gt;report an error&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; using the
-  &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;onerror&lt;/var&gt;, it must run these steps, after which the
-  error is either &lt;dfn id=concept-error-handled title=concept-error-handled&gt;&lt;i&gt;handled&lt;/i&gt;&lt;/dfn&gt; or &lt;dfn id=concept-error-nothandled title=concept-error-nothandled&gt;&lt;i&gt;not handled&lt;/i&gt;&lt;/dfn&gt;:&lt;/p&gt;
+  error&quot;&gt;report an error&lt;/dfn&gt; at a particular &lt;a href=#url&gt;URL&lt;/a&gt; &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; with a particular line number &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; in a particular origin &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, using the &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
+  handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;onerror&lt;/var&gt;, it must run these steps,
+  after which the error is either &lt;dfn id=concept-error-handled title=concept-error-handled&gt;&lt;i&gt;handled&lt;/i&gt;&lt;/dfn&gt; or &lt;dfn id=concept-error-nothandled title=concept-error-nothandled&gt;&lt;i&gt;not handled&lt;/i&gt;&lt;/dfn&gt;:&lt;/p&gt;
 
   &lt;dl class=switch&gt;&lt;dt&gt;If the value of &lt;var title=&quot;&quot;&gt;onerror&lt;/var&gt; is a
    &lt;code&gt;&lt;a href=#function&gt;Function&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;The function must be invoked with three arguments. The first
-    two arguments passed to the function must be of type
-    &lt;code&gt;DOMString&lt;/code&gt;, and the third must be of type
-    &lt;code&gt;unsigned long&lt;/code&gt;. The first must give the message that
-    the UA is considering reporting, the second must give the
-    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of the resource in which the error
-    occurred, and the third must give the line number in that resource
-    on which the error occurred.&lt;/p&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be a user-agent-defined
+     string describing the error in a helpful manner.&lt;/li&gt;
 
-    &lt;p&gt;If the function returns false, then the error is &lt;i title=concept-error-handled&gt;&lt;a href=#concept-error-handled&gt;handled&lt;/a&gt;&lt;/i&gt;. Otherwise, the error is
-    &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; &lt;a href=#url&gt;URL&lt;/a&gt; does
+     not have a &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt;
+     &lt;a href=#origin&gt;origin&lt;/a&gt; as the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, then set
+     &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; to &quot;&lt;code title=&quot;&quot;&gt;Script
+     error.&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; to the empty
+     string, and set &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; to 0.&lt;/li&gt;
 
-    &lt;p&gt;Any uncaught exceptions thrown or errors caused by this
-    function may be reported to the user immediately after the error
-    that the function was called for; the &lt;a href=#report-the-error title=&quot;report the
-    error&quot;&gt;report an error&lt;/a&gt; algorithm must not be used to handle
-    exceptions thrown or errors caused by this function.&lt;/p&gt;
+     &lt;li&gt;
 
-   &lt;/dd&gt;
+      &lt;p&gt;The function must be invoked with three arguments: &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;
 
+      &lt;p&gt;If the function returns false, then the error is &lt;i title=concept-error-handled&gt;&lt;a href=#concept-error-handled&gt;handled&lt;/a&gt;&lt;/i&gt;. Otherwise, the error is
+      &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Any uncaught exceptions thrown or errors caused by this
+      function may be reported to the user immediately after the error
+      that the function was called for; the &lt;a href=#report-the-error title=&quot;report the
+      error&quot;&gt;report an error&lt;/a&gt; algorithm must not be used to handle
+      exceptions thrown or errors caused by this function.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/dd&gt;
+
    &lt;dt&gt;Otherwise&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -68166,11 +68177,34 @@
 
   &lt;p&gt;Whenever an uncaught runtime script error occurs in one of the
   scripts associated with a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, the user agent must
-  &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
+  &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; at the URL of the resource containing
+  the script (as established when the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; was &lt;a href=#create-a-script title=&quot;create a
+  script&quot;&gt;created&lt;/a&gt;), with the problematic line number in that
+  resource, in the script's &lt;a href=#origin&gt;origin&lt;/a&gt;, using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
   handlers&quot;&gt;event handler&lt;/a&gt; of the &lt;a href=&quot;#script's-global-object&quot;&gt;script's global
   object&lt;/a&gt;. If the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; after this, then
   the error may be reported to the user.&lt;/p&gt;
 
+  &lt;p&gt;The resource containing the script will typically be the file
+  from which the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; was parsed, e.g. for inline
+  &lt;code&gt;&lt;a href=#the-script-element&gt;script&lt;/a&gt;&lt;/code&gt; elements or &lt;a href=#event-handler-content-attributes&gt;event handler content
+  attributes&lt;/a&gt;; or the JavaScript file that the script was in,
+  for external scripts. Even for dynamically-generated scripts, user
+  agents are strongly encouraged to attempt to keep track of the
+  original source of a script. For example, if an external script uses
+  the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; API to
+  insert an inline &lt;code&gt;&lt;a href=#the-script-element&gt;script&lt;/a&gt;&lt;/code&gt; element during parsing, the URL
+  of the resource containing the script would ideally be reported as
+  being the external script, and the line number might ideally be
+  reported as the line with the &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; call or where the
+  string passed to that call was first constructed. Naturally,
+  implementing this can be somewhat non-trivial.&lt;/p&gt;
+
+  &lt;p&gt;User agents are similarly encouraged to keep careful track of the
+  original line numbers, even in the face of &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; calls mutating
+  the document as it is parsed, or &lt;a href=#event-handler-content-attributes&gt;event handler content
+  attributes&lt;/a&gt; spanning multiple lines.&lt;/p&gt;
+
   &lt;/div&gt;
 
 
@@ -68514,7 +68548,9 @@
       &lt;p&gt;&lt;a href=#create-a-script-from-a-node title=&quot;create a script from a node&quot;&gt;Create a
       script&lt;/a&gt; from the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; node of the
       &lt;a href=#active-document&gt;active document&lt;/a&gt;, using the aforementioned script
-      source, and assuming the scripting language is JavaScript.&lt;/p&gt;
+      source, the &lt;a href=#url&gt;URL&lt;/a&gt; of the resource where the
+      &lt;code&gt;javascript:&lt;/code&gt; URL, was found, and assuming the
+      scripting language is JavaScript.&lt;/p&gt;
 
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the return value of the
       &lt;i&gt;&lt;a href=#initial-code-entry-point&gt;initial code entry-point&lt;/a&gt;&lt;/i&gt; of this &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;. If an exception was
@@ -68655,6 +68691,13 @@
   requirements, in particular the &lt;code title=handler-MessagePort-onmessage&gt;&lt;a href=#handler-messageport-onmessage&gt;onmessage&lt;/a&gt;&lt;/code&gt; attribute of
   &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects.&lt;/p&gt;
 
+  &lt;p&gt;On getting, &lt;a href=#event-handler-idl-attributes&gt;event handler IDL attributes&lt;/a&gt; must return
+  the value of their corresponding event handlers, except when the
+  value is an &lt;a href=#concept-handler-error title=concept-handler-error&gt;internal error
+  value&lt;/a&gt;, in which case the user agent must set the corresponding
+  event handler to null, and then throw an exception corresponding to
+  the error condition.&lt;/p&gt;
+
   &lt;hr&gt;&lt;/div&gt;
 
   &lt;p&gt;&lt;dfn id=event-handler-content-attributes&gt;Event handler content attributes&lt;/dfn&gt;, when specified, must
@@ -68687,7 +68730,8 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as
     &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects an &lt;i&gt;early error&lt;/i&gt;
-    then abort these steps.&lt;/p&gt;
+    then &lt;a href=#set-the-event-handler-content-attribute-to-an-error&gt;set the event handler content attribute to an
+    error&lt;/a&gt; as defined below, and abort these steps.&lt;/p&gt;
 
     &lt;p class=note&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript
     edition 5 section 13 Function Definition. &lt;i&gt;Early error&lt;/i&gt; is
@@ -68714,7 +68758,9 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var
     title=&quot;&quot;&gt;body&lt;/var&gt; is a &lt;code&gt;SyntaxError&lt;/code&gt; according to the
-    Strict Mode Restrictions, then abort these steps.&lt;/p&gt;
+    Strict Mode Restrictions, then &lt;span&gt;set the event handler content
+    attribute to an error&lt;/span&gt; as defined below, and abort these
+    steps.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in
     ECMAScript edition 5 section 13.1 Strict Mode Restrictions. &lt;a
@@ -68786,8 +68832,18 @@
    &lt;li&gt;&lt;p&gt;Set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
    handler&lt;/a&gt; to the aforementioned function.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;When an event handler content attribute is removed, the user
+  &lt;/ol&gt;&lt;p&gt;When a user agent is required, by the steps above, to &lt;dfn id=set-the-event-handler-content-attribute-to-an-error&gt;set
+  the event handler content attribute to an error&lt;/dfn&gt;, the user
   agent must set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
+  handler&lt;/a&gt; to an &lt;dfn id=concept-handler-error title=concept-handler-error&gt;internal
+  error value&lt;/dfn&gt; representing the error condition, keeping track of
+  the &lt;a href=#url&gt;URL&lt;/a&gt; of the resource where the &lt;a href=#event-handler-content-attributes title=&quot;event
+  handler content attributes&quot;&gt;event handler content attribute&lt;/a&gt;
+  was set, and the relevant line number inside that resource where the
+  error occurred.&lt;/p&gt;
+
+  &lt;p&gt;When an event handler content attribute is removed, the user
+  agent must set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
   handler&lt;/a&gt; to null.&lt;/p&gt;
   &lt;!--
   <A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/saved/245">http://software.hixie.ch/utilities/js/live-dom-viewer/saved/245</A> onload
@@ -68809,9 +68865,8 @@
 
   &lt;hr&gt;&lt;p&gt;When an &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; of an element or object &lt;var title=&quot;&quot;&gt;T&lt;/var&gt;
   implementing the &lt;code&gt;&lt;a href=#eventtarget&gt;EventTarget&lt;/a&gt;&lt;/code&gt; interface is first set to
-  a non-null &lt;code&gt;&lt;a href=#function&gt;Function&lt;/a&gt;&lt;/code&gt; object, the user agent must append
-  an &lt;a href=#concept-event-listener title=concept-event-listener&gt;event listener&lt;/a&gt; to the
-  list of &lt;a href=#concept-event-listener title=concept-event-listener&gt;event listeners&lt;/a&gt;
+  a non-null value, the user agent must append an &lt;a href=#concept-event-listener title=concept-event-listener&gt;event listener&lt;/a&gt; to the list of
+  &lt;a href=#concept-event-listener title=concept-event-listener&gt;event listeners&lt;/a&gt;
   associated with &lt;var title=&quot;&quot;&gt;T&lt;/var&gt; with &lt;i&gt;type&lt;/i&gt; set to the
   &lt;dfn id=event-handler-event-type&gt;event handler event type&lt;/dfn&gt; corresponding to &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;, &lt;i&gt;capture&lt;/i&gt; set to false, and &lt;i&gt;listener&lt;/i&gt;
   set to &lt;a href=#the-event-handler-processing-algorithm&gt;the event handler processing algorithm&lt;/a&gt; defined
@@ -68867,6 +68922,16 @@
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is null, then abort these
    steps.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;a href=#concept-handler-error title=concept-handler-error&gt;internal error value&lt;/a&gt;, then set
+   the &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to null and
+   then &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; at the appropriate URL and with
+   the appropriate line number, as established when the error was
+   detected, in the &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
+   of the node of the &lt;a href=#event-handler-content-attributes title=&quot;event handler content
+   attributes&quot;&gt;event handler content attribute&lt;/a&gt;, using the &lt;code title=handler-window-onerror&gt;&lt;a href=#handler-window-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event
+   handlers&quot;&gt;event handler&lt;/a&gt; of the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of
+   that &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, and abort these steps.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s
    value, the &lt;code&gt;&lt;a href=#function&gt;Function&lt;/a&gt;&lt;/code&gt; object that the &lt;a href=#event-handlers title=&quot;event
    handlers&quot;&gt;event handler&lt;/a&gt; was last set to.&lt;/li&gt;
@@ -69681,7 +69746,11 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Return a &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; that checks
-   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt; has been cleared, and if it has not, &lt;a href=#create-a-script title=&quot;create a script&quot;&gt;creates a script&lt;/a&gt; using &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, &lt;var title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting language, &lt;var title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object, &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; as the document, &lt;var title=&quot;&quot;&gt;character
+   if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var title=&quot;&quot;&gt;list&lt;/var&gt; has been cleared, and if it has not, &lt;a href=#create-a-script title=&quot;create a script&quot;&gt;creates a script&lt;/a&gt; using &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, the
+   &lt;a href=#url&gt;URL&lt;/a&gt; where &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; can be
+   found, &lt;var title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting
+   language, &lt;var title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object,
+   &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; as the document, &lt;var title=&quot;&quot;&gt;character
    encoding&lt;/var&gt; as the URL character encoding, and &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; as the base URL.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;hr&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for these &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; is the &lt;dfn id=timer-task-source&gt;timer task
@@ -78597,8 +78666,10 @@
   &lt;p&gt;Whenever an uncaught runtime script error occurs in one of the
   worker's scripts, if the error did not occur while handling a
   previous script error, the user agent must &lt;a href=#report-the-error&gt;report the
-  error&lt;/a&gt; using the &lt;code&gt;&lt;a href=#workerglobalscope&gt;WorkerGlobalScope&lt;/a&gt;&lt;/code&gt; object's &lt;code title=handler-WorkerGlobalScope-onerror&gt;&lt;a href=#handler-workerglobalscope-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt;
-  attribute.
+  error&lt;/a&gt; at the &lt;a href=#url&gt;URL&lt;/a&gt; of the resource that contained
+  the script, with the line number where the error occurred, in the
+  &lt;a href=#origin&gt;origin&lt;/a&gt; of the scripts running in the worker, using the
+  &lt;code&gt;&lt;a href=#workerglobalscope&gt;WorkerGlobalScope&lt;/a&gt;&lt;/code&gt; object's &lt;code title=handler-WorkerGlobalScope-onerror&gt;&lt;a href=#handler-workerglobalscope-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; attribute.
   &lt;/p&gt;
 
   &lt;p&gt;For shared workers, if the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; afterwards, or if
@@ -79142,7 +79213,8 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;&lt;a href=#create-a-script&gt;Create a script&lt;/a&gt;, using &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; as the script source and &lt;var title=&quot;&quot;&gt;language&lt;/var&gt; as the scripting language, using the
+      &lt;p&gt;&lt;a href=#create-a-script&gt;Create a script&lt;/a&gt;, using &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; as the script source, the &lt;a href=#url&gt;URL&lt;/a&gt;
+      from which &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; was obtained, and &lt;var title=&quot;&quot;&gt;language&lt;/var&gt; as the scripting language, using the
       same global object, browsing context, URL character encoding,
       base URL, and script group as the &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; that was created by the
       worker's &lt;a href=#run-a-worker&gt;run a worker&lt;/a&gt; algorithm.&lt;/p&gt;

Modified: source
===================================================================
--- source	2011-11-04 17:34:58 UTC (rev 6818)
+++ source	2011-11-10 23:45:02 UTC (rev 6819)
@@ -17139,7 +17139,8 @@
 
         &lt;p&gt;&lt;span title=&quot;create a script from a node&quot;&gt;Create a
         script&lt;/span&gt; from the &lt;code&gt;script&lt;/code&gt; element node, using
-        &lt;var&gt;the script block's source&lt;/var&gt; and &lt;var&gt;the script
+        &lt;var&gt;the script block's source&lt;/var&gt;, the &lt;span&gt;URL&lt;/span&gt;
+        from which the script was obtained, and &lt;var&gt;the script
         block's type&lt;/var&gt;.&lt;/p&gt;
 
         &lt;p class=&quot;note&quot;&gt;This is where the script is compiled and
@@ -77258,10 +77259,10 @@
 
   &lt;p&gt;When the specification says that a &lt;span
   title=&quot;concept-script&quot;&gt;script&lt;/span&gt; is to be &lt;dfn title=&quot;create a
-  script&quot;&gt;created&lt;/dfn&gt;, given some script source, its scripting
-  language, a global object, a browsing context, a URL character
-  encoding, and a base URL, the user agent must run the following
-  steps:&lt;/p&gt;
+  script&quot;&gt;created&lt;/dfn&gt;, given some script source, a script source
+  URL, its scripting language, a global object, a browsing context, a
+  URL character encoding, and a base URL, the user agent must run the
+  following steps:&lt;/p&gt;
 
   &lt;ol&gt;
 
@@ -77295,7 +77296,9 @@
     title=&quot;concept-script&quot;&gt;script&lt;/span&gt;'s &lt;i&gt;initial code
     entry-point&lt;/i&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, &lt;span&gt;report the error&lt;/span&gt; using the &lt;code
+    &lt;p&gt;Otherwise, &lt;span&gt;report the error&lt;/span&gt; at the script source
+    URL, with the problematic line number, in the script's
+    &lt;span&gt;origin&lt;/span&gt;, using the &lt;code
     title=&quot;handler-window-onerror&quot;&gt;onerror&lt;/code&gt; &lt;span title=&quot;event
     handlers&quot;&gt;event handler&lt;/span&gt; of the &lt;span&gt;script's global
     object&lt;/span&gt;. If the error is still &lt;i
@@ -77309,24 +77312,24 @@
   &lt;hr&gt;
 
   &lt;p&gt;When the user agent is to &lt;dfn&gt;create an impotent script&lt;/dfn&gt;,
-  given some script source, its scripting language, and a browsing
-  context, the user agent must &lt;span&gt;create a script&lt;/span&gt;, using the
-  given script source and scripting language, using a new empty object
-  as the global object, and using the given browsing context as the
-  browsing context. The URL character encoding and base URL for the
-  resulting &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; are not
-  important as no APIs are exposed to the script.&lt;/p&gt;
+  given some script source and URL, its scripting language, and a
+  browsing context, the user agent must &lt;span&gt;create a script&lt;/span&gt;,
+  using the given script source, URL, and scripting language, using a
+  new empty object as the global object, and using the given browsing
+  context as the browsing context. The URL character encoding and base
+  URL for the resulting &lt;span title=&quot;concept-script&quot;&gt;script&lt;/span&gt; are
+  not important as no APIs are exposed to the script.&lt;/p&gt;
 
   &lt;hr&gt;
 
   &lt;p&gt;When the specification says that a &lt;span
   title=&quot;concept-script&quot;&gt;script&lt;/span&gt; is to be &lt;dfn title=&quot;create a
   script from a node&quot;&gt;created from a node&lt;/dfn&gt; &lt;var
-  title=&quot;&quot;&gt;node&lt;/var&gt;, given some script source and its scripting
-  language, the user agent must &lt;span&gt;create a script&lt;/span&gt;, using
-  the given script source and scripting language, and using &lt;span&gt;the
-  script settings determined from the node&lt;/span&gt; &lt;var
-  title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;
+  title=&quot;&quot;&gt;node&lt;/var&gt;, given some script source, its URL, and its
+  scripting language, the user agent must &lt;span&gt;create a
+  script&lt;/span&gt;, using the given script source, URL, and scripting
+  language, and using &lt;span&gt;the script settings determined from the
+  node&lt;/span&gt; &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;.&lt;/p&gt;
 
   &lt;p&gt;&lt;dfn&gt;The script settings determined from the node&lt;/dfn&gt; &lt;var
   title=&quot;&quot;&gt;node&lt;/var&gt; are computed as follows:&lt;/p&gt;
@@ -77397,10 +77400,12 @@
   &lt;h5 id=&quot;runtime-script-errors&quot;&gt;Runtime script errors&lt;/h5&gt;
 
   &lt;p&gt;When the user agent is required to &lt;dfn title=&quot;report the
-  error&quot;&gt;report an error&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;error&lt;/var&gt; using the
-  &lt;span title=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; &lt;var
-  title=&quot;&quot;&gt;onerror&lt;/var&gt;, it must run these steps, after which the
-  error is either &lt;dfn
+  error&quot;&gt;report an error&lt;/dfn&gt; at a particular &lt;span&gt;URL&lt;/span&gt; &lt;var
+  title=&quot;&quot;&gt;location&lt;/var&gt; with a particular line number &lt;var
+  title=&quot;&quot;&gt;line&lt;/var&gt; in a particular origin &lt;var
+  title=&quot;&quot;&gt;origin&lt;/var&gt;, using the &lt;span title=&quot;event handlers&quot;&gt;event
+  handler&lt;/span&gt; &lt;var title=&quot;&quot;&gt;onerror&lt;/var&gt;, it must run these steps,
+  after which the error is either &lt;dfn
   title=&quot;concept-error-handled&quot;&gt;&lt;i&gt;handled&lt;/i&gt;&lt;/dfn&gt; or &lt;dfn
   title=&quot;concept-error-nothandled&quot;&gt;&lt;i&gt;not handled&lt;/i&gt;&lt;/dfn&gt;:&lt;/p&gt;
 
@@ -77411,25 +77416,38 @@
 
    &lt;dd&gt;
 
-    &lt;p&gt;The function must be invoked with three arguments. The first
-    two arguments passed to the function must be of type
-    &lt;code&gt;DOMString&lt;/code&gt;, and the third must be of type
-    &lt;code&gt;unsigned long&lt;/code&gt;. The first must give the message that
-    the UA is considering reporting, the second must give the
-    &lt;span&gt;absolute URL&lt;/span&gt; of the resource in which the error
-    occurred, and the third must give the line number in that resource
-    on which the error occurred.&lt;/p&gt;
+    &lt;ol&gt;
 
-    &lt;p&gt;If the function returns false, then the error is &lt;i
-    title=&quot;concept-error-handled&quot;&gt;handled&lt;/i&gt;. Otherwise, the error is
-    &lt;i title=&quot;concept-error-nothandled&quot;&gt;not handled&lt;/i&gt;.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be a user-agent-defined
+     string describing the error in a helpful manner.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;Any uncaught exceptions thrown or errors caused by this
-    function may be reported to the user immediately after the error
-    that the function was called for; the &lt;span title=&quot;report the
-    error&quot;&gt;report an error&lt;/span&gt; algorithm must not be used to handle
-    exceptions thrown or errors caused by this function.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; &lt;span&gt;URL&lt;/span&gt; does
+     not have a &lt;span title=&quot;same origin&quot;&gt;same&lt;/span&gt;
+     &lt;span&gt;origin&lt;/span&gt; as the &lt;var title=&quot;&quot;&gt;origin&lt;/var&gt;, then set
+     &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; to &quot;&lt;code title=&quot;&quot;&gt;Script
+     error.&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; to the empty
+     string, and set &lt;var title=&quot;&quot;&gt;line&lt;/var&gt; to 0.&lt;/p&gt;&lt;/li&gt;
 
+     &lt;li&gt;
+
+      &lt;p&gt;The function must be invoked with three arguments: &lt;var
+      title=&quot;&quot;&gt;message&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;, and &lt;var
+      title=&quot;&quot;&gt;line&lt;/var&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If the function returns false, then the error is &lt;i
+      title=&quot;concept-error-handled&quot;&gt;handled&lt;/i&gt;. Otherwise, the error is
+      &lt;i title=&quot;concept-error-nothandled&quot;&gt;not handled&lt;/i&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Any uncaught exceptions thrown or errors caused by this
+      function may be reported to the user immediately after the error
+      that the function was called for; the &lt;span title=&quot;report the
+      error&quot;&gt;report an error&lt;/span&gt; algorithm must not be used to handle
+      exceptions thrown or errors caused by this function.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+    &lt;/ol&gt;
+
    &lt;/dd&gt;
 
    &lt;dt&gt;Otherwise&lt;/dt&gt;
@@ -77447,13 +77465,39 @@
 
   &lt;p&gt;Whenever an uncaught runtime script error occurs in one of the
   scripts associated with a &lt;code&gt;Document&lt;/code&gt;, the user agent must
-  &lt;span&gt;report the error&lt;/span&gt; using the &lt;code
+  &lt;span&gt;report the error&lt;/span&gt; at the URL of the resource containing
+  the script (as established when the &lt;span
+  title=&quot;concept-script&quot;&gt;script&lt;/span&gt; was &lt;span title=&quot;create a
+  script&quot;&gt;created&lt;/span&gt;), with the problematic line number in that
+  resource, in the script's &lt;span&gt;origin&lt;/span&gt;, using the &lt;code
   title=&quot;handler-window-onerror&quot;&gt;onerror&lt;/code&gt; &lt;span title=&quot;event
   handlers&quot;&gt;event handler&lt;/span&gt; of the &lt;span&gt;script's global
   object&lt;/span&gt;. If the error is still &lt;i
   title=&quot;concept-error-nothandled&quot;&gt;not handled&lt;/i&gt; after this, then
   the error may be reported to the user.&lt;/p&gt;
 
+  &lt;p&gt;The resource containing the script will typically be the file
+  from which the &lt;code&gt;Document&lt;/code&gt; was parsed, e.g. for inline
+  &lt;code&gt;script&lt;/code&gt; elements or &lt;span&gt;event handler content
+  attributes&lt;/span&gt;; or the JavaScript file that the script was in,
+  for external scripts. Even for dynamically-generated scripts, user
+  agents are strongly encouraged to attempt to keep track of the
+  original source of a script. For example, if an external script uses
+  the &lt;code title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; API to
+  insert an inline &lt;code&gt;script&lt;/code&gt; element during parsing, the URL
+  of the resource containing the script would ideally be reported as
+  being the external script, and the line number might ideally be
+  reported as the line with the &lt;code
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; call or where the
+  string passed to that call was first constructed. Naturally,
+  implementing this can be somewhat non-trivial.&lt;/p&gt;
+
+  &lt;p&gt;User agents are similarly encouraged to keep careful track of the
+  original line numbers, even in the face of &lt;code
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; calls mutating
+  the document as it is parsed, or &lt;span&gt;event handler content
+  attributes&lt;/span&gt; spanning multiple lines.&lt;/p&gt;
+
   &lt;/div&gt;
 
 
@@ -77860,7 +77904,9 @@
       &lt;p&gt;&lt;span title=&quot;create a script from a node&quot;&gt;Create a
       script&lt;/span&gt; from the &lt;code&gt;Document&lt;/code&gt; node of the
       &lt;span&gt;active document&lt;/span&gt;, using the aforementioned script
-      source, and assuming the scripting language is JavaScript.&lt;/p&gt;
+      source, the &lt;span&gt;URL&lt;/span&gt; of the resource where the
+      &lt;code&gt;javascript:&lt;/code&gt; URL, was found, and assuming the
+      scripting language is JavaScript.&lt;/p&gt;
 
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the return value of the
       &lt;i&gt;initial code entry-point&lt;/i&gt; of this &lt;span
@@ -78014,6 +78060,13 @@
   title=&quot;handler-MessagePort-onmessage&quot;&gt;onmessage&lt;/code&gt; attribute of
   &lt;code&gt;MessagePort&lt;/code&gt; objects.&lt;/p&gt;
 
+  &lt;p&gt;On getting, &lt;span&gt;event handler IDL attributes&lt;/span&gt; must return
+  the value of their corresponding event handlers, except when the
+  value is an &lt;span title=&quot;concept-handler-error&quot;&gt;internal error
+  value&lt;/span&gt;, in which case the user agent must set the corresponding
+  event handler to null, and then throw an exception corresponding to
+  the error condition.&lt;/p&gt;
+
   &lt;hr&gt;
 
   &lt;/div&gt;
@@ -78051,7 +78104,8 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as
     &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects an &lt;i&gt;early error&lt;/i&gt;
-    then abort these steps.&lt;/p&gt;
+    then &lt;span&gt;set the event handler content attribute to an
+    error&lt;/span&gt; as defined below, and abort these steps.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript
     edition 5 section 13 Function Definition. &lt;i&gt;Early error&lt;/i&gt; is
@@ -78082,7 +78136,9 @@
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var
     title=&quot;&quot;&gt;body&lt;/var&gt; is a &lt;code&gt;SyntaxError&lt;/code&gt; according to the
-    Strict Mode Restrictions, then abort these steps.&lt;/p&gt;
+    Strict Mode Restrictions, then &lt;span&gt;set the event handler content
+    attribute to an error&lt;/span&gt; as defined below, and abort these
+    steps.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in
     ECMAScript edition 5 section 13.1 Strict Mode Restrictions. &lt;a
@@ -78176,6 +78232,16 @@
 
   &lt;/ol&gt;
 
+  &lt;p&gt;When a user agent is required, by the steps above, to &lt;dfn&gt;set
+  the event handler content attribute to an error&lt;/dfn&gt;, the user
+  agent must set the corresponding &lt;span title=&quot;event handlers&quot;&gt;event
+  handler&lt;/span&gt; to an &lt;dfn title=&quot;concept-handler-error&quot;&gt;internal
+  error value&lt;/dfn&gt; representing the error condition, keeping track of
+  the &lt;span&gt;URL&lt;/span&gt; of the resource where the &lt;span title=&quot;event
+  handler content attributes&quot;&gt;event handler content attribute&lt;/span&gt;
+  was set, and the relevant line number inside that resource where the
+  error occurred.&lt;/p&gt;
+
   &lt;p&gt;When an event handler content attribute is removed, the user
   agent must set the corresponding &lt;span title=&quot;event handlers&quot;&gt;event
   handler&lt;/span&gt; to null.&lt;/p&gt;
@@ -78202,9 +78268,9 @@
   &lt;p&gt;When an &lt;span title=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; &lt;var
   title=&quot;&quot;&gt;H&lt;/var&gt; of an element or object &lt;var title=&quot;&quot;&gt;T&lt;/var&gt;
   implementing the &lt;code&gt;EventTarget&lt;/code&gt; interface is first set to
-  a non-null &lt;code&gt;Function&lt;/code&gt; object, the user agent must append
-  an &lt;span title=&quot;concept-event-listener&quot;&gt;event listener&lt;/span&gt; to the
-  list of &lt;span title=&quot;concept-event-listener&quot;&gt;event listeners&lt;/span&gt;
+  a non-null value, the user agent must append an &lt;span
+  title=&quot;concept-event-listener&quot;&gt;event listener&lt;/span&gt; to the list of
+  &lt;span title=&quot;concept-event-listener&quot;&gt;event listeners&lt;/span&gt;
   associated with &lt;var title=&quot;&quot;&gt;T&lt;/var&gt; with &lt;i&gt;type&lt;/i&gt; set to the
   &lt;dfn&gt;event handler event type&lt;/dfn&gt; corresponding to &lt;var
   title=&quot;&quot;&gt;H&lt;/var&gt;, &lt;i&gt;capture&lt;/i&gt; set to false, and &lt;i&gt;listener&lt;/i&gt;
@@ -78268,6 +78334,18 @@
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is null, then abort these
    steps.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;span
+   title=&quot;concept-handler-error&quot;&gt;internal error value&lt;/span&gt;, then set
+   the &lt;span title=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; to null and
+   then &lt;span&gt;report the error&lt;/span&gt; at the appropriate URL and with
+   the appropriate line number, as established when the error was
+   detected, in the &lt;span&gt;origin&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt;
+   of the node of the &lt;span title=&quot;event handler content
+   attributes&quot;&gt;event handler content attribute&lt;/span&gt;, using the &lt;code
+   title=&quot;handler-window-onerror&quot;&gt;onerror&lt;/code&gt; &lt;span title=&quot;event
+   handlers&quot;&gt;event handler&lt;/span&gt; of the &lt;code&gt;Window&lt;/code&gt; object of
+   that &lt;code&gt;Document&lt;/code&gt;, and abort these steps.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s
    value, the &lt;code&gt;Function&lt;/code&gt; object that the &lt;span title=&quot;event
    handlers&quot;&gt;event handler&lt;/span&gt; was last set to.&lt;/p&gt;&lt;/li&gt;
@@ -79224,10 +79302,11 @@
    if the entry for &lt;var title=&quot;&quot;&gt;handle&lt;/var&gt; in &lt;var
    title=&quot;&quot;&gt;list&lt;/var&gt; has been cleared, and if it has not, &lt;span
    title=&quot;create a script&quot;&gt;creates a script&lt;/span&gt; using &lt;var
-   title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, &lt;var
-   title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting language, &lt;var
-   title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object, &lt;var
-   title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var
+   title=&quot;&quot;&gt;script source&lt;/var&gt; as the script source, the
+   &lt;span&gt;URL&lt;/span&gt; where &lt;var title=&quot;&quot;&gt;script source&lt;/var&gt; can be
+   found, &lt;var title=&quot;&quot;&gt;scripting language&lt;/var&gt; as the scripting
+   language, &lt;var title=&quot;&quot;&gt;global object&lt;/var&gt; as the global object,
+   &lt;var title=&quot;&quot;&gt;browsing context&lt;/var&gt; as the browsing context, &lt;var
    title=&quot;&quot;&gt;document&lt;/var&gt; as the document, &lt;var title=&quot;&quot;&gt;character
    encoding&lt;/var&gt; as the URL character encoding, and &lt;var
    title=&quot;&quot;&gt;base URL&lt;/var&gt; as the base URL.&lt;/p&gt;&lt;/li&gt;
@@ -88814,9 +88893,11 @@
   &lt;p&gt;Whenever an uncaught runtime script error occurs in one of the
   worker's scripts, if the error did not occur while handling a
   previous script error, the user agent must &lt;span&gt;report the
-  error&lt;/span&gt; using the &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object's &lt;code
-  title=&quot;handler-WorkerGlobalScope-onerror&quot;&gt;onerror&lt;/code&gt;
-  attribute.
+  error&lt;/span&gt; at the &lt;span&gt;URL&lt;/span&gt; of the resource that contained
+  the script, with the line number where the error occurred, in the
+  &lt;span&gt;origin&lt;/span&gt; of the scripts running in the worker, using the
+  &lt;code&gt;WorkerGlobalScope&lt;/code&gt; object's &lt;code
+  title=&quot;handler-WorkerGlobalScope-onerror&quot;&gt;onerror&lt;/code&gt; attribute.
   &lt;!--END complete--&gt;&lt;!--END epub--&gt;
   &lt;a href=&quot;#refsHTML&quot;&gt;[HTML]&lt;/a&gt;
   &lt;!--START complete--&gt;&lt;!--START epub--&gt;
@@ -89470,7 +89551,8 @@
      &lt;li&gt;
 
       &lt;p&gt;&lt;span&gt;Create a script&lt;/span&gt;, using &lt;var
-      title=&quot;&quot;&gt;source&lt;/var&gt; as the script source and &lt;var
+      title=&quot;&quot;&gt;source&lt;/var&gt; as the script source, the &lt;span&gt;URL&lt;/span&gt;
+      from which &lt;var title=&quot;&quot;&gt;source&lt;/var&gt; was obtained, and &lt;var
       title=&quot;&quot;&gt;language&lt;/var&gt; as the scripting language, using the
       same global object, browsing context, URL character encoding,
       base URL, and script group as the &lt;span


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013684.html">[html5] r6818 - [giow] (2) Change how nested clicks are prevented	to also prevent click() inside [...]
</A></li>
	<LI>Next message: <A HREF="013686.html">[html5] r6820 - [giow] (0) consistency with other APIs Fixing	http://www.w3.org/Bugs/Public/show [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13685">[ date ]</a>
              <a href="thread.html#13685">[ thread ]</a>
              <a href="subject.html#13685">[ subject ]</a>
              <a href="author.html#13685">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
