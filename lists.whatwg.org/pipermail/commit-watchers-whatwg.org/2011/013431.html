<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r6564 - [giow] (1) Make popstate not fire onload and not	fire when you go back and forth [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6564%20-%20%5Bgiow%5D%20%281%29%20Make%20popstate%20not%20fire%20onload%20and%20not%0A%09fire%20when%20you%20go%20back%20and%20forth%20%5B...%5D&In-Reply-To=%3C20110922232106.806491C84004%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013430.html">
   <LINK REL="Next"  HREF="013432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r6564 - [giow] (1) Make popstate not fire onload and not	fire when you go back and forth [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r6564%20-%20%5Bgiow%5D%20%281%29%20Make%20popstate%20not%20fire%20onload%20and%20not%0A%09fire%20when%20you%20go%20back%20and%20forth%20%5B...%5D&In-Reply-To=%3C20110922232106.806491C84004%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r6564 - [giow] (1) Make popstate not fire onload and not	fire when you go back and forth [...]">whatwg at whatwg.org
       </A><BR>
    <I>Thu Sep 22 16:21:06 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013430.html">[html5] r6563 - [e] (0) accuracy Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=12667
</A></li>
        <LI>Next message: <A HREF="013432.html">[html5] r6565 - [c] (0) Make size and maxlength conforming on	type=number for now. (fixing r6413 [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13431">[ date ]</a>
              <a href="thread.html#13431">[ thread ]</a>
              <a href="subject.html#13431">[ subject ]</a>
              <a href="author.html#13431">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2011-09-22 16:21:04 -0700 (Thu, 22 Sep 2011)
New Revision: 6564

Modified:
   complete.html
   index
   source
Log:
[giow] (1) Make popstate not fire onload and not fire when you go back and forth across documents without changing which was the last active state for that document. This is intended to match Firefox. It's also much more sensible than what we had before.
Fixing <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=12707">http://www.w3.org/Bugs/Public/show_bug.cgi?id=12707</A>

Modified: complete.html
===================================================================
--- complete.html	2011-09-22 22:29:26 UTC (rev 6563)
+++ complete.html	2011-09-22 23:21:04 UTC (rev 6564)
@@ -63360,6 +63360,12 @@
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; (and that are therefore merely different
   states of one particular document) are contiguous by definition.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; in a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;
+  also has a &lt;dfn id=latest-entry&gt;latest entry&lt;/dfn&gt;. This is the entry or that
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that was most the recently traversed to. When
+  a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created, it initially has no &lt;a href=#latest-entry&gt;latest
+  entry&lt;/a&gt;.&lt;/p&gt;
+
   &lt;div class=impl&gt;
 
   &lt;p&gt;User agents may &lt;a href=#discard-a-document title=&quot;discard a Document&quot;&gt;discard&lt;/a&gt;
@@ -63628,12 +63634,12 @@
      entry is then said to be &lt;a href=#an-entry-with-persisted-user-state&gt;an entry with persisted user
      state&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Add a state object entry to the session history, after the
-     &lt;a href=#current-entry&gt;current entry&lt;/a&gt;, with &lt;var title=&quot;&quot;&gt;cloned data&lt;/var&gt; as
-     the state object, the given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title,
-     and, if the third argument is present, the &lt;a href=#absolute-url&gt;absolute
-     URL&lt;/a&gt; that was found earlier in this algorithm as the
-     &lt;a href=#url&gt;URL&lt;/a&gt; of the entry.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Add a &lt;a href=#state-object&gt;state object&lt;/a&gt; entry to the session
+     history, after the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;, with &lt;var title=&quot;&quot;&gt;cloned data&lt;/var&gt; as the &lt;a href=#state-object&gt;state object&lt;/a&gt;, the
+     given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title, and, if the third
+     argument is present, the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that was found
+     earlier in this algorithm as the &lt;a href=#url&gt;URL&lt;/a&gt; of the
+     entry.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Update the &lt;a href=#current-entry&gt;current entry&lt;/a&gt; to be this newly
      added entry.&lt;/li&gt;
@@ -63669,13 +63675,21 @@
 
    &lt;li&gt;
 
-     &lt;p&gt;Set &lt;code title=dom-history-state&gt;&lt;a href=#dom-history-state&gt;history.state&lt;/a&gt;&lt;/code&gt; to a
-     &lt;a href=#structured-clone&gt;structured clone&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cloned
-     data&lt;/var&gt;.&lt;/p&gt; &lt;!-- it's a clone of /cloned data/, not /data/,
-     so that there's no risk of running scripts again --&gt;
+    &lt;p&gt;Set &lt;code title=dom-history-state&gt;&lt;a href=#dom-history-state&gt;history.state&lt;/a&gt;&lt;/code&gt; to a
+    &lt;a href=#structured-clone&gt;structured clone&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cloned
+    data&lt;/var&gt;.&lt;/p&gt; &lt;!-- it's a clone of /cloned data/, not /data/, so
+    that there's no risk of running scripts again --&gt;
 
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;Let the &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; of the
+    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt; be the
+    &lt;a href=#current-entry&gt;current entry&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
   &lt;/ol&gt;&lt;p class=note&gt;The &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; is purely
   advisory. User agents might use the title in the user interface.&lt;/p&gt;
 
@@ -64967,15 +64981,16 @@
   &lt;div class=impl&gt;
 
   &lt;p&gt;When a user agent is required to &lt;dfn id=traverse-the-history&gt;traverse the history&lt;/dfn&gt;
-  to a &lt;i&gt;specified entry&lt;/i&gt;, optionally with &lt;a href=#replacement-enabled&gt;replacement
-  enabled&lt;/a&gt;, the user agent must act as follows.&lt;/p&gt;
+  to a &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;, optionally with
+  &lt;a href=#replacement-enabled&gt;replacement enabled&lt;/a&gt;, the user agent must act as
+  follows.&lt;/p&gt;
 
   &lt;p class=note&gt;This algorithm is not just invoked when &lt;a href=#traverse-the-history-by-a-delta title=&quot;traverse the history by a delta&quot;&gt;explicitly going back or
   forwards in the session history&lt;/a&gt; &mdash; it is also invoked in
   other situations, for example when &lt;a href=#navigate title=navigate&gt;navigating
-  a browsing context&lt;/a&gt;, as part of &lt;a href=#update-the-session-history-with-the-new-page title=&quot;update the session
-  history with the new page&quot;&gt;updating the session history with the new
-  page&lt;/a&gt;.&lt;/p&gt;
+  a browsing context&lt;/a&gt;, as part of &lt;a href=#update-the-session-history-with-the-new-page title=&quot;update the
+  session history with the new page&quot;&gt;updating the session history with
+  the new page&lt;/a&gt;.&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is no longer a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object for the
    entry in question, the user agent must
@@ -65001,17 +65016,18 @@
    agent wishes to persist. The entry is then said to be &lt;a href=#an-entry-with-persisted-user-state&gt;an
    entry with persisted user state&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a different
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a different
    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object than the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;
    then the user agent must run the following substeps:&lt;/p&gt;
 
     &lt;ol&gt;&lt;li&gt;If the browsing context is a &lt;a href=#top-level-browsing-context&gt;top-level browsing
      context&lt;/a&gt;, but not an &lt;a href=#auxiliary-browsing-context&gt;auxiliary browsing
      context&lt;/a&gt;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of the
-     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;i&gt;specified entry&lt;/i&gt; is not the
-     &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt; as the &lt;a href=#origin&gt;origin&lt;/a&gt;
-     of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;,
-     then the following sub-sub-steps must be run:
+     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;
+     is not the &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt; as the
+     &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the
+     &lt;a href=#current-entry&gt;current entry&lt;/a&gt;, then the following sub-sub-steps must
+     be run:
 
       &lt;ol&gt;&lt;li&gt;The current &lt;a href=#browsing-context-name&gt;browsing context name&lt;/a&gt; must be
        stored with all the entries in the history that are associated
@@ -65024,12 +65040,11 @@
 
       &lt;/ol&gt;&lt;/li&gt;
 
-     &lt;li id=appcache-history-2&gt;The user agent must make the
-     &lt;i&gt;specified entry&lt;/i&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object the
+     &lt;li id=appcache-history-2&gt;The user agent must make the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object the
      &lt;a href=#active-document&gt;active document&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing
      context&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a &lt;a href=#browsing-context-name&gt;browsing
+     &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a &lt;a href=#browsing-context-name&gt;browsing
      context name&lt;/a&gt; stored with it, then the following
      sub-sub-steps must be run:
 
@@ -65044,14 +65059,13 @@
 
       &lt;/ol&gt;&lt;/li&gt;
 
-     &lt;li id=history-autocomplete&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt;'s
-     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; has any &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; elements whose
-     &lt;a href=#resulting-autocompletion-state&gt;resulting autocompletion state&lt;/a&gt; is &lt;i title=&quot;&quot;&gt;off&lt;/i&gt;, invoke the &lt;a href=#concept-form-reset-control title=concept-form-reset-control&gt;reset algorithm&lt;/a&gt; of each
+     &lt;li id=history-autocomplete&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified
+     entry&lt;/var&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; has any &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt;
+     elements whose &lt;a href=#resulting-autocompletion-state&gt;resulting autocompletion state&lt;/a&gt; is &lt;i title=&quot;&quot;&gt;off&lt;/i&gt;, invoke the &lt;a href=#concept-form-reset-control title=concept-form-reset-control&gt;reset algorithm&lt;/a&gt; of each
      of those elements.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; of the
-     &lt;i&gt;specified entry&lt;/i&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is &quot;complete&quot;,
-     &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire a &lt;code title=event-pageshow&gt;&lt;a href=#event-pageshow&gt;pageshow&lt;/a&gt;&lt;/code&gt; event at the
+     &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is
+     &quot;complete&quot;, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire a &lt;code title=event-pageshow&gt;&lt;a href=#event-pageshow&gt;pageshow&lt;/a&gt;&lt;/code&gt; event at the
      &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of that &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, but
      with its &lt;code title=dom-event-target&gt;&lt;a href=#dom-event-target&gt;target&lt;/a&gt;&lt;/code&gt; set to the
      &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object (and the &lt;code title=dom-event-currentTarget&gt;currentTarget&lt;/code&gt; set to the
@@ -65069,22 +65083,24 @@
     &lt;/ol&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set &lt;a href=&quot;#the-document's-current-address&quot;&gt;the document's current address&lt;/a&gt; to the URL
-   of the &lt;i&gt;specified entry&lt;/i&gt;.&lt;/li&gt;
+   of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a URL whose fragment
-   identifier differs from that of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;'s
-   when compared in a &lt;a href=#case-sensitive&gt;case-sensitive&lt;/a&gt; manner, and the two
-   share the same &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object, then let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var title=&quot;&quot;&gt;old
-   URL&lt;/var&gt; be the URL of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt; and &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;i&gt;specified entry&lt;/i&gt;.
-   Otherwise, let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be false.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a URL whose
+   fragment identifier differs from that of the &lt;a href=#current-entry&gt;current
+   entry&lt;/a&gt;'s when compared in a &lt;a href=#case-sensitive&gt;case-sensitive&lt;/a&gt;
+   manner, and the two share the same &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object,
+   then let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var title=&quot;&quot;&gt;old URL&lt;/var&gt; be the URL of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;
+   and &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;hash
+   changed&lt;/var&gt; be false.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the traversal was initiated with &lt;dfn id=replacement-enabled&gt;replacement
    enabled&lt;/dfn&gt;, remove the entry immediately before the
    &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; in the session history.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is not &lt;a href=#an-entry-with-persisted-user-state&gt;an entry with
-   persisted user state&lt;/a&gt;, but its URL has a fragment identifier,
-   &lt;a href=#scroll-to-the-fragment-identifier&gt;scroll to the fragment identifier&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; is not &lt;a href=#an-entry-with-persisted-user-state&gt;an
+   entry with persisted user state&lt;/a&gt;, but its URL has a fragment
+   identifier, &lt;a href=#scroll-to-the-fragment-identifier&gt;scroll to the fragment
+   identifier&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -65106,11 +65122,22 @@
    state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
    null.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Set &lt;code title=dom-history-state&gt;&lt;a href=#dom-history-state&gt;history.state&lt;/a&gt;&lt;/code&gt; to &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Set &lt;code title=dom-history-state&gt;&lt;a href=#dom-history-state&gt;history.state&lt;/a&gt;&lt;/code&gt; to
+   &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Fire a &lt;code title=event-popstate&gt;&lt;a href=#event-popstate&gt;popstate&lt;/a&gt;&lt;/code&gt; event at
-   the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, using
-   the &lt;code&gt;&lt;a href=#popstateevent&gt;PopStateEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt; attribute initialized
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;state changed&lt;/var&gt; be true if the
+   &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; is not the &lt;var title=&quot;&quot;&gt;specified
+   entry&lt;/var&gt;; otherwise let it be false. (If the
+   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; has no &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; then by
+   definition its &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; is not the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.)&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;Let the &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; of the
+   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; be
+   the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;var title=&quot;&quot;&gt;state changed&lt;/var&gt; is true, fire a &lt;code title=event-popstate&gt;&lt;a href=#event-popstate&gt;popstate&lt;/a&gt;&lt;/code&gt; event at the
+   &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, using the
+   &lt;code&gt;&lt;a href=#popstateevent&gt;PopStateEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt; attribute initialized
    to the value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble
    but not be cancelable and has no default action.&lt;/li&gt;
 
@@ -65122,8 +65149,8 @@
    initialized to &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt;. This event must bubble
    but not be cancelable and has no default action.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#current-entry&gt;current entry&lt;/a&gt; is now the &lt;i&gt;specified
-   entry&lt;/i&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;a href=#current-entry&gt;current entry&lt;/a&gt; is now the &lt;var title=&quot;&quot;&gt;specified
+   entry&lt;/var&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the tasks mentioned above is the
   &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task source&lt;/a&gt;.&lt;/p&gt;

Modified: index
===================================================================
--- index	2011-09-22 22:29:26 UTC (rev 6563)
+++ index	2011-09-22 23:21:04 UTC (rev 6564)
@@ -63227,6 +63227,12 @@
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; (and that are therefore merely different
   states of one particular document) are contiguous by definition.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; in a &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;
+  also has a &lt;dfn id=latest-entry&gt;latest entry&lt;/dfn&gt;. This is the entry or that
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that was most the recently traversed to. When
+  a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created, it initially has no &lt;a href=#latest-entry&gt;latest
+  entry&lt;/a&gt;.&lt;/p&gt;
+
   &lt;div class=impl&gt;
 
   &lt;p&gt;User agents may &lt;a href=#discard-a-document title=&quot;discard a Document&quot;&gt;discard&lt;/a&gt;
@@ -63495,12 +63501,12 @@
      entry is then said to be &lt;a href=#an-entry-with-persisted-user-state&gt;an entry with persisted user
      state&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Add a state object entry to the session history, after the
-     &lt;a href=#current-entry&gt;current entry&lt;/a&gt;, with &lt;var title=&quot;&quot;&gt;cloned data&lt;/var&gt; as
-     the state object, the given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title,
-     and, if the third argument is present, the &lt;a href=#absolute-url&gt;absolute
-     URL&lt;/a&gt; that was found earlier in this algorithm as the
-     &lt;a href=#url&gt;URL&lt;/a&gt; of the entry.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Add a &lt;a href=#state-object&gt;state object&lt;/a&gt; entry to the session
+     history, after the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;, with &lt;var title=&quot;&quot;&gt;cloned data&lt;/var&gt; as the &lt;a href=#state-object&gt;state object&lt;/a&gt;, the
+     given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title, and, if the third
+     argument is present, the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that was found
+     earlier in this algorithm as the &lt;a href=#url&gt;URL&lt;/a&gt; of the
+     entry.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Update the &lt;a href=#current-entry&gt;current entry&lt;/a&gt; to be this newly
      added entry.&lt;/li&gt;
@@ -63536,13 +63542,21 @@
 
    &lt;li&gt;
 
-     &lt;p&gt;Set &lt;code title=dom-history-state&gt;&lt;a href=#dom-history-state&gt;history.state&lt;/a&gt;&lt;/code&gt; to a
-     &lt;a href=#structured-clone&gt;structured clone&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cloned
-     data&lt;/var&gt;.&lt;/p&gt; &lt;!-- it's a clone of /cloned data/, not /data/,
-     so that there's no risk of running scripts again --&gt;
+    &lt;p&gt;Set &lt;code title=dom-history-state&gt;&lt;a href=#dom-history-state&gt;history.state&lt;/a&gt;&lt;/code&gt; to a
+    &lt;a href=#structured-clone&gt;structured clone&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;cloned
+    data&lt;/var&gt;.&lt;/p&gt; &lt;!-- it's a clone of /cloned data/, not /data/, so
+    that there's no risk of running scripts again --&gt;
 
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;Let the &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; of the
+    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt; be the
+    &lt;a href=#current-entry&gt;current entry&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
   &lt;/ol&gt;&lt;p class=note&gt;The &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; is purely
   advisory. User agents might use the title in the user interface.&lt;/p&gt;
 
@@ -64834,15 +64848,16 @@
   &lt;div class=impl&gt;
 
   &lt;p&gt;When a user agent is required to &lt;dfn id=traverse-the-history&gt;traverse the history&lt;/dfn&gt;
-  to a &lt;i&gt;specified entry&lt;/i&gt;, optionally with &lt;a href=#replacement-enabled&gt;replacement
-  enabled&lt;/a&gt;, the user agent must act as follows.&lt;/p&gt;
+  to a &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;, optionally with
+  &lt;a href=#replacement-enabled&gt;replacement enabled&lt;/a&gt;, the user agent must act as
+  follows.&lt;/p&gt;
 
   &lt;p class=note&gt;This algorithm is not just invoked when &lt;a href=#traverse-the-history-by-a-delta title=&quot;traverse the history by a delta&quot;&gt;explicitly going back or
   forwards in the session history&lt;/a&gt; &mdash; it is also invoked in
   other situations, for example when &lt;a href=#navigate title=navigate&gt;navigating
-  a browsing context&lt;/a&gt;, as part of &lt;a href=#update-the-session-history-with-the-new-page title=&quot;update the session
-  history with the new page&quot;&gt;updating the session history with the new
-  page&lt;/a&gt;.&lt;/p&gt;
+  a browsing context&lt;/a&gt;, as part of &lt;a href=#update-the-session-history-with-the-new-page title=&quot;update the
+  session history with the new page&quot;&gt;updating the session history with
+  the new page&lt;/a&gt;.&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;If there is no longer a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object for the
    entry in question, the user agent must
@@ -64868,17 +64883,18 @@
    agent wishes to persist. The entry is then said to be &lt;a href=#an-entry-with-persisted-user-state&gt;an
    entry with persisted user state&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a different
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a different
    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object than the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;
    then the user agent must run the following substeps:&lt;/p&gt;
 
     &lt;ol&gt;&lt;li&gt;If the browsing context is a &lt;a href=#top-level-browsing-context&gt;top-level browsing
      context&lt;/a&gt;, but not an &lt;a href=#auxiliary-browsing-context&gt;auxiliary browsing
      context&lt;/a&gt;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of the
-     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;i&gt;specified entry&lt;/i&gt; is not the
-     &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt; as the &lt;a href=#origin&gt;origin&lt;/a&gt;
-     of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;,
-     then the following sub-sub-steps must be run:
+     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;
+     is not the &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt; as the
+     &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the
+     &lt;a href=#current-entry&gt;current entry&lt;/a&gt;, then the following sub-sub-steps must
+     be run:
 
       &lt;ol&gt;&lt;li&gt;The current &lt;a href=#browsing-context-name&gt;browsing context name&lt;/a&gt; must be
        stored with all the entries in the history that are associated
@@ -64891,12 +64907,11 @@
 
       &lt;/ol&gt;&lt;/li&gt;
 
-     &lt;li id=appcache-history-2&gt;The user agent must make the
-     &lt;i&gt;specified entry&lt;/i&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object the
+     &lt;li id=appcache-history-2&gt;The user agent must make the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object the
      &lt;a href=#active-document&gt;active document&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing
      context&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a &lt;a href=#browsing-context-name&gt;browsing
+     &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a &lt;a href=#browsing-context-name&gt;browsing
      context name&lt;/a&gt; stored with it, then the following
      sub-sub-steps must be run:
 
@@ -64911,14 +64926,13 @@
 
       &lt;/ol&gt;&lt;/li&gt;
 
-     &lt;li id=history-autocomplete&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt;'s
-     &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; has any &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt; elements whose
-     &lt;a href=#resulting-autocompletion-state&gt;resulting autocompletion state&lt;/a&gt; is &lt;i title=&quot;&quot;&gt;off&lt;/i&gt;, invoke the &lt;a href=#concept-form-reset-control title=concept-form-reset-control&gt;reset algorithm&lt;/a&gt; of each
+     &lt;li id=history-autocomplete&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified
+     entry&lt;/var&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; has any &lt;code&gt;&lt;a href=#the-input-element&gt;input&lt;/a&gt;&lt;/code&gt;
+     elements whose &lt;a href=#resulting-autocompletion-state&gt;resulting autocompletion state&lt;/a&gt; is &lt;i title=&quot;&quot;&gt;off&lt;/i&gt;, invoke the &lt;a href=#concept-form-reset-control title=concept-form-reset-control&gt;reset algorithm&lt;/a&gt; of each
      of those elements.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; of the
-     &lt;i&gt;specified entry&lt;/i&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is &quot;complete&quot;,
-     &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire a &lt;code title=event-pageshow&gt;&lt;a href=#event-pageshow&gt;pageshow&lt;/a&gt;&lt;/code&gt; event at the
+     &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-document-readiness&gt;current document readiness&lt;/a&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is
+     &quot;complete&quot;, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to fire a &lt;code title=event-pageshow&gt;&lt;a href=#event-pageshow&gt;pageshow&lt;/a&gt;&lt;/code&gt; event at the
      &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of that &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, but
      with its &lt;code title=dom-event-target&gt;&lt;a href=#dom-event-target&gt;target&lt;/a&gt;&lt;/code&gt; set to the
      &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object (and the &lt;code title=dom-event-currentTarget&gt;currentTarget&lt;/code&gt; set to the
@@ -64936,22 +64950,24 @@
     &lt;/ol&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set &lt;a href=&quot;#the-document's-current-address&quot;&gt;the document's current address&lt;/a&gt; to the URL
-   of the &lt;i&gt;specified entry&lt;/i&gt;.&lt;/li&gt;
+   of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a URL whose fragment
-   identifier differs from that of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;'s
-   when compared in a &lt;a href=#case-sensitive&gt;case-sensitive&lt;/a&gt; manner, and the two
-   share the same &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object, then let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var title=&quot;&quot;&gt;old
-   URL&lt;/var&gt; be the URL of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt; and &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;i&gt;specified entry&lt;/i&gt;.
-   Otherwise, let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be false.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a URL whose
+   fragment identifier differs from that of the &lt;a href=#current-entry&gt;current
+   entry&lt;/a&gt;'s when compared in a &lt;a href=#case-sensitive&gt;case-sensitive&lt;/a&gt;
+   manner, and the two share the same &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object,
+   then let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var title=&quot;&quot;&gt;old URL&lt;/var&gt; be the URL of the &lt;a href=#current-entry&gt;current entry&lt;/a&gt;
+   and &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;hash
+   changed&lt;/var&gt; be false.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the traversal was initiated with &lt;dfn id=replacement-enabled&gt;replacement
    enabled&lt;/dfn&gt;, remove the entry immediately before the
    &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; in the session history.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is not &lt;a href=#an-entry-with-persisted-user-state&gt;an entry with
-   persisted user state&lt;/a&gt;, but its URL has a fragment identifier,
-   &lt;a href=#scroll-to-the-fragment-identifier&gt;scroll to the fragment identifier&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; is not &lt;a href=#an-entry-with-persisted-user-state&gt;an
+   entry with persisted user state&lt;/a&gt;, but its URL has a fragment
+   identifier, &lt;a href=#scroll-to-the-fragment-identifier&gt;scroll to the fragment
+   identifier&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -64973,11 +64989,22 @@
    state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
    null.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Set &lt;code title=dom-history-state&gt;&lt;a href=#dom-history-state&gt;history.state&lt;/a&gt;&lt;/code&gt; to &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Set &lt;code title=dom-history-state&gt;&lt;a href=#dom-history-state&gt;history.state&lt;/a&gt;&lt;/code&gt; to
+   &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Fire a &lt;code title=event-popstate&gt;&lt;a href=#event-popstate&gt;popstate&lt;/a&gt;&lt;/code&gt; event at
-   the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, using
-   the &lt;code&gt;&lt;a href=#popstateevent&gt;PopStateEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt; attribute initialized
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;state changed&lt;/var&gt; be true if the
+   &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; is not the &lt;var title=&quot;&quot;&gt;specified
+   entry&lt;/var&gt;; otherwise let it be false. (If the
+   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; has no &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; then by
+   definition its &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; is not the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.)&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;Let the &lt;a href=#latest-entry&gt;latest entry&lt;/a&gt; of the
+   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; be
+   the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;var title=&quot;&quot;&gt;state changed&lt;/var&gt; is true, fire a &lt;code title=event-popstate&gt;&lt;a href=#event-popstate&gt;popstate&lt;/a&gt;&lt;/code&gt; event at the
+   &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, using the
+   &lt;code&gt;&lt;a href=#popstateevent&gt;PopStateEvent&lt;/a&gt;&lt;/code&gt; interface, with the &lt;code title=dom-PopStateEvent-state&gt;&lt;a href=#dom-popstateevent-state&gt;state&lt;/a&gt;&lt;/code&gt; attribute initialized
    to the value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble
    but not be cancelable and has no default action.&lt;/li&gt;
 
@@ -64989,8 +65016,8 @@
    initialized to &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt;. This event must bubble
    but not be cancelable and has no default action.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#current-entry&gt;current entry&lt;/a&gt; is now the &lt;i&gt;specified
-   entry&lt;/i&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;a href=#current-entry&gt;current entry&lt;/a&gt; is now the &lt;var title=&quot;&quot;&gt;specified
+   entry&lt;/var&gt;.&lt;/li&gt;
 
   &lt;/ol&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the tasks mentioned above is the
   &lt;a href=#dom-manipulation-task-source&gt;DOM manipulation task source&lt;/a&gt;.&lt;/p&gt;

Modified: source
===================================================================
--- source	2011-09-22 22:29:26 UTC (rev 6563)
+++ source	2011-09-22 23:21:04 UTC (rev 6564)
@@ -71931,6 +71931,12 @@
   &lt;code&gt;Document&lt;/code&gt; (and that are therefore merely different
   states of one particular document) are contiguous by definition.&lt;/p&gt;
 
+  &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; in a &lt;span&gt;browsing context&lt;/span&gt;
+  also has a &lt;dfn&gt;latest entry&lt;/dfn&gt;. This is the entry or that
+  &lt;code&gt;Document&lt;/code&gt; that was most the recently traversed to. When
+  a &lt;code&gt;Document&lt;/code&gt; is created, it initially has no &lt;span&gt;latest
+  entry&lt;/span&gt;.&lt;/p&gt;
+
   &lt;div class=&quot;impl&quot;&gt;
 
   &lt;p&gt;User agents may &lt;span title=&quot;discard a Document&quot;&gt;discard&lt;/span&gt;
@@ -72242,12 +72248,13 @@
      entry is then said to be &lt;span&gt;an entry with persisted user
      state&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Add a state object entry to the session history, after the
-     &lt;span&gt;current entry&lt;/span&gt;, with &lt;var title=&quot;&quot;&gt;cloned data&lt;/var&gt; as
-     the state object, the given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title,
-     and, if the third argument is present, the &lt;span&gt;absolute
-     URL&lt;/span&gt; that was found earlier in this algorithm as the
-     &lt;span&gt;URL&lt;/span&gt; of the entry.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Add a &lt;span&gt;state object&lt;/span&gt; entry to the session
+     history, after the &lt;span&gt;current entry&lt;/span&gt;, with &lt;var
+     title=&quot;&quot;&gt;cloned data&lt;/var&gt; as the &lt;span&gt;state object&lt;/span&gt;, the
+     given &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; as the title, and, if the third
+     argument is present, the &lt;span&gt;absolute URL&lt;/span&gt; that was found
+     earlier in this algorithm as the &lt;span&gt;URL&lt;/span&gt; of the
+     entry.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Update the &lt;span&gt;current entry&lt;/span&gt; to be this newly
      added entry.&lt;/p&gt;&lt;/li&gt;
@@ -72292,13 +72299,21 @@
 
    &lt;li&gt;
 
-     &lt;p&gt;Set &lt;code title=&quot;dom-history-state&quot;&gt;history.state&lt;/code&gt; to a
-     &lt;span&gt;structured clone&lt;/span&gt; of &lt;var title=&quot;&quot;&gt;cloned
-     data&lt;/var&gt;.&lt;/p&gt; &lt;!-- it's a clone of /cloned data/, not /data/,
-     so that there's no risk of running scripts again --&gt;
+    &lt;p&gt;Set &lt;code title=&quot;dom-history-state&quot;&gt;history.state&lt;/code&gt; to a
+    &lt;span&gt;structured clone&lt;/span&gt; of &lt;var title=&quot;&quot;&gt;cloned
+    data&lt;/var&gt;.&lt;/p&gt; &lt;!-- it's a clone of /cloned data/, not /data/, so
+    that there's no risk of running scripts again --&gt;
 
    &lt;/li&gt;
 
+   &lt;li&gt;
+
+    &lt;p&gt;Let the &lt;span&gt;latest entry&lt;/span&gt; of the
+    &lt;code&gt;Document&lt;/code&gt; of the &lt;span&gt;current entry&lt;/span&gt; be the
+    &lt;span&gt;current entry&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
   &lt;/ol&gt;
 
   &lt;p class=&quot;note&quot;&gt;The &lt;var title=&quot;&quot;&gt;title&lt;/var&gt; is purely
@@ -73746,16 +73761,17 @@
   &lt;div class=&quot;impl&quot;&gt;
 
   &lt;p&gt;When a user agent is required to &lt;dfn&gt;traverse the history&lt;/dfn&gt;
-  to a &lt;i&gt;specified entry&lt;/i&gt;, optionally with &lt;span&gt;replacement
-  enabled&lt;/span&gt;, the user agent must act as follows.&lt;/p&gt;
+  to a &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;, optionally with
+  &lt;span&gt;replacement enabled&lt;/span&gt;, the user agent must act as
+  follows.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;This algorithm is not just invoked when &lt;span
   title=&quot;traverse the history by a delta&quot;&gt;explicitly going back or
   forwards in the session history&lt;/span&gt; &mdash; it is also invoked in
   other situations, for example when &lt;span title=&quot;navigate&quot;&gt;navigating
-  a browsing context&lt;/span&gt;, as part of &lt;span title=&quot;update the session
-  history with the new page&quot;&gt;updating the session history with the new
-  page&lt;/span&gt;.&lt;/p&gt;
+  a browsing context&lt;/span&gt;, as part of &lt;span title=&quot;update the
+  session history with the new page&quot;&gt;updating the session history with
+  the new page&lt;/span&gt;.&lt;/p&gt;
 
   &lt;ol&gt;
 
@@ -73785,7 +73801,7 @@
    agent wishes to persist. The entry is then said to be &lt;span&gt;an
    entry with persisted user state&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a different
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a different
    &lt;code&gt;Document&lt;/code&gt; object than the &lt;span&gt;current entry&lt;/span&gt;
    then the user agent must run the following substeps:&lt;/p&gt;
 
@@ -73794,10 +73810,11 @@
      &lt;li&gt;If the browsing context is a &lt;span&gt;top-level browsing
      context&lt;/span&gt;, but not an &lt;span&gt;auxiliary browsing
      context&lt;/span&gt;, and the &lt;span&gt;origin&lt;/span&gt; of the
-     &lt;code&gt;Document&lt;/code&gt; of the &lt;i&gt;specified entry&lt;/i&gt; is not the
-     &lt;span title=&quot;same origin&quot;&gt;same&lt;/span&gt; as the &lt;span&gt;origin&lt;/span&gt;
-     of the &lt;code&gt;Document&lt;/code&gt; of the &lt;span&gt;current entry&lt;/span&gt;,
-     then the following sub-sub-steps must be run:
+     &lt;code&gt;Document&lt;/code&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;
+     is not the &lt;span title=&quot;same origin&quot;&gt;same&lt;/span&gt; as the
+     &lt;span&gt;origin&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt; of the
+     &lt;span&gt;current entry&lt;/span&gt;, then the following sub-sub-steps must
+     be run:
 
       &lt;ol&gt;
 
@@ -73814,12 +73831,12 @@
 
      &lt;/li&gt;
 
-     &lt;li id=&quot;appcache-history-2&quot;&gt;The user agent must make the
-     &lt;i&gt;specified entry&lt;/i&gt;'s &lt;code&gt;Document&lt;/code&gt; object the
+     &lt;li id=&quot;appcache-history-2&quot;&gt;The user agent must make the &lt;var
+     title=&quot;&quot;&gt;specified entry&lt;/var&gt;'s &lt;code&gt;Document&lt;/code&gt; object the
      &lt;span&gt;active document&lt;/span&gt; of the &lt;span&gt;browsing
      context&lt;/span&gt;.&lt;/li&gt;
 
-     &lt;li&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a &lt;span&gt;browsing
+     &lt;li&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a &lt;span&gt;browsing
      context name&lt;/span&gt; stored with it, then the following
      sub-sub-steps must be run:
 
@@ -73838,16 +73855,16 @@
 
      &lt;/li&gt;
 
-     &lt;li id=&quot;history-autocomplete&quot;&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt;'s
-     &lt;code&gt;Document&lt;/code&gt; has any &lt;code&gt;input&lt;/code&gt; elements whose
-     &lt;span&gt;resulting autocompletion state&lt;/span&gt; is &lt;i
+     &lt;li id=&quot;history-autocomplete&quot;&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified
+     entry&lt;/var&gt;'s &lt;code&gt;Document&lt;/code&gt; has any &lt;code&gt;input&lt;/code&gt;
+     elements whose &lt;span&gt;resulting autocompletion state&lt;/span&gt; is &lt;i
      title=&quot;&quot;&gt;off&lt;/i&gt;, invoke the &lt;span
      title=&quot;concept-form-reset-control&quot;&gt;reset algorithm&lt;/span&gt; of each
      of those elements.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;If the &lt;span&gt;current document readiness&lt;/span&gt; of the
-     &lt;i&gt;specified entry&lt;/i&gt;'s &lt;code&gt;Document&lt;/code&gt; is &quot;complete&quot;,
-     &lt;span&gt;queue a task&lt;/span&gt; to fire a &lt;code
+     &lt;li&gt;&lt;p&gt;If the &lt;span&gt;current document readiness&lt;/span&gt; of the &lt;var
+     title=&quot;&quot;&gt;specified entry&lt;/var&gt;'s &lt;code&gt;Document&lt;/code&gt; is
+     &quot;complete&quot;, &lt;span&gt;queue a task&lt;/span&gt; to fire a &lt;code
      title=&quot;event-pageshow&quot;&gt;pageshow&lt;/code&gt; event at the
      &lt;code&gt;Window&lt;/code&gt; object of that &lt;code&gt;Document&lt;/code&gt;, but
      with its &lt;code title=&quot;dom-event-target&quot;&gt;target&lt;/code&gt; set to the
@@ -73870,24 +73887,26 @@
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Set &lt;span&gt;the document's current address&lt;/span&gt; to the URL
-   of the &lt;i&gt;specified entry&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+   of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; has a URL whose fragment
-   identifier differs from that of the &lt;span&gt;current entry&lt;/span&gt;'s
-   when compared in a &lt;span&gt;case-sensitive&lt;/span&gt; manner, and the two
-   share the same &lt;code&gt;Document&lt;/code&gt; object, then let &lt;var
-   title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var title=&quot;&quot;&gt;old
-   URL&lt;/var&gt; be the URL of the &lt;span&gt;current entry&lt;/span&gt; and &lt;var
-   title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;i&gt;specified entry&lt;/i&gt;.
-   Otherwise, let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be false.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; has a URL whose
+   fragment identifier differs from that of the &lt;span&gt;current
+   entry&lt;/span&gt;'s when compared in a &lt;span&gt;case-sensitive&lt;/span&gt;
+   manner, and the two share the same &lt;code&gt;Document&lt;/code&gt; object,
+   then let &lt;var title=&quot;&quot;&gt;hash changed&lt;/var&gt; be true, and let &lt;var
+   title=&quot;&quot;&gt;old URL&lt;/var&gt; be the URL of the &lt;span&gt;current entry&lt;/span&gt;
+   and &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the URL of the &lt;var
+   title=&quot;&quot;&gt;specified entry&lt;/var&gt;. Otherwise, let &lt;var title=&quot;&quot;&gt;hash
+   changed&lt;/var&gt; be false.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If the traversal was initiated with &lt;dfn&gt;replacement
    enabled&lt;/dfn&gt;, remove the entry immediately before the
    &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; in the session history.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;i&gt;specified entry&lt;/i&gt; is not &lt;span&gt;an entry with
-   persisted user state&lt;/span&gt;, but its URL has a fragment identifier,
-   &lt;span&gt;scroll to the fragment identifier&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; is not &lt;span&gt;an
+   entry with persisted user state&lt;/span&gt;, but its URL has a fragment
+   identifier, &lt;span&gt;scroll to the fragment
+   identifier&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -73913,12 +73932,25 @@
    state object. Otherwise, let &lt;var title=&quot;&quot;&gt;state&lt;/var&gt; be
    null.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Set &lt;code title=&quot;dom-history-state&quot;&gt;history.state&lt;/code&gt; to &lt;var
-   title=&quot;&quot;&gt;state&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Set &lt;code title=&quot;dom-history-state&quot;&gt;history.state&lt;/code&gt; to
+   &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Fire a &lt;code title=&quot;event-popstate&quot;&gt;popstate&lt;/code&gt; event at
-   the &lt;code&gt;Window&lt;/code&gt; object of the &lt;code&gt;Document&lt;/code&gt;, using
-   the &lt;code&gt;PopStateEvent&lt;/code&gt; interface, with the &lt;code
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;state changed&lt;/var&gt; be true if the
+   &lt;span&gt;latest entry&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt; of the &lt;var
+   title=&quot;&quot;&gt;specified entry&lt;/var&gt; is not the &lt;var title=&quot;&quot;&gt;specified
+   entry&lt;/var&gt;; otherwise let it be false. (If the
+   &lt;code&gt;Document&lt;/code&gt; has no &lt;span&gt;latest entry&lt;/span&gt; then by
+   definition its &lt;span&gt;latest entry&lt;/span&gt; is not the &lt;var
+   title=&quot;&quot;&gt;specified entry&lt;/var&gt;.)&lt;/p&gt;
+
+   &lt;li&gt;&lt;p&gt;Let the &lt;span&gt;latest entry&lt;/span&gt; of the
+   &lt;code&gt;Document&lt;/code&gt; of the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt; be
+   the &lt;var title=&quot;&quot;&gt;specified entry&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;var title=&quot;&quot;&gt;state changed&lt;/var&gt; is true, fire a &lt;code
+   title=&quot;event-popstate&quot;&gt;popstate&lt;/code&gt; event at the
+   &lt;code&gt;Window&lt;/code&gt; object of the &lt;code&gt;Document&lt;/code&gt;, using the
+   &lt;code&gt;PopStateEvent&lt;/code&gt; interface, with the &lt;code
    title=&quot;dom-PopStateEvent-state&quot;&gt;state&lt;/code&gt; attribute initialized
    to the value of &lt;var title=&quot;&quot;&gt;state&lt;/var&gt;. This event must bubble
    but not be cancelable and has no default action.&lt;/p&gt;&lt;/li&gt;
@@ -73933,8 +73965,8 @@
    initialized to &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt;. This event must bubble
    but not be cancelable and has no default action.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;current entry&lt;/span&gt; is now the &lt;i&gt;specified
-   entry&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;span&gt;current entry&lt;/span&gt; is now the &lt;var title=&quot;&quot;&gt;specified
+   entry&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013430.html">[html5] r6563 - [e] (0) accuracy Fixing	http://www.w3.org/Bugs/Public/show_bug.cgi?id=12667
</A></li>
	<LI>Next message: <A HREF="013432.html">[html5] r6565 - [c] (0) Make size and maxlength conforming on	type=number for now. (fixing r6413 [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13431">[ date ]</a>
              <a href="thread.html#13431">[ thread ]</a>
              <a href="subject.html#13431">[ subject ]</a>
              <a href="author.html#13431">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
