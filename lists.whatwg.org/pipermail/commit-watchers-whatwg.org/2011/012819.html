<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r5952 - [giow] (0) Expose readyState on PeerConnection.	This isn't entirely fully baked [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5952%20-%20%5Bgiow%5D%20%280%29%20Expose%20readyState%20on%20PeerConnection.%0A%09This%20isn%27t%20entirely%20fully%20baked%20%5B...%5D&In-Reply-To=%3C20110316055449.86DE48058205%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012818.html">
   <LINK REL="Next"  HREF="012820.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r5952 - [giow] (0) Expose readyState on PeerConnection.	This isn't entirely fully baked [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r5952%20-%20%5Bgiow%5D%20%280%29%20Expose%20readyState%20on%20PeerConnection.%0A%09This%20isn%27t%20entirely%20fully%20baked%20%5B...%5D&In-Reply-To=%3C20110316055449.86DE48058205%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r5952 - [giow] (0) Expose readyState on PeerConnection.	This isn't entirely fully baked [...]">whatwg at whatwg.org
       </A><BR>
    <I>Tue Mar 15 22:54:49 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012818.html">[html5] r5951 - [giow] (0) Use 'message' instead of 'text' for the	event name for consistency wi [...]
</A></li>
        <LI>Next message: <A HREF="012820.html">[html5] r5953 - [giow] (0) abarth tells me one layer is sufficient,	security wise.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12819">[ date ]</a>
              <a href="thread.html#12819">[ thread ]</a>
              <a href="subject.html#12819">[ subject ]</a>
              <a href="author.html#12819">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2011-03-15 22:54:48 -0700 (Tue, 15 Mar 2011)
New Revision: 5952

Modified:
   complete.html
   index
   source
Log:
[giow] (0) Expose readyState on PeerConnection. This isn't entirely fully baked yet, it'll probably need tweaking (unless I've been very lucky). Let me know what mistakes I made...

Modified: complete.html
===================================================================
--- complete.html	2011-03-14 22:21:01 UTC (rev 5951)
+++ complete.html	2011-03-16 05:54:48 UTC (rev 5952)
@@ -239,7 +239,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1&gt;Web Applications 1.0&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 14 March 2011&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 16 March 2011&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -71706,7 +71706,11 @@
 interface &lt;dfn id=peerconnection&gt;PeerConnection&lt;/dfn&gt; {
   void &lt;a href=#dom-peerconnection-signalingmessage title=dom-PeerConnection-signalingMessage&gt;signalingMessage&lt;/a&gt;(in DOMString message);
 
-  // &lt;span class=XXX&gt;readyState, etc&lt;/span&gt;
+  const unsigned short &lt;a href=#dom-peerconnection-new title=dom-PeerConnection-NEW&gt;NEW&lt;/a&gt; = 0;
+  const unsigned short &lt;a href=#dom-peerconnection-negotiating title=dom-PeerConnection-NEGOTIATING&gt;NEGOTIATING&lt;/a&gt; = 1;
+  const unsigned short &lt;a href=#dom-peerconnection-active title=dom-PeerConnection-ACTIVE&gt;ACTIVE&lt;/a&gt; = 2;
+  const unsigned short &lt;a href=#dom-peerconnection-closed title=dom-PeerConnection-CLOSED&gt;CLOSED&lt;/a&gt; = 3;
+  readonly attribute unsigned short &lt;a href=#dom-peerconnection-readystate title=dom-PeerConnection-readyState&gt;readyState&lt;/a&gt;;
 
   void &lt;a href=#dom-peerconnection-send title=dom-PeerConnection-send&gt;send&lt;/a&gt;(in DOMString text);
   void &lt;a href=#dom-peerconnection-addstream title=dom-PeerConnection-addStream&gt;addStream&lt;/a&gt;(in &lt;a href=#stream&gt;Stream&lt;/a&gt; stream);
@@ -71714,8 +71718,13 @@
   readonly attribute &lt;a href=#stream&gt;Stream&lt;/a&gt;[] &lt;a href=#dom-peerconnection-localstreams title=dom-PeerConnection-localStreams&gt;localStreams&lt;/a&gt;;
   readonly attribute &lt;a href=#stream&gt;Stream&lt;/a&gt;[] &lt;a href=#dom-peerconnection-remotestreams title=dom-PeerConnection-remoteStreams&gt;remoteStreams&lt;/a&gt;;
 
+  void &lt;a href=#dom-peerconnection-close title=dom-PeerConnection-close&gt;close&lt;/a&gt;();
+
   // &lt;span class=XXX&gt;connection quality information&lt;/span&gt;
-
+           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onconnecting title=handler-PeerConnection-onconnecting&gt;onconnecting&lt;/a&gt;;
+           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onopen title=handler-PeerConnection-onopen&gt;onopen&lt;/a&gt;;
+           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onerror title=handler-PeerConnection-onerror&gt;onerror&lt;/a&gt;;
+           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onclose title=handler-PeerConnection-onclose&gt;onclose&lt;/a&gt;;
            attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onmessage title=handler-PeerConnection-onmessage&gt;onmessage&lt;/a&gt;;
            attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onaddstream title=handler-PeerConnection-onaddstream&gt;onaddstream&lt;/a&gt;;
            attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onremovestream title=handler-PeerConnection-onremovestream&gt;onremovestream&lt;/a&gt;;
@@ -71784,6 +71793,21 @@
    &lt;/dd&gt;
 
 
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; . &lt;code title=dom-PeerConnection-readyState&gt;&lt;a href=#dom-peerconnection-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Returns the current readiness state for the connection,
+    represented by a number from the following list:&lt;/p&gt;
+    &lt;dl&gt;&lt;dt&gt; &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; . &lt;code title=dom-PeerConnection-NEW&gt;&lt;a href=#dom-peerconnection-new&gt;NEW&lt;/a&gt;&lt;/code&gt; (0)&lt;/dt&gt;
+     &lt;dd&gt;The object was just created, and no networking has yet occurred.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; . &lt;code title=dom-PeerConnection-NEGOTIATING&gt;&lt;a href=#dom-peerconnection-negotiating&gt;NEGOTIATING&lt;/a&gt;&lt;/code&gt; (1)&lt;/dt&gt;
+     &lt;dd&gt;The user agent is attempting to establish a connection.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; . &lt;code title=dom-PeerConnection-ACTIVE&gt;&lt;a href=#dom-peerconnection-active&gt;ACTIVE&lt;/a&gt;&lt;/code&gt; (2)&lt;/dt&gt;
+     &lt;dd&gt;The connection is as good as its going to get.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; . &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3)&lt;/dt&gt;
+     &lt;dd&gt;The connection is closed.&lt;/dd&gt;
+    &lt;/dl&gt;&lt;/dd&gt;
+
+
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; . &lt;code title=dom-PeerConnection-signalingMessage&gt;&lt;a href=#dom-peerconnection-signalingmessage&gt;signalingMessage&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;)&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -71810,7 +71834,7 @@
     every message will be received.&lt;/p&gt;
 
     &lt;p&gt;When a message sent in this manner from the other peer is
-    received, a &lt;code title=event-PeerConnection-message&gt;message&lt;/code&gt;
+    received, a &lt;code title=event-stream-message&gt;message&lt;/code&gt;
     event is dispatched at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -71823,7 +71847,7 @@
     peer.&lt;/p&gt;
 
     &lt;p&gt;When the other peer starts sending a stream in this manner, an
-    &lt;code title=event-PeerConnection-addstream&gt;addstream&lt;/code&gt;
+    &lt;code title=event-stream-addstream&gt;addstream&lt;/code&gt;
     event is dispatched at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -71835,7 +71859,7 @@
     &lt;p&gt;Steps sending the given stream to the remote peer.&lt;/p&gt;
 
     &lt;p&gt;When the other peer stops sending a stream in this manner, a
-    &lt;code title=event-PeerConnection-removestream&gt;removestream&lt;/code&gt;
+    &lt;code title=event-stream-removestream&gt;removestream&lt;/code&gt;
     event is dispatched at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -71857,7 +71881,7 @@
     &lt;p&gt;Returns a live array containing the streams that the user agent
     is currently receiving from the remote peer.&lt;/p&gt;
 
-    &lt;p&gt;This array is updated when &lt;code title=event-PeerConnection-addstream&gt;addstream&lt;/code&gt; and &lt;code title=event-PeerConnection-removestream&gt;removestream&lt;/code&gt;
+    &lt;p&gt;This array is updated when &lt;code title=event-stream-addstream&gt;addstream&lt;/code&gt; and &lt;code title=event-stream-removestream&gt;removestream&lt;/code&gt;
     events are fired.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -71867,11 +71891,33 @@
   &lt;p&gt;A &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object has an associated
   &lt;dfn id=peerconnection-signaling-callback&gt;&lt;code&gt;PeerConnection&lt;/code&gt; signaling callback&lt;/dfn&gt;, a
   &lt;dfn id=peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/dfn&gt;, a
-  &lt;dfn id=peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/dfn&gt; and an
+  &lt;dfn id=peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/dfn&gt;, a
+  &lt;dfn id=peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/dfn&gt; and an
   &lt;dfn id=ice-started-flag&gt;ICE started flag&lt;/dfn&gt;. These are initialized when the object
   is created.&lt;/p&gt;
 
-  &lt;p&gt;When the &lt;dfn id=dom-peerconnection title=dom-PeerConnection&gt;&lt;code&gt;PeerConnection()&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; can
+  have the following values:&lt;/p&gt;
+
+  &lt;dl&gt;&lt;dt&gt;&lt;dfn id=dom-peerconnection-new title=dom-PeerConnection-NEW&gt;&lt;code&gt;NEW&lt;/code&gt;&lt;/dfn&gt; (numeric value 0)&lt;/dt&gt;
+
+   &lt;dd&gt;The object was just created and its ICE Agent has not yet been started.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-peerconnection-negotiating title=dom-PeerConnection-NEGOTIATING&gt;&lt;code&gt;NEGOTIATING&lt;/code&gt;&lt;/dfn&gt; (numeric value 1)&lt;/dt&gt;
+
+   &lt;dd&gt;The ICE Agent is actively preforming ICE processing.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-peerconnection-active title=dom-PeerConnection-ACTIVE&gt;&lt;code&gt;ACTIVE&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)&lt;/dt&gt;
+
+   &lt;dd&gt;The ICE Agent has concluded ICE processing and media is streaming.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-peerconnection-closed title=dom-PeerConnection-CLOSED&gt;&lt;code&gt;CLOSED&lt;/code&gt;&lt;/dfn&gt; (numeric value 3)&lt;/dt&gt;
+
+   &lt;dd&gt;Either the &lt;code title=dom-PeerConnection-close&gt;&lt;a href=#dom-peerconnection-close&gt;close()&lt;/a&gt;&lt;/code&gt; method has been
+   invoked, or the other peer removed all the media streams, or the
+   other peer has apparently abruptly stopped sending any media.&lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;p&gt;When the &lt;dfn id=dom-peerconnection title=dom-PeerConnection&gt;&lt;code&gt;PeerConnection()&lt;/code&gt;&lt;/dfn&gt;
   constructor is invoked, the user agent must run the following steps.
   This algorithm has a &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; (which is
   triggered as part of the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; algorithm). Steps
@@ -71973,6 +72019,9 @@
    &lt;a href=#peerconnection-signaling-callback&gt;&lt;code&gt;PeerConnection&lt;/code&gt; signaling callback&lt;/a&gt; be
    &lt;var title=&quot;&quot;&gt;signalingCallback&lt;/var&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-NEW&gt;&lt;a href=#dom-peerconnection-new&gt;NEW&lt;/a&gt;&lt;/code&gt; (0).&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
    flag&lt;/a&gt; to false.&lt;/li&gt;
 
@@ -71999,11 +72048,21 @@
    &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; and send the
    initial offer. The initial offer must include a media description
    for the &lt;a href=#peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media
-   stream&lt;/a&gt; and for all the streams in &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt;. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/li&gt;
+   stream&lt;/a&gt;, marked as &quot;sendrecv&quot;, and for all the streams in
+   &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt;
+   (marked as &quot;sendonly&quot;). &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt; &lt;a href=#refsSDPOFFERANSWER&gt;[SDPOFFERANSWER]&lt;/a&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&#8987; Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE
    started flag&lt;/a&gt; be true.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;&#8987; If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is still
+   &lt;code title=dom-PeerConnection-NEW&gt;&lt;a href=#dom-peerconnection-new&gt;NEW&lt;/a&gt;&lt;/code&gt; (0), then
+   &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; that sets it to &lt;code title=dom-PeerConnection-NEGOTIATING&gt;&lt;a href=#dom-peerconnection-negotiating&gt;NEGOTIATING&lt;/a&gt;&lt;/code&gt; (1) and
+   then &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/a&gt;
+   named &lt;code title=event-stream-connecting&gt;connecting&lt;/code&gt; at the
+   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
   &lt;/ol&gt;&lt;p&gt;When a &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; is
   required to send SDP offers or answers, the user agent must follow
   these steps:&lt;/p&gt;
@@ -72020,7 +72079,12 @@
    &lt;a href=#peerconnection-signaling-callback&gt;&lt;code&gt;PeerConnection&lt;/code&gt; signaling callback&lt;/a&gt; with
    &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; as its argument.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;All SDP media descriptions for streams represented by
+  &lt;/ol&gt;&lt;p&gt;All streams represented by &lt;code&gt;&lt;a href=#stream&gt;Stream&lt;/a&gt;&lt;/code&gt; objects must be
+  marked as &quot;sendonly&quot; by the peer that initially adds the stream to
+  the session. The &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; API does not support
+  bidirectional (&quot;sendrecv&quot;) audio or video media streams. &lt;a href=#refsSDPOFFERANSWER&gt;[SDPOFFERANSWER]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;All SDP media descriptions for streams represented by
   &lt;code&gt;&lt;a href=#stream&gt;Stream&lt;/a&gt;&lt;/code&gt; objects must include a label attribute (&quot;&lt;code title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) whose value is the value of the
   &lt;code&gt;&lt;a href=#stream&gt;Stream&lt;/a&gt;&lt;/code&gt; object's &lt;code title=dom-stream-label&gt;&lt;a href=#dom-stream-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute. &lt;a href=#refsSDP&gt;[SDP]&lt;/a&gt; &lt;a href=#refsSDPLABEL&gt;[SDPLABEL]&lt;/a&gt;&lt;/p&gt;
 
@@ -72077,6 +72141,14 @@
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be the method's
    argument.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; be the
+   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object on which the method was
+   invoked.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;If the first four characters of &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; are
@@ -72094,35 +72166,85 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; be the string consisting of all
    but the first four characters of &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
+   flag&lt;/a&gt; is true, then pass &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; to the
+   &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; as a subsequent
+   offer or answer, to be interpreted as appropriate given the current
+   state of the ICE Agent, and abort these steps. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
-    flag&lt;/a&gt; is still false, start the
+    &lt;p&gt;The &lt;a href=#ice-started-flag&gt;ICE started flag&lt;/a&gt; is false. Start the
     &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; and pass it
     &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; as the initial offer from the other peer;
     the ICE Agent will then (asynchronously) construct the initial
-    answer and transmit it as described above. The initial answer must
-    include a media description for the
-    &lt;a href=#peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/a&gt; and
-    for all the streams in &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt;. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+    answer and transmit it as described above.&lt;/p&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
-    flag&lt;/a&gt; is true, then pass &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; to the
-    &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; as a subsequent
-    offer or answer, to be interpreted as appropriate given the
-    current state of the ICE Agent. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;a href=#remotely-initiated-data-udp-media-stream&gt;remotely-initiated data UDP media
+    stream&lt;/a&gt; in the initial offer, and it has an encryption key
+    advertised in its media description that is 16 bytes long, then
+    that is the &lt;a href=#peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media
+    stream&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;After the initial answer has been sent, the ICE Agent must add
+    all the streams in &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt; to the
+    session, as described above. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
    flag&lt;/a&gt; be true.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;When the &lt;dfn id=dom-peerconnection-send title=dom-PeerConnection-send&gt;&lt;code title=&quot;&quot;&gt;send()&lt;/code&gt;&lt;/dfn&gt; method is invoked, the
+   &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; that sets &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt;
+   readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-NEGOTIATING&gt;&lt;a href=#dom-peerconnection-negotiating&gt;NEGOTIATING&lt;/a&gt;&lt;/code&gt; (1) and
+   then &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/a&gt;
+   named &lt;code title=event-stream-connecting&gt;connecting&lt;/code&gt; at the
+   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When a &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt;
+  completes ICE processing with any active media streams, the user
+  agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; that sets the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-ACTIVE&gt;&lt;a href=#dom-peerconnection-active&gt;ACTIVE&lt;/a&gt;&lt;/code&gt; (2) and then &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/a&gt; named &lt;code title=event-stream-open&gt;open&lt;/code&gt; at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;When a &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt;
+  completes ICE processing with no active media streams, the user
+  agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; that sets the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3) and then, if the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; has ever
+  reached the &lt;code title=dom-PeerConnection-ACTIVE&gt;&lt;a href=#dom-peerconnection-active&gt;ACTIVE&lt;/a&gt;&lt;/code&gt;
+  (2) state, &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple
+  event&lt;/a&gt; named &lt;code title=event-stream-close&gt;close&lt;/code&gt; at the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object, or otherwise &lt;a href=#fire-a-simple-event title=&quot;fire a
+  simple event&quot;&gt;fires a simple event&lt;/a&gt; named &lt;code title=event-stream-error&gt;error&lt;/code&gt; at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;When a &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt;
+  restarts ICE processing for any reason (e.g. because a peer is
+  adding or removing a stream), the user agent must &lt;a href=#queue-a-task&gt;queue a
+  task&lt;/a&gt; that sets the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-NEGOTIATING&gt;&lt;a href=#dom-peerconnection-negotiating&gt;NEGOTIATING&lt;/a&gt;&lt;/code&gt; (1) and
+  then &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/a&gt;
+  named &lt;code title=event-stream-connecting&gt;connecting&lt;/code&gt; at the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+                                   
+  &lt;p&gt;The &lt;dfn id=dom-peerconnection-readystate title=dom-PeerConnection-readyState&gt;&lt;code title=&quot;&quot;&gt;readyState&lt;/code&gt;&lt;/dfn&gt; attribute must return the numeric
+  value of the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;When the &lt;dfn id=dom-peerconnection-send title=dom-PeerConnection-send&gt;&lt;code title=&quot;&quot;&gt;send()&lt;/code&gt;&lt;/dfn&gt; method is invoked, the
   user agent must run the following steps:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be the method's first
    argument.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;
    encoded as UTF-8. &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt;&lt;/li&gt;
 
@@ -72147,6 +72269,10 @@
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; be the method's
    argument.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; is null, throw a
    &lt;code&gt;TypeError&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
@@ -72171,6 +72297,10 @@
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; be the method's
    argument.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; is null, throw a
    &lt;code&gt;TypeError&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
@@ -72194,7 +72324,31 @@
   attributes must return the read-only &lt;code&gt;&lt;a href=#stream&gt;Stream&lt;/a&gt;&lt;/code&gt; arrays that
   the attributes were respectively set to when the
   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt;'s constructor ran.&lt;/p&gt;
+  
+  &lt;p&gt;When the &lt;dfn id=dom-peerconnection-close title=dom-PeerConnection-close&gt;&lt;code title=&quot;&quot;&gt;close()&lt;/code&gt;&lt;/dfn&gt; method is invoked, the user agent must
+  run the following steps:&lt;/p&gt;
 
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Destroy the &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE
+   Agent&lt;/a&gt;, abruptly ending any active ICE processing and any
+   active streaming, and releasing any relevant resources (e.g. TURN
+   permissions).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set the object's &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness
+   state&lt;/a&gt; to &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
+   event&lt;/a&gt; named &lt;code title=event-stream-close&gt;close&lt;/code&gt; at the
+   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;The &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt; and
+  &lt;code title=dom-PeerConnection-remoteStreams&gt;&lt;a href=#dom-peerconnection-remotestreams&gt;remoteStreams&lt;/a&gt;&lt;/code&gt;
+  objects remain in the state they were in when the object was
+  closed.&lt;/p&gt;
+
   &lt;hr&gt;&lt;p&gt;The following are the &lt;a href=#event-handlers&gt;event handlers&lt;/a&gt; (and their
   corresponding &lt;a href=#event-handler-event-type title=&quot;event handler event type&quot;&gt;event handler
   event types&lt;/a&gt;) that must be supported, as IDL attributes, by
@@ -72202,7 +72356,11 @@
   interface:&lt;/p&gt;
 
   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;Event handler&lt;/a&gt; &lt;th&gt;&lt;a href=#event-handler-event-type&gt;Event handler event type&lt;/a&gt;
-   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onmessage title=handler-PeerConnection-onmessage&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-message&gt;message&lt;/code&gt;
+   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onconnecting title=handler-PeerConnection-onconnecting&gt;&lt;code&gt;onconnecting&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-connecting&gt;connecting&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onopen title=handler-PeerConnection-onopen&gt;&lt;code&gt;onopen&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-open&gt;open&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onerror title=handler-PeerConnection-onerror&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-error&gt;error&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onclose title=handler-PeerConnection-onclose&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-close&gt;close&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onmessage title=handler-PeerConnection-onmessage&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-message&gt;message&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onaddstream title=handler-PeerConnection-onaddstream&gt;&lt;code&gt;onaddstream&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-addstream&gt;addstream&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onremovestream title=handler-PeerConnection-onremovestream&gt;&lt;code&gt;onremovestream&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-removestream&gt;removestream&lt;/code&gt;
   &lt;/table&gt;&lt;hr&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; listed in this section is the
@@ -72335,21 +72493,10 @@
    &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; has selected a
    destination for the &lt;a href=#data-udp-media-stream&gt;data UDP media stream&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;A &lt;dfn id=remote-data-udp-media-stream&gt;remote data UDP media stream&lt;/dfn&gt; is the first UDP media
-  stream whose sender is the remote peer, whose media is &quot;&lt;code title=&quot;&quot;&gt;application&lt;/code&gt;&quot;, whose transport protocol is &quot;&lt;code title=&quot;&quot;&gt;udp&lt;/code&gt;&quot;, whose media format description is
-  &quot;&lt;code&gt;&lt;a href=#application/html-peer-conection-data&gt;application/html-peer-conection-data&lt;/a&gt;&lt;/code&gt;&quot;, whose label
-  attribute (&quot;&lt;code title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) has the value &quot;&lt;code title=&quot;&quot;&gt;data&lt;/code&gt;&quot;, and for which a
-  &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; has selected a
-  destination, if that media stream has an encryption key advertised
-  in its media description, and if that encryption key is 16 bytes
-  long. A &lt;a href=#remote-data-udp-media-stream&gt;remote data UDP media stream&lt;/a&gt; is associated with
-  the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object for which the
-  &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; in question is
-  operating.&lt;/p&gt;
+  &lt;/ol&gt;&lt;p&gt;When a packet that is part of a &lt;a href=#data-udp-media-stream&gt;data UDP media
+  stream&lt;/a&gt; is received, the user agent must run the following
+  steps:&lt;/p&gt;
 
-  &lt;p&gt;When a packet from a &lt;a href=#remote-data-udp-media-stream&gt;remote data UDP media stream&lt;/a&gt; is
-  received, the user agent must run the following steps:&lt;/p&gt;
-
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encrypted message&lt;/var&gt; be the UDP
    packet's data.&lt;/li&gt;
 
@@ -72357,8 +72504,8 @@
    bytes, then abort these steps.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;ice-key&lt;/var&gt; be the 16 bytes given as the
-   encryption key for the &lt;a href=#remote-data-udp-media-stream&gt;remote data UDP media stream&lt;/a&gt; in
-   the media description for this media stream. &lt;a href=#refsSDP&gt;[SDP]&lt;/a&gt;&lt;/li&gt;
+   encryption key for the &lt;a href=#data-udp-media-stream&gt;data UDP media stream&lt;/a&gt; in the
+   media description for this media stream. &lt;a href=#refsSDP&gt;[SDP]&lt;/a&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;masked message with nonce&lt;/var&gt; be the
    result of decrypting &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; using AES-128-CTR
@@ -72390,15 +72537,21 @@
    handling&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Create an event that uses the &lt;code&gt;&lt;a href=#messageevent&gt;MessageEvent&lt;/a&gt;&lt;/code&gt;
-   interface, with the name &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt;,
-   which does not bubble, is not cancelable, has no default action,
-   and has a &lt;code title=dom-MessageEvent-data&gt;&lt;a href=#dom-messageevent-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute
-   whose value is &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, and &lt;a href=#queue-a-task&gt;queue a
-   task&lt;/a&gt; to dispatch the event at the
-   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object that the &lt;a href=#remote-data-udp-media-stream&gt;remote data UDP
-   media stream&lt;/a&gt; is associated with.&lt;/li&gt;
+   interface, with the name &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt;, which does not bubble, is not
+   cancelable, has no default action, and has a &lt;code title=dom-MessageEvent-data&gt;&lt;a href=#dom-messageevent-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute whose value is
+   &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, and &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to
+   dispatch the event at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object
+   responsible for this side of the &lt;a href=#data-udp-media-stream&gt;data UDP media
+   stream&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for this &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; is the &lt;a href=#networking-task-source&gt;networking task
+  &lt;/ol&gt;&lt;p&gt;A &lt;dfn id=remotely-initiated-data-udp-media-stream&gt;remotely-initiated data UDP media stream&lt;/dfn&gt; is the
+  first &quot;sendrecv&quot; media stream in the initial offer whose media is
+  &quot;&lt;code title=&quot;&quot;&gt;application&lt;/code&gt;&quot;, whose transport protocol is
+  &quot;&lt;code title=&quot;&quot;&gt;udp&lt;/code&gt;&quot;, whose media format description is
+  &quot;&lt;code&gt;&lt;a href=#application/html-peer-conection-data&gt;application/html-peer-conection-data&lt;/a&gt;&lt;/code&gt;&quot;, and whose label
+  attribute (&quot;&lt;code title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) has the value &quot;&lt;code title=&quot;&quot;&gt;data&lt;/code&gt;&quot;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for this &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; is the &lt;a href=#networking-task-source&gt;networking task
   source&lt;/a&gt;.&lt;/p&gt;
 
 

Modified: index
===================================================================
--- index	2011-03-14 22:21:01 UTC (rev 5951)
+++ index	2011-03-16 05:54:48 UTC (rev 5952)
@@ -243,7 +243,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> rel=home&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 14 March 2011&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 16 March 2011&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;p&gt;You can take part in this work. &lt;a href=<A HREF="http://www.whatwg.org/mailing-list">http://www.whatwg.org/mailing-list</A>&gt;Join the working group's discussion list.&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Web designers!&lt;/strong&gt; We have a &lt;a href=<A HREF="http://blog.whatwg.org/faq/">http://blog.whatwg.org/faq/</A>&gt;FAQ&lt;/a&gt;, a &lt;a href=<A HREF="http://forums.whatwg.org/">http://forums.whatwg.org/</A>&gt;forum&lt;/a&gt;, and a &lt;a href=<A HREF="http://www.whatwg.org/mailing-list#help">http://www.whatwg.org/mailing-list#help</A>&gt;help mailing list&lt;/a&gt; for you!&lt;/p&gt;
    &lt;!--&lt;p class=&quot;impl&quot;&gt;&lt;strong&gt;Implementors!&lt;/strong&gt; We have a &lt;a href=&quot;<A HREF="http://www.whatwg.org/mailing-list#implementors">http://www.whatwg.org/mailing-list#implementors</A>&quot;&gt;mailing list&lt;/a&gt; for you too!&lt;/p&gt;--&gt;
@@ -71715,7 +71715,11 @@
 interface &lt;dfn id=peerconnection&gt;PeerConnection&lt;/dfn&gt; {
   void &lt;a href=#dom-peerconnection-signalingmessage title=dom-PeerConnection-signalingMessage&gt;signalingMessage&lt;/a&gt;(in DOMString message);
 
-  // &lt;span class=XXX&gt;readyState, etc&lt;/span&gt;
+  const unsigned short &lt;a href=#dom-peerconnection-new title=dom-PeerConnection-NEW&gt;NEW&lt;/a&gt; = 0;
+  const unsigned short &lt;a href=#dom-peerconnection-negotiating title=dom-PeerConnection-NEGOTIATING&gt;NEGOTIATING&lt;/a&gt; = 1;
+  const unsigned short &lt;a href=#dom-peerconnection-active title=dom-PeerConnection-ACTIVE&gt;ACTIVE&lt;/a&gt; = 2;
+  const unsigned short &lt;a href=#dom-peerconnection-closed title=dom-PeerConnection-CLOSED&gt;CLOSED&lt;/a&gt; = 3;
+  readonly attribute unsigned short &lt;a href=#dom-peerconnection-readystate title=dom-PeerConnection-readyState&gt;readyState&lt;/a&gt;;
 
   void &lt;a href=#dom-peerconnection-send title=dom-PeerConnection-send&gt;send&lt;/a&gt;(in DOMString text);
   void &lt;a href=#dom-peerconnection-addstream title=dom-PeerConnection-addStream&gt;addStream&lt;/a&gt;(in &lt;a href=#stream&gt;Stream&lt;/a&gt; stream);
@@ -71723,8 +71727,13 @@
   readonly attribute &lt;a href=#stream&gt;Stream&lt;/a&gt;[] &lt;a href=#dom-peerconnection-localstreams title=dom-PeerConnection-localStreams&gt;localStreams&lt;/a&gt;;
   readonly attribute &lt;a href=#stream&gt;Stream&lt;/a&gt;[] &lt;a href=#dom-peerconnection-remotestreams title=dom-PeerConnection-remoteStreams&gt;remoteStreams&lt;/a&gt;;
 
+  void &lt;a href=#dom-peerconnection-close title=dom-PeerConnection-close&gt;close&lt;/a&gt;();
+
   // &lt;span class=XXX&gt;connection quality information&lt;/span&gt;
-
+           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onconnecting title=handler-PeerConnection-onconnecting&gt;onconnecting&lt;/a&gt;;
+           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onopen title=handler-PeerConnection-onopen&gt;onopen&lt;/a&gt;;
+           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onerror title=handler-PeerConnection-onerror&gt;onerror&lt;/a&gt;;
+           attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onclose title=handler-PeerConnection-onclose&gt;onclose&lt;/a&gt;;
            attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onmessage title=handler-PeerConnection-onmessage&gt;onmessage&lt;/a&gt;;
            attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onaddstream title=handler-PeerConnection-onaddstream&gt;onaddstream&lt;/a&gt;;
            attribute &lt;a href=#function&gt;Function&lt;/a&gt; &lt;a href=#handler-peerconnection-onremovestream title=handler-PeerConnection-onremovestream&gt;onremovestream&lt;/a&gt;;
@@ -71793,6 +71802,21 @@
    &lt;/dd&gt;
 
 
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; . &lt;code title=dom-PeerConnection-readyState&gt;&lt;a href=#dom-peerconnection-readystate&gt;readyState&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Returns the current readiness state for the connection,
+    represented by a number from the following list:&lt;/p&gt;
+    &lt;dl&gt;&lt;dt&gt; &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; . &lt;code title=dom-PeerConnection-NEW&gt;&lt;a href=#dom-peerconnection-new&gt;NEW&lt;/a&gt;&lt;/code&gt; (0)&lt;/dt&gt;
+     &lt;dd&gt;The object was just created, and no networking has yet occurred.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; . &lt;code title=dom-PeerConnection-NEGOTIATING&gt;&lt;a href=#dom-peerconnection-negotiating&gt;NEGOTIATING&lt;/a&gt;&lt;/code&gt; (1)&lt;/dt&gt;
+     &lt;dd&gt;The user agent is attempting to establish a connection.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; . &lt;code title=dom-PeerConnection-ACTIVE&gt;&lt;a href=#dom-peerconnection-active&gt;ACTIVE&lt;/a&gt;&lt;/code&gt; (2)&lt;/dt&gt;
+     &lt;dd&gt;The connection is as good as its going to get.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; . &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3)&lt;/dt&gt;
+     &lt;dd&gt;The connection is closed.&lt;/dd&gt;
+    &lt;/dl&gt;&lt;/dd&gt;
+
+
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; . &lt;code title=dom-PeerConnection-signalingMessage&gt;&lt;a href=#dom-peerconnection-signalingmessage&gt;signalingMessage&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;)&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -71819,7 +71843,7 @@
     every message will be received.&lt;/p&gt;
 
     &lt;p&gt;When a message sent in this manner from the other peer is
-    received, a &lt;code title=event-PeerConnection-message&gt;message&lt;/code&gt;
+    received, a &lt;code title=event-stream-message&gt;message&lt;/code&gt;
     event is dispatched at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -71832,7 +71856,7 @@
     peer.&lt;/p&gt;
 
     &lt;p&gt;When the other peer starts sending a stream in this manner, an
-    &lt;code title=event-PeerConnection-addstream&gt;addstream&lt;/code&gt;
+    &lt;code title=event-stream-addstream&gt;addstream&lt;/code&gt;
     event is dispatched at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -71844,7 +71868,7 @@
     &lt;p&gt;Steps sending the given stream to the remote peer.&lt;/p&gt;
 
     &lt;p&gt;When the other peer stops sending a stream in this manner, a
-    &lt;code title=event-PeerConnection-removestream&gt;removestream&lt;/code&gt;
+    &lt;code title=event-stream-removestream&gt;removestream&lt;/code&gt;
     event is dispatched at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -71866,7 +71890,7 @@
     &lt;p&gt;Returns a live array containing the streams that the user agent
     is currently receiving from the remote peer.&lt;/p&gt;
 
-    &lt;p&gt;This array is updated when &lt;code title=event-PeerConnection-addstream&gt;addstream&lt;/code&gt; and &lt;code title=event-PeerConnection-removestream&gt;removestream&lt;/code&gt;
+    &lt;p&gt;This array is updated when &lt;code title=event-stream-addstream&gt;addstream&lt;/code&gt; and &lt;code title=event-stream-removestream&gt;removestream&lt;/code&gt;
     events are fired.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -71876,11 +71900,33 @@
   &lt;p&gt;A &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object has an associated
   &lt;dfn id=peerconnection-signaling-callback&gt;&lt;code&gt;PeerConnection&lt;/code&gt; signaling callback&lt;/dfn&gt;, a
   &lt;dfn id=peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/dfn&gt;, a
-  &lt;dfn id=peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/dfn&gt; and an
+  &lt;dfn id=peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/dfn&gt;, a
+  &lt;dfn id=peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/dfn&gt; and an
   &lt;dfn id=ice-started-flag&gt;ICE started flag&lt;/dfn&gt;. These are initialized when the object
   is created.&lt;/p&gt;
 
-  &lt;p&gt;When the &lt;dfn id=dom-peerconnection title=dom-PeerConnection&gt;&lt;code&gt;PeerConnection()&lt;/code&gt;&lt;/dfn&gt;
+  &lt;p&gt;The &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; can
+  have the following values:&lt;/p&gt;
+
+  &lt;dl&gt;&lt;dt&gt;&lt;dfn id=dom-peerconnection-new title=dom-PeerConnection-NEW&gt;&lt;code&gt;NEW&lt;/code&gt;&lt;/dfn&gt; (numeric value 0)&lt;/dt&gt;
+
+   &lt;dd&gt;The object was just created and its ICE Agent has not yet been started.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-peerconnection-negotiating title=dom-PeerConnection-NEGOTIATING&gt;&lt;code&gt;NEGOTIATING&lt;/code&gt;&lt;/dfn&gt; (numeric value 1)&lt;/dt&gt;
+
+   &lt;dd&gt;The ICE Agent is actively preforming ICE processing.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-peerconnection-active title=dom-PeerConnection-ACTIVE&gt;&lt;code&gt;ACTIVE&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)&lt;/dt&gt;
+
+   &lt;dd&gt;The ICE Agent has concluded ICE processing and media is streaming.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn id=dom-peerconnection-closed title=dom-PeerConnection-CLOSED&gt;&lt;code&gt;CLOSED&lt;/code&gt;&lt;/dfn&gt; (numeric value 3)&lt;/dt&gt;
+
+   &lt;dd&gt;Either the &lt;code title=dom-PeerConnection-close&gt;&lt;a href=#dom-peerconnection-close&gt;close()&lt;/a&gt;&lt;/code&gt; method has been
+   invoked, or the other peer removed all the media streams, or the
+   other peer has apparently abruptly stopped sending any media.&lt;/dd&gt;
+
+  &lt;/dl&gt;&lt;p&gt;When the &lt;dfn id=dom-peerconnection title=dom-PeerConnection&gt;&lt;code&gt;PeerConnection()&lt;/code&gt;&lt;/dfn&gt;
   constructor is invoked, the user agent must run the following steps.
   This algorithm has a &lt;a href=#synchronous-section&gt;synchronous section&lt;/a&gt; (which is
   triggered as part of the &lt;a href=#event-loop&gt;event loop&lt;/a&gt; algorithm). Steps
@@ -71982,6 +72028,9 @@
    &lt;a href=#peerconnection-signaling-callback&gt;&lt;code&gt;PeerConnection&lt;/code&gt; signaling callback&lt;/a&gt; be
    &lt;var title=&quot;&quot;&gt;signalingCallback&lt;/var&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-NEW&gt;&lt;a href=#dom-peerconnection-new&gt;NEW&lt;/a&gt;&lt;/code&gt; (0).&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
    flag&lt;/a&gt; to false.&lt;/li&gt;
 
@@ -72008,11 +72057,21 @@
    &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; and send the
    initial offer. The initial offer must include a media description
    for the &lt;a href=#peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media
-   stream&lt;/a&gt; and for all the streams in &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt;. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/li&gt;
+   stream&lt;/a&gt;, marked as &quot;sendrecv&quot;, and for all the streams in
+   &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt;
+   (marked as &quot;sendonly&quot;). &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt; &lt;a href=#refsSDPOFFERANSWER&gt;[SDPOFFERANSWER]&lt;/a&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&#8987; Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE
    started flag&lt;/a&gt; be true.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;&#8987; If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is still
+   &lt;code title=dom-PeerConnection-NEW&gt;&lt;a href=#dom-peerconnection-new&gt;NEW&lt;/a&gt;&lt;/code&gt; (0), then
+   &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; that sets it to &lt;code title=dom-PeerConnection-NEGOTIATING&gt;&lt;a href=#dom-peerconnection-negotiating&gt;NEGOTIATING&lt;/a&gt;&lt;/code&gt; (1) and
+   then &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/a&gt;
+   named &lt;code title=event-stream-connecting&gt;connecting&lt;/code&gt; at the
+   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
   &lt;/ol&gt;&lt;p&gt;When a &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; is
   required to send SDP offers or answers, the user agent must follow
   these steps:&lt;/p&gt;
@@ -72029,7 +72088,12 @@
    &lt;a href=#peerconnection-signaling-callback&gt;&lt;code&gt;PeerConnection&lt;/code&gt; signaling callback&lt;/a&gt; with
    &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; as its argument.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;All SDP media descriptions for streams represented by
+  &lt;/ol&gt;&lt;p&gt;All streams represented by &lt;code&gt;&lt;a href=#stream&gt;Stream&lt;/a&gt;&lt;/code&gt; objects must be
+  marked as &quot;sendonly&quot; by the peer that initially adds the stream to
+  the session. The &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; API does not support
+  bidirectional (&quot;sendrecv&quot;) audio or video media streams. &lt;a href=#refsSDPOFFERANSWER&gt;[SDPOFFERANSWER]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;All SDP media descriptions for streams represented by
   &lt;code&gt;&lt;a href=#stream&gt;Stream&lt;/a&gt;&lt;/code&gt; objects must include a label attribute (&quot;&lt;code title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) whose value is the value of the
   &lt;code&gt;&lt;a href=#stream&gt;Stream&lt;/a&gt;&lt;/code&gt; object's &lt;code title=dom-stream-label&gt;&lt;a href=#dom-stream-label&gt;label&lt;/a&gt;&lt;/code&gt; attribute. &lt;a href=#refsSDP&gt;[SDP]&lt;/a&gt; &lt;a href=#refsSDPLABEL&gt;[SDPLABEL]&lt;/a&gt;&lt;/p&gt;
 
@@ -72086,6 +72150,14 @@
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be the method's
    argument.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; be the
+   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object on which the method was
+   invoked.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;If the first four characters of &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; are
@@ -72103,35 +72175,85 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; be the string consisting of all
    but the first four characters of &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
+   flag&lt;/a&gt; is true, then pass &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; to the
+   &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; as a subsequent
+   offer or answer, to be interpreted as appropriate given the current
+   state of the ICE Agent, and abort these steps. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
-    flag&lt;/a&gt; is still false, start the
+    &lt;p&gt;The &lt;a href=#ice-started-flag&gt;ICE started flag&lt;/a&gt; is false. Start the
     &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; and pass it
     &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; as the initial offer from the other peer;
     the ICE Agent will then (asynchronously) construct the initial
-    answer and transmit it as described above. The initial answer must
-    include a media description for the
-    &lt;a href=#peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/a&gt; and
-    for all the streams in &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt;. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+    answer and transmit it as described above.&lt;/p&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
-    flag&lt;/a&gt; is true, then pass &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; to the
-    &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; as a subsequent
-    offer or answer, to be interpreted as appropriate given the
-    current state of the ICE Agent. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;a href=#remotely-initiated-data-udp-media-stream&gt;remotely-initiated data UDP media
+    stream&lt;/a&gt; in the initial offer, and it has an encryption key
+    advertised in its media description that is 16 bytes long, then
+    that is the &lt;a href=#peerconnection-data-udp-media-stream&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media
+    stream&lt;/a&gt;.&lt;/p&gt;
 
+    &lt;p&gt;After the initial answer has been sent, the ICE Agent must add
+    all the streams in &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt; to the
+    session, as described above. &lt;a href=#refsICE&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#ice-started-flag&gt;ICE started
    flag&lt;/a&gt; be true.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;When the &lt;dfn id=dom-peerconnection-send title=dom-PeerConnection-send&gt;&lt;code title=&quot;&quot;&gt;send()&lt;/code&gt;&lt;/dfn&gt; method is invoked, the
+   &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; that sets &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt;
+   readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-NEGOTIATING&gt;&lt;a href=#dom-peerconnection-negotiating&gt;NEGOTIATING&lt;/a&gt;&lt;/code&gt; (1) and
+   then &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/a&gt;
+   named &lt;code title=event-stream-connecting&gt;connecting&lt;/code&gt; at the
+   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+  &lt;/ol&gt;&lt;p&gt;When a &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt;
+  completes ICE processing with any active media streams, the user
+  agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; that sets the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-ACTIVE&gt;&lt;a href=#dom-peerconnection-active&gt;ACTIVE&lt;/a&gt;&lt;/code&gt; (2) and then &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/a&gt; named &lt;code title=event-stream-open&gt;open&lt;/code&gt; at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;When a &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt;
+  completes ICE processing with no active media streams, the user
+  agent must &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; that sets the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3) and then, if the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; has ever
+  reached the &lt;code title=dom-PeerConnection-ACTIVE&gt;&lt;a href=#dom-peerconnection-active&gt;ACTIVE&lt;/a&gt;&lt;/code&gt;
+  (2) state, &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple
+  event&lt;/a&gt; named &lt;code title=event-stream-close&gt;close&lt;/code&gt; at the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object, or otherwise &lt;a href=#fire-a-simple-event title=&quot;fire a
+  simple event&quot;&gt;fires a simple event&lt;/a&gt; named &lt;code title=event-stream-error&gt;error&lt;/code&gt; at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;When a &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt;
+  restarts ICE processing for any reason (e.g. because a peer is
+  adding or removing a stream), the user agent must &lt;a href=#queue-a-task&gt;queue a
+  task&lt;/a&gt; that sets the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; to &lt;code title=dom-PeerConnection-NEGOTIATING&gt;&lt;a href=#dom-peerconnection-negotiating&gt;NEGOTIATING&lt;/a&gt;&lt;/code&gt; (1) and
+  then &lt;a href=#fire-a-simple-event title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/a&gt;
+  named &lt;code title=event-stream-connecting&gt;connecting&lt;/code&gt; at the
+  &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+                                   
+  &lt;p&gt;The &lt;dfn id=dom-peerconnection-readystate title=dom-PeerConnection-readyState&gt;&lt;code title=&quot;&quot;&gt;readyState&lt;/code&gt;&lt;/dfn&gt; attribute must return the numeric
+  value of the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+  &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;p&gt;When the &lt;dfn id=dom-peerconnection-send title=dom-PeerConnection-send&gt;&lt;code title=&quot;&quot;&gt;send()&lt;/code&gt;&lt;/dfn&gt; method is invoked, the
   user agent must run the following steps:&lt;/p&gt;
 
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be the method's first
    argument.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;
    encoded as UTF-8. &lt;a href=#refsRFC3629&gt;[RFC3629]&lt;/a&gt;&lt;/li&gt;
 
@@ -72156,6 +72278,10 @@
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; be the method's
    argument.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; is null, throw a
    &lt;code&gt;TypeError&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
@@ -72180,6 +72306,10 @@
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; be the method's
    argument.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; is null, throw a
    &lt;code&gt;TypeError&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
@@ -72203,7 +72333,31 @@
   attributes must return the read-only &lt;code&gt;&lt;a href=#stream&gt;Stream&lt;/a&gt;&lt;/code&gt; arrays that
   the attributes were respectively set to when the
   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt;'s constructor ran.&lt;/p&gt;
+  
+  &lt;p&gt;When the &lt;dfn id=dom-peerconnection-close title=dom-PeerConnection-close&gt;&lt;code title=&quot;&quot;&gt;close()&lt;/code&gt;&lt;/dfn&gt; method is invoked, the user agent must
+  run the following steps:&lt;/p&gt;
 
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object's
+   &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/a&gt; is &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3), throw an
+   &lt;code&gt;&lt;a href=#invalid_state_err&gt;INVALID_STATE_ERR&lt;/a&gt;&lt;/code&gt; exception.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Destroy the &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE
+   Agent&lt;/a&gt;, abruptly ending any active ICE processing and any
+   active streaming, and releasing any relevant resources (e.g. TURN
+   permissions).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set the object's &lt;a href=#peerconnection-readiness-state&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness
+   state&lt;/a&gt; to &lt;code title=dom-PeerConnection-CLOSED&gt;&lt;a href=#dom-peerconnection-closed&gt;CLOSED&lt;/a&gt;&lt;/code&gt; (3).&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to &lt;a href=#fire-a-simple-event&gt;fire a simple
+   event&lt;/a&gt; named &lt;code title=event-stream-close&gt;close&lt;/code&gt; at the
+   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;The &lt;code title=dom-PeerConnection-localStreams&gt;&lt;a href=#dom-peerconnection-localstreams&gt;localStreams&lt;/a&gt;&lt;/code&gt; and
+  &lt;code title=dom-PeerConnection-remoteStreams&gt;&lt;a href=#dom-peerconnection-remotestreams&gt;remoteStreams&lt;/a&gt;&lt;/code&gt;
+  objects remain in the state they were in when the object was
+  closed.&lt;/p&gt;
+
   &lt;hr&gt;&lt;p&gt;The following are the &lt;a href=#event-handlers&gt;event handlers&lt;/a&gt; (and their
   corresponding &lt;a href=#event-handler-event-type title=&quot;event handler event type&quot;&gt;event handler
   event types&lt;/a&gt;) that must be supported, as IDL attributes, by
@@ -72211,7 +72365,11 @@
   interface:&lt;/p&gt;
 
   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;Event handler&lt;/a&gt; &lt;th&gt;&lt;a href=#event-handler-event-type&gt;Event handler event type&lt;/a&gt;
-   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onmessage title=handler-PeerConnection-onmessage&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-message&gt;message&lt;/code&gt;
+   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onconnecting title=handler-PeerConnection-onconnecting&gt;&lt;code&gt;onconnecting&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-connecting&gt;connecting&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onopen title=handler-PeerConnection-onopen&gt;&lt;code&gt;onopen&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-open&gt;open&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onerror title=handler-PeerConnection-onerror&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-error&gt;error&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onclose title=handler-PeerConnection-onclose&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-close&gt;close&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onmessage title=handler-PeerConnection-onmessage&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-message&gt;message&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onaddstream title=handler-PeerConnection-onaddstream&gt;&lt;code&gt;onaddstream&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-addstream&gt;addstream&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-peerconnection-onremovestream title=handler-PeerConnection-onremovestream&gt;&lt;code&gt;onremovestream&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-stream-removestream&gt;removestream&lt;/code&gt;
   &lt;/table&gt;&lt;hr&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for the &lt;a href=#concept-task title=concept-task&gt;tasks&lt;/a&gt; listed in this section is the
@@ -72344,21 +72502,10 @@
    &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; has selected a
    destination for the &lt;a href=#data-udp-media-stream&gt;data UDP media stream&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;A &lt;dfn id=remote-data-udp-media-stream&gt;remote data UDP media stream&lt;/dfn&gt; is the first UDP media
-  stream whose sender is the remote peer, whose media is &quot;&lt;code title=&quot;&quot;&gt;application&lt;/code&gt;&quot;, whose transport protocol is &quot;&lt;code title=&quot;&quot;&gt;udp&lt;/code&gt;&quot;, whose media format description is
-  &quot;&lt;code&gt;&lt;a href=#application/html-peer-conection-data&gt;application/html-peer-conection-data&lt;/a&gt;&lt;/code&gt;&quot;, whose label
-  attribute (&quot;&lt;code title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) has the value &quot;&lt;code title=&quot;&quot;&gt;data&lt;/code&gt;&quot;, and for which a
-  &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; has selected a
-  destination, if that media stream has an encryption key advertised
-  in its media description, and if that encryption key is 16 bytes
-  long. A &lt;a href=#remote-data-udp-media-stream&gt;remote data UDP media stream&lt;/a&gt; is associated with
-  the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object for which the
-  &lt;a href=#peerconnection-ice-agent&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/a&gt; in question is
-  operating.&lt;/p&gt;
+  &lt;/ol&gt;&lt;p&gt;When a packet that is part of a &lt;a href=#data-udp-media-stream&gt;data UDP media
+  stream&lt;/a&gt; is received, the user agent must run the following
+  steps:&lt;/p&gt;
 
-  &lt;p&gt;When a packet from a &lt;a href=#remote-data-udp-media-stream&gt;remote data UDP media stream&lt;/a&gt; is
-  received, the user agent must run the following steps:&lt;/p&gt;
-
   &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encrypted message&lt;/var&gt; be the UDP
    packet's data.&lt;/li&gt;
 
@@ -72366,8 +72513,8 @@
    bytes, then abort these steps.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;ice-key&lt;/var&gt; be the 16 bytes given as the
-   encryption key for the &lt;a href=#remote-data-udp-media-stream&gt;remote data UDP media stream&lt;/a&gt; in
-   the media description for this media stream. &lt;a href=#refsSDP&gt;[SDP]&lt;/a&gt;&lt;/li&gt;
+   encryption key for the &lt;a href=#data-udp-media-stream&gt;data UDP media stream&lt;/a&gt; in the
+   media description for this media stream. &lt;a href=#refsSDP&gt;[SDP]&lt;/a&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;masked message with nonce&lt;/var&gt; be the
    result of decrypting &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; using AES-128-CTR
@@ -72399,15 +72546,21 @@
    handling&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Create an event that uses the &lt;code&gt;&lt;a href=#messageevent&gt;MessageEvent&lt;/a&gt;&lt;/code&gt;
-   interface, with the name &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt;,
-   which does not bubble, is not cancelable, has no default action,
-   and has a &lt;code title=dom-MessageEvent-data&gt;&lt;a href=#dom-messageevent-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute
-   whose value is &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, and &lt;a href=#queue-a-task&gt;queue a
-   task&lt;/a&gt; to dispatch the event at the
-   &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object that the &lt;a href=#remote-data-udp-media-stream&gt;remote data UDP
-   media stream&lt;/a&gt; is associated with.&lt;/li&gt;
+   interface, with the name &lt;code title=event-message&gt;&lt;a href=#event-message&gt;message&lt;/a&gt;&lt;/code&gt;, which does not bubble, is not
+   cancelable, has no default action, and has a &lt;code title=dom-MessageEvent-data&gt;&lt;a href=#dom-messageevent-data&gt;data&lt;/a&gt;&lt;/code&gt; attribute whose value is
+   &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, and &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to
+   dispatch the event at the &lt;code&gt;&lt;a href=#peerconnection&gt;PeerConnection&lt;/a&gt;&lt;/code&gt; object
+   responsible for this side of the &lt;a href=#data-udp-media-stream&gt;data UDP media
+   stream&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for this &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; is the &lt;a href=#networking-task-source&gt;networking task
+  &lt;/ol&gt;&lt;p&gt;A &lt;dfn id=remotely-initiated-data-udp-media-stream&gt;remotely-initiated data UDP media stream&lt;/dfn&gt; is the
+  first &quot;sendrecv&quot; media stream in the initial offer whose media is
+  &quot;&lt;code title=&quot;&quot;&gt;application&lt;/code&gt;&quot;, whose transport protocol is
+  &quot;&lt;code title=&quot;&quot;&gt;udp&lt;/code&gt;&quot;, whose media format description is
+  &quot;&lt;code&gt;&lt;a href=#application/html-peer-conection-data&gt;application/html-peer-conection-data&lt;/a&gt;&lt;/code&gt;&quot;, and whose label
+  attribute (&quot;&lt;code title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) has the value &quot;&lt;code title=&quot;&quot;&gt;data&lt;/code&gt;&quot;.&lt;/p&gt;
+
+  &lt;p&gt;The &lt;a href=#task-source&gt;task source&lt;/a&gt; for this &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; is the &lt;a href=#networking-task-source&gt;networking task
   source&lt;/a&gt;.&lt;/p&gt;
 
 

Modified: source
===================================================================
--- source	2011-03-14 22:21:01 UTC (rev 5951)
+++ source	2011-03-16 05:54:48 UTC (rev 5952)
@@ -81805,7 +81805,11 @@
 interface &lt;dfn&gt;PeerConnection&lt;/dfn&gt; {
   void &lt;span title=&quot;dom-PeerConnection-signalingMessage&quot;&gt;signalingMessage&lt;/span&gt;(in DOMString message);
 
-  // &lt;span class=&quot;XXX&quot;&gt;readyState, etc&lt;/span&gt;
+  const unsigned short &lt;span title=&quot;dom-PeerConnection-NEW&quot;&gt;NEW&lt;/span&gt; = 0;
+  const unsigned short &lt;span title=&quot;dom-PeerConnection-NEGOTIATING&quot;&gt;NEGOTIATING&lt;/span&gt; = 1;
+  const unsigned short &lt;span title=&quot;dom-PeerConnection-ACTIVE&quot;&gt;ACTIVE&lt;/span&gt; = 2;
+  const unsigned short &lt;span title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/span&gt; = 3;
+  readonly attribute unsigned short &lt;span title=&quot;dom-PeerConnection-readyState&quot;&gt;readyState&lt;/span&gt;;
 
   void &lt;span title=&quot;dom-PeerConnection-send&quot;&gt;send&lt;/span&gt;(in DOMString text);
   void &lt;span title=&quot;dom-PeerConnection-addStream&quot;&gt;addStream&lt;/span&gt;(in &lt;span&gt;Stream&lt;/span&gt; stream);
@@ -81813,8 +81817,13 @@
   readonly attribute &lt;span&gt;Stream&lt;/span&gt;[] &lt;span title=&quot;dom-PeerConnection-localStreams&quot;&gt;localStreams&lt;/span&gt;;
   readonly attribute &lt;span&gt;Stream&lt;/span&gt;[] &lt;span title=&quot;dom-PeerConnection-remoteStreams&quot;&gt;remoteStreams&lt;/span&gt;;
 
+  void &lt;span title=&quot;dom-PeerConnection-close&quot;&gt;close&lt;/span&gt;();
+
   // &lt;span class=&quot;XXX&quot;&gt;connection quality information&lt;/span&gt;
-
+           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-PeerConnection-onconnecting&quot;&gt;onconnecting&lt;/span&gt;;
+           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-PeerConnection-onopen&quot;&gt;onopen&lt;/span&gt;;
+           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-PeerConnection-onerror&quot;&gt;onerror&lt;/span&gt;;
+           attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-PeerConnection-onclose&quot;&gt;onclose&lt;/span&gt;;
            attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-PeerConnection-onmessage&quot;&gt;onmessage&lt;/span&gt;;
            attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-PeerConnection-onaddstream&quot;&gt;onaddstream&lt;/span&gt;;
            attribute &lt;span&gt;Function&lt;/span&gt; &lt;span title=&quot;handler-PeerConnection-onremovestream&quot;&gt;onremovestream&lt;/span&gt;;
@@ -81895,6 +81904,23 @@
    &lt;/dd&gt;
 
 
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; . &lt;code title=&quot;dom-PeerConnection-readyState&quot;&gt;readyState&lt;/code&gt;&lt;/dt&gt;
+   &lt;dd&gt;
+    &lt;p&gt;Returns the current readiness state for the connection,
+    represented by a number from the following list:&lt;/p&gt;
+    &lt;dl&gt;
+     &lt;dt&gt; &lt;code&gt;PeerConnection&lt;/code&gt; . &lt;code title=&quot;dom-PeerConnection-NEW&quot;&gt;NEW&lt;/code&gt; (0)&lt;/dt&gt;
+     &lt;dd&gt;The object was just created, and no networking has yet occurred.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;PeerConnection&lt;/code&gt; . &lt;code title=&quot;dom-PeerConnection-NEGOTIATING&quot;&gt;NEGOTIATING&lt;/code&gt; (1)&lt;/dt&gt;
+     &lt;dd&gt;The user agent is attempting to establish a connection.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;PeerConnection&lt;/code&gt; . &lt;code title=&quot;dom-PeerConnection-ACTIVE&quot;&gt;ACTIVE&lt;/code&gt; (2)&lt;/dt&gt;
+     &lt;dd&gt;The connection is as good as its going to get.&lt;/dd&gt;
+     &lt;dt&gt; &lt;code&gt;PeerConnection&lt;/code&gt; . &lt;code title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3)&lt;/dt&gt;
+     &lt;dd&gt;The connection is closed.&lt;/dd&gt;
+    &lt;/dl&gt;
+   &lt;/dd&gt;
+
+
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; . &lt;code title=&quot;dom-PeerConnection-signalingMessage&quot;&gt;signalingMessage&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;message&lt;/var&gt;)&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -81922,7 +81948,7 @@
     every message will be received.&lt;/p&gt;
 
     &lt;p&gt;When a message sent in this manner from the other peer is
-    received, a &lt;code title=&quot;event-PeerConnection-message&quot;&gt;message&lt;/code&gt;
+    received, a &lt;code title=&quot;event-stream-message&quot;&gt;message&lt;/code&gt;
     event is dispatched at the &lt;code&gt;PeerConnection&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -81935,7 +81961,7 @@
     peer.&lt;/p&gt;
 
     &lt;p&gt;When the other peer starts sending a stream in this manner, an
-    &lt;code title=&quot;event-PeerConnection-addstream&quot;&gt;addstream&lt;/code&gt;
+    &lt;code title=&quot;event-stream-addstream&quot;&gt;addstream&lt;/code&gt;
     event is dispatched at the &lt;code&gt;PeerConnection&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -81948,7 +81974,7 @@
 
     &lt;p&gt;When the other peer stops sending a stream in this manner, a
     &lt;code
-    title=&quot;event-PeerConnection-removestream&quot;&gt;removestream&lt;/code&gt;
+    title=&quot;event-stream-removestream&quot;&gt;removestream&lt;/code&gt;
     event is dispatched at the &lt;code&gt;PeerConnection&lt;/code&gt; object.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -81972,8 +81998,8 @@
     is currently receiving from the remote peer.&lt;/p&gt;
 
     &lt;p&gt;This array is updated when &lt;code
-    title=&quot;event-PeerConnection-addstream&quot;&gt;addstream&lt;/code&gt; and &lt;code
-    title=&quot;event-PeerConnection-removestream&quot;&gt;removestream&lt;/code&gt;
+    title=&quot;event-stream-addstream&quot;&gt;addstream&lt;/code&gt; and &lt;code
+    title=&quot;event-stream-removestream&quot;&gt;removestream&lt;/code&gt;
     events are fired.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -81985,10 +82011,37 @@
   &lt;p&gt;A &lt;code&gt;PeerConnection&lt;/code&gt; object has an associated
   &lt;dfn&gt;&lt;code&gt;PeerConnection&lt;/code&gt; signaling callback&lt;/dfn&gt;, a
   &lt;dfn&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/dfn&gt;, a
-  &lt;dfn&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/dfn&gt; and an
+  &lt;dfn&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/dfn&gt;, a
+  &lt;dfn&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/dfn&gt; and an
   &lt;dfn&gt;ICE started flag&lt;/dfn&gt;. These are initialized when the object
   is created.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; can
+  have the following values:&lt;/p&gt;
+
+  &lt;dl&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-PeerConnection-NEW&quot;&gt;&lt;code&gt;NEW&lt;/code&gt;&lt;/dfn&gt; (numeric value 0)&lt;/dt&gt;
+
+   &lt;dd&gt;The object was just created and its ICE Agent has not yet been started.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-PeerConnection-NEGOTIATING&quot;&gt;&lt;code&gt;NEGOTIATING&lt;/code&gt;&lt;/dfn&gt; (numeric value 1)&lt;/dt&gt;
+
+   &lt;dd&gt;The ICE Agent is actively preforming ICE processing.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-PeerConnection-ACTIVE&quot;&gt;&lt;code&gt;ACTIVE&lt;/code&gt;&lt;/dfn&gt; (numeric value 2)&lt;/dt&gt;
+
+   &lt;dd&gt;The ICE Agent has concluded ICE processing and media is streaming.&lt;/dd&gt;
+
+   &lt;dt&gt;&lt;dfn title=&quot;dom-PeerConnection-CLOSED&quot;&gt;&lt;code&gt;CLOSED&lt;/code&gt;&lt;/dfn&gt; (numeric value 3)&lt;/dt&gt;
+
+   &lt;dd&gt;Either the &lt;code
+   title=&quot;dom-PeerConnection-close&quot;&gt;close()&lt;/code&gt; method has been
+   invoked, or the other peer removed all the media streams, or the
+   other peer has apparently abruptly stopped sending any media.&lt;/dd&gt;
+
+  &lt;/dl&gt;
+
   &lt;p&gt;When the &lt;dfn
   title=&quot;dom-PeerConnection&quot;&gt;&lt;code&gt;PeerConnection()&lt;/code&gt;&lt;/dfn&gt;
   constructor is invoked, the user agent must run the following steps.
@@ -82109,6 +82162,10 @@
    &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; signaling callback&lt;/span&gt; be
    &lt;var title=&quot;&quot;&gt;signalingCallback&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; to &lt;code
+   title=&quot;dom-PeerConnection-NEW&quot;&gt;NEW&lt;/code&gt; (0).&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;span&gt;ICE started
    flag&lt;/span&gt; to false.&lt;/p&gt;&lt;/li&gt;
 
@@ -82139,13 +82196,23 @@
    &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt; and send the
    initial offer. The initial offer must include a media description
    for the &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media
-   stream&lt;/span&gt; and for all the streams in &lt;code
-   title=&quot;dom-PeerConnection-localStreams&quot;&gt;localStreams&lt;/code&gt;. &lt;a
-   href=&quot;#refsICE&quot;&gt;[ICE]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+   stream&lt;/span&gt;, marked as &quot;sendrecv&quot;, and for all the streams in
+   &lt;code title=&quot;dom-PeerConnection-localStreams&quot;&gt;localStreams&lt;/code&gt;
+   (marked as &quot;sendonly&quot;). &lt;a href=&quot;#refsICE&quot;&gt;[ICE]&lt;/a&gt; &lt;a
+   href=&quot;#refsSDPOFFERANSWER&quot;&gt;[SDPOFFERANSWER]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;&amp;#x231B; Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;span&gt;ICE
    started flag&lt;/span&gt; be true.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;&amp;#x231B; If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; is still
+   &lt;code title=&quot;dom-PeerConnection-NEW&quot;&gt;NEW&lt;/code&gt; (0), then
+   &lt;span&gt;queue a task&lt;/span&gt; that sets it to &lt;code
+   title=&quot;dom-PeerConnection-NEGOTIATING&quot;&gt;NEGOTIATING&lt;/code&gt; (1) and
+   then &lt;span title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/span&gt;
+   named &lt;code title=&quot;event-stream-connecting&quot;&gt;connecting&lt;/code&gt; at the
+   &lt;code&gt;PeerConnection&lt;/code&gt; object.&lt;/p&gt;
+
   &lt;/ol&gt;
 
   &lt;p&gt;When a &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt; is
@@ -82168,6 +82235,12 @@
 
   &lt;/ol&gt;
 
+  &lt;p&gt;All streams represented by &lt;code&gt;Stream&lt;/code&gt; objects must be
+  marked as &quot;sendonly&quot; by the peer that initially adds the stream to
+  the session. The &lt;code&gt;PeerConnection&lt;/code&gt; API does not support
+  bidirectional (&quot;sendrecv&quot;) audio or video media streams. &lt;a
+  href=&quot;#refsSDPOFFERANSWER&quot;&gt;[SDPOFFERANSWER]&lt;/a&gt;&lt;/p&gt;
+
   &lt;p&gt;All SDP media descriptions for streams represented by
   &lt;code&gt;Stream&lt;/code&gt; objects must include a label attribute (&quot;&lt;code
   title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) whose value is the value of the
@@ -82249,6 +82322,15 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be the method's
    argument.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt; be the
+   &lt;code&gt;PeerConnection&lt;/code&gt; object on which the method was
+   invoked.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s
+   &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; is &lt;code
+   title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3), throw an
+   &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;If the first four characters of &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; are
@@ -82267,33 +82349,88 @@
    but the first four characters of &lt;var
    title=&quot;&quot;&gt;message&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;span&gt;ICE started
+   flag&lt;/span&gt; is true, then pass &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; to the
+   &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt; as a subsequent
+   offer or answer, to be interpreted as appropriate given the current
+   state of the ICE Agent, and abort these steps. &lt;a
+   href=&quot;#refsICE&quot;&gt;[ICE]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;span&gt;ICE started
-    flag&lt;/span&gt; is still false, start the
+    &lt;p&gt;The &lt;span&gt;ICE started flag&lt;/span&gt; is false. Start the
     &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt; and pass it
     &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; as the initial offer from the other peer;
     the ICE Agent will then (asynchronously) construct the initial
-    answer and transmit it as described above. The initial answer must
-    include a media description for the
-    &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media stream&lt;/span&gt; and
-    for all the streams in &lt;code
-    title=&quot;dom-PeerConnection-localStreams&quot;&gt;localStreams&lt;/code&gt;. &lt;a
-    href=&quot;#refsICE&quot;&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+    answer and transmit it as described above.&lt;/p&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;span&gt;ICE started
-    flag&lt;/span&gt; is true, then pass &lt;var title=&quot;&quot;&gt;sdp&lt;/var&gt; to the
-    &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt; as a subsequent
-    offer or answer, to be interpreted as appropriate given the
-    current state of the ICE Agent. &lt;a href=&quot;#refsICE&quot;&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;span&gt;remotely-initiated data UDP media
+    stream&lt;/span&gt; in the initial offer, and it has an encryption key
+    advertised in its media description that is 16 bytes long, then
+    that is the &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; data UDP media
+    stream&lt;/span&gt;.&lt;/p&gt;
 
+    &lt;p&gt;After the initial answer has been sent, the ICE Agent must add
+    all the streams in &lt;code
+    title=&quot;dom-PeerConnection-localStreams&quot;&gt;localStreams&lt;/code&gt; to the
+    session, as described above. &lt;a href=&quot;#refsICE&quot;&gt;[ICE]&lt;/a&gt;&lt;/p&gt;
+
    &lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;span&gt;ICE started
    flag&lt;/span&gt; be true.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; that sets &lt;var
+   title=&quot;&quot;&gt;connection&lt;/var&gt;'s &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt;
+   readiness state&lt;/span&gt; to &lt;code
+   title=&quot;dom-PeerConnection-NEGOTIATING&quot;&gt;NEGOTIATING&lt;/code&gt; (1) and
+   then &lt;span title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/span&gt;
+   named &lt;code title=&quot;event-stream-connecting&quot;&gt;connecting&lt;/code&gt; at the
+   &lt;code&gt;PeerConnection&lt;/code&gt; object.&lt;/p&gt;
+
   &lt;/ol&gt;
 
+  &lt;p&gt;When a &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt;
+  completes ICE processing with any active media streams, the user
+  agent must &lt;span&gt;queue a task&lt;/span&gt; that sets the
+  &lt;code&gt;PeerConnection&lt;/code&gt; object's
+  &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; to &lt;code
+  title=&quot;dom-PeerConnection-ACTIVE&quot;&gt;ACTIVE&lt;/code&gt; (2) and then &lt;span
+  title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/span&gt; named &lt;code
+  title=&quot;event-stream-open&quot;&gt;open&lt;/code&gt; at the &lt;code&gt;PeerConnection&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;When a &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt;
+  completes ICE processing with no active media streams, the user
+  agent must &lt;span&gt;queue a task&lt;/span&gt; that sets the
+  &lt;code&gt;PeerConnection&lt;/code&gt; object's
+  &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; to &lt;code
+  title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3) and then, if the
+  &lt;code&gt;PeerConnection&lt;/code&gt; object's
+  &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; has ever
+  reached the &lt;code title=&quot;dom-PeerConnection-ACTIVE&quot;&gt;ACTIVE&lt;/code&gt;
+  (2) state, &lt;span title=&quot;fire a simple event&quot;&gt;fires a simple
+  event&lt;/span&gt; named &lt;code title=&quot;event-stream-close&quot;&gt;close&lt;/code&gt; at the
+  &lt;code&gt;PeerConnection&lt;/code&gt; object, or otherwise &lt;span title=&quot;fire a
+  simple event&quot;&gt;fires a simple event&lt;/span&gt; named &lt;code
+  title=&quot;event-stream-error&quot;&gt;error&lt;/code&gt; at the &lt;code&gt;PeerConnection&lt;/code&gt;
+  object.&lt;/p&gt;
+
+  &lt;p&gt;When a &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt;
+  restarts ICE processing for any reason (e.g. because a peer is
+  adding or removing a stream), the user agent must &lt;span&gt;queue a
+  task&lt;/span&gt; that sets the &lt;code&gt;PeerConnection&lt;/code&gt; object's
+  &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; to &lt;code
+  title=&quot;dom-PeerConnection-NEGOTIATING&quot;&gt;NEGOTIATING&lt;/code&gt; (1) and
+  then &lt;span title=&quot;fire a simple event&quot;&gt;fires a simple event&lt;/span&gt;
+  named &lt;code title=&quot;event-stream-connecting&quot;&gt;connecting&lt;/code&gt; at the
+  &lt;code&gt;PeerConnection&lt;/code&gt; object.&lt;/p&gt;
+                                   
+  &lt;p&gt;The &lt;dfn title=&quot;dom-PeerConnection-readyState&quot;&gt;&lt;code
+  title=&quot;&quot;&gt;readyState&lt;/code&gt;&lt;/dfn&gt; attribute must return the numeric
+  value of the &lt;code&gt;PeerConnection&lt;/code&gt; object's
+  &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt;.&lt;/p&gt;
+
   &lt;p&gt;When the &lt;dfn title=&quot;dom-PeerConnection-send&quot;&gt;&lt;code
   title=&quot;&quot;&gt;send()&lt;/code&gt;&lt;/dfn&gt; method is invoked, the
   user agent must run the following steps:&lt;/p&gt;
@@ -82303,6 +82440,11 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;message&lt;/var&gt; be the method's first
    argument.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;PeerConnection&lt;/code&gt; object's
+   &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; is &lt;code
+   title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3), throw an
+   &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;
    encoded as UTF-8. &lt;a href=&quot;#refsRFC3629&quot;&gt;[RFC3629]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
@@ -82332,6 +82474,11 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; be the method's
    argument.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;PeerConnection&lt;/code&gt; object's
+   &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; is &lt;code
+   title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3), throw an
+   &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; is null, throw a
    &lt;code&gt;TypeError&lt;/code&gt; exception and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
@@ -82364,6 +82511,11 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; be the method's
    argument.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;PeerConnection&lt;/code&gt; object's
+   &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; is &lt;code
+   title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3), throw an
+   &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;stream&lt;/var&gt; is null, throw a
    &lt;code&gt;TypeError&lt;/code&gt; exception and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
@@ -82394,7 +82546,39 @@
   attributes must return the read-only &lt;code&gt;Stream&lt;/code&gt; arrays that
   the attributes were respectively set to when the
   &lt;code&gt;PeerConnection&lt;/code&gt;'s constructor ran.&lt;/p&gt;
+  
+  &lt;p&gt;When the &lt;dfn title=&quot;dom-PeerConnection-close&quot;&gt;&lt;code
+  title=&quot;&quot;&gt;close()&lt;/code&gt;&lt;/dfn&gt; method is invoked, the user agent must
+  run the following steps:&lt;/p&gt;
 
+  &lt;ol&gt;
+
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;PeerConnection&lt;/code&gt; object's
+   &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness state&lt;/span&gt; is &lt;code
+   title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3), throw an
+   &lt;code&gt;INVALID_STATE_ERR&lt;/code&gt; exception.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Destroy the &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE
+   Agent&lt;/span&gt;, abruptly ending any active ICE processing and any
+   active streaming, and releasing any relevant resources (e.g. TURN
+   permissions).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Set the object's &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; readiness
+   state&lt;/span&gt; to &lt;code
+   title=&quot;dom-PeerConnection-CLOSED&quot;&gt;CLOSED&lt;/code&gt; (3).&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to &lt;span&gt;fire a simple
+   event&lt;/span&gt; named &lt;code title=&quot;event-stream-close&quot;&gt;close&lt;/code&gt; at the
+   &lt;code&gt;PeerConnection&lt;/code&gt; object.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p class=&quot;note&quot;&gt;The &lt;code
+  title=&quot;dom-PeerConnection-localStreams&quot;&gt;localStreams&lt;/code&gt; and
+  &lt;code title=&quot;dom-PeerConnection-remoteStreams&quot;&gt;remoteStreams&lt;/code&gt;
+  objects remain in the state they were in when the object was
+  closed.&lt;/p&gt;
+
   &lt;hr&gt;
 
   &lt;p&gt;The following are the &lt;span&gt;event handlers&lt;/span&gt; (and their
@@ -82407,6 +82591,10 @@
    &lt;thead&gt;
     &lt;tr&gt;&lt;th&gt;&lt;span title=&quot;event handlers&quot;&gt;Event handler&lt;/span&gt; &lt;th&gt;&lt;span&gt;Event handler event type&lt;/span&gt;
    &lt;tbody&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-PeerConnection-onconnecting&quot;&gt;&lt;code&gt;onconnecting&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-stream-connecting&quot;&gt;connecting&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-PeerConnection-onopen&quot;&gt;&lt;code&gt;onopen&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-stream-open&quot;&gt;open&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-PeerConnection-onerror&quot;&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-stream-error&quot;&gt;error&lt;/code&gt;
+    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-PeerConnection-onclose&quot;&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-stream-close&quot;&gt;close&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-PeerConnection-onmessage&quot;&gt;&lt;code&gt;onmessage&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-stream-message&quot;&gt;message&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-PeerConnection-onaddstream&quot;&gt;&lt;code&gt;onaddstream&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-stream-addstream&quot;&gt;addstream&lt;/code&gt;
     &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-PeerConnection-onremovestream&quot;&gt;&lt;code&gt;onremovestream&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-stream-removestream&quot;&gt;removestream&lt;/code&gt;
@@ -82557,24 +82745,10 @@
 
   &lt;/ol&gt;
 
-  &lt;p&gt;A &lt;dfn&gt;remote data UDP media stream&lt;/dfn&gt; is the first UDP media
-  stream whose sender is the remote peer, whose media is &quot;&lt;code
-  title=&quot;&quot;&gt;application&lt;/code&gt;&quot;, whose transport protocol is &quot;&lt;code
-  title=&quot;&quot;&gt;udp&lt;/code&gt;&quot;, whose media format description is
-  &quot;&lt;code&gt;application/html-peer-conection-data&lt;/code&gt;&quot;, whose label
-  attribute (&quot;&lt;code title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) has the value &quot;&lt;code
-  title=&quot;&quot;&gt;data&lt;/code&gt;&quot;, and for which a
-  &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt; has selected a
-  destination, if that media stream has an encryption key advertised
-  in its media description, and if that encryption key is 16 bytes
-  long. A &lt;span&gt;remote data UDP media stream&lt;/span&gt; is associated with
-  the &lt;code&gt;PeerConnection&lt;/code&gt; object for which the
-  &lt;span&gt;&lt;code&gt;PeerConnection&lt;/code&gt; ICE Agent&lt;/span&gt; in question is
-  operating.&lt;/p&gt;
+  &lt;p&gt;When a packet that is part of a &lt;span&gt;data UDP media
+  stream&lt;/span&gt; is received, the user agent must run the following
+  steps:&lt;/p&gt;
 
-  &lt;p&gt;When a packet from a &lt;span&gt;remote data UDP media stream&lt;/span&gt; is
-  received, the user agent must run the following steps:&lt;/p&gt;
-
   &lt;ol&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encrypted message&lt;/var&gt; be the UDP
@@ -82584,8 +82758,8 @@
    bytes, then abort these steps.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;ice-key&lt;/var&gt; be the 16 bytes given as the
-   encryption key for the &lt;span&gt;remote data UDP media stream&lt;/span&gt; in
-   the media description for this media stream. &lt;a
+   encryption key for the &lt;span&gt;data UDP media stream&lt;/span&gt; in the
+   media description for this media stream. &lt;a
    href=&quot;#refsSDP&quot;&gt;[SDP]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;masked message with nonce&lt;/var&gt; be the
@@ -82622,16 +82796,25 @@
    handling&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Create an event that uses the &lt;code&gt;MessageEvent&lt;/code&gt;
-   interface, with the name &lt;code title=&quot;event-message&quot;&gt;message&lt;/code&gt;,
-   which does not bubble, is not cancelable, has no default action,
-   and has a &lt;code title=&quot;dom-MessageEvent-data&quot;&gt;data&lt;/code&gt; attribute
-   whose value is &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, and &lt;span&gt;queue a
-   task&lt;/span&gt; to dispatch the event at the
-   &lt;code&gt;PeerConnection&lt;/code&gt; object that the &lt;span&gt;remote data UDP
-   media stream&lt;/span&gt; is associated with.&lt;/p&gt;&lt;/li&gt;
+   interface, with the name &lt;code
+   title=&quot;event-message&quot;&gt;message&lt;/code&gt;, which does not bubble, is not
+   cancelable, has no default action, and has a &lt;code
+   title=&quot;dom-MessageEvent-data&quot;&gt;data&lt;/code&gt; attribute whose value is
+   &lt;var title=&quot;&quot;&gt;message&lt;/var&gt;, and &lt;span&gt;queue a task&lt;/span&gt; to
+   dispatch the event at the &lt;code&gt;PeerConnection&lt;/code&gt; object
+   responsible for this side of the &lt;span&gt;data UDP media
+   stream&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
+  &lt;p&gt;A &lt;dfn&gt;remotely-initiated data UDP media stream&lt;/dfn&gt; is the
+  first &quot;sendrecv&quot; media stream in the initial offer whose media is
+  &quot;&lt;code title=&quot;&quot;&gt;application&lt;/code&gt;&quot;, whose transport protocol is
+  &quot;&lt;code title=&quot;&quot;&gt;udp&lt;/code&gt;&quot;, whose media format description is
+  &quot;&lt;code&gt;application/html-peer-conection-data&lt;/code&gt;&quot;, and whose label
+  attribute (&quot;&lt;code title=&quot;&quot;&gt;a=label:&lt;/code&gt;&quot;) has the value &quot;&lt;code
+  title=&quot;&quot;&gt;data&lt;/code&gt;&quot;.&lt;/p&gt;
+
   &lt;p&gt;The &lt;span&gt;task source&lt;/span&gt; for this &lt;span
   title=&quot;concept-task&quot;&gt;task&lt;/span&gt; is the &lt;span&gt;networking task
   source&lt;/span&gt;.&lt;/p&gt;


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012818.html">[html5] r5951 - [giow] (0) Use 'message' instead of 'text' for the	event name for consistency wi [...]
</A></li>
	<LI>Next message: <A HREF="012820.html">[html5] r5953 - [giow] (0) abarth tells me one layer is sufficient,	security wise.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12819">[ date ]</a>
              <a href="thread.html#12819">[ thread ]</a>
              <a href="subject.html#12819">[ subject ]</a>
              <a href="author.html#12819">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
