<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r7998 - [e] (0) Very risky editorial change! Please review!	This attempts to refactor th [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7998%20-%20%5Be%5D%20%280%29%20Very%20risky%20editorial%20change%21%20Please%20review%21%0A%09This%20attempts%20to%20refactor%20th%20%5B...%5D&In-Reply-To=%3C20130625053759.D56881E7C62E%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014855.html">
   <LINK REL="Next"  HREF="014857.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r7998 - [e] (0) Very risky editorial change! Please review!	This attempts to refactor th [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7998%20-%20%5Be%5D%20%280%29%20Very%20risky%20editorial%20change%21%20Please%20review%21%0A%09This%20attempts%20to%20refactor%20th%20%5B...%5D&In-Reply-To=%3C20130625053759.D56881E7C62E%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r7998 - [e] (0) Very risky editorial change! Please review!	This attempts to refactor th [...]">whatwg at whatwg.org
       </A><BR>
    <I>Mon Jun 24 22:37:59 PDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="014855.html">[html5] r7997 - [giow] (3) Block enumeration of cross-origin	objects, and clean up the language  [...]
</A></li>
        <LI>Next message: <A HREF="014857.html">[html5] r7999 - [giow] (3) Another very risky change! Please	review! This attempts to refactor t [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14856">[ date ]</a>
              <a href="thread.html#14856">[ thread ]</a>
              <a href="subject.html#14856">[ subject ]</a>
              <a href="author.html#14856">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2013-06-24 22:37:58 -0700 (Mon, 24 Jun 2013)
New Revision: 7998

Modified:
   complete.html
   index
   source
Log:
[e] (0) Very risky editorial change! Please review! This attempts to refactor the parser logic so that the foster parenting is actually done inline in a single algorithm that is called by anywhere in the parser that could be affected by it. This will allow us to add the &lt;template&gt; magic with minimal actual magic in the prose, hopefully.
Affected topics: HTML Syntax and Parsing

Modified: complete.html
===================================================================
--- complete.html	2013-06-24 20:28:46 UTC (rev 7997)
+++ complete.html	2013-06-25 05:37:58 UTC (rev 7998)
@@ -256,7 +256,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 24 June 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 25 June 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -1259,9 +1259,9 @@
        &lt;li&gt;&lt;a href=#tokenizing-character-references&gt;&lt;span class=secno&gt;12.2.4.69 &lt;/span&gt;Tokenizing character references&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#tree-construction&gt;&lt;span class=secno&gt;12.2.5 &lt;/span&gt;Tree construction&lt;/a&gt;
       &lt;ol&gt;
-       &lt;li&gt;&lt;a href=#creating-and-inserting-elements&gt;&lt;span class=secno&gt;12.2.5.1 &lt;/span&gt;Creating and inserting elements&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#closing-elements-that-have-implied-end-tags&gt;&lt;span class=secno&gt;12.2.5.2 &lt;/span&gt;Closing elements that have implied end tags&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#foster-parenting&gt;&lt;span class=secno&gt;12.2.5.3 &lt;/span&gt;Foster parenting&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#creating-and-inserting-nodes&gt;&lt;span class=secno&gt;12.2.5.1 &lt;/span&gt;Creating and inserting nodes&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#parsing-elements-that-contain-only-text&gt;&lt;span class=secno&gt;12.2.5.2 &lt;/span&gt;Parsing elements that contain only text&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#closing-elements-that-have-implied-end-tags&gt;&lt;span class=secno&gt;12.2.5.3 &lt;/span&gt;Closing elements that have implied end tags&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#parsing-main-inhtml&gt;&lt;span class=secno&gt;12.2.5.4 &lt;/span&gt;The rules for parsing tokens in HTML content&lt;/a&gt;
         &lt;ol&gt;
          &lt;li&gt;&lt;a href=#the-initial-insertion-mode&gt;&lt;span class=secno&gt;12.2.5.4.1 &lt;/span&gt;The &quot;initial&quot; insertion mode&lt;/a&gt;&lt;/li&gt;
@@ -86333,10 +86333,9 @@
    &lt;li&gt;&lt;a href=#create-an-element-for-the-token&gt;Create an element for the token&lt;/a&gt; for which the
    element &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; was created, to obtain &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;Append &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt; to the &lt;a href=#current-node&gt;current
-   node&lt;/a&gt; and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open
-   elements&lt;/a&gt; so that it is the new &lt;a href=#current-node&gt;current
-   node&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;Insert &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt; &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate
+   place&quot;&gt;in the appropriate place&lt;/a&gt; and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;
+   so that it is the new &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;Replace the entry for &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; in the list
    with an entry for &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt;.&lt;/li&gt;
@@ -88631,48 +88630,7 @@
    &lt;li&gt;A &lt;code title=&quot;&quot;&gt;foreignObject&lt;/code&gt; element in the &lt;a href=#svg-namespace&gt;SVG namespace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;A &lt;code title=&quot;&quot;&gt;desc&lt;/code&gt; element in the &lt;a href=#svg-namespace&gt;SVG namespace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;A &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#svg-namespace&gt;SVG namespace&lt;/a&gt;&lt;/li&gt;
-  &lt;/ul&gt;&lt;hr&gt;&lt;p&gt;When the steps below require the UA to &lt;dfn id=insert-a-character&gt;insert a character&lt;/dfn&gt; into a node, if that node
-  has a child immediately before where the character is to be inserted, and that child is a
-  &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node, then the character must be appended to that &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node;
-  otherwise, a new &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node whose data is just that character must be inserted in the
-  appropriate place.&lt;/p&gt;
-
-  &lt;div class=example&gt;
-
-   &lt;p&gt;Here are some sample inputs to the parser and the corresponding number of &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt;
-   nodes that they result in, assuming a user agent that executes scripts.&lt;/p&gt;
-
-   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Input &lt;th&gt;Number of &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes
-    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;script&nbsp;=&nbsp;document.getElementsByTagName('script')[0];
-document.body.removeChild(script);
-&lt;/script&gt;B&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node in the document, containing &quot;AB&quot;.
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;text&nbsp;=&nbsp;document.createTextNode('B');
-document.body.appendChild(text);
-&lt;/script&gt;C&lt;/pre&gt;
-      &lt;td&gt;Three &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes; &quot;A&quot; before the script, the script's contents, and &quot;BC&quot; after the script (the parser appends to the &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node created by the script).
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;text&nbsp;=&nbsp;document.getElementsByTagName('script')[0].firstChild;
-text.data&nbsp;=&nbsp;'B';
-document.body.appendChild(text);
-&lt;/script&gt;C&lt;/pre&gt;
-      &lt;td&gt;Two adjacent &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes in the document, containing &quot;A&quot; and &quot;BC&quot;.
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;B&lt;tr&gt;C&lt;/tr&gt;D&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;ABCD&quot;. (This is caused by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;.)
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;C&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;A&nbsp;B&nbsp;C&quot; (A-space-B-space-C). (This is caused by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;.)
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;&lt;/em&gt;C&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;A&nbsp;BC&quot; (A-space-B-C), and one &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node inside the table (as a child of a &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;) with a single space character. (Space characters separated from non-space characters by non-character tokens are not affected by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;, even if those other tokens then get ignored.)
-   &lt;/table&gt;&lt;/div&gt;
-
-  &lt;p id=mutation-during-parsing&gt;DOM mutation events must not fire for changes caused by the UA
-  parsing the document. This includes the parsing of any content inserted using &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-writeln&gt;&lt;a href=#dom-document-writeln&gt;document.writeln()&lt;/a&gt;&lt;/code&gt; calls. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;However, mutation observers &lt;em&gt;do&lt;/em&gt; fire, as required by the DOM specification.&lt;/p&gt;
-
-  &lt;p class=note&gt;Not all of the tag names mentioned below are conformant tag names in this
+  &lt;/ul&gt;&lt;p class=note&gt;Not all of the tag names mentioned below are conformant tag names in this
   specification; many are included to handle legacy content. They still form part of the algorithm
   that implementations are required to implement to claim conformance.&lt;/p&gt;
 
@@ -88682,7 +88640,7 @@
   depth constraints.&lt;/p&gt;
 
 
-  &lt;h5 id=creating-and-inserting-elements&gt;&lt;span class=secno&gt;12.2.5.1 &lt;/span&gt;Creating and inserting elements&lt;/h5&gt;
+  &lt;h5 id=creating-and-inserting-nodes&gt;&lt;span class=secno&gt;12.2.5.1 &lt;/span&gt;Creating and inserting nodes&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=create-an-element-for-the-token title=&quot;create an element for the token&quot;&gt;create an
   element for a token&lt;/dfn&gt; in a particular namespace, the UA must create a node implementing the
@@ -88705,23 +88663,27 @@
 
   &lt;hr&gt;&lt;!-- The names of these algorithms are kinda confusing; e.g. see the confusion in
          <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=18367">https://www.w3.org/Bugs/Public/show_bug.cgi?id=18367</A>
-       Not sure what we could call them instead, though... --&gt;&lt;p&gt;When the steps below require the UA to &lt;dfn id=insert-an-html-element&gt;insert an HTML element&lt;/dfn&gt; for a token, the UA
-  must first &lt;a href=#create-an-element-for-the-token&gt;create an element for the token&lt;/a&gt; in the &lt;a href=#html-namespace-0&gt;HTML namespace&lt;/a&gt;, and
-  then append this node to the &lt;a href=#current-node&gt;current node&lt;/a&gt;, and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt; so that it is the new &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+       Not sure what we could call them instead, though... --&gt;&lt;p&gt;When the steps below require the UA to &lt;dfn id=insert-an-html-element&gt;insert an HTML element&lt;/dfn&gt; for a token,
+  optionally in a specific place, the UA must run the following steps:&lt;/p&gt;
 
-  &lt;p&gt;The steps below may also require that the UA insert an HTML element in a particular place, in
-  which case the UA must follow the same steps except that it must insert or append the new node in
-  the location specified instead of appending it to the &lt;a href=#current-node&gt;current node&lt;/a&gt;. (This happens in
-  particular during the parsing of tables with invalid content.)&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#create-an-element-for-the-token&gt;Create an element for the token&lt;/a&gt; in the &lt;a href=#html-namespace-0&gt;HTML namespace&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;p&gt;If an element created by the &lt;a href=#insert-an-html-element&gt;insert an HTML element&lt;/a&gt; algorithm is a
-  &lt;a href=#form-associated-element&gt;form-associated element&lt;/a&gt;, and the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-  pointer&lt;/a&gt; is not null, and the newly created element doesn't have a &lt;code title=attr-fae-form&gt;&lt;a href=#attr-fae-form&gt;form&lt;/a&gt;&lt;/code&gt; attribute, the user agent must &lt;a href=#concept-form-association title=concept-form-association&gt;associate&lt;/a&gt; the newly created element with the
-  &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element pointed to by the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-  pointer&lt;/a&gt; when the element is inserted, instead of running the &lt;a href=#reset-the-form-owner&gt;reset the form
-  owner&lt;/a&gt; algorithm.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;If the element is a &lt;a href=#form-associated-element&gt;form-associated element&lt;/a&gt;, and the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, and the newly created element doesn't
+   have a &lt;code title=attr-fae-form&gt;&lt;a href=#attr-fae-form&gt;form&lt;/a&gt;&lt;/code&gt; attribute, &lt;a href=#concept-form-association title=concept-form-association&gt;associate&lt;/a&gt; the newly created element with the
+   &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element pointed to by the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
+   pointer&lt;/a&gt;, and suppress the running of the &lt;a href=#reset-the-form-owner&gt;reset the form owner&lt;/a&gt; algorithm in
+   the next step.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If no specific place has been specified, &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate
+   place&quot;&gt;insert the node in the appropriate place&lt;/a&gt;; otherwise, if a specific place has been
+   specified, insert or append the node as specified.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Push the element onto the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; so that it is the new
+   &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;A specific place is specified in in particular during the parsing of tables with
+  invalid content.&lt;/p&gt;
+
   &lt;hr&gt;&lt;p&gt;When the steps below require the UA to &lt;dfn id=insert-a-foreign-element&gt;insert a foreign element&lt;/dfn&gt; for a token, the UA
   must first &lt;a href=#create-an-element-for-the-token&gt;create an element for the token&lt;/a&gt; in the given namespace, and then append
   this node to the &lt;a href=#current-node&gt;current node&lt;/a&gt;, and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open
@@ -88732,6 +88694,10 @@
   namespace&lt;/a&gt; whose value is not the &lt;a href=#xlink-namespace&gt;XLink Namespace&lt;/a&gt;, that is a &lt;a href=#parse-error&gt;parse
   error&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p class=note&gt;The &lt;a href=#insert-a-foreign-element&gt;insert a foreign element&lt;/a&gt; algorithm isn't affected by the &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt; logic (it doesn't use the &lt;a href=#insert-a-node-in-the-appropriate-place&gt;insert a node in the
+  appropriate place&lt;/a&gt; algorithm); the &lt;a href=#current-node&gt;current node&lt;/a&gt;, when the &lt;a href=#insert-a-foreign-element&gt;insert a
+  foreign element&lt;/a&gt; algorithm is invoked, is always itself a non-HTML element.&lt;/p&gt;
+
   &lt;p&gt;When the steps below require the user agent to &lt;dfn id=adjust-mathml-attributes&gt;adjust MathML attributes&lt;/dfn&gt; for a token,
   then, if the token has an attribute named &lt;code title=&quot;&quot;&gt;definitionurl&lt;/code&gt;, change its name to
   &lt;code title=&quot;&quot;&gt;definitionURL&lt;/code&gt; (note the case difference).&lt;/p&gt;
@@ -88826,7 +88792,136 @@
     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;xml:space&lt;/code&gt; &lt;td&gt; &lt;code title=&quot;&quot;&gt;xml&lt;/code&gt; &lt;td&gt; &lt;code title=&quot;&quot;&gt;space&lt;/code&gt; &lt;td&gt; &lt;a href=#xml-namespace&gt;XML namespace&lt;/a&gt;
     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;xmlns&lt;/code&gt; &lt;td&gt; (none) &lt;td&gt; &lt;code title=&quot;&quot;&gt;xmlns&lt;/code&gt; &lt;td&gt; &lt;a href=#xmlns-namespace&gt;XMLNS namespace&lt;/a&gt;
     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;xmlns:xlink&lt;/code&gt; &lt;td&gt; &lt;code title=&quot;&quot;&gt;xmlns&lt;/code&gt; &lt;td&gt; &lt;code title=&quot;&quot;&gt;xlink&lt;/code&gt; &lt;td&gt; &lt;a href=#xmlns-namespace&gt;XMLNS namespace&lt;/a&gt;
-  &lt;/table&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=generic-raw-text-element-parsing-algorithm&gt;generic raw text element parsing algorithm&lt;/dfn&gt; and the &lt;dfn id=generic-rcdata-element-parsing-algorithm&gt;generic RCDATA element
+  &lt;/table&gt;&lt;hr&gt;&lt;p&gt;When the steps below require the user agent to &lt;dfn id=insert-a-character&gt;insert a character&lt;/dfn&gt; for a token, the
+  user agent must insert it &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the appropriate
+  place&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;When the user agent is required to &lt;dfn id=insert-a-node-in-the-appropriate-place&gt;insert a node in the appropriate place&lt;/dfn&gt;,
+  optionally using a particular &lt;i&gt;override target&lt;/i&gt;, the user agent must follow the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;If there was an &lt;i&gt;override target&lt;/i&gt; specified, then let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the
+    &lt;i&gt;override target&lt;/i&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Determine the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; using the first matching steps
+    from the following list:&lt;/p&gt;
+
+    &lt;dl class=switch&gt;&lt;dt&gt;If &lt;dfn id=foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/dfn&gt; is enabled and &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tfoot-element&gt;tfoot&lt;/a&gt;&lt;/code&gt;,
+     &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p class=note&gt;Foster parenting happens when content is misnested in tables.&lt;/p&gt;
+
+      &lt;p&gt;The &lt;dfn id=foster-parent-element&gt;foster parent element&lt;/dfn&gt; is the parent element of the last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;
+      element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, if there is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element and
+      it has such a parent element.&lt;/p&gt;
+
+      &lt;p class=note&gt;It might have no parent or some other kind parent if a script manipulated the
+      DOM after the element was inserted by the parser.&lt;/p&gt;
+
+      &lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;
+      (&lt;a href=#fragment-case&gt;fragment case&lt;/a&gt;), then the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the first element in the
+      &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; (the &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; element). Otherwise, if there is a
+      &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, but the last
+      &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has no parent, or its
+      parent node is not an element, then the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the element before the
+      last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the parent element of the last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;
+      element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, then the &lt;var title=&quot;&quot;&gt;adjusted insertion
+      location&lt;/var&gt; is inside the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;, immediately &lt;em&gt;before&lt;/em&gt; the
+      last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;; otherwise, the
+      &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; is inside the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;,
+      after its last child (if any).&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;The &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; is inside &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;,
+      after its last child (if any).&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Run the first matching steps from the following list to actually perform the insertion:&lt;/p&gt;
+
+    &lt;dl class=switch&gt;&lt;dt&gt;If the node being inserted is a character&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If there is a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node immediately before the &lt;var title=&quot;&quot;&gt;adjusted
+      insertion location&lt;/var&gt;, then append the character to that &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, create a new &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node whose data is just that character, and
+      insert it at the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;Insert the node at the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;hr&gt;&lt;div class=example&gt;
+
+   &lt;p&gt;Here are some sample inputs to the parser and the corresponding number of &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt;
+   nodes that they result in, assuming a user agent that executes scripts.&lt;/p&gt;
+
+   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Input &lt;th&gt;Number of &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes
+    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;script&nbsp;=&nbsp;document.getElementsByTagName('script')[0];
+document.body.removeChild(script);
+&lt;/script&gt;B&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node in the document, containing &quot;AB&quot;.
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;text&nbsp;=&nbsp;document.createTextNode('B');
+document.body.appendChild(text);
+&lt;/script&gt;C&lt;/pre&gt;
+      &lt;td&gt;Three &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes; &quot;A&quot; before the script, the script's contents, and &quot;BC&quot; after the script (the parser appends to the &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node created by the script).
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;text&nbsp;=&nbsp;document.getElementsByTagName('script')[0].firstChild;
+text.data&nbsp;=&nbsp;'B';
+document.body.appendChild(text);
+&lt;/script&gt;C&lt;/pre&gt;
+      &lt;td&gt;Two adjacent &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes in the document, containing &quot;A&quot; and &quot;BC&quot;.
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;B&lt;tr&gt;C&lt;/tr&gt;D&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;ABCD&quot;. (This is caused by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;.)
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;C&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;A&nbsp;B&nbsp;C&quot; (A-space-B-space-C). (This is caused by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;.)
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;&lt;/em&gt;C&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;A&nbsp;BC&quot; (A-space-B-C), and one &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node inside the table (as a child of a &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;) with a single space character. (Space characters separated from non-space characters by non-character tokens are not affected by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;, even if those other tokens then get ignored.)
+   &lt;/table&gt;&lt;/div&gt;
+
+  &lt;p id=mutation-during-parsing&gt;DOM mutation events must not fire for changes caused by the UA
+  parsing the document. This includes the parsing of any content inserted using &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-writeln&gt;&lt;a href=#dom-document-writeln&gt;document.writeln()&lt;/a&gt;&lt;/code&gt; calls. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;However, mutation observers &lt;em&gt;do&lt;/em&gt; fire, as required by the DOM specification.&lt;/p&gt;
+
+
+
+  &lt;h5 id=parsing-elements-that-contain-only-text&gt;&lt;span class=secno&gt;12.2.5.2 &lt;/span&gt;Parsing elements that contain only text&lt;/h5&gt;
+
+  &lt;p&gt;The &lt;dfn id=generic-raw-text-element-parsing-algorithm&gt;generic raw text element parsing algorithm&lt;/dfn&gt; and the &lt;dfn id=generic-rcdata-element-parsing-algorithm&gt;generic RCDATA element
   parsing algorithm&lt;/dfn&gt; consist of the following steps. These algorithms are always invoked in
   response to a start tag token.&lt;/p&gt;
 
@@ -88843,7 +88938,7 @@
    &lt;li&gt;&lt;p&gt;Then, switch the &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt; to &quot;&lt;a href=#parsing-main-incdata title=&quot;insertion mode:
    text&quot;&gt;text&lt;/a&gt;&quot;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;h5 id=closing-elements-that-have-implied-end-tags&gt;&lt;span class=secno&gt;12.2.5.2 &lt;/span&gt;Closing elements that have implied end tags&lt;/h5&gt;
+  &lt;/ol&gt;&lt;h5 id=closing-elements-that-have-implied-end-tags&gt;&lt;span class=secno&gt;12.2.5.3 &lt;/span&gt;Closing elements that have implied end tags&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=generate-implied-end-tags&gt;generate implied end
   tags&lt;/dfn&gt;, then, while the &lt;a href=#current-node&gt;current node&lt;/a&gt; is a
@@ -88859,48 +88954,7 @@
   above steps as if that element was not in the above list.&lt;/p&gt;
 
 
-  &lt;h5 id=foster-parenting&gt;&lt;span class=secno&gt;12.2.5.3 &lt;/span&gt;Foster parenting&lt;/h5&gt;
 
-  &lt;p&gt;Foster parenting happens when content is misnested in tables.&lt;/p&gt;
-
-  &lt;p&gt;When a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is to be &lt;dfn id=foster-parent title=&quot;foster
-  parent&quot;&gt;foster parented&lt;/dfn&gt;, the node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;
-  must be inserted into the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
-
-  &lt;p class=note&gt;This typically happens as part of the &lt;a href=#insert-an-html-element&gt;insert an HTML element&lt;/a&gt;
-  algorithm above: when that algorithm would normally insert the newly created node into the
-  &lt;a href=#current-node&gt;current node&lt;/a&gt;, it gets inserted into the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; instead.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=foster-parent-element&gt;foster parent element&lt;/dfn&gt; is the parent element of the
-  last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt;, if there is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element and it has
-  such a parent element.&lt;/p&gt;
-
-  &lt;p class=note&gt;It might have no parent or some other kind parent if
-  a script manipulated the DOM after the element was inserted by the
-  parser.&lt;/p&gt;
-
-  &lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of
-  open elements&lt;/a&gt; (&lt;a href=#fragment-case&gt;fragment case&lt;/a&gt;), then the
-  &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the first element in the &lt;a href=#stack-of-open-elements&gt;stack
-  of open elements&lt;/a&gt; (the &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; element). Otherwise,
-  if there is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt;, but the last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the
-  &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has no parent, or its parent
-  node is not an element, then the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the
-  element before the last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the
-  &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;p&gt;If the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the parent element of the
-  last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt;, then &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; must be inserted into
-  the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;, immediately &lt;em&gt;before&lt;/em&gt; the
-  last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt;; otherwise, &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; must be
-  &lt;em&gt;appended&lt;/em&gt; to the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
-
-
-
   &lt;h5 id=parsing-main-inhtml&gt;&lt;span class=secno&gt;12.2.5.4 &lt;/span&gt;The rules for parsing tokens in HTML content&lt;/h5&gt;
 
 
@@ -89193,9 +89247,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -89253,15 +89307,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -89360,9 +89413,8 @@
      &lt;code&gt;&lt;a href=#the-script-element&gt;script&lt;/a&gt;&lt;/code&gt; element as &lt;a href=#already-started&gt;&quot;already
      started&quot;&lt;/a&gt;. (&lt;a href=#fragment-case&gt;fragment case&lt;/a&gt;)&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Append the new element to the &lt;a href=#current-node&gt;current node&lt;/a&gt;
-     and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open
-     elements&lt;/a&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;Insert the node in the appropriate
+     place&lt;/a&gt;, and then push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Switch the tokenizer to the &lt;a href=#script-data-state&gt;script data
      state&lt;/a&gt;.&lt;/li&gt;
@@ -89474,15 +89526,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -89583,7 +89634,7 @@
     any.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    character&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -89594,7 +89645,7 @@
     any.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    character&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the &lt;a href=#frameset-ok-flag&gt;frameset-ok flag&lt;/a&gt; to &quot;not ok&quot;.&lt;/p&gt;
 
@@ -89602,9 +89653,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -90308,22 +90359,8 @@
 
       &lt;/ol&gt;&lt;/li&gt;
 
-     &lt;li&gt;
+     &lt;li&gt;&lt;p&gt;Insert whatever &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt; ended up being in the previous step &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the appropriate place&lt;/a&gt;, but using &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt; as the &lt;i&gt;override target&lt;/i&gt;.&lt;/li&gt;
 
-      &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt; node is a
-      &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tfoot-element&gt;tfoot&lt;/a&gt;&lt;/code&gt;,
-      &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element, then,
-      &lt;a href=#foster-parent&gt;foster parent&lt;/a&gt; whatever &lt;var title=&quot;&quot;&gt;last
-      node&lt;/var&gt; ended up being in the previous step, first removing
-      it from its previous parent node if any.&lt;/p&gt;
-
-      &lt;p&gt;Otherwise, append whatever &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt;
-      ended up being in the previous step to the &lt;var title=&quot;&quot;&gt;common
-      ancestor&lt;/var&gt; node, first removing it from its previous parent
-      node if any.&lt;/p&gt;
-
-     &lt;/li&gt;
-
      &lt;li&gt;&lt;p&gt;&lt;a href=#create-an-element-for-the-token&gt;Create an element for the token&lt;/a&gt; for which the
      &lt;var title=&quot;&quot;&gt;formatting element&lt;/var&gt; was created.&lt;/li&gt;
 
@@ -90822,7 +90859,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    character&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p class=note&gt;This can never be a U+0000 NULL character; the
     tokenizer converts those to U+FFFD REPLACEMENT CHARACTER
@@ -90979,9 +91016,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -91143,13 +91180,10 @@
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;. Process the token &lt;a href=#using-the-rules-for&gt;using the
-    rules for&lt;/a&gt; the &quot;&lt;a href=#parsing-main-inbody title=&quot;insertion mode: in body&quot;&gt;in
-    body&lt;/a&gt;&quot; &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt;, except that whenever a
-    node would be inserted into the &lt;a href=#current-node&gt;current node&lt;/a&gt; when the
-    &lt;a href=#current-node&gt;current node&lt;/a&gt; is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;,
-    &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tfoot-element&gt;tfoot&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt;, or
-    &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element, then it must instead be &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parented&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;. Enable &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;, process
+    the token &lt;a href=#using-the-rules-for&gt;using the rules for&lt;/a&gt; the &quot;&lt;a href=#parsing-main-inbody title=&quot;insertion mode: in body&quot;&gt;in
+    body&lt;/a&gt;&quot; &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt;, and then disable &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster
+    parenting&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -91206,7 +91240,7 @@
 
     &lt;p&gt;Otherwise, &lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;insert the
     characters&lt;/a&gt; given by the &lt;var&gt;&lt;a href=#pending-table-character-tokens&gt;pending table character
-    tokens&lt;/a&gt;&lt;/var&gt; list into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt; &lt;!--
+    tokens&lt;/a&gt;&lt;/var&gt; list.&lt;/p&gt; &lt;!--
     i.e. inter-element whitespace in the table model isn't foster
     parented --&gt;
 
@@ -91283,15 +91317,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -91644,14 +91677,14 @@
    &lt;dt&gt;Any other character token&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -91878,15 +91911,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -91971,15 +92003,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -92093,7 +92124,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;. &lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert a U+FFFD REPLACEMENT
-    CHARACTER character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    CHARACTER character&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -92101,16 +92132,14 @@
    FORM FEED (FF), U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/a&gt; into the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
    &lt;dt&gt;Any other character token&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/a&gt; into the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the &lt;a href=#frameset-ok-flag&gt;frameset-ok flag&lt;/a&gt; to &quot;not ok&quot;.&lt;/p&gt;
 
@@ -92119,7 +92148,9 @@
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -93268,7 +93299,6 @@
   listed above.&lt;/i&gt;&lt;/p&gt;
 
 
-
   &lt;h2 id=the-xhtml-syntax&gt;&lt;span class=secno&gt;13 &lt;/span&gt;&lt;dfn id=xhtml&gt;The XHTML syntax&lt;/dfn&gt;&lt;/h2&gt;
 
   &lt;p class=note&gt;This section only describes the rules for XML

Modified: index
===================================================================
--- index	2013-06-24 20:28:46 UTC (rev 7997)
+++ index	2013-06-25 05:37:58 UTC (rev 7998)
@@ -256,7 +256,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 24 June 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 25 June 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -1259,9 +1259,9 @@
        &lt;li&gt;&lt;a href=#tokenizing-character-references&gt;&lt;span class=secno&gt;12.2.4.69 &lt;/span&gt;Tokenizing character references&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=#tree-construction&gt;&lt;span class=secno&gt;12.2.5 &lt;/span&gt;Tree construction&lt;/a&gt;
       &lt;ol&gt;
-       &lt;li&gt;&lt;a href=#creating-and-inserting-elements&gt;&lt;span class=secno&gt;12.2.5.1 &lt;/span&gt;Creating and inserting elements&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#closing-elements-that-have-implied-end-tags&gt;&lt;span class=secno&gt;12.2.5.2 &lt;/span&gt;Closing elements that have implied end tags&lt;/a&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;a href=#foster-parenting&gt;&lt;span class=secno&gt;12.2.5.3 &lt;/span&gt;Foster parenting&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#creating-and-inserting-nodes&gt;&lt;span class=secno&gt;12.2.5.1 &lt;/span&gt;Creating and inserting nodes&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#parsing-elements-that-contain-only-text&gt;&lt;span class=secno&gt;12.2.5.2 &lt;/span&gt;Parsing elements that contain only text&lt;/a&gt;&lt;/li&gt;
+       &lt;li&gt;&lt;a href=#closing-elements-that-have-implied-end-tags&gt;&lt;span class=secno&gt;12.2.5.3 &lt;/span&gt;Closing elements that have implied end tags&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=#parsing-main-inhtml&gt;&lt;span class=secno&gt;12.2.5.4 &lt;/span&gt;The rules for parsing tokens in HTML content&lt;/a&gt;
         &lt;ol&gt;
          &lt;li&gt;&lt;a href=#the-initial-insertion-mode&gt;&lt;span class=secno&gt;12.2.5.4.1 &lt;/span&gt;The &quot;initial&quot; insertion mode&lt;/a&gt;&lt;/li&gt;
@@ -86333,10 +86333,9 @@
    &lt;li&gt;&lt;a href=#create-an-element-for-the-token&gt;Create an element for the token&lt;/a&gt; for which the
    element &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; was created, to obtain &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;Append &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt; to the &lt;a href=#current-node&gt;current
-   node&lt;/a&gt; and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open
-   elements&lt;/a&gt; so that it is the new &lt;a href=#current-node&gt;current
-   node&lt;/a&gt;.&lt;/li&gt;
+   &lt;li&gt;Insert &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt; &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate
+   place&quot;&gt;in the appropriate place&lt;/a&gt; and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;
+   so that it is the new &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;Replace the entry for &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; in the list
    with an entry for &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt;.&lt;/li&gt;
@@ -88631,48 +88630,7 @@
    &lt;li&gt;A &lt;code title=&quot;&quot;&gt;foreignObject&lt;/code&gt; element in the &lt;a href=#svg-namespace&gt;SVG namespace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;A &lt;code title=&quot;&quot;&gt;desc&lt;/code&gt; element in the &lt;a href=#svg-namespace&gt;SVG namespace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;A &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;a href=#svg-namespace&gt;SVG namespace&lt;/a&gt;&lt;/li&gt;
-  &lt;/ul&gt;&lt;hr&gt;&lt;p&gt;When the steps below require the UA to &lt;dfn id=insert-a-character&gt;insert a character&lt;/dfn&gt; into a node, if that node
-  has a child immediately before where the character is to be inserted, and that child is a
-  &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node, then the character must be appended to that &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node;
-  otherwise, a new &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node whose data is just that character must be inserted in the
-  appropriate place.&lt;/p&gt;
-
-  &lt;div class=example&gt;
-
-   &lt;p&gt;Here are some sample inputs to the parser and the corresponding number of &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt;
-   nodes that they result in, assuming a user agent that executes scripts.&lt;/p&gt;
-
-   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Input &lt;th&gt;Number of &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes
-    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;script&nbsp;=&nbsp;document.getElementsByTagName('script')[0];
-document.body.removeChild(script);
-&lt;/script&gt;B&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node in the document, containing &quot;AB&quot;.
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;text&nbsp;=&nbsp;document.createTextNode('B');
-document.body.appendChild(text);
-&lt;/script&gt;C&lt;/pre&gt;
-      &lt;td&gt;Three &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes; &quot;A&quot; before the script, the script's contents, and &quot;BC&quot; after the script (the parser appends to the &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node created by the script).
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;text&nbsp;=&nbsp;document.getElementsByTagName('script')[0].firstChild;
-text.data&nbsp;=&nbsp;'B';
-document.body.appendChild(text);
-&lt;/script&gt;C&lt;/pre&gt;
-      &lt;td&gt;Two adjacent &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes in the document, containing &quot;A&quot; and &quot;BC&quot;.
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;B&lt;tr&gt;C&lt;/tr&gt;D&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;ABCD&quot;. (This is caused by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;.)
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;C&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;A&nbsp;B&nbsp;C&quot; (A-space-B-space-C). (This is caused by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;.)
-     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;&lt;/em&gt;C&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;A&nbsp;BC&quot; (A-space-B-C), and one &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node inside the table (as a child of a &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;) with a single space character. (Space characters separated from non-space characters by non-character tokens are not affected by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;, even if those other tokens then get ignored.)
-   &lt;/table&gt;&lt;/div&gt;
-
-  &lt;p id=mutation-during-parsing&gt;DOM mutation events must not fire for changes caused by the UA
-  parsing the document. This includes the parsing of any content inserted using &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-writeln&gt;&lt;a href=#dom-document-writeln&gt;document.writeln()&lt;/a&gt;&lt;/code&gt; calls. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;However, mutation observers &lt;em&gt;do&lt;/em&gt; fire, as required by the DOM specification.&lt;/p&gt;
-
-  &lt;p class=note&gt;Not all of the tag names mentioned below are conformant tag names in this
+  &lt;/ul&gt;&lt;p class=note&gt;Not all of the tag names mentioned below are conformant tag names in this
   specification; many are included to handle legacy content. They still form part of the algorithm
   that implementations are required to implement to claim conformance.&lt;/p&gt;
 
@@ -88682,7 +88640,7 @@
   depth constraints.&lt;/p&gt;
 
 
-  &lt;h5 id=creating-and-inserting-elements&gt;&lt;span class=secno&gt;12.2.5.1 &lt;/span&gt;Creating and inserting elements&lt;/h5&gt;
+  &lt;h5 id=creating-and-inserting-nodes&gt;&lt;span class=secno&gt;12.2.5.1 &lt;/span&gt;Creating and inserting nodes&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=create-an-element-for-the-token title=&quot;create an element for the token&quot;&gt;create an
   element for a token&lt;/dfn&gt; in a particular namespace, the UA must create a node implementing the
@@ -88705,23 +88663,27 @@
 
   &lt;hr&gt;&lt;!-- The names of these algorithms are kinda confusing; e.g. see the confusion in
          <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=18367">https://www.w3.org/Bugs/Public/show_bug.cgi?id=18367</A>
-       Not sure what we could call them instead, though... --&gt;&lt;p&gt;When the steps below require the UA to &lt;dfn id=insert-an-html-element&gt;insert an HTML element&lt;/dfn&gt; for a token, the UA
-  must first &lt;a href=#create-an-element-for-the-token&gt;create an element for the token&lt;/a&gt; in the &lt;a href=#html-namespace-0&gt;HTML namespace&lt;/a&gt;, and
-  then append this node to the &lt;a href=#current-node&gt;current node&lt;/a&gt;, and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt; so that it is the new &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+       Not sure what we could call them instead, though... --&gt;&lt;p&gt;When the steps below require the UA to &lt;dfn id=insert-an-html-element&gt;insert an HTML element&lt;/dfn&gt; for a token,
+  optionally in a specific place, the UA must run the following steps:&lt;/p&gt;
 
-  &lt;p&gt;The steps below may also require that the UA insert an HTML element in a particular place, in
-  which case the UA must follow the same steps except that it must insert or append the new node in
-  the location specified instead of appending it to the &lt;a href=#current-node&gt;current node&lt;/a&gt;. (This happens in
-  particular during the parsing of tables with invalid content.)&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#create-an-element-for-the-token&gt;Create an element for the token&lt;/a&gt; in the &lt;a href=#html-namespace-0&gt;HTML namespace&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;p&gt;If an element created by the &lt;a href=#insert-an-html-element&gt;insert an HTML element&lt;/a&gt; algorithm is a
-  &lt;a href=#form-associated-element&gt;form-associated element&lt;/a&gt;, and the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-  pointer&lt;/a&gt; is not null, and the newly created element doesn't have a &lt;code title=attr-fae-form&gt;&lt;a href=#attr-fae-form&gt;form&lt;/a&gt;&lt;/code&gt; attribute, the user agent must &lt;a href=#concept-form-association title=concept-form-association&gt;associate&lt;/a&gt; the newly created element with the
-  &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element pointed to by the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-  pointer&lt;/a&gt; when the element is inserted, instead of running the &lt;a href=#reset-the-form-owner&gt;reset the form
-  owner&lt;/a&gt; algorithm.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;If the element is a &lt;a href=#form-associated-element&gt;form-associated element&lt;/a&gt;, and the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, and the newly created element doesn't
+   have a &lt;code title=attr-fae-form&gt;&lt;a href=#attr-fae-form&gt;form&lt;/a&gt;&lt;/code&gt; attribute, &lt;a href=#concept-form-association title=concept-form-association&gt;associate&lt;/a&gt; the newly created element with the
+   &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element pointed to by the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
+   pointer&lt;/a&gt;, and suppress the running of the &lt;a href=#reset-the-form-owner&gt;reset the form owner&lt;/a&gt; algorithm in
+   the next step.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If no specific place has been specified, &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate
+   place&quot;&gt;insert the node in the appropriate place&lt;/a&gt;; otherwise, if a specific place has been
+   specified, insert or append the node as specified.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Push the element onto the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; so that it is the new
+   &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;p class=note&gt;A specific place is specified in in particular during the parsing of tables with
+  invalid content.&lt;/p&gt;
+
   &lt;hr&gt;&lt;p&gt;When the steps below require the UA to &lt;dfn id=insert-a-foreign-element&gt;insert a foreign element&lt;/dfn&gt; for a token, the UA
   must first &lt;a href=#create-an-element-for-the-token&gt;create an element for the token&lt;/a&gt; in the given namespace, and then append
   this node to the &lt;a href=#current-node&gt;current node&lt;/a&gt;, and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open
@@ -88732,6 +88694,10 @@
   namespace&lt;/a&gt; whose value is not the &lt;a href=#xlink-namespace&gt;XLink Namespace&lt;/a&gt;, that is a &lt;a href=#parse-error&gt;parse
   error&lt;/a&gt;.&lt;/p&gt;
 
+  &lt;p class=note&gt;The &lt;a href=#insert-a-foreign-element&gt;insert a foreign element&lt;/a&gt; algorithm isn't affected by the &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt; logic (it doesn't use the &lt;a href=#insert-a-node-in-the-appropriate-place&gt;insert a node in the
+  appropriate place&lt;/a&gt; algorithm); the &lt;a href=#current-node&gt;current node&lt;/a&gt;, when the &lt;a href=#insert-a-foreign-element&gt;insert a
+  foreign element&lt;/a&gt; algorithm is invoked, is always itself a non-HTML element.&lt;/p&gt;
+
   &lt;p&gt;When the steps below require the user agent to &lt;dfn id=adjust-mathml-attributes&gt;adjust MathML attributes&lt;/dfn&gt; for a token,
   then, if the token has an attribute named &lt;code title=&quot;&quot;&gt;definitionurl&lt;/code&gt;, change its name to
   &lt;code title=&quot;&quot;&gt;definitionURL&lt;/code&gt; (note the case difference).&lt;/p&gt;
@@ -88826,7 +88792,136 @@
     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;xml:space&lt;/code&gt; &lt;td&gt; &lt;code title=&quot;&quot;&gt;xml&lt;/code&gt; &lt;td&gt; &lt;code title=&quot;&quot;&gt;space&lt;/code&gt; &lt;td&gt; &lt;a href=#xml-namespace&gt;XML namespace&lt;/a&gt;
     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;xmlns&lt;/code&gt; &lt;td&gt; (none) &lt;td&gt; &lt;code title=&quot;&quot;&gt;xmlns&lt;/code&gt; &lt;td&gt; &lt;a href=#xmlns-namespace&gt;XMLNS namespace&lt;/a&gt;
     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;xmlns:xlink&lt;/code&gt; &lt;td&gt; &lt;code title=&quot;&quot;&gt;xmlns&lt;/code&gt; &lt;td&gt; &lt;code title=&quot;&quot;&gt;xlink&lt;/code&gt; &lt;td&gt; &lt;a href=#xmlns-namespace&gt;XMLNS namespace&lt;/a&gt;
-  &lt;/table&gt;&lt;hr&gt;&lt;p&gt;The &lt;dfn id=generic-raw-text-element-parsing-algorithm&gt;generic raw text element parsing algorithm&lt;/dfn&gt; and the &lt;dfn id=generic-rcdata-element-parsing-algorithm&gt;generic RCDATA element
+  &lt;/table&gt;&lt;hr&gt;&lt;p&gt;When the steps below require the user agent to &lt;dfn id=insert-a-character&gt;insert a character&lt;/dfn&gt; for a token, the
+  user agent must insert it &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the appropriate
+  place&lt;/a&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;When the user agent is required to &lt;dfn id=insert-a-node-in-the-appropriate-place&gt;insert a node in the appropriate place&lt;/dfn&gt;,
+  optionally using a particular &lt;i&gt;override target&lt;/i&gt;, the user agent must follow the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;If there was an &lt;i&gt;override target&lt;/i&gt; specified, then let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the
+    &lt;i&gt;override target&lt;/i&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Determine the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; using the first matching steps
+    from the following list:&lt;/p&gt;
+
+    &lt;dl class=switch&gt;&lt;dt&gt;If &lt;dfn id=foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/dfn&gt; is enabled and &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tfoot-element&gt;tfoot&lt;/a&gt;&lt;/code&gt;,
+     &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p class=note&gt;Foster parenting happens when content is misnested in tables.&lt;/p&gt;
+
+      &lt;p&gt;The &lt;dfn id=foster-parent-element&gt;foster parent element&lt;/dfn&gt; is the parent element of the last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;
+      element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, if there is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element and
+      it has such a parent element.&lt;/p&gt;
+
+      &lt;p class=note&gt;It might have no parent or some other kind parent if a script manipulated the
+      DOM after the element was inserted by the parser.&lt;/p&gt;
+
+      &lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;
+      (&lt;a href=#fragment-case&gt;fragment case&lt;/a&gt;), then the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the first element in the
+      &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; (the &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; element). Otherwise, if there is a
+      &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, but the last
+      &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has no parent, or its
+      parent node is not an element, then the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the element before the
+      last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the parent element of the last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;
+      element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, then the &lt;var title=&quot;&quot;&gt;adjusted insertion
+      location&lt;/var&gt; is inside the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;, immediately &lt;em&gt;before&lt;/em&gt; the
+      last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;; otherwise, the
+      &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; is inside the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;,
+      after its last child (if any).&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;The &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; is inside &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;,
+      after its last child (if any).&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Run the first matching steps from the following list to actually perform the insertion:&lt;/p&gt;
+
+    &lt;dl class=switch&gt;&lt;dt&gt;If the node being inserted is a character&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If there is a &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node immediately before the &lt;var title=&quot;&quot;&gt;adjusted
+      insertion location&lt;/var&gt;, then append the character to that &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, create a new &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node whose data is just that character, and
+      insert it at the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;Insert the node at the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;hr&gt;&lt;div class=example&gt;
+
+   &lt;p&gt;Here are some sample inputs to the parser and the corresponding number of &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt;
+   nodes that they result in, assuming a user agent that executes scripts.&lt;/p&gt;
+
+   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Input &lt;th&gt;Number of &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes
+    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;script&nbsp;=&nbsp;document.getElementsByTagName('script')[0];
+document.body.removeChild(script);
+&lt;/script&gt;B&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node in the document, containing &quot;AB&quot;.
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;text&nbsp;=&nbsp;document.createTextNode('B');
+document.body.appendChild(text);
+&lt;/script&gt;C&lt;/pre&gt;
+      &lt;td&gt;Three &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes; &quot;A&quot; before the script, the script's contents, and &quot;BC&quot; after the script (the parser appends to the &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node created by the script).
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;text&nbsp;=&nbsp;document.getElementsByTagName('script')[0].firstChild;
+text.data&nbsp;=&nbsp;'B';
+document.body.appendChild(text);
+&lt;/script&gt;C&lt;/pre&gt;
+      &lt;td&gt;Two adjacent &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; nodes in the document, containing &quot;A&quot; and &quot;BC&quot;.
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;B&lt;tr&gt;C&lt;/tr&gt;D&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;ABCD&quot;. (This is caused by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;.)
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;C&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;A&nbsp;B&nbsp;C&quot; (A-space-B-space-C). (This is caused by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;.)
+     &lt;tr&gt;&lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;&lt;/em&gt;C&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node before the table, containing &quot;A&nbsp;BC&quot; (A-space-B-C), and one &lt;code&gt;&lt;a href=#text&gt;Text&lt;/a&gt;&lt;/code&gt; node inside the table (as a child of a &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;) with a single space character. (Space characters separated from non-space characters by non-character tokens are not affected by &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;, even if those other tokens then get ignored.)
+   &lt;/table&gt;&lt;/div&gt;
+
+  &lt;p id=mutation-during-parsing&gt;DOM mutation events must not fire for changes caused by the UA
+  parsing the document. This includes the parsing of any content inserted using &lt;code title=dom-document-write&gt;&lt;a href=#dom-document-write&gt;document.write()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-writeln&gt;&lt;a href=#dom-document-writeln&gt;document.writeln()&lt;/a&gt;&lt;/code&gt; calls. &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;However, mutation observers &lt;em&gt;do&lt;/em&gt; fire, as required by the DOM specification.&lt;/p&gt;
+
+
+
+  &lt;h5 id=parsing-elements-that-contain-only-text&gt;&lt;span class=secno&gt;12.2.5.2 &lt;/span&gt;Parsing elements that contain only text&lt;/h5&gt;
+
+  &lt;p&gt;The &lt;dfn id=generic-raw-text-element-parsing-algorithm&gt;generic raw text element parsing algorithm&lt;/dfn&gt; and the &lt;dfn id=generic-rcdata-element-parsing-algorithm&gt;generic RCDATA element
   parsing algorithm&lt;/dfn&gt; consist of the following steps. These algorithms are always invoked in
   response to a start tag token.&lt;/p&gt;
 
@@ -88843,7 +88938,7 @@
    &lt;li&gt;&lt;p&gt;Then, switch the &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt; to &quot;&lt;a href=#parsing-main-incdata title=&quot;insertion mode:
    text&quot;&gt;text&lt;/a&gt;&quot;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;h5 id=closing-elements-that-have-implied-end-tags&gt;&lt;span class=secno&gt;12.2.5.2 &lt;/span&gt;Closing elements that have implied end tags&lt;/h5&gt;
+  &lt;/ol&gt;&lt;h5 id=closing-elements-that-have-implied-end-tags&gt;&lt;span class=secno&gt;12.2.5.3 &lt;/span&gt;Closing elements that have implied end tags&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn id=generate-implied-end-tags&gt;generate implied end
   tags&lt;/dfn&gt;, then, while the &lt;a href=#current-node&gt;current node&lt;/a&gt; is a
@@ -88859,48 +88954,7 @@
   above steps as if that element was not in the above list.&lt;/p&gt;
 
 
-  &lt;h5 id=foster-parenting&gt;&lt;span class=secno&gt;12.2.5.3 &lt;/span&gt;Foster parenting&lt;/h5&gt;
 
-  &lt;p&gt;Foster parenting happens when content is misnested in tables.&lt;/p&gt;
-
-  &lt;p&gt;When a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is to be &lt;dfn id=foster-parent title=&quot;foster
-  parent&quot;&gt;foster parented&lt;/dfn&gt;, the node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;
-  must be inserted into the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
-
-  &lt;p class=note&gt;This typically happens as part of the &lt;a href=#insert-an-html-element&gt;insert an HTML element&lt;/a&gt;
-  algorithm above: when that algorithm would normally insert the newly created node into the
-  &lt;a href=#current-node&gt;current node&lt;/a&gt;, it gets inserted into the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; instead.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn id=foster-parent-element&gt;foster parent element&lt;/dfn&gt; is the parent element of the
-  last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt;, if there is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element and it has
-  such a parent element.&lt;/p&gt;
-
-  &lt;p class=note&gt;It might have no parent or some other kind parent if
-  a script manipulated the DOM after the element was inserted by the
-  parser.&lt;/p&gt;
-
-  &lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of
-  open elements&lt;/a&gt; (&lt;a href=#fragment-case&gt;fragment case&lt;/a&gt;), then the
-  &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the first element in the &lt;a href=#stack-of-open-elements&gt;stack
-  of open elements&lt;/a&gt; (the &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; element). Otherwise,
-  if there is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt;, but the last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the
-  &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; has no parent, or its parent
-  node is not an element, then the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the
-  element before the last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the
-  &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;p&gt;If the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt; is the parent element of the
-  last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt;, then &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; must be inserted into
-  the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;, immediately &lt;em&gt;before&lt;/em&gt; the
-  last &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt; element in the &lt;a href=#stack-of-open-elements&gt;stack of open
-  elements&lt;/a&gt;; otherwise, &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; must be
-  &lt;em&gt;appended&lt;/em&gt; to the &lt;i&gt;&lt;a href=#foster-parent-element&gt;foster parent element&lt;/a&gt;&lt;/i&gt;.&lt;/p&gt;
-
-
-
   &lt;h5 id=parsing-main-inhtml&gt;&lt;span class=secno&gt;12.2.5.4 &lt;/span&gt;The rules for parsing tokens in HTML content&lt;/h5&gt;
 
 
@@ -89193,9 +89247,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -89253,15 +89307,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -89360,9 +89413,8 @@
      &lt;code&gt;&lt;a href=#the-script-element&gt;script&lt;/a&gt;&lt;/code&gt; element as &lt;a href=#already-started&gt;&quot;already
      started&quot;&lt;/a&gt;. (&lt;a href=#fragment-case&gt;fragment case&lt;/a&gt;)&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Append the new element to the &lt;a href=#current-node&gt;current node&lt;/a&gt;
-     and push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open
-     elements&lt;/a&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;Insert the node in the appropriate
+     place&lt;/a&gt;, and then push it onto the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Switch the tokenizer to the &lt;a href=#script-data-state&gt;script data
      state&lt;/a&gt;.&lt;/li&gt;
@@ -89474,15 +89526,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -89583,7 +89634,7 @@
     any.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    character&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -89594,7 +89645,7 @@
     any.&lt;/p&gt;
 
     &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    character&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the &lt;a href=#frameset-ok-flag&gt;frameset-ok flag&lt;/a&gt; to &quot;not ok&quot;.&lt;/p&gt;
 
@@ -89602,9 +89653,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -90308,22 +90359,8 @@
 
       &lt;/ol&gt;&lt;/li&gt;
 
-     &lt;li&gt;
+     &lt;li&gt;&lt;p&gt;Insert whatever &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt; ended up being in the previous step &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the appropriate place&lt;/a&gt;, but using &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt; as the &lt;i&gt;override target&lt;/i&gt;.&lt;/li&gt;
 
-      &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt; node is a
-      &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tfoot-element&gt;tfoot&lt;/a&gt;&lt;/code&gt;,
-      &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element, then,
-      &lt;a href=#foster-parent&gt;foster parent&lt;/a&gt; whatever &lt;var title=&quot;&quot;&gt;last
-      node&lt;/var&gt; ended up being in the previous step, first removing
-      it from its previous parent node if any.&lt;/p&gt;
-
-      &lt;p&gt;Otherwise, append whatever &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt;
-      ended up being in the previous step to the &lt;var title=&quot;&quot;&gt;common
-      ancestor&lt;/var&gt; node, first removing it from its previous parent
-      node if any.&lt;/p&gt;
-
-     &lt;/li&gt;
-
      &lt;li&gt;&lt;p&gt;&lt;a href=#create-an-element-for-the-token&gt;Create an element for the token&lt;/a&gt; for which the
      &lt;var title=&quot;&quot;&gt;formatting element&lt;/var&gt; was created.&lt;/li&gt;
 
@@ -90822,7 +90859,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    character&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p class=note&gt;This can never be a U+0000 NULL character; the
     tokenizer converts those to U+FFFD REPLACEMENT CHARACTER
@@ -90979,9 +91016,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -91143,13 +91180,10 @@
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;. Process the token &lt;a href=#using-the-rules-for&gt;using the
-    rules for&lt;/a&gt; the &quot;&lt;a href=#parsing-main-inbody title=&quot;insertion mode: in body&quot;&gt;in
-    body&lt;/a&gt;&quot; &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt;, except that whenever a
-    node would be inserted into the &lt;a href=#current-node&gt;current node&lt;/a&gt; when the
-    &lt;a href=#current-node&gt;current node&lt;/a&gt; is a &lt;code&gt;&lt;a href=#the-table-element&gt;table&lt;/a&gt;&lt;/code&gt;,
-    &lt;code&gt;&lt;a href=#the-tbody-element&gt;tbody&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-tfoot-element&gt;tfoot&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href=#the-thead-element&gt;thead&lt;/a&gt;&lt;/code&gt;, or
-    &lt;code&gt;&lt;a href=#the-tr-element&gt;tr&lt;/a&gt;&lt;/code&gt; element, then it must instead be &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parented&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;. Enable &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster parenting&lt;/a&gt;, process
+    the token &lt;a href=#using-the-rules-for&gt;using the rules for&lt;/a&gt; the &quot;&lt;a href=#parsing-main-inbody title=&quot;insertion mode: in body&quot;&gt;in
+    body&lt;/a&gt;&quot; &lt;a href=#insertion-mode&gt;insertion mode&lt;/a&gt;, and then disable &lt;a href=#foster-parent title=&quot;foster parent&quot;&gt;foster
+    parenting&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -91206,7 +91240,7 @@
 
     &lt;p&gt;Otherwise, &lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;insert the
     characters&lt;/a&gt; given by the &lt;var&gt;&lt;a href=#pending-table-character-tokens&gt;pending table character
-    tokens&lt;/a&gt;&lt;/var&gt; list into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt; &lt;!--
+    tokens&lt;/a&gt;&lt;/var&gt; list.&lt;/p&gt; &lt;!--
     i.e. inter-element whitespace in the table model isn't foster
     parented --&gt;
 
@@ -91283,15 +91317,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -91644,14 +91677,14 @@
    &lt;dt&gt;Any other character token&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -91878,15 +91911,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -91971,15 +92003,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt; into
-    the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the character&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -92093,7 +92124,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;. &lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert a U+FFFD REPLACEMENT
-    CHARACTER character&lt;/a&gt; into the &lt;a href=#current-node&gt;current node&lt;/a&gt;.&lt;/p&gt;
+    CHARACTER character&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -92101,16 +92132,14 @@
    FORM FEED (FF), U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/a&gt; into the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
    &lt;dt&gt;Any other character token&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/a&gt; into the &lt;a href=#current-node&gt;current
-    node&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;a href=#insert-a-character title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/a&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the &lt;a href=#frameset-ok-flag&gt;frameset-ok flag&lt;/a&gt; to &quot;not ok&quot;.&lt;/p&gt;
 
@@ -92119,7 +92148,9 @@
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node to the &lt;a href=#current-node&gt;current node&lt;/a&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;&lt;a href=#comment-0&gt;Comment&lt;/a&gt;&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;a href=#insert-a-node-in-the-appropriate-place title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -93268,7 +93299,6 @@
   listed above.&lt;/i&gt;&lt;/p&gt;
 
 
-
   &lt;h2 id=the-xhtml-syntax&gt;&lt;span class=secno&gt;13 &lt;/span&gt;&lt;dfn id=xhtml&gt;The XHTML syntax&lt;/dfn&gt;&lt;/h2&gt;
 
   &lt;p class=note&gt;This section only describes the rules for XML

Modified: source
===================================================================
--- source	2013-06-24 20:28:46 UTC (rev 7997)
+++ source	2013-06-25 05:37:58 UTC (rev 7998)
@@ -96369,10 +96369,9 @@
    element &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; was created, to obtain &lt;var
    title=&quot;&quot;&gt;new element&lt;/var&gt;.&lt;/li&gt;
 
-   &lt;li&gt;Append &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt; to the &lt;span&gt;current
-   node&lt;/span&gt; and push it onto the &lt;span&gt;stack of open
-   elements&lt;/span&gt; so that it is the new &lt;span&gt;current
-   node&lt;/span&gt;.&lt;/li&gt;
+   &lt;li&gt;Insert &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt; &lt;span title=&quot;insert a node in the appropriate
+   place&quot;&gt;in the appropriate place&lt;/span&gt; and push it onto the &lt;span&gt;stack of open elements&lt;/span&gt;
+   so that it is the new &lt;span&gt;current node&lt;/span&gt;.&lt;/li&gt;
 
    &lt;li&gt;Replace the entry for &lt;var title=&quot;&quot;&gt;entry&lt;/var&gt; in the list
    with an entry for &lt;var title=&quot;&quot;&gt;new element&lt;/var&gt;.&lt;/li&gt;
@@ -99012,64 +99011,6 @@
    &lt;li&gt;A &lt;code title=&quot;&quot;&gt;title&lt;/code&gt; element in the &lt;span&gt;SVG namespace&lt;/span&gt;&lt;/li&gt;
   &lt;/ul&gt;
 
-  &lt;hr&gt;
-
-  &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;insert a character&lt;/dfn&gt; into a node, if that node
-  has a child immediately before where the character is to be inserted, and that child is a
-  &lt;code&gt;Text&lt;/code&gt; node, then the character must be appended to that &lt;code&gt;Text&lt;/code&gt; node;
-  otherwise, a new &lt;code&gt;Text&lt;/code&gt; node whose data is just that character must be inserted in the
-  appropriate place.&lt;/p&gt;
-
-  &lt;div class=&quot;example&quot;&gt;
-
-   &lt;p&gt;Here are some sample inputs to the parser and the corresponding number of &lt;code&gt;Text&lt;/code&gt;
-   nodes that they result in, assuming a user agent that executes scripts.&lt;/p&gt;
-
-   &lt;table&gt;
-    &lt;thead&gt;
-     &lt;tr&gt;
-      &lt;th&gt;Input &lt;th&gt;Number of &lt;code&gt;Text&lt;/code&gt; nodes
-    &lt;tbody&gt;
-     &lt;tr&gt;
-      &lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;script&nbsp;=&nbsp;document.getElementsByTagName('script')[0];
-document.body.removeChild(script);
-&lt;/script&gt;B&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;Text&lt;/code&gt; node in the document, containing &quot;AB&quot;.
-     &lt;tr&gt;
-      &lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;text&nbsp;=&nbsp;document.createTextNode('B');
-document.body.appendChild(text);
-&lt;/script&gt;C&lt;/pre&gt;
-      &lt;td&gt;Three &lt;code&gt;Text&lt;/code&gt; nodes; &quot;A&quot; before the script, the script's contents, and &quot;BC&quot; after the script (the parser appends to the &lt;code&gt;Text&lt;/code&gt; node created by the script).
-     &lt;tr&gt;
-      &lt;td&gt;&lt;pre&gt;A&lt;script&gt;
-var&nbsp;text&nbsp;=&nbsp;document.getElementsByTagName('script')[0].firstChild;
-text.data&nbsp;=&nbsp;'B';
-document.body.appendChild(text);
-&lt;/script&gt;C&lt;/pre&gt;
-      &lt;td&gt;Two adjacent &lt;code&gt;Text&lt;/code&gt; nodes in the document, containing &quot;A&quot; and &quot;BC&quot;.
-     &lt;tr&gt;
-      &lt;td&gt;&lt;pre&gt;A&lt;table&gt;B&lt;tr&gt;C&lt;/tr&gt;D&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;Text&lt;/code&gt; node before the table, containing &quot;ABCD&quot;. (This is caused by &lt;span title=&quot;foster parent&quot;&gt;foster parenting&lt;/span&gt;.)
-     &lt;tr&gt;
-      &lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;C&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;Text&lt;/code&gt; node before the table, containing &quot;A&nbsp;B&nbsp;C&quot; (A-space-B-space-C). (This is caused by &lt;span title=&quot;foster parent&quot;&gt;foster parenting&lt;/span&gt;.)
-     &lt;tr&gt;
-      &lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;&lt;/em&gt;C&lt;/table&gt;&lt;/pre&gt;
-      &lt;td&gt;One &lt;code&gt;Text&lt;/code&gt; node before the table, containing &quot;A&nbsp;BC&quot; (A-space-B-C), and one &lt;code&gt;Text&lt;/code&gt; node inside the table (as a child of a &lt;code&gt;tbody&lt;/code&gt;) with a single space character. (Space characters separated from non-space characters by non-character tokens are not affected by &lt;span title=&quot;foster parent&quot;&gt;foster parenting&lt;/span&gt;, even if those other tokens then get ignored.)
-   &lt;/table&gt;
-
-  &lt;/div&gt;
-
-  &lt;p id=&quot;mutation-during-parsing&quot;&gt;DOM mutation events must not fire for changes caused by the UA
-  parsing the document. This includes the parsing of any content inserted using &lt;code
-  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; and &lt;code
-  title=&quot;dom-document-writeln&quot;&gt;document.writeln()&lt;/code&gt; calls. &lt;a
-  href=&quot;#refsDOMEVENTS&quot;&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;However, mutation observers &lt;em&gt;do&lt;/em&gt; fire, as required by the DOM specification.&lt;/p&gt;
-
   &lt;p class=&quot;note&quot;&gt;Not all of the tag names mentioned below are conformant tag names in this
   specification; many are included to handle legacy content. They still form part of the algorithm
   that implementations are required to implement to claim conformance.&lt;/p&gt;
@@ -99081,7 +99022,7 @@
   depth constraints.&lt;/p&gt;
 
 
-  &lt;h5&gt;Creating and inserting elements&lt;/h5&gt;
+  &lt;h5&gt;Creating and inserting nodes&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn title=&quot;create an element for the token&quot;&gt;create an
   element for a token&lt;/dfn&gt; in a particular namespace, the UA must create a node implementing the
@@ -99108,25 +99049,33 @@
          <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=18367">https://www.w3.org/Bugs/Public/show_bug.cgi?id=18367</A>
        Not sure what we could call them instead, though... --&gt;
 
-  &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;insert an HTML element&lt;/dfn&gt; for a token, the UA
-  must first &lt;span&gt;create an element for the token&lt;/span&gt; in the &lt;span&gt;HTML namespace&lt;/span&gt;, and
-  then append this node to the &lt;span&gt;current node&lt;/span&gt;, and push it onto the &lt;span&gt;stack of open
-  elements&lt;/span&gt; so that it is the new &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+  &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;insert an HTML element&lt;/dfn&gt; for a token,
+  optionally in a specific place, the UA must run the following steps:&lt;/p&gt;
 
-  &lt;p&gt;The steps below may also require that the UA insert an HTML element in a particular place, in
-  which case the UA must follow the same steps except that it must insert or append the new node in
-  the location specified instead of appending it to the &lt;span&gt;current node&lt;/span&gt;. (This happens in
-  particular during the parsing of tables with invalid content.)&lt;/p&gt;
+  &lt;ol&gt;
 
-  &lt;p&gt;If an element created by the &lt;span&gt;insert an HTML element&lt;/span&gt; algorithm is a
-  &lt;span&gt;form-associated element&lt;/span&gt;, and the &lt;span&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-  pointer&lt;/span&gt; is not null, and the newly created element doesn't have a &lt;code
-  title=&quot;attr-fae-form&quot;&gt;form&lt;/code&gt; attribute, the user agent must &lt;span
-  title=&quot;concept-form-association&quot;&gt;associate&lt;/span&gt; the newly created element with the
-  &lt;code&gt;form&lt;/code&gt; element pointed to by the &lt;span&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-  pointer&lt;/span&gt; when the element is inserted, instead of running the &lt;span&gt;reset the form
-  owner&lt;/span&gt; algorithm.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt; in the &lt;span&gt;HTML namespace&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If the element is a &lt;span&gt;form-associated element&lt;/span&gt;, and the &lt;span&gt;&lt;code
+   title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; is not null, and the newly created element doesn't
+   have a &lt;code title=&quot;attr-fae-form&quot;&gt;form&lt;/code&gt; attribute, &lt;span
+   title=&quot;concept-form-association&quot;&gt;associate&lt;/span&gt; the newly created element with the
+   &lt;code&gt;form&lt;/code&gt; element pointed to by the &lt;span&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
+   pointer&lt;/span&gt;, and suppress the running of the &lt;span&gt;reset the form owner&lt;/span&gt; algorithm in
+   the next step.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;If no specific place has been specified, &lt;span title=&quot;insert a node in the appropriate
+   place&quot;&gt;insert the node in the appropriate place&lt;/span&gt;; otherwise, if a specific place has been
+   specified, insert or append the node as specified.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Push the element onto the &lt;span&gt;stack of open elements&lt;/span&gt; so that it is the new
+   &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;p class=&quot;note&quot;&gt;A specific place is specified in in particular during the parsing of tables with
+  invalid content.&lt;/p&gt;
+
   &lt;hr&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;insert a foreign element&lt;/dfn&gt; for a token, the UA
@@ -99139,6 +99088,11 @@
   namespace&lt;/span&gt; whose value is not the &lt;span&gt;XLink Namespace&lt;/span&gt;, that is a &lt;span&gt;parse
   error&lt;/span&gt;.&lt;/p&gt;
 
+  &lt;p class=&quot;note&quot;&gt;The &lt;span&gt;insert a foreign element&lt;/span&gt; algorithm isn't affected by the &lt;span
+  title=&quot;foster parent&quot;&gt;foster parenting&lt;/span&gt; logic (it doesn't use the &lt;span&gt;insert a node in the
+  appropriate place&lt;/span&gt; algorithm); the &lt;span&gt;current node&lt;/span&gt;, when the &lt;span&gt;insert a
+  foreign element&lt;/span&gt; algorithm is invoked, is always itself a non-HTML element.&lt;/p&gt;
+
   &lt;p&gt;When the steps below require the user agent to &lt;dfn&gt;adjust MathML attributes&lt;/dfn&gt; for a token,
   then, if the token has an attribute named &lt;code title=&quot;&quot;&gt;definitionurl&lt;/code&gt;, change its name to
   &lt;code title=&quot;&quot;&gt;definitionURL&lt;/code&gt; (note the case difference).&lt;/p&gt;
@@ -99245,6 +99199,167 @@
 
   &lt;hr&gt;
 
+  &lt;p&gt;When the steps below require the user agent to &lt;dfn&gt;insert a character&lt;/dfn&gt; for a token, the
+  user agent must insert it &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the appropriate
+  place&lt;/span&gt;.&lt;/p&gt;
+
+  &lt;hr&gt;
+
+  &lt;p&gt;When the user agent is required to &lt;dfn&gt;insert a node in the appropriate place&lt;/dfn&gt;,
+  optionally using a particular &lt;i&gt;override target&lt;/i&gt;, the user agent must follow the following
+  steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If there was an &lt;i&gt;override target&lt;/i&gt; specified, then let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the
+    &lt;i&gt;override target&lt;/i&gt;.&lt;/p&gt;
+
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;target&lt;/var&gt; be the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Determine the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; using the first matching steps
+    from the following list:&lt;/p&gt;
+
+    &lt;dl class=&quot;switch&quot;&gt;
+
+     &lt;dt&gt;If &lt;dfn title=&quot;foster parent&quot;&gt;foster parenting&lt;/dfn&gt; is enabled and &lt;var
+     title=&quot;&quot;&gt;target&lt;/var&gt; is a &lt;code&gt;table&lt;/code&gt;, &lt;code&gt;tbody&lt;/code&gt;, &lt;code&gt;tfoot&lt;/code&gt;,
+     &lt;code&gt;thead&lt;/code&gt;, or &lt;code&gt;tr&lt;/code&gt; element&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p class=&quot;note&quot;&gt;Foster parenting happens when content is misnested in tables.&lt;/p&gt;
+
+      &lt;p&gt;The &lt;dfn&gt;foster parent element&lt;/dfn&gt; is the parent element of the last &lt;code&gt;table&lt;/code&gt;
+      element in the &lt;span&gt;stack of open elements&lt;/span&gt;, if there is a &lt;code&gt;table&lt;/code&gt; element and
+      it has such a parent element.&lt;/p&gt;
+
+      &lt;p class=&quot;note&quot;&gt;It might have no parent or some other kind parent if a script manipulated the
+      DOM after the element was inserted by the parser.&lt;/p&gt;
+
+      &lt;p&gt;If there is no &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open elements&lt;/span&gt;
+      (&lt;span&gt;fragment case&lt;/span&gt;), then the &lt;i&gt;foster parent element&lt;/i&gt; is the first element in the
+      &lt;span&gt;stack of open elements&lt;/span&gt; (the &lt;code&gt;html&lt;/code&gt; element). Otherwise, if there is a
+      &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open elements&lt;/span&gt;, but the last
+      &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open elements&lt;/span&gt; has no parent, or its
+      parent node is not an element, then the &lt;i&gt;foster parent element&lt;/i&gt; is the element before the
+      last &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open elements&lt;/span&gt;.&lt;/p&gt;
+
+      &lt;p&gt;If the &lt;i&gt;foster parent element&lt;/i&gt; is the parent element of the last &lt;code&gt;table&lt;/code&gt;
+      element in the &lt;span&gt;stack of open elements&lt;/span&gt;, then the &lt;var title=&quot;&quot;&gt;adjusted insertion
+      location&lt;/var&gt; is inside the &lt;i&gt;foster parent element&lt;/i&gt;, immediately &lt;em&gt;before&lt;/em&gt; the
+      last &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open elements&lt;/span&gt;; otherwise, the
+      &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; is inside the &lt;i&gt;foster parent element&lt;/i&gt;,
+      after its last child (if any).&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;The &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt; is inside &lt;var title=&quot;&quot;&gt;target&lt;/var&gt;,
+      after its last child (if any).&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;Run the first matching steps from the following list to actually perform the insertion:&lt;/p&gt;
+
+    &lt;dl class=&quot;switch&quot;&gt;
+
+     &lt;dt&gt;If the node being inserted is a character&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;If there is a &lt;code&gt;Text&lt;/code&gt; node immediately before the &lt;var title=&quot;&quot;&gt;adjusted
+      insertion location&lt;/var&gt;, then append the character to that &lt;code&gt;Text&lt;/code&gt; node.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, create a new &lt;code&gt;Text&lt;/code&gt; node whose data is just that character, and
+      insert it at the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+     &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+     &lt;dd&gt;
+
+      &lt;p&gt;Insert the node at the &lt;var title=&quot;&quot;&gt;adjusted insertion location&lt;/var&gt;.&lt;/p&gt;
+
+     &lt;/dd&gt;
+
+    &lt;/dl&gt;
+
+   &lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;hr&gt;
+
+  &lt;div class=&quot;example&quot;&gt;
+
+   &lt;p&gt;Here are some sample inputs to the parser and the corresponding number of &lt;code&gt;Text&lt;/code&gt;
+   nodes that they result in, assuming a user agent that executes scripts.&lt;/p&gt;
+
+   &lt;table&gt;
+    &lt;thead&gt;
+     &lt;tr&gt;
+      &lt;th&gt;Input &lt;th&gt;Number of &lt;code&gt;Text&lt;/code&gt; nodes
+    &lt;tbody&gt;
+     &lt;tr&gt;
+      &lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;script&nbsp;=&nbsp;document.getElementsByTagName('script')[0];
+document.body.removeChild(script);
+&lt;/script&gt;B&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;Text&lt;/code&gt; node in the document, containing &quot;AB&quot;.
+     &lt;tr&gt;
+      &lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;text&nbsp;=&nbsp;document.createTextNode('B');
+document.body.appendChild(text);
+&lt;/script&gt;C&lt;/pre&gt;
+      &lt;td&gt;Three &lt;code&gt;Text&lt;/code&gt; nodes; &quot;A&quot; before the script, the script's contents, and &quot;BC&quot; after the script (the parser appends to the &lt;code&gt;Text&lt;/code&gt; node created by the script).
+     &lt;tr&gt;
+      &lt;td&gt;&lt;pre&gt;A&lt;script&gt;
+var&nbsp;text&nbsp;=&nbsp;document.getElementsByTagName('script')[0].firstChild;
+text.data&nbsp;=&nbsp;'B';
+document.body.appendChild(text);
+&lt;/script&gt;C&lt;/pre&gt;
+      &lt;td&gt;Two adjacent &lt;code&gt;Text&lt;/code&gt; nodes in the document, containing &quot;A&quot; and &quot;BC&quot;.
+     &lt;tr&gt;
+      &lt;td&gt;&lt;pre&gt;A&lt;table&gt;B&lt;tr&gt;C&lt;/tr&gt;D&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;Text&lt;/code&gt; node before the table, containing &quot;ABCD&quot;. (This is caused by &lt;span title=&quot;foster parent&quot;&gt;foster parenting&lt;/span&gt;.)
+     &lt;tr&gt;
+      &lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;C&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;Text&lt;/code&gt; node before the table, containing &quot;A&nbsp;B&nbsp;C&quot; (A-space-B-space-C). (This is caused by &lt;span title=&quot;foster parent&quot;&gt;foster parenting&lt;/span&gt;.)
+     &lt;tr&gt;
+      &lt;td&gt;&lt;pre&gt;A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;&lt;/em&gt;C&lt;/table&gt;&lt;/pre&gt;
+      &lt;td&gt;One &lt;code&gt;Text&lt;/code&gt; node before the table, containing &quot;A&nbsp;BC&quot; (A-space-B-C), and one &lt;code&gt;Text&lt;/code&gt; node inside the table (as a child of a &lt;code&gt;tbody&lt;/code&gt;) with a single space character. (Space characters separated from non-space characters by non-character tokens are not affected by &lt;span title=&quot;foster parent&quot;&gt;foster parenting&lt;/span&gt;, even if those other tokens then get ignored.)
+   &lt;/table&gt;
+
+  &lt;/div&gt;
+
+  &lt;p id=&quot;mutation-during-parsing&quot;&gt;DOM mutation events must not fire for changes caused by the UA
+  parsing the document. This includes the parsing of any content inserted using &lt;code
+  title=&quot;dom-document-write&quot;&gt;document.write()&lt;/code&gt; and &lt;code
+  title=&quot;dom-document-writeln&quot;&gt;document.writeln()&lt;/code&gt; calls. &lt;a
+  href=&quot;#refsDOMEVENTS&quot;&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
+
+  &lt;p&gt;However, mutation observers &lt;em&gt;do&lt;/em&gt; fire, as required by the DOM specification.&lt;/p&gt;
+
+
+
+  &lt;h5&gt;Parsing elements that contain only text&lt;/h5&gt;
+
   &lt;p&gt;The &lt;dfn&gt;generic raw text element parsing algorithm&lt;/dfn&gt; and the &lt;dfn&gt;generic RCDATA element
   parsing algorithm&lt;/dfn&gt; consist of the following steps. These algorithms are always invoked in
   response to a start tag token.&lt;/p&gt;
@@ -99267,7 +99382,6 @@
   &lt;/ol&gt;
 
 
-
   &lt;h5&gt;Closing elements that have implied end tags&lt;/h5&gt;
 
   &lt;p&gt;When the steps below require the UA to &lt;dfn&gt;generate implied end
@@ -99284,48 +99398,7 @@
   above steps as if that element was not in the above list.&lt;/p&gt;
 
 
-  &lt;h5&gt;Foster parenting&lt;/h5&gt;
 
-  &lt;p&gt;Foster parenting happens when content is misnested in tables.&lt;/p&gt;
-
-  &lt;p&gt;When a node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is to be &lt;dfn title=&quot;foster
-  parent&quot;&gt;foster parented&lt;/dfn&gt;, the node &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;
-  must be inserted into the &lt;i&gt;foster parent element&lt;/i&gt;.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;This typically happens as part of the &lt;span&gt;insert an HTML element&lt;/span&gt;
-  algorithm above: when that algorithm would normally insert the newly created node into the
-  &lt;span&gt;current node&lt;/span&gt;, it gets inserted into the &lt;i&gt;foster parent element&lt;/i&gt; instead.&lt;/p&gt;
-
-  &lt;p&gt;The &lt;dfn&gt;foster parent element&lt;/dfn&gt; is the parent element of the
-  last &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open
-  elements&lt;/span&gt;, if there is a &lt;code&gt;table&lt;/code&gt; element and it has
-  such a parent element.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;It might have no parent or some other kind parent if
-  a script manipulated the DOM after the element was inserted by the
-  parser.&lt;/p&gt;
-
-  &lt;p&gt;If there is no &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of
-  open elements&lt;/span&gt; (&lt;span&gt;fragment case&lt;/span&gt;), then the
-  &lt;i&gt;foster parent element&lt;/i&gt; is the first element in the &lt;span&gt;stack
-  of open elements&lt;/span&gt; (the &lt;code&gt;html&lt;/code&gt; element). Otherwise,
-  if there is a &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open
-  elements&lt;/span&gt;, but the last &lt;code&gt;table&lt;/code&gt; element in the
-  &lt;span&gt;stack of open elements&lt;/span&gt; has no parent, or its parent
-  node is not an element, then the &lt;i&gt;foster parent element&lt;/i&gt; is the
-  element before the last &lt;code&gt;table&lt;/code&gt; element in the
-  &lt;span&gt;stack of open elements&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;p&gt;If the &lt;i&gt;foster parent element&lt;/i&gt; is the parent element of the
-  last &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open
-  elements&lt;/span&gt;, then &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; must be inserted into
-  the &lt;i&gt;foster parent element&lt;/i&gt;, immediately &lt;em&gt;before&lt;/em&gt; the
-  last &lt;code&gt;table&lt;/code&gt; element in the &lt;span&gt;stack of open
-  elements&lt;/span&gt;; otherwise, &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; must be
-  &lt;em&gt;appended&lt;/em&gt; to the &lt;i&gt;foster parent element&lt;/i&gt;.&lt;/p&gt;
-
-
-
   &lt;h5 id=&quot;parsing-main-inhtml&quot;&gt;The rules for parsing tokens in HTML content&lt;/h5&gt;
 
 
@@ -99656,9 +99729,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -99723,15 +99796,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt; into
-    the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -99837,9 +99909,8 @@
      &lt;code&gt;script&lt;/code&gt; element as &lt;span&gt;&quot;already
      started&quot;&lt;/span&gt;. (&lt;span&gt;fragment case&lt;/span&gt;)&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Append the new element to the &lt;span&gt;current node&lt;/span&gt;
-     and push it onto the &lt;span&gt;stack of open
-     elements&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;insert a node in the appropriate place&quot;&gt;Insert the node in the appropriate
+     place&lt;/span&gt;, and then push it onto the &lt;span&gt;stack of open elements&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Switch the tokenizer to the &lt;span&gt;script data
      state&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -99968,15 +100039,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt; into
-    the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -100088,7 +100158,7 @@
     any.&lt;/p&gt;
 
     &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/span&gt; into the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    character&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -100099,7 +100169,7 @@
     any.&lt;/p&gt;
 
     &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/span&gt; into the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    character&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the &lt;span&gt;frameset-ok flag&lt;/span&gt; to &quot;not ok&quot;.&lt;/p&gt;
 
@@ -100107,9 +100177,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -100876,22 +100946,10 @@
 
      &lt;/li&gt;
 
-     &lt;li&gt;
+     &lt;li&gt;&lt;p&gt;Insert whatever &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt; ended up being in the previous step &lt;span
+     title=&quot;insert a node in the appropriate place&quot;&gt;in the appropriate place&lt;/span&gt;, but using &lt;var
+     title=&quot;&quot;&gt;common ancestor&lt;/var&gt; as the &lt;i&gt;override target&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
 
-      &lt;p&gt;If the &lt;var title=&quot;&quot;&gt;common ancestor&lt;/var&gt; node is a
-      &lt;code&gt;table&lt;/code&gt;, &lt;code&gt;tbody&lt;/code&gt;, &lt;code&gt;tfoot&lt;/code&gt;,
-      &lt;code&gt;thead&lt;/code&gt;, or &lt;code&gt;tr&lt;/code&gt; element, then,
-      &lt;span&gt;foster parent&lt;/span&gt; whatever &lt;var title=&quot;&quot;&gt;last
-      node&lt;/var&gt; ended up being in the previous step, first removing
-      it from its previous parent node if any.&lt;/p&gt;
-
-      &lt;p&gt;Otherwise, append whatever &lt;var title=&quot;&quot;&gt;last node&lt;/var&gt;
-      ended up being in the previous step to the &lt;var title=&quot;&quot;&gt;common
-      ancestor&lt;/var&gt; node, first removing it from its previous parent
-      node if any.&lt;/p&gt;
-
-     &lt;/li&gt;
-
      &lt;li&gt;&lt;p&gt;&lt;span&gt;Create an element for the token&lt;/span&gt; for which the
      &lt;var title=&quot;&quot;&gt;formatting element&lt;/var&gt; was created.&lt;/p&gt;&lt;/li&gt;
 
@@ -101425,7 +101483,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/span&gt; into the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    character&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p class=&quot;note&quot;&gt;This can never be a U+0000 NULL character; the
     tokenizer converts those to U+FFFD REPLACEMENT CHARACTER
@@ -101602,9 +101660,9 @@
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -101772,14 +101830,10 @@
    &lt;dt&gt;Anything else&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Process the token &lt;span&gt;using the
-    rules for&lt;/span&gt; the &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
-    body&lt;/span&gt;&quot; &lt;span&gt;insertion mode&lt;/span&gt;, except that whenever a
-    node would be inserted into the &lt;span&gt;current node&lt;/span&gt; when the
-    &lt;span&gt;current node&lt;/span&gt; is a &lt;code&gt;table&lt;/code&gt;,
-    &lt;code&gt;tbody&lt;/code&gt;, &lt;code&gt;tfoot&lt;/code&gt;, &lt;code&gt;thead&lt;/code&gt;, or
-    &lt;code&gt;tr&lt;/code&gt; element, then it must instead be &lt;span
-    title=&quot;foster parent&quot;&gt;foster parented&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. Enable &lt;span title=&quot;foster parent&quot;&gt;foster parenting&lt;/span&gt;, process
+    the token &lt;span&gt;using the rules for&lt;/span&gt; the &quot;&lt;span title=&quot;insertion mode: in body&quot;&gt;in
+    body&lt;/span&gt;&quot; &lt;span&gt;insertion mode&lt;/span&gt;, and then disable &lt;span title=&quot;foster parent&quot;&gt;foster
+    parenting&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -101841,7 +101895,7 @@
 
     &lt;p&gt;Otherwise, &lt;span title=&quot;insert a character&quot;&gt;insert the
     characters&lt;/span&gt; given by the &lt;var&gt;pending table character
-    tokens&lt;/var&gt; list into the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt; &lt;!--
+    tokens&lt;/var&gt; list.&lt;/p&gt; &lt;!--
     i.e. inter-element whitespace in the table model isn't foster
     parented --&gt;
 
@@ -101931,15 +101985,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt; into
-    the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -102326,14 +102379,14 @@
    &lt;dt&gt;Any other character token&lt;/dt&gt;
    &lt;dd&gt;
     &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's
-    character&lt;/span&gt; into the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    character&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -102584,15 +102637,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt; into
-    the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -102685,15 +102737,14 @@
    TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
    U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt; into
-    the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the character&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current
-    node&lt;/span&gt; with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to
-    the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
    &lt;/dd&gt;
 
    &lt;dt&gt;A DOCTYPE token&lt;/dt&gt;
@@ -102829,7 +102880,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;. &lt;span title=&quot;insert a character&quot;&gt;Insert a U+FFFD REPLACEMENT
-    CHARACTER character&lt;/span&gt; into the &lt;span&gt;current node&lt;/span&gt;.&lt;/p&gt;
+    CHARACTER character&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -102837,16 +102888,14 @@
    FORM FEED (FF), U+000D CARRIAGE RETURN (CR), or U+0020 SPACE&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/span&gt; into the &lt;span&gt;current
-    node&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
    &lt;dt&gt;Any other character token&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/span&gt; into the &lt;span&gt;current
-    node&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;&lt;span title=&quot;insert a character&quot;&gt;Insert the token's character&lt;/span&gt;.&lt;/p&gt;
 
     &lt;p&gt;Set the &lt;span&gt;frameset-ok flag&lt;/span&gt; to &quot;not ok&quot;.&lt;/p&gt;
 
@@ -102855,8 +102904,9 @@
    &lt;dt&gt;A comment token&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node to the &lt;span&gt;current node&lt;/span&gt; with the &lt;code
-    title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the data given in the comment token.&lt;/p&gt;
+    &lt;p&gt;Append a &lt;code&gt;Comment&lt;/code&gt; node with the &lt;code title=&quot;&quot;&gt;data&lt;/code&gt; attribute set to the
+    data given in the comment token &lt;span title=&quot;insert a node in the appropriate place&quot;&gt;in the
+    appropriate place&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -104191,7 +104241,6 @@
   listed above.&lt;/i&gt;&lt;/p&gt;
 
 
-
   &lt;h2&gt;&lt;dfn id=&quot;xhtml&quot;&gt;The XHTML syntax&lt;/dfn&gt;&lt;/h2&gt;
 
   &lt;p class=&quot;note&quot;&gt;This section only describes the rules for XML


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014855.html">[html5] r7997 - [giow] (3) Block enumeration of cross-origin	objects, and clean up the language  [...]
</A></li>
	<LI>Next message: <A HREF="014857.html">[html5] r7999 - [giow] (3) Another very risky change! Please	review! This attempts to refactor t [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14856">[ date ]</a>
              <a href="thread.html#14856">[ thread ]</a>
              <a href="subject.html#14856">[ subject ]</a>
              <a href="author.html#14856">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
