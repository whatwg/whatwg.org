<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r7710 - [e] (0) Integrate with URL standard. Fixing	https://www.w3.org/Bugs/Public/show_ [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7710%20-%20%5Be%5D%20%280%29%20Integrate%20with%20URL%20standard.%20Fixing%0A%09https%3A//www.w3.org/Bugs/Public/show_%20%5B...%5D&In-Reply-To=%3C20130209020731.3B45E1C84063%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014568.html">
   <LINK REL="Next"  HREF="014570.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r7710 - [e] (0) Integrate with URL standard. Fixing	https://www.w3.org/Bugs/Public/show_ [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7710%20-%20%5Be%5D%20%280%29%20Integrate%20with%20URL%20standard.%20Fixing%0A%09https%3A//www.w3.org/Bugs/Public/show_%20%5B...%5D&In-Reply-To=%3C20130209020731.3B45E1C84063%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r7710 - [e] (0) Integrate with URL standard. Fixing	https://www.w3.org/Bugs/Public/show_ [...]">whatwg at whatwg.org
       </A><BR>
    <I>Fri Feb  8 18:07:31 PST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="014568.html">[html5] r7709 - [e] (0) Add some examples of outlines. Fixing	https://www.w3.org/Bugs/Public/sho [...]
</A></li>
        <LI>Next message: <A HREF="014570.html">[html5] r7711 - [e] (0) Cleanup Affected topics: DOM APIs, HTML,	Offline Web Applications, Secur [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14569">[ date ]</a>
              <a href="thread.html#14569">[ thread ]</a>
              <a href="subject.html#14569">[ subject ]</a>
              <a href="author.html#14569">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2013-02-08 18:07:29 -0800 (Fri, 08 Feb 2013)
New Revision: 7710

Modified:
   complete.html
   index
   source
Log:
[e] (0) Integrate with URL standard.
Fixing <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20072">https://www.w3.org/Bugs/Public/show_bug.cgi?id=20072</A>
Affected topics: DOM APIs, HTML, HTML Syntax and Parsing, Offline Web Applications, Security, Video and Audio, Workers

Modified: complete.html
===================================================================
--- complete.html	2013-02-08 07:06:47 UTC (rev 7709)
+++ complete.html	2013-02-09 02:07:29 UTC (rev 7710)
@@ -248,7 +248,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 8 February 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 9 February 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -358,12 +358,8 @@
    &lt;li&gt;&lt;a href=#urls&gt;&lt;span class=secno&gt;2.5 &lt;/span&gt;URLs&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#terminology-0&gt;&lt;span class=secno&gt;2.5.1 &lt;/span&gt;Terminology&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#parsing-urls&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Parsing URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#base-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Base URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#resolving-urls&gt;&lt;span class=secno&gt;2.5.4 &lt;/span&gt;Resolving URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#url-manipulation-and-creation&gt;&lt;span class=secno&gt;2.5.5 &lt;/span&gt;URL manipulation and creation&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.5.6 &lt;/span&gt;Dynamic changes to base URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.5.7 &lt;/span&gt;Interfaces for URL manipulation&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#resolving-urls&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Resolving URLs&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Dynamic changes to base URLs&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#fetching-resources&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Fetching resources&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#terminology-1&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Terminology&lt;/a&gt;&lt;/li&gt;
@@ -2000,7 +1996,7 @@
 
   &lt;pre&gt;var a = &lt;a href=#document title=Document&gt;document&lt;/a&gt;.&lt;a href=#dom-document-links title=dom-document-links&gt;links&lt;/a&gt;[0]; // obtain the first link in the document
 a.&lt;a href=#dom-a-href title=dom-a-href&gt;href&lt;/a&gt; = 'sample.html'; // change the destination URL of the link
-a.&lt;a href=#dom-uda-protocol title=dom-uda-protocol&gt;protocol&lt;/a&gt; = 'https'; // change just the scheme part of the URL
+a.&lt;a href=#dom-url-protocol title=dom-url-protocol&gt;protocol&lt;/a&gt; = 'https'; // change just the scheme part of the URL
 a.setAttribute('href', '<A HREF="http://example.com/">http://example.com/</A>'); // change the content attribute directly&lt;/pre&gt;
 
   &lt;p&gt;Since DOM trees are used as the way to represent HTML documents when they are processed and
@@ -2848,8 +2844,8 @@
   compression format used was not supported, even if the implementation could determine the
   dimensions of the movie from the file's metadata.&lt;/p&gt;
 
-  &lt;p&gt;What some specifications, in particular the HTTP and URI specifications, refer to as a
-  &lt;i&gt;representation&lt;/i&gt; is referred to in this specification as a &lt;dfn title=&quot;&quot;&gt;resource&lt;/dfn&gt;. &lt;a href=#refsHTTP&gt;[HTTP]&lt;/a&gt; &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+  &lt;p&gt;What some specifications, in particular the HTTP specification, refer to as a
+  &lt;i&gt;representation&lt;/i&gt; is referred to in this specification as a &lt;dfn title=&quot;&quot;&gt;resource&lt;/dfn&gt;. &lt;a href=#refsHTTP&gt;[HTTP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The term &lt;dfn id=mime-type&gt;MIME type&lt;/dfn&gt; is used to refer to what is sometimes called an &lt;i&gt;Internet media
   type&lt;/i&gt; in protocol literature. The term &lt;i&gt;media type&lt;/i&gt; in this specification is used to refer
@@ -3408,15 +3404,40 @@
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;URIs, IRIs, IDNA&lt;/dt&gt;
+   &lt;dt&gt;URLs&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Implementations must support the semantics of &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; defined in the
-    URI and IRI specifications, as well as the semantics of IDNA domain names defined in the
-    &lt;cite&gt;Internationalizing Domain Names in Applications (IDNA)&lt;/cite&gt; specification. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt; &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;
+    &lt;p&gt;The following terms are defined in the URL standard: &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;/dd&gt;
+    &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=url&gt;URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=absolute-url&gt;Absolute URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=relative-url&gt;Relative URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=concept-url-scheme-relative title=concept-url-scheme-relative&gt;Relative schemes&lt;/dfn&gt;
+     &lt;li&gt;The &lt;dfn id=url-parser&gt;URL parser&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=parsed-url&gt;Parsed URL&lt;/dfn&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-scheme-data title=&quot;concept-url-scheme data&quot;&gt;scheme data&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-username title=concept-url-username&gt;username&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-password title=concept-url-password&gt;password&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-host title=concept-url-host&gt;host&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-port title=concept-url-port&gt;port&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-path title=concept-url-path&gt;path&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-query title=concept-url-query&gt;query&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;&lt;dfn id=concept-url-parse-error title=concept-url-parse-error&gt;Parse errors&lt;/dfn&gt; from the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=url-serializer&gt;URL serializer&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=default-encode-set&gt;Default encode set&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=percent-encode&gt;Percent encode&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=utf-8-percent-encode&gt;UTF-8 percent encode&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=urlutils&gt;&lt;code&gt;URLUtils&lt;/code&gt;&lt;/dfn&gt; interface
+     &lt;li&gt;&lt;dfn id=urlutilsreadonly&gt;&lt;code&gt;URLUtilsReadOnly&lt;/code&gt;&lt;/dfn&gt; interface
+     &lt;li&gt;&lt;dfn id=dom-url-protocol title=dom-url-protocol&gt;&lt;code&gt;protocol&lt;/code&gt; attribute&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=concept-uu-base title=concept-uu-base&gt;Base&lt;/dfn&gt; for &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt;
+     &lt;li&gt;&lt;dfn id=concept-uu-input title=concept-uu-input&gt;Input&lt;/dfn&gt; for &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt;
+     &lt;li&gt;&lt;dfn id=concept-uu-query-encoding title=concept-uu-query-encoding&gt;Query encoding&lt;/dfn&gt; for &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt;
+     &lt;li&gt;&lt;dfn id=concept-uu-update title=concept-uu-update&gt;Update steps&lt;/dfn&gt; for &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt;
+    &lt;/ul&gt;&lt;/dd&gt;
 
 
    &lt;dt&gt;Cookies&lt;/dt&gt;
@@ -6411,220 +6432,47 @@
 
   &lt;h3 id=urls&gt;&lt;span class=secno&gt;2.5 &lt;/span&gt;URLs&lt;/h3&gt;
 
-  &lt;p&gt;This specification defines the term &lt;a href=#url&gt;URL&lt;/a&gt;, and defines
-  various algorithms for dealing with URLs, because for historical
-  reasons the rules defined by the URI and IRI specifications are not
-  a complete description of what HTML user agents need to implement to
-  be compatible with Web content.&lt;/p&gt;
-
-  &lt;p class=note&gt;The term &quot;URL&quot; in this specification is used in a
-  manner distinct from the precise technical meaning it is given in
-  RFC 3986. Readers familiar with that RFC will find it easier to read
-  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
-  herein is really called something else altogether. This is a
-  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-
   &lt;h4 id=terminology-0&gt;&lt;span class=secno&gt;2.5.1 &lt;/span&gt;Terminology&lt;/h4&gt;
 
-  &lt;p&gt;A &lt;dfn id=url&gt;URL&lt;/dfn&gt; is a string used to identify a resource.&lt;/p&gt;
+  &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is a &lt;dfn id=valid-url&gt;valid URL&lt;/dfn&gt; if it conforms to the authoring conformance
+  requirements in the URL standard. &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is a &lt;dfn id=valid-url&gt;valid URL&lt;/dfn&gt; if at least one of
-  the following conditions holds:&lt;/p&gt;
+  &lt;p&gt;A string is a &lt;dfn id=valid-non-empty-url&gt;valid non-empty URL&lt;/dfn&gt; if it is a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt; but it is not
+  the empty string.&lt;/p&gt;
 
-  &lt;ul&gt;&lt;li&gt;&lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; is a valid URI reference &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;.&lt;/li&gt;
+  &lt;p&gt;A string is a &lt;dfn id=valid-url-potentially-surrounded-by-spaces&gt;valid URL potentially surrounded by spaces&lt;/dfn&gt; if, after &lt;a href=#strip-leading-and-trailing-whitespace title=&quot;strip leading and trailing whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt;
+  from it, it is a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; is a valid IRI reference and it has no
-   query component. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+  &lt;p&gt;A string is a &lt;dfn id=valid-non-empty-url-potentially-surrounded-by-spaces&gt;valid non-empty URL potentially surrounded by spaces&lt;/dfn&gt; if, after &lt;a href=#strip-leading-and-trailing-whitespace title=&quot;strip leading and trailing whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt;
+  from it, it is a &lt;a href=#valid-non-empty-url&gt;valid non-empty URL&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; is a valid IRI reference and its query
-   component contains no unescaped non-ASCII characters. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+  &lt;p&gt;This specification defines the URL &lt;dfn id=about:legacy-compat&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved,
+  though unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URL, for use in &lt;a href=#syntax-doctype title=syntax-doctype&gt;DOCTYPE&lt;/a&gt;s in &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt; when needed for
+  compatibility with XML tools. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; is a valid IRI reference and the &lt;a href=&quot;#document's-character-encoding&quot; title=&quot;document's character encoding&quot;&gt;character encoding&lt;/a&gt; of
-   the URL's &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is UTF-8 or &lt;a href=#a-utf-16-encoding&gt;a UTF-16
-   encoding&lt;/a&gt;. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+  &lt;p&gt;This specification defines the URL &lt;dfn id=about:srcdoc&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URL, that is used as &lt;a href=&quot;#the-document's-address&quot;&gt;the document's
+  address&lt;/a&gt; of &lt;a href=#an-iframe-srcdoc-document title=&quot;an iframe srcdoc document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; documents&lt;/a&gt;. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;/ul&gt;&lt;p&gt;A string is a &lt;dfn id=valid-non-empty-url&gt;valid non-empty URL&lt;/dfn&gt; if it is a
-  &lt;a href=#valid-url&gt;valid URL&lt;/a&gt; but it is not the empty string.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=fallback-base-url&gt;fallback base URL&lt;/dfn&gt; of a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is the &lt;a href=#absolute-url&gt;absolute
+  URL&lt;/a&gt; obtained by running these substeps:&lt;/p&gt;
 
-  &lt;p&gt;A string is a &lt;dfn id=valid-url-potentially-surrounded-by-spaces&gt;valid URL potentially surrounded by
-  spaces&lt;/dfn&gt; if, after &lt;a href=#strip-leading-and-trailing-whitespace title=&quot;strip leading and trailing
-  whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt; from
-  it, it is a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;.&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is &lt;a href=#an-iframe-srcdoc-document&gt;an &lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; document&lt;/a&gt;, then return the &lt;a href=#document-base-url&gt;document base
+   URL&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;a href=#browsing-context-container&gt;browsing context
+   container&lt;/a&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; and abort these steps.&lt;/li&gt;
 
-  &lt;p&gt;A string is a &lt;dfn id=valid-non-empty-url-potentially-surrounded-by-spaces&gt;valid non-empty URL potentially surrounded by
-  spaces&lt;/dfn&gt; if, after &lt;a href=#strip-leading-and-trailing-whitespace title=&quot;strip leading and trailing
-  whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt; from
-  it, it is a &lt;a href=#valid-non-empty-url&gt;valid non-empty URL&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn id=about:legacy-compat&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;a href=#syntax-doctype title=syntax-doctype&gt;DOCTYPE&lt;/a&gt;s in &lt;a href=#html-documents&gt;HTML
-  documents&lt;/a&gt; when needed for compatibility with XML tools. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn id=about:srcdoc&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
-  &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; of &lt;a href=#an-iframe-srcdoc-document title=&quot;an iframe srcdoc
-  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; documents&lt;/a&gt;. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
-
-
-  &lt;div class=impl&gt;
-
-  &lt;h4 id=parsing-urls&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Parsing URLs&lt;/h4&gt;
-
-  &lt;p&gt;To &lt;dfn id=parse-a-url&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
-  component parts, the user agent must use the following steps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#strip-leading-and-trailing-whitespace&gt;Strip leading and trailing whitespace&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
    &lt;li&gt;
 
-    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC
-    3986, with the following exceptions:&lt;/p&gt;
-
-    &lt;ul&gt;&lt;li&gt;Add all characters with code points less than or equal to
-     U+0020 or greater than or equal to U+007F to the
-     &lt;unreserved&gt; production.&lt;/li&gt;
-
-     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E,
-     U+0060, and U+007B .. U+007D to the &lt;unreserved&gt;
-     production.
-      &lt;!--
-       0022 QUOTATION MARK
-       003C LESS-THAN SIGN
-       003E GREATER-THAN SIGN
-       005B LEFT SQUARE BRACKET
-       005C REVERSE SOLIDUS
-       005D RIGHT SQUARE BRACKET
-       005E CIRCUMFLEX ACCENT
-       0060 GRAVE ACCENT
-       007B LEFT CURLY BRACKET
-       007C VERTICAL LINE
-       007D RIGHT CURLY BRACKET
-      --&gt;
-     &lt;/li&gt;
-
-     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second
-     alternative way of matching the &lt;pct-encoded&gt; production,
-     except when the &lt;pct-encoded&gt; is used in the
-     &lt;reg-name&gt; production.&lt;/li&gt;
-
-     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters
-     allowed in the &lt;fragment&gt; production.&lt;/li&gt;
-
-     &lt;!-- some browsers also have other differences, e.g. Mozilla
-     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
-     is &quot;ftp&quot;. --&gt;
-
-    &lt;/ul&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the
-    &lt;URI-reference&gt; production, even after the above changes are
-    made to the ABNF definitions, then parsing the URL fails with an
-    error. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
-    components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
-    defined as follows:&lt;/p&gt;
-
-    &lt;dl&gt;&lt;dt&gt;&lt;dfn id=url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-host title=url-host&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;host&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-port title=url-port&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;port&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-hostport title=url-hostport&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt;
-     component and the port given by the &lt;port&gt; component is
-     different than the default port defined for the protocol given by
-     the &lt;scheme&gt; component, then &lt;hostport&gt; is the
-     substring that starts with the substring matched by the
-     &lt;host&gt; production and ends with the substring matched by the
-     &lt;port&gt; production, and includes the colon in between the
-     two. Otherwise, it is the same as the &lt;host&gt; component.&lt;/p&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-path title=url-path&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;The substring matched by one of the following productions, if
-      one of them was matched:&lt;/p&gt;
-
-      &lt;ul class=brief&gt;&lt;li&gt;&lt;path-abempty&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-absolute&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-noscheme&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-rootless&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-empty&gt;&lt;/li&gt;
-      &lt;/ul&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-query title=url-query&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;query&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-host-specific title=url-host-specific&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring that &lt;em&gt;follows&lt;/em&gt; the substring matched
-     by the &lt;authority&gt; production, or the whole string if the
-     &lt;authority&gt; production wasn't matched.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p class=note&gt;These parsing rules are a &lt;a href=#willful-violation&gt;willful
-  violation&lt;/a&gt; of RFC 3986 and RFC 3987 (which do not define error
-  handling), motivated by a desire to handle legacy content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-  &lt;h4 id=base-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Base URLs&lt;/h4&gt;
-
-  &lt;p&gt;The &lt;dfn id=fallback-base-url&gt;fallback base URL&lt;/dfn&gt; of a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
-  object is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained by running these
-  substeps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is &lt;a href=#an-iframe-srcdoc-document&gt;an &lt;code&gt;iframe&lt;/code&gt;
-   &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; document&lt;/a&gt;,
-   then return the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the
-   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
-   &lt;a href=#browsing-context-container&gt;browsing context container&lt;/a&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; and
-   abort these steps.&lt;/li&gt;
-
-   &lt;li&gt;
-
     &lt;!-- <A HREF="http://www.hixie.ch/tests/adhoc/html/navigation/javascript-url/">http://www.hixie.ch/tests/adhoc/html/navigation/javascript-url/</A> --&gt;
 
-    &lt;!-- this should be tested in the case of a browsing context that
-    was navigated to about:blank after having been elsewhere, as
-    opposed to the about:blank used at the time of the browsing
+    &lt;!-- this should be tested in the case of a browsing context that was navigated to about:blank
+    after having been elsewhere, as opposed to the about:blank used at the time of the browsing
     context's creation. --&gt;
 
-    &lt;p&gt;If &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; is
-    &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;, and the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s
-    &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; has a &lt;a href=#creator-browsing-context&gt;creator browsing
-    context&lt;/a&gt;, then return the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of
-    the &lt;a href=#creator-document&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;, and abort these
-    steps.&lt;/p&gt;
+    &lt;p&gt;If &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; is &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;, and the
+    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; has a &lt;a href=#creator-browsing-context&gt;creator browsing
+    context&lt;/a&gt;, then return the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the &lt;a href=#creator-document&gt;creator
+    &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;, and abort these steps.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -6632,282 +6480,99 @@
 
    &lt;li&gt;&lt;p&gt;Return &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The &lt;dfn id=document-base-url&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
-  object is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained by running these
-  substeps:&lt;/p&gt;
+  &lt;/ol&gt;&lt;p&gt;The &lt;dfn id=document-base-url&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is the &lt;a href=#absolute-url&gt;absolute
+  URL&lt;/a&gt; obtained by running these substeps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt; be the
-   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#fallback-base-url&gt;fallback base URL&lt;/a&gt;.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt; be the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#fallback-base-url&gt;fallback
+   base URL&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; element that has an &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute, then the
-   &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is &lt;var title=&quot;&quot;&gt;fallback base
-   url&lt;/var&gt;; abort these steps. Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute of the first such
+   &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; element that has an &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute, then the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt;; abort these steps. Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be
+   the value of the &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute of the first such
    element.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var title=&quot;&quot;&gt;fallback base
-   url&lt;/var&gt; (thus, the &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute isn't affected by
-   &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt; (thus, the &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute isn't affected by &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes).&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is the result of the
-   previous step if it was successful; otherwise it is &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is the result of the previous step if it was
+   successful; otherwise it is &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;h4 id=resolving-urls&gt;&lt;span class=secno&gt;2.5.4 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
+  &lt;/ol&gt;&lt;div class=impl&gt;
 
-  &lt;p&gt;Resolving a URL is the process of taking a relative URL and
-  obtaining the absolute URL that it implies.&lt;/p&gt;
+  &lt;h4 id=resolving-urls&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
 
-  &lt;div class=impl&gt;
+  &lt;p&gt;Resolving a URL is the process of taking a &lt;a href=#relative-url&gt;relative URL&lt;/a&gt; and obtaining the
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that it implies.&lt;/p&gt;
 
-  &lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
-  relative to either another &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; or an element,
-  the user agent must use the following steps. Resolving a URL can
-  result in an error, in which case the URL is not resolvable.&lt;/p&gt;
+  &lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; relative to either another
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; or an element, the user agent must use the following steps. Resolving a
+  URL can result in an error, in which case the URL is not resolvable.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;a href=#url&gt;URL&lt;/a&gt; being
-   resolved.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;a href=#url&gt;URL&lt;/a&gt; being resolved.&lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be determined as follows:&lt;/p&gt;
 
-    &lt;dl class=switch&gt;&lt;dt&gt;If the URL had a character encoding defined when the URL was
-     created or defined&lt;/dt&gt;
+    &lt;dl class=switch&gt;&lt;dt&gt;If the URL had a character encoding defined when the URL was created or defined&lt;/dt&gt;
 
      &lt;dd&gt;The URL character encoding is as defined.&lt;/dd&gt;
 
-     &lt;dt&gt;If the URL came from a script (e.g. as an argument to a
-     method)&lt;/dt&gt;
+     &lt;dt&gt;If the URL came from a script (e.g. as an argument to a method)&lt;/dt&gt;
 
-     &lt;dd&gt;The URL character encoding is the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character
-     encoding&lt;/a&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The URL character encoding is the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character encoding&lt;/a&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;If the URL came from a DOM node (e.g. from an element)&lt;/dt&gt;
 
-     &lt;dd&gt;The node has a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, and the URL character
-     encoding is the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The node has a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, and the URL character encoding is the
+     &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt;.&lt;/dd&gt;
 
     &lt;/dl&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is &lt;a href=#a-utf-16-encoding&gt;a UTF-16
-   encoding&lt;/a&gt;, then change the value of &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; to UTF-8.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is &lt;a href=#a-utf-16-encoding&gt;a UTF-16 encoding&lt;/a&gt;, then change the value
+   of &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; to UTF-8.&lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If the algorithm was invoked with an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
-    to use as the base URL, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be that
-    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;If the algorithm was invoked with an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to use as the base URL, let
+    &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be that &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;i&gt;base URI of
-    the element&lt;/i&gt;, as defined by the XML Base specification, with
-    &lt;i&gt;the base URI of the document entity&lt;/i&gt; being defined as the
-    &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that
-    owns the element. &lt;a href=#refsXMLBASE&gt;[XMLBASE]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be &lt;a href=&quot;#the-element's-base-url&quot;&gt;the element's base URL&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;For the purposes of the XML Base specification, user agents
-    must act as if all &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects represented XML
-    documents.&lt;/p&gt;
-
-    &lt;p class=note&gt;It is possible for &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes to be present
-    even in HTML fragments, as such attributes can be added
-    dynamically using script. (Such scripts would not be conforming,
-    however, as &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes
-    are not allowed in &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt;.)&lt;/p&gt;
-
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#parse-a-url title=&quot;parse a URL&quot;&gt;Parse&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URL, with &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; as the encoding.&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If this results in a &lt;a href=#concept-url-parse-error title=concept-url-parse-error&gt;parse error&lt;/a&gt;, then abort
+   these steps with an error.&lt;/li&gt;
 
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from expanding any sequences of percent-encoded octets in
-    that component that are valid UTF-8 sequences into Unicode
-    characters as defined by UTF-8.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt; be the result of the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt;.&lt;/li&gt;
 
-    &lt;p&gt;If any percent-encoded octets in that component are not valid
-    UTF-8 sequences (e.g. sequences of percent-encoded octets that
-    expand to surrogate code points), then return an error and abort
-    these steps.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;serialized URL&lt;/var&gt; be the result of apply the &lt;a href=#url-serializer&gt;URL
+   serializer&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt;.&lt;/li&gt;
 
-    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring,
-    with both the AllowUnassigned and UseSTD3ASCIIRules flags
-    set. Replace the matching substring with the result of the ToASCII
-    algorithm.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;serialized URL&lt;/var&gt; as the &lt;dfn id=resulting-absolute-url&gt;resulting absolute URL&lt;/dfn&gt; and
+   &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt; as the &lt;dfn id=resulting-parsed-url&gt;resulting parsed URL&lt;/dfn&gt;.&lt;/li&gt;
 
-    &lt;p&gt;If ToASCII fails to convert one of the components of the
-    string, e.g. because it is too long or because it contains invalid
-    characters, then return an error and abort these steps. &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+  &lt;/ol&gt;&lt;p&gt;Given an element, &lt;dfn id=&quot;the-element's-base-url&quot;&gt;the element's base URL&lt;/dfn&gt; is the &lt;i&gt;base URI of the element&lt;/i&gt;, as
+  defined by the XML Base specification, with &lt;i&gt;the base URI of the document entity&lt;/i&gt; being
+  defined as the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that owns the element.
+  &lt;a href=#refsXMLBASE&gt;[XMLBASE]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;/li&gt;
+  &lt;p&gt;For the purposes of the XML Base specification, user agents must act as if all
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects represented XML documents.&lt;/p&gt;
 
-   &lt;li&gt;
+  &lt;p class=note&gt;It is possible for &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes to be
+  present even in HTML fragments, as such attributes can be added dynamically using script. (Such
+  scripts would not be conforming, however, as &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt;
+  attributes are not allowed in &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt;.)&lt;/p&gt;
 
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from applying the following steps to each character other
-    than U+0025 PERCENT SIGN (%) that doesn't match the original
-    &lt;path&gt; production defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;&lt;li&gt;Encode the character into a sequence of octets as defined by the &lt;a href=#utf-8-encoder&gt;utf-8 encoder&lt;/a&gt;
-     algorithm. &lt;a href=#refsENCODING&gt;[ENCODING]&lt;/a&gt;&lt;/li&gt;
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those
-     octets. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;div class=example&gt;
-
-     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code title=&quot;&quot;&gt;//example.com/a^b&#9786;c%FFd%z/?e&lt;/code&gt;&quot;, then the
-     &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component's substring
-     would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&#9786;c%FFd%z/&lt;/code&gt;&quot; and the two
-     characters that would have to be escaped would be &quot;&lt;code title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&#9786;&lt;/code&gt;&quot;. The
-     result after this step was applied would therefore be that &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
-
-    &lt;/div&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from applying the following steps to each character other
-    than U+0025 PERCENT SIGN (%) that doesn't match the original
-    &lt;query&gt; production defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;&lt;li&gt;If the character in question cannot be expressed in the
-     encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a
-     single 0x3F octet (an ASCII question mark) and skip the remaining
-     substeps for this character.&lt;/li&gt;
-
-     &lt;li&gt;Encode the character into a sequence of octets as defined by the &lt;a href=#encoder&gt;encoder&lt;/a&gt;
-     algorithm for &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;. &lt;a href=#refsENCODING&gt;[ENCODING]&lt;/a&gt;&lt;/li&gt;
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those
-     octets. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2
-   Relative Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the
-   potentially relative URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and
-   &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URI (&lt;var title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC
-    3987, returning an error and aborting these steps if
-    appropriate. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p class=example&gt;For instance, if an absolute URI that would be
-    returned by the above algorithm violates the restrictions specific
-    to its scheme, e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the
-    &quot;&lt;code title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax,
-    then user agents are to treat this as an error instead.&lt;!-- RFC
-    3986, 3.1 Scheme --&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution
-   algorithm.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a
-   server-based naming authority, replace all U+005C REVERSE SOLIDUS
-   (\) characters in &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS
-   (/) characters.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p class=note&gt;Some of the steps in these rules, for example the
-  processing of U+005C REVERSE SOLIDUS (\) characters, are a
-  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986 and RFC 3987, motivated
-  by a desire to handle legacy content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
   &lt;/div&gt;
 
-  &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is an &lt;dfn id=absolute-url&gt;absolute URL&lt;/dfn&gt; if &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; it results in the same output
-  regardless of what it is resolved relative to, and that output is
-  not a failure.&lt;/p&gt;
 
-  &lt;p&gt;An &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is a &lt;dfn id=hierarchical-url&gt;hierarchical URL&lt;/dfn&gt; if,
-  when &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; and then &lt;a href=#parse-a-url title=&quot;parse a url&quot;&gt;parsed&lt;/a&gt;, there is a character immediately
-  after the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component
-  and it is a U+002F SOLIDUS character (/).&lt;/p&gt;
 
-  &lt;p&gt;An &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is an &lt;dfn id=authority-based-url&gt;authority-based URL&lt;/dfn&gt;
-  if, when &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; and then &lt;a href=#parse-a-url title=&quot;parse a url&quot;&gt;parsed&lt;/a&gt;, there are two characters
-  immediately after the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
-  component and they are both U+002F SOLIDUS characters (//).&lt;/p&gt;
-
-
-
   &lt;div class=impl&gt;
 
-  &lt;h4 id=url-manipulation-and-creation&gt;&lt;span class=secno&gt;2.5.5 &lt;/span&gt;URL manipulation and creation&lt;/h4&gt;
+  &lt;h4 id=dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
 
-  &lt;p&gt;To &lt;dfn id=fragment-escaped title=fragment-escaped&gt;fragment-escape&lt;/dfn&gt; a string
-  &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, a user agent must run the following
-  steps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; be the string to be
-   escaped.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; point at the first
-   character of &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is past the end
-   of &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, then jump to the step labeled
-   &lt;i&gt;end&lt;/i&gt;.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the character in &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; pointed to by
-    &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is in the range U+0000 to U+0020 or
-    is one of the following characters:&lt;/p&gt;
-
-    &lt;ul class=brief&gt;&lt;li&gt;U+0022 QUOTATION MARK character (&quot;)
-     &lt;li&gt;U+0023 NUMBER SIGN character (#)
-     &lt;li&gt;U+0025 PERCENT SIGN character (%)
-     &lt;li&gt;U+003C LESS-THAN SIGN character (&lt;)
-     &lt;li&gt;U+003E GREATER-THAN SIGN character (&gt;)
-     &lt;li&gt;U+005B LEFT SQUARE BRACKET character ([)
-     &lt;li&gt;U+005C REVERSE SOLIDUS character (\)
-     &lt;li&gt;U+005D RIGHT SQUARE BRACKET character (])
-     &lt;li&gt;U+005E CIRCUMFLEX ACCENT character (^)
-     &lt;li&gt;U+007B LEFT CURLY BRACKET character ({)
-     &lt;li&gt;U+007C VERTICAL LINE character (|)
-     &lt;li&gt;U+007D RIGHT CURLY BRACKET character (})
-    &lt;/ul&gt;&lt;p&gt;...then append the percent-encoded form of the character to
-    &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt; &lt;!-- this is the same
-    phrasing that's used elsewhere in the spec, but we really should
-    define 'percent-encoded' or at least ensure we consistently say
-    whether it's upper-case or lower-case. --&gt;
-
-    &lt;p&gt;Otherwise, append the character itself to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=note&gt;This escapes any ASCII characters that are not
-    valid in the URI &lt;fragment&gt; production without being
-    escaped.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Advance &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; to the next character
-   in &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return to the step labeled &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;/div&gt;
-
-
-
-  &lt;div class=impl&gt;
-
-  &lt;h4 id=dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.5.6 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
-
   &lt;p&gt;When an &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attribute is set, changed, or removed, the
   attribute's element, and all descendant elements, are &lt;a href=#affected-by-a-base-url-change&gt;affected by a base URL
   change&lt;/a&gt;.&lt;/p&gt;
@@ -6960,239 +6625,7 @@
   &lt;/dl&gt;&lt;/div&gt;
 
 
-&lt;!--TOPIC:DOM APIs--&gt;
-  &lt;h4 id=interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.5.7 &lt;/span&gt;Interfaces for URL manipulation&lt;/h4&gt;
-
-  &lt;p&gt;An interface that has a complement of &lt;dfn id=url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/dfn&gt; has seven attributes with the following
-  definitions:&lt;/p&gt;
-
-&lt;pre class=&quot;idl extract&quot;&gt;           attribute DOMString &lt;a href=#dom-uda-protocol title=dom-uda-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-host title=dom-uda-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-hostname title=dom-uda-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-port title=dom-uda-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-pathname title=dom-uda-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-search title=dom-uda-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-hash title=dom-uda-hash&gt;hash&lt;/a&gt;;&lt;/pre&gt;
-
-  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-protocol&gt;&lt;a href=#dom-uda-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current scheme of the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's scheme.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-host&gt;&lt;a href=#dom-uda-host&gt;host&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current host and port (if it's not the default port) in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's host and port.&lt;/p&gt;
-    &lt;p&gt;The host and the port are separated by a colon. The port part,
-    if omitted, will be assumed to be the current scheme's default
-    port.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-hostname&gt;&lt;a href=#dom-uda-hostname&gt;hostname&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current host in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's host.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-port&gt;&lt;a href=#dom-uda-port&gt;port&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current port in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's port.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-pathname&gt;&lt;a href=#dom-uda-pathname&gt;pathname&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current path in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's path.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-search&gt;&lt;a href=#dom-uda-search&gt;search&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current query component in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's query component.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-hash&gt;&lt;a href=#dom-uda-hash&gt;hash&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current fragment identifier in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's fragment identifier.&lt;/p&gt;
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;&lt;div class=impl&gt;
-
-  &lt;hr&gt;&lt;p&gt;The attributes defined to be &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/a&gt; must act as described for the attributes with the
-  same corresponding names in this section.&lt;/p&gt;
-
-  &lt;p&gt;In addition, an interface with a complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL
-  decomposition IDL attributes&lt;/a&gt; defines an &lt;dfn id=concept-uda-input title=concept-uda-input&gt;input&lt;/dfn&gt;, which is a &lt;a href=#url&gt;URL&lt;/a&gt;
-  that the attributes act on, and a &lt;dfn id=concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/dfn&gt;, which is a
-  set of steps invoked when any of the attributes' setters are
-  invoked.&lt;/p&gt;
-
-  &lt;p&gt;The seven &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt; have
-  similar requirements.&lt;/p&gt;
-
-  &lt;p&gt;On getting, if the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt;
-  is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that fulfills the condition given in
-  the &quot;getter condition&quot; column corresponding to the attribute in the
-  table below, the user agent must return the part of the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; URL given in the &quot;component&quot;
-  column, with any prefixes specified in the &quot;prefix&quot; column
-  appropriately added to the start of the string and any suffixes
-  specified in the &quot;suffix&quot; column appropriately added to the end of
-  the string. Otherwise, the attribute must return the empty
-  string.&lt;/p&gt;
-
-  &lt;p&gt;On setting, the new value must first be mutated as described by
-  the &quot;setter preprocessor&quot; column, then mutated by %-escaping any
-  characters in the new value that are not valid in the relevant
-  component as given by the &quot;component&quot; column. Then, if the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#absolute-url&gt;absolute
-  URL&lt;/a&gt; and the resulting new value fulfills the condition given
-  in the &quot;setter condition&quot; column, the user agent must make a new
-  string &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; by replacing the component of the
-  URL given by the &quot;component&quot; column in the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; URL with the new value;
-  otherwise, the user agent must let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be
-  equal to the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt;. Finally,
-  the user agent must invoke the &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; with the
-  value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When replacing a component in the URL, if the component is part
-  of an optional group in the URL syntax consisting of a character
-  followed by the component, the component (including its prefix
-  character) must be included even if the new value is the empty
-  string.&lt;/p&gt;
-
-  &lt;p class=note&gt;The previous paragraph applies in particular to the
-  &quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot; before a &lt;port&gt; component, the &quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot; before a &lt;query&gt; component, and the &quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot; before a &lt;fragment&gt; component.&lt;/p&gt;
-
-  &lt;p&gt;For the purposes of the above definitions, URLs must be parsed
-  using the &lt;a href=#parse-a-url title=&quot;parse a URL&quot;&gt;URL parsing rules&lt;/a&gt; defined
-  in this specification.&lt;/p&gt;
-
-  &lt;table id=table-uda&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Attribute
-     &lt;th&gt;Component
-     &lt;th&gt;Getter Condition
-     &lt;th&gt;Prefix
-     &lt;th&gt;Suffix
-     &lt;th&gt;Setter Preprocessor
-     &lt;th&gt;Setter Condition
-   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-protocol title=dom-uda-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;U+003A COLON (:)
-     &lt;td&gt;Remove all trailing U+003A COLON characters (:)
-     &lt;td&gt;The new value is not the empty string
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-host title=dom-uda-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-hostport title=url-hostport&gt;&lt;hostport&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;The new value is not the empty string and &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-hostname title=dom-uda-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove all leading U+002F SOLIDUS characters (/)
-     &lt;td&gt;The new value is not the empty string and &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-port title=dom-uda-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-port title=url-port&gt;&lt;port&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;, and contained a &lt;a href=#url-port title=url-port&gt;&lt;port&gt;&lt;/a&gt; component (possibly an empty one)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove all characters in the new value from the first that is not an &lt;a href=#ascii-digits title=&quot;ASCII digits&quot;&gt;ASCII digit&lt;/a&gt;, if any.
-         Remove any leading U+0030 DIGIT ZERO characters (0) in the new value.
-         If the resulting string is empty, set it to a single U+0030 DIGIT ZERO character (0).
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;,
-         and the new value, when interpreted as a base-ten integer, is less than or equal to 65535
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-pathname title=dom-uda-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is a &lt;a href=#hierarchical-url&gt;hierarchical URL&lt;/a&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;If it has no leading U+002F SOLIDUS character (/), prepend a U+002F SOLIDUS character (/) to the new value
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-search title=dom-uda-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is a &lt;a href=#hierarchical-url&gt;hierarchical URL&lt;/a&gt;, and contained a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component (possibly an empty one)
-     &lt;td&gt;U+003F QUESTION MARK (?)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove one leading U+003F QUESTION MARK character (?), if any
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is a &lt;a href=#hierarchical-url&gt;hierarchical URL&lt;/a&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-hash title=dom-uda-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; contained a non-empty &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component
-     &lt;td&gt;U+0023 NUMBER SIGN (#)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove one leading U+0023 NUMBER SIGN character (#), if any
-     &lt;td&gt;&mdash;
-  &lt;/table&gt;&lt;!--
-  <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
-  <A HREF="http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp">http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp</A>
-  <A HREF="http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722">http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722</A>
---&gt;&lt;/div&gt;
-
-  &lt;div class=example&gt;
-
-   &lt;p&gt;The table below demonstrates how the getter &lt;span class=impl&gt;condition&lt;/span&gt; for &lt;code title=dom-uda-search&gt;&lt;a href=#dom-uda-search&gt;search&lt;/a&gt;&lt;/code&gt; results in different results
-   depending on the exact original syntax of the URL:&lt;/p&gt;
-
-   &lt;table id=table-uda-examples&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; Input URL
-      &lt;th&gt; &lt;code title=dom-uda-search&gt;&lt;a href=#dom-uda-search&gt;search&lt;/a&gt;&lt;/code&gt; value
-      &lt;th&gt; Explanation
-    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/&lt;/code">http://example.com/&lt;/code</A>&gt;
-      &lt;td&gt; &lt;i&gt;empty string&lt;/i&gt;
-      &lt;td&gt; No &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component in input URL.
-     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?&lt;/code">http://example.com/?&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
-      &lt;td&gt; There is a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, but it is empty.
-           &lt;span class=impl&gt;The question mark in the resulting value is the prefix.&lt;/span&gt;
-     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test&lt;/code">http://example.com/?test&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-      &lt;td&gt; The &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component has the value &quot;&lt;code title=&quot;&quot;&gt;test&lt;/code&gt;&quot;.
-     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test#&lt;/code">http://example.com/?test#&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-      &lt;td&gt; The (empty) &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component is not part of the &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component.
-   &lt;/table&gt;&lt;/div&gt;
-
-  &lt;div class=example&gt;
-
-   &lt;p&gt;The following table is similar; it provides a list of what each
-   of the &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt; returns for a
-   given &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; URL.&lt;/p&gt;
-
-   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Input
-      &lt;th&gt;&lt;code title=dom-uda-protocol&gt;&lt;a href=#dom-uda-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-host&gt;&lt;a href=#dom-uda-host&gt;host&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-hostname&gt;&lt;a href=#dom-uda-hostname&gt;hostname&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-port&gt;&lt;a href=#dom-uda-port&gt;port&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-pathname&gt;&lt;a href=#dom-uda-pathname&gt;pathname&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-search&gt;&lt;a href=#dom-uda-search&gt;search&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-hash&gt;&lt;a href=#dom-uda-hash&gt;hash&lt;/a&gt;&lt;/code&gt;
-    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/carrot#question%3f&lt;/code">http://example.com/carrot#question%3f&lt;/code</A>&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;http:&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;example.com&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;example.com&lt;/code&gt;
-      &lt;td&gt;(empty string)
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;/carrot&lt;/code&gt;
-      &lt;td&gt;(empty string)
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;#question%3f&lt;/code&gt;
-     &lt;tr&gt;&lt;td&gt;&lt;code title=&quot;&quot;&gt;<A HREF="https://www.example.com:4443?&lt;/code">https://www.example.com:4443?&lt;/code</A>&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;https:&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;www.example.com:4443&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;www.example.com&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;4443&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
-      &lt;td&gt;(empty string)
-   &lt;/table&gt;&lt;/div&gt;
-
-
-&lt;!--TOPIC:HTML--&gt;
+&lt;!--CLEANUP--&gt;
   &lt;div class=impl&gt;
 
   &lt;h3 id=fetching-resources&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Fetching resources&lt;/h3&gt;
@@ -7295,14 +6728,20 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;i&gt;Clean referrer&lt;/i&gt;: Remove any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-    component from &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt;.&lt;/p&gt; &lt;!-- RFC2616 says &quot;The URI MUST NOT include a
-    fragment.&quot; (section 14.36) --&gt;
+    &lt;p&gt;Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;parsed referrer&lt;/var&gt; be &lt;a href=#resulting-parsed-url&gt;resulting parsed URL&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
+    &lt;p&gt;&lt;i&gt;Clean referrer&lt;/i&gt;: Let &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; be the result of applying the
+    &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;parsed referrer&lt;/var&gt;, with the &lt;i&gt;exclude fragment
+    flag&lt;/i&gt; set.&lt;/p&gt; &lt;!-- RFC2616 says &quot;The URI MUST NOT include a fragment.&quot; (section 14.36) --&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; is not the empty string, is not a &lt;a href=#data-protocol title=&quot;data
     protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URL&lt;/a&gt;, is not a &lt;a href=#javascript-protocol title=&quot;javascript
     protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt; URL&lt;/a&gt;, and is not the &lt;a href=#url&gt;URL&lt;/a&gt;
@@ -8837,6 +8276,10 @@
   document&lt;/a&gt;, and the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is both &lt;a href=#ready-for-post-load-tasks&gt;ready for post-load tasks&lt;/a&gt; and
   &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt; immediately.&lt;/p&gt;
 
+  &lt;p&gt;&lt;dfn id=&quot;the-document's-referrer&quot;&gt;The document's referrer&lt;/dfn&gt; is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that can be set when the
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created. If it is not explicitly set, then its value is the empty
+  string.&lt;/p&gt;
+
   &lt;p&gt;Each &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object has a &lt;dfn id=reload-override-flag&gt;reload override flag&lt;/dfn&gt; that is originally
   unset. The flag is set by the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.write()&lt;/a&gt;&lt;/code&gt; methods in certain situations. When the flag is
   set, the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; also has a &lt;dfn id=reload-override-buffer&gt;reload override buffer&lt;/dfn&gt; which is a Unicode
@@ -8938,6 +8381,8 @@
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;document&lt;/var&gt; . &lt;code title=dom-document-referrer&gt;&lt;a href=#dom-document-referrer&gt;referrer&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
+&lt;!--CLEANUP--&gt;
+
     &lt;p&gt;Returns &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;the address&lt;/a&gt;
     of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; from which the user navigated to this
     one, unless it was blocked or there was no such document, in which
@@ -8950,14 +8395,8 @@
 
   &lt;/dl&gt;&lt;div class=impl&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-document-referrer title=dom-document-referrer&gt;&lt;code&gt;referrer&lt;/code&gt;&lt;/dfn&gt; attribute must return either
-  the &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; of the &lt;a href=#active-document&gt;active document&lt;/a&gt; of the
-  &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt; &lt;em&gt;at the time the navigation was started&lt;/em&gt; (that is, the
-  page which &lt;a href=#navigate title=navigate&gt;navigated&lt;/a&gt; the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to the
-  current document), with any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component removed;
-  or the empty string if there is no such originating page, or if the UA has been configured not to
-  report referrers in this case, or if the navigation was initiated for a &lt;a href=#hyperlink&gt;hyperlink&lt;/a&gt;
-  with a &lt;code title=rel-noreferrer&gt;&lt;a href=#link-type-noreferrer&gt;noreferrer&lt;/a&gt;&lt;/code&gt; keyword.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=dom-document-referrer title=dom-document-referrer&gt;&lt;code&gt;referrer&lt;/code&gt;&lt;/dfn&gt; attribute must return
+  &lt;a href=&quot;#the-document's-referrer&quot;&gt;the document's referrer&lt;/a&gt;.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -12371,6 +11810,8 @@
    &lt;li&gt;&lt;p&gt;Change &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; to the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's document&quot;&gt;document&lt;/a&gt;'s &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's
    address&quot;&gt;address&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;!-- &lt;span&gt;the document's referrer&lt;/span&gt; stays the same --&gt;
+
    &lt;li&gt;&lt;p&gt;Create a new &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; and associate it with the document. This is a
    &lt;dfn id=script-created-parser&gt;script-created parser&lt;/dfn&gt; (meaning that it can be closed by the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-close&gt;&lt;a href=#dom-document-close&gt;document.close()&lt;/a&gt;&lt;/code&gt; methods, and that the tokenizer will wait for
    an explicit call to &lt;code title=dom-document-close&gt;&lt;a href=#dom-document-close&gt;document.close()&lt;/a&gt;&lt;/code&gt; before emitting an
@@ -19387,16 +18828,8 @@
            attribute DOMString &lt;a href=#dom-a-type title=dom-a-type&gt;type&lt;/a&gt;;
 
            attribute DOMString &lt;a href=#dom-a-text title=dom-a-text&gt;text&lt;/a&gt;;
-
-  // &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;
-           attribute DOMString &lt;a href=#dom-a-protocol title=dom-a-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-host title=dom-a-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-hostname title=dom-a-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-port title=dom-a-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-pathname title=dom-a-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-search title=dom-a-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-hash title=dom-a-hash&gt;hash&lt;/a&gt;;
-};&lt;/pre&gt;
+};
+&lt;a href=#htmlanchorelement&gt;HTMLAnchorElement&lt;/a&gt; implements &lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;;&lt;/pre&gt;
    &lt;/dd&gt;
   &lt;/dl&gt;&lt;!--TOPIC:HTML--&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; element has an &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute,
   then it &lt;a href=#represents&gt;represents&lt;/a&gt; a &lt;a href=#hyperlink&gt;hyperlink&lt;/a&gt; (a hypertext anchor) labeled by its
@@ -19492,7 +18925,7 @@
 
    &lt;/dd&gt;
 
-  &lt;/dl&gt;&lt;div class=impl&gt;
+  &lt;/dl&gt;&lt;!-- CLEANUP --&gt;&lt;div class=impl&gt;
 
   &lt;p&gt;The IDL attributes &lt;dfn id=dom-a-href title=dom-a-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-download title=dom-a-download&gt;&lt;code&gt;download&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-ping title=dom-a-ping&gt;&lt;code&gt;ping&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-target title=dom-a-target&gt;&lt;code&gt;target&lt;/code&gt;&lt;/dfn&gt;,
   &lt;dfn id=dom-a-rel title=dom-a-rel&gt;&lt;code&gt;rel&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-hreflang title=dom-a-hreflang&gt;&lt;code&gt;hreflang&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-a-type title=dom-a-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;, must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the respective content
@@ -19505,12 +18938,12 @@
   same value as the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; IDL attribute on the element, and on setting, must act
   as if the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; IDL attribute on the element had been set to the new value.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; element also supports the complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/a&gt;, &lt;dfn id=dom-a-protocol title=dom-a-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-host title=dom-a-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-port title=dom-a-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-hostname title=dom-a-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-pathname title=dom-a-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-search title=dom-a-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-a-hash title=dom-a-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for &lt;a href=#url-decomposition-idl-attributes&gt;URL
-  decomposition IDL attributes&lt;/a&gt;, with the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; being
-  the result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the element's &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute relative to the element, if there is such an
-  attribute and resolving it is successful, or the empty string otherwise; and the &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; being the same as setting the element's
-  &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute to the new output value.&lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; element also supports the &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt; interface. The &lt;a href=#concept-uu-input title=concept-uu-input&gt;input&lt;/a&gt; is
+  the value of the element's &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute, if there is such an
+  attribute, or the empty string otherwise; the &lt;a href=#concept-uu-base title=concept-uu-base&gt;base&lt;/a&gt;
+  is &lt;a href=&quot;#the-element's-base-url&quot;&gt;the element's base URL&lt;/a&gt;; the &lt;a href=#concept-uu-query-encoding title=concept-uu-query-encoding&gt;query encoding&lt;/a&gt;
+  being the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt;; and the &lt;a href=#concept-uu-update title=concept-uu-update&gt;update steps&lt;/a&gt; being the same as setting the element's
+  &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute to the new output value.&lt;/p&gt;
 
   &lt;/div&gt;
 &lt;!--TOPIC:HTML--&gt;
@@ -25326,12 +24759,14 @@
     &lt;!-- if we get to this point we know we can successfully parsed the URL, since this algorithm is
     only used after fetching the resource in the steps above --&gt;
 
-    &lt;p&gt;Otherwise, if the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component of the
-    &lt;a href=#url&gt;URL&lt;/a&gt; of the specified resource (after any redirects) matches a pattern that a
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;Otherwise, if applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the
+    &lt;a href=#url&gt;URL&lt;/a&gt; of the specified resource (after any redirects) results in a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+    whose &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; component matches a pattern that a
     &lt;a href=#plugin&gt;plugin&lt;/a&gt; supports, then the &lt;a href=#concept-embed-type title=concept-embed-type&gt;content's type&lt;/a&gt; is
     the type that that plugin can handle.&lt;/p&gt;
 
-    &lt;p class=example&gt;For example, a plugin might say that it can handle resources with &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; components that end with the four character string &quot;&lt;code title=&quot;&quot;&gt;.swf&lt;/code&gt;&quot;.&lt;/p&gt;
+    &lt;p class=example&gt;For example, a plugin might say that it can handle resources with &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; components that end with the four character string &quot;&lt;code title=&quot;&quot;&gt;.swf&lt;/code&gt;&quot;.&lt;/p&gt;
 
     &lt;!-- it's sad that we have to do extension sniffing. sigh. --&gt;
     &lt;!-- see also &lt;object&gt; which has a similar step --&gt;
@@ -25860,12 +25295,14 @@
         &lt;!-- if we get to this point we know we can successfully parsed the URL, since this
         algorithm is only used after fetching the resource in the steps above --&gt;
 
-        &lt;p&gt;If the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component of the &lt;a href=#url&gt;URL&lt;/a&gt; of
-        the specified resource (after any redirects) matches a pattern that a &lt;a href=#plugin&gt;plugin&lt;/a&gt;
+&lt;!--CLEANUP--&gt;
+        &lt;p&gt;If applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the
+        &lt;a href=#url&gt;URL&lt;/a&gt; of the specified resource (after any redirects) results in a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+        whose &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; component matches a pattern that a &lt;a href=#plugin&gt;plugin&lt;/a&gt;
         supports, then let &lt;var title=&quot;&quot;&gt;resource type&lt;/var&gt; be the type that that plugin can
         handle.&lt;/p&gt;
 
-        &lt;p class=example&gt;For example, a plugin might say that it can handle resources with &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; components that end with the four character string
+        &lt;p class=example&gt;For example, a plugin might say that it can handle resources with &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; components that end with the four character string
         &quot;&lt;code title=&quot;&quot;&gt;.swf&lt;/code&gt;&quot;.&lt;/p&gt;
 
         &lt;!-- it's sad that we have to do extension sniffing. sigh. --&gt;
@@ -29934,7 +29371,7 @@
   should play, but it is also possible to select specific tracks declaratively, by specifying
   particular tracks in the fragment identifier of the &lt;a href=#url&gt;URL&lt;/a&gt; of the &lt;a href=#media-resource&gt;media
   resource&lt;/a&gt;. The format of the fragment identifier depends on the &lt;a href=#mime-type&gt;MIME type&lt;/a&gt; of
-  the &lt;a href=#media-resource&gt;media resource&lt;/a&gt;. &lt;a href=#refsRFC2046&gt;[RFC2046]&lt;/a&gt; &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+  the &lt;a href=#media-resource&gt;media resource&lt;/a&gt;. &lt;a href=#refsRFC2046&gt;[RFC2046]&lt;/a&gt; &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;div class=example&gt;
 
@@ -39553,16 +38990,8 @@
   readonly attribute &lt;a href=#domtokenlist&gt;DOMTokenList&lt;/a&gt; &lt;a href=#dom-area-rellist title=dom-area-relList&gt;relList&lt;/a&gt;;
            attribute DOMString &lt;a href=#dom-area-hreflang title=dom-area-hreflang&gt;hreflang&lt;/a&gt;;
            attribute DOMString &lt;a href=#dom-area-type title=dom-area-type&gt;type&lt;/a&gt;;
-
-  // &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;
-           attribute DOMString &lt;a href=#dom-area-protocol title=dom-area-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-host title=dom-area-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-hostname title=dom-area-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-port title=dom-area-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-pathname title=dom-area-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-search title=dom-area-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-hash title=dom-area-hash&gt;hash&lt;/a&gt;;
-};&lt;/pre&gt;
+};
+&lt;a href=#htmlareaelement&gt;HTMLAreaElement&lt;/a&gt; implements &lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;;&lt;/pre&gt;
    &lt;/dd&gt;
   &lt;/dl&gt;&lt;!--TOPIC:HTML--&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; element &lt;a href=#represents&gt;represents&lt;/a&gt; either a
   hyperlink with some text and a corresponding area on an &lt;a href=#image-map&gt;image
@@ -39704,7 +39133,7 @@
    the &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; element, if any, and as determined by the &lt;code title=attr-hyperlink-download&gt;&lt;a href=#attr-hyperlink-download&gt;download&lt;/a&gt;&lt;/code&gt; attribute and any expressed user
    preference.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The IDL attributes &lt;dfn id=dom-area-alt title=dom-area-alt&gt;&lt;code&gt;alt&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-coords title=dom-area-coords&gt;&lt;code&gt;coords&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-href title=dom-area-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-target title=dom-area-target&gt;&lt;code&gt;target&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-download title=dom-area-download&gt;&lt;code&gt;download&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-ping title=dom-area-ping&gt;&lt;code&gt;ping&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-rel title=dom-area-rel&gt;&lt;code&gt;rel&lt;/code&gt;&lt;/dfn&gt;,
+  &lt;/ol&gt;&lt;p&gt;The IDL attributes &lt;dfn id=dom-area-alt title=dom-area-alt&gt;&lt;code&gt;alt&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-coords title=dom-area-coords&gt;&lt;code&gt;coords&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-target title=dom-area-target&gt;&lt;code&gt;target&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-download title=dom-area-download&gt;&lt;code&gt;download&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-href title=dom-area-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-ping title=dom-area-ping&gt;&lt;code&gt;ping&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-rel title=dom-area-rel&gt;&lt;code&gt;rel&lt;/code&gt;&lt;/dfn&gt;,
   &lt;dfn id=dom-area-hreflang title=dom-area-hreflang&gt;&lt;code&gt;hreflang&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-area-type title=dom-area-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;, each must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the respective
   content attributes of the same name.&lt;/p&gt;
 
@@ -39714,13 +39143,12 @@
   &lt;p&gt;The IDL attribute &lt;dfn id=dom-area-rellist title=dom-area-rellist&gt;&lt;code&gt;relList&lt;/code&gt;&lt;/dfn&gt; must
   &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-hyperlink-rel&gt;&lt;a href=#attr-hyperlink-rel&gt;rel&lt;/a&gt;&lt;/code&gt; content attribute.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; element also supports the complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/a&gt;, &lt;dfn id=dom-area-protocol title=dom-area-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-host title=dom-area-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-port title=dom-area-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;,
-  &lt;dfn id=dom-area-hostname title=dom-area-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-pathname title=dom-area-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-search title=dom-area-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-area-hash title=dom-area-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for &lt;a href=#url-decomposition-idl-attributes&gt;URL
-  decomposition IDL attributes&lt;/a&gt;, with the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; being
-  the result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the element's &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute relative to the element, if there is such an
-  attribute and resolving it is successful, or the empty string otherwise; and the &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; being the same as setting the element's
-  &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute to the new output value.&lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; element also supports the &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt; interface. The &lt;a href=#concept-uu-input title=concept-uu-input&gt;input&lt;/a&gt; is
+  the value of the element's &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute, if there is such an
+  attribute, or the empty string otherwise; the &lt;a href=#concept-uu-base title=concept-uu-base&gt;base&lt;/a&gt;
+  is &lt;a href=&quot;#the-element's-base-url&quot;&gt;the element's base URL&lt;/a&gt;; the &lt;a href=#concept-uu-query-encoding title=concept-uu-query-encoding&gt;query encoding&lt;/a&gt;
+  being the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt;; and the &lt;a href=#concept-uu-update title=concept-uu-update&gt;update steps&lt;/a&gt; being the same as setting the element's
+  &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute to the new output value.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -55545,6 +54973,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;div class=impl&gt;
 
@@ -55596,11 +55025,6 @@
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; is the empty string, let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; of
     the &lt;var title=&quot;&quot;&gt;form document&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p class=note&gt;This step is a &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of
-    RFC 3986, which would require base URL processing here. This
-    violation is motivated by a desire for compatibility with legacy
-    content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
     &lt;!-- Don't ask me why. But that's what IE does. It even treats
     action=&quot;&quot; differently from action=&quot; &quot; or action=&quot;#&quot; (the latter
     two resolve to the base URL, the first one resolves to the doc
@@ -55613,12 +55037,17 @@
 
    &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the
    &lt;a href=#url&gt;URL&lt;/a&gt; &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;, relative to the &lt;var title=&quot;&quot;&gt;submitter&lt;/var&gt; element. If this fails, abort these
-   steps. Otherwise, let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be the resulting
-   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
+   steps.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; of the resulting
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be the resulting
    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;action components&lt;/var&gt; be the resulting &lt;a href=#parsed-url&gt;parsed
+   URL&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; of the resulting
+   &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;enctype&lt;/var&gt; be the &lt;var title=&quot;&quot;&gt;submitter&lt;/var&gt; element's &lt;a href=#concept-fs-enctype title=concept-fs-enctype&gt;enctype&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;method&lt;/var&gt; be the &lt;var title=&quot;&quot;&gt;submitter&lt;/var&gt; element's &lt;a href=#concept-fs-method title=concept-fs-method&gt;method&lt;/a&gt;.&lt;/li&gt;
@@ -55689,11 +55118,11 @@
       &lt;!-- by this point we've already tried to resolve the URL, so we
       know we can parse it --&gt;
 
+      &lt;p&gt;Set &lt;var title=&quot;&quot;&gt;parsed action&lt;/var&gt;'s &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt;
+      component to &lt;var title=&quot;&quot;&gt;query&lt;/var&gt;.&lt;/p&gt;
+
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt; be a new &lt;a href=#url&gt;URL&lt;/a&gt;
-      that is equal to the &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; except that its
-      &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component is
-      replaced by &lt;var title=&quot;&quot;&gt;query&lt;/var&gt; (adding a U+003F QUESTION
-      MARK character (?) if appropriate).&lt;/p&gt;
+      formed by applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; algorithm to &lt;var title=&quot;&quot;&gt;parsed action&lt;/var&gt;.&lt;/p&gt;
 
       &lt;p&gt;&lt;a href=#navigate&gt;Navigate&lt;/a&gt;&lt;!--DONAV form--&gt; &lt;var title=&quot;&quot;&gt;target
       browsing context&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt;. If
@@ -55750,6 +55179,8 @@
       browsing context&lt;/var&gt; must be navigated with &lt;a href=#replacement-enabled&gt;replacement
       enabled&lt;/a&gt;.&lt;/p&gt;
 
+      &lt;p class=note&gt;The &lt;var title=&quot;&quot;&gt;form data set&lt;/var&gt; is discarded.&lt;/p&gt;
+
      &lt;/dd&gt;
 
      &lt;dt&gt;&lt;dfn id=submit-data-post title=submit-data-post&gt;Post to data:&lt;/dfn&gt;
@@ -55760,20 +55191,19 @@
       form encoding algorithm&lt;/a&gt;.&lt;/p&gt;
 
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; contains the string &quot;&lt;code title=&quot;&quot;&gt;%%%%&lt;/code&gt;&quot; (four U+0025 PERCENT SIGN characters),
-      then %-escape all bytes in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if
-      interpreted as US-ASCII, do not match the &lt;code title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in the URI Generic Syntax,
-      and then, treating the result as a US-ASCII string, further
-      %-escape all the U+0025 PERCENT SIGN characters in the resulting
+      then &lt;a href=#percent-encode&gt;percent encode&lt;/a&gt; all bytes in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if
+      interpreted as US-ASCII, are not characters in the URL &lt;a href=#default-encode-set&gt;default encode set&lt;/a&gt;,
+      and then, treating the result as a US-ASCII string, 
+      &lt;a href=#utf-8-percent-encode&gt;UTF-8 percent encode&lt;/a&gt; all the U+0025 PERCENT SIGN characters in the resulting
       string and replace the first occurrence of &quot;&lt;code title=&quot;&quot;&gt;%%%%&lt;/code&gt;&quot; in &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; with the
-      resulting double-escaped string. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      resulting doubly-escaped string. &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; contains the string
       &quot;&lt;code title=&quot;&quot;&gt;%%&lt;/code&gt;&quot; (two U+0025 PERCENT SIGN characters
-      in a row, but not four), then %-escape all characters in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if interpreted as US-ASCII, do not
-      match the &lt;code title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in the URI
-      Generic Syntax, and then, treating the result as a US-ASCII
+      in a row, but not four), then &lt;a href=#utf-8-percent-encode&gt;UTF-8 percent encode&lt;/a&gt; all characters in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if interpreted as US-ASCII, 
+      are not characters in the URL &lt;a href=#default-encode-set&gt;default encode set&lt;/a&gt;, and then, treating the result as a US-ASCII
       string, replace the first occurrence of &quot;&lt;code title=&quot;&quot;&gt;%%&lt;/code&gt;&quot; in &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; with the
-      resulting escaped string. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      resulting escaped string. &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;&lt;a href=#navigate&gt;Navigate&lt;/a&gt;&lt;!--DONAV form--&gt; &lt;var title=&quot;&quot;&gt;target
       browsing context&lt;/var&gt; to the potentially modified &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; (which will be a &lt;a href=#data-protocol title=&quot;data
@@ -55813,12 +55243,11 @@
      &lt;dt&gt;&lt;dfn id=submit-mailto-body title=submit-mailto-body&gt;Mail as body&lt;/dfn&gt;
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the resulting encoding the
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the resulting of encoding the
       &lt;var title=&quot;&quot;&gt;form data set&lt;/var&gt; using the &lt;a href=#appropriate-form-encoding-algorithm&gt;appropriate
-      form encoding algorithm&lt;/a&gt; and then %-escaping all the bytes
+      form encoding algorithm&lt;/a&gt; and then &lt;a href=#percent-encode title=&quot;percent encode&quot;&gt;percent encoding&lt;/a&gt; all the bytes
       in the resulting byte string that, when interpreted as US-ASCII,
-      do not match the &lt;code title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in
-      the URI Generic Syntax. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      are not characters in the URL &lt;a href=#default-encode-set&gt;default encode set&lt;/a&gt;. &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt; have the same value as
       &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;.&lt;/p&gt;
@@ -64849,7 +64278,11 @@
   &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt; immediately. The &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; must have a single child
   &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; node, which itself has a single child &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; node. As soon as this
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created, the user agent must &lt;a href=#implement-the-sandboxing&gt;implement the sandboxing&lt;/a&gt; for
-  it.&lt;/p&gt;
+  it. If the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; has a &lt;a href=#creator-document&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;, then
+  the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=&quot;#the-document's-referrer&quot; title=&quot;the document's
+  referrer&quot;&gt;referrer&lt;/a&gt; must be set to &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;the address&lt;/a&gt;
+  of that &lt;a href=#creator-document&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt; at the time of the &lt;a href=#browsing-context&gt;browsing
+  context&lt;/a&gt;'s creation.&lt;/p&gt;
 
   &lt;p class=note&gt;If the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is created specifically to be immediately
   navigated, then that initial navigation will have &lt;a href=#replacement-enabled&gt;replacement enabled&lt;/a&gt;.&lt;/p&gt;
@@ -66489,10 +65922,11 @@
 
   &lt;/dl&gt;&lt;div class=impl&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;The &lt;dfn id=dom-document-domain title=dom-document-domain&gt;&lt;code&gt;domain&lt;/code&gt;&lt;/dfn&gt; attribute on
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects must be initialized to &lt;a href=&quot;#the-document's-domain&quot;&gt;the document's domain&lt;/a&gt;, if it has
   one, and the empty string otherwise. If the value is an IPv6 address, then the square brackets
-  from the host portion of the &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component must be omitted
+  from the &lt;a href=#concept-url-host title=concept-url-host&gt;host&lt;/a&gt; component must be omitted
   from the attribute's value.&lt;/p&gt;
 
   &lt;p&gt;On getting, the attribute must return its current value, unless the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; has
@@ -67210,22 +66644,22 @@
 
      &lt;li&gt;If that fails, throw a &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
-     &lt;li&gt;Compare the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt;. If
-     any part of these two &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; differ other than the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt;, &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt;, and &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; components, then throw a
+&lt;!--CLEANUP--&gt;
+     &lt;li&gt;Compare the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; to the result of applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt;. If
+     any component of these two &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; differ other than the &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt;, &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt;, and &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; components, then throw a
      &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
      &lt;li&gt;If the &lt;a href=#origin&gt;origin&lt;/a&gt; of the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is not the same as
      the &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
-     document&quot;&gt;document&lt;/a&gt;, and either the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; or &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components of the two &lt;a href=#url title=URL&gt;URLs&lt;/a&gt;
+     document&quot;&gt;document&lt;/a&gt;, and either the &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; or &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt; components of the two &lt;a href=#parsed-url title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/a&gt;
      compared in the previous step differ, throw a &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception and abort
      these steps. (This prevents sandboxed content from spoofing other pages on the same
      origin.)&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
 
-    &lt;/ol&gt;&lt;p&gt;For the purposes of the comparisons in the above substeps, the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; and &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components
-    can only be the same if the URLs are both &lt;a href=#hierarchical-url title=&quot;hierarchical URL&quot;&gt;hierarchical
-    URLs&lt;/a&gt;.&lt;/p&gt;
+    &lt;/ol&gt;&lt;p&gt;For the purposes of the comparisons in the above substeps, the &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; and &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt; components
+    can only be the same if the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component of both &lt;a href=#parsed-url title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/a&gt; are &lt;a href=#concept-url-scheme-relative title=concept-url-scheme-relative&gt;relative schemes&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -67452,17 +66886,9 @@
   void &lt;a href=#dom-location-assign title=dom-location-assign&gt;assign&lt;/a&gt;(DOMString url);
   void &lt;a href=#dom-location-replace title=dom-location-replace&gt;replace&lt;/a&gt;(DOMString url);
   void &lt;a href=#dom-location-reload title=dom-location-reload&gt;reload&lt;/a&gt;();
+};
+&lt;a href=#location&gt;Location&lt;/a&gt; implements &lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;;&lt;/pre&gt;
 
-  // &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt; &lt;!-- blame brendan for these &quot;innovative&quot; names --&gt;
-           attribute DOMString &lt;a href=#dom-location-protocol title=dom-location-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-host title=dom-location-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-hostname title=dom-location-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-port title=dom-location-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-pathname title=dom-location-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-search title=dom-location-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-hash title=dom-location-hash&gt;hash&lt;/a&gt;;
-};&lt;/pre&gt;
-
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;location&lt;/var&gt; . &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -67579,16 +67005,18 @@
   user agent may instead perform &lt;a href=#an-overridden-reload&gt;an overridden reload&lt;/a&gt; rather than the navigation
   described in this paragraph.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; interface also supports the &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt; interface. &lt;span class=impl&gt;The &lt;a href=#concept-uu-input title=concept-uu-input&gt;input&lt;/a&gt; is &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's
+  address&quot;&gt;the address&lt;/a&gt; of the &lt;i&gt;relevant &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;&lt;/i&gt; (same as the &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute), as an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;; the &lt;a href=#concept-uu-base title=concept-uu-base&gt;base&lt;/a&gt; is the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-base-url&quot; title=&quot;script's base
+  URL&quot;&gt;base URL&lt;/a&gt; (which can be different each time members on the interface are invoked); the
+  &lt;a href=#concept-uu-query-encoding title=concept-uu-query-encoding&gt;query encoding&lt;/a&gt; is the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character
+  encoding&lt;/a&gt;; and the &lt;a href=#concept-uu-update title=concept-uu-update&gt;update steps&lt;/a&gt; are the same as
+  setting the &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute to the new output
+  value.&lt;/span&gt;&lt;/p&gt;
+
   &lt;/div&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; interface also has the complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/a&gt;, &lt;dfn id=dom-location-protocol title=dom-location-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-host title=dom-location-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-port title=dom-location-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-hostname title=dom-location-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-pathname title=dom-location-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-search title=dom-location-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-location-hash title=dom-location-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. &lt;span class=impl&gt;These must follow the rules
-  given for &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;, with the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; being &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;the
-  address&lt;/a&gt; of the &lt;i&gt;relevant &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;&lt;/i&gt;, as an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; (same
-  as the &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute), and the &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; being the same as setting the &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute to the new output value.&lt;/span&gt;&lt;/p&gt;
 
 
-
 &lt;!--ADD-TOPIC:Security--&gt;
   &lt;div class=impl&gt;
 
@@ -67763,11 +67191,12 @@
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;gone async&lt;/var&gt; be false.&lt;/li&gt;
 
-   &lt;li id=navigate-fragid-step&gt;&lt;p&gt;&lt;i&gt;Fragment identifiers&lt;/i&gt;: If the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
-   the new resource is the same as the &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; of the
-   &lt;a href=#active-document&gt;active document&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being navigated, ignoring any
-   &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; components of those &lt;a href=#url title=URL&gt;URLs&lt;/a&gt;, and the new resource is to be fetched using HTTP GET &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt;, and the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
-   the new resource has a &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component (even if it
+&lt;!--CLEANUP--&gt;
+   &lt;li id=navigate-fragid-step&gt;&lt;p&gt;&lt;i&gt;Fragment identifiers&lt;/i&gt;: Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
+   the new resource and the &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; of the
+   &lt;a href=#active-document&gt;active document&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being navigated. If all the components of the resulting &lt;a href=#parsed-url title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/a&gt; , ignoring any
+   &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; components, are identical, and the new resource is to be fetched using HTTP GET &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt;, and the &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; of
+   the new resource has a &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; component that is not null (even if it
    is empty), then &lt;a href=#scroll-to-fragid title=navigate-fragid&gt;navigate to that fragment identifier&lt;/a&gt; and
    abort these steps.&lt;/li&gt;
 
@@ -68231,12 +67660,14 @@
   encoding is established, the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt; must be set to that
   character encoding.&lt;/p&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;If the root element, as parsed according to the XML specifications cited above, is found to be
   an &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; element with an attribute &lt;code title=attr-html-manifest&gt;&lt;a href=#attr-html-manifest&gt;manifest&lt;/a&gt;&lt;/code&gt;
   whose value is not the empty string, then, as soon as the element is &lt;a href=#insert-an-element-into-a-document title=&quot;insert an
   element into a document&quot;&gt;inserted into the document&lt;/a&gt;, the user agent must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the value of that attribute relative to that element, and if
-  that is successful, must run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
-  algorithm&lt;/a&gt; with the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; with any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component removed as the manifest URL, and passing in
+  that is successful, must apply the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; algorithm to the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set to obtain &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;, and then run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
+  algorithm&lt;/a&gt; with &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;
+  as the manifest URL, passing in
   the newly-created &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;. Otherwise, if the attribute is absent, its value is the
   empty string, or resolving its value fails, then as soon as the root element is &lt;a href=#insert-an-element-into-a-document title=&quot;insert an element into a document&quot;&gt;inserted into the document&lt;/a&gt;, the user agent must
   run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection algorithm&lt;/a&gt; with no
@@ -68478,8 +67909,8 @@
   processing model must be followed to determine what &lt;a href=#the-indicated-part-of-the-document&gt;the indicated part of the
   document&lt;/a&gt; is.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#parse-a-url title=&quot;parse a url&quot;&gt;Parse&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;fragid&lt;/var&gt; be the &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component of the
-   URL.&lt;/li&gt;&lt;!-- parsing can't fail, since we checked earlier on when navigating --&gt;
+  &lt;ol&gt;&lt;!--CLEANUP--&gt;&lt;li&gt;&lt;p&gt;Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the &lt;a href=#url&gt;URL&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;fragid&lt;/var&gt; be the &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; component of the
+   resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;.&lt;/li&gt;&lt;!-- parsing can't fail, since we checked earlier on when navigating --&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;fragid&lt;/var&gt; is the empty string, then &lt;a href=#the-indicated-part-of-the-document&gt;the indicated part of the
    document&lt;/a&gt; is the top of the document; stop the algorithm here.&lt;/li&gt;
@@ -69611,7 +69042,7 @@
   &lt;/div&gt;
 
 
-
+&lt;!--CLEANUP--&gt;
   &lt;h5 id=writing-cache-manifests&gt;&lt;span class=secno&gt;6.7.3.2 &lt;/span&gt;Writing cache manifests&lt;/h5&gt;
 
   &lt;p&gt;Manifests must be served using the
@@ -69771,10 +69202,10 @@
   which another namespace in the &lt;a href=#concept-appcache-onlinewhitelist title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt; is
   a &lt;a href=#prefix-match&gt;prefix match&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Relative URLs must be given relative to the manifest's own
-  URL. All URLs in the manifest must have the same &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; as the manifest itself
-  (either explicitly or implicitly, through the use of relative
-  URLs).&lt;/p&gt;
+  &lt;p&gt;&lt;a href=#relative-url title=&quot;relative URL&quot;&gt;Relative URLs&lt;/a&gt; must be given relative to the manifest's own
+  URL. All URLs in the manifest must have the same &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; as the manifest itself
+  (either explicitly or implicitly, through the use of &lt;a href=#relative-url title=&quot;relative url&quot;&gt;relative
+  URLs&lt;/a&gt;). &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;URLs in manifests must not have fragment identifiers (i.e. the
   U+0023 NUMBER SIGN character isn't allowed in URLs in
@@ -69785,6 +69216,7 @@
   matched by &lt;a href=#prefix-match&gt;prefix match&lt;/a&gt;.&lt;/p&gt;
 
 
+&lt;!--CLEANUP--&gt;
   &lt;div class=impl&gt;
 
   &lt;h5 id=parsing-cache-manifests&gt;&lt;span class=secno&gt;6.7.3.3 &lt;/span&gt;Parsing cache manifests&lt;/h5&gt;
@@ -69792,7 +69224,7 @@
   &lt;p&gt;When a user agent is to &lt;dfn id=parse-a-manifest&gt;parse a manifest&lt;/dfn&gt;, it means
   that the user agent must run the following steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;The user agent must decode the byte stream corresponding
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Decode the byte stream corresponding
    with the manifest to be parsed &lt;a href=#decoded-as-utf-8,-with-error-handling title=&quot;decoded as UTF-8, with
    error handling&quot;&gt;as UTF-8, with error handling&lt;/a&gt;. &lt;!--All
    U+0000 NULL characters must be replaced by U+FFFD REPLACEMENT
@@ -69803,6 +69235,10 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; be the &lt;a href=#absolute-url&gt;absolute
    URL&lt;/a&gt; representing the manifest.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; steps to the &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt;, so that the
+   components from its &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; can be used by the subseqent steps of this
+   algorithm.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; be an initially empty
    list of &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/a&gt; for &lt;a href=#concept-appcache-explicit title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt;.&lt;/li&gt;
 
@@ -69942,17 +69378,15 @@
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;If the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; has a different
-      &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component than
-      the manifest's URL (compared in an &lt;a href=#ascii-case-insensitive&gt;ASCII
-      case-insensitive&lt;/a&gt; manner), then jump back to the step
+      &lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a different
+      &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component than
+      &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; (the manifest's URL), then jump back to the step
       labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Drop the &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-      component of the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, if it has
-      one.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt;
+      algorithm to the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;, with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;Add the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -69974,18 +69408,22 @@
       jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt; &lt;!-- SECURITY
       --&gt;
 
-      &lt;p&gt;Drop any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-      components of the resulting &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute
-      URLs&lt;/a&gt;.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; be the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt;
+      algorithm to the first resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;, with the &lt;i&gt;exclude fragment
+      flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;If the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; corresponding to &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; be the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt;
+      algorithm to the second resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;, with the &lt;i&gt;exclude fragment
+      flag&lt;/i&gt; set.&lt;/p&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback
       URLs&lt;/var&gt; mapping as a &lt;a href=#concept-appcache-fallback-ns title=concept-appcache-fallback-ns&gt;fallback namespace&lt;/a&gt;,
       then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Otherwise, add the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; corresponding to
+      &lt;p&gt;Otherwise, add 
       &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;fallback
       URLs&lt;/var&gt; mapping as a &lt;a href=#concept-appcache-fallback-ns title=concept-appcache-fallback-ns&gt;fallback namespace&lt;/a&gt;,
-      mapped to the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; corresponding to &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;a href=#concept-appcache-fallback title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.&lt;/p&gt;
+      mapped to &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;a href=#concept-appcache-fallback title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -70004,17 +69442,15 @@
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;If the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; has a different
-      &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component than
-      the manifest's URL (compared in an &lt;a href=#ascii-case-insensitive&gt;ASCII
-      case-insensitive&lt;/a&gt; manner), then jump back to the step
+      &lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a different
+      &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component than
+      &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; (the manifest's URL), then jump back to the step
       labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Drop the &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-      component of the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, if it has
-      one.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt;
+      algorithm to the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;, with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;Add the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to the &lt;var title=&quot;&quot;&gt;online whitelist namespaces&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;online whitelist namespaces&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -70299,10 +69735,11 @@
       &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the display of some sort of user interface indicating to
       the user that the user agent failed to save the application for offline use.&lt;/p&gt;
 
+&lt;!--CLEANUP--&gt;
       &lt;p&gt;Otherwise, associate the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; for this entry with &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;; store the resource for this entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, if it
-      isn't already there, and categorize its entry as a &lt;a href=#concept-appcache-master title=concept-appcache-master&gt;master entry&lt;/a&gt;. If the resource's &lt;a href=#url&gt;URL&lt;/a&gt; has a
-      &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component, it must be removed from the
-      entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; (application caches never include fragment
+      isn't already there, and categorize its entry as a &lt;a href=#concept-appcache-master title=concept-appcache-master&gt;master entry&lt;/a&gt;. If applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the resource's &lt;a href=#url&gt;URL&lt;/a&gt; results in a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; that has a non-null
+      &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; component, the &lt;a href=#url&gt;URL&lt;/a&gt; used for the
+      entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; must instead be the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained from applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; algorith, to the &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set (application caches never include fragment
       identifiers).&lt;/p&gt;
 
      &lt;/li&gt;
@@ -70823,8 +70260,8 @@
 
   &lt;ol&gt;&lt;!--FETCH--&gt;&lt;li&gt;&lt;p&gt;If the resource is not to be fetched using the HTTP GET
    mechanism &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or
-   equivalent&lt;/a&gt;, or if its &lt;a href=#url&gt;URL&lt;/a&gt; has a different &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component than the
-   &lt;a href=#application-cache&gt;application cache&lt;/a&gt;'s &lt;a href=#concept-appcache-manifest title=concept-appcache-manifest&gt;manifest&lt;/a&gt;, then
+   equivalent&lt;/a&gt;, or if applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to both its &lt;a href=#url&gt;URL&lt;/a&gt; and the
+   &lt;a href=#application-cache&gt;application cache&lt;/a&gt;'s &lt;a href=#concept-appcache-manifest title=concept-appcache-manifest&gt;manifest&lt;/a&gt;'s URL results in two &lt;a href=#parsed-url title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/a&gt; with different &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; components, then
    &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resource normally and abort these
    steps.&lt;/li&gt;
 
@@ -71323,6 +70760,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;div class=impl&gt;
 
@@ -71469,7 +70907,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt;, set when the script is created, used to
-    resolve relative URLs. &lt;span id=sbu-not-copy title=&quot;&quot;&gt;If the
+    resolve &lt;a href=#relative-url title=&quot;relative url&quot;&gt;relative URLs&lt;/a&gt;. &lt;span id=sbu-not-copy title=&quot;&quot;&gt;If the
     base URL is set from another source, e.g. a &lt;a href=#document-base-url&gt;document base
     URL&lt;/a&gt;, then the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt; must follow
     the source, so that if the source's changes, so does the
@@ -73949,6 +73387,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;h5 id=custom-handlers&gt;&lt;span class=secno&gt;7.5.1.3 &lt;/span&gt;Custom scheme and content handlers&lt;/h5&gt;
 
@@ -74171,11 +73610,10 @@
     resulting URL using the GET method (&lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt; for
     non-HTTP URLs).&lt;/p&gt;
 
-    &lt;p&gt;To get the escaped version of the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
-    the content in question, the user agent must replace every
-    character in that &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that doesn't match the
-    &lt;query&gt; production defined in RFC 3986 by the
-    percent-encoded form of that character. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;To get the escaped version of the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of the content in question, the
+    user agent must replace every character in that &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that is not a
+    character in the URL &lt;a href=#default-encode-set&gt;default encode set&lt;/a&gt; with the result of &lt;a href=#utf-8-percent-encode title=&quot;UTF-8 percent
+    encode&quot;&gt;UTF-8 percent encoding&lt;/a&gt; that character.&lt;/p&gt;
 
     &lt;div class=example&gt;
 
@@ -74695,8 +74133,8 @@
 
     &lt;li&gt;&lt;p&gt;If this fails, return 0 and abort these steps.&lt;/li&gt;
 
-    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host2&lt;/var&gt; be be the &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component of the resulting
-    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
+    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host2&lt;/var&gt; be be the &lt;a href=#concept-url-host title=concept-url-host&gt;host&lt;/a&gt; component of the resulting
+    &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;.&lt;/li&gt;
 
     &lt;li&gt;
 
@@ -74710,10 +74148,8 @@
      &lt;var title=&quot;&quot;&gt;host2&lt;/var&gt; after their common suffix are not the
      same, then return 0 and abort these steps.&lt;/p&gt;
 
-     &lt;p&gt;Domain labels must be compared after applying the IDNA ToASCII
-     algorithm to them, with both the AllowUnassigned and
-     UseSTD3ASCIIRules flags set, in an &lt;a href=#ascii-case-insensitive&gt;ASCII
-     case-insensitive&lt;/a&gt; manner. &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+     &lt;!-- host1 is ascii here because origins are ascii. host2 is ascii because resolve urls
+     punycodes idna. --&gt;
 
     &lt;/li&gt;
 
@@ -78762,6 +78198,7 @@
   &lt;/div&gt;
 --&gt;
 
+&lt;!--CLEANUP--&gt;
 
 &lt;!--ADD-TOPIC:Security--&gt;
   &lt;div class=impl&gt;
@@ -78791,7 +78228,7 @@
 
   &lt;p&gt;User agents should filter potentially active (scripted) content
   (e.g. HTML) when it is dragged and when it is dropped, using a
-  whitelist of known-safe features. Similarly, relative URLs should be
+  whitelist of known-safe features. Similarly, &lt;a href=#relative-url title=&quot;relative url&quot;&gt;relative URLs&lt;/a&gt; should be
   turned into absolute URLs to avoid references changing in unexpected
   ways. This specification does not specify how this is performed.&lt;/p&gt;
 
@@ -80412,7 +79849,7 @@
   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;Event handler&lt;/a&gt; &lt;th&gt;&lt;a href=#event-handler-event-type&gt;Event handler event type&lt;/a&gt;
    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-abstractworker-onerror title=handler-AbstractWorker-onerror&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-error&gt;error&lt;/code&gt;
 &lt;!-- v2-onclose    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-AbstractWorker-onclose&quot;&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-worker-close&quot;&gt;close&lt;/code&gt; --&gt;
-  &lt;/table&gt;&lt;h5 id=dedicated-workers-and-the-worker-interface&gt;&lt;span class=secno&gt;9.2.6.2 &lt;/span&gt;Dedicated workers and the &lt;code&gt;&lt;a href=#worker&gt;Worker&lt;/a&gt;&lt;/code&gt; interface&lt;/h5&gt;
+  &lt;/table&gt;&lt;!--CLEANUP--&gt;&lt;h5 id=dedicated-workers-and-the-worker-interface&gt;&lt;span class=secno&gt;9.2.6.2 &lt;/span&gt;Dedicated workers and the &lt;code&gt;&lt;a href=#worker&gt;Worker&lt;/a&gt;&lt;/code&gt; interface&lt;/h5&gt;
 
   &lt;pre class=idl&gt;[&lt;a href=#dom-worker title=dom-Worker&gt;Constructor&lt;/a&gt;(DOMString scriptURL)]
 interface &lt;dfn id=worker&gt;Worker&lt;/dfn&gt; : &lt;a href=#eventtarget&gt;EventTarget&lt;/a&gt; {
@@ -80481,8 +79918,8 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component of
-    the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is not &quot;&lt;code title=data-protocol&gt;data&lt;/code&gt;&quot;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of
+    &lt;p&gt;If the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component of
+    the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; is not &quot;&lt;code title=data-protocol&gt;data&lt;/code&gt;&quot;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of
     the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is not the &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt; as the origin of the &lt;a href=#entry-script&gt;entry
     script&lt;/a&gt;, then throw a &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception
     and abort these steps.&lt;/p&gt;
@@ -80605,7 +80042,8 @@
    exception.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; be the
-   resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
+   resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; and &lt;var title=&quot;&quot;&gt;parsed scriptURL&lt;/var&gt; be the
+   resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; be the value of the second
    argument, or the empty string if the second argument was
@@ -80613,8 +80051,8 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component of
-    &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; is not &quot;&lt;code title=data-protocol&gt;data&lt;/code&gt;&quot;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of
+    &lt;p&gt;If the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component of
+    &lt;var title=&quot;&quot;&gt;parsed scriptURL&lt;/var&gt; is not &quot;&lt;code title=data-protocol&gt;data&lt;/code&gt;&quot;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of
     &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; is not the &lt;a href=#same-origin title=&quot;same
     origin&quot;&gt;same&lt;/a&gt; as the origin of the &lt;a href=#entry-script&gt;entry
     script&lt;/a&gt;, then throw a &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception
@@ -80966,16 +80404,9 @@
   &lt;h4 id=worker-locations&gt;&lt;span class=secno&gt;9.3.4 &lt;/span&gt;Worker locations&lt;/h4&gt;
 
   &lt;pre class=idl&gt;interface &lt;dfn id=workerlocation&gt;WorkerLocation&lt;/dfn&gt; {
-  // &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;
   stringifier readonly attribute DOMString &lt;a href=#dom-workerlocation-href title=dom-WorkerLocation-href&gt;href&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-protocol title=dom-WorkerLocation-protocol&gt;protocol&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-host title=dom-WorkerLocation-host&gt;host&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-hostname title=dom-WorkerLocation-hostname&gt;hostname&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-port title=dom-WorkerLocation-port&gt;port&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-pathname title=dom-WorkerLocation-pathname&gt;pathname&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-search title=dom-WorkerLocation-search&gt;search&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-hash title=dom-WorkerLocation-hash&gt;hash&lt;/a&gt;;
-};&lt;/pre&gt;
+};
+&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt; implements &lt;a href=#urlutilsreadonly&gt;URLUtilsReadOnly&lt;/a&gt;;&lt;/pre&gt;
 
   &lt;p&gt;A &lt;code&gt;&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt;&lt;/code&gt; object represents an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; set at its
   creation.&lt;/p&gt;
@@ -80983,13 +80414,10 @@
   &lt;p&gt;The &lt;dfn id=dom-workerlocation-href title=dom-WorkerLocation-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt; attribute must return the
   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that the object represents.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt;&lt;/code&gt; interface also has the complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition
-  IDL attributes&lt;/a&gt;, &lt;dfn id=dom-workerlocation-protocol title=dom-WorkerLocation-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-host title=dom-WorkerLocation-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-port title=dom-WorkerLocation-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-hostname title=dom-WorkerLocation-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-pathname title=dom-WorkerLocation-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-search title=dom-WorkerLocation-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-workerlocation-hash title=dom-WorkerLocation-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for
-  &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;, with the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; being the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that the object
-  represents (same as the &lt;code title=dom-WorkerLocation-href&gt;&lt;a href=#dom-workerlocation-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute), and the
-  &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; being a no-op, since the attributes
-  are defined to be readonly.
-  &lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt;&lt;/code&gt; interface also supports the &lt;code&gt;&lt;a href=#urlutilsreadonly&gt;URLUtilsReadOnly&lt;/a&gt;&lt;/code&gt;
+  interface. The &lt;a href=#concept-uu-input title=concept-uu-input&gt;input&lt;/a&gt; is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that
+  the object represents (same as the &lt;code title=dom-WorkerLocation-href&gt;&lt;a href=#dom-workerlocation-href&gt;href&lt;/a&gt;&lt;/code&gt;
+  attribute). &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt;&lt;/code&gt; interface must only be &lt;a href=#expose title=expose&gt;exposed&lt;/a&gt; if
   the &lt;a href=#javascript-global-environment&gt;JavaScript global environment&lt;/a&gt; is a &lt;a href=#worker-environment&gt;worker environment&lt;/a&gt;.&lt;/p&gt;
@@ -82602,6 +82030,7 @@
   <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=17264">https://www.w3.org/Bugs/Public/show_bug.cgi?id=17264</A> --&gt;
 
 
+&lt;!--CLEANUP--&gt;
   &lt;h4 id=parsing-websocket-urls&gt;&lt;span class=secno&gt;10.3.5 &lt;/span&gt;Parsing WebSocket URLs&lt;/h4&gt;
 
   &lt;p&gt;The steps to &lt;dfn id=&quot;parse-a-websocket-url's-components&quot;&gt;parse a WebSocket URL's components&lt;/dfn&gt; from a string &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; are as follows. These steps return either a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag,
@@ -82621,34 +82050,34 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; does not have a &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; does not have a &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt;
    component whose value, when &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt;, is either &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot; or &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, then fail this algorithm.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a non-null &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt;
    component, then fail this algorithm.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
-   is &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to false; otherwise, the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component is &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to true.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component of the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+   is &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to false; otherwise, the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component is &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to true.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the value of the &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, &lt;a href=#converted-to-ascii-lowercase&gt;converted to
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the value of the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;'s &lt;a href=#concept-url-host title=concept-url-host&gt;host&lt;/a&gt; component, &lt;a href=#converted-to-ascii-lowercase&gt;converted to
    ASCII lowercase&lt;/a&gt;.&lt;/li&gt; &lt;!-- at this point this is Punycode-encoded already --&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-port title=url-port&gt;&lt;port&gt;&lt;/a&gt; component,
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a &lt;a href=#concept-url-port title=concept-url-port&gt;port&lt;/a&gt; component that is not the empty string,
    then let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be that component's value; otherwise, there is no explicit &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If there is no explicit &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then: if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is
    false, let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be 80, otherwise let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be
    443.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; be the value of the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component (which might be empty) of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt; &lt;!-- at this point this is UTF-8 encoded and %-escaped --&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; be the value of the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;'s &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; component (which might be empty).&lt;/li&gt; &lt;!-- at this point this is UTF-8 encoded and percent encoded --&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; is the empty string, set it to a single character
    U+002F SOLIDUS (/).&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component,
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a non-null &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt; component,
    then append a single U+003F QUESTION MARK character (?) to &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;,
-   followed by the value of the &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component.&lt;/li&gt;
-   &lt;!-- at this point this is UTF-8 encoded and %-escaped --&gt;
+   followed by the value of the &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt; component.&lt;/li&gt;
+   &lt;!-- at this point this is UTF-8 encoded and percent encoded --&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource
    name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/li&gt;
@@ -85045,7 +84474,7 @@
   &lt;p class=note&gt;Whether the attributes in the table above are
   conforming or not is defined by other specifications (e.g. the SVG
   and MathML specifications); this section only describes the syntax
-  rules if the attributes are serialised using the HTML syntax.&lt;/p&gt;
+  rules if the attributes are serialized using the HTML syntax.&lt;/p&gt;
 
 
   &lt;h5 id=optional-tags&gt;&lt;span class=secno&gt;12.1.2.4 &lt;/span&gt;Optional tags&lt;/h5&gt;
@@ -89430,9 +88859,8 @@
     url&quot;&gt;resolve&lt;/a&gt; the value of that attribute to an
     &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, relative to the newly created element,
     and if that is successful, run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
-    algorithm&lt;/a&gt; with the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; with
-    any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component
-    removed; otherwise, if there is no such attribute, or its value is
+    algorithm&lt;/a&gt; with the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; algorithm to
+    the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set; otherwise, if there is no such attribute, or its value is
     the empty string, or resolving its value fails, run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
     algorithm&lt;/a&gt; with no manifest. The algorithm must be passed
     the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
@@ -102411,12 +101839,6 @@
    &lt;dt id=refsRFC3864&gt;[RFC3864]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc3864">http://tools.ietf.org/html/rfc3864</A>&gt;Registration Procedures for Message Header Fields&lt;/a&gt;&lt;/cite&gt;, G. Klyne, M. Nottingham, J. Mogul. IETF.&lt;/dd&gt;
 
-   &lt;dt id=refsRFC3986&gt;[RFC3986]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc3986">http://tools.ietf.org/html/rfc3986</A>&gt;Uniform Resource Identifier (URI): Generic Syntax&lt;/a&gt;&lt;/cite&gt;, T. Berners-Lee, R. Fielding, L. Masinter. IETF.&lt;/dd&gt;
-
-   &lt;dt id=refsRFC3987&gt;[RFC3987]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc3987">http://tools.ietf.org/html/rfc3987</A>&gt;Internationalized Resource Identifiers (IRIs)&lt;/a&gt;&lt;/cite&gt;, M. D&uuml;rst, M. Suignard. IETF.&lt;/dd&gt;
-
    &lt;dt id=refsRFC4281&gt;[RFC4281]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc4281">http://tools.ietf.org/html/rfc4281</A>&gt;The Codecs Parameter for &quot;Bucket&quot; Media Types&lt;/a&gt;&lt;/cite&gt;, R. Gellens, D. Singer, P. Frojdh. IETF.&lt;/dd&gt;
 
@@ -102471,6 +101893,9 @@
    &lt;dt id=refsUNIVCHARDET&gt;[UNIVCHARDET]&lt;/dt&gt;
    &lt;dd&gt;(Non-normative) &lt;cite&gt;&lt;a href=<A HREF="http://www.mozilla.org/projects/intl/UniversalCharsetDetection.html">http://www.mozilla.org/projects/intl/UniversalCharsetDetection.html</A>&gt;A composite approach to language/encoding detection&lt;/a&gt;&lt;/cite&gt;, S. Li, K. Momoi. Netscape. In &lt;cite&gt;Proceedings of the 19th International Unicode Conference&lt;/cite&gt;.&lt;/dd&gt;
 
+   &lt;dt id=refsURL&gt;[URL]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://url.spec.whatwg.org/">http://url.spec.whatwg.org/</A>&gt;URL&lt;/a&gt;&lt;/cite&gt;, A. van Kestern. WHATWG.&lt;/dd&gt;
+
    &lt;dt id=refsUTF7&gt;[UTF7]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc2152">http://tools.ietf.org/html/rfc2152</A>&gt;UTF-7: A Mail-Safe Transformation Format of Unicode&lt;/a&gt;&lt;/cite&gt;, D. Goldsmith, M. Davis. IETF.&lt;/dd&gt;
 

Modified: index
===================================================================
--- index	2013-02-08 07:06:47 UTC (rev 7709)
+++ index	2013-02-09 02:07:29 UTC (rev 7710)
@@ -248,7 +248,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 8 February 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 9 February 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -358,12 +358,8 @@
    &lt;li&gt;&lt;a href=#urls&gt;&lt;span class=secno&gt;2.5 &lt;/span&gt;URLs&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#terminology-0&gt;&lt;span class=secno&gt;2.5.1 &lt;/span&gt;Terminology&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#parsing-urls&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Parsing URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#base-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Base URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#resolving-urls&gt;&lt;span class=secno&gt;2.5.4 &lt;/span&gt;Resolving URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#url-manipulation-and-creation&gt;&lt;span class=secno&gt;2.5.5 &lt;/span&gt;URL manipulation and creation&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.5.6 &lt;/span&gt;Dynamic changes to base URLs&lt;/a&gt;&lt;/li&gt;
-     &lt;li&gt;&lt;a href=#interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.5.7 &lt;/span&gt;Interfaces for URL manipulation&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#resolving-urls&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Resolving URLs&lt;/a&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;a href=#dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Dynamic changes to base URLs&lt;/a&gt;&lt;/ol&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=#fetching-resources&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Fetching resources&lt;/a&gt;
     &lt;ol&gt;
      &lt;li&gt;&lt;a href=#terminology-1&gt;&lt;span class=secno&gt;2.6.1 &lt;/span&gt;Terminology&lt;/a&gt;&lt;/li&gt;
@@ -2000,7 +1996,7 @@
 
   &lt;pre&gt;var a = &lt;a href=#document title=Document&gt;document&lt;/a&gt;.&lt;a href=#dom-document-links title=dom-document-links&gt;links&lt;/a&gt;[0]; // obtain the first link in the document
 a.&lt;a href=#dom-a-href title=dom-a-href&gt;href&lt;/a&gt; = 'sample.html'; // change the destination URL of the link
-a.&lt;a href=#dom-uda-protocol title=dom-uda-protocol&gt;protocol&lt;/a&gt; = 'https'; // change just the scheme part of the URL
+a.&lt;a href=#dom-url-protocol title=dom-url-protocol&gt;protocol&lt;/a&gt; = 'https'; // change just the scheme part of the URL
 a.setAttribute('href', '<A HREF="http://example.com/">http://example.com/</A>'); // change the content attribute directly&lt;/pre&gt;
 
   &lt;p&gt;Since DOM trees are used as the way to represent HTML documents when they are processed and
@@ -2848,8 +2844,8 @@
   compression format used was not supported, even if the implementation could determine the
   dimensions of the movie from the file's metadata.&lt;/p&gt;
 
-  &lt;p&gt;What some specifications, in particular the HTTP and URI specifications, refer to as a
-  &lt;i&gt;representation&lt;/i&gt; is referred to in this specification as a &lt;dfn title=&quot;&quot;&gt;resource&lt;/dfn&gt;. &lt;a href=#refsHTTP&gt;[HTTP]&lt;/a&gt; &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+  &lt;p&gt;What some specifications, in particular the HTTP specification, refer to as a
+  &lt;i&gt;representation&lt;/i&gt; is referred to in this specification as a &lt;dfn title=&quot;&quot;&gt;resource&lt;/dfn&gt;. &lt;a href=#refsHTTP&gt;[HTTP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The term &lt;dfn id=mime-type&gt;MIME type&lt;/dfn&gt; is used to refer to what is sometimes called an &lt;i&gt;Internet media
   type&lt;/i&gt; in protocol literature. The term &lt;i&gt;media type&lt;/i&gt; in this specification is used to refer
@@ -3408,15 +3404,40 @@
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;URIs, IRIs, IDNA&lt;/dt&gt;
+   &lt;dt&gt;URLs&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Implementations must support the semantics of &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; defined in the
-    URI and IRI specifications, as well as the semantics of IDNA domain names defined in the
-    &lt;cite&gt;Internationalizing Domain Names in Applications (IDNA)&lt;/cite&gt; specification. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt; &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;
+    &lt;p&gt;The following terms are defined in the URL standard: &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;/dd&gt;
+    &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=url&gt;URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=absolute-url&gt;Absolute URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=relative-url&gt;Relative URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=concept-url-scheme-relative title=concept-url-scheme-relative&gt;Relative schemes&lt;/dfn&gt;
+     &lt;li&gt;The &lt;dfn id=url-parser&gt;URL parser&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=parsed-url&gt;Parsed URL&lt;/dfn&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-scheme-data title=&quot;concept-url-scheme data&quot;&gt;scheme data&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-username title=concept-url-username&gt;username&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-password title=concept-url-password&gt;password&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-host title=concept-url-host&gt;host&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-port title=concept-url-port&gt;port&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-path title=concept-url-path&gt;path&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-query title=concept-url-query&gt;query&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/dfn&gt; component of a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+     &lt;li&gt;&lt;dfn id=concept-url-parse-error title=concept-url-parse-error&gt;Parse errors&lt;/dfn&gt; from the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt;
+     &lt;li&gt;The &lt;dfn id=url-serializer&gt;URL serializer&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=default-encode-set&gt;Default encode set&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=percent-encode&gt;Percent encode&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=utf-8-percent-encode&gt;UTF-8 percent encode&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=urlutils&gt;&lt;code&gt;URLUtils&lt;/code&gt;&lt;/dfn&gt; interface
+     &lt;li&gt;&lt;dfn id=urlutilsreadonly&gt;&lt;code&gt;URLUtilsReadOnly&lt;/code&gt;&lt;/dfn&gt; interface
+     &lt;li&gt;&lt;dfn id=dom-url-protocol title=dom-url-protocol&gt;&lt;code&gt;protocol&lt;/code&gt; attribute&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn id=concept-uu-base title=concept-uu-base&gt;Base&lt;/dfn&gt; for &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt;
+     &lt;li&gt;&lt;dfn id=concept-uu-input title=concept-uu-input&gt;Input&lt;/dfn&gt; for &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt;
+     &lt;li&gt;&lt;dfn id=concept-uu-query-encoding title=concept-uu-query-encoding&gt;Query encoding&lt;/dfn&gt; for &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt;
+     &lt;li&gt;&lt;dfn id=concept-uu-update title=concept-uu-update&gt;Update steps&lt;/dfn&gt; for &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt;
+    &lt;/ul&gt;&lt;/dd&gt;
 
 
    &lt;dt&gt;Cookies&lt;/dt&gt;
@@ -6411,220 +6432,47 @@
 
   &lt;h3 id=urls&gt;&lt;span class=secno&gt;2.5 &lt;/span&gt;URLs&lt;/h3&gt;
 
-  &lt;p&gt;This specification defines the term &lt;a href=#url&gt;URL&lt;/a&gt;, and defines
-  various algorithms for dealing with URLs, because for historical
-  reasons the rules defined by the URI and IRI specifications are not
-  a complete description of what HTML user agents need to implement to
-  be compatible with Web content.&lt;/p&gt;
-
-  &lt;p class=note&gt;The term &quot;URL&quot; in this specification is used in a
-  manner distinct from the precise technical meaning it is given in
-  RFC 3986. Readers familiar with that RFC will find it easier to read
-  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
-  herein is really called something else altogether. This is a
-  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-
   &lt;h4 id=terminology-0&gt;&lt;span class=secno&gt;2.5.1 &lt;/span&gt;Terminology&lt;/h4&gt;
 
-  &lt;p&gt;A &lt;dfn id=url&gt;URL&lt;/dfn&gt; is a string used to identify a resource.&lt;/p&gt;
+  &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is a &lt;dfn id=valid-url&gt;valid URL&lt;/dfn&gt; if it conforms to the authoring conformance
+  requirements in the URL standard. &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is a &lt;dfn id=valid-url&gt;valid URL&lt;/dfn&gt; if at least one of
-  the following conditions holds:&lt;/p&gt;
+  &lt;p&gt;A string is a &lt;dfn id=valid-non-empty-url&gt;valid non-empty URL&lt;/dfn&gt; if it is a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt; but it is not
+  the empty string.&lt;/p&gt;
 
-  &lt;ul&gt;&lt;li&gt;&lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; is a valid URI reference &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;.&lt;/li&gt;
+  &lt;p&gt;A string is a &lt;dfn id=valid-url-potentially-surrounded-by-spaces&gt;valid URL potentially surrounded by spaces&lt;/dfn&gt; if, after &lt;a href=#strip-leading-and-trailing-whitespace title=&quot;strip leading and trailing whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt;
+  from it, it is a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; is a valid IRI reference and it has no
-   query component. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+  &lt;p&gt;A string is a &lt;dfn id=valid-non-empty-url-potentially-surrounded-by-spaces&gt;valid non-empty URL potentially surrounded by spaces&lt;/dfn&gt; if, after &lt;a href=#strip-leading-and-trailing-whitespace title=&quot;strip leading and trailing whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt;
+  from it, it is a &lt;a href=#valid-non-empty-url&gt;valid non-empty URL&lt;/a&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; is a valid IRI reference and its query
-   component contains no unescaped non-ASCII characters. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+  &lt;p&gt;This specification defines the URL &lt;dfn id=about:legacy-compat&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved,
+  though unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URL, for use in &lt;a href=#syntax-doctype title=syntax-doctype&gt;DOCTYPE&lt;/a&gt;s in &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt; when needed for
+  compatibility with XML tools. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#url&gt;URL&lt;/a&gt; is a valid IRI reference and the &lt;a href=&quot;#document's-character-encoding&quot; title=&quot;document's character encoding&quot;&gt;character encoding&lt;/a&gt; of
-   the URL's &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is UTF-8 or &lt;a href=#a-utf-16-encoding&gt;a UTF-16
-   encoding&lt;/a&gt;. &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/li&gt;
+  &lt;p&gt;This specification defines the URL &lt;dfn id=about:srcdoc&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URL, that is used as &lt;a href=&quot;#the-document's-address&quot;&gt;the document's
+  address&lt;/a&gt; of &lt;a href=#an-iframe-srcdoc-document title=&quot;an iframe srcdoc document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; documents&lt;/a&gt;. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;/ul&gt;&lt;p&gt;A string is a &lt;dfn id=valid-non-empty-url&gt;valid non-empty URL&lt;/dfn&gt; if it is a
-  &lt;a href=#valid-url&gt;valid URL&lt;/a&gt; but it is not the empty string.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=fallback-base-url&gt;fallback base URL&lt;/dfn&gt; of a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is the &lt;a href=#absolute-url&gt;absolute
+  URL&lt;/a&gt; obtained by running these substeps:&lt;/p&gt;
 
-  &lt;p&gt;A string is a &lt;dfn id=valid-url-potentially-surrounded-by-spaces&gt;valid URL potentially surrounded by
-  spaces&lt;/dfn&gt; if, after &lt;a href=#strip-leading-and-trailing-whitespace title=&quot;strip leading and trailing
-  whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt; from
-  it, it is a &lt;a href=#valid-url&gt;valid URL&lt;/a&gt;.&lt;/p&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is &lt;a href=#an-iframe-srcdoc-document&gt;an &lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; document&lt;/a&gt;, then return the &lt;a href=#document-base-url&gt;document base
+   URL&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;a href=#browsing-context-container&gt;browsing context
+   container&lt;/a&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; and abort these steps.&lt;/li&gt;
 
-  &lt;p&gt;A string is a &lt;dfn id=valid-non-empty-url-potentially-surrounded-by-spaces&gt;valid non-empty URL potentially surrounded by
-  spaces&lt;/dfn&gt; if, after &lt;a href=#strip-leading-and-trailing-whitespace title=&quot;strip leading and trailing
-  whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/a&gt; from
-  it, it is a &lt;a href=#valid-non-empty-url&gt;valid non-empty URL&lt;/a&gt;.&lt;/p&gt;
-
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn id=about:legacy-compat&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;a href=#syntax-doctype title=syntax-doctype&gt;DOCTYPE&lt;/a&gt;s in &lt;a href=#html-documents&gt;HTML
-  documents&lt;/a&gt; when needed for compatibility with XML tools. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn id=about:srcdoc&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
-  &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; of &lt;a href=#an-iframe-srcdoc-document title=&quot;an iframe srcdoc
-  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; documents&lt;/a&gt;. &lt;a href=#refsABOUT&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
-
-
-  &lt;div class=impl&gt;
-
-  &lt;h4 id=parsing-urls&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Parsing URLs&lt;/h4&gt;
-
-  &lt;p&gt;To &lt;dfn id=parse-a-url&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
-  component parts, the user agent must use the following steps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#strip-leading-and-trailing-whitespace&gt;Strip leading and trailing whitespace&lt;/a&gt; from &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt;
-
    &lt;li&gt;
 
-    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC
-    3986, with the following exceptions:&lt;/p&gt;
-
-    &lt;ul&gt;&lt;li&gt;Add all characters with code points less than or equal to
-     U+0020 or greater than or equal to U+007F to the
-     &lt;unreserved&gt; production.&lt;/li&gt;
-
-     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E,
-     U+0060, and U+007B .. U+007D to the &lt;unreserved&gt;
-     production.
-      &lt;!--
-       0022 QUOTATION MARK
-       003C LESS-THAN SIGN
-       003E GREATER-THAN SIGN
-       005B LEFT SQUARE BRACKET
-       005C REVERSE SOLIDUS
-       005D RIGHT SQUARE BRACKET
-       005E CIRCUMFLEX ACCENT
-       0060 GRAVE ACCENT
-       007B LEFT CURLY BRACKET
-       007C VERTICAL LINE
-       007D RIGHT CURLY BRACKET
-      --&gt;
-     &lt;/li&gt;
-
-     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second
-     alternative way of matching the &lt;pct-encoded&gt; production,
-     except when the &lt;pct-encoded&gt; is used in the
-     &lt;reg-name&gt; production.&lt;/li&gt;
-
-     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters
-     allowed in the &lt;fragment&gt; production.&lt;/li&gt;
-
-     &lt;!-- some browsers also have other differences, e.g. Mozilla
-     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
-     is &quot;ftp&quot;. --&gt;
-
-    &lt;/ul&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the
-    &lt;URI-reference&gt; production, even after the above changes are
-    made to the ABNF definitions, then parsing the URL fails with an
-    error. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
-    components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
-    defined as follows:&lt;/p&gt;
-
-    &lt;dl&gt;&lt;dt&gt;&lt;dfn id=url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-host title=url-host&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;host&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-port title=url-port&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;port&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-hostport title=url-hostport&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt;
-     component and the port given by the &lt;port&gt; component is
-     different than the default port defined for the protocol given by
-     the &lt;scheme&gt; component, then &lt;hostport&gt; is the
-     substring that starts with the substring matched by the
-     &lt;host&gt; production and ends with the substring matched by the
-     &lt;port&gt; production, and includes the colon in between the
-     two. Otherwise, it is the same as the &lt;host&gt; component.&lt;/p&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-path title=url-path&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;The substring matched by one of the following productions, if
-      one of them was matched:&lt;/p&gt;
-
-      &lt;ul class=brief&gt;&lt;li&gt;&lt;path-abempty&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-absolute&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-noscheme&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-rootless&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-empty&gt;&lt;/li&gt;
-      &lt;/ul&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-query title=url-query&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;query&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn id=url-host-specific title=url-host-specific&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring that &lt;em&gt;follows&lt;/em&gt; the substring matched
-     by the &lt;authority&gt; production, or the whole string if the
-     &lt;authority&gt; production wasn't matched.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p class=note&gt;These parsing rules are a &lt;a href=#willful-violation&gt;willful
-  violation&lt;/a&gt; of RFC 3986 and RFC 3987 (which do not define error
-  handling), motivated by a desire to handle legacy content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-  &lt;h4 id=base-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Base URLs&lt;/h4&gt;
-
-  &lt;p&gt;The &lt;dfn id=fallback-base-url&gt;fallback base URL&lt;/dfn&gt; of a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
-  object is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained by running these
-  substeps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is &lt;a href=#an-iframe-srcdoc-document&gt;an &lt;code&gt;iframe&lt;/code&gt;
-   &lt;code title=attr-iframe-srcdoc&gt;srcdoc&lt;/code&gt; document&lt;/a&gt;,
-   then return the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the
-   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s
-   &lt;a href=#browsing-context-container&gt;browsing context container&lt;/a&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; and
-   abort these steps.&lt;/li&gt;
-
-   &lt;li&gt;
-
     &lt;!-- <A HREF="http://www.hixie.ch/tests/adhoc/html/navigation/javascript-url/">http://www.hixie.ch/tests/adhoc/html/navigation/javascript-url/</A> --&gt;
 
-    &lt;!-- this should be tested in the case of a browsing context that
-    was navigated to about:blank after having been elsewhere, as
-    opposed to the about:blank used at the time of the browsing
+    &lt;!-- this should be tested in the case of a browsing context that was navigated to about:blank
+    after having been elsewhere, as opposed to the about:blank used at the time of the browsing
     context's creation. --&gt;
 
-    &lt;p&gt;If &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; is
-    &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;, and the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s
-    &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; has a &lt;a href=#creator-browsing-context&gt;creator browsing
-    context&lt;/a&gt;, then return the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of
-    the &lt;a href=#creator-document&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;, and abort these
-    steps.&lt;/p&gt;
+    &lt;p&gt;If &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; is &lt;code&gt;&lt;a href=#about:blank&gt;about:blank&lt;/a&gt;&lt;/code&gt;, and the
+    &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; has a &lt;a href=#creator-browsing-context&gt;creator browsing
+    context&lt;/a&gt;, then return the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the &lt;a href=#creator-document&gt;creator
+    &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;, and abort these steps.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -6632,282 +6480,99 @@
 
    &lt;li&gt;&lt;p&gt;Return &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The &lt;dfn id=document-base-url&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;
-  object is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained by running these
-  substeps:&lt;/p&gt;
+  &lt;/ol&gt;&lt;p&gt;The &lt;dfn id=document-base-url&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object is the &lt;a href=#absolute-url&gt;absolute
+  URL&lt;/a&gt; obtained by running these substeps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt; be the
-   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#fallback-base-url&gt;fallback base URL&lt;/a&gt;.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt; be the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#fallback-base-url&gt;fallback
+   base URL&lt;/a&gt;.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; element that has an &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute, then the
-   &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is &lt;var title=&quot;&quot;&gt;fallback base
-   url&lt;/var&gt;; abort these steps. Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute of the first such
+   &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; element that has an &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute, then the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt;; abort these steps. Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be
+   the value of the &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute of the first such
    element.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var title=&quot;&quot;&gt;fallback base
-   url&lt;/var&gt; (thus, the &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute isn't affected by
-   &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes).&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a URL&quot;&gt;Resolve&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt; (thus, the &lt;code&gt;&lt;a href=#the-base-element&gt;base&lt;/a&gt;&lt;/code&gt; &lt;code title=attr-base-href&gt;&lt;a href=#attr-base-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute isn't affected by &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes).&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is the result of the
-   previous step if it was successful; otherwise it is &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt;.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; is the result of the previous step if it was
+   successful; otherwise it is &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt;.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;h4 id=resolving-urls&gt;&lt;span class=secno&gt;2.5.4 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
+  &lt;/ol&gt;&lt;div class=impl&gt;
 
-  &lt;p&gt;Resolving a URL is the process of taking a relative URL and
-  obtaining the absolute URL that it implies.&lt;/p&gt;
+  &lt;h4 id=resolving-urls&gt;&lt;span class=secno&gt;2.5.2 &lt;/span&gt;Resolving URLs&lt;/h4&gt;
 
-  &lt;div class=impl&gt;
+  &lt;p&gt;Resolving a URL is the process of taking a &lt;a href=#relative-url&gt;relative URL&lt;/a&gt; and obtaining the
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that it implies.&lt;/p&gt;
 
-  &lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
-  relative to either another &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; or an element,
-  the user agent must use the following steps. Resolving a URL can
-  result in an error, in which case the URL is not resolvable.&lt;/p&gt;
+  &lt;p&gt;To &lt;dfn id=resolve-a-url&gt;resolve a URL&lt;/dfn&gt; to an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; relative to either another
+  &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; or an element, the user agent must use the following steps. Resolving a
+  URL can result in an error, in which case the URL is not resolvable.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;a href=#url&gt;URL&lt;/a&gt; being
-   resolved.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;a href=#url&gt;URL&lt;/a&gt; being resolved.&lt;/li&gt;
 
    &lt;li&gt;
 
     &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; be determined as follows:&lt;/p&gt;
 
-    &lt;dl class=switch&gt;&lt;dt&gt;If the URL had a character encoding defined when the URL was
-     created or defined&lt;/dt&gt;
+    &lt;dl class=switch&gt;&lt;dt&gt;If the URL had a character encoding defined when the URL was created or defined&lt;/dt&gt;
 
      &lt;dd&gt;The URL character encoding is as defined.&lt;/dd&gt;
 
-     &lt;dt&gt;If the URL came from a script (e.g. as an argument to a
-     method)&lt;/dt&gt;
+     &lt;dt&gt;If the URL came from a script (e.g. as an argument to a method)&lt;/dt&gt;
 
-     &lt;dd&gt;The URL character encoding is the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character
-     encoding&lt;/a&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The URL character encoding is the &lt;a href=&quot;#script's-url-character-encoding&quot;&gt;script's URL character encoding&lt;/a&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;If the URL came from a DOM node (e.g. from an element)&lt;/dt&gt;
 
-     &lt;dd&gt;The node has a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, and the URL character
-     encoding is the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The node has a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, and the URL character encoding is the
+     &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt;.&lt;/dd&gt;
 
     &lt;/dl&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is &lt;a href=#a-utf-16-encoding&gt;a UTF-16
-   encoding&lt;/a&gt;, then change the value of &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; to UTF-8.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is &lt;a href=#a-utf-16-encoding&gt;a UTF-16 encoding&lt;/a&gt;, then change the value
+   of &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; to UTF-8.&lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If the algorithm was invoked with an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;
-    to use as the base URL, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be that
-    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/p&gt;
+    &lt;p&gt;If the algorithm was invoked with an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to use as the base URL, let
+    &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be that &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;i&gt;base URI of
-    the element&lt;/i&gt;, as defined by the XML Base specification, with
-    &lt;i&gt;the base URI of the document entity&lt;/i&gt; being defined as the
-    &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that
-    owns the element. &lt;a href=#refsXMLBASE&gt;[XMLBASE]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be &lt;a href=&quot;#the-element's-base-url&quot;&gt;the element's base URL&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;For the purposes of the XML Base specification, user agents
-    must act as if all &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects represented XML
-    documents.&lt;/p&gt;
-
-    &lt;p class=note&gt;It is possible for &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes to be present
-    even in HTML fragments, as such attributes can be added
-    dynamically using script. (Such scripts would not be conforming,
-    however, as &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes
-    are not allowed in &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt;.)&lt;/p&gt;
-
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;a href=#parse-a-url title=&quot;parse a URL&quot;&gt;Parse&lt;/a&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, with &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URL, with &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; as the encoding.&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If this results in a &lt;a href=#concept-url-parse-error title=concept-url-parse-error&gt;parse error&lt;/a&gt;, then abort
+   these steps with an error.&lt;/li&gt;
 
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from expanding any sequences of percent-encoded octets in
-    that component that are valid UTF-8 sequences into Unicode
-    characters as defined by UTF-8.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt; be the result of the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt;.&lt;/li&gt;
 
-    &lt;p&gt;If any percent-encoded octets in that component are not valid
-    UTF-8 sequences (e.g. sequences of percent-encoded octets that
-    expand to surrogate code points), then return an error and abort
-    these steps.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;serialized URL&lt;/var&gt; be the result of apply the &lt;a href=#url-serializer&gt;URL
+   serializer&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt;.&lt;/li&gt;
 
-    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring,
-    with both the AllowUnassigned and UseSTD3ASCIIRules flags
-    set. Replace the matching substring with the result of the ToASCII
-    algorithm.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;serialized URL&lt;/var&gt; as the &lt;dfn id=resulting-absolute-url&gt;resulting absolute URL&lt;/dfn&gt; and
+   &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt; as the &lt;dfn id=resulting-parsed-url&gt;resulting parsed URL&lt;/dfn&gt;.&lt;/li&gt;
 
-    &lt;p&gt;If ToASCII fails to convert one of the components of the
-    string, e.g. because it is too long or because it contains invalid
-    characters, then return an error and abort these steps. &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+  &lt;/ol&gt;&lt;p&gt;Given an element, &lt;dfn id=&quot;the-element's-base-url&quot;&gt;the element's base URL&lt;/dfn&gt; is the &lt;i&gt;base URI of the element&lt;/i&gt;, as
+  defined by the XML Base specification, with &lt;i&gt;the base URI of the document entity&lt;/i&gt; being
+  defined as the &lt;a href=#document-base-url&gt;document base URL&lt;/a&gt; of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that owns the element.
+  &lt;a href=#refsXMLBASE&gt;[XMLBASE]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;/li&gt;
+  &lt;p&gt;For the purposes of the XML Base specification, user agents must act as if all
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects represented XML documents.&lt;/p&gt;
 
-   &lt;li&gt;
+  &lt;p class=note&gt;It is possible for &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attributes to be
+  present even in HTML fragments, as such attributes can be added dynamically using script. (Such
+  scripts would not be conforming, however, as &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt;
+  attributes are not allowed in &lt;a href=#html-documents&gt;HTML documents&lt;/a&gt;.)&lt;/p&gt;
 
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from applying the following steps to each character other
-    than U+0025 PERCENT SIGN (%) that doesn't match the original
-    &lt;path&gt; production defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;&lt;li&gt;Encode the character into a sequence of octets as defined by the &lt;a href=#utf-8-encoder&gt;utf-8 encoder&lt;/a&gt;
-     algorithm. &lt;a href=#refsENCODING&gt;[ENCODING]&lt;/a&gt;&lt;/li&gt;
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those
-     octets. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;div class=example&gt;
-
-     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code title=&quot;&quot;&gt;//example.com/a^b&#9786;c%FFd%z/?e&lt;/code&gt;&quot;, then the
-     &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component's substring
-     would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&#9786;c%FFd%z/&lt;/code&gt;&quot; and the two
-     characters that would have to be escaped would be &quot;&lt;code title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&#9786;&lt;/code&gt;&quot;. The
-     result after this step was applied would therefore be that &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
-
-    &lt;/div&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from applying the following steps to each character other
-    than U+0025 PERCENT SIGN (%) that doesn't match the original
-    &lt;query&gt; production defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;&lt;li&gt;If the character in question cannot be expressed in the
-     encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a
-     single 0x3F octet (an ASCII question mark) and skip the remaining
-     substeps for this character.&lt;/li&gt;
-
-     &lt;li&gt;Encode the character into a sequence of octets as defined by the &lt;a href=#encoder&gt;encoder&lt;/a&gt;
-     algorithm for &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;. &lt;a href=#refsENCODING&gt;[ENCODING]&lt;/a&gt;&lt;/li&gt;
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those
-     octets. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2
-   Relative Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the
-   potentially relative URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and
-   &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URI (&lt;var title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC
-    3987, returning an error and aborting these steps if
-    appropriate. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p class=example&gt;For instance, if an absolute URI that would be
-    returned by the above algorithm violates the restrictions specific
-    to its scheme, e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the
-    &quot;&lt;code title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax,
-    then user agents are to treat this as an error instead.&lt;!-- RFC
-    3986, 3.1 Scheme --&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution
-   algorithm.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a
-   server-based naming authority, replace all U+005C REVERSE SOLIDUS
-   (\) characters in &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS
-   (/) characters.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p class=note&gt;Some of the steps in these rules, for example the
-  processing of U+005C REVERSE SOLIDUS (\) characters, are a
-  &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of RFC 3986 and RFC 3987, motivated
-  by a desire to handle legacy content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt; &lt;a href=#refsRFC3987&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
   &lt;/div&gt;
 
-  &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt; is an &lt;dfn id=absolute-url&gt;absolute URL&lt;/dfn&gt; if &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; it results in the same output
-  regardless of what it is resolved relative to, and that output is
-  not a failure.&lt;/p&gt;
 
-  &lt;p&gt;An &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is a &lt;dfn id=hierarchical-url&gt;hierarchical URL&lt;/dfn&gt; if,
-  when &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; and then &lt;a href=#parse-a-url title=&quot;parse a url&quot;&gt;parsed&lt;/a&gt;, there is a character immediately
-  after the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component
-  and it is a U+002F SOLIDUS character (/).&lt;/p&gt;
 
-  &lt;p&gt;An &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is an &lt;dfn id=authority-based-url&gt;authority-based URL&lt;/dfn&gt;
-  if, when &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolved&lt;/a&gt; and then &lt;a href=#parse-a-url title=&quot;parse a url&quot;&gt;parsed&lt;/a&gt;, there are two characters
-  immediately after the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
-  component and they are both U+002F SOLIDUS characters (//).&lt;/p&gt;
-
-
-
   &lt;div class=impl&gt;
 
-  &lt;h4 id=url-manipulation-and-creation&gt;&lt;span class=secno&gt;2.5.5 &lt;/span&gt;URL manipulation and creation&lt;/h4&gt;
+  &lt;h4 id=dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.5.3 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
 
-  &lt;p&gt;To &lt;dfn id=fragment-escaped title=fragment-escaped&gt;fragment-escape&lt;/dfn&gt; a string
-  &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, a user agent must run the following
-  steps:&lt;/p&gt;
-
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; be the string to be
-   escaped.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; point at the first
-   character of &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is past the end
-   of &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, then jump to the step labeled
-   &lt;i&gt;end&lt;/i&gt;.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the character in &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; pointed to by
-    &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is in the range U+0000 to U+0020 or
-    is one of the following characters:&lt;/p&gt;
-
-    &lt;ul class=brief&gt;&lt;li&gt;U+0022 QUOTATION MARK character (&quot;)
-     &lt;li&gt;U+0023 NUMBER SIGN character (#)
-     &lt;li&gt;U+0025 PERCENT SIGN character (%)
-     &lt;li&gt;U+003C LESS-THAN SIGN character (&lt;)
-     &lt;li&gt;U+003E GREATER-THAN SIGN character (&gt;)
-     &lt;li&gt;U+005B LEFT SQUARE BRACKET character ([)
-     &lt;li&gt;U+005C REVERSE SOLIDUS character (\)
-     &lt;li&gt;U+005D RIGHT SQUARE BRACKET character (])
-     &lt;li&gt;U+005E CIRCUMFLEX ACCENT character (^)
-     &lt;li&gt;U+007B LEFT CURLY BRACKET character ({)
-     &lt;li&gt;U+007C VERTICAL LINE character (|)
-     &lt;li&gt;U+007D RIGHT CURLY BRACKET character (})
-    &lt;/ul&gt;&lt;p&gt;...then append the percent-encoded form of the character to
-    &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt; &lt;!-- this is the same
-    phrasing that's used elsewhere in the spec, but we really should
-    define 'percent-encoded' or at least ensure we consistently say
-    whether it's upper-case or lower-case. --&gt;
-
-    &lt;p&gt;Otherwise, append the character itself to &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=note&gt;This escapes any ASCII characters that are not
-    valid in the URI &lt;fragment&gt; production without being
-    escaped.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Advance &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; to the next character
-   in &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return to the step labeled &lt;i&gt;loop&lt;/i&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;/div&gt;
-
-
-
-  &lt;div class=impl&gt;
-
-  &lt;h4 id=dynamic-changes-to-base-urls&gt;&lt;span class=secno&gt;2.5.6 &lt;/span&gt;Dynamic changes to base URLs&lt;/h4&gt;
-
   &lt;p&gt;When an &lt;code title=attr-xml-base&gt;&lt;a href=#the-xml:base-attribute-(xml-only)&gt;xml:base&lt;/a&gt;&lt;/code&gt; attribute is set, changed, or removed, the
   attribute's element, and all descendant elements, are &lt;a href=#affected-by-a-base-url-change&gt;affected by a base URL
   change&lt;/a&gt;.&lt;/p&gt;
@@ -6960,239 +6625,7 @@
   &lt;/dl&gt;&lt;/div&gt;
 
 
-&lt;!--TOPIC:DOM APIs--&gt;
-  &lt;h4 id=interfaces-for-url-manipulation&gt;&lt;span class=secno&gt;2.5.7 &lt;/span&gt;Interfaces for URL manipulation&lt;/h4&gt;
-
-  &lt;p&gt;An interface that has a complement of &lt;dfn id=url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/dfn&gt; has seven attributes with the following
-  definitions:&lt;/p&gt;
-
-&lt;pre class=&quot;idl extract&quot;&gt;           attribute DOMString &lt;a href=#dom-uda-protocol title=dom-uda-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-host title=dom-uda-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-hostname title=dom-uda-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-port title=dom-uda-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-pathname title=dom-uda-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-search title=dom-uda-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-uda-hash title=dom-uda-hash&gt;hash&lt;/a&gt;;&lt;/pre&gt;
-
-  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-protocol&gt;&lt;a href=#dom-uda-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current scheme of the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's scheme.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-host&gt;&lt;a href=#dom-uda-host&gt;host&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current host and port (if it's not the default port) in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's host and port.&lt;/p&gt;
-    &lt;p&gt;The host and the port are separated by a colon. The port part,
-    if omitted, will be assumed to be the current scheme's default
-    port.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-hostname&gt;&lt;a href=#dom-uda-hostname&gt;hostname&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current host in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's host.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-port&gt;&lt;a href=#dom-uda-port&gt;port&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current port in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's port.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-pathname&gt;&lt;a href=#dom-uda-pathname&gt;pathname&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current path in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's path.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-search&gt;&lt;a href=#dom-uda-search&gt;search&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current query component in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's query component.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=dom-uda-hash&gt;&lt;a href=#dom-uda-hash&gt;hash&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current fragment identifier in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's fragment identifier.&lt;/p&gt;
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;&lt;div class=impl&gt;
-
-  &lt;hr&gt;&lt;p&gt;The attributes defined to be &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/a&gt; must act as described for the attributes with the
-  same corresponding names in this section.&lt;/p&gt;
-
-  &lt;p&gt;In addition, an interface with a complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL
-  decomposition IDL attributes&lt;/a&gt; defines an &lt;dfn id=concept-uda-input title=concept-uda-input&gt;input&lt;/dfn&gt;, which is a &lt;a href=#url&gt;URL&lt;/a&gt;
-  that the attributes act on, and a &lt;dfn id=concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/dfn&gt;, which is a
-  set of steps invoked when any of the attributes' setters are
-  invoked.&lt;/p&gt;
-
-  &lt;p&gt;The seven &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt; have
-  similar requirements.&lt;/p&gt;
-
-  &lt;p&gt;On getting, if the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt;
-  is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that fulfills the condition given in
-  the &quot;getter condition&quot; column corresponding to the attribute in the
-  table below, the user agent must return the part of the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; URL given in the &quot;component&quot;
-  column, with any prefixes specified in the &quot;prefix&quot; column
-  appropriately added to the start of the string and any suffixes
-  specified in the &quot;suffix&quot; column appropriately added to the end of
-  the string. Otherwise, the attribute must return the empty
-  string.&lt;/p&gt;
-
-  &lt;p&gt;On setting, the new value must first be mutated as described by
-  the &quot;setter preprocessor&quot; column, then mutated by %-escaping any
-  characters in the new value that are not valid in the relevant
-  component as given by the &quot;component&quot; column. Then, if the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#absolute-url&gt;absolute
-  URL&lt;/a&gt; and the resulting new value fulfills the condition given
-  in the &quot;setter condition&quot; column, the user agent must make a new
-  string &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; by replacing the component of the
-  URL given by the &quot;component&quot; column in the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; URL with the new value;
-  otherwise, the user agent must let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be
-  equal to the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt;. Finally,
-  the user agent must invoke the &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; with the
-  value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When replacing a component in the URL, if the component is part
-  of an optional group in the URL syntax consisting of a character
-  followed by the component, the component (including its prefix
-  character) must be included even if the new value is the empty
-  string.&lt;/p&gt;
-
-  &lt;p class=note&gt;The previous paragraph applies in particular to the
-  &quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot; before a &lt;port&gt; component, the &quot;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;&quot; before a &lt;query&gt; component, and the &quot;&lt;code title=&quot;&quot;&gt;#&lt;/code&gt;&quot; before a &lt;fragment&gt; component.&lt;/p&gt;
-
-  &lt;p&gt;For the purposes of the above definitions, URLs must be parsed
-  using the &lt;a href=#parse-a-url title=&quot;parse a URL&quot;&gt;URL parsing rules&lt;/a&gt; defined
-  in this specification.&lt;/p&gt;
-
-  &lt;table id=table-uda&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Attribute
-     &lt;th&gt;Component
-     &lt;th&gt;Getter Condition
-     &lt;th&gt;Prefix
-     &lt;th&gt;Suffix
-     &lt;th&gt;Setter Preprocessor
-     &lt;th&gt;Setter Condition
-   &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-protocol title=dom-uda-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;U+003A COLON (:)
-     &lt;td&gt;Remove all trailing U+003A COLON characters (:)
-     &lt;td&gt;The new value is not the empty string
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-host title=dom-uda-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-hostport title=url-hostport&gt;&lt;hostport&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;The new value is not the empty string and &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-hostname title=dom-uda-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove all leading U+002F SOLIDUS characters (/)
-     &lt;td&gt;The new value is not the empty string and &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-port title=dom-uda-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-port title=url-port&gt;&lt;port&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;, and contained a &lt;a href=#url-port title=url-port&gt;&lt;port&gt;&lt;/a&gt; component (possibly an empty one)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove all characters in the new value from the first that is not an &lt;a href=#ascii-digits title=&quot;ASCII digits&quot;&gt;ASCII digit&lt;/a&gt;, if any.
-         Remove any leading U+0030 DIGIT ZERO characters (0) in the new value.
-         If the resulting string is empty, set it to a single U+0030 DIGIT ZERO character (0).
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is an &lt;a href=#authority-based-url&gt;authority-based URL&lt;/a&gt;,
-         and the new value, when interpreted as a base-ten integer, is less than or equal to 65535
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-pathname title=dom-uda-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is a &lt;a href=#hierarchical-url&gt;hierarchical URL&lt;/a&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;If it has no leading U+002F SOLIDUS character (/), prepend a U+002F SOLIDUS character (/) to the new value
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is hierarchical
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-search title=dom-uda-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is a &lt;a href=#hierarchical-url&gt;hierarchical URL&lt;/a&gt;, and contained a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component (possibly an empty one)
-     &lt;td&gt;U+003F QUESTION MARK (?)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove one leading U+003F QUESTION MARK character (?), if any
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; is a &lt;a href=#hierarchical-url&gt;hierarchical URL&lt;/a&gt;
-    &lt;tr&gt;&lt;td&gt;&lt;dfn id=dom-uda-hash title=dom-uda-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-     &lt;td&gt;&lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; contained a non-empty &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component
-     &lt;td&gt;U+0023 NUMBER SIGN (#)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove one leading U+0023 NUMBER SIGN character (#), if any
-     &lt;td&gt;&mdash;
-  &lt;/table&gt;&lt;!--
-  <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
-  <A HREF="http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp">http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp</A>
-  <A HREF="http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722">http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722</A>
---&gt;&lt;/div&gt;
-
-  &lt;div class=example&gt;
-
-   &lt;p&gt;The table below demonstrates how the getter &lt;span class=impl&gt;condition&lt;/span&gt; for &lt;code title=dom-uda-search&gt;&lt;a href=#dom-uda-search&gt;search&lt;/a&gt;&lt;/code&gt; results in different results
-   depending on the exact original syntax of the URL:&lt;/p&gt;
-
-   &lt;table id=table-uda-examples&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; Input URL
-      &lt;th&gt; &lt;code title=dom-uda-search&gt;&lt;a href=#dom-uda-search&gt;search&lt;/a&gt;&lt;/code&gt; value
-      &lt;th&gt; Explanation
-    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/&lt;/code">http://example.com/&lt;/code</A>&gt;
-      &lt;td&gt; &lt;i&gt;empty string&lt;/i&gt;
-      &lt;td&gt; No &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component in input URL.
-     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?&lt;/code">http://example.com/?&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
-      &lt;td&gt; There is a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component, but it is empty.
-           &lt;span class=impl&gt;The question mark in the resulting value is the prefix.&lt;/span&gt;
-     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test&lt;/code">http://example.com/?test&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-      &lt;td&gt; The &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component has the value &quot;&lt;code title=&quot;&quot;&gt;test&lt;/code&gt;&quot;.
-     &lt;tr&gt;&lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test#&lt;/code">http://example.com/?test#&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-      &lt;td&gt; The (empty) &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component is not part of the &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component.
-   &lt;/table&gt;&lt;/div&gt;
-
-  &lt;div class=example&gt;
-
-   &lt;p&gt;The following table is similar; it provides a list of what each
-   of the &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt; returns for a
-   given &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; URL.&lt;/p&gt;
-
-   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Input
-      &lt;th&gt;&lt;code title=dom-uda-protocol&gt;&lt;a href=#dom-uda-protocol&gt;protocol&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-host&gt;&lt;a href=#dom-uda-host&gt;host&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-hostname&gt;&lt;a href=#dom-uda-hostname&gt;hostname&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-port&gt;&lt;a href=#dom-uda-port&gt;port&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-pathname&gt;&lt;a href=#dom-uda-pathname&gt;pathname&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-search&gt;&lt;a href=#dom-uda-search&gt;search&lt;/a&gt;&lt;/code&gt;
-      &lt;th&gt;&lt;code title=dom-uda-hash&gt;&lt;a href=#dom-uda-hash&gt;hash&lt;/a&gt;&lt;/code&gt;
-    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/carrot#question%3f&lt;/code">http://example.com/carrot#question%3f&lt;/code</A>&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;http:&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;example.com&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;example.com&lt;/code&gt;
-      &lt;td&gt;(empty string)
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;/carrot&lt;/code&gt;
-      &lt;td&gt;(empty string)
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;#question%3f&lt;/code&gt;
-     &lt;tr&gt;&lt;td&gt;&lt;code title=&quot;&quot;&gt;<A HREF="https://www.example.com:4443?&lt;/code">https://www.example.com:4443?&lt;/code</A>&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;https:&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;www.example.com:4443&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;www.example.com&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;4443&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
-      &lt;td&gt;(empty string)
-   &lt;/table&gt;&lt;/div&gt;
-
-
-&lt;!--TOPIC:HTML--&gt;
+&lt;!--CLEANUP--&gt;
   &lt;div class=impl&gt;
 
   &lt;h3 id=fetching-resources&gt;&lt;span class=secno&gt;2.6 &lt;/span&gt;Fetching resources&lt;/h3&gt;
@@ -7295,14 +6728,20 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;i&gt;Clean referrer&lt;/i&gt;: Remove any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-    component from &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt;.&lt;/p&gt; &lt;!-- RFC2616 says &quot;The URI MUST NOT include a
-    fragment.&quot; (section 14.36) --&gt;
+    &lt;p&gt;Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; and let &lt;var title=&quot;&quot;&gt;parsed referrer&lt;/var&gt; be &lt;a href=#resulting-parsed-url&gt;resulting parsed URL&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
+    &lt;p&gt;&lt;i&gt;Clean referrer&lt;/i&gt;: Let &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; be the result of applying the
+    &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; to &lt;var title=&quot;&quot;&gt;parsed referrer&lt;/var&gt;, with the &lt;i&gt;exclude fragment
+    flag&lt;/i&gt; set.&lt;/p&gt; &lt;!-- RFC2616 says &quot;The URI MUST NOT include a fragment.&quot; (section 14.36) --&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; is not the empty string, is not a &lt;a href=#data-protocol title=&quot;data
     protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URL&lt;/a&gt;, is not a &lt;a href=#javascript-protocol title=&quot;javascript
     protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt; URL&lt;/a&gt;, and is not the &lt;a href=#url&gt;URL&lt;/a&gt;
@@ -8837,6 +8276,10 @@
   document&lt;/a&gt;, and the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is both &lt;a href=#ready-for-post-load-tasks&gt;ready for post-load tasks&lt;/a&gt; and
   &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt; immediately.&lt;/p&gt;
 
+  &lt;p&gt;&lt;dfn id=&quot;the-document's-referrer&quot;&gt;The document's referrer&lt;/dfn&gt; is an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that can be set when the
+  &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created. If it is not explicitly set, then its value is the empty
+  string.&lt;/p&gt;
+
   &lt;p&gt;Each &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object has a &lt;dfn id=reload-override-flag&gt;reload override flag&lt;/dfn&gt; that is originally
   unset. The flag is set by the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.write()&lt;/a&gt;&lt;/code&gt; methods in certain situations. When the flag is
   set, the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; also has a &lt;dfn id=reload-override-buffer&gt;reload override buffer&lt;/dfn&gt; which is a Unicode
@@ -8938,6 +8381,8 @@
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;document&lt;/var&gt; . &lt;code title=dom-document-referrer&gt;&lt;a href=#dom-document-referrer&gt;referrer&lt;/a&gt;&lt;/code&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
+&lt;!--CLEANUP--&gt;
+
     &lt;p&gt;Returns &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;the address&lt;/a&gt;
     of the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; from which the user navigated to this
     one, unless it was blocked or there was no such document, in which
@@ -8950,14 +8395,8 @@
 
   &lt;/dl&gt;&lt;div class=impl&gt;
 
-  &lt;p&gt;The &lt;dfn id=dom-document-referrer title=dom-document-referrer&gt;&lt;code&gt;referrer&lt;/code&gt;&lt;/dfn&gt; attribute must return either
-  the &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; of the &lt;a href=#active-document&gt;active document&lt;/a&gt; of the
-  &lt;a href=#source-browsing-context&gt;source browsing context&lt;/a&gt; &lt;em&gt;at the time the navigation was started&lt;/em&gt; (that is, the
-  page which &lt;a href=#navigate title=navigate&gt;navigated&lt;/a&gt; the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to the
-  current document), with any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component removed;
-  or the empty string if there is no such originating page, or if the UA has been configured not to
-  report referrers in this case, or if the navigation was initiated for a &lt;a href=#hyperlink&gt;hyperlink&lt;/a&gt;
-  with a &lt;code title=rel-noreferrer&gt;&lt;a href=#link-type-noreferrer&gt;noreferrer&lt;/a&gt;&lt;/code&gt; keyword.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn id=dom-document-referrer title=dom-document-referrer&gt;&lt;code&gt;referrer&lt;/code&gt;&lt;/dfn&gt; attribute must return
+  &lt;a href=&quot;#the-document's-referrer&quot;&gt;the document's referrer&lt;/a&gt;.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -12371,6 +11810,8 @@
    &lt;li&gt;&lt;p&gt;Change &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; to the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's document&quot;&gt;document&lt;/a&gt;'s &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's
    address&quot;&gt;address&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;!-- &lt;span&gt;the document's referrer&lt;/span&gt; stays the same --&gt;
+
    &lt;li&gt;&lt;p&gt;Create a new &lt;a href=#html-parser&gt;HTML parser&lt;/a&gt; and associate it with the document. This is a
    &lt;dfn id=script-created-parser&gt;script-created parser&lt;/dfn&gt; (meaning that it can be closed by the &lt;code title=dom-document-open&gt;&lt;a href=#dom-document-open&gt;document.open()&lt;/a&gt;&lt;/code&gt; and &lt;code title=dom-document-close&gt;&lt;a href=#dom-document-close&gt;document.close()&lt;/a&gt;&lt;/code&gt; methods, and that the tokenizer will wait for
    an explicit call to &lt;code title=dom-document-close&gt;&lt;a href=#dom-document-close&gt;document.close()&lt;/a&gt;&lt;/code&gt; before emitting an
@@ -19387,16 +18828,8 @@
            attribute DOMString &lt;a href=#dom-a-type title=dom-a-type&gt;type&lt;/a&gt;;
 
            attribute DOMString &lt;a href=#dom-a-text title=dom-a-text&gt;text&lt;/a&gt;;
-
-  // &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;
-           attribute DOMString &lt;a href=#dom-a-protocol title=dom-a-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-host title=dom-a-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-hostname title=dom-a-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-port title=dom-a-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-pathname title=dom-a-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-search title=dom-a-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-a-hash title=dom-a-hash&gt;hash&lt;/a&gt;;
-};&lt;/pre&gt;
+};
+&lt;a href=#htmlanchorelement&gt;HTMLAnchorElement&lt;/a&gt; implements &lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;;&lt;/pre&gt;
    &lt;/dd&gt;
   &lt;/dl&gt;&lt;!--TOPIC:HTML--&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; element has an &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute,
   then it &lt;a href=#represents&gt;represents&lt;/a&gt; a &lt;a href=#hyperlink&gt;hyperlink&lt;/a&gt; (a hypertext anchor) labeled by its
@@ -19492,7 +18925,7 @@
 
    &lt;/dd&gt;
 
-  &lt;/dl&gt;&lt;div class=impl&gt;
+  &lt;/dl&gt;&lt;!-- CLEANUP --&gt;&lt;div class=impl&gt;
 
   &lt;p&gt;The IDL attributes &lt;dfn id=dom-a-href title=dom-a-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-download title=dom-a-download&gt;&lt;code&gt;download&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-ping title=dom-a-ping&gt;&lt;code&gt;ping&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-target title=dom-a-target&gt;&lt;code&gt;target&lt;/code&gt;&lt;/dfn&gt;,
   &lt;dfn id=dom-a-rel title=dom-a-rel&gt;&lt;code&gt;rel&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-hreflang title=dom-a-hreflang&gt;&lt;code&gt;hreflang&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-a-type title=dom-a-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;, must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the respective content
@@ -19505,12 +18938,12 @@
   same value as the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; IDL attribute on the element, and on setting, must act
   as if the &lt;code&gt;&lt;a href=#textcontent&gt;textContent&lt;/a&gt;&lt;/code&gt; IDL attribute on the element had been set to the new value.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; element also supports the complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/a&gt;, &lt;dfn id=dom-a-protocol title=dom-a-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-host title=dom-a-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-port title=dom-a-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-hostname title=dom-a-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-pathname title=dom-a-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-a-search title=dom-a-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-a-hash title=dom-a-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for &lt;a href=#url-decomposition-idl-attributes&gt;URL
-  decomposition IDL attributes&lt;/a&gt;, with the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; being
-  the result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the element's &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute relative to the element, if there is such an
-  attribute and resolving it is successful, or the empty string otherwise; and the &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; being the same as setting the element's
-  &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute to the new output value.&lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-a-element&gt;a&lt;/a&gt;&lt;/code&gt; element also supports the &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt; interface. The &lt;a href=#concept-uu-input title=concept-uu-input&gt;input&lt;/a&gt; is
+  the value of the element's &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute, if there is such an
+  attribute, or the empty string otherwise; the &lt;a href=#concept-uu-base title=concept-uu-base&gt;base&lt;/a&gt;
+  is &lt;a href=&quot;#the-element's-base-url&quot;&gt;the element's base URL&lt;/a&gt;; the &lt;a href=#concept-uu-query-encoding title=concept-uu-query-encoding&gt;query encoding&lt;/a&gt;
+  being the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt;; and the &lt;a href=#concept-uu-update title=concept-uu-update&gt;update steps&lt;/a&gt; being the same as setting the element's
+  &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute to the new output value.&lt;/p&gt;
 
   &lt;/div&gt;
 &lt;!--TOPIC:HTML--&gt;
@@ -25326,12 +24759,14 @@
     &lt;!-- if we get to this point we know we can successfully parsed the URL, since this algorithm is
     only used after fetching the resource in the steps above --&gt;
 
-    &lt;p&gt;Otherwise, if the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component of the
-    &lt;a href=#url&gt;URL&lt;/a&gt; of the specified resource (after any redirects) matches a pattern that a
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;Otherwise, if applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the
+    &lt;a href=#url&gt;URL&lt;/a&gt; of the specified resource (after any redirects) results in a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+    whose &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; component matches a pattern that a
     &lt;a href=#plugin&gt;plugin&lt;/a&gt; supports, then the &lt;a href=#concept-embed-type title=concept-embed-type&gt;content's type&lt;/a&gt; is
     the type that that plugin can handle.&lt;/p&gt;
 
-    &lt;p class=example&gt;For example, a plugin might say that it can handle resources with &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; components that end with the four character string &quot;&lt;code title=&quot;&quot;&gt;.swf&lt;/code&gt;&quot;.&lt;/p&gt;
+    &lt;p class=example&gt;For example, a plugin might say that it can handle resources with &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; components that end with the four character string &quot;&lt;code title=&quot;&quot;&gt;.swf&lt;/code&gt;&quot;.&lt;/p&gt;
 
     &lt;!-- it's sad that we have to do extension sniffing. sigh. --&gt;
     &lt;!-- see also &lt;object&gt; which has a similar step --&gt;
@@ -25860,12 +25295,14 @@
         &lt;!-- if we get to this point we know we can successfully parsed the URL, since this
         algorithm is only used after fetching the resource in the steps above --&gt;
 
-        &lt;p&gt;If the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component of the &lt;a href=#url&gt;URL&lt;/a&gt; of
-        the specified resource (after any redirects) matches a pattern that a &lt;a href=#plugin&gt;plugin&lt;/a&gt;
+&lt;!--CLEANUP--&gt;
+        &lt;p&gt;If applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the
+        &lt;a href=#url&gt;URL&lt;/a&gt; of the specified resource (after any redirects) results in a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+        whose &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; component matches a pattern that a &lt;a href=#plugin&gt;plugin&lt;/a&gt;
         supports, then let &lt;var title=&quot;&quot;&gt;resource type&lt;/var&gt; be the type that that plugin can
         handle.&lt;/p&gt;
 
-        &lt;p class=example&gt;For example, a plugin might say that it can handle resources with &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; components that end with the four character string
+        &lt;p class=example&gt;For example, a plugin might say that it can handle resources with &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; components that end with the four character string
         &quot;&lt;code title=&quot;&quot;&gt;.swf&lt;/code&gt;&quot;.&lt;/p&gt;
 
         &lt;!-- it's sad that we have to do extension sniffing. sigh. --&gt;
@@ -29934,7 +29371,7 @@
   should play, but it is also possible to select specific tracks declaratively, by specifying
   particular tracks in the fragment identifier of the &lt;a href=#url&gt;URL&lt;/a&gt; of the &lt;a href=#media-resource&gt;media
   resource&lt;/a&gt;. The format of the fragment identifier depends on the &lt;a href=#mime-type&gt;MIME type&lt;/a&gt; of
-  the &lt;a href=#media-resource&gt;media resource&lt;/a&gt;. &lt;a href=#refsRFC2046&gt;[RFC2046]&lt;/a&gt; &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+  the &lt;a href=#media-resource&gt;media resource&lt;/a&gt;. &lt;a href=#refsRFC2046&gt;[RFC2046]&lt;/a&gt; &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;div class=example&gt;
 
@@ -39553,16 +38990,8 @@
   readonly attribute &lt;a href=#domtokenlist&gt;DOMTokenList&lt;/a&gt; &lt;a href=#dom-area-rellist title=dom-area-relList&gt;relList&lt;/a&gt;;
            attribute DOMString &lt;a href=#dom-area-hreflang title=dom-area-hreflang&gt;hreflang&lt;/a&gt;;
            attribute DOMString &lt;a href=#dom-area-type title=dom-area-type&gt;type&lt;/a&gt;;
-
-  // &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;
-           attribute DOMString &lt;a href=#dom-area-protocol title=dom-area-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-host title=dom-area-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-hostname title=dom-area-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-port title=dom-area-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-pathname title=dom-area-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-search title=dom-area-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-area-hash title=dom-area-hash&gt;hash&lt;/a&gt;;
-};&lt;/pre&gt;
+};
+&lt;a href=#htmlareaelement&gt;HTMLAreaElement&lt;/a&gt; implements &lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;;&lt;/pre&gt;
    &lt;/dd&gt;
   &lt;/dl&gt;&lt;!--TOPIC:HTML--&gt;&lt;p&gt;The &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; element &lt;a href=#represents&gt;represents&lt;/a&gt; either a
   hyperlink with some text and a corresponding area on an &lt;a href=#image-map&gt;image
@@ -39704,7 +39133,7 @@
    the &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; element, if any, and as determined by the &lt;code title=attr-hyperlink-download&gt;&lt;a href=#attr-hyperlink-download&gt;download&lt;/a&gt;&lt;/code&gt; attribute and any expressed user
    preference.&lt;/li&gt;
 
-  &lt;/ol&gt;&lt;p&gt;The IDL attributes &lt;dfn id=dom-area-alt title=dom-area-alt&gt;&lt;code&gt;alt&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-coords title=dom-area-coords&gt;&lt;code&gt;coords&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-href title=dom-area-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-target title=dom-area-target&gt;&lt;code&gt;target&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-download title=dom-area-download&gt;&lt;code&gt;download&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-ping title=dom-area-ping&gt;&lt;code&gt;ping&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-rel title=dom-area-rel&gt;&lt;code&gt;rel&lt;/code&gt;&lt;/dfn&gt;,
+  &lt;/ol&gt;&lt;p&gt;The IDL attributes &lt;dfn id=dom-area-alt title=dom-area-alt&gt;&lt;code&gt;alt&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-coords title=dom-area-coords&gt;&lt;code&gt;coords&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-target title=dom-area-target&gt;&lt;code&gt;target&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-download title=dom-area-download&gt;&lt;code&gt;download&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-href title=dom-area-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-ping title=dom-area-ping&gt;&lt;code&gt;ping&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-rel title=dom-area-rel&gt;&lt;code&gt;rel&lt;/code&gt;&lt;/dfn&gt;,
   &lt;dfn id=dom-area-hreflang title=dom-area-hreflang&gt;&lt;code&gt;hreflang&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-area-type title=dom-area-type&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;, each must &lt;a href=#reflect&gt;reflect&lt;/a&gt; the respective
   content attributes of the same name.&lt;/p&gt;
 
@@ -39714,13 +39143,12 @@
   &lt;p&gt;The IDL attribute &lt;dfn id=dom-area-rellist title=dom-area-rellist&gt;&lt;code&gt;relList&lt;/code&gt;&lt;/dfn&gt; must
   &lt;a href=#reflect&gt;reflect&lt;/a&gt; the &lt;code title=attr-hyperlink-rel&gt;&lt;a href=#attr-hyperlink-rel&gt;rel&lt;/a&gt;&lt;/code&gt; content attribute.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; element also supports the complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/a&gt;, &lt;dfn id=dom-area-protocol title=dom-area-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-host title=dom-area-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-port title=dom-area-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;,
-  &lt;dfn id=dom-area-hostname title=dom-area-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-pathname title=dom-area-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-area-search title=dom-area-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-area-hash title=dom-area-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for &lt;a href=#url-decomposition-idl-attributes&gt;URL
-  decomposition IDL attributes&lt;/a&gt;, with the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; being
-  the result of &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolving&lt;/a&gt; the element's &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute relative to the element, if there is such an
-  attribute and resolving it is successful, or the empty string otherwise; and the &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; being the same as setting the element's
-  &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute to the new output value.&lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#the-area-element&gt;area&lt;/a&gt;&lt;/code&gt; element also supports the &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt; interface. The &lt;a href=#concept-uu-input title=concept-uu-input&gt;input&lt;/a&gt; is
+  the value of the element's &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute, if there is such an
+  attribute, or the empty string otherwise; the &lt;a href=#concept-uu-base title=concept-uu-base&gt;base&lt;/a&gt;
+  is &lt;a href=&quot;#the-element's-base-url&quot;&gt;the element's base URL&lt;/a&gt;; the &lt;a href=#concept-uu-query-encoding title=concept-uu-query-encoding&gt;query encoding&lt;/a&gt;
+  being the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt;; and the &lt;a href=#concept-uu-update title=concept-uu-update&gt;update steps&lt;/a&gt; being the same as setting the element's
+  &lt;code title=attr-hyperlink-href&gt;&lt;a href=#attr-hyperlink-href&gt;href&lt;/a&gt;&lt;/code&gt; content attribute to the new output value.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -55545,6 +54973,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;div class=impl&gt;
 
@@ -55596,11 +55025,6 @@
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; is the empty string, let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt; of
     the &lt;var title=&quot;&quot;&gt;form document&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p class=note&gt;This step is a &lt;a href=#willful-violation&gt;willful violation&lt;/a&gt; of
-    RFC 3986, which would require base URL processing here. This
-    violation is motivated by a desire for compatibility with legacy
-    content. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
     &lt;!-- Don't ask me why. But that's what IE does. It even treats
     action=&quot;&quot; differently from action=&quot; &quot; or action=&quot;#&quot; (the latter
     two resolve to the base URL, the first one resolves to the doc
@@ -55613,12 +55037,17 @@
 
    &lt;li&gt;&lt;p&gt;&lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;Resolve&lt;/a&gt; the
    &lt;a href=#url&gt;URL&lt;/a&gt; &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;, relative to the &lt;var title=&quot;&quot;&gt;submitter&lt;/var&gt; element. If this fails, abort these
-   steps. Otherwise, let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be the resulting
-   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
+   steps.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; of the resulting
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be the resulting
    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;action components&lt;/var&gt; be the resulting &lt;a href=#parsed-url&gt;parsed
+   URL&lt;/a&gt;.&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; of the resulting
+   &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;enctype&lt;/var&gt; be the &lt;var title=&quot;&quot;&gt;submitter&lt;/var&gt; element's &lt;a href=#concept-fs-enctype title=concept-fs-enctype&gt;enctype&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;method&lt;/var&gt; be the &lt;var title=&quot;&quot;&gt;submitter&lt;/var&gt; element's &lt;a href=#concept-fs-method title=concept-fs-method&gt;method&lt;/a&gt;.&lt;/li&gt;
@@ -55689,11 +55118,11 @@
       &lt;!-- by this point we've already tried to resolve the URL, so we
       know we can parse it --&gt;
 
+      &lt;p&gt;Set &lt;var title=&quot;&quot;&gt;parsed action&lt;/var&gt;'s &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt;
+      component to &lt;var title=&quot;&quot;&gt;query&lt;/var&gt;.&lt;/p&gt;
+
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt; be a new &lt;a href=#url&gt;URL&lt;/a&gt;
-      that is equal to the &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; except that its
-      &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component is
-      replaced by &lt;var title=&quot;&quot;&gt;query&lt;/var&gt; (adding a U+003F QUESTION
-      MARK character (?) if appropriate).&lt;/p&gt;
+      formed by applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; algorithm to &lt;var title=&quot;&quot;&gt;parsed action&lt;/var&gt;.&lt;/p&gt;
 
       &lt;p&gt;&lt;a href=#navigate&gt;Navigate&lt;/a&gt;&lt;!--DONAV form--&gt; &lt;var title=&quot;&quot;&gt;target
       browsing context&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt;. If
@@ -55750,6 +55179,8 @@
       browsing context&lt;/var&gt; must be navigated with &lt;a href=#replacement-enabled&gt;replacement
       enabled&lt;/a&gt;.&lt;/p&gt;
 
+      &lt;p class=note&gt;The &lt;var title=&quot;&quot;&gt;form data set&lt;/var&gt; is discarded.&lt;/p&gt;
+
      &lt;/dd&gt;
 
      &lt;dt&gt;&lt;dfn id=submit-data-post title=submit-data-post&gt;Post to data:&lt;/dfn&gt;
@@ -55760,20 +55191,19 @@
       form encoding algorithm&lt;/a&gt;.&lt;/p&gt;
 
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; contains the string &quot;&lt;code title=&quot;&quot;&gt;%%%%&lt;/code&gt;&quot; (four U+0025 PERCENT SIGN characters),
-      then %-escape all bytes in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if
-      interpreted as US-ASCII, do not match the &lt;code title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in the URI Generic Syntax,
-      and then, treating the result as a US-ASCII string, further
-      %-escape all the U+0025 PERCENT SIGN characters in the resulting
+      then &lt;a href=#percent-encode&gt;percent encode&lt;/a&gt; all bytes in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if
+      interpreted as US-ASCII, are not characters in the URL &lt;a href=#default-encode-set&gt;default encode set&lt;/a&gt;,
+      and then, treating the result as a US-ASCII string, 
+      &lt;a href=#utf-8-percent-encode&gt;UTF-8 percent encode&lt;/a&gt; all the U+0025 PERCENT SIGN characters in the resulting
       string and replace the first occurrence of &quot;&lt;code title=&quot;&quot;&gt;%%%%&lt;/code&gt;&quot; in &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; with the
-      resulting double-escaped string. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      resulting doubly-escaped string. &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; contains the string
       &quot;&lt;code title=&quot;&quot;&gt;%%&lt;/code&gt;&quot; (two U+0025 PERCENT SIGN characters
-      in a row, but not four), then %-escape all characters in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if interpreted as US-ASCII, do not
-      match the &lt;code title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in the URI
-      Generic Syntax, and then, treating the result as a US-ASCII
+      in a row, but not four), then &lt;a href=#utf-8-percent-encode&gt;UTF-8 percent encode&lt;/a&gt; all characters in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if interpreted as US-ASCII, 
+      are not characters in the URL &lt;a href=#default-encode-set&gt;default encode set&lt;/a&gt;, and then, treating the result as a US-ASCII
       string, replace the first occurrence of &quot;&lt;code title=&quot;&quot;&gt;%%&lt;/code&gt;&quot; in &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; with the
-      resulting escaped string. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      resulting escaped string. &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;&lt;a href=#navigate&gt;Navigate&lt;/a&gt;&lt;!--DONAV form--&gt; &lt;var title=&quot;&quot;&gt;target
       browsing context&lt;/var&gt; to the potentially modified &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; (which will be a &lt;a href=#data-protocol title=&quot;data
@@ -55813,12 +55243,11 @@
      &lt;dt&gt;&lt;dfn id=submit-mailto-body title=submit-mailto-body&gt;Mail as body&lt;/dfn&gt;
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the resulting encoding the
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the resulting of encoding the
       &lt;var title=&quot;&quot;&gt;form data set&lt;/var&gt; using the &lt;a href=#appropriate-form-encoding-algorithm&gt;appropriate
-      form encoding algorithm&lt;/a&gt; and then %-escaping all the bytes
+      form encoding algorithm&lt;/a&gt; and then &lt;a href=#percent-encode title=&quot;percent encode&quot;&gt;percent encoding&lt;/a&gt; all the bytes
       in the resulting byte string that, when interpreted as US-ASCII,
-      do not match the &lt;code title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in
-      the URI Generic Syntax. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      are not characters in the URL &lt;a href=#default-encode-set&gt;default encode set&lt;/a&gt;. &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt; have the same value as
       &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;.&lt;/p&gt;
@@ -64849,7 +64278,11 @@
   &lt;a href=#completely-loaded&gt;completely loaded&lt;/a&gt; immediately. The &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; must have a single child
   &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; node, which itself has a single child &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; node. As soon as this
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; is created, the user agent must &lt;a href=#implement-the-sandboxing&gt;implement the sandboxing&lt;/a&gt; for
-  it.&lt;/p&gt;
+  it. If the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; has a &lt;a href=#creator-document&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt;, then
+  the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;'s &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=&quot;#the-document's-referrer&quot; title=&quot;the document's
+  referrer&quot;&gt;referrer&lt;/a&gt; must be set to &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;the address&lt;/a&gt;
+  of that &lt;a href=#creator-document&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/a&gt; at the time of the &lt;a href=#browsing-context&gt;browsing
+  context&lt;/a&gt;'s creation.&lt;/p&gt;
 
   &lt;p class=note&gt;If the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is created specifically to be immediately
   navigated, then that initial navigation will have &lt;a href=#replacement-enabled&gt;replacement enabled&lt;/a&gt;.&lt;/p&gt;
@@ -66489,10 +65922,11 @@
 
   &lt;/dl&gt;&lt;div class=impl&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;The &lt;dfn id=dom-document-domain title=dom-document-domain&gt;&lt;code&gt;domain&lt;/code&gt;&lt;/dfn&gt; attribute on
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects must be initialized to &lt;a href=&quot;#the-document's-domain&quot;&gt;the document's domain&lt;/a&gt;, if it has
   one, and the empty string otherwise. If the value is an IPv6 address, then the square brackets
-  from the host portion of the &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component must be omitted
+  from the &lt;a href=#concept-url-host title=concept-url-host&gt;host&lt;/a&gt; component must be omitted
   from the attribute's value.&lt;/p&gt;
 
   &lt;p&gt;On getting, the attribute must return its current value, unless the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; has
@@ -67210,22 +66644,22 @@
 
      &lt;li&gt;If that fails, throw a &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
-     &lt;li&gt;Compare the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt;. If
-     any part of these two &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; differ other than the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt;, &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt;, and &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; components, then throw a
+&lt;!--CLEANUP--&gt;
+     &lt;li&gt;Compare the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; to the result of applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to &lt;a href=&quot;#the-document's-address&quot;&gt;the document's address&lt;/a&gt;. If
+     any component of these two &lt;a href=#url title=URL&gt;URLs&lt;/a&gt; differ other than the &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt;, &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt;, and &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; components, then throw a
      &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
      &lt;li&gt;If the &lt;a href=#origin&gt;origin&lt;/a&gt; of the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is not the same as
      the &lt;a href=#origin&gt;origin&lt;/a&gt; of the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-document&quot; title=&quot;script's
-     document&quot;&gt;document&lt;/a&gt;, and either the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; or &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components of the two &lt;a href=#url title=URL&gt;URLs&lt;/a&gt;
+     document&quot;&gt;document&lt;/a&gt;, and either the &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; or &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt; components of the two &lt;a href=#parsed-url title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/a&gt;
      compared in the previous step differ, throw a &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception and abort
      these steps. (This prevents sandboxed content from spoofing other pages on the same
      origin.)&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
 
-    &lt;/ol&gt;&lt;p&gt;For the purposes of the comparisons in the above substeps, the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; and &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; components
-    can only be the same if the URLs are both &lt;a href=#hierarchical-url title=&quot;hierarchical URL&quot;&gt;hierarchical
-    URLs&lt;/a&gt;.&lt;/p&gt;
+    &lt;/ol&gt;&lt;p&gt;For the purposes of the comparisons in the above substeps, the &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; and &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt; components
+    can only be the same if the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component of both &lt;a href=#parsed-url title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/a&gt; are &lt;a href=#concept-url-scheme-relative title=concept-url-scheme-relative&gt;relative schemes&lt;/a&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -67452,17 +66886,9 @@
   void &lt;a href=#dom-location-assign title=dom-location-assign&gt;assign&lt;/a&gt;(DOMString url);
   void &lt;a href=#dom-location-replace title=dom-location-replace&gt;replace&lt;/a&gt;(DOMString url);
   void &lt;a href=#dom-location-reload title=dom-location-reload&gt;reload&lt;/a&gt;();
+};
+&lt;a href=#location&gt;Location&lt;/a&gt; implements &lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;;&lt;/pre&gt;
 
-  // &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt; &lt;!-- blame brendan for these &quot;innovative&quot; names --&gt;
-           attribute DOMString &lt;a href=#dom-location-protocol title=dom-location-protocol&gt;protocol&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-host title=dom-location-host&gt;host&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-hostname title=dom-location-hostname&gt;hostname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-port title=dom-location-port&gt;port&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-pathname title=dom-location-pathname&gt;pathname&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-search title=dom-location-search&gt;search&lt;/a&gt;;
-           attribute DOMString &lt;a href=#dom-location-hash title=dom-location-hash&gt;hash&lt;/a&gt;;
-};&lt;/pre&gt;
-
   &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;location&lt;/var&gt; . &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
 
    &lt;dd&gt;
@@ -67579,16 +67005,18 @@
   user agent may instead perform &lt;a href=#an-overridden-reload&gt;an overridden reload&lt;/a&gt; rather than the navigation
   described in this paragraph.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; interface also supports the &lt;code&gt;&lt;a href=#urlutils&gt;URLUtils&lt;/a&gt;&lt;/code&gt; interface. &lt;span class=impl&gt;The &lt;a href=#concept-uu-input title=concept-uu-input&gt;input&lt;/a&gt; is &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's
+  address&quot;&gt;the address&lt;/a&gt; of the &lt;i&gt;relevant &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;&lt;/i&gt; (same as the &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute), as an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;; the &lt;a href=#concept-uu-base title=concept-uu-base&gt;base&lt;/a&gt; is the &lt;a href=#entry-script&gt;entry script&lt;/a&gt;'s &lt;a href=&quot;#script's-base-url&quot; title=&quot;script's base
+  URL&quot;&gt;base URL&lt;/a&gt; (which can be different each time members on the interface are invoked); the
+  &lt;a href=#concept-uu-query-encoding title=concept-uu-query-encoding&gt;query encoding&lt;/a&gt; is the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character
+  encoding&lt;/a&gt;; and the &lt;a href=#concept-uu-update title=concept-uu-update&gt;update steps&lt;/a&gt; are the same as
+  setting the &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute to the new output
+  value.&lt;/span&gt;&lt;/p&gt;
+
   &lt;/div&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#location&gt;Location&lt;/a&gt;&lt;/code&gt; interface also has the complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL
-  attributes&lt;/a&gt;, &lt;dfn id=dom-location-protocol title=dom-location-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-host title=dom-location-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-port title=dom-location-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-hostname title=dom-location-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-pathname title=dom-location-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-location-search title=dom-location-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-location-hash title=dom-location-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. &lt;span class=impl&gt;These must follow the rules
-  given for &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;, with the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; being &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;the
-  address&lt;/a&gt; of the &lt;i&gt;relevant &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;&lt;/i&gt;, as an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; (same
-  as the &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute), and the &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; being the same as setting the &lt;code title=dom-location-href&gt;&lt;a href=#dom-location-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute to the new output value.&lt;/span&gt;&lt;/p&gt;
 
 
-
 &lt;!--ADD-TOPIC:Security--&gt;
   &lt;div class=impl&gt;
 
@@ -67763,11 +67191,12 @@
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;gone async&lt;/var&gt; be false.&lt;/li&gt;
 
-   &lt;li id=navigate-fragid-step&gt;&lt;p&gt;&lt;i&gt;Fragment identifiers&lt;/i&gt;: If the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
-   the new resource is the same as the &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; of the
-   &lt;a href=#active-document&gt;active document&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being navigated, ignoring any
-   &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; components of those &lt;a href=#url title=URL&gt;URLs&lt;/a&gt;, and the new resource is to be fetched using HTTP GET &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt;, and the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
-   the new resource has a &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component (even if it
+&lt;!--CLEANUP--&gt;
+   &lt;li id=navigate-fragid-step&gt;&lt;p&gt;&lt;i&gt;Fragment identifiers&lt;/i&gt;: Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
+   the new resource and the &lt;a href=&quot;#the-document's-address&quot; title=&quot;the document's address&quot;&gt;address&lt;/a&gt; of the
+   &lt;a href=#active-document&gt;active document&lt;/a&gt; of the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; being navigated. If all the components of the resulting &lt;a href=#parsed-url title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/a&gt; , ignoring any
+   &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; components, are identical, and the new resource is to be fetched using HTTP GET &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt;, and the &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; of
+   the new resource has a &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; component that is not null (even if it
    is empty), then &lt;a href=#scroll-to-fragid title=navigate-fragid&gt;navigate to that fragment identifier&lt;/a&gt; and
    abort these steps.&lt;/li&gt;
 
@@ -68231,12 +67660,14 @@
   encoding is established, the &lt;a href=&quot;#document's-character-encoding&quot;&gt;document's character encoding&lt;/a&gt; must be set to that
   character encoding.&lt;/p&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;If the root element, as parsed according to the XML specifications cited above, is found to be
   an &lt;code&gt;&lt;a href=#the-html-element&gt;html&lt;/a&gt;&lt;/code&gt; element with an attribute &lt;code title=attr-html-manifest&gt;&lt;a href=#attr-html-manifest&gt;manifest&lt;/a&gt;&lt;/code&gt;
   whose value is not the empty string, then, as soon as the element is &lt;a href=#insert-an-element-into-a-document title=&quot;insert an
   element into a document&quot;&gt;inserted into the document&lt;/a&gt;, the user agent must &lt;a href=#resolve-a-url title=&quot;resolve a url&quot;&gt;resolve&lt;/a&gt; the value of that attribute relative to that element, and if
-  that is successful, must run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
-  algorithm&lt;/a&gt; with the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; with any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component removed as the manifest URL, and passing in
+  that is successful, must apply the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; algorithm to the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set to obtain &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;, and then run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
+  algorithm&lt;/a&gt; with &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;
+  as the manifest URL, passing in
   the newly-created &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;. Otherwise, if the attribute is absent, its value is the
   empty string, or resolving its value fails, then as soon as the root element is &lt;a href=#insert-an-element-into-a-document title=&quot;insert an element into a document&quot;&gt;inserted into the document&lt;/a&gt;, the user agent must
   run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection algorithm&lt;/a&gt; with no
@@ -68478,8 +67909,8 @@
   processing model must be followed to determine what &lt;a href=#the-indicated-part-of-the-document&gt;the indicated part of the
   document&lt;/a&gt; is.&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#parse-a-url title=&quot;parse a url&quot;&gt;Parse&lt;/a&gt; the &lt;a href=#url&gt;URL&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;fragid&lt;/var&gt; be the &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component of the
-   URL.&lt;/li&gt;&lt;!-- parsing can't fail, since we checked earlier on when navigating --&gt;
+  &lt;ol&gt;&lt;!--CLEANUP--&gt;&lt;li&gt;&lt;p&gt;Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the &lt;a href=#url&gt;URL&lt;/a&gt;, and let &lt;var title=&quot;&quot;&gt;fragid&lt;/var&gt; be the &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; component of the
+   resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;.&lt;/li&gt;&lt;!-- parsing can't fail, since we checked earlier on when navigating --&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;fragid&lt;/var&gt; is the empty string, then &lt;a href=#the-indicated-part-of-the-document&gt;the indicated part of the
    document&lt;/a&gt; is the top of the document; stop the algorithm here.&lt;/li&gt;
@@ -69611,7 +69042,7 @@
   &lt;/div&gt;
 
 
-
+&lt;!--CLEANUP--&gt;
   &lt;h5 id=writing-cache-manifests&gt;&lt;span class=secno&gt;6.7.3.2 &lt;/span&gt;Writing cache manifests&lt;/h5&gt;
 
   &lt;p&gt;Manifests must be served using the
@@ -69771,10 +69202,10 @@
   which another namespace in the &lt;a href=#concept-appcache-onlinewhitelist title=concept-appcache-onlinewhitelist&gt;online whitelist&lt;/a&gt; is
   a &lt;a href=#prefix-match&gt;prefix match&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Relative URLs must be given relative to the manifest's own
-  URL. All URLs in the manifest must have the same &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; as the manifest itself
-  (either explicitly or implicitly, through the use of relative
-  URLs).&lt;/p&gt;
+  &lt;p&gt;&lt;a href=#relative-url title=&quot;relative URL&quot;&gt;Relative URLs&lt;/a&gt; must be given relative to the manifest's own
+  URL. All URLs in the manifest must have the same &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; as the manifest itself
+  (either explicitly or implicitly, through the use of &lt;a href=#relative-url title=&quot;relative url&quot;&gt;relative
+  URLs&lt;/a&gt;). &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;URLs in manifests must not have fragment identifiers (i.e. the
   U+0023 NUMBER SIGN character isn't allowed in URLs in
@@ -69785,6 +69216,7 @@
   matched by &lt;a href=#prefix-match&gt;prefix match&lt;/a&gt;.&lt;/p&gt;
 
 
+&lt;!--CLEANUP--&gt;
   &lt;div class=impl&gt;
 
   &lt;h5 id=parsing-cache-manifests&gt;&lt;span class=secno&gt;6.7.3.3 &lt;/span&gt;Parsing cache manifests&lt;/h5&gt;
@@ -69792,7 +69224,7 @@
   &lt;p&gt;When a user agent is to &lt;dfn id=parse-a-manifest&gt;parse a manifest&lt;/dfn&gt;, it means
   that the user agent must run the following steps:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;The user agent must decode the byte stream corresponding
+  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Decode the byte stream corresponding
    with the manifest to be parsed &lt;a href=#decoded-as-utf-8,-with-error-handling title=&quot;decoded as UTF-8, with
    error handling&quot;&gt;as UTF-8, with error handling&lt;/a&gt;. &lt;!--All
    U+0000 NULL characters must be replaced by U+FFFD REPLACEMENT
@@ -69803,6 +69235,10 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; be the &lt;a href=#absolute-url&gt;absolute
    URL&lt;/a&gt; representing the manifest.&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Apply the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; steps to the &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt;, so that the
+   components from its &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; can be used by the subseqent steps of this
+   algorithm.&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; be an initially empty
    list of &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/a&gt; for &lt;a href=#concept-appcache-explicit title=concept-appcache-explicit&gt;explicit entries&lt;/a&gt;.&lt;/li&gt;
 
@@ -69942,17 +69378,15 @@
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;If the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; has a different
-      &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component than
-      the manifest's URL (compared in an &lt;a href=#ascii-case-insensitive&gt;ASCII
-      case-insensitive&lt;/a&gt; manner), then jump back to the step
+      &lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a different
+      &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component than
+      &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; (the manifest's URL), then jump back to the step
       labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Drop the &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-      component of the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, if it has
-      one.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt;
+      algorithm to the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;, with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;Add the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -69974,18 +69408,22 @@
       jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt; &lt;!-- SECURITY
       --&gt;
 
-      &lt;p&gt;Drop any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-      components of the resulting &lt;a href=#absolute-url title=&quot;absolute URL&quot;&gt;absolute
-      URLs&lt;/a&gt;.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; be the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt;
+      algorithm to the first resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;, with the &lt;i&gt;exclude fragment
+      flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;If the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; corresponding to &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; be the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt;
+      algorithm to the second resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;, with the &lt;i&gt;exclude fragment
+      flag&lt;/i&gt; set.&lt;/p&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback
       URLs&lt;/var&gt; mapping as a &lt;a href=#concept-appcache-fallback-ns title=concept-appcache-fallback-ns&gt;fallback namespace&lt;/a&gt;,
       then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Otherwise, add the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; corresponding to
+      &lt;p&gt;Otherwise, add 
       &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;fallback
       URLs&lt;/var&gt; mapping as a &lt;a href=#concept-appcache-fallback-ns title=concept-appcache-fallback-ns&gt;fallback namespace&lt;/a&gt;,
-      mapped to the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; corresponding to &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;a href=#concept-appcache-fallback title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.&lt;/p&gt;
+      mapped to &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;a href=#concept-appcache-fallback title=concept-appcache-fallback&gt;fallback entry&lt;/a&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -70004,17 +69442,15 @@
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;If the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; has a different
-      &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component than
-      the manifest's URL (compared in an &lt;a href=#ascii-case-insensitive&gt;ASCII
-      case-insensitive&lt;/a&gt; manner), then jump back to the step
+      &lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a different
+      &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component than
+      &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; (the manifest's URL), then jump back to the step
       labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Drop the &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
-      component of the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, if it has
-      one.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt;
+      algorithm to the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;, with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;Add the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; to the &lt;var title=&quot;&quot;&gt;online whitelist namespaces&lt;/var&gt;.&lt;/p&gt;
+      &lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;online whitelist namespaces&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
 
@@ -70299,10 +69735,11 @@
       &lt;a href=#shows-caching-progress&gt;shows caching progress&lt;/a&gt;, the display of some sort of user interface indicating to
       the user that the user agent failed to save the application for offline use.&lt;/p&gt;
 
+&lt;!--CLEANUP--&gt;
       &lt;p&gt;Otherwise, associate the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; for this entry with &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;; store the resource for this entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, if it
-      isn't already there, and categorize its entry as a &lt;a href=#concept-appcache-master title=concept-appcache-master&gt;master entry&lt;/a&gt;. If the resource's &lt;a href=#url&gt;URL&lt;/a&gt; has a
-      &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component, it must be removed from the
-      entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; (application caches never include fragment
+      isn't already there, and categorize its entry as a &lt;a href=#concept-appcache-master title=concept-appcache-master&gt;master entry&lt;/a&gt;. If applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to the resource's &lt;a href=#url&gt;URL&lt;/a&gt; results in a &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; that has a non-null
+      &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt; component, the &lt;a href=#url&gt;URL&lt;/a&gt; used for the
+      entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; must instead be the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; obtained from applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; algorith, to the &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set (application caches never include fragment
       identifiers).&lt;/p&gt;
 
      &lt;/li&gt;
@@ -70823,8 +70260,8 @@
 
   &lt;ol&gt;&lt;!--FETCH--&gt;&lt;li&gt;&lt;p&gt;If the resource is not to be fetched using the HTTP GET
    mechanism &lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or
-   equivalent&lt;/a&gt;, or if its &lt;a href=#url&gt;URL&lt;/a&gt; has a different &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component than the
-   &lt;a href=#application-cache&gt;application cache&lt;/a&gt;'s &lt;a href=#concept-appcache-manifest title=concept-appcache-manifest&gt;manifest&lt;/a&gt;, then
+   equivalent&lt;/a&gt;, or if applying the &lt;a href=#url-parser&gt;URL parser&lt;/a&gt; algorithm to both its &lt;a href=#url&gt;URL&lt;/a&gt; and the
+   &lt;a href=#application-cache&gt;application cache&lt;/a&gt;'s &lt;a href=#concept-appcache-manifest title=concept-appcache-manifest&gt;manifest&lt;/a&gt;'s URL results in two &lt;a href=#parsed-url title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/a&gt; with different &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; components, then
    &lt;a href=#fetch&gt;fetch&lt;/a&gt; the resource normally and abort these
    steps.&lt;/li&gt;
 
@@ -71323,6 +70760,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;div class=impl&gt;
 
@@ -71469,7 +70907,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;A &lt;a href=#url&gt;URL&lt;/a&gt;, set when the script is created, used to
-    resolve relative URLs. &lt;span id=sbu-not-copy title=&quot;&quot;&gt;If the
+    resolve &lt;a href=#relative-url title=&quot;relative url&quot;&gt;relative URLs&lt;/a&gt;. &lt;span id=sbu-not-copy title=&quot;&quot;&gt;If the
     base URL is set from another source, e.g. a &lt;a href=#document-base-url&gt;document base
     URL&lt;/a&gt;, then the &lt;a href=&quot;#script's-base-url&quot;&gt;script's base URL&lt;/a&gt; must follow
     the source, so that if the source's changes, so does the
@@ -73949,6 +73387,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;h5 id=custom-handlers&gt;&lt;span class=secno&gt;7.5.1.3 &lt;/span&gt;Custom scheme and content handlers&lt;/h5&gt;
 
@@ -74171,11 +73610,10 @@
     resulting URL using the GET method (&lt;a href=#concept-http-equivalent-get title=concept-http-equivalent-get&gt;or equivalent&lt;/a&gt; for
     non-HTTP URLs).&lt;/p&gt;
 
-    &lt;p&gt;To get the escaped version of the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of
-    the content in question, the user agent must replace every
-    character in that &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that doesn't match the
-    &lt;query&gt; production defined in RFC 3986 by the
-    percent-encoded form of that character. &lt;a href=#refsRFC3986&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;To get the escaped version of the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; of the content in question, the
+    user agent must replace every character in that &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that is not a
+    character in the URL &lt;a href=#default-encode-set&gt;default encode set&lt;/a&gt; with the result of &lt;a href=#utf-8-percent-encode title=&quot;UTF-8 percent
+    encode&quot;&gt;UTF-8 percent encoding&lt;/a&gt; that character.&lt;/p&gt;
 
     &lt;div class=example&gt;
 
@@ -74695,8 +74133,8 @@
 
     &lt;li&gt;&lt;p&gt;If this fails, return 0 and abort these steps.&lt;/li&gt;
 
-    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host2&lt;/var&gt; be be the &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component of the resulting
-    &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
+    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host2&lt;/var&gt; be be the &lt;a href=#concept-url-host title=concept-url-host&gt;host&lt;/a&gt; component of the resulting
+    &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;.&lt;/li&gt;
 
     &lt;li&gt;
 
@@ -74710,10 +74148,8 @@
      &lt;var title=&quot;&quot;&gt;host2&lt;/var&gt; after their common suffix are not the
      same, then return 0 and abort these steps.&lt;/p&gt;
 
-     &lt;p&gt;Domain labels must be compared after applying the IDNA ToASCII
-     algorithm to them, with both the AllowUnassigned and
-     UseSTD3ASCIIRules flags set, in an &lt;a href=#ascii-case-insensitive&gt;ASCII
-     case-insensitive&lt;/a&gt; manner. &lt;a href=#refsRFC3490&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+     &lt;!-- host1 is ascii here because origins are ascii. host2 is ascii because resolve urls
+     punycodes idna. --&gt;
 
     &lt;/li&gt;
 
@@ -78762,6 +78198,7 @@
   &lt;/div&gt;
 --&gt;
 
+&lt;!--CLEANUP--&gt;
 
 &lt;!--ADD-TOPIC:Security--&gt;
   &lt;div class=impl&gt;
@@ -78791,7 +78228,7 @@
 
   &lt;p&gt;User agents should filter potentially active (scripted) content
   (e.g. HTML) when it is dragged and when it is dropped, using a
-  whitelist of known-safe features. Similarly, relative URLs should be
+  whitelist of known-safe features. Similarly, &lt;a href=#relative-url title=&quot;relative url&quot;&gt;relative URLs&lt;/a&gt; should be
   turned into absolute URLs to avoid references changing in unexpected
   ways. This specification does not specify how this is performed.&lt;/p&gt;
 
@@ -80412,7 +79849,7 @@
   &lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;Event handler&lt;/a&gt; &lt;th&gt;&lt;a href=#event-handler-event-type&gt;Event handler event type&lt;/a&gt;
    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;dfn id=handler-abstractworker-onerror title=handler-AbstractWorker-onerror&gt;&lt;code&gt;onerror&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=event-error&gt;error&lt;/code&gt;
 &lt;!-- v2-onclose    &lt;tr&gt;&lt;td&gt;&lt;dfn title=&quot;handler-AbstractWorker-onclose&quot;&gt;&lt;code&gt;onclose&lt;/code&gt;&lt;/dfn&gt; &lt;td&gt; &lt;code title=&quot;event-worker-close&quot;&gt;close&lt;/code&gt; --&gt;
-  &lt;/table&gt;&lt;h5 id=dedicated-workers-and-the-worker-interface&gt;&lt;span class=secno&gt;9.2.6.2 &lt;/span&gt;Dedicated workers and the &lt;code&gt;&lt;a href=#worker&gt;Worker&lt;/a&gt;&lt;/code&gt; interface&lt;/h5&gt;
+  &lt;/table&gt;&lt;!--CLEANUP--&gt;&lt;h5 id=dedicated-workers-and-the-worker-interface&gt;&lt;span class=secno&gt;9.2.6.2 &lt;/span&gt;Dedicated workers and the &lt;code&gt;&lt;a href=#worker&gt;Worker&lt;/a&gt;&lt;/code&gt; interface&lt;/h5&gt;
 
   &lt;pre class=idl&gt;[&lt;a href=#dom-worker title=dom-Worker&gt;Constructor&lt;/a&gt;(DOMString scriptURL)]
 interface &lt;dfn id=worker&gt;Worker&lt;/dfn&gt; : &lt;a href=#eventtarget&gt;EventTarget&lt;/a&gt; {
@@ -80481,8 +79918,8 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component of
-    the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is not &quot;&lt;code title=data-protocol&gt;data&lt;/code&gt;&quot;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of
+    &lt;p&gt;If the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component of
+    the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; is not &quot;&lt;code title=data-protocol&gt;data&lt;/code&gt;&quot;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of
     the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; is not the &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt; as the origin of the &lt;a href=#entry-script&gt;entry
     script&lt;/a&gt;, then throw a &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception
     and abort these steps.&lt;/p&gt;
@@ -80605,7 +80042,8 @@
    exception.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; be the
-   resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;.&lt;/li&gt;
+   resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; and &lt;var title=&quot;&quot;&gt;parsed scriptURL&lt;/var&gt; be the
+   resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; be the value of the second
    argument, or the empty string if the second argument was
@@ -80613,8 +80051,8 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component of
-    &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; is not &quot;&lt;code title=data-protocol&gt;data&lt;/code&gt;&quot;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of
+    &lt;p&gt;If the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component of
+    &lt;var title=&quot;&quot;&gt;parsed scriptURL&lt;/var&gt; is not &quot;&lt;code title=data-protocol&gt;data&lt;/code&gt;&quot;, and the &lt;a href=#origin&gt;origin&lt;/a&gt; of
     &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; is not the &lt;a href=#same-origin title=&quot;same
     origin&quot;&gt;same&lt;/a&gt; as the origin of the &lt;a href=#entry-script&gt;entry
     script&lt;/a&gt;, then throw a &lt;code&gt;&lt;a href=#securityerror&gt;SecurityError&lt;/a&gt;&lt;/code&gt; exception
@@ -80966,16 +80404,9 @@
   &lt;h4 id=worker-locations&gt;&lt;span class=secno&gt;9.3.4 &lt;/span&gt;Worker locations&lt;/h4&gt;
 
   &lt;pre class=idl&gt;interface &lt;dfn id=workerlocation&gt;WorkerLocation&lt;/dfn&gt; {
-  // &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;
   stringifier readonly attribute DOMString &lt;a href=#dom-workerlocation-href title=dom-WorkerLocation-href&gt;href&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-protocol title=dom-WorkerLocation-protocol&gt;protocol&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-host title=dom-WorkerLocation-host&gt;host&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-hostname title=dom-WorkerLocation-hostname&gt;hostname&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-port title=dom-WorkerLocation-port&gt;port&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-pathname title=dom-WorkerLocation-pathname&gt;pathname&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-search title=dom-WorkerLocation-search&gt;search&lt;/a&gt;;
-  readonly attribute DOMString &lt;a href=#dom-workerlocation-hash title=dom-WorkerLocation-hash&gt;hash&lt;/a&gt;;
-};&lt;/pre&gt;
+};
+&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt; implements &lt;a href=#urlutilsreadonly&gt;URLUtilsReadOnly&lt;/a&gt;;&lt;/pre&gt;
 
   &lt;p&gt;A &lt;code&gt;&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt;&lt;/code&gt; object represents an &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; set at its
   creation.&lt;/p&gt;
@@ -80983,13 +80414,10 @@
   &lt;p&gt;The &lt;dfn id=dom-workerlocation-href title=dom-WorkerLocation-href&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt; attribute must return the
   &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that the object represents.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt;&lt;/code&gt; interface also has the complement of &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition
-  IDL attributes&lt;/a&gt;, &lt;dfn id=dom-workerlocation-protocol title=dom-WorkerLocation-protocol&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-host title=dom-WorkerLocation-host&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-port title=dom-WorkerLocation-port&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-hostname title=dom-WorkerLocation-hostname&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-pathname title=dom-WorkerLocation-pathname&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn id=dom-workerlocation-search title=dom-WorkerLocation-search&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn id=dom-workerlocation-hash title=dom-WorkerLocation-hash&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for
-  &lt;a href=#url-decomposition-idl-attributes&gt;URL decomposition IDL attributes&lt;/a&gt;, with the &lt;a href=#concept-uda-input title=concept-uda-input&gt;input&lt;/a&gt; being the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that the object
-  represents (same as the &lt;code title=dom-WorkerLocation-href&gt;&lt;a href=#dom-workerlocation-href&gt;href&lt;/a&gt;&lt;/code&gt; attribute), and the
-  &lt;a href=#concept-uda-setter title=concept-uda-setter&gt;common setter action&lt;/a&gt; being a no-op, since the attributes
-  are defined to be readonly.
-  &lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt;&lt;/code&gt; interface also supports the &lt;code&gt;&lt;a href=#urlutilsreadonly&gt;URLUtilsReadOnly&lt;/a&gt;&lt;/code&gt;
+  interface. The &lt;a href=#concept-uu-input title=concept-uu-input&gt;input&lt;/a&gt; is the &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; that
+  the object represents (same as the &lt;code title=dom-WorkerLocation-href&gt;&lt;a href=#dom-workerlocation-href&gt;href&lt;/a&gt;&lt;/code&gt;
+  attribute). &lt;a href=#refsURL&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;code&gt;&lt;a href=#workerlocation&gt;WorkerLocation&lt;/a&gt;&lt;/code&gt; interface must only be &lt;a href=#expose title=expose&gt;exposed&lt;/a&gt; if
   the &lt;a href=#javascript-global-environment&gt;JavaScript global environment&lt;/a&gt; is a &lt;a href=#worker-environment&gt;worker environment&lt;/a&gt;.&lt;/p&gt;
@@ -82602,6 +82030,7 @@
   <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=17264">https://www.w3.org/Bugs/Public/show_bug.cgi?id=17264</A> --&gt;
 
 
+&lt;!--CLEANUP--&gt;
   &lt;h4 id=parsing-websocket-urls&gt;&lt;span class=secno&gt;10.3.5 &lt;/span&gt;Parsing WebSocket URLs&lt;/h4&gt;
 
   &lt;p&gt;The steps to &lt;dfn id=&quot;parse-a-websocket-url's-components&quot;&gt;parse a WebSocket URL's components&lt;/dfn&gt; from a string &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; are as follows. These steps return either a &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, a &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;, and a &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; flag,
@@ -82621,34 +82050,34 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; does not have a &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt;
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; does not have a &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt;
    component whose value, when &lt;a href=#converted-to-ascii-lowercase&gt;converted to ASCII lowercase&lt;/a&gt;, is either &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot; or &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, then fail this algorithm.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt;
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a non-null &lt;a href=#concept-url-fragment title=concept-url-fragment&gt;fragment&lt;/a&gt;
    component, then fail this algorithm.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
-   is &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to false; otherwise, the &lt;a href=#url-scheme title=url-scheme&gt;&lt;scheme&gt;&lt;/a&gt; component is &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to true.&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component of the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;
+   is &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to false; otherwise, the &lt;a href=#concept-url-scheme title=concept-url-scheme&gt;scheme&lt;/a&gt; component is &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to true.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the value of the &lt;a href=#url-host title=url-host&gt;&lt;host&gt;&lt;/a&gt; component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, &lt;a href=#converted-to-ascii-lowercase&gt;converted to
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the value of the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;'s &lt;a href=#concept-url-host title=concept-url-host&gt;host&lt;/a&gt; component, &lt;a href=#converted-to-ascii-lowercase&gt;converted to
    ASCII lowercase&lt;/a&gt;.&lt;/li&gt; &lt;!-- at this point this is Punycode-encoded already --&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-port title=url-port&gt;&lt;port&gt;&lt;/a&gt; component,
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a &lt;a href=#concept-url-port title=concept-url-port&gt;port&lt;/a&gt; component that is not the empty string,
    then let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be that component's value; otherwise, there is no explicit &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If there is no explicit &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, then: if &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; is
    false, let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be 80, otherwise let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be
    443.&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; be the value of the &lt;a href=#url-path title=url-path&gt;&lt;path&gt;&lt;/a&gt; component (which might be empty) of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/li&gt; &lt;!-- at this point this is UTF-8 encoded and %-escaped --&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; be the value of the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt;'s &lt;a href=#concept-url-path title=concept-url-path&gt;path&lt;/a&gt; component (which might be empty).&lt;/li&gt; &lt;!-- at this point this is UTF-8 encoded and percent encoded --&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; is the empty string, set it to a single character
    U+002F SOLIDUS (/).&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component,
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; has a non-null &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt; component,
    then append a single U+003F QUESTION MARK character (?) to &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;,
-   followed by the value of the &lt;a href=#url-query title=url-query&gt;&lt;query&gt;&lt;/a&gt; component.&lt;/li&gt;
-   &lt;!-- at this point this is UTF-8 encoded and %-escaped --&gt;
+   followed by the value of the &lt;a href=#concept-url-query title=concept-url-query&gt;query&lt;/a&gt; component.&lt;/li&gt;
+   &lt;!-- at this point this is UTF-8 encoded and percent encoded --&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource
    name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/li&gt;
@@ -85045,7 +84474,7 @@
   &lt;p class=note&gt;Whether the attributes in the table above are
   conforming or not is defined by other specifications (e.g. the SVG
   and MathML specifications); this section only describes the syntax
-  rules if the attributes are serialised using the HTML syntax.&lt;/p&gt;
+  rules if the attributes are serialized using the HTML syntax.&lt;/p&gt;
 
 
   &lt;h5 id=optional-tags&gt;&lt;span class=secno&gt;12.1.2.4 &lt;/span&gt;Optional tags&lt;/h5&gt;
@@ -89430,9 +88859,8 @@
     url&quot;&gt;resolve&lt;/a&gt; the value of that attribute to an
     &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt;, relative to the newly created element,
     and if that is successful, run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
-    algorithm&lt;/a&gt; with the resulting &lt;a href=#absolute-url&gt;absolute URL&lt;/a&gt; with
-    any &lt;a href=#url-fragment title=url-fragment&gt;&lt;fragment&gt;&lt;/a&gt; component
-    removed; otherwise, if there is no such attribute, or its value is
+    algorithm&lt;/a&gt; with the result of applying the &lt;a href=#url-serializer&gt;URL serializer&lt;/a&gt; algorithm to
+    the resulting &lt;a href=#parsed-url&gt;parsed URL&lt;/a&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set; otherwise, if there is no such attribute, or its value is
     the empty string, or resolving its value fails, run the &lt;a href=#concept-appcache-init title=concept-appcache-init&gt;application cache selection
     algorithm&lt;/a&gt; with no manifest. The algorithm must be passed
     the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
@@ -102411,12 +101839,6 @@
    &lt;dt id=refsRFC3864&gt;[RFC3864]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc3864">http://tools.ietf.org/html/rfc3864</A>&gt;Registration Procedures for Message Header Fields&lt;/a&gt;&lt;/cite&gt;, G. Klyne, M. Nottingham, J. Mogul. IETF.&lt;/dd&gt;
 
-   &lt;dt id=refsRFC3986&gt;[RFC3986]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc3986">http://tools.ietf.org/html/rfc3986</A>&gt;Uniform Resource Identifier (URI): Generic Syntax&lt;/a&gt;&lt;/cite&gt;, T. Berners-Lee, R. Fielding, L. Masinter. IETF.&lt;/dd&gt;
-
-   &lt;dt id=refsRFC3987&gt;[RFC3987]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc3987">http://tools.ietf.org/html/rfc3987</A>&gt;Internationalized Resource Identifiers (IRIs)&lt;/a&gt;&lt;/cite&gt;, M. D&uuml;rst, M. Suignard. IETF.&lt;/dd&gt;
-
    &lt;dt id=refsRFC4281&gt;[RFC4281]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc4281">http://tools.ietf.org/html/rfc4281</A>&gt;The Codecs Parameter for &quot;Bucket&quot; Media Types&lt;/a&gt;&lt;/cite&gt;, R. Gellens, D. Singer, P. Frojdh. IETF.&lt;/dd&gt;
 
@@ -102471,6 +101893,9 @@
    &lt;dt id=refsUNIVCHARDET&gt;[UNIVCHARDET]&lt;/dt&gt;
    &lt;dd&gt;(Non-normative) &lt;cite&gt;&lt;a href=<A HREF="http://www.mozilla.org/projects/intl/UniversalCharsetDetection.html">http://www.mozilla.org/projects/intl/UniversalCharsetDetection.html</A>&gt;A composite approach to language/encoding detection&lt;/a&gt;&lt;/cite&gt;, S. Li, K. Momoi. Netscape. In &lt;cite&gt;Proceedings of the 19th International Unicode Conference&lt;/cite&gt;.&lt;/dd&gt;
 
+   &lt;dt id=refsURL&gt;[URL]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://url.spec.whatwg.org/">http://url.spec.whatwg.org/</A>&gt;URL&lt;/a&gt;&lt;/cite&gt;, A. van Kestern. WHATWG.&lt;/dd&gt;
+
    &lt;dt id=refsUTF7&gt;[UTF7]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=<A HREF="http://tools.ietf.org/html/rfc2152">http://tools.ietf.org/html/rfc2152</A>&gt;UTF-7: A Mail-Safe Transformation Format of Unicode&lt;/a&gt;&lt;/cite&gt;, D. Goldsmith, M. Davis. IETF.&lt;/dd&gt;
 

Modified: source
===================================================================
--- source	2013-02-08 07:06:47 UTC (rev 7709)
+++ source	2013-02-09 02:07:29 UTC (rev 7710)
@@ -710,7 +710,7 @@
 
   &lt;pre&gt;var a = &lt;span title=&quot;Document&quot;&gt;document&lt;/span&gt;.&lt;span title=&quot;dom-document-links&quot;&gt;links&lt;/span&gt;[0]; // obtain the first link in the document
 a.&lt;span title=&quot;dom-a-href&quot;&gt;href&lt;/span&gt; = 'sample.html'; // change the destination URL of the link
-a.&lt;span title=&quot;dom-uda-protocol&quot;&gt;protocol&lt;/span&gt; = 'https'; // change just the scheme part of the URL
+a.&lt;span title=&quot;dom-url-protocol&quot;&gt;protocol&lt;/span&gt; = 'https'; // change just the scheme part of the URL
 a.setAttribute('href', '<A HREF="http://example.com/">http://example.com/</A>'); // change the content attribute directly&lt;/pre&gt;
 
   &lt;p&gt;Since DOM trees are used as the way to represent HTML documents when they are processed and
@@ -1615,9 +1615,9 @@
   compression format used was not supported, even if the implementation could determine the
   dimensions of the movie from the file's metadata.&lt;/p&gt;
 
-  &lt;p&gt;What some specifications, in particular the HTTP and URI specifications, refer to as a
+  &lt;p&gt;What some specifications, in particular the HTTP specification, refer to as a
   &lt;i&gt;representation&lt;/i&gt; is referred to in this specification as a &lt;dfn title=&quot;&quot;&gt;resource&lt;/dfn&gt;. &lt;a
-  href=&quot;#refsHTTP&quot;&gt;[HTTP]&lt;/a&gt; &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+  href=&quot;#refsHTTP&quot;&gt;[HTTP]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The term &lt;dfn&gt;MIME type&lt;/dfn&gt; is used to refer to what is sometimes called an &lt;i&gt;Internet media
   type&lt;/i&gt; in protocol literature. The term &lt;i&gt;media type&lt;/i&gt; in this specification is used to refer
@@ -2210,16 +2210,42 @@
    &lt;/dd&gt;
 
 
-   &lt;dt&gt;URIs, IRIs, IDNA&lt;/dt&gt;
+   &lt;dt&gt;URLs&lt;/dt&gt;
 
    &lt;dd&gt;
 
-    &lt;p&gt;Implementations must support the semantics of &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt; defined in the
-    URI and IRI specifications, as well as the semantics of IDNA domain names defined in the
-    &lt;cite&gt;Internationalizing Domain Names in Applications (IDNA)&lt;/cite&gt; specification. &lt;a
-    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;
+    &lt;p&gt;The following terms are defined in the URL standard: &lt;a href=&quot;#refsURL&quot;&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
+    &lt;ul class=&quot;brief&quot;&gt;
+     &lt;li&gt;&lt;dfn&gt;URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;Absolute URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;Relative URL&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn title=&quot;concept-url-scheme-relative&quot;&gt;Relative schemes&lt;/dfn&gt;
+     &lt;li&gt;The &lt;dfn&gt;URL parser&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;Parsed URL&lt;/dfn&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-scheme data&quot;&gt;scheme data&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-username&quot;&gt;username&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-password&quot;&gt;password&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-host&quot;&gt;host&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-port&quot;&gt;port&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-path&quot;&gt;path&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-query&quot;&gt;query&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-url-fragment&quot;&gt;fragment&lt;/dfn&gt; component of a &lt;span&gt;parsed URL&lt;/span&gt;
+     &lt;li&gt;&lt;dfn title=&quot;concept-url-parse-error&quot;&gt;Parse errors&lt;/dfn&gt; from the &lt;span&gt;URL parser&lt;/span&gt;
+     &lt;li&gt;The &lt;dfn&gt;URL serializer&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;Default encode set&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;Percent encode&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;UTF-8 percent encode&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn&gt;&lt;code&gt;URLUtils&lt;/code&gt;&lt;/dfn&gt; interface
+     &lt;li&gt;&lt;dfn&gt;&lt;code&gt;URLUtilsReadOnly&lt;/code&gt;&lt;/dfn&gt; interface
+     &lt;li&gt;&lt;dfn title=&quot;dom-url-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt; attribute&lt;/dfn&gt;
+     &lt;li&gt;&lt;dfn title=&quot;concept-uu-base&quot;&gt;Base&lt;/dfn&gt; for &lt;code&gt;URLUtils&lt;/code&gt;
+     &lt;li&gt;&lt;dfn title=&quot;concept-uu-input&quot;&gt;Input&lt;/dfn&gt; for &lt;code&gt;URLUtils&lt;/code&gt;
+     &lt;li&gt;&lt;dfn title=&quot;concept-uu-query-encoding&quot;&gt;Query encoding&lt;/dfn&gt; for &lt;code&gt;URLUtils&lt;/code&gt;
+     &lt;li&gt;&lt;dfn title=&quot;concept-uu-update&quot;&gt;Update steps&lt;/dfn&gt; for &lt;code&gt;URLUtils&lt;/code&gt;
+    &lt;/ul&gt;
+
    &lt;/dd&gt;
 
 
@@ -5824,252 +5850,54 @@
 
   &lt;h3&gt;URLs&lt;/h3&gt;
 
-  &lt;p&gt;This specification defines the term &lt;span&gt;URL&lt;/span&gt;, and defines
-  various algorithms for dealing with URLs, because for historical
-  reasons the rules defined by the URI and IRI specifications are not
-  a complete description of what HTML user agents need to implement to
-  be compatible with Web content.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The term &quot;URL&quot; in this specification is used in a
-  manner distinct from the precise technical meaning it is given in
-  RFC 3986. Readers familiar with that RFC will find it easier to read
-  &lt;em&gt;this&lt;/em&gt; specification if they pretend the term &quot;URL&quot; as used
-  herein is really called something else altogether. This is a
-  &lt;span&gt;willful violation&lt;/span&gt; of RFC 3986. &lt;a
-  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-
   &lt;h4&gt;Terminology&lt;/h4&gt;
 
-  &lt;p&gt;A &lt;dfn&gt;URL&lt;/dfn&gt; is a string used to identify a resource.&lt;/p&gt;
+  &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is a &lt;dfn&gt;valid URL&lt;/dfn&gt; if it conforms to the authoring conformance
+  requirements in the URL standard. &lt;a href=&quot;#refsURL&quot;&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is a &lt;dfn&gt;valid URL&lt;/dfn&gt; if at least one of
-  the following conditions holds:&lt;/p&gt;
+  &lt;p&gt;A string is a &lt;dfn&gt;valid non-empty URL&lt;/dfn&gt; if it is a &lt;span&gt;valid URL&lt;/span&gt; but it is not
+  the empty string.&lt;/p&gt;
 
-  &lt;ul&gt;
+  &lt;p&gt;A string is a &lt;dfn&gt;valid URL potentially surrounded by spaces&lt;/dfn&gt; if, after &lt;span
+  title=&quot;strip leading and trailing whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/span&gt;
+  from it, it is a &lt;span&gt;valid URL&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid URI reference &lt;a
-   href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;
+  &lt;p&gt;A string is a &lt;dfn&gt;valid non-empty URL potentially surrounded by spaces&lt;/dfn&gt; if, after &lt;span
+  title=&quot;strip leading and trailing whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/span&gt;
+  from it, it is a &lt;span&gt;valid non-empty URL&lt;/span&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and it has no
-   query component. &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+  &lt;p&gt;This specification defines the URL &lt;dfn&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved,
+  though unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URL, for use in &lt;span
+  title=&quot;syntax-doctype&quot;&gt;DOCTYPE&lt;/span&gt;s in &lt;span&gt;HTML documents&lt;/span&gt; when needed for
+  compatibility with XML tools. &lt;a href=&quot;#refsABOUT&quot;&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and its query
-   component contains no unescaped non-ASCII characters. &lt;a
-   href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+  &lt;p&gt;This specification defines the URL &lt;dfn&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
+  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URL, that is used as &lt;span&gt;the document's
+  address&lt;/span&gt; of &lt;span title=&quot;an iframe srcdoc document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code
+  title=&quot;attr-iframe-srcdoc&quot;&gt;srcdoc&lt;/code&gt; documents&lt;/span&gt;. &lt;a href=&quot;#refsABOUT&quot;&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;URL&lt;/span&gt; is a valid IRI reference and the &lt;span
-   title=&quot;document's character encoding&quot;&gt;character encoding&lt;/span&gt; of
-   the URL's &lt;code&gt;Document&lt;/code&gt; is UTF-8 or &lt;span&gt;a UTF-16
-   encoding&lt;/span&gt;. &lt;a href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
+  &lt;p&gt;The &lt;dfn&gt;fallback base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; object is the &lt;span&gt;absolute
+  URL&lt;/span&gt; obtained by running these substeps:&lt;/p&gt;
 
-  &lt;/ul&gt;
-
-  &lt;p&gt;A string is a &lt;dfn&gt;valid non-empty URL&lt;/dfn&gt; if it is a
-  &lt;span&gt;valid URL&lt;/span&gt; but it is not the empty string.&lt;/p&gt;
-
-  &lt;p&gt;A string is a &lt;dfn&gt;valid URL potentially surrounded by
-  spaces&lt;/dfn&gt; if, after &lt;span title=&quot;strip leading and trailing
-  whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/span&gt; from
-  it, it is a &lt;span&gt;valid URL&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;p&gt;A string is a &lt;dfn&gt;valid non-empty URL potentially surrounded by
-  spaces&lt;/dfn&gt; if, after &lt;span title=&quot;strip leading and trailing
-  whitespace&quot;&gt;stripping leading and trailing whitespace&lt;/span&gt; from
-  it, it is a &lt;span&gt;valid non-empty URL&lt;/span&gt;.&lt;/p&gt;
-
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn&gt;&lt;code&gt;about:legacy-compat&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, for use in &lt;span
-  title=&quot;syntax-doctype&quot;&gt;DOCTYPE&lt;/span&gt;s in &lt;span&gt;HTML
-  documents&lt;/span&gt; when needed for compatibility with XML tools. &lt;a
-  href=&quot;#refsABOUT&quot;&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;p&gt;This specification defines the URL
-  &lt;dfn&gt;&lt;code&gt;about:srcdoc&lt;/code&gt;&lt;/dfn&gt; as a reserved, though
-  unresolvable, &lt;code title=&quot;&quot;&gt;about:&lt;/code&gt; URI, that is used as
-  &lt;span&gt;the document's address&lt;/span&gt; of &lt;span title=&quot;an iframe srcdoc
-  document&quot;&gt;&lt;code&gt;iframe&lt;/code&gt; &lt;code
-  title=&quot;attr-iframe-srcdoc&quot;&gt;srcdoc&lt;/code&gt; documents&lt;/span&gt;. &lt;a
-  href=&quot;#refsABOUT&quot;&gt;[ABOUT]&lt;/a&gt;&lt;/p&gt;
-
-
-  &lt;div class=&quot;impl&quot;&gt;
-
-  &lt;h4&gt;Parsing URLs&lt;/h4&gt;
-
-  &lt;p&gt;To &lt;dfn&gt;parse a URL&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; into its
-  component parts, the user agent must use the following steps:&lt;/p&gt;
-
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span&gt;Strip leading and trailing whitespace&lt;/span&gt; from &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt; is &lt;span&gt;an &lt;code&gt;iframe&lt;/code&gt; &lt;code
+   title=&quot;attr-iframe-srcdoc&quot;&gt;srcdoc&lt;/code&gt; document&lt;/span&gt;, then return the &lt;span&gt;document base
+   URL&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing context&lt;/span&gt;'s &lt;span&gt;browsing context
+   container&lt;/span&gt;'s &lt;code&gt;Document&lt;/code&gt; and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;Parse &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; in the manner defined by RFC
-    3986, with the following exceptions:&lt;/p&gt;
-
-    &lt;ul&gt;
-
-     &lt;li&gt;Add all characters with code points less than or equal to
-     U+0020 or greater than or equal to U+007F to the
-     &lt;unreserved&gt; production.&lt;/li&gt;
-
-     &lt;li&gt;Add the characters U+0022, U+003C, U+003E, U+005B .. U+005E,
-     U+0060, and U+007B .. U+007D to the &lt;unreserved&gt;
-     production.
-      &lt;!--
-       0022 QUOTATION MARK
-       003C LESS-THAN SIGN
-       003E GREATER-THAN SIGN
-       005B LEFT SQUARE BRACKET
-       005C REVERSE SOLIDUS
-       005D RIGHT SQUARE BRACKET
-       005E CIRCUMFLEX ACCENT
-       0060 GRAVE ACCENT
-       007B LEFT CURLY BRACKET
-       007C VERTICAL LINE
-       007D RIGHT CURLY BRACKET
-      --&gt;
-     &lt;/li&gt;
-
-     &lt;li&gt;Add a single U+0025 PERCENT SIGN character as a second
-     alternative way of matching the &lt;pct-encoded&gt; production,
-     except when the &lt;pct-encoded&gt; is used in the
-     &lt;reg-name&gt; production.&lt;/li&gt;
-
-     &lt;li&gt;Add the U+0023 NUMBER SIGN character to the characters
-     allowed in the &lt;fragment&gt; production.&lt;/li&gt;
-
-     &lt;!-- some browsers also have other differences, e.g. Mozilla
-     seems to treat &quot;;&quot; as if it was not in sub-delims, if the scheem
-     is &quot;ftp&quot;. --&gt;
-
-    &lt;/ul&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; doesn't match the
-    &lt;URI-reference&gt; production, even after the above changes are
-    made to the ABNF definitions, then parsing the URL fails with an
-    error. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p&gt;Otherwise, parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was successful; the
-    components of the URL are substrings of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
-    defined as follows:&lt;/p&gt;
-
-    &lt;dl&gt;
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;scheme&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;host&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;port&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-hostport&quot;&gt;&lt;hostport&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;If there is a &lt;scheme&gt; component and a &lt;port&gt;
-     component and the port given by the &lt;port&gt; component is
-     different than the default port defined for the protocol given by
-     the &lt;scheme&gt; component, then &lt;hostport&gt; is the
-     substring that starts with the substring matched by the
-     &lt;host&gt; production and ends with the substring matched by the
-     &lt;port&gt; production, and includes the colon in between the
-     two. Otherwise, it is the same as the &lt;host&gt; component.&lt;/p&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;p&gt;The substring matched by one of the following productions, if
-      one of them was matched:&lt;/p&gt;
-
-      &lt;ul class=&quot;brief&quot;&gt;
-       &lt;li&gt;&lt;path-abempty&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-absolute&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-noscheme&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-rootless&gt;&lt;/li&gt;
-       &lt;li&gt;&lt;path-empty&gt;&lt;/li&gt;
-      &lt;/ul&gt;
-
-     &lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;query&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring matched by the &lt;fragment&gt; production, if any.&lt;/p&gt;&lt;/dd&gt;
-
-
-     &lt;dt&gt;&lt;dfn title=&quot;url-host-specific&quot;&gt;&lt;host-specific&gt;&lt;/dfn&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;&lt;p&gt;The substring that &lt;em&gt;follows&lt;/em&gt; the substring matched
-     by the &lt;authority&gt; production, or the whole string if the
-     &lt;authority&gt; production wasn't matched.&lt;/p&gt;&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-   &lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p class=&quot;note&quot;&gt;These parsing rules are a &lt;span&gt;willful
-  violation&lt;/span&gt; of RFC 3986 and RFC 3987 (which do not define error
-  handling), motivated by a desire to handle legacy content. &lt;a
-  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-  &lt;/div&gt;
-
-
-  &lt;h4&gt;Base URLs&lt;/h4&gt;
-
-  &lt;p&gt;The &lt;dfn&gt;fallback base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt;
-  object is the &lt;span&gt;absolute URL&lt;/span&gt; obtained by running these
-  substeps:&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;If the &lt;code&gt;Document&lt;/code&gt; is &lt;span&gt;an &lt;code&gt;iframe&lt;/code&gt;
-   &lt;code title=&quot;attr-iframe-srcdoc&quot;&gt;srcdoc&lt;/code&gt; document&lt;/span&gt;,
-   then return the &lt;span&gt;document base URL&lt;/span&gt; of the
-   &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing context&lt;/span&gt;'s
-   &lt;span&gt;browsing context container&lt;/span&gt;'s &lt;code&gt;Document&lt;/code&gt; and
-   abort these steps.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
     &lt;!-- <A HREF="http://www.hixie.ch/tests/adhoc/html/navigation/javascript-url/">http://www.hixie.ch/tests/adhoc/html/navigation/javascript-url/</A> --&gt;
 
-    &lt;!-- this should be tested in the case of a browsing context that
-    was navigated to about:blank after having been elsewhere, as
-    opposed to the about:blank used at the time of the browsing
+    &lt;!-- this should be tested in the case of a browsing context that was navigated to about:blank
+    after having been elsewhere, as opposed to the about:blank used at the time of the browsing
     context's creation. --&gt;
 
-    &lt;p&gt;If &lt;span&gt;the document's address&lt;/span&gt; is
-    &lt;code&gt;about:blank&lt;/code&gt;, and the &lt;code&gt;Document&lt;/code&gt;'s
-    &lt;span&gt;browsing context&lt;/span&gt; has a &lt;span&gt;creator browsing
-    context&lt;/span&gt;, then return the &lt;span&gt;document base URL&lt;/span&gt; of
-    the &lt;span&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/span&gt;, and abort these
-    steps.&lt;/p&gt;
+    &lt;p&gt;If &lt;span&gt;the document's address&lt;/span&gt; is &lt;code&gt;about:blank&lt;/code&gt;, and the
+    &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;browsing context&lt;/span&gt; has a &lt;span&gt;creator browsing
+    context&lt;/span&gt;, then return the &lt;span&gt;document base URL&lt;/span&gt; of the &lt;span&gt;creator
+    &lt;code&gt;Document&lt;/code&gt;&lt;/span&gt;, and abort these steps.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -6079,52 +5907,45 @@
 
   &lt;/ol&gt;
 
-  &lt;p&gt;The &lt;dfn&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt;
-  object is the &lt;span&gt;absolute URL&lt;/span&gt; obtained by running these
-  substeps:&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn&gt;document base URL&lt;/dfn&gt; of a &lt;code&gt;Document&lt;/code&gt; object is the &lt;span&gt;absolute
+  URL&lt;/span&gt; obtained by running these substeps:&lt;/p&gt;
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt; be the
-   &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;fallback base URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt; be the &lt;code&gt;Document&lt;/code&gt;'s &lt;span&gt;fallback
+   base URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;If there is no &lt;code&gt;base&lt;/code&gt; element that has an &lt;code
-   title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute, then the
-   &lt;span&gt;document base URL&lt;/span&gt; is &lt;var title=&quot;&quot;&gt;fallback base
-   url&lt;/var&gt;; abort these steps. Otherwise, let &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt; be the value of the &lt;code
-   title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute of the first such
+   title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute, then the &lt;span&gt;document base URL&lt;/span&gt; is &lt;var
+   title=&quot;&quot;&gt;fallback base url&lt;/var&gt;; abort these steps. Otherwise, let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be
+   the value of the &lt;code title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute of the first such
    element.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a URL&quot;&gt;Resolve&lt;/span&gt; &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var title=&quot;&quot;&gt;fallback base
-   url&lt;/var&gt; (thus, the &lt;code&gt;base&lt;/code&gt; &lt;code
-   title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute isn't affected by
-   &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes).&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a URL&quot;&gt;Resolve&lt;/span&gt; &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; relative to &lt;var
+   title=&quot;&quot;&gt;fallback base url&lt;/var&gt; (thus, the &lt;code&gt;base&lt;/code&gt; &lt;code
+   title=&quot;attr-base-href&quot;&gt;href&lt;/code&gt; attribute isn't affected by &lt;code
+   title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes).&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;The &lt;span&gt;document base URL&lt;/span&gt; is the result of the
-   previous step if it was successful; otherwise it is &lt;var
-   title=&quot;&quot;&gt;fallback base url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;The &lt;span&gt;document base URL&lt;/span&gt; is the result of the previous step if it was
+   successful; otherwise it is &lt;var title=&quot;&quot;&gt;fallback base url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
   &lt;/ol&gt;
 
 
+  &lt;div class=&quot;impl&quot;&gt;
+
   &lt;h4&gt;Resolving URLs&lt;/h4&gt;
 
-  &lt;p&gt;Resolving a URL is the process of taking a relative URL and
-  obtaining the absolute URL that it implies.&lt;/p&gt;
+  &lt;p&gt;Resolving a URL is the process of taking a &lt;span&gt;relative URL&lt;/span&gt; and obtaining the
+  &lt;span&gt;absolute URL&lt;/span&gt; that it implies.&lt;/p&gt;
 
-  &lt;div class=&quot;impl&quot;&gt;
+  &lt;p&gt;To &lt;dfn&gt;resolve a URL&lt;/dfn&gt; to an &lt;span&gt;absolute URL&lt;/span&gt; relative to either another
+  &lt;span&gt;absolute URL&lt;/span&gt; or an element, the user agent must use the following steps. Resolving a
+  URL can result in an error, in which case the URL is not resolvable.&lt;/p&gt;
 
-  &lt;p&gt;To &lt;dfn&gt;resolve a URL&lt;/dfn&gt; to an &lt;span&gt;absolute URL&lt;/span&gt;
-  relative to either another &lt;span&gt;absolute URL&lt;/span&gt; or an element,
-  the user agent must use the following steps. Resolving a URL can
-  result in an error, in which case the URL is not resolvable.&lt;/p&gt;
-
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;span&gt;URL&lt;/span&gt; being
-   resolved.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; be the &lt;span&gt;URL&lt;/span&gt; being resolved.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
@@ -6132,276 +5953,64 @@
 
     &lt;dl class=&quot;switch&quot;&gt;
 
-     &lt;dt&gt;If the URL had a character encoding defined when the URL was
-     created or defined&lt;/dt&gt;
+     &lt;dt&gt;If the URL had a character encoding defined when the URL was created or defined&lt;/dt&gt;
 
      &lt;dd&gt;The URL character encoding is as defined.&lt;/dd&gt;
 
-     &lt;dt&gt;If the URL came from a script (e.g. as an argument to a
-     method)&lt;/dt&gt;
+     &lt;dt&gt;If the URL came from a script (e.g. as an argument to a method)&lt;/dt&gt;
 
-     &lt;dd&gt;The URL character encoding is the &lt;span&gt;script's URL character
-     encoding&lt;/span&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The URL character encoding is the &lt;span&gt;script's URL character encoding&lt;/span&gt;.&lt;/dd&gt;
 
      &lt;dt&gt;If the URL came from a DOM node (e.g. from an element)&lt;/dt&gt;
 
-     &lt;dd&gt;The node has a &lt;code&gt;Document&lt;/code&gt;, and the URL character
-     encoding is the &lt;span&gt;document's character encoding&lt;/span&gt;.&lt;/dd&gt;
+     &lt;dd&gt;The node has a &lt;code&gt;Document&lt;/code&gt;, and the URL character encoding is the
+     &lt;span&gt;document's character encoding&lt;/span&gt;.&lt;/dd&gt;
 
     &lt;/dl&gt;
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is &lt;span&gt;a UTF-16
-   encoding&lt;/span&gt;, then change the value of &lt;var
-   title=&quot;&quot;&gt;encoding&lt;/var&gt; to UTF-8.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; is &lt;span&gt;a UTF-16 encoding&lt;/span&gt;, then change the value
+   of &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; to UTF-8.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;
 
-    &lt;p&gt;If the algorithm was invoked with an &lt;span&gt;absolute URL&lt;/span&gt;
-    to use as the base URL, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be that
-    &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;
+    &lt;p&gt;If the algorithm was invoked with an &lt;span&gt;absolute URL&lt;/span&gt; to use as the base URL, let
+    &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be that &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be the &lt;i&gt;base URI of
-    the element&lt;/i&gt;, as defined by the XML Base specification, with
-    &lt;i&gt;the base URI of the document entity&lt;/i&gt; being defined as the
-    &lt;span&gt;document base URL&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt; that
-    owns the element. &lt;a href=&quot;#refsXMLBASE&quot;&gt;[XMLBASE]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; be &lt;span&gt;the element's base URL&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;For the purposes of the XML Base specification, user agents
-    must act as if all &lt;code&gt;Document&lt;/code&gt; objects represented XML
-    documents.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;It is possible for &lt;code
-    title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes to be present
-    even in HTML fragments, as such attributes can be added
-    dynamically using script. (Such scripts would not be conforming,
-    however, as &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes
-    are not allowed in &lt;span&gt;HTML documents&lt;/span&gt;.)&lt;/p&gt;
-
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;parse a URL&quot;&gt;Parse&lt;/span&gt; &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt; into its component parts.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;&lt;p&gt;Apply the &lt;span&gt;URL parser&lt;/span&gt; to &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, with &lt;var
+   title=&quot;&quot;&gt;base&lt;/var&gt; as the base URL, with &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt; as the encoding.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;
+   &lt;li&gt;&lt;p&gt;If this results in a &lt;span title=&quot;concept-url-parse-error&quot;&gt;parse error&lt;/span&gt;, then abort
+   these steps with an error.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
-    title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from expanding any sequences of percent-encoded octets in
-    that component that are valid UTF-8 sequences into Unicode
-    characters as defined by UTF-8.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt; be the result of the &lt;span&gt;URL parser&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;If any percent-encoded octets in that component are not valid
-    UTF-8 sequences (e.g. sequences of percent-encoded octets that
-    expand to surrogate code points), then return an error and abort
-    these steps.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;serialized URL&lt;/var&gt; be the result of apply the &lt;span&gt;URL
+   serializer&lt;/span&gt; to &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;Apply the IDNA ToASCII algorithm to the matching substring,
-    with both the AllowUnassigned and UseSTD3ASCIIRules flags
-    set. Replace the matching substring with the result of the ToASCII
-    algorithm.&lt;/p&gt;
+   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;serialized URL&lt;/var&gt; as the &lt;dfn&gt;resulting absolute URL&lt;/dfn&gt; and
+   &lt;var title=&quot;&quot;&gt;parsed URL&lt;/var&gt; as the &lt;dfn&gt;resulting parsed URL&lt;/dfn&gt;.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;If ToASCII fails to convert one of the components of the
-    string, e.g. because it is too long or because it contains invalid
-    characters, then return an error and abort these steps. &lt;a
-    href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
-    title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from applying the following steps to each character other
-    than U+0025 PERCENT SIGN (%) that doesn't match the original
-    &lt;path&gt; production defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;
-
-     &lt;li&gt;Encode the character into a sequence of octets as defined by the &lt;span&gt;utf-8 encoder&lt;/span&gt;
-     algorithm. &lt;a href=&quot;#refsENCODING&quot;&gt;[ENCODING]&lt;/a&gt;&lt;/li&gt;
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those
-     octets. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-    &lt;div class=&quot;example&quot;&gt;
-
-     &lt;p&gt;For instance if &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; was &quot;&lt;code
-     title=&quot;&quot;&gt;//example.com/a^b&amp;#x263a;c%FFd%z/?e&lt;/code&gt;&quot;, then the
-     &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component's substring
-     would be &quot;&lt;code title=&quot;&quot;&gt;/a^b&amp;#x263a;c%FFd%z/&lt;/code&gt;&quot; and the two
-     characters that would have to be escaped would be &quot;&lt;code
-     title=&quot;&quot;&gt;^&lt;/code&gt;&quot; and &quot;&lt;code title=&quot;&quot;&gt;&amp;#x263a;&lt;/code&gt;&quot;. The
-     result after this step was applied would therefore be that &lt;var
-     title=&quot;&quot;&gt;url&lt;/var&gt; now had the value &quot;&lt;code
-     title=&quot;&quot;&gt;//example.com/a%5Eb%E2%98%BAc%FFd%z/?e&lt;/code&gt;&quot;.&lt;/p&gt;
-
-    &lt;/div&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If parsing &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; resulted in a &lt;span
-    title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component, then replace the
-    matching substring of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; with the string that
-    results from applying the following steps to each character other
-    than U+0025 PERCENT SIGN (%) that doesn't match the original
-    &lt;query&gt; production defined in RFC 3986:&lt;/p&gt;
-
-    &lt;ol&gt;
-
-     &lt;li&gt;If the character in question cannot be expressed in the
-     encoding &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;, then replace it with a
-     single 0x3F octet (an ASCII question mark) and skip the remaining
-     substeps for this character.&lt;/li&gt;
-
-     &lt;li&gt;Encode the character into a sequence of octets as defined by the &lt;span&gt;encoder&lt;/span&gt;
-     algorithm for &lt;var title=&quot;&quot;&gt;encoding&lt;/var&gt;. &lt;a href=&quot;#refsENCODING&quot;&gt;[ENCODING]&lt;/a&gt;&lt;/li&gt;
-
-     &lt;li&gt;Replace the character with the percent-encoded form of those
-     octets. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/li&gt;
-
-    &lt;/ol&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Apply the algorithm described in RFC 3986 section 5.2
-   Relative Resolution, using &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; as the
-   potentially relative URI reference (&lt;var title=&quot;&quot;&gt;R&lt;/var&gt;), and
-   &lt;var title=&quot;&quot;&gt;base&lt;/var&gt; as the base URI (&lt;var
-   title=&quot;&quot;&gt;Base&lt;/var&gt;). &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;Apply any relevant conformance criteria of RFC 3986 and RFC
-    3987, returning an error and aborting these steps if
-    appropriate. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-    href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
-
-    &lt;p class=&quot;example&quot;&gt;For instance, if an absolute URI that would be
-    returned by the above algorithm violates the restrictions specific
-    to its scheme, e.g. a &lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URI using the
-    &quot;&lt;code title=&quot;&quot;&gt;//&lt;/code&gt;&quot; server-based naming authority syntax,
-    then user agents are to treat this as an error instead.&lt;!-- RFC
-    3986, 3.1 Scheme --&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; be the target URI (&lt;var
-   title=&quot;&quot;&gt;T&lt;/var&gt;) returned by the Relative Resolution
-   algorithm.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; uses a scheme with a
-   server-based naming authority, replace all U+005C REVERSE SOLIDUS
-   (\) characters in &lt;var title=&quot;&quot;&gt;result&lt;/var&gt; with U+002F SOLIDUS
-   (/) characters.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;result&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
   &lt;/ol&gt;
 
-  &lt;p class=&quot;note&quot;&gt;Some of the steps in these rules, for example the
-  processing of U+005C REVERSE SOLIDUS (\) characters, are a
-  &lt;span&gt;willful violation&lt;/span&gt; of RFC 3986 and RFC 3987, motivated
-  by a desire to handle legacy content. &lt;a
-  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC3987&quot;&gt;[RFC3987]&lt;/a&gt;&lt;/p&gt;
+  &lt;p&gt;Given an element, &lt;dfn&gt;the element's base URL&lt;/dfn&gt; is the &lt;i&gt;base URI of the element&lt;/i&gt;, as
+  defined by the XML Base specification, with &lt;i&gt;the base URI of the document entity&lt;/i&gt; being
+  defined as the &lt;span&gt;document base URL&lt;/span&gt; of the &lt;code&gt;Document&lt;/code&gt; that owns the element.
+  &lt;a href=&quot;#refsXMLBASE&quot;&gt;[XMLBASE]&lt;/a&gt;&lt;/p&gt;
 
-  &lt;/div&gt;
+  &lt;p&gt;For the purposes of the XML Base specification, user agents must act as if all
+  &lt;code&gt;Document&lt;/code&gt; objects represented XML documents.&lt;/p&gt;
 
-  &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt; is an &lt;dfn&gt;absolute URL&lt;/dfn&gt; if &lt;span
-  title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; it results in the same output
-  regardless of what it is resolved relative to, and that output is
-  not a failure.&lt;/p&gt;
+  &lt;p class=&quot;note&quot;&gt;It is possible for &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt; attributes to be
+  present even in HTML fragments, as such attributes can be added dynamically using script. (Such
+  scripts would not be conforming, however, as &lt;code title=&quot;attr-xml-base&quot;&gt;xml:base&lt;/code&gt;
+  attributes are not allowed in &lt;span&gt;HTML documents&lt;/span&gt;.)&lt;/p&gt;
 
-  &lt;p&gt;An &lt;span&gt;absolute URL&lt;/span&gt; is a &lt;dfn&gt;hierarchical URL&lt;/dfn&gt; if,
-  when &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; and then &lt;span
-  title=&quot;parse a url&quot;&gt;parsed&lt;/span&gt;, there is a character immediately
-  after the &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component
-  and it is a U+002F SOLIDUS character (/).&lt;/p&gt;
-
-  &lt;p&gt;An &lt;span&gt;absolute URL&lt;/span&gt; is an &lt;dfn&gt;authority-based URL&lt;/dfn&gt;
-  if, when &lt;span title=&quot;resolve a url&quot;&gt;resolved&lt;/span&gt; and then &lt;span
-  title=&quot;parse a url&quot;&gt;parsed&lt;/span&gt;, there are two characters
-  immediately after the &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt;
-  component and they are both U+002F SOLIDUS characters (//).&lt;/p&gt;
-
-
-
-  &lt;div class=&quot;impl&quot;&gt;
-
-  &lt;h4&gt;URL manipulation and creation&lt;/h4&gt;
-
-  &lt;p&gt;To &lt;dfn title=&quot;fragment-escaped&quot;&gt;fragment-escape&lt;/dfn&gt; a string
-  &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, a user agent must run the following
-  steps:&lt;/p&gt;
-
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; be the string to be
-   escaped.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; point at the first
-   character of &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be an empty string.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;Loop&lt;/i&gt;: If &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is past the end
-   of &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;, then jump to the step labeled
-   &lt;i&gt;end&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If the character in &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; pointed to by
-    &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; is in the range U+0000 to U+0020 or
-    is one of the following characters:&lt;/p&gt;
-
-    &lt;ul class=&quot;brief&quot;&gt;
-     &lt;li&gt;U+0022 QUOTATION MARK character (&quot;)
-     &lt;li&gt;U+0023 NUMBER SIGN character (#)
-     &lt;li&gt;U+0025 PERCENT SIGN character (%)
-     &lt;li&gt;U+003C LESS-THAN SIGN character (&lt;)
-     &lt;li&gt;U+003E GREATER-THAN SIGN character (&gt;)
-     &lt;li&gt;U+005B LEFT SQUARE BRACKET character ([)
-     &lt;li&gt;U+005C REVERSE SOLIDUS character (\)
-     &lt;li&gt;U+005D RIGHT SQUARE BRACKET character (])
-     &lt;li&gt;U+005E CIRCUMFLEX ACCENT character (^)
-     &lt;li&gt;U+007B LEFT CURLY BRACKET character ({)
-     &lt;li&gt;U+007C VERTICAL LINE character (|)
-     &lt;li&gt;U+007D RIGHT CURLY BRACKET character (})
-    &lt;/ul&gt;
-
-    &lt;p&gt;...then append the percent-encoded form of the character to
-    &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;. &lt;a
-    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt; &lt;!-- this is the same
-    phrasing that's used elsewhere in the spec, but we really should
-    define 'percent-encoded' or at least ensure we consistently say
-    whether it's upper-case or lower-case. --&gt;
-
-    &lt;p&gt;Otherwise, append the character itself to &lt;var
-    title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;This escapes any ASCII characters that are not
-    valid in the URI &lt;fragment&gt; production without being
-    escaped.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Advance &lt;var title=&quot;&quot;&gt;position&lt;/var&gt; to the next character
-   in &lt;var title=&quot;&quot;&gt;input&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Return to the step labeled &lt;i&gt;loop&lt;/i&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
   &lt;/div&gt;
 
 
@@ -6471,290 +6080,9 @@
   &lt;/div&gt;
 
 
-&lt;!--TOPIC:DOM APIs--&gt;
-  &lt;h4&gt;Interfaces for URL manipulation&lt;/h4&gt;
-
-  &lt;p&gt;An interface that has a complement of &lt;dfn&gt;URL decomposition IDL
-  attributes&lt;/dfn&gt; has seven attributes with the following
-  definitions:&lt;/p&gt;
-
-&lt;pre class=&quot;idl extract&quot;&gt;           attribute DOMString &lt;span title=&quot;dom-uda-protocol&quot;&gt;protocol&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-host&quot;&gt;host&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-hostname&quot;&gt;hostname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-port&quot;&gt;port&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-pathname&quot;&gt;pathname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-search&quot;&gt;search&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-uda-hash&quot;&gt;hash&lt;/span&gt;;&lt;/pre&gt;
-
-  &lt;dl class=&quot;domintro&quot;&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=&quot;dom-uda-protocol&quot;&gt;protocol&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current scheme of the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's scheme.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=&quot;dom-uda-host&quot;&gt;host&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current host and port (if it's not the default port) in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's host and port.&lt;/p&gt;
-    &lt;p&gt;The host and the port are separated by a colon. The port part,
-    if omitted, will be assumed to be the current scheme's default
-    port.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=&quot;dom-uda-hostname&quot;&gt;hostname&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current host in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's host.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=&quot;dom-uda-port&quot;&gt;port&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current port in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's port.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=&quot;dom-uda-pathname&quot;&gt;pathname&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current path in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's path.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=&quot;dom-uda-search&quot;&gt;search&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current query component in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's query component.&lt;/p&gt;
-   &lt;/dd&gt;
-
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;o&lt;/var&gt; . &lt;code title=&quot;dom-uda-hash&quot;&gt;hash&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
-   &lt;dd&gt;
-    &lt;p&gt;Returns the current fragment identifier in the underlying URL.&lt;/p&gt;
-    &lt;p&gt;Can be set, to change the underlying URL's fragment identifier.&lt;/p&gt;
-   &lt;/dd&gt;
-
-  &lt;/dl&gt;
-
+&lt;!--CLEANUP--&gt;
   &lt;div class=&quot;impl&quot;&gt;
 
-  &lt;hr&gt;
-
-  &lt;p&gt;The attributes defined to be &lt;span&gt;URL decomposition IDL
-  attributes&lt;/span&gt; must act as described for the attributes with the
-  same corresponding names in this section.&lt;/p&gt;
-
-  &lt;p&gt;In addition, an interface with a complement of &lt;span&gt;URL
-  decomposition IDL attributes&lt;/span&gt; defines an &lt;dfn
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/dfn&gt;, which is a &lt;span&gt;URL&lt;/span&gt;
-  that the attributes act on, and a &lt;dfn
-  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/dfn&gt;, which is a
-  set of steps invoked when any of the attributes' setters are
-  invoked.&lt;/p&gt;
-
-  &lt;p&gt;The seven &lt;span&gt;URL decomposition IDL attributes&lt;/span&gt; have
-  similar requirements.&lt;/p&gt;
-
-  &lt;p&gt;On getting, if the &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt;
-  is an &lt;span&gt;absolute URL&lt;/span&gt; that fulfills the condition given in
-  the &quot;getter condition&quot; column corresponding to the attribute in the
-  table below, the user agent must return the part of the &lt;span
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; URL given in the &quot;component&quot;
-  column, with any prefixes specified in the &quot;prefix&quot; column
-  appropriately added to the start of the string and any suffixes
-  specified in the &quot;suffix&quot; column appropriately added to the end of
-  the string. Otherwise, the attribute must return the empty
-  string.&lt;/p&gt;
-
-  &lt;p&gt;On setting, the new value must first be mutated as described by
-  the &quot;setter preprocessor&quot; column, then mutated by %-escaping any
-  characters in the new value that are not valid in the relevant
-  component as given by the &quot;component&quot; column. Then, if the &lt;span
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is an &lt;span&gt;absolute
-  URL&lt;/span&gt; and the resulting new value fulfills the condition given
-  in the &quot;setter condition&quot; column, the user agent must make a new
-  string &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; by replacing the component of the
-  URL given by the &quot;component&quot; column in the &lt;span
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; URL with the new value;
-  otherwise, the user agent must let &lt;var title=&quot;&quot;&gt;output&lt;/var&gt; be
-  equal to the &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt;. Finally,
-  the user agent must invoke the &lt;span
-  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/span&gt; with the
-  value of &lt;var title=&quot;&quot;&gt;output&lt;/var&gt;.&lt;/p&gt;
-
-  &lt;p&gt;When replacing a component in the URL, if the component is part
-  of an optional group in the URL syntax consisting of a character
-  followed by the component, the component (including its prefix
-  character) must be included even if the new value is the empty
-  string.&lt;/p&gt;
-
-  &lt;p class=&quot;note&quot;&gt;The previous paragraph applies in particular to the
-  &quot;&lt;code title=&quot;&quot;&gt;:&lt;/code&gt;&quot; before a &lt;port&gt; component, the &quot;&lt;code
-  title=&quot;&quot;&gt;?&lt;/code&gt;&quot; before a &lt;query&gt; component, and the &quot;&lt;code
-  title=&quot;&quot;&gt;#&lt;/code&gt;&quot; before a &lt;fragment&gt; component.&lt;/p&gt;
-
-  &lt;p&gt;For the purposes of the above definitions, URLs must be parsed
-  using the &lt;span title=&quot;parse a URL&quot;&gt;URL parsing rules&lt;/span&gt; defined
-  in this specification.&lt;/p&gt;
-
-  &lt;table id=&quot;table-uda&quot;&gt;
-   &lt;thead&gt;
-    &lt;tr&gt;
-     &lt;th&gt;Attribute
-     &lt;th&gt;Component
-     &lt;th&gt;Getter Condition
-     &lt;th&gt;Prefix
-     &lt;th&gt;Suffix
-     &lt;th&gt;Setter Preprocessor
-     &lt;th&gt;Setter Condition
-   &lt;tbody&gt;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;U+003A COLON (:)
-     &lt;td&gt;Remove all trailing U+003A COLON characters (:)
-     &lt;td&gt;The new value is not the empty string
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-hostport&quot;&gt;&lt;hostport&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is an &lt;span&gt;authority-based URL&lt;/span&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;The new value is not the empty string and &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is an &lt;span&gt;authority-based URL&lt;/span&gt;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is an &lt;span&gt;authority-based URL&lt;/span&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove all leading U+002F SOLIDUS characters (/)
-     &lt;td&gt;The new value is not the empty string and &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is an &lt;span&gt;authority-based URL&lt;/span&gt;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is an &lt;span&gt;authority-based URL&lt;/span&gt;, and contained a &lt;span title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/span&gt; component (possibly an empty one)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove all characters in the new value from the first that is not an &lt;span title=&quot;ASCII digits&quot;&gt;ASCII digit&lt;/span&gt;, if any.
-         Remove any leading U+0030 DIGIT ZERO characters (0) in the new value.
-         If the resulting string is empty, set it to a single U+0030 DIGIT ZERO character (0).
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is an &lt;span&gt;authority-based URL&lt;/span&gt;,
-         and the new value, when interpreted as a base-ten integer, is less than or equal to 65535
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-pathname&quot;&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is a &lt;span&gt;hierarchical URL&lt;/span&gt;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;&mdash;
-     &lt;td&gt;If it has no leading U+002F SOLIDUS character (/), prepend a U+002F SOLIDUS character (/) to the new value
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is hierarchical
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-search&quot;&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is a &lt;span&gt;hierarchical URL&lt;/span&gt;, and contained a &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component (possibly an empty one)
-     &lt;td&gt;U+003F QUESTION MARK (?)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove one leading U+003F QUESTION MARK character (?), if any
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; is a &lt;span&gt;hierarchical URL&lt;/span&gt;
-    &lt;tr&gt;
-     &lt;td&gt;&lt;dfn title=&quot;dom-uda-hash&quot;&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;
-     &lt;td&gt;&lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
-     &lt;td&gt;&lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; contained a non-empty &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component
-     &lt;td&gt;U+0023 NUMBER SIGN (#)
-     &lt;td&gt;&mdash;
-     &lt;td&gt;Remove one leading U+0023 NUMBER SIGN character (#), if any
-     &lt;td&gt;&mdash;
-  &lt;/table&gt;
-
-&lt;!--
-  <A HREF="http://www.hixie.ch/tests/adhoc/dom/level0/location/components/">http://www.hixie.ch/tests/adhoc/dom/level0/location/components/</A>
-  <A HREF="http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp">http://lxr.mozilla.org/seamonkey/source/dom/src/base/nsLocation.cpp</A>
-  <A HREF="http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722">http://wp.netscape.com/eng/mozilla/3.0/handbook/javascript/ref_h-l.htm#84722</A>
---&gt;
-
-  &lt;/div&gt;
-
-  &lt;div class=&quot;example&quot;&gt;
-
-   &lt;p&gt;The table below demonstrates how the getter &lt;span
-   class=&quot;impl&quot;&gt;condition&lt;/span&gt; for &lt;code
-   title=&quot;dom-uda-search&quot;&gt;search&lt;/code&gt; results in different results
-   depending on the exact original syntax of the URL:&lt;/p&gt;
-
-   &lt;table id=&quot;table-uda-examples&quot;&gt;
-    &lt;thead&gt;
-     &lt;tr&gt;
-      &lt;th&gt; Input URL
-      &lt;th&gt; &lt;code title=&quot;dom-uda-search&quot;&gt;search&lt;/code&gt; value
-      &lt;th&gt; Explanation
-    &lt;tbody&gt;
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/&lt;/code">http://example.com/&lt;/code</A>&gt;
-      &lt;td&gt; &lt;i&gt;empty string&lt;/i&gt;
-      &lt;td&gt; No &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component in input URL.
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?&lt;/code">http://example.com/?&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
-      &lt;td&gt; There is a &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component, but it is empty.
-           &lt;span class=&quot;impl&quot;&gt;The question mark in the resulting value is the prefix.&lt;/span&gt;
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test&lt;/code">http://example.com/?test&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-      &lt;td&gt; The &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component has the value &quot;&lt;code title=&quot;&quot;&gt;test&lt;/code&gt;&quot;.
-     &lt;tr&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/?test#&lt;/code">http://example.com/?test#&lt;/code</A>&gt;
-      &lt;td&gt; &lt;code title=&quot;&quot;&gt;?test&lt;/code&gt;
-      &lt;td&gt; The (empty) &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component is not part of the &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component.
-   &lt;/table&gt;
-
-  &lt;/div&gt;
-
-  &lt;div class=&quot;example&quot;&gt;
-
-   &lt;p&gt;The following table is similar; it provides a list of what each
-   of the &lt;span&gt;URL decomposition IDL attributes&lt;/span&gt; returns for a
-   given &lt;var title=&quot;&quot;&gt;input&lt;/var&gt; URL.&lt;/p&gt;
-
-   &lt;table&gt;
-    &lt;thead&gt;
-     &lt;tr&gt;
-      &lt;th&gt;Input
-      &lt;th&gt;&lt;code title=&quot;dom-uda-protocol&quot;&gt;protocol&lt;/code&gt;
-      &lt;th&gt;&lt;code title=&quot;dom-uda-host&quot;&gt;host&lt;/code&gt;
-      &lt;th&gt;&lt;code title=&quot;dom-uda-hostname&quot;&gt;hostname&lt;/code&gt;
-      &lt;th&gt;&lt;code title=&quot;dom-uda-port&quot;&gt;port&lt;/code&gt;
-      &lt;th&gt;&lt;code title=&quot;dom-uda-pathname&quot;&gt;pathname&lt;/code&gt;
-      &lt;th&gt;&lt;code title=&quot;dom-uda-search&quot;&gt;search&lt;/code&gt;
-      &lt;th&gt;&lt;code title=&quot;dom-uda-hash&quot;&gt;hash&lt;/code&gt;
-    &lt;tbody&gt;
-     &lt;tr&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;<A HREF="http://example.com/carrot#question%3f&lt;/code">http://example.com/carrot#question%3f&lt;/code</A>&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;http:&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;example.com&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;example.com&lt;/code&gt;
-      &lt;td&gt;(empty string)
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;/carrot&lt;/code&gt;
-      &lt;td&gt;(empty string)
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;#question%3f&lt;/code&gt;
-     &lt;tr&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;<A HREF="https://www.example.com:4443?&lt;/code">https://www.example.com:4443?&lt;/code</A>&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;https:&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;www.example.com:4443&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;www.example.com&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;4443&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;/&lt;/code&gt;
-      &lt;td&gt;&lt;code title=&quot;&quot;&gt;?&lt;/code&gt;
-      &lt;td&gt;(empty string)
-   &lt;/table&gt;
-
-  &lt;/div&gt;
-
-
-&lt;!--TOPIC:HTML--&gt;
-  &lt;div class=&quot;impl&quot;&gt;
-
   &lt;h3&gt;Fetching resources&lt;/h3&gt;
 
   &lt;h4&gt;Terminology&lt;/h4&gt;
@@ -6866,14 +6194,21 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;&lt;i&gt;Clean referrer&lt;/i&gt;: Remove any &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
-    component from &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt;.&lt;/p&gt; &lt;!-- RFC2616 says &quot;The URI MUST NOT include a
-    fragment.&quot; (section 14.36) --&gt;
+    &lt;p&gt;Apply the &lt;span&gt;URL parser&lt;/span&gt; to &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; and let &lt;var
+    title=&quot;&quot;&gt;parsed referrer&lt;/var&gt; be &lt;span&gt;resulting parsed URL&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
    &lt;li&gt;
 
+    &lt;p&gt;&lt;i&gt;Clean referrer&lt;/i&gt;: Let &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; be the result of applying the
+    &lt;span&gt;URL serializer&lt;/span&gt; to &lt;var title=&quot;&quot;&gt;parsed referrer&lt;/var&gt;, with the &lt;i&gt;exclude fragment
+    flag&lt;/i&gt; set.&lt;/p&gt; &lt;!-- RFC2616 says &quot;The URI MUST NOT include a fragment.&quot; (section 14.36) --&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;
+
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;referrer&lt;/var&gt; is not the empty string, is not a &lt;span title=&quot;data
     protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;data:&lt;/code&gt; URL&lt;/span&gt;, is not a &lt;span title=&quot;javascript
     protocol&quot;&gt;&lt;code title=&quot;&quot;&gt;javascript:&lt;/code&gt; URL&lt;/span&gt;, and is not the &lt;span&gt;URL&lt;/span&gt;
@@ -8642,6 +7977,10 @@
   document&lt;/span&gt;, and the &lt;code&gt;Document&lt;/code&gt; is both &lt;span&gt;ready for post-load tasks&lt;/span&gt; and
   &lt;span&gt;completely loaded&lt;/span&gt; immediately.&lt;/p&gt;
 
+  &lt;p&gt;&lt;dfn&gt;The document's referrer&lt;/dfn&gt; is an &lt;span&gt;absolute URL&lt;/span&gt; that can be set when the
+  &lt;code&gt;Document&lt;/code&gt; is created. If it is not explicitly set, then its value is the empty
+  string.&lt;/p&gt;
+
   &lt;p&gt;Each &lt;code&gt;Document&lt;/code&gt; object has a &lt;dfn&gt;reload override flag&lt;/dfn&gt; that is originally
   unset. The flag is set by the &lt;code title=&quot;dom-document-open&quot;&gt;document.open()&lt;/code&gt; and &lt;code
   title=&quot;dom-document-open&quot;&gt;document.write()&lt;/code&gt; methods in certain situations. When the flag is
@@ -8753,6 +8092,8 @@
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;document&lt;/var&gt; . &lt;code title=&quot;dom-document-referrer&quot;&gt;referrer&lt;/code&gt;&lt;/dt&gt;
    &lt;dd&gt;
 
+&lt;!--CLEANUP--&gt;
+
     &lt;p&gt;Returns &lt;span title=&quot;the document's address&quot;&gt;the address&lt;/span&gt;
     of the &lt;code&gt;Document&lt;/code&gt; from which the user navigated to this
     one, unless it was blocked or there was no such document, in which
@@ -8767,14 +8108,8 @@
 
   &lt;div class=&quot;impl&quot;&gt;
 
-  &lt;p&gt;The &lt;dfn title=&quot;dom-document-referrer&quot;&gt;&lt;code&gt;referrer&lt;/code&gt;&lt;/dfn&gt; attribute must return either
-  the &lt;span title=&quot;the document's address&quot;&gt;address&lt;/span&gt; of the &lt;span&gt;active document&lt;/span&gt; of the
-  &lt;span&gt;source browsing context&lt;/span&gt; &lt;em&gt;at the time the navigation was started&lt;/em&gt; (that is, the
-  page which &lt;span title=&quot;navigate&quot;&gt;navigated&lt;/span&gt; the &lt;span&gt;browsing context&lt;/span&gt; to the
-  current document), with any &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component removed;
-  or the empty string if there is no such originating page, or if the UA has been configured not to
-  report referrers in this case, or if the navigation was initiated for a &lt;span&gt;hyperlink&lt;/span&gt;
-  with a &lt;code title=&quot;rel-noreferrer&quot;&gt;noreferrer&lt;/code&gt; keyword.&lt;/p&gt;
+  &lt;p&gt;The &lt;dfn title=&quot;dom-document-referrer&quot;&gt;&lt;code&gt;referrer&lt;/code&gt;&lt;/dfn&gt; attribute must return
+  &lt;span&gt;the document's referrer&lt;/span&gt;.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -12688,6 +12023,8 @@
    title=&quot;script's document&quot;&gt;document&lt;/span&gt;'s &lt;span title=&quot;the document's
    address&quot;&gt;address&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;!-- &lt;span&gt;the document's referrer&lt;/span&gt; stays the same --&gt;
+
    &lt;li&gt;&lt;p&gt;Create a new &lt;span&gt;HTML parser&lt;/span&gt; and associate it with the document. This is a
    &lt;dfn&gt;script-created parser&lt;/dfn&gt; (meaning that it can be closed by the &lt;code
    title=&quot;dom-document-open&quot;&gt;document.open()&lt;/code&gt; and &lt;code
@@ -20428,16 +19765,8 @@
            attribute DOMString &lt;span title=&quot;dom-a-type&quot;&gt;type&lt;/span&gt;;
 
            attribute DOMString &lt;span title=&quot;dom-a-text&quot;&gt;text&lt;/span&gt;;
-
-  // &lt;span&gt;URL decomposition IDL attributes&lt;/span&gt;
-           attribute DOMString &lt;span title=&quot;dom-a-protocol&quot;&gt;protocol&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-a-host&quot;&gt;host&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-a-hostname&quot;&gt;hostname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-a-port&quot;&gt;port&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-a-pathname&quot;&gt;pathname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-a-search&quot;&gt;search&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-a-hash&quot;&gt;hash&lt;/span&gt;;
-};&lt;/pre&gt;
+};
+&lt;span&gt;HTMLAnchorElement&lt;/span&gt; implements &lt;span&gt;URLUtils&lt;/span&gt;;&lt;/pre&gt;
    &lt;/dd&gt;
   &lt;/dl&gt;&lt;!--TOPIC:HTML--&gt;
 
@@ -20559,6 +19888,7 @@
 
   &lt;/dl&gt;
 
+&lt;!-- CLEANUP --&gt;
   &lt;div class=&quot;impl&quot;&gt;
 
   &lt;p&gt;The IDL attributes &lt;dfn title=&quot;dom-a-href&quot;&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
@@ -20576,19 +19906,14 @@
   same value as the &lt;code&gt;textContent&lt;/code&gt; IDL attribute on the element, and on setting, must act
   as if the &lt;code&gt;textContent&lt;/code&gt; IDL attribute on the element had been set to the new value.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;a&lt;/code&gt; element also supports the complement of &lt;span&gt;URL decomposition IDL
-  attributes&lt;/span&gt;, &lt;dfn title=&quot;dom-a-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-a-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn title=&quot;dom-a-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-a-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-a-pathname&quot;&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-a-search&quot;&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn
-  title=&quot;dom-a-hash&quot;&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for &lt;span&gt;URL
-  decomposition IDL attributes&lt;/span&gt;, with the &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; being
-  the result of &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the element's &lt;code
-  title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute relative to the element, if there is such an
-  attribute and resolving it is successful, or the empty string otherwise; and the &lt;span
-  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/span&gt; being the same as setting the element's
-  &lt;code title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute to the new output value.&lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;a&lt;/code&gt; element also supports the &lt;code&gt;URLUtils&lt;/code&gt; interface. The &lt;span title=&quot;concept-uu-input&quot;&gt;input&lt;/span&gt; is
+  the value of the element's &lt;code
+  title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; content attribute, if there is such an
+  attribute, or the empty string otherwise; the &lt;span title=&quot;concept-uu-base&quot;&gt;base&lt;/span&gt;
+  is &lt;span&gt;the element's base URL&lt;/span&gt;; the &lt;span title=&quot;concept-uu-query-encoding&quot;&gt;query encoding&lt;/span&gt;
+  being the &lt;span&gt;document's character encoding&lt;/span&gt;; and the &lt;span
+  title=&quot;concept-uu-update&quot;&gt;update steps&lt;/span&gt; being the same as setting the element's
+  &lt;code title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; content attribute to the new output value.&lt;/p&gt;
 
   &lt;/div&gt;
 &lt;!--TOPIC:HTML--&gt;
@@ -26984,13 +26309,15 @@
     &lt;!-- if we get to this point we know we can successfully parsed the URL, since this algorithm is
     only used after fetching the resource in the steps above --&gt;
 
-    &lt;p&gt;Otherwise, if the &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component of the
-    &lt;span&gt;URL&lt;/span&gt; of the specified resource (after any redirects) matches a pattern that a
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;Otherwise, if applying the &lt;span&gt;URL parser&lt;/span&gt; algorithm to the
+    &lt;span&gt;URL&lt;/span&gt; of the specified resource (after any redirects) results in a &lt;span&gt;parsed URL&lt;/span&gt;
+    whose &lt;span title=&quot;concept-url-path&quot;&gt;path&lt;/span&gt; component matches a pattern that a
     &lt;span&gt;plugin&lt;/span&gt; supports, then the &lt;span title=&quot;concept-embed-type&quot;&gt;content's type&lt;/span&gt; is
     the type that that plugin can handle.&lt;/p&gt;
 
     &lt;p class=&quot;example&quot;&gt;For example, a plugin might say that it can handle resources with &lt;span
-    title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; components that end with the four character string &quot;&lt;code
+    title=&quot;concept-url-path&quot;&gt;path&lt;/span&gt; components that end with the four character string &quot;&lt;code
     title=&quot;&quot;&gt;.swf&lt;/code&gt;&quot;.&lt;/p&gt;
 
     &lt;!-- it's sad that we have to do extension sniffing. sigh. --&gt;
@@ -27573,13 +26900,15 @@
         &lt;!-- if we get to this point we know we can successfully parsed the URL, since this
         algorithm is only used after fetching the resource in the steps above --&gt;
 
-        &lt;p&gt;If the &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component of the &lt;span&gt;URL&lt;/span&gt; of
-        the specified resource (after any redirects) matches a pattern that a &lt;span&gt;plugin&lt;/span&gt;
+&lt;!--CLEANUP--&gt;
+        &lt;p&gt;If applying the &lt;span&gt;URL parser&lt;/span&gt; algorithm to the
+        &lt;span&gt;URL&lt;/span&gt; of the specified resource (after any redirects) results in a &lt;span&gt;parsed URL&lt;/span&gt;
+        whose &lt;span title=&quot;concept-url-path&quot;&gt;path&lt;/span&gt; component matches a pattern that a &lt;span&gt;plugin&lt;/span&gt;
         supports, then let &lt;var title=&quot;&quot;&gt;resource type&lt;/var&gt; be the type that that plugin can
         handle.&lt;/p&gt;
 
         &lt;p class=&quot;example&quot;&gt;For example, a plugin might say that it can handle resources with &lt;span
-        title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; components that end with the four character string
+        title=&quot;concept-url-path&quot;&gt;path&lt;/span&gt; components that end with the four character string
         &quot;&lt;code title=&quot;&quot;&gt;.swf&lt;/code&gt;&quot;.&lt;/p&gt;
 
         &lt;!-- it's sad that we have to do extension sniffing. sigh. --&gt;
@@ -32330,7 +31659,7 @@
   particular tracks in the fragment identifier of the &lt;span&gt;URL&lt;/span&gt; of the &lt;span&gt;media
   resource&lt;/span&gt;. The format of the fragment identifier depends on the &lt;span&gt;MIME type&lt;/span&gt; of
   the &lt;span&gt;media resource&lt;/span&gt;. &lt;a href=&quot;#refsRFC2046&quot;&gt;[RFC2046]&lt;/a&gt; &lt;a
-  href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+  href=&quot;#refsURL&quot;&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;div class=&quot;example&quot;&gt;
 
@@ -46277,16 +45606,8 @@
   readonly attribute &lt;span&gt;DOMTokenList&lt;/span&gt; &lt;span title=&quot;dom-area-relList&quot;&gt;relList&lt;/span&gt;;
            attribute DOMString &lt;span title=&quot;dom-area-hreflang&quot;&gt;hreflang&lt;/span&gt;;
            attribute DOMString &lt;span title=&quot;dom-area-type&quot;&gt;type&lt;/span&gt;;
-
-  // &lt;span&gt;URL decomposition IDL attributes&lt;/span&gt;
-           attribute DOMString &lt;span title=&quot;dom-area-protocol&quot;&gt;protocol&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-area-host&quot;&gt;host&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-area-hostname&quot;&gt;hostname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-area-port&quot;&gt;port&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-area-pathname&quot;&gt;pathname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-area-search&quot;&gt;search&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-area-hash&quot;&gt;hash&lt;/span&gt;;
-};&lt;/pre&gt;
+};
+&lt;span&gt;HTMLAreaElement&lt;/span&gt; implements &lt;span&gt;URLUtils&lt;/span&gt;;&lt;/pre&gt;
    &lt;/dd&gt;
   &lt;/dl&gt;&lt;!--TOPIC:HTML--&gt;
 
@@ -46465,9 +45786,9 @@
 
   &lt;p&gt;The IDL attributes &lt;dfn title=&quot;dom-area-alt&quot;&gt;&lt;code&gt;alt&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
   title=&quot;dom-area-coords&quot;&gt;&lt;code&gt;coords&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-area-href&quot;&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
   title=&quot;dom-area-target&quot;&gt;&lt;code&gt;target&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
   title=&quot;dom-area-download&quot;&gt;&lt;code&gt;download&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
+  title=&quot;dom-area-href&quot;&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
   title=&quot;dom-area-ping&quot;&gt;&lt;code&gt;ping&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn title=&quot;dom-area-rel&quot;&gt;&lt;code&gt;rel&lt;/code&gt;&lt;/dfn&gt;,
   &lt;dfn title=&quot;dom-area-hreflang&quot;&gt;&lt;code&gt;hreflang&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn
   title=&quot;dom-area-type&quot;&gt;&lt;code&gt;type&lt;/code&gt;&lt;/dfn&gt;, each must &lt;span&gt;reflect&lt;/span&gt; the respective
@@ -46479,19 +45800,14 @@
   &lt;p&gt;The IDL attribute &lt;dfn title=&quot;dom-area-rellist&quot;&gt;&lt;code&gt;relList&lt;/code&gt;&lt;/dfn&gt; must
   &lt;span&gt;reflect&lt;/span&gt; the &lt;code title=&quot;attr-hyperlink-rel&quot;&gt;rel&lt;/code&gt; content attribute.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;area&lt;/code&gt; element also supports the complement of &lt;span&gt;URL decomposition IDL
-  attributes&lt;/span&gt;, &lt;dfn title=&quot;dom-area-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-area-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn title=&quot;dom-area-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;,
-  &lt;dfn title=&quot;dom-area-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-area-pathname&quot;&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-area-search&quot;&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn
-  title=&quot;dom-area-hash&quot;&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for &lt;span&gt;URL
-  decomposition IDL attributes&lt;/span&gt;, with the &lt;span title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; being
-  the result of &lt;span title=&quot;resolve a url&quot;&gt;resolving&lt;/span&gt; the element's &lt;code
-  title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute relative to the element, if there is such an
-  attribute and resolving it is successful, or the empty string otherwise; and the &lt;span
-  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/span&gt; being the same as setting the element's
-  &lt;code title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; attribute to the new output value.&lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;area&lt;/code&gt; element also supports the &lt;code&gt;URLUtils&lt;/code&gt; interface. The &lt;span title=&quot;concept-uu-input&quot;&gt;input&lt;/span&gt; is
+  the value of the element's &lt;code
+  title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; content attribute, if there is such an
+  attribute, or the empty string otherwise; the &lt;span title=&quot;concept-uu-base&quot;&gt;base&lt;/span&gt;
+  is &lt;span&gt;the element's base URL&lt;/span&gt;; the &lt;span title=&quot;concept-uu-query-encoding&quot;&gt;query encoding&lt;/span&gt;
+  being the &lt;span&gt;document's character encoding&lt;/span&gt;; and the &lt;span
+  title=&quot;concept-uu-update&quot;&gt;update steps&lt;/span&gt; being the same as setting the element's
+  &lt;code title=&quot;attr-hyperlink-href&quot;&gt;href&lt;/code&gt; content attribute to the new output value.&lt;/p&gt;
 
   &lt;/div&gt;
 
@@ -64928,6 +64244,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;div class=&quot;impl&quot;&gt;
 
@@ -64993,11 +64310,6 @@
     title=&quot;&quot;&gt;action&lt;/var&gt; be &lt;span&gt;the document's address&lt;/span&gt; of
     the &lt;var title=&quot;&quot;&gt;form document&lt;/var&gt;.&lt;/p&gt;
 
-    &lt;p class=&quot;note&quot;&gt;This step is a &lt;span&gt;willful violation&lt;/span&gt; of
-    RFC 3986, which would require base URL processing here. This
-    violation is motivated by a desire for compatibility with legacy
-    content. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
-
     &lt;!-- Don't ask me why. But that's what IE does. It even treats
     action=&quot;&quot; differently from action=&quot; &quot; or action=&quot;#&quot; (the latter
     two resolve to the base URL, the first one resolves to the doc
@@ -65011,12 +64323,17 @@
    &lt;li&gt;&lt;p&gt;&lt;span title=&quot;resolve a url&quot;&gt;Resolve&lt;/span&gt; the
    &lt;span&gt;URL&lt;/span&gt; &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;, relative to the &lt;var
    title=&quot;&quot;&gt;submitter&lt;/var&gt; element. If this fails, abort these
-   steps. Otherwise, let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be the resulting
+   steps.&lt;/p&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; be the resulting
    &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;action components&lt;/var&gt; be the resulting &lt;span&gt;parsed
+   URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;scheme&lt;/var&gt; be the &lt;span
-   title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; of the resulting
-   &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; of the resulting
+   &lt;span&gt;parsed URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;enctype&lt;/var&gt; be the &lt;var
    title=&quot;&quot;&gt;submitter&lt;/var&gt; element's &lt;span
@@ -65113,11 +64430,11 @@
       &lt;!-- by this point we've already tried to resolve the URL, so we
       know we can parse it --&gt;
 
+      &lt;p&gt;Set &lt;var title=&quot;&quot;&gt;parsed action&lt;/var&gt;'s &lt;span title=&quot;concept-url-query&quot;&gt;query&lt;/span&gt;
+      component to &lt;var title=&quot;&quot;&gt;query&lt;/var&gt;.&lt;/p&gt;
+
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt; be a new &lt;span&gt;URL&lt;/span&gt;
-      that is equal to the &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; except that its
-      &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component is
-      replaced by &lt;var title=&quot;&quot;&gt;query&lt;/var&gt; (adding a U+003F QUESTION
-      MARK character (?) if appropriate).&lt;/p&gt;
+      formed by applying the &lt;span&gt;URL serializer&lt;/span&gt; algorithm to &lt;var title=&quot;&quot;&gt;parsed action&lt;/var&gt;.&lt;/p&gt;
 
       &lt;p&gt;&lt;span&gt;Navigate&lt;/span&gt;&lt;!--DONAV form--&gt; &lt;var title=&quot;&quot;&gt;target
       browsing context&lt;/var&gt; to &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt;. If
@@ -65188,6 +64505,8 @@
       browsing context&lt;/var&gt; must be navigated with &lt;span&gt;replacement
       enabled&lt;/span&gt;.&lt;/p&gt;
 
+      &lt;p class=&quot;note&quot;&gt;The &lt;var title=&quot;&quot;&gt;form data set&lt;/var&gt; is discarded.&lt;/p&gt;
+
      &lt;/dd&gt;
 
      &lt;dt&gt;&lt;dfn title=&quot;submit-data-post&quot;&gt;Post to data:&lt;/dfn&gt;
@@ -65199,26 +64518,24 @@
 
       &lt;p&gt;If &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; contains the string &quot;&lt;code
       title=&quot;&quot;&gt;%%%%&lt;/code&gt;&quot; (four U+0025 PERCENT SIGN characters),
-      then %-escape all bytes in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if
-      interpreted as US-ASCII, do not match the &lt;code
-      title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in the URI Generic Syntax,
-      and then, treating the result as a US-ASCII string, further
-      %-escape all the U+0025 PERCENT SIGN characters in the resulting
+      then &lt;span&gt;percent encode&lt;/span&gt; all bytes in &lt;var title=&quot;&quot;&gt;data&lt;/var&gt; that, if
+      interpreted as US-ASCII, are not characters in the URL &lt;span&gt;default encode set&lt;/span&gt;,
+      and then, treating the result as a US-ASCII string, 
+      &lt;span&gt;UTF-8 percent encode&lt;/span&gt; all the U+0025 PERCENT SIGN characters in the resulting
       string and replace the first occurrence of &quot;&lt;code
       title=&quot;&quot;&gt;%%%%&lt;/code&gt;&quot; in &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; with the
-      resulting double-escaped string. &lt;a
-      href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      resulting doubly-escaped string. &lt;a
+      href=&quot;#refsURL&quot;&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;Otherwise, if &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; contains the string
       &quot;&lt;code title=&quot;&quot;&gt;%%&lt;/code&gt;&quot; (two U+0025 PERCENT SIGN characters
-      in a row, but not four), then %-escape all characters in &lt;var
-      title=&quot;&quot;&gt;data&lt;/var&gt; that, if interpreted as US-ASCII, do not
-      match the &lt;code title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in the URI
-      Generic Syntax, and then, treating the result as a US-ASCII
+      in a row, but not four), then &lt;span&gt;UTF-8 percent encode&lt;/span&gt; all characters in &lt;var
+      title=&quot;&quot;&gt;data&lt;/var&gt; that, if interpreted as US-ASCII, 
+      are not characters in the URL &lt;span&gt;default encode set&lt;/span&gt;, and then, treating the result as a US-ASCII
       string, replace the first occurrence of &quot;&lt;code
       title=&quot;&quot;&gt;%%&lt;/code&gt;&quot; in &lt;var title=&quot;&quot;&gt;action&lt;/var&gt; with the
       resulting escaped string. &lt;a
-      href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      href=&quot;#refsURL&quot;&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;&lt;span&gt;Navigate&lt;/span&gt;&lt;!--DONAV form--&gt; &lt;var title=&quot;&quot;&gt;target
       browsing context&lt;/var&gt; to the potentially modified &lt;var
@@ -65265,12 +64582,11 @@
      &lt;dt&gt;&lt;dfn title=&quot;submit-mailto-body&quot;&gt;Mail as body&lt;/dfn&gt;
      &lt;dd&gt;
 
-      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the resulting encoding the
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the resulting of encoding the
       &lt;var title=&quot;&quot;&gt;form data set&lt;/var&gt; using the &lt;span&gt;appropriate
-      form encoding algorithm&lt;/span&gt; and then %-escaping all the bytes
+      form encoding algorithm&lt;/span&gt; and then &lt;span title=&quot;percent encode&quot;&gt;percent encoding&lt;/span&gt; all the bytes
       in the resulting byte string that, when interpreted as US-ASCII,
-      do not match the &lt;code title=&quot;&quot;&gt;unreserved&lt;/code&gt; production in
-      the URI Generic Syntax. &lt;a href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+      are not characters in the URL &lt;span&gt;default encode set&lt;/span&gt;. &lt;a href=&quot;#refsURL&quot;&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
       &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;destination&lt;/var&gt; have the same value as
       &lt;var title=&quot;&quot;&gt;action&lt;/var&gt;.&lt;/p&gt;
@@ -75974,7 +75290,11 @@
   &lt;span&gt;completely loaded&lt;/span&gt; immediately. The &lt;code&gt;Document&lt;/code&gt; must have a single child
   &lt;code&gt;html&lt;/code&gt; node, which itself has a single child &lt;code&gt;body&lt;/code&gt; node. As soon as this
   &lt;code&gt;Document&lt;/code&gt; is created, the user agent must &lt;span&gt;implement the sandboxing&lt;/span&gt; for
-  it.&lt;/p&gt;
+  it. If the &lt;span&gt;browsing context&lt;/span&gt; has a &lt;span&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/span&gt;, then
+  the &lt;span&gt;browsing context&lt;/span&gt;'s &lt;code&gt;Document&lt;/code&gt;'s &lt;span title=&quot;the document's
+  referrer&quot;&gt;referrer&lt;/span&gt; must be set to &lt;span title=&quot;the document's address&quot;&gt;the address&lt;/span&gt;
+  of that &lt;span&gt;creator &lt;code&gt;Document&lt;/code&gt;&lt;/span&gt; at the time of the &lt;span&gt;browsing
+  context&lt;/span&gt;'s creation.&lt;/p&gt;
 
   &lt;p class=&quot;note&quot;&gt;If the &lt;span&gt;browsing context&lt;/span&gt; is created specifically to be immediately
   navigated, then that initial navigation will have &lt;span&gt;replacement enabled&lt;/span&gt;.&lt;/p&gt;
@@ -77873,10 +77193,11 @@
 
   &lt;div class=&quot;impl&quot;&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;The &lt;dfn title=&quot;dom-document-domain&quot;&gt;&lt;code&gt;domain&lt;/code&gt;&lt;/dfn&gt; attribute on
   &lt;code&gt;Document&lt;/code&gt; objects must be initialized to &lt;span&gt;the document's domain&lt;/span&gt;, if it has
   one, and the empty string otherwise. If the value is an IPv6 address, then the square brackets
-  from the host portion of the &lt;span title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt; component must be omitted
+  from the &lt;span title=&quot;concept-url-host&quot;&gt;host&lt;/span&gt; component must be omitted
   from the attribute's value.&lt;/p&gt;
 
   &lt;p&gt;On getting, the attribute must return its current value, unless the &lt;code&gt;Document&lt;/code&gt; has
@@ -78695,16 +78016,17 @@
 
      &lt;li&gt;If that fails, throw a &lt;code&gt;SecurityError&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
-     &lt;li&gt;Compare the resulting &lt;span&gt;absolute URL&lt;/span&gt; to &lt;span&gt;the document's address&lt;/span&gt;. If
-     any part of these two &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt; differ other than the &lt;span
-     title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt;, &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt;, and &lt;span
-     title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; components, then throw a
+&lt;!--CLEANUP--&gt;
+     &lt;li&gt;Compare the resulting &lt;span&gt;parsed URL&lt;/span&gt; to the result of applying the &lt;span&gt;URL parser&lt;/span&gt; algorithm to &lt;span&gt;the document's address&lt;/span&gt;. If
+     any component of these two &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt; differ other than the &lt;span
+     title=&quot;concept-url-path&quot;&gt;path&lt;/span&gt;, &lt;span title=&quot;concept-url-query&quot;&gt;query&lt;/span&gt;, and &lt;span
+     title=&quot;concept-url-fragment&quot;&gt;fragment&lt;/span&gt; components, then throw a
      &lt;code&gt;SecurityError&lt;/code&gt; exception and abort these steps.&lt;/li&gt;
 
      &lt;li&gt;If the &lt;span&gt;origin&lt;/span&gt; of the resulting &lt;span&gt;absolute URL&lt;/span&gt; is not the same as
      the &lt;span&gt;origin&lt;/span&gt; of the &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's
-     document&quot;&gt;document&lt;/span&gt;, and either the &lt;span title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; or &lt;span
-     title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; components of the two &lt;span title=&quot;URL&quot;&gt;URLs&lt;/span&gt;
+     document&quot;&gt;document&lt;/span&gt;, and either the &lt;span title=&quot;concept-url-path&quot;&gt;path&lt;/span&gt; or &lt;span
+     title=&quot;concept-url-query&quot;&gt;query&lt;/span&gt; components of the two &lt;span title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/span&gt;
      compared in the previous step differ, throw a &lt;code&gt;SecurityError&lt;/code&gt; exception and abort
      these steps. (This prevents sandboxed content from spoofing other pages on the same
      origin.)&lt;/li&gt;
@@ -78714,9 +78036,8 @@
     &lt;/ol&gt;
 
     &lt;p&gt;For the purposes of the comparisons in the above substeps, the &lt;span
-    title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; and &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; components
-    can only be the same if the URLs are both &lt;span title=&quot;hierarchical URL&quot;&gt;hierarchical
-    URLs&lt;/span&gt;.&lt;/p&gt;
+    title=&quot;concept-url-path&quot;&gt;path&lt;/span&gt; and &lt;span title=&quot;concept-url-query&quot;&gt;query&lt;/span&gt; components
+    can only be the same if the &lt;span title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; component of both &lt;span title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/span&gt; are &lt;span title=&quot;concept-url-scheme-relative&quot;&gt;relative schemes&lt;/span&gt;.&lt;/p&gt;
 
    &lt;/li&gt;
 
@@ -78961,17 +78282,9 @@
   void &lt;span title=&quot;dom-location-assign&quot;&gt;assign&lt;/span&gt;(DOMString url);
   void &lt;span title=&quot;dom-location-replace&quot;&gt;replace&lt;/span&gt;(DOMString url);
   void &lt;span title=&quot;dom-location-reload&quot;&gt;reload&lt;/span&gt;();
+};
+&lt;span&gt;Location&lt;/span&gt; implements &lt;span&gt;URLUtils&lt;/span&gt;;&lt;/pre&gt;
 
-  // &lt;span&gt;URL decomposition IDL attributes&lt;/span&gt; &lt;!-- blame brendan for these &quot;innovative&quot; names --&gt;
-           attribute DOMString &lt;span title=&quot;dom-location-protocol&quot;&gt;protocol&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-location-host&quot;&gt;host&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-location-hostname&quot;&gt;hostname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-location-port&quot;&gt;port&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-location-pathname&quot;&gt;pathname&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-location-search&quot;&gt;search&lt;/span&gt;;
-           attribute DOMString &lt;span title=&quot;dom-location-hash&quot;&gt;hash&lt;/span&gt;;
-};&lt;/pre&gt;
-
   &lt;dl class=&quot;domintro&quot;&gt;
 
    &lt;dt&gt;&lt;var title=&quot;&quot;&gt;location&lt;/var&gt; . &lt;code title=&quot;dom-location-href&quot;&gt;href&lt;/code&gt; [ = &lt;var title=&quot;&quot;&gt;value&lt;/var&gt; ]&lt;/dt&gt;
@@ -79103,25 +78416,21 @@
   user agent may instead perform &lt;span&gt;an overridden reload&lt;/span&gt; rather than the navigation
   described in this paragraph.&lt;/p&gt;
 
+  &lt;p&gt;The &lt;code&gt;Location&lt;/code&gt; interface also supports the &lt;code&gt;URLUtils&lt;/code&gt; interface. &lt;span
+  class=&quot;impl&quot;&gt;The &lt;span title=&quot;concept-uu-input&quot;&gt;input&lt;/span&gt; is &lt;span title=&quot;the document's
+  address&quot;&gt;the address&lt;/span&gt; of the &lt;i&gt;relevant &lt;code&gt;Document&lt;/code&gt;&lt;/i&gt; (same as the &lt;code
+  title=&quot;dom-location-href&quot;&gt;href&lt;/code&gt; attribute), as an &lt;span&gt;absolute URL&lt;/span&gt;; the &lt;span
+  title=&quot;concept-uu-base&quot;&gt;base&lt;/span&gt; is the &lt;span&gt;entry script&lt;/span&gt;'s &lt;span title=&quot;script's base
+  URL&quot;&gt;base URL&lt;/span&gt; (which can be different each time members on the interface are invoked); the
+  &lt;span title=&quot;concept-uu-query-encoding&quot;&gt;query encoding&lt;/span&gt; is the &lt;span&gt;document's character
+  encoding&lt;/span&gt;; and the &lt;span title=&quot;concept-uu-update&quot;&gt;update steps&lt;/span&gt; are the same as
+  setting the &lt;code title=&quot;dom-location-href&quot;&gt;href&lt;/code&gt; attribute to the new output
+  value.&lt;/span&gt;&lt;/p&gt;
+
   &lt;/div&gt;
 
-  &lt;p&gt;The &lt;code&gt;Location&lt;/code&gt; interface also has the complement of &lt;span&gt;URL decomposition IDL
-  attributes&lt;/span&gt;, &lt;dfn title=&quot;dom-location-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-location-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-location-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-location-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-location-pathname&quot;&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-location-search&quot;&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn
-  title=&quot;dom-location-hash&quot;&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. &lt;span class=&quot;impl&quot;&gt;These must follow the rules
-  given for &lt;span&gt;URL decomposition IDL attributes&lt;/span&gt;, with the &lt;span
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; being &lt;span title=&quot;the document's address&quot;&gt;the
-  address&lt;/span&gt; of the &lt;i&gt;relevant &lt;code&gt;Document&lt;/code&gt;&lt;/i&gt;, as an &lt;span&gt;absolute URL&lt;/span&gt; (same
-  as the &lt;code title=&quot;dom-location-href&quot;&gt;href&lt;/code&gt; attribute), and the &lt;span
-  title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/span&gt; being the same as setting the &lt;code
-  title=&quot;dom-location-href&quot;&gt;href&lt;/code&gt; attribute to the new output value.&lt;/span&gt;&lt;/p&gt;
 
 
-
 &lt;!--ADD-TOPIC:Security--&gt;
   &lt;div class=&quot;impl&quot;&gt;
 
@@ -79306,13 +78615,13 @@
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;gone async&lt;/var&gt; be false.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li id=&quot;navigate-fragid-step&quot;&gt;&lt;p&gt;&lt;i&gt;Fragment identifiers&lt;/i&gt;: If the &lt;span&gt;absolute URL&lt;/span&gt; of
-   the new resource is the same as the &lt;span title=&quot;the document's address&quot;&gt;address&lt;/span&gt; of the
-   &lt;span&gt;active document&lt;/span&gt; of the &lt;span&gt;browsing context&lt;/span&gt; being navigated, ignoring any
-   &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; components of those &lt;span
-   title=&quot;URL&quot;&gt;URLs&lt;/span&gt;, and the new resource is to be fetched using HTTP GET &lt;span
-   title=&quot;concept-http-equivalent-get&quot;&gt;or equivalent&lt;/span&gt;, and the &lt;span&gt;absolute URL&lt;/span&gt; of
-   the new resource has a &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component (even if it
+&lt;!--CLEANUP--&gt;
+   &lt;li id=&quot;navigate-fragid-step&quot;&gt;&lt;p&gt;&lt;i&gt;Fragment identifiers&lt;/i&gt;: Apply the &lt;span&gt;URL parser&lt;/span&gt; algorithm to the &lt;span&gt;absolute URL&lt;/span&gt; of
+   the new resource and the &lt;span title=&quot;the document's address&quot;&gt;address&lt;/span&gt; of the
+   &lt;span&gt;active document&lt;/span&gt; of the &lt;span&gt;browsing context&lt;/span&gt; being navigated. If all the components of the resulting &lt;span title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/span&gt; , ignoring any
+   &lt;span title=&quot;concept-url-fragment&quot;&gt;fragment&lt;/span&gt; components, are identical, and the new resource is to be fetched using HTTP GET &lt;span
+   title=&quot;concept-http-equivalent-get&quot;&gt;or equivalent&lt;/span&gt;, and the &lt;span&gt;parsed URL&lt;/span&gt; of
+   the new resource has a &lt;span title=&quot;concept-url-fragment&quot;&gt;fragment&lt;/span&gt; component that is not null (even if it
    is empty), then &lt;span title=&quot;navigate-fragid&quot;&gt;navigate to that fragment identifier&lt;/span&gt; and
    abort these steps.&lt;/p&gt;&lt;/li&gt;
 
@@ -79836,14 +79145,15 @@
   encoding is established, the &lt;span&gt;document's character encoding&lt;/span&gt; must be set to that
   character encoding.&lt;/p&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;If the root element, as parsed according to the XML specifications cited above, is found to be
   an &lt;code&gt;html&lt;/code&gt; element with an attribute &lt;code title=&quot;attr-html-manifest&quot;&gt;manifest&lt;/code&gt;
   whose value is not the empty string, then, as soon as the element is &lt;span title=&quot;insert an
   element into a document&quot;&gt;inserted into the document&lt;/span&gt;, the user agent must &lt;span
   title=&quot;resolve a url&quot;&gt;resolve&lt;/span&gt; the value of that attribute relative to that element, and if
-  that is successful, must run the &lt;span title=&quot;concept-appcache-init&quot;&gt;application cache selection
-  algorithm&lt;/span&gt; with the resulting &lt;span&gt;absolute URL&lt;/span&gt; with any &lt;span
-  title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component removed as the manifest URL, and passing in
+  that is successful, must apply the &lt;span&gt;URL serializer&lt;/span&gt; algorithm to the resulting &lt;span&gt;parsed URL&lt;/span&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set to obtain &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;, and then run the &lt;span title=&quot;concept-appcache-init&quot;&gt;application cache selection
+  algorithm&lt;/span&gt; with &lt;var title=&quot;&quot;&gt;manifest URL&lt;/var&gt;
+  as the manifest URL, passing in
   the newly-created &lt;code&gt;Document&lt;/code&gt;. Otherwise, if the attribute is absent, its value is the
   empty string, or resolving its value fails, then as soon as the root element is &lt;span
   title=&quot;insert an element into a document&quot;&gt;inserted into the document&lt;/span&gt;, the user agent must
@@ -80115,10 +79425,12 @@
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;&lt;span title=&quot;parse a url&quot;&gt;Parse&lt;/span&gt; the &lt;span&gt;URL&lt;/span&gt;, and let &lt;var
-   title=&quot;&quot;&gt;fragid&lt;/var&gt; be the &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component of the
-   URL.&lt;/p&gt;&lt;/li&gt;&lt;!-- parsing can't fail, since we checked earlier on when navigating --&gt;
+&lt;!--CLEANUP--&gt;
 
+   &lt;li&gt;&lt;p&gt;Apply the &lt;span&gt;URL parser&lt;/span&gt; algorithm to the &lt;span&gt;URL&lt;/span&gt;, and let &lt;var
+   title=&quot;&quot;&gt;fragid&lt;/var&gt; be the &lt;span title=&quot;concept-url-fragment&quot;&gt;fragment&lt;/span&gt; component of the
+   resulting &lt;span&gt;parsed URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;&lt;!-- parsing can't fail, since we checked earlier on when navigating --&gt;
+
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;fragid&lt;/var&gt; is the empty string, then &lt;span&gt;the indicated part of the
    document&lt;/span&gt; is the top of the document; stop the algorithm here.&lt;/p&gt;&lt;/li&gt;
 
@@ -81430,7 +80742,7 @@
   &lt;/div&gt;
 
 
-
+&lt;!--CLEANUP--&gt;
   &lt;h5&gt;Writing cache manifests&lt;/h5&gt;
 
   &lt;p&gt;Manifests must be served using the
@@ -81622,11 +80934,11 @@
   title=&quot;concept-appcache-onlinewhitelist&quot;&gt;online whitelist&lt;/span&gt; is
   a &lt;span&gt;prefix match&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p&gt;Relative URLs must be given relative to the manifest's own
+  &lt;p&gt;&lt;span title=&quot;relative URL&quot;&gt;Relative URLs&lt;/span&gt; must be given relative to the manifest's own
   URL. All URLs in the manifest must have the same &lt;span
-  title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; as the manifest itself
-  (either explicitly or implicitly, through the use of relative
-  URLs).&lt;/p&gt;
+  title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; as the manifest itself
+  (either explicitly or implicitly, through the use of &lt;span title=&quot;relative url&quot;&gt;relative
+  URLs&lt;/span&gt;). &lt;a href=&quot;#refsURL&quot;&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;URLs in manifests must not have fragment identifiers (i.e. the
   U+0023 NUMBER SIGN character isn't allowed in URLs in
@@ -81638,6 +80950,7 @@
   matched by &lt;span&gt;prefix match&lt;/span&gt;.&lt;/p&gt;
 
 
+&lt;!--CLEANUP--&gt;
   &lt;div class=&quot;impl&quot;&gt;
 
   &lt;h5&gt;Parsing cache manifests&lt;/h5&gt;
@@ -81647,7 +80960,7 @@
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;The user agent must decode the byte stream corresponding
+   &lt;li&gt;&lt;p&gt;Decode the byte stream corresponding
    with the manifest to be parsed &lt;span title=&quot;decoded as UTF-8, with
    error handling&quot;&gt;as UTF-8, with error handling&lt;/span&gt;. &lt;!--All
    U+0000 NULL characters must be replaced by U+FFFD REPLACEMENT
@@ -81658,6 +80971,10 @@
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; be the &lt;span&gt;absolute
    URL&lt;/span&gt; representing the manifest.&lt;/p&gt;&lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;Apply the &lt;span&gt;URL parser&lt;/span&gt; steps to the &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt;, so that the
+   components from its &lt;span&gt;parsed URL&lt;/span&gt; can be used by the subseqent steps of this
+   algorithm.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;explicit URLs&lt;/var&gt; be an initially empty
    list of &lt;span title=&quot;absolute URL&quot;&gt;absolute URLs&lt;/span&gt; for &lt;span
    title=&quot;concept-appcache-explicit&quot;&gt;explicit entries&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -81822,17 +81139,15 @@
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;If the resulting &lt;span&gt;absolute URL&lt;/span&gt; has a different
-      &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component than
-      the manifest's URL (compared in an &lt;span&gt;ASCII
-      case-insensitive&lt;/span&gt; manner), then jump back to the step
+      &lt;p&gt;If the resulting &lt;span&gt;parsed URL&lt;/span&gt; has a different
+      &lt;span title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; component than
+      &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; (the manifest's URL), then jump back to the step
       labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Drop the &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
-      component of the resulting &lt;span&gt;absolute URL&lt;/span&gt;, if it has
-      one.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the result of applying the &lt;span&gt;URL serializer&lt;/span&gt;
+      algorithm to the resulting &lt;span&gt;parsed URL&lt;/span&gt;, with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;Add the resulting &lt;span&gt;absolute URL&lt;/span&gt; to the &lt;var
+      &lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; to the &lt;var
       title=&quot;&quot;&gt;explicit URLs&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
@@ -81858,21 +81173,25 @@
       jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt; &lt;!-- SECURITY
       --&gt;
 
-      &lt;p&gt;Drop any &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
-      components of the resulting &lt;span title=&quot;absolute URL&quot;&gt;absolute
-      URLs&lt;/span&gt;.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; be the result of applying the &lt;span&gt;URL serializer&lt;/span&gt;
+      algorithm to the first resulting &lt;span&gt;parsed URL&lt;/span&gt;, with the &lt;i&gt;exclude fragment
+      flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;If the &lt;span&gt;absolute URL&lt;/span&gt; corresponding to &lt;var
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;part two&lt;/var&gt; be the result of applying the &lt;span&gt;URL serializer&lt;/span&gt;
+      algorithm to the second resulting &lt;span&gt;parsed URL&lt;/span&gt;, with the &lt;i&gt;exclude fragment
+      flag&lt;/i&gt; set.&lt;/p&gt;
+
+      &lt;p&gt;If &lt;var
       title=&quot;&quot;&gt;part one&lt;/var&gt; is already in the &lt;var title=&quot;&quot;&gt;fallback
       URLs&lt;/var&gt; mapping as a &lt;span
       title=&quot;concept-appcache-fallback-ns&quot;&gt;fallback namespace&lt;/span&gt;,
       then jump back to the step labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Otherwise, add the &lt;span&gt;absolute URL&lt;/span&gt; corresponding to
+      &lt;p&gt;Otherwise, add 
       &lt;var title=&quot;&quot;&gt;part one&lt;/var&gt; to the &lt;var title=&quot;&quot;&gt;fallback
       URLs&lt;/var&gt; mapping as a &lt;span
       title=&quot;concept-appcache-fallback-ns&quot;&gt;fallback namespace&lt;/span&gt;,
-      mapped to the &lt;span&gt;absolute URL&lt;/span&gt; corresponding to &lt;var
+      mapped to &lt;var
       title=&quot;&quot;&gt;part two&lt;/var&gt; as the &lt;span
       title=&quot;concept-appcache-fallback&quot;&gt;fallback entry&lt;/span&gt;.&lt;/p&gt;
 
@@ -81894,17 +81213,15 @@
       &lt;p&gt;If this fails, then jump back to the step labeled &quot;start of
       line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;If the resulting &lt;span&gt;absolute URL&lt;/span&gt; has a different
-      &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component than
-      the manifest's URL (compared in an &lt;span&gt;ASCII
-      case-insensitive&lt;/span&gt; manner), then jump back to the step
+      &lt;p&gt;If the resulting &lt;span&gt;parsed URL&lt;/span&gt; has a different
+      &lt;span title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; component than
+      &lt;var title=&quot;&quot;&gt;base URL&lt;/var&gt; (the manifest's URL), then jump back to the step
       labeled &quot;start of line&quot;.&lt;/p&gt;
 
-      &lt;p&gt;Drop the &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
-      component of the resulting &lt;span&gt;absolute URL&lt;/span&gt;, if it has
-      one.&lt;/p&gt;
+      &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; be the result of applying the &lt;span&gt;URL serializer&lt;/span&gt;
+      algorithm to the resulting &lt;span&gt;parsed URL&lt;/span&gt;, with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set.&lt;/p&gt;
 
-      &lt;p&gt;Add the resulting &lt;span&gt;absolute URL&lt;/span&gt; to the &lt;var
+      &lt;p&gt;Add &lt;var title=&quot;&quot;&gt;new URL&lt;/var&gt; to the &lt;var
       title=&quot;&quot;&gt;online whitelist namespaces&lt;/var&gt;.&lt;/p&gt;
 
      &lt;/dd&gt;
@@ -82247,12 +81564,13 @@
       &lt;span&gt;shows caching progress&lt;/span&gt;, the display of some sort of user interface indicating to
       the user that the user agent failed to save the application for offline use.&lt;/p&gt;
 
+&lt;!--CLEANUP--&gt;
       &lt;p&gt;Otherwise, associate the &lt;code&gt;Document&lt;/code&gt; for this entry with &lt;var
       title=&quot;&quot;&gt;cache&lt;/var&gt;; store the resource for this entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt;, if it
       isn't already there, and categorize its entry as a &lt;span
-      title=&quot;concept-appcache-master&quot;&gt;master entry&lt;/span&gt;. If the resource's &lt;span&gt;URL&lt;/span&gt; has a
-      &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component, it must be removed from the
-      entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; (application caches never include fragment
+      title=&quot;concept-appcache-master&quot;&gt;master entry&lt;/span&gt;. If applying the &lt;span&gt;URL parser&lt;/span&gt; algorithm to the resource's &lt;span&gt;URL&lt;/span&gt; results in a &lt;span&gt;parsed URL&lt;/span&gt; that has a non-null
+      &lt;span title=&quot;concept-url-fragment&quot;&gt;fragment&lt;/span&gt; component, the &lt;span&gt;URL&lt;/span&gt; used for the
+      entry in &lt;var title=&quot;&quot;&gt;cache&lt;/var&gt; must instead be the &lt;span&gt;absolute URL&lt;/span&gt; obtained from applying the &lt;span&gt;URL serializer&lt;/span&gt; algorith, to the &lt;span&gt;parsed URL&lt;/span&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set (application caches never include fragment
       identifiers).&lt;/p&gt;
 
      &lt;/li&gt;
@@ -82867,10 +82185,10 @@
 
    &lt;li&gt;&lt;p&gt;If the resource is not to be fetched using the HTTP GET
    mechanism &lt;span title=&quot;concept-http-equivalent-get&quot;&gt;or
-   equivalent&lt;/span&gt;, or if its &lt;span&gt;URL&lt;/span&gt; has a different &lt;span
-   title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component than the
+   equivalent&lt;/span&gt;, or if applying the &lt;span&gt;URL parser&lt;/span&gt; algorithm to both its &lt;span&gt;URL&lt;/span&gt; and the
    &lt;span&gt;application cache&lt;/span&gt;'s &lt;span
-   title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;, then
+   title=&quot;concept-appcache-manifest&quot;&gt;manifest&lt;/span&gt;'s URL results in two &lt;span title=&quot;parsed URL&quot;&gt;parsed URLs&lt;/span&gt; with different &lt;span
+   title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; components, then
    &lt;span&gt;fetch&lt;/span&gt; the resource normally and abort these
    steps.&lt;/p&gt;&lt;/li&gt;
 
@@ -83450,6 +82768,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;div class=&quot;impl&quot;&gt;
 
@@ -83606,7 +82925,7 @@
    &lt;dd&gt;
 
     &lt;p&gt;A &lt;span&gt;URL&lt;/span&gt;, set when the script is created, used to
-    resolve relative URLs. &lt;span id=&quot;sbu-not-copy&quot; title=&quot;&quot;&gt;If the
+    resolve &lt;span title=&quot;relative url&quot;&gt;relative URLs&lt;/span&gt;. &lt;span id=&quot;sbu-not-copy&quot; title=&quot;&quot;&gt;If the
     base URL is set from another source, e.g. a &lt;span&gt;document base
     URL&lt;/span&gt;, then the &lt;span&gt;script's base URL&lt;/span&gt; must follow
     the source, so that if the source's changes, so does the
@@ -86499,6 +85818,7 @@
 
   &lt;/div&gt;
 
+&lt;!--CLEANUP--&gt;
 
   &lt;h5 id=&quot;custom-handlers&quot;&gt;Custom scheme and content handlers&lt;/h5&gt;
 
@@ -86745,12 +86065,10 @@
     title=&quot;concept-http-equivalent-get&quot;&gt;or equivalent&lt;/span&gt; for
     non-HTTP URLs).&lt;/p&gt;
 
-    &lt;p&gt;To get the escaped version of the &lt;span&gt;absolute URL&lt;/span&gt; of
-    the content in question, the user agent must replace every
-    character in that &lt;span&gt;absolute URL&lt;/span&gt; that doesn't match the
-    &lt;query&gt; production defined in RFC 3986 by the
-    percent-encoded form of that character. &lt;a
-    href=&quot;#refsRFC3986&quot;&gt;[RFC3986]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;To get the escaped version of the &lt;span&gt;absolute URL&lt;/span&gt; of the content in question, the
+    user agent must replace every character in that &lt;span&gt;absolute URL&lt;/span&gt; that is not a
+    character in the URL &lt;span&gt;default encode set&lt;/span&gt; with the result of &lt;span title=&quot;UTF-8 percent
+    encode&quot;&gt;UTF-8 percent encoding&lt;/span&gt; that character.&lt;/p&gt;
 
     &lt;div class=&quot;example&quot;&gt;
 
@@ -87352,8 +86670,8 @@
     &lt;li&gt;&lt;p&gt;If this fails, return 0 and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host2&lt;/var&gt; be be the &lt;span
-    title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt; component of the resulting
-    &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+    title=&quot;concept-url-host&quot;&gt;host&lt;/span&gt; component of the resulting
+    &lt;span&gt;parsed URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
     &lt;li&gt;
 
@@ -87367,11 +86685,8 @@
      &lt;var title=&quot;&quot;&gt;host2&lt;/var&gt; after their common suffix are not the
      same, then return 0 and abort these steps.&lt;/p&gt;
 
-     &lt;p&gt;Domain labels must be compared after applying the IDNA ToASCII
-     algorithm to them, with both the AllowUnassigned and
-     UseSTD3ASCIIRules flags set, in an &lt;span&gt;ASCII
-     case-insensitive&lt;/span&gt; manner. &lt;a
-     href=&quot;#refsRFC3490&quot;&gt;[RFC3490]&lt;/a&gt;&lt;/p&gt;
+     &lt;!-- host1 is ascii here because origins are ascii. host2 is ascii because resolve urls
+     punycodes idna. --&gt;
 
     &lt;/li&gt;
 
@@ -92128,6 +91443,7 @@
   &lt;/div&gt;
 --&gt;
 
+&lt;!--CLEANUP--&gt;
 
 &lt;!--ADD-TOPIC:Security--&gt;
   &lt;div class=&quot;impl&quot;&gt;
@@ -92158,7 +91474,7 @@
 
   &lt;p&gt;User agents should filter potentially active (scripted) content
   (e.g. HTML) when it is dragged and when it is dropped, using a
-  whitelist of known-safe features. Similarly, relative URLs should be
+  whitelist of known-safe features. Similarly, &lt;span title=&quot;relative url&quot;&gt;relative URLs&lt;/span&gt; should be
   turned into absolute URLs to avoid references changing in unexpected
   ways. This specification does not specify how this is performed.&lt;/p&gt;
 
@@ -93284,6 +92600,7 @@
 
 
 
+&lt;!--CLEANUP--&gt;
   &lt;h5&gt;Dedicated workers and the &lt;code&gt;Worker&lt;/code&gt; interface&lt;/h5&gt;
 
   &lt;pre class=&quot;idl&quot;&gt;[&lt;span title=&quot;dom-Worker&quot;&gt;Constructor&lt;/span&gt;(DOMString scriptURL)]
@@ -93366,8 +92683,8 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component of
-    the resulting &lt;span&gt;absolute URL&lt;/span&gt; is not &quot;&lt;code
+    &lt;p&gt;If the &lt;span title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; component of
+    the resulting &lt;span&gt;parsed URL&lt;/span&gt; is not &quot;&lt;code
     title=&quot;data-protocol&quot;&gt;data&lt;/code&gt;&quot;, and the &lt;span&gt;origin&lt;/span&gt; of
     the resulting &lt;span&gt;absolute URL&lt;/span&gt; is not the &lt;span
     title=&quot;same origin&quot;&gt;same&lt;/span&gt; as the origin of the &lt;span&gt;entry
@@ -93507,7 +92824,8 @@
    exception.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Otherwise, let &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; be the
-   resulting &lt;span&gt;absolute URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+   resulting &lt;span&gt;absolute URL&lt;/span&gt; and &lt;var title=&quot;&quot;&gt;parsed scriptURL&lt;/var&gt; be the
+   resulting &lt;span&gt;parsed URL&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
    &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;name&lt;/var&gt; be the value of the second
    argument, or the empty string if the second argument was
@@ -93515,8 +92833,8 @@
 
    &lt;li&gt;
 
-    &lt;p&gt;If the &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component of
-    &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; is not &quot;&lt;code
+    &lt;p&gt;If the &lt;span title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; component of
+    &lt;var title=&quot;&quot;&gt;parsed scriptURL&lt;/var&gt; is not &quot;&lt;code
     title=&quot;data-protocol&quot;&gt;data&lt;/code&gt;&quot;, and the &lt;span&gt;origin&lt;/span&gt; of
     &lt;var title=&quot;&quot;&gt;scriptURL&lt;/var&gt; is not the &lt;span title=&quot;same
     origin&quot;&gt;same&lt;/span&gt; as the origin of the &lt;span&gt;entry
@@ -93937,16 +93255,9 @@
   &lt;h4&gt;Worker locations&lt;/h4&gt;
 
   &lt;pre class=&quot;idl&quot;&gt;interface &lt;dfn&gt;WorkerLocation&lt;/dfn&gt; {
-  // &lt;span&gt;URL decomposition IDL attributes&lt;/span&gt;
   stringifier readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-href&quot;&gt;href&lt;/span&gt;;
-  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-protocol&quot;&gt;protocol&lt;/span&gt;;
-  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-host&quot;&gt;host&lt;/span&gt;;
-  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-hostname&quot;&gt;hostname&lt;/span&gt;;
-  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-port&quot;&gt;port&lt;/span&gt;;
-  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-pathname&quot;&gt;pathname&lt;/span&gt;;
-  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-search&quot;&gt;search&lt;/span&gt;;
-  readonly attribute DOMString &lt;span title=&quot;dom-WorkerLocation-hash&quot;&gt;hash&lt;/span&gt;;
-};&lt;/pre&gt;
+};
+&lt;span&gt;WorkerLocation&lt;/span&gt; implements &lt;span&gt;URLUtilsReadOnly&lt;/span&gt;;&lt;/pre&gt;
 
   &lt;p&gt;A &lt;code&gt;WorkerLocation&lt;/code&gt; object represents an &lt;span&gt;absolute URL&lt;/span&gt; set at its
   creation.&lt;/p&gt;
@@ -93954,23 +93265,10 @@
   &lt;p&gt;The &lt;dfn title=&quot;dom-WorkerLocation-href&quot;&gt;&lt;code&gt;href&lt;/code&gt;&lt;/dfn&gt; attribute must return the
   &lt;span&gt;absolute URL&lt;/span&gt; that the object represents.&lt;/p&gt;
 
-  &lt;p&gt;The &lt;code&gt;WorkerLocation&lt;/code&gt; interface also has the complement of &lt;span&gt;URL decomposition
-  IDL attributes&lt;/span&gt;, &lt;dfn title=&quot;dom-WorkerLocation-protocol&quot;&gt;&lt;code&gt;protocol&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-WorkerLocation-host&quot;&gt;&lt;code&gt;host&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-WorkerLocation-port&quot;&gt;&lt;code&gt;port&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-WorkerLocation-hostname&quot;&gt;&lt;code&gt;hostname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-WorkerLocation-pathname&quot;&gt;&lt;code&gt;pathname&lt;/code&gt;&lt;/dfn&gt;, &lt;dfn
-  title=&quot;dom-WorkerLocation-search&quot;&gt;&lt;code&gt;search&lt;/code&gt;&lt;/dfn&gt;, and &lt;dfn
-  title=&quot;dom-WorkerLocation-hash&quot;&gt;&lt;code&gt;hash&lt;/code&gt;&lt;/dfn&gt;. These must follow the rules given for
-  &lt;span&gt;URL decomposition IDL attributes&lt;/span&gt;, with the &lt;span
-  title=&quot;concept-uda-input&quot;&gt;input&lt;/span&gt; being the &lt;span&gt;absolute URL&lt;/span&gt; that the object
-  represents (same as the &lt;code title=&quot;dom-WorkerLocation-href&quot;&gt;href&lt;/code&gt; attribute), and the
-  &lt;span title=&quot;concept-uda-setter&quot;&gt;common setter action&lt;/span&gt; being a no-op, since the attributes
-  are defined to be readonly.
-  &lt;!--END complete--&gt;
-  &lt;a href=&quot;#refsHTML&quot;&gt;[HTML]&lt;/a&gt;
-  &lt;!--START complete--&gt;
-  &lt;/p&gt;
+  &lt;p&gt;The &lt;code&gt;WorkerLocation&lt;/code&gt; interface also supports the &lt;code&gt;URLUtilsReadOnly&lt;/code&gt;
+  interface. The &lt;span title=&quot;concept-uu-input&quot;&gt;input&lt;/span&gt; is the &lt;span&gt;absolute URL&lt;/span&gt; that
+  the object represents (same as the &lt;code title=&quot;dom-WorkerLocation-href&quot;&gt;href&lt;/code&gt;
+  attribute). &lt;a href=&quot;#refsURL&quot;&gt;[URL]&lt;/a&gt;&lt;/p&gt;
 
   &lt;p&gt;The &lt;code&gt;WorkerLocation&lt;/code&gt; interface must only be &lt;span title=&quot;expose&quot;&gt;exposed&lt;/span&gt; if
   the &lt;span&gt;JavaScript global environment&lt;/span&gt; is a &lt;span&gt;worker environment&lt;/span&gt;.&lt;/p&gt;
@@ -95880,6 +95178,7 @@
   <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=17264">https://www.w3.org/Bugs/Public/show_bug.cgi?id=17264</A> --&gt;
 
 
+&lt;!--CLEANUP--&gt;
   &lt;h4&gt;Parsing WebSocket URLs&lt;/h4&gt;
 
   &lt;p&gt;The steps to &lt;dfn&gt;parse a WebSocket URL's components&lt;/dfn&gt; from a string &lt;var
@@ -95903,23 +95202,23 @@
 
    &lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; does not have a &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt;
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;span&gt;parsed URL&lt;/span&gt; does not have a &lt;span title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt;
    component whose value, when &lt;span&gt;converted to ASCII lowercase&lt;/span&gt;, is either &quot;&lt;code
    title=&quot;&quot;&gt;ws&lt;/code&gt;&quot; or &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, then fail this algorithm.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt;
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;span&gt;parsed URL&lt;/span&gt; has a non-null &lt;span title=&quot;concept-url-fragment&quot;&gt;fragment&lt;/span&gt;
    component, then fail this algorithm.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If the &lt;span title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;
+   &lt;li&gt;&lt;p&gt;If the &lt;span title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; component of the resulting &lt;span&gt;parsed URL&lt;/span&gt;
    is &quot;&lt;code title=&quot;&quot;&gt;ws&lt;/code&gt;&quot;, set &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt; to false; otherwise, the &lt;span
-   title=&quot;url-scheme&quot;&gt;&lt;scheme&gt;&lt;/span&gt; component is &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, set &lt;var
+   title=&quot;concept-url-scheme&quot;&gt;scheme&lt;/span&gt; component is &quot;&lt;code title=&quot;&quot;&gt;wss&lt;/code&gt;&quot;, set &lt;var
    title=&quot;&quot;&gt;secure&lt;/var&gt; to true.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the value of the &lt;span
-   title=&quot;url-host&quot;&gt;&lt;host&gt;&lt;/span&gt; component of &lt;var title=&quot;&quot;&gt;url&lt;/var&gt;, &lt;span&gt;converted to
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;host&lt;/var&gt; be the value of the resulting &lt;span&gt;parsed URL&lt;/span&gt;'s &lt;span
+   title=&quot;concept-url-host&quot;&gt;host&lt;/span&gt; component, &lt;span&gt;converted to
    ASCII lowercase&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt; &lt;!-- at this point this is Punycode-encoded already --&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;span title=&quot;url-port&quot;&gt;&lt;port&gt;&lt;/span&gt; component,
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;span&gt;parsed URL&lt;/span&gt; has a &lt;span title=&quot;concept-url-port&quot;&gt;port&lt;/span&gt; component that is not the empty string,
    then let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be that component's value; otherwise, there is no explicit &lt;var
    title=&quot;&quot;&gt;port&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
 
@@ -95927,17 +95226,16 @@
    false, let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be 80, otherwise let &lt;var title=&quot;&quot;&gt;port&lt;/var&gt; be
    443.&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; be the value of the &lt;span
-   title=&quot;url-path&quot;&gt;&lt;path&gt;&lt;/span&gt; component (which might be empty) of &lt;var
-   title=&quot;&quot;&gt;url&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt; &lt;!-- at this point this is UTF-8 encoded and %-escaped --&gt;
+   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; be the value of the resulting &lt;span&gt;parsed URL&lt;/span&gt;'s &lt;span
+   title=&quot;concept-url-path&quot;&gt;path&lt;/span&gt; component (which might be empty).&lt;/p&gt;&lt;/li&gt; &lt;!-- at this point this is UTF-8 encoded and percent encoded --&gt;
 
    &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt; is the empty string, set it to a single character
    U+002F SOLIDUS (/).&lt;/p&gt;&lt;/li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;url&lt;/var&gt; has a &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component,
+   &lt;li&gt;&lt;p&gt;If the resulting &lt;span&gt;parsed URL&lt;/span&gt; has a non-null &lt;span title=&quot;concept-url-query&quot;&gt;query&lt;/span&gt; component,
    then append a single U+003F QUESTION MARK character (?) to &lt;var title=&quot;&quot;&gt;resource name&lt;/var&gt;,
-   followed by the value of the &lt;span title=&quot;url-query&quot;&gt;&lt;query&gt;&lt;/span&gt; component.&lt;/p&gt;&lt;/li&gt;
-   &lt;!-- at this point this is UTF-8 encoded and %-escaped --&gt;
+   followed by the value of the &lt;span title=&quot;concept-url-query&quot;&gt;query&lt;/span&gt; component.&lt;/p&gt;&lt;/li&gt;
+   &lt;!-- at this point this is UTF-8 encoded and percent encoded --&gt;
 
    &lt;li&gt;&lt;p&gt;Return &lt;var title=&quot;&quot;&gt;host&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;port&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;resource
    name&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;secure&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
@@ -98680,7 +97978,7 @@
   &lt;p class=&quot;note&quot;&gt;Whether the attributes in the table above are
   conforming or not is defined by other specifications (e.g. the SVG
   and MathML specifications); this section only describes the syntax
-  rules if the attributes are serialised using the HTML syntax.&lt;/p&gt;
+  rules if the attributes are serialized using the HTML syntax.&lt;/p&gt;
 
 
   &lt;h5&gt;Optional tags&lt;/h5&gt;
@@ -103726,9 +103024,8 @@
     &lt;span&gt;absolute URL&lt;/span&gt;, relative to the newly created element,
     and if that is successful, run the &lt;span
     title=&quot;concept-appcache-init&quot;&gt;application cache selection
-    algorithm&lt;/span&gt; with the resulting &lt;span&gt;absolute URL&lt;/span&gt; with
-    any &lt;span title=&quot;url-fragment&quot;&gt;&lt;fragment&gt;&lt;/span&gt; component
-    removed; otherwise, if there is no such attribute, or its value is
+    algorithm&lt;/span&gt; with the result of applying the &lt;span&gt;URL serializer&lt;/span&gt; algorithm to
+    the resulting &lt;span&gt;parsed URL&lt;/span&gt; with the &lt;i&gt;exclude fragment flag&lt;/i&gt; set; otherwise, if there is no such attribute, or its value is
     the empty string, or resolving its value fails, run the &lt;span
     title=&quot;concept-appcache-init&quot;&gt;application cache selection
     algorithm&lt;/span&gt; with no manifest. The algorithm must be passed
@@ -119862,12 +119159,6 @@
    &lt;dd&gt;&lt;cite&gt;&lt;a
    href=&quot;<A HREF="http://tools.ietf.org/html/rfc3864">http://tools.ietf.org/html/rfc3864</A>&quot;&gt;Registration Procedures for Message Header Fields&lt;/a&gt;&lt;/cite&gt;, G. Klyne, M. Nottingham, J. Mogul. IETF.&lt;/dd&gt;
 
-   &lt;dt id=&quot;refsRFC3986&quot;&gt;[RFC3986]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://tools.ietf.org/html/rfc3986">http://tools.ietf.org/html/rfc3986</A>&quot;&gt;Uniform Resource Identifier (URI): Generic Syntax&lt;/a&gt;&lt;/cite&gt;, T. Berners-Lee, R. Fielding, L. Masinter. IETF.&lt;/dd&gt;
-
-   &lt;dt id=&quot;refsRFC3987&quot;&gt;[RFC3987]&lt;/dt&gt;
-   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://tools.ietf.org/html/rfc3987">http://tools.ietf.org/html/rfc3987</A>&quot;&gt;Internationalized Resource Identifiers (IRIs)&lt;/a&gt;&lt;/cite&gt;, M. D&uuml;rst, M. Suignard. IETF.&lt;/dd&gt;
-
    &lt;dt id=&quot;refsRFC4281&quot;&gt;[RFC4281]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://tools.ietf.org/html/rfc4281">http://tools.ietf.org/html/rfc4281</A>&quot;&gt;The Codecs Parameter for &quot;Bucket&quot; Media Types&lt;/a&gt;&lt;/cite&gt;, R. Gellens, D. Singer, P. Frojdh. IETF.&lt;/dd&gt;
 
@@ -119951,6 +119242,9 @@
    &lt;dt id=&quot;refsUNIVCHARDET&quot;&gt;[UNIVCHARDET]&lt;/dt&gt;
    &lt;dd&gt;(Non-normative) &lt;cite&gt;&lt;a href=&quot;<A HREF="http://www.mozilla.org/projects/intl/UniversalCharsetDetection.html">http://www.mozilla.org/projects/intl/UniversalCharsetDetection.html</A>&quot;&gt;A composite approach to language/encoding detection&lt;/a&gt;&lt;/cite&gt;, S. Li, K. Momoi. Netscape. In &lt;cite&gt;Proceedings of the 19th International Unicode Conference&lt;/cite&gt;.&lt;/dd&gt;
 
+   &lt;dt id=&quot;refsURL&quot;&gt;[URL]&lt;/dt&gt;
+   &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://url.spec.whatwg.org/">http://url.spec.whatwg.org/</A>&quot;&gt;URL&lt;/a&gt;&lt;/cite&gt;, A. van Kestern. WHATWG.&lt;/dd&gt;
+
    &lt;dt id=&quot;refsUTF7&quot;&gt;[UTF7]&lt;/dt&gt;
    &lt;dd&gt;&lt;cite&gt;&lt;a href=&quot;<A HREF="http://tools.ietf.org/html/rfc2152">http://tools.ietf.org/html/rfc2152</A>&quot;&gt;UTF-7: A Mail-Safe Transformation Format of Unicode&lt;/a&gt;&lt;/cite&gt;, D. Goldsmith, M. Davis. IETF.&lt;/dd&gt;
 


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014568.html">[html5] r7709 - [e] (0) Add some examples of outlines. Fixing	https://www.w3.org/Bugs/Public/sho [...]
</A></li>
	<LI>Next message: <A HREF="014570.html">[html5] r7711 - [e] (0) Cleanup Affected topics: DOM APIs, HTML,	Offline Web Applications, Secur [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14569">[ date ]</a>
              <a href="thread.html#14569">[ thread ]</a>
              <a href="subject.html#14569">[ subject ]</a>
              <a href="author.html#14569">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
