<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r7828 - [e] (0) Try to clarify browsing context rules	Fixing https://www.w3.org/Bugs/Pub [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7828%20-%20%5Be%5D%20%280%29%20Try%20to%20clarify%20browsing%20context%20rules%0A%09Fixing%20https%3A//www.w3.org/Bugs/Pub%20%5B...%5D&In-Reply-To=%3C20130413161836.0B88F3C7C440%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014685.html">
   <LINK REL="Next"  HREF="014687.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r7828 - [e] (0) Try to clarify browsing context rules	Fixing https://www.w3.org/Bugs/Pub [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r7828%20-%20%5Be%5D%20%280%29%20Try%20to%20clarify%20browsing%20context%20rules%0A%09Fixing%20https%3A//www.w3.org/Bugs/Pub%20%5B...%5D&In-Reply-To=%3C20130413161836.0B88F3C7C440%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r7828 - [e] (0) Try to clarify browsing context rules	Fixing https://www.w3.org/Bugs/Pub [...]">whatwg at whatwg.org
       </A><BR>
    <I>Sat Apr 13 09:18:36 PDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="014685.html">[html5] r7827 - [e] (0) Clarify API is limited to three strings by	using WebIDL magic. Fixing ht [...]
</A></li>
        <LI>Next message: <A HREF="014687.html">[html5] r7829 - [c] (0) I couldn't find a normative statement	requiring that &lt;area&gt; only be insi [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14686">[ date ]</a>
              <a href="thread.html#14686">[ thread ]</a>
              <a href="subject.html#14686">[ subject ]</a>
              <a href="author.html#14686">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2013-04-13 09:18:34 -0700 (Sat, 13 Apr 2013)
New Revision: 7828

Modified:
   complete.html
   index
   source
Log:
[e] (0) Try to clarify browsing context rules
Fixing <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20939">https://www.w3.org/Bugs/Public/show_bug.cgi?id=20939</A>
Affected topics: HTML, Security, Video and Audio

Modified: complete.html
===================================================================
--- complete.html	2013-04-12 23:30:29 UTC (rev 7827)
+++ complete.html	2013-04-13 16:18:34 UTC (rev 7828)
@@ -248,7 +248,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 12 April 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 13 April 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -27138,6 +27138,7 @@
 
   &lt;/dl&gt;&lt;div class=impl&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;The &lt;dfn id=dom-navigator-canplaytype title=dom-navigator-canPlayType&gt;&lt;code&gt;canPlayType(&lt;var title=&quot;&quot;&gt;type&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return &lt;dfn id=dom-canplaytypeenum-nil title=dom-CanPlayTypeEnum-nil&gt;the empty string&lt;/dfn&gt; if &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
   is &lt;a href=#a-type-that-the-user-agent-knows-it-cannot-render&gt;a type that the user agent knows it cannot render&lt;/a&gt; or is the type
   &quot;&lt;code&gt;application/octet-stream&lt;/code&gt;&quot;; it must return &quot;&lt;dfn id=dom-canplaytypeenum-probably title=dom-CanPlayTypeEnum-probably&gt;&lt;code&gt;probably&lt;/code&gt;&lt;/dfn&gt;&quot; if the
@@ -64137,7 +64138,10 @@
    &lt;a href=#active-document&gt;active document&lt;/a&gt; has the &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt; &lt;a href=#origin&gt;origin&lt;/a&gt; as
    the &lt;a href=#active-document&gt;active document&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;A&lt;/var&gt; (possibly in fact being &lt;var title=&quot;&quot;&gt;A&lt;/var&gt; itself).&lt;/li&gt;
 
-  &lt;/ul&gt;&lt;hr&gt;&lt;p&gt;An element has a &lt;dfn id=browsing-context-scope-origin&gt;browsing context scope origin&lt;/dfn&gt; if its &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s
+  &lt;/ul&gt;&lt;p class=note&gt;Sandboxing (in particular the &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context
+  flag&lt;/a&gt;) can further restrict the above in certain cases.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;An element has a &lt;dfn id=browsing-context-scope-origin&gt;browsing context scope origin&lt;/dfn&gt; if its &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; or if all of its
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#ancestor-browsing-context title=&quot;ancestor browsing context&quot;&gt;ancestor browsing contexts&lt;/a&gt;
   all have &lt;a href=#active-document title=&quot;active document&quot;&gt;active documents&lt;/a&gt; whose &lt;a href=#origin&gt;origin&lt;/a&gt; are the
@@ -64241,10 +64245,10 @@
     &lt;tr&gt;&lt;td&gt;&lt;code title=&quot;&quot;&gt;_blank&lt;/code&gt;
      &lt;td&gt;new
      &lt;td&gt;new
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
 
     &lt;tr&gt;&lt;td&gt;&lt;code title=&quot;&quot;&gt;_self&lt;/code&gt;
      &lt;td&gt;current
@@ -64334,8 +64338,42 @@
      &lt;td&gt;none
      &lt;td&gt;none
 
-  &lt;/table&gt;&lt;p class=tablenote&gt;&lt;small&gt;&dagger; This case is only possible if the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute also allows scripts.&lt;/small&gt;&lt;/p&gt;
+    &lt;tr&gt;&lt;td&gt;other name that exists with common top
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
 
+    &lt;tr&gt;&lt;td&gt;other name that exists, if &lt;a href=#allowed-to-navigate&gt;allowed to navigate&lt;/a&gt; and &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/a&gt;
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+
+    &lt;tr&gt;&lt;td&gt;other name that exists, if &lt;a href=#allowed-to-navigate&gt;allowed to navigate&lt;/a&gt; but not &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/a&gt;
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+
+    &lt;tr&gt;&lt;td&gt;other name that exists, not &lt;a href=#allowed-to-navigate&gt;allowed to navigate&lt;/a&gt;
+     &lt;td&gt;new
+     &lt;td&gt;new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+
+  &lt;/table&gt;&lt;p class=tablenote&gt;&lt;small&gt;Most of the restrictions on sandboxed browsing contexts are applied by
+  other algorithms, e.g. the &lt;a href=#navigate title=navigate&gt;navigation&lt;/a&gt; algorithm, not &lt;a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name&gt;the rules
+  for choosing a browsing context given a browsing context name&lt;/a&gt; given below.&lt;/small&gt;&lt;/p&gt;
+
   &lt;div class=impl&gt;
 
   &lt;hr&gt;&lt;p&gt;An algorithm is &lt;dfn id=allowed-to-show-a-popup&gt;allowed to show a popup&lt;/dfn&gt; if, in the &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in which the algorithm is running, either:&lt;/p&gt;
@@ -77876,7 +77914,7 @@
    // CONFIGURATION
    function configure(event) {
      if (event.data.substr(0, 4) != 'cfg ') return;
-     var name = event.data.substr(4).split(' ', 1);
+     var name = event.data.substr(4).split(' ', 1)[0];
      // update display to mention our name is name
      document.getElementsByTagName('h1')[0].textContent += ' ' + name;
      // no longer need this listener
@@ -77898,7 +77936,7 @@
            context.fillStyle = 'green';
          else 
            context.fillStyle = 'maroon';
-         fillRect(x * 50, y * 50, 50, 50);
+         context.fillRect(x * 50, y * 50, 50, 50);
        }
      }
    }
@@ -77907,23 +77945,26 @@
    // PUBLIC CHAT
    function updatePublicChat(event) {
      if (event.data.substr(0, 4) != 'txt ') return;
-     var name = event.data.substr(4).split(' ', 1);
-     var message = event.data.substr(4 + length(name) + 1);
+     var name = event.data.substr(4).split(' ', 1)[0];
+     var message = event.data.substr(4 + name.length + 1);
      // display &quot;&lt;name&gt; message&quot; in public chat
-     var dialog = document.getElementById('public');
-     var dt = document.createElement('dt');
-     dt.textContent = name;
-     dialog.appendChild(dt);
-     var dd = document.createElement('dd');
-     dd.textContent = message;
-     dialog.appendChild(dd);
+     var public = document.getElementById('public');
+     var p = document.createElement('p');
+     var n = document.createElement('button');
+     n.textContent = '&lt;' + name + '&gt; ';
+     n.onclick = function () { worker.port.postMessage('msg ' + name); };
+     p.appendChild(n);
+     var m = document.createElement('span');
+     m.textContent = message;
+     p.appendChild(m);
+     public.appendChild(p);
    }
    worker.port.addEventListener('message', updatePublicChat, false);
 
    // PRIVATE CHAT
    function startPrivateChat(event) {
      if (event.data.substr(0, 4) != 'msg ') return;
-     var name = event.data.substr(4).split(' ', 1);
+     var name = event.data.substr(4).split(' ', 1)[0];
      var port = event.ports[0];
      // display a private chat UI
      var ul = document.getElementById('private');
@@ -77931,19 +77972,21 @@
      var h3 = document.createElement('h3');
      h3.textContent = 'Private chat with ' + name;
      li.appendChild(h3);
-     var dialog = document.createElement('dialog');
+     var div = document.createElement('div');
      var addMessage = function(name, message) {
-       var dt = document.createElement('dt');
-       dt.textContent = name;
-       dialog.appendChild(dt);
-       var dd = document.createElement('dd');
-       dd.textContent = message;
-       dialog.appendChild(dd);
+       var p = document.createElement('p');
+       var n = document.createElement('strong');
+       n.textContent = '&lt;' + name + '&gt; ';
+       p.appendChild(n);
+       var t = document.createElement('span');
+       t.textContent = message;
+       p.appendChild(t);
+       div.appendChild(p);
      };
      port.onmessage = function (event) {
        addMessage(name, event.data);
      };
-     li.appendChild(dialog);
+     li.appendChild(div);
      var form = document.createElement('form');
      var p = document.createElement('p');
      var input = document.createElement('input');
@@ -77961,6 +78004,7 @@
      };
      form.appendChild(p);
      li.appendChild(form);
+     ul.appendChild(li);
    }
    worker.port.addEventListener('message', startPrivateChat, false);
 
@@ -77980,7 +78024,7 @@
    &lt;button type=button onclick=&quot;worker.port.postMessage('set 1')&quot;&gt;Set 1&lt;/button&gt;
   &lt;/p&gt;
   &lt;h2&gt;Public Chat&lt;/h2&gt;
-  &lt;dialog id=&quot;public&quot;&gt;&lt;/dialog&gt;
+  &lt;div id=&quot;public&quot;&gt;&lt;/div&gt;
   &lt;form onsubmit=&quot;worker.port.postMessage('txt ' + message.value); message.value = ''; return false;&quot;&gt;
    &lt;p&gt;
     &lt;input type=&quot;text&quot; name=&quot;message&quot; size=&quot;50&quot;&gt;
@@ -78042,26 +78086,34 @@
   return y;
 }
 
-function sendMapData(callback) {
+function wrap(val, min, max) {
+  if (val &lt; min)
+    return val + (max-min)+1;
+  if (val &gt; max)
+    return val - (max-min)-1;
+  return val;
+}
+
+function sendMapData(viewer) {
   var data = '';
   for (var y = viewer.y-1; y &lt;= viewer.y+1; y += 1) {
     for (var x = viewer.x-1; x &lt;= viewer.x+1; x += 1) {
       if (data != '')
         data += ',';
-      data += map[y][x];
+      data += map[wrap(y, 0, map[0].length-1)][wrap(x, 0, map.length-1)];
     }
   }
-  callback('map ' + data);
+  viewer.port.postMessage('map ' + data);
 }
 
 var viewers = {};
 onconnect = function (event) {
-  event.ports[0]._name = getNextName();
-  event.ports[0]._data = { port: event.port, x: 0, y: 0, };
-  viewers[event.ports[0]._name] = event.port._data;
+  var name = getNextName();
+  event.ports[0]._data = { port: event.ports[0], name: name, x: 0, y: 0, };
+  viewers[name] = event.ports[0]._data;
   event.ports[0].postMessage('cfg ' + name);
   event.ports[0].onmessage = getMessage;
-  sendMapData(event.ports[0].postMessage);
+  sendMapData(event.ports[0]._data);
 };
 
 function getMessage(event) {
@@ -78078,23 +78130,23 @@
       }
       event.target._data.x = wrapX(event.target._data.x + dx);
       event.target._data.y = wrapY(event.target._data.y + dy);
-      sendMapData(event.target.postMessage);
+      sendMapData(event.target._data);
       break;
     case 'set ':
       var value = event.data.substr(4);
       map[event.target._data.y][event.target._data.x] = value;
       for (var viewer in viewers)
-        sendMapData(viewers[viewer].port.postMessage);
+        sendMapData(viewers[viewer]._data);
       break;
     case 'txt ':
-      var name = event.target._name;
+      var name = event.target._data.name;
       var message = event.data.substr(4);
       for (var viewer in viewers)
         viewers[viewer].port.postMessage('txt ' + name + ' ' + message);
       break;
     case 'msg ':
-      var party1 = event._data;
-      var party2 = viewers[event.data.substr(4).split(' ', 1)];
+      var party1 = event.target._data;
+      var party2 = viewers[event.data.substr(4).split(' ', 1)[0]];
       if (party2) {
         var channel = new MessageChannel();
         party1.port.postMessage('msg ' + party2.name, [channel.port1]);
@@ -101101,6 +101153,7 @@
   Bj&ouml;rn H&ouml;hrmann,
   Blake Frantz,
   Bob Lund,
+  Bob Owen,
   Boris Zbarsky,
   Brad Fults,
   Brad Neuberg,

Modified: index
===================================================================
--- index	2013-04-12 23:30:29 UTC (rev 7827)
+++ index	2013-04-13 16:18:34 UTC (rev 7828)
@@ -248,7 +248,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a class=logo href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A>&gt;&lt;img alt=WHATWG height=101 src=/images/logo width=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 12 April 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 13 April 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -27138,6 +27138,7 @@
 
   &lt;/dl&gt;&lt;div class=impl&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;The &lt;dfn id=dom-navigator-canplaytype title=dom-navigator-canPlayType&gt;&lt;code&gt;canPlayType(&lt;var title=&quot;&quot;&gt;type&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return &lt;dfn id=dom-canplaytypeenum-nil title=dom-CanPlayTypeEnum-nil&gt;the empty string&lt;/dfn&gt; if &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
   is &lt;a href=#a-type-that-the-user-agent-knows-it-cannot-render&gt;a type that the user agent knows it cannot render&lt;/a&gt; or is the type
   &quot;&lt;code&gt;application/octet-stream&lt;/code&gt;&quot;; it must return &quot;&lt;dfn id=dom-canplaytypeenum-probably title=dom-CanPlayTypeEnum-probably&gt;&lt;code&gt;probably&lt;/code&gt;&lt;/dfn&gt;&quot; if the
@@ -64137,7 +64138,10 @@
    &lt;a href=#active-document&gt;active document&lt;/a&gt; has the &lt;a href=#same-origin title=&quot;same origin&quot;&gt;same&lt;/a&gt; &lt;a href=#origin&gt;origin&lt;/a&gt; as
    the &lt;a href=#active-document&gt;active document&lt;/a&gt; of &lt;var title=&quot;&quot;&gt;A&lt;/var&gt; (possibly in fact being &lt;var title=&quot;&quot;&gt;A&lt;/var&gt; itself).&lt;/li&gt;
 
-  &lt;/ul&gt;&lt;hr&gt;&lt;p&gt;An element has a &lt;dfn id=browsing-context-scope-origin&gt;browsing context scope origin&lt;/dfn&gt; if its &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s
+  &lt;/ul&gt;&lt;p class=note&gt;Sandboxing (in particular the &lt;a href=#sandboxed-navigation-browsing-context-flag&gt;sandboxed navigation browsing context
+  flag&lt;/a&gt;) can further restrict the above in certain cases.&lt;/p&gt;
+
+  &lt;hr&gt;&lt;p&gt;An element has a &lt;dfn id=browsing-context-scope-origin&gt;browsing context scope origin&lt;/dfn&gt; if its &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; is a &lt;a href=#top-level-browsing-context&gt;top-level browsing context&lt;/a&gt; or if all of its
   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;'s &lt;a href=#ancestor-browsing-context title=&quot;ancestor browsing context&quot;&gt;ancestor browsing contexts&lt;/a&gt;
   all have &lt;a href=#active-document title=&quot;active document&quot;&gt;active documents&lt;/a&gt; whose &lt;a href=#origin&gt;origin&lt;/a&gt; are the
@@ -64241,10 +64245,10 @@
     &lt;tr&gt;&lt;td&gt;&lt;code title=&quot;&quot;&gt;_blank&lt;/code&gt;
      &lt;td&gt;new
      &lt;td&gt;new
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
 
     &lt;tr&gt;&lt;td&gt;&lt;code title=&quot;&quot;&gt;_self&lt;/code&gt;
      &lt;td&gt;current
@@ -64334,8 +64338,42 @@
      &lt;td&gt;none
      &lt;td&gt;none
 
-  &lt;/table&gt;&lt;p class=tablenote&gt;&lt;small&gt;&dagger; This case is only possible if the &lt;code title=attr-iframe-sandbox&gt;&lt;a href=#attr-iframe-sandbox&gt;sandbox&lt;/a&gt;&lt;/code&gt; attribute also allows scripts.&lt;/small&gt;&lt;/p&gt;
+    &lt;tr&gt;&lt;td&gt;other name that exists with common top
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
 
+    &lt;tr&gt;&lt;td&gt;other name that exists, if &lt;a href=#allowed-to-navigate&gt;allowed to navigate&lt;/a&gt; and &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/a&gt;
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+
+    &lt;tr&gt;&lt;td&gt;other name that exists, if &lt;a href=#allowed-to-navigate&gt;allowed to navigate&lt;/a&gt; but not &lt;a href=#one-permitted-sandboxed-navigator&gt;one permitted sandboxed navigator&lt;/a&gt;
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+
+    &lt;tr&gt;&lt;td&gt;other name that exists, not &lt;a href=#allowed-to-navigate&gt;allowed to navigate&lt;/a&gt;
+     &lt;td&gt;new
+     &lt;td&gt;new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+
+  &lt;/table&gt;&lt;p class=tablenote&gt;&lt;small&gt;Most of the restrictions on sandboxed browsing contexts are applied by
+  other algorithms, e.g. the &lt;a href=#navigate title=navigate&gt;navigation&lt;/a&gt; algorithm, not &lt;a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name&gt;the rules
+  for choosing a browsing context given a browsing context name&lt;/a&gt; given below.&lt;/small&gt;&lt;/p&gt;
+
   &lt;div class=impl&gt;
 
   &lt;hr&gt;&lt;p&gt;An algorithm is &lt;dfn id=allowed-to-show-a-popup&gt;allowed to show a popup&lt;/dfn&gt; if, in the &lt;a href=#concept-task title=concept-task&gt;task&lt;/a&gt; in which the algorithm is running, either:&lt;/p&gt;
@@ -77876,7 +77914,7 @@
    // CONFIGURATION
    function configure(event) {
      if (event.data.substr(0, 4) != 'cfg ') return;
-     var name = event.data.substr(4).split(' ', 1);
+     var name = event.data.substr(4).split(' ', 1)[0];
      // update display to mention our name is name
      document.getElementsByTagName('h1')[0].textContent += ' ' + name;
      // no longer need this listener
@@ -77898,7 +77936,7 @@
            context.fillStyle = 'green';
          else 
            context.fillStyle = 'maroon';
-         fillRect(x * 50, y * 50, 50, 50);
+         context.fillRect(x * 50, y * 50, 50, 50);
        }
      }
    }
@@ -77907,23 +77945,26 @@
    // PUBLIC CHAT
    function updatePublicChat(event) {
      if (event.data.substr(0, 4) != 'txt ') return;
-     var name = event.data.substr(4).split(' ', 1);
-     var message = event.data.substr(4 + length(name) + 1);
+     var name = event.data.substr(4).split(' ', 1)[0];
+     var message = event.data.substr(4 + name.length + 1);
      // display &quot;&lt;name&gt; message&quot; in public chat
-     var dialog = document.getElementById('public');
-     var dt = document.createElement('dt');
-     dt.textContent = name;
-     dialog.appendChild(dt);
-     var dd = document.createElement('dd');
-     dd.textContent = message;
-     dialog.appendChild(dd);
+     var public = document.getElementById('public');
+     var p = document.createElement('p');
+     var n = document.createElement('button');
+     n.textContent = '&lt;' + name + '&gt; ';
+     n.onclick = function () { worker.port.postMessage('msg ' + name); };
+     p.appendChild(n);
+     var m = document.createElement('span');
+     m.textContent = message;
+     p.appendChild(m);
+     public.appendChild(p);
    }
    worker.port.addEventListener('message', updatePublicChat, false);
 
    // PRIVATE CHAT
    function startPrivateChat(event) {
      if (event.data.substr(0, 4) != 'msg ') return;
-     var name = event.data.substr(4).split(' ', 1);
+     var name = event.data.substr(4).split(' ', 1)[0];
      var port = event.ports[0];
      // display a private chat UI
      var ul = document.getElementById('private');
@@ -77931,19 +77972,21 @@
      var h3 = document.createElement('h3');
      h3.textContent = 'Private chat with ' + name;
      li.appendChild(h3);
-     var dialog = document.createElement('dialog');
+     var div = document.createElement('div');
      var addMessage = function(name, message) {
-       var dt = document.createElement('dt');
-       dt.textContent = name;
-       dialog.appendChild(dt);
-       var dd = document.createElement('dd');
-       dd.textContent = message;
-       dialog.appendChild(dd);
+       var p = document.createElement('p');
+       var n = document.createElement('strong');
+       n.textContent = '&lt;' + name + '&gt; ';
+       p.appendChild(n);
+       var t = document.createElement('span');
+       t.textContent = message;
+       p.appendChild(t);
+       div.appendChild(p);
      };
      port.onmessage = function (event) {
        addMessage(name, event.data);
      };
-     li.appendChild(dialog);
+     li.appendChild(div);
      var form = document.createElement('form');
      var p = document.createElement('p');
      var input = document.createElement('input');
@@ -77961,6 +78004,7 @@
      };
      form.appendChild(p);
      li.appendChild(form);
+     ul.appendChild(li);
    }
    worker.port.addEventListener('message', startPrivateChat, false);
 
@@ -77980,7 +78024,7 @@
    &lt;button type=button onclick=&quot;worker.port.postMessage('set 1')&quot;&gt;Set 1&lt;/button&gt;
   &lt;/p&gt;
   &lt;h2&gt;Public Chat&lt;/h2&gt;
-  &lt;dialog id=&quot;public&quot;&gt;&lt;/dialog&gt;
+  &lt;div id=&quot;public&quot;&gt;&lt;/div&gt;
   &lt;form onsubmit=&quot;worker.port.postMessage('txt ' + message.value); message.value = ''; return false;&quot;&gt;
    &lt;p&gt;
     &lt;input type=&quot;text&quot; name=&quot;message&quot; size=&quot;50&quot;&gt;
@@ -78042,26 +78086,34 @@
   return y;
 }
 
-function sendMapData(callback) {
+function wrap(val, min, max) {
+  if (val &lt; min)
+    return val + (max-min)+1;
+  if (val &gt; max)
+    return val - (max-min)-1;
+  return val;
+}
+
+function sendMapData(viewer) {
   var data = '';
   for (var y = viewer.y-1; y &lt;= viewer.y+1; y += 1) {
     for (var x = viewer.x-1; x &lt;= viewer.x+1; x += 1) {
       if (data != '')
         data += ',';
-      data += map[y][x];
+      data += map[wrap(y, 0, map[0].length-1)][wrap(x, 0, map.length-1)];
     }
   }
-  callback('map ' + data);
+  viewer.port.postMessage('map ' + data);
 }
 
 var viewers = {};
 onconnect = function (event) {
-  event.ports[0]._name = getNextName();
-  event.ports[0]._data = { port: event.port, x: 0, y: 0, };
-  viewers[event.ports[0]._name] = event.port._data;
+  var name = getNextName();
+  event.ports[0]._data = { port: event.ports[0], name: name, x: 0, y: 0, };
+  viewers[name] = event.ports[0]._data;
   event.ports[0].postMessage('cfg ' + name);
   event.ports[0].onmessage = getMessage;
-  sendMapData(event.ports[0].postMessage);
+  sendMapData(event.ports[0]._data);
 };
 
 function getMessage(event) {
@@ -78078,23 +78130,23 @@
       }
       event.target._data.x = wrapX(event.target._data.x + dx);
       event.target._data.y = wrapY(event.target._data.y + dy);
-      sendMapData(event.target.postMessage);
+      sendMapData(event.target._data);
       break;
     case 'set ':
       var value = event.data.substr(4);
       map[event.target._data.y][event.target._data.x] = value;
       for (var viewer in viewers)
-        sendMapData(viewers[viewer].port.postMessage);
+        sendMapData(viewers[viewer]._data);
       break;
     case 'txt ':
-      var name = event.target._name;
+      var name = event.target._data.name;
       var message = event.data.substr(4);
       for (var viewer in viewers)
         viewers[viewer].port.postMessage('txt ' + name + ' ' + message);
       break;
     case 'msg ':
-      var party1 = event._data;
-      var party2 = viewers[event.data.substr(4).split(' ', 1)];
+      var party1 = event.target._data;
+      var party2 = viewers[event.data.substr(4).split(' ', 1)[0]];
       if (party2) {
         var channel = new MessageChannel();
         party1.port.postMessage('msg ' + party2.name, [channel.port1]);
@@ -101101,6 +101153,7 @@
   Bj&ouml;rn H&ouml;hrmann,
   Blake Frantz,
   Bob Lund,
+  Bob Owen,
   Boris Zbarsky,
   Brad Fults,
   Brad Neuberg,

Modified: source
===================================================================
--- source	2013-04-12 23:30:29 UTC (rev 7827)
+++ source	2013-04-13 16:18:34 UTC (rev 7828)
@@ -28705,6 +28705,7 @@
 
   &lt;div class=&quot;impl&quot;&gt;
 
+&lt;!--CLEANUP--&gt;
   &lt;p&gt;The &lt;dfn title=&quot;dom-navigator-canPlayType&quot;&gt;&lt;code&gt;canPlayType(&lt;var
   title=&quot;&quot;&gt;type&lt;/var&gt;)&lt;/code&gt;&lt;/dfn&gt; method must return &lt;dfn title=&quot;dom-CanPlayTypeEnum-nil&quot;&gt;the empty string&lt;/dfn&gt; if &lt;var title=&quot;&quot;&gt;type&lt;/var&gt;
   is &lt;span&gt;a type that the user agent knows it cannot render&lt;/span&gt; or is the type
@@ -76002,6 +76003,9 @@
 
   &lt;/ul&gt;
 
+  &lt;p class=&quot;note&quot;&gt;Sandboxing (in particular the &lt;span&gt;sandboxed navigation browsing context
+  flag&lt;/span&gt;) can further restrict the above in certain cases.&lt;/p&gt;
+
   &lt;hr&gt;
 
   &lt;p&gt;An element has a &lt;dfn&gt;browsing context scope origin&lt;/dfn&gt; if its &lt;code&gt;Document&lt;/code&gt;'s
@@ -76123,10 +76127,10 @@
      &lt;td&gt;&lt;code title=&quot;&quot;&gt;_blank&lt;/code&gt;
      &lt;td&gt;new
      &lt;td&gt;new
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
-     &lt;td&gt;maybe new&dagger;
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
 
     &lt;tr&gt;
      &lt;td&gt;&lt;code title=&quot;&quot;&gt;_self&lt;/code&gt;
@@ -76227,10 +76231,47 @@
      &lt;td&gt;none
      &lt;td&gt;none
 
+    &lt;tr&gt;
+     &lt;td&gt;other name that exists with common top
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+
+    &lt;tr&gt;
+     &lt;td&gt;other name that exists, if &lt;span&gt;allowed to navigate&lt;/span&gt; and &lt;span&gt;one permitted sandboxed navigator&lt;/span&gt;
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+
+    &lt;tr&gt;
+     &lt;td&gt;other name that exists, if &lt;span&gt;allowed to navigate&lt;/span&gt; but not &lt;span&gt;one permitted sandboxed navigator&lt;/span&gt;
+     &lt;td&gt;specified
+     &lt;td&gt;specified
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+     &lt;td&gt;none
+
+    &lt;tr&gt;
+     &lt;td&gt;other name that exists, not &lt;span&gt;allowed to navigate&lt;/span&gt;
+     &lt;td&gt;new
+     &lt;td&gt;new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+     &lt;td&gt;maybe new
+
   &lt;/table&gt;
 
-  &lt;p class=&quot;tablenote&quot;&gt;&lt;small&gt;&dagger; This case is only possible if the &lt;code
-  title=&quot;attr-iframe-sandbox&quot;&gt;sandbox&lt;/code&gt; attribute also allows scripts.&lt;/small&gt;&lt;/p&gt;
+  &lt;p class=&quot;tablenote&quot;&gt;&lt;small&gt;Most of the restrictions on sandboxed browsing contexts are applied by
+  other algorithms, e.g. the &lt;span title=&quot;navigate&quot;&gt;navigation&lt;/span&gt; algorithm, not &lt;span&gt;the rules
+  for choosing a browsing context given a browsing context name&lt;/span&gt; given below.&lt;/small&gt;&lt;/p&gt;
 
   &lt;div class=&quot;impl&quot;&gt;
 
@@ -117886,6 +117927,7 @@
   Bj&ouml;rn H&ouml;hrmann,
   Blake Frantz,
   Bob Lund,
+  Bob Owen,
   Boris Zbarsky,
   Brad Fults,
   Brad Neuberg,


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014685.html">[html5] r7827 - [e] (0) Clarify API is limited to three strings by	using WebIDL magic. Fixing ht [...]
</A></li>
	<LI>Next message: <A HREF="014687.html">[html5] r7829 - [c] (0) I couldn't find a normative statement	requiring that &lt;area&gt; only be insi [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14686">[ date ]</a>
              <a href="thread.html#14686">[ thread ]</a>
              <a href="subject.html#14686">[ subject ]</a>
              <a href="author.html#14686">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
