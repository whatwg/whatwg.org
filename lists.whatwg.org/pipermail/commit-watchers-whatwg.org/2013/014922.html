<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r8065 - [giow] (0) Update ImageBitmap to use Promises.	Affected topics: Canvas, DOM APIs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r8065%20-%20%5Bgiow%5D%20%280%29%20Update%20ImageBitmap%20to%20use%20Promises.%0A%09Affected%20topics%3A%20Canvas%2C%20DOM%20APIs&In-Reply-To=%3C20130717210309.DEFEE1536C3D3%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014921.html">
   <LINK REL="Next"  HREF="014923.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r8065 - [giow] (0) Update ImageBitmap to use Promises.	Affected topics: Canvas, DOM APIs</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r8065%20-%20%5Bgiow%5D%20%280%29%20Update%20ImageBitmap%20to%20use%20Promises.%0A%09Affected%20topics%3A%20Canvas%2C%20DOM%20APIs&In-Reply-To=%3C20130717210309.DEFEE1536C3D3%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r8065 - [giow] (0) Update ImageBitmap to use Promises.	Affected topics: Canvas, DOM APIs">whatwg at whatwg.org
       </A><BR>
    <I>Wed Jul 17 14:03:09 PDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="014921.html">[html5] r8064 - [giow] (3) Define the kind of language tag that	navigator.language must return A [...]
</A></li>
        <LI>Next message: <A HREF="014923.html">[html5] r8066 - [e] (0) Fix a the createImageBitmap() example to	use the Promise API more correc [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14922">[ date ]</a>
              <a href="thread.html#14922">[ thread ]</a>
              <a href="subject.html#14922">[ subject ]</a>
              <a href="author.html#14922">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2013-07-17 14:03:08 -0700 (Wed, 17 Jul 2013)
New Revision: 8065

Modified:
   complete.html
   index
   source
Log:
[giow] (0) Update ImageBitmap to use Promises.
Affected topics: Canvas, DOM APIs

Modified: complete.html
===================================================================
--- complete.html	2013-07-16 22:58:40 UTC (rev 8064)
+++ complete.html	2013-07-17 21:03:08 UTC (rev 8065)
@@ -256,7 +256,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> class=logo&gt;&lt;img width=101 src=/images/logo alt=WHATWG height=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 16 July 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 17 July 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -3580,7 +3580,7 @@
     specification is defined in terms of the DOM, and some of the features are defined as extensions
     to the DOM interfaces. &lt;a href=#refsDOM&gt;[DOM]&lt;/a&gt; &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;p&gt;In particular, the following features are defined in the DOM specification: &lt;a href=#refsDOM&gt;[DOM]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;In particular, the following features are defined in the DOM specification: &lt;a href=#refsDOM&gt;[DOM]&lt;/a&gt;&lt;/p&gt; &lt;!-- aka DOM Core or DOMCORE --&gt;
 
     &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=attr&gt;&lt;code&gt;Attr&lt;/code&gt;&lt;/dfn&gt; interface&lt;/li&gt;
      &lt;li&gt;&lt;dfn id=comment-0&gt;&lt;code&gt;Comment&lt;/code&gt;&lt;/dfn&gt; interface&lt;/li&gt;
@@ -3645,6 +3645,10 @@
      &lt;li&gt;The &lt;dfn id=mutationobserver-scripting-environment&gt;&lt;code&gt;MutationObserver&lt;/code&gt; &lt;var title=&quot;&quot;&gt;scripting environment&lt;/var&gt;&lt;/dfn&gt; concept&lt;/li&gt;
      &lt;li&gt;The &lt;dfn id=concept-mo-invoke title=concept-mo-invoke&gt;invoke &lt;code&gt;MutationObserver&lt;/code&gt; objects&lt;/dfn&gt; algorithm&lt;/li&gt;
 
+     &lt;li&gt;&lt;dfn id=promise&gt;Promise&lt;/dfn&gt; interface&lt;/li&gt;
+     &lt;li&gt;The &lt;dfn id=concept-resolver title=concept-resolver&gt;resolver&lt;/dfn&gt; concept&lt;/li&gt;
+     &lt;li&gt;The &lt;dfn id=concept-resolver-fulfill title=concept-resolver-fulfill&gt;fulfill&lt;/dfn&gt; and &lt;dfn id=concept-resolver-reject title=concept-resolver-reject&gt;reject&lt;/dfn&gt; algorithms&lt;/li&gt;
+
     &lt;/ul&gt;&lt;p&gt;The term &lt;dfn id=throw&gt;throw&lt;/dfn&gt; in this specification is used as defined in the DOM specification.
     The following &lt;code&gt;&lt;a href=#domexception&gt;DOMException&lt;/a&gt;&lt;/code&gt; types are defined in the DOM specification: &lt;a href=#refsDOM&gt;[DOM]&lt;/a&gt;&lt;/p&gt;
 
@@ -75283,7 +75287,7 @@
 
 [NoInterfaceObject]
 interface &lt;dfn id=imagebitmapfactories&gt;ImageBitmapFactories&lt;/dfn&gt; {
-  void &lt;a href=#dom-createimagebitmap title=dom-createImageBitmap&gt;createImageBitmap&lt;/a&gt;(&lt;a href=#imagebitmapsource&gt;ImageBitmapSource&lt;/a&gt; image, &lt;a href=#imagebitmapcallback&gt;ImageBitmapCallback&lt;/a&gt; _callback, optional long sx, long sy, long sw, long sh);
+  &lt;a href=#promise&gt;Promise&lt;/a&gt; &lt;a href=#dom-createimagebitmap title=dom-createImageBitmap&gt;createImageBitmap&lt;/a&gt;(&lt;a href=#imagebitmapsource&gt;ImageBitmapSource&lt;/a&gt; image, optional long sx, long sy, long sw, long sh);
 };
 &lt;a href=#window&gt;Window&lt;/a&gt; implements &lt;a href=#imagebitmapfactories&gt;ImageBitmapFactories&lt;/a&gt;;
 &lt;a href=#workerglobalscope&gt;WorkerGlobalScope&lt;/a&gt; implements &lt;a href=#imagebitmapfactories&gt;ImageBitmapFactories&lt;/a&gt;;&lt;/pre&gt;
@@ -75296,19 +75300,18 @@
   I/O, then the latency is probably undue; whereas if it only requires a blocking read from a GPU or
   system RAM, the latency is probably acceptable.&lt;/p&gt;
 
-  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;Window&lt;/var&gt; . &lt;code title=dom-createImageBitmap&gt;&lt;a href=#dom-createimagebitmap&gt;createImageBitmap&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;image&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; ] )&lt;/dt&gt;
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;promise&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;Window&lt;/var&gt; . &lt;code title=dom-createImageBitmap&gt;&lt;a href=#dom-createimagebitmap&gt;createImageBitmap&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;image&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; ] )&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;Takes &lt;var title=&quot;&quot;&gt;image&lt;/var&gt;, which can be an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element,
     &lt;code&gt;&lt;a href=#the-video-element&gt;video&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a href=#the-canvas-element&gt;canvas&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object, an
     &lt;code&gt;&lt;a href=#imagedata&gt;ImageData&lt;/a&gt;&lt;/code&gt; object, a &lt;code&gt;&lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt; object, or another
-    &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object, and asynchronously calls &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with a
-    new &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; as its argument when it has created one.&lt;/p&gt;
+    &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object, and return a &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt; that is resolved when a
+    new &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; is created.&lt;/p&gt;
 
     &lt;p&gt;If no &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object can be constructed, for example because the provided
-    &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; data is not actually an image, then the &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;
-    is invoked with null as the value instead.&lt;/p&gt;
+    &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; data is not actually an image, then promise is rejected instead.&lt;/p&gt;
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments are provided, the source image is cropped to the given pixels, with
     any pixels missing in the original replaced by transparent black. These coordinates are in the
@@ -75331,8 +75334,7 @@
   object's media data can be decoded without errors, it is said to be &lt;dfn id=concept-imagebitmap-good title=concept-ImageBitmap-good&gt;fully decodable&lt;/dfn&gt;.&lt;/p&gt;
 
   &lt;p&gt;An &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object can be obtained from a variety of different objects, using
-  the &lt;dfn id=dom-createimagebitmap title=dom-createImageBitmap&gt;&lt;code&gt;createImageBitmap()&lt;/code&gt;&lt;/dfn&gt; method. This method
-  takes two arguments, &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;. When invoked, the
+  the &lt;dfn id=dom-createimagebitmap title=dom-createImageBitmap&gt;&lt;code&gt;createImageBitmap()&lt;/code&gt;&lt;/dfn&gt; method. When invoked, the
   method must act as follows:&lt;/p&gt;
   &lt;!-- the canvas createPattern() and drawImage() methods have similar requirements --&gt;
 
@@ -75366,10 +75368,12 @@
      supported or is disabled), or, if there is no such image, the first frame of the
      animation.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps
+     asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75399,10 +75403,11 @@
      &lt;a href=#current-playback-position&gt;current playback position&lt;/a&gt;, at the &lt;a href=#media-resource&gt;media resource&lt;/a&gt;'s &lt;a href=#concept-video-intrinsic-width title=concept-video-intrinsic-width&gt;intrinsic width&lt;/a&gt; and &lt;a href=#concept-video-intrinsic-height title=concept-video-intrinsic-height&gt;intrinsic height&lt;/a&gt; (i.e. after any aspect-ratio
      correction has been applied), &lt;a href=#cropped-to-the-source-rectangle&gt;cropped to the source rectangle&lt;/a&gt;.&lt;/p&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75428,10 +75433,11 @@
      &lt;code&gt;&lt;a href=#the-canvas-element&gt;canvas&lt;/a&gt;&lt;/code&gt; element's bitmap data, &lt;a href=#cropped-to-the-source-rectangle&gt;cropped to the source
      rectangle&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75446,10 +75452,11 @@
      &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object has been neutered through the &lt;code title=dom-Blob-close&gt;close&lt;/code&gt; method, then throw an &lt;code&gt;&lt;a href=#invalidstateerror&gt;InvalidStateError&lt;/a&gt;&lt;/code&gt;
      exception and abort these steps.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Read the &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object's data. If an &lt;a href=#file-error-read title=file-error-read&gt;error
-     occurs during reading of the object&lt;/a&gt;, then &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with null as the argument, and abort these steps.&lt;/li&gt;
+     occurs during reading of the object&lt;/a&gt;, then &lt;a href=#concept-resolver-reject title=concept-resolver-reject&gt;reject&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with null as the value, and abort these steps.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Apply the &lt;a href=#content-type-sniffing:-image title=&quot;Content-Type sniffing: image&quot;&gt;image sniffing rules&lt;/a&gt; to
      determine the file format of the image data, with MIME type of the &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; (as given
@@ -75458,8 +75465,8 @@
 
      &lt;li&gt;&lt;p&gt;If the image data is not in a supported file format (e.g. it's not actually an image at
      all), or if the image data is corrupted in some fatal way such that the image dimensions cannot
-     be obtained, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with null as the
-     argument, and abort these steps.&lt;/li&gt;
+     be obtained, then &lt;a href=#concept-resolver-reject title=concept-resolver-reject&gt;reject&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with null as the value, and abort these steps.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Create a new &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object.&lt;/li&gt;
 
@@ -75470,8 +75477,9 @@
      supported or is disabled), or, if there is no such image, the first frame of the
      animation.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75490,10 +75498,11 @@
      of the object's &lt;code title=dom-imagedata-resolution&gt;&lt;a href=#dom-imagedata-resolution&gt;resolution&lt;/a&gt;&lt;/code&gt; attribute as the
      object's pixel density.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75520,10 +75529,11 @@
      &lt;code&gt;&lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt; object's &lt;a href=#scratch-bitmap&gt;scratch bitmap&lt;/a&gt;, &lt;a href=#cropped-to-the-source-rectangle&gt;cropped to
      the source rectangle&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75540,10 +75550,11 @@
      &lt;li&gt;&lt;p&gt;Let the &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object's bitmap data be a copy of the &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; argument's bitmap data, &lt;a href=#cropped-to-the-source-rectangle&gt;cropped to the source
      rectangle&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75585,27 +75596,21 @@
    &lt;p&gt;Using this API, a sprite sheet can be precut and prepared:&lt;/p&gt;
 
    &lt;pre&gt;var sprites = {};
-function loadMySprites(loadedCallback) {
-  var pending = 0;
-  function getSpriteAdder(name) {
-    pending += 1;
-    return function (image) {
-      sprites[name] = image;
-      pending -= 1;
-      if (!pending)
-        loadedCallback();
-    };
-  }
+function loadMySprites() {
   var image = new Image();
   image.src = 'mysprites.png';
+  var promise = new Promise();
   image.onload = function () {
-    createImageBitmap(image, getSpriteAdder('woman'),  0,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('man'),   40,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('tree'),  80,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('hut'),    0, 40, 40, 40);
-    createImageBitmap(image, getSpriteAdder('apple'), 40, 40, 40, 40);
-    createImageBitmap(image, getSpriteAdder('snake'), 80, 40, 40, 40);
+    Promise.every(
+      createImageBitmap(image,  0,  0, 40, 40).then(function (image) { sprites.woman = image }),
+      createImageBitmap(image, 40,  0, 40, 40).then(function (image) { sprites.man   = image }),
+      createImageBitmap(image, 80,  0, 40, 40).then(function (image) { sprites.tree  = image }),
+      createImageBitmap(image,  0, 40, 40, 40).then(function (image) { sprites.hut   = image }),
+      createImageBitmap(image, 40, 40, 40, 40).then(function (image) { sprites.apple = image }),
+      createImageBitmap(image, 80, 40, 40, 40).then(function (image) { sprites.snake = image }),
+    ).then(function (value) { promise.fulfill(value) }, function (value) { promise.reject(value) } );
   };
+  return promise;
 }
 
 function runDemo() {
@@ -75615,7 +75620,7 @@
   context.drawImage(sprites.snake, 70, 10);
 }
 
-loadMySprites(runDemo);&lt;/pre&gt;
+loadMySprites().then(runDemo);&lt;/pre&gt;
 
   &lt;/div&gt;
 

Modified: index
===================================================================
--- index	2013-07-16 22:58:40 UTC (rev 8064)
+++ index	2013-07-17 21:03:08 UTC (rev 8065)
@@ -256,7 +256,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> class=logo&gt;&lt;img width=101 src=/images/logo alt=WHATWG height=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 16 July 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 17 July 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -3580,7 +3580,7 @@
     specification is defined in terms of the DOM, and some of the features are defined as extensions
     to the DOM interfaces. &lt;a href=#refsDOM&gt;[DOM]&lt;/a&gt; &lt;a href=#refsDOMEVENTS&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
 
-    &lt;p&gt;In particular, the following features are defined in the DOM specification: &lt;a href=#refsDOM&gt;[DOM]&lt;/a&gt;&lt;/p&gt;
+    &lt;p&gt;In particular, the following features are defined in the DOM specification: &lt;a href=#refsDOM&gt;[DOM]&lt;/a&gt;&lt;/p&gt; &lt;!-- aka DOM Core or DOMCORE --&gt;
 
     &lt;ul class=brief&gt;&lt;li&gt;&lt;dfn id=attr&gt;&lt;code&gt;Attr&lt;/code&gt;&lt;/dfn&gt; interface&lt;/li&gt;
      &lt;li&gt;&lt;dfn id=comment-0&gt;&lt;code&gt;Comment&lt;/code&gt;&lt;/dfn&gt; interface&lt;/li&gt;
@@ -3645,6 +3645,10 @@
      &lt;li&gt;The &lt;dfn id=mutationobserver-scripting-environment&gt;&lt;code&gt;MutationObserver&lt;/code&gt; &lt;var title=&quot;&quot;&gt;scripting environment&lt;/var&gt;&lt;/dfn&gt; concept&lt;/li&gt;
      &lt;li&gt;The &lt;dfn id=concept-mo-invoke title=concept-mo-invoke&gt;invoke &lt;code&gt;MutationObserver&lt;/code&gt; objects&lt;/dfn&gt; algorithm&lt;/li&gt;
 
+     &lt;li&gt;&lt;dfn id=promise&gt;Promise&lt;/dfn&gt; interface&lt;/li&gt;
+     &lt;li&gt;The &lt;dfn id=concept-resolver title=concept-resolver&gt;resolver&lt;/dfn&gt; concept&lt;/li&gt;
+     &lt;li&gt;The &lt;dfn id=concept-resolver-fulfill title=concept-resolver-fulfill&gt;fulfill&lt;/dfn&gt; and &lt;dfn id=concept-resolver-reject title=concept-resolver-reject&gt;reject&lt;/dfn&gt; algorithms&lt;/li&gt;
+
     &lt;/ul&gt;&lt;p&gt;The term &lt;dfn id=throw&gt;throw&lt;/dfn&gt; in this specification is used as defined in the DOM specification.
     The following &lt;code&gt;&lt;a href=#domexception&gt;DOMException&lt;/a&gt;&lt;/code&gt; types are defined in the DOM specification: &lt;a href=#refsDOM&gt;[DOM]&lt;/a&gt;&lt;/p&gt;
 
@@ -75283,7 +75287,7 @@
 
 [NoInterfaceObject]
 interface &lt;dfn id=imagebitmapfactories&gt;ImageBitmapFactories&lt;/dfn&gt; {
-  void &lt;a href=#dom-createimagebitmap title=dom-createImageBitmap&gt;createImageBitmap&lt;/a&gt;(&lt;a href=#imagebitmapsource&gt;ImageBitmapSource&lt;/a&gt; image, &lt;a href=#imagebitmapcallback&gt;ImageBitmapCallback&lt;/a&gt; _callback, optional long sx, long sy, long sw, long sh);
+  &lt;a href=#promise&gt;Promise&lt;/a&gt; &lt;a href=#dom-createimagebitmap title=dom-createImageBitmap&gt;createImageBitmap&lt;/a&gt;(&lt;a href=#imagebitmapsource&gt;ImageBitmapSource&lt;/a&gt; image, optional long sx, long sy, long sw, long sh);
 };
 &lt;a href=#window&gt;Window&lt;/a&gt; implements &lt;a href=#imagebitmapfactories&gt;ImageBitmapFactories&lt;/a&gt;;
 &lt;a href=#workerglobalscope&gt;WorkerGlobalScope&lt;/a&gt; implements &lt;a href=#imagebitmapfactories&gt;ImageBitmapFactories&lt;/a&gt;;&lt;/pre&gt;
@@ -75296,19 +75300,18 @@
   I/O, then the latency is probably undue; whereas if it only requires a blocking read from a GPU or
   system RAM, the latency is probably acceptable.&lt;/p&gt;
 
-  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;Window&lt;/var&gt; . &lt;code title=dom-createImageBitmap&gt;&lt;a href=#dom-createimagebitmap&gt;createImageBitmap&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;image&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; ] )&lt;/dt&gt;
+  &lt;dl class=domintro&gt;&lt;dt&gt;&lt;var title=&quot;&quot;&gt;promise&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;Window&lt;/var&gt; . &lt;code title=dom-createImageBitmap&gt;&lt;a href=#dom-createimagebitmap&gt;createImageBitmap&lt;/a&gt;&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;image&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; ] )&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;Takes &lt;var title=&quot;&quot;&gt;image&lt;/var&gt;, which can be an &lt;code&gt;&lt;a href=#the-img-element&gt;img&lt;/a&gt;&lt;/code&gt; element,
     &lt;code&gt;&lt;a href=#the-video-element&gt;video&lt;/a&gt;&lt;/code&gt;, or &lt;code&gt;&lt;a href=#the-canvas-element&gt;canvas&lt;/a&gt;&lt;/code&gt; element, a &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object, an
     &lt;code&gt;&lt;a href=#imagedata&gt;ImageData&lt;/a&gt;&lt;/code&gt; object, a &lt;code&gt;&lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt; object, or another
-    &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object, and asynchronously calls &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with a
-    new &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; as its argument when it has created one.&lt;/p&gt;
+    &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object, and return a &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt; that is resolved when a
+    new &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; is created.&lt;/p&gt;
 
     &lt;p&gt;If no &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object can be constructed, for example because the provided
-    &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; data is not actually an image, then the &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;
-    is invoked with null as the value instead.&lt;/p&gt;
+    &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; data is not actually an image, then promise is rejected instead.&lt;/p&gt;
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, and &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; arguments are provided, the source image is cropped to the given pixels, with
     any pixels missing in the original replaced by transparent black. These coordinates are in the
@@ -75331,8 +75334,7 @@
   object's media data can be decoded without errors, it is said to be &lt;dfn id=concept-imagebitmap-good title=concept-ImageBitmap-good&gt;fully decodable&lt;/dfn&gt;.&lt;/p&gt;
 
   &lt;p&gt;An &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object can be obtained from a variety of different objects, using
-  the &lt;dfn id=dom-createimagebitmap title=dom-createImageBitmap&gt;&lt;code&gt;createImageBitmap()&lt;/code&gt;&lt;/dfn&gt; method. This method
-  takes two arguments, &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;. When invoked, the
+  the &lt;dfn id=dom-createimagebitmap title=dom-createImageBitmap&gt;&lt;code&gt;createImageBitmap()&lt;/code&gt;&lt;/dfn&gt; method. When invoked, the
   method must act as follows:&lt;/p&gt;
   &lt;!-- the canvas createPattern() and drawImage() methods have similar requirements --&gt;
 
@@ -75366,10 +75368,12 @@
      supported or is disabled), or, if there is no such image, the first frame of the
      animation.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps
+     asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75399,10 +75403,11 @@
      &lt;a href=#current-playback-position&gt;current playback position&lt;/a&gt;, at the &lt;a href=#media-resource&gt;media resource&lt;/a&gt;'s &lt;a href=#concept-video-intrinsic-width title=concept-video-intrinsic-width&gt;intrinsic width&lt;/a&gt; and &lt;a href=#concept-video-intrinsic-height title=concept-video-intrinsic-height&gt;intrinsic height&lt;/a&gt; (i.e. after any aspect-ratio
      correction has been applied), &lt;a href=#cropped-to-the-source-rectangle&gt;cropped to the source rectangle&lt;/a&gt;.&lt;/p&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75428,10 +75433,11 @@
      &lt;code&gt;&lt;a href=#the-canvas-element&gt;canvas&lt;/a&gt;&lt;/code&gt; element's bitmap data, &lt;a href=#cropped-to-the-source-rectangle&gt;cropped to the source
      rectangle&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75446,10 +75452,11 @@
      &lt;li&gt;&lt;p&gt;If the &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object has been neutered through the &lt;code title=dom-Blob-close&gt;close&lt;/code&gt; method, then throw an &lt;code&gt;&lt;a href=#invalidstateerror&gt;InvalidStateError&lt;/a&gt;&lt;/code&gt;
      exception and abort these steps.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Read the &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; object's data. If an &lt;a href=#file-error-read title=file-error-read&gt;error
-     occurs during reading of the object&lt;/a&gt;, then &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with null as the argument, and abort these steps.&lt;/li&gt;
+     occurs during reading of the object&lt;/a&gt;, then &lt;a href=#concept-resolver-reject title=concept-resolver-reject&gt;reject&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with null as the value, and abort these steps.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Apply the &lt;a href=#content-type-sniffing:-image title=&quot;Content-Type sniffing: image&quot;&gt;image sniffing rules&lt;/a&gt; to
      determine the file format of the image data, with MIME type of the &lt;code&gt;&lt;a href=#blob&gt;Blob&lt;/a&gt;&lt;/code&gt; (as given
@@ -75458,8 +75465,8 @@
 
      &lt;li&gt;&lt;p&gt;If the image data is not in a supported file format (e.g. it's not actually an image at
      all), or if the image data is corrupted in some fatal way such that the image dimensions cannot
-     be obtained, &lt;a href=#queue-a-task&gt;queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with null as the
-     argument, and abort these steps.&lt;/li&gt;
+     be obtained, then &lt;a href=#concept-resolver-reject title=concept-resolver-reject&gt;reject&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with null as the value, and abort these steps.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Create a new &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object.&lt;/li&gt;
 
@@ -75470,8 +75477,9 @@
      supported or is disabled), or, if there is no such image, the first frame of the
      animation.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75490,10 +75498,11 @@
      of the object's &lt;code title=dom-imagedata-resolution&gt;&lt;a href=#dom-imagedata-resolution&gt;resolution&lt;/a&gt;&lt;/code&gt; attribute as the
      object's pixel density.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75520,10 +75529,11 @@
      &lt;code&gt;&lt;a href=#canvasrenderingcontext2d&gt;CanvasRenderingContext2D&lt;/a&gt;&lt;/code&gt; object's &lt;a href=#scratch-bitmap&gt;scratch bitmap&lt;/a&gt;, &lt;a href=#cropped-to-the-source-rectangle&gt;cropped to
      the source rectangle&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75540,10 +75550,11 @@
      &lt;li&gt;&lt;p&gt;Let the &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object's bitmap data be a copy of the &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; argument's bitmap data, &lt;a href=#cropped-to-the-source-rectangle&gt;cropped to the source
      rectangle&lt;/a&gt;.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;, but continue running these steps asynchronously.&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;a href=#queue-a-task&gt;Queue a task&lt;/a&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as its argument.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#concept-resolver-fulfill title=concept-resolver-fulfill&gt;Fulfill&lt;/a&gt; the &lt;code&gt;&lt;a href=#promise&gt;Promise&lt;/a&gt;&lt;/code&gt;'s
+     associated &lt;a href=#concept-resolver title=concept-resolver&gt;resolver&lt;/a&gt;, with the new
+     &lt;code&gt;&lt;a href=#imagebitmap&gt;ImageBitmap&lt;/a&gt;&lt;/code&gt; object as the value.&lt;/li&gt;
 
     &lt;/ol&gt;&lt;/dd&gt;
 
@@ -75585,27 +75596,21 @@
    &lt;p&gt;Using this API, a sprite sheet can be precut and prepared:&lt;/p&gt;
 
    &lt;pre&gt;var sprites = {};
-function loadMySprites(loadedCallback) {
-  var pending = 0;
-  function getSpriteAdder(name) {
-    pending += 1;
-    return function (image) {
-      sprites[name] = image;
-      pending -= 1;
-      if (!pending)
-        loadedCallback();
-    };
-  }
+function loadMySprites() {
   var image = new Image();
   image.src = 'mysprites.png';
+  var promise = new Promise();
   image.onload = function () {
-    createImageBitmap(image, getSpriteAdder('woman'),  0,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('man'),   40,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('tree'),  80,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('hut'),    0, 40, 40, 40);
-    createImageBitmap(image, getSpriteAdder('apple'), 40, 40, 40, 40);
-    createImageBitmap(image, getSpriteAdder('snake'), 80, 40, 40, 40);
+    Promise.every(
+      createImageBitmap(image,  0,  0, 40, 40).then(function (image) { sprites.woman = image }),
+      createImageBitmap(image, 40,  0, 40, 40).then(function (image) { sprites.man   = image }),
+      createImageBitmap(image, 80,  0, 40, 40).then(function (image) { sprites.tree  = image }),
+      createImageBitmap(image,  0, 40, 40, 40).then(function (image) { sprites.hut   = image }),
+      createImageBitmap(image, 40, 40, 40, 40).then(function (image) { sprites.apple = image }),
+      createImageBitmap(image, 80, 40, 40, 40).then(function (image) { sprites.snake = image }),
+    ).then(function (value) { promise.fulfill(value) }, function (value) { promise.reject(value) } );
   };
+  return promise;
 }
 
 function runDemo() {
@@ -75615,7 +75620,7 @@
   context.drawImage(sprites.snake, 70, 10);
 }
 
-loadMySprites(runDemo);&lt;/pre&gt;
+loadMySprites().then(runDemo);&lt;/pre&gt;
 
   &lt;/div&gt;
 

Modified: source
===================================================================
--- source	2013-07-16 22:58:40 UTC (rev 8064)
+++ source	2013-07-17 21:03:08 UTC (rev 8065)
@@ -2375,7 +2375,7 @@
     to the DOM interfaces. &lt;a href=&quot;#refsDOM&quot;&gt;[DOM]&lt;/a&gt; &lt;a href=&quot;#refsDOMEVENTS&quot;&gt;[DOMEVENTS]&lt;/a&gt;&lt;/p&gt;
 
     &lt;p&gt;In particular, the following features are defined in the DOM specification: &lt;a
-    href=&quot;#refsDOM&quot;&gt;[DOM]&lt;/a&gt;&lt;/p&gt;
+    href=&quot;#refsDOM&quot;&gt;[DOM]&lt;/a&gt;&lt;/p&gt; &lt;!-- aka DOM Core or DOMCORE --&gt;
 
     &lt;ul class=&quot;brief&quot;&gt;
 
@@ -2442,6 +2442,10 @@
      &lt;li&gt;The &lt;dfn&gt;&lt;code&gt;MutationObserver&lt;/code&gt; &lt;var title=&quot;&quot;&gt;scripting environment&lt;/var&gt;&lt;/dfn&gt; concept&lt;/li&gt;
      &lt;li&gt;The &lt;dfn title=&quot;concept-mo-invoke&quot;&gt;invoke &lt;code&gt;MutationObserver&lt;/code&gt; objects&lt;/dfn&gt; algorithm&lt;/li&gt;
 
+     &lt;li&gt;&lt;dfn&gt;Promise&lt;/dfn&gt; interface&lt;/li&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-resolver&quot;&gt;resolver&lt;/dfn&gt; concept&lt;/li&gt;
+     &lt;li&gt;The &lt;dfn title=&quot;concept-resolver-fulfill&quot;&gt;fulfill&lt;/dfn&gt; and &lt;dfn title=&quot;concept-resolver-reject&quot;&gt;reject&lt;/dfn&gt; algorithms&lt;/li&gt;
+
     &lt;/ul&gt;
 
     &lt;p&gt;The term &lt;dfn&gt;throw&lt;/dfn&gt; in this specification is used as defined in the DOM specification.
@@ -84306,7 +84310,7 @@
 
 [NoInterfaceObject]
 interface &lt;dfn&gt;ImageBitmapFactories&lt;/dfn&gt; {
-  void &lt;span title=&quot;dom-createImageBitmap&quot;&gt;createImageBitmap&lt;/span&gt;(&lt;span&gt;ImageBitmapSource&lt;/span&gt; image, &lt;span&gt;ImageBitmapCallback&lt;/span&gt; _callback, optional long sx, long sy, long sw, long sh);
+  &lt;span&gt;Promise&lt;/span&gt; &lt;span title=&quot;dom-createImageBitmap&quot;&gt;createImageBitmap&lt;/span&gt;(&lt;span&gt;ImageBitmapSource&lt;/span&gt; image, optional long sx, long sy, long sw, long sh);
 };
 &lt;span&gt;Window&lt;/span&gt; implements &lt;span&gt;ImageBitmapFactories&lt;/span&gt;;
 &lt;span&gt;WorkerGlobalScope&lt;/span&gt; implements &lt;span&gt;ImageBitmapFactories&lt;/span&gt;;&lt;/pre&gt;
@@ -84321,19 +84325,18 @@
 
   &lt;dl class=&quot;domintro&quot;&gt;
 
-   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;Window&lt;/var&gt; . &lt;code title=&quot;dom-createImageBitmap&quot;&gt;createImageBitmap&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;image&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; ] )&lt;/dt&gt;
+   &lt;dt&gt;&lt;var title=&quot;&quot;&gt;promise&lt;/var&gt; = &lt;var title=&quot;&quot;&gt;Window&lt;/var&gt; . &lt;code title=&quot;dom-createImageBitmap&quot;&gt;createImageBitmap&lt;/code&gt;(&lt;var title=&quot;&quot;&gt;image&lt;/var&gt; [, &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sh&lt;/var&gt; ] )&lt;/dt&gt;
 
    &lt;dd&gt;
 
     &lt;p&gt;Takes &lt;var title=&quot;&quot;&gt;image&lt;/var&gt;, which can be an &lt;code&gt;img&lt;/code&gt; element,
     &lt;code&gt;video&lt;/code&gt;, or &lt;code&gt;canvas&lt;/code&gt; element, a &lt;code&gt;Blob&lt;/code&gt; object, an
     &lt;code&gt;ImageData&lt;/code&gt; object, a &lt;code&gt;CanvasRenderingContext2D&lt;/code&gt; object, or another
-    &lt;code&gt;ImageBitmap&lt;/code&gt; object, and asynchronously calls &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with a
-    new &lt;code&gt;ImageBitmap&lt;/code&gt; as its argument when it has created one.&lt;/p&gt;
+    &lt;code&gt;ImageBitmap&lt;/code&gt; object, and return a &lt;code&gt;Promise&lt;/code&gt; that is resolved when a
+    new &lt;code&gt;ImageBitmap&lt;/code&gt; is created.&lt;/p&gt;
 
     &lt;p&gt;If no &lt;code&gt;ImageBitmap&lt;/code&gt; object can be constructed, for example because the provided
-    &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; data is not actually an image, then the &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;
-    is invoked with null as the value instead.&lt;/p&gt;
+    &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; data is not actually an image, then promise is rejected instead.&lt;/p&gt;
 
     &lt;p&gt;If &lt;var title=&quot;&quot;&gt;sx&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sy&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;sw&lt;/var&gt;, and &lt;var
     title=&quot;&quot;&gt;sh&lt;/var&gt; arguments are provided, the source image is cropped to the given pixels, with
@@ -84360,8 +84363,7 @@
   title=&quot;concept-ImageBitmap-good&quot;&gt;fully decodable&lt;/dfn&gt;.&lt;/p&gt;
 
   &lt;p&gt;An &lt;code&gt;ImageBitmap&lt;/code&gt; object can be obtained from a variety of different objects, using
-  the &lt;dfn title=&quot;dom-createImageBitmap&quot;&gt;&lt;code&gt;createImageBitmap()&lt;/code&gt;&lt;/dfn&gt; method. This method
-  takes two arguments, &lt;var title=&quot;&quot;&gt;image&lt;/var&gt; and &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt;. When invoked, the
+  the &lt;dfn title=&quot;dom-createImageBitmap&quot;&gt;&lt;code&gt;createImageBitmap()&lt;/code&gt;&lt;/dfn&gt; method. When invoked, the
   method must act as follows:&lt;/p&gt;
   &lt;!-- the canvas createPattern() and drawImage() methods have similar requirements --&gt;
 
@@ -84399,10 +84401,12 @@
      supported or is disabled), or, if there is no such image, the first frame of the
      animation.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;Promise&lt;/code&gt;, but continue running these steps
+     asynchronously.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;ImageBitmap&lt;/code&gt; object as its argument.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;concept-resolver-fulfill&quot;&gt;Fulfill&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with the new
+     &lt;code&gt;ImageBitmap&lt;/code&gt; object as the value.&lt;/p&gt;&lt;/li&gt;
 
     &lt;/ol&gt;
 
@@ -84441,10 +84445,11 @@
      title=&quot;concept-video-intrinsic-height&quot;&gt;intrinsic height&lt;/span&gt; (i.e. after any aspect-ratio
      correction has been applied), &lt;span&gt;cropped to the source rectangle&lt;/span&gt;.&lt;/p&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;Promise&lt;/code&gt;, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;ImageBitmap&lt;/code&gt; object as its argument.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;concept-resolver-fulfill&quot;&gt;Fulfill&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with the new
+     &lt;code&gt;ImageBitmap&lt;/code&gt; object as the value.&lt;/p&gt;&lt;/li&gt;
 
     &lt;/ol&gt;
 
@@ -84475,10 +84480,11 @@
      &lt;code&gt;canvas&lt;/code&gt; element's bitmap data, &lt;span&gt;cropped to the source
      rectangle&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;Promise&lt;/code&gt;, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;ImageBitmap&lt;/code&gt; object as its argument.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;concept-resolver-fulfill&quot;&gt;Fulfill&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with the new
+     &lt;code&gt;ImageBitmap&lt;/code&gt; object as the value.&lt;/p&gt;&lt;/li&gt;
 
     &lt;/ol&gt;
 
@@ -84498,11 +84504,11 @@
      title=&quot;dom-Blob-close&quot;&gt;close&lt;/code&gt; method, then throw an &lt;code&gt;InvalidStateError&lt;/code&gt;
      exception and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;Promise&lt;/code&gt;, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Read the &lt;code&gt;Blob&lt;/code&gt; object's data. If an &lt;span title=&quot;file-error-read&quot;&gt;error
-     occurs during reading of the object&lt;/span&gt;, then &lt;span&gt;queue a task&lt;/span&gt; to invoke &lt;var
-     title=&quot;&quot;&gt;callback&lt;/var&gt; with null as the argument, and abort these steps.&lt;/p&gt;&lt;/li&gt;
+     occurs during reading of the object&lt;/span&gt;, then &lt;span title=&quot;concept-resolver-reject&quot;&gt;reject&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with null as the value, and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Apply the &lt;span title=&quot;Content-Type sniffing: image&quot;&gt;image sniffing rules&lt;/span&gt; to
      determine the file format of the image data, with MIME type of the &lt;code&gt;Blob&lt;/code&gt; (as given
@@ -84511,8 +84517,8 @@
 
      &lt;li&gt;&lt;p&gt;If the image data is not in a supported file format (e.g. it's not actually an image at
      all), or if the image data is corrupted in some fatal way such that the image dimensions cannot
-     be obtained, &lt;span&gt;queue a task&lt;/span&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with null as the
-     argument, and abort these steps.&lt;/p&gt;&lt;/li&gt;
+     be obtained, then &lt;span title=&quot;concept-resolver-reject&quot;&gt;reject&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with null as the value, and abort these steps.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Create a new &lt;code&gt;ImageBitmap&lt;/code&gt; object.&lt;/p&gt;&lt;/li&gt;
 
@@ -84523,8 +84529,9 @@
      supported or is disabled), or, if there is no such image, the first frame of the
      animation.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;ImageBitmap&lt;/code&gt; object as its argument.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;concept-resolver-fulfill&quot;&gt;Fulfill&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with the new
+     &lt;code&gt;ImageBitmap&lt;/code&gt; object as the value.&lt;/p&gt;&lt;/li&gt;
 
     &lt;/ol&gt;
 
@@ -84547,10 +84554,11 @@
      of the object's &lt;code title=&quot;dom-imagedata-resolution&quot;&gt;resolution&lt;/code&gt; attribute as the
      object's pixel density.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;Promise&lt;/code&gt;, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;ImageBitmap&lt;/code&gt; object as its argument.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;concept-resolver-fulfill&quot;&gt;Fulfill&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with the new
+     &lt;code&gt;ImageBitmap&lt;/code&gt; object as the value.&lt;/p&gt;&lt;/li&gt;
 
     &lt;/ol&gt;
 
@@ -84581,10 +84589,11 @@
      &lt;code&gt;CanvasRenderingContext2D&lt;/code&gt; object's &lt;span&gt;scratch bitmap&lt;/span&gt;, &lt;span&gt;cropped to
      the source rectangle&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;Promise&lt;/code&gt;, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;ImageBitmap&lt;/code&gt; object as its argument.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;concept-resolver-fulfill&quot;&gt;Fulfill&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with the new
+     &lt;code&gt;ImageBitmap&lt;/code&gt; object as the value.&lt;/p&gt;&lt;/li&gt;
 
     &lt;/ol&gt;
 
@@ -84606,10 +84615,11 @@
      title=&quot;&quot;&gt;image&lt;/var&gt; argument's bitmap data, &lt;span&gt;cropped to the source
      rectangle&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;Return, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;Return a new &lt;code&gt;Promise&lt;/code&gt;, but continue running these steps asynchronously.&lt;/p&gt;&lt;/li&gt;
 
-     &lt;li&gt;&lt;p&gt;&lt;span&gt;Queue a task&lt;/span&gt; to invoke &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with the new
-     &lt;code&gt;ImageBitmap&lt;/code&gt; object as its argument.&lt;/p&gt;&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;span title=&quot;concept-resolver-fulfill&quot;&gt;Fulfill&lt;/span&gt; the &lt;code&gt;Promise&lt;/code&gt;'s
+     associated &lt;span title=&quot;concept-resolver&quot;&gt;resolver&lt;/span&gt;, with the new
+     &lt;code&gt;ImageBitmap&lt;/code&gt; object as the value.&lt;/p&gt;&lt;/li&gt;
 
     &lt;/ol&gt;
 
@@ -84666,27 +84676,21 @@
    &lt;p&gt;Using this API, a sprite sheet can be precut and prepared:&lt;/p&gt;
 
    &lt;pre&gt;var sprites = {};
-function loadMySprites(loadedCallback) {
-  var pending = 0;
-  function getSpriteAdder(name) {
-    pending += 1;
-    return function (image) {
-      sprites[name] = image;
-      pending -= 1;
-      if (!pending)
-        loadedCallback();
-    };
-  }
+function loadMySprites() {
   var image = new Image();
   image.src = 'mysprites.png';
+  var promise = new Promise();
   image.onload = function () {
-    createImageBitmap(image, getSpriteAdder('woman'),  0,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('man'),   40,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('tree'),  80,  0, 40, 40);
-    createImageBitmap(image, getSpriteAdder('hut'),    0, 40, 40, 40);
-    createImageBitmap(image, getSpriteAdder('apple'), 40, 40, 40, 40);
-    createImageBitmap(image, getSpriteAdder('snake'), 80, 40, 40, 40);
+    Promise.every(
+      createImageBitmap(image,  0,  0, 40, 40).then(function (image) { sprites.woman = image }),
+      createImageBitmap(image, 40,  0, 40, 40).then(function (image) { sprites.man   = image }),
+      createImageBitmap(image, 80,  0, 40, 40).then(function (image) { sprites.tree  = image }),
+      createImageBitmap(image,  0, 40, 40, 40).then(function (image) { sprites.hut   = image }),
+      createImageBitmap(image, 40, 40, 40, 40).then(function (image) { sprites.apple = image }),
+      createImageBitmap(image, 80, 40, 40, 40).then(function (image) { sprites.snake = image }),
+    ).then(function (value) { promise.fulfill(value) }, function (value) { promise.reject(value) } );
   };
+  return promise;
 }
 
 function runDemo() {
@@ -84696,7 +84700,7 @@
   context.drawImage(sprites.snake, 70, 10);
 }
 
-loadMySprites(runDemo);&lt;/pre&gt;
+loadMySprites().then(runDemo);&lt;/pre&gt;
 
   &lt;/div&gt;
 


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014921.html">[html5] r8064 - [giow] (3) Define the kind of language tag that	navigator.language must return A [...]
</A></li>
	<LI>Next message: <A HREF="014923.html">[html5] r8066 - [e] (0) Fix a the createImageBitmap() example to	use the Promise API more correc [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14922">[ date ]</a>
              <a href="thread.html#14922">[ thread ]</a>
              <a href="subject.html#14922">[ subject ]</a>
              <a href="author.html#14922">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
