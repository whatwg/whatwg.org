<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r8331 - [cgiowt] (3) Change how the form element pointer	affects parsing &lt;template&gt; elem [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r8331%20-%20%5Bcgiowt%5D%20%283%29%20Change%20how%20the%20form%20element%20pointer%0A%09affects%20parsing%20%3Ctemplate%3E%20elem%20%5B...%5D&In-Reply-To=%3C20131204190226.2804E1536D08A%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015185.html">
   <LINK REL="Next"  HREF="015188.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r8331 - [cgiowt] (3) Change how the form element pointer	affects parsing &lt;template&gt; elem [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r8331%20-%20%5Bcgiowt%5D%20%283%29%20Change%20how%20the%20form%20element%20pointer%0A%09affects%20parsing%20%3Ctemplate%3E%20elem%20%5B...%5D&In-Reply-To=%3C20131204190226.2804E1536D08A%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r8331 - [cgiowt] (3) Change how the form element pointer	affects parsing &lt;template&gt; elem [...]">whatwg at whatwg.org
       </A><BR>
    <I>Wed Dec  4 11:02:26 PST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="015185.html">[html5] r8330 - [e] (0) Allow workers that become suspendable but	still have outstanding work to [...]
</A></li>
        <LI>Next message: <A HREF="015188.html">[html5] r8332 - [e] (0) Clarify bidi CSS rules interaction Affected	topics: Rendering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15186">[ date ]</a>
              <a href="thread.html#15186">[ thread ]</a>
              <a href="subject.html#15186">[ subject ]</a>
              <a href="author.html#15186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2013-12-04 11:02:24 -0800 (Wed, 04 Dec 2013)
New Revision: 8331

Modified:
   complete.html
   index
   source
Log:
[cgiowt] (3) Change how the form element pointer affects parsing &lt;template&gt; elements, to reduce weirdness in templates (e.g. before you couldn't have a template that contained a form if it was itself inside a form).
Affected topics: HTML Syntax and Parsing

Modified: complete.html
===================================================================
--- complete.html	2013-12-03 22:58:15 UTC (rev 8330)
+++ complete.html	2013-12-04 19:02:24 UTC (rev 8331)
@@ -125,7 +125,7 @@
   &lt;/script&gt;&lt;link rel=stylesheet href=<A HREF="http://www.whatwg.org/style/specification">http://www.whatwg.org/style/specification</A>&gt;&lt;link rel=icon href=<A HREF="http://www.whatwg.org/images/icon">http://www.whatwg.org/images/icon</A>&gt;&lt;style&gt;
    .proposal { border: blue solid; padding: 1em; }
    .bad, .bad *:not(.XXX) { color: gray; border-color: gray; background: transparent; }
-   #updatesStatus { display: none; }
+   #updatesStatus { display: none; z-index: 10; }
    #updatesStatus.relevant { display: block; position: fixed; right: 1em; top: 1em; padding: 0.5em; font: bold small sans-serif; min-width: 25em; width: 30%; max-width: 40em; height: auto; border: ridge 4px gray; background: #EEEEEE; color: black; }
    div.head .logo { width: 11em; margin-bottom: 20em; }
    #configUI { position: absolute; z-index: 20; top: 10em; right: 0; width: 11em; padding: 0 0.5em 0 0.5em; font-size: small; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 1em 0 0 1em; -moz-border-radius: 1em 0 0 1em; }
@@ -298,7 +298,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> class=logo&gt;&lt;img width=101 src=/images/logo alt=WHATWG height=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 3 December 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 4 December 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -86026,7 +86026,7 @@
   &lt;p&gt;The &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; points to the last
   &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element that was opened and whose end tag has not yet been seen. It is used to
   make form controls associate with forms in the face of dramatically bad markup, for historical
-  reasons.&lt;/p&gt;
+  reasons. It is ignored inside &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
 
 
   &lt;h5 id=other-parsing-state-flags&gt;&lt;span class=secno&gt;12.2.3.5 &lt;/span&gt;Other parsing state flags&lt;/h5&gt;
@@ -89374,7 +89374,8 @@
    &lt;dt&gt;A start tag whose tag name is &quot;form&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, then this is
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;If the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, and there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, then this is
     a &lt;a href=#parse-error&gt;parse error&lt;/a&gt;; ignore the token.&lt;/p&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -89383,7 +89384,8 @@
     &lt;code&gt;p&lt;/code&gt; element in button scope&lt;/a&gt;, then &lt;a href=#close-a-p-element&gt;close a &lt;code&gt;p&lt;/code&gt;
     element&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;a href=#insert-an-html-element&gt;Insert an HTML element&lt;/a&gt; for the token, and set the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to point to the element created.&lt;/p&gt;
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;&lt;a href=#insert-an-html-element&gt;Insert an HTML element&lt;/a&gt; for the token, and, if there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, set the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to point to the element created.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -89580,23 +89582,41 @@
    &lt;dt&gt;An end tag whose tag name is &quot;form&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be the element that the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-    pointer&lt;/a&gt; is set to.&lt;/p&gt;
+    &lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, then
+    run these substeps:&lt;/p&gt;
 
-    &lt;p&gt;Set the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to null.&lt;/p&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be the element that the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt;
+     element pointer&lt;/a&gt; is set to, or null if it is not set to an element.&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is null or the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; does not &lt;a href=#has-an-element-in-scope title=&quot;has an element in scope&quot;&gt;have &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in scope&lt;/a&gt;, then this is a
-    &lt;a href=#parse-error&gt;parse error&lt;/a&gt;; ignore the token.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;Set the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to null. Otherwise, let
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be null.&lt;/li&gt;
 
-    &lt;p&gt;Otherwise, run these steps:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is null or if the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; does
+     not &lt;a href=#has-an-element-in-scope title=&quot;has an element in scope&quot;&gt;have &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in scope&lt;/a&gt;, then
+     this is a &lt;a href=#parse-error&gt;parse error&lt;/a&gt;; abort these steps and ignore the token.&lt;/li&gt;
 
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#generate-implied-end-tags&gt;Generate implied end tags&lt;/a&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#generate-implied-end-tags&gt;Generate implied end tags&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-node&gt;current node&lt;/a&gt; is not &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then this is a
      &lt;a href=#parse-error&gt;parse error&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Remove &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; from the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;.&lt;/li&gt;
 
+    &lt;/ol&gt;&lt;p&gt;If there &lt;em&gt;is&lt;/em&gt; a &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open
+    elements&lt;/a&gt;, then run these substeps instead:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; does not &lt;a href=#has-an-element-in-scope title=&quot;has an element in
+     scope&quot;&gt;have a &lt;code&gt;form&lt;/code&gt; element in scope&lt;/a&gt;, then this is a &lt;a href=#parse-error&gt;parse
+     error&lt;/a&gt;; abort these steps and ignore the token.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;a href=#generate-implied-end-tags&gt;Generate implied end tags&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-node&gt;current node&lt;/a&gt; is not a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element, then this is a
+     &lt;a href=#parse-error&gt;parse error&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Pop elements from the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; until a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt;
+     element has been popped from the stack.&lt;/li&gt;
+
     &lt;/ol&gt;&lt;/dd&gt;
 
    &lt;!-- as normal, except &lt;/p&gt; implies &lt;p&gt; if there's no &lt;p&gt; in scope, and needs care as the elements have optional tags --&gt;
@@ -89893,7 +89913,8 @@
 
     &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, then ignore the
+    &lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; and
+    the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, then ignore the
     token.&lt;/p&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -89909,7 +89930,8 @@
     &lt;code&gt;p&lt;/code&gt; element in button scope&lt;/a&gt;, then &lt;a href=#close-a-p-element&gt;close a &lt;code&gt;p&lt;/code&gt;
     element&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;a href=#insert-an-html-element&gt;Insert an HTML element&lt;/a&gt; for a &quot;form&quot; start tag token with no attributes, and set
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;&lt;a href=#insert-an-html-element&gt;Insert an HTML element&lt;/a&gt; for a &quot;form&quot; start tag token with no attributes, and, if there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, set
     the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to point to the element
     created.&lt;/p&gt;
 
@@ -89947,7 +89969,8 @@
 
     &lt;!-- fake &lt;/form&gt; --&gt;
     &lt;p&gt;Pop the &lt;a href=#current-node&gt;current node&lt;/a&gt; (which will be the &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element created
-    earlier) off the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;. Set the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to null.&lt;/p&gt;
+    earlier) off the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, and, if there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt;
+    element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, set the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; back to null.&lt;/p&gt;
 
     &lt;!-- explanation of text --&gt;
     &lt;p&gt;&lt;dfn id=attr-isindex-prompt title=attr-isindex-prompt&gt;&lt;strong&gt;Prompt&lt;/strong&gt;&lt;/dfn&gt;: If the token has an attribute
@@ -90660,8 +90683,9 @@
 
     &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, ignore the
-    token.&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, or if
+    the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, ignore the
+    token.&lt;/p&gt; &lt;!-- in a &lt;template&gt;, the &lt;form&gt; would have no effect and thus be a waste of time... --&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
 
@@ -92848,10 +92872,13 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;Set the parser's &lt;a href=#form-element-pointer&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to the nearest node to the
-      &lt;var title=concept-frag-parse-context&gt;&lt;a href=#concept-frag-parse-context&gt;context&lt;/a&gt;&lt;/var&gt; element that is a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt;
-      element (going straight up the ancestor chain, and including the element itself, if it is a
-      &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element), or, if there is no such &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element, to null.&lt;/p&gt;
+      &lt;p&gt;If neither the &lt;var title=concept-frag-parse-context&gt;&lt;a href=#concept-frag-parse-context&gt;context&lt;/a&gt;&lt;/var&gt; element nor any of
+      its ancestors are &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; elements, then set the parser's
+      &lt;a href=#form-element-pointer&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to the nearest node to the &lt;var title=concept-frag-parse-context&gt;&lt;a href=#concept-frag-parse-context&gt;context&lt;/a&gt;&lt;/var&gt; element that is a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element
+      (going straight up the ancestor chain, and including the element itself, if it is a
+      &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element), if any. (If there is no such &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element, or if
+      there's a &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element in the ancestor chain, the &lt;a href=#form-element-pointer&gt;&lt;code&gt;form&lt;/code&gt;
+      element pointer&lt;/a&gt; keeps its initial value, null.)&lt;/p&gt;
 
      &lt;/li&gt;
 

Modified: index
===================================================================
--- index	2013-12-03 22:58:15 UTC (rev 8330)
+++ index	2013-12-04 19:02:24 UTC (rev 8331)
@@ -125,7 +125,7 @@
   &lt;/script&gt;&lt;link rel=stylesheet href=<A HREF="http://www.whatwg.org/style/specification">http://www.whatwg.org/style/specification</A>&gt;&lt;link rel=icon href=<A HREF="http://www.whatwg.org/images/icon">http://www.whatwg.org/images/icon</A>&gt;&lt;style&gt;
    .proposal { border: blue solid; padding: 1em; }
    .bad, .bad *:not(.XXX) { color: gray; border-color: gray; background: transparent; }
-   #updatesStatus { display: none; }
+   #updatesStatus { display: none; z-index: 10; }
    #updatesStatus.relevant { display: block; position: fixed; right: 1em; top: 1em; padding: 0.5em; font: bold small sans-serif; min-width: 25em; width: 30%; max-width: 40em; height: auto; border: ridge 4px gray; background: #EEEEEE; color: black; }
    div.head .logo { width: 11em; margin-bottom: 20em; }
    #configUI { position: absolute; z-index: 20; top: 10em; right: 0; width: 11em; padding: 0 0.5em 0 0.5em; font-size: small; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 1em 0 0 1em; -moz-border-radius: 1em 0 0 1em; }
@@ -298,7 +298,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> class=logo&gt;&lt;img width=101 src=/images/logo alt=WHATWG height=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 3 December 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 4 December 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -86026,7 +86026,7 @@
   &lt;p&gt;The &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; points to the last
   &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element that was opened and whose end tag has not yet been seen. It is used to
   make form controls associate with forms in the face of dramatically bad markup, for historical
-  reasons.&lt;/p&gt;
+  reasons. It is ignored inside &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; elements.&lt;/p&gt;
 
 
   &lt;h5 id=other-parsing-state-flags&gt;&lt;span class=secno&gt;12.2.3.5 &lt;/span&gt;Other parsing state flags&lt;/h5&gt;
@@ -89374,7 +89374,8 @@
    &lt;dt&gt;A start tag whose tag name is &quot;form&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, then this is
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;If the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, and there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, then this is
     a &lt;a href=#parse-error&gt;parse error&lt;/a&gt;; ignore the token.&lt;/p&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -89383,7 +89384,8 @@
     &lt;code&gt;p&lt;/code&gt; element in button scope&lt;/a&gt;, then &lt;a href=#close-a-p-element&gt;close a &lt;code&gt;p&lt;/code&gt;
     element&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;a href=#insert-an-html-element&gt;Insert an HTML element&lt;/a&gt; for the token, and set the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to point to the element created.&lt;/p&gt;
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;&lt;a href=#insert-an-html-element&gt;Insert an HTML element&lt;/a&gt; for the token, and, if there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, set the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to point to the element created.&lt;/p&gt;
 
    &lt;/dd&gt;
 
@@ -89580,23 +89582,41 @@
    &lt;dt&gt;An end tag whose tag name is &quot;form&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be the element that the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element
-    pointer&lt;/a&gt; is set to.&lt;/p&gt;
+    &lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, then
+    run these substeps:&lt;/p&gt;
 
-    &lt;p&gt;Set the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to null.&lt;/p&gt;
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be the element that the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt;
+     element pointer&lt;/a&gt; is set to, or null if it is not set to an element.&lt;/li&gt;
 
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is null or the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; does not &lt;a href=#has-an-element-in-scope title=&quot;has an element in scope&quot;&gt;have &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in scope&lt;/a&gt;, then this is a
-    &lt;a href=#parse-error&gt;parse error&lt;/a&gt;; ignore the token.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;Set the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to null. Otherwise, let
+     &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; be null.&lt;/li&gt;
 
-    &lt;p&gt;Otherwise, run these steps:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; is null or if the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; does
+     not &lt;a href=#has-an-element-in-scope title=&quot;has an element in scope&quot;&gt;have &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; in scope&lt;/a&gt;, then
+     this is a &lt;a href=#parse-error&gt;parse error&lt;/a&gt;; abort these steps and ignore the token.&lt;/li&gt;
 
-    &lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=#generate-implied-end-tags&gt;Generate implied end tags&lt;/a&gt;.&lt;/li&gt;
+     &lt;li&gt;&lt;p&gt;&lt;a href=#generate-implied-end-tags&gt;Generate implied end tags&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-node&gt;current node&lt;/a&gt; is not &lt;var title=&quot;&quot;&gt;node&lt;/var&gt;, then this is a
      &lt;a href=#parse-error&gt;parse error&lt;/a&gt;.&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;Remove &lt;var title=&quot;&quot;&gt;node&lt;/var&gt; from the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;.&lt;/li&gt;
 
+    &lt;/ol&gt;&lt;p&gt;If there &lt;em&gt;is&lt;/em&gt; a &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open
+    elements&lt;/a&gt;, then run these substeps instead:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;If the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; does not &lt;a href=#has-an-element-in-scope title=&quot;has an element in
+     scope&quot;&gt;have a &lt;code&gt;form&lt;/code&gt; element in scope&lt;/a&gt;, then this is a &lt;a href=#parse-error&gt;parse
+     error&lt;/a&gt;; abort these steps and ignore the token.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;a href=#generate-implied-end-tags&gt;Generate implied end tags&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;a href=#current-node&gt;current node&lt;/a&gt; is not a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element, then this is a
+     &lt;a href=#parse-error&gt;parse error&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Pop elements from the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; until a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt;
+     element has been popped from the stack.&lt;/li&gt;
+
     &lt;/ol&gt;&lt;/dd&gt;
 
    &lt;!-- as normal, except &lt;/p&gt; implies &lt;p&gt; if there's no &lt;p&gt; in scope, and needs care as the elements have optional tags --&gt;
@@ -89893,7 +89913,8 @@
 
     &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, then ignore the
+    &lt;p&gt;If there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt; and
+    the &lt;a href=#form-element-pointer&gt;&lt;code title=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, then ignore the
     token.&lt;/p&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -89909,7 +89930,8 @@
     &lt;code&gt;p&lt;/code&gt; element in button scope&lt;/a&gt;, then &lt;a href=#close-a-p-element&gt;close a &lt;code&gt;p&lt;/code&gt;
     element&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;a href=#insert-an-html-element&gt;Insert an HTML element&lt;/a&gt; for a &quot;form&quot; start tag token with no attributes, and set
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;&lt;a href=#insert-an-html-element&gt;Insert an HTML element&lt;/a&gt; for a &quot;form&quot; start tag token with no attributes, and, if there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, set
     the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to point to the element
     created.&lt;/p&gt;
 
@@ -89947,7 +89969,8 @@
 
     &lt;!-- fake &lt;/form&gt; --&gt;
     &lt;p&gt;Pop the &lt;a href=#current-node&gt;current node&lt;/a&gt; (which will be the &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element created
-    earlier) off the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;. Set the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to null.&lt;/p&gt;
+    earlier) off the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, and, if there is no &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt;
+    element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, set the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; back to null.&lt;/p&gt;
 
     &lt;!-- explanation of text --&gt;
     &lt;p&gt;&lt;dfn id=attr-isindex-prompt title=attr-isindex-prompt&gt;&lt;strong&gt;Prompt&lt;/strong&gt;&lt;/dfn&gt;: If the token has an attribute
@@ -90660,8 +90683,9 @@
 
     &lt;p&gt;&lt;a href=#parse-error&gt;Parse error&lt;/a&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, ignore the
-    token.&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element on the &lt;a href=#stack-of-open-elements&gt;stack of open elements&lt;/a&gt;, or if
+    the &lt;a href=#form-element-pointer&gt;&lt;code title=form&gt;form&lt;/code&gt; element pointer&lt;/a&gt; is not null, ignore the
+    token.&lt;/p&gt; &lt;!-- in a &lt;template&gt;, the &lt;form&gt; would have no effect and thus be a waste of time... --&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
 
@@ -92848,10 +92872,13 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;Set the parser's &lt;a href=#form-element-pointer&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to the nearest node to the
-      &lt;var title=concept-frag-parse-context&gt;&lt;a href=#concept-frag-parse-context&gt;context&lt;/a&gt;&lt;/var&gt; element that is a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt;
-      element (going straight up the ancestor chain, and including the element itself, if it is a
-      &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element), or, if there is no such &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element, to null.&lt;/p&gt;
+      &lt;p&gt;If neither the &lt;var title=concept-frag-parse-context&gt;&lt;a href=#concept-frag-parse-context&gt;context&lt;/a&gt;&lt;/var&gt; element nor any of
+      its ancestors are &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; elements, then set the parser's
+      &lt;a href=#form-element-pointer&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/a&gt; to the nearest node to the &lt;var title=concept-frag-parse-context&gt;&lt;a href=#concept-frag-parse-context&gt;context&lt;/a&gt;&lt;/var&gt; element that is a &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element
+      (going straight up the ancestor chain, and including the element itself, if it is a
+      &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element), if any. (If there is no such &lt;code&gt;&lt;a href=#the-form-element&gt;form&lt;/a&gt;&lt;/code&gt; element, or if
+      there's a &lt;code&gt;&lt;a href=#the-template-element&gt;template&lt;/a&gt;&lt;/code&gt; element in the ancestor chain, the &lt;a href=#form-element-pointer&gt;&lt;code&gt;form&lt;/code&gt;
+      element pointer&lt;/a&gt; keeps its initial value, null.)&lt;/p&gt;
 
      &lt;/li&gt;
 

Modified: source
===================================================================
--- source	2013-12-03 22:58:15 UTC (rev 8330)
+++ source	2013-12-04 19:02:24 UTC (rev 8331)
@@ -95739,7 +95739,7 @@
   &lt;p&gt;The &lt;span&gt;&lt;code data-x=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; points to the last
   &lt;code&gt;form&lt;/code&gt; element that was opened and whose end tag has not yet been seen. It is used to
   make form controls associate with forms in the face of dramatically bad markup, for historical
-  reasons.&lt;/p&gt;
+  reasons. It is ignored inside &lt;code&gt;template&lt;/code&gt; elements.&lt;/p&gt;
 
 
   &lt;h5&gt;Other parsing state flags&lt;/h5&gt;
@@ -99581,7 +99581,8 @@
    &lt;dt&gt;A start tag whose tag name is &quot;form&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;If the &lt;span&gt;&lt;code data-x=&quot;form&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; is not null, then this is
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;If the &lt;span&gt;&lt;code data-x=&quot;form&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; is not null, and there is no &lt;code&gt;template&lt;/code&gt; element on the &lt;span&gt;stack of open elements&lt;/span&gt;, then this is
     a &lt;span&gt;parse error&lt;/span&gt;; ignore the token.&lt;/p&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -99590,7 +99591,8 @@
     &lt;code&gt;p&lt;/code&gt; element in button scope&lt;/span&gt;, then &lt;span&gt;close a &lt;code&gt;p&lt;/code&gt;
     element&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token, and set the &lt;span&gt;&lt;code
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for the token, and, if there is no &lt;code&gt;template&lt;/code&gt; element on the &lt;span&gt;stack of open elements&lt;/span&gt;, set the &lt;span&gt;&lt;code
     data-x=&quot;form&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; to point to the element created.&lt;/p&gt;
 
    &lt;/dd&gt;
@@ -99823,18 +99825,20 @@
    &lt;dt&gt;An end tag whose tag name is &quot;form&quot;&lt;/dt&gt;
    &lt;dd&gt;
 
-    &lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;node&lt;/var&gt; be the element that the &lt;span&gt;&lt;code data-x=&quot;&quot;&gt;form&lt;/code&gt; element
-    pointer&lt;/span&gt; is set to.&lt;/p&gt;
+    &lt;p&gt;If there is no &lt;code&gt;template&lt;/code&gt; element on the &lt;span&gt;stack of open elements&lt;/span&gt;, then
+    run these substeps:&lt;/p&gt;
 
-    &lt;p&gt;Set the &lt;span&gt;&lt;code data-x=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; to null.&lt;/p&gt;
+    &lt;ol&gt;
 
-    &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;node&lt;/var&gt; is null or the &lt;span&gt;stack of open elements&lt;/span&gt; does not &lt;span
-    data-x=&quot;has an element in scope&quot;&gt;have &lt;var data-x=&quot;&quot;&gt;node&lt;/var&gt; in scope&lt;/span&gt;, then this is a
-    &lt;span&gt;parse error&lt;/span&gt;; ignore the token.&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;node&lt;/var&gt; be the element that the &lt;span&gt;&lt;code data-x=&quot;&quot;&gt;form&lt;/code&gt;
+     element pointer&lt;/span&gt; is set to, or null if it is not set to an element.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;p&gt;Otherwise, run these steps:&lt;/p&gt;
+     &lt;li&gt;&lt;p&gt;Set the &lt;span&gt;&lt;code data-x=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; to null. Otherwise, let
+     &lt;var data-x=&quot;&quot;&gt;node&lt;/var&gt; be null.&lt;/p&gt;&lt;/li&gt;
 
-    &lt;ol&gt;
+     &lt;li&gt;&lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;node&lt;/var&gt; is null or if the &lt;span&gt;stack of open elements&lt;/span&gt; does
+     not &lt;span data-x=&quot;has an element in scope&quot;&gt;have &lt;var data-x=&quot;&quot;&gt;node&lt;/var&gt; in scope&lt;/span&gt;, then
+     this is a &lt;span&gt;parse error&lt;/span&gt;; abort these steps and ignore the token.&lt;/p&gt;&lt;/li&gt;
 
      &lt;li&gt;&lt;p&gt;&lt;span&gt;Generate implied end tags&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 
@@ -99845,6 +99849,25 @@
 
     &lt;/ol&gt;
 
+    &lt;p&gt;If there &lt;em&gt;is&lt;/em&gt; a &lt;code&gt;template&lt;/code&gt; element on the &lt;span&gt;stack of open
+    elements&lt;/span&gt;, then run these substeps instead:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;span&gt;stack of open elements&lt;/span&gt; does not &lt;span data-x=&quot;has an element in
+     scope&quot;&gt;have a &lt;code&gt;form&lt;/code&gt; element in scope&lt;/span&gt;, then this is a &lt;span&gt;parse
+     error&lt;/span&gt;; abort these steps and ignore the token.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;&lt;span&gt;Generate implied end tags&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If the &lt;span&gt;current node&lt;/span&gt; is not a &lt;code&gt;form&lt;/code&gt; element, then this is a
+     &lt;span&gt;parse error&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Pop elements from the &lt;span&gt;stack of open elements&lt;/span&gt; until a &lt;code&gt;form&lt;/code&gt;
+     element has been popped from the stack.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
    &lt;/dd&gt;
 
    &lt;!-- as normal, except &lt;/p&gt; implies &lt;p&gt; if there's no &lt;p&gt; in scope, and needs care as the elements have optional tags --&gt;
@@ -100158,7 +100181,8 @@
 
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;span&gt;&lt;code data-x=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; is not null, then ignore the
+    &lt;p&gt;If there is no &lt;code&gt;template&lt;/code&gt; element on the &lt;span&gt;stack of open elements&lt;/span&gt; and
+    the &lt;span&gt;&lt;code data-x=&quot;&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; is not null, then ignore the
     token.&lt;/p&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
@@ -100174,7 +100198,8 @@
     &lt;code&gt;p&lt;/code&gt; element in button scope&lt;/span&gt;, then &lt;span&gt;close a &lt;code&gt;p&lt;/code&gt;
     element&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for a &quot;form&quot; start tag token with no attributes, and set
+&lt;!--CLEANUP--&gt;
+    &lt;p&gt;&lt;span&gt;Insert an HTML element&lt;/span&gt; for a &quot;form&quot; start tag token with no attributes, and, if there is no &lt;code&gt;template&lt;/code&gt; element on the &lt;span&gt;stack of open elements&lt;/span&gt;, set
     the &lt;span&gt;&lt;code data-x=&quot;form&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; to point to the element
     created.&lt;/p&gt;
 
@@ -100217,8 +100242,9 @@
 
     &lt;!-- fake &lt;/form&gt; --&gt;
     &lt;p&gt;Pop the &lt;span&gt;current node&lt;/span&gt; (which will be the &lt;code&gt;form&lt;/code&gt; element created
-    earlier) off the &lt;span&gt;stack of open elements&lt;/span&gt;. Set the &lt;span&gt;&lt;code
-    data-x=&quot;form&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; to null.&lt;/p&gt;
+    earlier) off the &lt;span&gt;stack of open elements&lt;/span&gt;, and, if there is no &lt;code&gt;template&lt;/code&gt;
+    element on the &lt;span&gt;stack of open elements&lt;/span&gt;, set the &lt;span&gt;&lt;code
+    data-x=&quot;form&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; back to null.&lt;/p&gt;
 
     &lt;!-- explanation of text --&gt;
     &lt;p&gt;&lt;dfn data-x=&quot;attr-isindex-prompt&quot;&gt;&lt;strong&gt;Prompt&lt;/strong&gt;&lt;/dfn&gt;: If the token has an attribute
@@ -100997,8 +101023,9 @@
 
     &lt;p&gt;&lt;span&gt;Parse error&lt;/span&gt;.&lt;/p&gt;
 
-    &lt;p&gt;If the &lt;span&gt;&lt;code data-x=&quot;form&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; is not null, ignore the
-    token.&lt;/p&gt;
+    &lt;p&gt;If there is a &lt;code&gt;template&lt;/code&gt; element on the &lt;span&gt;stack of open elements&lt;/span&gt;, or if
+    the &lt;span&gt;&lt;code data-x=&quot;form&quot;&gt;form&lt;/code&gt; element pointer&lt;/span&gt; is not null, ignore the
+    token.&lt;/p&gt; &lt;!-- in a &lt;template&gt;, the &lt;form&gt; would have no effect and thus be a waste of time... --&gt;
 
     &lt;p&gt;Otherwise:&lt;/p&gt;
 
@@ -103429,10 +103456,14 @@
 
      &lt;li&gt;
 
-      &lt;p&gt;Set the parser's &lt;span&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/span&gt; to the nearest node to the
-      &lt;var data-x=&quot;concept-frag-parse-context&quot;&gt;context&lt;/var&gt; element that is a &lt;code&gt;form&lt;/code&gt;
-      element (going straight up the ancestor chain, and including the element itself, if it is a
-      &lt;code&gt;form&lt;/code&gt; element), or, if there is no such &lt;code&gt;form&lt;/code&gt; element, to null.&lt;/p&gt;
+      &lt;p&gt;If neither the &lt;var data-x=&quot;concept-frag-parse-context&quot;&gt;context&lt;/var&gt; element nor any of
+      its ancestors are &lt;code&gt;template&lt;/code&gt; elements, then set the parser's
+      &lt;span&gt;&lt;code&gt;form&lt;/code&gt; element pointer&lt;/span&gt; to the nearest node to the &lt;var
+      data-x=&quot;concept-frag-parse-context&quot;&gt;context&lt;/var&gt; element that is a &lt;code&gt;form&lt;/code&gt; element
+      (going straight up the ancestor chain, and including the element itself, if it is a
+      &lt;code&gt;form&lt;/code&gt; element), if any. (If there is no such &lt;code&gt;form&lt;/code&gt; element, or if
+      there's a &lt;code&gt;template&lt;/code&gt; element in the ancestor chain, the &lt;span&gt;&lt;code&gt;form&lt;/code&gt;
+      element pointer&lt;/span&gt; keeps its initial value, null.)&lt;/p&gt;
 
      &lt;/li&gt;
 


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015185.html">[html5] r8330 - [e] (0) Allow workers that become suspendable but	still have outstanding work to [...]
</A></li>
	<LI>Next message: <A HREF="015188.html">[html5] r8332 - [e] (0) Clarify bidi CSS rules interaction Affected	topics: Rendering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15186">[ date ]</a>
              <a href="thread.html#15186">[ thread ]</a>
              <a href="subject.html#15186">[ subject ]</a>
              <a href="author.html#15186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
