<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [html5] r8303 - [giow] (3) Move the event handler content attribute	compiling logic to later in [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r8303%20-%20%5Bgiow%5D%20%283%29%20Move%20the%20event%20handler%20content%20attribute%0A%09compiling%20logic%20to%20later%20in%20%5B...%5D&In-Reply-To=%3C20131120210926.B16EF1536CF8E%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015157.html">
   <LINK REL="Next"  HREF="015159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[html5] r8303 - [giow] (3) Move the event handler content attribute	compiling logic to later in [...]</H1>
<!--htdig_noindex-->
    <B>whatwg at whatwg.org</B> 
    <A HREF="mailto:commit-watchers%40lists.whatwg.org?Subject=Re%3A%20%5Bhtml5%5D%20r8303%20-%20%5Bgiow%5D%20%283%29%20Move%20the%20event%20handler%20content%20attribute%0A%09compiling%20logic%20to%20later%20in%20%5B...%5D&In-Reply-To=%3C20131120210926.B16EF1536CF8E%40ps20323.dreamhostps.com%3E"
       TITLE="[html5] r8303 - [giow] (3) Move the event handler content attribute	compiling logic to later in [...]">whatwg at whatwg.org
       </A><BR>
    <I>Wed Nov 20 13:09:26 PST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="015157.html">[html5] r8302 - [giow] (1) Kill History objects on non-active docs	Fixing https://www.w3.org/Bug [...]
</A></li>
        <LI>Next message: <A HREF="015159.html">[html5] r8304 - [e] (0) Fix up the attribute annotations a bit	Fixing https://www.w3.org/Bugs/Pu [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15158">[ date ]</a>
              <a href="thread.html#15158">[ thread ]</a>
              <a href="subject.html#15158">[ subject ]</a>
              <a href="author.html#15158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Author: ianh
Date: 2013-11-20 13:09:24 -0800 (Wed, 20 Nov 2013)
New Revision: 8303

Modified:
   complete.html
   index
   source
Log:
[giow] (3) Move the event handler content attribute compiling logic to later in the pipeline, for better consistency with Firefox/Safari (and other browsers, though to a lesser extent).
Fixing <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=23836">https://www.w3.org/Bugs/Public/show_bug.cgi?id=23836</A>
Affected topics: DOM APIs

Modified: complete.html
===================================================================
--- complete.html	2013-11-19 23:20:29 UTC (rev 8302)
+++ complete.html	2013-11-20 21:09:24 UTC (rev 8303)
@@ -298,7 +298,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> class=logo&gt;&lt;img width=101 src=/images/logo alt=WHATWG height=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 19 November 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 20 November 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -70994,9 +70994,10 @@
   &lt;p&gt;An &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; has a name, which always starts with
   &quot;&lt;code title=&quot;&quot;&gt;on&lt;/code&gt;&quot; and is followed by the name of the event for which it is intended.&lt;/p&gt;
 
-  &lt;p&gt;An &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; can either have the value null or be set
-  to a callback object. This is defined using the &lt;code&gt;&lt;a href=#eventhandler&gt;EventHandler&lt;/a&gt;&lt;/code&gt; callback function type.
-  &lt;span class=impl&gt;Initially, event handlers must be set to null.&lt;/span&gt;&lt;/p&gt;
+  &lt;p&gt;An &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; can either have the value null, or be set
+  to a callback object&lt;span class=impl&gt;, or be set to an &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw uncompiled
+  handler&lt;/a&gt;&lt;/span&gt;. The &lt;code&gt;&lt;a href=#eventhandler&gt;EventHandler&lt;/a&gt;&lt;/code&gt; callback function type describes how this is
+  exposed to scripts. &lt;span class=impl&gt;Initially, event handlers must be set to null.&lt;/span&gt;&lt;/p&gt;
 
   &lt;p&gt;Event handlers are exposed in one of two ways.&lt;/p&gt;
 
@@ -71013,9 +71014,9 @@
   attribute for a specific &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt;. The name of the IDL
   attribute is the same as the name of the &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;p&gt;&lt;a href=#event-handler-idl-attributes&gt;Event handler IDL attributes&lt;/a&gt;, on setting, must set the corresponding event handler
-  to their new value, and on getting, must return whatever the current value of the corresponding
-  event handler is (possibly null).&lt;/p&gt;
+  &lt;p&gt;&lt;a href=#event-handler-idl-attributes&gt;Event handler IDL attributes&lt;/a&gt;, on setting, must set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to their new value, and on getting, must return the
+  result of &lt;a href=#getting-the-current-value-of-the-event-handler&gt;getting the current value of the event handler&lt;/a&gt; in question (this can throw
+  an exception, in which case the getting propagates it to the caller, it does not catch it).&lt;/p&gt;
 
   &lt;p&gt;If an &lt;a href=#event-handler-idl-attributes title=&quot;event handler IDL attributes&quot;&gt;event handler IDL attribute&lt;/a&gt; exposes an
   &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; of an object that doesn't exist, it must always
@@ -71029,11 +71030,6 @@
   the &lt;code title=handler-MessagePort-onmessage&gt;&lt;a href=#handler-messageport-onmessage&gt;onmessage&lt;/a&gt;&lt;/code&gt; attribute of
   &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects.&lt;/p&gt;
 
-  &lt;p&gt;On getting, &lt;a href=#event-handler-idl-attributes&gt;event handler IDL attributes&lt;/a&gt; must return the value of their
-  corresponding &lt;a href=#event-handlers&gt;event handlers&lt;/a&gt;, except when the value is an &lt;a href=#concept-handler-error title=concept-handler-error&gt;internal error value&lt;/a&gt;, in which case the user agent must set
-  the corresponding event handler to null, and then throw an exception corresponding to the error
-  condition.&lt;/p&gt;
-
   &lt;hr&gt;&lt;/div&gt;
 
   &lt;p&gt;An &lt;dfn id=event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event handler content attribute&lt;/dfn&gt; is a
@@ -71047,129 +71043,13 @@
 
   &lt;div class=impl&gt;
 
-  &lt;!-- SCRIPT EXEC --&gt;
   &lt;p&gt;When an &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event handler content attribute&lt;/a&gt;
   is set, if the element is owned by a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that is in a &lt;a href=#browsing-context&gt;browsing
   context&lt;/a&gt;, and &lt;a href=#concept-bc-script title=concept-bc-script&gt;scripting is enabled&lt;/a&gt; for that
-  &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, the user agent must run the following steps to create a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; after setting the content attribute to its new value:&lt;/p&gt;
+  &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, the user agent must set the corresponding &lt;a href=#event-handlers title=&quot;event
+  handlers&quot;&gt;event handler&lt;/a&gt; to an &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw uncompiled handler&lt;/a&gt; consisting of
+  the attribute's new value and the script location where the attribute was set to this value&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to null.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt; be the &lt;a href=#script-settings-object&gt;script settings object&lt;/a&gt; of the
-   &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object associated with the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to which belongs the
-   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the element in question.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Obtain the &lt;a href=#script-execution-environment&gt;script execution environment&lt;/a&gt; for JavaScript from &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event
-   handler content attribute&lt;/a&gt;'s new value.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects an
-    &lt;i&gt;early error&lt;/i&gt; then &lt;a href=#set-the-event-handler-content-attribute-to-an-error&gt;set the event handler content attribute to an error&lt;/a&gt; as
-    defined below, and abort these steps.&lt;/p&gt;
-
-    &lt;p class=note&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript edition 5 section 13 Function
-    Definition. &lt;i&gt;Early error&lt;/i&gt; is defined in ECMAScript edition 5 section 16 Errors. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; begins with a Directive Prologue that contains a Use Strict
-    Directive then let &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; be true, otherwise let &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt;
-    be false.&lt;/p&gt; &lt;!-- we can't defer to 10.1.1 since we're not using a Function constructor but
-    doing it ourselves. --&gt;
-
-    &lt;p class=note&gt;The terms &quot;Directive Prologue&quot; and &quot;Use Strict Directive&quot; are defined in
-    ECMAScript edition 5 section 14.1 Directive Prologues and the Use Strict Directive. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-&lt;!--
-currently this is unnecessary: <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4">http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4</A>
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is a
-    &lt;code&gt;SyntaxError&lt;/code&gt; according to the Strict Mode Restrictions, then &lt;span&gt;set the event
-    handler content attribute to an error&lt;/span&gt; as defined below, and abort these steps.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in ECMAScript edition 5 section
-    13.1 Strict Mode Restrictions. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
-&lt;!--CLEANUP--&gt;
-    &lt;p&gt;Using the &lt;a href=#script-execution-environment&gt;script execution environment&lt;/a&gt; obtained above, create a function object (as defined in
-    ECMAScript edition 5 section 13.2 Creating Function Objects), with:&lt;/p&gt;
-
-    &lt;dl&gt;&lt;dt&gt;Parameter list &lt;var title=&quot;&quot;&gt;FormalParameterList&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;dl class=switch&gt;&lt;dt&gt;If the attribute is an &lt;code title=handler-onerror&gt;&lt;a href=#handler-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; content attribute
-       corresponding to an &lt;span&gt;event handler&lt;/span&gt; of a &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object (that is, the
-       &lt;code title=handler-onerror&gt;&lt;a href=#handler-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; content attributes on &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; and
-       &lt;code&gt;&lt;a href=#frameset&gt;frameset&lt;/a&gt;&lt;/code&gt; elements)&lt;/dt&gt;
-
-       &lt;dd&gt;Let the function have five arguments, named &lt;code title=&quot;&quot;&gt;event&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;source&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;lineno&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;colno&lt;/code&gt;,
-       and &lt;code title=&quot;&quot;&gt;error&lt;/code&gt;.&lt;/dd&gt;
-       &lt;!-- /colno/ is new as of 2012; see <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319">https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319</A> and 22800 --&gt;
-       &lt;!-- /error/ is new as of 2013; see <A HREF="http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html">http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html</A> --&gt;
-
-       &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-       &lt;dd&gt;Let the function have a single argument called &lt;code title=&quot;&quot;&gt;event&lt;/code&gt;.&lt;/dd&gt;
-
-      &lt;/dl&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;Function body &lt;var title=&quot;&quot;&gt;FunctionBody&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The result of parsing &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; above.&lt;/dd&gt;
-
-     &lt;dt&gt;Lexical Environment &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;&lt;li&gt;Let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(the element's
-       &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, the &lt;var title=&quot;&quot;&gt;global environment&lt;/var&gt;).&lt;/li&gt;
-
-       &lt;li&gt;If the element has a &lt;a href=#form-owner&gt;form owner&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the result
-       of NewObjectEnvironment(the element's &lt;a href=#form-owner&gt;form owner&lt;/a&gt;, &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
-
-       &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(the element's object,
-       &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
-
-      &lt;/ol&gt;&lt;p class=note&gt;NewObjectEnvironment() is defined in ECMAScript edition 5 section 10.2.2.3
-      NewObjectEnvironment (O, E). &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Boolean flag &lt;var title=&quot;&quot;&gt;Strict&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The value of &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt;.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;!--CLEANUP--&gt;&lt;p&gt;Let this new function be a new &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;a href=#code-entry-point&gt;code entry-point&lt;/a&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let that &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;a href=#settings-object&gt;settings object&lt;/a&gt; be
-   &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to the
-   aforementioned function.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;When a user agent is required, by the steps above, to &lt;dfn id=set-the-event-handler-content-attribute-to-an-error&gt;set the event handler content
-  attribute to an error&lt;/dfn&gt;, the user agent must set the corresponding &lt;a href=#event-handlers title=&quot;event
-  handlers&quot;&gt;event handler&lt;/a&gt; to an &lt;dfn id=concept-handler-error title=concept-handler-error&gt;internal error value&lt;/dfn&gt;
-  representing the error condition, keeping track of the &lt;a href=#url&gt;URL&lt;/a&gt; of the resource where the
-  &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event handler content attribute&lt;/a&gt; was set, and
-  the relevant line number inside that resource where the error occurred.&lt;/p&gt;
-
   &lt;p&gt;When an event handler content attribute is removed, the user agent must set the corresponding
   &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to null.&lt;/p&gt;
   &lt;!--
@@ -71178,16 +71058,10 @@
   see <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=7626#c5">http://www.w3.org/Bugs/Public/show_bug.cgi?id=7626#c5</A> for reasoning
   --&gt;
 
-  &lt;/div&gt;
-
   &lt;p class=note&gt;When an &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event handler content
   attribute&lt;/a&gt; is set on an element owned by a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that is not in a
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, the corresponding event handler is not changed.&lt;/p&gt;
 
-  &lt;!-- v2: we should probably support HTML4's Content-Script-Type header here. --&gt;
-
-  &lt;div class=impl&gt;
-
   &lt;hr&gt;&lt;p&gt;When an &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; of an element
   or object &lt;var title=&quot;&quot;&gt;T&lt;/var&gt; implementing the &lt;code&gt;&lt;a href=#eventtarget&gt;EventTarget&lt;/a&gt;&lt;/code&gt; interface is first set
   to a non-null value, the user agent must append an &lt;a href=#concept-event-listener title=concept-event-listener&gt;event
@@ -71238,19 +71112,15 @@
   handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; and an &lt;code&gt;&lt;a href=#event&gt;Event&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;E&lt;/var&gt; is as
   follows:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is null, then abort these steps.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;a href=#concept-handler-error title=concept-handler-error&gt;internal error
-   value&lt;/a&gt;, then: set the &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to null and then
-   &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; for the appropriate &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; and
-   with the appropriate position (line number and column number), as established when the error was
-   detected, using the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of that &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; as the target. If
-   the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; after this, then the error
-   may be reported to the user. Finally, abort these steps.&lt;/li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; be the result of &lt;a href=#getting-the-current-value-of-the-event-handler&gt;getting the current value of the
+    event handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value, the callback that the
-   &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; was last set to.&lt;/li&gt;
+   &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; is null, then abort these steps.&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;Process the &lt;code&gt;&lt;a href=#event&gt;Event&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;E&lt;/var&gt; as follows:&lt;/p&gt;
@@ -71276,6 +71146,7 @@
 
      &lt;dd&gt;
 
+&lt;!--CLEANUP--&gt;
       &lt;p&gt;&lt;a href=#concept-invoke-event-handler title=concept-invoke-event-handler&gt;Invoke&lt;/a&gt; &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with one argument, the value of which is the
       &lt;code&gt;&lt;a href=#event&gt;Event&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;E&lt;/var&gt;, with the &lt;i title=dfn-callback-this-value&gt;callback this value&lt;/i&gt; set to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt;'s &lt;code title=dom-Event-currentTarget&gt;currentTarget&lt;/code&gt;. Let &lt;var title=&quot;&quot;&gt;return value&lt;/var&gt; be the callback's return value. &lt;a href=#refsWEBIDL&gt;[WEBIDL]&lt;/a&gt;&lt;/p&gt;
 
@@ -71366,7 +71237,159 @@
 
   &lt;!-- onreadystatechange is also defined specially, using [LenientThis]; see IDL --&gt;
 
+  &lt;div class=impl&gt;
 
+  &lt;hr&gt;&lt;p&gt;An &lt;dfn id=internal-raw-uncompiled-handler&gt;internal raw uncompiled handler&lt;/dfn&gt; is a tuple with the following information:&lt;/p&gt;
+
+  &lt;ul class=brief&gt;&lt;li&gt;An uncompiled script body
+
+   &lt;li&gt;A location where the script body originated, in case an error needs to be reported
+
+  &lt;/ul&gt;&lt;p&gt;When the user agent is to &lt;dfn id=getting-the-current-value-of-the-event-handler title=&quot;getting the current value of the event handler&quot;&gt;get the
+  current value of the event handler&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;, it must run these steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw uncompiled handler&lt;/a&gt;, run these
+    substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the uncompiled script body in the &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw
+     uncompiled handler&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; be the location where the script body originated, as
+     given by the &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw uncompiled handler&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; is an element's &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
+      handler&lt;/a&gt;, then let &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; be the element, and &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the element's &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; is a &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object's &lt;a href=#event-handlers title=&quot;event
+      handlers&quot;&gt;event handler&lt;/a&gt;: let &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; be null, and let &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; most recently associated with that
+      &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not null and &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; has a
+     &lt;a href=#form-owner&gt;form owner&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;form owner&lt;/var&gt; be that &lt;a href=#form-owner&gt;form owner&lt;/a&gt;.
+     Otherwise, let &lt;var title=&quot;&quot;&gt;form owner&lt;/var&gt; be null.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt; be the &lt;a href=#script-settings-object&gt;script settings object&lt;/a&gt;
+     created for the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object with which &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; is
+     currently associated.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Obtain the &lt;a href=#script-execution-environment&gt;script execution environment&lt;/a&gt; for JavaScript from &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/li&gt;
+     &lt;!-- v2: we could support HTML4's Content-Script-Type header here --&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects
+      an &lt;i&gt;early error&lt;/i&gt;, then follow these substeps:&lt;/p&gt;
+
+      &lt;ol&gt;&lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value to null.&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;&lt;a href=#report-the-error&gt;Report the error&lt;/a&gt; for the appropriate &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; and with the appropriate position (line number and
+       column number) given by &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;, using the &lt;a href=#global-object&gt;global object&lt;/a&gt;
+       specified by &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt; as the target. If the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; after this, then the error may be reported
+       to the user.&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;end&lt;/i&gt; below.&lt;/li&gt;
+
+      &lt;/ol&gt;&lt;p class=note&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript edition 5 section 13 Function
+      Definition. &lt;i&gt;Early error&lt;/i&gt; is defined in ECMAScript edition 5 section 16 Errors. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; begins with a Directive Prologue that contains a Use Strict
+      Directive then let &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; be true, otherwise let &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; be false.&lt;/p&gt; &lt;!-- we can't defer to 10.1.1 since we're not using a
+      Function constructor but doing it ourselves. --&gt;
+
+      &lt;p class=note&gt;The terms &quot;Directive Prologue&quot; and &quot;Use Strict Directive&quot; are defined in
+      ECMAScript edition 5 section 14.1 Directive Prologues and the Use Strict Directive. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+
+  &lt;!-- currently this is unnecessary: <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4">http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4</A>
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is a
+      &lt;code&gt;SyntaxError&lt;/code&gt; according to the Strict Mode Restrictions, then [...handle the error
+      as described above...].&lt;/p&gt;
+
+      &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in ECMAScript edition 5 section
+      13.1 Strict Mode Restrictions. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+  --&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Using the &lt;a href=#script-execution-environment&gt;script execution environment&lt;/a&gt; obtained above, create a function
+      object (as defined in ECMAScript edition 5 section 13.2 Creating Function Objects), with:&lt;/p&gt;
+
+      &lt;dl&gt;&lt;dt&gt;Parameter list &lt;var title=&quot;&quot;&gt;FormalParameterList&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;dl class=switch&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; is an &lt;code title=handler-onerror&gt;&lt;a href=#handler-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; of a &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object&lt;/dt&gt;
+
+         &lt;dd&gt;Let the function have five arguments, named &lt;code title=&quot;&quot;&gt;event&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;source&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;lineno&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;colno&lt;/code&gt;, and
+         &lt;code title=&quot;&quot;&gt;error&lt;/code&gt;.&lt;/dd&gt;
+
+         &lt;!-- /colno/ is new as of 2012; see <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319">https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319</A> and 22800 --&gt;
+         &lt;!-- /error/ is new as of 2013; see <A HREF="http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html">http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html</A> --&gt;
+
+         &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+         &lt;dd&gt;Let the function have a single argument called &lt;code title=&quot;&quot;&gt;event&lt;/code&gt;.&lt;/dd&gt;
+
+        &lt;/dl&gt;&lt;/dd&gt;
+
+       &lt;dt&gt;Function body &lt;var title=&quot;&quot;&gt;FunctionBody&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;The result of parsing &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; above.&lt;/dd&gt;
+
+       &lt;dt&gt;Lexical Environment &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;&lt;li&gt;Let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(&lt;var title=&quot;&quot;&gt;document&lt;/var&gt;, the &lt;var title=&quot;&quot;&gt;global environment&lt;/var&gt;).&lt;/li&gt;
+
+         &lt;li&gt;If &lt;var title=&quot;&quot;&gt;form owner&lt;/var&gt; is not null, let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the
+         result of NewObjectEnvironment(&lt;var title=&quot;&quot;&gt;&gt;form owner&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
+
+         &lt;li&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not null, let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the
+         result of NewObjectEnvironment(&lt;var title=&quot;&quot;&gt;element&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;p class=note&gt;NewObjectEnvironment() is defined in ECMAScript edition 5 section 10.2.2.3
+        NewObjectEnvironment (O, E). &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;Boolean flag &lt;var title=&quot;&quot;&gt;Strict&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;The value of &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt;.&lt;/dd&gt;
+
+      &lt;/dl&gt;&lt;!-- SCRIPT EXEC --&gt;&lt;p&gt;Let this new function be a new &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;a href=#code-entry-point&gt;code
+      entry-point&lt;/a&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let that &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;a href=#settings-object&gt;settings object&lt;/a&gt; be
+     &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; to the aforementioned function.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;/div&gt;
+
+
+
   &lt;h5 id=event-handlers-on-elements,-document-objects,-and-window-objects&gt;&lt;span class=secno&gt;7.1.5.2 &lt;/span&gt;Event handlers on elements, &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects, and &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; objects&lt;/h5&gt;
 
   &lt;p&gt;The following are the &lt;a href=#event-handlers&gt;event handlers&lt;/a&gt; (and their corresponding &lt;a href=#event-handler-event-type title=&quot;event

Modified: index
===================================================================
--- index	2013-11-19 23:20:29 UTC (rev 8302)
+++ index	2013-11-20 21:09:24 UTC (rev 8303)
@@ -298,7 +298,7 @@
 
   &lt;header class=head id=head&gt;&lt;p&gt;&lt;a href=<A HREF="http://www.whatwg.org/">http://www.whatwg.org/</A> class=logo&gt;&lt;img width=101 src=/images/logo alt=WHATWG height=101&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;hgroup&gt;&lt;h1 class=allcaps&gt;HTML&lt;/h1&gt;
-    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 19 November 2013&lt;/h2&gt;
+    &lt;h2 class=&quot;no-num no-toc&quot;&gt;Living Standard &mdash; Last Updated 20 November 2013&lt;/h2&gt;
    &lt;/hgroup&gt;&lt;dl&gt;&lt;dt&gt;&lt;strong&gt;Web developer edition:&lt;/strong&gt;&lt;/dt&gt;
     &lt;dd&gt;&lt;strong&gt;&lt;a href=<A HREF="http://developers.whatwg.org/">http://developers.whatwg.org/</A>&gt;<A HREF="http://developers.whatwg.org/&lt;/a">http://developers.whatwg.org/&lt;/a</A>&gt;&lt;/strong&gt;&lt;/dd&gt;
     &lt;dt&gt;Multiple-page version:&lt;/dt&gt;
@@ -70994,9 +70994,10 @@
   &lt;p&gt;An &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; has a name, which always starts with
   &quot;&lt;code title=&quot;&quot;&gt;on&lt;/code&gt;&quot; and is followed by the name of the event for which it is intended.&lt;/p&gt;
 
-  &lt;p&gt;An &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; can either have the value null or be set
-  to a callback object. This is defined using the &lt;code&gt;&lt;a href=#eventhandler&gt;EventHandler&lt;/a&gt;&lt;/code&gt; callback function type.
-  &lt;span class=impl&gt;Initially, event handlers must be set to null.&lt;/span&gt;&lt;/p&gt;
+  &lt;p&gt;An &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; can either have the value null, or be set
+  to a callback object&lt;span class=impl&gt;, or be set to an &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw uncompiled
+  handler&lt;/a&gt;&lt;/span&gt;. The &lt;code&gt;&lt;a href=#eventhandler&gt;EventHandler&lt;/a&gt;&lt;/code&gt; callback function type describes how this is
+  exposed to scripts. &lt;span class=impl&gt;Initially, event handlers must be set to null.&lt;/span&gt;&lt;/p&gt;
 
   &lt;p&gt;Event handlers are exposed in one of two ways.&lt;/p&gt;
 
@@ -71013,9 +71014,9 @@
   attribute for a specific &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt;. The name of the IDL
   attribute is the same as the name of the &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt;.&lt;/p&gt;
 
-  &lt;p&gt;&lt;a href=#event-handler-idl-attributes&gt;Event handler IDL attributes&lt;/a&gt;, on setting, must set the corresponding event handler
-  to their new value, and on getting, must return whatever the current value of the corresponding
-  event handler is (possibly null).&lt;/p&gt;
+  &lt;p&gt;&lt;a href=#event-handler-idl-attributes&gt;Event handler IDL attributes&lt;/a&gt;, on setting, must set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to their new value, and on getting, must return the
+  result of &lt;a href=#getting-the-current-value-of-the-event-handler&gt;getting the current value of the event handler&lt;/a&gt; in question (this can throw
+  an exception, in which case the getting propagates it to the caller, it does not catch it).&lt;/p&gt;
 
   &lt;p&gt;If an &lt;a href=#event-handler-idl-attributes title=&quot;event handler IDL attributes&quot;&gt;event handler IDL attribute&lt;/a&gt; exposes an
   &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; of an object that doesn't exist, it must always
@@ -71029,11 +71030,6 @@
   the &lt;code title=handler-MessagePort-onmessage&gt;&lt;a href=#handler-messageport-onmessage&gt;onmessage&lt;/a&gt;&lt;/code&gt; attribute of
   &lt;code&gt;&lt;a href=#messageport&gt;MessagePort&lt;/a&gt;&lt;/code&gt; objects.&lt;/p&gt;
 
-  &lt;p&gt;On getting, &lt;a href=#event-handler-idl-attributes&gt;event handler IDL attributes&lt;/a&gt; must return the value of their
-  corresponding &lt;a href=#event-handlers&gt;event handlers&lt;/a&gt;, except when the value is an &lt;a href=#concept-handler-error title=concept-handler-error&gt;internal error value&lt;/a&gt;, in which case the user agent must set
-  the corresponding event handler to null, and then throw an exception corresponding to the error
-  condition.&lt;/p&gt;
-
   &lt;hr&gt;&lt;/div&gt;
 
   &lt;p&gt;An &lt;dfn id=event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event handler content attribute&lt;/dfn&gt; is a
@@ -71047,129 +71043,13 @@
 
   &lt;div class=impl&gt;
 
-  &lt;!-- SCRIPT EXEC --&gt;
   &lt;p&gt;When an &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event handler content attribute&lt;/a&gt;
   is set, if the element is owned by a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that is in a &lt;a href=#browsing-context&gt;browsing
   context&lt;/a&gt;, and &lt;a href=#concept-bc-script title=concept-bc-script&gt;scripting is enabled&lt;/a&gt; for that
-  &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, the user agent must run the following steps to create a &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; after setting the content attribute to its new value:&lt;/p&gt;
+  &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, the user agent must set the corresponding &lt;a href=#event-handlers title=&quot;event
+  handlers&quot;&gt;event handler&lt;/a&gt; to an &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw uncompiled handler&lt;/a&gt; consisting of
+  the attribute's new value and the script location where the attribute was set to this value&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;Set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to null.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt; be the &lt;a href=#script-settings-object&gt;script settings object&lt;/a&gt; of the
-   &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object associated with the &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt; to which belongs the
-   &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; of the element in question.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Obtain the &lt;a href=#script-execution-environment&gt;script execution environment&lt;/a&gt; for JavaScript from &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event
-   handler content attribute&lt;/a&gt;'s new value.&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects an
-    &lt;i&gt;early error&lt;/i&gt; then &lt;a href=#set-the-event-handler-content-attribute-to-an-error&gt;set the event handler content attribute to an error&lt;/a&gt; as
-    defined below, and abort these steps.&lt;/p&gt;
-
-    &lt;p class=note&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript edition 5 section 13 Function
-    Definition. &lt;i&gt;Early error&lt;/i&gt; is defined in ECMAScript edition 5 section 16 Errors. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; begins with a Directive Prologue that contains a Use Strict
-    Directive then let &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; be true, otherwise let &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt;
-    be false.&lt;/p&gt; &lt;!-- we can't defer to 10.1.1 since we're not using a Function constructor but
-    doing it ourselves. --&gt;
-
-    &lt;p class=note&gt;The terms &quot;Directive Prologue&quot; and &quot;Use Strict Directive&quot; are defined in
-    ECMAScript edition 5 section 14.1 Directive Prologues and the Use Strict Directive. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-&lt;!--
-currently this is unnecessary: <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4">http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4</A>
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is a
-    &lt;code&gt;SyntaxError&lt;/code&gt; according to the Strict Mode Restrictions, then &lt;span&gt;set the event
-    handler content attribute to an error&lt;/span&gt; as defined below, and abort these steps.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in ECMAScript edition 5 section
-    13.1 Strict Mode Restrictions. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
-&lt;!--CLEANUP--&gt;
-    &lt;p&gt;Using the &lt;a href=#script-execution-environment&gt;script execution environment&lt;/a&gt; obtained above, create a function object (as defined in
-    ECMAScript edition 5 section 13.2 Creating Function Objects), with:&lt;/p&gt;
-
-    &lt;dl&gt;&lt;dt&gt;Parameter list &lt;var title=&quot;&quot;&gt;FormalParameterList&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;dl class=switch&gt;&lt;dt&gt;If the attribute is an &lt;code title=handler-onerror&gt;&lt;a href=#handler-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; content attribute
-       corresponding to an &lt;span&gt;event handler&lt;/span&gt; of a &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object (that is, the
-       &lt;code title=handler-onerror&gt;&lt;a href=#handler-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; content attributes on &lt;code&gt;&lt;a href=#the-body-element&gt;body&lt;/a&gt;&lt;/code&gt; and
-       &lt;code&gt;&lt;a href=#frameset&gt;frameset&lt;/a&gt;&lt;/code&gt; elements)&lt;/dt&gt;
-
-       &lt;dd&gt;Let the function have five arguments, named &lt;code title=&quot;&quot;&gt;event&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;source&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;lineno&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;colno&lt;/code&gt;,
-       and &lt;code title=&quot;&quot;&gt;error&lt;/code&gt;.&lt;/dd&gt;
-       &lt;!-- /colno/ is new as of 2012; see <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319">https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319</A> and 22800 --&gt;
-       &lt;!-- /error/ is new as of 2013; see <A HREF="http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html">http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html</A> --&gt;
-
-       &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-       &lt;dd&gt;Let the function have a single argument called &lt;code title=&quot;&quot;&gt;event&lt;/code&gt;.&lt;/dd&gt;
-
-      &lt;/dl&gt;&lt;/dd&gt;
-
-     &lt;dt&gt;Function body &lt;var title=&quot;&quot;&gt;FunctionBody&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The result of parsing &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; above.&lt;/dd&gt;
-
-     &lt;dt&gt;Lexical Environment &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;&lt;li&gt;Let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(the element's
-       &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;, the &lt;var title=&quot;&quot;&gt;global environment&lt;/var&gt;).&lt;/li&gt;
-
-       &lt;li&gt;If the element has a &lt;a href=#form-owner&gt;form owner&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the result
-       of NewObjectEnvironment(the element's &lt;a href=#form-owner&gt;form owner&lt;/a&gt;, &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
-
-       &lt;li&gt;Let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(the element's object,
-       &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
-
-      &lt;/ol&gt;&lt;p class=note&gt;NewObjectEnvironment() is defined in ECMAScript edition 5 section 10.2.2.3
-      NewObjectEnvironment (O, E). &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Boolean flag &lt;var title=&quot;&quot;&gt;Strict&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The value of &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt;.&lt;/dd&gt;
-
-    &lt;/dl&gt;&lt;!--CLEANUP--&gt;&lt;p&gt;Let this new function be a new &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;a href=#code-entry-point&gt;code entry-point&lt;/a&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let that &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;a href=#settings-object&gt;settings object&lt;/a&gt; be
-   &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Set the corresponding &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to the
-   aforementioned function.&lt;/li&gt;
-
-  &lt;/ol&gt;&lt;p&gt;When a user agent is required, by the steps above, to &lt;dfn id=set-the-event-handler-content-attribute-to-an-error&gt;set the event handler content
-  attribute to an error&lt;/dfn&gt;, the user agent must set the corresponding &lt;a href=#event-handlers title=&quot;event
-  handlers&quot;&gt;event handler&lt;/a&gt; to an &lt;dfn id=concept-handler-error title=concept-handler-error&gt;internal error value&lt;/dfn&gt;
-  representing the error condition, keeping track of the &lt;a href=#url&gt;URL&lt;/a&gt; of the resource where the
-  &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event handler content attribute&lt;/a&gt; was set, and
-  the relevant line number inside that resource where the error occurred.&lt;/p&gt;
-
   &lt;p&gt;When an event handler content attribute is removed, the user agent must set the corresponding
   &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to null.&lt;/p&gt;
   &lt;!--
@@ -71178,16 +71058,10 @@
   see <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=7626#c5">http://www.w3.org/Bugs/Public/show_bug.cgi?id=7626#c5</A> for reasoning
   --&gt;
 
-  &lt;/div&gt;
-
   &lt;p class=note&gt;When an &lt;a href=#event-handler-content-attributes title=&quot;event handler content attributes&quot;&gt;event handler content
   attribute&lt;/a&gt; is set on an element owned by a &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; that is not in a
   &lt;a href=#browsing-context&gt;browsing context&lt;/a&gt;, the corresponding event handler is not changed.&lt;/p&gt;
 
-  &lt;!-- v2: we should probably support HTML4's Content-Script-Type header here. --&gt;
-
-  &lt;div class=impl&gt;
-
   &lt;hr&gt;&lt;p&gt;When an &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; of an element
   or object &lt;var title=&quot;&quot;&gt;T&lt;/var&gt; implementing the &lt;code&gt;&lt;a href=#eventtarget&gt;EventTarget&lt;/a&gt;&lt;/code&gt; interface is first set
   to a non-null value, the user agent must append an &lt;a href=#concept-event-listener title=concept-event-listener&gt;event
@@ -71238,19 +71112,15 @@
   handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; and an &lt;code&gt;&lt;a href=#event&gt;Event&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;E&lt;/var&gt; is as
   follows:&lt;/p&gt;
 
-  &lt;ol&gt;&lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is null, then abort these steps.&lt;/li&gt;
+  &lt;ol&gt;&lt;li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;a href=#concept-handler-error title=concept-handler-error&gt;internal error
-   value&lt;/a&gt;, then: set the &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; to null and then
-   &lt;a href=#report-the-error&gt;report the error&lt;/a&gt; for the appropriate &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; and
-   with the appropriate position (line number and column number), as established when the error was
-   detected, using the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object of that &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; as the target. If
-   the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; after this, then the error
-   may be reported to the user. Finally, abort these steps.&lt;/li&gt;
+    &lt;p&gt;Let &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; be the result of &lt;a href=#getting-the-current-value-of-the-event-handler&gt;getting the current value of the
+    event handler&lt;/a&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; be &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value, the callback that the
-   &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; was last set to.&lt;/li&gt;
+   &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; is null, then abort these steps.&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;Process the &lt;code&gt;&lt;a href=#event&gt;Event&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;E&lt;/var&gt; as follows:&lt;/p&gt;
@@ -71276,6 +71146,7 @@
 
      &lt;dd&gt;
 
+&lt;!--CLEANUP--&gt;
       &lt;p&gt;&lt;a href=#concept-invoke-event-handler title=concept-invoke-event-handler&gt;Invoke&lt;/a&gt; &lt;var title=&quot;&quot;&gt;callback&lt;/var&gt; with one argument, the value of which is the
       &lt;code&gt;&lt;a href=#event&gt;Event&lt;/a&gt;&lt;/code&gt; object &lt;var title=&quot;&quot;&gt;E&lt;/var&gt;, with the &lt;i title=dfn-callback-this-value&gt;callback this value&lt;/i&gt; set to &lt;var title=&quot;&quot;&gt;E&lt;/var&gt;'s &lt;code title=dom-Event-currentTarget&gt;currentTarget&lt;/code&gt;. Let &lt;var title=&quot;&quot;&gt;return value&lt;/var&gt; be the callback's return value. &lt;a href=#refsWEBIDL&gt;[WEBIDL]&lt;/a&gt;&lt;/p&gt;
 
@@ -71366,7 +71237,159 @@
 
   &lt;!-- onreadystatechange is also defined specially, using [LenientThis]; see IDL --&gt;
 
+  &lt;div class=impl&gt;
 
+  &lt;hr&gt;&lt;p&gt;An &lt;dfn id=internal-raw-uncompiled-handler&gt;internal raw uncompiled handler&lt;/dfn&gt; is a tuple with the following information:&lt;/p&gt;
+
+  &lt;ul class=brief&gt;&lt;li&gt;An uncompiled script body
+
+   &lt;li&gt;A location where the script body originated, in case an error needs to be reported
+
+  &lt;/ul&gt;&lt;p&gt;When the user agent is to &lt;dfn id=getting-the-current-value-of-the-event-handler title=&quot;getting the current value of the event handler&quot;&gt;get the
+  current value of the event handler&lt;/dfn&gt; &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;, it must run these steps:&lt;/p&gt;
+
+  &lt;ol&gt;&lt;li&gt;
+
+    &lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw uncompiled handler&lt;/a&gt;, run these
+    substeps:&lt;/p&gt;
+
+    &lt;ol&gt;&lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; be the uncompiled script body in the &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw
+     uncompiled handler&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;location&lt;/var&gt; be the location where the script body originated, as
+     given by the &lt;a href=#internal-raw-uncompiled-handler&gt;internal raw uncompiled handler&lt;/a&gt;.&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; is an element's &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event
+      handler&lt;/a&gt;, then let &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; be the element, and &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the element's &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; is a &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object's &lt;a href=#event-handlers title=&quot;event
+      handlers&quot;&gt;event handler&lt;/a&gt;: let &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; be null, and let &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; be the &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; most recently associated with that
+      &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not null and &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; has a
+     &lt;a href=#form-owner&gt;form owner&lt;/a&gt;, let &lt;var title=&quot;&quot;&gt;form owner&lt;/var&gt; be that &lt;a href=#form-owner&gt;form owner&lt;/a&gt;.
+     Otherwise, let &lt;var title=&quot;&quot;&gt;form owner&lt;/var&gt; be null.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt; be the &lt;a href=#script-settings-object&gt;script settings object&lt;/a&gt;
+     created for the &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object with which &lt;var title=&quot;&quot;&gt;document&lt;/var&gt; is
+     currently associated.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Obtain the &lt;a href=#script-execution-environment&gt;script execution environment&lt;/a&gt; for JavaScript from &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/li&gt;
+     &lt;!-- v2: we could support HTML4's Content-Script-Type header here --&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects
+      an &lt;i&gt;early error&lt;/i&gt;, then follow these substeps:&lt;/p&gt;
+
+      &lt;ol&gt;&lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value to null.&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;&lt;a href=#report-the-error&gt;Report the error&lt;/a&gt; for the appropriate &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt; and with the appropriate position (line number and
+       column number) given by &lt;var title=&quot;&quot;&gt;location&lt;/var&gt;, using the &lt;a href=#global-object&gt;global object&lt;/a&gt;
+       specified by &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt; as the target. If the error is still &lt;i title=concept-error-nothandled&gt;&lt;a href=#concept-error-nothandled&gt;not handled&lt;/a&gt;&lt;/i&gt; after this, then the error may be reported
+       to the user.&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;end&lt;/i&gt; below.&lt;/li&gt;
+
+      &lt;/ol&gt;&lt;p class=note&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript edition 5 section 13 Function
+      Definition. &lt;i&gt;Early error&lt;/i&gt; is defined in ECMAScript edition 5 section 16 Errors. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; begins with a Directive Prologue that contains a Use Strict
+      Directive then let &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; be true, otherwise let &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; be false.&lt;/p&gt; &lt;!-- we can't defer to 10.1.1 since we're not using a
+      Function constructor but doing it ourselves. --&gt;
+
+      &lt;p class=note&gt;The terms &quot;Directive Prologue&quot; and &quot;Use Strict Directive&quot; are defined in
+      ECMAScript edition 5 section 14.1 Directive Prologues and the Use Strict Directive. &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+
+  &lt;!-- currently this is unnecessary: <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4">http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4</A>
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; is a
+      &lt;code&gt;SyntaxError&lt;/code&gt; according to the Strict Mode Restrictions, then [...handle the error
+      as described above...].&lt;/p&gt;
+
+      &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in ECMAScript edition 5 section
+      13.1 Strict Mode Restrictions. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+  --&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Using the &lt;a href=#script-execution-environment&gt;script execution environment&lt;/a&gt; obtained above, create a function
+      object (as defined in ECMAScript edition 5 section 13.2 Creating Function Objects), with:&lt;/p&gt;
+
+      &lt;dl&gt;&lt;dt&gt;Parameter list &lt;var title=&quot;&quot;&gt;FormalParameterList&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;dl class=switch&gt;&lt;dt&gt;If &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; is an &lt;code title=handler-onerror&gt;&lt;a href=#handler-onerror&gt;onerror&lt;/a&gt;&lt;/code&gt; &lt;a href=#event-handlers title=&quot;event handlers&quot;&gt;event handler&lt;/a&gt; of a &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; object&lt;/dt&gt;
+
+         &lt;dd&gt;Let the function have five arguments, named &lt;code title=&quot;&quot;&gt;event&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;source&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;lineno&lt;/code&gt;, &lt;code title=&quot;&quot;&gt;colno&lt;/code&gt;, and
+         &lt;code title=&quot;&quot;&gt;error&lt;/code&gt;.&lt;/dd&gt;
+
+         &lt;!-- /colno/ is new as of 2012; see <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319">https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319</A> and 22800 --&gt;
+         &lt;!-- /error/ is new as of 2013; see <A HREF="http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html">http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html</A> --&gt;
+
+         &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+         &lt;dd&gt;Let the function have a single argument called &lt;code title=&quot;&quot;&gt;event&lt;/code&gt;.&lt;/dd&gt;
+
+        &lt;/dl&gt;&lt;/dd&gt;
+
+       &lt;dt&gt;Function body &lt;var title=&quot;&quot;&gt;FunctionBody&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;The result of parsing &lt;var title=&quot;&quot;&gt;body&lt;/var&gt; above.&lt;/dd&gt;
+
+       &lt;dt&gt;Lexical Environment &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;&lt;li&gt;Let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(&lt;var title=&quot;&quot;&gt;document&lt;/var&gt;, the &lt;var title=&quot;&quot;&gt;global environment&lt;/var&gt;).&lt;/li&gt;
+
+         &lt;li&gt;If &lt;var title=&quot;&quot;&gt;form owner&lt;/var&gt; is not null, let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the
+         result of NewObjectEnvironment(&lt;var title=&quot;&quot;&gt;&gt;form owner&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
+
+         &lt;li&gt;If &lt;var title=&quot;&quot;&gt;element&lt;/var&gt; is not null, let &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt; be the
+         result of NewObjectEnvironment(&lt;var title=&quot;&quot;&gt;element&lt;/var&gt;, &lt;var title=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
+
+        &lt;/ol&gt;&lt;p class=note&gt;NewObjectEnvironment() is defined in ECMAScript edition 5 section 10.2.2.3
+        NewObjectEnvironment (O, E). &lt;a href=#refsECMA262&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;Boolean flag &lt;var title=&quot;&quot;&gt;Strict&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;The value of &lt;var title=&quot;&quot;&gt;strict&lt;/var&gt;.&lt;/dd&gt;
+
+      &lt;/dl&gt;&lt;!-- SCRIPT EXEC --&gt;&lt;p&gt;Let this new function be a new &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;a href=#code-entry-point&gt;code
+      entry-point&lt;/a&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let that &lt;a href=#concept-script title=concept-script&gt;script&lt;/a&gt;'s &lt;a href=#settings-object&gt;settings object&lt;/a&gt; be
+     &lt;var title=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Set &lt;var title=&quot;&quot;&gt;H&lt;/var&gt; to the aforementioned function.&lt;/li&gt;
+
+    &lt;/ol&gt;&lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var title=&quot;&quot;&gt;H&lt;/var&gt;'s value.&lt;/li&gt;
+
+  &lt;/ol&gt;&lt;/div&gt;
+
+
+
   &lt;h5 id=event-handlers-on-elements,-document-objects,-and-window-objects&gt;&lt;span class=secno&gt;7.1.5.2 &lt;/span&gt;Event handlers on elements, &lt;code&gt;&lt;a href=#document&gt;Document&lt;/a&gt;&lt;/code&gt; objects, and &lt;code&gt;&lt;a href=#window&gt;Window&lt;/a&gt;&lt;/code&gt; objects&lt;/h5&gt;
 
   &lt;p&gt;The following are the &lt;a href=#event-handlers&gt;event handlers&lt;/a&gt; (and their corresponding &lt;a href=#event-handler-event-type title=&quot;event

Modified: source
===================================================================
--- source	2013-11-19 23:20:29 UTC (rev 8302)
+++ source	2013-11-20 21:09:24 UTC (rev 8303)
@@ -79279,9 +79279,10 @@
   &lt;p&gt;An &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; has a name, which always starts with
   &quot;&lt;code data-x=&quot;&quot;&gt;on&lt;/code&gt;&quot; and is followed by the name of the event for which it is intended.&lt;/p&gt;
 
-  &lt;p&gt;An &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; can either have the value null or be set
-  to a callback object. This is defined using the &lt;code&gt;EventHandler&lt;/code&gt; callback function type.
-  &lt;span class=&quot;impl&quot;&gt;Initially, event handlers must be set to null.&lt;/span&gt;&lt;/p&gt;
+  &lt;p&gt;An &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; can either have the value null, or be set
+  to a callback object&lt;span class=&quot;impl&quot;&gt;, or be set to an &lt;span&gt;internal raw uncompiled
+  handler&lt;/span&gt;&lt;/span&gt;. The &lt;code&gt;EventHandler&lt;/code&gt; callback function type describes how this is
+  exposed to scripts. &lt;span class=&quot;impl&quot;&gt;Initially, event handlers must be set to null.&lt;/span&gt;&lt;/p&gt;
 
   &lt;p&gt;Event handlers are exposed in one of two ways.&lt;/p&gt;
 
@@ -79300,9 +79301,10 @@
   attribute for a specific &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt;. The name of the IDL
   attribute is the same as the name of the &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt;.&lt;/p&gt;
 
-  &lt;p&gt;&lt;span&gt;Event handler IDL attributes&lt;/span&gt;, on setting, must set the corresponding event handler
-  to their new value, and on getting, must return whatever the current value of the corresponding
-  event handler is (possibly null).&lt;/p&gt;
+  &lt;p&gt;&lt;span&gt;Event handler IDL attributes&lt;/span&gt;, on setting, must set the corresponding &lt;span
+  data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; to their new value, and on getting, must return the
+  result of &lt;span&gt;getting the current value of the event handler&lt;/span&gt; in question (this can throw
+  an exception, in which case the getting propagates it to the caller, it does not catch it).&lt;/p&gt;
 
   &lt;p&gt;If an &lt;span data-x=&quot;event handler IDL attributes&quot;&gt;event handler IDL attribute&lt;/span&gt; exposes an
   &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; of an object that doesn't exist, it must always
@@ -79316,12 +79318,6 @@
   the &lt;code data-x=&quot;handler-MessagePort-onmessage&quot;&gt;onmessage&lt;/code&gt; attribute of
   &lt;code&gt;MessagePort&lt;/code&gt; objects.&lt;/p&gt;
 
-  &lt;p&gt;On getting, &lt;span&gt;event handler IDL attributes&lt;/span&gt; must return the value of their
-  corresponding &lt;span&gt;event handlers&lt;/span&gt;, except when the value is an &lt;span
-  data-x=&quot;concept-handler-error&quot;&gt;internal error value&lt;/span&gt;, in which case the user agent must set
-  the corresponding event handler to null, and then throw an exception corresponding to the error
-  condition.&lt;/p&gt;
-
   &lt;hr&gt;
 
   &lt;/div&gt;
@@ -79337,152 +79333,13 @@
 
   &lt;div class=&quot;impl&quot;&gt;
 
-  &lt;!-- SCRIPT EXEC --&gt;
   &lt;p&gt;When an &lt;span data-x=&quot;event handler content attributes&quot;&gt;event handler content attribute&lt;/span&gt;
   is set, if the element is owned by a &lt;code&gt;Document&lt;/code&gt; that is in a &lt;span&gt;browsing
   context&lt;/span&gt;, and &lt;span data-x=&quot;concept-bc-script&quot;&gt;scripting is enabled&lt;/span&gt; for that
-  &lt;span&gt;browsing context&lt;/span&gt;, the user agent must run the following steps to create a &lt;span
-  data-x=&quot;concept-script&quot;&gt;script&lt;/span&gt; after setting the content attribute to its new value:&lt;/p&gt;
+  &lt;span&gt;browsing context&lt;/span&gt;, the user agent must set the corresponding &lt;span data-x=&quot;event
+  handlers&quot;&gt;event handler&lt;/span&gt; to an &lt;span&gt;internal raw uncompiled handler&lt;/span&gt; consisting of
+  the attribute's new value and the script location where the attribute was set to this value&lt;/p&gt;
 
-  &lt;ol&gt;
-
-   &lt;li&gt;&lt;p&gt;Set the corresponding &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; to null.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;script settings&lt;/var&gt; be the &lt;span&gt;script settings object&lt;/span&gt; of the
-   &lt;code&gt;Window&lt;/code&gt; object associated with the &lt;span&gt;browsing context&lt;/span&gt; to which belongs the
-   &lt;code&gt;Document&lt;/code&gt; of the element in question.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Obtain the &lt;span&gt;script execution environment&lt;/span&gt; for JavaScript from &lt;var
-   data-x=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; be the &lt;span data-x=&quot;event handler content attributes&quot;&gt;event
-   handler content attribute&lt;/span&gt;'s new value.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects an
-    &lt;i&gt;early error&lt;/i&gt; then &lt;span&gt;set the event handler content attribute to an error&lt;/span&gt; as
-    defined below, and abort these steps.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript edition 5 section 13 Function
-    Definition. &lt;i&gt;Early error&lt;/i&gt; is defined in ECMAScript edition 5 section 16 Errors. &lt;a
-    href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; begins with a Directive Prologue that contains a Use Strict
-    Directive then let &lt;var data-x=&quot;&quot;&gt;strict&lt;/var&gt; be true, otherwise let &lt;var data-x=&quot;&quot;&gt;strict&lt;/var&gt;
-    be false.&lt;/p&gt; &lt;!-- we can't defer to 10.1.1 since we're not using a Function constructor but
-    doing it ourselves. --&gt;
-
-    &lt;p class=&quot;note&quot;&gt;The terms &quot;Directive Prologue&quot; and &quot;Use Strict Directive&quot; are defined in
-    ECMAScript edition 5 section 14.1 Directive Prologues and the Use Strict Directive. &lt;a
-    href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
-
-&lt;!--
-currently this is unnecessary: <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4">http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4</A>
-   &lt;li&gt;
-
-    &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; is a
-    &lt;code&gt;SyntaxError&lt;/code&gt; according to the Strict Mode Restrictions, then &lt;span&gt;set the event
-    handler content attribute to an error&lt;/span&gt; as defined below, and abort these steps.&lt;/p&gt;
-
-    &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in ECMAScript edition 5 section
-    13.1 Strict Mode Restrictions. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-   &lt;/li&gt;
---&gt;
-
-   &lt;li&gt;
-
-&lt;!--CLEANUP--&gt;
-    &lt;p&gt;Using the &lt;span&gt;script execution environment&lt;/span&gt; obtained above, create a function object (as defined in
-    ECMAScript edition 5 section 13.2 Creating Function Objects), with:&lt;/p&gt;
-
-    &lt;dl&gt;
-
-     &lt;dt&gt;Parameter list &lt;var data-x=&quot;&quot;&gt;FormalParameterList&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;dl class=&quot;switch&quot;&gt;
-
-       &lt;dt&gt;If the attribute is an &lt;code data-x=&quot;handler-onerror&quot;&gt;onerror&lt;/code&gt; content attribute
-       corresponding to an &lt;span&gt;event handler&lt;/span&gt; of a &lt;code&gt;Window&lt;/code&gt; object (that is, the
-       &lt;code data-x=&quot;handler-onerror&quot;&gt;onerror&lt;/code&gt; content attributes on &lt;code&gt;body&lt;/code&gt; and
-       &lt;code&gt;frameset&lt;/code&gt; elements)&lt;/dt&gt;
-
-       &lt;dd&gt;Let the function have five arguments, named &lt;code data-x=&quot;&quot;&gt;event&lt;/code&gt;, &lt;code
-       data-x=&quot;&quot;&gt;source&lt;/code&gt;, &lt;code data-x=&quot;&quot;&gt;lineno&lt;/code&gt;, &lt;code data-x=&quot;&quot;&gt;colno&lt;/code&gt;,
-       and &lt;code data-x=&quot;&quot;&gt;error&lt;/code&gt;.&lt;/dd&gt;
-       &lt;!-- /colno/ is new as of 2012; see <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319">https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319</A> and 22800 --&gt;
-       &lt;!-- /error/ is new as of 2013; see <A HREF="http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html">http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html</A> --&gt;
-
-       &lt;dt&gt;Otherwise&lt;/dt&gt;
-
-       &lt;dd&gt;Let the function have a single argument called &lt;code data-x=&quot;&quot;&gt;event&lt;/code&gt;.&lt;/dd&gt;
-
-      &lt;/dl&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Function body &lt;var data-x=&quot;&quot;&gt;FunctionBody&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The result of parsing &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; above.&lt;/dd&gt;
-
-     &lt;dt&gt;Lexical Environment &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;
-
-      &lt;ol&gt;
-
-       &lt;li&gt;Let &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(the element's
-       &lt;code&gt;Document&lt;/code&gt;, the &lt;var data-x=&quot;&quot;&gt;global environment&lt;/var&gt;).&lt;/li&gt;
-
-       &lt;li&gt;If the element has a &lt;span&gt;form owner&lt;/span&gt;, let &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt; be the result
-       of NewObjectEnvironment(the element's &lt;span&gt;form owner&lt;/span&gt;, &lt;var
-       data-x=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
-
-       &lt;li&gt;Let &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(the element's object,
-       &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
-
-      &lt;/ol&gt;
-
-      &lt;p class=&quot;note&quot;&gt;NewObjectEnvironment() is defined in ECMAScript edition 5 section 10.2.2.3
-      NewObjectEnvironment (O, E). &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
-
-     &lt;/dd&gt;
-
-     &lt;dt&gt;Boolean flag &lt;var data-x=&quot;&quot;&gt;Strict&lt;/var&gt;&lt;/dt&gt;
-
-     &lt;dd&gt;The value of &lt;var data-x=&quot;&quot;&gt;strict&lt;/var&gt;.&lt;/dd&gt;
-
-    &lt;/dl&gt;
-
-&lt;!--CLEANUP--&gt;
-    &lt;p&gt;Let this new function be a new &lt;span data-x=&quot;concept-script&quot;&gt;script&lt;/span&gt;'s &lt;span&gt;code entry-point&lt;/span&gt;.&lt;/p&gt;
-
-   &lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Let that &lt;span data-x=&quot;concept-script&quot;&gt;script&lt;/span&gt;'s &lt;span&gt;settings object&lt;/span&gt; be
-   &lt;var data-x=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
-
-   &lt;li&gt;&lt;p&gt;Set the corresponding &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; to the
-   aforementioned function.&lt;/p&gt;&lt;/li&gt;
-
-  &lt;/ol&gt;
-
-  &lt;p&gt;When a user agent is required, by the steps above, to &lt;dfn&gt;set the event handler content
-  attribute to an error&lt;/dfn&gt;, the user agent must set the corresponding &lt;span data-x=&quot;event
-  handlers&quot;&gt;event handler&lt;/span&gt; to an &lt;dfn data-x=&quot;concept-handler-error&quot;&gt;internal error value&lt;/dfn&gt;
-  representing the error condition, keeping track of the &lt;span&gt;URL&lt;/span&gt; of the resource where the
-  &lt;span data-x=&quot;event handler content attributes&quot;&gt;event handler content attribute&lt;/span&gt; was set, and
-  the relevant line number inside that resource where the error occurred.&lt;/p&gt;
-
   &lt;p&gt;When an event handler content attribute is removed, the user agent must set the corresponding
   &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; to null.&lt;/p&gt;
   &lt;!--
@@ -79491,16 +79348,10 @@
   see <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=7626#c5">http://www.w3.org/Bugs/Public/show_bug.cgi?id=7626#c5</A> for reasoning
   --&gt;
 
-  &lt;/div&gt;
-
   &lt;p class=&quot;note&quot;&gt;When an &lt;span data-x=&quot;event handler content attributes&quot;&gt;event handler content
   attribute&lt;/span&gt; is set on an element owned by a &lt;code&gt;Document&lt;/code&gt; that is not in a
   &lt;span&gt;browsing context&lt;/span&gt;, the corresponding event handler is not changed.&lt;/p&gt;
 
-  &lt;!-- v2: we should probably support HTML4's Content-Script-Type header here. --&gt;
-
-  &lt;div class=&quot;impl&quot;&gt;
-
   &lt;hr&gt;
 
   &lt;p&gt;When an &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt; of an element
@@ -79557,19 +79408,15 @@
 
   &lt;ol&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt;'s value is null, then abort these steps.&lt;/p&gt;&lt;/li&gt;
+   &lt;li&gt;
 
-   &lt;li&gt;&lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;span data-x=&quot;concept-handler-error&quot;&gt;internal error
-   value&lt;/span&gt;, then: set the &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; to null and then
-   &lt;span&gt;report the error&lt;/span&gt; for the appropriate &lt;span data-x=&quot;concept-script&quot;&gt;script&lt;/span&gt; and
-   with the appropriate position (line number and column number), as established when the error was
-   detected, using the &lt;code&gt;Window&lt;/code&gt; object of that &lt;code&gt;Document&lt;/code&gt; as the target. If
-   the error is still &lt;i data-x=&quot;concept-error-nothandled&quot;&gt;not handled&lt;/i&gt; after this, then the error
-   may be reported to the user. Finally, abort these steps.&lt;/p&gt;&lt;/li&gt;
+    &lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;callback&lt;/var&gt; be the result of &lt;span&gt;getting the current value of the
+    event handler&lt;/span&gt; &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt;.&lt;/p&gt;
 
-   &lt;li&gt;&lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;callback&lt;/var&gt; be &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt;'s value, the callback that the
-   &lt;span data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; was last set to.&lt;/p&gt;&lt;/li&gt;
+   &lt;/li&gt;
 
+   &lt;li&gt;&lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;callback&lt;/var&gt; is null, then abort these steps.&lt;/p&gt;&lt;/li&gt;
+
    &lt;li&gt;
 
     &lt;p&gt;Process the &lt;code&gt;Event&lt;/code&gt; object &lt;var data-x=&quot;&quot;&gt;E&lt;/var&gt; as follows:&lt;/p&gt;
@@ -79598,6 +79445,7 @@
 
      &lt;dd&gt;
 
+&lt;!--CLEANUP--&gt;
       &lt;p&gt;&lt;span data-x=&quot;concept-invoke-event-handler&quot;&gt;Invoke&lt;/span&gt; &lt;var data-x=&quot;&quot;&gt;callback&lt;/var&gt; with one argument, the value of which is the
       &lt;code&gt;Event&lt;/code&gt; object &lt;var data-x=&quot;&quot;&gt;E&lt;/var&gt;, with the &lt;i
       data-x=&quot;dfn-callback-this-value&quot;&gt;callback this value&lt;/i&gt; set to &lt;var data-x=&quot;&quot;&gt;E&lt;/var&gt;'s &lt;code
@@ -79705,7 +79553,203 @@
 
   &lt;!-- onreadystatechange is also defined specially, using [LenientThis]; see IDL --&gt;
 
+  &lt;div class=&quot;impl&quot;&gt;
 
+  &lt;hr&gt;
+
+  &lt;p&gt;An &lt;dfn&gt;internal raw uncompiled handler&lt;/dfn&gt; is a tuple with the following information:&lt;/p&gt;
+
+  &lt;ul class=&quot;brief&quot;&gt;
+
+   &lt;li&gt;An uncompiled script body
+
+   &lt;li&gt;A location where the script body originated, in case an error needs to be reported
+
+  &lt;/ul&gt;
+
+  &lt;p&gt;When the user agent is to &lt;dfn data-x=&quot;getting the current value of the event handler&quot;&gt;get the
+  current value of the event handler&lt;/dfn&gt; &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt;, it must run these steps:&lt;/p&gt;
+
+  &lt;ol&gt;
+
+   &lt;li&gt;
+
+    &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt;'s value is an &lt;span&gt;internal raw uncompiled handler&lt;/span&gt;, run these
+    substeps:&lt;/p&gt;
+
+    &lt;ol&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; be the uncompiled script body in the &lt;span&gt;internal raw
+     uncompiled handler&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;location&lt;/var&gt; be the location where the script body originated, as
+     given by the &lt;span&gt;internal raw uncompiled handler&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt; is an element's &lt;span data-x=&quot;event handlers&quot;&gt;event
+      handler&lt;/span&gt;, then let &lt;var data-x=&quot;&quot;&gt;element&lt;/var&gt; be the element, and &lt;var
+      data-x=&quot;&quot;&gt;document&lt;/var&gt; be the element's &lt;code&gt;Document&lt;/code&gt;.&lt;/p&gt;
+
+      &lt;p&gt;Otherwise, &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt; is a &lt;code&gt;Window&lt;/code&gt; object's &lt;span data-x=&quot;event
+      handlers&quot;&gt;event handler&lt;/span&gt;: let &lt;var data-x=&quot;&quot;&gt;element&lt;/var&gt; be null, and let &lt;var
+      data-x=&quot;&quot;&gt;document&lt;/var&gt; be the &lt;code&gt;Document&lt;/code&gt; most recently associated with that
+      &lt;code&gt;Window&lt;/code&gt; object.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;element&lt;/var&gt; is not null and &lt;var data-x=&quot;&quot;&gt;element&lt;/var&gt; has a
+     &lt;span&gt;form owner&lt;/span&gt;, let &lt;var data-x=&quot;&quot;&gt;form owner&lt;/var&gt; be that &lt;span&gt;form owner&lt;/span&gt;.
+     Otherwise, let &lt;var data-x=&quot;&quot;&gt;form owner&lt;/var&gt; be null.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let &lt;var data-x=&quot;&quot;&gt;script settings&lt;/var&gt; be the &lt;span&gt;script settings object&lt;/span&gt;
+     created for the &lt;code&gt;Window&lt;/code&gt; object with which &lt;var data-x=&quot;&quot;&gt;document&lt;/var&gt; is
+     currently associated.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Obtain the &lt;span&gt;script execution environment&lt;/span&gt; for JavaScript from &lt;var
+     data-x=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+     &lt;!-- v2: we could support HTML4's Content-Script-Type header here --&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; is not parsable as &lt;i&gt;FunctionBody&lt;/i&gt; or if parsing detects
+      an &lt;i&gt;early error&lt;/i&gt;, then follow these substeps:&lt;/p&gt;
+
+      &lt;ol&gt;
+
+       &lt;li&gt;&lt;p&gt;Set &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt;'s value to null.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;&lt;span&gt;Report the error&lt;/span&gt; for the appropriate &lt;span
+       data-x=&quot;concept-script&quot;&gt;script&lt;/span&gt; and with the appropriate position (line number and
+       column number) given by &lt;var data-x=&quot;&quot;&gt;location&lt;/var&gt;, using the &lt;span&gt;global object&lt;/span&gt;
+       specified by &lt;var data-x=&quot;&quot;&gt;script settings&lt;/var&gt; as the target. If the error is still &lt;i
+       data-x=&quot;concept-error-nothandled&quot;&gt;not handled&lt;/i&gt; after this, then the error may be reported
+       to the user.&lt;/p&gt;&lt;/li&gt;
+
+       &lt;li&gt;&lt;p&gt;Jump to the step labeled &lt;i&gt;end&lt;/i&gt; below.&lt;/p&gt;&lt;/li&gt;
+
+      &lt;/ol&gt;
+
+      &lt;p class=&quot;note&quot;&gt;&lt;i&gt;FunctionBody&lt;/i&gt; is defined in ECMAScript edition 5 section 13 Function
+      Definition. &lt;i&gt;Early error&lt;/i&gt; is defined in ECMAScript edition 5 section 16 Errors. &lt;a
+      href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; begins with a Directive Prologue that contains a Use Strict
+      Directive then let &lt;var data-x=&quot;&quot;&gt;strict&lt;/var&gt; be true, otherwise let &lt;var
+      data-x=&quot;&quot;&gt;strict&lt;/var&gt; be false.&lt;/p&gt; &lt;!-- we can't defer to 10.1.1 since we're not using a
+      Function constructor but doing it ourselves. --&gt;
+
+      &lt;p class=&quot;note&quot;&gt;The terms &quot;Directive Prologue&quot; and &quot;Use Strict Directive&quot; are defined in
+      ECMAScript edition 5 section 14.1 Directive Prologues and the Use Strict Directive. &lt;a
+      href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+
+  &lt;!-- currently this is unnecessary: <A HREF="http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4">http://www.w3.org/Bugs/Public/show_bug.cgi?id=11977#c4</A>
+     &lt;li&gt;
+
+      &lt;p&gt;If &lt;var data-x=&quot;&quot;&gt;strict&lt;/var&gt; is true, and anything in &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; is a
+      &lt;code&gt;SyntaxError&lt;/code&gt; according to the Strict Mode Restrictions, then [...handle the error
+      as described above...].&lt;/p&gt;
+
+      &lt;p class=&quot;note&quot;&gt;The Strict Mode Restrictions are those listed in ECMAScript edition 5 section
+      13.1 Strict Mode Restrictions. &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+     &lt;/li&gt;
+  --&gt;
+
+     &lt;li&gt;
+
+      &lt;p&gt;Using the &lt;span&gt;script execution environment&lt;/span&gt; obtained above, create a function
+      object (as defined in ECMAScript edition 5 section 13.2 Creating Function Objects), with:&lt;/p&gt;
+
+      &lt;dl&gt;
+
+       &lt;dt&gt;Parameter list &lt;var data-x=&quot;&quot;&gt;FormalParameterList&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;dl class=&quot;switch&quot;&gt;
+
+         &lt;dt&gt;If &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt; is an &lt;code data-x=&quot;handler-onerror&quot;&gt;onerror&lt;/code&gt; &lt;span
+         data-x=&quot;event handlers&quot;&gt;event handler&lt;/span&gt; of a &lt;code&gt;Window&lt;/code&gt; object&lt;/dt&gt;
+
+         &lt;dd&gt;Let the function have five arguments, named &lt;code data-x=&quot;&quot;&gt;event&lt;/code&gt;, &lt;code
+         data-x=&quot;&quot;&gt;source&lt;/code&gt;, &lt;code data-x=&quot;&quot;&gt;lineno&lt;/code&gt;, &lt;code data-x=&quot;&quot;&gt;colno&lt;/code&gt;, and
+         &lt;code data-x=&quot;&quot;&gt;error&lt;/code&gt;.&lt;/dd&gt;
+
+         &lt;!-- /colno/ is new as of 2012; see <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319">https://www.w3.org/Bugs/Public/show_bug.cgi?id=13319</A> and 22800 --&gt;
+         &lt;!-- /error/ is new as of 2013; see <A HREF="http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html">http://lists.w3.org/Archives/Public/public-whatwg-archive/2013Jul/0313.html</A> --&gt;
+
+         &lt;dt&gt;Otherwise&lt;/dt&gt;
+
+         &lt;dd&gt;Let the function have a single argument called &lt;code data-x=&quot;&quot;&gt;event&lt;/code&gt;.&lt;/dd&gt;
+
+        &lt;/dl&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;Function body &lt;var data-x=&quot;&quot;&gt;FunctionBody&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;The result of parsing &lt;var data-x=&quot;&quot;&gt;body&lt;/var&gt; above.&lt;/dd&gt;
+
+       &lt;dt&gt;Lexical Environment &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;
+
+        &lt;ol&gt;
+
+         &lt;li&gt;Let &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt; be the result of NewObjectEnvironment(&lt;var
+         data-x=&quot;&quot;&gt;document&lt;/var&gt;, the &lt;var data-x=&quot;&quot;&gt;global environment&lt;/var&gt;).&lt;/li&gt;
+
+         &lt;li&gt;If &lt;var data-x=&quot;&quot;&gt;form owner&lt;/var&gt; is not null, let &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt; be the
+         result of NewObjectEnvironment(&lt;var data-x=&quot;&quot;&gt;&gt;form owner&lt;/var&gt;, &lt;var
+         data-x=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
+
+         &lt;li&gt;If &lt;var data-x=&quot;&quot;&gt;element&lt;/var&gt; is not null, let &lt;var data-x=&quot;&quot;&gt;Scope&lt;/var&gt; be the
+         result of NewObjectEnvironment(&lt;var data-x=&quot;&quot;&gt;element&lt;/var&gt;, &lt;var
+         data-x=&quot;&quot;&gt;Scope&lt;/var&gt;).&lt;/li&gt;
+
+        &lt;/ol&gt;
+
+        &lt;p class=&quot;note&quot;&gt;NewObjectEnvironment() is defined in ECMAScript edition 5 section 10.2.2.3
+        NewObjectEnvironment (O, E). &lt;a href=&quot;#refsECMA262&quot;&gt;[ECMA262]&lt;/a&gt;&lt;/p&gt;
+
+       &lt;/dd&gt;
+
+       &lt;dt&gt;Boolean flag &lt;var data-x=&quot;&quot;&gt;Strict&lt;/var&gt;&lt;/dt&gt;
+
+       &lt;dd&gt;The value of &lt;var data-x=&quot;&quot;&gt;strict&lt;/var&gt;.&lt;/dd&gt;
+
+      &lt;/dl&gt;
+
+  &lt;!-- SCRIPT EXEC --&gt;
+      &lt;p&gt;Let this new function be a new &lt;span data-x=&quot;concept-script&quot;&gt;script&lt;/span&gt;'s &lt;span&gt;code
+      entry-point&lt;/span&gt;.&lt;/p&gt;
+
+     &lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Let that &lt;span data-x=&quot;concept-script&quot;&gt;script&lt;/span&gt;'s &lt;span&gt;settings object&lt;/span&gt; be
+     &lt;var data-x=&quot;&quot;&gt;script settings&lt;/var&gt;.&lt;/p&gt;&lt;/li&gt;
+
+     &lt;li&gt;&lt;p&gt;Set &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt; to the aforementioned function.&lt;/p&gt;&lt;/li&gt;
+
+    &lt;/ol&gt;
+
+   &lt;/li&gt;
+
+   &lt;li&gt;&lt;p&gt;&lt;i&gt;End&lt;/i&gt;: Return &lt;var data-x=&quot;&quot;&gt;H&lt;/var&gt;'s value.&lt;/p&gt;&lt;/li&gt;
+
+  &lt;/ol&gt;
+
+  &lt;/div&gt;
+
+
+
   &lt;h5&gt;Event handlers on elements, &lt;code&gt;Document&lt;/code&gt; objects, and &lt;code&gt;Window&lt;/code&gt; objects&lt;/h5&gt;
 
   &lt;p&gt;The following are the &lt;span&gt;event handlers&lt;/span&gt; (and their corresponding &lt;span data-x=&quot;event


</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015157.html">[html5] r8302 - [giow] (1) Kill History objects on non-active docs	Fixing https://www.w3.org/Bug [...]
</A></li>
	<LI>Next message: <A HREF="015159.html">[html5] r8304 - [e] (0) Fix up the attribute annotations a bit	Fixing https://www.w3.org/Bugs/Pu [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15158">[ date ]</a>
              <a href="thread.html#15158">[ thread ]</a>
              <a href="subject.html#15158">[ subject ]</a>
              <a href="author.html#15158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">More information about the Commit-Watchers
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
