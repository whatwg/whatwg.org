<tt>
Hi!&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;wondering&nbsp;what&nbsp;prevents&nbsp;a&nbsp;web&nbsp;worker&nbsp;from&nbsp;running&nbsp;into&nbsp;race-conditions&nbsp;when&nbsp;setting&nbsp;the&nbsp;onmessage&nbsp;handlers.&nbsp;I&nbsp;am&nbsp;worried&nbsp;about&nbsp;that&nbsp;a&nbsp;web&nbsp;worker&nbsp;posts&nbsp;a&nbsp;message&nbsp;before&nbsp;the&nbsp;main&nbsp;script&nbsp;has&nbsp;set&nbsp;up&nbsp;the&nbsp;onmessage&nbsp;handler,&nbsp;or&nbsp;the&nbsp;other&nbsp;way&nbsp;around,&nbsp;that&nbsp;the&nbsp;web&nbsp;worker&nbsp;posts&nbsp;a&nbsp;message&nbsp;before&nbsp;the&nbsp;main&nbsp;script&nbsp;has&nbsp;set&nbsp;up&nbsp;its&nbsp;onmessage&nbsp;handler.&lt;br&gt;<br>
&lt;br&gt;I&nbsp;know&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;message&nbsp;queue&nbsp;[1],&nbsp;but&nbsp;you&nbsp;can&nbsp;easily&nbsp;make&nbsp;up&nbsp;an&nbsp;example&nbsp;where&nbsp;a&nbsp;message&nbsp;is&nbsp;not&nbsp;enqueued:&lt;br&gt;&lt;br&gt;Main&nbsp;Script:&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
var&nbsp;worker&nbsp;=&nbsp;new&nbsp;Worker(&quot;webworker.js&quot;);&lt;br&gt;worker.onmessage&nbsp;=&nbsp;function(event)&nbsp;{&lt;br&gt;   &nbsp;console.log(&#39;onmessage&nbsp;&#39;&nbsp;+&nbsp;event.data)   &nbsp;&lt;br&gt;};&lt;br&gt;worker.postMessage(&quot;start&quot;);&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;br&gt;<br>
&#39;webworker.js&#39;:&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;setTimeout(&lt;br&gt;   &nbsp;function()&nbsp;{&lt;br&gt;       &nbsp;onmessage&nbsp;=&nbsp;function(event)&nbsp;{&lt;br&gt;<br>
           &nbsp;postMessage(&quot;message&nbsp;received&quot;);   &nbsp;&lt;br&gt;       &nbsp;};&lt;br&gt;       &nbsp;postMessage(&quot;done&quot;);&lt;br&gt;   &nbsp;},&nbsp;1000);&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;br&gt;The&nbsp;output&nbsp;is&nbsp;(in&nbsp;Chromium&nbsp;6.0.475.0&nbsp;and&nbsp;Firefox&nbsp;4.01b,&nbsp;Opera&nbsp;10.70&nbsp;also&nbsp;outputs&nbsp;&quot;onmessage&nbsp;message&nbsp;received&quot;):&lt;br&gt;<br>
&lt;br&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;onmessage&nbsp;done&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;So&nbsp;the&nbsp;&quot;onmessage&quot;&nbsp;handler&nbsp;of&nbsp;the&nbsp;web&nbsp;worker&nbsp;is&nbsp;never&nbsp;called.&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;Is&nbsp;this&nbsp;the&nbsp;behavior&nbsp;the&nbsp;specification&nbsp;requests,&nbsp;or&nbsp;is&nbsp;it&nbsp;a&nbsp;bug&nbsp;in&nbsp;Chrome/Chromium&nbsp;and&nbsp;Firefox?&lt;br&gt;&lt;br&gt;Tobias&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;[1]:&nbsp;&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#port-message-queue&quot;&gt;http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#port-message-queue&lt;/a&gt;&lt;br&gt;<br>

</tt>
