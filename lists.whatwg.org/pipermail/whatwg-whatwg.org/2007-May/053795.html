<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Establishing the character encoding and determinism
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Establishing%20the%20character%20encoding%20and%20determinism&In-Reply-To=%3C8B70426D-8AD6-467F-ADCF-B46081BB006A%40iki.fi%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="053792.html">
   <LINK REL="Next"  HREF="053802.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Establishing the character encoding and determinism</H1>
<!--htdig_noindex-->
    <B>Henri Sivonen</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Establishing%20the%20character%20encoding%20and%20determinism&In-Reply-To=%3C8B70426D-8AD6-467F-ADCF-B46081BB006A%40iki.fi%3E"
       TITLE="[whatwg] Establishing the character encoding and determinism">hsivonen at iki.fi
       </A><BR>
    <I>Mon May 28 07:28:06 PDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="053792.html">[whatwg] Corrections and clarifications to the WhatWG charter
</A></li>
        <LI>Next message: <A HREF="053802.html">[whatwg] Establishing the character encoding and determinism
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53795">[ date ]</a>
              <a href="thread.html#53795">[ thread ]</a>
              <a href="subject.html#53795">[ subject ]</a>
              <a href="author.html#53795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>For proper communication it is important that a document is decoded  
reliably. In addition, for security reasons, it is important that  
documents are decoded the same way by browsers and by gatekeeper tools.

To this end, I think at least for conforming documents the algorithm  
for establishing the character encoding should be deterministic. I'd  
like to request two things:

1) When sniffing for meta charset, the current draft allows a use  
agent to give up sooner than after examining the first 512 bytes. To  
make meta charset sniffing reliable and deterministic so that it  
doesn't depend on flukes in buffering, I think UAs should (if there's  
no transfer protocol level charset label and no BOM) be required to  
consumer bytes until they find a meta charset, reach the EOF or have  
examined 512 bytes. That is, I think UAs should not be allowed to  
give up earlier. (On the other hand, I think UAs should be allowed to  
start examining the byte stream before 512 have been buffered without  
an IO error, since in general, byte stream buffer management should  
be up to the IO libraries and outside the scope of the HTML spec.)

2) Since the chardet step is optional and the spec doesn't make the  
Mozilla chardet behavior normative, I think the document should be  
considered non-conforming if the algorithm for establishing the  
character encoding proceeds to steps 6 (chardet) or 7 (last resort  
default).

Personally, I'd prefer formulating such a document conformance  
requirement as part of the algorithm, but given recent feedback, I am  
aware that most people wish to maintain a separation of processing  
models and document conformance requirement. (For me, mixing the two  
is what I have to do in my head anyway. ;-)

It wouldn't hurt, though, to say in the section on writing documents  
that at least one of the following is required for document conformance:
  * A transfer protocol-level character encoding declaration.
  * A meta charset within the first 512 bytes.
  * A BOM.

-- 
Henri Sivonen
<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">hsivonen at iki.fi</A>
<A HREF="http://hsivonen.iki.fi/">http://hsivonen.iki.fi/</A>



</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="053792.html">[whatwg] Corrections and clarifications to the WhatWG charter
</A></li>
	<LI>Next message: <A HREF="053802.html">[whatwg] Establishing the character encoding and determinism
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53795">[ date ]</a>
              <a href="thread.html#53795">[ thread ]</a>
              <a href="subject.html#53795">[ subject ]</a>
              <a href="author.html#53795">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
