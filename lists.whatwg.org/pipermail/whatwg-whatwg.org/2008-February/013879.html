<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] postMessage: event.source allows navigation of sender
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20postMessage%3A%20event.source%20allows%20navigation%20of%20sender&In-Reply-To=%3Cdd4c8a40802070159h4299d983u9ceea0ee966f13b%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013878.html">
   <LINK REL="Next"  HREF="013881.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] postMessage: event.source allows navigation of sender</H1>
<!--htdig_noindex-->
    <B>Hallvord R M Steen</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20postMessage%3A%20event.source%20allows%20navigation%20of%20sender&In-Reply-To=%3Cdd4c8a40802070159h4299d983u9ceea0ee966f13b%40mail.gmail.com%3E"
       TITLE="[whatwg] postMessage: event.source allows navigation of sender">hallvors at gmail.com
       </A><BR>
    <I>Thu Feb  7 01:59:26 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="013878.html">[whatwg] postMessage: event.source allows navigation of sender
</A></li>
        <LI>Next message: <A HREF="013881.html">[whatwg] postMessage: event.source allows navigation of sender
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13879">[ date ]</a>
              <a href="thread.html#13879">[ thread ]</a>
              <a href="subject.html#13879">[ subject ]</a>
              <a href="author.html#13879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On 07/02/2008, Thomas Broyer &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">t.broyer at gmail.com</A>&gt; wrote:
&gt;<i> On Feb 7, 2008 10:24 AM, Hallvord R M Steen wrote:
</I>&gt;<i> &gt; Adam Barth and Collin Jackson pointed out to me that while
</I>&gt;<i> &gt; investigating frame navigation policies they found that a recipient of
</I>&gt;<i> &gt; a postMessage in Opera can set event.source.location, thus navigate
</I>&gt;<i> &gt; the sender window/document. I think this is a bug in the API itself.
</I>&gt;<i>
</I>&gt;<i> If what you say is true (see below) I'd rather say it's a bug in
</I>&gt;<i> Opera's implementation.
</I>
That is of course a possibility. I don't have Firefox 3 handy so I'd
appreciate somebody explaining how it is implemented there.

&gt;<i> Shouldn't event.source.location be read-only? Isn't that a direct
</I>&gt;<i> application of the same-origin policy?
</I>
No, all user agents I know allow you to set window.location across
domains. Not doing so would break literally millions of web pages. As
event.source just points to the sending window object setting
event.source.location is same as setting window.location .

&gt;<i> The current draft contains the following note:
</I>&gt;<i> &quot;Implementors are urged to take extra care in the implementation of
</I>&gt;<i> this feature. It allows authors to transmit information from one
</I>&gt;<i> domain to another domain, which is normally disallowed for security
</I>&gt;<i> reasons. It also requires that UAs be careful to allow access to
</I>&gt;<i> certain properties but not others.&quot;
</I>
Do you really thing this vague paragraph *can* be interpreted as
saying normal same-domain policies should be extended with a stricter
policy that also disallows setting location? It's not exactly clear.

&gt;<i> See also <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/section-history.html#security5">http://www.whatwg.org/specs/web-apps/current-work/multipage/section-history.html#security5</A>
</I>&gt;<i>
</I>&gt;<i> And setting the event.source (Window object)'s location property is
</I>&gt;<i> covered by the following paragraph:
</I>&gt;<i> &quot;In the ECMAScript DOM binding, the location members of the
</I>&gt;<i> HTMLDocument and Window interfaces behave as if they had a setter:
</I>&gt;<i> user agents must treats attempts to set these location attribute as
</I>&gt;<i> attempts at setting the href attribute of the relevant Location object
</I>&gt;<i> instead.&quot;
</I>
Indeed. All UAs already do that - if you set location, you set .href.
Have a look at section 4.7.4.1. Security which reads:

User agents must raise a security exception whenever any of the
members of a Location object are accessed by scripts whose origin is
not the same as the Location object's associated Document's origin,
with the following exceptions:
* The href setter

So setting location actually sets href, and setting href is explicitly
permitted across domains. By my reading the spec clearly dictates what
Opera has implemented, so the original question remains.

-- 
Hallvord R. M. Steen

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013878.html">[whatwg] postMessage: event.source allows navigation of sender
</A></li>
	<LI>Next message: <A HREF="013881.html">[whatwg] postMessage: event.source allows navigation of sender
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13879">[ date ]</a>
              <a href="thread.html#13879">[ thread ]</a>
              <a href="subject.html#13879">[ subject ]</a>
              <a href="author.html#13879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
