<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Asynchronous database API feedback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Asynchronous%20database%20API%20feedback&In-Reply-To=%3C278fd46c0712111122k70b2b961u3ef22f7555dff764%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="055457.html">
   <LINK REL="Next"  HREF="055474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Asynchronous database API feedback</H1>
<!--htdig_noindex-->
    <B>Aaron Boodman</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Asynchronous%20database%20API%20feedback&In-Reply-To=%3C278fd46c0712111122k70b2b961u3ef22f7555dff764%40mail.gmail.com%3E"
       TITLE="[whatwg] Asynchronous database API feedback">aa at google.com
       </A><BR>
    <I>Tue Dec 11 11:22:43 PST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="055457.html">[whatwg] Asynchronous database API feedback
</A></li>
        <LI>Next message: <A HREF="055474.html">[whatwg] Asynchronous database API feedback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55472">[ date ]</a>
              <a href="thread.html#55472">[ thread ]</a>
              <a href="subject.html#55472">[ subject ]</a>
              <a href="author.html#55472">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Dec 10, 2007 4:04 PM, Dan Mosedale &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">dmose at mozilla.org</A>&gt; wrote:
&gt;<i> On Dec 10, 2007, at 12:21 PM, Geoffrey Garen wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; I'd hate for GMail to mysteriously stop working every couple of
</I>&gt;<i> &gt;&gt;&gt; days just because of some background process that I had no
</I>&gt;<i> &gt;&gt;&gt; knowledge of. As a developer, how would you debug such a problem?
</I>&gt;<i> &gt;&gt;&gt; As a tech support worker, how would you explain it to an end user?
</I>&gt;<i>
</I>&gt;<i> +1.  Having a bug in a single web-app be able to completely freeze the
</I>&gt;<i> entire UI of the entire browser (not just that window/tab) seems like
</I>&gt;<i> a pretty painful user experience, almost to the point of being
</I>&gt;<i> unacceptable.  If an end user ran into this problem very often, I
</I>&gt;<i> would expect them to blame the browser, and perhaps even switch to a
</I>&gt;<i> browser which didn't have this problem (i.e. didn't support
</I>&gt;<i> localStorage).
</I>
How does the globalStorage implementation deal with this problem? It
has a synchronous storage API. True it is probably designed for
smaller amounts of data, but there's nothing preventing an author from
using it for large amounts (is there?). Also, some of the concerns
raised here have nothing to do with the amount of data stored. Or does
globalStorage not guarantee that data is written when the setter
returns?

&gt;<i> As a user, assuming a synchronous interface with timeouts, I would
</I>&gt;<i> almost certainly want my browser to enforce a _much_ shorter timeout
</I>&gt;<i> than 5 seconds... something on the order of 200ms, maybe.  Anything
</I>&gt;<i> that makes repainting stop just feels really bad.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; If we cannot provide this, I feel that localstorage will not be
</I>&gt;<i> &gt;&gt; successful, so it won't matter what API it uses.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think this is a pretty extreme conclusion.
</I>&gt;<i>
</I>&gt;<i> I tend to agree.  Aaron, can you describe the thinking behind this
</I>&gt;<i> conclusion in more detail?
</I>
It's just from attempting to use the API. It is pretty difficult. If
you imagine some code that does synchronization of mail, it is going
to be downloading items in batches. A simple schema might include
messages, threads, and contacts. With a synchronous API, you just
process these in a loop. Very straightforward.

With an asynchronous API, it gets quite a bit messier. Here's an
example of what it might look like:

var messages = incoming_data;

db.transaction(function(tx) {
  processNextMessage(tx);
});

function processNextMessage(tx) {

  if (!messages.length) return;

  tx.executeSql(&quot;insert into messages (id, subject, body) values (?, ?, ?)&quot;, [
}

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="055457.html">[whatwg] Asynchronous database API feedback
</A></li>
	<LI>Next message: <A HREF="055474.html">[whatwg] Asynchronous database API feedback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55472">[ date ]</a>
              <a href="thread.html#55472">[ thread ]</a>
              <a href="subject.html#55472">[ subject ]</a>
              <a href="author.html#55472">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
