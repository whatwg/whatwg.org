<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Start position of media resources
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Start%20position%20of%20media%20resources&In-Reply-To=%3CPine.LNX.4.62.0904300024400.10370%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="061496.html">
   <LINK REL="Next"  HREF="061791.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Start position of media resources</H1>
<!--htdig_noindex-->
    <B>Ian Hickson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Start%20position%20of%20media%20resources&In-Reply-To=%3CPine.LNX.4.62.0904300024400.10370%40hixie.dreamhostps.com%3E"
       TITLE="[whatwg] Start position of media resources">ian at hixie.ch
       </A><BR>
    <I>Wed Apr 29 18:04:40 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="061496.html">[whatwg] Start position of media resources
</A></li>
        <LI>Next message: <A HREF="061791.html">[whatwg] Start position of media resources
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61789">[ date ]</a>
              <a href="thread.html#61789">[ thread ]</a>
              <a href="subject.html#61789">[ subject ]</a>
              <a href="author.html#61789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Mon, 6 Apr 2009, Chris Double wrote:
&gt;<i>
</I>&gt;<i> Ogg based media resources can start from a time position that is not 
</I>&gt;<i> zero. Examples of files that do this are those generated by the program 
</I>&gt;<i> oggz-chop. For example:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://ia331342.us.archive.org/2/items/night_of_the_living_dead/night_of_the_living_dead.ogv?t=0:20:00/0:20:50">http://ia331342.us.archive.org/2/items/night_of_the_living_dead/night_of_the_living_dead.ogv?t=0:20:00/0:20:50</A>
</I>&gt;<i> 
</I>&gt;<i> If this is played in VLC the start time of the video is 0:20:00. When 
</I>&gt;<i> seeking the time requested for the seek must be between 0:20:00 and 
</I>&gt;<i> 0:20:50. Does the HTML5 spec allow media resources that don't start from 
</I>&gt;<i> 0?
</I>
Yes. A typical example of a media resource that doesn't start from 0 is a 
live TV stream being buffered DVR-style, where the start position keeps 
moving. Other examples are as you give above, where the timeline of the 
clip doesn't start at zero.

In all these cases, the &quot;earliest possible position&quot; is non-zero.


&gt;<i> I see in the spec mention:
</I>&gt;<i> 
</I>&gt;<i> &quot;Media elements have a current playback position, which must initially 
</I>&gt;<i> be zero. The current position is a time.&quot;
</I>
There are two other requirements of relevance here:

For the case of a non-zero origin, the following is relevant:

# Once enough of the media data has been fetched to determine the duration 
# of the media resource, its dimensions, and other metadata
# [...]
# 1. Set the current playback position to the earliest possible position

For the DVR case, this is relevant also:

# When the earliest possible position changes, if the current playback 
# position is before the earliest possible position, the user agent must 
# seek to the earliest possible position.


&gt;<i> Is this valid per the spec?  If so, would we need an attribute on the 
</I>&gt;<i> media object so the web page author can retrieve the start time of the 
</I>&gt;<i> video (in the same way they can get the duration). They would need this 
</I>&gt;<i> to be able to display progress bars/scrubbers to position the thumb 
</I>&gt;<i> correctly based on the currentTime. Detecting the first frame or 
</I>&gt;<i> metadata loaded events and getting the position of the that won't work 
</I>&gt;<i> as some of the video may have been played by the time that event is 
</I>&gt;<i> handled by user code.
</I>
Good point. I've added .startTime to expose this, and made timeupdate fire 
if the value changes.


On Mon, 6 Apr 2009, Eric Carlson wrote:
&gt;<i>
</I>&gt;<i>   A media file with a non-zero initial time stamp is not new to 
</I>&gt;<i> oggz-chopped files (eg. an MPEG stream initial PTS can have any value, 
</I>&gt;<i> SMPTE time-codes do not necessarily start at zero, etc), but I disagree 
</I>&gt;<i> that we need a new attribute to handle it.
</I>&gt;<i> 
</I>&gt;<i>   Media time values are expressed in normal play time (NPT), the 
</I>&gt;<i> absolute position relative to the beginning of the presentation. It is 
</I>&gt;<i> the responsibility of the UA to map time zero of the element to the 
</I>&gt;<i> starting time of the media resource, whatever it may be.
</I>
On Tue, 7 Apr 2009, Robert O'Callahan wrote:
&gt;<i> 
</I>&gt;<i> What if a script wants to present UI that contains the time from the 
</I>&gt;<i> media resource?
</I>
On Tue, 7 Apr 2009, Philip J&#228;genstedt wrote:
&gt;<i> 
</I>&gt;<i> Indeed clarification is needed. In my opinion time 0 should correspond 
</I>&gt;<i> to the beginning of the media resource, no matter what the timeline of 
</I>&gt;<i> the container format says. This means that currentTime doesn't jump when 
</I>&gt;<i> playback begins and never goes beyond duration.
</I>
&gt;<i> Taking Ogg as an example, there's no requirement that the granulepos start at
</I>&gt;<i> zero nor does a non-zero granulepos imply any special semantics such as &quot;the
</I>&gt;<i> beginning of the file has been chopped off&quot;. A tool like oggz-chop might
</I>&gt;<i> retain the original granulepos of each packet or it could just as well adjust
</I>&gt;<i> the stream to start at granulepos 0. Neither is more correct than the other,
</I>&gt;<i> so I'd prefer we not try to infer anything from it, especially since such
</I>&gt;<i> low-level timing information might be hidden deep inside the platform media
</I>&gt;<i> framework (if it normalizes the time like XiphQT presumably does).
</I>&gt;<i> 
</I>&gt;<i> Perhaps we would like to have some way to express where a resource is
</I>&gt;<i> positioned on a timeline external to the resource itself, but could SMIL do
</I>&gt;<i> this perhaps?
</I>&gt;<i> 
</I>&gt;<i> I suppose that an UA could parse the media fragment in the URL and 
</I>&gt;<i> adjust the timeline accordingly, but I'm not sure if it's a great 
</I>&gt;<i> idea...
</I>
On Tue, 7 Apr 2009, Conrad Parker wrote:
&gt;<i> 
</I>&gt;<i> For Ogg, the start time of the original file (prior to chopping) is 
</I>&gt;<i> recorded in the skeleton headers by oggz-chop, so this info is 
</I>&gt;<i> intrinsically in the media format itself.
</I>
On Tue, 7 Apr 2009, Silvia Pfeiffer wrote:
&gt;<i> 
</I>&gt;<i> I humbly disagree. If a media file explicitly knows at what time offset 
</I>&gt;<i> it starts, the timeline needs to represent that, otherwise there are 
</I>&gt;<i> contradictory user experiences.
</I>&gt;<i> 
</I>&gt;<i> For example, take a video that is a subpart of a larger video and has 
</I>&gt;<i> been delivered through a media fragment URI 
</I>&gt;<i> (<A HREF="http://www.w3.org/2008/WebVideo/Fragments/WD-media-fragments-reqs/">http://www.w3.org/2008/WebVideo/Fragments/WD-media-fragments-reqs/</A>). 
</I>&gt;<i> When a user watches both, the fragment and the full resource, and both 
</I>&gt;<i> start at 0, he/she will assume they are different resources, when in 
</I>&gt;<i> fact one is just a fragment of the other. Worse still: if he/she tries 
</I>&gt;<i> to send a URI with a link to a specific time offset in the video to a 
</I>&gt;<i> friend, he/she will come up with diverging URIs based on whether he/she 
</I>&gt;<i> watched the fragment or the full resource. Representing the wrong 
</I>&gt;<i> timeline for a media fragment will only cause confusion and 
</I>&gt;<i> inconsistencies.
</I>
On Tue, 7 Apr 2009, Philip J&#228;genstedt wrote:
&gt;<i> 
</I>&gt;<i> If the media resource really does explicitly define an offset then I 
</I>&gt;<i> might agree that it makes sense to adjust the timeline.
</I>&gt;<i> 
</I>&gt;<i> However, for plain Ogg or any other container format that just happens 
</I>&gt;<i> to have a non-zero timestamp at the beginning of the file I think we 
</I>&gt;<i> should definitely align them to zero. You can get such files easily by 
</I>&gt;<i> cutting streams and it would be confusing if the timeline was relative 
</I>&gt;<i> to the original file. As an example, in MPEG the PTS (Presentation Time 
</I>&gt;<i> Stamp) can start at non-zero, be discontinuos and wrap around 0 so 
</I>&gt;<i> normalization is necessary. I'm not sure if anyone disagrees, but it 
</I>&gt;<i> would be a very bad idea to infer any semantics from the container time 
</I>&gt;<i> stamps in the absense of some explicit mapping like Ogg Skeleton.
</I>&gt;<i> 
</I>&gt;<i> Not generally requiring low-level inspection of the container format 
</I>&gt;<i> time stamps is important to us as that would virtually require that the 
</I>&gt;<i> UA itself to demux and inspect the time stamps of different container 
</I>&gt;<i> formats. If a platform media framework is used, time is normalized in 
</I>&gt;<i> some way, likely differently depending on framework and plugins used.
</I>
On Tue, 7 Apr 2009, Ralph Giles wrote:
&gt;<i>
</I>&gt;<i> There is a ui problem here, in that the 'seek bar' control typically 
</I>&gt;<i> displayed by web video players has finite resolution. It works great for 
</I>&gt;<i> short-form clips a la YouTube, but a 30 second segment of a two hour 
</I>&gt;<i> movie amounts to a few pixels. Displaying such a fragment in the context 
</I>&gt;<i> of the complete work makes a linear progress bar useless for seeking 
</I>&gt;<i> within the fragment itself, everything having been traded for showing 
</I>&gt;<i> that it's part of a much larger resource. Never mind that a temporal url 
</I>&gt;<i> can equally well reference a five minute section of a 20000 hour webcam 
</I>&gt;<i> archive.
</I>&gt;<i> 
</I>&gt;<i> Showing a fragment in context is helpful, not just for the time offset, 
</I>&gt;<i> but cue points, related resources, and so on. The default controls the 
</I>&gt;<i> browser provides can't encompass all possible context interfaces, so 
</I>&gt;<i> perhaps the focus here should be on what is necessary to enable scripts 
</I>&gt;<i> (or browser vendors) to build more complicated interfaces when they're 
</I>&gt;<i> appropriate.
</I>
On Wed, 8 Apr 2009, Silvia Pfeiffer wrote:
&gt;<i> 
</I>&gt;<i> I think there is a misunderstanding here. The suggestion is not to 
</I>&gt;<i> display the full timeline of the original resource and specially mark 
</I>&gt;<i> the fragment, but to start and end the timeline with the in and out 
</I>&gt;<i> times of the fragment. I mentioned &quot;context&quot; only in that the in and out 
</I>&gt;<i> times imply that the media resource is a fragment of a larger resource. 
</I>&gt;<i> Not that the full context is actually displayed in the timeline.
</I>
On Tue, 7 Apr 2009, David Singer wrote:
&gt;<i>
</I>&gt;<i> I think that there is a very real difference between the 
</I>&gt;<i> zero-to-duration 'seek bar' that the UI presents, and which users 
</I>&gt;<i> understand, from the 'represented time' of the content.  That might be a 
</I>&gt;<i> section of a movie, or indeed might be a section of real time-of-day 
</I>&gt;<i> (think of one of the millions of british surveillance cameras..., or not 
</I>&gt;<i> if you'd prefer not to).  Getting &quot;what time is this media resource 
</I>&gt;<i> talking about&quot; is a metadata question...
</I>
I have left the spec as is (except for adding startTime), which means that 
currentTime can be greater than duration if startTime is not zero.

The UI is up to the UA, but the information is present now for all of the 
UIs described above to be rendered, I believe.



On Tue, 7 Apr 2009, David Singer wrote:
&gt;<i> 
</I>&gt;<i> If a URL asks for
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.example.com/t.mov?time=">http://www.example.com/t.mov?time=</A>&quot;10s-20s&quot;
</I>&gt;<i> 
</I>&gt;<i> it's clear that all I have at the UA is a 10s clip, so that's what I 
</I>&gt;<i> present; the ? means the trimming is done at the server.
</I>&gt;<i> 
</I>&gt;<i> However, if I am given
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.example.com/t.mov#time=">http://www.example.com/t.mov#time=</A>&quot;10s-20s&quot;
</I>&gt;<i> 
</I>&gt;<i> which means the UA does the selecting;  should the UA present a timeline
</I>&gt;<i> representing all of t.mov, but start at 10s into it and stop at 20s, allowing
</I>&gt;<i> the user (if they wish) to seek outside that range, or should the UA present
</I>&gt;<i> (as in the query case) only a 10s clip?
</I>
The UA should allow seeking to all times (at least from the API; the UI 
could be limited I guess).


On Wed, 8 Apr 2009, Silvia Pfeiffer wrote:
&gt;<i> 
</I>&gt;<i> Note that in the Media Fragment working group even the specification of 
</I>&gt;<i> <A HREF="http://www.example.com/t.mov#time=">http://www.example.com/t.mov#time=</A>&quot;10s-20s&quot; may mean that only the 
</I>&gt;<i> requested 10s clip is delivered, especially if all the involved 
</I>&gt;<i> instances in the exchange understand media fragment URIs.
</I>
That doesn't seem possible since fragments aren't sent to the server.


On Thu, 9 Apr 2009, Jonas Sicking wrote:
&gt;<i> 
</I>&gt;<i> If we look at how fragment identifiers work in web pages today, a link 
</I>&gt;<i> such as
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://example.com/page.html#target">http://example.com/page.html#target</A>
</I>&gt;<i> 
</I>&gt;<i> this displays the 'target' part of the page, but lets the user scroll to 
</I>&gt;<i> anywhere in the resource. This feels to me like it maps fairly well to
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://example.com/video.ogg#t=5s">http://example.com/video.ogg#t=5s</A>
</I>&gt;<i> 
</I>&gt;<i> displaying the selected frame, but displaying a timeline for the full 
</I>&gt;<i> video and allowing the user to directly go to any position.
</I>
Agreed. This is how the spec works now.

# Once enough of the media data has been fetched to determine the duration 
# of the media resource, its dimensions, and other metadata
# [...]
# 
# 6. If either the media resource or the address of the current media 
# resource indicate a particular start time, then seek to that time. 
# [...]
#
# || For example, a fragment identifier could be used to indicate a start 
# || position.


&gt;<i> But I also agree that there is a use case for directing the user to a 
</I>&gt;<i> specific range of the video, such as your 30 second clip out of 5 hour 
</I>&gt;<i> video example. Maybe this could be done with syntax like
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://example.com/video.ogg#r=3600s-3630s">http://example.com/video.ogg#r=3600s-3630s</A>
</I>
Currently the spec has no way to indicate a stop time from the fragment 
identifier or other out-of-band information, but I agree that we might 
need to add something like that (e.g. implying a default cue range with 
autopause-on-exit enabled) at some point.


On Wed, 8 Apr 2009, Silvia Pfeiffer wrote:
&gt;<i> 
</I>&gt;<i> Most videos nowadays are sent using HTTP - in particular YouTube videos. 
</I>&gt;<i> But we (in the media fragments WG) do indeed include RTP/RTSP as another 
</I>&gt;<i> protocol that already includes mechanisms for requesting time fragments.
</I>
It certainly would be nice for videos to be sent using a more appropriate 
protocol than HTTP.

-- 
Ian Hickson               U+1047E                )\._.,--....,'``.    fL
<A HREF="http://ln.hixie.ch/">http://ln.hixie.ch/</A>       U+263A                /,   _.. \   _\  ;`._ ,.
Things that are impossible just take longer.   `._.-(,_..'--(,_..'`-.;.'
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="061496.html">[whatwg] Start position of media resources
</A></li>
	<LI>Next message: <A HREF="061791.html">[whatwg] Start position of media resources
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61789">[ date ]</a>
              <a href="thread.html#61789">[ thread ]</a>
              <a href="subject.html#61789">[ subject ]</a>
              <a href="author.html#61789">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
