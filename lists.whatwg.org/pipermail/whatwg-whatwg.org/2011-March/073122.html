<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Redirect handling for &lt;audio&gt; &amp; &lt;video&gt;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Redirect%20handling%20for%20%3Caudio%3E%20%26%20%3Cvideo%3E&In-Reply-To=%3Cop.vr4bqancsr6mfa%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="073119.html">
   <LINK REL="Next"  HREF="030796.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Redirect handling for &lt;audio&gt; &amp; &lt;video&gt;</H1>
<!--htdig_noindex-->
    <B>Philip J&#228;genstedt</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Redirect%20handling%20for%20%3Caudio%3E%20%26%20%3Cvideo%3E&In-Reply-To=%3Cop.vr4bqancsr6mfa%40localhost.localdomain%3E"
       TITLE="[whatwg] Redirect handling for &lt;audio&gt; &amp; &lt;video&gt;">philipj at opera.com
       </A><BR>
    <I>Thu Mar 10 00:12:00 PST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="073119.html">[whatwg] Redirect handling for &lt;audio&gt; &amp; &lt;video&gt;
</A></li>
        <LI>Next message: <A HREF="030796.html">[whatwg] [html5] r5928 - [acgiow] (0) Drop forminput and formchange events, and their associated machiner [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73122">[ date ]</a>
              <a href="thread.html#73122">[ thread ]</a>
              <a href="subject.html#73122">[ subject ]</a>
              <a href="author.html#73122">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Wed, 09 Mar 2011 19:48:30 +0100, Aaron Colwell &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">acolwell at google.com</A>&gt;  
wrote:

&gt;<i> Thanks for your response.. comments inline
</I>&gt;<i>
</I>&gt;<i> On Fri, Mar 4, 2011 at 1:30 AM, Philip J&#228;genstedt &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">philipj at opera.com</A>&gt;  
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Thu, 03 Mar 2011 22:15:58 +0100, Aaron Colwell &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">acolwell at google.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I was looking at the resource fetch
</I>&gt;&gt;&gt;<i> algorithm&lt;
</I>&gt;&gt;&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/video.html#concept-media-load-resource">http://www.whatwg.org/specs/web-apps/current-work/multipage/video.html#concept-media-load-resource</A>
</I>&gt;&gt;&gt;<i> &gt;section
</I>&gt;&gt;&gt;<i> and fetching
</I>&gt;&gt;&gt;<i> resources &lt;
</I>&gt;&gt;&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/urls.html#fetch">http://www.whatwg.org/specs/web-apps/current-work/multipage/urls.html#fetch</A>
</I>&gt;&gt;&gt;<i> &gt;
</I>&gt;&gt;&gt;<i> sections of the HTML5 spec to determine what the proper behavior is for
</I>&gt;&gt;&gt;<i> handling
</I>&gt;&gt;&gt;<i> redirects. Both YouTube and Vimeo do 302 redirects to different  
</I>&gt;&gt;&gt;<i> hostnames
</I>&gt;&gt;&gt;<i> from
</I>&gt;&gt;&gt;<i> the URLs specified in the src attribute. It looks like the spec says  
</I>&gt;&gt;&gt;<i> that
</I>&gt;&gt;&gt;<i> playback should fail in these cases because they are from different
</I>&gt;&gt;&gt;<i> origins (Section 2.7 Fetching resources bullet 7). This leads me to a  
</I>&gt;&gt;&gt;<i> few
</I>&gt;&gt;&gt;<i> questions.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1. Is my interpretation of the spec correct? Sample YouTube &amp; Vimeo  
</I>&gt;&gt;&gt;<i> URLs
</I>&gt;&gt;&gt;<i> are
</I>&gt;&gt;&gt;<i>   shown below.
</I>&gt;&gt;&gt;<i>   YouTube : src      : <A HREF="http://v22.lscache6.c.youtube.com/videoplayback?">http://v22.lscache6.c.youtube.com/videoplayback?</A>
</I>&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i>             redirect :  
</I>&gt;&gt;&gt;<i> <A HREF="http://tc.v22.cache6.c.youtube.com/videoplayback?">http://tc.v22.cache6.c.youtube.com/videoplayback?</A>
</I>&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   Vimeo   : src      : <A HREF="http://player.vimeo.com/play_redirect?">http://player.vimeo.com/play_redirect?</A> ...
</I>&gt;&gt;&gt;<i>             redirect : <A HREF="http://av.vimeo.com/05">http://av.vimeo.com/05</A> ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, from what I can tell you're correct, but I think it's not  
</I>&gt;&gt;<i> intentional.
</I>&gt;&gt;<i> The behavior was changed by &lt;<A HREF="http://html5.org/r/5111">http://html5.org/r/5111</A>&gt; in 2010-06-25, and
</I>&gt;&gt;<i> this is the first time I've noticed it. Opera (and I assume most if not  
</I>&gt;&gt;<i> all
</I>&gt;&gt;<i> other browsers) already supports HTTP redirects for &lt;video&gt; and I don't
</I>&gt;&gt;<i> think it makes much sense to disallow it. For security purposes, the  
</I>&gt;&gt;<i> origin
</I>&gt;&gt;<i> of the resource is considered to be the final destination, not any of  
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> origins in the redirect chain.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I agree that redirects should be allowed, but it seems like the force
</I>&gt;<i> same-origin flag was introduced to limit the types of redirects. The  
</I>&gt;<i> YouTube
</I>&gt;<i> &amp; Vimeo cases mentioned above seem reasonable, but redirects from  
</I>&gt;<i> vimeo.comto malicious-site.com might not be ok.
</I>
As far as I can tell, there's no difference between the YouTube/Vimeo  
cases and redirecting to malicious-site.com. In both cases, they redirect  
to another origin, so the exact same thing should happen. Besides, if a  
good site redirects to an evil site, that's your problem right there. The  
only issue I'm aware of is if an evil site redirecting to good site, in  
the hope that the origin of the resource would still be considered evil  
site, so that they can read out pixel data, etc. That would be a browser  
bug, though.

&gt;<i> It looks like the changes reference CORS
</I>&gt;<i> as a future solution. Do you have any CORS references that might be  
</I>&gt;<i> helpful?
</I>
Nothing beyond &lt;<A HREF="http://www.w3.org/TR/cors/">http://www.w3.org/TR/cors/</A>&gt;, no. Anne is the editor and is  
on this list so he'll know more if you have specific questions.

&gt;<i> You also mentioned that the final destination is what should be used for
</I>&gt;<i> security. It seems like this could cause problems for canvas.drawImage()  
</I>&gt;<i> (
</I>&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/#security-with-canvas-elements">http://www.whatwg.org/specs/web-apps/current-work/#security-with-canvas-elements</A>)
</I>&gt;<i> when trying copy video data to the canvas. If I understand you correctly  
</I>&gt;<i> a
</I>&gt;<i> page on YouTube would have to come from the final destination origin to
</I>&gt;<i> allow canvas.drawImage() to work. Is that correct?
</I>
The details of this is outlined in  
&lt;<A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#security-with-canvas-elements">http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#security-with-canvas-elements</A>&gt;.

The case you mention is this one:

&quot;The element's 2D context's drawImage() method is called with an  
HTMLImageElement or an HTMLVideoElement whose origin is not the same as  
that of the Document object that owns the canvas element.&quot;

However, since the spec now says that redirecting video cross-origin  
should just fail, it doesn't match what at least Opera actually does here.

&gt;&gt;<i>  2. What about http: -&gt; https: redirects? Some content is required to be
</I>&gt;&gt;&gt;<i> delivered
</I>&gt;&gt;&gt;<i>   only via https and this sort of redirect enforces that but isn't  
</I>&gt;&gt;&gt;<i> really
</I>&gt;&gt;&gt;<i> a
</I>&gt;&gt;&gt;<i> different origin.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Quoting &lt;
</I>&gt;&gt;<i> <A HREF="http://tools.ietf.org/html/draft-abarth-principles-of-origin-00#section-3">http://tools.ietf.org/html/draft-abarth-principles-of-origin-00#section-3</A>
</I>&gt;&gt;<i> &gt;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;two URLs are part of the same origin (i.e., represent the same  
</I>&gt;&gt;<i> principal)
</I>&gt;&gt;<i> if they have the same scheme, host, and port&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Since both the scheme (http vs https) and port (80 vs 443) would be
</I>&gt;&gt;<i> different, it's considered a different origin.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I think I made some poor word choices here. I agree that they are  
</I>&gt;<i> different
</I>&gt;<i> origins because the scheme and port are different. I was just trying to  
</I>&gt;<i> get
</I>&gt;<i> at the fact they still referred to the same content just over a secure
</I>&gt;<i> connection. It seems like there are use cases where a set of &lt;scheme,  
</I>&gt;<i> host,
</I>&gt;<i> port&gt; tuples should be considered a single origin from a security point  
</I>&gt;<i> of
</I>&gt;<i> view. It just isn't clear to me how we are supposed to express that.
</I>
What problem does this solve, though?

&gt;&gt;<i>  3. If my interpretation of the spec is correct, are there proposals to
</I>&gt;&gt;&gt;<i> change this
</I>&gt;&gt;&gt;<i>   or other specs that allow content providers to signal that these
</I>&gt;&gt;&gt;<i> different hostnames
</I>&gt;&gt;&gt;<i>   actually represent the same &quot;origin&quot;.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I think the force same-origin flag introduced by  
</I>&gt;&gt;<i> &lt;<A HREF="http://html5.org/r/5111">http://html5.org/r/5111</A>&gt;
</I>&gt;&gt;<i> should be removed from the resource fetch algorithm, but the http vs  
</I>&gt;&gt;<i> https
</I>&gt;&gt;<i> origin issue is not something that can really be changed.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So what is the process for proposing this type of change? Is this the  
</I>&gt;<i> right
</I>&gt;<i> forum?
</I>&gt;<i> Why is allowing redirects with the same scheme but different hosts ok,  
</I>&gt;<i> but
</I>&gt;<i> redirecting different schemes with the same host not ok? I'm new to this  
</I>&gt;<i> so
</I>&gt;<i> I'm just trying to understand.
</I>
There is no strict process here, but I suppose if you want to change or  
invent new security models, this is as good a forum as any. Step 1 would  
be explaining what the problem you want to solve is, not a specific  
solution you have in mind.

-- 
Philip J&#228;genstedt
Core Developer
Opera Software

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="073119.html">[whatwg] Redirect handling for &lt;audio&gt; &amp; &lt;video&gt;
</A></li>
	<LI>Next message: <A HREF="030796.html">[whatwg] [html5] r5928 - [acgiow] (0) Drop forminput and formchange events, and their associated machiner [...]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73122">[ date ]</a>
              <a href="thread.html#73122">[ thread ]</a>
              <a href="subject.html#73122">[ subject ]</a>
              <a href="author.html#73122">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
