<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Ongoing work on an editing commands (execCommand()) specification
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Ongoing%20work%20on%20an%20editing%20commands%20%28execCommand%28%29%29%0A%20specification&In-Reply-To=%3C825518243.15450.1300751710488.JavaMail.root%40cm-mail03.mozilla.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="073076.html">
   <LINK REL="Next"  HREF="073243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Ongoing work on an editing commands (execCommand()) specification</H1>
<!--htdig_noindex-->
    <B>Ehsan Akhgari</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Ongoing%20work%20on%20an%20editing%20commands%20%28execCommand%28%29%29%0A%20specification&In-Reply-To=%3C825518243.15450.1300751710488.JavaMail.root%40cm-mail03.mozilla.org%3E"
       TITLE="[whatwg] Ongoing work on an editing commands (execCommand()) specification">ehsan at mozilla.com
       </A><BR>
    <I>Mon Mar 21 16:55:10 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="073076.html">[whatwg] Ongoing work on an editing commands (execCommand()) specification
</A></li>
        <LI>Next message: <A HREF="073243.html">[whatwg] Ongoing work on an editing commands (execCommand())	specification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73242">[ date ]</a>
              <a href="thread.html#73242">[ thread ]</a>
              <a href="subject.html#73242">[ subject ]</a>
              <a href="author.html#73242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>----- Original Message -----
&gt;<i> From: &quot;Aryeh Gregor&quot; &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">Simetrical+w3c at gmail.com</A>&gt;
</I>&gt;<i> To: &quot;Ehsan Akhgari&quot; &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ehsan.akhgari at gmail.com</A>&gt;
</I>&gt;<i> Cc: &quot;whatwg&quot; &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">whatwg at lists.whatwg.org</A>&gt;, <A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ehsan at mozilla.com</A>, &quot;Hallvord R. M. Steen&quot; &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">hallvord at opera.com</A>&gt;, &quot;Ryosuke Niwa&quot;
</I>&gt;<i> &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">rniwa at webkit.org</A>&gt;
</I>&gt;<i> Sent: Monday, March 21, 2011 1:25:40 PM
</I>&gt;<i> Subject: Re: [whatwg] Ongoing work on an editing commands (execCommand()) specification
</I>&gt;<i> On Sat, Mar 19, 2011 at 1:23 AM, Ehsan Akhgari
</I>&gt;<i> &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ehsan.akhgari at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; I don't think this is a useful argument for not supporting the CSS
</I>&gt;<i> &gt; mode.
</I>&gt;<i> &gt; &#160;But if you're looking for examples, a quick Google search suggested
</I>&gt;<i> &gt; &#160;that
</I>&gt;<i> &gt; elRTE can take advantage of the CSS mode (possibly among many other
</I>&gt;<i> &gt; rich
</I>&gt;<i> &gt; text editing frameworks).
</I>&gt;<i> 
</I>&gt;<i> As I said, I looked at three rich-text frameworks that used
</I>&gt;<i> execCommand(), and all three forced styleWithCSS to false. You're
</I>&gt;<i> right that elRTE has a styleWithCSS option, but it defaults to false,
</I>&gt;<i> so by default elRTE also forces styleWithCSS off. Theoretically a
</I>&gt;<i> site using it could re-enable it, but are you aware of any site
</I>&gt;<i> actually doing so? Just because the software supports it doesn't mean
</I>&gt;<i> anyone uses the feature.
</I>
Like I said, I don't see why this is a useful argument.  I just meant to give you an example of somewhere that can use the CSS mode, and I didn't spend more than 2 minutes in googling until I found the first result.

You're proposing to remove something from Gecko and Webkit which has been supported for many years (about 8 years for Gecko).  We do not have the ability to make sure that nobody is relying on this in any of the billions of available web sites.  Unless you have a very strong argument on why we should remove support for an API as old as this one, I'm not sure that we're going to do that, and I think that Webkit might have similar constraints as well.  So far, the argument that you've proposed is extrapolating the assumption that this API doesn't have any users from three implementations which use the editing APIs.  I'm afraid you should have a _much_ larger sample if you want to draw this conclusion.

I would personally very much like to get one of the two modes killed in favor of the other, since that means an easier spec to implement, less code to maintain, and easier life for me.  But I think we should carefully think about what this would means for potential users who are using the CSS mode in their applications.

&gt;<i> In the face of arbitrary non-inline CSS rules, you can't rely on
</I>&gt;<i> cascading to work either. What my current spec does is first try to
</I>&gt;<i> wrap things with tags, because that produces the nicest markup. It
</I>&gt;<i> then checks if the desired style is actually present, and if not,
</I>&gt;<i> forces it using additional tags or inline CSS. For instance, when
</I>&gt;<i> bolding
</I>&gt;<i> 
</I>&gt;<i> Foo&lt;span class=&quot;notbold&quot;&gt;bar&lt;/span&gt;baz
</I>&gt;<i> 
</I>&gt;<i> (where there's a rule .notbold { font-weight: normal }) I produce
</I>&gt;<i> 
</I>&gt;<i> &lt;b&gt;Foo&lt;span class=&quot;notbold&quot;&gt;&lt;b&gt;bar&lt;/b&gt;&lt;/span&gt;baz&lt;/b&gt;
</I>&gt;<i> 
</I>&gt;<i> while WebKit and Gecko both produce
</I>&gt;<i> 
</I>&gt;<i> &lt;b&gt;Foo&lt;span class=&quot;notbold&quot;&gt;bar&lt;/span&gt;baz&lt;/b&gt;
</I>&gt;<i> 
</I>&gt;<i> which gives incorrect appearance. In styleWithCSS mode, Gecko and
</I>&gt;<i> WebKit respectively produce
</I>&gt;<i> 
</I>&gt;<i> &lt;div style=&quot;font-weight: bold;&quot;&gt;Foo&lt;span
</I>&gt;<i> class=&quot;notbold&quot;&gt;bar&lt;/span&gt;baz&lt;/div&gt;
</I>&gt;<i> 
</I>&gt;<i> (applying the style to the container) and
</I>&gt;<i> 
</I>&gt;<i> &lt;span class=&quot;Apple-style-span&quot; style=&quot;font-weight: bold;&quot;&gt;Foo&lt;span
</I>&gt;<i> class=&quot;notbold&quot;&gt;bar&lt;/span&gt;baz&lt;/span&gt;
</I>&gt;<i> 
</I>&gt;<i> which again both give incorrect appearance.
</I>&gt;<i> 
</I>&gt;<i> If I add b, strong { font-weight: normal } to my stylesheet, my
</I>&gt;<i> algorithm starts using &lt;b style=&quot;font-weight: bold&quot;&gt;, which works just
</I>&gt;<i> as well as &lt;span style=&quot;font-weight: bold&quot;&gt; and is slightly shorter.
</I>&gt;<i> 
</I>&gt;<i> So, I don't think this is a legitimate use-case. Whether in CSS mode
</I>&gt;<i> or not, the algorithm should be robust enough to deal with conflicting
</I>&gt;<i> style rules -- the issue you raise is orthogonal.
</I>
It's not orthogonal, in fact.  I was talking about the case where you don't have control (or knowledge) of the target page's CSS rules.  Your algorithm works based on this knowledge.  The correct solution to your first example is this markup, FWIW:

&lt;span style=&quot;font-weight: bold&quot;&gt;Foo&lt;span class=&quot;notbold&quot; style=&quot;font-weight: bold&quot;&gt;bar&lt;/span&gt;baz&lt;/span&gt;

&gt;<i> &gt; Non-CSS mode: Suppose that you're writing a web based email editor.
</I>&gt;<i> &gt; Your
</I>&gt;<i> &gt; task is to create HTML emails, and automatically format the
</I>&gt;<i> &gt; plaintext
</I>&gt;<i> &gt; version of the email on the server side using simple rules such as
</I>&gt;<i> &gt; wrapping
</I>&gt;<i> &gt; bold text with asterisks, or italic text with underscores. You can
</I>&gt;<i> &gt; set the
</I>&gt;<i> &gt; client side editor to use the non-CSS mode, and then use an
</I>&gt;<i> &gt; off-the-shelf
</I>&gt;<i> &gt; Python HTML parser library to parse the simple HTML tags and replace
</I>&gt;<i> &gt; them
</I>&gt;<i> &gt; with the correct characters. Having to deal with CSS in that case
</I>&gt;<i> &gt; means that
</I>&gt;<i> &gt; you have to write a full-blown CSS parser and support style
</I>&gt;<i> &gt; resolution on
</I>&gt;<i> &gt; each node, which is not trivial.
</I>&gt;<i> 
</I>&gt;<i> I agree that there are use-cases for not relying on CSS. I also agree
</I>&gt;<i> that there are use-cases for producing only conforming markup.
</I>&gt;<i> However, I don't see the use-cases for outputting &lt;span
</I>&gt;<i> style=&quot;font-weight: bold&quot;&gt; instead of &lt;b&gt; (et al.).
</I>
I presented one sample use case.  It's easy to invent more.  :-)

&gt;<i> &gt; I can give you more examples for each case, but I think the above
</I>&gt;<i> &gt; two help
</I>&gt;<i> &gt; me to drive this point home: there are legit usecases for both
</I>&gt;<i> &gt; cases, and
</I>&gt;<i> &gt; since they've both been around for quite a while, I don't see the
</I>&gt;<i> &gt; existing
</I>&gt;<i> &gt; implementations drop this support (or even worse, adopt a mixed
</I>&gt;<i> &gt; mode).
</I>&gt;<i> &gt; &#160;Backwards compatibility is what this boils down to.
</I>&gt;<i> 
</I>&gt;<i> In the end I'm going to have to go with what implementers want to
</I>&gt;<i> implement here, but I'm still going to argue a bit more. :) The four
</I>&gt;<i> execCommand()-using rich text editors I've looked at so far all force
</I>&gt;<i> styleWithCSS to false. I'm planning to also look at some major
</I>&gt;<i> webmail clients' use of execCommand(), but I'm practically certain
</I>&gt;<i> they'll also force styleWithCSS false, because otherwise their mail
</I>&gt;<i> won't display right in (at least) Blackberry. Likewise, if you look
</I>&gt;<i> at the bug requesting that WebKit support styleWithCSS
</I>&gt;<i> &lt;<A HREF="https://bugs.webkit.org/show_bug.cgi?id=13490">https://bugs.webkit.org/show_bug.cgi?id=13490</A>&gt;, it seems clear that
</I>&gt;<i> what the users there want is for WebKit to output things like &lt;b&gt;
</I>&gt;<i> instead of CSS, i.e., they just want WebKit to support it so they can
</I>&gt;<i> set it to false.
</I>&gt;<i> 
</I>&gt;<i> So I see lots of users who want styleWithCSS false, and not a single
</I>&gt;<i> one yet who wants it true.
</I>
As I said above, I don't think that your sample set is large enough for drawing that conclusion.

&gt;<i> I can't see a backward-compatibility issue
</I>&gt;<i> when there are no known sites that use of the feature, *and* when IE
</I>&gt;<i> and Opera have never supported it.
</I>
Unfortunately, most rich text editing applications on the web have lots of browser specific hacks to work around the bugs in the implementations, so they may easily maintain Gecko/Webkit specific code.

&gt;<i> You probably know better than me, but I'm guessing the history of this
</I>&gt;<i> feature went something like this:
</I>&gt;<i> 
</I>&gt;<i> * In September 1997, Microsoft introduces the API in IE4. CSS is a
</I>&gt;<i> new technology that only cutting-edge browsers have support for, so
</I>&gt;<i> they output only tags like &lt;font&gt; and &lt;b&gt;, not CSS.
</I>&gt;<i> * In March 2003, Mozilla clones the API in Mozilla 1.3. CSS is now
</I>&gt;<i> well-established and widely supported, and tags like &lt;font&gt; and &lt;b&gt;
</I>&gt;<i> are banned in HTML 4 Strict and XHTML 1 Strict. XHTML 2 removes them
</I>&gt;<i> from the language entirely. Thus Mozilla uses CSS instead. For
</I>&gt;<i> compatibility with IE or due to author demand or something, they also
</I>&gt;<i> add a useCSS feature to let you use deprecated tags instead, if you
</I>&gt;<i> don't care about conformance or use transitional formats.
</I>
This dates back to before my time here at Mozilla, so I don't really know, and unfortunately there is nobody that I know of who knows why they really chose to do things the way that they did!

&gt;<i> If this is the case, the fact that styleWithCSS doesn't output tags
</I>&gt;<i> like &lt;b&gt; or &lt;i&gt; is because they happened not to be valid when it was
</I>&gt;<i> first devised. This is no longer relevant today. But there will be
</I>&gt;<i> authors today who want conforming markup that's *also* as short as
</I>&gt;<i> possible, which is what my proposed revision of styleWithCSS = true
</I>&gt;<i> gives -- something that's demonstrably useful.
</I>
Something that I meant to mention elsewhere in the thread: simpler DOM structure is for sure better, but I'm not sure there's much value to try to make the string representation of the generated DOM as short as possible.

&gt;<i> &gt; I think simpler DOM structures should be preferred, and we can't
</I>&gt;<i> &gt; give away
</I>&gt;<i> &gt; simple DOM structures for the sake of simpler algorithms. Browsers
</I>&gt;<i> &gt; tend to
</I>&gt;<i> &gt; have buggier behavior when it comes to editing more complex DOM
</I>&gt;<i> &gt; structures,
</I>&gt;<i> &gt; and one should also keep in mind that editing operations are
</I>&gt;<i> &gt; additive:
</I>&gt;<i> &gt; having one command generate a complex DOM would cause the next one
</I>&gt;<i> &gt; to
</I>&gt;<i> &gt; generate even more complex DOM, and so on.
</I>&gt;<i> 
</I>&gt;<i> I've rewritten my algorithm to produce (IMO) better markup in all
</I>&gt;<i> cases than any existing browsers. There are only a few cases I've
</I>&gt;<i> thrown at it where it produces markup that's worse than I'd produce by
</I>&gt;<i> hand, like
</I>&gt;<i> 
</I>&gt;<i> &lt;i&gt;&lt;b&gt;Foo&lt;/b&gt;&lt;/i&gt;bar&lt;i&gt;&lt;b&gt;baz&lt;/b&gt;&lt;/i&gt;
</I>&gt;<i> 
</I>&gt;<i> becoming (when you bold &quot;bar&quot;)
</I>&gt;<i> 
</I>&gt;<i> &lt;i&gt;&lt;b&gt;Foo&lt;/b&gt;&lt;/i&gt;&lt;b&gt;bar&lt;/b&gt;&lt;i&gt;&lt;b&gt;baz&lt;/b&gt;&lt;/i&gt;
</I>&gt;<i> 
</I>&gt;<i> instead of
</I>&gt;<i> 
</I>&gt;<i> &lt;b&gt;&lt;i&gt;Foo&lt;/i&gt;bar&lt;i&gt;baz&lt;/i&gt;&lt;/b&gt;
</I>&gt;<i> 
</I>&gt;<i> but no browser I've looked at handles that better. (Maybe I'll update
</I>&gt;<i> the algorithm to handle it, too -- it's probably not that uncommon in
</I>&gt;<i> practice.)
</I>
Yes, I actually think that this is a nice optimization to have in the algorithm.

&gt;<i> On Sat, Mar 19, 2011 at 1:39 AM, Ehsan Akhgari
</I>&gt;<i> &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ehsan.akhgari at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; I disagree. The editing behaviors of browsers are fairly consistent
</I>&gt;<i> &gt;&gt; across
</I>&gt;<i> &gt;&gt; browsers as of now even though they fail to deal with many edge
</I>&gt;<i> &gt;&gt; cases.
</I>&gt;<i> &gt;&gt; &#160;While we should try to spec and agree on those edge cases, we
</I>&gt;<i> &gt;&gt; &#160;shouldn't
</I>&gt;<i> &gt;&gt; suddenly change the overall editing behavior of execCommand at this
</I>&gt;<i> &gt;&gt; point.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I agree with Ryosuke here.
</I>&gt;<i> 
</I>&gt;<i> I also agree, in cases where browsers are actually consistent. Where
</I>&gt;<i> browsers agree, I won't spec anything different without compelling
</I>&gt;<i> reason. But browsers don't agree on styleWithCSS -- IE and Opera
</I>&gt;<i> don't implement it.
</I>
That's true, so we should decide whether we want to support it or not.

So far in this thread I haven't seen a clear-cut argument on whether (or not) the CSS mode should be supported.  The backward compatibility concerns outweigh the arguments towards the alternative of not specifying the CSS mode at this point, the way I see things.

But more thought and comments would definitely be appreciated!

Cheers,
--
Ehsan Akhgari
Mozilla Corporation
<A HREF="http://ehsanakhgari.org/">http://ehsanakhgari.org/</A>

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="073076.html">[whatwg] Ongoing work on an editing commands (execCommand()) specification
</A></li>
	<LI>Next message: <A HREF="073243.html">[whatwg] Ongoing work on an editing commands (execCommand())	specification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73242">[ date ]</a>
              <a href="thread.html#73242">[ thread ]</a>
              <a href="subject.html#73242">[ subject ]</a>
              <a href="author.html#73242">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
