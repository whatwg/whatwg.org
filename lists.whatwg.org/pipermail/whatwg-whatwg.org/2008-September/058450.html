<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] HTML5 Offline Web Applications
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20HTML5%20Offline%20Web%20Applications&In-Reply-To=%3C11e306600809051449t2af71di9a5050fb60a8fbe0%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="058449.html">
   <LINK REL="Next"  HREF="058451.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] HTML5 Offline Web Applications</H1>
<!--htdig_noindex-->
    <B>Robert O'Callahan</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20HTML5%20Offline%20Web%20Applications&In-Reply-To=%3C11e306600809051449t2af71di9a5050fb60a8fbe0%40mail.gmail.com%3E"
       TITLE="[whatwg] HTML5 Offline Web Applications">robert at ocallahan.org
       </A><BR>
    <I>Fri Sep  5 14:49:54 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="058449.html">[whatwg] HTML5 Offline Web Applications
</A></li>
        <LI>Next message: <A HREF="058451.html">[whatwg] HTML5 Offline Web Applications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58450">[ date ]</a>
              <a href="thread.html#58450">[ thread ]</a>
              <a href="subject.html#58450">[ subject ]</a>
              <a href="author.html#58450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Sat, Sep 6, 2008 at 8:46 AM, Chris Prince &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">cprince at google.com</A>&gt; wrote:

&gt;<i> I think Michael has some valid concerns here.  Specifically, where he says:
</I>&gt;<i>
</I>&gt;<i> - &quot;Where does appCache deletion happen?&quot;
</I>&gt;<i>
</I>&gt;<i> and
</I>&gt;<i>
</I>&gt;<i> - &quot;I think the appCache update/validation logic is fundamentally flawed
</I>&gt;<i>   with regard to resources that are not explicitly listed.&quot;
</I>&gt;<i>
</I>&gt;<i> Is anybody else working on the Offline Web Applications feature?
</I>&gt;<i>
</I>
Dave Camp and Honza Bombas at Mozilla (CCed).




&gt;<i>
</I>&gt;<i> --Chris
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, Aug 29, 2008 at 4:36 PM, Michael Nordman &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">michaeln at google.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; Hello again all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; A couple more comments.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When is anything ever deleted?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Maybe i missed it, but where does appCache deletion happen?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Something that Gears user's have done is to serve an empty manifest file.
</I>&gt;<i> &gt; The results are a close approximation to having deleted the resource
</I>&gt;<i> store.
</I>&gt;<i> &gt; I would vote to have some syntax for expressing 'delete me'  in the
</I>&gt;<i> manifest
</I>&gt;<i> &gt; file for an appCache. A new type of event may be warranted for completion
</I>&gt;<i> of
</I>&gt;<i> &gt; such an update, and when swapCache() is called there would no longer an
</I>&gt;<i> &gt; appCache associated with the context.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Should we revisit the caching semantics for any resource not explicitly
</I>&gt;<i> &gt; listed in the manifest?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Unless i missed something, I think the appCache update/validation logic
</I>&gt;<i> is
</I>&gt;<i> &gt; fundamentally flawed with regard to resources that are not explicitly
</I>&gt;<i> &gt; listed. As presently spec'd, a failure to update/validate any of these
</I>&gt;<i> &gt; resources causes the entire update to fail, and the old version will
</I>&gt;<i> &gt; remain pinned in the cache. Now suppose the app changes it's url space
</I>&gt;<i> such
</I>&gt;<i> &gt; that some of the resources that got picked up by one of the mechanisms to
</I>&gt;<i> &gt; add new resources (autocaching namespace or manually .add()ed or &lt;html
</I>&gt;<i> &gt; manifest=x&gt;) no longer make sense... i think this means the appCache is
</I>&gt;<i> &gt; stuck in time.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; One idea is to rephrase this feature in terms closer to std http caching
</I>&gt;<i> for
</I>&gt;<i> &gt; all entries that do not explicily appear in the manifest file. In
</I>&gt;<i> &gt; effect, closer to telling the http cache to not purge the resource.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * at initial cache time
</I>&gt;<i> &gt;   - cache the resource
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * at appCache update time
</I>&gt;<i> &gt;   - validate all non-explicit entries per usual http caching semantics
</I>&gt;<i> &gt;      (so 404s  will remove these entries at update time)
</I>&gt;<i> &gt;   - network/server errors do not fail the larger update
</I>&gt;<i> &gt;   - beyond that, not sure what todo on network/server errors... remove or
</I>&gt;<i> &gt; retain the resources?
</I>&gt;<i> &gt;   - perhaps maintain a list of 'failed to update' items that the webapp
</I>&gt;<i> can
</I>&gt;<i> &gt; access via script
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * at resource load time
</I>&gt;<i> &gt;   - validate per usual http caching rules going forward
</I>&gt;<i> &gt;     (so 404s will remove these entries)
</I>&gt;<i> &gt;   - with the following exceptions
</I>&gt;<i> &gt;      - use the cached resource as a fallback for network or server(5xx)
</I>&gt;<i> &gt; errors
</I>&gt;<i> &gt;      - do not purge the resource upon expiration
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Comments?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Mon, Aug 25, 2008 at 11:54 AM, Michael Nordman &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">michaeln at google.com</A>&gt;
</I>&gt;<i> &gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Hello all,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I have many comments on the Offline Web Applications corner of the HTML5
</I>&gt;<i> &gt;&gt; spec. This is the first round of comments you'll see coming from me.
</I>&gt;<i> This
</I>&gt;<i> &gt;&gt; one is mostly top-level comments.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; 5.7.2 Application caches
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I found the terminology used to describe the contents of the
</I>&gt;<i> &gt;&gt; cache sometimes contradictory and confusing, and it doesn't correspond
</I>&gt;<i> &gt;&gt; directly with the terminology used in the manifest file syntax. FWIW,
</I>&gt;<i> some
</I>&gt;<i> &gt;&gt; word smithing and reconciling the differences could add clarity to the
</I>&gt;<i> spec.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; cached resource categories
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * implicit category
</I>&gt;<i> &gt;&gt; This categorization applies to html docs which explicitly contain a
</I>&gt;<i> &gt;&gt; reference to the manifest file via the 'manifest' attribute of their
</I>&gt;<i> &lt;html&gt;
</I>&gt;<i> &gt;&gt; tag. I understand they are not necessarily explicitly listed in the
</I>&gt;<i> manifest
</I>&gt;<i> &gt;&gt; file, but they may also be explicitly listed. The end result is that a
</I>&gt;<i> &gt;&gt; resource can be categorized as both 'implicit' and 'explicit'. This is
</I>&gt;<i> &gt;&gt; confusing. I'd vote to have a different name for clarity sake... some
</I>&gt;<i> &gt;&gt; ideas... 'toplevel', 'manifest referencing', 'native' (an awkward play
</I>&gt;<i> on
</I>&gt;<i> &gt;&gt; foreign).
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * manifest category
</I>&gt;<i> &gt;&gt; Perfect.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * explicit category
</I>&gt;<i> &gt;&gt; Ok provided 'implicit' is renamed.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * fallback category
</I>&gt;<i> &gt;&gt; The term 'fallback' refers to the prescribed use of these resources for
</I>&gt;<i> &gt;&gt; the opportunistic-caching namespace in particular. As part of pulling
</I>&gt;<i> apart
</I>&gt;<i> &gt;&gt; namespaces vs how to handle hits within a namespace, I'd vote to change
</I>&gt;<i> the
</I>&gt;<i> &gt;&gt; name for this category... some ideas... 'namespace-handler'.  I'll say
</I>&gt;<i> more
</I>&gt;<i> &gt;&gt; more to say about different types of 'namespaces' below.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * opportunistcally cached category
</I>&gt;<i> &gt;&gt; A mouthful, but ok. Another possibility is 'auto-cached' which would
</I>&gt;<i> work
</I>&gt;<i> &gt;&gt; well with the 'manually-cached' terminology below.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * dynamic category
</I>&gt;<i> &gt;&gt; I'd like to reserve the term 'dynamic' for a different use of that term
</I>&gt;<i> &gt;&gt; (more on that in a moment).  Some name possibilites for this category...
</I>&gt;<i> &gt;&gt; 'manually-cached' or 'script-added' or 'programatically-added'.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;  flavors of namespaces
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * online whitelist
</I>&gt;<i> &gt;&gt; As mentioned in previous messages, this would need to be some form of
</I>&gt;<i> &gt;&gt; namespacing or filtering to be useful. A better term for this might be
</I>&gt;<i> &gt;&gt; 'bypass' since with respect to the appcache, hits here bypass the cache.
</I>&gt;<i> Its
</I>&gt;<i> &gt;&gt; not clear if path prefix matching is the best option for filtering out
</I>&gt;<i> &gt;&gt; request that should bypass the cache. In working with app developers
</I>&gt;<i> using
</I>&gt;<i> &gt;&gt; Gears, the idea of specifying a particular query argument to filter on
</I>&gt;<i> in
</I>&gt;<i> &gt;&gt; addition to a path prefix has come up. <A HREF="http://server/pathprefix">http://server/pathprefix</A>   +
</I>&gt;<i> &gt;&gt; &amp;bypassAppCache
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * opportunistic caching namespaces
</I>&gt;<i> &gt;&gt; A mouthful but ok. Whatever terminology used for the category of
</I>&gt;<i> resulting
</I>&gt;<i> &gt;&gt; entries should be used here... perhaps 'auto-caching namespace'.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * fallback namespace [factored out of opportunistic-caching]
</I>&gt;<i> &gt;&gt; This form of namespace is addressed by the spec at present, but is
</I>&gt;<i> &gt;&gt; co-mingled with the auto-caching feature. This is a proposal to detangle
</I>&gt;<i> &gt;&gt; them from one another. The basic idea is to load the resource as usual,
</I>&gt;<i> and
</I>&gt;<i> &gt;&gt; only upon failure fallback to a cached 'namespace-handler'... no
</I>&gt;<i> &gt;&gt; auto-caching involved.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * intercept namespaces [new]
</I>&gt;<i> &gt;&gt; This form of namespace is not in the spec at present. This is a proposal
</I>&gt;<i> &gt;&gt; to add it. It is a heavily used feature of the Gears LocalServer. The
</I>&gt;<i> basic
</I>&gt;<i> &gt;&gt; idea is to intercept requests into this namespace and satisfy them with
</I>&gt;<i> a
</I>&gt;<i> &gt;&gt; cached 'namespace-handler'  without consulting the server.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; summary of the above change requests
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Cached resource categories (just name changes):
</I>&gt;<i> &gt;&gt; * toplevel - pages which &lt;html manifest='manifesturlforthisappcache'&gt;
</I>&gt;<i> &gt;&gt; * manifest - the manifest file
</I>&gt;<i> &gt;&gt; * explicit - explicitly listed in the manifest file
</I>&gt;<i> &gt;&gt; * namespace-handler - resource which is utilized by a name-space
</I>&gt;<i> &gt;&gt; * auto-cached - resources that have been cached via the auto-cache
</I>&gt;<i> &gt;&gt; namespace
</I>&gt;<i> &gt;&gt; * manually-cached - resources that have been cached via a javascript
</I>&gt;<i> call
</I>&gt;<i> &gt;&gt; to appCache.add()
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Namespaces (name changes, refactored things a bit, and introduced the
</I>&gt;<i> &gt;&gt; 'intercept' namespace)
</I>&gt;<i> &gt;&gt; * bypass - bypasses further lookup within the appcache and resorts to
</I>&gt;<i> the
</I>&gt;<i> &gt;&gt; usual resource loading
</I>&gt;<i> &gt;&gt; * intercept - doesn't hit server, serves a cached namespace-handler
</I>&gt;<i> &gt;&gt; resource
</I>&gt;<i> &gt;&gt; * autocache - hits server, caches successful response for future use, on
</I>&gt;<i> &gt;&gt; server errors serves a cached namespace-handler resource
</I>&gt;<i> &gt;&gt; * fallback - hits server, does NOT cache successful responses, on server
</I>&gt;<i> &gt;&gt; errors serves a cached namespace-handler resource
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Manifest file section headers:
</I>&gt;<i> &gt;&gt; * BYPASS: list of url [namespaces/filters]
</I>&gt;<i> &gt;&gt; * CACHE: list of exact [urls]
</I>&gt;<i> &gt;&gt; * INTERCEPT: list of [urlnamespaces, namespace-handler url]
</I>&gt;<i> &gt;&gt; * AUTOCACHE: list of [urlnamespaces, namespace-handler url]
</I>&gt;<i> &gt;&gt; * FALLBACK: : list of [urlnamespaces, namespace-handler url]
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Scriptlets - or dynamic namespace-handlers [new idea]
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Something we wrestled with in the process of putting together the Gears
</I>&gt;<i> &gt;&gt; LocalServer was the distinction between intercepting requests for urls
</I>&gt;<i> and
</I>&gt;<i> &gt;&gt; identifying the appropiate cached resource for that request. We ended up
</I>&gt;<i> &gt;&gt; with a declarative manifest file, similar to but different from what is
</I>&gt;<i> &gt;&gt; contained in this spec. This wasn't an altogether satisfying answer. The
</I>&gt;<i> &gt;&gt; expressiveness of the language to match/filter requested urls is limited
</I>&gt;<i> in
</I>&gt;<i> &gt;&gt; Gears and this spec shares that same characterization.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Something else we've wrestled with in Gears was having to do awkward
</I>&gt;<i> &gt;&gt; redesigns in corners of a web application in order to 'take it offline',
</I>&gt;<i> &gt;&gt; single-sign-on for example. In general, anywhere an application relies
</I>&gt;<i> on
</I>&gt;<i> &gt;&gt; HTTP features more than HTML to influence navigation or conditional
</I>&gt;<i> resource
</I>&gt;<i> &gt;&gt; loading, it's difficult to address with a static cache.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; So I'd like to propose extending this spec to incorporate 'dynamically
</I>&gt;<i> &gt;&gt; generated responses'. I think this capability fits into this corner of
</I>&gt;<i> the
</I>&gt;<i> &gt;&gt; HTML5 spec because this is most directly useful in the &quot;Offline Web
</I>&gt;<i> &gt;&gt; Application&quot; scenario. The basic idea is to execute application code
</I>&gt;<i> &gt;&gt; (script) to produce responses to intercepted resource loads. The
</I>&gt;<i> application
</I>&gt;<i> &gt;&gt; code is executed in the background and can formulate a response
</I>&gt;<i> &gt;&gt; asynchronously.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Some handwaving where this could hang off of this spec
</I>&gt;<i> &gt;&gt; * Modify namespace-handlers entries to have an attitional attribute to
</I>&gt;<i> &gt;&gt; indicate that they are to be executed rather than returned
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; And some handwaving at what a scriptlet can do...
</I>&gt;<i> &gt;&gt; * Can read the request headers and POST body
</I>&gt;<i> &gt;&gt; * Can set response status code and headers (redirects)
</I>&gt;<i> &gt;&gt; * Can generate a textual response body
</I>&gt;<i> &gt;&gt; * Can designate a non-executable cached resource to be returned in
</I>&gt;<i> &gt;&gt; response
</I>&gt;<i> &gt;&gt; * Can decide to 'bypass' handling of a request and defer to the usual
</I>&gt;<i> &gt;&gt; resource loading
</I>&gt;<i> &gt;&gt; * Can decide to perform the usual resource loading, but to have the
</I>&gt;<i> &gt;&gt; response added to the appCache
</I>&gt;<i> &gt;&gt; * Can access HTML5Database APIs
</I>&gt;<i> &gt;&gt; * Can utlize XmlHttpRequest to communicate with a server
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; This would obviously be significant addition to the spec, but i do think
</I>&gt;<i> &gt;&gt; this is worth consideration in the context of 'offline applications'.
</I>&gt;<i> Based
</I>&gt;<i> &gt;&gt; on observations of app developers wrestling with Gears, there have been
</I>&gt;<i> &gt;&gt; several pain points. The HTML5ApplicationCache addresses one of them
</I>&gt;<i> &gt;&gt; with per-application caches. This addition would address the second of
</I>&gt;<i> &gt;&gt; them.  (Another pain point has been application deployment).
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Am interested in seeing what others think of an addition along these
</I>&gt;<i> &gt;&gt; lines.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>


-- 
&quot;He was pierced for our transgressions, he was crushed for our iniquities;
the punishment that brought us peace was upon him, and by his wounds we are
healed. We all, like sheep, have gone astray, each of us has turned to his
own way; and the LORD has laid on him the iniquity of us all.&quot; [Isaiah
53:5-6]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20080906/3c8cb604/attachment-0001.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20080906/3c8cb604/attachment-0001.htm</A>&gt;
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="058449.html">[whatwg] HTML5 Offline Web Applications
</A></li>
	<LI>Next message: <A HREF="058451.html">[whatwg] HTML5 Offline Web Applications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58450">[ date ]</a>
              <a href="thread.html#58450">[ thread ]</a>
              <a href="subject.html#58450">[ subject ]</a>
              <a href="author.html#58450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
