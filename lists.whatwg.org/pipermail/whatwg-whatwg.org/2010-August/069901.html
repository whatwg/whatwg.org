<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Adding ECMAScript 5 array extras to HTMLCollection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Adding%20ECMAScript%205%20array%20extras%20to%20HTMLCollection&In-Reply-To=%3CAANLkTi%3DUESzYr93yEi2U79SxroZWNesw2ug-19FdUcn-%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="069900.html">
   <LINK REL="Next"  HREF="069902.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Adding ECMAScript 5 array extras to HTMLCollection</H1>
<!--htdig_noindex-->
    <B>Garrett Smith</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Adding%20ECMAScript%205%20array%20extras%20to%20HTMLCollection&In-Reply-To=%3CAANLkTi%3DUESzYr93yEi2U79SxroZWNesw2ug-19FdUcn-%40mail.gmail.com%3E"
       TITLE="[whatwg] Adding ECMAScript 5 array extras to HTMLCollection">dhtmlkitchen at gmail.com
       </A><BR>
    <I>Wed Aug  4 15:27:35 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="069900.html">[whatwg] Adding ECMAScript 5 array extras to HTMLCollection
</A></li>
        <LI>Next message: <A HREF="069902.html">[whatwg] Adding ECMAScript 5 array extras to HTMLCollection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#69901">[ date ]</a>
              <a href="thread.html#69901">[ thread ]</a>
              <a href="subject.html#69901">[ subject ]</a>
              <a href="author.html#69901">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On 8/4/10, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:
&gt;<i> On Wed, Aug 4, 2010 at 11:10 AM, Alex Russell &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">slightlyoff at google.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;&gt;<i> Sorry for the lagged response,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Fri, Jul 30, 2010 at 2:56 PM, Oliver Hunt &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">oliver at apple.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Jul 30, 2010, at 2:46 PM, Alex Russell wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> On Fri, Jul 30, 2010 at 4:18 AM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> On Thu, Jul 29, 2010 at 5:45 PM, Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ian at hixie.ch</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> The e-mails quoted below consist of the salient points of this thread:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> On Fri, 23 Apr 2010, David Bruant wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Make that HTMLCollection (and all HTML*Collection, as a consequence
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> of
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> inheritence of HTMLCollection) inherit from the ECMAScript Array
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> prototype. This way, it will make available all Array extra methods
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> (forEach, map, filter...) added in ECMAScript5 (and next versions
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> which
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> should go in the same direction).
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> As far as I know, adding this won't break any existing code. The
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> semantics of a Collection and the way it is used is very close from
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> ECMAScript Arrays. I don't think that the notion of &quot;live object&quot; and
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> ECMAScript Array are incompatible either. Once again, I am talking
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> about
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> ECMAScript binding. I have no intention to touch the HTMLCollection
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> interface or other languages bindings.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> On Sun, 25 Apr 2010, J Z wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> If HTMLCollection was inheriting from Array, and methods like
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> `forEach`,
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> `map`, etc. were to operate on a live object, there would definitely
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> be
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> undesired consequences. We can see this in, say, Firefox (which
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> allows to
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> set [[Prototype]] of `HTMLCollection` to `Array.prototype`):
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> HTMLCollection.prototype.__proto__ = Array.prototype;
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> document.getElementsByTagName('div').forEach(function(el) {
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>   el.parentNode.removeChild(el); // doesn't work as expected
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> });
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> // turning live collection into static array fixes this
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Array.slice(document.getElementsByTagName('div')).forEach(function(el)
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> {
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>   el.parentNode.removeChild(el);
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> });
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> On Sat, 24 Apr 2010, David Bruant wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> I think I can take your point as a &quot;pro&quot; more than a &quot;con&quot;, because
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> in
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> ES5, right before the definition of each array extra method, a
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> paragraph
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> like the following can be found :
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> &quot;The range of elements processed by forEach is set before the first
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> call
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> to callbackfn. Elements which are appended to the array after the
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> call
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> to forEach begins will not be visited by callbackfn. If existing
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> elements of the array are changed, their value as passed to callback
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> will be the value at the time forEach visits them; elements that are
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> deleted after the call to forEach begins and before being visited are
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> not visited.&quot;
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> This point is confirmed by every algorithm where the length is
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> &quot;saved&quot;
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> once for all before the loop and not got from the .length property
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> each
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> time.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> On Mon, 26 Apr 2010, Erik Arvidsson wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> On Sun, Apr 25, 2010 at 01:07, David Bruant wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Le 25/04/2010 00:39, J Z a &#233;crit :
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> I have thought a lot about weirdnesses that people could think
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> about
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> like trying to assign a value to the HTMLCollection (divs[14] =
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> myOtherDiv), but once again, it wouldn't be more allowed than it
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> currently is (I have no idea of what happens today, but if an error
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> is thrown in a for-loop, it should throw an error as well in a call
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> within a forEach).
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> How would destructive methods like `push` or `sort` behave? Would
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> `document.body.childNodes.push(document.createTextNode('foo'))`
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> append
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> text node to a body element? Or would it be a noop?
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> That is actually a very good point. It think that the behavior
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> should
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> be exactly the same as &quot;an equivalent without array methods&quot;. (this
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> point of my proposal would need to be made completly explicit for
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> each
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> method)
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> One way to solve this could be to split Array into two interfaces.
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> One
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> to be used with immutable array like objects and one to use to mutate
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> objects. Then we could apply the immutable array like interface to
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> NodeList and its related interfaces. The benefit of doing that is
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> that
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> NodeList.prototype.push would be undefined instead of failing when
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> called.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> On Mon, 26 Apr 2010, David Flanagan wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>
[snip]

To all, please trim quotes to a minimum - thanks.

&gt;&gt;&gt;<i> What would you expect a mutable NodeList to be?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A good example would be the result of document.querySelectorAll().
</I>&gt;<i>
</I>&gt;<i> Why couldn't querySelectorAll return a normal Array?
</I>&gt;<i>
</I>
It could have done that. It would not be immutable. How much
interoperability issue would changing it now cause? Array could be an
ECMA binding as a potential consideration as an idea for alternative
to non-live static nodelist.

Changing live collections to be Arrays would cause severe
interoperability problems. It would be very complicated.

Then if you're going to get an array, it should be possible to set an
array. I suppose in this sort of situation a setItems method could be
useful:

  var cells = Array.prototype.slice.call(row.cells).sort( comparator );
  row.childNodes.setItems( cells );

The first line is a bit ugly and so it would be nice to have it a more
succinct, not to save typing, per se, but to be clearer:

  var cells = row.cells.toArray().sort( comparator );
  row.childNodes.setItems( cells );

Then again, if ECMA provides top level static Array generics, it's
about the same:

  var cells = Array.slice(row.cells).sort( comparator );
  row.childNodes.setItems( cells );

But that doesn't still address the more fundamental problem of
explaining existing collections. Should they be implemented as native
ES object? Should property access operations ([[Get]]) or
[[HasProperty]] checks be defined more precisely? What are &quot;string
index&quot; and &quot;integer index&quot; with property accessor operators? These
constructs are all used today and without clear definition of what is
to be expected by:

  &quot;submitButton&quot; in form.elements

Existing implementations vary on when they use catchalls. I'd like to
see standardization for this behavior and codification so that
implementations behave similarly -- either use a catchall for a
particular type of collection or use a native object. If a catchall is
used, it would be nice to get &quot;has&quot; checks working with desirable
results.  For example, it would be nice to see - &quot;submitButton&quot; in
elements - result true iff `elements` can [[Get]] a &quot;submitButton&quot;
property.

Garrett

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="069900.html">[whatwg] Adding ECMAScript 5 array extras to HTMLCollection
</A></li>
	<LI>Next message: <A HREF="069902.html">[whatwg] Adding ECMAScript 5 array extras to HTMLCollection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#69901">[ date ]</a>
              <a href="thread.html#69901">[ thread ]</a>
              <a href="subject.html#69901">[ subject ]</a>
              <a href="author.html#69901">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
