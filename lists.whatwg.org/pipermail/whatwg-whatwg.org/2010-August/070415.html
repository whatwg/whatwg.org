<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Fwd: Discussing WebSRT and alternatives/improvements
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Fwd%3A%20Discussing%20WebSRT%20and%20alternatives/improvements&In-Reply-To=%3Cop.vhzlk5lwsr6mfa%40nog%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="070409.html">
   <LINK REL="Next"  HREF="070416.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Fwd: Discussing WebSRT and alternatives/improvements</H1>
<!--htdig_noindex-->
    <B>Philip J&#228;genstedt</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Fwd%3A%20Discussing%20WebSRT%20and%20alternatives/improvements&In-Reply-To=%3Cop.vhzlk5lwsr6mfa%40nog%3E"
       TITLE="[whatwg] Fwd: Discussing WebSRT and alternatives/improvements">philipj at opera.com
       </A><BR>
    <I>Wed Aug 25 02:20:55 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="070409.html">[whatwg] Fwd: Discussing WebSRT and alternatives/improvements
</A></li>
        <LI>Next message: <A HREF="070416.html">[whatwg] Fwd: Discussing WebSRT and alternatives/improvements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70415">[ date ]</a>
              <a href="thread.html#70415">[ thread ]</a>
              <a href="subject.html#70415">[ subject ]</a>
              <a href="author.html#70415">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Wed, 25 Aug 2010 09:16:56 +0200, Silvia Pfeiffer  
&lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">silviapfeiffer1 at gmail.com</A>&gt; wrote:

&gt;<i> On Tue, Aug 24, 2010 at 8:49 PM, Philip J&#228;genstedt  
</I>&gt;<i> &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">philipj at opera.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Tue, 24 Aug 2010 04:32:21 +0200, Silvia Pfeiffer &lt;
</I>&gt;&gt;<i> <A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">silviapfeiffer1 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  On Mon, Aug 23, 2010 at 6:55 PM, Philip J&#228;genstedt &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">philipj at opera.com</A>
</I>&gt;&gt;&gt;<i> &gt;wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   Aside: WebSRT can't contain binary data, only UTF-8 encoded text.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> It sure can. Just base-64 encode it. I'm not saying it's a good  
</I>&gt;&gt;&gt;&gt;&gt;<i> thing,
</I>&gt;&gt;&gt;&gt;&gt;<i> but
</I>&gt;&gt;&gt;&gt;&gt;<i> if somebody really has an urge...
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Sure, this would be a metadata track. Sites have no reason to offer
</I>&gt;&gt;&gt;&gt;<i> download links to it, and if anyone gets hold of such a file it would
</I>&gt;&gt;&gt;&gt;<i> quickly be evident that it's useless.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> After a user has seen the crap on screen. I'm just saying: it's a legal
</I>&gt;&gt;&gt;<i> WebSRT file and really not compatible with any existing infrastructure  
</I>&gt;&gt;&gt;<i> for
</I>&gt;&gt;&gt;<i> SRT.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A fair point. The alternatives I can see are (1) using an incompatible
</I>&gt;&gt;<i> format so that the user sees nothing or (2) adding a header that  
</I>&gt;&gt;<i> indicates
</I>&gt;&gt;<i> that the track is metadata.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In order to tell the user to stop wasting their time with this file, I
</I>&gt;&gt;<i> think (1) is clearly worse. (2) is absolutely an option, but it will  
</I>&gt;&gt;<i> only
</I>&gt;&gt;<i> make a difference to software that understands this header and if the  
</I>&gt;&gt;<i> header
</I>&gt;&gt;<i> is optional it will likely often be omitted. A dialog saying &quot;this is a
</I>&gt;&gt;<i> metadata track, you can't watch it&quot; is slightly friendlier than a screen
</I>&gt;&gt;<i> full of crap, but they are both pretty effective at getting the message
</I>&gt;&gt;<i> across.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yeah, I'm totally for adding a hint as to what format is in the cue.  
</I>&gt;<i> Then, a
</I>&gt;<i> WebSRT file can be identified as to what it contains.
</I>
OK, but note that a browser would ignore this and trust what &lt;track kind&gt;  
says. I wouldn't want the kind change after the external track is loaded,  
it would make the UI confusing if a captions track disappeared from the  
menu as soon as it was loaded because it internally claims to be metadata.

&gt;&gt;<i>   If we define WebSRT in a way that can handle &gt;99% of existing content  
</I>&gt;&gt;<i> and
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> degrade gracefully (enough) when using new features in old software,  
</I>&gt;&gt;&gt;&gt;&gt;<i> it
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> seems reasonable to do. If lots of software developers cry foul,  
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> then
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> perhaps we should reconsider. It seems to me, though, that actually
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> researching and defining a good algorithm for parsing SRT would be  
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> of
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> use
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> to
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> others than just browsers.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  How is that different from moving away from SRT. If everyone has to
</I>&gt;&gt;&gt;&gt;&gt;<i> change
</I>&gt;&gt;&gt;&gt;&gt;<i> their parsing of SRT to accommodate a new spec, then that is a new
</I>&gt;&gt;&gt;&gt;&gt;<i> format.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Not everyone has to change their parsers immediately, many will  
</I>&gt;&gt;&gt;&gt;<i> continue
</I>&gt;&gt;&gt;&gt;<i> to
</I>&gt;&gt;&gt;&gt;<i> work. However, if someone wants to support SRT in a compatible way,  
</I>&gt;&gt;&gt;&gt;<i> it's
</I>&gt;&gt;&gt;&gt;<i> very helpful to have a spec, assuming that WebSRT is actually  
</I>&gt;&gt;&gt;&gt;<i> compatible
</I>&gt;&gt;&gt;&gt;<i> enough with existing SRT content.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> This is quite similar to HTML4 vs HTML5. There are lots of mostly
</I>&gt;&gt;&gt;&gt;<i> compatible HTML parsers, but HTML5 defines a single parsing algorithm,
</I>&gt;&gt;&gt;&gt;<i> and
</I>&gt;&gt;&gt;&gt;<i> slow convergence towards that is a good thing.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> No, no, no! It is not at all similar to HTML4 and HTML5. A Web browser
</I>&gt;&gt;&gt;<i> cannot suddenly stop working for a Web page, just because it has some
</I>&gt;&gt;&gt;<i> extra
</I>&gt;&gt;&gt;<i> functionality in it. Thus, the HTML format has been developed such  
</I>&gt;&gt;&gt;<i> that it
</I>&gt;&gt;&gt;<i> can be extended without breaking existing stuff. We can guarantee that  
</I>&gt;&gt;&gt;<i> no
</I>&gt;&gt;&gt;<i> browser will break because that is the way in which the format has been
</I>&gt;&gt;&gt;<i> specified.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> No such thing has happened for SRT and there is simply no way to  
</I>&gt;&gt;&gt;<i> guarantee
</I>&gt;&gt;&gt;<i> that all new WebSRT files will work in all existing SRT software,  
</I>&gt;&gt;&gt;<i> because
</I>&gt;&gt;&gt;<i> SRT has not been specified as a extensible format and because there is  
</I>&gt;&gt;&gt;<i> no
</I>&gt;&gt;&gt;<i> agreement between all parties that have implemented SRT support as to  
</I>&gt;&gt;&gt;<i> how
</I>&gt;&gt;&gt;<i> extensions should be made.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We can introduce such a thing for WebSRT, but we cannot claim it for  
</I>&gt;&gt;&gt;<i> SRT.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You are right, existing SRT parsers are probably far less interoperable
</I>&gt;&gt;<i> than HTML parsers were before HTML5.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Existing content demands that SRT parsers handle at least &lt;i&gt;, &lt;b&gt;,  
</I>&gt;&gt;<i> &lt;font&gt;
</I>&gt;&gt;<i> and &lt;u&gt; in some manner, even if it is by ignoring it. Any parsers that  
</I>&gt;&gt;<i> treat
</I>&gt;&gt;<i> SRT as plain text don't even work with todays content, so I don't think  
</I>&gt;&gt;<i> they
</I>&gt;&gt;<i> should be considered at all.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You've just defined what SRT is. I would actually define SRT as the plain
</I>&gt;<i> text format and the &lt;i&gt;, &lt;b&gt;, &lt;font&gt; and &lt;u&gt; markup as extensions.
</I>
Perhaps SRT was originally plain text, but for a very long time now, files  
with the .srt extension contain markup, more than 50% do in the  
OpenSubtitles sample data. With nothing to differentiate the plain text  
and markup formats, there is effectively only one format, no matter what  
we choose to call it.

&gt;&gt;<i> The question, then, is if parsers that handle the mentioned markup also
</I>&gt;&gt;<i> ignore &lt;1&gt;, &lt;ruby&gt; and &lt;rt&gt;. I haven't tested it, but I assume that some
</I>&gt;&gt;<i> will ignore it and some won't. How many percent of the media player  
</I>&gt;&gt;<i> market
</I>&gt;&gt;<i> would have to handle this correctly for these extensions to be OK, in  
</I>&gt;&gt;<i> your
</I>&gt;&gt;<i> opinion?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If a single one breaks, it would be bad IMO because the expectations of  
</I>&gt;<i> the
</I>&gt;<i> users of that software will be broken even if it may just be a small
</I>&gt;<i> percentage of users and we have no influence on the upgrade path of that
</I>&gt;<i> software - in particular if it is proprietary.
</I>
Neither a new file extension, MIME type or header is enough to stop some  
implementations from treating it as SRT and break. The only remaining  
option, AFAICT, is making the format fundamentally incompatible with SRT.  
Is it worth it?

&gt;&gt;<i>  If the SRT ecosystem is so fragile that it cannot tolerate any  
</I>&gt;&gt;<i> extension
</I>&gt;&gt;&gt;&gt;<i> whatsoever, then we should stay far away from it. It just seems that's
</I>&gt;&gt;&gt;&gt;<i> not
</I>&gt;&gt;&gt;&gt;<i> the case.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> How do we know that everyone that uses SRT now really wants to use  
</I>&gt;&gt;&gt;<i> WebSRT
</I>&gt;&gt;&gt;<i> instead and wants to take part in the new ecosystem that we are
</I>&gt;&gt;&gt;<i> introducing?
</I>&gt;&gt;&gt;<i> We make some pretty big assumptions about what everyone who is not a  
</I>&gt;&gt;&gt;<i> Web
</I>&gt;&gt;&gt;<i> browser vendor wants to do with SRT. That doesn't make the existing SRT
</I>&gt;&gt;&gt;<i> ecosystem fragile - but it makes it an existing environment that needs  
</I>&gt;&gt;&gt;<i> to
</I>&gt;&gt;&gt;<i> be
</I>&gt;&gt;&gt;<i> respected.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> At this point, what is your recommendation? The following ideas have  
</I>&gt;&gt;<i> been
</I>&gt;&gt;<i> on the table:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * Change the file extension to something other than .srt.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I don't have an opinion, browsers ignore the file extension anyway.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes, I think we should definitely have a new file extension.
</I>
I'll leave this to others to decide, but since browsers have no concept of  
file extensions, just using .srt will work. If the format is SRT-like it's  
likely at least some files will use .srt in practice.

&gt;&gt;<i> * Change the MIME type to something other than text/srt.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I doubt it makes any difference, as most software that deal with SRT  
</I>&gt;&gt;<i> today
</I>&gt;&gt;<i> have no concept of MIME types. No matter what I'd want exactly 1 MIME  
</I>&gt;&gt;<i> type
</I>&gt;&gt;<i> or alternatively make browsers ignore the MIME type completely.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You're right in that existing SRT software probably doesn't deal much  
</I>&gt;<i> with a
</I>&gt;<i> SRT mime type. Right now text/x-srt or text/srt is sometimes used for SRT
</I>&gt;<i> files, but often text/plain is also in use and more likely from a Web
</I>&gt;<i> server. Since this is the space where Web browsers play, I am not overly
</I>&gt;<i> fussed, though I think logically text/websrt makes more sense with a  
</I>&gt;<i> .wsrt
</I>&gt;<i> extension. Then, also SRT files can be served as text/websrt to allow  
</I>&gt;<i> them
</I>&gt;<i> to take part in the WebSRT infrastructure if indeed they will continue  
</I>&gt;<i> to be
</I>&gt;<i> valid WebSRT files.
</I>
Is there anything you expect would break if WebSRT files were served as  
text/srt?

&gt;<i> Incidentally, it is a problem if WebSRT files are served as text/plain,  
</I>&gt;<i> i.e.
</I>&gt;<i> will the browser not identify them as subtitle files?
</I>
&lt;<A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/video.html#sourcing-out-of-band-timed-tracks">http://www.whatwg.org/specs/web-apps/current-work/multipage/video.html#sourcing-out-of-band-timed-tracks</A>&gt;

Step 4 says:

&quot;The tasks queued by the fetching algorithm on the networking task source  
to process the data as it is being fetched must examine the resource's  
Content Type metadata, once it is available, if it ever is. If no Content  
Type metadata is ever available, or if the type is not recognised as a  
timed track format, then the resource's format must be assumed to be  
unsupported (this causes the load to fail, as described below).&quot;

In other words, browsers should have a whitelist of supported text track  
format, just like they should for audio and video formats. (Note though  
that Safari and Chrome ignore the MIME type for audio/video and will  
likely continue to do so.)

It seems to that a side-effect of this is that it will be impossible to  
test &lt;track&gt; on a local file system, as there's no MIME type and browsers  
aren't allowed to sniff. Surely this can't be the intention, Hixie?

&gt;&gt;<i> * Add a header to WebSRT to make it uniquely identifiable.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The header would have to be mandatory and browsers would have to reject
</I>&gt;&gt;<i> files that don't have it. Such files would be compatible with some  
</I>&gt;&gt;<i> existing
</I>&gt;&gt;<i> software and break some, depending on how they sniff. We could also put
</I>&gt;&gt;<i> metadata in such a header.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes, I think we need to introduce a header. Maybe we can hide all the
</I>&gt;<i> structure in what SRT recognizes as comments (i.e. start the lines as  
</I>&gt;<i> &quot;;&quot;.
</I>&gt;<i> But I believe we need some hints like the @profile to identify the type  
</I>&gt;<i> of
</I>&gt;<i> the cues and the &lt;link&gt; to link to a style sheet, and we need metadata  
</I>&gt;<i> like
</I>&gt;<i> the &lt;meta&gt; element of HTML headers.
</I>
I had no idea that semicolon was used for comments in SRT, is this usage  
widespread? Does it work in most players?

&gt;<i> * Make something deliberately incompatible with SRT.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It doesn't make a big difference to browsers implementing the format.  
</I>&gt;&gt;<i> We'd
</I>&gt;&gt;<i> be replacing something that mostly works in existing players with  
</I>&gt;&gt;<i> something
</I>&gt;&gt;<i> that never works.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That was the idea of WMML and I took that path because I thought it  
</I>&gt;<i> would be
</I>&gt;<i> advantageous for other Web applications, such as built on libxml2, expat,
</I>&gt;<i> php's SimpleXML, pyexpat for python, Nokogiri for ruby etc. But I really
</I>&gt;<i> like the idea of WebSRT to allow arbitrary metadata in the cues without
</I>&gt;<i> having to put it into CDATA sections.
</I>&gt;<i>
</I>&gt;<i> I don't mind creating a format that is still somewhat compatible with  
</I>&gt;<i> SRT.
</I>&gt;<i> We don't have to force incompatibility - but we should also not have it
</I>&gt;<i> restrict us. In either case, it is a new format.
</I>
I'm not trying to be annoying, but this seems to clash with your  
preference to not break any existing software. Anything that resembles SRT  
*will* be treated as SRT in some existing players.

&gt;&gt;<i> Here's the SRT research I promised:
</I>&gt;&gt;<i> <A HREF="http://blog.foolip.org/2010/08/20/srt-research/">http://blog.foolip.org/2010/08/20/srt-research/</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That is awesome work. I knew that most SRT files didn't use UTF-8, but I
</I>&gt;<i> didn't know that we would make such a large percentage of files that are
</I>&gt;<i> currently parsed by SRT software be incompatible. It is good data to  
</I>&gt;<i> have.
</I>
Indeed, this makes reusing existing content highly unlikely outside of the  
ASCII-speaking world. Realistically, though, that wouldn't be very common  
anyway, especially not in the case of subtitles for movies and TV series  
like most of the content on OpenSubtitles. The benefit that remains is  
being able to use the same subtitle files in browsers and standalone  
players without conversion.

-- 
Philip J&#228;genstedt
Core Developer
Opera Software

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="070409.html">[whatwg] Fwd: Discussing WebSRT and alternatives/improvements
</A></li>
	<LI>Next message: <A HREF="070416.html">[whatwg] Fwd: Discussing WebSRT and alternatives/improvements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70415">[ date ]</a>
              <a href="thread.html#70415">[ thread ]</a>
              <a href="subject.html#70415">[ subject ]</a>
              <a href="author.html#70415">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
