<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] HTML resource packages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20HTML%20resource%20packages&In-Reply-To=%3CAANLkTikkrkU3Vj4i-Pac7b%3DWruafZm%2BTqh6kHk5GC69J%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="070041.html">
   <LINK REL="Next"  HREF="070073.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] HTML resource packages</H1>
<!--htdig_noindex-->
    <B>Justin Lebar</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20HTML%20resource%20packages&In-Reply-To=%3CAANLkTikkrkU3Vj4i-Pac7b%3DWruafZm%2BTqh6kHk5GC69J%40mail.gmail.com%3E"
       TITLE="[whatwg] HTML resource packages">justin.lebar at gmail.com
       </A><BR>
    <I>Mon Aug  9 13:40:27 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="070041.html">[whatwg] HTML resource packages
</A></li>
        <LI>Next message: <A HREF="070073.html">[whatwg] HTML resource packages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70042">[ date ]</a>
              <a href="thread.html#70042">[ thread ]</a>
              <a href="subject.html#70042">[ subject ]</a>
              <a href="author.html#70042">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>&gt;<i> Can you provide the content of the page which you used in your whitepaper?
</I>&gt;<i> (<A HREF="https://bug529208.bugzilla.mozilla.org/attachment.cgi?id=455820">https://bug529208.bugzilla.mozilla.org/attachment.cgi?id=455820</A>)
</I>
I'll post this to the bug when I get home tonight.  But your comments
are astute -- the page I used is a pretty bad benchmark for a variety
of reasons.  It sounds like you probably could hack up a much better
one.

&gt;<i>    a) Looks like pages were loaded exactly once, as per your notes?  How
</I>&gt;<i> hard is it to run the tests long enough to get to a 95% confidence interval?
</I>
Since I was running on a simulated network with no random parameters
(e.g. no packet loss), there was very little variance in load time
across runs.

&gt;<i>    d) What did you do about subdomains in the test?  I assume your test
</I>&gt;<i> loaded from one subdomain?
</I>
That's correct.

&gt;<i> I'm betting time-to-paint goes through the roof with resource bundles:-)
</I>
It does right now because we don't support incremental extraction,
which is why I didn't bother measuring time-to-paint.  The hope is
that with incremental extraction, we won't take too much of a hit.

-Justin

On Mon, Aug 9, 2010 at 1:30 PM, Mike Belshe &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">mike at belshe.com</A>&gt; wrote:
&gt;<i> Justin -
</I>&gt;<i> Can you provide the content of the page which you used in your whitepaper?
</I>&gt;<i> (<A HREF="https://bug529208.bugzilla.mozilla.org/attachment.cgi?id=455820">https://bug529208.bugzilla.mozilla.org/attachment.cgi?id=455820</A>)
</I>&gt;<i> I have a few concerns about the benchmark:
</I>&gt;<i> &#160;&#160; a) Looks like pages were loaded exactly once, as per your notes? &#160;How
</I>&gt;<i> hard is it to run the tests long enough to get to a 95% confidence interval?
</I>&gt;<i> &#160;&#160; b) As you note in the report, slow start will kill you. &#160;I've verified
</I>&gt;<i> this so many times it makes me sick. &#160;If you try more combinations, I
</I>&gt;<i> believe you'll see this.
</I>&gt;<i> &#160;&#160; c) The 1.3MB of subresources in a single bundle seems unrealistic to me.
</I>&gt;<i> &#160;On one hand you say that its similar to CNN, but note that CNN has
</I>&gt;<i> JS/CSS/images, not just thumbnails like your test. &#160;Further, note that CNN
</I>&gt;<i> pulls these resources from multiple domains; combining them into one domain
</I>&gt;<i> may work, but certainly makes the test content very different from CNN. &#160;So
</I>&gt;<i> the claim that it is somehow representative seems incorrect. &#160; For more
</I>&gt;<i> accurate data on what websites look like,
</I>&gt;<i> see&#160;<A HREF="http://code.google.com/speed/articles/web-metrics.html">http://code.google.com/speed/articles/web-metrics.html</A>
</I>&gt;<i> &#160;&#160; d) What did you do about subdomains in the test? &#160;I assume your test
</I>&gt;<i> loaded from one subdomain?
</I>&gt;<i> &#160;&#160; e) There is more to a browser than page-load-time. &#160;Time-to-first-paint
</I>&gt;<i> is critical as well. &#160;For instance, in WebKit and Chrome, we have specific
</I>&gt;<i> heuristics which optimize for time-to-render instead of total page load.
</I>&gt;<i> &#160;CNN is always cited as a &quot;bad page&quot;, but it's really not - it just has a
</I>&gt;<i> lot of content, both below and above the fold. &#160;When the user can interact
</I>&gt;<i> with the page successfully, the user is happy. &#160;In other words, I know I can
</I>&gt;<i> make webkit's PLT much faster by removing a couple of throttles. &#160;But I also
</I>&gt;<i> know that doing so worsens the user experience by delaying the time to first
</I>&gt;<i> paint. &#160;So - is it possible to measure both times? &#160;I'm betting
</I>&gt;<i> time-to-paint goes through the roof with resource bundles:-)
</I>&gt;<i> If you provide the content, I'll try to&#160;run some tests. &#160;It will take a few
</I>&gt;<i> days.
</I>&gt;<i> Mike
</I>&gt;<i>
</I>&gt;<i> On Mon, Aug 9, 2010 at 9:52 AM, Justin Lebar &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">justin.lebar at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Aug 9, 2010 at 9:47 AM, Aryeh Gregor &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">Simetrical+w3c at gmail.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt; If UAs can assume that files with the same path
</I>&gt;&gt;<i> &gt; are the same regardless of whether they came from a resource package
</I>&gt;&gt;<i> &gt; or which, and they have all but a couple of the files cached, they
</I>&gt;&gt;<i> &gt; could request those directly instead of from the resource package,
</I>&gt;&gt;<i> &gt; even if a resource package is specified.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> These kinds of heuristics are far beyond the scope of resource
</I>&gt;&gt;<i> packages as we're planning to implement them. &#160;Again, I think this
</I>&gt;&gt;<i> type of behavior is the domain of a large change to the networking
</I>&gt;&gt;<i> stack, such as SPDY, not a small hack like resource packages.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Justin
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Aug 9, 2010 at 9:47 AM, Aryeh Gregor &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">Simetrical+w3c at gmail.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt; On Fri, Aug 6, 2010 at 7:40 PM, Justin Lebar &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">justin.lebar at gmail.com</A>&gt;
</I>&gt;&gt;<i> &gt; wrote:
</I>&gt;&gt;<i> &gt;&gt; I think this is a fair point. &#160;But I'd suggest we consider the
</I>&gt;&gt;<i> &gt;&gt; following:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; * It might be confusing for resources from a resource package to show
</I>&gt;&gt;<i> &gt;&gt; up on a page which doesn't &quot;opt-in&quot; to resource packages in general or
</I>&gt;&gt;<i> &gt;&gt; to that specific resource package.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Only if the resource package contains a different file from the real
</I>&gt;&gt;<i> &gt; one. &#160;I suggest we treat this as a pathological case and accept that
</I>&gt;&gt;<i> &gt; it will be broken and confusing -- or at least we consider how many
</I>&gt;&gt;<i> &gt; extra optimizations we could make if we did accept that, before
</I>&gt;&gt;<i> &gt; deciding whether the extra performance is worth the confusion.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt; * There's no easy way to opt out of this behavior. &#160;That is, if I
</I>&gt;&gt;<i> &gt;&gt; explicitly *don't* want to load content cached from a resource
</I>&gt;&gt;<i> &gt;&gt; package, I have to name that content differently.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Why would you want that, if the files are the same anyway?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt; * The avatars-on-a-forum use case is less convincing the more I think
</I>&gt;&gt;<i> &gt;&gt; about it. &#160;Certainly you'd want each page which displays many avatars
</I>&gt;&gt;<i> &gt;&gt; to package up all the avatars into a single package. &#160;So you wouldn't
</I>&gt;&gt;<i> &gt;&gt; benefit from the suggested caching changes on those pages.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I don't see why not. &#160;If UAs can assume that files with the same path
</I>&gt;&gt;<i> &gt; are the same regardless of whether they came from a resource package
</I>&gt;&gt;<i> &gt; or which, and they have all but a couple of the files cached, they
</I>&gt;&gt;<i> &gt; could request those directly instead of from the resource package,
</I>&gt;&gt;<i> &gt; even if a resource package is specified. &#160;So if twenty different
</I>&gt;&gt;<i> &gt; people post on the page, and you've been browsing for a while and have
</I>&gt;&gt;<i> &gt; eighteen of their avatars (this will be common, a handful of people
</I>&gt;&gt;<i> &gt; tend to account for most posts in a given forum):
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; 1) With no resource packages, you fetch two separate avatars (but on
</I>&gt;&gt;<i> &gt; earlier page views you suffered).
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; 2) With resource packages as you suggest, you fetch a whole resource
</I>&gt;&gt;<i> &gt; package, 90% of which you don't need. &#160;In fact, you have to fetch a
</I>&gt;&gt;<i> &gt; resource package even if you have 100% of the avatars on the page! &#160;No
</I>&gt;&gt;<i> &gt; two pages will be likely to have the same resource package, so you
</I>&gt;&gt;<i> &gt; can't share cache at all.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; 3) With resource packages as I suggest, you fetch only two separate
</I>&gt;&gt;<i> &gt; avatars, *and* you got the benefits of resource packages on earlier
</I>&gt;&gt;<i> &gt; pages. &#160;The UA gets to guess whether using resource packages would be
</I>&gt;&gt;<i> &gt; a win on a case-by-case basis, so in particular, it should be able to
</I>&gt;&gt;<i> &gt; perform strictly better than either (1) or (2), given decent
</I>&gt;&gt;<i> &gt; heuristics. &#160;E.g., the heuristic &quot;fetch the resource package if I need
</I>&gt;&gt;<i> &gt; at least two files, fetch the file if I only need one&quot; will perform
</I>&gt;&gt;<i> &gt; better than either (1) or (2) in any reasonable circumstance.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I think this sort of situation will be fairly common. &#160;Has anyone
</I>&gt;&gt;<i> &gt; looked at a bunch of different types of web pages and done a breakdown
</I>&gt;&gt;<i> &gt; of how many assets they have, and how they're reused across pages? &#160;If
</I>&gt;&gt;<i> &gt; we're talking about assets that are used only on one page (image
</I>&gt;&gt;<i> &gt; search) or all pages (logos, shared scripts), your approach works
</I>&gt;&gt;<i> &gt; fine, but not if they're used on a random mix of pages. &#160;I think a lot
</I>&gt;&gt;<i> &gt; of files will wind up being used on only particular subsets of pages.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt; In general, I think we need something like SPDY to really address the
</I>&gt;&gt;<i> &gt;&gt; problem of duplicated downloads. &#160;I don't think resource packages can
</I>&gt;&gt;<i> &gt;&gt; fix it with any caching policy.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Certainly there are limits to what resource packages can do, but we
</I>&gt;&gt;<i> &gt; can wind up closer to the limits or farther from them depending on the
</I>&gt;&gt;<i> &gt; implementation details.
</I>&gt;&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="070041.html">[whatwg] HTML resource packages
</A></li>
	<LI>Next message: <A HREF="070073.html">[whatwg] HTML resource packages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70042">[ date ]</a>
              <a href="thread.html#70042">[ thread ]</a>
              <a href="subject.html#70042">[ subject ]</a>
              <a href="author.html#70042">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
