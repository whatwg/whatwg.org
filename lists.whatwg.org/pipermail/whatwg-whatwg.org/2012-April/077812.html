<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] DOMContentLoaded, load and current document readiness
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20DOMContentLoaded%2C%20load%20and%20current%20document%20readiness&In-Reply-To=%3CCA%2Bc2ei9fE8mkTVwEHUpr3v87mLHtKCdSN6eegOLm7tvEA4D5Tg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035504.html">
   <LINK REL="Next"  HREF="035511.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] DOMContentLoaded, load and current document readiness</H1>
<!--htdig_noindex-->
    <B>Jonas Sicking</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20DOMContentLoaded%2C%20load%20and%20current%20document%20readiness&In-Reply-To=%3CCA%2Bc2ei9fE8mkTVwEHUpr3v87mLHtKCdSN6eegOLm7tvEA4D5Tg%40mail.gmail.com%3E"
       TITLE="[whatwg] DOMContentLoaded, load and current document readiness">jonas at sicking.cc
       </A><BR>
    <I>Wed Apr 25 10:53:35 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="035504.html">[whatwg] DOMContentLoaded, load and current document readiness
</A></li>
        <LI>Next message: <A HREF="035511.html">[whatwg] Encoding Sniffing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77812">[ date ]</a>
              <a href="thread.html#77812">[ thread ]</a>
              <a href="subject.html#77812">[ subject ]</a>
              <a href="author.html#77812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Fri, Apr 20, 2012 at 3:43 AM, Henri Sivonen &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">hsivonen at iki.fi</A>&gt; wrote:
&gt;<i> On Tue, Jan 10, 2012 at 2:10 AM, Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ian at hixie.ch</A>&gt; wrote:
</I>&gt;&gt;<i> On Tue, 31 May 2011, Henri Sivonen wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Recently, there was discussion about changing media element state in the
</I>&gt;&gt;&gt;<i> same task that fires the event about the state change so that scripts
</I>&gt;&gt;&gt;<i> that probe the state can make non-racy conclusions about whether a
</I>&gt;&gt;&gt;<i> certain event has fired already.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Currently, there seems to be no correct non-racy way to write code that
</I>&gt;&gt;&gt;<i> probes a document to determine if DOMContentLoaded or load has fired and
</I>&gt;&gt;&gt;<i> runs code immediately if the event of interest has fired or adds a
</I>&gt;&gt;&gt;<i> listener to wait for the event if the event hasn't fired.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Are there compat or other reasons why we couldn't or shouldn't make it
</I>&gt;&gt;&gt;<i> so that the same task that fires DOMContentLoaded changes the readyState
</I>&gt;&gt;&gt;<i> to &quot;interactive&quot; and the same task that fires load changes readyState to
</I>&gt;&gt;&gt;<i> &quot;complete&quot;?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Fixed for 'load'. I don't see a good way to fix this for
</I>&gt;&gt;<i> 'DOMContentLoaded', unfortunately.
</I>&gt;<i>
</I>&gt;<i> It turns out that Firefox has accidentally been running defer scripts
</I>&gt;<i> after DOMContentLoaded. I haven't seen bug reports about this.
</I>&gt;<i> Embracing this bug might offer a way to always keep the
</I>&gt;<i> readystatechange to &quot;interactive&quot; in the same task that fire
</I>&gt;<i> DOMContentLoaded.
</I>&gt;<i>
</I>&gt;<i> See <A HREF="http://hsivonen.iki.fi/test/moz/readystate/defer-script.html">http://hsivonen.iki.fi/test/moz/readystate/defer-script.html</A>
</I>
Hmm.. how long as that been the case? I thought that when we
originally implemented @defer we ran them before DOMContentLoaded was
fired for various internal sanity reasons as well as because it gave
authors better migration paths.

It seems nice to me to be able to depend on that all scripts have run
by the time that DOMContentLoaded is fired. Except for async scripts
of course, which are always unreliable as to when and which order they
execute. I.e. async scripts is an explicit footgun, but I'd rather
have fewer of those.

/ Jonas

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035504.html">[whatwg] DOMContentLoaded, load and current document readiness
</A></li>
	<LI>Next message: <A HREF="035511.html">[whatwg] Encoding Sniffing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77812">[ date ]</a>
              <a href="thread.html#77812">[ thread ]</a>
              <a href="subject.html#77812">[ subject ]</a>
              <a href="author.html#77812">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
