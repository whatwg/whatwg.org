<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Fixing two security vulnerabilities in	registerProtocolHandler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Fixing%20two%20security%20vulnerabilities%20in%0A%09registerProtocolHandler&In-Reply-To=%3CPine.LNX.4.64.1204100016280.22654%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="077678.html">
   <LINK REL="Next"  HREF="035303.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler</H1>
<!--htdig_noindex-->
    <B>Ian Hickson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Fixing%20two%20security%20vulnerabilities%20in%0A%09registerProtocolHandler&In-Reply-To=%3CPine.LNX.4.64.1204100016280.22654%40ps20323.dreamhostps.com%3E"
       TITLE="[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler">ian at hixie.ch
       </A><BR>
    <I>Mon Apr  9 17:24:52 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="077678.html">[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler
</A></li>
        <LI>Next message: <A HREF="035303.html">[whatwg] [media] startOffsetTime, also add startTime?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77679">[ date ]</a>
              <a href="thread.html#77679">[ thread ]</a>
              <a href="subject.html#77679">[ subject ]</a>
              <a href="author.html#77679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Mon, 9 Apr 2012, Tyler Close wrote:
&gt;<i> On Mon, Apr 9, 2012 at 4:48 PM, Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ian at hixie.ch</A>&gt; wrote:
</I>&gt;<i> &gt; On Mon, 9 Apr 2012, Tyler Close wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The RPH handler doesn't need to know which is the legit site. The RPH 
</I>&gt;<i> &gt;&gt; handler just needs to know that it's getting the RPH data from the 
</I>&gt;<i> &gt;&gt; site that the user was interacting with, not some other unseen site 
</I>&gt;<i> &gt;&gt; running in the browser.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Nothing we have discussed so far would provide such a guarantee.
</I>&gt;<i> 
</I>&gt;<i> Yes, what I am proposing provides that guarantee. When an iframe is 
</I>&gt;<i> initially navigated to a mailto URL, the browser starts its RPH dispatch 
</I>&gt;<i> logic. In Firefox, this means a Picker dialog is shown and the user 
</I>&gt;<i> selects an RPH handler. The browser then navigates the iframe to the RPH 
</I>&gt;<i> handler URL and, under my proposal, would populate a DOM field 
</I>&gt;<i> containing the mailto URL.
</I>
Nothing in the spec guarantees that a picker dialog is shown. Indeed, the 
specification is specifically designed to allow sites to be marked as 
default handlers, and in typical operation that would likely be the 
preferred behaviour for users. (Users don't typically want to pick a new 
PDF viewer or e-mail client every time they click on a PDF or mailto: link.)


&gt;<i> Alternatively, the browser could refuse to do repeated RPH navigation of 
</I>&gt;<i> the same iframe.
</I>
That would break a use case such as a site with an index of PDFs opening 
in an irame, if the PDF viewer was a handler rather than a plugin.


&gt;<i> &gt;&gt; The vulnerability is that window.location can be overwritten by other 
</I>&gt;<i> &gt;&gt; code running in the browser.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Then we should fix _that_.
</I>&gt;<i> 
</I>&gt;<i> I was under the impression that the descendant policy on frame 
</I>&gt;<i> navigation was baked into the Web at this point and could not be 
</I>&gt;<i> changed.
</I>
As far as I can tell, at least some browsers prevent anything but the 
fragment identifier being changed in certain cross-origin cases. I haven't 
studied this in depth recently, but I strongly suspect that the rules 
currently in the spec regarding access to Location object members (which 
block the access you are describing for scripted navigations as well as 
window.open() and target=&quot;&quot; navigations) do not need to be relaxed beyond 
merely allowing changes to fragment identifiers. As I mentioned, the 
implications if we do not limit them beyond this are far more dramatic 
than a site making a handler use a different URL.

-- 
Ian Hickson               U+1047E                )\._.,--....,'``.    fL
<A HREF="http://ln.hixie.ch/">http://ln.hixie.ch/</A>       U+263A                /,   _.. \   _\  ;`._ ,.
Things that are impossible just take longer.   `._.-(,_..'--(,_..'`-.;.'

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="077678.html">[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler
</A></li>
	<LI>Next message: <A HREF="035303.html">[whatwg] [media] startOffsetTime, also add startTime?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77679">[ date ]</a>
              <a href="thread.html#77679">[ thread ]</a>
              <a href="subject.html#77679">[ subject ]</a>
              <a href="author.html#77679">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
