<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Fixing two security vulnerabilities in	registerProtocolHandler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Fixing%20two%20security%20vulnerabilities%20in%0A%09registerProtocolHandler&In-Reply-To=%3CCAKvcKK%3D%3Dv3h-_KodxWONcoxoDrGLQ_j4BrA8Y3__Fe7hyxqPKQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="077653.html">
   <LINK REL="Next"  HREF="077658.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler</H1>
<!--htdig_noindex-->
    <B>Tyler Close</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Fixing%20two%20security%20vulnerabilities%20in%0A%09registerProtocolHandler&In-Reply-To=%3CCAKvcKK%3D%3Dv3h-_KodxWONcoxoDrGLQ_j4BrA8Y3__Fe7hyxqPKQ%40mail.gmail.com%3E"
       TITLE="[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler">tyler.close at gmail.com
       </A><BR>
    <I>Fri Apr  6 16:50:41 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="077653.html">[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler
</A></li>
        <LI>Next message: <A HREF="077658.html">[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77654">[ date ]</a>
              <a href="thread.html#77654">[ thread ]</a>
              <a href="subject.html#77654">[ subject ]</a>
              <a href="author.html#77654">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>&gt;&gt;&gt;<i> On Mon, Apr 2, 2012 at 4:39 PM, Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ian at hixie.ch</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> &gt; On Mon, 26 Sep 2011, Tyler Close wrote:
</I>&gt;&gt;&gt;<i> For example, a web mail program might have two registered RPH handlers
</I>&gt;&gt;&gt;<i> for mailto: &quot;<A HREF="https://example.org/?from=me@company&amp;q=%s">https://example.org/?from=me@company&amp;q=%s</A>&quot; and
</I>&gt;&gt;&gt;<i> &quot;<A HREF="https://example.org/?from=me@personal&amp;q=%s">https://example.org/?from=me@personal&amp;q=%s</A>&quot;. The user has configured
</I>&gt;&gt;&gt;<i> their browser to send mailto links to their personal email editor. A
</I>&gt;&gt;&gt;<i> malicious client page could directly open the URL for the company email
</I>&gt;&gt;&gt;<i> editor. The web mail editor needs a way to detect when a client page is
</I>&gt;&gt;&gt;<i> trying to subvert the user's chosen preferences. So, an RPH handler
</I>&gt;&gt;&gt;<i> needs a way to know that it was loaded via the RPH dispatch. Once it
</I>&gt;&gt;&gt;<i> knows this, it can also trust that the arguments in the URL, such as
</I>&gt;&gt;&gt;<i> &quot;from&quot; in this case, were not tampered with by the client page.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I don't understand the attack scenario. Sure, a Web page can open another
</I>&gt;&gt;<i> Web page with arbitrary arguments. Why does it matter here?
</I>
In the example above, the user is expecting that clicking a mailto
link initiates sending of an email from their personal email account.
The attack page bypasses the RPH dispatch and directly sends the user
to their company email editor. Consequently, the user sends an email
from the wrong account, with potentially embarrassing results.

With the change I am asking for, the mailto RPH handler can detect
that the RPH dispatch was bypassed and show UI that says: &quot;Hey user,
this was an unusual request. Are you sure you want to use this
account? Maybe you want to use one of these others.&quot; In the legitimate
scenario, the mail handler page can assume that the user is using the
account they intended to, since the browser indicated that this is an
RPH request and so this handler is the one the user purposely
selected.

In other RPH use-cases, bypassing the user's selected preference could
have worse consequences. It's easy to protect against this and so not
have to worry about what else could go wrong.

--Tyler

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="077653.html">[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler
</A></li>
	<LI>Next message: <A HREF="077658.html">[whatwg] Fixing two security vulnerabilities in	registerProtocolHandler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77654">[ date ]</a>
              <a href="thread.html#77654">[ thread ]</a>
              <a href="subject.html#77654">[ subject ]</a>
              <a href="author.html#77654">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
