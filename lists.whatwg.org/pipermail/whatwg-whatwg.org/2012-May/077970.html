<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Declarative unload data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20%3D%3Futf-8%3Fq%3FDeclarative_unload_data%3F%3D&In-Reply-To=%3C20120507114252.5831D3E023D%40homiemail-mx23.g.dreamhost.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035686.html">
   <LINK REL="Next"  HREF="077971.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Declarative unload data</H1>
<!--htdig_noindex-->
    <B>Tim Streater</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20%3D%3Futf-8%3Fq%3FDeclarative_unload_data%3F%3D&In-Reply-To=%3C20120507114252.5831D3E023D%40homiemail-mx23.g.dreamhost.com%3E"
       TITLE="[whatwg] Declarative unload data">tim at clothears.org.uk
       </A><BR>
    <I>Mon May  7 04:42:00 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="035686.html">[whatwg] Declarative unload data
</A></li>
        <LI>Next message: <A HREF="077971.html">[whatwg] Declarative unload data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77970">[ date ]</a>
              <a href="thread.html#77970">[ thread ]</a>
              <a href="subject.html#77970">[ subject ]</a>
              <a href="author.html#77970">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On 07 May 2012 at 08:53, Tab Atkins Jr. &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jackalmage at gmail.com</A>&gt; wrote: 

&gt;<i> Besides those annoying &quot;Are you sure you want to leave this page?&quot;
</I>&gt;<i> dialogs, the primary use of the unload events is a final, desperate
</I>&gt;<i> attempt to throw a message at the server, either to save some data or
</I>&gt;<i> release some server-held resource.  However, this is tricky to do
</I>&gt;<i> reliably, because browsers kill pending XHRs as they unload the page.
</I>&gt;<i> Right now, I think the most reliable method is to create an &lt;img&gt; and
</I>&gt;<i> set its @src, because of an old quirk in IE that other browsers have
</I>&gt;<i> copied which means that pending image loads are carried to completion
</I>&gt;<i> rather than being killed.  This is, obviously, stupid.  (Another,
</I>&gt;<i> stupider, method is to prevent the handler from exiting by spinning a
</I>&gt;<i> no-op loop for several seconds, as I think browsers won't unload the
</I>&gt;<i> page until the handler exits?)
</I>
Personally I use onbeforeunload. In the handler for that I do a *synchronous* ajax request to have a tidy-up script run. The tidy-up script spins off a process that sleeps for 3 seconds before closing down apache. That allows the tidy-up script time to complete and send the ajax results back, so permitting the unbeforeunload handler to finish. Since the apache instance is running on the user's machine, the assumption here is that the three seconds is plenty of time.

--
Cheers  --  Tim
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035686.html">[whatwg] Declarative unload data
</A></li>
	<LI>Next message: <A HREF="077971.html">[whatwg] Declarative unload data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77970">[ date ]</a>
              <a href="thread.html#77970">[ thread ]</a>
              <a href="subject.html#77970">[ subject ]</a>
              <a href="author.html#77970">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
