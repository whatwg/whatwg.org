<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] multipart/form-data filename encoding: unicode and special characters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20multipart/form-data%20filename%20encoding%3A%20unicode%20and%0A%20special%20characters&In-Reply-To=%3C4FA11DDD.7050002%40gmx.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="077893.html">
   <LINK REL="Next"  HREF="077899.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] multipart/form-data filename encoding: unicode and special characters</H1>
<!--htdig_noindex-->
    <B>Julian Reschke</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20multipart/form-data%20filename%20encoding%3A%20unicode%20and%0A%20special%20characters&In-Reply-To=%3C4FA11DDD.7050002%40gmx.de%3E"
       TITLE="[whatwg] multipart/form-data filename encoding: unicode and special characters">julian.reschke at gmx.de
       </A><BR>
    <I>Wed May  2 04:43:25 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="077893.html">[whatwg] multipart/form-data filename encoding: unicode and	special characters
</A></li>
        <LI>Next message: <A HREF="077899.html">[whatwg] multipart/form-data filename encoding: unicode and	special characters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77894">[ date ]</a>
              <a href="thread.html#77894">[ thread ]</a>
              <a href="subject.html#77894">[ subject ]</a>
              <a href="author.html#77894">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On 2012-05-02 13:05, Evan Jones wrote:
&gt;<i> On May 1, 2012, at 22:38 , Ashley Sheridan wrote:
</I>&gt;&gt;<i> The Webkit method looks the better of the two with regards to how
</I>&gt;&gt;<i> server-side languages might interpret it, but it would need work to
</I>&gt;&gt;<i> ensure everything that should be escaped is, and that everything that is
</I>&gt;&gt;<i> unescaped on the server should be and is done so correctly.
</I>&gt;<i>
</I>&gt;<i> The problem is that currently I am unable to correctly &quot;round trip&quot; an uploaded file name. I would like users to upload a file, and be able to later download the file with the *exact same* file name. If you follow the specifications, this is not possible. Firefox is closer to the MIME RFCs (which specifies backslash quoting in quoted-strings), but apparently that will break IE6, 7, and 8:
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://bugs.webkit.org/show_bug.cgi?id=62107">https://bugs.webkit.org/show_bug.cgi?id=62107</A>
</I>&gt;<i> <A HREF="http://java.net/jira/browse/JERSEY-759">http://java.net/jira/browse/JERSEY-759</A>
</I>&gt;<i>
</I>&gt;<i> Webkit's %-escaping behaviour is *not* part of the referenced MIME RFCs (which specifies either backslash quoting in quoted-strings, base64 encoding, or %-escaping in special &quot;filename*=&quot; arguments). Thus, if this is the &quot;right answer,&quot; it should be specified somewhere. I'm assuming that this needs to be in the HTML5 spec, since HTTP calls this the &quot;body&quot; of the the POST and declares that it is outside the HTTP specification.
</I>&gt;<i>
</I>&gt;<i> Webkit's escaping is also flawed (see bug 62107 above). Files with that contain %-escapes (eg. my%22file.txt, admittedly very rare) will get mangled, because there is no difference between my%22file.txt and my&quot;file.txt.
</I>&gt;<i>
</I>&gt;<i> Currently, I need to detect the browser in order to figure out what kind of unescaping to apply to the file name, and even then in some cases I can't figure out what the right file name is. Webkit claims this is a specification bug, so I'm hoping someone here might tell me if this is the case, and if so where can I file bugs, create test cases, etc?
</I>&gt;<i>
</I>&gt;<i> Evan
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> <A HREF="http://evanjones.ca/">http://evanjones.ca/</A>
</I>
I did spend a considerable amount of time with Content-Disposition, the 
*response* header field (resulting in RFC 6266 and 
&lt;<A HREF="http://greenbytes.de/tech/tc2231/">http://greenbytes.de/tech/tc2231/</A>&gt;).

However, this has little to do with the representation in form uploads. 
If browser implementers want to try something new that will not affect 
the old code paths, supporting the encoding defined in RFC 5987 might be 
the right thing to do (yes, it's ugly, but it's unambiguous).

Best regards, Julian

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="077893.html">[whatwg] multipart/form-data filename encoding: unicode and	special characters
</A></li>
	<LI>Next message: <A HREF="077899.html">[whatwg] multipart/form-data filename encoding: unicode and	special characters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77894">[ date ]</a>
              <a href="thread.html#77894">[ thread ]</a>
              <a href="subject.html#77894">[ subject ]</a>
              <a href="author.html#77894">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
