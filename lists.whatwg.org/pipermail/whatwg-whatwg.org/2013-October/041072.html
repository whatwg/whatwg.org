<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] onclose events for MessagePort
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20onclose%20events%20for%20MessagePort&In-Reply-To=%3CCAArhhiuGqZ2CSTsRYeu-cFr%2Bf%3DaUpq-yzrON4U3LYw35cwUSyg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041070.html">
   <LINK REL="Next"  HREF="041160.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] onclose events for MessagePort</H1>
<!--htdig_noindex-->
    <B>Andrew Wilson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20onclose%20events%20for%20MessagePort&In-Reply-To=%3CCAArhhiuGqZ2CSTsRYeu-cFr%2Bf%3DaUpq-yzrON4U3LYw35cwUSyg%40mail.gmail.com%3E"
       TITLE="[whatwg] onclose events for MessagePort">atwilson at google.com
       </A><BR>
    <I>Fri Oct 11 01:37:43 PDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="041070.html">[whatwg] onclose events for MessagePort
</A></li>
        <LI>Next message: <A HREF="041160.html">[whatwg] onclose events for MessagePort
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41072">[ date ]</a>
              <a href="thread.html#41072">[ thread ]</a>
              <a href="subject.html#41072">[ subject ]</a>
              <a href="author.html#41072">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Fri, Oct 11, 2013 at 10:18 AM, Anne van Kesteren &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">annevk at annevk.nl</A>&gt;wrote:

&gt;<i> On Fri, Oct 11, 2013 at 9:38 AM, Andrew Wilson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">atwilson at google.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; *&quot;or while there exists an event listener on either port for the
</I>&gt;<i> &gt; channeldropped event.&quot;*
</I>&gt;<i>
</I>&gt;<i> Once you do that you basically rely on the developer to handle GC and
</I>&gt;<i> you'll end up with memory leaks instead.
</I>&gt;<i>
</I>&gt;<i>
</I>Agreed. I'm just pointing out that language/behavior like this is basically
required if you're going to support a channeldropped event that can be
spontaneously generated even on ports that have no live external references.

To ameliorate this, you could say that the ports are only kept alive in the
case that they have different owners (if I create a port and keep both ends
with the same owner, then you'll never need to generate a channeldropped
event and you can freely free them whenever there are no active
references/pending events).

As a data point/implementation note: Chrome already leaks ports whose
entangled endpoints live in separate processes. It's just too hard to do
the cross-process GC required to guarantee that both sides are unreachable.
That's one reason why the spec states that it's best practice to explicitly
close MessagePorts:

Authors are strongly encouraged to explicitly close
MessagePort&lt;<A HREF="http://www.w3.org/TR/webmessaging/#messageport">http://www.w3.org/TR/webmessaging/#messageport</A>&gt; objects
to disentangle them, so that their resources can be recollected. Creating
many MessagePort &lt;<A HREF="http://www.w3.org/TR/webmessaging/#messageport">http://www.w3.org/TR/webmessaging/#messageport</A>&gt; objects
and discarding them without closing them can lead to high memory usage.
</PRE>






<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041070.html">[whatwg] onclose events for MessagePort
</A></li>
	<LI>Next message: <A HREF="041160.html">[whatwg] onclose events for MessagePort
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41072">[ date ]</a>
              <a href="thread.html#41072">[ thread ]</a>
              <a href="subject.html#41072">[ subject ]</a>
              <a href="author.html#41072">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
