<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] API for encoding/decoding ArrayBuffers into text
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20API%20for%20encoding/decoding%20ArrayBuffers%20into%20text&In-Reply-To=%3Calpine.DEB.2.00.1203162016290.2182%40sirius%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="077357.html">
   <LINK REL="Next"  HREF="077359.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] API for encoding/decoding ArrayBuffers into text</H1>
<!--htdig_noindex-->
    <B>James Graham</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20API%20for%20encoding/decoding%20ArrayBuffers%20into%20text&In-Reply-To=%3Calpine.DEB.2.00.1203162016290.2182%40sirius%3E"
       TITLE="[whatwg] API for encoding/decoding ArrayBuffers into text">jgraham at opera.com
       </A><BR>
    <I>Fri Mar 16 12:22:13 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="077357.html">[whatwg] API for encoding/decoding ArrayBuffers into text
</A></li>
        <LI>Next message: <A HREF="077359.html">[whatwg] API for encoding/decoding ArrayBuffers into text
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77358">[ date ]</a>
              <a href="thread.html#77358">[ thread ]</a>
              <a href="subject.html#77358">[ subject ]</a>
              <a href="author.html#77358">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>

On Fri, 16 Mar 2012, Glenn Maynard wrote:

&gt;<i> On Fri, Mar 16, 2012 at 11:19 AM, Joshua Bell &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jsbell at chromium.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> And just to be clear, the use case is decoding data formats where string
</I>&gt;&gt;<i> fields are variable length null terminated.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> A concrete example is ZIP central directories.
</I>&gt;<i>
</I>&gt;<i> I think we want both encoding and destination to be optional. That leads us
</I>&gt;&gt;<i> to an API like:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> out_dict = stringEncoding.encode(&quot;string&quot;, opt_dict);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> .. where both out_dict and opt_dict are WebIDL Dictionaries:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> opt_dict keys: view, encoding
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> out_dict keys: charactersWritten, byteWritten, output
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The return value should just be a [NoInterfaceObject] interface.
</I>&gt;<i> Dictionaries are used for input fields.
</I>&gt;<i>
</I>&gt;<i> Something that came up on IRC that we should spend some time thinking
</I>&gt;<i> about, though: Is it actually important to be able to encode into an
</I>&gt;<i> existing buffer?  This may be a premature optimization.  You can always
</I>&gt;<i> encode into a new buffer, and--if needed--copy the result where you need it.
</I>&gt;<i>
</I>&gt;<i> If we don't support that, most of this extra stuff in encode() goes away.
</I>
Yes, I think we should focus on getting feature parity with e.g. python 
first -- i.e. not worry about decoding into existing buffers -- and add 
extra fancy stuff later if we find that there are actually usecases where 
avoiding the copy is critical. This should allow us to focus on getting 
the right API for the common case.

&gt;<i> If in-place decoding isn't really needed, we could have:
</I>&gt;<i>
</I>&gt;<i> newView = str.encode(&quot;utf-8&quot;); // or {encoding: &quot;utf-8&quot;}
</I>&gt;<i> str2 = newView.decode(&quot;utf-8&quot;);
</I>&gt;<i> len = newView.find(0); // replaces stringLength, searching for 0 in the
</I>&gt;<i> view's type; you'd use Uint16Array for UTF-16
</I>&gt;<i>
</I>&gt;<i> and encodedLength() would go away.
</I>
This looks like a big win to me.

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="077357.html">[whatwg] API for encoding/decoding ArrayBuffers into text
</A></li>
	<LI>Next message: <A HREF="077359.html">[whatwg] API for encoding/decoding ArrayBuffers into text
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77358">[ date ]</a>
              <a href="thread.html#77358">[ thread ]</a>
              <a href="subject.html#77358">[ subject ]</a>
              <a href="author.html#77358">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
