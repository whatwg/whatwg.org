<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] History: onpopstate on initial document load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20History%3A%20onpopstate%20on%20initial%20document%20load&In-Reply-To=%3CCABirCh9Sa5Ui9qLpBnN3icgvXACuWwn04%2Bb73p1oLN5XAfy6Jw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="079203.html">
   <LINK REL="Next"  HREF="079202.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] History: onpopstate on initial document load</H1>
<!--htdig_noindex-->
    <B>Glenn Maynard</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20History%3A%20onpopstate%20on%20initial%20document%20load&In-Reply-To=%3CCABirCh9Sa5Ui9qLpBnN3icgvXACuWwn04%2Bb73p1oLN5XAfy6Jw%40mail.gmail.com%3E"
       TITLE="[whatwg] History: onpopstate on initial document load">glenn at zewt.org
       </A><BR>
    <I>Wed Aug 15 21:17:41 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="079203.html">[whatwg] Archive API - proposal
</A></li>
        <LI>Next message: <A HREF="079202.html">[whatwg] History: onpopstate on initial document load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36926">[ date ]</a>
              <a href="thread.html#36926">[ thread ]</a>
              <a href="subject.html#36926">[ subject ]</a>
              <a href="author.html#36926">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Should this alert on initial load?

&lt;!doctype html&gt;&lt;body onpopstate=&quot;alert('xxx')&quot;&gt;

[1] says &quot;After creating the Document object, but before any script
execution, certainly before the parser stops, the user agent must update
the session history with the new page.&quot;  That invokes [2] &quot;update the
session history with the new page&quot;, which invokes [3] &quot;Traverse the history
to the new entry&quot;, which fires popstate in step 14.

However, &quot;After creating the Document object, but before any script
execution&quot; seems like it could happen before or after the &lt;body&gt; element
has been parsed, so the alert may or may not happen.

Whether it's always invoked or never invoked, it would be least confusing
for it to match up with:

&lt;!doctype html&gt;&lt;script&gt;window.onpopstate = alert(&quot;xxx&quot;);&lt;/script&gt;

so either both of the above or neither of the above alert.  From what I can
tell, this one should never alert on load, since the script doesn't run
until after the popstate event has already happened.

WebKit alerts in both of these cases (and after onload).  Firefox and Opera
alert in neither.

[1] <A HREF="http://www.whatwg.org/specs/web-apps/current-work/#read-html">http://www.whatwg.org/specs/web-apps/current-work/#read-html</A>
[2]
<A HREF="http://www.whatwg.org/specs/web-apps/current-work/#update-the-session-history-with-the-new-page">http://www.whatwg.org/specs/web-apps/current-work/#update-the-session-history-with-the-new-page</A>
[3] <A HREF="http://www.whatwg.org/specs/web-apps/current-work/#traverse-the-history">http://www.whatwg.org/specs/web-apps/current-work/#traverse-the-history</A>

-- 
Glenn Maynard
</PRE>

















<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="079203.html">[whatwg] Archive API - proposal
</A></li>
	<LI>Next message: <A HREF="079202.html">[whatwg] History: onpopstate on initial document load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36926">[ date ]</a>
              <a href="thread.html#36926">[ thread ]</a>
              <a href="subject.html#36926">[ subject ]</a>
              <a href="author.html#36926">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
