<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Behavior when &lt;script&gt; is removed from DOM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Behavior%20when%20%3Cscript%3E%20is%20removed%20from%20DOM&In-Reply-To=%3CCAD649j5Ohq2aWfb85yXy1seSi5tWKg3ueZfd69Cz6X07Af-%3DSg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034100.html">
   <LINK REL="Next"  HREF="034102.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Behavior when &lt;script&gt; is removed from DOM</H1>
<!--htdig_noindex-->
    <B>Joshua Bell</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Behavior%20when%20%3Cscript%3E%20is%20removed%20from%20DOM&In-Reply-To=%3CCAD649j5Ohq2aWfb85yXy1seSi5tWKg3ueZfd69Cz6X07Af-%3DSg%40mail.gmail.com%3E"
       TITLE="[whatwg] Behavior when &lt;script&gt; is removed from DOM">jsbell at chromium.org
       </A><BR>
    <I>Wed Dec  7 12:22:51 PST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="034100.html">[whatwg] Behavior when &lt;script&gt; is removed from DOM
</A></li>
        <LI>Next message: <A HREF="034102.html">[whatwg] Behavior when &lt;script&gt; is removed from DOM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34101">[ date ]</a>
              <a href="thread.html#34101">[ thread ]</a>
              <a href="subject.html#34101">[ subject ]</a>
              <a href="author.html#34101">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Wed, Dec 7, 2011 at 12:01 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:

&gt;<i> On Wed, Dec 7, 2011 at 11:27 AM, Adam van den Hoven &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">adam at littlefyr.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; On Sat, Dec 3, 2011 at 9:17 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Sat, Dec 3, 2011 at 7:38 PM, Yehuda Katz &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">wycats at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; Yehuda Katz
</I>&gt;<i> &gt;&gt; &gt; (ph) 718.877.1325
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; On Sat, Dec 3, 2011 at 6:37 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; On Sat, Dec 3, 2011 at 6:24 PM, Yehuda Katz &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">wycats at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Yehuda Katz
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; (ph) 718.877.1325
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; On Fri, Dec 2, 2011 at 11:30 AM, Tab Atkins Jr.
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jackalmage at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; On Fri, Dec 2, 2011 at 11:27 AM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; &gt; The main use case for wanting to support scripts getting appears
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; &gt; to
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; &gt; be
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; &gt; wanting to abort JSONP loads. Potentially to issue it with new
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; &gt; parameters. This is a decent use case, but given the racyness
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; &gt; described above in webkit, it doesn't seem like a reliable
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; &gt; technique
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; &gt; in existing browsers.
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; If it's unreliable *and* no sites appear to break with the proper
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; behavior, we shouldn't care about this use-case, since
</I>&gt;<i> cross-domain
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;&gt; XHR solves it properly.
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Cross-domain XHR *can* solve this use case, but the fact is that
</I>&gt;<i> CORS
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; is
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; harder to implement JSONP, and so we continue to have a large
</I>&gt;<i> number
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; of
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; web
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; APIs that support JSONP but not CORS. Unfortunately, I do not
</I>&gt;<i> forsee
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; this
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; changing in the near future.
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; I think we can solve this in 3 ways:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; 1. Keep spec as it is. Pages can simply ignore the JSONP callback
</I>&gt;<i> when
</I>&gt;<i> &gt;&gt; &gt;&gt; it happens.
</I>&gt;<i> &gt;&gt; &gt;&gt; Disadvantages:
</I>&gt;<i> &gt;&gt; &gt;&gt; Additional bandwidth.
</I>&gt;<i> &gt;&gt; &gt;&gt; More complexity for the web page.
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; 2. Make removing scripts cancel any execution
</I>&gt;<i> &gt;&gt; &gt;&gt; Disadvantages:
</I>&gt;<i> &gt;&gt; &gt;&gt; Pages will have to deal with the fact that removing scripts can still
</I>&gt;<i> &gt;&gt; &gt;&gt; cause the callback to happen if the load just finished. So the same
</I>&gt;<i> &gt;&gt; &gt;&gt; amount of complexity for page authors that don't want buggy pages as
</I>&gt;<i> &gt;&gt; &gt;&gt; alternative 1.
</I>&gt;<i> &gt;&gt; &gt;&gt; Since many pages likely won't properly handle the callback happening
</I>&gt;<i> &gt;&gt; &gt;&gt; anyway will likely cause pages to be buggy in contemporary browsers.
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; 3. Add a new API to reliably cancel a script load
</I>&gt;<i> &gt;&gt; &gt;&gt; Disadvantages:
</I>&gt;<i> &gt;&gt; &gt;&gt; New API for pages to learn.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; 4. Add a new API (or customize XHR) to explicitly support JSONP
</I>&gt;<i> &gt;&gt; &gt; requests,
</I>&gt;<i> &gt;&gt; &gt; and allow those requests to be cancelled.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Yes, that's definitely an option.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; It will be sort of a weird API since the security model will be sort
</I>&gt;<i> &gt;&gt; of strange. Traditionally we say that you can't load data cross site,
</I>&gt;<i> &gt;&gt; but that you can execute scripts cross site. Here we want something
</I>&gt;<i> &gt;&gt; sort of in between.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; It could have significant advantages if it makes it easier for sites
</I>&gt;<i> &gt;&gt; to do cross-site loading of data without exposing themselves to XSS
</I>&gt;<i> &gt;&gt; risks.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; / Jonas
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If we went for a hybrid approach, namely that XHR has a cancellable way
</I>&gt;<i> to
</I>&gt;<i> &gt; call and execute some arbitrary JavaScript and sandbox the execution so
</I>&gt;<i> that
</I>&gt;<i> &gt; &quot;this&quot; is something explicitly provided to the XHR, would we not suddenly
</I>&gt;<i> &gt; have a rather secure way to load any javascript in general (and probably
</I>&gt;<i> &gt; make things like lab.js and yepnope easier to write)? Now I can load some
</I>&gt;<i> &gt; javascript (say from some ad server) without giving it access to the
</I>&gt;<i> window
</I>&gt;<i> &gt; object and the global scope, if I don't want to. Wouldn't this address
</I>&gt;<i> some
</I>&gt;<i> &gt; of the security issues that Doug Crockford has brought up in the past?
</I>&gt;<i>
</I>&gt;<i> Yeah. This would be very cool. Proposals more than welcome, though I
</I>&gt;<i> would suggest not tying it to XHR but rather have a dedicated &quot;load
</I>&gt;<i> and execute this url in this sandbox&quot; API.
</I>&gt;<i>
</I>&gt;<i> Designing a sandbox API is likely a fairly large task. I believe that
</I>&gt;<i> ES.next might have something to that extent but I'm not fully sure.
</I>&gt;<i>
</I>&gt;<i>
</I>Yeah, the &quot;modules&quot; proposal for ES &quot;harmony&quot; is fairly similar:
<A HREF="http://wiki.ecmascript.org/doku.php?id=harmony:modules">http://wiki.ecmascript.org/doku.php?id=harmony:modules</A>

The relative bits for this thread are that a script can be loaded into a
new pristine global environment (i.e. it doesn't just get to party on
window, is shielded from any prior monkeying with Object.prototype, etc)
and decides what to export (by applying properties to its global object);
the script doing the import can decide what to pick up from from the global
object of the imported module.

This can't be implemented in JS today (e.g. as a shim) since that &quot;evaluate
this script text in this new global sandbox&quot; bit isn't present.


&gt;<i> A dedicated JSONP API is likely a lot simpler to design and could be
</I>&gt;<i> specced and rolled out quicker. But of course has a smaller feature
</I>&gt;<i> set.
</I>&gt;<i>
</I>&gt;<i> / Jonas
</I>&gt;<i>
</I>&gt;<i> / Jonas
</I>&gt;<i>
</I></PRE>











<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034100.html">[whatwg] Behavior when &lt;script&gt; is removed from DOM
</A></li>
	<LI>Next message: <A HREF="034102.html">[whatwg] Behavior when &lt;script&gt; is removed from DOM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34101">[ date ]</a>
              <a href="thread.html#34101">[ thread ]</a>
              <a href="subject.html#34101">[ subject ]</a>
              <a href="author.html#34101">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
