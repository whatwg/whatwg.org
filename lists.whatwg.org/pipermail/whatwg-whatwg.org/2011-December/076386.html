<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Behavior when &lt;script&gt; is removed from DOM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Behavior%20when%20%3Cscript%3E%20is%20removed%20from%20DOM&In-Reply-To=%3CCAMFeDTXEcHiWowRO3aq%3DARB-h5nXomjtjMFVCyuUF1BPcF1R7g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="076383.html">
   <LINK REL="Next"  HREF="076406.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Behavior when &lt;script&gt; is removed from DOM</H1>
<!--htdig_noindex-->
    <B>Yehuda Katz</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Behavior%20when%20%3Cscript%3E%20is%20removed%20from%20DOM&In-Reply-To=%3CCAMFeDTXEcHiWowRO3aq%3DARB-h5nXomjtjMFVCyuUF1BPcF1R7g%40mail.gmail.com%3E"
       TITLE="[whatwg] Behavior when &lt;script&gt; is removed from DOM">wycats at gmail.com
       </A><BR>
    <I>Thu Dec  8 10:06:19 PST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="076383.html">[whatwg] Behavior when &lt;script&gt; is removed from DOM
</A></li>
        <LI>Next message: <A HREF="076406.html">[whatwg] Behavior when &lt;script&gt; is removed from DOM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#76386">[ date ]</a>
              <a href="thread.html#76386">[ thread ]</a>
              <a href="subject.html#76386">[ subject ]</a>
              <a href="author.html#76386">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Yehuda Katz
(ph) 718.877.1325


On Thu, Dec 8, 2011 at 9:23 AM, Mark S. Miller &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">erights at google.com</A>&gt; wrote:

&gt;<i> Given only that the JSONP response has a ACCESS-CONTROL-ALLOW-ORIGIN:*
</I>&gt;<i> header, the API you suggest below can be fully implemented as a library.
</I>&gt;<i>
</I>&gt;<i> Since any response that parses as JavaScript has no same origin protection
</I>&gt;<i> anyway, rather than carve out a special case for JSONP, should we waive
</I>&gt;<i> the ACCESS-CONTROL-ALLOW-ORIGIN:* requirement on responses that parse as
</I>&gt;<i> JavaScript for XHR requests in general? If not, what justifies carving out
</I>&gt;<i> a special case for JSONP?
</I>&gt;<i>
</I>
In the general case, executed JavaScript does not expose the content.
Existing JSONP implementations obviously work as libraries, but
implementing them robustly is non-trivial. Given that we know that this
subset is already secure (or at least, doesn't add any new security
issues), creating an explicit API that eliminated the library fiddliness
(and need for registering a global function) would be great.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, Dec 7, 2011 at 5:20 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Wed, Dec 7, 2011 at 3:55 PM, Yehuda Katz &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">wycats at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Yehuda Katz
</I>&gt;&gt;<i> &gt; (ph) 718.877.1325
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; On Wed, Dec 7, 2011 at 3:43 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; On Wed, Dec 7, 2011 at 12:39 PM, Yehuda Katz &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">wycats at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt; &gt; Yehuda Katz
</I>&gt;&gt;<i> &gt;&gt; &gt; (ph) 718.877.1325
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; On Wed, Dec 7, 2011 at 12:29 PM, Boris Zbarsky &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">bzbarsky at mit.edu</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; On 12/7/11 3:22 PM, Joshua Bell wrote:
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt;&gt; This can't be implemented in JS today (e.g. as a shim) since that
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt;&gt; &quot;evaluate
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt;&gt; this script text in this new global sandbox&quot; bit isn't present.
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; It can sort of be done via opening a new window and setting its
</I>&gt;&gt;<i> opener
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; to
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; null before injecting some &lt;script&gt; tags into it.  Modulo popup
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; blockers
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; and crappy user experience, of course....
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; Or evaluating the script inside a worker, perhaps?
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Workers aren't great sandboxes. They already have access to shared
</I>&gt;&gt;<i> &gt;&gt; workers and XHR. Soon they will get access to IndexedDB too. So
</I>&gt;&gt;<i> &gt;&gt; there's lots of damage they can cause.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; If we want to run untrusted code then I think we need to have an API
</I>&gt;&gt;<i> &gt;&gt; specifically designed for that.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; If we want an API for loading JSONP data apart from the sandbox (which
</I>&gt;&gt;<i> &gt;&gt; I think is needed), then we should have an API specifically designed
</I>&gt;&gt;<i> &gt;&gt; for that. It's possible that we can reuse XHR here and just adjust the
</I>&gt;&gt;<i> &gt;&gt; security model when the returned data is JSONP.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; You would at least want to execute them in a lexical scope containing
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> &gt; callback, so that the callback did not need to be installed on the
</I>&gt;&gt;<i> global
</I>&gt;&gt;<i> &gt; scope.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ideally we wouldn't execute anything. We'd just parse the JSON literal
</I>&gt;&gt;<i> and hand that back. That is what'll give us safety.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To make a concrete, but hideous, example:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We could add xhr.responseType = &quot;jsonp&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When this is set, the XHR object will look for contents on the following
</I>&gt;&gt;<i> form:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;js identifier&gt; '(' &lt;js-literal&gt; ')'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> followed by an optional ';'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When the contents follows that syntax, the XHR object parses the
</I>&gt;&gt;<i> js-literal and sets it's .response property to the result.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Other than that the XHR object works just as it currently does. I.e.
</I>&gt;&gt;<i> it fires progress events, load events and readystatechange events as
</I>&gt;&gt;<i> normal.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This way no JS execution happens, and no global names need to be set
</I>&gt;&gt;<i> up. The &lt;js identifier&gt; part is simply ignored other than to check
</I>&gt;&gt;<i> that it's a valid js identifier.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I believe we can come up with something better than this, but it's a
</I>&gt;&gt;<i> demonstration of what's technically feasible.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> / Jonas
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>     Cheers,
</I>&gt;<i>     --MarkM
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="076383.html">[whatwg] Behavior when &lt;script&gt; is removed from DOM
</A></li>
	<LI>Next message: <A HREF="076406.html">[whatwg] Behavior when &lt;script&gt; is removed from DOM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#76386">[ date ]</a>
              <a href="thread.html#76386">[ thread ]</a>
              <a href="subject.html#76386">[ subject ]</a>
              <a href="author.html#76386">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
