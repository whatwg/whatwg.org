<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to handle it.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20document.write%28%22%5Cr%22%29%3A%20the%20spec%20doesn%27t%20say%20how%20to%0A%20handle%20it.&In-Reply-To=%3CPine.LNX.4.64.1112132356370.18028%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034166.html">
   <LINK REL="Next"  HREF="076502.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to handle it.</H1>
<!--htdig_noindex-->
    <B>Ian Hickson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20document.write%28%22%5Cr%22%29%3A%20the%20spec%20doesn%27t%20say%20how%20to%0A%20handle%20it.&In-Reply-To=%3CPine.LNX.4.64.1112132356370.18028%40ps20323.dreamhostps.com%3E"
       TITLE="[whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to handle it.">ian at hixie.ch
       </A><BR>
    <I>Tue Dec 13 16:00:26 PST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="034166.html">[whatwg] HTML parsing: &quot;act as if...had been seen&quot; using what insertion mode?
</A></li>
        <LI>Next message: <A HREF="076502.html">[whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to	handle it.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34167">[ date ]</a>
              <a href="thread.html#34167">[ thread ]</a>
              <a href="subject.html#34167">[ subject ]</a>
              <a href="author.html#34167">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Wed, 2 Nov 2011, David Flanagan wrote:
&gt;<i>
</I>&gt;<i> The spec for document.write()
</I>&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#dom-document-write">http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#dom-document-write</A>
</I>&gt;<i> says: &quot;... have the tokenizer process the characters that were inserted, one
</I>&gt;<i> at a time, processing resulting tokens as they are emitted, and stopping when
</I>&gt;<i> the tokenizer reaches the insertion point...&quot;
</I>&gt;<i> 
</I>&gt;<i> But what happens if the last character written by document.write() is a
</I>&gt;<i> carriage return?
</I>&gt;<i> 
</I>&gt;<i> The HTML parsing spec says that CR followed by LF is ignored but CR 
</I>&gt;<i> followed by anything else is converted to LF.  So if the last character 
</I>&gt;<i> is CR, then the tokenizer can't process all characters up to the 
</I>&gt;<i> insertion point because it needs to lookahead at the next character, 
</I>&gt;<i> right?
</I>
I can remove the text &quot;one at a time&quot;, if you like. Would that be 
satisfactory? Or I guess I could change the spec to say that the parser 
should process the characters, rather than the tokenizer, since really 
it's the whole shebang that needs to be involved (stream preprocessor and 
everything). Any opinions on what the right text is here?


&gt;<i> Similarly, what should the tokenizer do if the document.write emits half 
</I>&gt;<i> of a UTF-16 surrogate pair as the last character?
</I>
Can you elaborate on what difficulty this would present?

-- 
Ian Hickson               U+1047E                )\._.,--....,'``.    fL
<A HREF="http://ln.hixie.ch/">http://ln.hixie.ch/</A>       U+263A                /,   _.. \   _\  ;`._ ,.
Things that are impossible just take longer.   `._.-(,_..'--(,_..'`-.;.'
</PRE>






























<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034166.html">[whatwg] HTML parsing: &quot;act as if...had been seen&quot; using what insertion mode?
</A></li>
	<LI>Next message: <A HREF="076502.html">[whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to	handle it.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34167">[ date ]</a>
              <a href="thread.html#34167">[ thread ]</a>
              <a href="subject.html#34167">[ subject ]</a>
              <a href="author.html#34167">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
