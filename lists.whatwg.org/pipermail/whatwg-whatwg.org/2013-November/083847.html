<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] The src-N proposal
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20The%20src-N%20proposal&In-Reply-To=%3Cop.w6tg2vrvidj3kv%40simons-macbook-pro.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="083831.html">
   <LINK REL="Next"  HREF="083848.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] The src-N proposal</H1>
<!--htdig_noindex-->
    <B>Simon Pieters</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20The%20src-N%20proposal&In-Reply-To=%3Cop.w6tg2vrvidj3kv%40simons-macbook-pro.local%3E"
       TITLE="[whatwg] The src-N proposal">simonp at opera.com
       </A><BR>
    <I>Tue Nov 19 14:07:33 PST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="083831.html">[whatwg] The src-N proposal
</A></li>
        <LI>Next message: <A HREF="083848.html">[whatwg] The src-N proposal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#83847">[ date ]</a>
              <a href="thread.html#83847">[ thread ]</a>
              <a href="subject.html#83847">[ subject ]</a>
              <a href="author.html#83847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Tue, 19 Nov 2013 12:40:17 +0100, James Graham &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">james at hoppipolla.co.uk</A>&gt;  
wrote:

&gt;<i> On 19/11/13 01:55, Kornel Lesi&#324;ski wrote:
</I>&gt;&gt;<i> On Tue, 19 Nov 2013 01:12:12 -0000, Tab Atkins Jr.  
</I>&gt;&gt;<i> &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jackalmage at gmail.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> AFAIK it makes it as easy to implement and as safe to use as src-N.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Simon, who initially raised concerns about use of &lt;source&gt; in  
</I>&gt;&gt;&gt;&gt;<i> &lt;picture&gt;
</I>&gt;&gt;&gt;&gt;<i> found that solution acceptable[2].
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I'd love to hear feedback about simplified, atomic &lt;source&gt; from other
</I>&gt;&gt;&gt;&gt;<i> vendors.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The cost there is that &lt;picture&gt;&lt;source&gt; is now treated substantially
</I>&gt;&gt;&gt;<i> differently than &lt;video&gt;&lt;source&gt;, despite sharing a name.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The substantial difference is that it lacks JS API exposing
</I>&gt;&gt;<i> network/buffering state, but IHMO that's not a big loss, as those
</I>&gt;&gt;<i> concepts are not as needed for pictures.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IMHO the important thing is that on the surface (syntactical level)
</I>&gt;&gt;<i> they're the same - multiple &lt;source&gt; elements where the first one  
</I>&gt;&gt;<i> matches.
</I>&gt;<i>
</I>&gt;<i> So the remaining objections I am aware of to atomic-source are:
</I>&gt;<i>
</I>&gt;<i> * Something related to animations. I don't actually understand this, so  
</I>&gt;<i> it would be nice if someone who does would explain. Alternatively this  
</I>&gt;<i> might not actually be an issue.
</I>&gt;<i>
</I>&gt;<i> * Verbosity. This proposal is clearly verbose, but it is also the one  
</I>&gt;<i> that authors seem to prefer, largely because it uses the underlying  
</I>&gt;<i> markup syntax in a natural way. It seems that people will likely deal  
</I>&gt;<i> with the verbosity by copy and paste, templates or libraries to provide  
</I>&gt;<i> a convenient shorthand. If the latter occurs we can look at  
</I>&gt;<i> standardising it later.
</I>&gt;<i>
</I>&gt;<i> * More testing is needed. Specifically it seems that tests will be  
</I>&gt;<i> needed to use &lt;source&gt; elements (or &lt;picture&gt; elements?) where you can  
</I>&gt;<i> currently use &lt;img&gt; elements. This is a real concern of course, but  
</I>&gt;<i> seems lower on the priority of constituencies than authoring concerns,  
</I>&gt;<i> unless we think that poor interop will poison the feature. With an  
</I>&gt;<i> atomic proposal this seems much less likely, Hopefully implementations  
</I>&gt;<i> will be able to reuse the existing &lt;img&gt; code so that the actual amount  
</I>&gt;<i> of new *code* to test is less than you might think by looking at the  
</I>&gt;<i> extra API surface.
</I>
Also see discussion in  
<A HREF="http://krijnhoetmer.nl/irc-logs/whatwg/20131119#l-537">http://krijnhoetmer.nl/irc-logs/whatwg/20131119#l-537</A>

In <A HREF="http://lists.w3.org/Archives/Public/public-respimg/2013Oct/0045.html">http://lists.w3.org/Archives/Public/public-respimg/2013Oct/0045.html</A> I  
discuss a problem that a new element would have, namely that it would  
require a new fallback mechanism and a lot of stuff would need to be  
duplicated from img.

If we want to avoid that problem but still use &lt;source&gt; elements, that is  
possible by using &lt;img&gt; for rendering the image and &lt;source&gt; for providing  
the sources. There is precedent for this sort of thing in HTML, namely  
&lt;input list=x&gt; &lt;datalist id=x&gt;&lt;option&gt;...&lt;/datalist&gt;.

My first idea along these lines was to use &lt;img list=&quot;&quot;&gt;  
&lt;sourcelist&gt;&lt;source ...&gt;...&lt;/sourcelist&gt; where, if the img element has a  
list attribute, the next element sibling is used for the sources. However,  
Anne pointed out a problem that it wouldn't work so well if you want to  
create the image in script and have it load without appending it to the  
document, since they wouldn't be siblings. There are ways to make it work  
but it would be non-obvious and it's better to come up with something that  
just works.

So my next idea is to put the img element inside the sourcelist element,  
like so:

    &lt;sourcelist&gt; &lt;img list=&quot;&quot;&gt; &lt;source&gt;... &lt;/sourcelist&gt;

The sourcelist element would be a normal inline element and only serve to  
bind together the img with the source elements. I've left the list  
attribute on img because currently the &lt;img src&gt; would start loading as  
soon as the element is created by the HTML parser, before the element is  
inserted to the document so there is no parent. If we want to get rid of  
the attribute, we can make the HTML parser set a &quot;parser-created&quot; flag on  
the img element and upon element creation, if the flag is set, do nothing,  
and when it is inserted to the document, if the flag is set, unset it and  
run 'update the image data' steps. (The spec says to await a stable state  
before downloading anything, I don't know if browsers want img to wait  
with downloading until the parser yields or would rather handle a flag and  
not await a stable state for parser-created img.)

At this point we could change the name of the wrapping element to  
&lt;picture&gt; and basically have the same syntax as current &lt;picture&gt; except  
there would be a required &lt;img&gt; child element.

If we want similar syntax to &lt;video&gt;, the &lt;source&gt;s should go first and  
the &lt;img&gt; last.

So:

&lt;picture&gt;
  &lt;source ...&gt;
  &lt;source ...&gt;
  &lt;img src=&quot;fallback&quot; alt=&quot;...&quot;&gt;
&lt;/picture&gt;

The selection algorithm would only consider &lt;source&gt; elements that are  
previous siblings of the &lt;img&gt; if the parent is a &lt;picture&gt; element, and  
would be called in place of the current 'process the image candidates' in  
the spec (called from 'update the image data'). 'Update the image data'  
gets run when an img element is created, has its src or crossorigin (or  
srcset if we still want that on img) attributes changed/set/removed, is  
inserted or removed from its parent, when &lt;source&gt; is inserted to a  
&lt;picture&gt; as a previous sibling, or a &lt;source&gt; that is a previous sibling  
is removed from &lt;picture&gt;, or when a &lt;source&gt; that is a previous sibling  
and is in &lt;picture&gt; has its src or srcset (or whatever attributes we want  
to use on &lt;source&gt;) attributes changed/set/removed. 'Update the image  
data' aborts if the parser-created flag is set. When img is inserted to  
the document, if the parser-created flag is set, the flag is first unset  
and then 'update the image data' is run but without the await a stable  
state step.

-- 
Simon Pieters
Opera Software

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="083831.html">[whatwg] The src-N proposal
</A></li>
	<LI>Next message: <A HREF="083848.html">[whatwg] The src-N proposal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#83847">[ date ]</a>
              <a href="thread.html#83847">[ thread ]</a>
              <a href="subject.html#83847">[ subject ]</a>
              <a href="author.html#83847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
