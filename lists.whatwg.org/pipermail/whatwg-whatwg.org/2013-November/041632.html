<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Structured Clone of Map and Set objects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Structured%20Clone%20of%20Map%20and%20Set%20objects&In-Reply-To=%3Calpine.DEB.2.00.1311222048400.27766%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="083901.html">
   <LINK REL="Next"  HREF="083906.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Structured Clone of Map and Set objects</H1>
<!--htdig_noindex-->
    <B>Ian Hickson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Structured%20Clone%20of%20Map%20and%20Set%20objects&In-Reply-To=%3Calpine.DEB.2.00.1311222048400.27766%40ps20323.dreamhostps.com%3E"
       TITLE="[whatwg] Structured Clone of Map and Set objects">ian at hixie.ch
       </A><BR>
    <I>Fri Nov 22 12:57:52 PST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="083901.html">[whatwg] New responsive images proposal
</A></li>
        <LI>Next message: <A HREF="083906.html">[whatwg] Structured Clone of Map and Set objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41632">[ date ]</a>
              <a href="thread.html#41632">[ thread ]</a>
              <a href="subject.html#41632">[ subject ]</a>
              <a href="author.html#41632">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Wed, 4 Sep 2013, Oliver Hunt wrote:
&gt;<i>
</I>&gt;<i> The current structured clone algorithm does not include support for the 
</I>&gt;<i> Map and Set types, so a developer would need to manually implement the 
</I>&gt;<i> serialisation and deserialisation.  While this would not be impossible 
</I>&gt;<i> it does seem like it is an unnecessary inconvenience for a core type in 
</I>&gt;<i> ES6.
</I>&gt;<i> 
</I>&gt;<i> The semantics of Map and Set are stable so unless someone objects i see 
</I>&gt;<i> no reason we should not amend the internal structured clone algorithm to 
</I>&gt;<i> specially handle Set and Map in addition to Array.  To support cloning 
</I>&gt;<i> of Map and Set we will want to recursively call the structured clone 
</I>&gt;<i> algorithm on each key or key/value pair in the %SetData% or %MapData% 
</I>&gt;<i> internal arrays, and maintain the order of those entries (as the Map/Set 
</I>&gt;<i> ordering is well defined)
</I>
On Wed, 4 Sep 2013, Anne van Kesteren wrote:
&gt;<i> 
</I>&gt;<i> I suggested this to TC39 a while back and I still think it's a good idea 
</I>&gt;<i> even though reception was lukewarm at best (the people replying didn't 
</I>&gt;<i> like to acknowledge the existence of this seemed like). They should 
</I>&gt;<i> define this as a primitive of the Object type and define which objects 
</I>&gt;<i> support it and how. The monkey patching we do now is not great.
</I>
I agree with Anne that it'd be better if the JS spec just defined how to 
clone the various JS types natively.

Would anyone who works on the JS spec like to work with me to move the 
relevant parts over and define an appropriate hook for the HTML spec to 
invoke in the structured clone algorithm? (All that's needed is a hook 
that takes a value, and returns a new value that's a clone of the first, 
with a different realm, if I understand it right.)

I've filed this bug to track this:

   <A HREF="https://www.w3.org/Bugs/Public/show_bug.cgi?id=23892">https://www.w3.org/Bugs/Public/show_bug.cgi?id=23892</A>

-- 
Ian Hickson               U+1047E                )\._.,--....,'``.    fL
<A HREF="http://ln.hixie.ch/">http://ln.hixie.ch/</A>       U+263A                /,   _.. \   _\  ;`._ ,.
Things that are impossible just take longer.   `._.-(,_..'--(,_..'`-.;.'
</PRE>







<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="083901.html">[whatwg] New responsive images proposal
</A></li>
	<LI>Next message: <A HREF="083906.html">[whatwg] Structured Clone of Map and Set objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41632">[ date ]</a>
              <a href="thread.html#41632">[ thread ]</a>
              <a href="subject.html#41632">[ subject ]</a>
              <a href="author.html#41632">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
