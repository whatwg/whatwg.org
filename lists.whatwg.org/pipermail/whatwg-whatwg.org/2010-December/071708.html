<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] element &quot;img&quot; with HTTP POST method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20element%20%22img%22%20with%20HTTP%20POST%20method&In-Reply-To=%3C32BE9988-CCF7-41F5-AF6D-DF760DA43D0C%40kaor.in%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="071703.html">
   <LINK REL="Next"  HREF="071710.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] element &quot;img&quot; with HTTP POST method</H1>
<!--htdig_noindex-->
    <B>Martin Janecke</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20element%20%22img%22%20with%20HTTP%20POST%20method&In-Reply-To=%3C32BE9988-CCF7-41F5-AF6D-DF760DA43D0C%40kaor.in%3E"
       TITLE="[whatwg] element &quot;img&quot; with HTTP POST method">whatwg.org at kaor.in
       </A><BR>
    <I>Fri Dec 10 06:52:47 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="071703.html">[whatwg] element &quot;img&quot; with HTTP POST method
</A></li>
        <LI>Next message: <A HREF="071710.html">[whatwg] element &quot;img&quot; with HTTP POST method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#71708">[ date ]</a>
              <a href="thread.html#71708">[ thread ]</a>
              <a href="subject.html#71708">[ subject ]</a>
              <a href="author.html#71708">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Am 09.12.2010 um 20:41 schrieb Philipp Serafin:

&gt;<i> [...] though this would
</I>&gt;<i> also present serious security vulnerabilities, especially in forum pages.
</I>&gt;<i> 
</I>&gt;<i> There are quite a number of older web forums that sanitize their HTML
</I>&gt;<i> using black lists and would not strip new attributes like &quot;post-data&quot;.
</I>&gt;<i> For malicious users, it would be very easy to include e.g. &lt;img
</I>&gt;<i> src=&quot;./do_post.php&quot; post-data=&quot;thread_id=42&amp;post_content=Go visit (some
</I>&gt;<i> spam URL)&quot;&gt; in their signature and have users doing involuntary posts by
</I>&gt;<i> simply viewing a thread.
</I>
I actually considered the question of misuse in forums, but only thought of those that use BBCode and therefore shouldn't be vulnerable to this. But you're right, there are others that allow HTML elements.


Am 09.12.2010 um 21:09 schrieb Philipp Serafin:

&gt;<i> ... on second thought, maybe  it would be an even better idea to just
</I>&gt;<i> define a new &quot;submit&quot; like input type that would submit the form as soon
</I>&gt;<i> as it's fully loaded and display the POST result as an image. This would
</I>&gt;<i> work better with the form metaphor and would present less security
</I>&gt;<i> risks, since only very few sites allow &lt;form&gt; or &lt;input&gt; elements in
</I>&gt;<i> user content.
</I>&gt;<i> 
</I>&gt;<i> Martin Janecke's example would then look like this:
</I>&gt;<i> 
</I>&gt;<i> &lt;form method=&quot;post&quot; action=&quot;<A HREF="http://www.forkosh.dreamhost.com/mathtex.cgi">http://www.forkosh.dreamhost.com/mathtex.cgi</A>&quot;&gt;
</I>&gt;<i> &lt;input type=&quot;hidden&quot; name=&quot;latexdata&quot; value=&quot;\begin{align} (... latex
</I>&gt;<i> ...) \end{align}&quot;&gt;
</I>&gt;<i> &lt;input type=&quot;post-image&quot;&gt;
</I>&gt;<i> &lt;/form&gt;
</I>
Yes, this would be better indeed to prevent abuse by forum/social network/etc. users.


Am 10.12.2010 um 05:35 schrieb Tab Atkins Jr.:

&gt;<i> On Thu, Dec 9, 2010 at 7:15 PM, Adam Barth &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">w3c at adambarth.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> On Thu, Dec 9, 2010 at 11:41 AM, Philipp Serafin &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">phil127 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> There are quite a number of older web forums that sanitize their HTML using black lists and would not strip new attributes like &quot;post-data&quot;. For malicious users, it would be very easy to include e.g. &lt;img src=&quot;./do_post.php&quot; post-data=&quot;thread_id=42&amp;post_content=Go visit (some spam URL)&quot;&gt; in their signature and have users doing involuntary posts by simply viewing a thread.
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Indeed.  You shouldn't be able to trigger POSTs from involuntary
</I>&gt;&gt;&gt;&gt;&gt;<i> actions.  They should always require some sort of user input, because
</I>&gt;&gt;&gt;&gt;&gt;<i> there is simply *far* too much naive code out there that is vulnerable
</I>&gt;&gt;&gt;&gt;&gt;<i> to CSRF.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Unfortunately, the attacker can already trigger POSTs with involuntary
</I>&gt;&gt;&gt;&gt;<i> actions.  That code is already vulnerable attack, sadly.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Via scripting, yes, which is usually stripped out by sanitizers (or
</I>&gt;&gt;&gt;<i> just plain doesn't work, like javascript urls in images).  I don't
</I>&gt;&gt;&gt;<i> believe there are any declarative ways to trigger involuntary POSTs,
</I>&gt;&gt;&gt;<i> are there?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The attacker can always make a giant invisible button that covers the
</I>&gt;&gt;<i> whole page that submits a form.  Web sites can generate POST requests
</I>&gt;&gt;<i> without user intervention.  Anyone who's using POST as a security
</I>&gt;&gt;<i> feature as far bigger troubles than this attribute.
</I>&gt;<i> 
</I>&gt;<i> Heh, agreed about that.
</I>&gt;<i> 
</I>&gt;<i> But still, none of those are new POST-ing abilities that can be
</I>&gt;<i> utilized by J. Random User on a message board with half-decent
</I>&gt;<i> security.
</I>
I agree with Adam about POST being not sufficient as security measurement anyway. There are already enough other CSRF possibilities for malicious web page authors. And Philipp Serafin's idea seems to prevent new POST-ing abilities that can be utilized by J. Random User on a message board with half-decent security.

Nevertheless I doubt my use cases justify opening a CSRF hole that can be used by malicious web page authors, even if it is just another hole among many&#8230;? More security holes are worse than less, I guess.


Am 10.12.2010 um 09:23 schrieb Julian Reschke:

&gt;<i> It's sad that the discussion even got that far.
</I>
I'm very happy about the broad feedback highlighting different aspects of the topic.

&gt;<i> If the URI length is a problem because of browsers, fix the browsers to extend the limits, instead of adding a completely new feature.
</I>
That's a good idea. Can we define a minimum length in the spec that should/must be supported? As a point of reference for browser vendors and web page authors? I didn't find a reliable point of reference other than <A HREF="http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.2.1">http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.2.1</A> ...

Note: Servers ought to be cautious about depending on URI lengths
above 255 bytes, because some older client or proxy
implementations might not properly support these lengths.

... which isn't sufficient for the use cases.


Am 10.12.2010 um 10:03 schrieb Benjamin Hawkes-Lewis:

&gt;<i> POST is a sort of catch-all method, but what here do you think makes
</I>&gt;<i> POST a better match than GET?
</I>
I must admit that I apparently misunderstood &quot;In particular, the convention has been established that the GET and HEAD methods SHOULD NOT have the significance of taking an action other than retrieval&quot; (<A HREF="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1">http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1</A>). In the LaTeX example, the request provides source code which is compiled by the remote service. The requested content isn't something that the service provider prepared before. He just offers an environment and the user defines what happens within the boundaries of this environment. I considered this to be &quot;an action other than retrieval&quot; only. But now I understand that for the user it has the *significance* of retrieval only, though.

However, I still have the impression, that my use cases are described more precisely by the description &quot;Providing a block of data [...] to a data-handling process. [...] The actual function performed by the POST method is determined by the server and is usually dependent on the Request-URI. The posted entity is subordinate to that URI in the same way that a file is subordinate to a directory containing it, a news article is subordinate to a newsgroup to which it is posted, or a record is subordinate to a database.&quot; (POST) than what is described in the section about GET. But I might be wrong here (and also impaired by a lack of better understanding of the English language).

&gt;<i> See also:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.w3.org/2001/tag/doc/whenToUseGet.html">http://www.w3.org/2001/tag/doc/whenToUseGet.html</A>
</I>
Thank you for the link. In particular, I found the following passage in <A HREF="http://www.w3.org/2001/tag/doc/whenToUseGet.html#uris">http://www.w3.org/2001/tag/doc/whenToUseGet.html#uris</A> interesting:

&quot;By convention, when GET method is used, all information required to
identify the resource is encoded in the URI. There is no convention
in HTTP/1.1 for a safe interaction (e.g., retrieval) where the client
supplies data to the server in an HTTP entity body rather than in the
query part of a URI. This means that for safe operations, URIs may be
long. The case of large parameters to a safe operation is not
directly addressed by HTTP as it is presently deployed. A QUERY or
&quot;safe POST&quot; or &quot;GET with BODY&quot; method has been discussed (e.g., at
the December 1996 IETF meeting) but no consensus has emerged.&quot;

A &quot;safe POST&quot; or &quot;GET with BODY&quot; would meet what I'm looking for, it seems. But clearly this is out of scope of this mailing list.

&gt;&gt;<i> but also
</I>&gt;&gt;<i> for practical reasons: URLs in GET requests are (inconsistently)
</I>&gt;&gt;<i> limited in length by browsers and server software, which limits these
</I>&gt;&gt;<i> services (inconsistently).
</I>&gt;<i> 
</I>&gt;<i> The most popular browser currently limits URLs to 2,083 characters.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://support.microsoft.com/kb/208427">http://support.microsoft.com/kb/208427</A>
</I>&gt;<i> 
</I>&gt;<i> [...] Apparently, Firefox/Safari/Opera already support much longer URLs:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://blogs.nitobi.com/alexei/?p=163">http://blogs.nitobi.com/alexei/?p=163</A>
</I>&gt;<i> 
</I>&gt;<i> I think at some point repeatedly GETing or POSTing large amounts of data
</I>&gt;<i> to display an image becomes unrealistically wasteful of bandwidth,
</I>&gt;<i> compared to generating the image once and reusing the created image URL.
</I>&gt;<i> 
</I>&gt;&gt;<i> This could be implemented with an optional attribute, e.g.
</I>&gt;&gt;<i> &quot;post-data&quot;. The client would request the source using the POST method
</I>&gt;&gt;<i> if the attribute is present and send the attribute's value as the
</I>&gt;&gt;<i> request's message body.
</I>&gt;<i> 
</I>&gt;<i> Increasing URL limits to (say) 10,000 characters by spec would have a
</I>&gt;<i> better backwards compatibility story than a &quot;post-data&quot; attribute, since
</I>&gt;<i> it would work in many of today's browsers.
</I>&gt;<i> 
</I>&gt;<i> [...] are many formulas more than 10,000 characters?
</I>&gt;<i> 
</I>&gt;&gt;<i> (2) QR-Code generators encode texts or URLs in a way that can be
</I>&gt;&gt;<i> easily read by devices such as cell phones with built-in cameras. Info
</I>&gt;&gt;<i> and generator:
</I>&gt;<i> 
</I>&gt;<i> QR codes have a maximum capacity of 7,089 characters, well within the
</I>&gt;<i> 10,000 characters requirement I suggest above.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://en.wikipedia.org/wiki/QR_Code">http://en.wikipedia.org/wiki/QR_Code</A>
</I>
Thanks for the research. I think it is a good idea to spec a minimum URL length and I agree that &#8211; in this magnitude &#8211; it would help with realistic use cases. Should I start a new thread for this proposal?

&gt;&gt;<i> === Example/Use Cases ===
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> (1) MimeTeX and MathTeX are used to display mathematical formulae in
</I>&gt;&gt;<i> web pages.
</I>&gt;<i> 
</I>&gt;<i> Only future browsers could use &quot;post-data&quot; and are better off
</I>&gt;<i> implementing inline MathML to support this use-case:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-map-element.html#mathml">http://www.whatwg.org/specs/web-apps/current-work/multipage/the-map-element.html#mathml</A>
</I>
A little off-topic: MathML isn't really designed to be typed by hand, is it? My impression is that the solution from my use case is often used by those who lack the knowledge/rights to install sophisticated software on their own webspace that generates the desired output. So, they might as well lack the knowledge/rights to install tools that convert to MathML. Fortunately there are client-side solutions using Javascript today, but as some people disable scripting, there is still a need for a fallback solution.

So I think that use cases will pop up as long as there's webspace with narrowly limited rights.

Thanks again for all your comments (including those I haven't explicitly replied to),
Martin
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="071703.html">[whatwg] element &quot;img&quot; with HTTP POST method
</A></li>
	<LI>Next message: <A HREF="071710.html">[whatwg] element &quot;img&quot; with HTTP POST method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#71708">[ date ]</a>
              <a href="thread.html#71708">[ thread ]</a>
              <a href="subject.html#71708">[ subject ]</a>
              <a href="author.html#71708">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
