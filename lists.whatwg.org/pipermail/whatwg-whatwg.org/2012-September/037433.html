<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Blending, filtering
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Blending%2C%20filtering&In-Reply-To=%3CCAGN7qDDAz4FG-Y7Gfk9ZEjzTRkTX2hDJ7gZ12PKTbdX5r2JTRg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037432.html">
   <LINK REL="Next"  HREF="037338.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Blending, filtering</H1>
<!--htdig_noindex-->
    <B>Rik Cabanier</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Blending%2C%20filtering&In-Reply-To=%3CCAGN7qDDAz4FG-Y7Gfk9ZEjzTRkTX2hDJ7gZ12PKTbdX5r2JTRg%40mail.gmail.com%3E"
       TITLE="[whatwg] Blending, filtering">cabanier at gmail.com
       </A><BR>
    <I>Tue Sep 25 14:11:19 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="037432.html">[whatwg] Blending, filtering
</A></li>
        <LI>Next message: <A HREF="037338.html">[whatwg] [canvas] letter-spaceing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37433">[ date ]</a>
              <a href="thread.html#37433">[ thread ]</a>
              <a href="subject.html#37433">[ subject ]</a>
              <a href="author.html#37433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Tue, Sep 25, 2012 at 12:55 PM, Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ian at hixie.ch</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On Thu, 16 Aug 2012, David Geary wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It looks like there is general agreement that CSS filters should be
</I>&gt;<i> &gt; added to Canvas. Now how do we make it happen?
</I>&gt;<i>
</I>&gt;<i> On Thu, 16 Aug 2012, Rik Cabanier wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; File a bug on it: [...]
</I>&gt;<i>
</I>&gt;<i> Actually no need to file a bug, just mentioning it in this mailing list is
</I>&gt;<i> enough for it to get on the radar.
</I>&gt;<i>
</I>&gt;<i> If you do want to file a bug, though, you can. I recently created this
</I>&gt;<i> short URL:
</I>&gt;<i>
</I>&gt;<i>    <A HREF="http://whatwg.org/newbug">http://whatwg.org/newbug</A>
</I>&gt;<i>
</I>&gt;<i> You can also use the little box in the spec at the bottom right, it files
</I>&gt;<i> a bug also.
</I>&gt;<i>
</I>&gt;<i> (I only guarantee responses to new feedback on the spec sent to this
</I>&gt;<i> mailing list; bugs may not get detailed responses, though they will all
</I>&gt;<i> get looked at.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, 10 Apr 2012, Charles Pritchard wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; About three or four years ago we talked about adding addition blend
</I>&gt;<i> &gt; modes and/or filters to the Canvas API. Is there still room for
</I>&gt;<i> &gt; discussion on that?
</I>&gt;<i>
</I>&gt;<i> There's always room for discussion. Discussions that don't introduce new
</I>&gt;<i> content may get very short answers though. :-)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, 24 Jan 2012, Ronald Jett wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think that bringing the new CSS filters
</I>&gt;<i> &gt; (<A HREF="http://html5-demos.appspot.com/static/css/filters/index.html">http://html5-demos.appspot.com/static/css/filters/index.html</A>) to canvas
</I>&gt;<i> &gt; might be a good idea. Some of the new filters, specifically blur, would
</I>&gt;<i> &gt; definitely speed up some applications. I saw that there was a previous
</I>&gt;<i> &gt; discussion on this list about bringing SVG filters to canvas, but it was
</I>&gt;<i> &gt; a few years back and it doesn't seem like the discussion yielded much.
</I>&gt;<i>
</I>&gt;<i> On Mon, 16 Jul 2012, Ashley Gullen wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; IMO the big use case here is games - the CSS filters are great for
</I>&gt;<i> &gt; interesting visual effects.
</I>&gt;<i>
</I>&gt;<i> On Tue, 10 Apr 2012, Jonas Sicking wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I recently was shown an canvas based game which had been forced to use
</I>&gt;<i> &gt; WebGL purely for the reason of needing blending modes. I believe the
</I>&gt;<i> &gt; use-case in that example was when the game character was shot at, the
</I>&gt;<i> &gt; background of the game should be rendered with a varying red tint. I
</I>&gt;<i> &gt; unfortunately forget the specifics of why rendering a partially
</I>&gt;<i> &gt; transparent red square over the background produced the wrong colors,
</I>&gt;<i> &gt; but if needed I can try to find the specifics.
</I>&gt;<i>
</I>&gt;<i> These use cases seem solid.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, 24 Jan 2012, Ronald Jett wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It would be great if you could turn the filters on and off while
</I>&gt;<i> &gt; drawing. Something like:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ctx.blur(20); // turns on a 20px blur
</I>&gt;<i> &gt; ctx.drawRect(0, 0, 50, 50); // this will be blurred
</I>&gt;<i> &gt; ctx.blur(0); // turns off blur
</I>&gt;<i> &gt; ctx.drawRect(100, 100, 50, 50); // this will not be blurred
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You could even do multiples:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ctx.blur(2);
</I>&gt;<i> &gt; ctx.sepia(1);
</I>&gt;<i> &gt; ctx.drawImage(img, 0, 0);
</I>&gt;<i> &gt; ctx.endFilters(); // turn all filters off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Another benefit of having these effects in canvas is that we could
</I>&gt;<i> &gt; utilize toDataURL to save out an image that a user/application has
</I>&gt;<i> &gt; filtered.
</I>&gt;<i>
</I>&gt;<i> On Mon, 16 Jul 2012, Ashley Gullen wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; One way to define this is to specify that drawImage(), when passed
</I>&gt;<i> another
</I>&gt;<i> &gt; canvas as a parameter, must take in to account the canvas' 'filter' CSS
</I>&gt;<i> &gt; property.  So to draw an image with a blur you'd render using an
</I>&gt;<i> &gt; intermediate canvas, e.g.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; tempcanvascontext.drawImage(myimage, 0, 0);
</I>&gt;<i> &gt; tempcanvas.style.filter = &quot;blur(10px)&quot;;
</I>&gt;<i> &gt; gamecanvascontext.drawImage(tempcanvas, 0, 0); // draws with blur
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Another way would be just to add a 'filter' property to the 2D context,
</I>&gt;<i> &gt; e.g.:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; gamecanvascontext.filter = &quot;blur(10px)&quot;;
</I>&gt;<i> &gt; gamecanvascontext.drawImage(myimage, 0, 0);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This would also be extremely powerful if custom CSS shaders are also
</I>&gt;<i> &gt; supported, allowing for user-written effects in the canvas 2D context.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Effects should should apply to all drawing operations for consistency,
</I>&gt;<i> &gt; including lines, paths, rectangles and patterns.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Another argument is that you should just use WebGL and write shaders for
</I>&gt;<i> &gt; advanced effects.  This is an option, but given that a filter effect can
</I>&gt;<i> &gt; be applied to an entire canvas, it seems a waste not to enable it for
</I>&gt;<i> &gt; individual draw calls, especially given the 2D context is considerably
</I>&gt;<i> &gt; easier and quicker to code for.
</I>&gt;<i>
</I>&gt;<i> Adding such filters would be pretty useful...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, 10 Apr 2012, Charles Pritchard wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; <A HREF="https://dvcs.w3.org/hg/FXTF/rawfile/tip/compositing/index.html">https://dvcs.w3.org/hg/FXTF/rawfile/tip/compositing/index.html</A>
</I>&gt;<i>
</I>&gt;<i> On Fri, 21 Sep 2012, Tyler Larson wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If we had access to matrix transformation on the pixels we wouldn't need
</I>&gt;<i> &gt; a sepia or contrast methods, all of this could be created as a simple
</I>&gt;<i> &gt; transform.
</I>&gt;<i>
</I>&gt;<i> On Fri, 21 Sep 2012, Tab Atkins Jr. wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Not true - having useful predefined things *in addition to* lower-level
</I>&gt;<i> &gt; primitives is good for authors.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [...] once canvas supports CSS Filters, you can do per-pixel matrix
</I>&gt;<i> &gt; transformations via an SVG &lt;feComponentMatrix&gt; filter.  However, you
</I>&gt;<i> &gt; can't yet use SVG filters to do matrix transforms over multiple pixels,
</I>&gt;<i> &gt; like you need to do emboss or blur filters yourself.
</I>&gt;<i>
</I>&gt;<i> On Wed, 11 Apr 2012, Rik Cabanier wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm working on a spec to add blending and compositing through simple CSS
</I>&gt;<i> &gt; keywords. It is trying to define a generic model that is not specific to
</I>&gt;<i> &gt; Canvas, HTML or SVG and then lists how the model could be implemented.
</I>&gt;<i> &gt; We've gotten some comments that this feature would be useful in Canvas
</I>&gt;<i> &gt; as well so I was wondering if it made sense to add it to the canvas API.
</I>&gt;<i>
</I>&gt;<i> Is there any chance of adding filters to this also?
</I>&gt;<i>
</I>
CSS Filters are already defined here:
<A HREF="https://dvcs.w3.org/hg/FXTF/raw-file/tip/filters/index.html.">https://dvcs.w3.org/hg/FXTF/raw-file/tip/filters/index.html.</A>
The spec refer to each other for some concepts but are pretty separate.
(Filtering generally just works on 1 image while blending and compositing
describes how 2 images are combined)

One possibility would be to add a globalFilterOperation property that takes
the arguments of the 'filter' property [1]


&gt;<i>
</I>&gt;<i> &gt; I can see 2 ways of adding this:
</I>&gt;<i> &gt; 1. extend the list of compositing operators (
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#compositing">http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#compositing</A>
</I>&gt;<i> )
</I>&gt;<i> &gt; with blending. This is what is currently in the draft spec (
</I>&gt;<i> &gt; <A HREF="https://dvcs.w3.org/hg/FXTF/rawfile/tip/compositing/index.html">https://dvcs.w3.org/hg/FXTF/rawfile/tip/compositing/index.html</A> chapter
</I>&gt;<i> 7)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2. create a new attribute on the context called 'globalBlendOperation'
</I>&gt;<i> that
</I>&gt;<i> &gt; takes the same list of blend operations as css (
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="https://dvcs.w3.org/hg/FXTF/rawfile/tip/compositing/index.html#blend-mode">https://dvcs.w3.org/hg/FXTF/rawfile/tip/compositing/index.html#blend-mode</A>)
</I>&gt;<i>
</I>&gt;<i> Either (or both) of these seems reasonable to me. Would it make sense to
</I>&gt;<i> have the canvas section defer to this spec for all blending, filtering,
</I>&gt;<i> and compositing?
</I>&gt;<i>
</I>
I think it does since then everyting will be in 1 location.
I would need to update the blending spec for canvas because it behaves
differently than HTML and SVG.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, 27 Jul 2012, Rik Cabanier wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On another note, wouldn't it be nice if you could add a grouping
</I>&gt;<i> &gt; operator such as this:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; gamecanvascontext.filter = '...';
</I>&gt;<i> &gt; gamecanvascontext.beginGroup();
</I>&gt;<i> &gt; ... // lots of drawing operators
</I>&gt;<i> &gt; gamecanvascontext.endGroup();
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; and have everything in that group at endGroup time?
</I>&gt;<i>
</I>&gt;<i> On Sat, 28 Jul 2012, Ashley Gullen wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Do you mean applying an effect to multiple draw operations?  Usually
</I>&gt;<i> &gt; that is achieved with rendering to an offscreen canvas, then rendering
</I>&gt;<i> &gt; that with the effect.
</I>&gt;<i>
</I>&gt;<i> On Sat, 28 Jul 2012, Rik Cabanier wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; True, but you would have to know the size of the offscreen canvas which
</I>&gt;<i> &gt; is sometimes hard. I'm unsure what happens if you scale or rotate that
</I>&gt;<i> &gt; offscreen canvas. Will the artwork and text antialias correctly? How
</I>&gt;<i> &gt; does the up/downsampling happen?
</I>&gt;<i>
</I>&gt;<i> On Sun, 29 Jul 2012, Ashley Gullen wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Re: beginGroup()/endGroup(): I assume browsers would implement it as an
</I>&gt;<i> &gt; offscreen canvas anyway, so it would be better to write a JS library to
</I>&gt;<i> &gt; take care of it for you rather than requiring a browser feature for
</I>&gt;<i> &gt; that.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You would not need to rotate or scale the off-screen canvas.  You'd make
</I>&gt;<i> &gt; it the size of the main canvas, draw everything with all the
</I>&gt;<i> &gt; rotation/scaling you want, then just draw it over the main canvas at (0,
</I>&gt;<i> &gt; 0) with 100% scale. This will not affect antialiasing or artwork
</I>&gt;<i> &gt; compared to just drawing it directly to the main canvas.  Fancier
</I>&gt;<i> &gt; implementations can work out the changed bounding box and only draw that
</I>&gt;<i> &gt; with the effect for efficiency.
</I>&gt;<i>
</I>&gt;<i> I haven't added grouping, for the reason described above. But if it's
</I>&gt;<i> something that could benefit from native support from browsers and browser
</I>&gt;<i> vendors want to implement it, we can definitely add something like this.
</I>&gt;<i>
</I>
Grouping is definitely a heavy-weight process which introduces hidden
internal bitmaps.
It is a very handy feature but will impact performance if not handled with
care.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, 21 Sep 2012, Tyler Larson wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I like the idea of abstracting this into an ArrayBuffer, I like the
</I>&gt;<i> &gt; sound of this but ArrayBuffers seem to promote nested arrays, whereas
</I>&gt;<i> &gt; the Canvas spec uses a simpler structure with r,g,b,a,&#8230; pixel values. It
</I>&gt;<i> &gt; would be awesome to have these types of inconsistencies worked out so we
</I>&gt;<i> &gt; didn't need to transform our data into different structures before
</I>&gt;<i> &gt; applying it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; An abstraction between all of these contexts (Canvas,Element
</I>&gt;<i> &gt; Transforms,Audio,WebGL,...) seems doable but if it means sacrificing
</I>&gt;<i> &gt; performance later because what is output by the generic structure can't
</I>&gt;<i> &gt; be used in each of these APIs as is, I would rather have more targeted
</I>&gt;<i> &gt; transformation methods on each of these APIs.
</I>&gt;<i>
</I>&gt;<i> On Sat, 22 Sep 2012, Rob Manson wrote:
</I>&gt;<i> &gt; On Fri, 21 Sep 2012, Tyler Larson wrote:
</I>&gt;<i> &gt; &gt; On Sep 21, 2012, at 3:34 AM, Jussi Kalliokoski
</I>&gt;<i> &gt; &gt; &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jussi.kalliokoski at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; Please see the DSP API [1]. It's currently developed unofficially
</I>&gt;<i> &gt; &gt; &gt; under the W3C Audio WG [2], so if you have input, please post it to
</I>&gt;<i> &gt; &gt; &gt; the audiowg public mailing list. This should scratch your itch and
</I>&gt;<i> &gt; &gt; &gt; more. ;)
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; [1] <A HREF="http://people.opera.com/mage/dspapi/">http://people.opera.com/mage/dspapi/</A>
</I>&gt;<i> &gt; &gt; &gt; [2] <A HREF="http://www.w3.org/2011/audio/">http://www.w3.org/2011/audio/</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; This stuff looks really interesting, and actually lower level than I
</I>&gt;<i> &gt; &gt; was asking for which is cool but I'm not sure how this could be
</I>&gt;<i> &gt; &gt; abstracted out so that it is useful for things outside of Audio? I'm
</I>&gt;<i> &gt; &gt; likely just not putting it all together.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I agree that this looks really useful and I don't think it's intimately
</I>&gt;<i> &gt; tied to Audio as it simply manipulates Typed Arrays.  In fact that the
</I>&gt;<i> &gt; page at link [1] doesn't seem to even contain the term &quot;audio&quot; at all.
</I>&gt;<i> &gt; So it's definitely just a generic DSP model built upon Type Arrays.  So
</I>&gt;<i> &gt; it seems like there's no need to raise this as feedback on the
</I>&gt;<i> &gt; ArrayBuffer spec at all since Type Arrays are built on top of
</I>&gt;<i> &gt; ArrayBuffers.
</I>&gt;<i>
</I>&gt;<i> I agree that it would be nice to have a generic way to mutate
</I>&gt;<i> ArrayBuffers. I recommend bringing this up with the editor of the Typed
</I>&gt;<i> Array specification.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, 21 Sep 2012, Tab Atkins Jr. wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Usually, these kinds of things are written as a flat array of
</I>&gt;<i> &gt; components, with each item cycling between being an r, g, b, or a. This
</I>&gt;<i> &gt; is what is already used by ImageData, for example.  It seems reasonable
</I>&gt;<i> &gt; in the future to let the functions that take an ImageData also take an
</I>&gt;<i> &gt; ArrayBuffer directly.
</I>&gt;<i>
</I>&gt;<i> ImageData actually holds an actual ArrayBuffer, so we're pretty much
</I>&gt;<i> there.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Ian Hickson               U+1047E                )\._.,--....,'``.    fL
</I>&gt;<i> <A HREF="http://ln.hixie.ch/">http://ln.hixie.ch/</A>       U+263A                /,   _.. \   _\  ;`._ ,.
</I>&gt;<i> Things that are impossible just take longer.   `._.-(,_..'--(,_..'`-.;.'
</I>

1:
<A HREF="https://dvcs.w3.org/hg/FXTF/raw-file/tip/filters/index.html#FilterProperty">https://dvcs.w3.org/hg/FXTF/raw-file/tip/filters/index.html#FilterProperty</A>
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037432.html">[whatwg] Blending, filtering
</A></li>
	<LI>Next message: <A HREF="037338.html">[whatwg] [canvas] letter-spaceing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37433">[ date ]</a>
              <a href="thread.html#37433">[ thread ]</a>
              <a href="subject.html#37433">[ subject ]</a>
              <a href="author.html#37433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
