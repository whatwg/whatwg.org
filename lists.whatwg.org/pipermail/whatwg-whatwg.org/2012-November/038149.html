<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] iframe sandbox and top navigation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20iframe%20sandbox%20and%20top%20navigation&In-Reply-To=%3C951993145.1391696.1354132097113.JavaMail.root%40mozilla.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="080453.html">
   <LINK REL="Next"  HREF="038153.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] iframe sandbox and top navigation</H1>
<!--htdig_noindex-->
    <B>Ian Melven</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20iframe%20sandbox%20and%20top%20navigation&In-Reply-To=%3C951993145.1391696.1354132097113.JavaMail.root%40mozilla.com%3E"
       TITLE="[whatwg] iframe sandbox and top navigation">imelven at mozilla.com
       </A><BR>
    <I>Wed Nov 28 11:48:17 PST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="080453.html">[whatwg] [mimesniff] Sniffing archives
</A></li>
        <LI>Next message: <A HREF="038153.html">[whatwg] Adding crossorigin=&quot;&quot; to more elements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38149">[ date ]</a>
              <a href="thread.html#38149">[ thread ]</a>
              <a href="subject.html#38149">[ subject ]</a>
              <a href="author.html#38149">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>
Hi,

while working on <A HREF="https://bugzilla.mozilla.org/show_bug.cgi?id=785310">https://bugzilla.mozilla.org/show_bug.cgi?id=785310</A> (block setting
window.top.location from a document sandboxed without 'allow-top-navigation') and discussing
the correct behavior with Bobby Holley, I found some interesting differences
between what Chrome and IE have implemented around top navigation and iframe sandbox.

In my testing with Chrome, if you have a sandboxed document with the same
origin as the top level document and the sandboxed document has 'allow-same-origin allow-scripts',
the sandboxed document can NOT navigate the top level document via setting window.top.location 
ie it's blocked. Bobby pointed out that blocking top navigation when the sandboxed document
is same origin with the top level document is difficult, since the sandboxed document
can do window.top.eval('window.location = &quot;<A HREF="http://foo.com">http://foo.com</A>&quot;') - this bypasses the block in Chrome
and the top navigation happens. 

In IE 10, at least in the Windows 8 consumer preview which is the latest
version i have at the moment unfortunately, you can set window.top.location from a document that's same origin
with the top level document which is contained in an &lt;iframe sandbox = 'allow-same-origin allow-scripts'&gt; ie it doesn't
need allow-top-navigation.

It would be great if the spec could clarify the correct behavior around top navigation
when the sandboxed document is/is not same origin with the top level document. 

One option would be for Chrome/Webkit to also block the window.top.eval loophole, but in general
we feel that trying to stop this when the documents are same origin would possibly be problematic. 
Another option would be to not block top navigation when the sandboxed document is same origin
with the top level document (which implies it's been sandboxed with 'allow-same-origin' of course). 

&gt;<i>From discussions with Bobby, I think we prefer the second option. The restriction on navigating
</I>window.top would only be applied in the cross domain case. 

thanks !
ian


</PRE>














<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="080453.html">[whatwg] [mimesniff] Sniffing archives
</A></li>
	<LI>Next message: <A HREF="038153.html">[whatwg] Adding crossorigin=&quot;&quot; to more elements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38149">[ date ]</a>
              <a href="thread.html#38149">[ thread ]</a>
              <a href="subject.html#38149">[ subject ]</a>
              <a href="author.html#38149">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
