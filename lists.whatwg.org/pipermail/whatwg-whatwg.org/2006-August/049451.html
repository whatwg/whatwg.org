<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Persistent storage is critically flawed.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Persistent%20storage%20is%20critically%20flawed.&In-Reply-To=%3C44F28679.6030200%40arc.net.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049449.html">
   <LINK REL="Next"  HREF="049454.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Persistent storage is critically flawed.</H1>
<!--htdig_noindex-->
    <B>Shannon Baker</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Persistent%20storage%20is%20critically%20flawed.&In-Reply-To=%3C44F28679.6030200%40arc.net.au%3E"
       TITLE="[whatwg] Persistent storage is critically flawed.">shannon at arc.net.au
       </A><BR>
    <I>Sun Aug 27 23:00:25 PDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="049449.html">[whatwg] Persistent storage is critically flawed.
</A></li>
        <LI>Next message: <A HREF="049454.html">[whatwg] Persistent storage is critically flawed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49451">[ date ]</a>
              <a href="thread.html#49451">[ thread ]</a>
              <a href="subject.html#49451">[ subject ]</a>
              <a href="author.html#49451">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Ian Hickson wrote:
&gt;<i>
</I>&gt;<i> This is mentioned in the &quot;Security and privacy&quot; section; the third
</I>&gt;<i> bullet point here for example suggests blocking access to &quot;public&quot;
</I>&gt;<i> storage areas:
</I>&gt;<i>
</I>&gt;<i>   <A HREF="http://whatwg.org/specs/web-apps/current-work/#user-tracking">http://whatwg.org/specs/web-apps/current-work/#user-tracking</A>
</I>&gt;<i>
</I>I did read the suggestions and I know the authors have given these 
issues thought. However, my concern is that the solutions are all 
'suggestions' rather than rules. I believe the standard should be more 
definitive to eliminate the potential for browser inconsistencies.

&gt;<i> Yes, there's an entire section of the spec discussing this in detail,
</I>&gt;<i> with suggested solutions.
</I>&gt;<i>
</I>Again, the key word here is 'suggest'.

&gt;<i> Indeed, the spec suggests blocking such access.
</I>&gt;<i>
</I>Suggest. See where I'm going with this. The spec is too loose.

&gt;<i> There generally is; but for the two cases where there are not, see:
</I>&gt;<i>
</I>&gt;<i>   <A HREF="http://whatwg.org/specs/web-apps/current-work/#storage">http://whatwg.org/specs/web-apps/current-work/#storage</A>
</I>&gt;<i>
</I>&gt;<i> ...and:
</I>&gt;<i>
</I>&gt;<i>   <A HREF="http://whatwg.org/specs/web-apps/current-work/#storage0">http://whatwg.org/specs/web-apps/current-work/#storage0</A>
</I>&gt;<i>
</I>&gt;<i> Basically, for the few cases where an author doesn't control his
</I>&gt;<i> subdomain space, he should be careful. But this goes without saying.
</I>&gt;<i> The same requirement (that authors be responsible) applies to all Web
</I>&gt;<i> technologies, for example CGI script authors must be careful not to
</I>&gt;<i> allow SQL injection attacks, must check Referer headers, must ensure
</I>&gt;<i> POST/GET requests are handled appropriately, and so forth.
</I>&gt;<i>
</I>As I pointed out this only gives control to the parent domain, not the 
child without regard for the real-world political relationship between 
the two. Also the implication here is that the 'parent' domain is more 
trustworthy and important than the child - that it should always be able 
to read a subdomains private user data. The spec doesn't give the 
developer a chance to be responsible when it hands out user data to 
anybody in the domain hierarchy without regard for whether they are a 
single, trusted entity or not. Don't blame the programmer when the spec 
dictates who can read and write the data with no regard for the authors 
preferences. CGI scripts generally do not have this limitation so your 
analogy is irrelevant.
 
&gt;<i> Indeed; users are geocities.com shouldn't be using this service, and
</I>&gt;<i> geocities themselves should put their data (if any) in a private
</I>&gt;<i> subdomain space.
</I>Geocities and other free-hosting sites generally have a low server-side 
storage allowance. This means these sites have a _greater_ need for 
persistent storage than 'real' domains.

&gt;<i> It doesn't. The solution for mysite.geocities.com is to get their own 
</I>&gt;<i> domain.
</I>That's a bit presumptuous. In fact it's downright offensive. The user 
may have valid reasons for not buying a domain. Is it the whatcg's role 
to dictate hosting requirements in a web standard?

&gt;<i> The spec was written in conjunction with UA vendors. It is realistic
</I>&gt;<i> for UA vendors to provide a hardcoded list of TLDs; in fact, there is
</I>&gt;<i> significant work underway to create such a list (and have it be
</I>&gt;<i> regualrly updated). That work was originally started for use for HTTP
</I>&gt;<i> Cookie implementations, which have similar problems, but would be very
</I>&gt;<i> useful for Storage API implementations (although, again as noted in
</I>&gt;<i> the draft, not imperative for a secure implementation if the author is
</I>&gt;<i> responsible.
</I>I accept that such a list is probably the answer, however I believe the 
list should itself be standardised before becoming part of a web 
standard - otherwise more UA inconsistency.

&gt;<i> One could create much more complex APIs, naturally, but I do not see
</I>&gt;<i> that this would solve the problems. It wouldn't solve the issue of
</I>&gt;<i> authors who don't understand the security implications of their code,
</I>&gt;<i> for instance. It also wouldn't prevent the security issue you
</I>&gt;<i> mentioned -- why couldn't all *.geocities.com sites cooperate to
</I>&gt;<i> violate the user's privacy? Or *.co.uk sites, for that matter? (Note
</I>&gt;<i> that it is already possible today to do such tracking with cookies; in
</I>&gt;<i> fact it's already possible today even without cookies if you use
</I>&gt;<i> Referer tracking, and even without Referer tracking one can use IP and
</I>&gt;<i> User-Agent fingerprinting combined with log analysis to perform quite
</I>&gt;<i> thorough tracking.)
</I>None of those techniques are reliable. My own weblogs show most users 
have the referer field turned off. Cookies can be safely deleted after 
every session without a major impact on site function (I may have to 
login again). IP tracking is mitigated by proxies and NAT's. The trouble 
with this proposal is that it would allow important data to get lumped 
in with tracking data when the spec suggests that UA's should only 
delete the storage when explicitly asked to do so. I don't have a 
solution to this other than to revoke this proposal or prevent the 
sharing of storage between sites. I accept tracking is inevitable but we 
shouldn't be making it easier either.

&gt;<i> Certainly one could add a .readonly field or some such to storage data
</I>&gt;<i> items, or even fully fledged ACL APIs, but I don't think that should
</I>&gt;<i> be available in a first version, and I'm not sure it's really useful
</I>&gt;<i> in later versions either.
</I>Any more or less complex or useful than the .secure flag? Readonly is an 
essential attribute in any shared data system from databases to 
filesystems. Would you advocate that all websites be world-writable just 
to simplify the API? Not that it should be hard to implement .readonly, 
as we already have metadata with each key.

&gt;<i> I don't really understand what this is referring to. Could you show an
</I>&gt;<i> example of the transaction/callback system you refer to? The API is
</I>&gt;<i> intended to be really simple, just specify the item name and there you
</I>&gt;<i> go.
</I>I'm refering to the &quot;storage&quot; event described in 5.9.6 which is fired in 
all active pages as data changes. This is an unusual proceedure that 
needs a better justification than those given in the spec. If the event 
pulls me out of my current function then how am I going to do anything 
useful with the application state (without really knowing where 
execution was interrupted)?

&gt;<i> While I agree that there are valid concerns, I believe they are all
</I>&gt;<i> addressed explicitly in the spec, with suggested solutions.
</I>You points are also quite valid however they ignore the root of my 
concerns - which is that the spec leaves too much up to the UA to 
resolve. I don't see how you can explicitly define something with a 
suggestion! The whole spec kind of 'hopes' that many disparate 
companies/groups will cooperate to make persistent storage work 
consistently across browsers. They might, but given both Microsoft and 
Netscapes track records I think things need to be more concrete in such 
an important spec.

&gt;<i> I would be interested in seeing a concrete proposal for a better
</I>&gt;<i> solution; I don't really see what a better solution would be.
</I>
I'm not sure myself but I don't think it can stay the way it is. I would 
be happy to offer a better proposal or update the current one given 
enough time to consider it.

As a quick thought, the simplest approach might just be to require the 
site send a secret hash or public key in order to prove it 'owns' the 
key. The secret could even be a timestamp of the exact time the key was 
set or just a hash of the users site login. eg:

DOMAIN         KEY          SECRET                                 DATA
foo.bar              baz             kj43h545j34h6jk534dfytyf      A string.

Just one idea.

Shannon
Web Developer

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="049449.html">[whatwg] Persistent storage is critically flawed.
</A></li>
	<LI>Next message: <A HREF="049454.html">[whatwg] Persistent storage is critically flawed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49451">[ date ]</a>
              <a href="thread.html#49451">[ thread ]</a>
              <a href="subject.html#49451">[ subject ]</a>
              <a href="author.html#49451">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
