<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] pagehide vs pagevis
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20pagehide%20vs%20pagevis&In-Reply-To=%3C9EA28714-0E47-4310-9E9F-61E1726F1657%40apple.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="081924.html">
   <LINK REL="Next"  HREF="081940.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] pagehide vs pagevis</H1>
<!--htdig_noindex-->
    <B>Brady Eidson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20pagehide%20vs%20pagevis&In-Reply-To=%3C9EA28714-0E47-4310-9E9F-61E1726F1657%40apple.com%3E"
       TITLE="[whatwg] pagehide vs pagevis">beidson at apple.com
       </A><BR>
    <I>Thu May 30 09:41:30 PDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="081924.html">[whatwg] pagehide vs pagevis
</A></li>
        <LI>Next message: <A HREF="081940.html">[whatwg] pagehide vs pagevis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81938">[ date ]</a>
              <a href="thread.html#81938">[ thread ]</a>
              <a href="subject.html#81938">[ subject ]</a>
              <a href="author.html#81938">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>
On May 29, 2013, at 5:34 PM, Boris Zbarsky &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">bzbarsky at mit.edu</A>&gt; wrote:

&gt;<i> On 5/29/13 4:30 PM, Brady Eidson wrote:
</I>&gt;&gt;<i> I see in the HTML spec that the step *before* firing pagehide is &#8220;set
</I>&gt;&gt;<i> the Document&#8217;s page showing flag to false,&#8221; but I can&#8217;t find language
</I>&gt;&gt;<i> that says pagehide fires *before* the page is actually hidden, and
</I>&gt;&gt;<i> unload fires *after* the page is actually hidden.
</I>&gt;<i> 
</I>&gt;<i> Hidden in terms of &quot;document.hidden&quot; or something else?
</I>
Hidden as in &#8220;visible&#8221; in the concept of &#8220;page visibility&#8221; and &#8220;visibilitychanged&quot;
&gt;<i> 
</I>&gt;&gt;<i> pageshow is a history traversal event, and not a visibility event.  I
</I>&gt;&gt;<i> don&#8217;t see a guarantee in any spec that &#8220;pageshow&#8221; comes after the
</I>&gt;&gt;<i> document is actually visible.
</I>&gt;<i> 
</I>&gt;<i> It comes after it's visible in terms of document.visibilityState, for pages not in background tabs.
</I>
This is true *only* because you and the other people who worked on integrating page-vis into HTML decided it was true.

What I meant was that the pageshow event does *not* inherently mean that the page is actually visible - actually has pixels painted on the screen.  Whereas the visibilitychanged event would (presumably?) only fire once the pixels are painted on the screen.

&gt;<i> Obviously for pages in background tabs the visibilityState of the document is just hidden throughout.
</I>
Sure.

&gt;<i> 
</I>&gt;&gt;<i> First, since pagehide currently always has persisted set to true (in the
</I>&gt;&gt;<i> spec and in Gecko)
</I>&gt;<i> 
</I>&gt;<i> This is false in Gecko.  There are lots of cases in which persisted is not set to true in pagehide.  It's only set to true if the page is in fact going to be placed in the page cache based on the information available at the point pagehide fires.
</I>&gt;<i> 
</I>&gt;<i> The spec on setting &quot;persisted&quot; in the pagehide event is just wrong.
</I>
I suppose I jumped to an assumption on Gecko, my apologies.  I definitely agree the spec on pagehide is just wrong.

&gt;<i> 
</I>&gt;&gt;<i> Third, is the difference between 4 states and 5 states really appreciable?
</I>&gt;<i> 
</I>&gt;<i> Which states are 4 and 5?
</I>&gt;<i> 
</I>&gt;<i> In any case, there are multiple page visibility implementations shipping now, with interop on the ordering last I checked, and the spec is finalized.  If you want to change around how it works, you're going to have to convince all the people who are already shipping implementations of it as written, apparently with no problems, to change behavior...
</I>
Only people without page caches or with a gecko-style page cache could ship this.

It&#8217;s our fault we missed the ball on this.  But I am bummed the discussion to change HTML took place in web-perf, as it&#8217;s tough to keep the right eyes in all the right places.

~Brady
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="081924.html">[whatwg] pagehide vs pagevis
</A></li>
	<LI>Next message: <A HREF="081940.html">[whatwg] pagehide vs pagevis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81938">[ date ]</a>
              <a href="thread.html#81938">[ thread ]</a>
              <a href="subject.html#81938">[ subject ]</a>
              <a href="author.html#81938">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
