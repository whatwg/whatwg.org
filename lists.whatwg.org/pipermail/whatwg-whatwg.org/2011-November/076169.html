<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Drag-and-drop folders/files support with directory structure using DirectoryEntry
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Drag-and-drop%20folders/files%20support%20with%20directory%0A%20structure%20using%20DirectoryEntry&In-Reply-To=%3CCAMWgRNbjGKTrbmMCCMvjr%3DQkX%3DDhPok2pQVL%3DpqGEr_YfOOkUQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="076167.html">
   <LINK REL="Next"  HREF="076174.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Drag-and-drop folders/files support with directory structure using DirectoryEntry</H1>
<!--htdig_noindex-->
    <B>Kinuko Yasuda</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Drag-and-drop%20folders/files%20support%20with%20directory%0A%20structure%20using%20DirectoryEntry&In-Reply-To=%3CCAMWgRNbjGKTrbmMCCMvjr%3DQkX%3DDhPok2pQVL%3DpqGEr_YfOOkUQ%40mail.gmail.com%3E"
       TITLE="[whatwg] Drag-and-drop folders/files support with directory structure using DirectoryEntry">kinuko at chromium.org
       </A><BR>
    <I>Thu Nov 17 22:36:47 PST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="076167.html">[whatwg] Drag-and-drop folders/files support with directory structure using DirectoryEntry
</A></li>
        <LI>Next message: <A HREF="076174.html">[whatwg] Drag-and-drop folders/files support with directory structure using DirectoryEntry
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#76169">[ date ]</a>
              <a href="thread.html#76169">[ thread ]</a>
              <a href="subject.html#76169">[ subject ]</a>
              <a href="author.html#76169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Fri, Nov 18, 2011 at 1:00 PM, Glenn Maynard &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">glenn at zewt.org</A>&gt; wrote:
&gt;<i> On Thu, Nov 17, 2011 at 10:47 PM, Kinuko Yasuda &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">kinuko at chromium.org</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I mean the URL would essentially be a weak reference to the backing
</I>&gt;&gt;<i> file, but it won't keep the backing file alive.
</I>&gt;&gt;<i> (At least in sandboxed cases) the filesystem URLs are more like
</I>&gt;&gt;<i> 'public address' and not coupled with any particular Entry instances.
</I>&gt;&gt;<i> One can make up a URL just by concatenating strings and then can get
</I>&gt;&gt;<i> the Entry from the URL.
</I>&gt;<i>
</I>&gt;<i> Right, but we're talking about the non-sandboxed case.
</I>&gt;<i>
</I>&gt;&gt;<i> What I'm going to do is: create a set of capabilities upon drag event,
</I>&gt;&gt;<i> give the capabilities to the context when it was dropped, and revoke
</I>&gt;&gt;<i> the capabilities when the context gets deleted (i.e. the page is
</I>&gt;&gt;<i> closed). &#160;The lifetime of the Entry instance object doesn't matter in
</I>&gt;&gt;<i> this case; Entry is yet another weak reference to the backing file but
</I>&gt;&gt;<i> doesn't mean a live reference or access right.
</I>&gt;<i>
</I>&gt;<i> This implies a memory leak, as each time you drag a file into a page, you
</I>&gt;<i> permanently (for the lifetime of the document) create a record that the page
</I>&gt;<i> is allowed to access that file.&#160; If you drag lots of individual files into
</I>&gt;<i> the page, this leak could become nontrivial.&#160; I don't think a design with
</I>&gt;<i> inherent memory leaks is a good direction.
</I>
I would say the approach has a bloating per-page bookkeeping problem but
not a 'leak'.  Actually chrome does record such per-file/per-directory
permission
for each page regardless of whether we support DirectoryEntry or not, and
so far our observation tells that the amount of memory necessary to keep such
permission is negligibly small.  If we needed to keep actual data in-memory
along with the permission (like we do for Blob) the problem would have been
serious but I don't think that'd be a big issue in this case.

&gt;<i> --
</I>&gt;<i> Glenn Maynard
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="076167.html">[whatwg] Drag-and-drop folders/files support with directory structure using DirectoryEntry
</A></li>
	<LI>Next message: <A HREF="076174.html">[whatwg] Drag-and-drop folders/files support with directory structure using DirectoryEntry
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#76169">[ date ]</a>
              <a href="thread.html#76169">[ thread ]</a>
              <a href="subject.html#76169">[ subject ]</a>
              <a href="author.html#76169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
