<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to handle	it.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20document.write%28%22%5Cr%22%29%3A%20the%20spec%20doesn%27t%20say%20how%20to%20handle%0A%09it.&In-Reply-To=%3C4EB1D8F7.6050909%40mozilla.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="076013.html">
   <LINK REL="Next"  HREF="076019.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to handle	it.</H1>
<!--htdig_noindex-->
    <B>David Flanagan</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20document.write%28%22%5Cr%22%29%3A%20the%20spec%20doesn%27t%20say%20how%20to%20handle%0A%09it.&In-Reply-To=%3C4EB1D8F7.6050909%40mozilla.com%3E"
       TITLE="[whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to handle	it.">dflanagan at mozilla.com
       </A><BR>
    <I>Wed Nov  2 16:57:43 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="076013.html">[whatwg] MediaController feedback
</A></li>
        <LI>Next message: <A HREF="076019.html">[whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to	handle it.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33741">[ date ]</a>
              <a href="thread.html#33741">[ thread ]</a>
              <a href="subject.html#33741">[ subject ]</a>
              <a href="author.html#33741">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>The spec for document.write() 
<A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#dom-document-write">http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#dom-document-write</A> 
says: &quot;... have the tokenizer process the characters that were inserted, 
one at a time, processing resulting tokens as they are emitted, and 
stopping when the tokenizer reaches the insertion point...&quot;

But what happens if the last character written by document.write() is a 
carriage return?

The HTML parsing spec says that CR followed by LF is ignored but CR 
followed by anything else is converted to LF.  So if the last character 
is CR, then the tokenizer can't process all characters up to the 
insertion point because it needs to lookahead at the next character, right?

Firefox, Chrome and Safari all seem to do the right thing: wait for the 
next character before tokenizing the CR.  And I think this means that 
the description of document.write needs to be changed.  (Opera, on the 
other hand, just gets this wrong and emits a CR character).

Similarly, what should the tokenizer do if the document.write emits half 
of a UTF-16 surrogate pair as the last character?

     David
</PRE>






<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="076013.html">[whatwg] MediaController feedback
</A></li>
	<LI>Next message: <A HREF="076019.html">[whatwg] document.write(&quot;\r&quot;): the spec doesn't say how to	handle it.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33741">[ date ]</a>
              <a href="thread.html#33741">[ thread ]</a>
              <a href="subject.html#33741">[ subject ]</a>
              <a href="author.html#33741">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
