<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Thread to run Web Socket feedback from the protocol ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Thread%20to%20run%20Web%20Socket%20feedback%20from%20the%20protocol%20%3F&In-Reply-To=%3CPine.LNX.4.62.0912091847440.16061%40hixie.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024410.html">
   <LINK REL="Next"  HREF="024326.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Thread to run Web Socket feedback from the protocol ?</H1>
<!--htdig_noindex-->
    <B>Ian Hickson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Thread%20to%20run%20Web%20Socket%20feedback%20from%20the%20protocol%20%3F&In-Reply-To=%3CPine.LNX.4.62.0912091847440.16061%40hixie.dreamhostps.com%3E"
       TITLE="[whatwg] Thread to run Web Socket feedback from the protocol ?">ian at hixie.ch
       </A><BR>
    <I>Wed Dec  9 10:51:36 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="024410.html">[whatwg] Thread to run Web Socket feedback from the protocol ?
</A></li>
        <LI>Next message: <A HREF="024326.html">[whatwg] Thread to run Web Socket feedback from the protocol ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24412">[ date ]</a>
              <a href="thread.html#24412">[ thread ]</a>
              <a href="subject.html#24412">[ subject ]</a>
              <a href="author.html#24412">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Wed, 9 Dec 2009, Alexey Proskuryakov wrote:
&gt;<i> On 09.12.2009, at 10:07, Ian Hickson wrote:
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; I'm absolutely fine with changing WebSocket to change readyState 
</I>&gt;<i> &gt; &gt; &gt; as part of the same task that dispatches the event
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Yes, that is what I think the spec should say.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Done.
</I>&gt;<i> 
</I>&gt;<i> As discussed on IRC, this leaves us with a race condition between 
</I>&gt;<i> close() and queued messages. The spec says that once close() is invoked, 
</I>&gt;<i> incoming data should be dropped, but queued tasks to dispatch message 
</I>&gt;<i> event will still be coming.
</I>&gt;<i> 
</I>&gt;<i> This race condition can of course be fixed without much difficulty.
</I>
I believe it has been fixed, as per my last e-mail.


&gt;<i> It may be more difficult to similarly rearrange XHR specs.
</I>
I'm happy to work with Anne to address this as necessary.


&gt;<i> I find it unfortunate that where the spec says &quot;queue a task&quot;, most (or 
</I>&gt;<i> all) implementations will perform those actions immediately. This may be 
</I>&gt;<i> indistinguishable from JavaScript client code, but it will be a source 
</I>&gt;<i> of confusion for developers.
</I>
I disagree with your interpretation. Wherever the spec says &quot;queue a 
task&quot;, this can be interpreted as meaning a message posted by a network 
thread to the main UI event loop, for UAs where this makes sense. However, 
there are many other UA implementation strategies where explicitly saying 
this would be even further from the actual implementation. I think it is 
inadvisable for specs to be defining things that are not black-box 
testable.

-- 
Ian Hickson               U+1047E                )\._.,--....,'``.    fL
<A HREF="http://ln.hixie.ch/">http://ln.hixie.ch/</A>       U+263A                /,   _.. \   _\  ;`._ ,.
Things that are impossible just take longer.   `._.-(,_..'--(,_..'`-.;.'
</PRE>












<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024410.html">[whatwg] Thread to run Web Socket feedback from the protocol ?
</A></li>
	<LI>Next message: <A HREF="024326.html">[whatwg] Thread to run Web Socket feedback from the protocol ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24412">[ date ]</a>
              <a href="thread.html#24412">[ thread ]</a>
              <a href="subject.html#24412">[ subject ]</a>
              <a href="author.html#24412">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
