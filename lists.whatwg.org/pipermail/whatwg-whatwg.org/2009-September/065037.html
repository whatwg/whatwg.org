<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20RFC%3A%20Alternatives%20to%20storage%20mutex%20for%20cookies%20and%0A%09localStorage&In-Reply-To=%3C11e306600909080521u1d749bb7ie488a789d50dc8aa%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="065036.html">
   <LINK REL="Next"  HREF="065018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage</H1>
<!--htdig_noindex-->
    <B>Robert O'Callahan</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20RFC%3A%20Alternatives%20to%20storage%20mutex%20for%20cookies%20and%0A%09localStorage&In-Reply-To=%3C11e306600909080521u1d749bb7ie488a789d50dc8aa%40mail.gmail.com%3E"
       TITLE="[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage">robert at ocallahan.org
       </A><BR>
    <I>Tue Sep  8 05:21:53 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="065036.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
        <LI>Next message: <A HREF="065018.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65037">[ date ]</a>
              <a href="thread.html#65037">[ thread ]</a>
              <a href="subject.html#65037">[ subject ]</a>
              <a href="author.html#65037">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Tue, Sep 8, 2009 at 9:38 PM, Aaron Boodman &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">aa at google.com</A>&gt; wrote:

&gt;<i> On Tue, Sep 8, 2009 at 2:02 AM, Robert O'Callahan&lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">robert at ocallahan.org</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; Looking back over previous threads on the storage mutex, I can't seem to
</I>&gt;<i> &gt; remember or find the reason that implementing the storage mutex for
</I>&gt;<i> cookies
</I>&gt;<i> &gt; can't easily be done with a mutex per domain. Ian pointed out this
</I>&gt;<i> approach
</I>&gt;<i> &gt; breaks if you can make synchronous script calls across origins (e.g.
</I>&gt;<i> across
</I>&gt;<i> &gt; IFRAME boundaries), but can you actually make such calls? Or if you can
</I>&gt;<i> &gt; (NPAPI?), can we just declare that those APIs release the storage mutex?
</I>&gt;<i>
</I>&gt;<i> I believe that synchronous cross-origin calls are possible a variety
</I>&gt;<i> of ways. Here is one way I found with a quick test: Resize an iframe
</I>&gt;<i> element. window.onresize is fired synchronously inside the frame. I
</I>&gt;<i> bet there are others.
</I>&gt;<i>
</I>
What spec says that onresize should fire synchronously? I'm actually pretty
sure no-one should be saying that, since layout is &quot;mostly asynchronous&quot; in
Webkit and Gecko and I don't want any spec to impose mostly-unobservable
requirements about when layout should happen.

&gt;<i> I know that setting document.domain makes this tricky because it
</I>&gt;<i> &gt; synchronously enables new cross-domain interactions, but can't we handle
</I>&gt;<i> &gt; that by declaring that setting document.domain releases the storage
</I>&gt;<i> mutex?
</I>&gt;<i>
</I>&gt;<i> All of these different ways that the storage mutex gets implicitly
</I>&gt;<i> released lead to weird behavior in edge cases. In my opinion, it would
</I>&gt;<i> be better to fix the API in a clean way than keep patching it like
</I>&gt;<i> this.
</I>&gt;<i>
</I>&gt;<i>
</I>document.domain is a crazy API. So are sync XHRs which I believe also drop
the mutex. I'm comfortable with these cases dropping the mutex ... much more
comfortable than not having the mutex at all.

Rob
-- 
&quot;He was pierced for our transgressions, he was crushed for our iniquities;
the punishment that brought us peace was upon him, and by his wounds we are
healed. We all, like sheep, have gone astray, each of us has turned to his
own way; and the LORD has laid on him the iniquity of us all.&quot; [Isaiah
53:5-6]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20090909/d6ea2fb4/attachment-0002.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20090909/d6ea2fb4/attachment-0002.htm</A>&gt;
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="065036.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
	<LI>Next message: <A HREF="065018.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65037">[ date ]</a>
              <a href="thread.html#65037">[ thread ]</a>
              <a href="subject.html#65037">[ subject ]</a>
              <a href="author.html#65037">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
