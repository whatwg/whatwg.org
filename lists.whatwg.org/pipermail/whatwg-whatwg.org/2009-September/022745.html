<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20RFC%3A%20Alternatives%20to%20storage%20mutex%20for%20cookies%20and%0A%09localStorage&In-Reply-To=%3C5dd9e5c50909080108j21eca0f6t2227be13451d2460%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022764.html">
   <LINK REL="Next"  HREF="022789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage</H1>
<!--htdig_noindex-->
    <B>Jeremy Orlow</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20RFC%3A%20Alternatives%20to%20storage%20mutex%20for%20cookies%20and%0A%09localStorage&In-Reply-To=%3C5dd9e5c50909080108j21eca0f6t2227be13451d2460%40mail.gmail.com%3E"
       TITLE="[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage">jorlow at chromium.org
       </A><BR>
    <I>Tue Sep  8 01:08:55 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="022764.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
        <LI>Next message: <A HREF="022789.html">[whatwg] RFC: Alternatives to storage mutex for cookies and localStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22745">[ date ]</a>
              <a href="thread.html#22745">[ thread ]</a>
              <a href="subject.html#22745">[ subject ]</a>
              <a href="author.html#22745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Tue, Sep 8, 2009 at 4:54 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:

&gt;<i> On Tue, Sep 8, 2009 at 12:00 AM, Aaron Boodman&lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">aa at google.com</A>&gt; wrote:
</I>&gt;<i> &gt; On Fri, Sep 4, 2009 at 12:02 AM, Chris Jones&lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">cjones at mozilla.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; I propose adding the functions
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;  window.localStorage.beginTransaction()
</I>&gt;<i> &gt;&gt;  window.localStorage.commitTransaction()
</I>&gt;<i> &gt;&gt; or
</I>&gt;<i> &gt;&gt;  window.beginTransaction()
</I>&gt;<i> &gt;&gt;  window.commitTransaction()
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think this is a good idea! I would modify it to follow the pattern
</I>&gt;<i> &gt; set by the current SQLDatabase proposal, to have a callback, like
</I>&gt;<i> &gt; this:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; window.localStorage.transaction(function() {
</I>&gt;<i> &gt;  // use local storage here
</I>&gt;<i> &gt; });
</I>&gt;<i>
</I>&gt;<i> We have discussed similar APIs in the past. Something like a:
</I>&gt;<i>
</I>&gt;<i> window.getLocalStorage(function (storage) {
</I>&gt;<i>  ...use storage...
</I>&gt;<i> });
</I>&gt;<i>
</I>&gt;<i> This is nice because it can be expanded to something like:
</I>&gt;<i> window.getSharedItems(window.SHARED_ITEM_LOCALSTORAGE |
</I>&gt;<i> window.SHARED_ITEM_COOKIES, function (...) { ... });
</I>&gt;<i>
</I>&gt;<i> to let you access both cookies and localStorage safely at the same time.
</I>&gt;<i>
</I>&gt;<i> However, this requires breaking compatibility with existing syntax,
</I>&gt;<i> something that seems impossible at this point given that Microsoft has
</I>&gt;<i> shipped localStorage. I know Hixie has asked them in the past about
</I>&gt;<i> how they plan to deal with the mutex problem, but I'm not sure if an
</I>&gt;<i> answer has been received as of yet.
</I>&gt;<i>
</I>
First of all, I'm not sure I agree that we're at the point where
breaking compatibility is impossible.  It really doesn't seem like it's
terribly widely used, and what's implemented is based on an early draft of
the spec.  Yes, I agree that it's really unfortunate we didn't iron these
problems out better before everyone implemented it, but if LocalStorage
changed today, it definitely wouldn't break the web.  (Of course, it's
possible that we would be breaking the web by the time the next gen of the
major browsers ship.....it's hard to know for sure.)

But, if we're going to say that the way things are now is sacred, then how
do we reconcile the fact that an app that works fine on Safari (and others)
may break in IE due to races?  If we're so worried about compatibility,
maybe we need to cater to the lowest common denominator (IE8....so no run to
completion guarantees for LocalStorage) and add in a mechanism that does
give you guarantees (like a callback).


As a side note, I'd be very interested to hear what Microsoft's response
was.

J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20090908/91ecb197/attachment-0001.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20090908/91ecb197/attachment-0001.htm</A>&gt;
</PRE>




























































































<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022764.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
	<LI>Next message: <A HREF="022789.html">[whatwg] RFC: Alternatives to storage mutex for cookies and localStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22745">[ date ]</a>
              <a href="thread.html#22745">[ thread ]</a>
              <a href="subject.html#22745">[ subject ]</a>
              <a href="author.html#22745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
