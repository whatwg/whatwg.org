<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20RFC%3A%20Alternatives%20to%20storage%20mutex%20for%20cookies%20and%0A%09localStorage&In-Reply-To=%3C11e306600909051333y20bb6ecam228b3d299ce7942a%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022704.html">
   <LINK REL="Next"  HREF="022706.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage</H1>
<!--htdig_noindex-->
    <B>Robert O'Callahan</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20RFC%3A%20Alternatives%20to%20storage%20mutex%20for%20cookies%20and%0A%09localStorage&In-Reply-To=%3C11e306600909051333y20bb6ecam228b3d299ce7942a%40mail.gmail.com%3E"
       TITLE="[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage">robert at ocallahan.org
       </A><BR>
    <I>Sat Sep  5 13:33:05 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="022704.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
        <LI>Next message: <A HREF="022706.html">[whatwg] RFC: Alternatives to storage mutex for cookies and localStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22705">[ date ]</a>
              <a href="thread.html#22705">[ thread ]</a>
              <a href="subject.html#22705">[ subject ]</a>
              <a href="author.html#22705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Sun, Sep 6, 2009 at 4:55 AM, Chris Jones &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">cjones at mozilla.com</A>&gt; wrote:

&gt;<i> I mean prevent the UA from affecting a script's execution.  The cases I've
</I>&gt;<i> thought of so far where we will probably have to break storage-mutex
</I>&gt;<i> semantics are
</I>&gt;<i>
</I>&gt;<i>  * clear private data
</I>&gt;<i>
</I> * close tab
&gt;<i>  * quit UA
</I>&gt;<i>
</I>
I think these could appear to complete immediately while doing their work
asynchronously in the background, given the assumption that content script
execution time is bounded (if it takes &quot;too long&quot; we enforce the assumption
using the slow-script timeout).

 * &quot;slow script&quot; timeout
&gt;<i>  * store-to-disk failure
</I>&gt;<i>  * crash
</I>&gt;<i>
</I>&gt;<i>
</I>In HTML5 we generally take the approach that if a UA is unable to satisfy
spec semantics due to resource limits or other problems in the environment,
then it's OK to deviate from the spec. Applying that principle here, we
would not need to provide database consistency in the presence of these
failures.

And as I argued in the OP, I think localStorage should be designed only with
&gt;<i> sites like gmail in mind.
</I>&gt;<i>
</I>
Yes ... I'm not so sure about that.

I'm beginning to think that this discussion is more about DB consistency
&gt;<i> than multi-event-loop UAs.  I think it's telling that all of the cases I
</I>&gt;<i> listed above could arise in single-process Gecko except &quot;clear private data&quot;
</I>&gt;<i> (and maybe &quot;close tab&quot;, not sure).
</I>&gt;<i>
</I>
Currently in Gecko &quot;clear private data&quot;, &quot;close tab&quot; and &quot;quit&quot; would all
wait for running scripts to complete. But indeed, the consistency you want
isn't provided by any browser today if the app encounters resource limits or
hardware failures. Storing a single key-value pair should be atomic in the
case of failure, so apps have to roll-your-own consistency and recovery
using that.

Rob
-- 
&quot;He was pierced for our transgressions, he was crushed for our iniquities;
the punishment that brought us peace was upon him, and by his wounds we are
healed. We all, like sheep, have gone astray, each of us has turned to his
own way; and the LORD has laid on him the iniquity of us all.&quot; [Isaiah
53:5-6]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20090906/9419df39/attachment.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20090906/9419df39/attachment.htm</A>&gt;
</PRE>

























































































<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022704.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
	<LI>Next message: <A HREF="022706.html">[whatwg] RFC: Alternatives to storage mutex for cookies and localStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22705">[ date ]</a>
              <a href="thread.html#22705">[ thread ]</a>
              <a href="subject.html#22705">[ subject ]</a>
              <a href="author.html#22705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
