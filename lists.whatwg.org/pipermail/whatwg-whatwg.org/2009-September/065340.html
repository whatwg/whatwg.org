<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] localStorage, the storage mutex, document.domain,	and 	workers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20localStorage%2C%20the%20storage%20mutex%2C%20document.domain%2C%0A%09and%20%09workers&In-Reply-To=%3C63df84f0909171156pf911dd1xc5cc2b59b289ff69%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="065339.html">
   <LINK REL="Next"  HREF="065344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] localStorage, the storage mutex, document.domain,	and 	workers</H1>
<!--htdig_noindex-->
    <B>Jonas Sicking</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20localStorage%2C%20the%20storage%20mutex%2C%20document.domain%2C%0A%09and%20%09workers&In-Reply-To=%3C63df84f0909171156pf911dd1xc5cc2b59b289ff69%40mail.gmail.com%3E"
       TITLE="[whatwg] localStorage, the storage mutex, document.domain,	and 	workers">jonas at sicking.cc
       </A><BR>
    <I>Thu Sep 17 11:56:02 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="065339.html">[whatwg] localStorage, the storage mutex, document.domain,	and workers
</A></li>
        <LI>Next message: <A HREF="065344.html">[whatwg] localStorage, the storage mutex, document.domain,	and workers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65340">[ date ]</a>
              <a href="thread.html#65340">[ thread ]</a>
              <a href="subject.html#65340">[ subject ]</a>
              <a href="author.html#65340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Thu, Sep 17, 2009 at 10:53 AM, Jeremy Orlow &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jorlow at chromium.org</A>&gt; wrote:
&gt;<i> On Thu, Sep 17, 2009 at 1:32 AM, Ian Hickson&#160;&lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ian at hixie.ch</A>&gt;&#160;wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Tue, 15 Sep 2009, Jonas Sicking wrote:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; First off, I agree that not having localStorage in workers is a big
</I>&gt;&gt;<i> &gt; problem that we need to address.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; If I were designing the localStorage interface today I would use the
</I>&gt;&gt;<i> &gt; above interface that you suggest. Grabbing localStorage can only be done
</I>&gt;&gt;<i> &gt; asynchronously, and while you're using it, no one else can get a
</I>&gt;&gt;<i> &gt; reference to it. This way there are no race conditions, but also no way
</I>&gt;&gt;<i> &gt; for anyone to have to lock.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; So one solution is to do that in parallel to the current localStorage
</I>&gt;&gt;<i> &gt; interface. Let's say we introduce a 'clientStorage' object. You can only
</I>&gt;&gt;<i> &gt; get a reference to it using a 'getClientStorage' function. This function
</I>&gt;&gt;<i> &gt; is available both to workers and windows. The storage is separate from
</I>&gt;&gt;<i> &gt; localStorage so no need to worry about the 'storage mutex'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I think we should be very careful before introducing a fourth storage
</I>&gt;&gt;<i> mechanism to make sure that whatever we introduce really is something
</I>&gt;&gt;<i> that's going to be very useful and really solve problems. I'd really
</I>&gt;&gt;<i> rather not rush into adding yet another mechanism at this point.
</I>&gt;<i>
</I>&gt;<i> Sure. &#160;But what about the other idea Robert and Drew had (in the workers +
</I>&gt;<i> local storage thread) about just having a WorkerLocalStorage mechanism?
</I>&gt;<i> &#160;Only workers would be able to access it and the interface would be exactly
</I>&gt;<i> the same as LocalStorage. &#160;The only difference is that the data is in
</I>&gt;<i> a&#160;separate&#160;area (and pages/workers cannot share data). &#160;(Though we could, in
</I>&gt;<i> the future, add such an async interface if we wanted to allow pages to
</I>&gt;<i> access it.) &#160;I know the burden for implementation in WebKit is low, and I
</I>&gt;<i> imagine (though don't know for sure) that the burden would be low in other
</I>&gt;<i> browsers as well.
</I>
This is what I think we should do. I do think that an async accessor
in pages would increase its utility significantly. In fact, if we did
that the interface could even work as an alternative to localStorage
on the main thread for applications that worry about the locking, and
thus unresponsive UI, that the storage mutex creates.

/ Jonas

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="065339.html">[whatwg] localStorage, the storage mutex, document.domain,	and workers
</A></li>
	<LI>Next message: <A HREF="065344.html">[whatwg] localStorage, the storage mutex, document.domain,	and workers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65340">[ date ]</a>
              <a href="thread.html#65340">[ thread ]</a>
              <a href="subject.html#65340">[ subject ]</a>
              <a href="author.html#65340">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
