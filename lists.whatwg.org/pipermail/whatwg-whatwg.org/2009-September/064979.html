<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] RFC: Alternatives to storage mutex for cookies and localStorage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20RFC%3A%20Alternatives%20to%20storage%20mutex%20for%20cookies%20and%0A%20localStorage&In-Reply-To=%3C4AA2DF82.8020606%40mozilla.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="064978.html">
   <LINK REL="Next"  HREF="064987.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] RFC: Alternatives to storage mutex for cookies and localStorage</H1>
<!--htdig_noindex-->
    <B>Chris Jones</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20RFC%3A%20Alternatives%20to%20storage%20mutex%20for%20cookies%20and%0A%20localStorage&In-Reply-To=%3C4AA2DF82.8020606%40mozilla.com%3E"
       TITLE="[whatwg] RFC: Alternatives to storage mutex for cookies and localStorage">cjones at mozilla.com
       </A><BR>
    <I>Sat Sep  5 15:00:34 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="064978.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
        <LI>Next message: <A HREF="064987.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64979">[ date ]</a>
              <a href="thread.html#64979">[ thread ]</a>
              <a href="subject.html#64979">[ subject ]</a>
              <a href="author.html#64979">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Robert O'Callahan wrote:
&gt;<i> On Sun, Sep 6, 2009 at 4:55 AM, Chris Jones &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">cjones at mozilla.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">cjones at mozilla.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     I mean prevent the UA from affecting a script's execution.  The
</I>&gt;<i>     cases I've thought of so far where we will probably have to break
</I>&gt;<i>     storage-mutex semantics are
</I>&gt;<i> 
</I>&gt;<i>      * clear private data
</I>&gt;<i> 
</I>&gt;<i>      * close tab
</I>&gt;<i>      * quit UA
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I think these could appear to complete immediately while doing their 
</I>&gt;<i> work asynchronously in the background, given the assumption that content 
</I>&gt;<i> script execution time is bounded (if it takes &quot;too long&quot; we enforce the 
</I>&gt;<i> assumption using the slow-script timeout).
</I>&gt;<i> 
</I>&gt;<i>      * &quot;slow script&quot; timeout
</I>&gt;<i>      * store-to-disk failure
</I>&gt;<i>      * crash
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> In HTML5 we generally take the approach that if a UA is unable to 
</I>&gt;<i> satisfy spec semantics due to resource limits or other problems in the 
</I>&gt;<i> environment, then it's OK to deviate from the spec. Applying that 
</I>&gt;<i> principle here, we would not need to provide database consistency in the 
</I>&gt;<i> presence of these failures.
</I>&gt;<i> 
</I>
I don't like the idea of the spec creating an illusion that's impossible 
for browser vendors to maintain.

&gt;<i>     I'm beginning to think that this discussion is more about DB
</I>&gt;<i>     consistency than multi-event-loop UAs.  I think it's telling that
</I>&gt;<i>     all of the cases I listed above could arise in single-process Gecko
</I>&gt;<i>     except &quot;clear private data&quot; (and maybe &quot;close tab&quot;, not sure).
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Currently in Gecko &quot;clear private data&quot;, &quot;close tab&quot; and &quot;quit&quot; would 
</I>&gt;<i> all wait for running scripts to complete. But indeed, the consistency 
</I>&gt;<i> you want isn't provided by any browser today if the app encounters 
</I>&gt;<i> resource limits or hardware failures. Storing a single key-value pair 
</I>&gt;<i> should be atomic in the case of failure, so apps have to roll-your-own 
</I>&gt;<i> consistency and recovery using that.
</I>&gt;<i> 
</I>
&quot;Force quit&quot; will interrupt scripts.

Desktop apps have to worry about DB consistency, and DBs for those 
provide transactional consistency guarantees.  It seems undesirable to 
deny them to web apps using localStorage, especially since localStorage 
seems more author-friendly than Web Database.  (Undesirable excepting 
compatibility with existing localStorage impls.)  This is a rhetorical 
point not necessarily directed at you personally, since I think we're 
pretty much on the same page.

Cheers,
Chris

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="064978.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
	<LI>Next message: <A HREF="064987.html">[whatwg] RFC: Alternatives to storage mutex for cookies and	localStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64979">[ date ]</a>
              <a href="thread.html#64979">[ thread ]</a>
              <a href="subject.html#64979">[ subject ]</a>
              <a href="author.html#64979">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
