<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] [hybi] Races in websocket API?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20%5Bhybi%5D%20Races%20in%20websocket%20API%3F&In-Reply-To=%3Cde17d48e0911182026i1a31dcbdoa5edafeb1f48e779%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="066387.html">
   <LINK REL="Next"  HREF="066393.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] [hybi] Races in websocket API?</H1>
<!--htdig_noindex-->
    <B>Fumitoshi Ukai (&#40284;&#39164;&#25991;&#25935;)</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20%5Bhybi%5D%20Races%20in%20websocket%20API%3F&In-Reply-To=%3Cde17d48e0911182026i1a31dcbdoa5edafeb1f48e779%40mail.gmail.com%3E"
       TITLE="[whatwg] [hybi] Races in websocket API?">ukai at chromium.org
       </A><BR>
    <I>Wed Nov 18 20:26:04 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="066387.html">[whatwg] svn.whatwg.org inaccessible?
</A></li>
        <LI>Next message: <A HREF="066393.html">[whatwg] [hybi] Races in websocket API?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66386">[ date ]</a>
              <a href="thread.html#66386">[ thread ]</a>
              <a href="subject.html#66386">[ subject ]</a>
              <a href="author.html#66386">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Thu, Nov 19, 2009 at 1:00 PM, Greg Wilkins &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">gregw at webtide.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Is there a race in the websocket API.
</I>&gt;<i>
</I>&gt;<i> When you do:
</I>&gt;<i>
</I>&gt;<i>  var ws = new WebSocket(&quot;<A HREF="ws://mysite.com">ws://mysite.com</A>&quot;,&quot;myprotocol&quot;);
</I>&gt;<i>
</I>&gt;<i> then the spec says:
</I>&gt;<i>
</I>&gt;<i>   Return a new WebSocket object, and continue these steps in the
</I>&gt;<i>   background (without blocking scripts).
</I>&gt;<i>
</I>&gt;<i>   Establish a Web Socket connection to a host host, on port port
</I>&gt;<i>   (if one was specified), from origin, with the flag secure, with
</I>&gt;<i>   resource name as the resource name, and with protocol as the
</I>&gt;<i>   protocol (if it is present).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So if the next line in the script is
</I>&gt;<i>
</I>&gt;<i>  ws.onopen=myopenfunc;
</I>&gt;<i>
</I>&gt;<i> there is a race between if the onopen function will
</I>&gt;<i> be assigned and if the background connection has been established?
</I>&gt;<i>
</I>
I believe open event  is just queued at the moment, and it will be fired
later when javascript becomes idle.

When the Web Socket connection is established, the user agent must run the
following steps:
 Change the readyState attribute's value to OPEN (1).
 Queue a task to fire a simple event named open at the WebSocket object.

-- 
ukai

&gt;<i>
</I>&gt;<i> OK it is currently unlikely that the connect will happen that
</I>&gt;<i> quick - however if I'm running in a rhino test environment
</I>&gt;<i> or a on a browser that is multiplexing the websocket onto an
</I>&gt;<i> already existing connection, then the onopen may indeed be fast.
</I>&gt;<i>
</I>&gt;<i> Similar races exist for onmessage and onclose.  Setting onmessage
</I>&gt;<i> might miss a message that is delivered quickly after the websocket
</I>&gt;<i> is opened.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> regards
</I>&gt;<i> _______________________________________________
</I>&gt;<i> hybi mailing list
</I>&gt;<i> <A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">hybi at ietf.org</A>
</I>&gt;<i> <A HREF="https://www.ietf.org/mailman/listinfo/hybi">https://www.ietf.org/mailman/listinfo/hybi</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20091119/652a0c4e/attachment-0001.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20091119/652a0c4e/attachment-0001.htm</A>&gt;
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="066387.html">[whatwg] svn.whatwg.org inaccessible?
</A></li>
	<LI>Next message: <A HREF="066393.html">[whatwg] [hybi] Races in websocket API?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66386">[ date ]</a>
              <a href="thread.html#66386">[ thread ]</a>
              <a href="subject.html#66386">[ subject ]</a>
              <a href="author.html#66386">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
