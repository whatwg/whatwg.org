<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and	&lt;meta/&gt;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Possible%20bugs%20%3A%20Microdata%20Itemscope%20on%20%3Clink/%3E%20and%0A%09%3Cmeta/%3E&In-Reply-To=%3C4B12B613.8080607%40depulz.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="066485.html">
   <LINK REL="Next"  HREF="066497.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and	&lt;meta/&gt;</H1>
<!--htdig_noindex-->
    <B>Tim van Oostrom</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Possible%20bugs%20%3A%20Microdata%20Itemscope%20on%20%3Clink/%3E%20and%0A%09%3Cmeta/%3E&In-Reply-To=%3C4B12B613.8080607%40depulz.nl%3E"
       TITLE="[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and	&lt;meta/&gt;">tim at depulz.nl
       </A><BR>
    <I>Sun Nov 29 09:57:39 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="066485.html">[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and &lt;meta/&gt;
</A></li>
        <LI>Next message: <A HREF="066497.html">[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and &lt;meta/&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66486">[ date ]</a>
              <a href="thread.html#66486">[ thread ]</a>
              <a href="subject.html#66486">[ subject ]</a>
              <a href="author.html#66486">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Tim van Oostrom wrote:
&gt;<i> Philip J&#228;genstedt wrote:
</I>&gt;&gt;<i> On Sun, 29 Nov 2009 12:46:16 +0100, Tim van Oostrom &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">tim at depulz.nl</A>&gt; 
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Philip J&#228;genstedt wrote:
</I>&gt;&gt;&gt;&gt;<i> On Thu, 26 Nov 2009 22:30:41 +0100, Tim van Oostrom &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">tim at depulz.nl</A>&gt; 
</I>&gt;&gt;&gt;&gt;<i> wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Hi, I made a forumpost : 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://forums.whatwg.org/viewtopic.php?t=4176,">http://forums.whatwg.org/viewtopic.php?t=4176,</A> concerning a 
</I>&gt;&gt;&gt;&gt;&gt;<i> possible &quot;microdata specification bug&quot; and a bug in the 
</I>&gt;&gt;&gt;&gt;&gt;<i> james.html5.org microdata extractor.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Comes down to &lt;link/&gt; and &lt;meta/&gt; elements possibly being unfit 
</I>&gt;&gt;&gt;&gt;&gt;<i> for use with the itemscope attribute.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> I made an example in the forum post with some nice ubb formatting .
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> There are some other issues with &lt;link&gt; and &lt;meta&gt; you might want 
</I>&gt;&gt;&gt;&gt;<i> to review first: [1]
</I>&gt;&gt;&gt;<i> Ok
</I>&gt;&gt;&gt;&gt;<i> Your second example was:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> &lt;div itemtype=&quot;<A HREF="http://url.to/geoVocab#country">http://url.to/geoVocab#country</A>&quot; itemscope&gt;
</I>&gt;&gt;&gt;&gt;<i>    &lt;span itemprop=&quot;<A HREF="http://xmlns.com/foaf/spec/index.rdf#name">http://xmlns.com/foaf/spec/index.rdf#name</A>&quot; 
</I>&gt;&gt;&gt;&gt;<i> lang=&quot;cn&quot;&gt;&#20013;&#33775;&#20154;&#27665;&#20849;&#21644;&#22283;&lt;/span&gt;
</I>&gt;&gt;&gt;&gt;<i>    &lt;span itemprop=&quot;<A HREF="http://xmlns.com/foaf/spec/index.rdf#name">http://xmlns.com/foaf/spec/index.rdf#name</A>&quot; 
</I>&gt;&gt;&gt;&gt;<i> lang=&quot;en&quot;&gt;China&lt;/span&gt;
</I>&gt;&gt;&gt;&gt;<i>    &lt;link itemprop=&quot;<A HREF="http://url.to/city">http://url.to/city</A>&quot; 
</I>&gt;&gt;&gt;&gt;<i> href=&quot;<A HREF="http://url.to/shanghai">http://url.to/shanghai</A>&quot; itemscope itemref=&quot;city-shanghai&quot; /&gt;
</I>&gt;&gt;&gt;&gt;<i>    &lt;div id=&quot;city-shanghai&quot;&gt;
</I>&gt;&gt;&gt;&gt;<i>       &lt;span 
</I>&gt;&gt;&gt;&gt;<i> itemprop=&quot;<A HREF="http://xmlns.com/foaf/spec/index.rdf#name">http://xmlns.com/foaf/spec/index.rdf#name</A>&quot;&gt;Shanghai&lt;/span&gt;
</I>&gt;&gt;&gt;&gt;<i>       &lt;span itemprop=&quot;<A HREF="http://url.to/demoVocab#population">http://url.to/demoVocab#population</A>&quot;&gt;14.61 
</I>&gt;&gt;&gt;&gt;<i> million people&lt;/span&gt;
</I>&gt;&gt;&gt;&gt;<i>       &lt;span itemprop=&quot;<A HREF="http://url.to/physicsVocab#time">http://url.to/physicsVocab#time</A>&quot; 
</I>&gt;&gt;&gt;&gt;<i> datetime=&quot;2009-11-26 11:43&quot;&gt;11:43 pm (CT)&lt;/span&gt;
</I>&gt;&gt;&gt;&gt;<i>    &lt;/div&gt;
</I>&gt;&gt;&gt;&gt;<i> &lt;/div&gt;
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> &lt;link&gt;, &lt;meta&gt; and any other void elements are usually the wrong 
</I>&gt;&gt;&gt;&gt;<i> choice for itemprop+itemscope because they don't have child 
</I>&gt;&gt;&gt;&gt;<i> elements, so itemref is the only way to add properties.
</I>&gt;&gt;&gt;<i> Yes, see forumpost. Shouldn't this be noted in the Spec then ? 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, the spec certainly needs some notes on how to use &lt;link&gt; and 
</I>&gt;&gt;<i> &lt;meta&gt;.
</I>&gt;<i>
</I>
And other void alements such as : area, base, br, col, command, embed, 
hr, img, input, link, meta, param, source 
(<A HREF="http://dev.w3.org/html5/markup/syntax.html">http://dev.w3.org/html5/markup/syntax.html</A>)

Basically, the microdata can't really be on all elements as stated in : 
HTML5 spec, 5.2.2 Items

&gt;&gt;&gt;<i> According to this an &quot;itemref&quot; attribute can never be added to an 
</I>&gt;&gt;&gt;<i> &quot;item&quot; within an itemscope of another &quot;item&quot; without the crawled 
</I>&gt;&gt;&gt;<i> prop/val pairs also applying to the ancestors itemscope.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ah, I think you've found the root of the problem. By allowing a 
</I>&gt;&gt;<i> property to be part of several items at once, we get different kinds 
</I>&gt;&gt;<i> of strange problems. Except from messing up your example, it seems it 
</I>&gt;&gt;<i> is the real cause for the infinite recursion bug I wrote about in 
</I>&gt;&gt;<i> [1]. Then I was so focused on the recursion that I suggested a rather 
</I>&gt;&gt;<i> complex solution to detect loops in the microdata, when it seems it 
</I>&gt;&gt;<i> could be solved simply be making sure that a property belongs to only 
</I>&gt;&gt;<i> 1 item. Detailed suggestion below.
</I>&gt;&gt;<i> Now, back to the problem of one property, multiple items. The 
</I>&gt;&gt;<i> algorithm for finding the properties of an item [2] is an attempt at 
</I>&gt;&gt;<i> optimizing the search for properties starting at an item element. I 
</I>&gt;&gt;<i> think we should replace this algorithm with an algorithm for finding 
</I>&gt;&gt;<i> the item of a property. This was previously the case with the spec 
</I>&gt;&gt;<i> before the itemref mechanism. I would suggest something along these 
</I>&gt;&gt;<i> lines:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. let current be the element with the itemprop attribute
</I>&gt;&gt;<i> 2. if current has an ID, for each element e in document order:
</I>&gt;&gt;<i> 2.1. if e has an itemref attribute:
</I>&gt;&gt;<i> 2.1.1. split the value of that itemref attribute on spaces. for each 
</I>&gt;&gt;<i> resulting token, ID:
</I>&gt;&gt;<i> 2.1.1.1. if ID equals the ID of current, return e
</I>&gt;&gt;<i> 3. reaching this step indicates that the item wasn't found via 
</I>&gt;&gt;<i> itemref on this element
</I>&gt;&gt;<i> 4. let parent be the parent element of current
</I>&gt;&gt;<i> 5. if parent is null, return null
</I>&gt;&gt;<i> 6. if parent has the itemscope attribute, return parent
</I>&gt;&gt;<i> 7. otherwise, let current be parent and jump to step 2.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This algorithm will find the parent item of a property, if there is 
</I>&gt;&gt;<i> one. itemref'ing takes precedence over &quot;parent-child linking&quot;, so in 
</I>&gt;&gt;<i> Tim's example the properties of Shanghai would be applied to only the 
</I>&gt;&gt;<i> Shanghai sub-item. I'm not convinced writing markup like that is a 
</I>&gt;&gt;<i> good idea, but at least this way it has sane processing.
</I>
Which is important in the markup-souped web of non-linked-data :-)

&gt;&gt;<i> HTMLPropertiesCollection on any given element would simply match all 
</I>&gt;&gt;<i> elements in the document for which the the algorithm returns that 
</I>&gt;&gt;<i> very element. It should be invalid for there to be any elements in 
</I>&gt;&gt;<i> the document with itemprop where this algorithm returns null or the 
</I>&gt;&gt;<i> element itself.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I will try implementing this algorithm in MicrodataJS [3] and see if 
</I>&gt;&gt;<i> it works OK. While it may look less efficient than the current 
</I>&gt;&gt;<i> algorithm, consider that a browser won't implement either algorithm 
</I>&gt;&gt;<i> as writting, only act as if they did. The expensive step of going 
</I>&gt;&gt;<i> through all elements with itemref attributes is actually no more 
</I>&gt;&gt;<i> expensive than e.g. document.querySelector('.classname') if 
</I>&gt;&gt;<i> implemented natively.
</I>
I did something like this in my experimental/unfinished/test/learn 
microdata extractor based on jquery which is here : 
<A HREF="http://www.depulz.nl/microdata/">http://www.depulz.nl/microdata/</A> (works at least in FF 3.5 and opera 10.10).

&gt;&gt;<i> [1] 
</I>&gt;&gt;<i> <A HREF="http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2009-November/024095.html">http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2009-November/024095.html</A> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [2] 
</I>&gt;&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/microdata.html#the-properties-of-an-item">http://www.whatwg.org/specs/web-apps/current-work/multipage/microdata.html#the-properties-of-an-item</A> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [3] <A HREF="http://gitorious.org/microdatajs">http://gitorious.org/microdatajs</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="066485.html">[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and &lt;meta/&gt;
</A></li>
	<LI>Next message: <A HREF="066497.html">[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and &lt;meta/&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66486">[ date ]</a>
              <a href="thread.html#66486">[ thread ]</a>
              <a href="subject.html#66486">[ subject ]</a>
              <a href="author.html#66486">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
