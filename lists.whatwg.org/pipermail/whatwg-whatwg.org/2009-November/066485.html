<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and &lt;meta/&gt;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Possible%20bugs%20%3A%20Microdata%20Itemscope%20on%20%3Clink/%3E%20and%0A%20%3Cmeta/%3E&In-Reply-To=%3Cop.u35ro3eosr6mfa%40worf%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="066484.html">
   <LINK REL="Next"  HREF="066486.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and &lt;meta/&gt;</H1>
<!--htdig_noindex-->
    <B>Philip J&#228;genstedt</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Possible%20bugs%20%3A%20Microdata%20Itemscope%20on%20%3Clink/%3E%20and%0A%20%3Cmeta/%3E&In-Reply-To=%3Cop.u35ro3eosr6mfa%40worf%3E"
       TITLE="[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and &lt;meta/&gt;">philipj at opera.com
       </A><BR>
    <I>Sun Nov 29 05:28:05 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="066484.html">[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and	&lt;meta/&gt;
</A></li>
        <LI>Next message: <A HREF="066486.html">[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and	&lt;meta/&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66485">[ date ]</a>
              <a href="thread.html#66485">[ thread ]</a>
              <a href="subject.html#66485">[ subject ]</a>
              <a href="author.html#66485">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Sun, 29 Nov 2009 12:46:16 +0100, Tim van Oostrom &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">tim at depulz.nl</A>&gt; wrote:

&gt;<i> Philip J&#228;genstedt wrote:
</I>&gt;&gt;<i> On Thu, 26 Nov 2009 22:30:41 +0100, Tim van Oostrom &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">tim at depulz.nl</A>&gt;  
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi, I made a forumpost :  
</I>&gt;&gt;&gt;<i> <A HREF="http://forums.whatwg.org/viewtopic.php?t=4176,">http://forums.whatwg.org/viewtopic.php?t=4176,</A> concerning a possible  
</I>&gt;&gt;&gt;<i> &quot;microdata specification bug&quot; and a bug in the james.html5.org  
</I>&gt;&gt;&gt;<i> microdata extractor.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Comes down to &lt;link/&gt; and &lt;meta/&gt; elements possibly being unfit for  
</I>&gt;&gt;&gt;<i> use with the itemscope attribute.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I made an example in the forum post with some nice ubb formatting .
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> There are some other issues with &lt;link&gt; and &lt;meta&gt; you might want to  
</I>&gt;&gt;<i> review first: [1]
</I>&gt;<i> Ok
</I>&gt;&gt;<i> Your second example was:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;div itemtype=&quot;<A HREF="http://url.to/geoVocab#country">http://url.to/geoVocab#country</A>&quot; itemscope&gt;
</I>&gt;&gt;<i>    &lt;span itemprop=&quot;<A HREF="http://xmlns.com/foaf/spec/index.rdf#name">http://xmlns.com/foaf/spec/index.rdf#name</A>&quot;  
</I>&gt;&gt;<i> lang=&quot;cn&quot;&gt;&#20013;&#33775;&#20154;&#27665;&#20849;&#21644;&#22283;&lt;/span&gt;
</I>&gt;&gt;<i>    &lt;span itemprop=&quot;<A HREF="http://xmlns.com/foaf/spec/index.rdf#name">http://xmlns.com/foaf/spec/index.rdf#name</A>&quot;  
</I>&gt;&gt;<i> lang=&quot;en&quot;&gt;China&lt;/span&gt;
</I>&gt;&gt;<i>    &lt;link itemprop=&quot;<A HREF="http://url.to/city">http://url.to/city</A>&quot; href=&quot;<A HREF="http://url.to/shanghai">http://url.to/shanghai</A>&quot;  
</I>&gt;&gt;<i> itemscope itemref=&quot;city-shanghai&quot; /&gt;
</I>&gt;&gt;<i>    &lt;div id=&quot;city-shanghai&quot;&gt;
</I>&gt;&gt;<i>       &lt;span  
</I>&gt;&gt;<i> itemprop=&quot;<A HREF="http://xmlns.com/foaf/spec/index.rdf#name">http://xmlns.com/foaf/spec/index.rdf#name</A>&quot;&gt;Shanghai&lt;/span&gt;
</I>&gt;&gt;<i>       &lt;span itemprop=&quot;<A HREF="http://url.to/demoVocab#population">http://url.to/demoVocab#population</A>&quot;&gt;14.61 million  
</I>&gt;&gt;<i> people&lt;/span&gt;
</I>&gt;&gt;<i>       &lt;span itemprop=&quot;<A HREF="http://url.to/physicsVocab#time">http://url.to/physicsVocab#time</A>&quot;  
</I>&gt;&gt;<i> datetime=&quot;2009-11-26 11:43&quot;&gt;11:43 pm (CT)&lt;/span&gt;
</I>&gt;&gt;<i>    &lt;/div&gt;
</I>&gt;&gt;<i> &lt;/div&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> By using itemprop+itemscope, you're saying that the property is itself  
</I>&gt;&gt;<i> an item. Also specifying href=&quot;<A HREF="http://url.to/shanghai">http://url.to/shanghai</A>&quot; does nothing.
</I>&gt;<i> I also pointed that out in my forumpost.
</I>
I probably didn't read it all closely enough to see which parts were  
misunderstandings and which parts were intentionally testing the limits of  
the spec, sorry if I hit you on the head with things you already knew.

&gt;&gt;<i> &lt;link&gt;, &lt;meta&gt; and any other void elements are usually the wrong choice  
</I>&gt;&gt;<i> for itemprop+itemscope because they don't have child elements, so  
</I>&gt;&gt;<i> itemref is the only way to add properties.
</I>&gt;<i> Yes, see forumpost. Shouldn't this be noted in the Spec then ?  (maybe i  
</I>&gt;<i> read over it)
</I>
Yes, the spec certainly needs some notes on how to use &lt;link&gt; and &lt;meta&gt;.

&gt;&gt;<i> What you've accidentally done above is add the 3 properties of Shanghai  
</I>&gt;&gt;<i> to both the top-level item and the sub-item, see [2] for details.
</I>&gt;<i> Well, i did it in full awareness, i interpreted the itemref attribute  
</I>&gt;<i> like this. But if it can't be used this way, isn't this a setback on the  
</I>&gt;<i> flexibility of itemref? Or was it intended this way.
</I>&gt;<i> According to this an &quot;itemref&quot; attribute can never be added to an &quot;item&quot;  
</I>&gt;<i> within an itemscope of another &quot;item&quot; without the crawled prop/val pairs  
</I>&gt;<i> also applying to the ancestors itemscope.
</I>&gt;<i>
</I>
Ah, I think you've found the root of the problem. By allowing a property  
to be part of several items at once, we get different kinds of strange  
problems. Except from messing up your example, it seems it is the real  
cause for the infinite recursion bug I wrote about in [1]. Then I was so  
focused on the recursion that I suggested a rather complex solution to  
detect loops in the microdata, when it seems it could be solved simply be  
making sure that a property belongs to only 1 item. Detailed suggestion  
below.

[snip Amanda example]

[snip most of what Shanghai is to China]

&gt;<i> Assigning &quot;unique&quot; properties to Subjects for RDF's sake doesn't seem  
</I>&gt;<i> like a good idea to me.
</I>&gt;<i> Ofcourse i can make other, more sensible, html markup but the whole  
</I>&gt;<i> point of a solid annotating language is that i can apply it to my  
</I>&gt;<i> existing markup without changing it.
</I>
Hehe, I wasn't suggesting a unique predicate for each combination of  
country and city, just trying to sort out what is the itemprop and what is  
the itemtype in your example. If you want RDF I suppose you have to find  
some vocabulary that has a predicate that makes sense as China *predicate*  
Shanghai.

&gt;&gt;<i> If &lt;<A HREF="http://url.to/shanghai">http://url.to/shanghai</A>&gt; is a global identifier for Shanghai you  
</I>&gt;&gt;<i> should use itemid.
</I>&gt;<i>
</I>&gt;<i> Correct, but the href=&quot;&quot; is ignored in that example. If it only  
</I>&gt;<i> concerned a property i'd use :
</I>&gt;<i>
</I>&gt;<i> &lt;link itemprop=&quot;<A HREF="http://url.to/city">http://url.to/city</A>&quot; href=&quot;<A HREF="http://url.to/shanghai">http://url.to/shanghai</A>&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i> and it would be valid. I used it to show my point about &lt;link/&gt; and  
</I>&gt;<i> itemscope, see forumpost.
</I>&gt;<i>
</I>
In this example, I really don't see why you would use &lt;link&gt; to make a  
sub-item to begin with. Perhaps we should make itemscope on &lt;link&gt; and  
&lt;meta&gt; invalid in order to warn people of the problem?

&gt;&gt;<i>
</I>&gt;&gt;<i> I don't know what &lt;<A HREF="http://url.to/physicsVocab#time">http://url.to/physicsVocab#time</A>&gt; is, but note that  
</I>&gt;&gt;<i> an exact time isn't very useful without a timezone, so I added the PRC  
</I>&gt;&gt;<i> timezone for you. I'll also note that using traditional Chinese for the  
</I>&gt;&gt;<i> full name of the PRC is an odd choice, so I changed it to simplified  
</I>&gt;&gt;<i> Chinese above.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Marking up the population as &quot;14.61 million people&quot; isn't terribly  
</I>&gt;&gt;<i> helpful if you want a computer to be able to find the city with the  
</I>&gt;&gt;<i> biggest population among several cities, unless your vocabulary defines  
</I>&gt;&gt;<i> how to parse &quot;14.61 million people&quot; into a number, which would be  
</I>&gt;&gt;<i> strange. In any case this is hidden metadata unless you want 14610000  
</I>&gt;&gt;<i> or some other easily machine-parsable representation to be visible in  
</I>&gt;&gt;<i> the page rendering.
</I>&gt;<i>
</I>&gt;<i> Ok but using content=&quot;&quot; on a span, is that valid ? Your suggestion in  
</I>&gt;<i> [1] would be nicer. But i prefer the use of &lt;link/&gt; and &lt;meta/&gt; elements.
</I>&gt;<i>
</I>
Oops, my suggestion is broken, I mean to write:

&lt;span hidden itemprop=&quot;<A HREF="http://url.to/demoVocab#population">http://url.to/demoVocab#population</A>&quot;&gt;14610000&lt;/span&gt;

&gt;&gt;<i> Finally, I think &lt;<A HREF="http://xmlns.com/foaf/spec/index.rdf#name">http://xmlns.com/foaf/spec/index.rdf#name</A>&gt; should be  
</I>&gt;&gt;<i> &lt;<A HREF="http://xmlns.com/foaf/0.1/name">http://xmlns.com/foaf/0.1/name</A>&gt;. If you're going to use existing  
</I>&gt;&gt;<i> vocabularies like FOAF and want your data to be play nice with the RDF  
</I>&gt;&gt;<i> world, make sure to check that the result of the RDF extraction  
</I>&gt;&gt;<i> algorithm [3] is what you intended.
</I>&gt;<i> This remains unclear to me. For example : <A HREF="http://xmlns.com/foaf/0.1/name">http://xmlns.com/foaf/0.1/name</A>  
</I>&gt;<i> redirects to an html page but : <A HREF="http://purl.org/dc/terms/title">http://purl.org/dc/terms/title</A> redirects  
</I>&gt;<i> to an .rdf file. For readability, wouldn't  
</I>&gt;<i> <A HREF="http://xmlns.com/foaf/spec/#term_name">http://xmlns.com/foaf/spec/#term_name</A> and  
</I>&gt;<i> <A HREF="http://dublincore.org/documents/dcmi-terms/#elements-title">http://dublincore.org/documents/dcmi-terms/#elements-title</A> be better  ?
</I>&gt;<i> If i dereference these url's i find the information i want in one stop.
</I>
If you want to reuse an RDF vocabulary you have to use byte-by-byte the  
exact same URIs. I agree that finding the correct URI is quite difficult  
because treating them as a URL and looking them up in a browser will often  
redirect you. I got &lt;<A HREF="http://xmlns.com/foaf/0.1/name">http://xmlns.com/foaf/0.1/name</A>&gt; by looking at the  
namespace declaration used for foaf and appending &quot;name&quot;.

&gt;&gt;<i> In particular, you probably want to use itemid where possible and make  
</I>&gt;&gt;<i> sure that all your URIs are exactly correct. Personally, though, unless  
</I>&gt;&gt;<i> I could reuse existing vocabularies for every single item and property,  
</I>&gt;&gt;<i> I would only use a full URI for itemtype and point that to a vocabulary  
</I>&gt;&gt;<i> that defines what simpler property names like &quot;name&quot; and &quot;city&quot; mean  
</I>&gt;&gt;<i> and how to convert the vocabulary to RDF.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [1]  
</I>&gt;&gt;<i> <A HREF="http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2009-November/024116.html">http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2009-November/024116.html</A>  
</I>&gt;&gt;<i> [2]  
</I>&gt;&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/microdata.html#the-properties-of-an-item">http://www.whatwg.org/specs/web-apps/current-work/multipage/microdata.html#the-properties-of-an-item</A>  
</I>&gt;&gt;<i> [3]  
</I>&gt;&gt;<i> <A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/converting-html-to-other-formats.html#rdf">http://www.whatwg.org/specs/web-apps/current-work/multipage/converting-html-to-other-formats.html#rdf</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
Now, back to the problem of one property, multiple items. The algorithm  
for finding the properties of an item [2] is an attempt at optimizing the  
search for properties starting at an item element. I think we should  
replace this algorithm with an algorithm for finding the item of a  
property. This was previously the case with the spec before the itemref  
mechanism. I would suggest something along these lines:

1. let current be the element with the itemprop attribute
2. if current has an ID, for each element e in document order:
2.1. if e has an itemref attribute:
2.1.1. split the value of that itemref attribute on spaces. for each  
resulting token, ID:
2.1.1.1. if ID equals the ID of current, return e
3. reaching this step indicates that the item wasn't found via itemref on  
this element
4. let parent be the parent element of current
5. if parent is null, return null
6. if parent has the itemscope attribute, return parent
7. otherwise, let current be parent and jump to step 2.

This algorithm will find the parent item of a property, if there is one.  
itemref'ing takes precedence over &quot;parent-child linking&quot;, so in Tim's  
example the properties of Shanghai would be applied to only the Shanghai  
sub-item. I'm not convinced writing markup like that is a good idea, but  
at least this way it has sane processing. HTMLPropertiesCollection on any  
given element would simply match all elements in the document for which  
the the algorithm returns that very element. It should be invalid for  
there to be any elements in the document with itemprop where this  
algorithm returns null or the element itself.

I will try implementing this algorithm in MicrodataJS [3] and see if it  
works OK. While it may look less efficient than the current algorithm,  
consider that a browser won't implement either algorithm as writting, only  
act as if they did. The expensive step of going through all elements with  
itemref attributes is actually no more expensive than e.g.  
document.querySelector('.classname') if implemented natively.

[1]  
<A HREF="http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2009-November/024095.html">http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2009-November/024095.html</A>
[2]  
<A HREF="http://www.whatwg.org/specs/web-apps/current-work/multipage/microdata.html#the-properties-of-an-item">http://www.whatwg.org/specs/web-apps/current-work/multipage/microdata.html#the-properties-of-an-item</A>
[3] <A HREF="http://gitorious.org/microdatajs">http://gitorious.org/microdatajs</A>

-- 
Philip J&#228;genstedt

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="066484.html">[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and	&lt;meta/&gt;
</A></li>
	<LI>Next message: <A HREF="066486.html">[whatwg] Possible bugs : Microdata Itemscope on &lt;link/&gt; and	&lt;meta/&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66485">[ date ]</a>
              <a href="thread.html#66485">[ thread ]</a>
              <a href="subject.html#66485">[ subject ]</a>
              <a href="author.html#66485">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
