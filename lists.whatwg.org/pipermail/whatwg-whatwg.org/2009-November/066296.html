<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] What is the purpose of timeupdate?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20What%20is%20the%20purpose%20of%20timeupdate%3F&In-Reply-To=%3C63df84f0911071521k3a1002d3waf18873e9f78056c%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="066276.html">
   <LINK REL="Next"  HREF="066297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] What is the purpose of timeupdate?</H1>
<!--htdig_noindex-->
    <B>Jonas Sicking</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20What%20is%20the%20purpose%20of%20timeupdate%3F&In-Reply-To=%3C63df84f0911071521k3a1002d3waf18873e9f78056c%40mail.gmail.com%3E"
       TITLE="[whatwg] What is the purpose of timeupdate?">jonas at sicking.cc
       </A><BR>
    <I>Sat Nov  7 15:21:49 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="066276.html">[whatwg] What is the purpose of timeupdate?
</A></li>
        <LI>Next message: <A HREF="066297.html">[whatwg] What is the purpose of timeupdate?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66296">[ date ]</a>
              <a href="thread.html#66296">[ thread ]</a>
              <a href="subject.html#66296">[ subject ]</a>
              <a href="author.html#66296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Fri, Nov 6, 2009 at 1:44 AM, Philip J&#228;genstedt &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">philipj at opera.com</A>&gt; wrote:
&gt;<i> On Thu, 05 Nov 2009 21:11:15 +0100, Andrew Scherkus &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">scherkus at chromium.org</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Thu, Nov 5, 2009 at 6:10 AM, Brian Campbell &lt;
</I>&gt;&gt;<i> <A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">brian.p.campbell at dartmouth.edu</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Nov 5, 2009, at 1:17 AM, Andrew Scherkus wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#160;On Fri, Oct 30, 2009 at 10:18 PM, Brian Campbell &lt;
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">Brian.P.Campbell at dartmouth.edu</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> As a multimedia developer, I am wondering about the purpose of the
</I>&gt;&gt;&gt;&gt;<i> timeupdate event on media elements. On first glance, it would appear
</I>&gt;&gt;&gt;&gt;<i> that
</I>&gt;&gt;&gt;&gt;<i> this event would be useful for synchronizing animations, bullets,
</I>&gt;&gt;&gt;&gt;<i> captions,
</I>&gt;&gt;&gt;&gt;<i> UI, and the like. The spec specifies a rate of 4 to 66 Hz for these
</I>&gt;&gt;&gt;&gt;<i> events.
</I>&gt;&gt;&gt;&gt;<i> The high end of this (30 or more Hz) is pretty reasonable for displaying
</I>&gt;&gt;&gt;&gt;<i> things in sync with the video. The low end, however, 4 Hz, is far too
</I>&gt;&gt;&gt;&gt;<i> slow
</I>&gt;&gt;&gt;&gt;<i> for most types of synchronization; everything feels laggy at this
</I>&gt;&gt;&gt;&gt;<i> frequency.
</I>&gt;&gt;&gt;&gt;<i> From my testing on a two year old MacBook Pro, Firefox is giving me
</I>&gt;&gt;&gt;&gt;<i> about 25
</I>&gt;&gt;&gt;&gt;<i> timeupdate events per second, while Safari and Chrome are giving me the
</I>&gt;&gt;&gt;&gt;<i> bare
</I>&gt;&gt;&gt;&gt;<i> minimum, of 4 timeupdate events per second.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> At 4 timeupdate events per second, it isn't all that useful. I can
</I>&gt;&gt;&gt;&gt;<i> replace
</I>&gt;&gt;&gt;&gt;<i> it with setInterval, at whatever rate I want, query the time, and get
</I>&gt;&gt;&gt;&gt;<i> the
</I>&gt;&gt;&gt;&gt;<i> synchronization I need, but that makes the timeupdate event seem to be
</I>&gt;&gt;&gt;&gt;<i> redundant. At 25 timeupdate events per second, it is reasonably useful,
</I>&gt;&gt;&gt;&gt;<i> and
</I>&gt;&gt;&gt;&gt;<i> can be used to synchronize various things to the video.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> So, I'm wondering if there's a purpose for the timeupdate event that I'm
</I>&gt;&gt;&gt;&gt;<i> missing. If it is intended for any sort of synchronization with the
</I>&gt;&gt;&gt;&gt;<i> video, I
</I>&gt;&gt;&gt;&gt;<i> think it should be improved to give better guarantees on the interval
</I>&gt;&gt;&gt;&gt;<i> between updates, or just dropped from the spec; it's not useful enough
</I>&gt;&gt;&gt;&gt;<i> in
</I>&gt;&gt;&gt;&gt;<i> its current form. To improve it, the maximum interval between updates
</I>&gt;&gt;&gt;&gt;<i> could
</I>&gt;&gt;&gt;&gt;<i> be reduced to about 40 ms, or perhaps the interval could be made
</I>&gt;&gt;&gt;&gt;<i> settable so
</I>&gt;&gt;&gt;&gt;<i> the author could control how often they want to get the event.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> -- Brian
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I believe it's a convenience over using setTimeout/setInterval + polling
</I>&gt;&gt;&gt;&gt;<i> to determine whether playback has progressed ie., for rendering your own
</I>&gt;&gt;&gt;&gt;<i> playback progress bar. &#160;I've also seen it been used as a signal to copy
</I>&gt;&gt;&gt;&gt;<i> frames into &lt;canvas&gt; on Firefox, however if timeupdate frequency != fps
</I>&gt;&gt;&gt;&gt;<i> of
</I>&gt;&gt;&gt;&gt;<i> video you either miss frames or paint too much.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I don't think timeupdate today is very useful for doing anything beyond
</I>&gt;&gt;&gt;&gt;<i> a
</I>&gt;&gt;&gt;&gt;<i> progress bar or other simple synchronized animations.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Right. That's what I figured the point is; I just wanted to check to make
</I>&gt;&gt;&gt;<i> sure I wasn't missing something.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> As implemented by Safari and Chrome (which is the minimum rate allowed by
</I>&gt;&gt;&gt;<i> the spec), it's not really useful for that purpose, as 4 updates per
</I>&gt;&gt;&gt;<i> second
</I>&gt;&gt;&gt;<i> makes any sort of synchronization feel jerky and laggy. If it were done
</I>&gt;&gt;&gt;<i> at
</I>&gt;&gt;&gt;<i> the frame rate of the video, or perhaps with a minimum of 25 frames per
</I>&gt;&gt;&gt;<i> second, it would be much more useful. Even at a minimum of 15 frames per
</I>&gt;&gt;&gt;<i> second, you would still be able to get some sorts of useful
</I>&gt;&gt;&gt;<i> synchronization,
</I>&gt;&gt;&gt;<i> though animations synchronized wouldn't feel as smooth as they could.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#160;Would something like &lt;video&gt; firing events for every frame rendered help
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> you out? &#160;This would help also fix the &lt;canvas&gt; over/under painting
</I>&gt;&gt;&gt;&gt;<i> issue
</I>&gt;&gt;&gt;&gt;<i> and improve synchronization.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Yes, this would be considerably better than what is currently specced.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> -- Brian
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'll see if we can do something for WebKit based browsers, because today
</I>&gt;&gt;<i> it
</I>&gt;&gt;<i> literally is hardcoded to 250ms for all ports.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://trac.webkit.org/browser/trunk/WebCore/html/HTMLMediaElement.cpp#L1254">http://trac.webkit.org/browser/trunk/WebCore/html/HTMLMediaElement.cpp#L1254</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Maybe we'll end up firing events based on frame updates for video, and
</I>&gt;&gt;<i> something arbitrary for audio (as it is today).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Brian, since Firefox is doing what you proposed -- can you think of any
</I>&gt;&gt;<i> other issues with its current implementation? &#160;What about for audio files?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Andrew
</I>&gt;<i>
</I>&gt;<i> We've considered firing it for each frame, but there is one problem. If
</I>&gt;<i> people expect that it fires once per frame they will probably write scripts
</I>&gt;<i> which do frame-based animations by moving things n pixels per frame or
</I>&gt;<i> similar. Some animations are just easier to do this way, so there's no
</I>&gt;<i> reason to think that people won't do it. This will break horribly if a
</I>&gt;<i> browser is ever forced to drop a frame, which is going to happen on slower
</I>&gt;<i> machines. In balance this may or may not be a risk worth taking.
</I>
When timeupdate was added, the stated goal was actually as a battery
saving feature for for example mobile devices. The idea was that the
implementation could scale back how often it fired the event in order
to save battery.

Now that we have implementation experience, is timeupdate fulfilling
this goal? If not, is it fulfilling any other goals making it worth
keeping?

/ Jonas

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="066276.html">[whatwg] What is the purpose of timeupdate?
</A></li>
	<LI>Next message: <A HREF="066297.html">[whatwg] What is the purpose of timeupdate?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66296">[ date ]</a>
              <a href="thread.html#66296">[ thread ]</a>
              <a href="subject.html#66296">[ subject ]</a>
              <a href="author.html#66296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
