<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Do we really need history.clearState()?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Do%20we%20really%20need%20history.clearState%28%29%3F&In-Reply-To=%3C9145FE00-C668-4008-9518-F7270F6933A8%40apple.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024080.html">
   <LINK REL="Next"  HREF="024089.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Do we really need history.clearState()?</H1>
<!--htdig_noindex-->
    <B>Brady Eidson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Do%20we%20really%20need%20history.clearState%28%29%3F&In-Reply-To=%3C9145FE00-C668-4008-9518-F7270F6933A8%40apple.com%3E"
       TITLE="[whatwg] Do we really need history.clearState()?">beidson at apple.com
       </A><BR>
    <I>Thu Nov 12 15:41:16 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="024080.html">[whatwg] Do we really need history.clearState()?
</A></li>
        <LI>Next message: <A HREF="024089.html">[whatwg] [WebWorkers] Advocation to provide the DOM API to the	workers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24081">[ date ]</a>
              <a href="thread.html#24081">[ thread ]</a>
              <a href="subject.html#24081">[ subject ]</a>
              <a href="author.html#24081">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>
On Nov 12, 2009, at 3:37 PM, Marius Gundersen wrote:

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Fri, Nov 13, 2009 at 8:16 AM, Brady Eidson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">beidson at apple.com</A>&gt; wrote:
</I>&gt;<i> I should've responded to this more directly:
</I>&gt;<i> 
</I>&gt;<i> On Nov 12, 2009, at 12:00 PM, Justin Lebar wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; I think the use case I proposed is much better served by something
</I>&gt;<i> &gt; like history.truncate(numBefore, numAfter), which would remove all but
</I>&gt;<i> &gt; the numBefore entries before the current entry and the numAfter
</I>&gt;<i> &gt; entries after the current entry.  We'd subject this to the same-origin
</I>&gt;<i> &gt; policy, of course, and stop removing entries in a direction as soon as
</I>&gt;<i> &gt; we encountered an entry from another origin.
</I>&gt;<i> 
</I>&gt;<i> The History object is - quite purposefully - very limited in scope and abilities.  Today, it gives the ability to navigate back and forward a number of steps.  Period.
</I>&gt;<i> 
</I>&gt;<i> The pushState() API adds a very limited way of adding new items programatically.  clearState() also adds the ability for a script to remove entries, but only ones that it added.  Period.
</I>&gt;<i> 
</I>&gt;<i> Same-origin policy be damned, I really don't like the idea of a script being able to remove items that it didn't add.
</I>&gt;<i> 
</I>&gt;<i> As I said in my previous reply, I think it might be useful to give a more fine-grained version of &quot;clearState()&quot;, but that could always be added later if there's demand.  And I still think it should be limited to affecting the string of the Document object's entries.
</I>&gt;<i> 
</I>&gt;<i> I don't think the history.truncate function proposed would be able to affect other Document object's entries. So for example, if the current history looks like this:
</I>&gt;<i> 
</I>&gt;<i> A1 A2 B1 *B2* B3 B4 C1 C2
</I>&gt;<i> 
</I>&gt;<i> Then you can only call history.truncate(1, 2). If you call it with a higher number in either parameter, then you will get a same origin exception. If the numbers are smaller though, it would still work. For example, calling history.truncate(0,1) would leave the following in your history:
</I>&gt;<i> 
</I>&gt;<i> A1 A2 B1 *B2* B4 C1 C2
</I>&gt;<i> 
</I>&gt;<i> I think this is the usecase clearState is designed for, but it's just not implemented in a very good way. This would not add a lot of extra work, and wouldn't complicate it for the user. truncate could also be called with no parameters, in which case it would clear the entire Document object's history, similarly to clearState.
</I>
You're confusing the &quot;same origin&quot; policy with this API's inherent &quot;Document object&quot; policy.

Document objects A, B, and C could all be from the same origin.  I'm asserting that even with that qualification, Document B should not be able to remove entries for Document A and Document C.

~Brady

&gt;<i> Marius Gundersen
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20091112/ec7e4d1f/attachment.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20091112/ec7e4d1f/attachment.htm</A>&gt;
</PRE>







































<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024080.html">[whatwg] Do we really need history.clearState()?
</A></li>
	<LI>Next message: <A HREF="024089.html">[whatwg] [WebWorkers] Advocation to provide the DOM API to the	workers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24081">[ date ]</a>
              <a href="thread.html#24081">[ thread ]</a>
              <a href="subject.html#24081">[ subject ]</a>
              <a href="author.html#24081">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
