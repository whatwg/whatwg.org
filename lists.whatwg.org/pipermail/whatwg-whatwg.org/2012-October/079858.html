<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Encoding: API
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Encoding%3A%20API&In-Reply-To=%3CCADnb78gOiYbw%3D1st%2Bq3ghy3CBMjJ6dOLjqn4u%3DOSBvEkacpHnA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="079855.html">
   <LINK REL="Next"  HREF="079863.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Encoding: API</H1>
<!--htdig_noindex-->
    <B>Anne van Kesteren</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Encoding%3A%20API&In-Reply-To=%3CCADnb78gOiYbw%3D1st%2Bq3ghy3CBMjJ6dOLjqn4u%3DOSBvEkacpHnA%40mail.gmail.com%3E"
       TITLE="[whatwg] Encoding: API">annevk at annevk.nl
       </A><BR>
    <I>Wed Oct 10 23:36:36 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="079855.html">[whatwg] Encoding: API
</A></li>
        <LI>Next message: <A HREF="079863.html">[whatwg] Encoding: API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79858">[ date ]</a>
              <a href="thread.html#79858">[ thread ]</a>
              <a href="subject.html#79858">[ subject ]</a>
              <a href="author.html#79858">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Thu, Oct 11, 2012 at 6:09 AM, Anne van Kesteren &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">annevk at annevk.nl</A>&gt; wrote:
&gt;<i> On Wed, Oct 10, 2012 at 7:28 PM, Joshua Bell &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jsbell at chromium.org</A>&gt; wrote:
</I>&gt;&gt;<i> Practically speaking, this would mean refactoring the combined spec so that
</I>&gt;&gt;<i> the current BOM handling is defined for parsing web content outside of the
</I>&gt;&gt;<i> API rather than requiring the API to hack around it.
</I>&gt;<i>
</I>&gt;<i> You would still get the hack because the API requires special
</I>&gt;<i> treatment for &quot;utf-16&quot;. Given that per Unicode &quot;utf-16le&quot; and
</I>&gt;<i> &quot;utf-16be&quot; outlaw the BOM, maybe a good solution would be a flag to
</I>&gt;<i> disable BOM handling as seen by the decode algorithm? So the decoder
</I>&gt;<i> gets a disableBOM flag that defaults to false? That would only require
</I>&gt;<i> a special case for BOM handling on top of what there is today, which
</I>&gt;<i> seems a fair bit cleaner.
</I>
The main problem with this is that you would get a leading BOM in
utf-8 if the content includes that. An unlikely scenario, but maybe we
want to take care of that. Another approach I thought about is that we
have an &quot;API decode&quot; algorithm, which is very similar to

<A HREF="http://encoding.spec.whatwg.org/#decode">http://encoding.spec.whatwg.org/#decode</A>

However, instead of setting the encoding, it checks if the leading
bytes match, and if the encoding matches, and only then does it set
the offset. So the BOM would be skipped for utf-8/utf-16 if it was a
valid BOM, but a BOM invalid for the given encoding would never switch
the encoding.

The behavior of the normal decode algorithm does not need to be
exposed through the API I think, unless a use case comes up at some
point.


-- 
<A HREF="http://annevankesteren.nl/">http://annevankesteren.nl/</A>

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="079855.html">[whatwg] Encoding: API
</A></li>
	<LI>Next message: <A HREF="079863.html">[whatwg] Encoding: API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79858">[ date ]</a>
              <a href="thread.html#79858">[ thread ]</a>
              <a href="subject.html#79858">[ subject ]</a>
              <a href="author.html#79858">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
