<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Cryptographically strong random numbers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Cryptographically%20strong%20random%20numbers&In-Reply-To=%3CAANLkTinVBNkYu34j%2Brg_5A6QYJ7dydBtsTtzHw5y1BBt%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="072763.html">
   <LINK REL="Next"  HREF="072815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Cryptographically strong random numbers</H1>
<!--htdig_noindex-->
    <B>Mark S. Miller</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Cryptographically%20strong%20random%20numbers&In-Reply-To=%3CAANLkTinVBNkYu34j%2Brg_5A6QYJ7dydBtsTtzHw5y1BBt%40mail.gmail.com%3E"
       TITLE="[whatwg] Cryptographically strong random numbers">erights at google.com
       </A><BR>
    <I>Mon Feb 14 12:15:25 PST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="072763.html">[whatwg] Cryptographically strong random numbers
</A></li>
        <LI>Next message: <A HREF="072815.html">[whatwg] Cryptographically strong random numbers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#72745">[ date ]</a>
              <a href="thread.html#72745">[ thread ]</a>
              <a href="subject.html#72745">[ subject ]</a>
              <a href="author.html#72745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Everyone,

Before posting on this thread, please subscribe at &lt;
<A HREF="https://mail.mozilla.org/listinfo/es-discuss">https://mail.mozilla.org/listinfo/es-discuss</A>&gt; to es-discuss. The es-discuss
list drops posts by non-subscribers, and thus seems to have dropped posts by
Adam Barth and Shabsi Walfish that were sent after es-discuss was added to
the thread. Adam and Shabsi, could you please subscribe and re-post? Thanks.

As has already been discussed, since these issues are general EcmaScript
issues, applying not just in the browser but in many places JavaScript is
run (e.g., nodejs), I suggest that this be the last message on this thread
cross-posted to whatwg. Unless someone has a reason for retaining whatwg in
the addressee list, I will drop it from all my further postings on this
thread.


On Mon, Feb 14, 2011 at 12:01 PM, Shabsi Walfish &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">shabsi at google.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mon, Feb 14, 2011 at 11:31 AM, Adam Barth &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">w3c at adambarth.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Mon, Feb 14, 2011 at 8:31 AM, Mark S. Miller &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">erights at google.com</A>&gt;wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Mon, Feb 14, 2011 at 2:47 AM, Adam Barth &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">w3c at adambarth.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> That's a pretty long time horizon.  You're going to start discussing
</I>&gt;&gt;&gt;&gt;<i> it in 2-4 months?  That seems a bit overwrought for what amounts to
</I>&gt;&gt;&gt;&gt;<i> four lines of code.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The committee meets once every two months. Between meetings, we discuss
</I>&gt;&gt;&gt;<i> things on es-discuss, so please do.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What are the four lines of code?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://trac.webkit.org/browser/trunk/Source/WebCore/page/Crypto.cpp">http://trac.webkit.org/browser/trunk/Source/WebCore/page/Crypto.cpp</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Feb 14, 2011 at 8:40 AM, Boris Zbarsky &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">bzbarsky at mit.edu</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  On 2/14/11 11:31 AM, Mark S. Miller wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  On Mon, Feb 14, 2011 at 2:47 AM, Adam Barth &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">w3c at adambarth.com</A>
</I>&gt;&gt;&gt;&gt;<i> &lt;mailto:<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">w3c at adambarth.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>    That's a pretty long time horizon.  You're going to start discussing
</I>&gt;&gt;&gt;&gt;<i>    it in 2-4 months?  That seems a bit overwrought for what amounts to
</I>&gt;&gt;&gt;&gt;<i>    four lines of code.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> For what it's worth, it's a lot more than 4 lines of code in Gecko,
</I>&gt;&gt;&gt;<i> because we don't have an existing source of strong randomness in
</I>&gt;&gt;&gt;<i> Spidermonkey.  It'd be about that much code in the DOM, where we could pass
</I>&gt;&gt;&gt;<i> the buck to NSS, but for Spidermonkey it would take a good bit more work.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Similarly, the WebKit implementation just passes the buck to the WTF
</I>&gt;&gt;<i> layer, which already knows how to fill a void* with n cryptographically
</I>&gt;&gt;<i> random bytes.  The implementation will be similarly trivial in most
</I>&gt;&gt;<i> applications that link with OpenSSL or NSS or that run on Mac, Linux, or
</I>&gt;&gt;<i> Windows.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Feb 14, 2011 at 10:05 AM, Brendan Eich &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">brendan at mozilla.org</A>&gt;
</I>&gt;&gt;<i>  wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Feb 14, 2011, at 8:40 AM, Boris Zbarsky wrote:
</I>&gt;&gt;&gt;<i> &gt; On 2/14/11 11:31 AM, Mark S. Miller wrote:
</I>&gt;&gt;&gt;<i> &gt;&gt; On Mon, Feb 14, 2011 at 2:47 AM, Adam Barth &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">w3c at adambarth.com</A>
</I>&gt;&gt;&gt;<i>  &gt;&gt; &lt;mailto:<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">w3c at adambarth.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;&gt;<i> &gt;&gt;    That's a pretty long time horizon.  You're going to start
</I>&gt;&gt;&gt;<i> discussing
</I>&gt;&gt;&gt;<i> &gt;&gt;    it in 2-4 months?  That seems a bit overwrought for what amounts to
</I>&gt;&gt;&gt;<i> &gt;&gt;    four lines of code.
</I>&gt;&gt;&gt;<i> &gt;
</I>&gt;&gt;&gt;<i> &gt; For what it's worth, it's a lot more than 4 lines of code in Gecko,
</I>&gt;&gt;&gt;<i> because we don't have an existing source of strong randomness in
</I>&gt;&gt;&gt;<i> Spidermonkey.  It'd be about that much code in the DOM, where we could pass
</I>&gt;&gt;&gt;<i> the buck to NSS, but for Spidermonkey it would take a good bit more work.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Not really. We use callback-style APIs to delegate such chores as l10n to
</I>&gt;&gt;&gt;<i> the embedding, and the same can be done for randomness-hunting. It's just
</I>&gt;&gt;&gt;<i> interfacing, or buck-passing -- but I'm still wondering what magical four
</I>&gt;&gt;&gt;<i> lines of code provide useful lower bounds on bits of entropy in WebKit. Is
</I>&gt;&gt;&gt;<i> this just non-interoperable delegation to the host OS?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What's non-interoperable about filling an ArrayBuffer with random bytes?
</I>&gt;&gt;<i>  I'm not sure I understand your question.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Adam, I like moving fast (but beware, that's how JS and the DOM were
</I>&gt;&gt;&gt;<i> created), but we need a cross-browser spec of some kind, even if we all add
</I>&gt;&gt;&gt;<i> crypto.getRandomValues quickly. The original y2k-buggy,
</I>&gt;&gt;&gt;<i> cloned-from-java.util.Date JS Date object of 1995 required a lot of work for
</I>&gt;&gt;&gt;<i> ES1 to remove OS dependencies that made for interop hell.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In this case, the API is several order of magnitude simpler than Date.
</I>&gt;&gt;<i>  The choices to make roughly boil down to the name of the function, which
</I>&gt;&gt;<i> types to support, and what sorts of exceptions to throw in which error
</I>&gt;&gt;<i> cases.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> For a core language standard, we would want some kind of minimum quality
</I>&gt;&gt;&gt;<i> guarantee on the randomness.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm not sure that's possible without either allowing the API to block for
</I>&gt;&gt;<i> arbitrary periods of time or to fail.  Assuming we want a non-blocking,
</I>&gt;&gt;<i> non-failing API, we can't make any guarantees about the quality of the
</I>&gt;&gt;<i> randomness.  In that sense, crypto.getRandomValues is &quot;best effort.&quot;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I don't think its necessary to use &quot;best effort&quot; if you want something that
</I>&gt;<i> is effectively non-blocking... what you need to do is preemptively gather a
</I>&gt;<i> _small_ amount of real entropy on startup (say, 160 bits worth) and then use
</I>&gt;<i> a cryptographic PRNG to generate whatever you need based on that seed... the
</I>&gt;<i> PRNG would be pretty darn fast, so you wouldn't have to block forever after.
</I>&gt;<i> Only the initial seeding needs to be done via a call to the OS that might
</I>&gt;<i> block, and if that can be done asynchronously at startup time odds are good
</I>&gt;<i> it will be a non-issue on most all platforms. Whatever you do, my advice is
</I>&gt;<i> to combine entropy in the seed pool via XOR (assuming you do any entropy
</I>&gt;<i> combining), since various combinations of append/prepend/etc. always lead to
</I>&gt;<i> problems.
</I>&gt;<i>
</I>&gt;<i> Shabsi
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Obviously, a blocking API is in appropriate for the browser setting.
</I>&gt;&gt;<i>  There's certainly a place for failing randomness sources (e.g., analogous
</I>&gt;&gt;<i> to /dev/random versus /dev/urandom, although /dev/random is blocking rather
</I>&gt;&gt;<i> than failing).  The need just isn't as dire, in my view.  I'd certainly be
</I>&gt;&gt;<i> happy if ECMAScript came along in six months or a year with a nice
</I>&gt;&gt;<i> cryptographic library, including a variety of random generators (e.g.,
</I>&gt;&gt;<i> perhaps seedable, failing, and with algorithmic agility).  However, I'm
</I>&gt;&gt;<i> disinclined to wait on the basic best-effort PRNG for that to happen.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Quick thought on the name: to avoid vagueness and the &quot;why not wider int
</I>&gt;&gt;&gt;<i> or even float element type&quot; questions that have already come up, call the
</I>&gt;&gt;&gt;<i> method getRandomBytes.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I added support for all the integer ArrayBuffer types, so getRandomBytes
</I>&gt;&gt;<i> isn't a particularly accurate name.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Adam
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

-- 
    Cheers,
    --MarkM

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="072763.html">[whatwg] Cryptographically strong random numbers
</A></li>
	<LI>Next message: <A HREF="072815.html">[whatwg] Cryptographically strong random numbers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#72745">[ date ]</a>
              <a href="thread.html#72745">[ thread ]</a>
              <a href="subject.html#72745">[ subject ]</a>
              <a href="author.html#72745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
