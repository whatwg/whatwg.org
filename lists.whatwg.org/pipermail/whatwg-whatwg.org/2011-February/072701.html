<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Workers feedback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Workers%20feedback&In-Reply-To=%3CAANLkTimLG_7dtdcnViZgWd%2BZ_LGOAOPEjMQ9dDT0jF81%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="072515.html">
   <LINK REL="Next"  HREF="072702.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Workers feedback</H1>
<!--htdig_noindex-->
    <B>Gregg Tavares (wrk)</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Workers%20feedback&In-Reply-To=%3CAANLkTimLG_7dtdcnViZgWd%2BZ_LGOAOPEjMQ9dDT0jF81%40mail.gmail.com%3E"
       TITLE="[whatwg] Workers feedback">gman at google.com
       </A><BR>
    <I>Fri Feb 11 17:37:28 PST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="072515.html">[whatwg] Workers feedback
</A></li>
        <LI>Next message: <A HREF="072702.html">[whatwg] Workers feedback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#72701">[ date ]</a>
              <a href="thread.html#72701">[ thread ]</a>
              <a href="subject.html#72701">[ subject ]</a>
              <a href="author.html#72701">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Fri, Feb 4, 2011 at 3:43 PM, Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ian at hixie.ch</A>&gt; wrote:

&gt;<i> On Sat, 16 Oct 2010, Samuel Ytterbrink wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; *What is the problem you are trying to solve?*
</I>&gt;<i> &gt; To create sophisticated single file webpages.
</I>&gt;<i>
</I>&gt;<i> That's maybe a bit vaguer than I was hoping for when asking the question.
</I>&gt;<i> :-)
</I>&gt;<i>
</I>&gt;<i> Why does it have to be a single file? Would multipart MIME be acceptable?
</I>&gt;<i>
</I>&gt;<i> A single file is a solution, not a problem. What is the problem?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; [...] trying to build a more optimal standalone DAISY player (would be
</I>&gt;<i> &gt; nice if i could rewrite it with web workers).
</I>&gt;<i>
</I>&gt;<i> Now that's a problem. :-)
</I>&gt;<i>
</I>&gt;<i> It seems like what you need is a package mechanism, not necessarily a way
</I>&gt;<i> to run workers without an external script.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, 15 Oct 2010, Jonas Sicking wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Allowing both blob URLs and data URLs for workers sounds like a great
</I>&gt;<i> &gt; idea.
</I>&gt;<i>
</I>&gt;<i> I expect we'll add these in due course, probably around the same time we
</I>&gt;<i> add cross-origin workers. (We didn't add them before because exactly how
</I>&gt;<i> we do them depends on how we determine origins.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sat, 16 Oct 2010, Samuel Ytterbrink wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; But then i got another problem, why is not
</I>&gt;<i> &gt; &quot;<A HREF="file:///some_directory_where_the_html_are/">file:///some_directory_where_the_html_are/</A>&quot; not the same domain as
</I>&gt;<i> &gt;
</I>&gt;<i> &quot;<A HREF="file:///some_directory_where_the_html_are/child_directory_with_ajax_stuff/">file:///some_directory_where_the_html_are/child_directory_with_ajax_stuff/</A>&quot;.
</I>&gt;<i> &gt; I understand if it was not okay to go closer to root when ajax,
</I>&gt;<i> &gt; &quot;<A HREF="file:///where_all_secrete_stuff_are/">file:///where_all_secrete_stuff_are/</A>&quot; or &quot;/../../&quot;.
</I>&gt;<i>
</I>&gt;<i> That's not a Web problem. I recommend contacting your browser vendor about
</I>&gt;<i> it. (It's probably security-related.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, 30 Dec 2010, Glenn Maynard wrote:
</I>&gt;<i> &gt; On Thu, Dec 30, 2010 at 7:11 PM, Ian Hickson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ian at hixie.ch</A>&gt; wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Unfortunately we can't really require immediate failure, since there'd
</I>&gt;<i> &gt; &gt; be no way to test it or to prove that it wasn't implemented -- a user
</I>&gt;<i> &gt; &gt; agent could always just say &quot;oh, it's just that we take a long time to
</I>&gt;<i> &gt; &gt; launch the worker sometimes&quot;. (Performance can be another hardware
</I>&gt;<i> &gt; &gt; limitation.)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Preferably, if a Worker is successfully created, the worker thread
</I>&gt;<i> &gt; starting must not block on user code taking certain actions, like
</I>&gt;<i> &gt; closing other threads.
</I>&gt;<i>
</I>&gt;<i> How can you tell the difference between &quot;the thread takes 3 seconds to
</I>&gt;<i> start&quot; and &quot;the thread waits for the user to close a thread&quot;, if it takes
</I>&gt;<i> 3 seconds for the user to close a thread?
</I>&gt;<i>
</I>&gt;<i> My point is from a black-box perspective, one can never firmly say that
</I>&gt;<i> it's not just the browser being slow to start the thread. And we can't
</I>&gt;<i> disallow the browser from being slow.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; That doesn't mean it needs to start immediately, but if I start a thread
</I>&gt;<i> &gt; and then do nothing, it's very bad for the thread to sit in limbo
</I>&gt;<i> &gt; forever because the browser expects me to take some action, without
</I>&gt;<i> &gt; anything to tell me so.
</I>&gt;<i>
</I>&gt;<i> I don't disagree that it's bad. Hopefully browser vendors will agree and
</I>&gt;<i> this problem will go away.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; If queuing is really necessary, please at least give us a way to query
</I>&gt;<i> &gt; whether a worker is queued.
</I>&gt;<i>
</I>&gt;<i> It's queued if you asked it to start and it hasn't yet started.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, 31 Dec 2010, Aryeh Gregor wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've long thought that HTML5 should specify hardware limitations more
</I>&gt;<i> &gt; precisely.
</I>&gt;<i>
</I>&gt;<i> We can't, because it depends on the hardware. For example, we can't say
</I>&gt;<i> &quot;you must be able to allocate a 1GB string&quot; because the system might only
</I>&gt;<i> have 500MB of storage.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Clearly it can't cover all cases, and some sort of general escape clause
</I>&gt;<i> &gt; will always be needed -- but in cases where limits are likely to be low
</I>&gt;<i> &gt; enough that authors might run into them, the limit should really be
</I>&gt;<i> &gt; standardized.
</I>&gt;<i>
</I>&gt;<i> It's not much of a standardised limit if there's still an escape clause.
</I>&gt;<i>
</I>&gt;<i> I'm happy to put recommendations in if we have data showing certain
</I>&gt;<i> specific limits are needed for interop with real content.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; Unfortunately we can't really require immediate failure, since there'd
</I>&gt;<i> &gt; &gt; be no way to test it or to prove that it wasn't implemented -- a user
</I>&gt;<i> &gt; &gt; agent could always just say &quot;oh, it's just that we take a long time to
</I>&gt;<i> &gt; &gt; launch the worker sometimes&quot;. (Performance can be another hardware
</I>&gt;<i> &gt; &gt; limitation.)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In principle this is so, but in practice it's not.  In real life, you
</I>&gt;<i> &gt; can easily tell an algorithm that runs the first sixteen workers and
</I>&gt;<i> &gt; then stalls any further ones until one of the early ones exit, from an
</I>&gt;<i> &gt; algorithm that just takes a while to launch workers sometimes.  I think
</I>&gt;<i> &gt; it would be entirely reasonable and would help interoperability in
</I>&gt;<i> &gt; practice if HTML5 were to require that the UA must run all pending
</I>&gt;<i> &gt; workers in some manner that doesn't allow starvation, and that if it
</I>&gt;<i> &gt; can't do so, it must return an error rather than accepting a new worker.
</I>&gt;<i> &gt; Failure to return an error should mean that the worker can be run soon,
</I>&gt;<i> &gt; in a predictable timeframe, not maybe at some indefinite point in the
</I>&gt;<i> &gt; future.
</I>&gt;<i>
</I>&gt;<i> All workers should run soon, not maybe in the future. Not running a
</I>&gt;<i> worker should be an unusual circumstance. Errors that occur in unusual
</I>&gt;<i> circumstances aren't errors that authors will check for.
</I>&gt;<i>
</I>&gt;<i> This dicussion comes from Chrome having a very small limit currently. It
</I>&gt;<i> is my understanding that this limit is temporary and not representative
</I>&gt;<i> of what the API will be like once widely implemented.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, 7 Jan 2011, Berend-Jan Wever wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I read that giving WebWorkers access to the DOM is apparently a bad
</I>&gt;<i> &gt; idea: <A HREF="http://forums.whatwg.org/viewtopic.php?t=4437">http://forums.whatwg.org/viewtopic.php?t=4437</A> However, the page
</I>&gt;<i> &gt; does not mention why. I'd like to know :)
</I>&gt;<i>
</I>&gt;<i> It's basically due to limitations in how browsers are built. The DOM
</I>&gt;<i> implementations have shared global state that isn't thread-safe.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, 7 Jan 2011, Berend-Jan Wever wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1) To give WebWorkers access to the DOM API so they can create their own
</I>&gt;<i> &gt; elements such as img, canvas, etc...?
</I>&gt;<i>
</I>&gt;<i> It's the API itself that isn't thread-safe, unfortunately.
</I>&gt;<i>
</I>
I didn't see the original thread but how is a WebWorker any different from
another webpage? Those run just fine in other threads and use the DOM API.

It seems like treating a WebWorker like another webpage without a display
would open WebWorkers to far more work. They could do GPGPU work using
WebGL. They could image process using canvas.  They could build DOM elements
using standard DOM APIs and common libraries then use innerHTML to get a
string to pass back to the calling page. It means as new stuff as added to
the DOM or new objects they don't have to be special cased for WebWorkers.





&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; 2) To create a way to communicate media data between web workers and
</I>&gt;<i> &gt; pages without serialization, so they can pass img, video, and/or audio
</I>&gt;<i> &gt; with high throughput?
</I>&gt;<i>
</I>&gt;<i> You can't currently do anything with audio or video in a worker. Image
</I>&gt;<i> data from canvas can be passed along, though. How fast the throughput is
</I>&gt;<i> depends on the browser.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; 3) Introduce a set of &quot;shared&quot; objects, which are re-entrancy save
</I>&gt;<i> &gt; versions of a very limited sub-set of classes in the DOM API.
</I>&gt;<i>
</I>&gt;<i> Not sure what this means.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, 13 Jan 2011, Jorge wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; But I think that the workers desperately need a mechanism that permitted
</I>&gt;<i> &gt; to pass objects *quickly*, and *quickly* most likely means by reference
</I>&gt;<i> &gt; not by copy.
</I>&gt;<i>
</I>&gt;<i> The spec doesn't preclude browsers from implementing copy-on-write
</I>&gt;<i> semantics, which essentially gives you by-reference. (We can't do actual
</I>&gt;<i> by-reference without freezing values on both sides somehow, since
</I>&gt;<i> otherwise you'd have race conditions.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, 13 Jan 2011, Glenn Maynard wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Browsers should be allowed to permit 0ms &quot;return, run events then run
</I>&gt;<i> &gt; this code immediately&quot; timers.  It takes some heuristics to do this
</I>&gt;<i> &gt; safely, to prevent code which (usually accidentally) assumes a minimum
</I>&gt;<i> &gt; delay from busy looping, but browsers should be free to attempt such a
</I>&gt;<i> &gt; heuristic, not required by spec to clamp to 4ms.
</I>&gt;<i>
</I>&gt;<i> The reason the spec requires a 4ms clamp is that if you implement a 0ms
</I>&gt;<i> clamp, pages break. (Note: the spec only clamps if the setTimeout() is
</I>&gt;<i> called from another setTimeout().)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Non-looping 0ms timers are common, to run code when the current call
</I>&gt;<i> &gt; finishes.
</I>&gt;<i>
</I>&gt;<i> Yeah, spec allows those fine.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Timeouts in workers shouldn't require this, either, since there's no
</I>&gt;<i> &gt; legacy code to worry about.
</I>&gt;<i>
</I>&gt;<i> Keeping the timers the same everywhere is good for sanity.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, 13 Jan 2011, Boris Zbarsky wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; timeouts in workers are... weird as currently specced.  Not only do they
</I>&gt;<i> &gt; have the 4ms floor for nested timeouts, but they're not specced in terms
</I>&gt;<i> &gt; of wall-clock time but rather in terms of time during which the worker
</I>&gt;<i> &gt; is not suspended.
</I>&gt;<i>
</I>&gt;<i> The idea being that if you have scheduled two timers to fire two seconds
</I>&gt;<i> apart, and the user happens to leave the page and return, you don't want
</I>&gt;<i> them all to fire at once.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Ian Hickson               U+1047E                )\._.,--....,'``.    fL
</I>&gt;<i> <A HREF="http://ln.hixie.ch/">http://ln.hixie.ch/</A>       U+263A                /,   _.. \   _\  ;`._ ,.
</I>&gt;<i> Things that are impossible just take longer.   `._.-(,_..'--(,_..'`-.;.'
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="072515.html">[whatwg] Workers feedback
</A></li>
	<LI>Next message: <A HREF="072702.html">[whatwg] Workers feedback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#72701">[ date ]</a>
              <a href="thread.html#72701">[ thread ]</a>
              <a href="subject.html#72701">[ subject ]</a>
              <a href="author.html#72701">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
