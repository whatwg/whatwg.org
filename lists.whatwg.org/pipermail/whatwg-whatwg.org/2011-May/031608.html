<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] &lt;video&gt; ... &lt;script&gt; race condition
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20%3Cvideo%3E%20...%20%3Cscript%3E%20race%20condition&In-Reply-To=%3Cop.vveyilzusr6mfa%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="073876.html">
   <LINK REL="Next"  HREF="073883.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] &lt;video&gt; ... &lt;script&gt; race condition</H1>
<!--htdig_noindex-->
    <B>Philip J&#228;genstedt</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20%3Cvideo%3E%20...%20%3Cscript%3E%20race%20condition&In-Reply-To=%3Cop.vveyilzusr6mfa%40localhost.localdomain%3E"
       TITLE="[whatwg] &lt;video&gt; ... &lt;script&gt; race condition">philipj at opera.com
       </A><BR>
    <I>Fri May 13 02:40:59 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="073876.html">[whatwg] Processing the zoom level - MS extensions to	window.screen
</A></li>
        <LI>Next message: <A HREF="073883.html">[whatwg] &lt;video&gt; ... &lt;script&gt; race condition
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31608">[ date ]</a>
              <a href="thread.html#31608">[ thread ]</a>
              <a href="subject.html#31608">[ subject ]</a>
              <a href="author.html#31608">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Problem:

&lt;video src=&quot;video.webm&quot;&gt;&lt;/video&gt;
...
&lt;script&gt;
document.querySelector('video').oncanplay = function() {
   /* will it run? */
};
&lt;/script&gt;

In the above the canplay event can be replaced with many others, like  
loadedmetadata and loadeddata. Whether or not the event handler has been  
registered by the time the event is fired depends on how fast decoding is,  
how fast the network is and how much &quot;...&quot; there is.

This is not new information, Simon Pieters wrote extensively about the  
problem in  
<A HREF="http://dev.opera.com/articles/view/consistent-event-firing-with-html5-video/">http://dev.opera.com/articles/view/consistent-event-firing-with-html5-video/</A>

The reason I write now is that in one of our projects this exact race  
condition happens to be hit for <A HREF="http://html5demos.com/video">http://html5demos.com/video</A> which is where  
the above code snippet comes from.

Does anyone have ideas about how to deal with this problem, which *is*  
going to appear on many real-world pages? Is there any browser that has  
already done something to mitigate the problem?

-- 
Philip J&#228;genstedt
Core Developer
Opera Software
</PRE>







































































<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="073876.html">[whatwg] Processing the zoom level - MS extensions to	window.screen
</A></li>
	<LI>Next message: <A HREF="073883.html">[whatwg] &lt;video&gt; ... &lt;script&gt; race condition
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31608">[ date ]</a>
              <a href="thread.html#31608">[ thread ]</a>
              <a href="subject.html#31608">[ subject ]</a>
              <a href="author.html#31608">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
