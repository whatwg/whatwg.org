<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] a rel=attachment
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20a%20rel%3Dattachment&In-Reply-To=%3CCA%2Bc2ei917jnPuuov9wNCgqtATHjG%2BZoeeEL8_-0FpFjx8J-03w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="074781.html">
   <LINK REL="Next"  HREF="074789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] a rel=attachment</H1>
<!--htdig_noindex-->
    <B>Jonas Sicking</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20a%20rel%3Dattachment&In-Reply-To=%3CCA%2Bc2ei917jnPuuov9wNCgqtATHjG%2BZoeeEL8_-0FpFjx8J-03w%40mail.gmail.com%3E"
       TITLE="[whatwg] a rel=attachment">jonas at sicking.cc
       </A><BR>
    <I>Sun Jul 17 20:40:56 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="074781.html">[whatwg] a rel=attachment
</A></li>
        <LI>Next message: <A HREF="074789.html">[whatwg] a rel=attachment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74788">[ date ]</a>
              <a href="thread.html#74788">[ thread ]</a>
              <a href="subject.html#74788">[ subject ]</a>
              <a href="author.html#74788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Sun, Jul 17, 2011 at 1:05 PM, Adam Barth &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">w3c at adambarth.com</A>&gt; wrote:
&gt;<i> 2011/7/15 Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;:
</I>&gt;&gt;<i> We've discussed a different solution to the same problem at mozilla.
</I>&gt;&gt;<i> The solution we discussed was allowing FileSaver to in addition to
</I>&gt;&gt;<i> taking a blob argument, allow it to take a url argument.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One concern which was brought up was the ability to cause the user to
</I>&gt;&gt;<i> download a file from a third party site. I.e. this would allow
</I>&gt;&gt;<i> evil.com to trick the user into downloading an email from the users
</I>&gt;&gt;<i> webmail, or download a page from their bank which contains all their
</I>&gt;&gt;<i> banking information. It might be easier to then trick the user into
</I>&gt;&gt;<i> re-uploading the saved file to evil.com since from a user's
</I>&gt;&gt;<i> perspective, it looked like the file came from evil.com
</I>&gt;<i>
</I>&gt;<i> It seems like the solution to that problem is to be clear about where
</I>&gt;<i> the download is coming from. &#160;Being clear about where downloads come
</I>&gt;<i> from is important in many scenarios, beyond just this setting.
</I>
Sure, I'm just not sure that we'll ever be able to get very high
percentage of people actually understanding and making sure they make
a informed decision based on this.

&gt;&gt;<i> Another possible attack goes something like:
</I>&gt;&gt;<i> 1. evil.com tricks the user into downloading sensitive data from bank.com
</I>&gt;&gt;<i> 2. evil.com then asks the user to download a html from evil.com and
</I>&gt;&gt;<i> open the newly downloaded file
</I>&gt;<i>
</I>&gt;<i> Most browsers treat downloaded HTML files as &quot;dangerous downloads,&quot;
</I>&gt;<i> which means they get similar UI treatment to executable downloads.
</I>&gt;<i> For example, on Mac OS X, HTML downloads get the same &quot;you're about to
</I>&gt;<i> open a dangerous file&quot; warning from the operating system as executable
</I>&gt;<i> downloads. &#160;If the attacker can convince the the user to click past
</I>&gt;<i> these dialogs, the attacker can convince the user to run arbitrary
</I>&gt;<i> code anyway, so there's nothing we can do to provide security in this
</I>&gt;<i> setting.
</I>&gt;<i>
</I>&gt;&gt;<i> 3. the html file contains script which reads the contents from the
</I>&gt;&gt;<i> file downloaded from bank.com and sends it back to evil.com
</I>&gt;<i>
</I>&gt;<i> This sounds like a security vulnerability in the browser. &#160;A better
</I>&gt;<i> security posture is to not allow downloaded content from one web site
</I>&gt;<i> read downloaded content from another web site, regardless of how the
</I>&gt;<i> content was downloaded. &#160;For example, that's the current behavior of
</I>&gt;<i> Chrome and Internet Explorer. &#160;Safari takes a different approach and
</I>&gt;<i> allows downloaded HTML content to access any file and any web site,
</I>&gt;<i> which means the attacker doesn't need to go through the elaborate
</I>&gt;<i> process you've outlined. &#160;Merely performing step (3) is sufficient to
</I>&gt;<i> steal all the user's banking details today, which tells me that either
</I>&gt;<i> Safari is already vulnerable to this attack without this new feature
</I>&gt;<i> or that this threat isn't actually much of a risk.
</I>
That wasn't the security model IE used last I checked. At least at
that time it would refuse to run any scripts while displaying a
warning to the user telling them that they needed to opt-in to scripts
on the page. Opting in was a simple matter of pressing a &quot;yes button&quot;
though and so is something that a decent number of people likely will
do. However it's possible that IE has changed since then.

I just tried and this doesn't appear to be what chrome does. I'd love
to hear the details about chrome's strategy.

&gt;<i> (I know that Firefox has a policy that's somewhere in between the
</I>&gt;<i> strong local-file security policy used by Chrome and the weak policy
</I>&gt;<i> used by Safari, but Firefox's policy is too complex for me to
</I>&gt;<i> understand. &#160;I know that protection of downloaded files was one of the
</I>&gt;<i> considerations that fed into the design of Firefox's policy, but I'll
</I>&gt;<i> leave it to others to common on whether it provided effective
</I>&gt;<i> protection in this scenario.)
</I>
Firefox *basically* lets the page read the contents of the folder that
the html file is in, as well as any sub folders. There are some tricky
situations where more than that is allowed, but that's generally not
relevant to this discussion.

However since Firefox allows the page to read the contents of the same
folder, this means that the script would be allowed to read files
downloaded from other sites.

&gt;&gt;<i> Step 1 and 2 require the user to answer &quot;yes&quot; to a dialog displayed by
</I>&gt;&gt;<i> the browser. However it's well known that users very often hit
</I>&gt;&gt;<i> whichever button they suspect will make the dialog go away, rather
</I>&gt;&gt;<i> than actually read the contents of the dialog.
</I>&gt;<i>
</I>&gt;<i> In that model, the attacker can just run arbitrary code. &#160;It's not
</I>&gt;<i> possible to provide security in that model, regardless of this
</I>&gt;<i> feature.
</I>
I'm not quite sure what you mean here?

&gt;&gt;<i> One very simple remedy to this would be to require CORS opt-in for
</I>&gt;&gt;<i> cross-site downloads. For same-site downloads no special opt-in would
</I>&gt;&gt;<i> be required of course.
</I>&gt;<i>
</I>&gt;<i> I'm not convinced there's a problem to solve here. &#160;Wiring CORS into
</I>&gt;<i> the download system, by contrast, add a significant amount of
</I>&gt;<i> complexity to the implementation, which is costly.
</I>
The fact that it's a bit more work for the browser implementation
seems like a good tradeoff if it means less data stolen from users. So
this isn't an argument that carries much weight for me.

&gt;&gt;<i> It's also possible that it would be ok to do this without any opt-ins
</I>&gt;&gt;<i> since there are a good number of actions that the user has to take in
</I>&gt;&gt;<i> all these scenarios. Definitely something that I'd be ok with
</I>&gt;&gt;<i> discussing with our security team.
</I>&gt;<i>
</I>&gt;<i> I'm happy to talk it over with your security folks if they disagree
</I>&gt;<i> with the contents of this email.
</I>
Sure, we can schedule a security review of this feature if this is a
route that we really want to go. I'll contact you off this list.

/ Jonas

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="074781.html">[whatwg] a rel=attachment
</A></li>
	<LI>Next message: <A HREF="074789.html">[whatwg] a rel=attachment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74788">[ date ]</a>
              <a href="thread.html#74788">[ thread ]</a>
              <a href="subject.html#74788">[ subject ]</a>
              <a href="author.html#74788">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
