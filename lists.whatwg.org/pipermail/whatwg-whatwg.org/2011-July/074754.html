<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] a rel=attachment
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20a%20rel%3Dattachment&In-Reply-To=%3CCA%2Bc2ei_8m3iNAR9DjHzapaKX5J0bHv-yH0OGhgbGXk2QNvP-6w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="074752.html">
   <LINK REL="Next"  HREF="074762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] a rel=attachment</H1>
<!--htdig_noindex-->
    <B>Jonas Sicking</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20a%20rel%3Dattachment&In-Reply-To=%3CCA%2Bc2ei_8m3iNAR9DjHzapaKX5J0bHv-yH0OGhgbGXk2QNvP-6w%40mail.gmail.com%3E"
       TITLE="[whatwg] a rel=attachment">jonas at sicking.cc
       </A><BR>
    <I>Fri Jul 15 13:09:17 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="074752.html">[whatwg] a rel=attachment
</A></li>
        <LI>Next message: <A HREF="074762.html">[whatwg] a rel=attachment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74754">[ date ]</a>
              <a href="thread.html#74754">[ thread ]</a>
              <a href="subject.html#74754">[ subject ]</a>
              <a href="author.html#74754">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>2011/7/15 Ian Fette (&#12452;&#12450;&#12531;&#12501;&#12455;&#12483;&#12486;&#12451;) &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ifette at google.com</A>&gt;:
&gt;<i> 2011/7/15 Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;
</I>&gt;<i>
</I>&gt;&gt;<i> 2011/7/14 Ian Fette (&#12452;&#12450;&#12531;&#12501;&#12455;&#12483;&#12486;&#12451;) &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ifette at google.com</A>&gt;:
</I>&gt;&gt;<i> &gt; Many websites wish to offer a file for download, even though it could
</I>&gt;&gt;<i> &gt; potentially be viewed inline (take images, PDFs, or word documents as an
</I>&gt;&gt;<i> &gt; example). Traditionally the only way to achieve this is to set a
</I>&gt;&gt;<i> &gt; content-disposition header. *However, sometimes it is not possible for
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> &gt; page author to have control over the response headers sent by the
</I>&gt;&gt;<i> &gt; server.*(A related example is offline apps, which may wish to provide
</I>&gt;&gt;<i> &gt; the user with
</I>&gt;&gt;<i> &gt; a way to &quot;download&quot; a file stored locally using the filesystem API but
</I>&gt;&gt;<i> again
</I>&gt;&gt;<i> &gt; can't set any headers.) It would be nice to provide the page author with
</I>&gt;&gt;<i> a
</I>&gt;&gt;<i> &gt; client side mechanism to trigger a download.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; After mulling this over with some application developers who are trying
</I>&gt;&gt;<i> to
</I>&gt;&gt;<i> &gt; use this functionality, it seems like adding a &quot;rel&quot; attribute to the &lt;a&gt;
</I>&gt;&gt;<i> &gt; tag would be a straightforward, minimally invasive way to address this
</I>&gt;&gt;<i> use
</I>&gt;&gt;<i> &gt; case. &lt;a rel=attachment href=blah.pdf&gt; would indicate that the browser
</I>&gt;&gt;<i> &gt; should treat this link as if the response came with a
</I>&gt;&gt;<i> content-disposition:
</I>&gt;&gt;<i> &gt; attachment header, and offer to download/save the file for the user.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We've discussed a different solution to the same problem at mozilla.
</I>&gt;&gt;<i> The solution we discussed was allowing FileSaver to in addition to
</I>&gt;&gt;<i> taking a blob argument, allow it to take a url argument.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One concern which was brought up was the ability to cause the user to
</I>&gt;&gt;<i> download a file from a third party site. I.e. this would allow
</I>&gt;&gt;<i> evil.com to trick the user into downloading an email from the users
</I>&gt;&gt;<i> webmail, or download a page from their bank which contains all their
</I>&gt;&gt;<i> banking information. It might be easier to then trick the user into
</I>&gt;&gt;<i> re-uploading the saved file to evil.com since from a user's
</I>&gt;&gt;<i> perspective, it looked like the file came from evil.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Another possible attack goes something like:
</I>&gt;&gt;<i> 1. evil.com tricks the user into downloading sensitive data from bank.com
</I>&gt;&gt;<i> 2. evil.com then asks the user to download a html from evil.com and
</I>&gt;&gt;<i> open the newly downloaded file
</I>&gt;&gt;<i> 3. the html file contains script which reads the contents from the
</I>&gt;&gt;<i> file downloaded from bank.com and sends it back to evil.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Step 1 and 2 require the user to answer &quot;yes&quot; to a dialog displayed by
</I>&gt;&gt;<i> the browser. However it's well known that users very often hit
</I>&gt;&gt;<i> whichever button they suspect will make the dialog go away, rather
</I>&gt;&gt;<i> than actually read the contents of the dialog.
</I>&gt;&gt;<i> Step 3 again requires the user to answer &quot;yes&quot; to a dialog displayed
</I>&gt;&gt;<i> by the browser in at least some browsers. Same caveat applies though.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One very simple remedy to this would be to require CORS opt-in for
</I>&gt;&gt;<i> cross-site downloads. For same-site downloads no special opt-in would
</I>&gt;&gt;<i> be required of course.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It's also possible that it would be ok to do this without any opt-ins
</I>&gt;&gt;<i> since there are a good number of actions that the user has to take in
</I>&gt;&gt;<i> all these scenarios. Definitely something that I'd be ok with
</I>&gt;&gt;<i> discussing with our security team.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Tentatively I would feel safer with the CORS option though. And again,
</I>&gt;&gt;<i> for same-site downloads this isn't a problem at all, but I suspect
</I>&gt;&gt;<i> that in many cases the file to be downloaded is hosted on a separate
</I>&gt;&gt;<i> server.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Oh, and I don't have strong opinions at this time on if rel=attachment
</I>&gt;&gt;<i> or FileSaver or both should be the way to trigger this functionality.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> / Jonas
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I agree FileSaver is useful and has its place, but I don't think it negates
</I>&gt;<i> the need for something like rel=attachment or download=filename. For one,
</I>&gt;<i> FileSaver currently operates on blobs and as you mention would have to be
</I>&gt;<i> modified to handle URLs or streams more generally. Second, it would force
</I>&gt;<i> developers to use javascript links and/or set up click listeners and so
</I>&gt;<i> forth, which could be annoying for users (losing the ability to copy the URL
</I>&gt;<i> etc).
</I>
As stated, I don't have a strong preference here. I suspect ultimately
we'll end up wanting both a markup based and an API based solution
here.

&gt;<i> I guess the interesting question is &quot;If the response would not have
</I>&gt;<i> otherwise triggered a download, and the request is cross-origin, should that
</I>&gt;<i> require CORS&quot; and personally I would say no, this is still a remote enough
</I>&gt;<i> concern that I would not worry about it.
</I>
Indeed, that is the interesting question.

I know that I would personally feel a lot more comfortable if the site
opted in to allowing downloads of the resource in question. But it's
quite possible that I'm overly paranoid.

Though one thing to keep in mind is sites that explicitly state that a
resource should *not* reach the users disk. This is today often done
using &quot;Cache-Control: no-store&quot;. Seems scary to allow such content to
be saved based on a cross-site request.

/ Jonas

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="074752.html">[whatwg] a rel=attachment
</A></li>
	<LI>Next message: <A HREF="074762.html">[whatwg] a rel=attachment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74754">[ date ]</a>
              <a href="thread.html#74754">[ thread ]</a>
              <a href="subject.html#74754">[ subject ]</a>
              <a href="author.html#74754">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
