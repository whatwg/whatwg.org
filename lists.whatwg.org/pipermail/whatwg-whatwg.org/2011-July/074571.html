<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] AppCache-related e-mails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20AppCache-related%20e-mails&In-Reply-To=%3CCAAbwPooVf3cQ2VE3AK_JMxHs2Q0NMQXuZ1XG1wtb_RTDvYAsnA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="074570.html">
   <LINK REL="Next"  HREF="074573.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] AppCache-related e-mails</H1>
<!--htdig_noindex-->
    <B>Felix Halim</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20AppCache-related%20e-mails&In-Reply-To=%3CCAAbwPooVf3cQ2VE3AK_JMxHs2Q0NMQXuZ1XG1wtb_RTDvYAsnA%40mail.gmail.com%3E"
       TITLE="[whatwg] AppCache-related e-mails">felix.halim at gmail.com
       </A><BR>
    <I>Sat Jul  2 12:16:49 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="074570.html">[whatwg] AppCache-related e-mails
</A></li>
        <LI>Next message: <A HREF="074573.html">[whatwg] AppCache-related e-mails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74571">[ date ]</a>
              <a href="thread.html#74571">[ thread ]</a>
              <a href="subject.html#74571">[ subject ]</a>
              <a href="author.html#74571">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Sat, Jul 2, 2011 at 8:14 AM, Bjartur Thorlacius &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">svartman95 at gmail.com</A>&gt; wrote:
&gt;<i> &#350;ann f&#246;s &#160;1.j&#250;l 2011 03:22, skrifa&#287;i Felix Halim:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm looking for a solution that doesn't require modifying anything
</I>&gt;&gt;<i> except adding a manifest.
</I>&gt;&gt;<i>
</I>&gt;<i> I recommend fixing your website. As others have stated, this has practical
</I>&gt;<i> benefits, in the online as well as the offline case.
</I>
I don't mind fixing my website, if I really have to! If AppCache have
an option to always view the main page &quot;online&quot;, I won't have to do
anything.


&gt;&gt;<i> however, if we don't have &quot;pageStorage&quot;, even we have a clean dynamic
</I>&gt;&gt;<i> separation, it will quickly run out of space if we use &quot;localStorage&quot;
</I>&gt;&gt;<i> since the localStorage quota is per domain.
</I>&gt;&gt;<i>
</I>&gt;<i> Nobody's forcing you to use localStorage. How do you figure using
</I>&gt;<i> pageStorage or localStorage will be less work than using iframes or other
</I>&gt;<i> linking methods already proposed?
</I>
It's not about the amount of work that matters, it's the quota I'm
talking about.


&gt;&gt;<i> Let's see an example:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have a dynamic page with this url:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://bla/page?id=10">http://bla/page?id=10</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The content inside is changing very frequently, lets say every hour.
</I>&gt;&gt;<i> Of course, I want the browser to cache the latest version.
</I>&gt;<i>
</I>&gt;<i> Then specify the applicable HTTP headers with informative values. HTTP
</I>&gt;<i> caching hasn't stopped working, nor is it barred from improving. There is
</I>&gt;<i> space for implementations to improve while complying with current
</I>&gt;<i> specifications. All you have to do is split dynamic resources from static,
</I>&gt;<i> read the RFC and send the appropriate headers.
</I>&gt;<i> Of course this method has the drawback of requiring a request/response pair
</I>&gt;<i> for every resource transferred over HTTP.
</I>
Remember that I also want those URL to be available even if the user is offline.
HTTP Cache is not that powerful, AppCache is.


&gt;&gt;<i> In that case, my cleanly separated static and dynamic will have no effect!
</I>&gt;&gt;<i> Because all the statics get duplicated for each App Cache.
</I>&gt;&gt;<i> It will be the same as if I don't have the framework!
</I>&gt;&gt;<i>
</I>&gt;<i> I'm not following your line of thinking. Why do you insist on using an App
</I>&gt;<i> Cache for each page rather than a shared cache for all your resources?
</I>
I do want to use shared cache for shared resources and &quot;page cache&quot;
for non-shared resources (unique to that page). However, the
non-shared resources will become too large to fit in 5MB quota.
Remember I have different non-shared content for id=10, id=11, ...,
id=100000, I don't think that will fit in localStorage.


&gt;<i> Are you certain that users wish to archive every single dynamic resource
</I>&gt;<i> they fetch from your site? Disposition of any significant amount of storage
</I>&gt;<i> should be in the hands of the user, if indirectly through the user agent.
</I>&gt;<i> Take handhelds.
</I>
Users only view the resources they want.

When they viewed it, I want it to be there for offline use or for
performance reasons.
I expect the users only view (and cache) few hundreds of them.
They cannot cache what they didn't view / open.
It is OK for the browser to not cache it if it doesn't any storage left.

I am satisfied if there is a &quot;page storage&quot; quota of 5MB given per
page (not per domain).
This will solve all my problems (of course by restructuring my site).



&gt;&gt;<i> If only I can store the dynamic content into a pageStorage (assuming
</I>&gt;&gt;<i> different URL -&gt; &#160;including the shebang bookmark has different
</I>&gt;&gt;<i> pageStorage), then I won't be running out of storage if I keep one
</I>&gt;&gt;<i> page within 5MB. So
</I>&gt;<i>
</I>&gt;<i> And you're sure this is a good thing, because?
</I>
Because currently, browsers can handle a page content &lt; 5MB very fast.
I think it is OK for a page (not a domain) to have 5MB data quota.

If you are building games, perhaps need more than that (it has to go
to the web store to get unlimited permission). However, for regular
pages, 5MB &quot;currently&quot; is more than enough. 5MB per domain is too
small!


&gt;&gt;<i> <A HREF="http://bla/page#!id=10">http://bla/page#!id=10</A>
</I>&gt;&gt;<i>
</I>&gt;<i> You *can't* allocate a quota per URI fragment, as a script in the page could
</I>&gt;<i> create new ones as wanted.
</I>
Yes I know, that was only for an example to point out that:

If I use shared cache:

<A HREF="http://bla/page">http://bla/page</A>

I will run out of quota quickly.

If I use parameters like this:

<A HREF="http://bla/page?id=10">http://bla/page?id=10</A>

I will have to refresh TWICE to get the latest content (annoying).

If I can use:

<A HREF="http://bla/page#!id=10">http://bla/page#!id=10</A>

I get the best of both worlds, that is I have shared static cache, and
I won't run out of quota for the non-shared-dynamic cache since the
quota is 5MB per hash value. I know that this has a security hole that
the script can just generate random url to get more quota.

My suggestion is to give quota to hash value for the first time the
page is loaded, so a later script modification will be linked to the
original hash value's quota.


&gt;&gt;<i> So, we have seen how the AppCache fails to satisfy certain usecase and
</I>&gt;&gt;<i> how pageStorage is needed to make the alternative solution works.
</I>&gt;&gt;<i>
</I>&gt;<i> Show how either the HTTP specification or common practice forbids HTTP
</I>&gt;<i> caches from satisfy your use cases.
</I>
I think it's clear that HTTP Cache is inferior to AppCache.
What HTTP Cache can, it can be overridden by AppCache.
AppCache complements HTTP Cache.

HTTP Cache does satisfy my use cases since long time ago.
But with the presence of AppCache, I want better control.


&gt;<i> You're asking for user agents archiving websites for offline viewing (in the
</I>&gt;<i> offline mode). I fetch a bunch of unread pages for offline reading from time
</I>&gt;<i> to time, but keeping a copy of read pages when I'm most likely going to be
</I>&gt;<i> online may be considered a waste of storage space. Users who have a lot of
</I>&gt;<i> storage at their disposal may do this already. I see no reason to do so only
</I>&gt;<i> if requested by the author.
</I>
AppCache cannot cache what has not been read/viewed.
What have been viewed can be safely deleted by the browser without warning.
Except, perhaps, for special &quot;installable&quot; web-apps in the store?


&gt;<i> There are two situations:
</I>&gt;<i> &#160;a) A user agent runs in a constrained environment with limited storage
</I>&gt;<i> space. The user agent caches static resources only, or doesn't cache at all.
</I>&gt;<i> &#160;b) A user agent runs in a plentiful environment with great volumes of
</I>&gt;<i> storage space at it's disposal. The user agent archives most if not all
</I>&gt;<i> resources it fetches, throwing stale resources away according to a cache
</I>&gt;<i> algorithm when a quote set in proportion to the available storage space is
</I>&gt;<i> reached.
</I>&gt;<i>
</I>&gt;<i> How does your proposal help the user agent in archiving, or not archiving
</I>&gt;<i> resources?
</I>
The decision of archiving is entirely up to the browser.
The cached pages in the AppCache will work fine if it is deleted by the browser.
It will just re-fetch everything and it will be as slow as the first
view of the page.

The archiving problem is not relevant for my proposal.


&gt;&gt;<i> All these discussions only begs to add one feature to AppCache:
</I>&gt;&gt;<i> - Only show the cache when the network / server is offline, otherwise,
</I>&gt;&gt;<i> show the online version of the page.
</I>&gt;&gt;<i>
</I>&gt;<i> This requires a validation roundtrip (as is common), but is otherwise fair.
</I>
Yes of course.

However, if the AppCache is set to cache the main page + everything,
no roundtrip is needed.

My proposal is to include an option to ALWAYS make a roundtrip for the
main page and show the latest main page (rather than show the cached
main page which avoid the roundtrip but will do that in later time and
giant refresh needed).


&gt;&gt;<i> The current AppCache doesn't care whether the network/server is online
</I>&gt;&gt;<i> or offline, it BLINDLY shows the cache everytime. This is good for the
</I>&gt;&gt;<i> default, however, we should HAVE an option to not show the cache if we
</I>&gt;&gt;<i> are ONLINE (this is what people meant when they say &quot;DON&quot;T CACHE THE
</I>&gt;&gt;<i> MAIN PAGE&quot;).
</I>&gt;&gt;<i>
</I>&gt;<i> HTTP caches may do what you want.
</I>
Yes, but I'm no longer satisfied with HTTP Caches when I can use a
more reliable AppCache.

Felix Halim

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="074570.html">[whatwg] AppCache-related e-mails
</A></li>
	<LI>Next message: <A HREF="074573.html">[whatwg] AppCache-related e-mails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74571">[ date ]</a>
              <a href="thread.html#74571">[ thread ]</a>
              <a href="subject.html#74571">[ subject ]</a>
              <a href="author.html#74571">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
