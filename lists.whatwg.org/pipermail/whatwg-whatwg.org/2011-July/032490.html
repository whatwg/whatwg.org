<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] a rel=attachment
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20a%20rel%3Dattachment&In-Reply-To=%3CCA%2Bc2ei_fpFLSjzDUPqgoLbwt8egXa_dC54UHF0EfgpUyf7m-XQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032489.html">
   <LINK REL="Next"  HREF="032491.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] a rel=attachment</H1>
<!--htdig_noindex-->
    <B>Jonas Sicking</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20a%20rel%3Dattachment&In-Reply-To=%3CCA%2Bc2ei_fpFLSjzDUPqgoLbwt8egXa_dC54UHF0EfgpUyf7m-XQ%40mail.gmail.com%3E"
       TITLE="[whatwg] a rel=attachment">jonas at sicking.cc
       </A><BR>
    <I>Fri Jul 15 16:00:03 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="032489.html">[whatwg] a rel=attachment
</A></li>
        <LI>Next message: <A HREF="032491.html">[whatwg] a rel=attachment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32490">[ date ]</a>
              <a href="thread.html#32490">[ thread ]</a>
              <a href="subject.html#32490">[ subject ]</a>
              <a href="author.html#32490">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>2011/7/15 Darin Fisher &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">darin at chromium.org</A>&gt;:
&gt;<i> On Fri, Jul 15, 2011 at 1:09 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2011/7/15 Ian Fette (&#12452;&#12450;&#12531;&#12501;&#12455;&#12483;&#12486;&#12451;) &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ifette at google.com</A>&gt;:
</I>&gt;&gt;<i> &gt; 2011/7/15 Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt; 2011/7/14 Ian Fette (&#12452;&#12450;&#12531;&#12501;&#12455;&#12483;&#12486;&#12451;) &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">ifette at google.com</A>&gt;:
</I>&gt;&gt;<i> &gt;&gt; &gt; Many websites wish to offer a file for download, even though it could
</I>&gt;&gt;<i> &gt;&gt; &gt; potentially be viewed inline (take images, PDFs, or word documents as
</I>&gt;&gt;<i> &gt;&gt; &gt; an
</I>&gt;&gt;<i> &gt;&gt; &gt; example). Traditionally the only way to achieve this is to set a
</I>&gt;&gt;<i> &gt;&gt; &gt; content-disposition header. *However, sometimes it is not possible
</I>&gt;&gt;<i> &gt;&gt; &gt; for
</I>&gt;&gt;<i> &gt;&gt; the
</I>&gt;&gt;<i> &gt;&gt; &gt; page author to have control over the response headers sent by the
</I>&gt;&gt;<i> &gt;&gt; &gt; server.*(A related example is offline apps, which may wish to provide
</I>&gt;&gt;<i> &gt;&gt; &gt; the user with
</I>&gt;&gt;<i> &gt;&gt; &gt; a way to &quot;download&quot; a file stored locally using the filesystem API
</I>&gt;&gt;<i> &gt;&gt; &gt; but
</I>&gt;&gt;<i> &gt;&gt; again
</I>&gt;&gt;<i> &gt;&gt; &gt; can't set any headers.) It would be nice to provide the page author
</I>&gt;&gt;<i> &gt;&gt; &gt; with
</I>&gt;&gt;<i> &gt;&gt; a
</I>&gt;&gt;<i> &gt;&gt; &gt; client side mechanism to trigger a download.
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; After mulling this over with some application developers who are
</I>&gt;&gt;<i> &gt;&gt; &gt; trying
</I>&gt;&gt;<i> &gt;&gt; to
</I>&gt;&gt;<i> &gt;&gt; &gt; use this functionality, it seems like adding a &quot;rel&quot; attribute to the
</I>&gt;&gt;<i> &gt;&gt; &gt; &lt;a&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; tag would be a straightforward, minimally invasive way to address
</I>&gt;&gt;<i> &gt;&gt; &gt; this
</I>&gt;&gt;<i> &gt;&gt; use
</I>&gt;&gt;<i> &gt;&gt; &gt; case. &lt;a rel=attachment href=blah.pdf&gt; would indicate that the
</I>&gt;&gt;<i> &gt;&gt; &gt; browser
</I>&gt;&gt;<i> &gt;&gt; &gt; should treat this link as if the response came with a
</I>&gt;&gt;<i> &gt;&gt; content-disposition:
</I>&gt;&gt;<i> &gt;&gt; &gt; attachment header, and offer to download/save the file for the user.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; We've discussed a different solution to the same problem at mozilla.
</I>&gt;&gt;<i> &gt;&gt; The solution we discussed was allowing FileSaver to in addition to
</I>&gt;&gt;<i> &gt;&gt; taking a blob argument, allow it to take a url argument.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; One concern which was brought up was the ability to cause the user to
</I>&gt;&gt;<i> &gt;&gt; download a file from a third party site. I.e. this would allow
</I>&gt;&gt;<i> &gt;&gt; evil.com to trick the user into downloading an email from the users
</I>&gt;&gt;<i> &gt;&gt; webmail, or download a page from their bank which contains all their
</I>&gt;&gt;<i> &gt;&gt; banking information. It might be easier to then trick the user into
</I>&gt;&gt;<i> &gt;&gt; re-uploading the saved file to evil.com since from a user's
</I>&gt;&gt;<i> &gt;&gt; perspective, it looked like the file came from evil.com
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Another possible attack goes something like:
</I>&gt;&gt;<i> &gt;&gt; 1. evil.com tricks the user into downloading sensitive data from
</I>&gt;&gt;<i> &gt;&gt; bank.com
</I>&gt;&gt;<i> &gt;&gt; 2. evil.com then asks the user to download a html from evil.com and
</I>&gt;&gt;<i> &gt;&gt; open the newly downloaded file
</I>&gt;&gt;<i> &gt;&gt; 3. the html file contains script which reads the contents from the
</I>&gt;&gt;<i> &gt;&gt; file downloaded from bank.com and sends it back to evil.com
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Step 1 and 2 require the user to answer &quot;yes&quot; to a dialog displayed by
</I>&gt;&gt;<i> &gt;&gt; the browser. However it's well known that users very often hit
</I>&gt;&gt;<i> &gt;&gt; whichever button they suspect will make the dialog go away, rather
</I>&gt;&gt;<i> &gt;&gt; than actually read the contents of the dialog.
</I>&gt;&gt;<i> &gt;&gt; Step 3 again requires the user to answer &quot;yes&quot; to a dialog displayed
</I>&gt;&gt;<i> &gt;&gt; by the browser in at least some browsers. Same caveat applies though.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; One very simple remedy to this would be to require CORS opt-in for
</I>&gt;&gt;<i> &gt;&gt; cross-site downloads. For same-site downloads no special opt-in would
</I>&gt;&gt;<i> &gt;&gt; be required of course.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; It's also possible that it would be ok to do this without any opt-ins
</I>&gt;&gt;<i> &gt;&gt; since there are a good number of actions that the user has to take in
</I>&gt;&gt;<i> &gt;&gt; all these scenarios. Definitely something that I'd be ok with
</I>&gt;&gt;<i> &gt;&gt; discussing with our security team.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Tentatively I would feel safer with the CORS option though. And again,
</I>&gt;&gt;<i> &gt;&gt; for same-site downloads this isn't a problem at all, but I suspect
</I>&gt;&gt;<i> &gt;&gt; that in many cases the file to be downloaded is hosted on a separate
</I>&gt;&gt;<i> &gt;&gt; server.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Oh, and I don't have strong opinions at this time on if rel=attachment
</I>&gt;&gt;<i> &gt;&gt; or FileSaver or both should be the way to trigger this functionality.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; / Jonas
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I agree FileSaver is useful and has its place, but I don't think it
</I>&gt;&gt;<i> &gt; negates
</I>&gt;&gt;<i> &gt; the need for something like rel=attachment or download=filename. For
</I>&gt;&gt;<i> &gt; one,
</I>&gt;&gt;<i> &gt; FileSaver currently operates on blobs and as you mention would have to
</I>&gt;&gt;<i> &gt; be
</I>&gt;&gt;<i> &gt; modified to handle URLs or streams more generally. Second, it would
</I>&gt;&gt;<i> &gt; force
</I>&gt;&gt;<i> &gt; developers to use javascript links and/or set up click listeners and so
</I>&gt;&gt;<i> &gt; forth, which could be annoying for users (losing the ability to copy the
</I>&gt;&gt;<i> &gt; URL
</I>&gt;&gt;<i> &gt; etc).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As stated, I don't have a strong preference here. I suspect ultimately
</I>&gt;&gt;<i> we'll end up wanting both a markup based and an API based solution
</I>&gt;&gt;<i> here.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; I guess the interesting question is &quot;If the response would not have
</I>&gt;&gt;<i> &gt; otherwise triggered a download, and the request is cross-origin, should
</I>&gt;&gt;<i> &gt; that
</I>&gt;&gt;<i> &gt; require CORS&quot; and personally I would say no, this is still a remote
</I>&gt;&gt;<i> &gt; enough
</I>&gt;&gt;<i> &gt; concern that I would not worry about it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Indeed, that is the interesting question.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I know that I would personally feel a lot more comfortable if the site
</I>&gt;&gt;<i> opted in to allowing downloads of the resource in question. But it's
</I>&gt;&gt;<i> quite possible that I'm overly paranoid.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Though one thing to keep in mind is sites that explicitly state that a
</I>&gt;&gt;<i> resource should *not* reach the users disk. This is today often done
</I>&gt;&gt;<i> using &quot;Cache-Control: no-store&quot;. Seems scary to allow such content to
</I>&gt;&gt;<i> be saved based on a cross-site request.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> / Jonas
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This security concern is very interesting.  I had not considered it before.
</I>&gt;<i> Putting that aside for a moment, I'm glad to hear that you also support
</I>&gt;<i> there being some declarative method of triggering a download.  Which of
</I>&gt;<i> the proposals are you leaning toward?
</I>&gt;<i> Personally, I'm most fond of the @download=filename method.  Reason:
</I>&gt;<i> 1)  Unlike rel=something, @download is feature detectable at runtime via
</I>&gt;<i> (&quot;download&quot; in document.createElement(&quot;a&quot;)).
</I>&gt;<i> 2)  Unlike rel=something, @download provides a way to specify the name
</I>&gt;<i> of the file to save.  This makes the feature useful with data: URLs and
</I>&gt;<i> blob:
</I>&gt;<i> URLs (that are not backed by a single file).  This is valuable to me because
</I>&gt;<i> I can imagine wanting to save the contents of a &lt;canvas&gt;, and that probably
</I>&gt;<i> involves saving the data URL that you get from toDataURL().
</I>&gt;<i> 3)  The target=_download idea is interesting, but I'm not sure we can safely
</I>&gt;<i> introduce new target values, and this also suffers from not providing a way
</I>&gt;<i> to
</I>&gt;<i> specify the downloaded filename.
</I>&gt;<i> 4)  The idea of using both a rel=something and an attribute to specify the
</I>&gt;<i> file
</I>&gt;<i> name could work too, but it seems a bit overly verbose.  I'm not sure I see
</I>&gt;<i> enough benefit from this.  The idea of providing a name for &lt;img&gt; tags that
</I>&gt;<i> might be downloaded manually by the user is interesting, but it feels like a
</I>&gt;<i> far less interesting problem to solve.  If our solution solves this too,
</I>&gt;<i> then great,
</I>&gt;<i> but I wouldn't necessarily make it a requirement to solve this problem too.
</I>&gt;<i> Anyways, what do you think?  I'd really like to reach some consensus on what
</I>&gt;<i> the declarative method should look like.
</I>
I agree! I like the @download attribute the best so far for basically
the same reasons you enumerate. It's also a very memorable name.

It definitely is an interesting usecase that Glenn brought up about
being able to specify a save-as name without otherwise modifying the
behavior of a reference. However that seems like a much more rare
usecase and so not the one we should optimize for.

Another UI feature that this all would allow is the ability to
drag-out-to-save. I.e. if the user drags a &lt;a href=&quot;...&quot;
download=&quot;...&quot;&gt; to the desktop, the browser can treat that as a saving
action.

&gt;<i> Whatever security restrictions we come up with will need to apply to
</I>&gt;<i> FileSaver
</I>&gt;<i> too assuming FileSaver ends up taking an URL (and a filename!).
</I>
Absolutely!

I think that the model Ian summarized in his last email is a good one.
Same-origin is always allowed, cross-origin is only allowed if there
is CORS or content-disposition: attachment.

/ Jonas
</PRE>

















<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032489.html">[whatwg] a rel=attachment
</A></li>
	<LI>Next message: <A HREF="032491.html">[whatwg] a rel=attachment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32490">[ date ]</a>
              <a href="thread.html#32490">[ thread ]</a>
              <a href="subject.html#32490">[ subject ]</a>
              <a href="author.html#32490">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
