<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Default encoding to UTF-8?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Default%20encoding%20to%20UTF-8%3F&In-Reply-To=%3CCAJQvAudrVCZOWnyCZ4oqGqQzEDbd4j7JV9km0DUj0tt-jvVjcQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="076564.html">
   <LINK REL="Next"  HREF="076558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Default encoding to UTF-8?</H1>
<!--htdig_noindex-->
    <B>Henri Sivonen</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Default%20encoding%20to%20UTF-8%3F&In-Reply-To=%3CCAJQvAudrVCZOWnyCZ4oqGqQzEDbd4j7JV9km0DUj0tt-jvVjcQ%40mail.gmail.com%3E"
       TITLE="[whatwg] Default encoding to UTF-8?">hsivonen at iki.fi
       </A><BR>
    <I>Tue Jan  3 00:33:02 PST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="076564.html">[whatwg] [encoding] utf-16
</A></li>
        <LI>Next message: <A HREF="076558.html">[whatwg] Default encoding to UTF-8?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34284">[ date ]</a>
              <a href="thread.html#34284">[ thread ]</a>
              <a href="subject.html#34284">[ subject ]</a>
              <a href="author.html#34284">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Thu, Dec 22, 2011 at 12:36 PM, Leif Halvard Silli &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">lhs at russisk.no</A>&gt; wrote:
&gt;&gt;<i> It's unclear to me if you are talking about HTTP-level charset=UNICODE
</I>&gt;&gt;<i> or charset=UNICODE in a meta. Is content labeled with charset=UNICODE
</I>&gt;&gt;<i> BOMless?
</I>&gt;<i>
</I>&gt;<i> Charset=UNICODE in meta, as generated by MS tools (Office or IE, eg.)
</I>&gt;<i> seems to usually be &quot;BOM-full&quot;. But there are still enough occurrences
</I>&gt;<i> of pages without BOM. I have found UTF-8 pages with the charset=unicode
</I>&gt;<i> label in meta. But the few page I found contained either BOM or
</I>&gt;<i> HTTP-level charset=utf-8. I have to little &quot;research material&quot; when it
</I>&gt;<i> comes to UTF-8 pages with charset=unicode inside.
</I>
Making 'unicode' an alias of UTF-16 or UTF-16LE would be useless for
pages that have a BOM, because the BOM is already inspected before
&lt;meta&gt; and if HTTP-level charset is unrecognized, the BOM wins.

Making 'unicode' an alias of UTF-16 or UTF-16LE would be useful for
UTF-8-encoded pages that say charset=unicode in &lt;meta&gt; if alias
resolution happens before UTF-16 labels are mapped to UTF-8.

Making 'unicode' an alias for UTF-16 or UTF-16LE would be useless for
pages that are (BOMless) UTF-16LE and that have charset=unicode in
&lt;meta&gt;, because the &lt;meta&gt; prescan doesn't see UTF-16-encoded metas.
Furthermore, it doesn't make sense to make the &lt;meta&gt; prescan look for
UTF-16-encoded metas, because it would make sense to honor the value
only if it matched a flavor of UTF-16 appropriate for the pattern of
zero bytes in the file, so it would be more reliable and straight
forward to just analyze the pattern of zero bytes without bothering to
look for UTF-16-encoded &lt;meta&gt;s.

&gt;<i> When the detector says UTF-8 - that is step 7 of the sniffing algorith,
</I>&gt;<i> no?
</I>&gt;<i> <A HREF="http://dev.w3.org/html5/spec/parsing.html#determining-the-character-encoding">http://dev.w3.org/html5/spec/parsing.html#determining-the-character-encoding</A>
</I>
Yes.

&gt;&gt;<i> &#160;2) Start the parse assuming UTF-8 and reload as Windows-1252 if the
</I>&gt;&gt;<i> detector says non-UTF-8.
</I>...
&gt;<i> I think you are mistaken there: If parsers perform UTF-8 detection,
</I>&gt;<i> then unlabelled pages will be detected, and no reparsing will happen.
</I>&gt;<i> Not even increase. You at least need to explain this negative spiral
</I>&gt;<i> theory better before I buy it ... Step 7 will *not* lead to reparsing
</I>&gt;<i> unless the default encoding is WINDOWS-1252. If the default encoding is
</I>&gt;<i> UTF-8, then step 7, when it detects UTF-8, then it means that parsing
</I>&gt;<i> can continue uninterrupted.
</I>
That would be what I labeled as option #2 above.

&gt;<i> What we will instead see is that those using legacy encodings must be
</I>&gt;<i> more clever in labelling their pages, or else they won't be detected.
</I>
Many pages that use legacy encodings are legacy pages that aren't
actively maintained. Unmaintained pages aren't going to become more
clever about labeling.

&gt;<i> I am a bitt baffled here: It sounds like you say that there will be bad
</I>&gt;<i> consequences if browsers becomes more reliable ...
</I>
Becoming more reliable can be bad if the reliability comes at the cost
of performance, which would be the case if the kind of heuristic
detector that e.g. Firefox has was turned on for all locales. (I don't
mean the performance impact of running a detector state machine. I
mean the performance impact of reloading the page or, alternatively,
the loss of incremental rendering.)

A solution that would border on reasonable would be decoding as
US-ASCII up to the first non-ASCII byte and then deciding between
UTF-8 and the locale-specific legacy encoding by examining the first
non-ASCII byte and up to 3 bytes after it to see if they form a valid
UTF-8 byte sequence. But trying to gain more statistical confidence
about UTF-8ness than that would be bad for performance (either due to
stalling stream processing or due to reloading).

&gt;<i> Apart from UTF-16, Chrome seems quite aggressive w.r.t. encoding
</I>&gt;<i> detection. So it might still be an competitive advantage.
</I>
It would be interesting to know what exactly Chrome does. Maybe
someone who knows the code could enlighten us?

&gt;&gt;&gt;<i> * Let's say that I *kept* ISO-8859-1 as default encoding, but instead
</I>&gt;&gt;&gt;<i> enabled the Universal detector. The frame then works.
</I>&gt;&gt;&gt;<i> * But if I make the frame page very short, 10 * the letter &quot;&#248;&quot; as
</I>&gt;&gt;&gt;<i> content, then the Universal detector fails - on a test on my own
</I>&gt;&gt;&gt;<i> computer, it guess the page to be Cyrillic rather than Norwegian.
</I>&gt;&gt;&gt;<i> * What's the problem? The Universal detector is too greedy - it tries
</I>&gt;&gt;&gt;<i> to fix more problems than I have. I only want it to guess on &quot;UTF-8&quot;.
</I>&gt;&gt;&gt;<i> And if it doesn't detect UTF-8, then it should fall back to the locale
</I>&gt;&gt;&gt;<i> default (including fall back to the encoding of the parent frame).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Wouldn't that be an idea?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> No. The current configuration works for Norwegian users already. For
</I>&gt;&gt;<i> users from different silos, the ad might break, but ad breakage is
</I>&gt;&gt;<i> less bad than spreading heuristic detection to more locales.
</I>&gt;<i>
</I>&gt;<i> Here I must disagree: Less bad for whom?
</I>
For users performance-wise.

--
Henri Sivonen
<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">hsivonen at iki.fi</A>
<A HREF="http://hsivonen.iki.fi/">http://hsivonen.iki.fi/</A>
</PRE>












<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="076564.html">[whatwg] [encoding] utf-16
</A></li>
	<LI>Next message: <A HREF="076558.html">[whatwg] Default encoding to UTF-8?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34284">[ date ]</a>
              <a href="thread.html#34284">[ thread ]</a>
              <a href="subject.html#34284">[ subject ]</a>
              <a href="author.html#34284">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
