<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Offscreen canvas (or canvas for web workers).
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Offscreen%20canvas%20%28or%20canvas%20for%20web%20workers%29.&In-Reply-To=%3C5dd9e5c51002230740t16ad9dc2p2677081a7e62e0f5%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="067547.html">
   <LINK REL="Next"  HREF="067576.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Offscreen canvas (or canvas for web workers).</H1>
<!--htdig_noindex-->
    <B>Jeremy Orlow</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Offscreen%20canvas%20%28or%20canvas%20for%20web%20workers%29.&In-Reply-To=%3C5dd9e5c51002230740t16ad9dc2p2677081a7e62e0f5%40mail.gmail.com%3E"
       TITLE="[whatwg] Offscreen canvas (or canvas for web workers).">jorlow at chromium.org
       </A><BR>
    <I>Tue Feb 23 07:40:36 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="067547.html">[whatwg] Offscreen canvas (or canvas for web workers).
</A></li>
        <LI>Next message: <A HREF="067576.html">[whatwg] Offscreen canvas (or canvas for web workers).
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67550">[ date ]</a>
              <a href="thread.html#67550">[ thread ]</a>
              <a href="subject.html#67550">[ subject ]</a>
              <a href="author.html#67550">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Tue, Feb 23, 2010 at 11:31 AM, Jeremy Orlow &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jorlow at chromium.org</A>&gt; wrote:

&gt;<i> On Tue, Feb 23, 2010 at 12:46 AM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Mon, Feb 22, 2010 at 4:34 PM, Jeremy Orlow &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jorlow at chromium.org</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt; On Tue, Feb 23, 2010 at 12:05 AM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; On Mon, Feb 22, 2010 at 3:43 PM, Jeremy Orlow &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jorlow at chromium.org</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt;&gt; &gt; On Mon, Feb 22, 2010 at 11:10 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; wrote:
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; On Mon, Feb 22, 2010 at 11:13 AM, David Levin &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">levin at google.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; &gt; I've talked with some other folks on WebKit (Maciej and Oliver)
</I>&gt;&gt;<i> about
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; &gt; having
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; &gt; a canvas that is available to workers. They suggested some nice
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; &gt; modifications to make it an offscreen canvas, which may be used in
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; &gt; the
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; &gt; Document or in a Worker.
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; What is the use case for this? It seems like in most cases you'll
</I>&gt;&gt;<i> want
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; to display something on screen to the user, and so the difference
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; comes down to shipping drawing commands across the pipe, vs.
</I>&gt;&gt;<i> shipping
</I>&gt;&gt;<i> &gt;&gt; &gt;&gt; the pixel data.
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; Sometimes the commands take up a lot more CPU power than shipping the
</I>&gt;&gt;<i> &gt;&gt; &gt; pixels.  Lets say you wanted to have a really rich map application
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i> &gt;&gt; &gt; looked great, was highly interactive/fluid, but didn't use a lot of
</I>&gt;&gt;<i> &gt;&gt; &gt; bandwidth.  Rendering different parts of the screen on different
</I>&gt;&gt;<i> workers
</I>&gt;&gt;<i> &gt;&gt; &gt; seems like a legit use.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; I admit to not being a graphics expert, but I would imagine you have
</I>&gt;&gt;<i> &gt;&gt; to do quite a lot of drawing before
</I>&gt;&gt;<i> &gt;&gt; 1. Drawing on offscreen canvas
</I>&gt;&gt;<i> &gt;&gt; 2. Cloning the pixel data in order to ship it to a different thread
</I>&gt;&gt;<i> &gt;&gt; 3. Drawing the pixel data to the on-screen canvas
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Presumably a smart UA implementation could make 1 and 3 be nearly
</I>&gt;&gt;<i> nothing
</I>&gt;&gt;<i> &gt; (with copy on write and such) in many cases.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Huh? I thought the whole point was that 1 was expensive, which was why
</I>&gt;&gt;<i> you wanted to do it off the main thread.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And 3 is what puts pixels on the screen so I don't see how you could
</I>&gt;&gt;<i> do that without copying. You could possibly implement 3 using
</I>&gt;&gt;<i> blitting, but that's still not &quot;nearly nothing&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Possibly 2 is what you could get rid of using copy-on-write.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;&gt; gets to be cheaper than
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; 1. Drawing to on-screen canvas.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; You're assuming only one core.  The norm on the desktops and laptops
</I>&gt;&gt;<i> these
</I>&gt;&gt;<i> &gt; days is multiple cores.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I did not assume that no. But it sounded like your use case was to
</I>&gt;&gt;<i> rasterize off the main thread, get the pixels to the main thread, and
</I>&gt;&gt;<i> then draw there. The last part (step 3 above) will definitely happen
</I>&gt;&gt;<i> on the main thread no matter how many cores you have.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sorry, I didn't read clearly before sending.
</I>&gt;<i>
</I>&gt;<i> Yes, 1 would presumably be expensive and thus worth doing on a worker.
</I>&gt;<i>  Even on a single core machine, workers are great for long tasks since you
</I>&gt;<i> needn't add breaks to your code via setTimeout so the UI can be updated
</I>&gt;<i> (which doesn't always work perfectly anyway).
</I>&gt;<i>
</I>&gt;<i> 2 could be done with copy on write in many cases.  3 is just blitting which
</I>&gt;<i> is generally a pretty fast operation.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I've gotten a couple responses back on use cases.  I'll admit that about
</I>&gt;<i> half a simply resize/rotate.  The others I've been told I cannot talk about
</I>&gt;<i> publicly.  I think my map tiles example is similar enough to a bunch of them
</I>&gt;<i> though that you can get at least the conceptual idea.  And my understanding
</I>&gt;<i> is that in prototypes, it's been very hard to do the (computationally
</I>&gt;<i> complex) rendering without making the UI go janky.  There might be some more
</I>&gt;<i> use cases that come up that I can generalize into a public form, in which
</I>&gt;<i> case I'll do my best.
</I>&gt;<i>
</I>
Note that doing rendering in a worker and then displaying it on the the main
thread also gives you double buffering for no additional cost.  This is
something our teams are excited about as well.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20100223/8db7dce5/attachment-0002.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20100223/8db7dce5/attachment-0002.htm</A>&gt;
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="067547.html">[whatwg] Offscreen canvas (or canvas for web workers).
</A></li>
	<LI>Next message: <A HREF="067576.html">[whatwg] Offscreen canvas (or canvas for web workers).
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67550">[ date ]</a>
              <a href="thread.html#67550">[ thread ]</a>
              <a href="subject.html#67550">[ subject ]</a>
              <a href="author.html#67550">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
