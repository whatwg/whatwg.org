<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] XSS safe templating
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20XSS%20safe%20templating&In-Reply-To=%3C64409C95-0CE9-4C9F-AF1F-8213BFA2AA60%40iki.fi%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="067772.html">
   <LINK REL="Next"  HREF="067787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] XSS safe templating</H1>
<!--htdig_noindex-->
    <B>Henri Sivonen</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20XSS%20safe%20templating&In-Reply-To=%3C64409C95-0CE9-4C9F-AF1F-8213BFA2AA60%40iki.fi%3E"
       TITLE="[whatwg] XSS safe templating">hsivonen at iki.fi
       </A><BR>
    <I>Fri Mar 12 07:04:19 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="067772.html">[whatwg] XSS safe templating
</A></li>
        <LI>Next message: <A HREF="067787.html">[whatwg] XSS safe templating
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67786">[ date ]</a>
              <a href="thread.html#67786">[ thread ]</a>
              <a href="subject.html#67786">[ subject ]</a>
              <a href="author.html#67786">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Mar 11, 2010, at 20:18, Mike Samuel wrote:

&gt;<i> I think I can probably do without new HTML5 stuff.
</I>
OK. One supplemental point:

On Mar 10, 2010, at 20:15, Mike Samuel wrote:

&gt;<i> document.write can be wrapped.  But the wrapper would still need to
</I>&gt;<i> know the insertion-mode.
</I>&gt;<i> If the insertion mode were exposed, or at least some context were
</I>&gt;<i> given -- enough to know whether the next char if not something that
</I>&gt;<i> changed the current token, would be interpreted as
</I>&gt;<i>  * inside a tag
</I>&gt;<i>  * outside a tag in a comment / application instruction / doctype
</I>&gt;<i>  * outside a tag in a PCDATA/RCDATA/CDATA context and ideally in what
</I>&gt;<i> kind of containing tag
</I>&gt;<i>  * outside a tag in a CDATA section.
</I>
That's not the insertion mode. That's the tokenizer state.

Whenever a script that is eligible to write to the stream starts running, the tokenizer is in the &quot;data&quot; state. Therefore, if you control all the scripts on the page, and wrap document.write(), you already have a stable initial tokenizer state provided to you by the host browser's parser and you can predict the state transitions from there.

If you have arbitrary other scripts on the page whose execution may be interleaved with the execution of your wrapper in unexpected ways, you've already lost XSS-safety overall.

-- 
Henri Sivonen
<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">hsivonen at iki.fi</A>
<A HREF="http://hsivonen.iki.fi/">http://hsivonen.iki.fi/</A>



</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="067772.html">[whatwg] XSS safe templating
</A></li>
	<LI>Next message: <A HREF="067787.html">[whatwg] XSS safe templating
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67786">[ date ]</a>
              <a href="thread.html#67786">[ thread ]</a>
              <a href="subject.html#67786">[ subject ]</a>
              <a href="author.html#67786">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
