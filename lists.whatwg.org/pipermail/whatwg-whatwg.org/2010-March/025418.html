<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] WebSocket bufferedAmount includes overhead or not.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20WebSocket%20bufferedAmount%20includes%20overhead%20or%20not.&In-Reply-To=%3C4B914D1A.3050807%40helsinki.fi%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025417.html">
   <LINK REL="Next"  HREF="025420.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] WebSocket bufferedAmount includes overhead or not.</H1>
<!--htdig_noindex-->
    <B>Olli Pettay</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20WebSocket%20bufferedAmount%20includes%20overhead%20or%20not.&In-Reply-To=%3C4B914D1A.3050807%40helsinki.fi%3E"
       TITLE="[whatwg] WebSocket bufferedAmount includes overhead or not.">Olli.Pettay at helsinki.fi
       </A><BR>
    <I>Fri Mar  5 10:27:38 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="025417.html">[whatwg] WebSocket bufferedAmount includes overhead or not.
</A></li>
        <LI>Next message: <A HREF="025420.html">[whatwg] WebSocket bufferedAmount includes overhead or not.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25418">[ date ]</a>
              <a href="thread.html#25418">[ thread ]</a>
              <a href="subject.html#25418">[ subject ]</a>
              <a href="author.html#25418">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On 3/5/10 7:54 PM, Alexey Proskuryakov wrote:
&gt;<i>
</I>&gt;<i> On 04.03.2010, at 1:52, Olli Pettay wrote:
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> I noticed that WebSocket spec updated to not inlcude framing overhead in
</I>&gt;&gt;&gt;<i> bufferedAmount.
</I>&gt;&gt;<i> I asked that since from API point of view it doesn't make
</I>&gt;&gt;<i> much sense to have the frame bytes to be magically included in the
</I>&gt;&gt;<i> bufferedAmount.
</I>&gt;&gt;<i> What if we change the protocol and require different amount framing
</I>&gt;&gt;<i> bytes?
</I>&gt;<i>
</I>&gt;<i> I was going to mention this as the primary reason why frame bytes should
</I>&gt;<i> be included. JavaScript code needs this information for flow control,
</I>Why?

&gt;<i> and it's raw bytes that are sent over the tubes, not original message
</I>&gt;<i> strings.
</I>Right. But this is about the API. I assume the underlying protocol may
change or the API can eventually support different kinds of protocols
(some may use UPD, some TCP, some send text, some binary).
The API usage should be still the same, if possible.


&gt;<i>
</I>&gt;<i> Also, I think it's a layering violation.
</I>I don't understand what you mean with this.
bufferedAmount is about the API.

&gt;<i> In WebKit, we'd have to queue
</I>&gt;<i> unsent messages separately just to implement this quirk (see
</I>&gt;<i> <A HREF="https://bugs.webkit.org/attachment.cgi?id=50093">https://bugs.webkit.org/attachment.cgi?id=50093</A> for a proof of concept).
</I>&gt;<i> It becomes very difficult to implement we decide to add size of data
</I>&gt;<i> that an underlying network library buffers internally - which I think
</I>&gt;<i> would be a reasonable thing to do.
</I>I don't see why that would be difficult. If you know you have just 
written x bytes to the whatever network method, you know how many bytes
of those were frame markers.


-Olli

&gt;<i>
</I>&gt;&gt;<i> Also why to have framing bytes and not the bytes related to http
</I>&gt;&gt;<i> handling?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Nothing would change for engines or JS code if HTTP headers were counted
</I>&gt;<i> in bufferedAmount. Since they are only sent when establishing a
</I>&gt;<i> connection, adding a small constant at the beginning will make no
</I>&gt;<i> difference to flow control. And the constant is going to be zero in
</I>&gt;<i> practice, because the data will immediately go where we can't see it.
</I>&gt;<i>
</I>&gt;<i> - WBR, Alexey Proskuryakov
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>











<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025417.html">[whatwg] WebSocket bufferedAmount includes overhead or not.
</A></li>
	<LI>Next message: <A HREF="025420.html">[whatwg] WebSocket bufferedAmount includes overhead or not.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25418">[ date ]</a>
              <a href="thread.html#25418">[ thread ]</a>
              <a href="subject.html#25418">[ subject ]</a>
              <a href="author.html#25418">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
