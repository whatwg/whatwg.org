<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Character encoding of document.open()ed documents
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Character%20encoding%20of%20document.open%28%29ed%20documents&In-Reply-To=%3CC19EFF71-B4E1-4F35-96D0-217AD752E0A5%40iki.fi%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025744.html">
   <LINK REL="Next"  HREF="025750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Character encoding of document.open()ed documents</H1>
<!--htdig_noindex-->
    <B>Henri Sivonen</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Character%20encoding%20of%20document.open%28%29ed%20documents&In-Reply-To=%3CC19EFF71-B4E1-4F35-96D0-217AD752E0A5%40iki.fi%3E"
       TITLE="[whatwg] Character encoding of document.open()ed documents">hsivonen at iki.fi
       </A><BR>
    <I>Wed Mar 31 07:37:59 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="025744.html">[whatwg] Character encoding of document.open()ed documents
</A></li>
        <LI>Next message: <A HREF="025750.html">[whatwg] Character encoding of document.open()ed documents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25745">[ date ]</a>
              <a href="thread.html#25745">[ thread ]</a>
              <a href="subject.html#25745">[ subject ]</a>
              <a href="author.html#25745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Mar 31, 2010, at 16:24, Boris Zbarsky wrote:

&gt;<i> On 3/31/10 7:12 AM, Henri Sivonen wrote:
</I>&gt;&gt;<i> Currently, the spec says that document.open() sets the document's character encoding to UTF-16. This is what IE does except IE uses the label &quot;unicode&quot; instead of &quot;UTF-16&quot;.
</I>&gt;&gt;<i> Demo: <A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/saved/438">http://software.hixie.ch/utilities/js/live-dom-viewer/saved/438</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Gecko and WebKit set document's character encoding to UTF-8 even though the parser operates on UTF-16.
</I>&gt;&gt;<i> Demo: <A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/saved/439">http://software.hixie.ch/utilities/js/live-dom-viewer/saved/439</A>
</I>&gt;<i> 
</I>&gt;<i> Is that what Gecko does?  Or does it set the document's character encoding to the character encoding of the page that called open()?  I believe it's actually the latter.
</I>&gt;<i> 
</I>&gt;&gt;<i> When loading external resources that don't have encoding labels, IE, Gecko and WebKit all use UTF-8 to decode the external resource.
</I>&gt;&gt;<i> Demo: <A HREF="http://software.hixie.ch/utilities/js/live-dom-viewer/saved/437">http://software.hixie.ch/utilities/js/live-dom-viewer/saved/437</A>
</I>&gt;<i> 
</I>&gt;<i> Again, UTF-8 or the encoding of the page that called open()?
</I>
Good point.

Gecko sets the document's character encoding to UTF-8 and uses UTF-8 to decode the external resource. WebKit uses the encoding of the opener. IE8 (both with compat view button pressed and not pressed) sets the document's character encoding to &quot;unicode&quot; and uses UTF-8 to decode the external resource. Opera uses Windows-1252 to decode the external resource.
<A HREF="http://hsivonen.iki.fi/test/moz/document-open-external-charset.htm">http://hsivonen.iki.fi/test/moz/document-open-external-charset.htm</A>

&gt;&gt;<i> None of IE, WebKit or Opera let the meta charset in a document.open()ed document have any effect
</I>&gt;<i> 
</I>&gt;<i> As in, it doesn't affect how external resources with no encoding labels are handled?
</I>
Right.

&gt;<i> Odd; I could have sworn it mattered in IE.  I distinctly recall Gecko having compat bugs of various sorts here for the external resource case at one point (as in, people reporting intranet apps and the like that worked in IE but not Gecko), and us trying pretty hard to fix them.
</I>
It seems to me it doesn't matter even in IE6:
<A HREF="http://hsivonen.iki.fi/test/moz/document-open-internal-charset.htm">http://hsivonen.iki.fi/test/moz/document-open-internal-charset.htm</A>

(WebKit seems to cache the charset of external resources, so it seems necessary to create a new incognito window in Chrome for each test run.)

-- 
Henri Sivonen
<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">hsivonen at iki.fi</A>
<A HREF="http://hsivonen.iki.fi/">http://hsivonen.iki.fi/</A>


</PRE>










<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025744.html">[whatwg] Character encoding of document.open()ed documents
</A></li>
	<LI>Next message: <A HREF="025750.html">[whatwg] Character encoding of document.open()ed documents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25745">[ date ]</a>
              <a href="thread.html#25745">[ thread ]</a>
              <a href="subject.html#25745">[ subject ]</a>
              <a href="author.html#25745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
