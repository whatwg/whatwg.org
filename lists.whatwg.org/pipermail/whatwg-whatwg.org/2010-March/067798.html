<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Offscreen canvas (or canvas for web workers).
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Offscreen%20canvas%20%28or%20canvas%20for%20web%20workers%29.&In-Reply-To=%3C2FC652F1-8B95-4DF3-B720-8813E2994FE2%40apple.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="067797.html">
   <LINK REL="Next"  HREF="067799.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Offscreen canvas (or canvas for web workers).</H1>
<!--htdig_noindex-->
    <B>Maciej Stachowiak</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Offscreen%20canvas%20%28or%20canvas%20for%20web%20workers%29.&In-Reply-To=%3C2FC652F1-8B95-4DF3-B720-8813E2994FE2%40apple.com%3E"
       TITLE="[whatwg] Offscreen canvas (or canvas for web workers).">mjs at apple.com
       </A><BR>
    <I>Fri Mar 12 22:07:15 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="067797.html">[whatwg] Offscreen canvas (or canvas for web workers).
</A></li>
        <LI>Next message: <A HREF="067799.html">[whatwg] Offscreen canvas (or canvas for web workers).
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67798">[ date ]</a>
              <a href="thread.html#67798">[ thread ]</a>
              <a href="subject.html#67798">[ subject ]</a>
              <a href="author.html#67798">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>
On Mar 12, 2010, at 6:20 PM, Jonas Sicking wrote:

&gt;<i> On Fri, Mar 12, 2010 at 4:19 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;  
</I>&gt;<i> wrote:
</I>&gt;&gt;<i> On Fri, Mar 12, 2010 at 3:38 PM, David Levin &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">levin at google.com</A>&gt;  
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Fri, Mar 12, 2010 at 2:35 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt;  
</I>&gt;&gt;&gt;<i> wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> On Fri, Mar 12, 2010 at 12:46 PM, Oliver Hunt &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">oliver at apple.com</A>&gt;  
</I>&gt;&gt;&gt;&gt;<i> wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> On Mar 12, 2010, at 12:16 PM, Jonas Sicking wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> I'm not saying that the proposed API is bad. It just doesn't  
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> seem to
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> solve the (seemingly most commonly requested) use case of
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> rotating/scaling images. So if we want to solve those use cases  
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> we
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> need to either come up with a separate API for that, or extend  
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> this
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> proposal to solve that use case somehow.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Just for reference I think one thing that people are forgetting  
</I>&gt;&gt;&gt;&gt;&gt;<i> that
</I>&gt;&gt;&gt;&gt;&gt;<i> there is a difference between
</I>&gt;&gt;&gt;&gt;&gt;<i> being computationally faster, and being more responsive.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> As I mentioned in my email, if you look at the steps listed,  
</I>&gt;&gt;&gt;&gt;<i> enough of
</I>&gt;&gt;&gt;&gt;<i> them happen *on the main thread* that you're spending far more of  
</I>&gt;&gt;&gt;&gt;<i> the
</I>&gt;&gt;&gt;&gt;<i> main threads CPU cycles than you'd like. Possibly even more than  
</I>&gt;&gt;&gt;&gt;<i> doing
</I>&gt;&gt;&gt;&gt;<i> all the resizing on the main thread.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> With the other improvements suggested by David things do definitely
</I>&gt;&gt;&gt;&gt;<i> look different, but those are not in a proposal yet.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> There is the other scenario I mentioned, but I'll see what I can  
</I>&gt;&gt;&gt;<i> do about
</I>&gt;&gt;&gt;<i> separately working up a proposal for adding those methods because  
</I>&gt;&gt;&gt;<i> they were
</I>&gt;&gt;&gt;<i> next on my list to deal with. (fromBlob/load may be enough for  
</I>&gt;&gt;&gt;<i> this.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that the other proposals that have been made has put toBlob on
</I>&gt;&gt;<i> HTMLCanvasElement, not on the context. That makes the most sense for
</I>&gt;&gt;<i> the main-thread canvas as that way its available on all contexts.
</I>&gt;<i>
</I>&gt;<i> Oh, another thing to keep in mind is that if/when we add fromBlob to
</I>&gt;<i> the main-thread canvas, it has to be asynchronous in order to avoid
</I>&gt;<i> main thread synchronous IO. This isn't a big deal, but I figured I
</I>&gt;<i> should mention it while we're on the subject.
</I>
This is part of why I think Blob is the wrong tool for the job - we  
really want to use a data type here that can promise synchronous  
access to the data. When you copy the canvas backing store to a new in- 
memory representation, it seems silly to put that behind an interface  
that's the same as data to which you can only promise async access,  
such as part of a file on disk. There's nothing about copying bits  
from one canvas to another that needs to be async.

(Also it's not clear to me why a Blob would be faster to copy from,  
copy to, or copy cross-thread than ImageData; I thought the motivation  
for adding it was to have a binary container that can be uploaded to a  
server via XHR.)


&gt;<i> In general I wonder if we should add API to convert directly between
</I>&gt;<i> Blob and ImageData. Or at least Blob-&gt;ImageData and
</I>&gt;<i> ImageData-&gt;ByteArray. That could avoid overhead of going through a
</I>&gt;<i> canvas context. That is probably a win no matter which thread we are
</I>&gt;<i> on.
</I>&gt;<i>
</I>&gt;<i> We could even add APIs to rotate and scale ImageData objects directly.
</I>&gt;<i> If those are asynchronous the implementation could easily implement
</I>&gt;<i> them using a background thread. I'm less sure that this is worth it
</I>&gt;<i> though given that you can implement this yourself using workers if we
</I>&gt;<i> add the other stuff we've talked about.
</I>
Scaling and rotation can be done with just pixels if you code it by  
hand, but you can get native code to do it for you if you can  
manipulate actually offscreen buffers - you just establish the  
appropriate transform before painting the ImageData. REally the  
question is, how much slower is a scaling or rotating image paint than  
an image paint with the identity transform? Is it more than twice as  
expensive? That's the only way copying image data to a background  
thread will give you a responsiveness win. I'd like to see some data  
to establish that this is the case, if scales and rotates are the only  
concrete use cases we have in mind.

Regards,
Maciej







-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20100312/b83ef1c8/attachment-0002.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20100312/b83ef1c8/attachment-0002.htm</A>&gt;
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="067797.html">[whatwg] Offscreen canvas (or canvas for web workers).
</A></li>
	<LI>Next message: <A HREF="067799.html">[whatwg] Offscreen canvas (or canvas for web workers).
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67798">[ date ]</a>
              <a href="thread.html#67798">[ thread ]</a>
              <a href="subject.html#67798">[ subject ]</a>
              <a href="author.html#67798">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
