<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] WebSocket bufferedAmount includes overhead or not.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20WebSocket%20bufferedAmount%20includes%20overhead%20or%20not.&In-Reply-To=%3C4B8F82C2.4070107%40helsinki.fi%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025403.html">
   <LINK REL="Next"  HREF="025407.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] WebSocket bufferedAmount includes overhead or not.</H1>
<!--htdig_noindex-->
    <B>Olli Pettay</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20WebSocket%20bufferedAmount%20includes%20overhead%20or%20not.&In-Reply-To=%3C4B8F82C2.4070107%40helsinki.fi%3E"
       TITLE="[whatwg] WebSocket bufferedAmount includes overhead or not.">Olli.Pettay at helsinki.fi
       </A><BR>
    <I>Thu Mar  4 01:52:02 PST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="025403.html">[whatwg] WebSocket bufferedAmount includes overhead or not.
</A></li>
        <LI>Next message: <A HREF="025407.html">[whatwg] WebSocket bufferedAmount includes overhead or not.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25405">[ date ]</a>
              <a href="thread.html#25405">[ thread ]</a>
              <a href="subject.html#25405">[ subject ]</a>
              <a href="author.html#25405">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On 3/4/10 4:42 AM, Fumitoshi Ukai (&#40284;&#39164;&#25991;&#25935;) wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I noticed that WebSocket spec updated to not inlcude framing overhead in
</I>&gt;<i> bufferedAmount.
</I>I asked that since from API point of view it doesn't make
much sense to have the frame bytes to be magically included in the 
bufferedAmount.
What if we change the protocol and require different amount framing
bytes?
Also why to have framing bytes and not the bytes related to http handling?

Also, XHR+progress events don't include http headers etc in the
.loaded or .total.


&gt;<i> <A HREF="http://lists.whatwg.org/pipermail/commit-watchers-whatwg.org/2010/003971.html">http://lists.whatwg.org/pipermail/commit-watchers-whatwg.org/2010/003971.html</A>
</I>&gt;<i> I tried to implement it in WebKit, but found it make hard to implement
</I>&gt;<i> correctly.
</I>Not hard at all in gecko's implementation (the patch is still waiting 
for a review and will be possibly updated to include the latest
changes to the protocol before pushing to hg repo).


&gt;<i> <A HREF="https://bugs.webkit.org/show_bug.cgi?id=35571">https://bugs.webkit.org/show_bug.cgi?id=35571</A>
</I>&gt;<i> It's easy after WebSocket is closed (just add length of message),
</I>right


&gt;<i> but
</I>&gt;<i> while it's open, we'll manage buffer including frame bytes
</I>In the patch for gecko there is a different buffer for each
&quot;message&quot;, so it is easy to count how many frame bytes are in the
buffers.


&gt;<i> and
</I>&gt;<i> underlying socket will write arbitrary length of the buffer (may not be
</I>&gt;<i> on frame boundary)
</I>&gt;<i> To get bufferdAmount correctly without framing overhead, we need to
</I>&gt;<i> parse the buffer again.  It's not light operation and it's challenge to
</I>&gt;<i> make it effective.
</I>&gt;<i> I think including frame overhead is much easier.
</I>

&gt;<i> Could you revert it?
</I>That would make the API worse, especially for web developers, IMO.
They shouldn't need to know about the protocol, they should just be able 
to use the API and understand easily what bufferedAmount means.



br,


-Olli



&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Fumitoshi Ukai
</I>&gt;<i>
</I>
</PRE>



















<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025403.html">[whatwg] WebSocket bufferedAmount includes overhead or not.
</A></li>
	<LI>Next message: <A HREF="025407.html">[whatwg] WebSocket bufferedAmount includes overhead or not.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25405">[ date ]</a>
              <a href="thread.html#25405">[ thread ]</a>
              <a href="subject.html#25405">[ subject ]</a>
              <a href="author.html#25405">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
