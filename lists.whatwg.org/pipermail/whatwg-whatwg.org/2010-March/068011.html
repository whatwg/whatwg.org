<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] WebSocket bufferedAmount includes overhead or not
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20WebSocket%20bufferedAmount%20includes%20overhead%20or%20not&In-Reply-To=%3Cop.vae70mtadopkj4%40fozzie.gothenburg.osa%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="068009.html">
   <LINK REL="Next"  HREF="068025.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] WebSocket bufferedAmount includes overhead or not</H1>
<!--htdig_noindex-->
    <B>Niklas Beischer</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20WebSocket%20bufferedAmount%20includes%20overhead%20or%20not&In-Reply-To=%3Cop.vae70mtadopkj4%40fozzie.gothenburg.osa%3E"
       TITLE="[whatwg] WebSocket bufferedAmount includes overhead or not">no at opera.com
       </A><BR>
    <I>Tue Mar 30 23:20:36 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="068009.html">[whatwg] WebSocket bufferedAmount includes overhead or not
</A></li>
        <LI>Next message: <A HREF="068025.html">[whatwg] WebSocket bufferedAmount includes overhead or not
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68011">[ date ]</a>
              <a href="thread.html#68011">[ thread ]</a>
              <a href="subject.html#68011">[ subject ]</a>
              <a href="author.html#68011">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Wed, 31 Mar 2010 09:38:21 +0300, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:

&gt;<i> On Tue, Mar 30, 2010 at 9:56 PM, Boris Zbarsky &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">bzbarsky at mit.edu</A>&gt; wrote:
</I>&gt;&gt;<i> On 3/30/10 10:22 AM, Jonas Sicking wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Making it implementation dependent is likely to lead to website
</I>&gt;&gt;&gt;<i> incompatibilities. Such as:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ws = new WebSocket(...);
</I>&gt;&gt;&gt;<i> ws.onopen = function() {
</I>&gt;&gt;&gt;<i>   ws.send(someString);
</I>&gt;&gt;&gt;<i>   if (ws.bufferedAmount&gt;  X) {
</I>&gt;&gt;&gt;<i>     doStuff();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can bufferedAmount not change due to data actually hitting the network
</I>&gt;&gt;<i> during the execution of this code?  As in, will all the someString data  
</I>&gt;&gt;<i> be
</I>&gt;&gt;<i> buffered immediately after that send() call?
</I>&gt;<i>
</I>&gt;<i> I would have expected bufferedAmount to only change as a result of an
</I>&gt;<i> event being posted to the main event loop.
</I>
I'm certainly no EcmaScript expert but now I'm confused. What event would  
that be? There is no 'onsent' event. Would bufferedAmount not change until  
there is an 'onerror' or 'onclosed' event?

BR,
  /niklas


&gt;<i> We generally try to avoid &quot;racy&quot; variables since people don't expect  
</I>&gt;<i> them. Consider for example
</I>&gt;<i>
</I>&gt;<i> if (ws.bufferedAmount &gt; X) {
</I>&gt;<i>   setUpSomeState();
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> try {
</I>&gt;<i>   doOtherThings();
</I>&gt;<i> }
</I>&gt;<i> finally {
</I>&gt;<i>   if (ws.bufferedAmount &gt; X) {
</I>&gt;<i>     cleanUpState();
</I>&gt;<i>   }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> I'd imagine most JS developers to expect the cleanup to always happen
</I>&gt;<i> if the setup did.
</I>


-- 
Niklas Beischer
Software Developer
Opera Software

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="068009.html">[whatwg] WebSocket bufferedAmount includes overhead or not
</A></li>
	<LI>Next message: <A HREF="068025.html">[whatwg] WebSocket bufferedAmount includes overhead or not
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68011">[ date ]</a>
              <a href="thread.html#68011">[ thread ]</a>
              <a href="subject.html#68011">[ subject ]</a>
              <a href="author.html#68011">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
