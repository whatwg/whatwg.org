<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] HTTP adaptive streaming of video (was Re: Video feedback)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20HTTP%20adaptive%20streaming%20of%20video%20%28was%20Re%3A%20Video%0A%20feedback%29&In-Reply-To=%3C3D1C098B-6BE2-4F2E-A76C-C032B8F0115B%40netflix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032201.html">
   <LINK REL="Next"  HREF="032209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] HTTP adaptive streaming of video (was Re: Video feedback)</H1>
<!--htdig_noindex-->
    <B>Mark Watson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20HTTP%20adaptive%20streaming%20of%20video%20%28was%20Re%3A%20Video%0A%20feedback%29&In-Reply-To=%3C3D1C098B-6BE2-4F2E-A76C-C032B8F0115B%40netflix.com%3E"
       TITLE="[whatwg] HTTP adaptive streaming of video (was Re: Video feedback)">watsonm at netflix.com
       </A><BR>
    <I>Tue Jun 21 03:01:23 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="032201.html">[whatwg] HTTP adaptive streaming of video (was Re: Video feedback)
</A></li>
        <LI>Next message: <A HREF="032209.html">[whatwg] comment on a part of the script execution spec, regarding not fully  active documents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32206">[ date ]</a>
              <a href="thread.html#32206">[ thread ]</a>
              <a href="subject.html#32206">[ subject ]</a>
              <a href="author.html#32206">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>
On Jun 21, 2011, at 3:32 AM, Silvia Pfeiffer wrote:

&gt;<i> Moving this to a different subject, since it's all about adaptive streaming now.
</I>&gt;<i> 
</I>&gt;<i> On Tue, Jun 21, 2011 at 1:43 AM, Mark Watson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">watsonm at netflix.com</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Jun 20, 2011, at 5:28 PM, Silvia Pfeiffer wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Tue, Jun 21, 2011 at 12:07 AM, Mark Watson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">watsonm at netflix.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> On Jun 20, 2011, at 11:52 AM, Silvia Pfeiffer wrote:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> On Mon, Jun 20, 2011 at 7:31 PM, Mark Watson &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">watsonm at netflix.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>
&lt;snip&gt;

&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> The way in which HTML deals with different devices and their different
</I>&gt;&gt;&gt;&gt;&gt;<i> capabilities is through media queries. As a author you provide your
</I>&gt;&gt;&gt;&gt;&gt;<i> content with different versions of media-dependent style sheets and
</I>&gt;&gt;&gt;&gt;&gt;<i> content, so that when you view the page with a different device, the
</I>&gt;&gt;&gt;&gt;&gt;<i> capabilities of the device select the right style sheet and content
</I>&gt;&gt;&gt;&gt;&gt;<i> for display on that device. Opera has an example on how to use this
</I>&gt;&gt;&gt;&gt;&gt;<i> here: <A HREF="http://dev.opera.com/articles/view/everything-you-need-to-know-about-html5-video-and-audio/">http://dev.opera.com/articles/view/everything-you-need-to-know-about-html5-video-and-audio/</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> (search for &quot;Media Query&quot;).
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> I believe that this mechanism should also work for adaptive streaming,
</I>&gt;&gt;&gt;&gt;&gt;<i> such that you provide multiple alternative media resources through the
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;source&gt; element, each of which has a @media attribute that says what
</I>&gt;&gt;&gt;&gt;&gt;<i> device capabilities that particular resource is adequate for. Except
</I>&gt;&gt;&gt;&gt;&gt;<i> that the &quot;media resource&quot; provides alternative bitrate files for that
</I>&gt;&gt;&gt;&gt;&gt;<i> case. I do not see a need to move this functionality into the adaptive
</I>&gt;&gt;&gt;&gt;&gt;<i> streaming file.
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Nice to get started on this discussion about adaptive streaming. ;-)
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Indeed.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> So, what I said above is that there is no rationale for a hierarchy. What I mean is that if I have ten encodings of a video, I should just list those ten in a flat list somewhere, annotated with their properties. The device knows best what it can support, what's appropriate etc. The key point is that I get this list without having to download the actual media.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> It's not a good idea to split up that list of ten into sub-lists &quot;intended&quot; for different devices, because then I am making assumptions about what kinds of devices there are and what they need. But it is the devices that know best. In DASH people often proposed splitting the list into &quot;Handheld&quot;, &quot;SD&quot; and &quot;HD&quot;, but then there are devices that happily cope with resolutions that span those categories. Consider a few such devices and you find you need finer granularity. Since we're talking about a tiny amount of descriptive metadata, its much simpler just to list them all in one flat list.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> So then there is the question of where this &quot;flat&quot; list should be: in the HTML or in an adaptive streaming manifest ?
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Here we have a genuine functional overlap. HTML provides information which drives a resource selection function which considers many things, such as container types, codecs and everything which can be expressed in Media Queries. Adaptive streaming manifests also provide the same information for the same &quot;selection&quot; purpose plus additional information supporting adaptive streaming as well. Much of the information which drives selection is also needed for adaptation. Also there is no strict split between &quot;adaptation&quot; and &quot;selection&quot;: the capabilities of clients may differ in terms of what they can seamlessly switch and what they can't.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> So, in integrating HTML and adaptive streaming we have to define the interactions between these overlapping selection functions - we cannot get away from this functional overlap.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I think it would be a bad idea to try and re-invent adaptive streaming in HTML itself. A lot of work has been done on this over the past few years and anything HTML starts from scratch will be way behind. For my part I would like to see adaptive streaming defined in a way which is independent of the presentation layer technology, so adaptive streams can be constructed which play both in HTML and in other places.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> The consequence is that we should not assume that an &quot;adaptive stream&quot; (for want of a better term) will be split up into multiple sources when used in HTML. Of course people can do this: if you want to provide 4 separate adaptive streams and use media queries to have the client select which one to play, that's fine, but we must also consider the case where everything is in one manifest.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Note that this is not what I suggested. I just believe we cab use both
</I>&gt;&gt;&gt;<i> approaches: Media Queries and adaptive streams. With media queries we
</I>&gt;&gt;&gt;<i> can more easily pre-select the first stream that is picked to be more
</I>&gt;&gt;&gt;<i> appropriate for the device that is being used, and we can make more
</I>&gt;&gt;&gt;<i> appropriate alternative streams. For example, if we use markup as
</I>&gt;&gt;&gt;<i> follows:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> &lt;video controls&gt;
</I>&gt;&gt;&gt;<i> &lt;source src=&quot;manifest1_ogv&quot; media=&quot;min-device-height:720px&quot; type=&quot;video/ogg&quot;&gt;
</I>&gt;&gt;&gt;<i> &lt;source src=&quot;manifest2_ogv&quot; media=&quot;max-device-height:720px&quot; type=&quot;video/ogg&quot;&gt;
</I>&gt;&gt;&gt;<i> &lt;source src=&quot;manifest1_mp4&quot; media=&quot;min-device-height:720px&quot; type=&quot;video/mp4&quot;&gt;
</I>&gt;&gt;&gt;<i> &lt;source src=&quot;manifest2_mp4&quot; media=&quot;max-device-height:720px&quot; type=&quot;video/mp4&quot;&gt;
</I>&gt;&gt;&gt;<i> &lt;/video&gt;
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> then we can have Ogg Theora or MP4 videos of different bandwidth and
</I>&gt;&gt;&gt;<i> screen size in manifest1 to manifest2 and the device will itself
</I>&gt;&gt;&gt;<i> decide which of the two first its screen height and then stick with
</I>&gt;&gt;&gt;<i> the streams in that manifest.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Right, and this is exactly the problem. What about a device where it's appropriate to range from 420px to 1080px ?
</I>&gt;<i> 
</I>&gt;<i> Surely you'd start with the highest resolution and try to keep it as
</I>&gt;<i> high as possible. So, it would pick the manifest1 option. Within that
</I>&gt;<i> option would be a whole bunch of alternatives at different bitrates
</I>&gt;<i> that provide enough choice for adaptability.
</I>
Ah, are you saying that manifest1 is a *superset* of manifest2 ? i.e. it contains all the lower rate streams as well ?

&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> If a group of files are from the start
</I>&gt;&gt;&gt;<i> excluded from being useful for a particular device because they are
</I>&gt;&gt;&gt;<i> unfit, it will make the switching much faster, so this is a good
</I>&gt;&gt;&gt;<i> thing.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I'm not sure how it will make switching faster.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Certainly, the first thing a client should do with a manifest is exclude the options which are not useful for that device, based on its capabilities.
</I>&gt;<i> 
</I>&gt;<i> It would be faster because this step would not be necessary, since it
</I>&gt;<i> has already been taken and been removed from the list of choices.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Whether that is done in HTML based on Media Queries, or within the adaptive streaming client based on information in the manifest makes no difference in terms of speed, except that your manifests above are smaller than a manifest containing all the streams. But manifests are anyway pretty small.
</I>&gt;<i> 
</I>&gt;<i> It does make a difference, because adaptation has to choose from all
</I>&gt;<i> the available acceptable options  and if the set of acceptable
</I>&gt;<i> alternatives has been made smaller, the algorithm to choose can focus
</I>&gt;<i> on less parameters, be simpler, and therefore faster.
</I>
Firstly, we're talking about processing small data sets with at most 10s of entries and a handful of parameters, so we're talking microseconds of processing time here, maybe small numbers of milliseconds on constrained devices.

Secondly, there's two steps. A first step &quot;prunes&quot; the available choices based on device capabilities. This step takes the same time whether it's done based on media queries at the HTML level or based on manifest annotations (possible media queries would be slower, because in their generality they are rather more complex than the annotations in a manifest).

The second step is what you describe above, where the adaptation process makes continuous choices amongst the remaining options. This is the same speed in both case.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Having separate sources for different container formats makes more sense, because it's unlikely anyone would ever support adaptive switching between container formats (though its certainly logically meaningful and technically possible). But still if I want to create an adaptive stream that is useful also in non-HTML contexts I would put all the container formats into one manifest.
</I>&gt;<i> 
</I>&gt;<i> You can always concatenate them if that is required.
</I>
Well, that depends on the Manifest format - bytewise concatenation would only work if the format supported it. Nevertheless, combination of multiple manifests is always easy. And I might still prefer to manage a single, combined, manifest for each content item, rather than have a bunch of sliced and diced versions to manage.

But actually, all I am saying is that it should not be a *design assumption* that there must be separate manifests for these different cases. Any design which supports a single combined manifest also supports smaller, targeted, ones which can be used as you propose above. In our system we effectively custom-craft a manifest for each individual device on request. That model needs to be supported, but not required.

...Mark

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Silvia.
</I>&gt;<i> 
</I>
</PRE>





































<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032201.html">[whatwg] HTTP adaptive streaming of video (was Re: Video feedback)
</A></li>
	<LI>Next message: <A HREF="032209.html">[whatwg] comment on a part of the script execution spec, regarding not fully  active documents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32206">[ date ]</a>
              <a href="thread.html#32206">[ thread ]</a>
              <a href="subject.html#32206">[ subject ]</a>
              <a href="author.html#32206">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
