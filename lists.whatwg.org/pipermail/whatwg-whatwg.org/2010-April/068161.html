<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] WebSocket bufferedAmount includes overhead or not
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20WebSocket%20bufferedAmount%20includes%20overhead%20or%20not&In-Reply-To=%3Cop.vauh3rxrdopkj4%40fozzie.gothenburg.osa%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="068060.html">
   <LINK REL="Next"  HREF="068162.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] WebSocket bufferedAmount includes overhead or not</H1>
<!--htdig_noindex-->
    <B>Niklas Beischer</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20WebSocket%20bufferedAmount%20includes%20overhead%20or%20not&In-Reply-To=%3Cop.vauh3rxrdopkj4%40fozzie.gothenburg.osa%3E"
       TITLE="[whatwg] WebSocket bufferedAmount includes overhead or not">no at opera.com
       </A><BR>
    <I>Thu Apr  8 05:22:29 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="068060.html">[whatwg] WebSocket bufferedAmount includes overhead or not
</A></li>
        <LI>Next message: <A HREF="068162.html">[whatwg] WebSocket bufferedAmount includes overhead or not
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68161">[ date ]</a>
              <a href="thread.html#68161">[ thread ]</a>
              <a href="subject.html#68161">[ subject ]</a>
              <a href="author.html#68161">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Fri, 02 Apr 2010 20:43:57 +0300, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:

&gt;<i> On Thu, Apr 1, 2010 at 8:15 PM, Boris Zbarsky &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">bzbarsky at mit.edu</A>&gt; wrote:
</I>&gt;&gt;<i> On 3/31/10 6:57 PM, Jonas Sicking wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I would expect that send() is allowed to start streaming data over the
</I>&gt;&gt;&gt;<i> network as soon as it can, but only update bufferedAmount from the
</I>&gt;&gt;&gt;<i> event loop.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Maybe I'm not being clear.  Let's say bufferedAmount were to reflect the
</I>&gt;&gt;<i> number of UTF-8-encoded bytes to be sent, for the sake of argument.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I wait until bufferedAmount is 0, then call send(&quot;My text&quot;).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What are possible values of bufferedAmount if I examine it right after  
</I>&gt;&gt;<i> the send() call?  Is 0 a valid possible value?  What about 1?  2? 3? 4?  
</I>&gt;&gt;<i> 5? 6? 7?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Presumably the value will be somewhere in the integer range [0,7],  
</I>&gt;&gt;<i> right? Or will it always be 7 after that call in that situation?
</I>&gt;<i>
</I>&gt;<i> In order to archive maximum interoperability and predictability I
</I>&gt;<i> think it should always be 7. So bufferedAmount is always adjusted
</I>&gt;<i> synchronously upwards by the length of the sent message by send(),
</I>
I think it should be pointed out that, since we in the current suggestion  
expose the serialization of the protocol in bufferedAmount, the length of  
the message passed in the call to send() may or may not differ from the  
value of bufferedAmount. Depending on whether or not you use non ASCII  
characters the bufferedAmount increase may be larger than the length of  
the original message string.


&gt;<i> and always adjusted downwards from events posted to the main event loop.
</I>
The event posting I completely agree with (thanks Jonas for teaching me a  
little something about EcmaScript execution :-) ). But for WebWorkers you  
would only need to notify the event loop connected to the WebWorker in  
question, right?


&gt;<i> Though it's possible that this is overengineering given how people are
</I>&gt;<i> likely to use bufferedAmount. Interested to hear opinions.
</I>
Just to be clear, I definitely prefer the current spec over completely  
hiding the serialization from the API. Though I wouldn't mind if we  
specified bufferedAmount to include protocol overhead and have it  
represent exactly the amount of bytes waiting to be pushed to the network.

BR,
  /niklas


-- 
Niklas Beischer
Software Developer
Opera Software

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="068060.html">[whatwg] WebSocket bufferedAmount includes overhead or not
</A></li>
	<LI>Next message: <A HREF="068162.html">[whatwg] WebSocket bufferedAmount includes overhead or not
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68161">[ date ]</a>
              <a href="thread.html#68161">[ thread ]</a>
              <a href="subject.html#68161">[ subject ]</a>
              <a href="author.html#68161">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
