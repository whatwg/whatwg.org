<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] When do scripts execute? (4.3.1)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20When%20do%20scripts%20execute%3F%20%284.3.1%29&In-Reply-To=%3C20090115154846.C88A714D983%40looneymail-mx2.g.dreamhost.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="060470.html">
   <LINK REL="Next"  HREF="060472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] When do scripts execute? (4.3.1)</H1>
<!--htdig_noindex-->
    <B>Kartikaya Gupta</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20When%20do%20scripts%20execute%3F%20%284.3.1%29&In-Reply-To=%3C20090115154846.C88A714D983%40looneymail-mx2.g.dreamhost.com%3E"
       TITLE="[whatwg] When do scripts execute? (4.3.1)">lists.whatwg at stakface.com
       </A><BR>
    <I>Thu Jan 15 07:48:30 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="060470.html">[whatwg] E4X and attribute values
</A></li>
        <LI>Next message: <A HREF="060472.html">[whatwg] When do scripts execute? (4.3.1)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60471">[ date ]</a>
              <a href="thread.html#60471">[ thread ]</a>
              <a href="subject.html#60471">[ subject ]</a>
              <a href="author.html#60471">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>I have a question about when scripts execute. From my reading of section 4.3.1 it seems like if script elements are created and added to the DOM via DOM operations, then they should NOT be marked as parser-inserted, and should get run immediately (assuming no defer/async stuff). However, a page that I constructed to test this (below) fails in FF, Opera, and Safari (didn't test IE). Am I misreading the spec, or does it not accurately reflect current behavior? I found [1] after poking through the archives a bit, and it's somewhat related, but doesn't address this issue directly.

&lt;div id=&quot;r&quot;&gt;NOTRUN&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
 var sn = document.createElement('script');
 sn.setAttribute( 'type', 'text/javascript' );
 sn.appendChild( document.createTextNode( 'document.getElementById(&quot;r&quot;).firstChild.data = &quot;PASS&quot;;' ) );
 document.body.appendChild( sn );        // this runs the script and sets r's text to PASS (verifiable by alert)

 sn = document.createElement( 'script' );
 sn.setAttribute( 'type', 'text/javascript' );
 document.body.appendChild( sn );        // this *should* run an empty script block and do nothing
 // the next line should have no effect since the script already ran
 sn.appendChild( document.createTextNode( 'document.getElementById(&quot;r&quot;).firstChild.data = &quot;FAIL&quot;;' ) );
 // here r's text is FAIL. why?
&lt;/script&gt;

[1] <A HREF="http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2007-May/011561.html">http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2007-May/011561.html</A>

Cheers,
kats

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="060470.html">[whatwg] E4X and attribute values
</A></li>
	<LI>Next message: <A HREF="060472.html">[whatwg] When do scripts execute? (4.3.1)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60471">[ date ]</a>
              <a href="thread.html#60471">[ thread ]</a>
              <a href="subject.html#60471">[ subject ]</a>
              <a href="author.html#60471">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
