<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Proposal: requestBackgroundProcessing()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Proposal%3A%20requestBackgroundProcessing%28%29&In-Reply-To=%3CCAABs73iJcgcPFC5cKn%3Dh1qHRCMfcaNNKm%3DjvVoKitWs8wOJKTQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="042058.html">
   <LINK REL="Next"  HREF="084337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Proposal: requestBackgroundProcessing()</H1>
<!--htdig_noindex-->
    <B>Ashley Gullen</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Proposal%3A%20requestBackgroundProcessing%28%29&In-Reply-To=%3CCAABs73iJcgcPFC5cKn%3Dh1qHRCMfcaNNKm%3DjvVoKitWs8wOJKTQ%40mail.gmail.com%3E"
       TITLE="[whatwg] Proposal: requestBackgroundProcessing()">ashley at scirra.com
       </A><BR>
    <I>Thu Feb 20 07:25:56 PST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="042058.html">[whatwg] URL spec and IDN
</A></li>
        <LI>Next message: <A HREF="084337.html">[whatwg] Proposal: requestBackgroundProcessing()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42063">[ date ]</a>
              <a href="thread.html#42063">[ thread ]</a>
              <a href="subject.html#42063">[ subject ]</a>
              <a href="author.html#42063">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>We're building a browser-based P2P multiplayer engine on top of WebRTC
DataChannels. You can try out our work-in-progress here:
<A HREF="http://www.scirra.com/labs/multiplayer/test1/">http://www.scirra.com/labs/multiplayer/test1/</A>

The first player in to a room is assigned the host, and all other
subsequently joining peers connect to the host with WebRTC DataChannels and
start exchanging game data. Like all responsible HTML5 games, it runs based
on a requestAnimationFrame loop. When switching tab, the
requestAnimationFrame loop stops, and most browsers also limit timers to 1
Hz in background tabs. This is a sensible strategy to avoid wasting
resources and draining battery from inactive tabs. However in the use case
of a WebRTC-based multiplayer game, the host is effectively acting as the
game server, and this basically hangs the server. If there were 20 peers
connected to the host, the game hangs for all 20 players.

Users regularly switch tabs and probably don't expect that this hangs the
game for everyone. To prevent multiplayer games commonly hanging, perhaps
there could be a new API to request that a page can keep running at full
capacity even in the background, such as
window.requestBackgroundProcessing(). This could show a permission prompt
like 'Do you want to allow this page to run in the background? Allow /
Deny' to help protect against abuse.

The formal definition could be: if background processing is approved, all
timer and requestAnimationFrame callbacks run with the same frequency they
would in &quot;visible&quot; state even when in &quot;hidden&quot; state (using the terms from
the Page Visibility API).

Alternatively browsers could automatically perform this if any WebRTC
DataChannel has been created by the page. However there are probably cases
where it doesn't matter if the DataChannel hangs or reduces to 1 Hz
response, and so it would still be good to save resources. Also, there may
be other use cases not involving WebRTC where it would be useful to run a
page in the background.

If this specific proposal does not seem appropriate, please consider
suggesting any other possible solutions to avoid multiplayer games hanging
when put in to a background tab - we've already run in to this with
testing, so it seems likely to affect real-world games too.

Ashley Gullen
Scirra.com
</PRE>
















<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="042058.html">[whatwg] URL spec and IDN
</A></li>
	<LI>Next message: <A HREF="084337.html">[whatwg] Proposal: requestBackgroundProcessing()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42063">[ date ]</a>
              <a href="thread.html#42063">[ thread ]</a>
              <a href="subject.html#42063">[ subject ]</a>
              <a href="author.html#42063">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
