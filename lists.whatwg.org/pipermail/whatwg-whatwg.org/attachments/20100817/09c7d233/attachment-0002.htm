<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
Jonas&nbsp;Sicking&nbsp;wrote:<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:AANLkTinbjJSvHZfAwsxxFC-bg-zBxjDbymuo3y8eUpCO@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;Tue,&nbsp;Aug&nbsp;17,&nbsp;2010&nbsp;at&nbsp;2:17&nbsp;PM,&nbsp;John&nbsp;J&nbsp;Barton<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:johnjbarton@johnjbarton.com&quot;&gt;&lt;johnjbarton@johnjbarton.com&gt;&lt;/a&gt;&nbsp;wrote:<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:whatwg-request@lists.whatwg.org&quot;&gt;whatwg-request@lists.whatwg.org&lt;/a&gt;&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Date:&nbsp;Mon,&nbsp;16&nbsp;Aug&nbsp;2010&nbsp;21:15:35&nbsp;-0700<br>
From:&nbsp;Jonas&nbsp;Sicking&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:jonas@sicking.cc&quot;&gt;&lt;jonas@sicking.cc&gt;&lt;/a&gt;<br>
To:&nbsp;WHAT&nbsp;Working&nbsp;Group&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:whatwg@whatwg.org&quot;&gt;&lt;whatwg@whatwg.org&gt;&lt;/a&gt;<br>
Subject:&nbsp;[whatwg]&nbsp;&lt;script&gt;&nbsp;features<br>
Message-ID:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:AANLkTin3t5ZB4DrUxJ8WS_hiuSgs3pMoZL8WOgRTCkfq@mail.gmail.com&quot;&gt;&lt;AANLkTin3t5ZB4DrUxJ8WS_hiuSgs3pMoZL8WOgRTCkfq@mail.gmail.com&gt;&lt;/a&gt;<br>
Content-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1<br>
<br>
Hi&nbsp;All,<br>
<br>
I'd&nbsp;like&nbsp;to&nbsp;propose&nbsp;a&nbsp;couple&nbsp;of&nbsp;simple&nbsp;features&nbsp;to&nbsp;make&nbsp;&lt;script&gt;<br>
elements&nbsp;more&nbsp;useful:<br>
<br>
1.&nbsp;document.currentScript<br>
<br>
This&nbsp;property&nbsp;returns&nbsp;the&nbsp;currently&nbsp;executing&nbsp;&lt;script&gt;,&nbsp;if&nbsp;any.<br>
Returns&nbsp;null&nbsp;if&nbsp;no&nbsp;&lt;script&gt;&nbsp;is&nbsp;currently&nbsp;executing.&nbsp;In&nbsp;the&nbsp;case&nbsp;of<br>
several&nbsp;nested&nbsp;executing&nbsp;&lt;script&gt;s,&nbsp;it&nbsp;returns&nbsp;the&nbsp;innermost&nbsp;one.&nbsp;This<br>
is&nbsp;useful&nbsp;for&nbsp;being&nbsp;able&nbsp;to&nbsp;pass&nbsp;parameters&nbsp;to&nbsp;the&nbsp;script&nbsp;by&nbsp;setting<br>
data-&nbsp;attributes&nbsp;on&nbsp;the&nbsp;script&nbsp;element.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I&nbsp;wonder&nbsp;if&nbsp;you&nbsp;mean:&nbsp;&quot;This&nbsp;property&nbsp;returns&nbsp;the&nbsp;&lt;script&gt;&nbsp;tag&nbsp;defining&nbsp;the<br>
currently&nbsp;executing&nbsp;top-level&nbsp;function&quot;?<br>
So&nbsp;for:<br>
&lt;script&gt;<br>
var&nbsp;foo&nbsp;=&nbsp;function()&nbsp;{<br>
alert(&quot;a&nbsp;foo&quot;);<br>
}<br>
foo();<br>
window.addEventListener(&quot;load&quot;,&nbsp;foo,&nbsp;false);<br>
&lt;/script&gt;<br>
the&nbsp;property&nbsp;will&nbsp;be&nbsp;null&nbsp;until&nbsp;the&nbsp;&lt;script&gt;&nbsp;tag&nbsp;is&nbsp;parsed&nbsp;and&nbsp;passed&nbsp;to&nbsp;the<br>
compiler.&nbsp;Then&nbsp;the&nbsp;property&nbsp;will&nbsp;point&nbsp;to&nbsp;the&nbsp;script&nbsp;tag&nbsp;during&nbsp;the<br>
execution&nbsp;of&nbsp;the&nbsp;outer&nbsp;or&nbsp;top&nbsp;level&nbsp;function&nbsp;which&nbsp;defines&nbsp;foo,&nbsp;calls&nbsp;foo,<br>
and&nbsp;sets&nbsp;foo&nbsp;as&nbsp;a&nbsp;load&nbsp;handler.&nbsp;Then&nbsp;the&nbsp;property&nbsp;is&nbsp;null&nbsp;again.&nbsp;When&nbsp;the<br>
load&nbsp;event&nbsp;runs,&nbsp;the&nbsp;property&nbsp;is&nbsp;null.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
That&nbsp;is&nbsp;correct.&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
Well&nbsp;either&nbsp;this&nbsp;is&nbsp;correct&nbsp;*or*&nbsp;you&nbsp;fire&nbsp;the&nbsp;event&nbsp;before&nbsp;compiling<br>
(see&nbsp;below).&nbsp;I&nbsp;think&nbsp;my&nbsp;description&nbsp;is&nbsp;not&nbsp;correct,&nbsp;and&nbsp;that's&nbsp;good.&lt;br&gt;<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:AANLkTinbjJSvHZfAwsxxFC-bg-zBxjDbymuo3y8eUpCO@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Though&nbsp;it's&nbsp;not&nbsp;related&nbsp;to&nbsp;if&nbsp;the&nbsp;script&nbsp;is&nbsp;top-level<br>
or&nbsp;not.&nbsp;It's&nbsp;simply&nbsp;related&nbsp;to&nbsp;*when*&nbsp;the&nbsp;script&nbsp;statements&nbsp;execute.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
(It's&nbsp;the&nbsp;function&nbsp;that&nbsp;is&nbsp;top-level.)&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;guess&nbsp;you&nbsp;mean&nbsp;by&nbsp;&quot;execute&nbsp;the&nbsp;&lt;script&gt;&quot;,&nbsp;&quot;compile&nbsp;the&nbsp;source<br>
in&nbsp;the&nbsp;tag&nbsp;and&nbsp;run&nbsp;the&nbsp;top-level&nbsp;function&quot;?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:AANLkTinbjJSvHZfAwsxxFC-bg-zBxjDbymuo3y8eUpCO@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;...<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
seeing.&nbsp;For&nbsp;example&nbsp;installing&nbsp;compatibility&nbsp;shims&nbsp;for&nbsp;older&nbsp;browsers.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;But&nbsp;by&nbsp;the&nbsp;time&nbsp;the&nbsp;functions&nbsp;execute,&nbsp;the&nbsp;environment&nbsp;of&nbsp;compilation&nbsp;has<br>
already&nbsp;been&nbsp;bound&nbsp;into&nbsp;the&nbsp;functions.&nbsp;I&nbsp;think&nbsp;you&nbsp;want&nbsp;the&nbsp;event&nbsp;*before*<br>
compilation.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
Sure&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
Ok,&nbsp;so&nbsp;before&nbsp;compilation&nbsp;and&nbsp;hence&nbsp;my&nbsp;description&nbsp;above&nbsp;is&nbsp;*not*<br>
correct.&nbsp;Good.<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:AANLkTinbjJSvHZfAwsxxFC-bg-zBxjDbymuo3y8eUpCO@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;(though&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;which&nbsp;environment&nbsp;is&nbsp;compiled&nbsp;in&nbsp;other&nbsp;than<br>
the&nbsp;global&nbsp;object,&nbsp;which&nbsp;you&nbsp;can't&nbsp;replace&nbsp;anyway,&nbsp;at&nbsp;least&nbsp;not&nbsp;for<br>
now).<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
Well&nbsp;if&nbsp;I&nbsp;intercept&nbsp;the&nbsp;event&nbsp;and&nbsp;change&nbsp;the&nbsp;source&nbsp;to&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;with(browserShim)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;script&nbsp;tag&nbsp;contents&nbsp;here....&lt;br&gt;<br>
&nbsp;&nbsp;}&lt;br&gt;<br>
Then&nbsp;I&nbsp;compile&nbsp;into&nbsp;another&nbsp;environment.&nbsp;Otherwise&nbsp;how&nbsp;can&nbsp;I&nbsp;achieve<br>
your&nbsp;goal?&lt;br&gt;<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:AANLkTinbjJSvHZfAwsxxFC-bg-zBxjDbymuo3y8eUpCO@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;If&nbsp;this&nbsp;kind&nbsp;of&nbsp;event&nbsp;were&nbsp;provided&nbsp;for&nbsp;all&nbsp;compilations,&nbsp;Javascript<br>
debugging&nbsp;would&nbsp;make&nbsp;a&nbsp;quantum&nbsp;leap&nbsp;forward&nbsp;in&nbsp;performance&nbsp;and&nbsp;reliability.<br>
Firebug,&nbsp;for&nbsp;example,&nbsp;uses&nbsp;egregious&nbsp;hacks&nbsp;to&nbsp;fake&nbsp;these&nbsp;events&nbsp;on&nbsp;the<br>
mozilla&nbsp;platform.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
This&nbsp;feature&nbsp;is&nbsp;not&nbsp;enough&nbsp;for&nbsp;that.&nbsp;For&nbsp;example&nbsp;this&nbsp;event&nbsp;is&nbsp;not<br>
fired&nbsp;for&nbsp;onXXX&nbsp;event&nbsp;handlers,&nbsp;calls&nbsp;to&nbsp;eval(),&nbsp;calls&nbsp;to&nbsp;the&nbsp;Function<br>
constructor,&nbsp;calls&nbsp;to&nbsp;WorkerGlobalScope.importScripts&nbsp;or&nbsp;loading&nbsp;of<br>
Workers&nbsp;and&nbsp;SharedWorkers.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
But&nbsp;if&nbsp;you&nbsp;don't&nbsp;cover&nbsp;these&nbsp;paths&nbsp;then&nbsp;I&nbsp;don't&nbsp;think&nbsp;the&nbsp;feature&nbsp;is<br>
complete,&nbsp;because&nbsp;what&nbsp;ever&nbsp;developers&nbsp;do&nbsp;in&nbsp;top-level&nbsp;functions&nbsp;of<br>
script&nbsp;tag&nbsp;source&nbsp;they&nbsp;do&nbsp;in&nbsp;all&nbsp;those&nbsp;other&nbsp;cases&nbsp;too.&lt;br&gt;<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:AANLkTinbjJSvHZfAwsxxFC-bg-zBxjDbymuo3y8eUpCO@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
For&nbsp;debugging&nbsp;APIs&nbsp;I&nbsp;suggest&nbsp;platform&nbsp;specific&nbsp;notification&nbsp;mechanisms<br>
as&nbsp;they&nbsp;are&nbsp;much&nbsp;more&nbsp;performant&nbsp;and&nbsp;easier&nbsp;to&nbsp;implement.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
Well&nbsp;I&nbsp;was&nbsp;just&nbsp;suggesting&nbsp;another&nbsp;use&nbsp;case&nbsp;for&nbsp;your&nbsp;suggested&nbsp;feature.<br>
You&nbsp;are&nbsp;suggesting&nbsp;an&nbsp;introspection&nbsp;feature&nbsp;that&nbsp;also&nbsp;has&nbsp;potential&nbsp;for<br>
debugging.&nbsp;Web&nbsp;debuggers&nbsp;are&nbsp;mostly&nbsp;based&nbsp;on&nbsp;introspection&nbsp;APIs,&nbsp;a<br>
notable&nbsp;exception&nbsp;being&nbsp;Javascript&nbsp;control.&nbsp;Your&nbsp;feature&nbsp;would&nbsp;be&nbsp;good<br>
step&nbsp;in&nbsp;that&nbsp;direction.&lt;br&gt;<br>
jjb&lt;br&gt;<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:AANLkTinbjJSvHZfAwsxxFC-bg-zBxjDbymuo3y8eUpCO@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
/&nbsp;Jonas<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>
<br>

</tt>
