<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;3,&nbsp;2009&nbsp;at&nbsp;1:32&nbsp;PM,&nbsp;Benjamin&nbsp;Smedberg&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:bsmedberg@mozilla.com&quot;&gt;bsmedberg@mozilla.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;9/3/09&nbsp;4:24&nbsp;PM,&nbsp;Drew&nbsp;Wilson&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;think&nbsp;the&nbsp;canonical&nbsp;racy&nbsp;case&nbsp;is&nbsp;&quot;the&nbsp;page&nbsp;wants&nbsp;to&nbsp;keep&nbsp;a&nbsp;counter&nbsp;for&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;number&nbsp;of&nbsp;times&nbsp;event&nbsp;X&nbsp;occurs&quot;&nbsp;in&nbsp;a&nbsp;cookie&nbsp;or&nbsp;local&nbsp;storage.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;doesn&#39;t&nbsp;seem&nbsp;to&nbsp;be&nbsp;possible&nbsp;to&nbsp;achieve&nbsp;this&nbsp;without&nbsp;the&nbsp;mutex&nbsp;-&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;proposal&nbsp;below&nbsp;would&nbsp;break&nbsp;down&nbsp;if&nbsp;two&nbsp;pages&nbsp;tried&nbsp;to&nbsp;increment&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;cookie&nbsp;value&nbsp;simultaneously&nbsp;(if&nbsp;both&nbsp;pages&nbsp;changed&nbsp;&quot;cookieValue=3&quot;&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;&quot;cookieValue=4&quot;&nbsp;at&nbsp;the&nbsp;same&nbsp;time,&nbsp;the&nbsp;result&nbsp;of&nbsp;your&nbsp;merge&nbsp;step&nbsp;would&lt;br&gt;<br>
&gt;&nbsp;likely&nbsp;be&nbsp;&quot;cookieValue=4&quot;,&nbsp;not&nbsp;&quot;cookieValue=5&quot;&nbsp;as&nbsp;one&nbsp;might&nbsp;intend).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Is&nbsp;that&nbsp;case&nbsp;important?&nbsp;I&nbsp;think&nbsp;that&nbsp;it&#39;s&nbsp;more&nbsp;important&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&lt;br&gt;<br>
script&nbsp;doesn&#39;t&nbsp;inadvertently&nbsp;remove&nbsp;or&nbsp;modify&nbsp;cookies&nbsp;due&nbsp;to&nbsp;races&nbsp;in&lt;br&gt;<br>
document.cookie,&nbsp;but&nbsp;that&nbsp;maintaining&nbsp;a&nbsp;single-threaded&nbsp;view&nbsp;of&nbsp;the&nbsp;cookie&lt;br&gt;<br>
data&nbsp;is&nbsp;not&nbsp;desirable.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&#39;re&nbsp;asking&nbsp;the&nbsp;wrong&nbsp;guy&nbsp;-&nbsp;I&#39;m&nbsp;in&nbsp;the&nbsp;&quot;don&#39;t&nbsp;bother&nbsp;trying&nbsp;to&nbsp;ensure&nbsp;consistency&quot;&nbsp;camp&nbsp;:)&nbsp;I&#39;m&nbsp;just&nbsp;parroting&nbsp;the&nbsp;arguments&nbsp;that&nbsp;were&nbsp;offered&nbsp;previously.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;I&nbsp;hadn&#39;t&nbsp;lost&nbsp;the&nbsp;arguments&nbsp;about&nbsp;providing&nbsp;workers&nbsp;access&nbsp;to&nbsp;cookies,&nbsp;then&nbsp;I&#39;d&nbsp;say&nbsp;that&nbsp;pages&nbsp;that&nbsp;care&nbsp;about&nbsp;cookie&nbsp;consistency&nbsp;should&nbsp;set&nbsp;cookies&nbsp;via&nbsp;a&nbsp;SharedWorker.&nbsp;But&nbsp;failing&nbsp;that,&nbsp;it&nbsp;seems&nbsp;like&nbsp;the&nbsp;choices&nbsp;are&nbsp;fairly&nbsp;stark:&nbsp;ensure&nbsp;consistency&nbsp;and&nbsp;take&nbsp;the&nbsp;performance&nbsp;hit&nbsp;in&nbsp;all&nbsp;multi-threaded&nbsp;browsers,&nbsp;or&nbsp;explicitly&nbsp;disavow&nbsp;consistency,&nbsp;and&nbsp;console&nbsp;ourselves&nbsp;by&nbsp;making&nbsp;our&nbsp;future&nbsp;APIs&nbsp;more&nbsp;multi-process&nbsp;friendly.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;do&nbsp;understand&nbsp;the&nbsp;point&nbsp;of&nbsp;view&nbsp;of&nbsp;the&nbsp;&quot;correctness&nbsp;over&nbsp;performance&quot;&nbsp;camp&nbsp;-&nbsp;however,&nbsp;as&nbsp;Jeremy&nbsp;points&nbsp;out,&nbsp;it&nbsp;doesn&#39;t&nbsp;sound&nbsp;like&nbsp;those&nbsp;arguments&nbsp;have&nbsp;gotten&nbsp;much&nbsp;traction&nbsp;with&nbsp;actual&nbsp;implementors&nbsp;yet.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;br&gt;<br>
--BDS&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
