<tt>
(Apologies&nbsp;if&nbsp;the&nbsp;threading&nbsp;on&nbsp;this&nbsp;gets&nbsp;messed&nbsp;up.&nbsp;&nbsp;I&nbsp;was&nbsp;not&nbsp;subscribed&nbsp;to&nbsp;the&nbsp;list&nbsp;when&nbsp;the&nbsp;original&nbsp;message&nbsp;was&nbsp;sent.)&lt;br&gt;&lt;br&gt;I&nbsp;want&nbsp;to&nbsp;paint&nbsp;Eric&#39;s&nbsp;scenario&nbsp;more&nbsp;strongly,&nbsp;because&nbsp;it&nbsp;seems&nbsp;like&nbsp;people&nbsp;think&nbsp;if&nbsp;it&nbsp;would&nbsp;rarely&nbsp;blow&nbsp;up&nbsp;then&nbsp;it&nbsp;doesn&#39;t&nbsp;matter.&lt;br&gt;<br>
&lt;br&gt;If&nbsp;you&nbsp;want&nbsp;to&nbsp;handle&nbsp;_any_&nbsp;request&nbsp;sent&nbsp;by&nbsp;a&nbsp;synchronous&nbsp;postMessage,&nbsp;and&nbsp;you&nbsp;aren&#39;t&nbsp;a&nbsp;cowboy&nbsp;programmer,&nbsp;you&nbsp;_must_&nbsp;either&nbsp;call&nbsp;no&nbsp;functions,&nbsp;or&nbsp;use&nbsp;a&nbsp;setTimeout()&nbsp;continuation.&nbsp;&nbsp;You&nbsp;CANNOT&nbsp;know&nbsp;how&nbsp;deep&nbsp;your&nbsp;caller&#39;s&nbsp;stack&nbsp;is,&nbsp;so&nbsp;you&nbsp;CANNOT&nbsp;safely&nbsp;do&nbsp;anything&nbsp;that&nbsp;could&nbsp;add&nbsp;to&nbsp;the&nbsp;stack&nbsp;depth.&nbsp;&nbsp;It&nbsp;doesn&#39;t&nbsp;matter&nbsp;if&nbsp;the&nbsp;stack&nbsp;will&nbsp;not&nbsp;_commonly_&nbsp;be&nbsp;too&nbsp;deep,&nbsp;or&nbsp;if&nbsp;it&nbsp;isn&#39;t&nbsp;too&nbsp;deep&nbsp;for&nbsp;the&nbsp;callers&nbsp;that&nbsp;you&nbsp;know&nbsp;about&nbsp;right&nbsp;now&nbsp;--&nbsp;it&nbsp;might&nbsp;be&nbsp;too&nbsp;deep&nbsp;at&nbsp;some&nbsp;point&nbsp;(after&nbsp;someone&nbsp;else&nbsp;changes&nbsp;the&nbsp;caller&nbsp;code,&nbsp;for&nbsp;example),&nbsp;and&nbsp;your&nbsp;sync&nbsp;handler&nbsp;will&nbsp;blow&nbsp;up.&nbsp;&nbsp;And&nbsp;the&nbsp;very&nbsp;sorts&nbsp;of&nbsp;things&nbsp;you&#39;d&nbsp;want&nbsp;postMessage&nbsp;for&nbsp;are&nbsp;frequently&nbsp;cases&nbsp;where&nbsp;others&nbsp;will&nbsp;write&nbsp;mashups&nbsp;and&nbsp;use&nbsp;your&nbsp;code&nbsp;in&nbsp;ways&nbsp;you&nbsp;hadn&#39;t&nbsp;planned.&nbsp;&nbsp;For&nbsp;this&nbsp;reason,&nbsp;I&nbsp;think&nbsp;talking&nbsp;about&nbsp;&quot;the&nbsp;common&nbsp;case&quot;&nbsp;misses&nbsp;the&nbsp;point&nbsp;--&nbsp;a&nbsp;sync&nbsp;API&nbsp;is&nbsp;completely&nbsp;useless&nbsp;to&nbsp;anyone&nbsp;trying&nbsp;to&nbsp;write&nbsp;_any_&nbsp;serious&nbsp;code&nbsp;defensively,&nbsp;large&nbsp;app&nbsp;or&nbsp;small,&nbsp;because&nbsp;it&nbsp;cannot&nbsp;be&nbsp;made&nbsp;safe&nbsp;except&nbsp;by&nbsp;using&nbsp;setTimeout&nbsp;to&nbsp;make&nbsp;it&nbsp;async,&nbsp;at&nbsp;which&nbsp;point&nbsp;synchronicity&nbsp;has&nbsp;bought&nbsp;you&nbsp;nothing.&nbsp;&nbsp;On&nbsp;the&nbsp;contrary,&nbsp;it&nbsp;has&nbsp;added&nbsp;great&nbsp;risk,&nbsp;because&nbsp;any&nbsp;coder&nbsp;who&nbsp;fails&nbsp;to&nbsp;understand&nbsp;the&nbsp;threat&nbsp;posed&nbsp;here&nbsp;and&nbsp;fails&nbsp;to&nbsp;transform&nbsp;all&nbsp;postMessage&nbsp;handlers&nbsp;into&nbsp;async&nbsp;ones&nbsp;risks&nbsp;his&nbsp;code&nbsp;blowing&nbsp;up.&nbsp;&nbsp;I&nbsp;prefer&nbsp;not&nbsp;to&nbsp;have&nbsp;APIs&nbsp;that&nbsp;force&nbsp;you&nbsp;to&nbsp;take&nbsp;action&nbsp;if&nbsp;you&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;shoot&nbsp;yourself&nbsp;in&nbsp;the&nbsp;head.&lt;br&gt;<br>
&lt;br&gt;If&nbsp;you&#39;re&nbsp;still&nbsp;not&nbsp;convinced&nbsp;that&nbsp;coders&nbsp;would&nbsp;care,&nbsp;remember&nbsp;that&nbsp;stack&nbsp;depths&nbsp;vary&nbsp;by&nbsp;interpreter,&nbsp;too.&nbsp;&nbsp;I&nbsp;believe&nbsp;in&nbsp;pocket&nbsp;IE&nbsp;you&nbsp;have&nbsp;a&nbsp;ridiculously&nbsp;small&nbsp;stack&nbsp;depth&nbsp;[12?].&nbsp;&nbsp;On&nbsp;this&nbsp;kind&nbsp;of&nbsp;platform,&nbsp;the&nbsp;recursion&nbsp;limits&nbsp;get&nbsp;hit&nbsp;in&nbsp;the&nbsp;common&nbsp;case&nbsp;rather&nbsp;than&nbsp;the&nbsp;uncommon,&nbsp;even&nbsp;in&nbsp;today&#39;s&nbsp;code&nbsp;without&nbsp;postMessage().&nbsp;&nbsp;While&nbsp;other&nbsp;mobile&nbsp;devices&nbsp;may&nbsp;be&nbsp;a&nbsp;little&nbsp;more&nbsp;forgiving,&nbsp;smaller&nbsp;recursion&nbsp;limits&nbsp;are&nbsp;always&nbsp;going&nbsp;to&nbsp;be&nbsp;more&nbsp;likely&nbsp;on&nbsp;embedded&nbsp;devices,&nbsp;and&nbsp;embedded&nbsp;devices&nbsp;are&nbsp;just&nbsp;going&nbsp;to&nbsp;get&nbsp;more&nbsp;popular.&lt;br&gt;<br>
&lt;br&gt;And&nbsp;as&nbsp;Eric&nbsp;mentioned,&nbsp;even&nbsp;on&nbsp;desktop&nbsp;browsers,&nbsp;apps&nbsp;of&nbsp;any&nbsp;reasonable&nbsp;size&nbsp;(like&nbsp;gmail)&nbsp;already&nbsp;jump&nbsp;through&nbsp;hoops&nbsp;TODAY&nbsp;to&nbsp;avoid&nbsp;getting&nbsp;near&nbsp;any&nbsp;stack&nbsp;limits.&nbsp;&nbsp;This&nbsp;isn&#39;t&nbsp;some&nbsp;vague&nbsp;theoretical&nbsp;concern.&nbsp;&nbsp;It&#39;s&nbsp;very&nbsp;real&nbsp;and&nbsp;already&nbsp;impacts&nbsp;web&nbsp;apps.&nbsp;&nbsp;So&nbsp;if&nbsp;we&#39;re&nbsp;trying&nbsp;to&nbsp;write&nbsp;APIs&nbsp;to&nbsp;enable&nbsp;even&nbsp;more&nbsp;powerful,&nbsp;more&nbsp;robust&nbsp;web&nbsp;applications,&nbsp;sync&nbsp;postMessage&nbsp;completely&nbsp;fails&nbsp;to&nbsp;accomplish&nbsp;that.&lt;br&gt;<br>
&lt;br&gt;Below&nbsp;I&nbsp;have&nbsp;some&nbsp;less&nbsp;important&nbsp;replies&nbsp;to&nbsp;various&nbsp;points&nbsp;in&nbsp;Jeff&#39;s&nbsp;post.&lt;br&gt;&lt;br&gt;Jeff&nbsp;Walden&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
Eric&nbsp;Seidel&nbsp;wrote:&lt;br&gt;&gt;&nbsp;1.&nbsp;JS&nbsp;content&nbsp;authors&nbsp;will&nbsp;want&nbsp;an&nbsp;async&nbsp;API.&lt;br&gt;&lt;br&gt;Sometimes,&nbsp;for&nbsp;the&nbsp;large&nbsp;applications;&nbsp;small&nbsp;apps&nbsp;won&#39;t&nbsp;care.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Besides&nbsp;the&nbsp;comments&nbsp;I&nbsp;wrote&nbsp;above&nbsp;that&nbsp;amount&nbsp;to&nbsp;&quot;all&nbsp;the&nbsp;time,&nbsp;for&nbsp;all&nbsp;large&nbsp;apps,&nbsp;and&nbsp;most&nbsp;small&nbsp;ones&nbsp;too,&nbsp;you&nbsp;will&nbsp;want&nbsp;async&nbsp;for&nbsp;safety&quot;:&lt;br&gt;<br>
&lt;br&gt;I&nbsp;admit&nbsp;to&nbsp;spending&nbsp;more&nbsp;time&nbsp;in&nbsp;the&nbsp;C++&nbsp;space&nbsp;than&nbsp;the&nbsp;JS&nbsp;space,&nbsp;but&nbsp;it&nbsp;seems&nbsp;like&nbsp;in&nbsp;most&nbsp;cases&nbsp;where&nbsp;you&#39;d&nbsp;actually&nbsp;want&nbsp;to&nbsp;call&nbsp;postMessage,&nbsp;you&nbsp;don&#39;t&nbsp;really&nbsp;know&nbsp;how&nbsp;long&nbsp;the&nbsp;target&nbsp;may&nbsp;take&nbsp;to&nbsp;act&nbsp;on&nbsp;your&nbsp;request,&nbsp;and&nbsp;you&nbsp;don&#39;t&nbsp;necessarily&nbsp;want&nbsp;to&nbsp;block.&nbsp;&nbsp;The&nbsp;async&nbsp;use&nbsp;case&nbsp;seems&nbsp;more&nbsp;common&nbsp;to&nbsp;me.&lt;br&gt;<br>
&lt;br&gt;(Incidentally,&nbsp;I&nbsp;also&nbsp;find&nbsp;the&nbsp;name&nbsp;bizarre.&nbsp;&nbsp;If&nbsp;it&#39;s&nbsp;a&nbsp;sync&nbsp;API,&nbsp;why&nbsp;not&nbsp;&quot;callFunction&quot;&nbsp;or&nbsp;at&nbsp;the&nbsp;very&nbsp;least&nbsp;&quot;sendMessage&quot;,&nbsp;which&nbsp;[in&nbsp;Windows&nbsp;land]&nbsp;doesn&#39;t&nbsp;imply&nbsp;asynchronicity&nbsp;the&nbsp;way&nbsp;&quot;postMessage&quot;&nbsp;does&nbsp;[in&nbsp;both&nbsp;the&nbsp;Windows&nbsp;and&nbsp;common-english-usage&nbsp;senses&nbsp;of&nbsp;&quot;post&quot;].)&lt;br&gt;<br>
&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;As&nbsp;you&nbsp;note,&nbsp;the&nbsp;workaround&nbsp;of&nbsp;immediately&nbsp;packaging&nbsp;up&nbsp;a&nbsp;setTimeout&nbsp;continuation&nbsp;isn&#39;t&nbsp;difficult.&nbsp;I&nbsp;tend&nbsp;to&nbsp;think&nbsp;worrying&nbsp;about&nbsp;the&nbsp;N-1&nbsp;case&nbsp;is&nbsp;designing&nbsp;a&nbsp;bit&nbsp;too&nbsp;much&nbsp;for&nbsp;the&nbsp;special&nbsp;cases,&nbsp;personally.&nbsp;Special&nbsp;cases&nbsp;aren&#39;t&nbsp;special&nbsp;enough&nbsp;to&nbsp;break&nbsp;the&nbsp;rules.[0]&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;Again,&nbsp;ignoring&nbsp;my&nbsp;&quot;this&nbsp;isn&#39;t&nbsp;a&nbsp;special&nbsp;case&quot;&nbsp;comments:&lt;br&gt;&lt;br&gt;Given&nbsp;the&nbsp;number&nbsp;of&nbsp;websites&nbsp;relying&nbsp;on&nbsp;this&nbsp;feature&nbsp;right&nbsp;now&nbsp;(0?),&nbsp;how&nbsp;do&nbsp;you&nbsp;know&nbsp;what&nbsp;the&nbsp;special&nbsp;cases&nbsp;are?&nbsp;&nbsp;I&#39;m&nbsp;skeptical&nbsp;that&nbsp;async&nbsp;usage&nbsp;is&nbsp;so&nbsp;exceptional&nbsp;as&nbsp;you&nbsp;seem&nbsp;to&nbsp;think.&nbsp;&nbsp;Besides&nbsp;my&nbsp;own&nbsp;intuition&nbsp;above,&nbsp;the&nbsp;JS&nbsp;developers&nbsp;at&nbsp;Google&nbsp;I&#39;ve&nbsp;spoken&nbsp;to&nbsp;have&nbsp;all&nbsp;been&nbsp;surprised&nbsp;postMessage&nbsp;is&nbsp;currently&nbsp;specified&nbsp;to&nbsp;be&nbsp;synchronous&nbsp;--&nbsp;they&nbsp;were&nbsp;all&nbsp;expecting&nbsp;async.&lt;br&gt;<br>
&lt;/div&gt;&lt;br&gt;setTimeout&nbsp;may&nbsp;not&nbsp;be&nbsp;terribly&nbsp;difficult,&nbsp;but&nbsp;if&nbsp;it&#39;s&nbsp;the&nbsp;common&nbsp;case,&nbsp;it&nbsp;also&nbsp;forces&nbsp;the&nbsp;JS&nbsp;engine&nbsp;to&nbsp;jump&nbsp;through&nbsp;hoops&nbsp;that&nbsp;it&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;for&nbsp;no&nbsp;benefit,&nbsp;forces&nbsp;programmers&nbsp;to&nbsp;contort&nbsp;their&nbsp;app&nbsp;in&nbsp;ways&nbsp;that&nbsp;don&#39;t&nbsp;express&nbsp;their&nbsp;intent&nbsp;as&nbsp;well,&nbsp;and&nbsp;is&nbsp;less&nbsp;obvious&nbsp;to&nbsp;someone&nbsp;newly&nbsp;approaching&nbsp;the&nbsp;API.&lt;br&gt;<br>
&lt;br&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;Further,&nbsp;nothing&nbsp;says&nbsp;browser&nbsp;implementations&nbsp;must&nbsp;or&nbsp;will&nbsp;continue&nbsp;to&nbsp;enforce&nbsp;hard&nbsp;limits&nbsp;on&nbsp;recursion.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;br&gt;Nothing&nbsp;says&nbsp;they&nbsp;won&#39;t,&nbsp;either.&nbsp;&nbsp;And&nbsp;when&nbsp;the&nbsp;status&nbsp;quo&nbsp;is&nbsp;that&nbsp;they&nbsp;do,&nbsp;I&nbsp;will&nbsp;believe&nbsp;this&nbsp;restriction&nbsp;will&nbsp;disappear&nbsp;when&nbsp;I&nbsp;see&nbsp;it.&lt;br&gt;&lt;br&gt;Even&nbsp;if,&nbsp;say,&nbsp;SpiderMonkey&nbsp;stops&nbsp;enforcing&nbsp;a&nbsp;recursion&nbsp;limit,&nbsp;so&nbsp;what?&nbsp;&nbsp;If&nbsp;I&nbsp;want&nbsp;my&nbsp;app&nbsp;to&nbsp;actually&nbsp;run&nbsp;everywhere,&nbsp;I&nbsp;need&nbsp;to&nbsp;assume&nbsp;the&nbsp;limit&nbsp;is&nbsp;present&nbsp;until&nbsp;_every_&nbsp;UA&nbsp;gets&nbsp;rid&nbsp;of&nbsp;it.&nbsp;&nbsp;Surely&nbsp;you&nbsp;agree&nbsp;the&nbsp;chances&nbsp;of&nbsp;that&nbsp;happening&nbsp;are&nbsp;small.&nbsp;&nbsp;See&nbsp;my&nbsp;comments&nbsp;at&nbsp;top&nbsp;about&nbsp;mobile&nbsp;devices,&nbsp;where&nbsp;these&nbsp;limits&nbsp;make&nbsp;lots&nbsp;of&nbsp;sense.&lt;br&gt;<br>
&lt;br&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;Making&nbsp;the&nbsp;API&nbsp;async&nbsp;basically&nbsp;requires&nbsp;the&nbsp;optional&nbsp;origin&nbsp;argument&nbsp;always&nbsp;be&nbsp;provided&nbsp;to&nbsp;postMessage,&nbsp;adding&nbsp;API&nbsp;complexity.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;br&gt;I&nbsp;don&#39;t&nbsp;really&nbsp;see&nbsp;how&nbsp;making&nbsp;an&nbsp;optional&nbsp;argument&nbsp;be&nbsp;a&nbsp;non-optional&nbsp;argument&nbsp;would&nbsp;result&nbsp;in&nbsp;a&nbsp;more&nbsp;complex&nbsp;API.&nbsp;&nbsp;It&nbsp;doesn&#39;t&nbsp;raise&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;arguments&nbsp;to&nbsp;provide,&nbsp;and&nbsp;it&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;forms&nbsp;the&nbsp;function&nbsp;takes&nbsp;by&nbsp;one.&nbsp;&nbsp;Furthermore,&nbsp;if&nbsp;a&nbsp;recipient&nbsp;needs&nbsp;to&nbsp;handle&nbsp;the&nbsp;message&nbsp;asynchronously&nbsp;via&nbsp;setTimeout,&nbsp;they&#39;ll&nbsp;need&nbsp;this&nbsp;anyway.&nbsp;&nbsp;Forcing&nbsp;callers&nbsp;to&nbsp;provide&nbsp;it&nbsp;is&nbsp;a&nbsp;security&nbsp;win&nbsp;at&nbsp;that&nbsp;point,&nbsp;not&nbsp;a&nbsp;loss.&lt;br&gt;<br>
&lt;br&gt;Or,&nbsp;if&nbsp;you&nbsp;like,&nbsp;take&nbsp;the&nbsp;position&nbsp;that&nbsp;the&nbsp;argument&nbsp;should&nbsp;stay&nbsp;optional,&nbsp;and&nbsp;if&nbsp;someone&nbsp;for&nbsp;some&nbsp;reason&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;care&nbsp;about&nbsp;security&nbsp;(?!),&nbsp;they&nbsp;can&nbsp;avoid&nbsp;passing&nbsp;it.&nbsp;&nbsp;Although&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;this&nbsp;is&nbsp;a&nbsp;particularly&nbsp;great&nbsp;idea&nbsp;:)&lt;br&gt;<br>
&lt;font&nbsp;style=&quot;font-family:&nbsp;arial,sans-serif;&quot;&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;font&nbsp;style=&quot;font-family:&nbsp;arial,sans-serif;&quot;&nbsp;size=&quot;2&quot;&gt;If&nbsp;some&nbsp;piece&nbsp;of&nbsp;JS&nbsp;is&nbsp;in&nbsp;flight,&nbsp;every&nbsp;client-side&nbsp;change&nbsp;it&nbsp;can&nbsp;detect&nbsp;*must*&nbsp;be&nbsp;one&nbsp;it&nbsp;has&nbsp;caused.&lt;/font&gt;&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;Are&nbsp;you&nbsp;sure?&nbsp;&nbsp;I&#39;m&nbsp;reading&nbsp;the&nbsp;docs&nbsp;in&nbsp;section&nbsp;4.1.4,&nbsp;and&nbsp;it&nbsp;seems&nbsp;to&nbsp;say&nbsp;that&nbsp;this&nbsp;is&nbsp;only&nbsp;true&nbsp;for&nbsp;changes&nbsp;within&nbsp;the&nbsp;unit&nbsp;of&nbsp;related&nbsp;browsing&nbsp;contexts.&nbsp;&nbsp;If&nbsp;it&nbsp;is&nbsp;possible&nbsp;to&nbsp;get&nbsp;a&nbsp;reference&nbsp;to&nbsp;a&nbsp;Window&nbsp;outside&nbsp;this&nbsp;group,&nbsp;then&nbsp;your&nbsp;statement&nbsp;is&nbsp;untrue.&nbsp;&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;whether&nbsp;that&#39;s&nbsp;possible.&lt;br&gt;<br>
&lt;br&gt;PK&lt;br&gt;&lt;/div&gt;<br>

</tt>
