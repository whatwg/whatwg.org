<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;agree&nbsp;with&nbsp;Drew's&nbsp;assessment&nbsp;that&nbsp;MessagePorts&nbsp;in&nbsp;combination&nbsp;with&nbsp;Workers&nbsp;are&nbsp;extremely&nbsp;complicated&nbsp;to&nbsp;implement&nbsp;correctly,&nbsp;as&nbsp;currently&nbsp;specified.&nbsp;In&nbsp;fact,&nbsp;the&nbsp;design&nbsp;seems&nbsp;to&nbsp;push&nbsp;towards&nbsp;having&nbsp;lockable&nbsp;shared&nbsp;state,&nbsp;even&nbsp;though&nbsp;one&nbsp;potential&nbsp;advantage&nbsp;of&nbsp;the&nbsp;message&nbsp;passing&nbsp;design&nbsp;is&nbsp;to&nbsp;avoid&nbsp;locking&nbsp;and&nbsp;shared&nbsp;state.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Besides&nbsp;removing&nbsp;MessagePorts&nbsp;as&nbsp;a&nbsp;way&nbsp;to&nbsp;communicate&nbsp;with&nbsp;workers,&nbsp;another&nbsp;possibility&nbsp;is&nbsp;simplifying&nbsp;the&nbsp;life&nbsp;cycle&nbsp;requirements.&nbsp;For&nbsp;example,&nbsp;getting&nbsp;rid&nbsp;of&nbsp;the&nbsp;keepalive&nbsp;rule,&nbsp;whereby&nbsp;both&nbsp;MessagePorts&nbsp;remain&nbsp;live&nbsp;so&nbsp;long&nbsp;as&nbsp;either&nbsp;is&nbsp;otherwise&nbsp;live,&nbsp;would&nbsp;remove&nbsp;the&nbsp;majority&nbsp;of&nbsp;the&nbsp;complexity.&nbsp;I&nbsp;don't&nbsp;think&nbsp;the&nbsp;slight&nbsp;convenience&nbsp;of&nbsp;that&nbsp;rule&nbsp;is&nbsp;worth&nbsp;the&nbsp;extra&nbsp;implementation&nbsp;cost.&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;May&nbsp;7,&nbsp;2009,&nbsp;at&nbsp;1:39&nbsp;PM,&nbsp;Drew&nbsp;Wilson&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Hi&nbsp;all,&lt;br&gt;&lt;br&gt;I've&nbsp;been&nbsp;hashing&nbsp;through&nbsp;a&nbsp;bunch&nbsp;of&nbsp;the&nbsp;design&nbsp;issues&nbsp;around&nbsp;using&nbsp;MessagePorts&nbsp;within&nbsp;Workers&nbsp;with&nbsp;IanH&nbsp;and&nbsp;the&nbsp;Chrome/WebKit&nbsp;teams&nbsp;and&nbsp;I&nbsp;wanted&nbsp;to&nbsp;follow&nbsp;up&nbsp;with&nbsp;the&nbsp;list&nbsp;with&nbsp;my&nbsp;progress.&lt;br&gt;&lt;br&gt;The&nbsp;problems&nbsp;we've&nbsp;encountered&nbsp;are&nbsp;all&nbsp;solveable,&nbsp;but&nbsp;I've&nbsp;been&nbsp;surprised&nbsp;at&nbsp;the&nbsp;amount&nbsp;of&nbsp;work&nbsp;involved&nbsp;in&nbsp;implementing&nbsp;worker&nbsp;MessagePorts&nbsp;(and&nbsp;the&nbsp;resulting&nbsp;implications&nbsp;that&nbsp;MessagePorts&nbsp;have&nbsp;on&nbsp;worker&nbsp;lifecycles/reachability).&nbsp;My&nbsp;concern&nbsp;is&nbsp;that&nbsp;the&nbsp;amount&nbsp;of&nbsp;work&nbsp;to&nbsp;implement&nbsp;MessagePorts&nbsp;within&nbsp;Worker&nbsp;context&nbsp;may&nbsp;be&nbsp;so&nbsp;high&nbsp;that&nbsp;it&nbsp;will&nbsp;prevent&nbsp;vendors&nbsp;from&nbsp;implementing&nbsp;the&nbsp;SharedWorker&nbsp;API.&nbsp;Have&nbsp;other&nbsp;implementers&nbsp;started&nbsp;working&nbsp;on&nbsp;this&nbsp;part&nbsp;of&nbsp;the&nbsp;spec&nbsp;yet?&lt;br&gt;&nbsp;&lt;br&gt;Let&nbsp;me&nbsp;quickly&nbsp;run&nbsp;down&nbsp;some&nbsp;of&nbsp;the&nbsp;implementation&nbsp;issues&nbsp;I've&nbsp;run&nbsp;into&nbsp;-&nbsp;some&nbsp;of&nbsp;these&nbsp;may&nbsp;be&nbsp;WebKit/Chrome&nbsp;specific,&nbsp;but&nbsp;other&nbsp;browsers&nbsp;may&nbsp;run&nbsp;into&nbsp;some&nbsp;of&nbsp;them&nbsp;as&nbsp;well:&lt;br&gt;&lt;br&gt;1)&nbsp;MessagePort&nbsp;reachability&nbsp;is&nbsp;challenging&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;separate&nbsp;Worker&nbsp;heaps&lt;br&gt;&nbsp;&lt;br&gt;In&nbsp;WebKit,&nbsp;each&nbsp;worker&nbsp;has&nbsp;its&nbsp;own&nbsp;heap&nbsp;(in&nbsp;Chrome,&nbsp;they&nbsp;will&nbsp;have&nbsp;their&nbsp;own&nbsp;process&nbsp;as&nbsp;well).&nbsp;The&nbsp;spec&nbsp;reads:&lt;br&gt;&lt;blockquote&gt;&lt;p&gt;User&nbsp;agents&nbsp;must&nbsp;act&nbsp;as&nbsp;if&nbsp;&lt;code&gt;&lt;a&nbsp;href=&quot;http://www.w3.org/TR/html5/comms.html#messageport&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt;&nbsp;objects&nbsp;have&nbsp;&nbsp;a&nbsp;strong&nbsp;reference&nbsp;to&nbsp;their&nbsp;entangled&nbsp;&lt;code&gt;&lt;a&nbsp;href=&quot;http://www.w3.org/TR/html5/comms.html#messageport&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt;&nbsp;&nbsp;object.&lt;/p&gt;&lt;div&nbsp;class=&quot;note&quot;&gt;&lt;p&gt;Thus,&nbsp;a&nbsp;message&nbsp;port&nbsp;can&nbsp;be&nbsp;received,&nbsp;given&nbsp;an&nbsp;event&nbsp;listener,&nbsp;&nbsp;&nbsp;and&nbsp;then&nbsp;forgotten,&nbsp;and&nbsp;so&nbsp;long&nbsp;as&nbsp;that&nbsp;event&nbsp;listener&nbsp;could&nbsp;&nbsp;&nbsp;receive&nbsp;a&nbsp;message,&nbsp;the&nbsp;channel&nbsp;will&nbsp;be&nbsp;maintained.&lt;/p&gt;&lt;p&gt;Of&nbsp;course,&nbsp;if&nbsp;this&nbsp;was&nbsp;to&nbsp;occur&nbsp;on&nbsp;both&nbsp;sides&nbsp;of&nbsp;the&nbsp;channel,&nbsp;&nbsp;&nbsp;then&nbsp;both&nbsp;ports&nbsp;would&nbsp;be&nbsp;garbage&nbsp;collected,&nbsp;since&nbsp;they&nbsp;would&nbsp;not&nbsp;be&nbsp;&nbsp;&nbsp;reachable&nbsp;from&nbsp;live&nbsp;code,&nbsp;despite&nbsp;having&nbsp;a&nbsp;strong&nbsp;reference&nbsp;to&nbsp;each&nbsp;&nbsp;&nbsp;other.&lt;/p&gt;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;p&gt;Furthermore,&nbsp;a&nbsp;&lt;code&gt;&lt;a&nbsp;href=&quot;http://www.w3.org/TR/html5/comms.html#messageport&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt;&nbsp;object&nbsp;must&nbsp;not&nbsp;be&nbsp;&nbsp;garbage&nbsp;collected&nbsp;while&nbsp;there&nbsp;exists&nbsp;a&nbsp;message&nbsp;in&nbsp;a&nbsp;&lt;a&nbsp;href=&quot;http://www.w3.org/TR/html5/browsers.html#task-queue&quot;&gt;task&nbsp;&nbsp;queue&lt;/a&gt;&nbsp;that&nbsp;is&nbsp;to&nbsp;be&nbsp;dispatched&nbsp;on&nbsp;that&nbsp;&nbsp;&lt;code&gt;&lt;a&nbsp;href=&quot;http://www.w3.org/TR/html5/comms.html#messageport&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt;&nbsp;object,&nbsp;or&nbsp;while&nbsp;the&nbsp;&nbsp;&lt;code&gt;&lt;a&nbsp;href=&quot;http://www.w3.org/TR/html5/comms.html#messageport&quot;&gt;MessagePort&lt;/a&gt;&lt;/code&gt;&nbsp;object's&nbsp;&lt;a&nbsp;href=&quot;http://www.w3.org/TR/html5/comms.html#port-message-queue&quot;&gt;port&nbsp;message&nbsp;queue&lt;/a&gt;&nbsp;is&nbsp;&nbsp;open&nbsp;and&nbsp;there&nbsp;exists&nbsp;a&nbsp;&lt;code&nbsp;title=&quot;event-message&quot;&gt;&lt;a&nbsp;href=&quot;http://www.w3.org/TR/html5/comms.html#event-message&quot;&gt;message&lt;/a&gt;&lt;/code&gt;&nbsp;&nbsp;event&nbsp;in&nbsp;that&nbsp;queue.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;The&nbsp;end&nbsp;result&nbsp;of&nbsp;this&nbsp;is&nbsp;the&nbsp;need&nbsp;to&nbsp;track&nbsp;some&nbsp;common&nbsp;state&nbsp;across&nbsp;an&nbsp;entangled&nbsp;MessagePort&nbsp;pair&nbsp;such&nbsp;as:&nbsp;number&nbsp;of&nbsp;outstanding&nbsp;messages,&nbsp;open&nbsp;state&nbsp;of&nbsp;each&nbsp;end,&nbsp;and&nbsp;number&nbsp;of&nbsp;active&nbsp;references&nbsp;to&nbsp;each&nbsp;port&nbsp;(zero&nbsp;or&nbsp;non-zero).&nbsp;Turns&nbsp;out&nbsp;this&nbsp;last&nbsp;bit&nbsp;will&nbsp;require&nbsp;adding&nbsp;new&nbsp;hooks&nbsp;to&nbsp;the&nbsp;JavaScriptCore&nbsp;garbage&nbsp;collector&nbsp;to&nbsp;detect&nbsp;transitioning&nbsp;between&nbsp;1&nbsp;and&nbsp;0&nbsp;references&nbsp;without&nbsp;actually&nbsp;freeing&nbsp;the&nbsp;object&nbsp;-&nbsp;not&nbsp;that&nbsp;difficult,&nbsp;but&nbsp;possibly&nbsp;something&nbsp;that&nbsp;other&nbsp;implementers&nbsp;should&nbsp;keep&nbsp;in&nbsp;mind.&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;2)&nbsp;MessagePorts&nbsp;dramatically&nbsp;change&nbsp;the&nbsp;worker&nbsp;lifecycle&lt;/p&gt;&lt;p&gt;Having&nbsp;MessagePorts&nbsp;in&nbsp;worker&nbsp;context&nbsp;means&nbsp;that&nbsp;Workers&nbsp;can&nbsp;outlive&nbsp;their&nbsp;parent&nbsp;window(s)&nbsp;-&nbsp;I&nbsp;can&nbsp;create&nbsp;a&nbsp;worker,&nbsp;pass&nbsp;off&nbsp;an&nbsp;entangled&nbsp;MessagePort&nbsp;to&nbsp;another&nbsp;window&nbsp;(say,&nbsp;to&nbsp;a&nbsp;different&nbsp;domain),&nbsp;then&nbsp;close&nbsp;the&nbsp;original&nbsp;window,&nbsp;and&nbsp;the&nbsp;worker&nbsp;should&nbsp;stay&nbsp;alive.&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;WebKit,&nbsp;this&nbsp;causes&nbsp;some&nbsp;problems&nbsp;for&nbsp;things&nbsp;like&nbsp;worker-initiated&nbsp;network&nbsp;requests&nbsp;-&nbsp;if&nbsp;workers&nbsp;can&nbsp;continue&nbsp;to&nbsp;run&nbsp;even&nbsp;though&nbsp;there&nbsp;are&nbsp;no&nbsp;open&nbsp;windows&nbsp;for&nbsp;that&nbsp;origin,&nbsp;then&nbsp;it&nbsp;becomes&nbsp;problematic&nbsp;to&nbsp;perform&nbsp;network&nbsp;requests&nbsp;(part&nbsp;of&nbsp;this&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;architecture&nbsp;of&nbsp;WebKit&nbsp;which&nbsp;requires&nbsp;proxying&nbsp;network&nbsp;requests&nbsp;to&nbsp;window&nbsp;context,&nbsp;but&nbsp;part&nbsp;of&nbsp;this&nbsp;is&nbsp;just&nbsp;a&nbsp;general&nbsp;problem&nbsp;of&nbsp;&quot;how&nbsp;do&nbsp;you&nbsp;handle&nbsp;things&nbsp;like&nbsp;HTTP&nbsp;Auth&nbsp;when&nbsp;there&nbsp;are&nbsp;no&nbsp;open&nbsp;windows&nbsp;for&nbsp;that&nbsp;origin?&quot;)&lt;/p&gt;&lt;p&gt;Finally,&nbsp;the&nbsp;spec&nbsp;defines&nbsp;a&nbsp;fairly&nbsp;broad&nbsp;definition&nbsp;of&nbsp;what&nbsp;makes&nbsp;a&nbsp;worker&nbsp;reachable&nbsp;-&nbsp;here's&nbsp;an&nbsp;excerpt&nbsp;from&nbsp;my&nbsp;WebKit&nbsp;Shared&nbsp;Worker&nbsp;design&nbsp;doc,&nbsp;where&nbsp;I&nbsp;summarize&nbsp;the&nbsp;spec&nbsp;(possibly&nbsp;incorrectly&nbsp;-&nbsp;feel&nbsp;free&nbsp;to&nbsp;correct&nbsp;any&nbsp;misconceptions):&lt;/p&gt;&nbsp;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;h5&gt;Permissible&lt;/h5&gt;&lt;div&gt;The&nbsp;spec&nbsp;specifies&nbsp;that&nbsp;a&nbsp;worker&nbsp;is&nbsp;&lt;i&gt;permissible&lt;/i&gt;&nbsp;based&nbsp;on&nbsp;whether&nbsp;it&nbsp;has&nbsp;a&nbsp;reachable&nbsp;MessagePort&nbsp;that&nbsp;has&nbsp;been&nbsp;entangled&nbsp;&lt;i&gt;at&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;past&lt;/i&gt;&nbsp;with&nbsp;an&nbsp;active&nbsp;window&nbsp;(or&nbsp;with&nbsp;a&nbsp;worker&nbsp;who&nbsp;is&nbsp;itself&nbsp;permissible).&nbsp;Basically,&nbsp;if&nbsp;a&nbsp;worker&nbsp;has&nbsp;&lt;b&gt;ever&lt;/b&gt;&nbsp;been&nbsp;entangled&nbsp;with&nbsp;an&nbsp;active&nbsp;window,&nbsp;or&nbsp;if&nbsp;it's&nbsp;ever&nbsp;been&nbsp;entangled&nbsp;with&nbsp;a&nbsp;worker&nbsp;who&nbsp;is&nbsp;itself&nbsp;permissible&nbsp;(i.e.&nbsp;it's&nbsp;associated&nbsp;with&nbsp;an&nbsp;active&nbsp;window&nbsp;via&nbsp;a&nbsp;chain&nbsp;of&nbsp;workers&nbsp;that&nbsp;have&nbsp;been&nbsp;entangled&nbsp;at&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;past)&nbsp;then&nbsp;it's&nbsp;permissible.&nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;reason&nbsp;why&nbsp;the&nbsp;&quot;at&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;past&quot;&nbsp;language&nbsp;is&nbsp;present&nbsp;is&nbsp;to&nbsp;allow&nbsp;a&nbsp;page&nbsp;to&nbsp;create&nbsp;a&nbsp;fire-and-forget&nbsp;worker&nbsp;(for&nbsp;example,&nbsp;a&nbsp;worker&nbsp;that&nbsp;does&nbsp;a&nbsp;set&nbsp;of&nbsp;long&nbsp;network&nbsp;operations)&nbsp;without&nbsp;having&nbsp;to&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;that&nbsp;worker&nbsp;around.&nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Once&nbsp;the&nbsp;referent&nbsp;windows&nbsp;close,&nbsp;the&nbsp;worker&nbsp;should&nbsp;also&nbsp;close,&nbsp;as&nbsp;being&nbsp;permissible&nbsp;is&nbsp;a&nbsp;necessary&nbsp;(but&nbsp;not&nbsp;sufficient)&nbsp;criteria&nbsp;for&nbsp;being&nbsp;runnable.&nbsp;&lt;/div&gt;&lt;h5&gt;Active&nbsp;needed&lt;/h5&gt;&lt;div&gt;A&nbsp;permissible&nbsp;worker&nbsp;is&nbsp;&lt;i&gt;active&nbsp;needed&lt;/i&gt;&nbsp;if:&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;it&nbsp;has&nbsp;pending&nbsp;timers/network&nbsp;requests/DB&nbsp;activity,&nbsp;or&lt;/li&gt;&lt;li&gt;it&nbsp;is&nbsp;currently&nbsp;entangled&nbsp;with&nbsp;an&nbsp;active&nbsp;window,&nbsp;or&nbsp;another&nbsp;active&nbsp;needed&nbsp;worker.&nbsp;&lt;/li&gt;&nbsp;&lt;/ol&gt;&lt;br&gt;The&nbsp;intent&nbsp;behind&nbsp;#1&nbsp;is&nbsp;to&nbsp;enable&nbsp;fire-and-forget&nbsp;workers&nbsp;that&nbsp;don't&nbsp;exit&nbsp;until&nbsp;they&nbsp;are&nbsp;idle.&nbsp;The&nbsp;intent&nbsp;behind&nbsp;#2&nbsp;is&nbsp;that&nbsp;an&nbsp;idle&nbsp;worker&nbsp;shouldn't&nbsp;exit&nbsp;as&nbsp;long&nbsp;as&nbsp;it's&nbsp;reachable&nbsp;by&nbsp;an&nbsp;active&nbsp;window&nbsp;(possibly&nbsp;chained&nbsp;through&nbsp;other&nbsp;workers).&lt;/div&gt;&lt;span&nbsp;style=&quot;background-color:&nbsp;rgb(255,&nbsp;229,&nbsp;153);&quot;&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;p&gt;The&nbsp;end&nbsp;result&nbsp;is&nbsp;that&nbsp;for&nbsp;each&nbsp;worker&nbsp;we&nbsp;need&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;a&nbsp;big&nbsp;list&nbsp;of&nbsp;every&nbsp;window&nbsp;it's&nbsp;ever&nbsp;been&nbsp;entangled&nbsp;with.&nbsp;As&nbsp;workers&nbsp;become&nbsp;entangled&nbsp;with&nbsp;other&nbsp;workers,&nbsp;they&nbsp;each&nbsp;inherit&nbsp;the&nbsp;list&nbsp;of&nbsp;entangled&nbsp;windows&nbsp;from&nbsp;the&nbsp;other&nbsp;worker.&nbsp;As&nbsp;windows&nbsp;become&nbsp;inactive,&nbsp;we&nbsp;then&nbsp;walk&nbsp;the&nbsp;lists&nbsp;of&nbsp;every&nbsp;worker&nbsp;to&nbsp;remove&nbsp;references&nbsp;to&nbsp;the&nbsp;window&nbsp;and&nbsp;properly&nbsp;shutdown&nbsp;the&nbsp;worker&nbsp;as&nbsp;appropriate.&nbsp;All&nbsp;of&nbsp;this&nbsp;with&nbsp;the&nbsp;appropriate&nbsp;cross-thread&nbsp;synchronization,&nbsp;of&nbsp;course&nbsp;:)&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;Likewise,&nbsp;determining&nbsp;when&nbsp;a&nbsp;worker&nbsp;is&nbsp;active&nbsp;needed&nbsp;requires&nbsp;tracking&nbsp;a&nbsp;graph&nbsp;of&nbsp;entangled&nbsp;message&nbsp;ports,&nbsp;and&nbsp;walking&nbsp;that&nbsp;graph&nbsp;to&nbsp;determine&nbsp;whether&nbsp;a&nbsp;given&nbsp;worker&nbsp;is&nbsp;reachable&nbsp;by&nbsp;any&nbsp;active&nbsp;window.&nbsp;Typically&nbsp;this&nbsp;is&nbsp;only&nbsp;needed&nbsp;when&nbsp;either&nbsp;a&nbsp;window&nbsp;closes,&nbsp;or&nbsp;when&nbsp;a&nbsp;worker&nbsp;goes&nbsp;idle.&lt;/p&gt;&lt;p&gt;Again,&nbsp;none&nbsp;of&nbsp;these&nbsp;issues&nbsp;individually&nbsp;are&nbsp;insurmountable,&nbsp;but&nbsp;in&nbsp;total&nbsp;they&nbsp;add&nbsp;up&nbsp;to&nbsp;a&nbsp;significant&nbsp;amount&nbsp;of&nbsp;work&nbsp;for&nbsp;what&nbsp;should&nbsp;be&nbsp;a&nbsp;fairly&nbsp;incremental&nbsp;improvement&nbsp;(going&nbsp;from&nbsp;dedicated&nbsp;workers&nbsp;to&nbsp;shared&nbsp;workers).&nbsp;Have&nbsp;other&nbsp;vendors&nbsp;started&nbsp;investigating&nbsp;what&nbsp;it&nbsp;takes&nbsp;to&nbsp;implement&nbsp;SharedWorkers&nbsp;(and&nbsp;therefore&nbsp;MessagePorts&nbsp;in&nbsp;workers)?&lt;/p&gt;&lt;p&gt;Another&nbsp;approach&nbsp;for&nbsp;SharedWorkers&nbsp;would&nbsp;be&nbsp;to&nbsp;give&nbsp;them&nbsp;an&nbsp;implicit&nbsp;MessagePort-esque&nbsp;API&nbsp;like&nbsp;dedicated&nbsp;Workers&nbsp;and&nbsp;not&nbsp;allow&nbsp;passing&nbsp;in&nbsp;MessagePorts&nbsp;to&nbsp;postMessage().&nbsp;This&nbsp;would&nbsp;mean&nbsp;that&nbsp;references&nbsp;to&nbsp;workers&nbsp;can't&nbsp;really&nbsp;be&nbsp;passed&nbsp;around&nbsp;to&nbsp;other&nbsp;windows/workers,&nbsp;but&nbsp;rather&nbsp;are&nbsp;kept&nbsp;per-origin.&nbsp;Dedicated&nbsp;workers&nbsp;could&nbsp;work&nbsp;as&nbsp;they&nbsp;do&nbsp;now&nbsp;in&nbsp;Firefox/WebKit&nbsp;(with&nbsp;no&nbsp;MessagePorts).&nbsp;The&nbsp;SharedWorker&nbsp;lifecycle&nbsp;could&nbsp;be&nbsp;significantly&nbsp;simplified&nbsp;such&nbsp;that&nbsp;a&nbsp;SharedWorker&nbsp;is&nbsp;permissible&nbsp;as&nbsp;long&nbsp;as&nbsp;there's&nbsp;an&nbsp;active&nbsp;window&nbsp;under&nbsp;the&nbsp;same&nbsp;origin&nbsp;(no&nbsp;more&nbsp;walking&nbsp;some&nbsp;distributed&nbsp;cross-thread&nbsp;dependency&nbsp;graph).&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;The&nbsp;thing&nbsp;we'd&nbsp;give&nbsp;up&nbsp;is&nbsp;the&nbsp;capabilities-based&nbsp;API&nbsp;that&nbsp;MessagePorts&nbsp;provide,&nbsp;but&nbsp;I'd&nbsp;argue&nbsp;that&nbsp;the&nbsp;workaround&nbsp;is&nbsp;simple:&nbsp;the&nbsp;creating&nbsp;window&nbsp;can&nbsp;just&nbsp;act&nbsp;as&nbsp;a&nbsp;proxy&nbsp;for&nbsp;the&nbsp;worker.&nbsp;IMO,&nbsp;the&nbsp;implementation&nbsp;burden&nbsp;far&nbsp;outstrips&nbsp;the&nbsp;benefit&nbsp;of&nbsp;allowing&nbsp;direct&nbsp;foreign&nbsp;access&nbsp;to&nbsp;workers.&nbsp;Literally&nbsp;90%&nbsp;of&nbsp;the&nbsp;work&nbsp;on&nbsp;my&nbsp;plate&nbsp;for&nbsp;SharedWorkers&nbsp;seems&nbsp;to&nbsp;derive&nbsp;from&nbsp;MessagePorts&nbsp;in&nbsp;one&nbsp;form&nbsp;or&nbsp;another,&nbsp;which&nbsp;seems&nbsp;completely&nbsp;wrong.&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;I'd&nbsp;like&nbsp;to&nbsp;hear&nbsp;your&nbsp;thoughts&nbsp;on&nbsp;this&nbsp;-&nbsp;are&nbsp;people&nbsp;open&nbsp;to&nbsp;removing&nbsp;MessagePort&nbsp;support&nbsp;from&nbsp;Workers?&lt;br&gt;&lt;/p&gt;&lt;p&gt;-atw&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
