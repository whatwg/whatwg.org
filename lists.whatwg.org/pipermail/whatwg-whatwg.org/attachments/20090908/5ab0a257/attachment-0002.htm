<tt>
I&#39;m&nbsp;happy&nbsp;to&nbsp;see&nbsp;this&nbsp;getting&nbsp;sorted&nbsp;out. I&nbsp;like&nbsp;maciej&#39;s&nbsp;idea&nbsp;too.&lt;div&gt;&lt;div&gt;- &lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;13px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;&quot;&gt;Keep&nbsp;the&nbsp;current&nbsp;LocalStorage&nbsp;API,&nbsp;but&nbsp;make&nbsp;it&nbsp;give&nbsp;no&nbsp;concurrency&nbsp;guarantees&nbsp;whatsoever.&nbsp;(IE&#39;s&nbsp;impl&nbsp;i&nbsp;think)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;13px;&nbsp;&quot;&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&quot;&gt;- &lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;13px;&nbsp;&quot;&gt;Add&nbsp;a&nbsp;simple&nbsp;optional&nbsp;transactional&nbsp;model&nbsp;for&nbsp;aware&nbsp;authors&nbsp;who&nbsp;want&nbsp;better&nbsp;consistency&nbsp;guarantees.&lt;/span&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&quot;&gt;There&nbsp;is&nbsp;one&nbsp;use-case&nbsp;to&nbsp;keep&nbsp;in&nbsp;mind...&nbsp;setting&nbsp;key/values&nbsp;onunload...&nbsp;how&nbsp;can&nbsp;we&nbsp;provide&nbsp;transactional&nbsp;access&nbsp;at&nbsp;that&nbsp;time? Maybe&nbsp;we&nbsp;could guarantee that&nbsp;transact&nbsp;calls&nbsp;made&nbsp;in&nbsp;(and&nbsp;perhaps&nbsp;prior&nbsp;to) &lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;separate;&nbsp;font-family:&nbsp;verdana,&nbsp;helvetica,&nbsp;arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;11px;&nbsp;&quot;&gt;onbeforeunload &lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;small;&nbsp;border-collapse:&nbsp;collapse;&nbsp;&quot;&gt;will&nbsp;be&nbsp;satisfied&nbsp;prior&nbsp;to&nbsp;onunload.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Sep&nbsp;8,&nbsp;2009&nbsp;at&nbsp;6:21&nbsp;PM,&nbsp;Jeremy&nbsp;Orlow&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:jorlow@chromium.org&quot;&gt;jorlow@chromium.org&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;Wed,&nbsp;Sep&nbsp;9,&nbsp;2009&nbsp;at&nbsp;9:54&nbsp;AM,&nbsp;Maciej&nbsp;Stachowiak&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:mjs@apple.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mjs@apple.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
On&nbsp;Sep&nbsp;8,&nbsp;2009,&nbsp;at&nbsp;4:10&nbsp;PM,&nbsp;Jonas&nbsp;Sicking&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
On&nbsp;Tue,&nbsp;Sep&nbsp;8,&nbsp;2009&nbsp;at&nbsp;4:00&nbsp;PM,&nbsp;Maciej&nbsp;Stachowiak&lt;&lt;a&nbsp;href=&quot;mailto:mjs@apple.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mjs@apple.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
On&nbsp;Sep&nbsp;8,&nbsp;2009,&nbsp;at&nbsp;1:35&nbsp;AM,&nbsp;Jonas&nbsp;Sicking&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;Firefox&nbsp;would&nbsp;be&nbsp;willing&nbsp;to&nbsp;break&nbsp;compat.&nbsp;The&nbsp;question&nbsp;is&nbsp;if&lt;br&gt;<br>
microsoft&nbsp;is.&nbsp;Which&nbsp;we&nbsp;need&nbsp;to&nbsp;ask&nbsp;them.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
We&nbsp;would&nbsp;be&nbsp;very&nbsp;hesitant&nbsp;to&nbsp;break&nbsp;LocalStorage&nbsp;API&nbsp;compatibility&nbsp;for&lt;br&gt;<br>
Safari,&nbsp;at&nbsp;least&nbsp;without&nbsp;some&nbsp;demonstration&nbsp;that&nbsp;the&nbsp;level&nbsp;of&nbsp; real-world&lt;br&gt;<br>
breakage&nbsp;is&nbsp;low&nbsp;(including&nbsp;for&nbsp;mobile-specific/iPhone-specific&nbsp;sites).&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Even&nbsp;if&nbsp;that&nbsp;means&nbsp;that&nbsp;you&#39;ll&nbsp;for&nbsp;all&nbsp;future&nbsp;will&nbsp;need&nbsp;to&nbsp;use&nbsp;a&lt;br&gt;<br>
per-domain&nbsp;mutex&nbsp;protecting&nbsp;localStorage?&nbsp;And&nbsp;even&nbsp;possibly&nbsp;a&nbsp;global&lt;br&gt;<br>
mutex&nbsp;as&nbsp;currently&nbsp;specified?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
I&nbsp;don&#39;t&nbsp;think&nbsp;telling&nbsp;this&nbsp;story&nbsp;to&nbsp;users&nbsp;or&nbsp;developers&nbsp;will&nbsp;make&nbsp;them&nbsp;satisfied&nbsp;with&nbsp;the&nbsp;breakage,&nbsp;so&nbsp;the&nbsp;&quot;even&nbsp;if&quot;&nbsp;is&nbsp;not&nbsp;very&nbsp;relevant.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;there&nbsp;are&nbsp;ways&nbsp;to&nbsp;solve&nbsp;the&nbsp;problem&nbsp;without&nbsp;completely&nbsp;breaking&nbsp;compatibility.&nbsp;For&nbsp;example:&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;Keep&nbsp;the&nbsp;current&nbsp;LocalStorage&nbsp;API,&nbsp;but&nbsp;make&nbsp;it&nbsp;give&nbsp;no&nbsp;concurrency&nbsp;guarantees&nbsp;whatsoever&nbsp;(only&nbsp;single&nbsp;key/value&nbsp;accesses&nbsp;are&nbsp;guaranteed&nbsp;atomic).&lt;br&gt;<br>
-&nbsp;Add&nbsp;a&nbsp;simple&nbsp;optional&nbsp;transactional&nbsp;model&nbsp;for&nbsp;aware&nbsp;authors&nbsp;who&nbsp;want&nbsp;better&nbsp;consistency&nbsp;guarantees.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;might&nbsp;not&nbsp;meaningfully&nbsp;break&nbsp;existing&nbsp;content,&nbsp;unlike&nbsp;proposals&nbsp;for&nbsp;effectively&nbsp;mandatory&nbsp;new&nbsp;API&nbsp;calls.&nbsp;Particularly&nbsp;since&nbsp;IE&nbsp;doesn&#39;t&nbsp;have&nbsp;any&nbsp;kind&nbsp;of&nbsp;storage&nbsp;mutex.&lt;br&gt;<br>
&lt;br&gt;<br>
Yet&nbsp;another&nbsp;possibility&nbsp;is&nbsp;to&nbsp;keep&nbsp;a&nbsp;per-domain&nbsp;mutex,&nbsp;also&nbsp;offer&nbsp;a&nbsp;transactional&nbsp;API,&nbsp;and&nbsp;accept&nbsp;that&nbsp;careless&nbsp;authors&nbsp;may&nbsp;indefinitely&nbsp;lock&nbsp;up&nbsp;the&nbsp;UI&nbsp;for&nbsp;all&nbsp;pages&nbsp;in&nbsp;their&nbsp;domain&nbsp;(up&nbsp;to&nbsp;the&nbsp;slow&nbsp;script&nbsp;execution&nbsp;limit)&nbsp;if&nbsp;they&nbsp;code&nbsp;poorly,&nbsp;but&nbsp;in&nbsp;exchange&nbsp;won&#39;t&nbsp;have&nbsp;unexpected&nbsp;race&nbsp;conditions&nbsp;with&nbsp;themselves.&lt;br&gt;<br>
<br>
<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;I&#39;ll&nbsp;see&nbsp;if&nbsp;I&nbsp;can&#39;t&nbsp;get&nbsp;any&nbsp;numbers&nbsp;on&nbsp;how&nbsp;widely&nbsp;used&nbsp;localStorage&nbsp;is&nbsp;today.&nbsp; Assuming&nbsp;that&nbsp;we&nbsp;can&#39;t&nbsp;break&nbsp;compat&nbsp;(which&nbsp;I&nbsp;think&nbsp;is&nbsp;a&nbsp;strong&nbsp;possibility)&nbsp;I&nbsp;think&nbsp;Maciej&#39;s&nbsp;idea&nbsp;is&nbsp;the&nbsp;best&nbsp;one&nbsp;so&nbsp;far.&nbsp; That&nbsp;said,&nbsp;I&nbsp;think&nbsp;Chris&#39;s&nbsp;|window.localStorage&nbsp;==&nbsp;undefined|&nbsp;could&nbsp;work.&nbsp; Both&nbsp;would&nbsp;be&nbsp;confusing&nbsp;to&nbsp;web&nbsp;developers&nbsp;in&nbsp;different&nbsp;ways,&nbsp;but&nbsp;I&nbsp;don&#39;t&nbsp;think&nbsp;that&#39;s&nbsp;avoidable&nbsp;(unless&nbsp;we&nbsp;break&nbsp;compat).&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
