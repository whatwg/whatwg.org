<tt>
On&nbsp;Oct&nbsp;12,&nbsp;2007&nbsp;9:39&nbsp;PM,&nbsp;Maciej&nbsp;Stachowiak&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:mjs@apple.com&quot;&gt;mjs@apple.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&nbsp;style=&quot;&quot;&gt;On&nbsp;Oct&nbsp;11,&nbsp;2007,&nbsp;at&nbsp;6:47&nbsp;PM,&nbsp;Robert&nbsp;O&#39;Callahan&nbsp;wrote:&lt;br&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;Oct&nbsp;12,&nbsp;2007&nbsp;12:53&nbsp;PM,&nbsp;Ian&nbsp;Hickson&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ian@hixie.ch&quot;&nbsp;target=&quot;_blank&quot;&gt;ian@hixie.ch<br>
&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&nbsp;The&nbsp;problem&nbsp;with&nbsp;isLocallyAvailable()&nbsp;--&nbsp;as&nbsp;noted&nbsp;by&nbsp;Maciej&nbsp;on&nbsp;IRC&nbsp;--&nbsp;is<br>
&lt;br&gt;mostly&nbsp;one&nbsp;of&nbsp;race&nbsp;conditions.&nbsp;What&nbsp;if&nbsp;the&nbsp;resource&nbsp;was&nbsp;removed&nbsp;in&nbsp;between&lt;br&gt;you&nbsp;asking&nbsp;for&nbsp;it&nbsp;and&nbsp;using&nbsp;it?&nbsp;Or&nbsp;added?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&nbsp;In&nbsp;the&nbsp;contexts&nbsp;for&nbsp;which&nbsp;it&nbsp;was&nbsp;requested,&nbsp;race&nbsp;conditions&nbsp;are&nbsp;tolerable.&nbsp;For&nbsp;example&nbsp;in&nbsp;a&nbsp;mapping&nbsp;application,&nbsp;if&nbsp;you&nbsp;choose&nbsp;the&nbsp;wrong&nbsp;tile&nbsp;as&nbsp;a&nbsp;template&nbsp;for&nbsp;zooming,&nbsp;then&nbsp;you&nbsp;get&nbsp;an&nbsp;ugly&nbsp;transition&nbsp;but&nbsp;that&#39;s&nbsp;all.&nbsp;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;Seems&nbsp;like&nbsp;wrongly&nbsp;choosing&nbsp;one&nbsp;that&nbsp;is&nbsp;not&nbsp;actually&nbsp;locally&nbsp;available&nbsp;would&nbsp;leave&nbsp;a&nbsp;hole&nbsp;in&nbsp;your&nbsp;map.&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;This&nbsp;case&nbsp;was&nbsp;for&nbsp;an&nbsp;online&nbsp;app.&nbsp;The&nbsp;assumption&nbsp;is&nbsp;that&nbsp;either&nbsp;tile&nbsp;chosen&nbsp;would&nbsp;load&nbsp;&quot;eventually&quot;;&nbsp;the&nbsp;app&nbsp;would&nbsp;choose&nbsp;to&nbsp;base&nbsp;its&nbsp;transition&nbsp;effect&nbsp;on&nbsp;whichever&nbsp;tile&nbsp;was&nbsp;most&nbsp;likely&nbsp;to&nbsp;be&nbsp;available.&nbsp;I&#39;m&nbsp;told&nbsp;that&nbsp;right&nbsp;now,&nbsp;they&nbsp;use&nbsp;heuristics&nbsp;based&nbsp;on&nbsp;a&nbsp;completely&nbsp;naive&nbsp;model&nbsp;of&nbsp;the&nbsp;browser&nbsp;cache!<br>
&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;&lt;blockquote&gt;Or&nbsp;what&nbsp;if&nbsp;you&nbsp;go&nbsp;offline&nbsp;(thus&lt;br&gt;changing&nbsp;the&nbsp;rules)&nbsp;in&nbsp;between&nbsp;checking&nbsp;for&nbsp;and&nbsp;using&nbsp;the&nbsp;resource?&lt;br&gt;&lt;/blockquote&gt;That&#39;s&nbsp;why&nbsp;we&nbsp;have&nbsp;the&nbsp;&#39;whenOffline&#39;&nbsp;parameter.<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;style=&quot;&quot;&gt;&lt;div&gt;&lt;div&gt;I&nbsp;don&#39;t&nbsp;see&nbsp;how&nbsp;the&nbsp;whenOffline&nbsp;parameter&nbsp;addresses&nbsp;that&nbsp;problem&nbsp;that&nbsp;your&nbsp;online/offline&nbsp;state&nbsp;may&nbsp;change&nbsp;between&nbsp;the&nbsp;time&nbsp;you&nbsp;do&nbsp;the&nbsp;check&nbsp;and&nbsp;the&nbsp;time&nbsp;you&nbsp;try&nbsp;to&nbsp;load&nbsp;the&nbsp;resource.&nbsp;In&nbsp;fact,&nbsp;I&#39;m&nbsp;not&nbsp;really&nbsp;sure&nbsp;how&nbsp;it&nbsp;is&nbsp;helpful,&nbsp;compared&nbsp;to&nbsp;just&nbsp;basing&nbsp;the&nbsp;check&nbsp;on&nbsp;the&nbsp;current&nbsp;online/offline&nbsp;state&nbsp;always.<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&nbsp;&lt;br&gt;Some&nbsp;apps&nbsp;may&nbsp;find&nbsp;it&nbsp;helpful&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;predict&nbsp;their&nbsp;offline&nbsp;capabilities&nbsp;even&nbsp;while&nbsp;they&#39;re&nbsp;online.&nbsp;For&nbsp;example,&nbsp;an&nbsp;app&nbsp;might&nbsp;want&nbsp;to&nbsp;indicate&nbsp;what&nbsp;the&nbsp;user&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;do&nbsp;if&nbsp;they&nbsp;go&nbsp;offline&nbsp;right&nbsp;now.<br>
&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;style=&quot;&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
A&nbsp;race-free&nbsp;API&nbsp;seems&nbsp;difficult&nbsp;to&nbsp;design.&nbsp;Because&nbsp;loads&nbsp;are&nbsp;typically&nbsp;asynchronous,&nbsp;I&nbsp;doubt&nbsp;you&nbsp;can&nbsp;do&nbsp;much&nbsp;better&nbsp;than&nbsp;start&nbsp;a&nbsp;regular&nbsp;load,&nbsp;and&nbsp;set&nbsp;a&nbsp;timer&nbsp;to&nbsp;go&nbsp;off&nbsp;and&nbsp;cancel&nbsp;the&nbsp;load&nbsp;and&nbsp;take&nbsp;other&nbsp;action&nbsp;if&nbsp;the&nbsp;load&nbsp;doesn&#39;t&nbsp;complete&nbsp;&quot;fast&nbsp;enough&quot;.<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;The&nbsp;race-free&nbsp;approach&nbsp;would&nbsp;be&nbsp;to&nbsp;provide&nbsp;APIs&nbsp;to&nbsp;load&nbsp;resources&nbsp;only&nbsp;from&nbsp;the&nbsp;cache&nbsp;and&nbsp;to&nbsp;error&nbsp;out&nbsp;immediately&nbsp;if&nbsp;the&nbsp;the&nbsp;request&nbsp;can&#39;t&nbsp;be&nbsp;served&nbsp;locally.&nbsp;The&nbsp;problem&nbsp;with&nbsp;this&nbsp;is&nbsp;that&nbsp;there&nbsp;are&nbsp;a&nbsp;huge&nbsp;number&nbsp;of&nbsp;APIs&nbsp;to&nbsp;trigger&nbsp;a&nbsp;load:&nbsp;frame&nbsp;src,&nbsp;iframe&nbsp;src,&nbsp;<br>
window.location&nbsp;assignment,&nbsp;window.location.replace,&nbsp;img&nbsp;src,&nbsp;script&nbsp;src,&nbsp;link&nbsp;for&nbsp;a&nbsp;stylesheet,&nbsp;XMLHttpRequest,&nbsp;and&nbsp;that&#39;s&nbsp;just&nbsp;the&nbsp;obvious&nbsp;ones.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Indeed.&lt;br&gt;&lt;br&gt;Another&nbsp;problem&nbsp;is&nbsp;that&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;offer&nbsp;a&nbsp;hard&nbsp;guarantee&nbsp;that&nbsp;the&nbsp;resource&nbsp;will&nbsp;load,&nbsp;you&nbsp;probably&nbsp;want&nbsp;to&nbsp;check&nbsp;not&nbsp;just&nbsp;whether&nbsp;it&#39;s&nbsp;in&nbsp;the&nbsp;cache&nbsp;but&nbsp;also&nbsp;that&nbsp;no&nbsp;other&nbsp;error&nbsp;will&nbsp;occur&nbsp;before&nbsp;the&nbsp;load&nbsp;completes&nbsp;(<br>
e.g.&nbsp;due&nbsp;to&nbsp;a&nbsp;change&nbsp;in&nbsp;the&nbsp;browser&nbsp;state&nbsp;during&nbsp;a&nbsp;load).&nbsp;This&nbsp;might&nbsp;be&nbsp;simple,&nbsp;or&nbsp;it&nbsp;might&nbsp;not,&nbsp;depending&nbsp;on&nbsp;the&nbsp;browser&nbsp;implementation.&nbsp;In&nbsp;other&nbsp;words,&nbsp;the&nbsp;race&nbsp;window&nbsp;doesn&#39;t&nbsp;end&nbsp;when&nbsp;the&nbsp;load&nbsp;starts,&nbsp;it&nbsp;actually&nbsp;ends&nbsp;when&nbsp;the&nbsp;load&nbsp;ends&nbsp;IMHO.<br>
&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;style=&quot;&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;a&nbsp;way&nbsp;to&nbsp;do&nbsp;an&nbsp;XMLHttpRequest&nbsp;that&nbsp;will&nbsp;only&nbsp;succeed&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;cached&nbsp;would&nbsp;cover&nbsp;many&nbsp;cases,&nbsp;and&nbsp;is&nbsp;probably&nbsp;a&nbsp;reasonable&nbsp;extension&nbsp;to&nbsp;XHR&nbsp;(given&nbsp;the&nbsp;text&nbsp;of&nbsp;an&nbsp;html&nbsp;document,&nbsp;script&nbsp;or&nbsp;stylesheet,&nbsp;you&nbsp;can&nbsp;insert&nbsp;it&nbsp;into&nbsp;an&nbsp;appropriate&nbsp;element&nbsp;for&nbsp;use).&nbsp;The&nbsp;problem&nbsp;is&nbsp;binary&nbsp;formats,&nbsp;since&nbsp;XHR&nbsp;has&nbsp;no&nbsp;good&nbsp;way&nbsp;of&nbsp;returning&nbsp;the&nbsp;data&nbsp;yet&nbsp;and&nbsp;the&nbsp;elements&nbsp;that&nbsp;would&nbsp;consume&nbsp;them&nbsp;(img,&nbsp;video,&nbsp;audio,&nbsp;object)&nbsp;have&nbsp;no&nbsp;way&nbsp;to&nbsp;pass&nbsp;in&nbsp;raw&nbsp;bytes&nbsp;(using&nbsp;a&nbsp;data:&nbsp;URL&nbsp;to&nbsp;encode&nbsp;it&nbsp;would&nbsp;be&nbsp;poor&nbsp;form&nbsp;for&nbsp;image&nbsp;and&nbsp;probably&nbsp;unworkable&nbsp;for&nbsp;video).&nbsp;However,&nbsp;if&nbsp;those&nbsp;elements&nbsp;were&nbsp;extended&nbsp;with&nbsp;some&nbsp;way&nbsp;to&nbsp;set&nbsp;raw&nbsp;data&nbsp;then&nbsp;such&nbsp;an&nbsp;approach&nbsp;could&nbsp;work.<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Yes,&nbsp;but&nbsp;I&nbsp;think&nbsp;you&#39;d&nbsp;want&nbsp;this&nbsp;API&nbsp;to&nbsp;be&nbsp;synchronous&nbsp;for&nbsp;the&nbsp;above&nbsp;reasons.&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&nbsp;style=&quot;&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;At&nbsp;that&nbsp;point,&nbsp;isLocallyAvailable&nbsp;might&nbsp;possibly&nbsp;be&nbsp;useful&nbsp;solely&nbsp;as&nbsp;a&nbsp;UI&nbsp;hint,&nbsp;much&nbsp;as&nbsp;the&nbsp;POSIX&nbsp;access()&nbsp;/&nbsp;stat()&nbsp;calls&nbsp;are&nbsp;only&nbsp;useful&nbsp;as&nbsp;UI&nbsp;hints&nbsp;for&nbsp;openability.&nbsp;In&nbsp;fact,&nbsp;this&nbsp;is&nbsp;pretty&nbsp;much&nbsp;analogous&nbsp;to&nbsp;the&nbsp;potential&nbsp;pitfalls&nbsp;of&nbsp;access()&nbsp;vs.&nbsp;open().&nbsp;You&nbsp;need&nbsp;to&nbsp;check&nbsp;whether&nbsp;open()&nbsp;succeeds,&nbsp;and&nbsp;pass&nbsp;it&nbsp;the&nbsp;right&nbsp;parameters&nbsp;to&nbsp;make&nbsp;sure&nbsp;it&nbsp;will&nbsp;fail&nbsp;if&nbsp;it&nbsp;shouldn&#39;t&nbsp;succeed,&nbsp;rather&nbsp;than&nbsp;trusting&nbsp;a&nbsp;pre-check&nbsp;with&nbsp;access()&nbsp;or&nbsp;stat().<br>
&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Agreed.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;Rob&lt;br&gt;--&nbsp;&lt;br&gt;&quot;Two&nbsp;men&nbsp;owed&nbsp;money&nbsp;to&nbsp;a&nbsp;certain&nbsp;moneylender.&nbsp;One&nbsp;owed&nbsp;him&nbsp;five&nbsp;hundred&nbsp;denarii,&nbsp;and&nbsp;the&nbsp;other&nbsp;fifty.&nbsp;Neither&nbsp;of&nbsp;them&nbsp;had&nbsp;the&nbsp;money&nbsp;to&nbsp;pay&nbsp;him&nbsp;back,&nbsp;so&nbsp;he&nbsp;canceled&nbsp;the&nbsp;debts&nbsp;of&nbsp;both.&nbsp;Now&nbsp;which&nbsp;of&nbsp;them&nbsp;will&nbsp;love&nbsp;him&nbsp;more?&quot;&nbsp;Simon&nbsp;replied,&nbsp;&quot;I&nbsp;suppose&nbsp;the&nbsp;one&nbsp;who&nbsp;had&nbsp;the&nbsp;bigger&nbsp;debt&nbsp;canceled.&quot;&nbsp;&quot;You&nbsp;have&nbsp;judged&nbsp;correctly,&quot;&nbsp;Jesus&nbsp;said.&nbsp;[Luke&nbsp;7:41-43]<br>

</tt>
