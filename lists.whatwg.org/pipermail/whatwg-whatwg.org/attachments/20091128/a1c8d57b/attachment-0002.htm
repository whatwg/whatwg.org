<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;My&nbsp;apologies&nbsp;for&nbsp;the&nbsp;direct&nbsp;reply,&nbsp;Oliver.&nbsp;&nbsp;This&nbsp;was&nbsp;meant&nbsp;to&nbsp;go&nbsp;back&nbsp;to&nbsp;the&nbsp;list:&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;On&nbsp;Nov&nbsp;26,&nbsp;2009,&nbsp;at&nbsp;3:35&nbsp;PM,&nbsp;Oliver&nbsp;Hunt&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;WebGL&nbsp;has&nbsp;completely&nbsp;different&nbsp;constraints&nbsp;to&nbsp;that&nbsp;of&nbsp;the&nbsp;2d&nbsp;canvas&nbsp;--&nbsp;when&nbsp;the&nbsp;developer&nbsp;provides&nbsp;resources&nbsp;to&nbsp;GL&nbsp;the&nbsp;developer&nbsp;has&nbsp;to&nbsp;provide&nbsp;a&nbsp;myriad&nbsp;of&nbsp;type&nbsp;details,&nbsp;this&nbsp;means&nbsp;that&nbsp;the&nbsp;developer&nbsp;needs&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;request&nbsp;storage&nbsp;of&nbsp;a&nbsp;specific&nbsp;type.&nbsp;&nbsp;The&nbsp;WebGL&nbsp;array&nbsp;types&nbsp;are&nbsp;specifically&nbsp;targeting&nbsp;this&nbsp;use&nbsp;case&nbsp;--&nbsp;they&nbsp;don't&nbsp;make&nbsp;sense&nbsp;for&nbsp;canvas2d&nbsp;where&nbsp;the&nbsp;only&nbsp;storage&nbsp;is&nbsp;not&nbsp;a&nbsp;developer&nbsp;specified&nbsp;format.&lt;br&gt;&lt;/blockquote&gt;That&nbsp;is&nbsp;understandable.&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;History&nbsp;has&nbsp;shown&nbsp;that&nbsp;any&nbsp;time&nbsp;a&nbsp;developer&nbsp;won't&nbsp;handle&nbsp;both&nbsp;byte&nbsp;orders&nbsp;--&nbsp;developers&nbsp;tend&nbsp;to&nbsp;work&nbsp;on&nbsp;the&nbsp;assumption&nbsp;that&nbsp;if&nbsp;something&nbsp;works&nbsp;for&nbsp;them&nbsp;it&nbsp;must&nbsp;be&nbsp;correct,&nbsp;this&nbsp;is&nbsp;why&nbsp;we&nbsp;end&nbsp;up&nbsp;with&nbsp;sites&nbsp;that&nbsp;claim&nbsp;&quot;This&nbsp;site&nbsp;needs&nbsp;IE/Safari/Firefox&nbsp;to&nbsp;run&quot;&nbsp;type&nbsp;messages.&nbsp;&nbsp;Even&nbsp;conscientious&nbsp;developers&nbsp;who&nbsp;test&nbsp;multiple&nbsp;browsers,&nbsp;and&nbsp;validate&nbsp;their&nbsp;content,&nbsp;etc&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;produce&nbsp;accidentally&nbsp;broken&nbsp;sites&nbsp;because&nbsp;this&nbsp;would&nbsp;add&nbsp;a&nbsp;hardware&nbsp;dependency&nbsp;on&nbsp;spec&nbsp;behaviour.&lt;br&gt;&lt;/blockquote&gt;We&nbsp;certainly&nbsp;don't&nbsp;want&nbsp;any&nbsp;more&nbsp;of&nbsp;that.&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Realistically&nbsp;simply&nbsp;making&nbsp;an&nbsp;separate&nbsp;object&nbsp;that&nbsp;has&nbsp;indexes&nbsp;32bit&nbsp;rgba&nbsp;pixels&nbsp;would&nbsp;resolve&nbsp;the&nbsp;problem&nbsp;you're&nbsp;trying&nbsp;to&nbsp;describe&nbsp;--&nbsp;the&nbsp;implementation&nbsp;would&nbsp;need&nbsp;to&nbsp;do&nbsp;byte&nbsp;order&nbsp;correct,&nbsp;but&nbsp;given&nbsp;that&nbsp;2/3&nbsp;canvas&nbsp;implementations&nbsp;already&nbsp;do&nbsp;unpre-&gt;premultiplied&nbsp;data&nbsp;conversion&nbsp;on&nbsp;putImageData&nbsp;this&nbsp;is&nbsp;unlikely&nbsp;to&nbsp;add&nbsp;any&nbsp;cost&nbsp;at&nbsp;all&nbsp;(in&nbsp;fact&nbsp;in&nbsp;the&nbsp;webkit&nbsp;implementation&nbsp;i&nbsp;don't&nbsp;believe&nbsp;there&nbsp;would&nbsp;be&nbsp;any&nbsp;difference&nbsp;in&nbsp;the&nbsp;logic&nbsp;in&nbsp;get/putImageData).&lt;br&gt;&lt;/blockquote&gt;Once&nbsp;again,&nbsp;I&nbsp;agree.&nbsp;&nbsp;My&nbsp;confusion&nbsp;on&nbsp;the&nbsp;type-specific&nbsp;arrays&nbsp;for&nbsp;WebGL&nbsp;is&nbsp;that&nbsp;they&nbsp;were&nbsp;specific&nbsp;and&nbsp;general&nbsp;enough&nbsp;to&nbsp;use&nbsp;in&nbsp;other&nbsp;cases.&nbsp;&nbsp;If&nbsp;they&nbsp;should&nbsp;not&nbsp;be&nbsp;used&nbsp;in&nbsp;2D&nbsp;canvas&nbsp;implementations&nbsp;(or&nbsp;elsewhere)&nbsp;then&nbsp;a&nbsp;2D-canvas-specific&nbsp;array&nbsp;or&nbsp;object&nbsp;would&nbsp;be&nbsp;the&nbsp;way&nbsp;forward.&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Take&nbsp;for&nbsp;instance,&nbsp;the&nbsp;following&nbsp;pseudo&nbsp;code:&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;var&nbsp;canvas&nbsp;=&nbsp;document.getElementById(&quot;canvas&quot;);&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;var&nbsp;ctx&nbsp;=&nbsp;canvas.getContext(&quot;2d&quot;);&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;var&nbsp;pixels&nbsp;=&nbsp;ctx.createUnsignedByteArray(8,&nbsp;8);&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;//&nbsp;Fill&nbsp;with&nbsp;medium&nbsp;gray&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;8&nbsp;*&nbsp;8;&nbsp;i++)&nbsp;{&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&nbsp;pixels.data[i]&nbsp;=&nbsp;ctx.mapRGBA(128,&nbsp;128,&nbsp;128,&nbsp;255);&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;}&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;ctx.putUnsignedByteArray(pixels,&nbsp;0,&nbsp;0);&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Adding&nbsp;a&nbsp;function&nbsp;call&nbsp;would&nbsp;make&nbsp;your&nbsp;code&nbsp;much&nbsp;slower.&lt;br&gt;&lt;/blockquote&gt;Yes,&nbsp;it&nbsp;would.&nbsp;&nbsp;Once&nbsp;again,&nbsp;this&nbsp;was&nbsp;only&nbsp;for&nbsp;illustrative&nbsp;purposes.&nbsp;&nbsp;More&nbsp;commonly,&nbsp;a&nbsp;Look-Up&nbsp;Table&nbsp;would&nbsp;be&nbsp;created,&nbsp;containing&nbsp;all&nbsp;of&nbsp;the&nbsp;colors&nbsp;used&nbsp;in&nbsp;the&nbsp;scene&nbsp;before&nbsp;any&nbsp;pixels&nbsp;are&nbsp;touched.&nbsp;&nbsp;For&nbsp;any&nbsp;kind&nbsp;of&nbsp;low-resolution&nbsp;pixel&nbsp;art&nbsp;(as&nbsp;found&nbsp;in&nbsp;classic&nbsp;gaming&nbsp;consoles),&nbsp;the&nbsp;palette&nbsp;is&nbsp;typically&nbsp;indexed&nbsp;and&nbsp;consisting&nbsp;of&nbsp;256&nbsp;colors&nbsp;or&nbsp;fewer.&nbsp;&nbsp;In&nbsp;extreme&nbsp;cases,&nbsp;an&nbsp;LUT&nbsp;with&nbsp;thousands&nbsp;of&nbsp;colors&nbsp;would&nbsp;be&nbsp;far&nbsp;faster&nbsp;than&nbsp;using&nbsp;such&nbsp;a&nbsp;function&nbsp;call.&lt;br&gt;&lt;br&gt;I&nbsp;neglected&nbsp;to&nbsp;mention&nbsp;any&nbsp;optimal&nbsp;way&nbsp;of&nbsp;using&nbsp;a&nbsp;&quot;mapRGBA&quot;&nbsp;function;&nbsp;that's&nbsp;not&nbsp;what&nbsp;I&nbsp;was&nbsp;trying&nbsp;to&nbsp;illustrate.&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;I&nbsp;understand&nbsp;this&nbsp;a&nbsp;bad&nbsp;way&nbsp;to&nbsp;fill&nbsp;a&nbsp;portion&nbsp;of&nbsp;a&nbsp;canvas&nbsp;with&nbsp;a&nbsp;solid&nbsp;color;&nbsp;this&nbsp;is&nbsp;for&nbsp;illustration&nbsp;purposes&nbsp;only.&nbsp;&nbsp;The&nbsp;overall&nbsp;idea&nbsp;is&nbsp;that&nbsp;setting&nbsp;fewer&nbsp;array&nbsp;elements&nbsp;per&nbsp;pixel&nbsp;will&nbsp;perform&nbsp;better.&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Have&nbsp;you&nbsp;actually&nbsp;measured&nbsp;this?&nbsp;&nbsp;How&nbsp;long&nbsp;is&nbsp;spent&nbsp;in&nbsp;each&nbsp;part?&nbsp;&nbsp;I&nbsp;suspect&nbsp;if&nbsp;you're&nbsp;not&nbsp;using&nbsp;the&nbsp;dirty&nbsp;region&nbsp;arguments&nbsp;you're&nbsp;pushing&nbsp;back&nbsp;(and&nbsp;doing&nbsp;premult&nbsp;conversion)&nbsp;on&nbsp;a&nbsp;lot&nbsp;more&nbsp;pixels&nbsp;than&nbsp;necessary.&nbsp;&nbsp;Yes&nbsp;setting&nbsp;4&nbsp;properties&nbsp;is&nbsp;slower&nbsp;than&nbsp;setting&nbsp;1,&nbsp;but&nbsp;where&nbsp;is&nbsp;your&nbsp;time&nbsp;actually&nbsp;being&nbsp;spent.&lt;br&gt;&lt;/blockquote&gt;I&nbsp;have&nbsp;not&nbsp;directly&nbsp;done&nbsp;any&nbsp;measurements,&nbsp;sorry.&nbsp;&nbsp;What&nbsp;I&nbsp;do&nbsp;have&nbsp;is&nbsp;a&nbsp;mecurial&nbsp;repository&nbsp;for&nbsp;a&nbsp;level&nbsp;editor&nbsp;project&nbsp;(which&nbsp;draws&nbsp;independent&nbsp;pixels&nbsp;directly&nbsp;to&nbsp;very&nbsp;large&nbsp;canvas&nbsp;elements)&nbsp;showing&nbsp;the&nbsp;progression&nbsp;of&nbsp;optimizations&nbsp;I've&nbsp;introduced.&nbsp;&nbsp;Many&nbsp;of&nbsp;the&nbsp;modifications&nbsp;intended&nbsp;to&nbsp;make&nbsp;the&nbsp;drawing&nbsp;faster&nbsp;have&nbsp;done&nbsp;so&nbsp;by&nbsp;avoiding&nbsp;pixel&nbsp;access&nbsp;wherever&nbsp;possible.&nbsp;&nbsp;Certainly&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;most&nbsp;efficient&nbsp;code,&nbsp;but&nbsp;I've&nbsp;optimized&nbsp;enough&nbsp;to&nbsp;make&nbsp;the&nbsp;time&nbsp;spent&nbsp;setting&nbsp;pixel&nbsp;arrays&nbsp;worth&nbsp;investigating.&nbsp;&nbsp;I&nbsp;still&nbsp;do&nbsp;not&nbsp;have&nbsp;any&nbsp;actual&nbsp;numbers&nbsp;to&nbsp;throw&nbsp;around,&nbsp;however.&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;We've&nbsp;already&nbsp;seen&nbsp;the&nbsp;emergence&nbsp;of&nbsp;emulators&nbsp;written&nbsp;in&nbsp;JavaScript/Canvas.&nbsp;&nbsp;In&nbsp;fact,&nbsp;there&nbsp;are&nbsp;loads&nbsp;of&nbsp;them[4],&nbsp;and&nbsp;they&nbsp;would&nbsp;all&nbsp;benefit&nbsp;from&nbsp;having&nbsp;a&nbsp;better&nbsp;way&nbsp;to&nbsp;interact&nbsp;directly&nbsp;with&nbsp;canvas&nbsp;pixels.&nbsp;&nbsp;Of&nbsp;course,&nbsp;the&nbsp;use&nbsp;cases&nbsp;are&nbsp;not&nbsp;limited&nbsp;to&nbsp;emulation;&nbsp;my&nbsp;NES/SNES&nbsp;level&nbsp;editor&nbsp;projects&nbsp;would&nbsp;enjoy&nbsp;faster&nbsp;pixel&nbsp;manipulation&nbsp;as&nbsp;well.&nbsp;&nbsp;These&nbsp;kinds&nbsp;of&nbsp;projects&nbsp;can&nbsp;use&nbsp;arbitrarily&nbsp;sized&nbsp;canvases&nbsp;(up&nbsp;to&nbsp;4864px&nbsp;×&nbsp;3072px&nbsp;in&nbsp;one&nbsp;case[5])&nbsp;and&nbsp;can&nbsp;take&nbsp;a&nbsp;good&nbsp;deal&nbsp;of&nbsp;time&nbsp;to&nbsp;fully&nbsp;render,&nbsp;even&nbsp;with&nbsp;several&nbsp;off-ImageData&nbsp;optimization&nbsp;tricks.&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Without&nbsp;seeing&nbsp;the&nbsp;code&nbsp;for&nbsp;your&nbsp;demo&nbsp;i'd&nbsp;have&nbsp;no&nbsp;idea&nbsp;whether&nbsp;what&nbsp;you're&nbsp;doing&nbsp;is&nbsp;actually&nbsp;efficient&nbsp;--&nbsp;have&nbsp;you&nbsp;profiled?&nbsp;&nbsp;Both&nbsp;Safari&nbsp;and&nbsp;Firefox&nbsp;have&nbsp;built&nbsp;in&nbsp;profilers.&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;The&nbsp;trouble&nbsp;with&nbsp;profiling&nbsp;my&nbsp;project&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;a&nbsp;XULRunner&nbsp;application,&nbsp;and&nbsp;does&nbsp;not&nbsp;run&nbsp;directly&nbsp;in&nbsp;web&nbsp;browsers&nbsp;as-is.&nbsp;&nbsp;The&nbsp;code&nbsp;can&nbsp;largely&nbsp;be&nbsp;hacked&nbsp;to&nbsp;work&nbsp;as&nbsp;a&nbsp;web&nbsp;application.&nbsp;&nbsp;If&nbsp;you&nbsp;are&nbsp;interested&nbsp;in&nbsp;a&nbsp;&quot;demo&quot;&nbsp;of&nbsp;sorts,&nbsp;the&nbsp;code&nbsp;is&nbsp;all&nbsp;available&nbsp;here:&lt;a&nbsp;href=&quot;http://hg.kodewerx.org/index.cgi/syndrome/&quot;&gt;http://hg.kodewerx.org/index.cgi/syndrome/&lt;/a&gt;&nbsp;&nbsp;and&nbsp;documentation&nbsp;here:&nbsp;&lt;a&nbsp;href=&quot;http://www.kodewerx.org/wiki/index.php/Syndrome&quot;&gt;http://www.kodewerx.org/wiki/index.php/Syndrome&lt;/a&gt;&lt;br&gt;&lt;br&gt;Changeset&nbsp;2b56c4771d5c&nbsp;reduced&nbsp;the&nbsp;number&nbsp;of&nbsp;pixel&nbsp;array&nbsp;elements&nbsp;accessed&nbsp;by&nbsp;caching&nbsp;the&nbsp;256px&nbsp;x&nbsp;256px&nbsp;&quot;rooms&quot;&nbsp;within&nbsp;the&nbsp;stage&nbsp;map,&nbsp;and&nbsp;passing&nbsp;the&nbsp;cached&nbsp;rooms&nbsp;to&nbsp;putImageData().&nbsp;&nbsp;Once&nbsp;again,&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;most&nbsp;efficient&nbsp;code.&nbsp;&nbsp;There&nbsp;are&nbsp;several&nbsp;areas&nbsp;I&nbsp;could&nbsp;continue&nbsp;to&nbsp;improve,&nbsp;but&nbsp;that&nbsp;is&nbsp;not&nbsp;my&nbsp;point.&lt;br&gt;&lt;br&gt;My&nbsp;point,&nbsp;as&nbsp;you&nbsp;concur,&nbsp;is&nbsp;that&nbsp;setting&nbsp;four&nbsp;array&nbsp;elements&nbsp;(properties)&nbsp;is&nbsp;slower&nbsp;than&nbsp;setting&nbsp;just&nbsp;one.&nbsp;&nbsp;I&nbsp;am&nbsp;looking&nbsp;for&nbsp;a&nbsp;viable&nbsp;solution&nbsp;to&nbsp;this&nbsp;specific&nbsp;issue,&nbsp;and&nbsp;not&nbsp;merely&nbsp;working&nbsp;around&nbsp;it.&nbsp;&nbsp;If&nbsp;a&nbsp;workaround&nbsp;was&nbsp;sufficient,&nbsp;I&nbsp;would&nbsp;not&nbsp;have&nbsp;come&nbsp;to&nbsp;the&nbsp;WHATWG&nbsp;for&nbsp;a&nbsp;discussion.&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;listening!&lt;br&gt;Jason&nbsp;Oster&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
