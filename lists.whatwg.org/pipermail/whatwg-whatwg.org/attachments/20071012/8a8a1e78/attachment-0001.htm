<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Oct&nbsp;11,&nbsp;2007,&nbsp;at&nbsp;6:47&nbsp;PM,&nbsp;Robert&nbsp;O'Callahan&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;Oct&nbsp;12,&nbsp;2007&nbsp;12:53&nbsp;PM,&nbsp;Ian&nbsp;Hickson&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ian@hixie.ch&quot;&gt;ian@hixie.ch&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&nbsp;The&nbsp;problem&nbsp;with&nbsp;isLocallyAvailable()&nbsp;--&nbsp;as&nbsp;noted&nbsp;by&nbsp;Maciej&nbsp;on&nbsp;IRC&nbsp;--&nbsp;is&lt;br&gt;mostly&nbsp;one&nbsp;of&nbsp;race&nbsp;conditions.&nbsp;What&nbsp;if&nbsp;the&nbsp;resource&nbsp;was&nbsp;removed&nbsp;in&nbsp;between&lt;br&gt;you&nbsp;asking&nbsp;for&nbsp;it&nbsp;and&nbsp;using&nbsp;it?&nbsp;Or&nbsp;added?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&nbsp;In&nbsp;the&nbsp;contexts&nbsp;for&nbsp;which&nbsp;it&nbsp;was&nbsp;requested,&nbsp;race&nbsp;conditions&nbsp;are&nbsp;tolerable.&nbsp;For&nbsp;example&nbsp;in&nbsp;a&nbsp;mapping&nbsp;application,&nbsp;if&nbsp;you&nbsp;choose&nbsp;the&nbsp;wrong&nbsp;tile&nbsp;as&nbsp;a&nbsp;template&nbsp;for&nbsp;zooming,&nbsp;then&nbsp;you&nbsp;get&nbsp;an&nbsp;ugly&nbsp;transition&nbsp;but&nbsp;that's&nbsp;all.&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;Seems&nbsp;like&nbsp;wrongly&nbsp;choosing&nbsp;one&nbsp;that&nbsp;is&nbsp;not&nbsp;actually&nbsp;locally&nbsp;available&nbsp;would&nbsp;leave&nbsp;a&nbsp;hole&nbsp;in&nbsp;your&nbsp;map.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;Or&nbsp;you&nbsp;might&nbsp;have&nbsp;a&nbsp;button&nbsp;that&nbsp;opens&nbsp;another&nbsp;offline&nbsp;application,&nbsp;and&nbsp;you&nbsp;want&nbsp;to&nbsp;disable&nbsp;the&nbsp;button&nbsp;if&nbsp;you&nbsp;think&nbsp;that&nbsp;application&nbsp;is&nbsp;not&nbsp;available;&nbsp;here&nbsp;a&nbsp;race&nbsp;condition&nbsp;would&nbsp;probably&nbsp;mean&nbsp;that&nbsp;the&nbsp;button&nbsp;is&nbsp;enabled&nbsp;but&nbsp;pressing&nbsp;it&nbsp;gives&nbsp;you&nbsp;an&nbsp;error&nbsp;page.&nbsp;In&nbsp;these&nbsp;cases&nbsp;isLocallyAvailable&nbsp;can&nbsp;be&nbsp;a&nbsp;useful&nbsp;hint&nbsp;even&nbsp;if&nbsp;it's&nbsp;occasionally&nbsp;wrong.&nbsp;&lt;br&gt;&lt;blockquote&gt;&nbsp;Or&nbsp;what&nbsp;if&nbsp;you&nbsp;go&nbsp;offline&nbsp;(thus&lt;br&gt;changing&nbsp;the&nbsp;rules)&nbsp;in&nbsp;between&nbsp;checking&nbsp;for&nbsp;and&nbsp;using&nbsp;the&nbsp;resource?&lt;br&gt;&lt;/blockquote&gt;That's&nbsp;why&nbsp;we&nbsp;have&nbsp;the&nbsp;'whenOffline'&nbsp;parameter.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don't&nbsp;see&nbsp;how&nbsp;the&nbsp;whenOffline&nbsp;parameter&nbsp;addresses&nbsp;that&nbsp;problem&nbsp;that&nbsp;your&nbsp;online/offline&nbsp;state&nbsp;may&nbsp;change&nbsp;between&nbsp;the&nbsp;time&nbsp;you&nbsp;do&nbsp;the&nbsp;check&nbsp;and&nbsp;the&nbsp;time&nbsp;you&nbsp;try&nbsp;to&nbsp;load&nbsp;the&nbsp;resource.&nbsp;In&nbsp;fact,&nbsp;I'm&nbsp;not&nbsp;really&nbsp;sure&nbsp;how&nbsp;it&nbsp;is&nbsp;helpful,&nbsp;compared&nbsp;to&nbsp;just&nbsp;basing&nbsp;the&nbsp;check&nbsp;on&nbsp;the&nbsp;current&nbsp;online/offline&nbsp;state&nbsp;always.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;I'm&nbsp;going&nbsp;to&nbsp;punt&nbsp;on&nbsp;this&nbsp;for&nbsp;now,&nbsp;pending&nbsp;implementation&nbsp;and&nbsp;author&lt;br&gt;experience.&nbsp;I'm&nbsp;certainly&nbsp;open&nbsp;to&nbsp;suggestions&nbsp;though.&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;That's&nbsp;fine.&lt;br&gt;&nbsp;&lt;br&gt;A&nbsp;race-free&nbsp;API&nbsp;seems&nbsp;difficult&nbsp;to&nbsp;design.&nbsp;Because&nbsp;loads&nbsp;are&nbsp;typically&nbsp;asynchronous,&nbsp;I&nbsp;doubt&nbsp;you&nbsp;can&nbsp;do&nbsp;much&nbsp;better&nbsp;than&nbsp;start&nbsp;a&nbsp;regular&nbsp;load,&nbsp;and&nbsp;set&nbsp;a&nbsp;timer&nbsp;to&nbsp;go&nbsp;off&nbsp;and&nbsp;cancel&nbsp;the&nbsp;load&nbsp;and&nbsp;take&nbsp;other&nbsp;action&nbsp;if&nbsp;the&nbsp;load&nbsp;doesn't&nbsp;complete&nbsp;&quot;fast&nbsp;enough&quot;.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;race-free&nbsp;approach&nbsp;would&nbsp;be&nbsp;to&nbsp;provide&nbsp;APIs&nbsp;to&nbsp;load&nbsp;resources&nbsp;only&nbsp;from&nbsp;the&nbsp;cache&nbsp;and&nbsp;to&nbsp;error&nbsp;out&nbsp;immediately&nbsp;if&nbsp;the&nbsp;the&nbsp;request&nbsp;can't&nbsp;be&nbsp;served&nbsp;locally.&nbsp;The&nbsp;problem&nbsp;with&nbsp;this&nbsp;is&nbsp;that&nbsp;there&nbsp;are&nbsp;a&nbsp;huge&nbsp;number&nbsp;of&nbsp;APIs&nbsp;to&nbsp;trigger&nbsp;a&nbsp;load:&nbsp;frame&nbsp;src,&nbsp;iframe&nbsp;src,&nbsp;window.location&nbsp;assignment,&nbsp;window.location.replace,&nbsp;img&nbsp;src,&nbsp;script&nbsp;src,&nbsp;link&nbsp;for&nbsp;a&nbsp;stylesheet,&nbsp;XMLHttpRequest,&nbsp;and&nbsp;that's&nbsp;just&nbsp;the&nbsp;obvious&nbsp;ones.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;a&nbsp;way&nbsp;to&nbsp;do&nbsp;an&nbsp;XMLHttpRequest&nbsp;that&nbsp;will&nbsp;only&nbsp;succeed&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;cached&nbsp;would&nbsp;cover&nbsp;many&nbsp;cases,&nbsp;and&nbsp;is&nbsp;probably&nbsp;a&nbsp;reasonable&nbsp;extension&nbsp;to&nbsp;XHR&nbsp;(given&nbsp;the&nbsp;text&nbsp;of&nbsp;an&nbsp;html&nbsp;document,&nbsp;script&nbsp;or&nbsp;stylesheet,&nbsp;you&nbsp;can&nbsp;insert&nbsp;it&nbsp;into&nbsp;an&nbsp;appropriate&nbsp;element&nbsp;for&nbsp;use).&nbsp;The&nbsp;problem&nbsp;is&nbsp;binary&nbsp;formats,&nbsp;since&nbsp;XHR&nbsp;has&nbsp;no&nbsp;good&nbsp;way&nbsp;of&nbsp;returning&nbsp;the&nbsp;data&nbsp;yet&nbsp;and&nbsp;the&nbsp;elements&nbsp;that&nbsp;would&nbsp;consume&nbsp;them&nbsp;(img,&nbsp;video,&nbsp;audio,&nbsp;object)&nbsp;have&nbsp;no&nbsp;way&nbsp;to&nbsp;pass&nbsp;in&nbsp;raw&nbsp;bytes&nbsp;(using&nbsp;a&nbsp;data:&nbsp;URL&nbsp;to&nbsp;encode&nbsp;it&nbsp;would&nbsp;be&nbsp;poor&nbsp;form&nbsp;for&nbsp;image&nbsp;and&nbsp;probably&nbsp;unworkable&nbsp;for&nbsp;video).&nbsp;However,&nbsp;if&nbsp;those&nbsp;elements&nbsp;were&nbsp;extended&nbsp;with&nbsp;some&nbsp;way&nbsp;to&nbsp;set&nbsp;raw&nbsp;data&nbsp;then&nbsp;such&nbsp;an&nbsp;approach&nbsp;could&nbsp;work.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;At&nbsp;that&nbsp;point,&nbsp;isLocallyAvailable&nbsp;might&nbsp;possibly&nbsp;be&nbsp;useful&nbsp;solely&nbsp;as&nbsp;a&nbsp;UI&nbsp;hint,&nbsp;much&nbsp;as&nbsp;the&nbsp;POSIX&nbsp;access()&nbsp;/&nbsp;stat()&nbsp;calls&nbsp;are&nbsp;only&nbsp;useful&nbsp;as&nbsp;UI&nbsp;hints&nbsp;for&nbsp;openability.&nbsp;In&nbsp;fact,&nbsp;this&nbsp;is&nbsp;pretty&nbsp;much&nbsp;analogous&nbsp;to&nbsp;the&nbsp;potential&nbsp;pitfalls&nbsp;of&nbsp;access()&nbsp;vs.&nbsp;open().&nbsp;You&nbsp;need&nbsp;to&nbsp;check&nbsp;whether&nbsp;open()&nbsp;succeeds,&nbsp;and&nbsp;pass&nbsp;it&nbsp;the&nbsp;right&nbsp;parameters&nbsp;to&nbsp;make&nbsp;sure&nbsp;it&nbsp;will&nbsp;fail&nbsp;if&nbsp;it&nbsp;shouldn't&nbsp;succeed,&nbsp;rather&nbsp;than&nbsp;trusting&nbsp;a&nbsp;pre-check&nbsp;with&nbsp;access()&nbsp;or&nbsp;stat().&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Maciej&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
