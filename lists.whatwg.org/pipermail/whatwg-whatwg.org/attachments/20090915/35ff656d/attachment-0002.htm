<tt>
I&#39;ve&nbsp;talked&nbsp;to&nbsp;a&nbsp;lot&nbsp;of&nbsp;web&nbsp;developers&nbsp;about&nbsp;workers&nbsp;and&nbsp;the&nbsp;one&nbsp;thing&nbsp;that&nbsp;they&nbsp;keep&nbsp;expressing&nbsp;to&nbsp;me&nbsp;is&nbsp;how disappointing it&nbsp;is&nbsp;to&nbsp;not&nbsp;have&nbsp;access&nbsp;to&nbsp;LocalStorage.&nbsp; I&nbsp;tell&nbsp;them&nbsp;about&nbsp;the&nbsp;&quot;work&nbsp;around&quot;&nbsp;which&nbsp;is&nbsp;to&nbsp;pass&nbsp;a&nbsp;message&nbsp;back&nbsp;to&nbsp;the&nbsp;page&nbsp;(or,&nbsp;in&nbsp;the&nbsp;case&nbsp;of&nbsp;shared&nbsp;workers,&nbsp;any&nbsp;page)&nbsp;and&nbsp;ask&nbsp;it&nbsp;to&nbsp;look&nbsp;up&nbsp;the&nbsp;value,&nbsp;but&nbsp;this&nbsp;approach&nbsp;is&nbsp;uninteresting&nbsp;to&nbsp;most&nbsp;of&nbsp;them.&nbsp; Enough&nbsp;so&nbsp;that&nbsp;most&nbsp;of&nbsp;them&nbsp;have&nbsp;said&nbsp;they&#39;d&nbsp;probably&nbsp;just&nbsp;wait&nbsp;until&nbsp;workers&nbsp;were&nbsp;more&nbsp;&quot;mature&quot;&nbsp;(and/or&nbsp;WebDatabase&nbsp;was&nbsp;more&nbsp;widely&nbsp;available)&nbsp;before&nbsp;bothering&nbsp;with&nbsp;them.&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;LocalStorage&nbsp;is&nbsp;a&nbsp;synchronous&nbsp;interface.&nbsp; When&nbsp;you&nbsp;access&nbsp;it&nbsp;from&nbsp;a&nbsp;normal&nbsp;web&nbsp;page,&nbsp;all&nbsp;other&nbsp;event&nbsp;loops&nbsp;that&nbsp;try&nbsp;to&nbsp;access&nbsp;it&nbsp;will&nbsp;block&nbsp;until&nbsp;either&nbsp;you&nbsp;exit&nbsp;your&nbsp;script&nbsp;context&nbsp;or&nbsp;call&nbsp;yieldForStorageUpdates&nbsp;manually.&nbsp; Of&nbsp;course,&nbsp;during&nbsp;this&nbsp;time,&nbsp;the&nbsp;UI&nbsp;of&nbsp;the&nbsp;browser&nbsp;will&nbsp;be&nbsp;locked&nbsp;up&nbsp;and&nbsp;many&nbsp;UAs&nbsp;would&nbsp;present&nbsp;the&nbsp;user&nbsp;with&nbsp;a&nbsp;slow&nbsp;script&nbsp;dialog.&nbsp; This&nbsp;is&nbsp;(hopefully)&nbsp;enough&nbsp;to&nbsp;keep&nbsp;web&nbsp;apps&nbsp;reasonably&nbsp;in&nbsp;check.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Unfortunately,&nbsp;it&#39;s&nbsp;perfectly&nbsp;reasonable&nbsp;for&nbsp;a&nbsp;worker&nbsp;to&nbsp;run&nbsp;forever.&nbsp; For&nbsp;example,&nbsp;it&nbsp;might&nbsp;calculate&nbsp;pi.&nbsp; If,&nbsp;for&nbsp;example,&nbsp;that&nbsp;worker&nbsp;periodically&nbsp;saved&nbsp;the&nbsp;value&nbsp;of&nbsp;pi&nbsp;to&nbsp;localStorage&nbsp;(and&nbsp;didn&#39;t&nbsp;call&nbsp;yieldForStorageUpdates)&nbsp;then&nbsp;you&nbsp;could&nbsp;block&nbsp;your&nbsp;other&nbsp;event&nbsp;loops&nbsp;forever.&nbsp; Even&nbsp;if&nbsp;a&nbsp;worker&nbsp;held&nbsp;the&nbsp;lock&nbsp;for&nbsp;a&nbsp;couple&nbsp;hundred milliseconds,&nbsp;it&nbsp;could&nbsp;still&nbsp;affect&nbsp;the&nbsp;responsiveness&nbsp;of&nbsp;a&nbsp;web&nbsp;browser&nbsp;in&nbsp;a&nbsp;perceivable&nbsp;for&nbsp;no&nbsp;apparent&nbsp;reason&nbsp;(from&nbsp;the&nbsp;users&nbsp;perspective).&nbsp; For&nbsp;this&nbsp;reason,&nbsp;it&nbsp;was&nbsp;taken&nbsp;out&nbsp;of&nbsp;the&nbsp;spec.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;One&nbsp;possible&nbsp;solution&nbsp;is&nbsp;to add&nbsp;an&nbsp;asynchronous&nbsp;callback&nbsp;interface&nbsp;for&nbsp;LocalStorage&nbsp;into&nbsp;workers.&nbsp; For&nbsp;example:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;function&nbsp;myCallback(localStorage)&nbsp;{&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  localStorage.accountBalance&nbsp;=&nbsp;localStorage.accountBalance&nbsp;+&nbsp;100;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;}&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;executeLocalStorageCallback(myCallback);&nbsp; //&nbsp;TODO:&nbsp;Make&nbsp;this&nbsp;name&nbsp;better&nbsp; :-)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;interface&nbsp;is&nbsp;simple.&nbsp; You&nbsp;can&nbsp;only&nbsp;access&nbsp;localStorage&nbsp;via&nbsp;a&nbsp;callback.&nbsp; Any&nbsp;use&nbsp;outside&nbsp;of&nbsp;the&nbsp;callback&nbsp;is&nbsp;illegal&nbsp;and&nbsp;would&nbsp;raise&nbsp;an&nbsp;exception.&nbsp; The&nbsp;callback&nbsp;would&nbsp;acquire&nbsp;the&nbsp;storage&nbsp;mutex&nbsp;during&nbsp;execution,&nbsp;but&nbsp;the&nbsp;worker&#39;s&nbsp;execution&nbsp;would&nbsp;not&nbsp;block&nbsp;during&nbsp;this&nbsp;time.&nbsp; Of&nbsp;course,&nbsp;it&#39;s&nbsp;still&nbsp;possible&nbsp;for&nbsp;a&nbsp;poorly&nbsp;behaving&nbsp;worker&nbsp;to&nbsp;do&nbsp;large&nbsp;amounts&nbsp;of computation in&nbsp;the&nbsp;callback,&nbsp;but&nbsp;hopefully&nbsp;the&nbsp;fact&nbsp;they&#39;re&nbsp;executing&nbsp;in&nbsp;a&nbsp;callback&nbsp;makes&nbsp;the&nbsp;developer&nbsp;more&nbsp;aware&nbsp;of&nbsp;the&nbsp;problem.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;admit&nbsp;that&nbsp;this&nbsp;is&nbsp;not&nbsp;a&nbsp;great&nbsp;solution&nbsp;and&nbsp;would&nbsp;definitely&nbsp;like&nbsp;to&nbsp;hear&nbsp;alternate&nbsp;proposals.&nbsp; But,&nbsp;no&nbsp;matter&nbsp;what,&nbsp;I&nbsp;think&nbsp;we&nbsp;need&nbsp;to&nbsp;think&nbsp;seriously&nbsp;about&nbsp;giving&nbsp;workers&nbsp;access&nbsp;to&nbsp;LocalStorage&nbsp;again.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;J&lt;/div&gt;<br>

</tt>
