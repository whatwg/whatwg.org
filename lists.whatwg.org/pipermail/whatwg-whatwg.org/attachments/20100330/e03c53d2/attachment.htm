<tt>
I&amp;#39;ll&nbsp;note&nbsp;that&nbsp;the&nbsp;spec&nbsp;gives&nbsp;the&nbsp;UA&nbsp;an&nbsp;significant&nbsp;amount&nbsp;of&nbsp;latitude&nbsp;about&nbsp;its&nbsp;behavior&nbsp;after&nbsp;close()&nbsp;is&nbsp;called:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;sans-serif,&nbsp;&amp;#39;Droid&nbsp;Sans&nbsp;Fallback&amp;#39;;&nbsp;font-size:&nbsp;medium;&nbsp;line-height:&nbsp;21px;&nbsp;&quot;&gt;User&nbsp;agents&nbsp;may&nbsp;invoke&nbsp;the&nbsp;&amp;quot;&lt;a&nbsp;href=&quot;#kill-a-worker&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;204);&nbsp;background-image:&nbsp;initial;&nbsp;background-attachment:&nbsp;initial;&nbsp;background-origin:&nbsp;initial;&nbsp;background-clip:&nbsp;initial;&nbsp;background-color:&nbsp;transparent;&nbsp;background-position:&nbsp;initial&nbsp;initial;&nbsp;background-repeat:&nbsp;initial&nbsp;initial;&nbsp;&quot;&gt;kill&nbsp;a&nbsp;worker&lt;/a&gt;&amp;quot;&nbsp;processing&nbsp;model&nbsp;on&nbsp;a&nbsp;worker&nbsp;at&nbsp;any&nbsp;time,&nbsp;e.g.&nbsp;in&nbsp;response&nbsp;to&nbsp;user&nbsp;requests,&nbsp;in&nbsp;response&nbsp;to&nbsp;CPU&nbsp;quota&nbsp;management,&nbsp;or&nbsp;when&nbsp;a&nbsp;worker&nbsp;stops&nbsp;being&nbsp;an &lt;a&nbsp;href=&quot;#active-needed-worker&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;204);&nbsp;background-image:&nbsp;initial;&nbsp;background-attachment:&nbsp;initial;&nbsp;background-origin:&nbsp;initial;&nbsp;background-clip:&nbsp;initial;&nbsp;background-color:&nbsp;transparent;&nbsp;background-position:&nbsp;initial&nbsp;initial;&nbsp;background-repeat:&nbsp;initial&nbsp;initial;&nbsp;&quot;&gt;active&nbsp;needed&nbsp;worker&lt;/a&gt; if&nbsp;the&nbsp;worker&nbsp;continues&nbsp;executing&nbsp;even&nbsp;after&nbsp;its &lt;a&nbsp;href=&quot;#dom-workerglobalscope-closing&quot;&nbsp;title=&quot;dom-WorkerGlobalScope-closing&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;204);&nbsp;background-image:&nbsp;initial;&nbsp;background-attachment:&nbsp;initial;&nbsp;background-origin:&nbsp;initial;&nbsp;background-clip:&nbsp;initial;&nbsp;background-color:&nbsp;transparent;&nbsp;background-position:&nbsp;initial&nbsp;initial;&nbsp;background-repeat:&nbsp;initial&nbsp;initial;&nbsp;&quot;&gt;closing&lt;/a&gt; flag&nbsp;was&nbsp;set&nbsp;to&nbsp;true.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Essentially,&nbsp;UAs&nbsp;can&nbsp;kill&nbsp;a&nbsp;worker&nbsp;at&nbsp;any&nbsp;time,&nbsp;and&nbsp;since&nbsp;the&nbsp;&amp;quot;kill&nbsp;a&nbsp;worker&amp;quot;&nbsp;algorithm&nbsp;allows&nbsp;UAs&nbsp;to&nbsp;abort&nbsp;the&nbsp;script&nbsp;after&nbsp;a&nbsp;user-agent-defined&nbsp;amount&nbsp;of&nbsp;time&nbsp;(including&nbsp;zero),&nbsp;it&nbsp;seems&nbsp;like&nbsp;almost&nbsp;any&nbsp;behavior&nbsp;post-close&nbsp;is&nbsp;compliant.&nbsp;This&nbsp;seems&nbsp;like&nbsp;a&nbsp;guaranteed&nbsp;source&nbsp;of&nbsp;cross-browser&nbsp;incompatibilities.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;ve&nbsp;always&nbsp;operated&nbsp;under&nbsp;the&nbsp;impression&nbsp;that&nbsp;the&nbsp;intent&nbsp;of&nbsp;the&nbsp;spec&nbsp;is&nbsp;to&nbsp;allow&nbsp;pending&nbsp;worker&nbsp;operations&nbsp;to&nbsp;complete,&nbsp;but&nbsp;still&nbsp;give&nbsp;UAs&nbsp;the&nbsp;ability&nbsp;to&nbsp;abort&nbsp;scripts&nbsp;that&nbsp;don&amp;#39;t&nbsp;exit&nbsp;in&nbsp;a&nbsp;timely&nbsp;manner&nbsp;(so&nbsp;close()&nbsp;should&nbsp;not&nbsp;immediately&nbsp;abort&nbsp;the&nbsp;script),&nbsp;but&nbsp;I&nbsp;don&amp;#39;t&nbsp;see&nbsp;anything&nbsp;in&nbsp;the&nbsp;spec&nbsp;regarding&nbsp;this.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;#2&nbsp;below,&nbsp;I&nbsp;believe&nbsp;that&nbsp;exceptions&nbsp;in&nbsp;worker&nbsp;context&nbsp;should&nbsp;*always*&nbsp;be&nbsp;reported,&nbsp;regardless&nbsp;of&nbsp;closing&nbsp;state.&nbsp;Section&nbsp;4.6&nbsp;(Runtime&nbsp;script&nbsp;errors)&nbsp;makes&nbsp;no&nbsp;mention&nbsp;of&nbsp;tying&nbsp;this&nbsp;behavior&nbsp;to&nbsp;the&nbsp;closing&nbsp;flag.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-atw&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Mar&nbsp;30,&nbsp;2010&nbsp;at&nbsp;4:44&nbsp;PM,&nbsp;Dmitry&nbsp;Titov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:dimich@chromium.org&quot;&gt;dimich@chromium.org&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&gt;Hi!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Trying&nbsp;to&nbsp;fix&nbsp;some&nbsp;bugs&nbsp;for&nbsp;Workers,&nbsp;I&amp;#39;ve&nbsp;got&nbsp;some&nbsp;questions&nbsp;about&nbsp;&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-workers/current-work/#workerglobalscope&quot;&nbsp;target=&quot;_blank&quot;&gt;close()&nbsp;method&nbsp;on&nbsp;WorkerGlobalScope&lt;/a&gt;.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;particular,&nbsp;the&nbsp;spec&nbsp;seems&nbsp;to&nbsp;imply&nbsp;that&nbsp;after calling close()&nbsp;inside&nbsp;the&nbsp;worker,&nbsp;the&nbsp;JS&nbsp;does&nbsp;not&nbsp;get&nbsp;terminated&nbsp;right&nbsp;away,&nbsp;but&nbsp;rather&nbsp;continue&nbsp;to&nbsp;execute,&nbsp;while&nbsp;an&nbsp;internal&nbsp;&amp;#39;closing&amp;#39;&nbsp;flag&nbsp;is&nbsp;set&nbsp;and&nbsp;a&nbsp;message&nbsp;queue associated with&nbsp;the&nbsp;worker&nbsp;discards&nbsp;all&nbsp;the&nbsp;tasks,&nbsp;existing&nbsp;and&nbsp;future.&nbsp;Also,&nbsp;all&nbsp;ports&nbsp;are&nbsp;immediately&nbsp;disentangled.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;seems&nbsp;to&nbsp;leave&nbsp;some&nbsp;questions&nbsp;without&nbsp;explicit&nbsp;answer,&nbsp;with&nbsp;differences&nbsp;in&nbsp;current&nbsp;implementations:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;Does&nbsp;this&nbsp;code&nbsp;in&nbsp;a worker continues&nbsp;looping&nbsp;until&nbsp;the&nbsp;parent&nbsp;page&nbsp;unloads:&lt;/div&gt;<br>
<br>
&lt;div&gt; ...&lt;/div&gt;&lt;div&gt; close();&lt;/div&gt;&lt;div&gt; while(true)&nbsp;{}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;WebKit&nbsp;V8&nbsp;terminates,&nbsp;WebKit&nbsp;JCS&nbsp;terminates&nbsp;after&nbsp;a&nbsp;timeout,&nbsp;FF&nbsp;does&nbsp;not&nbsp;terminate.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;Do&nbsp;the&nbsp;errors&nbsp;propagate&nbsp;back&nbsp;to&nbsp;Worker&nbsp;object&nbsp;after&nbsp;close()?&lt;/div&gt;<br>
<br>
&lt;div&gt;...&lt;/div&gt;&lt;div&gt;close();&lt;/div&gt;&lt;div&gt;nonExistingFunction();&nbsp; &amp;lt;&amp;lt;--&nbsp;throws,&nbsp;if&nbsp;not&nbsp;processed&nbsp;locally,&nbsp;posts&nbsp;error&nbsp;info&nbsp;to&nbsp;the&nbsp;Worker&nbsp;object.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;WebKit&nbsp;and&nbsp;FF&nbsp;errors&nbsp;propagate,&nbsp;although&nbsp;it&nbsp;does&nbsp;not&nbsp;seem&nbsp;consistent&nbsp;while&nbsp;worker&nbsp;closed&nbsp;all&nbsp;the&nbsp;ports&nbsp;and&nbsp;is&nbsp;in&nbsp;a&nbsp;dormant&nbsp;state.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.&nbsp;Should&nbsp;synchronous&nbsp;operations&nbsp;work&nbsp;after&nbsp;close()?&nbsp;Asynchronous&nbsp;ones&nbsp;perhaps&nbsp;should&nbsp;not,&nbsp;because&nbsp;of&nbsp;the&nbsp;event&nbsp;loop&nbsp;queue&nbsp;which&nbsp;is&nbsp;stopped...&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;close();&lt;/div&gt;&lt;div&gt;xhr.open(&amp;quot;GET&amp;quot;,&nbsp;&amp;quot;&lt;a&nbsp;href=&quot;http://foo.com&quot;&nbsp;target=&quot;_blank&quot;&gt;foo.com&lt;/a&gt;&amp;quot;,&nbsp;&lt;b&gt;false&lt;/b&gt;);&lt;/div&gt;<br>
<br>
&lt;div&gt;xhr.send();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;WebKit:&nbsp;does&nbsp;not&nbsp;work&nbsp;(mostly),&nbsp;FF&nbsp;-&nbsp;does&nbsp;work.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Perhaps&nbsp;it&nbsp;would&nbsp;be&nbsp;simpler&nbsp;to&nbsp;either&nbsp;say&nbsp;nothing&nbsp;is&nbsp;executed/posted/fired&nbsp;after&nbsp;close()&nbsp;(immediate&nbsp;termination),&nbsp;or&nbsp;to&nbsp;enable&nbsp;worker&nbsp;run&nbsp;unimpeded&nbsp;(with&nbsp;ports&nbsp;open,&nbsp;etc)&nbsp;until&nbsp;it&nbsp;naturally&nbsp;yields&nbsp;from&nbsp;JS.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;opinions?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;br&gt;Dmitry&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
