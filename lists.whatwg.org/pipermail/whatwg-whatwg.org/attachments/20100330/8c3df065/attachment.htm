<tt>
&lt;div&gt;Hi!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Trying&nbsp;to&nbsp;fix&nbsp;some&nbsp;bugs&nbsp;for&nbsp;Workers,&nbsp;I&amp;#39;ve&nbsp;got&nbsp;some&nbsp;questions&nbsp;about&nbsp;&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-workers/current-work/#workerglobalscope&quot;&gt;close()&nbsp;method&nbsp;on&nbsp;WorkerGlobalScope&lt;/a&gt;.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;particular,&nbsp;the&nbsp;spec&nbsp;seems&nbsp;to&nbsp;imply&nbsp;that&nbsp;after calling close()&nbsp;inside&nbsp;the&nbsp;worker,&nbsp;the&nbsp;JS&nbsp;does&nbsp;not&nbsp;get&nbsp;terminated&nbsp;right&nbsp;away,&nbsp;but&nbsp;rather&nbsp;continue&nbsp;to&nbsp;execute,&nbsp;while&nbsp;an&nbsp;internal&nbsp;&amp;#39;closing&amp;#39;&nbsp;flag&nbsp;is&nbsp;set&nbsp;and&nbsp;a&nbsp;message&nbsp;queue associated with&nbsp;the&nbsp;worker&nbsp;discards&nbsp;all&nbsp;the&nbsp;tasks,&nbsp;existing&nbsp;and&nbsp;future.&nbsp;Also,&nbsp;all&nbsp;ports&nbsp;are&nbsp;immediately&nbsp;disentangled.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;seems&nbsp;to&nbsp;leave&nbsp;some&nbsp;questions&nbsp;without&nbsp;explicit&nbsp;answer,&nbsp;with&nbsp;differences&nbsp;in&nbsp;current&nbsp;implementations:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;Does&nbsp;this&nbsp;code&nbsp;in&nbsp;a worker continues&nbsp;looping&nbsp;until&nbsp;the&nbsp;parent&nbsp;page&nbsp;unloads:&lt;/div&gt;<br>
&lt;div&gt; ...&lt;/div&gt;&lt;div&gt; close();&lt;/div&gt;&lt;div&gt; while(true)&nbsp;{}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;WebKit&nbsp;V8&nbsp;terminates,&nbsp;WebKit&nbsp;JCS&nbsp;terminates&nbsp;after&nbsp;a&nbsp;timeout,&nbsp;FF&nbsp;does&nbsp;not&nbsp;terminate.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;Do&nbsp;the&nbsp;errors&nbsp;propagate&nbsp;back&nbsp;to&nbsp;Worker&nbsp;object&nbsp;after&nbsp;close()?&lt;/div&gt;<br>
&lt;div&gt;...&lt;/div&gt;&lt;div&gt;close();&lt;/div&gt;&lt;div&gt;nonExistingFunction();&nbsp; &amp;lt;&amp;lt;--&nbsp;throws,&nbsp;if&nbsp;not&nbsp;processed&nbsp;locally,&nbsp;posts&nbsp;error&nbsp;info&nbsp;to&nbsp;the&nbsp;Worker&nbsp;object.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;WebKit&nbsp;and&nbsp;FF&nbsp;errors&nbsp;propagate,&nbsp;although&nbsp;it&nbsp;does&nbsp;not&nbsp;seem&nbsp;consistent&nbsp;while&nbsp;worker&nbsp;closed&nbsp;all&nbsp;the&nbsp;ports&nbsp;and&nbsp;is&nbsp;in&nbsp;a&nbsp;dormant&nbsp;state.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.&nbsp;Should&nbsp;synchronous&nbsp;operations&nbsp;work&nbsp;after&nbsp;close()?&nbsp;Asynchronous&nbsp;ones&nbsp;perhaps&nbsp;should&nbsp;not,&nbsp;because&nbsp;of&nbsp;the&nbsp;event&nbsp;loop&nbsp;queue&nbsp;which&nbsp;is&nbsp;stopped...&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;close();&lt;/div&gt;&lt;div&gt;xhr.open(&amp;quot;GET&amp;quot;,&nbsp;&amp;quot;&lt;a&nbsp;href=&quot;http://foo.com&quot;&gt;foo.com&lt;/a&gt;&amp;quot;,&nbsp;&lt;b&gt;false&lt;/b&gt;);&lt;/div&gt;<br>
&lt;div&gt;xhr.send();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;WebKit:&nbsp;does&nbsp;not&nbsp;work&nbsp;(mostly),&nbsp;FF&nbsp;-&nbsp;does&nbsp;work.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Perhaps&nbsp;it&nbsp;would&nbsp;be&nbsp;simpler&nbsp;to&nbsp;either&nbsp;say&nbsp;nothing&nbsp;is&nbsp;executed/posted/fired&nbsp;after&nbsp;close()&nbsp;(immediate&nbsp;termination),&nbsp;or&nbsp;to&nbsp;enable&nbsp;worker&nbsp;run&nbsp;unimpeded&nbsp;(with&nbsp;ports&nbsp;open,&nbsp;etc)&nbsp;until&nbsp;it&nbsp;naturally&nbsp;yields&nbsp;from&nbsp;JS.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;opinions?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;br&gt;Dmitry&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
