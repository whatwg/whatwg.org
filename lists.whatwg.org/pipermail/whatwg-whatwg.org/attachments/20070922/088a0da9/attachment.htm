<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;<br>
&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Monaco;&nbsp;font-size:&nbsp;10px;&nbsp;&quot;&gt;&lt;div&gt;The&nbsp;callback&nbsp;syntax&nbsp;is&nbsp;nice&nbsp;but&nbsp;the&nbsp;implicit&nbsp;thread-global&nbsp;transaction&nbsp;is&nbsp;confusing&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;programmer&nbsp;error&nbsp;and&nbsp;unneeded&nbsp;database&nbsp;locking.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;Commonly&nbsp;there&nbsp;is&nbsp;a&nbsp;implicit&nbsp;transaction&nbsp;per&nbsp;query&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;explicit&nbsp;transaction&nbsp;created.&nbsp;I&nbsp;think&nbsp;this&nbsp;is&nbsp;what&nbsp;developers&nbsp;will&nbsp;expect,&nbsp;after&nbsp;using&nbsp;server&nbsp;side&nbsp;databases.&nbsp;In&nbsp;a&nbsp;complex&nbsp;web&nbsp;application,&nbsp;an&nbsp;implicit&nbsp;thread-global&nbsp;transaction&nbsp;will&nbsp;cause&nbsp;questions&nbsp;on&nbsp;when&nbsp;it&nbsp;began.&nbsp;The&nbsp;code&nbsp;can&nbsp;be&nbsp;spread&nbsp;all&nbsp;over,&nbsp;and&nbsp;will&nbsp;not&nbsp;always&nbsp;be&nbsp;written&nbsp;out&nbsp;using&nbsp;closures&nbsp;for&nbsp;the&nbsp;callbacks.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;doesn't&nbsp;look&nbsp;like&nbsp;you&nbsp;can&nbsp;rollback&nbsp;the&nbsp;implicit&nbsp;transaction&nbsp;(one&nbsp;of&nbsp;the&nbsp;big&nbsp;features&nbsp;of&nbsp;transactions.)&nbsp;Also&nbsp;what&nbsp;access&nbsp;locks&nbsp;does&nbsp;the&nbsp;implicit&nbsp;transaction&nbsp;take?&nbsp;What&nbsp;if&nbsp;you&nbsp;need&nbsp;exclusive&nbsp;access&nbsp;to&nbsp;the&nbsp;database&nbsp;temporarily?&nbsp;These&nbsp;cases&nbsp;would&nbsp;be&nbsp;solved&nbsp;by&nbsp;adding&nbsp;explicit&nbsp;transactions&nbsp;with&nbsp;control&nbsp;to&nbsp;access&nbsp;locks&nbsp;and&nbsp;rolling&nbsp;back.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;explicit&amp;nbsp;transactions&amp;nbsp;are&nbsp;not&nbsp;added&nbsp;developers&nbsp;will&nbsp;take&nbsp;advantage&nbsp;of&nbsp;what&nbsp;they&nbsp;have&nbsp;access&nbsp;to&nbsp;using&nbsp;the&nbsp;implicit&nbsp;transactions.&nbsp;(I&nbsp;assume&nbsp;each&nbsp;Database&nbsp;object&nbsp;will&nbsp;have&nbsp;it's&nbsp;own&nbsp;implicit&nbsp;thread-global&nbsp;transaction.)&nbsp;So&nbsp;you&nbsp;could&nbsp;open&nbsp;two&nbsp;Database&nbsp;objects&nbsp;for&nbsp;the&nbsp;same&nbsp;database&nbsp;and&nbsp;execute&nbsp;two&nbsp;simultaneous&nbsp;implicit&nbsp;transactions.&nbsp;But&nbsp;you&nbsp;would&nbsp;need&nbsp;to&nbsp;write&nbsp;your&nbsp;own&nbsp;rollback&nbsp;code&nbsp;if&nbsp;you&nbsp;need&nbsp;to&amp;nbsp;programatically&amp;nbsp;bail&nbsp;out&nbsp;of&nbsp;a&nbsp;transaction&nbsp;and&amp;nbsp;restore&amp;nbsp;any&nbsp;previous&nbsp;values.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;propose&nbsp;that&nbsp;the&nbsp;implicit&nbsp;transaction&nbsp;be&nbsp;scoped&nbsp;to&nbsp;only&nbsp;one&nbsp;query&nbsp;at&nbsp;a&nbsp;time,&nbsp;like&nbsp;I&nbsp;mentioned&nbsp;earlier.&nbsp;Then&nbsp;add&nbsp;explicit&nbsp;transactions&nbsp;that&nbsp;you&nbsp;create&nbsp;from&nbsp;a&nbsp;Database&nbsp;object.&amp;nbsp;Then&nbsp;you&nbsp;can&nbsp;start&nbsp;two&nbsp;simultaneous&nbsp;transactions&nbsp;on&nbsp;the&nbsp;same&nbsp;Database&nbsp;object,&nbsp;which&nbsp;is&nbsp;nicer&nbsp;than&nbsp;holding&nbsp;two&nbsp;Database&nbsp;objects&nbsp;for&nbsp;the&nbsp;same&nbsp;database&nbsp;just&nbsp;for&nbsp;concurrent&nbsp;access.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;is&nbsp;an&nbsp;example&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;line-height:&nbsp;20px;&nbsp;&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;line-height:&nbsp;20px;&nbsp;&quot;&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;transation1&nbsp;=&nbsp;db.&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;51,&nbsp;105);&nbsp;&quot;&gt;beginTransation&lt;/span&gt;();&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;transation1.&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;51,&nbsp;105);&nbsp;&quot;&gt;executeQuery&lt;/span&gt;(&lt;span&nbsp;style=&quot;color:&nbsp;rgb(235,&nbsp;115,&nbsp;0);&nbsp;&quot;&gt;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;document&quot;&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(136,&nbsp;19,&nbsp;80);&nbsp;&quot;&gt;function&lt;/span&gt;(result1)&nbsp;{&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(136,&nbsp;19,&nbsp;80);&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;if&lt;/span&gt;(...)&nbsp;{&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;color:&nbsp;rgb(235,&nbsp;115,&nbsp;0);&nbsp;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;result1.transation.&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;51,&nbsp;105);&nbsp;&quot;&gt;executeQuery&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;(&lt;/span&gt;&quot;UPDATE&nbsp;document&nbsp;WITH&nbsp;...&nbsp;WHERE&nbsp;document&nbsp;=&nbsp;?&quot;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;,&nbsp;result1.&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;51,&nbsp;105);&nbsp;&quot;&gt;namedItem&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;(&lt;/span&gt;&quot;id&quot;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;),&amp;nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(136,&nbsp;19,&nbsp;80);&nbsp;&quot;&gt;function&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;(result2)&nbsp;{&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;...&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;});&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;});&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;min-height:&nbsp;14px;&nbsp;&quot;&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;min-height:&nbsp;14px;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;transation2&nbsp;=&nbsp;db.&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;51,&nbsp;105);&nbsp;&quot;&gt;beginTransation&lt;/span&gt;(Database.ExclusiveTransactionLocks);&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;color:&nbsp;rgb(235,&nbsp;115,&nbsp;0);&nbsp;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;transation2.&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;51,&nbsp;105);&nbsp;&quot;&gt;executeQuery&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;(&lt;/span&gt;&quot;UPDATE&nbsp;user&nbsp;WITH&nbsp;...&nbsp;WHERE&nbsp;user&nbsp;=&nbsp;?&quot;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;,&amp;nbsp;&lt;/span&gt;&quot;123&quot;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;,&amp;nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(136,&nbsp;19,&nbsp;80);&nbsp;&quot;&gt;function&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;(result1)&nbsp;{&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(136,&nbsp;19,&nbsp;80);&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;if&lt;/span&gt;(...)&nbsp;{&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;result1.transation.&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;51,&nbsp;105);&nbsp;&quot;&gt;executeQuery&lt;/span&gt;(&lt;span&nbsp;style=&quot;color:&nbsp;rgb(235,&nbsp;115,&nbsp;0);&nbsp;&quot;&gt;&quot;UPDATE&nbsp;user&nbsp;WITH&nbsp;...&nbsp;WHERE&nbsp;user&nbsp;=&nbsp;?&quot;&lt;/span&gt;,&nbsp;result1.&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;51,&nbsp;105);&nbsp;&quot;&gt;namedItem&lt;/span&gt;(&lt;span&nbsp;style=&quot;color:&nbsp;rgb(235,&nbsp;115,&nbsp;0);&nbsp;&quot;&gt;&quot;id&quot;&lt;/span&gt;),&amp;nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(136,&nbsp;19,&nbsp;80);&nbsp;&quot;&gt;function&lt;/span&gt;(result2)&nbsp;{&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;result1.transation.commit();&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;});&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&amp;nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(136,&nbsp;19,&nbsp;80);&nbsp;&quot;&gt;else&lt;/span&gt;&amp;nbsp;{&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;result1.transation.&lt;span&nbsp;style=&quot;color:&nbsp;rgb(102,&nbsp;26,&nbsp;169);&nbsp;&quot;&gt;rollback&lt;/span&gt;();&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;line-height:&nbsp;20px;&nbsp;&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/span&gt;});&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;My&nbsp;example&nbsp;executes&nbsp;queries&nbsp;on&nbsp;the&nbsp;transaction&nbsp;object.&nbsp;The&nbsp;transaction&nbsp;object&nbsp;would&nbsp;internally&nbsp;keep&nbsp;track&nbsp;of&nbsp;the&nbsp;database&nbsp;connection&nbsp;it&nbsp;holds.&nbsp;Transactions&nbsp;can&nbsp;come&nbsp;in&nbsp;a&nbsp;couple&nbsp;of&nbsp;forms,&amp;nbsp;shared&nbsp;and&nbsp;exclusive&nbsp;access&nbsp;locks&nbsp;(read&amp;nbsp;&lt;a&nbsp;href=&quot;http://www.sqlite.org/lang_transaction.html&quot;&gt;http://www.sqlite.org/lang_transaction.html&lt;/a&gt;&amp;nbsp;for&nbsp;details&nbsp;on&nbsp;these.)&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;I&nbsp;think&nbsp;an&nbsp;explicit&nbsp;commit&nbsp;should&nbsp;be&nbsp;required&nbsp;for&nbsp;the&nbsp;transactions.&nbsp;So&nbsp;you&nbsp;can&nbsp;keep&nbsp;the&nbsp;transcript&nbsp;object&nbsp;around&nbsp;and&nbsp;add&nbsp;to&nbsp;it&nbsp;over&nbsp;time.&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;10px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;Above&nbsp;I&nbsp;have&nbsp;beginTransation&nbsp;taking&nbsp;a&nbsp;constant&nbsp;Database.ExclusiveTransactionLocks.&nbsp;Passing&nbsp;no&nbsp;argument&nbsp;would&nbsp;get&nbsp;shared&nbsp;access&nbsp;locks.&nbsp;Also&nbsp;in&nbsp;my&nbsp;example&nbsp;is&nbsp;an&nbsp;explicit&nbsp;rollback.&nbsp;Any&nbsp;query&nbsp;that&nbsp;fails&nbsp;will&nbsp;naturally&nbsp;rollback&nbsp;the&nbsp;transaction,&nbsp;but&nbsp;having&nbsp;progrmatic&nbsp;way&nbsp;to&nbsp;rollback&nbsp;is&nbsp;a&nbsp;necessity.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;&lt;div&gt;The&nbsp;closeTransaction&nbsp;Database&nbsp;object&nbsp;function&nbsp;should&nbsp;be&nbsp;remove&nbsp;if&amp;nbsp;explicit&nbsp;transactions&nbsp;are&nbsp;added&nbsp;and&nbsp;the&nbsp;implicit&nbsp;transaction&nbsp;is&nbsp;limited&nbsp;to&nbsp;one&nbsp;query.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;Some&nbsp;other&nbsp;comments:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;You&nbsp;might&nbsp;notice&nbsp;that&nbsp;I&nbsp;have&nbsp;been&nbsp;using&nbsp;executeQuery()&nbsp;instead&nbsp;of&nbsp;executeSql().&nbsp;I&nbsp;think&nbsp;it&nbsp;is&nbsp;weird&nbsp;and&nbsp;unneeded&nbsp;to&nbsp;say&nbsp;Sql&nbsp;in&nbsp;the&nbsp;function&nbsp;name.&nbsp;If&nbsp;anything,&nbsp;it&nbsp;should&nbsp;be&nbsp;executeSQL().&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Verdana&quot;&nbsp;size=&quot;3&quot;&gt;I&nbsp;think&nbsp;the&nbsp;ResultSet&nbsp;object&nbsp;should&nbsp;have&nbsp;a&nbsp;property&nbsp;to&nbsp;get&nbsp;the&nbsp;Database&nbsp;and&nbsp;the&nbsp;Transaction&nbsp;objects.&nbsp;As&nbsp;I&nbsp;mentioned&nbsp;earlier,&nbsp;not&nbsp;everyone&nbsp;will&nbsp;use&nbsp;closures&nbsp;and&nbsp;will&nbsp;need&nbsp;access&nbsp;to&nbsp;these&nbsp;to&nbsp;do&nbsp;anything&nbsp;else.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;&nbsp;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;separate;&nbsp;border-spacing:&nbsp;0px&nbsp;0px;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Verdana;&nbsp;font-size:&nbsp;11px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;text-align:&nbsp;auto;&nbsp;-khtml-text-decorations-in-effect:&nbsp;none;&nbsp;text-indent:&nbsp;0px;&nbsp;-apple-text-size-adjust:&nbsp;auto;&nbsp;text-transform:&nbsp;none;&nbsp;orphans:&nbsp;2;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;2;&nbsp;word-spacing:&nbsp;0px;&nbsp;&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-khtml-nbsp-mode:&nbsp;space;&nbsp;-khtml-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;10px;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;10px;&nbsp;&quot;&gt;—&nbsp;Timothy&nbsp;Hatcher&lt;/span&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;/span&gt;&nbsp;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
