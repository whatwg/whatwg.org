<tt>
&lt;div&gt;&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;On&nbsp;Thu,&nbsp;Nov&nbsp;11,&nbsp;2010&nbsp;at&nbsp;5:48&nbsp;PM,&nbsp;Jonas&nbsp;Sicking &lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;jonas@sicking.cc&gt;&lt;/span&gt; wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
When&nbsp;setting&nbsp;.innerHTML&nbsp;browsers&nbsp;always&nbsp;have&nbsp;prevented&nbsp;any&nbsp;created&lt;br&gt;&lt;script&gt;s&nbsp;from&nbsp;running.&nbsp;We&nbsp;ended&nbsp;up&nbsp;copying&nbsp;this&nbsp;behavior&nbsp;from&nbsp;IE&nbsp;when&lt;br&gt;we&nbsp;originally&nbsp;implemented&nbsp;.innerHTML&nbsp;in&nbsp;firefox&nbsp;(then&nbsp;netscape)&nbsp;since&lt;br&gt;<br>
<br>
sites&nbsp;were&nbsp;relying&nbsp;on&nbsp;it.&lt;br&gt;&lt;br&gt;In&nbsp;particular&nbsp;sites&nbsp;were&nbsp;doing&nbsp;things&nbsp;like&lt;br&gt;&lt;br&gt;a.innerHTML&nbsp;=&nbsp;b.innerHTML;&lt;br&gt;and&lt;br&gt;a.innerHTML&nbsp;+=&nbsp;&quot;&lt;b&gt;what&#39;s&nbsp;up&nbsp;dog&lt;/b&gt;&quot;;&nbsp; (btw,&nbsp;perf-wise&nbsp;this&nbsp;is&lt;br&gt;terrible,&nbsp;but&nbsp;people&nbsp;do&nbsp;do&nbsp;it).&lt;br&gt;<br>
<br>
&lt;br&gt;and&nbsp;in&nbsp;both&nbsp;cases&nbsp;fell&nbsp;over&nbsp;when&nbsp;scripts&nbsp;in&nbsp;a&nbsp;&quot;re-executed&quot;.&nbsp;So&nbsp;your&lt;br&gt;example&nbsp;above&nbsp;should&nbsp;not&nbsp;alert&nbsp;if&nbsp;you&nbsp;want&nbsp;your&nbsp;browser&nbsp;to&nbsp;be&lt;br&gt;compatible&nbsp;with&nbsp;the&nbsp;web.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ok,&nbsp;so&nbsp;we&nbsp;agree&nbsp;on&nbsp;this&nbsp;case.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
For&nbsp;range.createContextualFragment&nbsp;things&nbsp;are&nbsp;different&nbsp;though.&nbsp;(The&lt;br&gt;function&nbsp;returns&nbsp;a&nbsp;fragment,&nbsp;and&nbsp;so&nbsp;its&nbsp;obvious&nbsp;that&nbsp;script&nbsp;should&lt;br&gt;never&nbsp;execute&nbsp;*during*&nbsp;exeuction&nbsp;of&nbsp;createContextualFragment,&nbsp;the&lt;br&gt;question&nbsp;is&nbsp;if&nbsp;they&nbsp;should&nbsp;execute&nbsp;if&nbsp;that&nbsp;fragment&nbsp;is&nbsp;later&nbsp;inserted&lt;br&gt;<br>
<br>
in&nbsp;a&nbsp;document).&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don&#39;t&nbsp;think&nbsp;we&nbsp;should&nbsp;execute&nbsp;either.&nbsp; Why&nbsp;should&nbsp;we&nbsp;treat&nbsp;fragments&nbsp;created&nbsp;by createContextualFragment&nbsp;differently&nbsp;from&nbsp;fragments&nbsp;created&nbsp;by&nbsp;innerHTML?&nbsp; That&nbsp;sounds&nbsp;arbitrary&nbsp;and&nbsp;confusing.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
First&nbsp;off,&nbsp;there&nbsp;is&nbsp;no&nbsp;spec&nbsp;for&nbsp;createContextualFragment&nbsp;so&nbsp;there&nbsp;is&lt;br&gt;no&nbsp;spec&nbsp;text&nbsp;to&nbsp;turn&nbsp;to.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;On&nbsp;Thu,&nbsp;Nov&nbsp;11,&nbsp;2010&nbsp;at&nbsp;10:22&nbsp;PM,&nbsp;Henri&nbsp;Sivonen &lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:hsivonen@iki.fi&quot;&gt;hsivonen@iki.fi&lt;/a&gt;&gt;&lt;/span&gt; wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&gt;&nbsp;First&nbsp;off,&nbsp;there&nbsp;is&nbsp;no&nbsp;spec&nbsp;for&nbsp;createContextualFragment&nbsp;so&nbsp;there&nbsp;is&lt;br&gt;&gt;&nbsp;no&nbsp;spec&nbsp;text&nbsp;to&nbsp;turn&nbsp;to.&lt;br&gt;&lt;br&gt;&lt;/div&gt;There&nbsp;is&nbsp;now:&lt;br&gt;&lt;a&nbsp;href=&quot;http://html5.org/specs/dom-parsing.html#extensions-to-the-range-interface&quot;&nbsp;target=&quot;_blank&quot;&gt;http://html5.org/specs/dom-parsing.html#extensions-to-the-range-interface&lt;/a&gt;&lt;/blockquote&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;According&nbsp;to&nbsp;the&nbsp;part&nbsp;of&nbsp;spec&nbsp;Heri&nbsp;referenced,&nbsp;we&nbsp;should&nbsp;NOT&nbsp;run&nbsp;scripts&nbsp;in&nbsp;a&nbsp;fragment&nbsp;created&nbsp;by createContextualFragment either&nbsp;because&nbsp;we&nbsp;invoke&nbsp;the&nbsp;same&nbsp;HTML&nbsp;fragment&nbsp;parsing&nbsp;algorithm,&nbsp;which&nbsp;sets&nbsp;&quot;already&nbsp;started&quot;&nbsp;flag&nbsp;before&nbsp;inserting&nbsp;the&nbsp;script&nbsp;element&nbsp;into&nbsp;the&nbsp;document.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
*&nbsp;Firefox&nbsp;has&nbsp;always&nbsp;left&nbsp;scripts&nbsp;created&nbsp;using&lt;br&gt;createContextualFragment&nbsp;as&nbsp;executable.&nbsp;So&nbsp;web&nbsp;compatibility&nbsp;would &lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
speak&nbsp;for&nbsp;making&nbsp;the&nbsp;scripts&nbsp;executable.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Opera&nbsp;seems&nbsp;to&nbsp;execute&nbsp;scripts&nbsp;created&nbsp;by&nbsp;createContexualFragment&nbsp;as&nbsp;well.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
*&nbsp;It&nbsp;seems&nbsp;somewhat&nbsp;weird&nbsp;to&nbsp;single&nbsp;out&nbsp;script&nbsp;elements&nbsp;as&nbsp;being&nbsp;the&lt;br&gt;only&nbsp;ones&nbsp;to&nbsp;receive&nbsp;special&nbsp;treatment&nbsp;by&nbsp;disabling&nbsp;them.&nbsp;Things&nbsp;like&lt;br&gt;onclick&nbsp;attributes&nbsp;are&nbsp;still&nbsp;enabled.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;we&nbsp;already&nbsp;do&nbsp;this&nbsp;for&nbsp;innerHTML.&nbsp; I&nbsp;don&#39;t&nbsp;think&nbsp;it&#39;s&nbsp;weird&nbsp;to&nbsp;single&nbsp;out&nbsp;script&nbsp;elements&nbsp;given&nbsp;the&nbsp;security&nbsp;implications.&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
*&nbsp;Since&nbsp;scripts&nbsp;don&#39;t&nbsp;execute&nbsp;synchronously&nbsp;from&nbsp;within&lt;br&gt;createContextualFragment&nbsp;the&nbsp;caller&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;deal&nbsp;with&nbsp;weird&lt;br&gt;reentrancy&nbsp;issues&nbsp;during&nbsp;parsing.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sure&nbsp;but&nbsp;that&nbsp;means&nbsp;we&nbsp;have&nbsp;to&nbsp;special-case&nbsp;fragments&nbsp;created&nbsp;by createContexualFragment.&nbsp; That&nbsp;adds&nbsp;extra&nbsp;complexity&nbsp;to&nbsp;the&nbsp;HTML&nbsp;fragment&nbsp;parsing&nbsp;algorithm.&lt;/div&gt;<br>
<br>
&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
<br>
For&nbsp;these&nbsp;reasons&nbsp;we&nbsp;decided&nbsp;to&nbsp;keep&nbsp;Firefox&nbsp;4&nbsp;behaving&nbsp;like&nbsp;previous&lt;br&gt;versions&nbsp;of&nbsp;firefox&nbsp;and&nbsp;allow&nbsp;scripts&nbsp;created&nbsp;using&lt;br&gt;createContextualFragment&nbsp;to&nbsp;execute.&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;However,&nbsp;Firefox&nbsp;4.0&nbsp;Beta&nbsp;6&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;script&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;tested.&nbsp; Try&nbsp;opening &lt;a&nbsp;href=&quot;http://dscoder.com/MessageStyle/testcase.html&quot;&gt;http://dscoder.com/MessageStyle/testcase.html&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;- Ryosuke&nbsp;Niwa&lt;/div&gt;<br>

</tt>
