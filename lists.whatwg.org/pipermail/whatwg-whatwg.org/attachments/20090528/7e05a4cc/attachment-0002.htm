<tt>
So&nbsp;I&nbsp;got&nbsp;a&nbsp;chance&nbsp;to&nbsp;review&nbsp;the&nbsp;latest&nbsp;changes&nbsp;(Hurray&nbsp;for&nbsp;the&nbsp;tracking&nbsp;view!: &lt;a&nbsp;href=&quot;http://html5.org/tools/web-workers-tracker?from=139&amp;to=140&quot;&gt;http://html5.org/tools/web-workers-tracker?from=139&amp;to=140&lt;/a&gt;).&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Do&nbsp;we&nbsp;still&nbsp;need&nbsp;the&nbsp;concept&nbsp;of&nbsp;a&nbsp;&quot;protected&quot;&nbsp;worker?&nbsp;We&nbsp;define&nbsp;what&nbsp;a&nbsp;protected&nbsp;worker&nbsp;is,&nbsp;but&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;reference&nbsp;that&nbsp;definition&nbsp;anywhere&nbsp;in&nbsp;the&nbsp;spec&nbsp;anymore,&nbsp;since&nbsp;active&nbsp;needed/permissible&nbsp;status&nbsp;is&nbsp;entirely&nbsp;driven&nbsp;by&nbsp;the&nbsp;existence&nbsp;of&nbsp;active/inactive&nbsp;documents.&lt;br&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Overall&nbsp;it&nbsp;looks&nbsp;good,&nbsp;and&nbsp;I&nbsp;think&nbsp;the&nbsp;steps&nbsp;taken&nbsp;to&nbsp;remove&nbsp;GC&nbsp;behavior&nbsp;from&nbsp;the&nbsp;spec&nbsp;will&nbsp;greatly&nbsp;facility&nbsp;implementation.&nbsp;However, I&nbsp;did&nbsp;have&nbsp;a&nbsp;question&nbsp;about&nbsp;the&nbsp;definition&nbsp;of&nbsp;orphaned&nbsp;workers&nbsp;and&nbsp;&quot;active&nbsp;needed&quot;&nbsp;workers:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;webkit-indent-blockquote&quot;&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;16px;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;A&nbsp;worker&nbsp;is&nbsp;said&nbsp;to&nbsp;be&nbsp;an&nbsp;&lt;/span&gt;&lt;b&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;active&nbsp;needed&nbsp;worker&lt;/span&gt;&lt;/b&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;&nbsp;if&nbsp;any&nbsp;of&nbsp;the&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font:&nbsp;13.0px&nbsp;Courier;&nbsp;color:&nbsp;#e35316&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;Document&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;&nbsp;objects&nbsp;in&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://dev.w3.org/html5/workers/#the-worker-s-documents&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:&nbsp;underline&nbsp;;&nbsp;color:&nbsp;#0014c7&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;the&nbsp;worker&#39;s&nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font:&nbsp;13.0px&nbsp;Courier;&nbsp;color:&nbsp;#e35316&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;Document&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;text-decoration:&nbsp;underline&nbsp;;&nbsp;color:&nbsp;#0014c7&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;s&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;&nbsp;are&nbsp;fully&nbsp;active.&lt;br&gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;16px;&nbsp;&quot;&gt;&lt;b&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;Closing&nbsp;orphan&nbsp;workers&lt;/span&gt;&lt;/b&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;:&nbsp;Start&nbsp;monitoring&nbsp;the&nbsp;worker&nbsp;such&nbsp;that&nbsp;no&nbsp;sooner&nbsp;than&nbsp;it&nbsp;stops&nbsp;being&nbsp;either&nbsp;an&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://dev.w3.org/html5/workers/#active-needed-worker&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:&nbsp;underline&nbsp;;&nbsp;color:&nbsp;#0014c7&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;active&nbsp;needed&nbsp;worker&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;&nbsp;or&nbsp;a&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://dev.w3.org/html5/workers/#suspendable-worker&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:&nbsp;underline&nbsp;;&nbsp;color:&nbsp;#0014c7&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;suspendable&nbsp;worker&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;,&nbsp;and&nbsp;no&nbsp;later&nbsp;than&nbsp;it&nbsp;stops&nbsp;being&nbsp;a&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://dev.w3.org/html5/workers/#permissible-worker&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:&nbsp;underline&nbsp;;&nbsp;color:&nbsp;#0014c7&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;permissible&nbsp;worker&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;,&nbsp;&lt;/span&gt;&lt;i&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;worker&nbsp;global&nbsp;scope&lt;/span&gt;&lt;/i&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;&#39;s&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://dev.w3.org/html5/workers/#dom-workerglobalscope-closing&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:&nbsp;underline&nbsp;;&nbsp;color:&nbsp;#0014c7&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;closing&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;&nbsp;flag&nbsp;is&nbsp;set&nbsp;to&nbsp;true.&lt;/span&gt;&lt;/span&gt;&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;sounds&nbsp;like&nbsp;the&nbsp;worker&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;not&nbsp;be&nbsp;orphaned&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;parent&nbsp;window&nbsp;is&nbsp;active,&nbsp;even&nbsp;if&nbsp;the&nbsp;user&nbsp;agent&nbsp;is&nbsp;able&nbsp;to&nbsp;identify&nbsp;that&nbsp;the&nbsp;worker&nbsp;is&nbsp;not&nbsp;reachable,&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;stronger&nbsp;guarantee&nbsp;than&nbsp;was&nbsp;intended.&nbsp;Perhaps&nbsp;the&nbsp;spec&nbsp;already&nbsp;has&nbsp;an&nbsp;implicit&nbsp;assumption&nbsp;that&nbsp;UAs&nbsp;are&nbsp;able&nbsp;to&nbsp;do&nbsp;whatever&nbsp;they&nbsp;want&nbsp;with&nbsp;unreachable&nbsp;items?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-atw&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;May&nbsp;28,&nbsp;2009&nbsp;at&nbsp;1:08&nbsp;PM,&nbsp;Ian&nbsp;Hickson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:ian@hixie.ch&quot;&gt;ian@hixie.ch&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Thu,&nbsp;28&nbsp;May&nbsp;2009,&nbsp;Maciej&nbsp;Stachowiak&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;assuming&nbsp;this&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;changes:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;User&nbsp;agents&nbsp;must&nbsp;either&nbsp;act&nbsp;as&nbsp;if&nbsp;MessagePort&nbsp;objects&nbsp;have&nbsp;a&nbsp;strong&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;reference&nbsp;to&nbsp;their&nbsp;entangled&nbsp;MessagePort&nbsp;object&nbsp;or&nbsp;as&nbsp;if&nbsp;each&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;MessagePort&nbsp;object&#39;s&nbsp;owner&nbsp;has&nbsp;a&nbsp;strong&nbsp;reference&nbsp;to&nbsp;the&nbsp;MessagePort&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;object.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;seems&nbsp;to&nbsp;me&nbsp;the&nbsp;second&nbsp;alternative&nbsp;prevents&nbsp;MessagePorts&nbsp;created&nbsp;by&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;Window&nbsp;from&nbsp;ever&nbsp;being&nbsp;garbage&nbsp;collected&nbsp;until&nbsp;the&nbsp;user&nbsp;leaves&nbsp;the&nbsp;page.&lt;br&gt;<br>
&gt;&nbsp;Is&nbsp;that&nbsp;a&nbsp;correct&nbsp;understanding?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Yes.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;so,&nbsp;that&nbsp;seems&nbsp;like&nbsp;it&nbsp;could&nbsp;create&nbsp;unbounded&nbsp;memory&nbsp;leaks&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;long-running&nbsp;Web&nbsp;applications&nbsp;that&nbsp;use&nbsp;MessagePorts,&nbsp;even&nbsp;if&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;references&nbsp;to&nbsp;both&nbsp;endpoints&nbsp;of&nbsp;the&nbsp;MessageChannel&nbsp;are&nbsp;dropped.&nbsp;That&lt;br&gt;<br>
&gt;&nbsp;seems&nbsp;unacceptable&nbsp;to&nbsp;me,&nbsp;unless&nbsp;I&nbsp;misunderstood.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;The&nbsp;requirement&nbsp;is&nbsp;actually&nbsp;indistinguishable&nbsp;from&nbsp;the&nbsp;UA&nbsp;using&nbsp;the&nbsp;other&lt;br&gt;<br>
alternative&nbsp;and&nbsp;just&nbsp;having&nbsp;a&nbsp;really&nbsp;slow&nbsp;garbage&nbsp;collector&nbsp;that&nbsp;only&nbsp;runs&lt;br&gt;<br>
at&nbsp;page-closing&nbsp;time.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Thu,&nbsp;28&nbsp;May&nbsp;2009,&nbsp;Drew&nbsp;Wilson&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Is&nbsp;your&nbsp;concern&nbsp;that&nbsp;an&nbsp;ill-behaved&nbsp;app&nbsp;could&nbsp;leak&nbsp;ports&nbsp;(since&lt;br&gt;<br>
&gt;&nbsp;obviously&nbsp;an&nbsp;ill-behaved&nbsp;app&nbsp;could&nbsp;leak&nbsp;ports&nbsp;anyway&nbsp;just&nbsp;by&nbsp;stuffing&lt;br&gt;<br>
&gt;&nbsp;them&nbsp;in&nbsp;some&nbsp;array),&nbsp;or&nbsp;is&nbsp;it&nbsp;that&nbsp;a&nbsp;well-behaved&nbsp;app&nbsp;can&#39;t&nbsp;release&lt;br&gt;<br>
&gt;&nbsp;ports?&nbsp;Still&nbsp;need&nbsp;to&nbsp;review&nbsp;the&nbsp;new&nbsp;spec&nbsp;in&nbsp;detail,&nbsp;but&nbsp;from&nbsp;previous&lt;br&gt;<br>
&gt;&nbsp;conversations&nbsp;I&#39;d&nbsp;assumed&nbsp;that&nbsp;calling&nbsp;MessagePort.close()&nbsp;on&nbsp;either&nbsp;end&lt;br&gt;<br>
&gt;&nbsp;would&nbsp;allow&nbsp;the&nbsp;ports&nbsp;to&nbsp;be&nbsp;freed&nbsp;-&nbsp;perhaps&nbsp;we&nbsp;should&nbsp;clarify&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;language&nbsp;in&nbsp;the&nbsp;spec&nbsp;to&nbsp;state&nbsp;that&nbsp;the&nbsp;strong&nbsp;reference&nbsp;is&nbsp;only&nbsp;in&nbsp;place&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;*entangled*&nbsp;ports.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;The&nbsp;UA&nbsp;can&nbsp;at&nbsp;any&nbsp;time&nbsp;switch&nbsp;to&nbsp;the&nbsp;other&nbsp;mechanism,&nbsp;which&nbsp;only&nbsp;has&nbsp;a&lt;br&gt;<br>
strong&nbsp;reference&nbsp;through&nbsp;the&nbsp;entanglement,&nbsp;which&nbsp;basically&nbsp;means&nbsp;that&nbsp;the&lt;br&gt;<br>
UA&nbsp;can&nbsp;be&nbsp;as&nbsp;aggressive&nbsp;as&nbsp;the&nbsp;UA&nbsp;wants&nbsp;to&nbsp;be.&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
--&lt;br&gt;<br>
Ian&nbsp;Hickson&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;U+1047E&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\._.,--....,&#39;``.&nbsp; &nbsp; fL&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://ln.hixie.ch/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ln.hixie.ch/&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp;U+263A&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /,&nbsp; &nbsp;_..&nbsp;\&nbsp; &nbsp;_\&nbsp; ;`._&nbsp;,.&lt;br&gt;<br>
Things&nbsp;that&nbsp;are&nbsp;impossible&nbsp;just&nbsp;take&nbsp;longer.&nbsp; &nbsp;`._.-(,_..&#39;--(,_..&#39;`-.;.&#39;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
