<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Nov&nbsp;25,&nbsp;2009,&nbsp;at&nbsp;7:46&nbsp;AM,&nbsp;Jeremy&nbsp;Orlow&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;Wed,&nbsp;Nov&nbsp;25,&nbsp;2009&nbsp;at&nbsp;6:20&nbsp;AM,&nbsp;Ian&nbsp;Hickson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:ian@hixie.ch&quot;&gt;ian@hixie.ch&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&nbsp;On&nbsp;Wed,&nbsp;4&nbsp;Nov&nbsp;2009,&nbsp;Rob&nbsp;Ennals&nbsp;wrote:&lt;br&gt;&nbsp;&gt;&lt;br&gt;&nbsp;&gt;&nbsp;How&nbsp;about&nbsp;this&nbsp;for&nbsp;a&nbsp;solution&nbsp;for&nbsp;the&nbsp;localStorage&nbsp;mutex&nbsp;problem:&nbsp;[...]&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;Here's&nbsp;a&nbsp;proposal&nbsp;based&nbsp;on&nbsp;the&nbsp;recent&nbsp;feedback:&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;*&nbsp;There&nbsp;is&nbsp;a&nbsp;per-origin&nbsp;mutex.&nbsp;It&nbsp;can&nbsp;be&nbsp;owned&nbsp;by&nbsp;either&nbsp;an&nbsp;event&nbsp;loop&lt;br&gt;&nbsp;&nbsp;task&nbsp;or&nbsp;a&nbsp;network&nbsp;layer&nbsp;task.&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;*&nbsp;Things&nbsp;that&nbsp;wait&nbsp;until&nbsp;their&nbsp;task&nbsp;owns&nbsp;the&nbsp;storage&nbsp;mutex:&lt;br&gt;&nbsp;&nbsp;&nbsp;-&nbsp;script&nbsp;fetching&nbsp;document.cookie&lt;br&gt;&nbsp;&nbsp;&nbsp;-&nbsp;script&nbsp;setting&nbsp;document.cookie&lt;br&gt;&nbsp;&nbsp;&nbsp;-&nbsp;script&nbsp;reading&nbsp;or&nbsp;writing&nbsp;a&nbsp;property&nbsp;of,&nbsp;or&nbsp;calling&nbsp;a&nbsp;method&nbsp;on,&nbsp;or&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enumerating&nbsp;the&nbsp;properties&nbsp;of,&nbsp;the&nbsp;localStorage&nbsp;object&lt;br&gt;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;network&nbsp;layer&nbsp;setting&nbsp;cookies&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;*&nbsp;Things&nbsp;that&nbsp;release&nbsp;the&nbsp;storage&nbsp;mutex&nbsp;if&nbsp;their&nbsp;task&nbsp;owns&nbsp;it:&lt;br&gt;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;network&nbsp;layer&nbsp;after&nbsp;it&nbsp;has&nbsp;set&nbsp;cookies&lt;br&gt;&nbsp;&nbsp;&nbsp;-&nbsp;script&nbsp;calling&nbsp;a&nbsp;method&nbsp;implemented&nbsp;in&nbsp;native&nbsp;code&nbsp;on&nbsp;a&nbsp;host&nbsp;object&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;this&nbsp;a&nbsp;may&nbsp;or&nbsp;a&nbsp;must?&nbsp;&nbsp;As&nbsp;discussed,&nbsp;a&nbsp;may&nbsp;will&nbsp;result&nbsp;in&nbsp;different&nbsp;behaviors&nbsp;and&nbsp;strange&nbsp;bugs&nbsp;when&nbsp;someone&nbsp;develops&nbsp;on&nbsp;one&nbsp;browser&nbsp;and&nbsp;then&nbsp;tries&nbsp;to&nbsp;run&nbsp;their&nbsp;script&nbsp;on&nbsp;a&nbsp;different&nbsp;version&nbsp;of&nbsp;that&nbsp;browser&nbsp;or&nbsp;different&nbsp;browsers&nbsp;since&nbsp;they&nbsp;will&nbsp;probably&nbsp;have&nbsp;subtly&nbsp;different&nbsp;cases&nbsp;when&nbsp;they'll&nbsp;need&nbsp;to&nbsp;release&nbsp;the&nbsp;lock.&nbsp;&nbsp;If&nbsp;it's&nbsp;a&nbsp;must,&nbsp;then&nbsp;we'll&nbsp;take&nbsp;a&nbsp;small&nbsp;hit&nbsp;in&nbsp;all&nbsp;of&nbsp;our&nbsp;script&nbsp;binding&nbsp;code,&nbsp;but&nbsp;things&nbsp;will&nbsp;be&nbsp;more&nbsp;interoperable.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;any&nbsp;observable&nbsp;difference&nbsp;between&nbsp;a&nbsp;&quot;may&quot;&nbsp;and&nbsp;a&nbsp;&quot;must&quot;&nbsp;(assuming&nbsp;the&nbsp;implementation&nbsp;has&nbsp;avoided&nbsp;deadlocks)?&nbsp;Dropping&nbsp;the&nbsp;mutex&nbsp;will&nbsp;just&nbsp;remove&nbsp;a&nbsp;guarantee,&nbsp;it&nbsp;won't&nbsp;force&nbsp;different&nbsp;behavior.&nbsp;You&nbsp;can&nbsp;still&nbsp;get&nbsp;lucky.&nbsp;Indeed,&nbsp;in&nbsp;a&nbsp;browser&nbsp;that&nbsp;only&nbsp;uses&nbsp;a&nbsp;single&nbsp;thread/process&nbsp;to&nbsp;render&nbsp;Web&nbsp;content,&nbsp;if&nbsp;you're&nbsp;not&nbsp;using&nbsp;workers&nbsp;you&nbsp;will&nbsp;always&nbsp;get&nbsp;lucky.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;Regards,&lt;div&gt;Maciej&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
