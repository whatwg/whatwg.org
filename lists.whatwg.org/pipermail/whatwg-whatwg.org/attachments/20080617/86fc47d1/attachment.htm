<tt>
Hello,&lt;br&gt;&lt;br&gt;We&amp;#39;ve&nbsp;had&nbsp;a&nbsp;number&nbsp;of&nbsp;discussions&nbsp;in&nbsp;the&nbsp;#whatwg&nbsp;channel&nbsp;thus&nbsp;far&nbsp;about&nbsp;the&nbsp;TCPConnection&nbsp;specification&nbsp;in&nbsp;section&nbsp;6,&nbsp;and&nbsp;the&nbsp;consesus&nbsp;is&nbsp;that&nbsp;there&nbsp;is&nbsp;utility&nbsp;in&nbsp;an&nbsp;asynchronous,&nbsp;bi-directional&nbsp;communication&nbsp;mechanism,&nbsp;but&nbsp;the&nbsp;current&nbsp;proposal&nbsp;has&nbsp;a&nbsp;number&nbsp;of&nbsp;issues&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;resolved.&lt;br&gt;<br>
&lt;br&gt;There&nbsp;are&nbsp;a&nbsp;list&nbsp;of&nbsp;requirements&nbsp;for&nbsp;the&nbsp;protocol:&lt;br&gt;&lt;br&gt;&amp;lt;Hixie&amp;gt;&nbsp;basically&nbsp;my&nbsp;main&nbsp;requirements&nbsp;are&nbsp;that:&nbsp;&lt;br&gt;HIXIE.1)&nbsp;there&nbsp;be&nbsp;the&nbsp;ability&nbsp;for&nbsp;one&nbsp;process&nbsp;to&nbsp;have&nbsp;a&nbsp;full-duplex&nbsp;communication&nbsp;channel&nbsp;to&nbsp;the&nbsp;script&nbsp;running&nbsp;in&nbsp;the&nbsp;web&nbsp;page&lt;br&gt;<br>
HIXIE.2)&nbsp;the&nbsp;server-side&nbsp;be&nbsp;implementable&nbsp;in&nbsp;a&nbsp;fully&nbsp;conformant&nbsp;way&nbsp;in&nbsp;just&nbsp;a&nbsp;few&nbsp;lines&nbsp;of&nbsp;perl&nbsp;without&nbsp;support&nbsp;libraries&lt;br&gt;HIXIE.3)&nbsp;that&nbsp;it&nbsp;be&nbsp;safe&nbsp;from&nbsp;abuse&nbsp;(e.g.&nbsp;can&amp;#39;t&nbsp;connect&nbsp;to&nbsp;smtp&nbsp;servers)&lt;br&gt;HIXIE.4)&nbsp;that&nbsp;it&nbsp;work&nbsp;from&nbsp;within&nbsp;fascist&nbsp;firewalls&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;There&nbsp;are&nbsp;some&nbsp;issues&nbsp;with&nbsp;the&nbsp;specification&nbsp;as&nbsp;it&nbsp;stands:&lt;br&gt;-----------&lt;br&gt;&amp;lt;othermaciej&amp;gt;&nbsp;my&nbsp;two&nbsp;problems&nbsp;with&nbsp;it&nbsp;are:&nbsp;(1)&nbsp;it&nbsp;uses&nbsp;port/host&nbsp;addressing&nbsp;instead&nbsp;of&nbsp;URI&nbsp;addressing,&nbsp;which&nbsp;is&nbsp;a&nbsp;poor&nbsp;fit&nbsp;for&nbsp;the&nbsp;Web&nbsp;model&lt;br&gt;<br>
&amp;lt;othermaciej&amp;gt;&nbsp;(2)&nbsp;it&amp;#39;s&nbsp;bad&nbsp;to&nbsp;send&nbsp;non-http&nbsp;over&nbsp;the&nbsp;assigned&nbsp;ports&nbsp;for&nbsp;http&nbsp;and&nbsp;https&lt;br&gt;&amp;lt;othermaciej&amp;gt;&nbsp;(3)&nbsp;I&nbsp;am&nbsp;worried&nbsp;that&nbsp;connection&nbsp;to&nbsp;arbitrary&nbsp;ports&nbsp;could&nbsp;lead&nbsp;to&nbsp;security&nbsp;issues,&nbsp;although&nbsp;Hixie&nbsp;tried&nbsp;hard&nbsp;to&nbsp;avoid&nbsp;them&lt;br&gt;<br>
----------&lt;br&gt;&lt;br&gt;The&nbsp;complete&nbsp;list&nbsp;from&nbsp;multiple&nbsp;discussions,&nbsp;I&nbsp;believe,&nbsp;is:&lt;br&gt;ISSUE.1)&nbsp;lack&nbsp;of&nbsp;URI&nbsp;addressing&lt;br&gt;ISSUE.2)&nbsp;sending&nbsp;non-http(s)&nbsp;over&nbsp;http(s)&nbsp;ports&lt;br&gt;ISSUE.3)&nbsp;inability&nbsp;to&nbsp;traverse&nbsp;forward&nbsp;proxies&lt;br&gt;ISSUE.4)&nbsp;lack&nbsp;of&nbsp;cross-domain&nbsp;access&nbsp;control&lt;br&gt;<br>
ISSUE.5)&nbsp;DNS&nbsp;rebinding&nbsp;security&nbsp;holes&lt;br&gt;ISSUE.6)&nbsp;lack&nbsp;of&nbsp;load&nbsp;balancing&nbsp;integration&lt;br&gt;ISSUE.7)&nbsp;lack&nbsp;of&nbsp;authentication&nbsp;integration&lt;br&gt;ISSUE.8)&nbsp;virtual&nbsp;hosting&nbsp;with&nbsp;secure&nbsp;communication&nbsp;(no&nbsp;Host&nbsp;header,&nbsp;and&nbsp;even&nbsp;if&nbsp;there&nbsp;was,&nbsp;there&amp;#39;s&nbsp;no&nbsp;way&nbsp;to&nbsp;indicate&nbsp;this&nbsp;header&nbsp;*before*&nbsp;the&nbsp;secure&nbsp;handshake)&lt;br&gt;<br>
&lt;br&gt;I&nbsp;propose&nbsp;that&nbsp;we&nbsp;&lt;br&gt;PROPOSAL.1)&nbsp;change&nbsp;the&nbsp;initial&nbsp;handshake&nbsp;of&nbsp;the&nbsp;protocol&nbsp;to&nbsp;be&nbsp;HTTP&nbsp;based&nbsp;to&nbsp;leverage&nbsp;existing&nbsp;solutions&nbsp;to&nbsp;these&nbsp;problems.&lt;br&gt;PROPOSAL.2)&nbsp;modify&nbsp;the&nbsp;API&nbsp;to&nbsp;use&nbsp;URIs&nbsp;instead&nbsp;of&nbsp;port/host&nbsp;pairs&lt;br&gt;<br>
&lt;br&gt;I&nbsp;believe&nbsp;that&nbsp;the&nbsp;HTTP/1.1&nbsp;OPTIONS&nbsp;method,&nbsp;Upgrade&nbsp;header,&nbsp;and&nbsp;&amp;quot;101&nbsp;Switching&nbsp;Protocols&amp;quot;&nbsp;response&nbsp;is&nbsp;the&nbsp;best&nbsp;avenue&nbsp;to&nbsp;take&nbsp;because&nbsp;these&nbsp;parts&nbsp;of&nbsp;HTTP&nbsp;were&nbsp;specifically&nbsp;designed&nbsp;to:&nbsp;(1)&nbsp;See&nbsp;if&nbsp;the&nbsp;server&nbsp;can&nbsp;speak&nbsp;the&nbsp;new&nbsp;protocol&nbsp;(2)&nbsp;switch&nbsp;the&nbsp;protocol&nbsp;mid-stream.&lt;br&gt;<br>
&lt;br&gt;How&nbsp;the&nbsp;changes&nbsp;solve&nbsp;the&nbsp;problems&lt;br&gt;=================================&lt;br&gt;ISSUE.1)&nbsp;We&nbsp;added&nbsp;URI&nbsp;addressing&lt;br&gt;ISSUE.2)&nbsp;We&nbsp;now&nbsp;only&nbsp;send&nbsp;valid&nbsp;HTTP(s)&nbsp;over&nbsp;HTTP(s)&nbsp;ports.&lt;br&gt;ISSUE.3)&nbsp;We&nbsp;can&nbsp;send&nbsp;a&nbsp;CONNECT&nbsp;to&nbsp;the&nbsp;proxy,&nbsp;thus&nbsp;eliminating&nbsp;this&nbsp;problem.&lt;br&gt;<br>
ISSUE.4)&nbsp;We&nbsp;can&nbsp;use&nbsp;the&nbsp;Access-Control&nbsp;header&nbsp;to&nbsp;solve&nbsp;this&nbsp;problem.&lt;br&gt;ISSUE.5)&nbsp;The&nbsp;Host&nbsp;header&nbsp;solves&nbsp;this&nbsp;problem&lt;br&gt;ISSUE.6)&nbsp;Many&nbsp;load&nbsp;balancers&nbsp;use&nbsp;cookies&nbsp;or&nbsp;urls.&nbsp;Using&nbsp;HTTP&nbsp;allows&nbsp;both&nbsp;cookies&nbsp;and&nbsp;urls,&nbsp;so&nbsp;we&nbsp;can&nbsp;integrate&nbsp;with&nbsp;existing&nbsp;HTTP&nbsp;load&nbsp;balancers.&lt;br&gt;<br>
ISSUE.7)&nbsp;Cookies&nbsp;allow&nbsp;standard&nbsp;authentication&nbsp;mechansisms&nbsp;to&nbsp;be&nbsp;applied&nbsp;to&nbsp;the&nbsp;TCPConnection&lt;br&gt;ISSUE.8)&nbsp;We&nbsp;can&nbsp;follow&nbsp;RFC&nbsp;2817&nbsp;for&nbsp;TLS&nbsp;upgrading&nbsp;mid&nbsp;stream,&nbsp;&lt;br&gt;&lt;br&gt;&lt;br&gt;Examples&lt;br&gt;========&lt;br&gt;&lt;br&gt;Normal&nbsp;Handshake&lt;br&gt;----------------&lt;br&gt;<br>
In&nbsp;javascript&nbsp;on&nbsp;a&nbsp;page&nbsp;served&nbsp;from&nbsp;the&nbsp;domain&nbsp;&amp;quot;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;&amp;quot;,&nbsp;the&nbsp;following&nbsp;call&nbsp;is&nbsp;issued:&lt;br&gt;&lt;br&gt;tcp&amp;nbsp;&nbsp;=&nbsp;new&nbsp;TCPConnection(&amp;quot;&lt;a&nbsp;href=&quot;http://example.com/some/url&quot;&gt;http://example.com/some/url&lt;/a&gt;&amp;quot;)&nbsp;&lt;br&gt;<br>
&lt;br&gt;C:&lt;br&gt;OPTIONS&nbsp;/some/url&nbsp;HTTP/1.1\r\n&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;\r\n&lt;br&gt;Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;\r\n&lt;br&gt;S:&lt;br&gt;HTTP/1.1&nbsp;101&nbsp;Switching&nbsp;Protocols\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;<br>
Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;\r\n&lt;br&gt;&lt;br&gt;C,&nbsp;S:&lt;br&gt;&lt;br&gt;[&nbsp;Bi-directional&nbsp;communication&nbsp;]&lt;br&gt;&lt;br&gt;&lt;br&gt;Secure&nbsp;Handshake&nbsp;&lt;br&gt;----------------&lt;br&gt;In&nbsp;javascript&nbsp;on&nbsp;a&nbsp;page&nbsp;served&nbsp;from&nbsp;the&nbsp;domain&nbsp;&amp;quot;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;&amp;quot;,&nbsp;the&nbsp;following&nbsp;call&nbsp;is&nbsp;issued:&lt;br&gt;<br>
&lt;br&gt;tcp&amp;nbsp;&nbsp;=&nbsp;new&nbsp;TCPConnection(&amp;quot;&lt;a&nbsp;href=&quot;https://example.com/some/url&quot;&gt;https://example.com/some/url&lt;/a&gt;&amp;quot;)&nbsp;&lt;br&gt;&lt;br&gt;C,&nbsp;S&nbsp;(port&nbsp;443):&lt;br&gt;[&nbsp;SSL&nbsp;handshake&nbsp;]&lt;br&gt;C:&lt;br&gt;OPTIONS&nbsp;/some/url&nbsp;HTTP/1.1\r\n&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;\r\n&lt;br&gt;<br>
Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;\r\n&lt;br&gt;S:&lt;br&gt;HTTP/1.1&nbsp;101&nbsp;Switching&nbsp;Protocols\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;\r\n&lt;br&gt;C,&nbsp;S:&lt;br&gt;[&nbsp;Bi-directional&nbsp;communication&nbsp;]&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;Cross-domain&nbsp;Access&nbsp;Controlled&nbsp;Handshake&lt;br&gt;----------------------------------------&lt;br&gt;In&nbsp;javascript&nbsp;on&nbsp;a&nbsp;page&nbsp;served&nbsp;from&nbsp;the&nbsp;domain&nbsp;&amp;quot;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;&amp;quot;,&nbsp;the&nbsp;following&nbsp;call&nbsp;is&nbsp;issued:&lt;br&gt;<br>
&lt;br&gt;tcp&amp;nbsp;&nbsp;=&nbsp;new&nbsp;TCPConnection(&amp;quot;&lt;a&nbsp;href=&quot;http://www.example.com/some/url&quot;&gt;http://www.example.com/some/url&lt;/a&gt;&amp;quot;)&nbsp;&lt;br&gt;&lt;br&gt;C:&lt;br&gt;OPTIONS&nbsp;/some/url&nbsp;HTTP/1.1\r\n&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://www.example.com&quot;&gt;www.example.com&lt;/a&gt;\r\n&lt;br&gt;<br>
Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;\r\n&lt;br&gt;S:&lt;br&gt;HTTP/1.1&nbsp;101&nbsp;Switching&nbsp;Protocols\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;Access-Control:&nbsp;allow&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;&amp;gt;\r\n&lt;br&gt;<br>
\r\n&lt;br&gt;&lt;br&gt;C,&nbsp;S:&lt;br&gt;[&nbsp;Bi-directional&nbsp;communication&nbsp;]&lt;br&gt;&lt;br&gt;&lt;br&gt;Handshake&nbsp;Through&nbsp;a&nbsp;Forward&nbsp;Proxy&nbsp;(with&nbsp;Proxy&nbsp;Authentication)&lt;br&gt;-------------------------------------------------------------&lt;br&gt;In&nbsp;javascript&nbsp;from&nbsp;a&nbsp;page&nbsp;served&nbsp;in&nbsp;the&nbsp;domain&nbsp;&amp;quot;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;&amp;quot;,&nbsp;and&nbsp;the&nbsp;browser&nbsp;is&nbsp;behind&nbsp;a&nbsp;forward&nbsp;proxy,&nbsp;the&nbsp;following&nbsp;call&nbsp;is&nbsp;issued:&lt;br&gt;<br>
&lt;br&gt;tcp&amp;nbsp;&nbsp;=&nbsp;new&nbsp;TCPConnection(&amp;quot;&lt;a&nbsp;href=&quot;http://example.com/some/url&quot;&gt;http://example.com/some/url&lt;/a&gt;&amp;quot;)&nbsp;&lt;br&gt;&lt;br&gt;C:&lt;br&gt;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://example.com:80&quot;&gt;example.com:80&lt;/a&gt;&nbsp;HTTP/1.1\r\n&lt;br&gt;Proxy-authorization:&nbsp;basic&nbsp;aGVsbG86d29ybGQ=\r\n&lt;br&gt;<br>
\r\n&lt;br&gt;OPTIONS&nbsp;/some/url&nbsp;HTTP/1.1\r\n&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;\r\n&lt;br&gt;Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;\r\n&lt;br&gt;S:&lt;br&gt;HTTP/1.1&nbsp;101&nbsp;Switching&nbsp;Protocols\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;<br>
Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;\r\n&lt;br&gt;C,&nbsp;S:&lt;br&gt;[&nbsp;Bi-directional&nbsp;communication&nbsp;]&lt;br&gt;&lt;br&gt;&lt;br&gt;TLS&nbsp;Upgrade&lt;br&gt;-----------&lt;br&gt;&lt;br&gt;A&nbsp;potential&nbsp;server-side&nbsp;requirement&nbsp;of&nbsp;TCPConnection&nbsp;is&nbsp;virtual&nbsp;hosting&nbsp;TCPConnection&nbsp;servers&nbsp;by&nbsp;domain&nbsp;while&nbsp;allowing&nbsp;secure&nbsp;communication.&nbsp;RFC&nbsp;2817&nbsp;specifies&nbsp;how&nbsp;to&nbsp;do&nbsp;TLS&nbsp;upgrades&nbsp;over&nbsp;HTTP&nbsp;so&nbsp;as&nbsp;to&nbsp;allow&nbsp;the&nbsp;initial&nbsp;Host&nbsp;header&nbsp;to&nbsp;be&nbsp;read&nbsp;by&nbsp;the&nbsp;server&nbsp;before&nbsp;the&nbsp;secure&nbsp;channel&nbsp;is&nbsp;created.&nbsp;We&nbsp;can&nbsp;use&nbsp;the&nbsp;same&nbsp;strategy&nbsp;with&nbsp;the&nbsp;TCPConnection&nbsp;protocol:&lt;br&gt;<br>
&lt;br&gt;C:&lt;br&gt;OPTIONS&nbsp;/some/url&nbsp;HTTP/1.1\r\n&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;\r\n&lt;br&gt;Upgrade:&nbsp;TLS/1.0\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;\r\n&lt;br&gt;S:&lt;br&gt;HTTP/1.1&nbsp;101&nbsp;Switching&nbsp;Protocols\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;<br>
Upgrade:&nbsp;TLS/1.0,&nbsp;HTTP/1.1\r\n&lt;br&gt;\r\n&lt;br&gt;C:&lt;br&gt;OPTIONS&nbsp;/some/url&nbsp;HTTP/1.1\r\n&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;\r\n&lt;br&gt;Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;Connection:&nbsp;Upgrade\r\n&lt;br&gt;\r\n&lt;br&gt;S:&lt;br&gt;HTTP/1.1&nbsp;101&nbsp;Switching&nbsp;Protocols\r\n&lt;br&gt;<br>
Connection:&nbsp;Upgrade\r\n&lt;br&gt;Upgrade:&nbsp;TCPConnection/1.0\r\n&lt;br&gt;\r\n&lt;br&gt;C,&nbsp;S:&lt;br&gt;[&nbsp;Secure&nbsp;Handshake&nbsp;]&lt;br&gt;C,&nbsp;S:&lt;br&gt;[&nbsp;Bi-directional&nbsp;communication&nbsp;]&lt;br&gt;&lt;br&gt;&lt;br&gt;Conclusion&lt;br&gt;==========&lt;br&gt;This&nbsp;proposal&nbsp;fits&nbsp;within&nbsp;the&nbsp;original&nbsp;requirements.&lt;br&gt;<br>
&lt;br&gt;HIXIE.1)&nbsp;We&amp;#39;ve&nbsp;provided&nbsp;full-duplex&nbsp;communication&nbsp;in&nbsp;the&nbsp;browser&lt;br&gt;HIXIE.2)&nbsp;Its&nbsp;a&nbsp;single&nbsp;line&nbsp;of&nbsp;perl&nbsp;code&nbsp;to&nbsp;parse&nbsp;the&nbsp;http&nbsp;headers,&nbsp;and&nbsp;another&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;proper&nbsp;headers&nbsp;exist&lt;br&gt;HIXIE.3)&nbsp;No&nbsp;existing&nbsp;SMTP&nbsp;server&nbsp;(or&nbsp;any&nbsp;non-TCPConnection&nbsp;server)&nbsp;is&nbsp;going&nbsp;to&nbsp;send&nbsp;back&nbsp;the&nbsp;appropriate&nbsp;handshake&nbsp;response.&lt;br&gt;<br>
HIXIE.4)&nbsp;TCPConnection&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;navigate&nbsp;forward&nbsp;proxies&nbsp;and&nbsp;firewalls&nbsp;due&nbsp;to&nbsp;our&nbsp;use&nbsp;of&nbsp;CONNECT.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;-Michael&nbsp;Carter&lt;br&gt;&lt;br&gt;<br>

</tt>
