<tt>
This&nbsp;is&nbsp;intriguing.&nbsp; But&nbsp;what&nbsp;it&nbsp;comes&nbsp;down&nbsp;to&nbsp;is&nbsp;what&nbsp;we&nbsp;consider&nbsp;an&nbsp;&quot;API&nbsp;operation&quot;.&nbsp; For&nbsp;example,&nbsp;you&nbsp;could&nbsp;define&nbsp;&quot;API&nbsp;operation&quot;&nbsp;to&nbsp;be&nbsp;the&nbsp;existing&nbsp;list&nbsp;of&nbsp;thing&nbsp;that&nbsp;unlock&nbsp;LocalStorage.&nbsp; Or&nbsp;it&nbsp;could&nbsp;be&nbsp;defined&nbsp;in&nbsp;a&nbsp;way&nbsp;that&nbsp;Darin&nbsp;Fisher&#39;s&nbsp;idea&nbsp;to&nbsp;lock&nbsp;whenever&nbsp;we&#39;re&nbsp;about&nbsp;to&nbsp;nest&nbsp;locking&nbsp;calls&nbsp;would&nbsp;also&nbsp;work.&nbsp; Or&nbsp;a&nbsp;variety&nbsp;of&nbsp;other&nbsp;things.&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;anyone&nbsp;have&nbsp;any&nbsp;ideas&nbsp;on&nbsp;what&nbsp;the&nbsp;exact&nbsp;language&nbsp;for&nbsp;what&nbsp;an&nbsp;&quot;API&nbsp;operation&quot;&nbsp;might&nbsp;look&nbsp;like?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;do&nbsp;have&nbsp;a&nbsp;couple&nbsp;of&nbsp;concerns&nbsp;though:&lt;/div&gt;&lt;div&gt;Leaving&nbsp;the&nbsp;language&nbsp;open&nbsp;might&nbsp;not&nbsp;be&nbsp;terribly&nbsp;useful&nbsp;to&nbsp;a&nbsp;typical&nbsp;web&nbsp;developer&nbsp;since&nbsp;they&#39;re&nbsp;not&nbsp;going&nbsp;to&nbsp;read&nbsp;the&nbsp;spec&nbsp;and&nbsp;probably&nbsp;aren&#39;t&nbsp;going&nbsp;to&nbsp;have&nbsp;a&nbsp;very&nbsp;firm&nbsp;idea&nbsp;of&nbsp;whether&nbsp;what&nbsp;they&#39;re&nbsp;doing&nbsp;could&nbsp;unlock&nbsp;storage&nbsp;or&nbsp;not.&nbsp; Experimentation wouldn&#39;t&nbsp;work&nbsp;very&nbsp;well&nbsp;since&nbsp;each&nbsp;platform&nbsp;could&nbsp;be&nbsp;wildly&nbsp;different&nbsp;(since&nbsp;a&nbsp;lot&nbsp;of&nbsp;possible&nbsp;behaviors&nbsp;fall&nbsp;between&nbsp;the&nbsp;MAY&nbsp;and&nbsp;the&nbsp;MAY&nbsp;NOT&nbsp;in&nbsp;the&nbsp;proposed&nbsp;spec).&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Another&nbsp;concern&nbsp;is&nbsp;that&nbsp;the&nbsp;worst&nbsp;case&nbsp;performance&nbsp;aspects&nbsp;of&nbsp;LocalStorage&nbsp;remain.&nbsp; I&nbsp;cringe&nbsp;every&nbsp;time&nbsp;I&nbsp;think&nbsp;of&nbsp;one&nbsp;event&nbsp;loop&nbsp;blocking&nbsp;another.&nbsp; But&nbsp;I&nbsp;will&nbsp;admit&nbsp;that&nbsp;the&nbsp;average&nbsp;time&nbsp;would&nbsp;be&nbsp;better--especially&nbsp;if&nbsp;we&#39;re&nbsp;unlocking&nbsp;fairly aggressively.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;interested&nbsp;to&nbsp;hear&nbsp;what&nbsp;others&nbsp;have&nbsp;to&nbsp;say&nbsp;on&nbsp;this&nbsp;proposal.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;J&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Nov&nbsp;4,&nbsp;2009&nbsp;at&nbsp;3:31&nbsp;PM,&nbsp;Rob&nbsp;Ennals&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rob.ennals@gmail.com&quot;&gt;rob.ennals@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;Missed&nbsp;out&nbsp;the&nbsp;important&nbsp;final&nbsp;qualifier.&nbsp;Here&#39;s&nbsp;take&nbsp;3:&lt;br&gt;<br>
&lt;br&gt;<br>
&quot;the&nbsp;user&nbsp;agent&nbsp;MUST&nbsp;NOT&nbsp;release&nbsp;the&nbsp;storage&nbsp;mutex&nbsp;between&nbsp;calls&nbsp;to&nbsp;local&nbsp;storage,&nbsp;except&nbsp;that&nbsp;the&nbsp;user&nbsp;agent&nbsp;MAY&nbsp;release&nbsp;the&nbsp;storage&nbsp;mutex&nbsp;on&nbsp;any&nbsp;API&nbsp;operation&nbsp;/other&nbsp;that&nbsp;a&nbsp;local&nbsp;storage&nbsp;oeration/&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;a&nbsp;local&nbsp;storage&nbsp;op&nbsp;can&nbsp;release&nbsp;the&nbsp;mutex&nbsp;then&nbsp;the&nbsp;whole&nbsp;thing&nbsp;is&nbsp;pointless&nbsp;:-)&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
-Rob&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Nov&nbsp;4,&nbsp;2009,&nbsp;at&nbsp;3:15&nbsp;PM,&nbsp;Rob&nbsp;Ennals&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rob.ennals@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rob.ennals@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;suspect&nbsp;my&nbsp;suggested&nbsp;spec&nbsp;line&nbsp;was&nbsp;insufficiently&nbsp;precise.&nbsp;How&nbsp;about&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;<br>
&quot;the&nbsp;user&nbsp;agent&nbsp;MUST&nbsp;NOT&nbsp;release&nbsp;the&nbsp;storage&nbsp;mutex&nbsp;between&nbsp;calls&nbsp;to&nbsp;local&nbsp;storage,&nbsp;except&nbsp;that&nbsp;the&nbsp;user&nbsp;agent&nbsp;MAY&nbsp;release&nbsp;the&nbsp;storage&nbsp;mutex&nbsp;on&nbsp;any&nbsp;API&nbsp;operation&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
We&#39;d&nbsp;still&nbsp;need&nbsp;to&nbsp;define&nbsp;what&nbsp;&quot;API&nbsp;operation&quot;&nbsp;means,&nbsp;and&nbsp;I&#39;m&nbsp;sure&nbsp;this&nbsp;could&nbsp;be&nbsp;worded&nbsp;better,&nbsp;but&nbsp;hopefully&nbsp;this&nbsp;makes&nbsp;the&nbsp;basic&nbsp;idea&nbsp;clearer.&lt;br&gt;<br>
&lt;br&gt;<br>
-Rob&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Nov&nbsp;4,&nbsp;2009,&nbsp;at&nbsp;2:56&nbsp;PM,&nbsp;Mike&nbsp;Shaver&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:mike.shaver@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mike.shaver@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
On&nbsp;Wed,&nbsp;Nov&nbsp;4,&nbsp;2009&nbsp;at&nbsp;5:51&nbsp;PM,&nbsp;Rob&nbsp;Ennals&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rob.ennals@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rob.ennals@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Or&nbsp;to&nbsp;put&nbsp;it&nbsp;another&nbsp;way:&nbsp;if&nbsp;the&nbsp;thread&nbsp;can&#39;t&nbsp;call&nbsp;an&nbsp;API&nbsp;then&nbsp;it&nbsp;can&#39;t&lt;br&gt;<br>
block&nbsp;waiting&nbsp;for&nbsp;another&nbsp;storage&nbsp;mutex,&nbsp;thus&nbsp;deadlock&nbsp;can&#39;t&nbsp;occur,&nbsp;thus&nbsp;we&lt;br&gt;<br>
don&#39;t&nbsp;need&nbsp;to&nbsp;release&nbsp;the&nbsp;storage&nbsp;mutex.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Right,&nbsp;but&nbsp;the&nbsp;spec&nbsp;text&nbsp;there&nbsp;doesn&#39;t&nbsp;prevent&nbsp;the&nbsp;UA&nbsp;from&nbsp;releasing&lt;br&gt;<br>
more&nbsp;than&nbsp;in&nbsp;that&nbsp;scenario,&nbsp;which&nbsp;seems&nbsp;like&nbsp;it&#39;s&nbsp;not&nbsp;an&nbsp;improvement&lt;br&gt;<br>
over&nbsp;where&nbsp;we&nbsp;are&nbsp;right&nbsp;now:&nbsp;unpredictable&nbsp;consistency.&nbsp; Existing&nbsp;racy&lt;br&gt;<br>
implementations&nbsp;like&nbsp;in&nbsp;IE&nbsp;would&nbsp;be&nbsp;conformant,&nbsp;so&nbsp;developers&nbsp;can&#39;t&lt;br&gt;<br>
count&nbsp;on&nbsp;the&nbsp;script-sequenced-storage-ops&nbsp;pattern&nbsp;providing&lt;br&gt;<br>
transactionality.&lt;br&gt;<br>
&lt;br&gt;<br>
More&nbsp;likely,&nbsp;though,&nbsp;_I_&#39;m&nbsp;missing&nbsp;something...&lt;br&gt;<br>
&lt;br&gt;<br>
Mike&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
