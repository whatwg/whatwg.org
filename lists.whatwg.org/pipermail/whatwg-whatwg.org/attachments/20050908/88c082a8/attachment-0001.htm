<tt>
On&nbsp;08/09/05,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Ian&nbsp;Hickson&lt;/b&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ian@hixie.ch&quot;&gt;ian@hixie.ch&lt;/a&gt;&gt;&nbsp;wrote:&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
On&nbsp;Thu,&nbsp;1&nbsp;Sep&nbsp;2005,&nbsp;Robert&nbsp;O'Callahan&nbsp;wrote:&lt;br&gt;&gt;&nbsp;3.4.2&nbsp;&quot;DOM&nbsp;Node&nbsp;objects&quot;&nbsp;browser&nbsp;DOM&nbsp;nodes&nbsp;often&nbsp;have&nbsp;state&nbsp;that&nbsp;isn't&lt;br&gt;&gt;&nbsp;apparent&nbsp;in&nbsp;the&nbsp;DOM&nbsp;---&nbsp;e.g.,&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;&lt;canvas&gt;,&nbsp;or&nbsp;the&nbsp;state&lt;br&gt;<br>
&gt;&nbsp;of&nbsp;form&nbsp;controls.&nbsp;Please&nbsp;clarify&nbsp;that&nbsp;this&nbsp;state&nbsp;is&nbsp;not&nbsp;restored&nbsp;and&lt;br&gt;&gt;&nbsp;ONLY&nbsp;the&nbsp;listed&nbsp;attributes&nbsp;and&nbsp;children&nbsp;may&nbsp;be&nbsp;restored.&lt;br&gt;&lt;br&gt;Added&nbsp;a&nbsp;note&nbsp;to&nbsp;this&nbsp;effect.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Actually&nbsp;I&nbsp;think&nbsp;you&nbsp;need&nbsp;a&nbsp;more&nbsp;general&nbsp;statement:&nbsp;that&nbsp;no&nbsp;state&nbsp;other&nbsp;than&nbsp;the&nbsp;state&nbsp;mentioned&nbsp;in&nbsp;the&nbsp;previous&nbsp;paragraph&nbsp;may&nbsp;be&nbsp;restored&nbsp;(which&nbsp;rules&nbsp;out&nbsp;canvas&nbsp;bitmaps&nbsp;etc).&nbsp;Otherwise&nbsp;it's&nbsp;not&nbsp;robust&nbsp;with&nbsp;respect&nbsp;to&nbsp;DOM&nbsp;extensions.&nbsp;I&nbsp;can&nbsp;see&nbsp;compatibility&nbsp;problems&nbsp;if&nbsp;some&nbsp;implementations&nbsp;accidentally&nbsp;or&nbsp;deliberately&nbsp;save&nbsp;and&nbsp;restore&nbsp;additional&nbsp;state,&nbsp;even&nbsp;if&nbsp;minor.<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&gt;&nbsp;3.4.2&nbsp;&quot;other&nbsp;objects&quot;&nbsp;this&nbsp;is&nbsp;entirely&nbsp;ECMAscript&nbsp;specific,&nbsp;is&nbsp;it&nbsp;not?<br>
&lt;br&gt;&lt;br&gt;Not&nbsp;necessarily;&nbsp;I&nbsp;would&nbsp;expect&nbsp;a&nbsp;Perl&nbsp;binding&nbsp;to&nbsp;support&nbsp;this&nbsp;kind&nbsp;of&lt;br&gt;thing&nbsp;for&nbsp;Perl&nbsp;hashes.&nbsp;Having&nbsp;said&nbsp;that,&nbsp;note&nbsp;that&nbsp;HTML5&nbsp;in&nbsp;general&nbsp;has&nbsp;a&lt;br&gt;strong&nbsp;JS&nbsp;bias,&nbsp;since&nbsp;JS&nbsp;is&nbsp;the&nbsp;Web's&nbsp;main&nbsp;language.&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;Sure&nbsp;but...&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&gt;&nbsp;How&nbsp;can&nbsp;this&nbsp;work&nbsp;across&nbsp;language&nbsp;bindings?&nbsp;It&nbsp;might&nbsp;be&nbsp;a&nbsp;lot&nbsp;simpler<br>
&lt;br&gt;&gt;&nbsp;for&nbsp;everyone&nbsp;to&nbsp;only&nbsp;specify&nbsp;storage&nbsp;for&nbsp;DOM&nbsp;types.&lt;br&gt;&lt;br&gt;It&nbsp;might&nbsp;be&nbsp;simpler&nbsp;for&nbsp;implementors,&nbsp;but&nbsp;I&nbsp;really&nbsp;think&nbsp;authors&nbsp;would&lt;br&gt;want&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;do&nbsp;things&nbsp;like:&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;globalStorage[document.domain].username&nbsp;=&nbsp;username;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;globalStorage[document.domain].lastVisit&nbsp;=&nbsp;new&nbsp;Date();&lt;br&gt;&nbsp;&nbsp;&nbsp;globalStorage[document.domain].game&nbsp;=&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;'fred',&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;level:&nbsp;42&lt;br&gt;&nbsp;&nbsp;&nbsp;};&lt;br&gt;&lt;br&gt;...and&nbsp;so&nbsp;forth.&nbsp;Having&nbsp;to&nbsp;wrap&nbsp;stuff&nbsp;like&nbsp;that&nbsp;in&nbsp;E4X&nbsp;XML&nbsp;or&nbsp;(worse)&nbsp;DOM<br>
&lt;br&gt;nodes&nbsp;just&nbsp;seems&nbsp;like&nbsp;an&nbsp;excessive&nbsp;amount&nbsp;of&nbsp;boxing.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Okay,&nbsp;but&nbsp;the&nbsp;problem&nbsp;then&nbsp;becomes&nbsp;what&nbsp;happens&nbsp;when&nbsp;one&nbsp;language&nbsp;sets&nbsp;a&nbsp;property&nbsp;and&nbsp;another&nbsp;language&nbsp;gets&nbsp;it:&nbsp;i.e.&nbsp;what&nbsp;you&nbsp;put&nbsp;in&nbsp;your&nbsp;note:&nbsp;&quot;<br>
&lt;span&nbsp;class=&quot;issue&quot;&gt;define&nbsp;how&nbsp;to&nbsp;take&nbsp;a&nbsp;JS&nbsp;Object&nbsp;and&nbsp;turn&nbsp;it&nbsp;into&nbsp;a&nbsp;Perl&nbsp;%hash,&nbsp;etc.&quot;&nbsp;---&nbsp;without&nbsp;doing&nbsp;some&nbsp;N^2&nbsp;conversion&nbsp;matrix.&nbsp;Avoiding&nbsp;the&nbsp;matrix&nbsp;means&nbsp;we&nbsp;have&nbsp;to&nbsp;specify&nbsp;some&nbsp;common&nbsp;format&nbsp;and&nbsp;how&nbsp;each&nbsp;of&nbsp;N&nbsp;languages&nbsp;maps&nbsp;to&nbsp;it.&nbsp;Now,&nbsp;what&nbsp;if&nbsp;the&nbsp;common&nbsp;format&nbsp;was&nbsp;---&nbsp;hmm&nbsp;---&nbsp;DOM&nbsp;nodes?&nbsp;:-)&nbsp;Then&nbsp;all&nbsp;we&nbsp;need&nbsp;here&nbsp;are&nbsp;JS&nbsp;convenience&nbsp;functions&nbsp;to&nbsp;convert&nbsp;simple&nbsp;JS&nbsp;object&nbsp;trees&nbsp;into&nbsp;some&nbsp;DOM&nbsp;representation&nbsp;and&nbsp;back&nbsp;again.&nbsp;We&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;want&nbsp;to&nbsp;standardize&nbsp;those&nbsp;functions&nbsp;but&nbsp;I&nbsp;bet&nbsp;they're&nbsp;only&nbsp;a&nbsp;few&nbsp;lines&nbsp;of&nbsp;E4X&nbsp;to&nbsp;write.<br>
&lt;br&gt;&lt;br&gt;An&nbsp;alternative&nbsp;is&nbsp;to&nbsp;define&nbsp;storage&nbsp;of&nbsp;simple&nbsp;JS&nbsp;object&nbsp;trees&nbsp;and&nbsp;then&nbsp;force&nbsp;all&nbsp;other&nbsp;languages&nbsp;to&nbsp;provide&nbsp;a&nbsp;mapping&nbsp;to&nbsp;and&nbsp;from&nbsp;that.&nbsp;I&nbsp;guess&nbsp;that'd&nbsp;be&nbsp;acceptable.&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://3.4.6.1&quot;&gt;3.4.6.1&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://3.4.6.1&quot;&gt;http://3.4.6.1&lt;/a&gt;&gt;&nbsp;&quot;The&nbsp;space&nbsp;limits&nbsp;on&nbsp;public&nbsp;storage&nbsp;areas&nbsp;should&lt;br&gt;&gt;&nbsp;not&nbsp;affect&nbsp;the&nbsp;limits&nbsp;for&nbsp;non-public&nbsp;domains,&nbsp;however.&quot;&lt;br&gt;&lt;br&gt;<br>
Changed&nbsp;that&nbsp;to&nbsp;a&nbsp;new&nbsp;suggested&nbsp;model&nbsp;based&nbsp;on&nbsp;the&nbsp;domain&nbsp;of&nbsp;the&nbsp;script&lt;br&gt;setting&nbsp;the&nbsp;data,&nbsp;not&nbsp;the&nbsp;domain&nbsp;of&nbsp;storage&nbsp;area.&nbsp;Let&nbsp;me&nbsp;know&nbsp;what&nbsp;you&lt;br&gt;think.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Is&nbsp;the&nbsp;domain&nbsp;of&nbsp;the&nbsp;script&nbsp;the&nbsp;domain&nbsp;where&nbsp;the&nbsp;script&nbsp;was&nbsp;loaded&nbsp;from,&nbsp;or&nbsp;the&nbsp;domain&nbsp;of&nbsp;the&nbsp;document&nbsp;in&nbsp;which&nbsp;it&nbsp;runs?<br>
&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;I&nbsp;have&nbsp;added&nbsp;text&nbsp;about&nbsp;this&nbsp;to&nbsp;the&nbsp;sessionStorage&nbsp;and&nbsp;globalStorage&lt;br&gt;sections.&nbsp;(Short&nbsp;answer:&nbsp;sessionStorage:&nbsp;only&nbsp;when&nbsp;the&nbsp;window&nbsp;is&nbsp;closed&nbsp;or<br>
&lt;br&gt;when&nbsp;you&nbsp;run&nbsp;out&nbsp;of&nbsp;disk&nbsp;space;&nbsp;globalStorage:&nbsp;only&nbsp;when&nbsp;the&nbsp;user&nbsp;says&nbsp;so.&lt;br&gt;And&nbsp;in&nbsp;both&nbsp;cases,&nbsp;security&nbsp;concerns&nbsp;can&nbsp;trump&nbsp;everything&nbsp;and&nbsp;be&nbsp;used&nbsp;as&lt;br&gt;an&nbsp;excuse&nbsp;to&nbsp;delete&nbsp;data&nbsp;whenever...)&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Looks&nbsp;good.&nbsp;But&nbsp;I&nbsp;think&nbsp;developers&nbsp;would&nbsp;also&nbsp;like&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;browser&nbsp;won't&nbsp;delete&nbsp;anything,&nbsp;say,&nbsp;while&nbsp;a&nbsp;script&nbsp;is&nbsp;running.<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&gt;&nbsp;--&nbsp;There&nbsp;should&nbsp;be&nbsp;some&nbsp;atomicity&nbsp;property&nbsp;that&nbsp;authors&nbsp;can&nbsp;rely&nbsp;on&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;safely&nbsp;update&nbsp;storage&nbsp;under&nbsp;potential&nbsp;failures&nbsp;(of&nbsp;the&nbsp;UA,&nbsp;or&nbsp;the&lt;br&gt;&gt;&nbsp;hardware,&nbsp;or&nbsp;whatever).&nbsp;It's&nbsp;probably&nbsp;enough&nbsp;to&nbsp;require&nbsp;that&nbsp;setItem&nbsp;and&lt;br&gt;&gt;&nbsp;removeItem&nbsp;are&nbsp;atomic&nbsp;with&nbsp;respect&nbsp;to&nbsp;failure.&nbsp;In&nbsp;other&nbsp;words,&nbsp;if&nbsp;the&nbsp;UA<br>
&lt;br&gt;&gt;&nbsp;fails&nbsp;during&nbsp;a&nbsp;setItem&nbsp;or&nbsp;removeItem,&nbsp;then&nbsp;later&nbsp;the&nbsp;operation&nbsp;will&nbsp;be&lt;br&gt;&gt;&nbsp;observed&nbsp;to&nbsp;either&nbsp;have&nbsp;succeeded&nbsp;normally&nbsp;or&nbsp;not&nbsp;happened&nbsp;at&nbsp;all&nbsp;(and&lt;br&gt;&gt;&nbsp;of&nbsp;course&nbsp;the&nbsp;storage&nbsp;object&nbsp;will&nbsp;not&nbsp;be&nbsp;corrupted!).&lt;br&gt;<br>
&lt;br&gt;Good&nbsp;call.&nbsp;Added.&nbsp;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;what&nbsp;I&nbsp;added&nbsp;is&nbsp;enough,&nbsp;though.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;It&nbsp;looks&nbsp;good.&nbsp;That&nbsp;should&nbsp;let&nbsp;people&nbsp;build&nbsp;reliable&nbsp;storage&nbsp;without&nbsp;going&nbsp;the&nbsp;whole&nbsp;hog&nbsp;of&nbsp;transactions.&lt;br&gt;&lt;/div&gt;&lt;br&gt;Rob&lt;/div&gt;--&nbsp;<br>
&lt;br&gt;[&quot;Therefore,&nbsp;my&nbsp;dear&nbsp;friends,&nbsp;as&nbsp;you&nbsp;have&nbsp;always&nbsp;obeyed–not&nbsp;only&nbsp;in&nbsp;my&lt;br&gt;presence,&nbsp;but&nbsp;now&nbsp;much&nbsp;more&nbsp;in&nbsp;my&nbsp;absence–continue&nbsp;to&nbsp;work&nbsp;out&nbsp;your&lt;br&gt;salvation&nbsp;with&nbsp;fear&nbsp;and&nbsp;trembling,&nbsp;for&nbsp;it&nbsp;is&nbsp;God&nbsp;who&nbsp;works&nbsp;in&nbsp;you&nbsp;to&nbsp;will<br>
&lt;br&gt;and&nbsp;to&nbsp;act&nbsp;according&nbsp;to&nbsp;his&nbsp;good&nbsp;purpose.&quot;&nbsp;Philippians&nbsp;2:12-13.]
</tt>
