<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;p&gt;I&#39;d&nbsp;like&nbsp;to&nbsp;offer&nbsp;more&nbsp;justification&nbsp;for&nbsp;Michael&nbsp;Nordman&#39;s&nbsp;&quot;scriptlet&quot;&nbsp;proposal.&nbsp;&lt;/p&gt;<br>
&lt;div&gt;We&#39;ve&nbsp;spent&nbsp;the&nbsp;last&nbsp;year&nbsp;or&nbsp;so&nbsp;modifying&nbsp;an&nbsp;existing&nbsp;online&nbsp;application&nbsp;to&nbsp;make&nbsp;it&nbsp;work&nbsp;offline.&nbsp;A&nbsp;secondary&nbsp;motivation&nbsp;was&nbsp;application&nbsp;speed.&nbsp;We&nbsp;used&nbsp;Google&nbsp;Gears&nbsp;to&nbsp;enable&nbsp;this.&nbsp;Although&nbsp;we&nbsp;had&nbsp;some&nbsp;success,&nbsp;we&nbsp;also&nbsp;had&nbsp;challenges.&nbsp;Here&nbsp;are&nbsp;some&nbsp;of&nbsp;the&nbsp;big&nbsp;ones:&lt;/div&gt;<br>
<br>
&lt;ol&gt;<br>
&lt;li&gt;&lt;strong&gt;Significant&nbsp;architecture&nbsp;change&lt;/strong&gt;.&nbsp;Our&nbsp;web&nbsp;pages&nbsp;are&nbsp;built&nbsp;on&nbsp;the&nbsp;server&nbsp;without&nbsp;much&nbsp;concern&nbsp;for&nbsp;separation&nbsp;of&nbsp;application&nbsp;logic&nbsp;and&nbsp;user&nbsp;data.&nbsp;User&nbsp;data&nbsp;is&nbsp;usually&nbsp;just&nbsp;&quot;baked&nbsp;in&quot;&nbsp;to&nbsp;the&nbsp;page.&nbsp;In&nbsp;captured/offline&nbsp;mode,&nbsp;we&nbsp;have&nbsp;to&nbsp;serve&nbsp;a&nbsp;generic&nbsp;page&nbsp;that&nbsp;can&nbsp;fill&nbsp;in&nbsp;user&nbsp;data&nbsp;via&nbsp;javascript.&nbsp;This&nbsp;required&nbsp;changing&nbsp;the&nbsp;online&nbsp;application&nbsp;in&nbsp;significant&nbsp;ways&nbsp;just&nbsp;to&nbsp;support&nbsp;offline&nbsp;functionality.&nbsp;And,&nbsp;it&nbsp;required&nbsp;forking&nbsp;the&nbsp;code&nbsp;in&nbsp;many&nbsp;places,&nbsp;leading&nbsp;to&nbsp;maintenance&nbsp;difficulties.&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;strong&gt;All-or-nothing&nbsp;captured&nbsp;mode&lt;/strong&gt;;&nbsp;i.e.,&nbsp;once&nbsp;a&nbsp;URL&nbsp;is&nbsp;captured,&nbsp;it&nbsp;is&nbsp;always&nbsp;served&nbsp;from&nbsp;offline&nbsp;cache.&nbsp;This&nbsp;means&nbsp;if&nbsp;we&nbsp;encounter&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;offline&nbsp;app,&nbsp;it&#39;s&nbsp;not&nbsp;easy&nbsp;to&nbsp;fall&nbsp;back&nbsp;to&nbsp;the&nbsp;online&nbsp;app.&nbsp;We&nbsp;could&nbsp;serve&nbsp;the&nbsp;offline&nbsp;app&nbsp;off&nbsp;a&nbsp;different&nbsp;URL&nbsp;space,&nbsp;but&nbsp;that&nbsp;makes&nbsp;for&nbsp;harsh&nbsp;transitions&nbsp;between&nbsp;online&nbsp;and&nbsp;offline&nbsp;mode;&nbsp;e.g.,&nbsp;on&nbsp;a&nbsp;flaky&nbsp;connection.&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;strong&gt;Single&nbsp;sign-on&nbsp;was&nbsp;hard&lt;/strong&gt;.&lt;/li&gt;&lt;/ol&gt;<br>
&lt;div&gt;How&nbsp;I&nbsp;think&nbsp;Michael&#39;s&nbsp;proposal&nbsp;addresses&nbsp;these:&lt;/div&gt;<br>
&lt;ol&gt;<br>
&lt;li&gt;Some&nbsp;applications&nbsp;have&nbsp;cleaner&nbsp;separation&nbsp;of&nbsp;app&nbsp;and&nbsp;user&nbsp;data&nbsp;than&nbsp;others,&nbsp;but&nbsp;one&nbsp;consistent&nbsp;point&nbsp;of&nbsp;clean&nbsp;separation&nbsp;common&nbsp;to&nbsp;all&nbsp;web&nbsp;apps&nbsp;is&nbsp;the&nbsp;HTTP&nbsp;layer,&nbsp;between&nbsp;client&nbsp;and&nbsp;server.&nbsp;Michael&#39;s&nbsp;proposal&nbsp;would&nbsp;allow&nbsp;applications&nbsp;a&nbsp;hook&nbsp;at&nbsp;precisely&nbsp;this&nbsp;point.&nbsp;Most&nbsp;client&nbsp;javascript&nbsp;could&nbsp;remain&nbsp;unchanged.&nbsp;XHR&nbsp;servlets&nbsp;would&nbsp;be&nbsp;replaced&nbsp;with&nbsp;client&nbsp;side&nbsp;scriptlets.&nbsp;Server-side&nbsp;templates&nbsp;could&nbsp;be&nbsp;fairly&nbsp;easily&nbsp;migrated&nbsp;to&nbsp;client-side&nbsp;counterparts&nbsp;that&nbsp;populate&nbsp;the&nbsp;template&nbsp;from&nbsp;a&nbsp;local&nbsp;data&nbsp;store.&lt;/li&gt;<br>
<br>
&lt;li&gt;These&nbsp;scriptlets&nbsp;could&nbsp;also&nbsp;offer&nbsp;a&nbsp;failure&nbsp;mode&nbsp;that&nbsp;would&nbsp;fall&nbsp;through&nbsp;to&nbsp;the&nbsp;online&nbsp;app.&lt;/li&gt;<br>
&lt;li&gt;We&nbsp;had&nbsp;to&nbsp;jump&nbsp;through&nbsp;all&nbsp;kinds&nbsp;of&nbsp;hoops&nbsp;to&nbsp;get&nbsp;single&nbsp;sign-on&nbsp;to&nbsp;work.&nbsp;We&nbsp;have&nbsp;to&nbsp;have&nbsp;2&nbsp;separate&nbsp;manifests&nbsp;containing&nbsp;all&nbsp;our&nbsp;app&nbsp;URLs,&nbsp;one&nbsp;protected&nbsp;by&nbsp;a&nbsp;cookie&nbsp;and&nbsp;one&nbsp;not.&nbsp;This&nbsp;proposal&nbsp;wouldn&#39;t&nbsp;completely&nbsp;ease&nbsp;this&nbsp;problem,&nbsp;but&nbsp;if&nbsp;we&#39;re&nbsp;executing&nbsp;a&nbsp;script&nbsp;before&nbsp;the&nbsp;page&nbsp;is&nbsp;loaded&nbsp;we&nbsp;have&nbsp;more&nbsp;options&nbsp;for&nbsp;redirecting&nbsp;to&nbsp;another&nbsp;page&nbsp;when&nbsp;not&nbsp;authenticated,&nbsp;more&nbsp;similar&nbsp;to&nbsp;the&nbsp;way&nbsp;most&nbsp;online&nbsp;authentication&nbsp;schemes&nbsp;work.&lt;/li&gt;<br>
&lt;/ol&gt;<br>
&lt;div&gt;Also,&nbsp;there&nbsp;are&nbsp;some&nbsp;cases&nbsp;where&nbsp;Javascript&nbsp;simply&nbsp;is&nbsp;not&nbsp;powerful&nbsp;enough.&nbsp;An&nbsp;example&nbsp;we&nbsp;hit&nbsp;recently&nbsp;is&nbsp;dynamic&nbsp;data&nbsp;in&nbsp;the&nbsp;header&nbsp;(e.g.,&nbsp;meta&nbsp;tags,&nbsp;styles).&nbsp;We&nbsp;have&nbsp;many&nbsp;cases&nbsp;where&nbsp;these&nbsp;change&nbsp;dynamically.&nbsp;There&nbsp;are&nbsp;ways&nbsp;to&nbsp;get&nbsp;around&nbsp;this&nbsp;(put&nbsp;the&nbsp;dynamic&nbsp;page&nbsp;in&nbsp;an&nbsp;iframe,&nbsp;construct&nbsp;HTML&nbsp;in&nbsp;javascript,&nbsp;and&nbsp;writer&nbsp;it&nbsp;into&nbsp;the&nbsp;iframe),&nbsp;but&nbsp;I&nbsp;think&nbsp;it&#39;s&nbsp;clear&nbsp;that&nbsp;this&nbsp;is&nbsp;not&nbsp;a&nbsp;great&nbsp;solution.&nbsp;This&nbsp;is&nbsp;processing&nbsp;that&nbsp;should&nbsp;happen&nbsp;before&nbsp;the&nbsp;page&nbsp;is&nbsp;handed&nbsp;to&nbsp;the&nbsp;browser.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;-&nbsp;Philip&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*Scriptlets&nbsp;-&nbsp;or&nbsp;dynamic&nbsp;namespace-handlers&nbsp;[new&nbsp;idea]*&lt;/div&gt;<br>
&lt;div&gt;&gt;&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;Something&nbsp;we&nbsp;wrestled&nbsp;with&nbsp;in&nbsp;the&nbsp;process&nbsp;of&nbsp;putting&nbsp;together&nbsp;the&nbsp;Gears&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;LocalServer&nbsp;was&nbsp;the&nbsp;distinction&nbsp;between&nbsp;intercepting&nbsp;requests&nbsp;for&nbsp;urls&nbsp;and&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;identifying&nbsp;the&nbsp;appropiate&nbsp;cached&nbsp;resource&nbsp;for&nbsp;that&nbsp;request.&nbsp;We&nbsp;ended&nbsp;up&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;with&nbsp;a&nbsp;declarative&nbsp;manifest&nbsp;file,&nbsp;similar&nbsp;to&nbsp;but&nbsp;different&nbsp;from&nbsp;what&nbsp;is&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;contained&nbsp;in&nbsp;this&nbsp;spec.&nbsp;This&nbsp;wasn&#39;t&nbsp;an&nbsp;altogether&nbsp;satisfying&nbsp;answer.&nbsp;The&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;expressiveness&nbsp;of&nbsp;the&nbsp;language&nbsp;to&nbsp;match/filter&nbsp;requested&nbsp;urls&nbsp;is&nbsp;limited&nbsp;in&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;Gears&nbsp;and&nbsp;this&nbsp;spec&nbsp;shares&nbsp;that&nbsp;same&nbsp;characterization.&lt;/div&gt;<br>
&lt;div&gt;&gt;&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;Something&nbsp;else&nbsp;we&#39;ve&nbsp;wrestled&nbsp;with&nbsp;in&nbsp;Gears&nbsp;was&nbsp;having&nbsp;to&nbsp;do&nbsp;awkward&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;redesigns&nbsp;in&nbsp;corners&nbsp;of&nbsp;a&nbsp;web&nbsp;application&nbsp;in&nbsp;order&nbsp;to&nbsp;&#39;take&nbsp;it&nbsp;offline&#39;,&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;single-sign-on&nbsp;for&nbsp;example.&nbsp;In&nbsp;general,&nbsp;anywhere&nbsp;an&nbsp;application&nbsp;relies&nbsp;on&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;HTTP&nbsp;features&nbsp;more&nbsp;than&nbsp;HTML&nbsp;to&nbsp;influence&nbsp;navigation&nbsp;or&nbsp;conditional&nbsp;resource&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;loading,&nbsp;it&#39;s&nbsp;difficult&nbsp;to&nbsp;address&nbsp;with&nbsp;a&nbsp;static&nbsp;cache.&lt;/div&gt;<br>
&lt;div&gt;&gt;&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;So&nbsp;I&#39;d&nbsp;like&nbsp;to&nbsp;propose&nbsp;extending&nbsp;this&nbsp;spec&nbsp;to&nbsp;incorporate&nbsp;&#39;dynamically&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;generated&nbsp;responses&#39;.&nbsp;I&nbsp;think&nbsp;this&nbsp;capability&nbsp;fits&nbsp;into&nbsp;this&nbsp;corner&nbsp;of&nbsp;the&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;HTML5&nbsp;spec&nbsp;because&nbsp;this&nbsp;is&nbsp;most&nbsp;directly&nbsp;useful&nbsp;in&nbsp;the&nbsp;&quot;Offline&nbsp;Web&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;Application&quot;&nbsp;scenario.&nbsp;The&nbsp;basic&nbsp;idea&nbsp;is&nbsp;to&nbsp;execute&nbsp;application&nbsp;code&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;(script)&nbsp;to&nbsp;produce&nbsp;responses&nbsp;to&nbsp;intercepted&nbsp;resource&nbsp;loads.&nbsp;The&nbsp;application&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;code&nbsp;is&nbsp;executed&nbsp;in&nbsp;the&nbsp;background&nbsp;and&nbsp;can&nbsp;formulate&nbsp;a&nbsp;response&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;asynchronously.&lt;/div&gt;<br>
&lt;div&gt;&gt;&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;Some&nbsp;handwaving&nbsp;where&nbsp;this&nbsp;could&nbsp;hang&nbsp;off&nbsp;of&nbsp;this&nbsp;spec&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*&nbsp;Modify&nbsp;namespace-handlers&nbsp;entries&nbsp;to&nbsp;have&nbsp;an&nbsp;attitional&nbsp;attribute&nbsp;to&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;indicate&nbsp;that&nbsp;they&nbsp;are&nbsp;to&nbsp;be&nbsp;executed&nbsp;rather&nbsp;than&nbsp;returned&lt;/div&gt;<br>
&lt;div&gt;&gt;&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;And&nbsp;some&nbsp;handwaving&nbsp;at&nbsp;what&nbsp;a&nbsp;scriptlet&nbsp;can&nbsp;do...&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*&nbsp;Can&nbsp;read&nbsp;the&nbsp;request&nbsp;headers&nbsp;and&nbsp;POST&nbsp;body&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*&nbsp;Can&nbsp;set&nbsp;response&nbsp;status&nbsp;code&nbsp;and&nbsp;headers&nbsp;(redirects)&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*&nbsp;Can&nbsp;generate&nbsp;a&nbsp;textual&nbsp;response&nbsp;body&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;&nbsp;*&nbsp;Can&nbsp;designate&nbsp;a&nbsp;non-executable&nbsp;cached&nbsp;resource&nbsp;to&nbsp;be&nbsp;returned&nbsp;in&nbsp;response&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*&nbsp;Can&nbsp;decide&nbsp;to&nbsp;&#39;bypass&#39;&nbsp;handling&nbsp;of&nbsp;a&nbsp;request&nbsp;and&nbsp;defer&nbsp;to&nbsp;the&nbsp;usual&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;resource&nbsp;loading&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*&nbsp;Can&nbsp;decide&nbsp;to&nbsp;perform&nbsp;the&nbsp;usual&nbsp;resource&nbsp;loading,&nbsp;but&nbsp;to&nbsp;have&nbsp;the&nbsp;response&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;added&nbsp;to&nbsp;the&nbsp;appCache&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*&nbsp;Can&nbsp;access&nbsp;HTML5Database&nbsp;APIs&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;*&nbsp;Can&nbsp;utlize&nbsp;XmlHttpRequest&nbsp;to&nbsp;communicate&nbsp;with&nbsp;a&nbsp;server&lt;/div&gt;<br>
&lt;div&gt;&gt;&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;This&nbsp;would&nbsp;obviously&nbsp;be&nbsp;significant&nbsp;addition&nbsp;to&nbsp;the&nbsp;spec,&nbsp;but&nbsp;i&nbsp;do&nbsp;think&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;this&nbsp;is&nbsp;worth&nbsp;consideration&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;&#39;offline&nbsp;applications&#39;.&nbsp;Based&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;on&nbsp;observations&nbsp;of&nbsp;app&nbsp;developers&nbsp;wrestling&nbsp;with&nbsp;Gears,&nbsp;there&nbsp;have&nbsp;been&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;several&nbsp;pain&nbsp;points.&nbsp;The&nbsp;HTML5ApplicationCache&nbsp;addresses&nbsp;one&nbsp;of&nbsp;them&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;with&nbsp;per-application&nbsp;caches.&nbsp;This&nbsp;addition&nbsp;would&nbsp;address&nbsp;the&nbsp;second&nbsp;of&lt;/div&gt;<br>
&lt;div&gt;&gt;&nbsp;them.&nbsp;&nbsp;(Another&nbsp;pain&nbsp;point&nbsp;has&nbsp;been&nbsp;application&nbsp;deployment).&lt;/div&gt;<br>
&lt;div&gt;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
