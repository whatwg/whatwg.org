<tt>
Filed&nbsp;a&nbsp;bug&nbsp;on&nbsp;URL&nbsp;encoding, &lt;a&nbsp;href=&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=482388&quot;&gt;https://bugzilla.mozilla.org/show_bug.cgi?id=482388&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Mar&nbsp;9,&nbsp;2009&nbsp;at&nbsp;5:02&nbsp;PM,&nbsp;Jonas&nbsp;Sicking&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;jonas@sicking.cc&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Fri,&nbsp;Mar&nbsp;6,&nbsp;2009&nbsp;at&nbsp;4:51&nbsp;PM,&nbsp;Dmitry&nbsp;Titov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dimich@chromium.org&quot;&gt;dimich@chromium.org&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;a&nbsp;couple&nbsp;of&nbsp;questions&nbsp;about&nbsp;Web&nbsp;Workers&nbsp;and&nbsp;text&nbsp;encoding&nbsp;of&nbsp;URLs.&lt;br&gt;<br>
&gt;&nbsp;Usually,&nbsp;&#39;server&#39;&nbsp;and&nbsp;&#39;path&#39;&nbsp;portions&nbsp;of&nbsp;URLs&nbsp;are&nbsp;always&nbsp;sent&nbsp;in&nbsp;UTRF-8,&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;&#39;query&#39;&nbsp;portion&nbsp;may&nbsp;be&nbsp;sent&nbsp;encoded&nbsp;if&nbsp;it&nbsp;contains&nbsp;non-ascii&nbsp;characters.&nbsp;I&#39;m&lt;br&gt;<br>
&gt;&nbsp;looking&nbsp;at&nbsp;what&nbsp;should&nbsp;be&nbsp;an&nbsp;encoding&nbsp;used&nbsp;for&nbsp;this.&lt;br&gt;<br>
&gt;&nbsp;Lets&nbsp;say&nbsp;we&nbsp;have&nbsp;the&nbsp;Page&nbsp;that&nbsp;creates&nbsp;a&nbsp;Worker&nbsp;which&nbsp;uses&nbsp;includeScripts&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;load&nbsp;the&nbsp;NestedScript.&lt;br&gt;<br>
&gt;&nbsp;Lets&nbsp;say&nbsp;the&nbsp;Page&nbsp;has&nbsp;some&nbsp;text&nbsp;encoding&nbsp;(from&nbsp;http&nbsp;header,&nbsp;meta&nbsp;tag&nbsp;or&lt;br&gt;<br>
&gt;&nbsp;otherwise).&nbsp;For&nbsp;example,&nbsp;in&nbsp;latest&nbsp;FF&nbsp;nightly&nbsp;(Minefield)&nbsp;the&nbsp;following&lt;br&gt;<br>
&gt;&nbsp;behaviors&nbsp;can&nbsp;be&nbsp;observed:&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;XmlHttpRequest&nbsp;created&nbsp;on&nbsp;the&nbsp;Page&nbsp;would&nbsp;send&nbsp;its&nbsp;URL&nbsp;to&nbsp;server&nbsp;encoded&lt;br&gt;<br>
&gt;&nbsp;using&nbsp;UTF8,&nbsp;irrespective&nbsp;to&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the&nbsp;Page.&nbsp;However,&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;XmlHttpRequest&nbsp;created&nbsp;in&nbsp;the&nbsp;Worker&nbsp;would&nbsp;send&nbsp;the&nbsp;URL&nbsp;encoded&nbsp;using&nbsp;Page&#39;s&lt;br&gt;<br>
&gt;&nbsp;encoding.&nbsp;It&nbsp;seems&nbsp;that&nbsp;either&nbsp;XHR&nbsp;on&nbsp;the&nbsp;Page&nbsp;should&nbsp;also&nbsp;use&nbsp;Page&#39;s&lt;br&gt;<br>
&gt;&nbsp;encoding,&nbsp;or&nbsp;XHR&nbsp;in&nbsp;the&nbsp;Worker&nbsp;should&nbsp;use&nbsp;UTF-8.&nbsp;Bug?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Sounds&nbsp;like&nbsp;it.&nbsp;Would&nbsp;be&nbsp;great&nbsp;if&nbsp;you&nbsp;could&nbsp;file&nbsp;a&nbsp;bug.&nbsp;That&nbsp;is&nbsp;why&nbsp;we&lt;br&gt;<br>
have&nbsp;beta&nbsp;releases&nbsp;:)&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;When&nbsp;a&nbsp;script&nbsp;of&nbsp;the&nbsp;Worker&nbsp;is&nbsp;decoded,&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the&nbsp;Page&nbsp;is&nbsp;used,&lt;br&gt;<br>
&gt;&nbsp;unless&nbsp;Worker&#39;s&nbsp;script&nbsp;comes&nbsp;with&nbsp;http&nbsp;header&nbsp;overriding&nbsp;the&nbsp;ecncoding.&nbsp;That&lt;br&gt;<br>
&gt;&nbsp;sounds&nbsp;right.&nbsp;However,&nbsp;if&nbsp;the&nbsp;Worker&nbsp;in&nbsp;turn&nbsp;creates&nbsp;a&nbsp;nested&nbsp;Worker,&nbsp;uses&lt;br&gt;<br>
&gt;&nbsp;an&nbsp;XHR&nbsp;or&nbsp;importScripts(url),&nbsp;the&nbsp;URL&nbsp;encoding&nbsp;defaults&nbsp;back&nbsp;to&nbsp;the&nbsp;Page&#39;s,&lt;br&gt;<br>
&gt;&nbsp;even&nbsp;if&nbsp;there&nbsp;was&nbsp;overriding&nbsp;http&nbsp;header.&nbsp;It&nbsp;might&nbsp;be&nbsp;ok&nbsp;but&nbsp;seems&nbsp;a&nbsp;bit&lt;br&gt;<br>
&gt;&nbsp;illogical&nbsp;-&nbsp;the&nbsp;nested&nbsp;worker&nbsp;or&nbsp;imported&nbsp;scripts&nbsp;are&nbsp;&#39;sub&nbsp;resources&#39;,&nbsp;their&lt;br&gt;<br>
&gt;&nbsp;relative&nbsp;url&nbsp;is&nbsp;resolved&nbsp;against&nbsp;the&nbsp;Worker&#39;s&nbsp;base&nbsp;url,&nbsp;so&nbsp;it&nbsp;feels&nbsp;that&lt;br&gt;<br>
&gt;&nbsp;their&nbsp;default&nbsp;encoding&nbsp;should&nbsp;be&nbsp;inherited&nbsp;from&nbsp;Worker.&nbsp;Is&nbsp;it&nbsp;a&nbsp;bug?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;I&nbsp;suspect&nbsp;so&nbsp;yes.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
/&nbsp;Jonas&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
