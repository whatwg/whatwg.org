<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Dec&nbsp;12,&nbsp;2008&nbsp;at&nbsp;12:55&nbsp;AM,&nbsp;Ian&nbsp;Hickson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;ian@hixie.ch&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;On&nbsp;Sun,&nbsp;16&nbsp;Nov&nbsp;2008,&nbsp;ddailey&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Here&#39;s&nbsp;the&nbsp;sitch:&nbsp;because&nbsp;of&nbsp;an&nbsp;extensive&nbsp;use&nbsp;of&nbsp;CTRL&nbsp;sequences&nbsp;in&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;interface,&nbsp;the&nbsp;user&nbsp;will&nbsp;sometimes&nbsp;accidentally&nbsp;do&nbsp;something&nbsp;like&nbsp;CTRL&nbsp;R&lt;br&gt;<br>
&gt;&nbsp;(which&nbsp;the&nbsp;browser&nbsp;thinks&nbsp;is&nbsp;a&nbsp;refresh&nbsp;command).&nbsp;In&nbsp;a&nbsp;regular&nbsp;app,&nbsp;if&lt;br&gt;<br>
&gt;&nbsp;users&nbsp;stand&nbsp;in&nbsp;jeopardy&nbsp;of&nbsp;losing&nbsp;all&nbsp;their&nbsp;work,&nbsp;the&nbsp;app&nbsp;usually&nbsp;warns&lt;br&gt;<br>
&gt;&nbsp;them&nbsp;before&nbsp;quitting.&nbsp;The&nbsp;way&nbsp;I&nbsp;found&nbsp;to&nbsp;work&nbsp;around&nbsp;it&nbsp;(that&nbsp;used&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;work)&nbsp;was&nbsp;to&nbsp;use&nbsp;onunload=&quot;confirm(&#39;save&nbsp;before&nbsp;quitting?&#39;).&nbsp;Currently,&lt;br&gt;<br>
&gt;&nbsp;however,&nbsp;IE&nbsp;seems&nbsp;to&nbsp;have&nbsp;removed&nbsp;my&nbsp;ability&nbsp;to&nbsp;intervene&nbsp;before&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;erases&nbsp;all&nbsp;work.&nbsp;onbeforeunload=function&nbsp;(){&nbsp;fix(everything)}&nbsp;doesn&#39;t&lt;br&gt;<br>
&gt;&nbsp;seem&nbsp;to&nbsp;help&nbsp;either.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&gt;&nbsp;So&nbsp;the&nbsp;question:&nbsp;how&nbsp;does&nbsp;HTML&nbsp;5&nbsp;currently&nbsp;address&nbsp;the&nbsp;issue&nbsp;and&nbsp;do&lt;br&gt;<br>
&gt;&nbsp;browsers&nbsp;actually&nbsp;implement&nbsp;something&nbsp;along&nbsp;this&nbsp;line&nbsp;these&nbsp;days?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;I&nbsp;just&nbsp;went&nbsp;ahead&nbsp;and&nbsp;specced&nbsp;out&nbsp;the&nbsp;&#39;onbeforeunload&#39;&nbsp;feature&nbsp;that&nbsp;most&lt;br&gt;<br>
browsers&nbsp;support&nbsp;today&nbsp;that&nbsp;handles&nbsp;this&nbsp;case.&lt;br&gt;<br>
&lt;br&gt;<br>
Basically&nbsp;you&nbsp;just&nbsp;need&nbsp;to&nbsp;do&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;onbeforeunload=&quot;if&nbsp;(dirty)&nbsp;return&nbsp;&#39;You&nbsp;have&nbsp;unsaved&nbsp;work.&nbsp;Are&nbsp;you&nbsp;sure&nbsp;you&nbsp;want&nbsp;to&nbsp;close&nbsp;this&nbsp;page?&#39;&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
...or&nbsp;some&nbsp;such.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;we&#39;re&nbsp;going&nbsp;for&nbsp;matching&nbsp;what&nbsp;browsers&nbsp;do,&nbsp;there&#39;s&nbsp;a&nbsp;number&nbsp;of&nbsp;cases&nbsp;(different&nbsp;in&nbsp;each&nbsp;browser)&nbsp;where&nbsp;the&nbsp;confirm&nbsp;doesn&#39;t&nbsp;popup.&nbsp;In&nbsp;Chrome,&nbsp;for&nbsp;example,&nbsp;if&nbsp;the&nbsp;beforeunload&nbsp;handler&nbsp;takes&nbsp;too&nbsp;long,&nbsp;we&nbsp;kill&nbsp;it&nbsp;and&nbsp;navigate&nbsp;away.&nbsp;Similarly,&nbsp;in&nbsp;Firefox,&nbsp;if&nbsp;the&nbsp;beforeunload&nbsp;handler&nbsp;hits&nbsp;the&nbsp;limit&nbsp;for&nbsp;script&nbsp;execution&nbsp;and&nbsp;the&nbsp;user&nbsp;stops&nbsp;the&nbsp;script,&nbsp;the&nbsp;beforeunload&nbsp;handler&nbsp;never&nbsp;fires.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Not&nbsp;sure&nbsp;what&nbsp;the&nbsp;right&nbsp;language&nbsp;for&nbsp;that&nbsp;is.&nbsp;But&nbsp;developers&nbsp;try&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;using&nbsp;beforeunload/unload&nbsp;to&nbsp;release&nbsp;locks,&nbsp;make&nbsp;server&nbsp;requests,&nbsp;etc.&nbsp;and&nbsp;it&#39;s&nbsp;just&nbsp;not&nbsp;a&nbsp;very&nbsp;reliable&nbsp;thing&nbsp;to&nbsp;do&nbsp;in&nbsp;any&nbsp;browser.&nbsp;It&#39;s&nbsp;really&nbsp;just&nbsp;useful&nbsp;for&nbsp;the&nbsp;quick&nbsp;prompt&nbsp;for&nbsp;the&nbsp;user&nbsp;as&nbsp;to&nbsp;things&nbsp;like&nbsp;unsaved&nbsp;changes.&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ojan&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;On&nbsp;Mon,&nbsp;17&nbsp;Nov&nbsp;2008,&nbsp;Thomas&nbsp;Broyer&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;you&nbsp;can&nbsp;automatically&nbsp;save&nbsp;but&nbsp;what&nbsp;you&nbsp;can&nbsp;do&nbsp;is&nbsp;cancel&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;unload&nbsp;with&nbsp;a&nbsp;prompt.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&gt;&nbsp;window.onbeforeunload&nbsp;=&nbsp;function()&nbsp;{&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;Your&nbsp;unsaved&nbsp;changes&nbsp;will&nbsp;be&nbsp;lost.&nbsp;Are&nbsp;you&nbsp;sure&nbsp;you&nbsp;want&nbsp;to&nbsp;leave?&quot;;&lt;br&gt;<br>
&gt;&nbsp;};&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;browser&nbsp;will&nbsp;prompt&nbsp;the&nbsp;user&nbsp;with&nbsp;the&nbsp;returned&nbsp;string.&nbsp;Clicking&nbsp;&quot;no&quot;&lt;br&gt;<br>
&gt;&nbsp;or&nbsp;&quot;cancel&quot;&nbsp;(depends&nbsp;on&nbsp;the&nbsp;browser)&nbsp;will&nbsp;cancel&nbsp;the&nbsp;&quot;unload&quot;.&nbsp;If&nbsp;you&lt;br&gt;<br>
&gt;&nbsp;don&#39;t&nbsp;want&nbsp;the&nbsp;prompt,&nbsp;just&nbsp;return&nbsp;&quot;undefined&quot;&nbsp;(beware,&nbsp;returning&nbsp;null&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;IE6&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;returning&nbsp;the&nbsp;string&nbsp;&quot;null&quot;).&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;window.onbeforeunload&nbsp;=&nbsp;function()&nbsp;{&lt;br&gt;<br>
&gt;&nbsp;&nbsp;if&nbsp;(unsavedChanges)&nbsp;{&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;You&nbsp;have&nbsp;unsaved&nbsp;changes.&quot;;&lt;br&gt;<br>
&gt;&nbsp;&nbsp;}&lt;br&gt;<br>
&gt;&nbsp;&nbsp;//&nbsp;return&nbsp;nothing,&nbsp;i.e.&nbsp;return&nbsp;undefined&lt;br&gt;<br>
&gt;&nbsp;};&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Right.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;HTML5&nbsp;is&nbsp;almost&nbsp;silent&nbsp;about&nbsp;beforeunload&nbsp;and&nbsp;unload&nbsp;(and&nbsp;many&nbsp;other)&lt;br&gt;<br>
&gt;&nbsp;events&nbsp;re.&nbsp;their&nbsp;properties&nbsp;(cancelable&nbsp;in&nbsp;this&nbsp;case).&nbsp;unload&nbsp;is&nbsp;defined&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;DOM3-Events&nbsp;(as&nbsp;non-cancelable)&nbsp;but&nbsp;AFAICT&nbsp;beforeunload&nbsp;is&nbsp;not&nbsp;spec&#39;d&lt;br&gt;<br>
&gt;&nbsp;anywhere.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Fixed.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Mon,&nbsp;17&nbsp;Nov&nbsp;2008,&nbsp;Philipp&nbsp;Serafin&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;you&nbsp;can&nbsp;do&nbsp;for&nbsp;an&nbsp;&quot;emergency&nbsp;save&quot;&nbsp;is&nbsp;to&nbsp;fire&nbsp;a&nbsp;*synchronous*&nbsp;XHR&nbsp;during&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;unload&nbsp;event.&nbsp;This&nbsp;will&nbsp;freeze&nbsp;the&nbsp;UI&nbsp;but&nbsp;since&nbsp;the&nbsp;user&nbsp;was&nbsp;about&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;close&nbsp;the&nbsp;page&nbsp;anyway,&nbsp;this&nbsp;shouldn&#39;t&nbsp;matter&nbsp;much.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;The&nbsp;other&nbsp;alternative&nbsp;is&nbsp;to&nbsp;be&nbsp;always&nbsp;saving&nbsp;state&nbsp;on&nbsp;the&nbsp;server&nbsp;(or&nbsp;in&lt;br&gt;<br>
a&nbsp;local&nbsp;database,&nbsp;cookie,&nbsp;or&nbsp;equivalent).&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
--&lt;br&gt;<br>
Ian&nbsp;Hickson&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U+1047E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)\._.,--....,&#39;``.&nbsp;&nbsp;&nbsp;&nbsp;fL&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://ln.hixie.ch/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ln.hixie.ch/&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U+263A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/,&nbsp;&nbsp;&nbsp;_..&nbsp;\&nbsp;&nbsp;&nbsp;_\&nbsp;&nbsp;;`._&nbsp;,.&lt;br&gt;<br>
Things&nbsp;that&nbsp;are&nbsp;impossible&nbsp;just&nbsp;take&nbsp;longer.&nbsp;&nbsp;&nbsp;`._.-(,_..&#39;--(,_..&#39;`-.;.&#39;&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
