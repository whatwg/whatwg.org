<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;font-size:13px;border-collapse:collapse&quot;&gt;SUMMARY&lt;/span&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;font-size:13px;border-collapse:collapse&quot;&gt;Currently,&nbsp;textareas&nbsp;and&nbsp;text&nbsp;inputs&nbsp;support&nbsp;the&nbsp;&amp;quot;oninput&amp;quot;&nbsp;event&nbsp;that&nbsp;fires&nbsp;on&nbsp;all&nbsp;user-initiated&nbsp;modifications&nbsp;to&nbsp;their&nbsp;content.&nbsp;We&nbsp;should&nbsp;add&nbsp;this&nbsp;event&nbsp;to&nbsp;contentEditable&nbsp;elements&nbsp;as&nbsp;well&nbsp;and&nbsp;add&nbsp;an&nbsp;&amp;quot;action&amp;quot;&nbsp;property&nbsp;the&nbsp;specifies&nbsp;what&nbsp;action&nbsp;the&nbsp;user&nbsp;took&nbsp;that&nbsp;caused&nbsp;the&nbsp;input&nbsp;event.&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;font-size:13px;border-collapse:collapse&quot;&gt;We&nbsp;should&nbsp;also&nbsp;add&nbsp;a&nbsp;cancellable&nbsp;&amp;quot;onbeforeinput&amp;quot;&nbsp;event.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;USE&nbsp;CASE&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;font-size:13px;border-collapse:collapse&quot;&gt;There&nbsp;are&nbsp;two&nbsp;main&nbsp;use&nbsp;cases.&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;font-size:13px;border-collapse:collapse&quot;&gt;1.&nbsp;A&nbsp;simple&nbsp;but&nbsp;comprehensive&nbsp;way&nbsp;to&nbsp;detect&nbsp;changes&nbsp;in&nbsp;a&nbsp;contentEditable&nbsp;region&nbsp;for&nbsp;features&nbsp;like&nbsp;autosave,&nbsp;transliteration,&nbsp;spelling&nbsp;correction,&nbsp;etc.&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;font-size:13px;border-collapse:collapse&quot;&gt;2.&nbsp;Maintaining&nbsp;the&nbsp;data&nbsp;in&nbsp;a&nbsp;non-html&nbsp;model&nbsp;and&nbsp;using&nbsp;HTML&nbsp;as&nbsp;the&nbsp;view&nbsp;on&nbsp;the&nbsp;data.&nbsp;This&nbsp;requires&nbsp;capturing&nbsp;each&nbsp;change&nbsp;to&nbsp;the&nbsp;contentEditable&nbsp;element&amp;#39;s&nbsp;contents&nbsp;and&nbsp;updating&nbsp;the&nbsp;model&nbsp;appropriately.&nbsp;Specifically,&nbsp;this&nbsp;is&nbsp;what&nbsp;Google&nbsp;Wave&nbsp;does.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;WORK&nbsp;AROUNDS&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;font-size:13px;border-collapse:collapse&quot;&gt;Sites&nbsp;that&nbsp;use&nbsp;contentEditable&nbsp;currently&nbsp;rely&nbsp;on&nbsp;MutationEvents&nbsp;to&nbsp;detect&nbsp;when&nbsp;their&nbsp;contents&nbsp;have&nbsp;changed.&nbsp;MutationEvents&nbsp;are&nbsp;lower-level&nbsp;than&nbsp;the&nbsp;developer&nbsp;cares&nbsp;for,&nbsp;fire&nbsp;far&nbsp;too&nbsp;frequently&nbsp;for&nbsp;these&nbsp;use-cases,&nbsp;are&nbsp;complicated&nbsp;to&nbsp;use&nbsp;and&nbsp;have&nbsp;a&nbsp;significant&nbsp;performance&nbsp;impact.&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;Sites&nbsp;that&nbsp;don&amp;#39;t&nbsp;use&nbsp;MutationEvents&nbsp;use&nbsp;a&nbsp;long&nbsp;list&nbsp;of&nbsp;events&nbsp;(keydown,&nbsp;keyup,&nbsp;keypress,&nbsp;copy,&nbsp;paste,&nbsp;undo,&nbsp;etc.)&nbsp;to&nbsp;monitor&nbsp;changes.&nbsp;This&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;code&nbsp;and&nbsp;hard&nbsp;to&nbsp;get&nbsp;right.&nbsp;Not&nbsp;to&nbsp;mention&nbsp;that&nbsp;browsers&nbsp;don&amp;#39;t&nbsp;actually&nbsp;have&nbsp;events&nbsp;for&nbsp;all&nbsp;the&nbsp;possible&nbsp;user-initiated&nbsp;actions.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;Google&nbsp;properties&nbsp;actually&nbsp;use&nbsp;the&nbsp;long&nbsp;list&nbsp;of&nbsp;events&nbsp;for&nbsp;semantic&nbsp;things&nbsp;(e.g.&nbsp;catch&nbsp;ctrl+z,&nbsp;cancel&nbsp;it&nbsp;and&nbsp;perform&nbsp;a&nbsp;custom&nbsp;undo)&nbsp;*and*&nbsp;listen&nbsp;to&nbsp;MutationEvents&nbsp;to&nbsp;catch&nbsp;cases&nbsp;where&nbsp;browsers&nbsp;don&amp;#39;t&nbsp;fire&nbsp;an&nbsp;event.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;font-size:13px;border-collapse:collapse&quot;&gt;&lt;br&gt;PROPOSAL&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;When&nbsp;a&nbsp;user-initiated&nbsp;action&nbsp;is&nbsp;going&nbsp;to&nbsp;modify&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;contentEditable&nbsp;element,&nbsp;a&nbsp;beforeinput&nbsp;event&nbsp;should&nbsp;be&nbsp;fired.&nbsp;The&nbsp;event&nbsp;should&nbsp;be&nbsp;cancellable&nbsp;and&nbsp;have&nbsp;an&nbsp;action&nbsp;property&nbsp;that&nbsp;is&nbsp;a&nbsp;string&nbsp;specifying&nbsp;what&nbsp;the&nbsp;user-action&nbsp;involved&nbsp;was&nbsp;(e.g.&nbsp;&amp;quot;paste&amp;quot;,&nbsp;&amp;quot;inserttext&amp;quot;,&nbsp;&amp;quot;undo&amp;quot;,&nbsp;etc). &lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,&nbsp;sans-serif;border-collapse:collapse&quot;&gt;After&nbsp;the&nbsp;DOM&nbsp;has&nbsp;been&nbsp;modified,&nbsp;fire&nbsp;the&nbsp;input&nbsp;event,&nbsp;which&nbsp;also&nbsp;has&nbsp;the&nbsp;action&nbsp;property.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;<br>
<br>
<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;The&nbsp;action&nbsp;property&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;use-case&nbsp;of&nbsp;maintaining&nbsp;a&nbsp;non-html&nbsp;model&nbsp;of&nbsp;the&nbsp;content.&nbsp; For&nbsp;example,&nbsp;when&nbsp;the&nbsp;HTML&nbsp;representation&nbsp;of&nbsp;the&nbsp;content&nbsp;has&nbsp;complicated&nbsp;HTML&nbsp;content&nbsp;(e.g.&nbsp;an&nbsp;image&nbsp;with&nbsp;a&nbsp;caption)&nbsp;that&nbsp;maps&nbsp;to&nbsp;one&nbsp;atomic&nbsp;unit&nbsp;in&nbsp;the&nbsp;data&nbsp;model,&nbsp;the&nbsp;web&nbsp;app&nbsp;needs&nbsp;to&nbsp;catch&nbsp;events&nbsp;like&nbsp;backspace,&nbsp;cancel&nbsp;the&nbsp;event&nbsp;and&nbsp;update&nbsp;the&nbsp;DOM&nbsp;and&nbsp;it&amp;#39;s&nbsp;model&nbsp;appropriately.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;You&nbsp;can&nbsp;currently&nbsp;do&nbsp;most&nbsp;of&nbsp;this&nbsp;using&nbsp;the&nbsp;long&nbsp;list&nbsp;of&nbsp;events&nbsp;exposed.&nbsp;But&nbsp;there&amp;#39;s&nbsp;no&nbsp;guarantee&nbsp;that&nbsp;all&nbsp;user-initiated&nbsp;events&nbsp;will&nbsp;be&nbsp;exposed&nbsp;via&nbsp;an&nbsp;event&nbsp;and,&nbsp;even&nbsp;if&nbsp;they&nbsp;were&nbsp;all&nbsp;exposed,&nbsp;it&amp;#39;s&nbsp;a&nbsp;lot&nbsp;of&nbsp;complex&nbsp;code&nbsp;to&nbsp;make&nbsp;it&nbsp;work.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;Ojan&lt;/div&gt;<br>

</tt>
