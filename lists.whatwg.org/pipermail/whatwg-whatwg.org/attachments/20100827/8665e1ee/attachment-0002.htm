<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;27&nbsp;August&nbsp;2010&nbsp;05:02,&nbsp;Boris&nbsp;Zbarsky&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:bzbarsky@mit.edu&quot;&gt;bzbarsky@mit.edu&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;8/26/10&nbsp;11:58&nbsp;AM,&nbsp;James&nbsp;May&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
I&nbsp;thought&nbsp;I&nbsp;just&nbsp;suggested&nbsp;that?&lt;br&gt;<br>
&lt;br&gt;<br>
Everything&nbsp;works&nbsp;normally&nbsp;(as&nbsp;if&nbsp;it&nbsp;was&nbsp;still&nbsp;attached)&nbsp;until&nbsp;it&nbsp;is&lt;br&gt;<br>
reattached,&nbsp;when&nbsp;the&nbsp;situation&nbsp;is&nbsp;re-evaluated.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
That&nbsp;could&nbsp;fall&nbsp;afoul&nbsp;of&nbsp;security&nbsp;checks&nbsp;that&nbsp;assume&nbsp;that&nbsp;an&nbsp;iframe&nbsp;with&nbsp;a&nbsp;non-null&nbsp;parent&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;subframe&nbsp;and&nbsp;that&nbsp;it&#39;s&nbsp;owner&nbsp;element&nbsp;is&nbsp;in&nbsp;the&nbsp;DOM.&nbsp; I&nbsp;know&nbsp;Gecko&nbsp;certainly&nbsp;has&nbsp;such&nbsp;internally.&lt;br&gt;<br>
&lt;br&gt;<br>
Again,&nbsp;nothing&nbsp;insurmountable,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;bunch&nbsp;of&nbsp;code&nbsp;in&nbsp;Gecko&nbsp;that&nbsp;makes&nbsp;assumptions&nbsp;about&nbsp;when&nbsp;windows&nbsp;can&nbsp;and&nbsp;can&#39;t&nbsp;exist&nbsp;that&nbsp;would&nbsp;need&nbsp;auditing.&nbsp;I&nbsp;can&#39;t&nbsp;speak&nbsp;to&nbsp;the&nbsp;web&nbsp;compat&nbsp;aspects.&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Could&nbsp;the&nbsp;iframe&nbsp;be&nbsp;hoisted&nbsp;to&nbsp;the&nbsp;top&nbsp;level&nbsp;of&nbsp;its&nbsp;parent&nbsp;browsing&nbsp;context?&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
In&nbsp;terms&nbsp;of&nbsp;resource&nbsp;consumption,&nbsp;I&nbsp;don&#39;t&nbsp;see&nbsp;how&nbsp;this&nbsp;would&nbsp;be&nbsp;any&lt;br&gt;<br>
different&nbsp;to&nbsp;any&nbsp;other&nbsp;kind&nbsp;of&nbsp;leak&nbsp;that&nbsp;web&nbsp;content&nbsp;can&nbsp;trigger.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
I&nbsp;don&#39;t&nbsp;think&nbsp;that&#39;s&nbsp;an&nbsp;issue,&nbsp;though&nbsp;this&nbsp;does&nbsp;raise&nbsp;the&nbsp;question&nbsp;of&nbsp;when&nbsp;it&#39;s&nbsp;OK&nbsp;to&nbsp;gc&nbsp;the&nbsp;iframe.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;When&nbsp;no&nbsp;references&nbsp;remain&nbsp;in&nbsp;either&nbsp;the&nbsp;DOM&nbsp;or&nbsp;script?&lt;br&gt;&lt;blockquote&gt;&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;if&nbsp;an&nbsp;&lt;/span&gt;&lt;code&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/the-iframe-element.html#the-iframe-element&quot;&gt;iframe&lt;/a&gt;&lt;/code&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&nbsp;is&nbsp;&lt;/span&gt;&lt;a&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#remove-an-element-from-a-document&quot;&nbsp;title=&quot;remove&nbsp;an&nbsp;element&nbsp;from&nbsp;a&nbsp;document&quot;&gt;removed&lt;/a&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&nbsp;from&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;code&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#document&quot;&gt;Document&lt;/a&gt;&lt;/code&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&nbsp;and&nbsp;is&nbsp;then&nbsp;subsequently&nbsp;garbage&nbsp;collected,<br>
&nbsp;&nbsp;&nbsp;this&nbsp;will&nbsp;likely&nbsp;mean&nbsp;(in&nbsp;the&nbsp;absence&nbsp;of&nbsp;other&nbsp;references)&nbsp;that&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;a&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#child-browsing-context&quot;&gt;child&nbsp;browsing&nbsp;context&lt;/a&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&#39;s&nbsp;&lt;/span&gt;&lt;code&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#windowproxy&quot;&gt;WindowProxy&lt;/a&gt;&lt;/code&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;object&nbsp;will&nbsp;become&nbsp;eligble&nbsp;for&nbsp;garbage&nbsp;collection,&nbsp;which&nbsp;will&nbsp;then<br>
&nbsp;&nbsp;&nbsp;lead&nbsp;to&nbsp;that&nbsp;&lt;/span&gt;&lt;a&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#browsing-context&quot;&gt;browsing&nbsp;context&lt;/a&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&nbsp;being&nbsp;&lt;/span&gt;&lt;a&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#a-browsing-context-is-discarded&quot;&nbsp;title=&quot;a<br>
&nbsp;&nbsp;&nbsp;browsing&nbsp;context&nbsp;is&nbsp;discarded&quot;&gt;discarded&lt;/a&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;,&nbsp;which&nbsp;will&nbsp;then<br>
&nbsp;&nbsp;&nbsp;lead&nbsp;to&nbsp;its&nbsp;&lt;/span&gt;&lt;code&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#document&quot;&gt;Document&lt;/a&gt;&lt;/code&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&nbsp;being&nbsp;&lt;/span&gt;&lt;a&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#discard-a-document&quot;&nbsp;title=&quot;discard&nbsp;a<br>
&nbsp;&nbsp;&nbsp;document&quot;&gt;discarded&lt;/a&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&nbsp;also.&nbsp;This&nbsp;happens&nbsp;without&nbsp;notice&nbsp;to&nbsp;any<br>
&nbsp;&nbsp;&nbsp;scripts&nbsp;running&nbsp;in&nbsp;that&nbsp;&lt;/span&gt;&lt;code&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#document&quot;&gt;Document&lt;/a&gt;&lt;/code&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;;&nbsp;for&nbsp;example,&nbsp;no<br>
&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;code&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&nbsp;title=&quot;event-unload&quot;&gt;unload&lt;/code&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&nbsp;events&nbsp;are&nbsp;fired&nbsp;(the<br>
&nbsp;&nbsp;&nbsp;&quot;&lt;/span&gt;&lt;a&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/history.html#unload-a-document&quot;&gt;unload&nbsp;a&nbsp;document&lt;/a&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;153,&nbsp;0);&quot;&gt;&quot;&nbsp;steps&nbsp;are&nbsp;not&nbsp;run).&nbsp;&lt;/span&gt;&lt;br&gt;<br>
<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;Although&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;why&nbsp;this&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;regular&nbsp;steps. &nbsp;(&lt;a&nbsp;href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#garbage-collection-and-browsing-contexts&quot;&gt;http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#garbage-collection-and-browsing-contexts&lt;/a&gt;)&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
(I&nbsp;think&nbsp;someone&nbsp;mentioned&nbsp;that&nbsp;iframes&nbsp;can&nbsp;be&nbsp;GC&#39;d&nbsp;normally)&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Can&nbsp;they,&nbsp;with&nbsp;your&nbsp;proposal?&nbsp; It&nbsp;seems&nbsp;that&nbsp;with&nbsp;your&nbsp;proposal&nbsp;if&nbsp;you&nbsp;remove&nbsp;an&nbsp;iframe&nbsp;from&nbsp;the&nbsp;DOM&nbsp;and&nbsp;then&nbsp;forget&nbsp;about&nbsp;it&nbsp;then&nbsp;as&nbsp;long&nbsp;as&nbsp;there&#39;s&nbsp;any&nbsp;network&nbsp;activity&nbsp;in&nbsp;that&nbsp;iframe&nbsp;or&nbsp;anything&nbsp;else&nbsp;which&nbsp;might&nbsp;potentially&nbsp;trigger&nbsp;script&nbsp;it&nbsp;cannot&nbsp;be&nbsp;gced.&nbsp; This&nbsp;seems&nbsp;like&nbsp;it&nbsp;would&nbsp;make&nbsp;it&nbsp;very&nbsp;easy&nbsp;to&nbsp;leak&nbsp;document&nbsp;after&nbsp;document...&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
<br>
<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;So&nbsp;running&nbsp;scripts&nbsp;and&nbsp;network&nbsp;activity&nbsp;are&nbsp;GC&nbsp;roots?&lt;br&gt;&lt;br&gt;--&nbsp;James&lt;br&gt;<br>

</tt>
