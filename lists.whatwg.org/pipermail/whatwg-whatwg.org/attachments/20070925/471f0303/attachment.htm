<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;<br>
&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Sep&nbsp;24,&nbsp;2007,&nbsp;at&nbsp;10:45&nbsp;PM,&nbsp;Robert&nbsp;O'Callahan&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;9/23/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Maciej&nbsp;Stachowiak&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mjs@apple.com&quot;&gt;mjs@apple.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&nbsp;Obviously,&nbsp;if&nbsp;the&nbsp;way&nbsp;to&nbsp;get&nbsp;the&nbsp;contents&nbsp;as&nbsp;text&nbsp;requires&nbsp;providing&lt;br&gt;the&nbsp;encoding,&nbsp;then&nbsp;it&nbsp;has&nbsp;to&nbsp;be&nbsp;a&nbsp;method.&nbsp;My&nbsp;comment&nbsp;was&nbsp;about&nbsp;the&nbsp;no-&lt;br&gt;argument&nbsp;methods.&nbsp;But&nbsp;you&nbsp;have&nbsp;a&nbsp;point&nbsp;that&nbsp;reading&nbsp;from&nbsp;disk&nbsp;is&nbsp;not&nbsp;a&lt;br&gt;simple&nbsp;get&nbsp;operation.&nbsp;Probably&nbsp;the&nbsp;methods&nbsp;should&nbsp;have&nbsp;names&nbsp;based&nbsp;on&nbsp;&lt;br&gt;read&nbsp;or&nbsp;the&nbsp;like&nbsp;(read(),&nbsp;readAsText(),&nbsp;etc)&nbsp;to&nbsp;indicate&nbsp;this.&nbsp;Also,&lt;br&gt;they&nbsp;should&nbsp;arguably&nbsp;be&nbsp;asynchronous&nbsp;since&nbsp;reading&nbsp;from&nbsp;the&nbsp;disk&nbsp;can&lt;br&gt;be&nbsp;slow,&nbsp;especially&nbsp;for&nbsp;large&nbsp;files,&nbsp;and&nbsp;it&nbsp;is&nbsp;undesirable&nbsp;to&nbsp;block&lt;br&gt;the&nbsp;main&nbsp;thread.&nbsp;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;For&nbsp;small&nbsp;files,&nbsp;synchronous&nbsp;reading&nbsp;is&nbsp;OK.&nbsp;Perhaps&nbsp;there&nbsp;should&nbsp;be&nbsp;a&nbsp;separate&nbsp;whiz-bang&nbsp;asynchronous&nbsp;API&nbsp;...&nbsp;it&nbsp;could&nbsp;support&nbsp;partial&nbsp;reads&nbsp;too.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;kind&nbsp;of&nbsp;file&nbsp;is&nbsp;small&nbsp;enough&nbsp;is&nbsp;a&nbsp;matter&nbsp;of&nbsp;judgment&nbsp;and&nbsp;depends&nbsp;on&nbsp;device&nbsp;performance&nbsp;characteristics.&nbsp;I&nbsp;tried&nbsp;the&nbsp;following&nbsp;experiment&nbsp;to&nbsp;estimate&nbsp;how&nbsp;much&nbsp;time&nbsp;could&nbsp;be&nbsp;taken&nbsp;by&nbsp;synchronous&nbsp;cold&nbsp;reads&nbsp;of&nbsp;a&nbsp;moderate&nbsp;number&nbsp;of&nbsp;files&nbsp;(assuming&nbsp;multi-file&nbsp;support&nbsp;in&nbsp;&amp;lt;input&nbsp;type=&quot;file&quot;&amp;gt;&nbsp;and&nbsp;naiive&nbsp;use&nbsp;of&nbsp;the&nbsp;synchronous&nbsp;read&nbsp;API):&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;$&nbsp;time&nbsp;cat&nbsp;~/Pictures/*.jpg&nbsp;&amp;gt;&nbsp;/dev/null&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;real&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;0m1.135s&lt;/div&gt;&lt;div&gt;user&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;0m0.007s&lt;/div&gt;&lt;div&gt;sys&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;0m0.076s&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;on&nbsp;a&nbsp;pretty&nbsp;fast&nbsp;machine&nbsp;with&nbsp;a&nbsp;local&nbsp;filesystem.&nbsp;I&nbsp;have&nbsp;76&nbsp;.jpg&nbsp;files&nbsp;totaling&nbsp;about&nbsp;19M&nbsp;in&nbsp;size.&nbsp;1.13&nbsp;seconds&nbsp;seems&nbsp;like&nbsp;an&nbsp;unacceptable&nbsp;length&nbsp;of&nbsp;time&nbsp;to&nbsp;block&nbsp;the&nbsp;UI,&nbsp;and&nbsp;it&nbsp;could&nbsp;easily&nbsp;be&nbsp;much&nbsp;worse&nbsp;for,&nbsp;say,&nbsp;a&nbsp;batch&nbsp;photo&nbsp;upload&nbsp;or&nbsp;an&nbsp;upload&nbsp;of&nbsp;a&nbsp;moderately&nbsp;large&nbsp;video&nbsp;file.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;I&nbsp;suspect&nbsp;that,&nbsp;much&nbsp;like&nbsp;synchronous&nbsp;XMLHttpRequest,&nbsp;synchronous&nbsp;file&nbsp;reads&nbsp;will&nbsp;lead&nbsp;to&nbsp;excessive&nbsp;UI&nbsp;lockups&nbsp;in&nbsp;bad&nbsp;circumstances&nbsp;unanticipated&nbsp;by&nbsp;the&nbsp;app&nbsp;author.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Also,&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;how&nbsp;a&nbsp;web&nbsp;app&nbsp;can&nbsp;be&nbsp;expected&nbsp;to&nbsp;know&nbsp;the&nbsp;encoding&lt;br&gt;of&nbsp;a&nbsp;text&nbsp;file&nbsp;on&nbsp;disk.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;The&nbsp;same&nbsp;way&nbsp;that&nbsp;any&nbsp;other&nbsp;app&nbsp;does&nbsp;---&nbsp;guess&nbsp;based&nbsp;on&nbsp;the&nbsp;extension&nbsp;and&nbsp;expected&nbsp;usage?&nbsp;---&nbsp;now&nbsp;that&nbsp;we've&nbsp;all&nbsp;standardized&nbsp;on&nbsp;meta-data-less&nbsp;file&nbsp;systems&nbsp;:-(.&nbsp;I&nbsp;suppose&nbsp;an&nbsp;app&nbsp;could&nbsp;examine&nbsp;the&nbsp;first&nbsp;chunk&nbsp;of&nbsp;the&nbsp;file&nbsp;and&nbsp;then&nbsp;re-read&nbsp;the&nbsp;file&nbsp;with&nbsp;a&nbsp;better&nbsp;guess.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;The&nbsp;OS&nbsp;and&nbsp;the&nbsp;UA&nbsp;can&nbsp;often&nbsp;make&nbsp;a&nbsp;better&nbsp;guess,&nbsp;so&nbsp;I&nbsp;think&nbsp;the&nbsp;option&nbsp;to&nbsp;let&nbsp;the&nbsp;UA&nbsp;decide&nbsp;the&nbsp;encoding&nbsp;should&nbsp;at&nbsp;least&nbsp;be&nbsp;provided.&nbsp;Here&nbsp;are&nbsp;some&nbsp;sources&nbsp;of&nbsp;info&nbsp;that&nbsp;the&nbsp;UA&nbsp;has&nbsp;but&nbsp;the&nbsp;web&nbsp;app&nbsp;doesn't&nbsp;(at&nbsp;least&nbsp;without&nbsp;doing&nbsp;a&nbsp;separate&nbsp;binary&nbsp;read&nbsp;of&nbsp;the&nbsp;file&nbsp;first&nbsp;and&nbsp;possibly&nbsp;significant&nbsp;computation):&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;1)&nbsp;OS-level&nbsp;metadata,&nbsp;as&nbsp;for&nbsp;example&nbsp;in&nbsp;Mac&nbsp;OS&nbsp;X:&lt;/div&gt;&lt;div&gt;$&nbsp;xattr&nbsp;-l&nbsp;plan.txt&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;div&gt;com.apple.TextEncoding:&nbsp;UTF-8;134217984&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;2)&nbsp;Checking&nbsp;for&nbsp;a&nbsp;BOM.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;3)&nbsp;Heuristics&nbsp;for&nbsp;specific&nbsp;file&nbsp;types,&nbsp;like&nbsp;looking&nbsp;for&nbsp;&amp;lt;meta&nbsp;charset&amp;gt;&nbsp;in&nbsp;HTML&nbsp;files&nbsp;or&nbsp;the&nbsp;encoding&nbsp;pseudo-attribute&nbsp;in&nbsp;an&nbsp;XML&nbsp;declaration.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;4)&nbsp;General&nbsp;character&nbsp;set&nbsp;autodetection&nbsp;algorithms&nbsp;through&nbsp;statistical&nbsp;methods&nbsp;or&nbsp;similar.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;5)&nbsp;Knowledge&nbsp;of&nbsp;the&nbsp;user's&nbsp;locale&nbsp;(useful&nbsp;for&nbsp;some&nbsp;legacy&nbsp;systems&nbsp;where&nbsp;default&nbsp;text&nbsp;encoding&nbsp;is&nbsp;determined&nbsp;by&nbsp;locale).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;6)&nbsp;Knowledge&nbsp;of&nbsp;platform&nbsp;encoding&nbsp;conventions.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Maciej&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
