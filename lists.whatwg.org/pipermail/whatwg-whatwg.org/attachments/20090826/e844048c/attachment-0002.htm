<tt>
My&nbsp;recollection&nbsp;is&nbsp;that&nbsp;we&nbsp;prohibit&nbsp;worker&nbsp;access&nbsp;to&nbsp;cookies&nbsp;for&nbsp;exactly&nbsp;this&nbsp;reason&nbsp;(WorkerGlobalScope&nbsp;does&nbsp;not&nbsp;expose&nbsp;a&nbsp;&quot;cookies&quot;&nbsp;attribute).&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-atw&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Aug&nbsp;26,&nbsp;2009&nbsp;at&nbsp;2:05&nbsp;PM,&nbsp;Jens&nbsp;Alfke&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:snej@google.com&quot;&gt;snej@google.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;I&nbsp;know&nbsp;that&nbsp;one&nbsp;of&nbsp;the&nbsp;design&nbsp;issues&nbsp;with&nbsp;worker&nbsp;threads&nbsp;and&nbsp;local&nbsp;storage&nbsp;has&nbsp;been&nbsp;how&nbsp;to&nbsp;resolve&nbsp;concurrency&nbsp;issues,&nbsp;and&nbsp;that&nbsp;for&nbsp;this&nbsp;reason,&nbsp;in&nbsp;the&nbsp;current&nbsp;spec&nbsp;worker&nbsp;threads&nbsp;can&#39;t&nbsp;access&nbsp;local&nbsp;storage.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;there&#39;s&nbsp;a&nbsp;scenario&nbsp;under&nbsp;the&nbsp;current&nbsp;spec&nbsp;that&nbsp;&lt;i&gt;doesn&#39;t&lt;/i&gt;&nbsp;involve&nbsp;local&nbsp;storage,&nbsp;whereby&nbsp;a&nbsp;worker&nbsp;thread&nbsp;can&nbsp;deadlock&nbsp;the&nbsp;browser.&nbsp;This&nbsp;is&nbsp;because&nbsp;access&nbsp;to&nbsp;cookies,&nbsp;by&nbsp;workers&nbsp;or&nbsp;the&nbsp;browser&nbsp;itself,&nbsp;is&nbsp;also&nbsp;subject&nbsp;to&nbsp;that&nbsp;global&nbsp;mutex.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Consider&nbsp;these&nbsp;steps:&lt;/div&gt;&lt;div&gt;1.&nbsp;A&nbsp;worker&nbsp;thread&nbsp;accesses&nbsp;&quot;document.cookie&quot;.&nbsp;This&nbsp;causes&nbsp;it&nbsp;to&nbsp;acquire&nbsp;the&nbsp;mutex&nbsp;(sec.&nbsp;3.1.3).&lt;/div&gt;&lt;div&gt;2.&nbsp;The&nbsp;thread&nbsp;now&nbsp;performs&nbsp;some&nbsp;long-lasting&nbsp;operation&nbsp;without&nbsp;exiting.&nbsp;In&nbsp;the&nbsp;simplest&nbsp;case&nbsp;it&nbsp;just&nbsp;goes&nbsp;into&nbsp;an&nbsp;infinite&nbsp;loop.&lt;/div&gt;<br>
&lt;div&gt;3.&nbsp;Meanwhile,&nbsp;the&nbsp;user&nbsp;loads&nbsp;a&nbsp;new&nbsp;web&nbsp;page&nbsp;in&nbsp;the&nbsp;browser.&lt;/div&gt;&lt;div&gt;4.&nbsp;The&nbsp;resulting&nbsp;HTTP&nbsp;response&nbsp;contains&nbsp;a&nbsp;Cookie:&nbsp;header.&nbsp;The&nbsp;spec&nbsp;requires&nbsp;that&nbsp;the&nbsp;browser&#39;s&nbsp;loader temporarily&nbsp;acquire&nbsp;the&nbsp;mutex&nbsp;while&nbsp;updating&nbsp;the&nbsp;cookie&nbsp;(sec.&nbsp;2.6,&nbsp;item&nbsp;4).&lt;/div&gt;<br>
&lt;div&gt;5.&nbsp;The&nbsp;page-load&nbsp;blocks&nbsp;indefinitely&nbsp;because&nbsp;the&nbsp;worker&nbsp;thread&nbsp;still&nbsp;has&nbsp;the&nbsp;mutex&nbsp;and&nbsp;never&nbsp;lets&nbsp;go&nbsp;of&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;result&nbsp;is&nbsp;that&nbsp;the&nbsp;browser&nbsp;becomes&nbsp;incapable&nbsp;of&nbsp;loading&nbsp;any&nbsp;web&nbsp;pages&nbsp;that&nbsp;use&nbsp;cookies.&nbsp;Assuming&nbsp;the&nbsp;worker&nbsp;thread&nbsp;never&nbsp;exits,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;recover&nbsp;from&nbsp;this&nbsp;is&nbsp;to&nbsp;quit&nbsp;the&nbsp;browser.&nbsp;A&nbsp;worker&nbsp;thread&nbsp;like&nbsp;this&nbsp;could&nbsp;very&nbsp;easily&nbsp;be&nbsp;created&nbsp;by&nbsp;a&nbsp;malicious&nbsp;website,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;DoS&nbsp;attack&nbsp;on&nbsp;the&nbsp;browser.&nbsp;And&nbsp;of&nbsp;course,&nbsp;a&nbsp;merely&nbsp;poorly-written&nbsp;script&nbsp;could&nbsp;create&nbsp;the&nbsp;same&nbsp;effect&nbsp;without&nbsp;intending&nbsp;to.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;honestly&nbsp;can&#39;t&nbsp;think&nbsp;of&nbsp;any&nbsp;safe&nbsp;way&nbsp;of&nbsp;tweaking&nbsp;the&nbsp;semantics&nbsp;of&nbsp;the&nbsp;existing&nbsp;&#39;document.cookie&#39;&nbsp;API&nbsp;to&nbsp;make&nbsp;it&nbsp;transactional.&nbsp;:(&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Has&nbsp;anyone&nbsp;implemented&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;spec&nbsp;yet?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;—Jens&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
