<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Request: window.postMessage should be async
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Request%3A%20window.postMessage%20should%20be%20async&In-Reply-To=%3C278fd46c0804060214h7d75c1bbq418d81dba1109c93%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="056614.html">
   <LINK REL="Next"  HREF="056616.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Request: window.postMessage should be async</H1>
<!--htdig_noindex-->
    <B>Aaron Boodman</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Request%3A%20window.postMessage%20should%20be%20async&In-Reply-To=%3C278fd46c0804060214h7d75c1bbq418d81dba1109c93%40mail.gmail.com%3E"
       TITLE="[whatwg] Request: window.postMessage should be async">aa at google.com
       </A><BR>
    <I>Sun Apr  6 02:14:00 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="056614.html">[whatwg] Request: window.postMessage should be async
</A></li>
        <LI>Next message: <A HREF="056616.html">[whatwg] Request: window.postMessage should be async
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56615">[ date ]</a>
              <a href="thread.html#56615">[ thread ]</a>
              <a href="subject.html#56615">[ subject ]</a>
              <a href="author.html#56615">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Sun, Apr 6, 2008 at 1:52 AM, Aaron Boodman &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">aa at google.com</A>&gt; wrote:
&gt;<i>  There doesn't seem to be any advantage to it.
</I>
I take it back, there is one advantage, which Jeff brought up:

&gt;<i> &gt; function realMessageHandler(messageEvent) {
</I>&gt;<i> &gt;  // handle the message...
</I>&gt;<i> &gt;  // and, reply to the message
</I>&gt;<i> &gt;  messageEvent.source.postMessage(&quot;response message&quot;);
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>  Furthermore, note that the above behavior is actually *insecure* if the
</I>&gt;<i> handler authenticates the sender and discloses some secret in his response,
</I>&gt;<i> because |messageEvent.source| may have been navigated to a different origin.
</I>&gt;<i> Making the API async basically requires the optional origin argument always
</I>&gt;<i> be provided to postMessage, adding API complexity.  If a piece of
</I>&gt;<i> information doesn't have to be [present] for the system to [usually] work,
</I>&gt;<i> sooner or later it won't be [and the system won't work].[1]
</I>
But I think the fact that messageEvent.source can be navigated and
still be the &quot;source&quot; is real issue here. To me, messages sent to
messageEvent.source after it has been unloaded should throw. I realize
this means that it cannot be the same object as is accessible via
window.frames[], but that seems OK to me. Actually, that is exactly
what hixie's messages proposal [1] does in this case.

That would address the only reason I've seen for making this API
synchronous, and it would also eliminate the need for authors to pass
origin when replying to messages received via sendMessage.

- a

1. <A HREF="http://hixie.ch/specs/dom/messages/0.9">http://hixie.ch/specs/dom/messages/0.9</A>

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="056614.html">[whatwg] Request: window.postMessage should be async
</A></li>
	<LI>Next message: <A HREF="056616.html">[whatwg] Request: window.postMessage should be async
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56615">[ date ]</a>
              <a href="thread.html#56615">[ thread ]</a>
              <a href="subject.html#56615">[ subject ]</a>
              <a href="author.html#56615">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
