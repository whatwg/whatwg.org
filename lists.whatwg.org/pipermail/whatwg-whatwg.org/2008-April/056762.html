<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] postMessage() issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20postMessage%28%29%20issues&In-Reply-To=%3C480CD80D.4090506%40sicking.cc%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="056716.html">
   <LINK REL="Next"  HREF="056692.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] postMessage() issues</H1>
<!--htdig_noindex-->
    <B>Jonas Sicking</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20postMessage%28%29%20issues&In-Reply-To=%3C480CD80D.4090506%40sicking.cc%3E"
       TITLE="[whatwg] postMessage() issues">jonas at sicking.cc
       </A><BR>
    <I>Mon Apr 21 11:08:13 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="056716.html">[whatwg] postMessage() issues
</A></li>
        <LI>Next message: <A HREF="056692.html">[whatwg] Question about the PICS label in HTML5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56762">[ date ]</a>
              <a href="thread.html#56762">[ thread ]</a>
              <a href="subject.html#56762">[ subject ]</a>
              <a href="author.html#56762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Aaron Boodman wrote:
&gt;<i> On Wed, Apr 16, 2008 at 3:17 PM, Jonas Sicking &lt;<A HREF="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">jonas at sicking.cc</A>&gt; wrote:
</I>&gt;&gt;<i> Maciej Stachowiak wrote:
</I>&gt;&gt;&gt;<i> - Processing a reply synchronously is awkward in any case, since you need
</I>&gt;&gt;&gt;<i> a callback.
</I>&gt;&gt;<i> I'm not sure I follow this argument, I actually come to the opposite
</I>&gt;&gt;<i> conclusion.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Say that a page is communicating with multiple iframes using
</I>&gt;&gt;<i> postMessage, and expect replies from all of them.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If postMessage is synchronous it is easy to associate a given &quot;reply&quot;
</I>&gt;&gt;<i> with a given postMessage call, it's simply the reply you get between the
</I>&gt;&gt;<i> time you make the postMessage call and when it returns. So you could install
</I>&gt;&gt;<i> a generic listener for the message event and let the listener set a global
</I>&gt;&gt;<i> variable. Then you just do a postMessage and pick up the reply from the
</I>&gt;&gt;<i> global variable.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If postMessage is asynchronous you need to agree on using some identifier in
</I>&gt;&gt;<i> the messages, or you have to use the pipes mechanism for all communication.
</I>&gt;&gt;<i> Granted, with javascript generators you can almost get the same behavior as
</I>&gt;&gt;<i> for synchronous calling, but that is non-trivial.
</I>&gt;<i> 
</I>&gt;<i> This is a really good argument. FWIW, I had not considered the case of
</I>&gt;<i> coordinating between multiple iframes. That does make the async
</I>&gt;<i> version significantly more complex.
</I>&gt;<i> 
</I>&gt;<i> IMO, the tradeoff is still worth it, though. And in the future, with
</I>&gt;<i> something like Hixie's messaging proposal, this problem will go away
</I>&gt;<i> (because you'll have stateful objects that represent a conversation).
</I>
That's still somewhat painful when you are sending multiple messages 
back and forth since you have to stow away state and resume where you 
were which can be a big hassle.

Certainly not impossible to deal with for a developer, but more complicated.

&gt;&gt;<i> So one thing I should note first of all is that the implementation that
</I>&gt;&gt;<i> is currently in the Firefox 3 betas are synchronous. It is unlikely that
</I>&gt;&gt;<i> we can get this changed by final shipping since we are more or less in
</I>&gt;&gt;<i> code freeze already.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Of course, we implemented this knowing that it's part of HTML5 which is
</I>&gt;&gt;<i> nowhere near complete, so obviously we were aware that it might change.
</I>&gt;&gt;<i> However it might mean that developers will have to put in workarounds in
</I>&gt;&gt;<i> order to support the FF3 release :(
</I>&gt;<i> 
</I>&gt;<i> What about if we just left the sync/async-ness unspecified for the
</I>&gt;<i> first version of postMessage. In practice this means that
</I>&gt;<i> implementations might be incompatible, but I don't the workarounds are
</I>&gt;<i> that big a deal. Authors have this problem already today with XHR in
</I>&gt;<i> certain edge cases (sometimes onreadystatechange is not asynchronous)?
</I>&gt;<i> 
</I>&gt;<i> In the future, when the messaging proposal evolves, we tighten it down
</I>&gt;<i> and make it async.
</I>
I think that's a really bad idea. Async vs. sync has a huge impact on 
how to use the API, it's very likely that anyone using the API will 
break if the implementation changes either way on this. So basically 
there is very little advantage over specifying nothing at all.

/ Jonas

</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="056716.html">[whatwg] postMessage() issues
</A></li>
	<LI>Next message: <A HREF="056692.html">[whatwg] Question about the PICS label in HTML5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56762">[ date ]</a>
              <a href="thread.html#56762">[ thread ]</a>
              <a href="subject.html#56762">[ subject ]</a>
              <a href="author.html#56762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
