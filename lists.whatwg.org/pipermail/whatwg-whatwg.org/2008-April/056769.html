<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] Minor event-source (SSE) modification
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Minor%20event-source%20%28SSE%29%20modification&In-Reply-To=%3C24f9a1ba0804211610l6bde41ddkc364043df72142d6%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="056855.html">
   <LINK REL="Next"  HREF="056792.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] Minor event-source (SSE) modification</H1>
<!--htdig_noindex-->
    <B>Michael Carter</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20Minor%20event-source%20%28SSE%29%20modification&In-Reply-To=%3C24f9a1ba0804211610l6bde41ddkc364043df72142d6%40mail.gmail.com%3E"
       TITLE="[whatwg] Minor event-source (SSE) modification">michael.carter at kaazing.com
       </A><BR>
    <I>Mon Apr 21 16:10:49 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="056855.html">[whatwg] Footnotes, end notes, side notes
</A></li>
        <LI>Next message: <A HREF="056792.html">[whatwg] Minor event-source (SSE) modification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56769">[ date ]</a>
              <a href="thread.html#56769">[ thread ]</a>
              <a href="subject.html#56769">[ subject ]</a>
              <a href="author.html#56769">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>We're using SSE as a reliable Server -&gt; Browser streaming mechanism where
the server maintains a message queue per user connection. The server needs
to buffer all messages until it receives an acknowledgment for a given
message (ACK). The server sometimes needs to indicate to the Browser that
the message queue has become too large and the browser should send an ACK as
soon as possible. One way the server can indicate that it needs an ACK is to
end the HTTP Response causing the event-source stream to automatically
reconnect with the &quot;Last-Event-ID&quot; header. We call this an &quot;in-band ACK&quot;,
where the server sends a &quot;request for ACK&quot; by ending the HTTP response
(using transfer-encoding chunked and sending the 0 chunk, for instance.)

Normally, a message's latency is  the time it takes to travel from the
server to the browser, or one leg. For in band ACKing, it takes 3 legs to
deliver the next message after an ACK request: 1) Server -&gt; Browser (end of
response), 2) Browser -&gt; Server (new request), 3) Server -&gt; Browser (next
message). A solution to this problem is to make a second concurrent http
request that represents the ACK; this we call an &quot;out-of-band ACK&quot;.

Unfortunately, the current Server-sent Events specification provides no way
for a user of the event-source API to know the value of the lastEventId,
thus making it impossible to send an ACK out-of-band. We have two proposals,
either of which can solve this problem.

1) Expose the id attribute on each dispatched event. This allows us to send
out-of-band ACKs as required. The downside is that we would need to extend
the MessageEvent interface.

2) Expose an add/remove EventListener on the event-source dom element that
dispatches whenever the last event id for an event source is changed. The
event generated by a change in the last event id would have that id value as
an attribute, as well as the href for the event source associated with the
id.

We prefer the first solution, but any solution would be good. Any
suggestions for a better solution?


-Michael Carter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20080421/82c16f04/attachment-0001.htm">http://lists.whatwg.org/pipermail/whatwg-whatwg.org/attachments/20080421/82c16f04/attachment-0001.htm</A>&gt;
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="056855.html">[whatwg] Footnotes, end notes, side notes
</A></li>
	<LI>Next message: <A HREF="056792.html">[whatwg] Minor event-source (SSE) modification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56769">[ date ]</a>
              <a href="thread.html#56769">[ thread ]</a>
              <a href="subject.html#56769">[ subject ]</a>
              <a href="author.html#56769">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
