<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [whatwg] beforepopstate event?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20beforepopstate%20event%3F&In-Reply-To=%3CPine.LNX.4.64.1206062342290.378%40ps20323.dreamhostps.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036292.html">
   <LINK REL="Next"  HREF="036294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[whatwg] beforepopstate event?</H1>
<!--htdig_noindex-->
    <B>Ian Hickson</B> 
    <A HREF="mailto:whatwg%40lists.whatwg.org?Subject=Re%3A%20%5Bwhatwg%5D%20beforepopstate%20event%3F&In-Reply-To=%3CPine.LNX.4.64.1206062342290.378%40ps20323.dreamhostps.com%3E"
       TITLE="[whatwg] beforepopstate event?">ian at hixie.ch
       </A><BR>
    <I>Wed Jun  6 16:45:12 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="036292.html">[whatwg] Cut and paste (and related) events' futures
</A></li>
        <LI>Next message: <A HREF="036294.html">[whatwg] HTMLLinkElement.disabled and HTMLLinkElement.sheet behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36293">[ date ]</a>
              <a href="thread.html#36293">[ thread ]</a>
              <a href="subject.html#36293">[ subject ]</a>
              <a href="author.html#36293">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>On Fri, 27 Jan 2012, Thomas Broyer wrote:
&gt;<i> 
</I>&gt;<i> A common use case for beforeunload is to prompt the user before leaving 
</I>&gt;<i> when it has unsaved changes. For instance, you edited a mail draft, 
</I>&gt;<i> updated the phone number of a contact, or filled any kind of form, but 
</I>&gt;<i> you didn't save your changes; when you &quot;navigate away&quot;, beforeunload can 
</I>&gt;<i> be used to prompt you whether you really want to go (and lose your 
</I>&gt;<i> changes).
</I>&gt;<i> 
</I>&gt;<i> Within a &quot;single-page app&quot;, where you use location.hash=xxx and
</I>&gt;<i> hashchange, or pushState() and popstate, to handle the navigation,
</I>&gt;<i> there doesn't seem to be any way to prompt the user and possibly
</I>&gt;<i> *cancel* the navigation. Something like:
</I>&gt;<i> 1. you're looking at your mail inbox, and click on &quot;new mail&quot;
</I>&gt;<i> 2. you type in some text
</I>&gt;<i> 3. you click on the &quot;previous page&quot; button of your browser, or trigger
</I>&gt;<i> an equivalent action using a keyboard shortcut (possibly mistakenly)
</I>&gt;<i> As the app developer, I'd like to be able to prompt the user whether
</I>&gt;<i> he really want to go (and lose his changes), and if he actually wants
</I>&gt;<i> to continue editing his mail draft (and/or save it before navigating
</I>&gt;<i> again), then *cancel* the &quot;history traversal&quot;; in a similar way as if
</I>&gt;<i> I developed a &quot;multi-page app&quot; (or if he'd close the window/tab or
</I>&gt;<i> navigate away from the app): I could then do that using the
</I>&gt;<i> beforeunload event, either cancelling it or setting its returnValue to
</I>&gt;<i> some non-empty string value.
</I>
Ah, yeah. This isn't supported. I would recommend just making the app not
discard the state, so it becomes a non-issue. They hit back, and the 
message is saved to drafts and can be obtained again by going forward. You 
can put up a message saying that the draft will be discarded in five 
minutes or some such, if the ideal model is for the data to be lost.

The reason onbeforeunload makes sense is that there's no way to do 
anything once the page is unloaded. But that doesn't apply here, where the 
same code is still running.


&gt;<i> Unless I missed something, all I can do is to handle the hashchange or
</I>&gt;<i> popstate event and use Window.confirm() or similar, and only update
</I>&gt;<i> the page from the location.hash or history.state if he confirms; but
</I>&gt;<i> then navigation has already taken place, I cannot cancel the
</I>&gt;<i> navigation but only &quot;ignore&quot; it.
</I>
Well, you can always just do history.forward() or whatever, to go back to 
the previous state. :-)

-- 
Ian Hickson               U+1047E                )\._.,--....,'``.    fL
<A HREF="http://ln.hixie.ch/">http://ln.hixie.ch/</A>       U+263A                /,   _.. \   _\  ;`._ ,.
Things that are impossible just take longer.   `._.-(,_..'--(,_..'`-.;.'
</PRE>



































<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036292.html">[whatwg] Cut and paste (and related) events' futures
</A></li>
	<LI>Next message: <A HREF="036294.html">[whatwg] HTMLLinkElement.disabled and HTMLLinkElement.sheet behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36293">[ date ]</a>
              <a href="thread.html#36293">[ thread ]</a>
              <a href="subject.html#36293">[ subject ]</a>
              <a href="author.html#36293">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.whatwg.org/listinfo.cgi/whatwg-whatwg.org">More information about the whatwg
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
