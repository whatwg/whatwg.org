<!DOCTYPE html>
<!DOCTYPE html><html class="split chapter" lang="en-US-x-hixie"><title>9.2.4 Tokenization &mdash; HTML5</title><link href="/style/specification" rel="stylesheet"><link href="/images/icon" rel="icon"><style>
   .proposal { border: blue solid; padding: 1em; }
   .bad, .bad *:not(.XXX) { color: gray; border-color: gray; background: transparent; }
   #updatesStatus { display: none; }
   #updatesStatus.relevant { display: block; position: fixed; right: 1em; top: 1em; padding: 0.5em; font: bold small sans-serif; min-width: 25em; width: 30%; max-width: 40em; height: auto; border: ridge 4px gray; background: #EEEEEE; color: black; }
   div.head .logo { width: 11em; margin-bottom: 20em; }
   #configUI { position: absolute; z-index: 20; top: 10em; right: 1em; width: 11em; font-size: small; }
   #configUI p { margin: 0.5em 0; padding: 0.3em; background: #EEEEEE; color: black; border: inset thin; }
   #configUI p label { display: block; }
   #configUI #updateUI, #configUI .loginUI { text-align: center; }
   #configUI input[type=button] { display: block; margin: auto; }
   #reviewer { position: fixed; bottom: 0; right: 0; white-space: nowrap; border: thin; border-style: inset none none inset; background: #EEEEEE; color: black; overflow: hidden; z-index: 30; }
   #reviewer * { font-size: small; }
   #reviewer.off > :not(:first-child) { display: none; }
   @media print { #configUI { display: none; } }
   .rfc2119 { font-variant: small-caps; text-shadow: 0 0 0.5em yellow; position: static; }
   .rfc2119::after { position: absolute; left: 0; width: 25px; text-align: center; color: yellow; text-shadow: 0.075em 0.075em 0.2em black; }
   .rfc2119.m\ust::after { content: '\2605'; }
   .rfc2119.s\hould::after { content: '\2606'; }
   [hidden] { display: none; }
  </style><style type="text/css">

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies tbody th { whitespace: nowrap; }
   .applies td { text-align: center; }
   .applies .yes { background: yellow; }

   .matrix, .matrix td { border: none; text-align: right; }
   .matrix { margin-left: 2em; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

  </style><link href="data:text/css," id="complete" rel="stylesheet" title="Complete specification"><link href="data:text/css,.impl%20{%20display:%20none;%20}" id="author" rel="alternate stylesheet" title="Author documentation only"><link href="data:text/css,.impl%20{%20background:%20%23FFEEEE;%20}" id="highlight" rel="alternate stylesheet" title="Highlight implementation requirements"><script>
   var loadTimer = new Date();
   var current_revision = "r" + "$Revision: 4372 $".substr(11);
   current_revision = current_revision.substr(0, current_revision.length - 2);
   var last_known_revision = current_revision;
   function getCookie(name) {
     var params = location.search.substr(1).split("&");
     for (var index = 0; index < params.length; index++) {
       if (params[index] == name)
         return "1";
       var data = params[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     var cookies = document.cookie.split("; ");
     for (var index = 0; index < cookies.length; index++) {
       var data = cookies[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     return null;
   }
   function load(script) {
     var e = document.createElement('script');
     e.setAttribute('src', script);
     document.body.appendChild(e);
   }
   function init() {
     if (location.search == '?slow-browser')
       return;
     var configUI = document.createElement('div');
     configUI.id = 'configUI';
     document.body.appendChild(configUI);
     if (document.documentElement.className == "" || document.documentElement.className == "split index")
       load('toc.js');
     load('styler.js');
     if (document.documentElement.className == "")
       load('dfn.js');
     if (getCookie('profile') == '1')
       document.getElementsByTagName('h2')[0].textContent += '; load: ' + (new Date() - loadTimer) + 'ms';
   }
  </script>
  <script src="link-fixup.js"></script>
  <link href="parsing.html" rel="prev" title="9.2 Parsing HTML documents">
  <link href="index.html#contents" rel="index" title="Table of contents">
  <link href="the-end.html" rel="next" title="9.2.6 The end">
  <body class="cfc" onload="fixBrokenLink(); init()">
  <style scoped>
   * { color: gray ! important; background: none ! important; border-color: silver ! important; }
   img, object, iframe { filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); -webkit-filter: grayscale(100%); }
   .obsolete { border: double thick red ! important; background: yellow ! important; margin: 4em auto 0 auto; max-width: 50em; width: 70%; text-align: center; position: fixed;  z-index: 10000; top: 0; left: 0; right: 0; }
   .obsolete a { color: blue ! important; }
   .obsolete p { font: 900 2em sans-serif; color: red ! important; margin: 1em 1.5em ! important; }
  </style>
  <div class=obsolete>
   <p>This is a snapshot of an early working draft and has therefore
   been superseded by the <a href="http://whatwg.org/html">HTML
   standard</a>.</p>
   <p>This document will not be further updated.</p>
  </div>
<header class="head"><p><a class="logo" href="http://www.whatwg.org/" rel="home"><img alt="WHATWG" src="/images/logo"></a></p>
   <hgroup><h1>HTML5</h1>
    <h2 class="no-num no-toc">Draft Standard &mdash; Call For Comments &mdash; 27 October 2009</h2>
   </hgroup></header><nav>
   <a href="parsing.html">&larr; 9.2 Parsing HTML documents</a> &ndash;
   <a href="index.html#contents">Table of contents</a> &ndash;
   <a href="the-end.html">9.2.6 The end &rarr;</a>
  <ol class="toc"><li><ol><li><ol><li><a href="tokenization.html#tokenization"><span class="secno">9.2.4 </span>Tokenization</a>
      <ol><li><a href="tokenization.html#data-state"><span class="secno">9.2.4.1 </span>Data state</a><li><a href="tokenization.html#character-reference-in-data-state"><span class="secno">9.2.4.2 </span>Character reference in data state</a><li><a href="tokenization.html#rcdata-state"><span class="secno">9.2.4.3 </span>RCDATA state</a><li><a href="tokenization.html#character-reference-in-rcdata-state"><span class="secno">9.2.4.4 </span>Character reference in RCDATA state</a><li><a href="tokenization.html#rawtext-state"><span class="secno">9.2.4.5 </span>RAWTEXT state</a><li><a href="tokenization.html#script-data-state"><span class="secno">9.2.4.6 </span>Script data state</a><li><a href="tokenization.html#plaintext-state"><span class="secno">9.2.4.7 </span>PLAINTEXT state</a><li><a href="tokenization.html#tag-open-state"><span class="secno">9.2.4.8 </span>Tag open state</a><li><a href="tokenization.html#close-tag-open-state"><span class="secno">9.2.4.9 </span>Close tag open state</a><li><a href="tokenization.html#tag-name-state"><span class="secno">9.2.4.10 </span>Tag name state</a><li><a href="tokenization.html#rcdata-less-than-sign-state"><span class="secno">9.2.4.11 </span>RCDATA less-than sign state</a><li><a href="tokenization.html#rcdata-end-tag-open-state"><span class="secno">9.2.4.12 </span>RCDATA end tag open state</a><li><a href="tokenization.html#rcdata-end-tag-name-state"><span class="secno">9.2.4.13 </span>RCDATA end tag name state</a><li><a href="tokenization.html#rawtext-less-than-sign-state"><span class="secno">9.2.4.14 </span>RAWTEXT less-than sign state</a><li><a href="tokenization.html#rawtext-end-tag-open-state"><span class="secno">9.2.4.15 </span>RAWTEXT end tag open state</a><li><a href="tokenization.html#rawtext-end-tag-name-state"><span class="secno">9.2.4.16 </span>RAWTEXT end tag name state</a><li><a href="tokenization.html#script-data-less-than-sign-state"><span class="secno">9.2.4.17 </span>Script data less-than sign state</a><li><a href="tokenization.html#script-data-end-tag-open-state"><span class="secno">9.2.4.18 </span>Script data end tag open state</a><li><a href="tokenization.html#script-data-end-tag-name-state"><span class="secno">9.2.4.19 </span>Script data end tag name state</a><li><a href="tokenization.html#script-data-escape-start-state"><span class="secno">9.2.4.20 </span>Script data escape start state</a><li><a href="tokenization.html#script-data-escape-start-dash-state"><span class="secno">9.2.4.21 </span>Script data escape start dash state</a><li><a href="tokenization.html#script-data-escaped-state"><span class="secno">9.2.4.22 </span>Script data escaped state</a><li><a href="tokenization.html#script-data-escaped-dash-state"><span class="secno">9.2.4.23 </span>Script data escaped dash state</a><li><a href="tokenization.html#script-data-escaped-dash-dash-state"><span class="secno">9.2.4.24 </span>Script data escaped dash dash state</a><li><a href="tokenization.html#script-data-escaped-less-than-sign-state"><span class="secno">9.2.4.25 </span>Script data escaped less-than sign state</a><li><a href="tokenization.html#script-data-escaped-end-tag-open-state"><span class="secno">9.2.4.26 </span>Script data escaped end tag open state</a><li><a href="tokenization.html#script-data-escaped-end-tag-name-state"><span class="secno">9.2.4.27 </span>Script data escaped end tag name state</a><li><a href="tokenization.html#script-data-double-escape-start-state"><span class="secno">9.2.4.28 </span>Script data double escape start state</a><li><a href="tokenization.html#script-data-double-escaped-state"><span class="secno">9.2.4.29 </span>Script data double escaped state</a><li><a href="tokenization.html#script-data-double-escaped-dash-state"><span class="secno">9.2.4.30 </span>Script data double escaped dash state</a><li><a href="tokenization.html#script-data-double-escaped-dash-dash-state"><span class="secno">9.2.4.31 </span>Script data double escaped dash dash state</a><li><a href="tokenization.html#script-data-double-escaped-less-than-sign-state"><span class="secno">9.2.4.32 </span>Script data double escaped less-than sign state</a><li><a href="tokenization.html#script-data-double-escape-end-state"><span class="secno">9.2.4.33 </span>Script data double escape end state</a><li><a href="tokenization.html#before-attribute-name-state"><span class="secno">9.2.4.34 </span>Before attribute name state</a><li><a href="tokenization.html#attribute-name-state"><span class="secno">9.2.4.35 </span>Attribute name state</a><li><a href="tokenization.html#after-attribute-name-state"><span class="secno">9.2.4.36 </span>After attribute name state</a><li><a href="tokenization.html#before-attribute-value-state"><span class="secno">9.2.4.37 </span>Before attribute value state</a><li><a href="tokenization.html#attribute-value-(double-quoted)-state"><span class="secno">9.2.4.38 </span>Attribute value (double-quoted) state</a><li><a href="tokenization.html#attribute-value-(single-quoted)-state"><span class="secno">9.2.4.39 </span>Attribute value (single-quoted) state</a><li><a href="tokenization.html#attribute-value-(unquoted)-state"><span class="secno">9.2.4.40 </span>Attribute value (unquoted) state</a><li><a href="tokenization.html#character-reference-in-attribute-value-state"><span class="secno">9.2.4.41 </span>Character reference in attribute value state</a><li><a href="tokenization.html#after-attribute-value-(quoted)-state"><span class="secno">9.2.4.42 </span>After attribute value (quoted) state</a><li><a href="tokenization.html#self-closing-start-tag-state"><span class="secno">9.2.4.43 </span>Self-closing start tag state</a><li><a href="tokenization.html#bogus-comment-state"><span class="secno">9.2.4.44 </span>Bogus comment state</a><li><a href="tokenization.html#markup-declaration-open-state"><span class="secno">9.2.4.45 </span>Markup declaration open state</a><li><a href="tokenization.html#comment-start-state"><span class="secno">9.2.4.46 </span>Comment start state</a><li><a href="tokenization.html#comment-start-dash-state"><span class="secno">9.2.4.47 </span>Comment start dash state</a><li><a href="tokenization.html#comment-state"><span class="secno">9.2.4.48 </span>Comment state</a><li><a href="tokenization.html#comment-end-dash-state"><span class="secno">9.2.4.49 </span>Comment end dash state</a><li><a href="tokenization.html#comment-end-state"><span class="secno">9.2.4.50 </span>Comment end state</a><li><a href="tokenization.html#comment-end-bang-state"><span class="secno">9.2.4.51 </span>Comment end bang state</a><li><a href="tokenization.html#comment-end-space-state"><span class="secno">9.2.4.52 </span>Comment end space state</a><li><a href="tokenization.html#doctype-state"><span class="secno">9.2.4.53 </span>DOCTYPE state</a><li><a href="tokenization.html#before-doctype-name-state"><span class="secno">9.2.4.54 </span>Before DOCTYPE name state</a><li><a href="tokenization.html#doctype-name-state"><span class="secno">9.2.4.55 </span>DOCTYPE name state</a><li><a href="tokenization.html#after-doctype-name-state"><span class="secno">9.2.4.56 </span>After DOCTYPE name state</a><li><a href="tokenization.html#after-doctype-public-keyword-state"><span class="secno">9.2.4.57 </span>After DOCTYPE public keyword state</a><li><a href="tokenization.html#before-doctype-public-identifier-state"><span class="secno">9.2.4.58 </span>Before DOCTYPE public identifier state</a><li><a href="tokenization.html#doctype-public-identifier-(double-quoted)-state"><span class="secno">9.2.4.59 </span>DOCTYPE public identifier (double-quoted) state</a><li><a href="tokenization.html#doctype-public-identifier-(single-quoted)-state"><span class="secno">9.2.4.60 </span>DOCTYPE public identifier (single-quoted) state</a><li><a href="tokenization.html#after-doctype-public-identifier-state"><span class="secno">9.2.4.61 </span>After DOCTYPE public identifier state</a><li><a href="tokenization.html#between-doctype-public-and-system-identifiers-state"><span class="secno">9.2.4.62 </span>Between DOCTYPE public and system identifiers state</a><li><a href="tokenization.html#after-doctype-system-keyword-state"><span class="secno">9.2.4.63 </span>After DOCTYPE system keyword state</a><li><a href="tokenization.html#before-doctype-system-identifier-state"><span class="secno">9.2.4.64 </span>Before DOCTYPE system identifier state</a><li><a href="tokenization.html#doctype-system-identifier-(double-quoted)-state"><span class="secno">9.2.4.65 </span>DOCTYPE system identifier (double-quoted) state</a><li><a href="tokenization.html#doctype-system-identifier-(single-quoted)-state"><span class="secno">9.2.4.66 </span>DOCTYPE system identifier (single-quoted) state</a><li><a href="tokenization.html#after-doctype-system-identifier-state"><span class="secno">9.2.4.67 </span>After DOCTYPE system identifier state</a><li><a href="tokenization.html#bogus-doctype-state"><span class="secno">9.2.4.68 </span>Bogus DOCTYPE state</a><li><a href="tokenization.html#cdata-section-state"><span class="secno">9.2.4.69 </span>CDATA section state</a><li><a href="tokenization.html#tokenizing-character-references"><span class="secno">9.2.4.70 </span>Tokenizing character references</a></ol><li><a href="tokenization.html#tree-construction"><span class="secno">9.2.5 </span>Tree construction</a>
      <ol><li><a href="tokenization.html#creating-and-inserting-elements"><span class="secno">9.2.5.1 </span>Creating and inserting elements</a><li><a href="tokenization.html#closing-elements-that-have-implied-end-tags"><span class="secno">9.2.5.2 </span>Closing elements that have implied end tags</a><li><a href="tokenization.html#foster-parenting"><span class="secno">9.2.5.3 </span>Foster parenting</a><li><a href="tokenization.html#the-initial-insertion-mode"><span class="secno">9.2.5.4 </span>The "initial" insertion mode</a><li><a href="tokenization.html#the-before-html-insertion-mode"><span class="secno">9.2.5.5 </span>The "before html" insertion mode</a><li><a href="tokenization.html#the-before-head-insertion-mode"><span class="secno">9.2.5.6 </span>The "before head" insertion mode</a><li><a href="tokenization.html#parsing-main-inhead"><span class="secno">9.2.5.7 </span>The "in head" insertion mode</a><li><a href="tokenization.html#parsing-main-inheadnoscript"><span class="secno">9.2.5.8 </span>The "in head noscript" insertion mode</a><li><a href="tokenization.html#the-after-head-insertion-mode"><span class="secno">9.2.5.9 </span>The "after head" insertion mode</a><li><a href="tokenization.html#parsing-main-inbody"><span class="secno">9.2.5.10 </span>The "in body" insertion mode</a><li><a href="tokenization.html#parsing-main-incdata"><span class="secno">9.2.5.11 </span>The "text" insertion mode</a><li><a href="tokenization.html#parsing-main-intable"><span class="secno">9.2.5.12 </span>The "in table" insertion mode</a><li><a href="tokenization.html#parsing-main-intabletext"><span class="secno">9.2.5.13 </span>The "in table text" insertion mode</a><li><a href="tokenization.html#parsing-main-incaption"><span class="secno">9.2.5.14 </span>The "in caption" insertion mode</a><li><a href="tokenization.html#parsing-main-incolgroup"><span class="secno">9.2.5.15 </span>The "in column group" insertion mode</a><li><a href="tokenization.html#parsing-main-intbody"><span class="secno">9.2.5.16 </span>The "in table body" insertion mode</a><li><a href="tokenization.html#parsing-main-intr"><span class="secno">9.2.5.17 </span>The "in row" insertion mode</a><li><a href="tokenization.html#parsing-main-intd"><span class="secno">9.2.5.18 </span>The "in cell" insertion mode</a><li><a href="tokenization.html#parsing-main-inselect"><span class="secno">9.2.5.19 </span>The "in select" insertion mode</a><li><a href="tokenization.html#parsing-main-inselectintable"><span class="secno">9.2.5.20 </span>The "in select in table" insertion mode</a><li><a href="tokenization.html#parsing-main-inforeign"><span class="secno">9.2.5.21 </span>The "in foreign content" insertion mode</a><li><a href="tokenization.html#parsing-main-afterbody"><span class="secno">9.2.5.22 </span>The "after body" insertion mode</a><li><a href="tokenization.html#parsing-main-inframeset"><span class="secno">9.2.5.23 </span>The "in frameset" insertion mode</a><li><a href="tokenization.html#parsing-main-afterframeset"><span class="secno">9.2.5.24 </span>The "after frameset" insertion mode</a><li><a href="tokenization.html#the-after-after-body-insertion-mode"><span class="secno">9.2.5.25 </span>The "after after body" insertion mode</a><li><a href="tokenization.html#the-after-after-frameset-insertion-mode"><span class="secno">9.2.5.26 </span>The "after after frameset" insertion mode</a></ol></ol></ol></ol></nav>

  <div class="impl">

  <h4 id="tokenization"><span class="secno">9.2.4 </span><dfn>Tokenization</dfn></h4>

  <p>Implementations must act as if they used the following state
  machine to tokenize HTML. The state machine must start in the
  <a href="#data-state">data state</a>. Most states consume a single character,
  which may have various side-effects, and either switches the state
  machine to a new state to <em>reconsume</em> the same character, or
  switches it to a new state (to consume the next character), or
  repeats the same state (to consume the next character). Some states
  have more complicated behavior and can consume several characters
  before switching to another state. In some cases, the tokenizer
  state is also changed by the tree construction stage.</p>

  <p>The exact behavior of certain states depends on the
  <a href="parsing.html#insertion-mode">insertion mode</a> and the <a href="parsing.html#stack-of-open-elements">stack of open
  elements</a>. Certain states also use a <dfn id="temporary-buffer"><var>temporary
  buffer</var></dfn> to track progress.</p>

  <p>The output of the tokenization step is a series of zero or more
  of the following tokens: DOCTYPE, start tag, end tag, comment,
  character, end-of-file. DOCTYPE tokens have a name, a public
  identifier, a system identifier, and a <i>force-quirks
  flag</i>. When a DOCTYPE token is created, its name, public
  identifier, and system identifier must be marked as missing (which
  is a distinct state from the empty string), and the <i>force-quirks
  flag</i> must be set to <i>off</i> (its other state is
  <i>on</i>). Start and end tag tokens have a tag name, a
  <i>self-closing flag</i>, and a list of attributes, each of which
  has a name and a value. When a start or end tag token is created,
  its <i>self-closing flag</i> must be unset (its other state is that
  it be set), and its attributes list must be empty. Comment and
  character tokens have data.</p>

  <p>When a token is emitted, it must immediately be handled by the
  <a href="#tree-construction">tree construction</a> stage. The tree construction stage
  can affect the state of the tokenization stage, and can insert
  additional characters into the stream. (For example, the
  <code><a href="scripting-1.html#script">script</a></code> element can result in scripts executing and
  using the <a href="apis-in-html-documents.html#dynamic-markup-insertion">dynamic markup insertion</a> APIs to insert
  characters into the stream being tokenized.)</p>

  <p>When a start tag token is emitted with its <i>self-closing
  flag</i> set, if the flag is not <dfn id="acknowledge-self-closing-flag" title="acknowledge
  self-closing flag">acknowledged</dfn> when it is processed by the
  tree construction stage, that is a <a href="parsing.html#parse-error">parse error</a>.</p>

  <p>When an end tag token is emitted with attributes, that is a
  <a href="parsing.html#parse-error">parse error</a>.</p>

  <p>When an end tag token is emitted with its <i>self-closing
  flag</i> set, that is a <a href="parsing.html#parse-error">parse error</a>.</p>

  <p>An <dfn id="appropriate-end-tag-token">appropriate end tag token</dfn> is an end tag token whose
  tag name matches the tag name of the last start tag to have been
  emitted from this tokenizer, if any. If no start tag has been
  emitted from this tokenizer, then no end tag token is
  appropriate.</p>

  <p>Before each step of the tokenizer, the user agent must first
  check the <a href="parsing.html#parser-pause-flag">parser pause flag</a>. If it is true, then the
  tokenizer must abort the processing of any nested invocations of the
  tokenizer, yielding control back to the caller.</p>

  <p>The tokenizer state machine consists of the states defined in the
  following subsections.</p>


  <!-- Order of the lists below is supposed to be non-error then
  error, by unicode, then EOF, ending with "anything else" -->


  <h5 id="data-state"><span class="secno">9.2.4.1 </span><dfn>Data state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0026 AMPERSAND (&amp;)</dt>
   <dd>Switch to the <a href="#character-reference-in-data-state">character reference in data
   state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd>Switch to the <a href="#tag-open-state">tag open state</a>.</dd>

   <dt>EOF</dt>
   <dd>Emit an end-of-file token.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Stay in the <a href="#data-state">data state</a>.</dd>

  </dl><h5 id="character-reference-in-data-state"><span class="secno">9.2.4.2 </span><dfn>Character reference in data state</dfn></h5>

  <p>Attempt to <a href="#consume-a-character-reference">consume a character reference</a>, with no
  <a href="#additional-allowed-character">additional allowed character</a>.</p>

  <p>If nothing is returned, emit a U+0026 AMPERSAND character
  token.</p>

  <p>Otherwise, emit the character token that was returned.</p>

  <p>Finally, switch to the <a href="#data-state">data state</a>.</p>


  <h5 id="rcdata-state"><span class="secno">9.2.4.3 </span><dfn>RCDATA state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0026 AMPERSAND (&amp;)</dt>
   <dd>Switch to the <a href="#character-reference-in-rcdata-state">character reference in RCDATA
   state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd>Switch to the <a href="#rcdata-less-than-sign-state">RCDATA less-than sign state</a>.</dd>

   <dt>EOF</dt>
   <dd>Emit an end-of-file token.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Stay in the <a href="#rcdata-state">RCDATA state</a>.</dd>

  </dl><h5 id="character-reference-in-rcdata-state"><span class="secno">9.2.4.4 </span><dfn>Character reference in RCDATA state</dfn></h5>

  <p>Attempt to <a href="#consume-a-character-reference">consume a character reference</a>, with no
  <a href="#additional-allowed-character">additional allowed character</a>.</p>

  <p>If nothing is returned, emit a U+0026 AMPERSAND character
  token.</p>

  <p>Otherwise, emit the character token that was returned.</p>

  <p>Finally, switch to the <a href="#rcdata-state">RCDATA state</a>.</p>


  <h5 id="rawtext-state"><span class="secno">9.2.4.5 </span><dfn>RAWTEXT state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd>Switch to the <a href="#rawtext-less-than-sign-state">RAWTEXT less-than sign state</a>.</dd>

   <dt>EOF</dt>
   <dd>Emit an end-of-file token.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Stay in the <a href="#rawtext-state">RAWTEXT state</a>.</dd>

  </dl><h5 id="script-data-state"><span class="secno">9.2.4.6 </span><dfn>Script data state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd>Switch to the <a href="#script-data-less-than-sign-state">script data less-than sign state</a>.</dd>

   <dt>EOF</dt>
   <dd>Emit an end-of-file token.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Stay in the <a href="#script-data-state">script data state</a>.</dd>

  </dl><h5 id="plaintext-state"><span class="secno">9.2.4.7 </span><dfn>PLAINTEXT state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>EOF</dt>
   <dd>Emit an end-of-file token.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Stay in the <a href="#plaintext-state">PLAINTEXT state</a>.</dd>

  </dl><h5 id="tag-open-state"><span class="secno">9.2.4.8 </span><dfn>Tag open state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0021 EXCLAMATION MARK (!)</dt>
   <dd>Switch to the <a href="#markup-declaration-open-state">markup declaration open state</a>.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>Switch to the <a href="#close-tag-open-state">close tag open state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Create a new start tag token, set its tag name to the
   lowercase version of the <a href="parsing.html#current-input-character">current input character</a> (add 0x0020 to the
   character's code point), then switch to the <a href="#tag-name-state">tag name
   state</a>. (Don't emit the token yet; further details will
   be filled in before it is emitted.)</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Create a new start tag token, set its tag name to the
   <a href="parsing.html#current-input-character">current input character</a>, then switch to the <a href="#tag-name-state">tag
   name state</a>. (Don't emit the token yet; further details will
   be filled in before it is emitted.)</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit a U+003C LESS-THAN SIGN
   character token and a U+003E GREATER-THAN SIGN character
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>U+003F QUESTION MARK (?)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Switch to the <a href="#bogus-comment-state">bogus
   comment state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit a U+003C LESS-THAN SIGN
   character token and reconsume the <a href="parsing.html#current-input-character">current input
   character</a> in the <a href="#data-state">data state</a>.</dd>

  </dl><h5 id="close-tag-open-state"><span class="secno">9.2.4.9 </span><dfn>Close tag open state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Create a new end tag token, set its tag name to the lowercase
   version of the <a href="parsing.html#current-input-character">current input character</a> (add 0x0020 to
   the character's code point), then switch to the <a href="#tag-name-state">tag name
   state</a>. (Don't emit the token yet; further details will be
   filled in before it is emitted.)</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Create a new end tag token, set its tag name to the
   <a href="parsing.html#current-input-character">current input character</a>, then switch to the <a href="#tag-name-state">tag
   name state</a>. (Don't emit the token yet; further details will
   be filled in before it is emitted.)</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit a U+003C LESS-THAN SIGN
   character token and a U+002F SOLIDUS character token. Reconsume
   the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Switch to the <a href="#bogus-comment-state">bogus
   comment state</a>.</dd>

  </dl><h5 id="tag-name-state"><span class="secno">9.2.4.10 </span><dfn>Tag name state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#before-attribute-name-state">before attribute name state</a>.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>Switch to the <a href="#self-closing-start-tag-state">self-closing start tag state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current tag token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   current tag token's tag name. Stay in the <a href="#tag-name-state">tag name
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   tag token's tag name. Stay in the <a href="#tag-name-state">tag name state</a>.</dd>

  </dl><h5 id="rcdata-less-than-sign-state"><span class="secno">9.2.4.11 </span><dfn>RCDATA less-than sign state</dfn></h5>
  <!-- identical to the RAWTEXT less-than sign state, except s/RAWTEXT/RCDATA/g -->

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002F SOLIDUS (/)</dt>
   <dd>Set the <var><a href="#temporary-buffer">temporary buffer</a></var> to the empty string. Switch
   to the <a href="#rcdata-end-tag-open-state">RCDATA end tag open state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token and reconsume the
   <a href="parsing.html#current-input-character">current input character</a> in the <a href="#rcdata-state">RCDATA
   state</a>.</dd>

  </dl><h5 id="rcdata-end-tag-open-state"><span class="secno">9.2.4.12 </span><dfn>RCDATA end tag open state</dfn></h5>
  <!-- identical to the RAWTEXT (and Script data) end tag open state, except s/RAWTEXT/RCDATA/g -->

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Create a new end tag token, and set its tag name to the
   lowercase version of the <a href="parsing.html#current-input-character">current input character</a> (add
   0x0020 to the character's code point). Append the <a href="parsing.html#current-input-character">current
   input character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Finally,
   switch to the <a href="#rcdata-end-tag-name-state">RCDATA end tag name state</a>. (Don't emit
   the token yet; further details will be filled in before it is
   emitted.)</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Create a new end tag token, and set its tag name to the
   <a href="parsing.html#current-input-character">current input character</a>. Append the <a href="parsing.html#current-input-character">current
   input character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Finally,
   switch to the <a href="#rcdata-end-tag-name-state">RCDATA end tag name state</a>. (Don't emit
   the token yet; further details will be filled in before it is
   emitted.)</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
   character token, and reconsume the <a href="parsing.html#current-input-character">current input
   character</a> in the <a href="#rcdata-state">RCDATA state</a>.</dd>

  </dl><h5 id="rcdata-end-tag-name-state"><span class="secno">9.2.4.13 </span><dfn>RCDATA end tag name state</dfn></h5>
  <!-- identical to the RAWTEXT (and Script data) end tag name state, except s/RAWTEXT/RCDATA/g -->

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then switch to the <a href="#before-attribute-name-state">before attribute name
   state</a>. Otherwise, treat it as per the "anything else" entry
   below.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then switch to the <a href="#self-closing-start-tag-state">self-closing start tag
   state</a>. Otherwise, treat it as per the "anything else" entry
   below.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then emit the current tag token and switch to the
   <a href="#data-state">data state</a>. Otherwise, treat it as per the "anything
   else" entry below.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   current tag token's tag name. Append the <a href="parsing.html#current-input-character">current input
   character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the
   <a href="#rcdata-end-tag-name-state">RCDATA end tag name state</a>.</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   tag token's tag name. Append the <a href="parsing.html#current-input-character">current input
   character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the
   <a href="#rcdata-end-tag-name-state">RCDATA end tag name state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
   character token, a character token for each of the characters in
   the <var><a href="#temporary-buffer">temporary buffer</a></var> (in the order they were added to
   the buffer), and reconsume the <a href="parsing.html#current-input-character">current input character</a>
   in the <a href="#rcdata-state">RCDATA state</a>.</dd>

  </dl><h5 id="rawtext-less-than-sign-state"><span class="secno">9.2.4.14 </span><dfn>RAWTEXT less-than sign state</dfn></h5>
  <!-- identical to the RCDATA less-than sign state, except s/RCDATA/RAWTEXT/g -->

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002F SOLIDUS (/)</dt>
   <dd>Set the <var><a href="#temporary-buffer">temporary buffer</a></var> to the empty string. Switch
   to the <a href="#rawtext-end-tag-open-state">RAWTEXT end tag open state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token and reconsume the
   <a href="parsing.html#current-input-character">current input character</a> in the <a href="#rawtext-state">RAWTEXT
   state</a>.</dd>

  </dl><h5 id="rawtext-end-tag-open-state"><span class="secno">9.2.4.15 </span><dfn>RAWTEXT end tag open state</dfn></h5>
  <!-- identical to the RCDATA (and Script data) end tag open state, except s/RCDATA/RAWTEXT/g -->

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Create a new end tag token, and set its tag name to the
   lowercase version of the <a href="parsing.html#current-input-character">current input character</a> (add
   0x0020 to the character's code point). Append the <a href="parsing.html#current-input-character">current
   input character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Finally,
   switch to the <a href="#rawtext-end-tag-name-state">RAWTEXT end tag name state</a>. (Don't emit
   the token yet; further details will be filled in before it is
   emitted.)</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Create a new end tag token, and set its tag name to the
   <a href="parsing.html#current-input-character">current input character</a>. Append the <a href="parsing.html#current-input-character">current
   input character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Finally,
   switch to the <a href="#rawtext-end-tag-name-state">RAWTEXT end tag name state</a>. (Don't emit
   the token yet; further details will be filled in before it is
   emitted.)</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
   character token, and reconsume the <a href="parsing.html#current-input-character">current input
   character</a> in the <a href="#rawtext-state">RAWTEXT state</a>.</dd>

  </dl><h5 id="rawtext-end-tag-name-state"><span class="secno">9.2.4.16 </span><dfn>RAWTEXT end tag name state</dfn></h5>
  <!-- identical to the RCDATA (and Script data) end tag name state, except s/RCDATA/RAWTEXT/g -->

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then switch to the <a href="#before-attribute-name-state">before attribute name
   state</a>. Otherwise, treat it as per the "anything else" entry
   below.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then switch to the <a href="#self-closing-start-tag-state">self-closing start tag
   state</a>. Otherwise, treat it as per the "anything else" entry
   below.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then emit the current tag token and switch to the
   <a href="#data-state">data state</a>. Otherwise, treat it as per the "anything
   else" entry below.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   current tag token's tag name. Append the <a href="parsing.html#current-input-character">current input
   character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the
   <a href="#rawtext-end-tag-name-state">RAWTEXT end tag name state</a>.</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   tag token's tag name. Append the <a href="parsing.html#current-input-character">current input
   character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the
   <a href="#rawtext-end-tag-name-state">RAWTEXT end tag name state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
   character token, a character token for each of the characters in
   the <var><a href="#temporary-buffer">temporary buffer</a></var> (in the order they were added to
   the buffer), and reconsume the <a href="parsing.html#current-input-character">current input character</a>
   in the <a href="#rawtext-state">RAWTEXT state</a>.</dd>

  </dl><h5 id="script-data-less-than-sign-state"><span class="secno">9.2.4.17 </span><dfn>Script data less-than sign state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002F SOLIDUS (/)</dt>
   <dd>Set the <var><a href="#temporary-buffer">temporary buffer</a></var> to the empty string. Switch
   to the <a href="#script-data-end-tag-open-state">script data end tag open state</a>.</dd>

   <dt>U+0021 EXCLAMATION MARK (!)</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token and a U+0021
   EXCLAMATION MARK character token. Switch to the <a href="#script-data-escape-start-state">script data
   escape start state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token and reconsume the
   <a href="parsing.html#current-input-character">current input character</a> in the <a href="#script-data-state">script data
   state</a>.</dd>

  </dl><h5 id="script-data-end-tag-open-state"><span class="secno">9.2.4.18 </span><dfn>Script data end tag open state</dfn></h5>
  <!-- identical to the RCDATA (and RAWTEXT) end tag open state, except s/RCDATA/Script data/g -->

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Create a new end tag token, and set its tag name to the
   lowercase version of the <a href="parsing.html#current-input-character">current input character</a> (add
   0x0020 to the character's code point). Append the <a href="parsing.html#current-input-character">current
   input character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Finally,
   switch to the <a href="#script-data-end-tag-name-state">script data end tag name state</a>. (Don't emit
   the token yet; further details will be filled in before it is
   emitted.)</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Create a new end tag token, and set its tag name to the
   <a href="parsing.html#current-input-character">current input character</a>. Append the <a href="parsing.html#current-input-character">current
   input character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Finally,
   switch to the <a href="#script-data-end-tag-name-state">script data end tag name state</a>. (Don't emit
   the token yet; further details will be filled in before it is
   emitted.)</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
   character token, and reconsume the <a href="parsing.html#current-input-character">current input
   character</a> in the <a href="#script-data-state">script data state</a>.</dd>

  </dl><h5 id="script-data-end-tag-name-state"><span class="secno">9.2.4.19 </span><dfn>Script data end tag name state</dfn></h5>
  <!-- identical to the RCDATA (and RAWTEXT) end tag name state, except s/RCDATA/Script data/g -->

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then switch to the <a href="#before-attribute-name-state">before attribute name
   state</a>. Otherwise, treat it as per the "anything else" entry
   below.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then switch to the <a href="#self-closing-start-tag-state">self-closing start tag
   state</a>. Otherwise, treat it as per the "anything else" entry
   below.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then emit the current tag token and switch to the
   <a href="#data-state">data state</a>. Otherwise, treat it as per the "anything
   else" entry below.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   current tag token's tag name. Append the <a href="parsing.html#current-input-character">current input
   character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the
   <a href="#script-data-end-tag-name-state">script data end tag name state</a>.</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   tag token's tag name. Append the <a href="parsing.html#current-input-character">current input
   character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the
   <a href="#script-data-end-tag-name-state">script data end tag name state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
   character token, a character token for each of the characters in
   the <var><a href="#temporary-buffer">temporary buffer</a></var> (in the order they were added to
   the buffer), and reconsume the <a href="parsing.html#current-input-character">current input character</a>
   in the <a href="#script-data-state">script data state</a>.</dd>

  </dl><h5 id="script-data-escape-start-state"><span class="secno">9.2.4.20 </span><dfn>Script data escape start state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Emit a U+002D HYPHEN-MINUS character token. Switch to the
   <a href="#script-data-escape-start-dash-state">script data escape start dash state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Reconsume the <a href="parsing.html#current-input-character">current input character</a> in the
   <a href="#script-data-state">script data state</a>.</dd>

  </dl><h5 id="script-data-escape-start-dash-state"><span class="secno">9.2.4.21 </span><dfn>Script data escape start dash state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Emit a U+002D HYPHEN-MINUS character token. Switch to the
   <a href="#script-data-escaped-dash-dash-state">script data escaped dash dash state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Reconsume the <a href="parsing.html#current-input-character">current input character</a> in the
   <a href="#script-data-state">script data state</a>.</dd>

  </dl><h5 id="script-data-escaped-state"><span class="secno">9.2.4.22 </span><dfn>Script data escaped state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Emit a U+002D HYPHEN-MINUS character token. Switch to the
   <a href="#script-data-escaped-dash-state">script data escaped dash state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd><p>Switch to the <a href="#script-data-escaped-less-than-sign-state">script data escaped less-than sign
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Stay in the <a href="#script-data-escaped-state">script data escaped state</a>.</dd>

  </dl><h5 id="script-data-escaped-dash-state"><span class="secno">9.2.4.23 </span><dfn>Script data escaped dash state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Emit a U+002D HYPHEN-MINUS character token. Switch to the
   <a href="#script-data-escaped-dash-dash-state">script data escaped dash dash state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd><p>Switch to the <a href="#script-data-escaped-less-than-sign-state">script data escaped less-than sign
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Switch to the <a href="#script-data-escaped-state">script data escaped state</a>.</dd>

  </dl><h5 id="script-data-escaped-dash-dash-state"><span class="secno">9.2.4.24 </span><dfn>Script data escaped dash dash state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Emit a U+002D HYPHEN-MINUS character token. Stay in the
   <a href="#script-data-escaped-dash-dash-state">script data escaped dash dash state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd><p>Switch to the <a href="#script-data-escaped-less-than-sign-state">script data escaped less-than sign
   state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit a U+003E GREATER-THAN SIGN character token. Switch to the
   <a href="#script-data-state">script data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Switch to the <a href="#script-data-escaped-state">script data escaped state</a>.</dd>

  </dl><h5 id="script-data-escaped-less-than-sign-state"><span class="secno">9.2.4.25 </span><dfn>Script data escaped less-than sign state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002F SOLIDUS (/)</dt>
   <dd>Set the <var><a href="#temporary-buffer">temporary buffer</a></var> to the empty string. Switch
   to the <a href="#script-data-escaped-end-tag-open-state">script data escaped end tag open state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token and the
   <a href="parsing.html#current-input-character">current input character</a> as a character token. Set the
   <var><a href="#temporary-buffer">temporary buffer</a></var> to the empty string. Append the
   lowercase version of the <a href="parsing.html#current-input-character">current input character</a> (add
   0x0020 to the character's code point) to the <var><a href="#temporary-buffer">temporary
   buffer</a></var>. Switch to the <a href="#script-data-double-escape-start-state">script data double escape start
   state</a>.</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token and the
   <a href="parsing.html#current-input-character">current input character</a> as a character token. Set the
   <var><a href="#temporary-buffer">temporary buffer</a></var> to the empty string. Append the
   <a href="parsing.html#current-input-character">current input character</a> to the <var><a href="#temporary-buffer">temporary
   buffer</a></var>. Switch to the <a href="#script-data-double-escape-start-state">script data double escape start
   state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token and reconsume the
   <a href="parsing.html#current-input-character">current input character</a> in the <a href="#script-data-escaped-state">script data
   escaped state</a>.</dd>

  </dl><h5 id="script-data-escaped-end-tag-open-state"><span class="secno">9.2.4.26 </span><dfn>Script data escaped end tag open state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Create a new end tag token, and set its tag name to the
   lowercase version of the <a href="parsing.html#current-input-character">current input character</a> (add
   0x0020 to the character's code point). Append the <a href="parsing.html#current-input-character">current
   input character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Finally,
   switch to the <a href="#script-data-escaped-end-tag-name-state">script data escaped end tag name
   state</a>. (Don't emit the token yet; further details will be
   filled in before it is emitted.)</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Create a new end tag token, and set its tag name to the
   <a href="parsing.html#current-input-character">current input character</a>. Append the <a href="parsing.html#current-input-character">current
   input character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Finally,
   switch to the <a href="#script-data-escaped-end-tag-name-state">script data escaped end tag name
   state</a>. (Don't emit the token yet; further details will be
   filled in before it is emitted.)</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
   character token, and reconsume the <a href="parsing.html#current-input-character">current input
   character</a> in the <a href="#script-data-escaped-state">script data escaped state</a>.</dd>

  </dl><h5 id="script-data-escaped-end-tag-name-state"><span class="secno">9.2.4.27 </span><dfn>Script data escaped end tag name state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then switch to the <a href="#before-attribute-name-state">before attribute name
   state</a>. Otherwise, treat it as per the "anything else" entry
   below.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then switch to the <a href="#self-closing-start-tag-state">self-closing start tag
   state</a>. Otherwise, treat it as per the "anything else" entry
   below.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>If the current end tag token is an <a href="#appropriate-end-tag-token">appropriate end tag
   token</a>, then emit the current tag token and switch to the
   <a href="#data-state">data state</a>. Otherwise, treat it as per the "anything
   else" entry below.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   current tag token's tag name. Append the <a href="parsing.html#current-input-character">current input
   character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the
   <a href="#script-data-escaped-end-tag-name-state">script data escaped end tag name state</a>.</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   tag token's tag name. Append the <a href="parsing.html#current-input-character">current input
   character</a> to the <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the
   <a href="#script-data-escaped-end-tag-name-state">script data escaped end tag name state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
   character token, a character token for each of the characters in
   the <var><a href="#temporary-buffer">temporary buffer</a></var> (in the order they were added to
   the buffer), and reconsume the <a href="parsing.html#current-input-character">current input character</a>
   in the <a href="#script-data-escaped-state">script data escaped state</a>.</dd>

  </dl><h5 id="script-data-double-escape-start-state"><span class="secno">9.2.4.28 </span><dfn>Script data double escape start state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dt>U+002F SOLIDUS (/)</dt>
   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. If the <var><a href="#temporary-buffer">temporary buffer</a></var> is the string "<code title="">script</code>", then switch to the <a href="#script-data-double-escaped-state">script data
   double escaped state</a>. Otherwise, switch to the <a href="#script-data-escaped-state">script
   data escaped state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the <a href="#script-data-double-escape-start-state">script data double
   escape start state</a>.</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Append the <a href="parsing.html#current-input-character">current input character</a> to the
   <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the <a href="#script-data-double-escape-start-state">script data double
   escape start state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Reconsume the <a href="parsing.html#current-input-character">current input character</a> in the
   <a href="#script-data-escaped-state">script data escaped state</a>.</dd>

  </dl><h5 id="script-data-double-escaped-state"><span class="secno">9.2.4.29 </span><dfn>Script data double escaped state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Emit a U+002D HYPHEN-MINUS character token. Switch to the
   <a href="#script-data-double-escaped-dash-state">script data double escaped dash state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd><p>Emit a U+003C LESS-THAN SIGN character token. Switch to the
   <a href="#script-data-double-escaped-less-than-sign-state">script data double escaped less-than sign
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Stay in the <a href="#script-data-double-escaped-state">script data double escaped
   state</a>.</dd>

  </dl><h5 id="script-data-double-escaped-dash-state"><span class="secno">9.2.4.30 </span><dfn>Script data double escaped dash state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Emit a U+002D HYPHEN-MINUS character token. Switch to the
   <a href="#script-data-double-escaped-dash-dash-state">script data double escaped dash dash state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd><p>Emit a U+003C LESS-THAN SIGN character token. Switch to the
   <a href="#script-data-double-escaped-less-than-sign-state">script data double escaped less-than sign
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Switch to the <a href="#script-data-double-escaped-state">script data double escaped
   state</a>.</dd>

  </dl><h5 id="script-data-double-escaped-dash-dash-state"><span class="secno">9.2.4.31 </span><dfn>Script data double escaped dash dash state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Emit a U+002D HYPHEN-MINUS character token. Stay in the
   <a href="#script-data-double-escaped-dash-dash-state">script data double escaped dash dash state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd><p>Emit a U+003C LESS-THAN SIGN character token. Switch to the
   <a href="#script-data-double-escaped-less-than-sign-state">script data double escaped less-than sign
   state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit a U+003E GREATER-THAN SIGN character token. Switch to the
   <a href="#script-data-state">script data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Switch to the <a href="#script-data-double-escaped-state">script data double escaped
   state</a>.</dd>

  </dl><h5 id="script-data-double-escaped-less-than-sign-state"><span class="secno">9.2.4.32 </span><dfn>Script data double escaped less-than sign state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002F SOLIDUS (/)</dt>
   <dd>Emit a U+002F SOLIDUS character token. Set the <var><a href="#temporary-buffer">temporary
   buffer</a></var> to the empty string. Switch to the <a href="#script-data-double-escape-end-state">script data
   double escape end state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Reconsume the <a href="parsing.html#current-input-character">current input character</a> in the
   <a href="#script-data-double-escaped-state">script data double escaped state</a>.</dd>

  </dl><h5 id="script-data-double-escape-end-state"><span class="secno">9.2.4.33 </span><dfn>Script data double escape end state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dt>U+002F SOLIDUS (/)</dt>
   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. If the <var><a href="#temporary-buffer">temporary buffer</a></var> is the string "<code title="">script</code>", then switch to the <a href="#script-data-escaped-state">script data
   escaped state</a>. Otherwise, switch to the <a href="#script-data-double-escaped-state">script data
   double escaped state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the <a href="#script-data-double-escape-end-state">script data double
   escape end state</a>.</dd>

   <dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z</dt>
   <dd>Emit the <a href="parsing.html#current-input-character">current input character</a> as a character
   token. Append the <a href="parsing.html#current-input-character">current input character</a> to the
   <var><a href="#temporary-buffer">temporary buffer</a></var>. Stay in the <a href="#script-data-double-escape-end-state">script data double
   escape end state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Reconsume the <a href="parsing.html#current-input-character">current input character</a> in the
   <a href="#script-data-double-escaped-state">script data double escaped state</a>.</dd>

  </dl><h5 id="before-attribute-name-state"><span class="secno">9.2.4.34 </span><dfn>Before attribute name state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#before-attribute-name-state">before attribute name state</a>.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>Switch to the <a href="#self-closing-start-tag-state">self-closing start tag state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current tag token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Start a new attribute in the current tag token. Set that
   attribute's name to the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point), and its
   value to the empty string. Switch to the <a href="#attribute-name-state">attribute name
   state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dt>U+0027 APOSTROPHE (')</dt>
   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dt>U+003D EQUALS SIGN (=)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Treat it as per the "anything else"
   entry below.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Start a new attribute in the current tag token. Set that
   attribute's name to the <a href="parsing.html#current-input-character">current input character</a>, and its value to
   the empty string. Switch to the <a href="#attribute-name-state">attribute name
   state</a>.</dd>

  </dl><h5 id="attribute-name-state"><span class="secno">9.2.4.35 </span><dfn>Attribute name state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#after-attribute-name-state">after attribute name state</a>.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>Switch to the <a href="#self-closing-start-tag-state">self-closing start tag state</a>.</dd>

   <dt>U+003D EQUALS SIGN (=)</dt>
   <dd>Switch to the <a href="#before-attribute-value-state">before attribute value state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current tag token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   current attribute's name. Stay in the <a href="#attribute-name-state">attribute name
   state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dt>U+0027 APOSTROPHE (')</dt>
   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Treat it as per the "anything else"
   entry below.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   attribute's name. Stay in the <a href="#attribute-name-state">attribute name
   state</a>.</dd>

  </dl><p>When the user agent leaves the attribute name state (and before
  emitting the tag token, if appropriate), the complete attribute's
  name must be compared to the other attributes on the same token;
  if there is already an attribute on the token with the exact same
  name, then this is a <a href="parsing.html#parse-error">parse error</a> and the new
  attribute must be dropped, along with the value that gets
  associated with it (if any).</p>


  <h5 id="after-attribute-name-state"><span class="secno">9.2.4.36 </span><dfn>After attribute name state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#after-attribute-name-state">after attribute name state</a>.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>Switch to the <a href="#self-closing-start-tag-state">self-closing start tag state</a>.</dd>

   <dt>U+003D EQUALS SIGN (=)</dt>
   <dd>Switch to the <a href="#before-attribute-value-state">before attribute value state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current tag token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Start a new attribute in the current tag token. Set that
   attribute's name to the lowercase version of the <a href="parsing.html#current-input-character">current
   input character</a> (add 0x0020 to the character's code point),
   and its value to the empty string. Switch to the <a href="#attribute-name-state">attribute
   name state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dt>U+0027 APOSTROPHE (')</dt>
   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Treat it as per the "anything else"
   entry below.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Start a new attribute in the current tag token. Set that
   attribute's name to the <a href="parsing.html#current-input-character">current input character</a>, and
   its value to the empty string. Switch to the <a href="#attribute-name-state">attribute name
   state</a>.</dd>

  </dl><h5 id="before-attribute-value-state"><span class="secno">9.2.4.37 </span><dfn>Before attribute value state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#before-attribute-value-state">before attribute value state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dd>Switch to the <a href="#attribute-value-(double-quoted)-state">attribute value (double-quoted) state</a>.</dd>

   <dt>U+0026 AMPERSAND (&amp;)</dt>
   <dd>Switch to the <a href="#attribute-value-(unquoted)-state">attribute value (unquoted) state</a>
   and reconsume this <a href="parsing.html#current-input-character">current input character</a>.</dd>

   <dt>U+0027 APOSTROPHE (')</dt>
   <dd>Switch to the <a href="#attribute-value-(single-quoted)-state">attribute value (single-quoted) state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the current tag token. Switch to
   the <a href="#data-state">data state</a>.</dd>

   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dt>U+003D EQUALS SIGN (=)</dt>
   <dt>U+0060 GRAVE ACCENT (`)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Treat it as per the "anything else"
   entry below.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   attribute's value. Switch to the <a href="#attribute-value-(unquoted)-state">attribute value (unquoted)
   state</a>.</dd>

  </dl><h5 id="attribute-value-(double-quoted)-state"><span class="secno">9.2.4.38 </span><dfn>Attribute value (double-quoted) state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0022 QUOTATION MARK (")</dt>
   <dd>Switch to the <a href="#after-attribute-value-(quoted)-state">after attribute value (quoted)
   state</a>.</dd>

   <dt>U+0026 AMPERSAND (&amp;)</dt>
   <dd>Switch to the <a href="#character-reference-in-attribute-value-state">character reference in attribute value
   state</a>, with the <a href="#additional-allowed-character">additional allowed character</a>
   being U+0022 QUOTATION MARK (").</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   attribute's value. Stay in the <a href="#attribute-value-(double-quoted)-state">attribute value
   (double-quoted) state</a>.</dd>

  </dl><h5 id="attribute-value-(single-quoted)-state"><span class="secno">9.2.4.39 </span><dfn>Attribute value (single-quoted) state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0027 APOSTROPHE (')</dt>
   <dd>Switch to the <a href="#after-attribute-value-(quoted)-state">after attribute value (quoted)
   state</a>.</dd>

   <dt>U+0026 AMPERSAND (&amp;)</dt>
   <dd>Switch to the <a href="#character-reference-in-attribute-value-state">character reference in attribute value
   state</a>, with the <a href="#additional-allowed-character">additional allowed character</a>
   being U+0027 APOSTROPHE (').</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   attribute's value. Stay in the <a href="#attribute-value-(single-quoted)-state">attribute value
   (single-quoted) state</a>.</dd>

  </dl><h5 id="attribute-value-(unquoted)-state"><span class="secno">9.2.4.40 </span><dfn>Attribute value (unquoted) state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#before-attribute-name-state">before attribute name state</a>.</dd>

   <dt>U+0026 AMPERSAND (&amp;)</dt>
   <dd>Switch to the <a href="#character-reference-in-attribute-value-state">character reference in attribute value
   state</a>, with the <a href="#additional-allowed-character">additional allowed character</a>
   being U+003E GREATER-THAN SIGN (&gt;).</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current tag token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dt>U+0027 APOSTROPHE (')</dt>
   <dt>U+003C LESS-THAN SIGN (&lt;)</dt>
   <dt>U+003D EQUALS SIGN (=)</dt>
   <dt>U+0060 GRAVE ACCENT (`)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Treat it as per the "anything else"
   entry below.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   attribute's value. Stay in the <a href="#attribute-value-(unquoted)-state">attribute value (unquoted)
   state</a>.</dd>

  </dl><h5 id="character-reference-in-attribute-value-state"><span class="secno">9.2.4.41 </span><dfn>Character reference in attribute value state</dfn></h5>

  <p>Attempt to <a href="#consume-a-character-reference">consume a character reference</a>.</p>

  <p>If nothing is returned, append a U+0026 AMPERSAND character to
  the current attribute's value.</p>

  <p>Otherwise, append the returned character token to the current
  attribute's value.</p>

  <p>Finally, switch back to the attribute value state that you were
  in when were switched into this state.</p>


  <h5 id="after-attribute-value-(quoted)-state"><span class="secno">9.2.4.42 </span><dfn>After attribute value (quoted) state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#before-attribute-name-state">before attribute name state</a>.</dd>

   <dt>U+002F SOLIDUS (/)</dt>
   <dd>Switch to the <a href="#self-closing-start-tag-state">self-closing start tag state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current tag token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the character in
   the <a href="#before-attribute-name-state">before attribute name state</a>.</dd>

  </dl><h5 id="self-closing-start-tag-state"><span class="secno">9.2.4.43 </span><dfn>Self-closing start tag state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Set the <i>self-closing flag</i> of the current tag
   token. Emit the current tag token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the character in
   the <a href="#before-attribute-name-state">before attribute name state</a>.</dd>

  </dl><h5 id="bogus-comment-state"><span class="secno">9.2.4.44 </span><dfn>Bogus comment state</dfn></h5>

  <p>Consume every character up to and including the first U+003E
  GREATER-THAN SIGN character (&gt;) or the end of the file (EOF),
  whichever comes first. Emit a comment token whose data is the
  concatenation of all the characters starting from and including
  the character that caused the state machine to switch into the
  bogus comment state, up to and including the character immediately
  before the last consumed character (i.e. up to the character just
  before the U+003E or EOF character). (If the comment was started
  by the end of the file (EOF), the token is empty.)</p>

  <p>Switch to the <a href="#data-state">data state</a>.</p>

  <p>If the end of the file was reached, reconsume the EOF
  character.</p>


  <h5 id="markup-declaration-open-state"><span class="secno">9.2.4.45 </span><dfn>Markup declaration open state</dfn></h5>

  <p>If the next two characters are both U+002D HYPHEN-MINUS
  characters (-), consume those two characters, create a comment token
  whose data is the empty string, and switch to the <a href="#comment-start-state">comment
  start state</a>.</p>

  <p>Otherwise, if the next seven characters are an <a href="infrastructure.html#ascii-case-insensitive">ASCII
  case-insensitive</a> match for the word "DOCTYPE", then consume
  those characters and switch to the <a href="#doctype-state">DOCTYPE state</a>.</p>

  <p>Otherwise, if the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-inforeign" title="insertion mode: in foreign content">in foreign
  content</a>" and the <a href="parsing.html#current-node">current node</a> is not an element
  in the <a href="the-end.html#html-namespace-0">HTML namespace</a> and the next seven characters are
  an <a href="infrastructure.html#case-sensitive">case-sensitive</a> match for the string "[CDATA[" (the
  five uppercase letters "CDATA" with a U+005B LEFT SQUARE BRACKET
  character before and after), then consume those characters and
  switch to the <a href="#cdata-section-state">CDATA section state</a>.</p>

  <p>Otherwise, this is a <a href="parsing.html#parse-error">parse error</a>. Switch to the
  <a href="#bogus-comment-state">bogus comment state</a>. The next character that is
  consumed, if any, is the first character that will be in the
  comment.</p>


  <h5 id="comment-start-state"><span class="secno">9.2.4.46 </span><dfn>Comment start state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Switch to the <a href="#comment-start-dash-state">comment start dash state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Switch to the
   <a href="#data-state">data state</a>.</dd> <!-- see comment in comment end state
   -->

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Reconsume
   the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the comment
   token's data. Switch to the <a href="#comment-state">comment state</a>.</dd>

  </dl><h5 id="comment-start-dash-state"><span class="secno">9.2.4.47 </span><dfn>Comment start dash state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Switch to the <a href="#comment-end-state">comment end state</a></dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Switch to
   the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Reconsume the
   EOF character in the <a href="#data-state">data state</a>.</dd> <!-- see comment
   in comment end state -->

   <dt>Anything else</dt>
   <dd>Append a U+002D HYPHEN-MINUS character (-) and the
   <a href="parsing.html#current-input-character">current input character</a> to the comment token's
   data. Switch to the <a href="#comment-state">comment state</a>.</dd>

  </dl><h5 id="comment-state"><span class="secno">9.2.4.48 </span><dfn id="comment">Comment state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Switch to the <a href="#comment-end-dash-state">comment end dash state</a></dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Reconsume the
   EOF character in the <a href="#data-state">data state</a>.</dd> <!-- see comment
   in comment end state -->

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the comment
   token's data. Stay in the <a href="#comment-state">comment state</a>.</dd>

  </dl><h5 id="comment-end-dash-state"><span class="secno">9.2.4.49 </span><dfn>Comment end dash state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Switch to the <a href="#comment-end-state">comment end state</a></dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Reconsume the
   EOF character in the <a href="#data-state">data state</a>.</dd> <!-- see comment
   in comment end state -->

   <dt>Anything else</dt>
   <dd>Append a U+002D HYPHEN-MINUS character (-) and the
   <a href="parsing.html#current-input-character">current input character</a> to the comment token's
   data. Switch to the <a href="#comment-state">comment state</a>.</dd>

  </dl><h5 id="comment-end-state"><span class="secno">9.2.4.50 </span><dfn>Comment end state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the comment token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Append two U+002D HYPHEN-MINUS
   characters (-) and the <a href="parsing.html#current-input-character">current input character</a> to the
   comment token's data. Switch to the <a href="#comment-end-space-state">comment end space
   state</a>.</dd>

   <dt>U+0021 EXCLAMATION MARK (!)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Switch to the <a href="#comment-end-bang-state">comment end bang
   state</a>.</dd>

   <dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Append a U+002D HYPHEN-MINUS
   character (-) to the comment token's data. Stay in the
   <a href="#comment-end-state">comment end state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Reconsume
   the EOF character in the <a href="#data-state">data state</a>.</dd> <!-- For
   security reasons: otherwise, hostile user could put a <script> in
   a comment e.g. in a blog comment and then DOS the server so that
   the end tag isn't read, and then the commented <script> tag would
   be treated as live code -->

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Append two U+002D HYPHEN-MINUS
   characters (-) and the <a href="parsing.html#current-input-character">current input character</a> to the
   comment token's data. Switch to the <a href="#comment-state">comment
   state</a>.</dd>

  </dl><h5 id="comment-end-bang-state"><span class="secno">9.2.4.51 </span><dfn>Comment end bang state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Append two U+002D HYPHEN-MINUS characters (-) and a U+0021
   EXCLAMATION MARK character (!) to the comment token's data. Switch
   to the <a href="#comment-end-dash-state">comment end dash state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the comment token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Reconsume
   the EOF character in the <a href="#data-state">data state</a>.</dd> <!-- see
   comment in comment end state -->

   <dt>Anything else</dt>
   <dd>Append two U+002D HYPHEN-MINUS characters (-), a U+0021
   EXCLAMATION MARK character (!), and the <a href="parsing.html#current-input-character">current input
   character</a> to the comment token's data. Switch to the
   <a href="#comment-state">comment state</a>.</dd>

  </dl><h5 id="comment-end-space-state"><span class="secno">9.2.4.52 </span><dfn>Comment end space state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the comment token's data. Stay in
   the <a href="#comment-end-space-state">comment end space state</a>.</dd>

   <dt>U+002D HYPHEN-MINUS (-)</dt>
   <dd>Switch to the <a href="#comment-end-dash-state">comment end dash state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the comment token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Emit the comment token. Reconsume
   the EOF character in the <a href="#data-state">data state</a>.</dd> <!-- see
   comment in comment end state -->

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the comment token's data. Switch
   to the <a href="#comment-state">comment state</a>.</dd>

  </dl><h5 id="doctype-state"><span class="secno">9.2.4.53 </span><dfn>DOCTYPE state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#before-doctype-name-state">before DOCTYPE name state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Create a new DOCTYPE token. Set its
   <i>force-quirks flag</i> to <i>on</i>. Emit the token. Reconsume
   the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Reconsume the character in the
   <a href="#before-doctype-name-state">before DOCTYPE name state</a>.</dd>

  </dl><h5 id="before-doctype-name-state"><span class="secno">9.2.4.54 </span><dfn>Before DOCTYPE name state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#before-doctype-name-state">before DOCTYPE name state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Create a new DOCTYPE token. Set the token's name to the
   lowercase version of the <a href="parsing.html#current-input-character">current input character</a> (add 0x0020 to the
   character's code point). Switch to the <a href="#doctype-name-state">DOCTYPE name
   state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Create a new DOCTYPE token. Set its
   <i>force-quirks flag</i> to <i>on</i>. Emit the token. Switch to
   the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Create a new DOCTYPE token. Set its
   <i>force-quirks flag</i> to <i>on</i>. Emit the token. Reconsume
   the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Create a new DOCTYPE token. Set the token's name to the
   <a href="parsing.html#current-input-character">current input character</a>. Switch to the <a href="#doctype-name-state">DOCTYPE name
   state</a>.</dd>

  </dl><h5 id="doctype-name-state"><span class="secno">9.2.4.55 </span><dfn>DOCTYPE name state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#after-doctype-name-state">after DOCTYPE name state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER Z</dt>
   <dd>Append the lowercase version of the <a href="parsing.html#current-input-character">current input
   character</a> (add 0x0020 to the character's code point) to the
   current DOCTYPE token's name. Stay in the <a href="#doctype-name-state">DOCTYPE name
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   DOCTYPE token's name. Stay in the <a href="#doctype-name-state">DOCTYPE name
   state</a>.</dd>

  </dl><h5 id="after-doctype-name-state"><span class="secno">9.2.4.56 </span><dfn>After DOCTYPE name state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#after-doctype-name-state">after DOCTYPE name state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>

    <p>If the six characters starting from the <a href="parsing.html#current-input-character">current input
    character</a> are an <a href="infrastructure.html#ascii-case-insensitive">ASCII case-insensitive</a> match
    for the word "PUBLIC", then consume those characters and switch to
    the <a href="#after-doctype-public-keyword-state">after DOCTYPE public keyword state</a>.</p>

    <p>Otherwise, if the six characters starting from the
    <a href="parsing.html#current-input-character">current input character</a> are an <a href="infrastructure.html#ascii-case-insensitive">ASCII
    case-insensitive</a> match for the word "SYSTEM", then consume
    those characters and switch to the <a href="#after-doctype-system-keyword-state">after DOCTYPE system
    keyword state</a>.</p>

    <p>Otherwise, this is the <a href="parsing.html#parse-error">parse error</a>. Set the
    DOCTYPE token's <i>force-quirks flag</i> to <i>on</i>. Switch to
    the <a href="#bogus-doctype-state">bogus DOCTYPE state</a>.</p>

   </dd>

  </dl><h5 id="after-doctype-public-keyword-state"><span class="secno">9.2.4.57 </span><dfn>After DOCTYPE public keyword state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#before-doctype-public-identifier-state">before DOCTYPE public identifier
   state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's public
   identifier to the empty string (not missing), then switch to the
   <a href="#doctype-public-identifier-(double-quoted)-state">DOCTYPE public identifier (double-quoted) state</a>.</dd>

   <dt>U+0027 APOSTROPHE (')</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's public
   identifier to the empty string (not missing), then switch to the
   <a href="#doctype-public-identifier-(single-quoted)-state">DOCTYPE public identifier (single-quoted) state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Switch to the <a href="#bogus-doctype-state">bogus
   DOCTYPE state</a>.</dd>

  </dl><h5 id="before-doctype-public-identifier-state"><span class="secno">9.2.4.58 </span><dfn>Before DOCTYPE public identifier state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#before-doctype-public-identifier-state">before DOCTYPE public identifier state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dd>Set the DOCTYPE token's public identifier to the empty string
   (not missing), then switch to the <a href="#doctype-public-identifier-(double-quoted)-state">DOCTYPE public identifier
   (double-quoted) state</a>.</dd>

   <dt>U+0027 APOSTROPHE (')</dt>
   <dd>Set the DOCTYPE token's public identifier to the empty string
   (not missing), then switch to the <a href="#doctype-public-identifier-(single-quoted)-state">DOCTYPE public identifier
   (single-quoted) state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Switch to the <a href="#bogus-doctype-state">bogus
   DOCTYPE state</a>.</dd>

  </dl><h5 id="doctype-public-identifier-(double-quoted)-state"><span class="secno">9.2.4.59 </span><dfn>DOCTYPE public identifier (double-quoted) state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0022 QUOTATION MARK (")</dt>
   <dd>Switch to the <a href="#after-doctype-public-identifier-state">after DOCTYPE public identifier state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current DOCTYPE
   token's public identifier. Stay in the <a href="#doctype-public-identifier-(double-quoted)-state">DOCTYPE public
   identifier (double-quoted) state</a>.</dd>

  </dl><h5 id="doctype-public-identifier-(single-quoted)-state"><span class="secno">9.2.4.60 </span><dfn>DOCTYPE public identifier (single-quoted) state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0027 APOSTROPHE (')</dt>
   <dd>Switch to the <a href="#after-doctype-public-identifier-state">after DOCTYPE public identifier state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current DOCTYPE
   token's public identifier. Stay in the <a href="#doctype-public-identifier-(single-quoted)-state">DOCTYPE public
   identifier (single-quoted) state</a>.</dd>

  </dl><h5 id="after-doctype-public-identifier-state"><span class="secno">9.2.4.61 </span><dfn>After DOCTYPE public identifier state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#between-doctype-public-and-system-identifiers-state">between DOCTYPE public and system
   identifiers state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's system
   identifier to the empty string (not missing), then switch to the
   <a href="#doctype-system-identifier-(double-quoted)-state">DOCTYPE system identifier (double-quoted) state</a>.</dd>

   <dt>U+0027 APOSTROPHE (')</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's system
   identifier to the empty string (not missing), then switch to the
   <a href="#doctype-system-identifier-(single-quoted)-state">DOCTYPE system identifier (single-quoted) state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Switch to the <a href="#bogus-doctype-state">bogus
   DOCTYPE state</a>.</dd>

  </dl><h5 id="between-doctype-public-and-system-identifiers-state"><span class="secno">9.2.4.62 </span><dfn>Between DOCTYPE public and system identifiers state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#between-doctype-public-and-system-identifiers-state">between DOCTYPE public and system identifiers
   state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dd>Set the DOCTYPE token's system identifier to the empty string
   (not missing), then switch to the <a href="#doctype-system-identifier-(double-quoted)-state">DOCTYPE system identifier
   (double-quoted) state</a>.</dd>

   <dt>U+0027 APOSTROPHE (')</dt>
   <dd>Set the DOCTYPE token's system identifier to the empty string
   (not missing), then switch to the <a href="#doctype-system-identifier-(single-quoted)-state">DOCTYPE system identifier
   (single-quoted) state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Switch to the <a href="#bogus-doctype-state">bogus
   DOCTYPE state</a>.</dd>

  </dl><h5 id="after-doctype-system-keyword-state"><span class="secno">9.2.4.63 </span><dfn>After DOCTYPE system keyword state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Switch to the <a href="#before-doctype-system-identifier-state">before DOCTYPE system identifier
   state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's system
   identifier to the empty string (not missing), then switch to the
   <a href="#doctype-system-identifier-(double-quoted)-state">DOCTYPE system identifier (double-quoted) state</a>.</dd>

   <dt>U+0027 APOSTROPHE (')</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's system
   identifier to the empty string (not missing), then switch to the
   <a href="#doctype-system-identifier-(single-quoted)-state">DOCTYPE system identifier (single-quoted) state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Switch to the <a href="#bogus-doctype-state">bogus
   DOCTYPE state</a>.</dd>

  </dl><h5 id="before-doctype-system-identifier-state"><span class="secno">9.2.4.64 </span><dfn>Before DOCTYPE system identifier state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#before-doctype-system-identifier-state">before DOCTYPE system identifier state</a>.</dd>

   <dt>U+0022 QUOTATION MARK (")</dt>
   <dd>Set the DOCTYPE token's system identifier to the empty string
   (not missing), then switch to the <a href="#doctype-system-identifier-(double-quoted)-state">DOCTYPE system identifier
   (double-quoted) state</a>.</dd>

   <dt>U+0027 APOSTROPHE (')</dt>
   <dd>Set the DOCTYPE token's system identifier to the empty string
   (not missing), then switch to the <a href="#doctype-system-identifier-(single-quoted)-state">DOCTYPE system identifier
   (single-quoted) state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Switch to the <a href="#bogus-doctype-state">bogus
   DOCTYPE state</a>.</dd>

  </dl><h5 id="doctype-system-identifier-(double-quoted)-state"><span class="secno">9.2.4.65 </span><dfn>DOCTYPE system identifier (double-quoted) state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0022 QUOTATION MARK (")</dt>
   <dd>Switch to the <a href="#after-doctype-system-identifier-state">after DOCTYPE system identifier
   state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   DOCTYPE token's system identifier. Stay in the <a href="#doctype-system-identifier-(double-quoted)-state">DOCTYPE system
   identifier (double-quoted) state</a>.</dd>

  </dl><h5 id="doctype-system-identifier-(single-quoted)-state"><span class="secno">9.2.4.66 </span><dfn>DOCTYPE system identifier (single-quoted) state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0027 APOSTROPHE (')</dt>
   <dd>Switch to the <a href="#after-doctype-system-identifier-state">after DOCTYPE system identifier
   state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE
   token. Switch to the <a href="#data-state">data state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Append the <a href="parsing.html#current-input-character">current input character</a> to the current
   DOCTYPE token's system identifier. Stay in the <a href="#doctype-system-identifier-(single-quoted)-state">DOCTYPE system
   identifier (single-quoted) state</a>.</dd>

  </dl><h5 id="after-doctype-system-identifier-state"><span class="secno">9.2.4.67 </span><dfn>After DOCTYPE system identifier state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dd>Stay in the <a href="#after-doctype-system-identifier-state">after DOCTYPE system identifier
   state</a>.</dd>

   <dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>EOF</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>. Emit that DOCTYPE token.
   Reconsume the EOF character in the <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd><a href="parsing.html#parse-error">Parse error</a>. Switch to the <a href="#bogus-doctype-state">bogus DOCTYPE
   state</a>. (This does <em>not</em> set the DOCTYPE token's
   <i>force-quirks flag</i> to <i>on</i>.)</dd>

  </dl><h5 id="bogus-doctype-state"><span class="secno">9.2.4.68 </span><dfn>Bogus DOCTYPE state</dfn></h5>

  <p>Consume the <a href="parsing.html#next-input-character">next input character</a>:</p>

  <dl class="switch"><dt>U+003E GREATER-THAN SIGN (&gt;)</dt>
   <dd>Emit the DOCTYPE token. Switch to the <a href="#data-state">data
   state</a>.</dd>

   <dt>EOF</dt>
   <dd>Emit the DOCTYPE token. Reconsume the EOF character in the
   <a href="#data-state">data state</a>.</dd>

   <dt>Anything else</dt>
   <dd>Stay in the <a href="#bogus-doctype-state">bogus DOCTYPE state</a>.</dd>

  </dl><h5 id="cdata-section-state"><span class="secno">9.2.4.69 </span><dfn>CDATA section state</dfn></h5>

  <p>Consume every character up to the next occurrence of the three
  character sequence U+005D RIGHT SQUARE BRACKET U+005D RIGHT SQUARE
  BRACKET U+003E GREATER-THAN SIGN (<code title="">]]&gt;</code>), or the
  end of the file (EOF), whichever comes first. Emit a series of
  character tokens consisting of all the characters consumed except
  the matching three character sequence at the end (if one was found
  before the end of the file).</p>

  <p>Switch to the <a href="#data-state">data state</a>.</p>

  <p>If the end of the file was reached, reconsume the EOF
  character.</p>



  <h5 id="tokenizing-character-references"><span class="secno">9.2.4.70 </span>Tokenizing character references</h5>

  <p>This section defines how to <dfn id="consume-a-character-reference">consume a character
  reference</dfn>. This definition is used when parsing character
  references <a href="#character-reference-in-data-state" title="character reference in data state">in
  text</a> and <a href="#character-reference-in-attribute-value-state" title="character reference in attribute value
  state">in attributes</a>.</p>

  <p>The behavior depends on the identity of the next character (the
  one immediately after the U+0026 AMPERSAND character):</p>

  <dl class="switch"><dt>U+0009 CHARACTER TABULATION</dt>
   <dt>U+000A LINE FEED (LF)</dt>
   <dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->
   <dt>U+0020 SPACE</dt>
   <dt>U+003C LESS-THAN SIGN</dt>
   <dt>U+0026 AMPERSAND</dt>
   <dt>EOF</dt>
   <dt>The <dfn id="additional-allowed-character">additional allowed character</dfn>, if there is one</dt>

   <dd>Not a character reference. No characters are consumed, and
   nothing is returned. (This is not an error, either.)</dd>


   <dt>U+0023 NUMBER SIGN (#)</dt>

   <dd>

    <p>Consume the U+0023 NUMBER SIGN.</p>

    <p>The behavior further depends on the character after the U+0023
    NUMBER SIGN:</p>

    <dl class="switch"><dt>U+0078 LATIN SMALL LETTER X</dt>
     <dt>U+0058 LATIN CAPITAL LETTER X</dt>

     <dd>

      <p>Consume the X.</p>

      <p>Follow the steps below, but using the range of characters
      U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9), U+0061 LATIN
      SMALL LETTER A to U+0066 LATIN SMALL LETTER F, and U+0041 LATIN
      CAPITAL LETTER A to U+0046 LATIN CAPITAL LETTER F (in other
      words, 0-9, A-F, a-f).</p>

      <p>When it comes to interpreting the number, interpret it as a
      hexadecimal number.</p>

     </dd>


     <dt>Anything else</dt>

     <dd>

      <p>Follow the steps below, but using the range of characters
      U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9).</p>

      <p>When it comes to interpreting the number, interpret it as a
      decimal number.</p>

     </dd>

    </dl><p>Consume as many characters as match the range of characters
    given above.</p>

    <p>If no characters match the range, then don't consume any
    characters (and unconsume the U+0023 NUMBER SIGN character and, if
    appropriate, the X character). This is a <a href="parsing.html#parse-error">parse
    error</a>; nothing is returned.</p>

    <p>Otherwise, if the next character is a U+003B SEMICOLON, consume
    that too. If it isn't, there is a <a href="parsing.html#parse-error">parse
    error</a>.</p>

    <p>If one or more characters match the range, then take them all
    and interpret the string of characters as a number (either
    hexadecimal or decimal as appropriate).</p>

    <p>If that number is one of the numbers in the first column of the
    following table, then this is a <a href="parsing.html#parse-error">parse error</a>. Find the
    row with that number in the first column, and return a character
    token for the Unicode character given in the second column of that
    row.</p>

    <table><thead><tr><th>Number <th colspan="2">Unicode character
     <tbody><tr><td>0x00 <td>U+FFFD <td>REPLACEMENT CHARACTER
      <tr><td>0x0D <td>U+000A <td>LINE FEED (LF)
      <tr><td>0x80 <td>U+20AC <td>EURO SIGN (&euro;)
      <tr><td>0x81 <td>U+0081 <td>&lt;control&gt;
      <tr><td>0x82 <td>U+201A <td>SINGLE LOW-9 QUOTATION MARK (&sbquo;)
      <tr><td>0x83 <td>U+0192 <td>LATIN SMALL LETTER F WITH HOOK (&fnof;)
      <tr><td>0x84 <td>U+201E <td>DOUBLE LOW-9 QUOTATION MARK (&bdquo;)
      <tr><td>0x85 <td>U+2026 <td>HORIZONTAL ELLIPSIS (&hellip;)
      <tr><td>0x86 <td>U+2020 <td>DAGGER (&dagger;)
      <tr><td>0x87 <td>U+2021 <td>DOUBLE DAGGER (&Dagger;)
      <tr><td>0x88 <td>U+02C6 <td>MODIFIER LETTER CIRCUMFLEX ACCENT (&circ;)
      <tr><td>0x89 <td>U+2030 <td>PER MILLE SIGN (&permil;)
      <tr><td>0x8A <td>U+0160 <td>LATIN CAPITAL LETTER S WITH CARON (&Scaron;)
      <tr><td>0x8B <td>U+2039 <td>SINGLE LEFT-POINTING ANGLE QUOTATION MARK (&lsaquo;)
      <tr><td>0x8C <td>U+0152 <td>LATIN CAPITAL LIGATURE OE (&OElig;)
      <tr><td>0x8D <td>U+008D <td>&lt;control&gt;
      <tr><td>0x8E <td>U+017D <td>LATIN CAPITAL LETTER Z WITH CARON (&#381;)
      <tr><td>0x8F <td>U+008F <td>&lt;control&gt;
      <tr><td>0x90 <td>U+0090 <td>&lt;control&gt;
      <tr><td>0x91 <td>U+2018 <td>LEFT SINGLE QUOTATION MARK (&lsquo;)
      <tr><td>0x92 <td>U+2019 <td>RIGHT SINGLE QUOTATION MARK (&rsquo;)
      <tr><td>0x93 <td>U+201C <td>LEFT DOUBLE QUOTATION MARK (&ldquo;)
      <tr><td>0x94 <td>U+201D <td>RIGHT DOUBLE QUOTATION MARK (&rdquo;)
      <tr><td>0x95 <td>U+2022 <td>BULLET (&bull;)
      <tr><td>0x96 <td>U+2013 <td>EN DASH (&ndash;)
      <tr><td>0x97 <td>U+2014 <td>EM DASH (&mdash;)
      <tr><td>0x98 <td>U+02DC <td>SMALL TILDE (&tilde;)
      <tr><td>0x99 <td>U+2122 <td>TRADE MARK SIGN (&trade;)
      <tr><td>0x9A <td>U+0161 <td>LATIN SMALL LETTER S WITH CARON (&scaron;)
      <tr><td>0x9B <td>U+203A <td>SINGLE RIGHT-POINTING ANGLE QUOTATION MARK (&rsaquo;)
      <tr><td>0x9C <td>U+0153 <td>LATIN SMALL LIGATURE OE (&oelig;)
      <tr><td>0x9D <td>U+009D <td>&lt;control&gt;
      <tr><td>0x9E <td>U+017E <td>LATIN SMALL LETTER Z WITH CARON (&#382;)
      <tr><td>0x9F <td>U+0178 <td>LATIN CAPITAL LETTER Y WITH DIAERESIS (&Yuml;)
    </table><p>Otherwise, if the number is in the range 0xD800 to 0xDFFF<!--
    surrogates not allowed; see the comment in the "preprocessing the
    input stream" section for details --> or is greater than 0x10FFFF,
    then this is a <a href="parsing.html#parse-error">parse error</a>. Return a U+FFFD
    REPLACEMENT CHARACTER.</p>

    <p>Otherwise, return a character token for the Unicode character
    whose code point is that number.

    <!-- this is the same as the equivalent list in the input stream
    section -->
    If the number is in the range 0x0001 to 0x0008, <!-- HT, LF
    allowed --> <!-- U+000B is in the next list --> <!-- FF, CR
    allowed --> 0x000E to 0x001F, <!-- ASCII allowed --> 0x007F <!--to
    0x0084, (0x0085 NEL not allowed), 0x0086--> to 0x009F, 0xFDD0 to
    0xFDEF, or is one of 0x000B, 0xFFFE, 0xFFFF, 0x1FFFE, 0x1FFFF,
    0x2FFFE, 0x2FFFF, 0x3FFFE, 0x3FFFF, 0x4FFFE, 0x4FFFF, 0x5FFFE,
    0x5FFFF, 0x6FFFE, 0x6FFFF, 0x7FFFE, 0x7FFFF, 0x8FFFE, 0x8FFFF,
    0x9FFFE, 0x9FFFF, 0xAFFFE, 0xAFFFF, 0xBFFFE, 0xBFFFF, 0xCFFFE,
    0xCFFFF, 0xDFFFE, 0xDFFFF, 0xEFFFE, 0xEFFFF, 0xFFFFE, 0xFFFFF,
    0x10FFFE, or 0x10FFFF, then this is a <a href="parsing.html#parse-error">parse
    error</a>.</p>

   </dd>


   <dt>Anything else</dt>

   <dd>

    <p>Consume the maximum number of characters possible, with the
    consumed characters matching one of the identifiers in the first
    column of the <a href="named-character-references.html#named-character-references">named character references</a> table (in a
    <a href="infrastructure.html#case-sensitive">case-sensitive</a> manner).</p>

    <p>If no match can be made, then this is a <a href="parsing.html#parse-error">parse
    error</a>. No characters are consumed, and nothing is
    returned.</p>

    <p>If the last character matched is not a U+003B SEMICOLON
    character (;), there is a <a href="parsing.html#parse-error">parse error</a>.</p>

    <p>If the character reference is being consumed <a href="#character-reference-in-attribute-value-state" title="character reference in attribute value state">as part of an
    attribute</a>, and the last character matched is not a U+003B
    SEMICOLON character (;), and the next character is in the range
    U+0030 DIGIT ZERO (0) to U+0039 DIGIT NINE (9), U+0041 LATIN
    CAPITAL LETTER A to U+005A LATIN CAPITAL LETTER Z, or U+0061 LATIN
    SMALL LETTER A to U+007A LATIN SMALL LETTER Z, then, for
    historical reasons, all the characters that were matched after the
    U+0026 AMPERSAND character (&amp;) must be unconsumed, and nothing
    is returned.</p>

    <p>Otherwise, return a character token for the character
    corresponding to the character reference name (as given by the
    second column of the <a href="named-character-references.html#named-character-references">named character references</a>
    table).</p>

    <div class="example">

     <p>If the markup contains <code title="">I'm &amp;notit; I tell
     you</code>, the character reference is parsed as "not", as in,
     <code title="">I'm &not;it; I tell you</code>. But if the markup
     was <code title="">I'm &amp;notin; I tell you</code>, the
     character reference would be parsed as "notin;", resulting in
     <code title="">I'm &notin; I tell you</code>.</p>

    </div>

   </dd>

  </dl></div>


  <div class="impl">

  <!-- v2: One thing that this doesn't define is handling deeply
  nested documents. There are compatibility requirements around that:
  you can't throw away the elements altogether, consider Tux made only
  with opening <font> elements, one per character. Seems that the best
  thing to do is to close some formatting elements from the middle of
  the stack when you hit a limit, or something. -->

  <h4 id="tree-construction"><span class="secno">9.2.5 </span><dfn>Tree construction</dfn></h4>

  <p>The input to the tree construction stage is a sequence of tokens
  from the <a href="#tokenization">tokenization</a> stage. The tree construction
  stage is associated with a DOM <code>Document</code> object when a
  parser is created. The "output" of this stage consists of
  dynamically modifying or extending that document's DOM tree.</p>

  <p>This specification does not define when an interactive user agent
  has to render the <code>Document</code> so that it is available to
  the user, or when it has to begin accepting user input.</p>

  <p>As each token is emitted from the tokenizer, the user agent must
  process the token according to the rules given in the section
  corresponding to the current <a href="parsing.html#insertion-mode">insertion mode</a>.</p>

  <p>When the steps below require the UA to <dfn id="insert-a-character">insert a
  character</dfn> into a node, if that node has a child immediately
  before where the character is to be inserted, and that child is a
  <code>Text</code> node, and that <code>Text</code> node was the last
  node that the parser inserted into the document, then the character
  must be appended to that <code>Text</code> node; otherwise, a new
  <code>Text</code> node whose data is just that character must be
  inserted in the appropriate place.</p>

  <div class="example">

   <p>Here are some sample inputs to the parser and the corresponding
   number of text nodes that they result in, assuming a user agent
   that executes scripts.</p>

   <table><thead><tr><th>Input <th>Number of text nodes
    <tbody><tr><td><pre>A&lt;script&gt;
var&nbsp;script&nbsp;=&nbsp;document.getElementsByTagName('script')[0];
document.body.removeChild(script);
&lt;/script&gt;B</pre>
      <td>Two adjacent text nodes in the document, containing "A" and "B".
     <tr><td><pre>A&lt;script&gt;
var&nbsp;text&nbsp;=&nbsp;document.createTextNode('B');
document.body.appendChild(text);
&lt;/script&gt;C</pre>
      <td>Four text nodes; "A" before the script, the script's contents, "B" after the script, and then, immediately after that, "C".
     <tr><td><pre>A&lt;script&gt;
var&nbsp;text&nbsp;=&nbsp;document.getElementsByTagName('script')[0].firstChild;
text.data&nbsp;=&nbsp;'B';
document.body.appendChild(text);
&lt;/script&gt;B</pre>
      <td>Two adjacent text nodes in the document, containing "A" and "BB".
     <tr><td><pre>A&lt;table&gt;B&lt;tr&gt;C&lt;/tr&gt;C&lt;/table&gt;</pre>
      <td>Three adjacent text nodes before the table, containing "A", "B", and "CC" respectively. (This is caused by <a href="#foster-parent" title="foster parent">foster parenting</a>.)
     <tr><td><pre>A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;B&lt;/table&gt;</pre>
      <td>Two adjacent text nodes before the table, containing "A" and "&nbsp;B&nbsp;B" (space-B-space-B) respectively. (This is caused by <a href="#foster-parent" title="foster parent">foster parenting</a>.)
     <tr><td><pre>A&lt;table&gt;&lt;tr&gt;&nbsp;B&lt;/tr&gt;&nbsp;&lt;/em&gt;C&lt;/table&gt;</pre>
      <td>Three adjacent text nodes before the table, containing "A", "&nbsp;B" (space-B), and "C" respectively, and one text node inside the table (as a child of a <code><a href="tabular-data.html#the-tbody-element">tbody</a></code>) with a single space character. (Space characters separated from non-space characters by non-character tokens are not affected by <a href="#foster-parent" title="foster parent">foster parenting</a>, even if those other tokens then get ignored.)
   </table></div>

  <p id="mutation-during-parsing">DOM mutation events must not fire
  for changes caused by the UA parsing the document. (Conceptually,
  the parser is not mutating the DOM, it is constructing it.) This
  includes the parsing of any content inserted using <code title="dom-document-write"><a href="apis-in-html-documents.html#dom-document-write">document.write()</a></code> and <code title="dom-document-writeln"><a href="apis-in-html-documents.html#dom-document-writeln">document.writeln()</a></code> calls. <a href="references.html#refsDOMEVENTS">[DOMEVENTS]</a></p>

  <p class="note">Not all of the tag names mentioned below are
  conformant tag names in this specification; many are included to
  handle legacy content. They still form part of the algorithm that
  implementations are required to implement to claim conformance.</p>

  <p class="note">The algorithm described below places no limit on the
  depth of the DOM tree generated, or on the length of tag names,
  attribute names, attribute values, text nodes, etc. While
  implementors are encouraged to avoid arbitrary limits, it is
  recognized that <a href="infrastructure.html#hardwareLimitations">practical
  concerns</a> will likely force user agents to impose nesting depth
  constraints.</p>


  <h5 id="creating-and-inserting-elements"><span class="secno">9.2.5.1 </span>Creating and inserting elements</h5>

  <p>When the steps below require the UA to <dfn id="create-an-element-for-the-token" title="create an
  element for the token">create an element for a token</dfn> in a
  particular namespace, the UA must create a node implementing the
  interface appropriate for the element type corresponding to the tag
  name of the token in the given namespace (as given in the
  specification that defines that element, e.g. for an <code><a href="text-level-semantics.html#the-a-element">a</a></code>
  element in the <a href="the-end.html#html-namespace-0">HTML namespace</a>, this specification
  defines it to be the <code><a href="text-level-semantics.html#htmlanchorelement">HTMLAnchorElement</a></code> interface), with
  the tag name being the name of that element, with the node being in
  the given namespace, and with the attributes on the node being those
  given in the given token.</p>

  <p>The interface appropriate for an element in the <a href="the-end.html#html-namespace-0">HTML
  namespace</a> that is not defined in this specification (or
  <a href="infrastructure.html#other-applicable-specifications">other applicable specifications</a>) is
  <code><a href="elements.html#htmlunknownelement">HTMLUnknownElement</a></code>. Element in other namespaces whose
  interface is not defined by that namespace's specification must use
  the interface <code>Element</code>.</p>

  <p>When a <a href="forms.html#category-reset" title="category-reset">resettable</a> element is
  created in this manner, its <a href="association-of-controls-and-forms.html#concept-form-reset-control" title="concept-form-reset-control">reset algorithm</a> must be
  invoked once the attributes are set. (This initializes the element's
  <a href="association-of-controls-and-forms.html#concept-fe-value" title="concept-fe-value">value</a> and <a href="association-of-controls-and-forms.html#concept-fe-checked" title="concept-fe-checked">checkedness</a> based on the element's
  attributes.)</p>

  <hr><p>When the steps below require the UA to <dfn id="insert-an-html-element">insert an HTML
  element</dfn> for a token, the UA must first <a href="#create-an-element-for-the-token">create an element
  for the token</a> in the <a href="the-end.html#html-namespace-0">HTML namespace</a>, and then
  append this node to the <a href="parsing.html#current-node">current node</a>, and push it onto
  the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> so that it is the new
  <a href="parsing.html#current-node">current node</a>.</p>

  <p>The steps below may also require that the UA insert an HTML
  element in a particular place, in which case the UA must follow the
  same steps except that it must insert or append the new node in the
  location specified instead of appending it to the <a href="parsing.html#current-node">current
  node</a>. (This happens in particular during the parsing of
  tables with invalid content.)</p>

  <p>If an element created by the <a href="#insert-an-html-element">insert an HTML element</a>
  algorithm is a <a href="forms.html#form-associated-element">form-associated element</a>, and the
  <a href="parsing.html#form-element-pointer"><code title="">form</code> element pointer</a> is not null,
  and the newly created element doesn't have a <code title="attr-fae-form"><a href="association-of-controls-and-forms.html#attr-fae-form">form</a></code> attribute, the user agent must
  <a href="association-of-controls-and-forms.html#concept-form-association" title="concept-form-association">associate</a> the newly
  created element with the <code><a href="forms.html#the-form-element">form</a></code> element pointed to by the
  <a href="parsing.html#form-element-pointer"><code title="">form</code> element pointer</a> before
  inserting it wherever it is to be inserted.</p>

  <hr><p>When the steps below require the UA to <dfn id="insert-a-foreign-element">insert a foreign
  element</dfn> for a token, the UA must first <a href="#create-an-element-for-the-token">create an element
  for the token</a> in the given namespace, and then append this
  node to the <a href="parsing.html#current-node">current node</a>, and push it onto the
  <a href="parsing.html#stack-of-open-elements">stack of open elements</a> so that it is the new
  <a href="parsing.html#current-node">current node</a>. If the newly created element has an <code title="">xmlns</code> attribute in the <a href="the-end.html#xmlns-namespace">XMLNS namespace</a>
  whose value is not exactly the same as the element's namespace, that
  is a <a href="parsing.html#parse-error">parse error</a>. Similarly, if the newly created
  element has an <code title="">xmlns:xlink</code> attribute in the
  <a href="the-end.html#xmlns-namespace">XMLNS namespace</a> whose value is not the <a href="the-end.html#xlink-namespace">XLink
  Namespace</a>, that is a <a href="parsing.html#parse-error">parse error</a>.</p>

  <p>When the steps below require the user agent to <dfn id="adjust-mathml-attributes">adjust MathML
  attributes</dfn> for a token, then, if the token has an attribute
  named <code title="">definitionurl</code>, change its name to <code title="">definitionURL</code> (note the case difference).</p>

  <p>When the steps below require the user agent to <dfn id="adjust-svg-attributes">adjust SVG
  attributes</dfn> for a token, then, for each attribute on the token
  whose attribute name is one of the ones in the first column of the
  following table, change the attribute's name to the name given in
  the corresponding cell in the second column. (This fixes the case of
  SVG attributes that are not all lowercase.)</p>

  <table><thead><tr><th> Attribute name on token <th> Attribute name on element
   <tbody><tr><td> <code title="">attributename</code> <td> <code title="">attributeName</code>
    <tr><td> <code title="">attributetype</code> <td> <code title="">attributeType</code>
    <tr><td> <code title="">basefrequency</code> <td> <code title="">baseFrequency</code>
    <tr><td> <code title="">baseprofile</code> <td> <code title="">baseProfile</code>
    <tr><td> <code title="">calcmode</code> <td> <code title="">calcMode</code>
    <tr><td> <code title="">clippathunits</code> <td> <code title="">clipPathUnits</code>
    <tr><td> <code title="">contentscripttype</code> <td> <code title="">contentScriptType</code>
    <tr><td> <code title="">contentstyletype</code> <td> <code title="">contentStyleType</code>
    <tr><td> <code title="">diffuseconstant</code> <td> <code title="">diffuseConstant</code>
    <tr><td> <code title="">edgemode</code> <td> <code title="">edgeMode</code>
    <tr><td> <code title="">externalresourcesrequired</code> <td> <code title="">externalResourcesRequired</code>
    <tr><td> <code title="">filterres</code> <td> <code title="">filterRes</code>
    <tr><td> <code title="">filterunits</code> <td> <code title="">filterUnits</code>
    <tr><td> <code title="">glyphref</code> <td> <code title="">glyphRef</code>
    <tr><td> <code title="">gradienttransform</code> <td> <code title="">gradientTransform</code>
    <tr><td> <code title="">gradientunits</code> <td> <code title="">gradientUnits</code>
    <tr><td> <code title="">kernelmatrix</code> <td> <code title="">kernelMatrix</code>
    <tr><td> <code title="">kernelunitlength</code> <td> <code title="">kernelUnitLength</code>
    <tr><td> <code title="">keypoints</code> <td> <code title="">keyPoints</code>
    <tr><td> <code title="">keysplines</code> <td> <code title="">keySplines</code>
    <tr><td> <code title="">keytimes</code> <td> <code title="">keyTimes</code>
    <tr><td> <code title="">lengthadjust</code> <td> <code title="">lengthAdjust</code>
    <tr><td> <code title="">limitingconeangle</code> <td> <code title="">limitingConeAngle</code>
    <tr><td> <code title="">markerheight</code> <td> <code title="">markerHeight</code>
    <tr><td> <code title="">markerunits</code> <td> <code title="">markerUnits</code>
    <tr><td> <code title="">markerwidth</code> <td> <code title="">markerWidth</code>
    <tr><td> <code title="">maskcontentunits</code> <td> <code title="">maskContentUnits</code>
    <tr><td> <code title="">maskunits</code> <td> <code title="">maskUnits</code>
    <tr><td> <code title="">numoctaves</code> <td> <code title="">numOctaves</code>
    <tr><td> <code title="">pathlength</code> <td> <code title="">pathLength</code>
    <tr><td> <code title="">patterncontentunits</code> <td> <code title="">patternContentUnits</code>
    <tr><td> <code title="">patterntransform</code> <td> <code title="">patternTransform</code>
    <tr><td> <code title="">patternunits</code> <td> <code title="">patternUnits</code>
    <tr><td> <code title="">pointsatx</code> <td> <code title="">pointsAtX</code>
    <tr><td> <code title="">pointsaty</code> <td> <code title="">pointsAtY</code>
    <tr><td> <code title="">pointsatz</code> <td> <code title="">pointsAtZ</code>
    <tr><td> <code title="">preservealpha</code> <td> <code title="">preserveAlpha</code>
    <tr><td> <code title="">preserveaspectratio</code> <td> <code title="">preserveAspectRatio</code>
    <tr><td> <code title="">primitiveunits</code> <td> <code title="">primitiveUnits</code>
    <tr><td> <code title="">refx</code> <td> <code title="">refX</code>
    <tr><td> <code title="">refy</code> <td> <code title="">refY</code>
    <tr><td> <code title="">repeatcount</code> <td> <code title="">repeatCount</code>
    <tr><td> <code title="">repeatdur</code> <td> <code title="">repeatDur</code>
    <tr><td> <code title="">requiredextensions</code> <td> <code title="">requiredExtensions</code>
    <tr><td> <code title="">requiredfeatures</code> <td> <code title="">requiredFeatures</code>
    <tr><td> <code title="">specularconstant</code> <td> <code title="">specularConstant</code>
    <tr><td> <code title="">specularexponent</code> <td> <code title="">specularExponent</code>
    <tr><td> <code title="">spreadmethod</code> <td> <code title="">spreadMethod</code>
    <tr><td> <code title="">startoffset</code> <td> <code title="">startOffset</code>
    <tr><td> <code title="">stddeviation</code> <td> <code title="">stdDeviation</code>
    <tr><td> <code title="">stitchtiles</code> <td> <code title="">stitchTiles</code>
    <tr><td> <code title="">surfacescale</code> <td> <code title="">surfaceScale</code>
    <tr><td> <code title="">systemlanguage</code> <td> <code title="">systemLanguage</code>
    <tr><td> <code title="">tablevalues</code> <td> <code title="">tableValues</code>
    <tr><td> <code title="">targetx</code> <td> <code title="">targetX</code>
    <tr><td> <code title="">targety</code> <td> <code title="">targetY</code>
    <tr><td> <code title="">textlength</code> <td> <code title="">textLength</code>
    <tr><td> <code title="">viewbox</code> <td> <code title="">viewBox</code>
    <tr><td> <code title="">viewtarget</code> <td> <code title="">viewTarget</code>
    <tr><td> <code title="">xchannelselector</code> <td> <code title="">xChannelSelector</code>
    <tr><td> <code title="">ychannelselector</code> <td> <code title="">yChannelSelector</code>
    <tr><td> <code title="">zoomandpan</code> <td> <code title="">zoomAndPan</code>
  </table><p>When the steps below require the user agent to <dfn id="adjust-foreign-attributes">adjust
  foreign attributes</dfn> for a token, then, if any of the attributes
  on the token match the strings given in the first column of the
  following table, let the attribute be a namespaced attribute, with
  the prefix being the string given in the corresponding cell in the
  second column, the local name being the string given in the
  corresponding cell in the third column, and the namespace being the
  namespace given in the corresponding cell in the fourth
  column. (This fixes the use of namespaced attributes, in particular
  <a href="elements.html#attr-xml-lang" title="attr-xml-lang"><code title="">lang</code> attributes in
  the <span>XML namespace</span></a>.)</p>

  <table><thead><tr><th> Attribute name <th> Prefix <th> Local name <th> Namespace
   <tbody><tr><td> <code title="">xlink:actuate</code> <td> <code title="">xlink</code> <td> <code title="">actuate</code> <td> <a href="the-end.html#xlink-namespace">XLink namespace</a>
    <tr><td> <code title="">xlink:arcrole</code> <td> <code title="">xlink</code> <td> <code title="">arcrole</code> <td> <a href="the-end.html#xlink-namespace">XLink namespace</a>
    <tr><td> <code title="">xlink:href</code> <td> <code title="">xlink</code> <td> <code title="">href</code> <td> <a href="the-end.html#xlink-namespace">XLink namespace</a>
    <tr><td> <code title="">xlink:role</code> <td> <code title="">xlink</code> <td> <code title="">role</code> <td> <a href="the-end.html#xlink-namespace">XLink namespace</a>
    <tr><td> <code title="">xlink:show</code> <td> <code title="">xlink</code> <td> <code title="">show</code> <td> <a href="the-end.html#xlink-namespace">XLink namespace</a>
    <tr><td> <code title="">xlink:title</code> <td> <code title="">xlink</code> <td> <code title="">title</code> <td> <a href="the-end.html#xlink-namespace">XLink namespace</a>
    <tr><td> <code title="">xlink:type</code> <td> <code title="">xlink</code> <td> <code title="">type</code> <td> <a href="the-end.html#xlink-namespace">XLink namespace</a>
    <tr><td> <code title="">xml:base</code> <td> <code title="">xml</code> <td> <code title="">base</code> <td> <a href="the-end.html#xml-namespace">XML namespace</a> <!-- attr-xml-base -->
    <tr><td> <code title="">xml:lang</code> <td> <code title="">xml</code> <td> <code title="">lang</code> <td> <a href="the-end.html#xml-namespace">XML namespace</a>
    <tr><td> <code title="">xml:space</code> <td> <code title="">xml</code> <td> <code title="">space</code> <td> <a href="the-end.html#xml-namespace">XML namespace</a>
    <tr><td> <code title="">xmlns</code> <td> (none) <td> <code title="">xmlns</code> <td> <a href="the-end.html#xmlns-namespace">XMLNS namespace</a>
    <tr><td> <code title="">xmlns:xlink</code> <td> <code title="">xmlns</code> <td> <code title="">xlink</code> <td> <a href="the-end.html#xmlns-namespace">XMLNS namespace</a>
  </table><hr><p>The <dfn id="generic-raw-text-element-parsing-algorithm">generic raw text element parsing algorithm</dfn> and the
  <dfn id="generic-rcdata-element-parsing-algorithm">generic RCDATA element parsing algorithm</dfn> consist of the
  following steps. These algorithms are always invoked in response to
  a start tag token.</p>

  <ol><li><p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</li>

   <li><p>If the algorithm that was invoked is the <a href="#generic-raw-text-element-parsing-algorithm">generic raw
   text element parsing algorithm</a>, switch the tokenizer to the
   <a href="#rawtext-state">RAWTEXT state</a>; otherwise the algorithm invoked
   was the <a href="#generic-rcdata-element-parsing-algorithm">generic RCDATA element parsing algorithm</a>,
   switch the tokenizer to the <a href="#rcdata-state">RCDATA state</a>.</li>

   <li><p>Let the <a href="parsing.html#original-insertion-mode">original insertion mode</a> be the current
   <a href="parsing.html#insertion-mode">insertion mode</a>.</p>

   <li><p>Then, switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-incdata" title="insertion mode: text">text</a>".</li>

  </ol><h5 id="closing-elements-that-have-implied-end-tags"><span class="secno">9.2.5.2 </span>Closing elements that have implied end tags</h5>

  <p>When the steps below require the UA to <dfn id="generate-implied-end-tags">generate implied end
  tags</dfn>, then, while the <a href="parsing.html#current-node">current node</a> is a
  <code><a href="grouping-content.html#the-dd-element">dd</a></code> element, a <code><a href="grouping-content.html#the-dt-element">dt</a></code> element, an
  <code><a href="grouping-content.html#the-li-element">li</a></code> element, an <code><a href="the-button-element.html#the-option-element">option</a></code> element, an
  <code><a href="the-button-element.html#the-optgroup-element">optgroup</a></code> element, a <code><a href="grouping-content.html#the-p-element">p</a></code> element, an
  <code><a href="text-level-semantics.html#the-rp-element">rp</a></code> element, or an <code><a href="text-level-semantics.html#the-rt-element">rt</a></code> element, the UA must
  pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
  elements</a>.</p>

  <p>If a step requires the UA to generate implied end tags but lists
  an element to exclude from the process, then the UA must perform the
  above steps as if that element was not in the above list.</p>


  <h5 id="foster-parenting"><span class="secno">9.2.5.3 </span>Foster parenting</h5>

  <p>Foster parenting happens when content is misnested in tables.</p>

  <p>When a node <var title="">node</var> is to be <dfn id="foster-parent" title="foster
  parent">foster parented</dfn>, the node <var title="">node</var>
  must be inserted into the <i><a href="#foster-parent-element">foster parent element</a></i>.</p>

  <p>The <dfn id="foster-parent-element">foster parent element</dfn> is the parent element of the
  last <code><a href="tabular-data.html#the-table-element">table</a></code> element in the <a href="parsing.html#stack-of-open-elements">stack of open
  elements</a>, if there is a <code><a href="tabular-data.html#the-table-element">table</a></code> element and it has
  such a parent element. If there is no <code><a href="tabular-data.html#the-table-element">table</a></code> element in
  the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> (<a href="the-end.html#fragment-case">fragment
  case</a>), then the <i><a href="#foster-parent-element">foster parent element</a></i> is the first
  element in the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> (the
  <code><a href="semantics.html#the-html-element-0">html</a></code> element). Otherwise, if there is a
  <code><a href="tabular-data.html#the-table-element">table</a></code> element in the <a href="parsing.html#stack-of-open-elements">stack of open
  elements</a>, but the last <code><a href="tabular-data.html#the-table-element">table</a></code> element in the
  <a href="parsing.html#stack-of-open-elements">stack of open elements</a> has no parent, or its parent
  node is not an element, then the <i><a href="#foster-parent-element">foster parent element</a></i> is
  the element before the last <code><a href="tabular-data.html#the-table-element">table</a></code> element in the
  <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</p>

  <p>If the <i><a href="#foster-parent-element">foster parent element</a></i> is the parent element of the
  last <code><a href="tabular-data.html#the-table-element">table</a></code> element in the <a href="parsing.html#stack-of-open-elements">stack of open
  elements</a>, then <var title="">node</var> must be inserted
  immediately <em>before</em> the last <code><a href="tabular-data.html#the-table-element">table</a></code> element in
  the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> in the <i><a href="#foster-parent-element">foster parent
  element</a></i>; otherwise, <var title="">node</var> must be
  <em>appended</em> to the <i><a href="#foster-parent-element">foster parent element</a></i>.</p>



  <h5 id="the-initial-insertion-mode"><span class="secno">9.2.5.4 </span>The "<dfn title="insertion mode: initial">initial</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#the-initial-insertion-mode" title="insertion
  mode: initial">initial</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p>Ignore the token.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <code>Document</code>
    object with the <code title="">data</code> attribute set to the
    data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>

    <p>If the DOCTYPE token's name is not a
    <a href="infrastructure.html#case-sensitive">case-sensitive</a> match for the string "<code title="">html</code>", or the token's public identifier is not
    missing, or the token's system identifier is neither missing nor a
    <a href="infrastructure.html#case-sensitive">case-sensitive</a> match for the string
    "<code><a href="urls.html#about:legacy-compat">about:legacy-compat</a></code>", and none of the sets of
    conditions in the following list are matched, then there is a
    <a href="parsing.html#parse-error">parse error</a>. If one of the sets of conditions in the
    following list is matched, then there is an <dfn id="obsolete-permitted-doctype">obsolete
    permitted DOCTYPE</dfn>.</p>

    <ul><!-- only things that trigger no-quirks mode and were valid in
     some other spec are allowed in this list --><li>The DOCTYPE token's name is an <a href="infrastructure.html#ascii-case-insensitive">ASCII
     case-insensitive</a> match for the string "<code title="">html</code>", the token's public identifier is the
     <a href="infrastructure.html#case-sensitive">case-sensitive</a> string "<code title="">-//W3C//DTD&nbsp;HTML&nbsp;4.0//EN</code>", and the
     token's system identifier is either missing or the
     <a href="infrastructure.html#case-sensitive">case-sensitive</a> string "<code title="">http://www.w3.org/TR/REC-html40/strict.dtd</code>".</li>

     <li>The DOCTYPE token's name is an <a href="infrastructure.html#ascii-case-insensitive">ASCII
     case-insensitive</a> match for the string "<code title="">html</code>", the token's public identifier is the
     <a href="infrastructure.html#case-sensitive">case-sensitive</a> string "<code title="">-//W3C//DTD&nbsp;HTML&nbsp;4.01//EN</code>", and the
     token's system identifier is either missing or the
     <a href="infrastructure.html#case-sensitive">case-sensitive</a> string "<code title="">http://www.w3.org/TR/html4/strict.dtd</code>".</li>

     <li>The DOCTYPE token's name is an <a href="infrastructure.html#ascii-case-insensitive">ASCII
     case-insensitive</a> match for the string "<code title="">html</code>", the token's public identifier is the
     <a href="infrastructure.html#case-sensitive">case-sensitive</a> string "<code title="">-//W3C//DTD&nbsp;XHTML&nbsp;1.0&nbsp;Strict//EN</code>",
     and the token's system identifier is the
     <a href="infrastructure.html#case-sensitive">case-sensitive</a> string "<code title="">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</code>".</li>

     <li>The DOCTYPE token's name is an <a href="infrastructure.html#ascii-case-insensitive">ASCII
     case-insensitive</a> match for the string "<code title="">html</code>", the token's public identifier is the
     <a href="infrastructure.html#case-sensitive">case-sensitive</a> string "<code title="">-//W3C//DTD&nbsp;XHTML&nbsp;1.1//EN</code>", and the
     token's system identifier is the <a href="infrastructure.html#case-sensitive">case-sensitive</a>
     string "<code title="">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</code>".</li>

    </ul><p>Conformance checkers may, based on the values (including
    presence or lack thereof) of the DOCTYPE token's name, public
    identifier, or system identifier, switch to a conformance checking
    mode for another language (e.g. based on the DOCTYPE token a
    conformance checker could recognize that the document is an
    HTML4-era document, and defer to an HTML4 conformance
    checker.)</p>

    <p>Append a <code>DocumentType</code> node to the
    <code>Document</code> node, with the <code title="">name</code>
    attribute set to the name given in the DOCTYPE token, or the empty
    string if the name was missing; the <code title="">publicId</code>
    attribute set to the public identifier given in the DOCTYPE token,
    or the empty string if the public identifier was missing; the
    <code title="">systemId</code> attribute set to the system
    identifier given in the DOCTYPE token, or the empty string if the
    system identifier was missing; and the other attributes specific
    to <code>DocumentType</code> objects set to null and empty lists
    as appropriate. Associate the <code>DocumentType</code> node with
    the <code>Document</code> object so that it is returned as the
    value of the <code title="">doctype</code> attribute of the
    <code>Document</code> object.</p>

    <p id="quirks-mode-doctypes">Then, if the DOCTYPE token matches
    one of the conditions in the following list, then set the
    <code>Document</code> to <a href="dom.html#quirks-mode">quirks mode</a>:</p>

    <ul class="brief"><li> The <i>force-quirks flag</i> is set to <i>on</i>. </li>
     <li> The name is set to anything other than "<code title="">HTML</code>". </li>
     <li> The public identifier starts with: "<code title="">+//Silmaril//dtd html Pro v0r11 19970101//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//AdvaSoft Ltd//DTD HTML 3.0 asWedit + extensions//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//AS//DTD HTML 3.0 asWedit + extensions//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 2.0 Level 1//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 2.0 Level 2//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 2.0 Strict Level 1//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 2.0 Strict Level 2//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 2.0 Strict//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 2.0//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 2.1E//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 3.0//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML 3.0//EN//</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 3.2 Final//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 3.2//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML 3//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Level 0//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Level 0//EN//2.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Level 1//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Level 1//EN//2.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Level 2//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Level 2//EN//2.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Level 3//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Level 3//EN//3.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Strict Level 0//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Strict Level 0//EN//2.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Strict Level 1//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Strict Level 1//EN//2.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Strict Level 2//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Strict Level 2//EN//2.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Strict Level 3//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Strict Level 3//EN//3.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML Strict//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Strict//EN//2.0</code>" </li>-->
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML Strict//EN//3.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//IETF//DTD HTML//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML//EN//2.0</code>" </li>-->
   <!--<li> The public identifier is set to: "<code title="">-//IETF//DTD HTML//EN//3.0</code>" </li>-->
     <li> The public identifier starts with: "<code title="">-//Metrius//DTD Metrius Presentational//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Microsoft//DTD Internet Explorer 2.0 HTML Strict//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Microsoft//DTD Internet Explorer 2.0 HTML//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Microsoft//DTD Internet Explorer 2.0 Tables//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Microsoft//DTD Internet Explorer 3.0 HTML Strict//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Microsoft//DTD Internet Explorer 3.0 HTML//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Microsoft//DTD Internet Explorer 3.0 Tables//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Netscape Comm. Corp.//DTD HTML//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Netscape Comm. Corp.//DTD Strict HTML//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//O'Reilly and Associates//DTD HTML 2.0//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//O'Reilly and Associates//DTD HTML Extended 1.0//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//O'Reilly and Associates//DTD HTML Extended Relaxed 1.0//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//SoftQuad Software//DTD HoTMetaL PRO 6.0::19990601::extensions to HTML 4.0//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//SoftQuad//DTD HoTMetaL PRO 4.0::19971010::extensions to HTML 4.0//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Spyglass//DTD HTML 2.0 Extended//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//SQ//DTD HTML 2.0 HoTMetaL + extensions//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Sun Microsystems Corp.//DTD HotJava HTML//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//Sun Microsystems Corp.//DTD HotJava Strict HTML//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML 3 1995-03-24//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML 3.2 Draft//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML 3.2 Final//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML 3.2//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML 3.2S Draft//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML 4.0 Frameset//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML 4.0 Transitional//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML Experimental 19960712//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD HTML Experimental 970421//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD W3 HTML//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3O//DTD W3 HTML 3.0//<!--EN--></code>" </li>
   <!--<li> The public identifier is set to: "<code title="">-//W3O//DTD W3 HTML 3.0//EN//</code>" </li>-->
     <li> The public identifier is set to: "<code title="">-//W3O//DTD W3 HTML Strict 3.0//EN//</code>" </li>
     <li> The public identifier starts with: "<code title="">-//WebTechs//DTD Mozilla HTML 2.0//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//WebTechs//DTD Mozilla HTML//<!--EN--></code>" </li>
     <li> The public identifier is set to: "<code title="">-/W3C/DTD HTML 4.0 Transitional/EN</code>" </li>
     <li> The public identifier is set to: "<code title="">HTML</code>" </li>
     <li> The system identifier is set to: "<code title="">http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd</code>" </li>
     <li> The system identifier is missing and the public identifier starts with: "<code title="">-//W3C//DTD HTML 4.01 Frameset//<!--EN--></code>" </li>
     <li> The system identifier is missing and the public identifier starts with: "<code title="">-//W3C//DTD HTML 4.01 Transitional//<!--EN--></code>" </li>
    </ul><p>Otherwise, if the DOCTYPE token matches one of the conditions
    in the following list, then set the <code>Document</code> to
    <a href="dom.html#limited-quirks-mode">limited quirks mode</a>:</p>

    <ul class="brief"><li> The public identifier starts with: "<code title="">-//W3C//DTD XHTML 1.0 Frameset//<!--EN--></code>" </li>
     <li> The public identifier starts with: "<code title="">-//W3C//DTD XHTML 1.0 Transitional//<!--EN--></code>" </li>
     <li> The system identifier is not missing and the public identifier starts with: "<code title="">-//W3C//DTD HTML 4.01 Frameset//<!--EN--></code>" </li>
     <li> The system identifier is not missing and the public identifier starts with: "<code title="">-//W3C//DTD HTML 4.01 Transitional//<!--EN--></code>" </li>
    </ul><p>The name, system identifier, and public identifier strings must
    be compared to the values given in the lists above in an
    <a href="infrastructure.html#ascii-case-insensitive">ASCII case-insensitive</a> manner. A system identifier
    whose value is the empty string is not considered missing for the
    purposes of the conditions above.</p>

    <p>Then, switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#the-before-html-insertion-mode" title="insertion mode: before html">before html</a>".</p>

   </dd>

   <dt>Anything else</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>Set the <code>Document</code> to <a href="dom.html#quirks-mode">quirks mode</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#the-before-html-insertion-mode" title="insertion mode: before html">before html</a>", then
    reprocess the current token.</p>

   </dd>

  </dl><h5 id="the-before-html-insertion-mode"><span class="secno">9.2.5.5 </span>The "<dfn title="insertion mode: before html">before html</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#the-before-html-insertion-mode" title="insertion
  mode: before html">before html</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <code>Document</code>
    object with the <code title="">data</code> attribute set to the
    data given in the comment token.</p>
   </dd>

   <dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p>Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>

    <p><a href="#create-an-element-for-the-token">Create an element for the token</a> in the <a href="the-end.html#html-namespace-0">HTML
    namespace</a>. Append it to the <code>Document</code>
    object. Put this element in the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p id="parser-appcache">If the <code>Document</code> is being
    loaded as part of <a href="history.html#navigate" title="navigate">navigation</a> of a
    <a href="browsers.html#browsing-context">browsing context</a>, then: if the newly created element
    has a <code title="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute,
    then <a href="urls.html#resolve-a-url" title="resolve a url">resolve</a> the value of that
    attribute to an <a href="urls.html#absolute-url">absolute URL</a>, relative to the newly
    created element, and if that is successful, run the <a href="offline.html#concept-appcache-init" title="concept-appcache-init">application cache selection
    algorithm</a> with the resulting <a href="urls.html#absolute-url">absolute URL</a> with
    any <a href="urls.html#url-fragment" title="url-fragment">&lt;fragment&gt;</a> component
    removed; otherwise, if there is no such attribute or resolving it
    fails, run the <a href="offline.html#concept-appcache-init" title="concept-appcache-init">application
    cache selection algorithm</a> with no manifest. The algorithm
    must be passed the <code>Document</code> object.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#the-before-head-insertion-mode" title="insertion mode: before head">before head</a>".</p>

   </dd>

   <dt>An end tag whose tag name is one of: "head", "body", "html", "br"</dt>
   <dd>
    <p>Act as described in the "anything else" entry below.</p>
   </dd>

   <dt>Any other end tag</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>

    <p>Create an <code><a href="semantics.html#the-html-element-0">html</a></code> element. Append it to the
    <code>Document</code> object. Put this element in the <a href="parsing.html#stack-of-open-elements">stack
    of open elements</a>.</p>

    <p>If the <code>Document</code> is being loaded as part of <a href="history.html#navigate" title="navigate">navigation</a> of a <a href="browsers.html#browsing-context">browsing
    context</a>, then: run the <a href="offline.html#concept-appcache-init" title="concept-appcache-init">application cache selection
    algorithm</a> with no manifest, passing it the
    <code>Document</code> object.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#the-before-head-insertion-mode" title="insertion mode: before head">before head</a>", then
    reprocess the current token.</p>

   </dd>

  </dl><p>The root element can end up being removed from the
  <code>Document</code> object, e.g. by scripts; nothing in particular
  happens in such cases, content continues being appended to the nodes
  as described in the next section.</p>


  <h5 id="the-before-head-insertion-mode"><span class="secno">9.2.5.6 </span>The "<dfn title="insertion mode: before head">before head</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#the-before-head-insertion-mode" title="insertion
  mode: before head">before head</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p>Ignore the token.</p> <!-- :-( -->
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "head"</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Set the <a href="parsing.html#head-element-pointer"><code title="">head</code> element pointer</a>
    to the newly created <code><a href="semantics.html#the-head-element-0">head</a></code> element.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>".</p>

   </dd>

   <dt>An end tag whose tag name is one of: "head", "body", "html", "br"</dt>
   <dd>

    <p>Act as if a start tag token with the tag name "head" and no
    attributes had been seen, then reprocess the current token.</p>

   </dd>

   <dt>Any other end tag</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>

   </dd>

   <dt>Anything else</dt>
   <dd>

    <p>Act as if a start tag token with the tag name "head" and no
    attributes had been seen, then reprocess the current
    token.</p>

   </dd>

  </dl><h5 id="parsing-main-inhead"><span class="secno">9.2.5.7 </span>The "<dfn title="insertion mode: in head">in head</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-inhead" title="insertion
  mode: in head">in head</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p><a href="#insert-a-character" title="insert a character">Insert the character</a> into
    the <a href="parsing.html#current-node">current node</a>.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>A start tag whose tag name is one of: "base", "command",
   "link"</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Immediately
    pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p><a href="#acknowledge-self-closing-flag" title="acknowledge self-closing flag">Acknowledge the
    token's <i>self-closing flag</i></a>, if it is set.</p>

   </dd>

   <dt>A start tag whose tag name is "meta"</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Immediately
    pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p><a href="#acknowledge-self-closing-flag" title="acknowledge self-closing flag">Acknowledge the
    token's <i>self-closing flag</i></a>, if it is set.</p>

    <p id="meta-charset-during-parse">If the element has a <code title="attr-meta-charset"><a href="semantics.html#attr-meta-charset">charset</a></code> attribute, and its
    value is a supported encoding, and the <a href="parsing.html#concept-encoding-confidence" title="concept-encoding-confidence">confidence</a> is
    currently <i>tentative</i>, then <a href="parsing.html#change-the-encoding">change the
    encoding</a> to the encoding given by the value of the
    <code title="attr-meta-charset"><a href="semantics.html#attr-meta-charset">charset</a></code> attribute.</p>

    <p>Otherwise, if the element has a <code title="attr-meta-charset"><a href="semantics.html#attr-meta-charset">content</a></code> attribute, and
    applying the <a href="urls.html#algorithm-for-extracting-an-encoding-from-a-content-type">algorithm for extracting an encoding from a
    Content-Type</a> to its value returns a supported encoding
    <var title="">encoding</var>, and the <a href="parsing.html#concept-encoding-confidence" title="concept-encoding-confidence">confidence</a> is
    currently <i>tentative</i>, then <a href="parsing.html#change-the-encoding">change the
    encoding</a> to the encoding <var title="">encoding</var>.</p>

   </dd>

   <dt>A start tag whose tag name is "title"</dt>
   <dd>
    <p>Follow the <a href="#generic-rcdata-element-parsing-algorithm">generic RCDATA element parsing algorithm</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "noscript", if the <a href="parsing.html#scripting-flag">scripting flag</a> is enabled</dt>
   <dt>A start tag whose tag name is one of: "noframes", "style"</dt>
   <dd>
    <p>Follow the <a href="#generic-raw-text-element-parsing-algorithm">generic raw text element parsing algorithm</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "noscript", if the <a href="parsing.html#scripting-flag">scripting flag</a> is disabled</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-inheadnoscript" title="insertion mode: in head noscript">in head
    noscript</a>".</p>

   </dd>

   <dt id="scriptTag">A start tag whose tag name is "script"</dt>
   <dd>

    <ol><li><p><a href="#create-an-element-for-the-token">Create an element for the token</a> in the
     <a href="the-end.html#html-namespace-0">HTML namespace</a>.</li>

     <li>

      <p>Mark the element as being <a href="scripting-1.html#parser-inserted">"parser-inserted"</a>.</p>

      <p class="note">This ensures that, if the script is external,
      any <code title="dom-document-write"><a href="apis-in-html-documents.html#dom-document-write">document.write()</a></code>
      calls in the script will execute in-line, instead of blowing the
      document away, as would happen in most other cases. It also
      prevents the script from executing until the end tag is
      seen.</p>

     </li>

     <li><p>If the parser was originally created for the <a href="the-end.html#html-fragment-parsing-algorithm">HTML
     fragment parsing algorithm</a>, then mark the
     <code><a href="scripting-1.html#script">script</a></code> element as <a href="scripting-1.html#already-started">"already
     started"</a>. (<a href="the-end.html#fragment-case">fragment case</a>)</li>

     <li><p>Append the new element to the <a href="parsing.html#current-node">current node</a>
     and push it onto the <a href="parsing.html#stack-of-open-elements">stack of open
     elements</a>.</li>

     <li><p>Switch the tokenizer to the <a href="#script-data-state">script data
     state</a>.</li>

     <li><p>Let the <a href="parsing.html#original-insertion-mode">original insertion mode</a> be the current
     <a href="parsing.html#insertion-mode">insertion mode</a>.</p>

     <li><p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-incdata" title="insertion mode: text">text</a>".</li>

    </ol></dd>

   <dt>An end tag whose tag name is "head"</dt>
   <dd>

    <p>Pop the <a href="parsing.html#current-node">current node</a> (which will be the
    <code><a href="semantics.html#the-head-element-0">head</a></code> element) off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#the-after-head-insertion-mode" title="insertion mode: after head">after head</a>".</p>

   </dd>

   <dt>An end tag whose tag name is one of: "body", "html", "br"</dt>
   <dd>
    <p>Act as described in the "anything else" entry below.</p>
   </dd>

   <dt>A start tag whose tag name is "head"</dt>
   <dt>Any other end tag</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>

    <!-- can't get here with an EOF and a fragment case -->

    <p>Act as if an end tag token with the tag name "head" had
    been seen, and reprocess the current token.</p>

   </dd>

  </dl><h5 id="parsing-main-inheadnoscript"><span class="secno">9.2.5.8 </span>The "<dfn title="insertion mode: in head noscript">in head noscript</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-inheadnoscript" title="insertion
  mode: in head noscript">in head noscript</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end tag whose tag name is "noscript"</dt>
   <dd>

    <p>Pop the <a href="parsing.html#current-node">current node</a> (which will be a
    <code><a href="scripting-1.html#the-noscript-element">noscript</a></code> element) from the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>; the new <a href="parsing.html#current-node">current node</a> will be a
    <code><a href="semantics.html#the-head-element-0">head</a></code> element.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>".</p>

   </dd>

   <dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dt>A comment token</dt>
   <dt>A start tag whose tag name is one of: "link", "meta", "noframes", "style"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end tag whose tag name is "br"</dt>
   <dd>
    <p>Act as described in the "anything else" entry below.</p>
   </dd>

   <dt>A start tag whose tag name is one of: "head", "noscript"</dt>
   <dt>Any other end tag</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>

    <!-- can't get here with an EOF and a fragment case -->

    <p><a href="parsing.html#parse-error">Parse error</a>. Act as if an end tag with the tag
    name "noscript" had been seen and reprocess the current
    token.</p>

   </dd>

  </dl><h5 id="the-after-head-insertion-mode"><span class="secno">9.2.5.9 </span>The "<dfn title="insertion mode: after head">after head</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#the-after-head-insertion-mode" title="insertion
  mode: after head">after head</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p><a href="#insert-a-character" title="insert a character">Insert the character</a> into
    the <a href="parsing.html#current-node">current node</a>.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "body"</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>".</p>

   </dd>

   <dt>A start tag whose tag name is "frameset"</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-inframeset" title="insertion mode: in frameset">in frameset</a>".</p>

   </dd>

   <dt>A start tag token whose tag name is one of: "base", "link",
   "meta", "noframes", "script", "style", "title"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>Push the node pointed to by the <a href="parsing.html#head-element-pointer"><code title="">head</code> element pointer</a> onto the
    <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</p>

    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>

    <p>Remove the node pointed to by the <a href="parsing.html#head-element-pointer"><code title="">head</code> element pointer</a> from the <a href="parsing.html#stack-of-open-elements">stack
    of open elements</a>.</p>

    <p class="note">The <a href="parsing.html#head-element-pointer"><code title="">head</code> element
    pointer</a> cannot be null at this point.</p>

   </dd>

   <dt>An end tag whose tag name is one of: "body", "html", "br"</dt>
   <dd>
    <p>Act as described in the "anything else" entry below.</p>
   </dd>

   <dt>A start tag whose tag name is "head"</dt>
   <dt>Any other end tag</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>
    <p>Act as if a start tag token with the tag name "body" and no
    attributes had been seen, then set the <a href="parsing.html#frameset-ok-flag">frameset-ok
    flag</a> back to "ok", and then reprocess the current
    token.</p>
   </dd>

  </dl><h5 id="parsing-main-inbody"><span class="secno">9.2.5.10 </span>The "<dfn title="insertion mode: in body">in body</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-inbody" title="insertion
  mode: in body">in body</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-a-character" title="insert a character">Insert the token's
    character</a> into the <a href="parsing.html#current-node">current node</a>.</p>

    <p>If the token is not one of U+0009 CHARACTER TABULATION, U+000A
    LINE FEED (LF), U+000C FORM FEED (FF), <!--U+000D CARRIAGE RETURN
    (CR),--> or U+0020 SPACE, then set the <a href="parsing.html#frameset-ok-flag">frameset-ok
    flag</a> to "not ok".</p>

   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. For each attribute on the token,
    check to see if the attribute is already present on the top
    element of the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>. If it is not,
    add the attribute and its corresponding value to that element.</p>
   </dd>

   <dt>A start tag token whose tag name is one of: "base", "command",
   "link", "meta", "noframes", "script", "style", "title"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "body"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>If the second element on the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a> is not a <code><a href="sections.html#the-body-element-0">body</a></code> element, or, if the
    <a href="parsing.html#stack-of-open-elements">stack of open elements</a> has only one node on it,
    then ignore the token. (<a href="the-end.html#fragment-case">fragment case</a>)</p>

    <p>Otherwise, for each attribute on the token, check to see if
    the attribute is already present on the <code><a href="sections.html#the-body-element-0">body</a></code>
    element (the second element) on the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>. If it is not, add the attribute and its
    corresponding value to that element.</p>

   </dd>

   <dt>A start tag whose tag name is "frameset"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>If the second element on the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a> is not a <code><a href="sections.html#the-body-element-0">body</a></code> element, or, if the
    <a href="parsing.html#stack-of-open-elements">stack of open elements</a> has only one node on it,
    then ignore the token. (<a href="the-end.html#fragment-case">fragment case</a>)</p>

    <p>If the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> is set to "not ok", ignore
    the token.</p>

    <p>Otherwise, run the following steps:</p>

    <ol><li><p>Remove the second element on the <a href="parsing.html#stack-of-open-elements">stack of open
     elements</a> from its parent node, if it has one.</li>

     <li><p>Pop all the nodes from the bottom of the <a href="parsing.html#stack-of-open-elements">stack of
     open elements</a>, from the <a href="parsing.html#current-node">current node</a> up to,
     but not including, the root <code><a href="semantics.html#the-html-element-0">html</a></code> element.</p>

     <li><p><a href="#insert-an-html-element">Insert an HTML element</a> for the
     token.</li>

     <li><p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-inframeset" title="insertion mode: in frameset">in frameset</a>".</p>

    </ol></dd>

   <dt>An end-of-file token</dt>
   <dd>

    <p>If there is a node in the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>
    that is not either a <code><a href="grouping-content.html#the-dd-element">dd</a></code> element, a <code><a href="grouping-content.html#the-dt-element">dt</a></code>
    element, an <code><a href="grouping-content.html#the-li-element">li</a></code> element, a <code><a href="grouping-content.html#the-p-element">p</a></code> element, a
    <code><a href="tabular-data.html#the-tbody-element">tbody</a></code> element, a <code><a href="tabular-data.html#the-td-element">td</a></code> element, a
    <code><a href="tabular-data.html#the-tfoot-element">tfoot</a></code> element, a <code><a href="tabular-data.html#the-th-element">th</a></code> element, a
    <code><a href="tabular-data.html#the-thead-element">thead</a></code> element, a <code><a href="tabular-data.html#the-tr-element">tr</a></code> element, the
    <code><a href="sections.html#the-body-element-0">body</a></code> element, or the <code><a href="semantics.html#the-html-element-0">html</a></code> element, then
    this is a <a href="parsing.html#parse-error">parse error</a>.</p> <!-- (some of those are
    fragment cases) -->

    <p><a href="the-end.html#stop-parsing">Stop parsing</a>.</p>

   </dd>

   <dt>An end tag whose tag name is "body"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-scope" title="has an element in scope">have a <code>body</code> element
    in scope</a>, this is a <a href="parsing.html#parse-error">parse error</a>; ignore the
    token.</p>

    <!-- if we get here, the insertion mode here is forcibly "in
    body". -->

    <p>Otherwise, if there is a node in the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a> that is not either a <code><a href="grouping-content.html#the-dd-element">dd</a></code> element, a
    <code><a href="grouping-content.html#the-dt-element">dt</a></code> element, an <code><a href="grouping-content.html#the-li-element">li</a></code> element, an
    <code><a href="the-button-element.html#the-optgroup-element">optgroup</a></code> element, an <code><a href="the-button-element.html#the-option-element">option</a></code> element, a
    <code><a href="grouping-content.html#the-p-element">p</a></code> element, an <code><a href="text-level-semantics.html#the-rp-element">rp</a></code> element, an
    <code><a href="text-level-semantics.html#the-rt-element">rt</a></code> element, a <code><a href="tabular-data.html#the-tbody-element">tbody</a></code> element, a
    <code><a href="tabular-data.html#the-td-element">td</a></code> element, a <code><a href="tabular-data.html#the-tfoot-element">tfoot</a></code> element, a
    <code><a href="tabular-data.html#the-th-element">th</a></code> element, a <code><a href="tabular-data.html#the-thead-element">thead</a></code> element, a
    <code><a href="tabular-data.html#the-tr-element">tr</a></code> element, the <code><a href="sections.html#the-body-element-0">body</a></code> element, or the
    <code><a href="semantics.html#the-html-element-0">html</a></code> element, then this is a <a href="parsing.html#parse-error">parse
    error</a>.</p> <!-- (some of those are fragment cases, e.g. for
    <tbody> you'd have hit the first paragraph since the <body>
    wouldn't be in scope, unless it was a fragment case) -->

    <!-- If we ever change the frameset-ok flag to an insertion mode,
    then we'd have to somehow keep track of its state when we switch
    to after-body. -->

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-afterbody" title="insertion mode: after body">after body</a>".</p>

   </dd>

   <dt>An end tag whose tag name is "html"</dt>
   <dd>

    <p>Act as if an end tag with tag name "body" had been seen,
    then, if that token wasn't ignored, reprocess the current
    token.</p>

    <p class="note">The fake end tag token here can only be
    ignored in the <a href="the-end.html#fragment-case">fragment case</a>.</p>

   </dd>

   <!-- start tags for non-phrasing flow content elements -->

   <!-- the normal ones -->
   <dt>A start tag whose tag name is one of: "address", "article",
   "aside", "blockquote", "center", <!--v2DATAGRID-->"datagrid",
   "details", "dir", "div", "dl", "fieldset", "figure", "footer",
   "header", "hgroup", "menu", "nav", "ol", "p", "section", "ul"</dt>
   <dd>

    <!-- As of May 2008 this doesn't match any browser exactly, but is
    as close to what IE does as I can get without doing the non-tree
    DOM nonsense, and thus should actually afford better compatibility
    when implemented by the other browsers. -->

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
    an element in scope">has a <code>p</code> element in
    scope</a>, then act as if an end tag with the tag name
    "p" had been seen.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

   </dd>

   <!-- as normal, but close h1-h6 if it's the current node -->
   <dt>A start tag whose tag name is one of: "h1", "h2", "h3", "h4",
   "h5", "h6"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
    an element in scope">has a <code>p</code> element in
    scope</a>, then act as if an end tag with the tag name
    "p" had been seen.</p>

    <p>If the <a href="parsing.html#current-node">current node</a> is an element whose tag name
    is one of "h1", "h2", "h3", "h4", "h5", or "h6", then this is a
    <a href="parsing.html#parse-error">parse error</a>; pop the <a href="parsing.html#current-node">current node</a> off
    the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</p>
    <!-- See https://bugs.webkit.org/show_bug.cgi?id=12646 -->

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

   </dd>

   <!-- as normal, but drops leading newline -->
   <dt>A start tag whose tag name is one of: "pre", "listing"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
    an element in scope">has a <code>p</code> element in
    scope</a>, then act as if an end tag with the tag name
    "p" had been seen.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>If the next token is a U+000A LINE FEED (LF) character
    token, then ignore that token and move on to the next
    one. (Newlines at the start of <code><a href="grouping-content.html#the-pre-element">pre</a></code> blocks are
    ignored as an authoring convenience.)</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

   </dd>

   <!-- as normal, but interacts with the form element pointer -->
   <dt>A start tag whose tag name is "form"</dt>
   <dd>

    <p>If the <a href="parsing.html#form-element-pointer"><code title="form">form</code> element
    pointer</a> is not null, then this is a <a href="parsing.html#parse-error">parse
    error</a>; ignore the token.</p>

    <p>Otherwise:</p>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
    an element in scope">has a <code>p</code> element in
    scope</a>, then act as if an end tag with the tag name
    "p" had been seen.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token, and set the
    <a href="parsing.html#form-element-pointer"><code title="form">form</code> element pointer</a> to
    point to the element created.</p>

   </dd>

   <!-- as normal, but imply </li> when there's another <li> open in weird cases -->
   <dt>A start tag whose tag name is "li"</dt>
   <dd>

    <p>Run the following algorithm:</p>

    <ol><li><p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</li>

     <li><p>Initialize <var title="">node</var> to be the <a href="parsing.html#current-node">current
     node</a> (the bottommost node of the stack).</li>

     <li><p><i>Loop</i>: If <var title="">node</var> is an
     <code><a href="grouping-content.html#the-li-element">li</a></code> element, then act as if an end tag with the tag
     name "li" had been seen, then jump to the last step.</li>

     <li><p>If <var title="">node</var> is not in the
     <a href="parsing.html#formatting">formatting</a> category, and is not in the
     <a href="parsing.html#phrasing">phrasing</a> category, and is not an
     <code><a href="sections.html#the-address-element">address</a></code>, <code><a href="grouping-content.html#the-div-element">div</a></code>, or <code><a href="grouping-content.html#the-p-element">p</a></code>
     element, then jump to the last step.</li> <!-- an element
     <foo> is in this list if the following markup:

         <!DOCTYPE html><body><ol><li><foo><li>

     ...results in the second <li> not being (in any way) a descendant
     of the first <li>, or if <foo> is a formatting element that gets
     reopened later. -->

     <li><p>Otherwise, set <var title="">node</var> to the previous
     entry in the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> and return to
     the step labeled <i>loop</i>.</li>

     <li>

      <p>This is the last step.</p>

      <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
      an element in scope">has a <code>p</code> element in
      scope</a>, then act as if an end tag with the tag name
      "p" had been seen.</p>

      <p>Finally, <a href="#insert-an-html-element">insert an HTML element</a> for the
      token.</p>

     </li>

    </ol></dd>

   <!-- as normal, but imply </dt> or </dd> when there's another <dt> or <dd> open in weird cases  -->
   <dt>A start tag whose tag name is one of: "dd", "dt"</dt>
   <dd>

    <p>Run the following algorithm:</p>

    <ol><li><p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</li>

     <li><p>Initialize <var title="">node</var> to be the <a href="parsing.html#current-node">current
     node</a> (the bottommost node of the stack).</li>

     <li><p><i>Loop</i>: If <var title="">node</var> is a
     <code><a href="grouping-content.html#the-dd-element">dd</a></code> or <code><a href="grouping-content.html#the-dt-element">dt</a></code> element, then act as if an end
     tag with the same tag name as <var title="">node</var> had been
     seen, then jump to the last step.</li>

     <li><p>If <var title="">node</var> is not in the
     <a href="parsing.html#formatting">formatting</a> category, and is not in the
     <a href="parsing.html#phrasing">phrasing</a> category, and is not an
     <code><a href="sections.html#the-address-element">address</a></code>, <code><a href="grouping-content.html#the-div-element">div</a></code>, or <code><a href="grouping-content.html#the-p-element">p</a></code>
     element, then jump to the last step.</li> <!-- an element
     <foo> is in this list if the following markup:

         <!DOCTYPE html><body><dl><dt><foo><dt>

     ...results in the second <dt> not being (in any way) a descendant
     of the first <dt>, or if <foo> is a formatting element that gets
     reopened later. -->

     <li><p>Otherwise, set <var title="">node</var> to the previous
     entry in the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> and return to
     the step labeled <i>loop</i>.</li>

     <li>

      <p>This is the last step.</p>

      <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
      an element in scope">has a <code>p</code> element in
      scope</a>, then act as if an end tag with the tag name
      "p" had been seen.</p>

      <p>Finally, <a href="#insert-an-html-element">insert an HTML element</a> for the
      token.</p>

     </li>

    </ol></dd>

   <!-- same as normal, but effectively ends parsing -->
   <dt>A start tag whose tag name is "plaintext"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
    an element in scope">has a <code>p</code> element in
    scope</a>, then act as if an end tag with the tag name
    "p" had been seen.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Switch the tokenizer to the <a href="#plaintext-state">PLAINTEXT state</a>.</p>

    <p class="note">Once a start tag with the tag name "plaintext" has
    been seen, that will be the last token ever seen other than
    character tokens (and the end-of-file token), because there is no
    way to switch out of the <a href="#plaintext-state">PLAINTEXT state</a>.</p>

   </dd>

   <!-- end tags for non-phrasing flow content elements -->

   <!-- the normal ones -->
   <dt>An end tag whose tag name is one of: "address", "article",
   "aside", "blockquote", "center", <!--v2DATAGRID-->"datagrid",
   "details", "dir", "div", "dl", "fieldset", "figure", "footer",
   "header", "hgroup", "listing", "menu", "nav", "ol", "pre",
   "section", "ul"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-scope" title="has an element in scope">have an element in scope</a>
    with the same tag name as that of the token, then this is a
    <a href="parsing.html#parse-error">parse error</a>; ignore the token.</p>

    <p>Otherwise, run these steps:</p>

    <ol><li><p><a href="#generate-implied-end-tags">Generate implied end tags</a>.</li>

     <li><p>If the <a href="parsing.html#current-node">current node</a> is not an element with
     the same tag name as that of the token, then this is a
     <a href="parsing.html#parse-error">parse error</a>.</li>

     <li><p>Pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>
     until an element with the same tag name as the token has been
     popped from the stack.</li>

    </ol></dd>

   <!-- removes the form element pointer instead of the matching node -->
   <dt>An end tag whose tag name is "form"</dt>
   <dd>

    <p>Let <var title="">node</var> be the element that the
    <a href="parsing.html#form-element-pointer"><code title="">form</code> element pointer</a> is set
    to.</p>

    <p>Set the <a href="parsing.html#form-element-pointer"><code title="">form</code> element pointer</a>
    to null.</p>

    <p>If <var title="">node</var> is null or the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a> does not <a href="parsing.html#has-an-element-in-scope" title="has an element in
    scope">have <var title="">node</var> in scope</a>, then this is
    a <a href="parsing.html#parse-error">parse error</a>; ignore the token.</p>

    <p>Otherwise, run these steps:</p>

    <ol><li><p><a href="#generate-implied-end-tags">Generate implied end tags</a>.</li>

     <li><p>If the <a href="parsing.html#current-node">current node</a> is not <var title="">node</var>, then this is a <a href="parsing.html#parse-error">parse
     error</a>.</li>

     <li><p>Remove <var title="">node</var> from the <a href="parsing.html#stack-of-open-elements">stack of
     open elements</a>.</li>

    </ol></dd>

   <!-- as normal, except </p> implies <p> if there's no <p> in scope, and needs care as the elements have optional tags -->
   <dt>An end tag whose tag name is "p"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-scope" title="has an element in scope">have an element in scope</a>
    with the same tag name as that of the token, then this is a
    <a href="parsing.html#parse-error">parse error</a>; act as if a start tag with the tag name
    "p" had been seen, then reprocess the current token.</p>

    <p>Otherwise, run these steps:</p>

    <ol><li><p><a href="#generate-implied-end-tags">Generate implied end tags</a>, except
     for elements with the same tag name as the token.</li>

     <li><p>If the <a href="parsing.html#current-node">current node</a> is not an element with
     the same tag name as that of the token, then this is a
     <a href="parsing.html#parse-error">parse error</a>.</li>

     <li><p>Pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>
     until an element with the same tag name as the token has been
     popped from the stack.</li>

    </ol></dd>

   <!-- as normal, but needs care as the elements have optional tags, and are further scoped by <ol>/<ul> -->
   <dt>An end tag whose tag name is "li"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-list-item-scope" title="has an element in list item scope">have an element in list
    item scope</a> with the same tag name as that of the token,
    then this is a <a href="parsing.html#parse-error">parse error</a>; ignore the token.</p>

    <p>Otherwise, run these steps:</p>

    <ol><li><p><a href="#generate-implied-end-tags">Generate implied end tags</a>, except
     for elements with the same tag name as the token.</li>

     <li><p>If the <a href="parsing.html#current-node">current node</a> is not an element with
     the same tag name as that of the token, then this is a
     <a href="parsing.html#parse-error">parse error</a>.</li>

     <li><p>Pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>
     until an element with the same tag name as the token has been
     popped from the stack.</li>

    </ol></dd>

   <!-- as normal, but needs care as the elements have optional tags -->
   <dt>An end tag whose tag name is one of: "dd", "dt"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-scope" title="has an element in scope">have an element in scope</a>
    with the same tag name as that of the token, then this is a
    <a href="parsing.html#parse-error">parse error</a>; ignore the token.</p>

    <p>Otherwise, run these steps:</p>

    <ol><li><p><a href="#generate-implied-end-tags">Generate implied end tags</a>, except
     for elements with the same tag name as the token.</li>

     <li><p>If the <a href="parsing.html#current-node">current node</a> is not an element with
     the same tag name as that of the token, then this is a
     <a href="parsing.html#parse-error">parse error</a>.</li>

     <li><p>Pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>
     until an element with the same tag name as the token has been
     popped from the stack.</li>

    </ol></dd>

   <!-- as normal, except acts as a closer for any of the h1-h6 elements -->
   <dt>An end tag whose tag name is one of: "h1", "h2", "h3", "h4", "h5", "h6"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-scope" title="has an element in scope">have an element in scope</a>
    whose tag name is one of "h1", "h2", "h3", "h4", "h5", or "h6",
    then this is a <a href="parsing.html#parse-error">parse error</a>; ignore the token.</p>

    <p>Otherwise, run these steps:</p>

    <ol><li><p><a href="#generate-implied-end-tags">Generate implied end tags</a>.</li>

     <li><p>If the <a href="parsing.html#current-node">current node</a> is not an element with
     the same tag name as that of the token, then this is a
     <a href="parsing.html#parse-error">parse error</a>.</li>

     <li><p>Pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>
     until an element whose tag name is one of "h1", "h2", "h3", "h4",
     "h5", or "h6" has been popped from the stack.</li>

    </ol></dd>

   <dt>An end tag whose tag name is "sarcasm"</dt>
   <dd>
    <p>Take a deep breath, then act as described in the "any other end
    tag" entry below.</p>
   </dd>

   <!-- ADOPTION AGENCY ELEMENTS
        Mozilla-only: bdo blink del ins sub sup q
        Safari-only: code dfn kbd nobr samp var wbr
        Both: a b big em font i s small strike strong tt u -->

   <dt>A start tag whose tag name is "a"</dt>
   <dd>

    <p>If the <a href="parsing.html#list-of-active-formatting-elements">list of active formatting elements</a>
    contains an element whose tag name is "a" between the end of
    the list and the last marker on the list (or the start of the
    list if there is no marker on the list), then this is a
    <a href="parsing.html#parse-error">parse error</a>; act as if an end tag with the tag
    name "a" had been seen, then remove that element from the
    <a href="parsing.html#list-of-active-formatting-elements">list of active formatting elements</a> and the
    <a href="parsing.html#stack-of-open-elements">stack of open elements</a> if the end tag didn't
    already remove it (it might not have if the element is not
    <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">in table
    scope</a>).</p>

    <p class="example">In the non-conforming stream
    <code>&lt;a&nbsp;href="a"&gt;a&lt;table&gt;&lt;a&nbsp;href="b"&gt;b&lt;/table&gt;x</code>,
    the first <code><a href="text-level-semantics.html#the-a-element">a</a></code> element would be closed upon seeing
    the second one, and the "x" character would be inside a link
    to "b", not to "a". This is despite the fact that the outer
    <code><a href="text-level-semantics.html#the-a-element">a</a></code> element is not in table scope (meaning that a
    regular <code>&lt;/a&gt;</code> end tag at the start of the table
    wouldn't close the outer <code><a href="text-level-semantics.html#the-a-element">a</a></code> element).</p>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Add that
    element to the <a href="parsing.html#list-of-active-formatting-elements">list of active formatting
    elements</a>.</p>

   </dd>

   <dt>A start tag whose tag name is one of: "b", "big", "code", "em",
   "font", "i", "s", "small", "strike", "strong", "tt", "u"</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Add that
    element to the <a href="parsing.html#list-of-active-formatting-elements">list of active formatting
    elements</a>.</p>

   </dd>

   <dt>A start tag whose tag name is "nobr"</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has an
    element in scope">has a <code>nobr</code> element in scope</a>,
    then this is a <a href="parsing.html#parse-error">parse error</a>; act as if an end tag with
    the tag name "nobr" had been seen, then once again
    <a href="parsing.html#reconstruct-the-active-formatting-elements">reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Add that
    element to the <a href="parsing.html#list-of-active-formatting-elements">list of active formatting
    elements</a>.</p>

   </dd>

   <dt id="adoptionAgency">An end tag whose tag name is one of: "a",
   "b", "big", "code", "em", "font", "i", "nobr", "s", "small",
   "strike", "strong", "tt", "u"</dt>
   <dd>

    <p>Follow these steps:</p>

    <ol><li>

      <p>Let the <var title="">formatting element</var> be the
      last element in the <a href="parsing.html#list-of-active-formatting-elements">list of active formatting
      elements</a> that:</p>

      <ul><li>is between the end of the list and the last scope
       marker in the list, if any, or the start of the list
       otherwise, and</li>

       <li>has the same tag name as the token.</li>

      </ul><p>If there is no such node, or, if that node is also in the
      <a href="parsing.html#stack-of-open-elements">stack of open elements</a> but the element is not <a href="parsing.html#has-an-element-in-scope" title="has an element in scope">in scope</a>, then this is a
      <a href="parsing.html#parse-error">parse error</a>; ignore the token, and abort these
      steps.</p>

      <p>Otherwise, if there is such a node, but that node is not
      in the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>, then this is a
      <a href="parsing.html#parse-error">parse error</a>; remove the element from the list,
      and abort these steps.</p>

      <p>Otherwise, there is a <var title="">formatting
      element</var> and that element is in <a href="parsing.html#stack-of-open-elements" title="stack of
      open elements">the stack</a> and is <a href="parsing.html#has-an-element-in-scope" title="has an
      element in scope">in scope</a>. If the element is not the
      <a href="parsing.html#current-node">current node</a>, this is a <a href="parsing.html#parse-error">parse
      error</a>. In any case, proceed with the algorithm as
      written in the following steps.</p>

     </li>

     <li><p>Let the <var title="">furthest block</var> be the
     topmost node in the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> that
     is lower in the stack than the <var title="">formatting
     element</var>, and is not an element in the
     <a href="parsing.html#phrasing">phrasing</a> or <a href="parsing.html#formatting">formatting</a>
     categories. There might not be one.</li>

     <li><p>If there is no <var title="">furthest block</var>,
     then the UA must skip the subsequent steps and instead just
     pop all the nodes from the bottom of the <a href="parsing.html#stack-of-open-elements">stack of open
     elements</a>, from the <a href="parsing.html#current-node">current node</a> up to and
     including the <var title="">formatting element</var>, and
     remove the <var title="">formatting element</var> from the
     <a href="parsing.html#list-of-active-formatting-elements">list of active formatting elements</a>.</li>

     <li><p>Let the <var title="">common ancestor</var> be the element
     immediately above the <var title="">formatting element</var> in the
     <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</li>

     <li><p>Let a bookmark note the position of the <var title="">formatting element</var> in the <a href="parsing.html#list-of-active-formatting-elements">list of active
     formatting elements</a> relative to the elements on either
     side of it in the list.</li>

     <li>

      <p>Let <var title="">node</var> and <var title="">last node</var> be the
      <var title="">furthest block</var>. Follow these steps:</p>

      <ol><li>Let <var title="">node</var> be the element immediately
       above <var title="">node</var> in the <a href="parsing.html#stack-of-open-elements">stack of open
       elements</a>, or if <var title="">node</var> is no longer in
       the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> (e.g. because it got
       removed by the next step), the element that was immediately
       above <var title="">node</var> in the <a href="parsing.html#stack-of-open-elements">stack of open
       elements</a> before <var title="">node</var> was
       removed.</li>

       <li>If <var title="">node</var> is not in the <a href="parsing.html#list-of-active-formatting-elements">list of
       active formatting elements</a>, then remove <var title="">node</var> from the <a href="parsing.html#stack-of-open-elements">stack of open
       elements</a> and then go back to step 1.</li>

       <li>Otherwise, if <var title="">node</var> is the <var title="">formatting element</var>, then go to the next step
       in the overall algorithm.</li>

       <li>Otherwise, if <var title="">last node</var> is the <var title="">furthest block</var>, then move the aforementioned
       bookmark to be immediately after the <var title="">node</var> in the <a href="parsing.html#list-of-active-formatting-elements">list of active formatting
       elements</a>.</li>

       <li><a href="#create-an-element-for-the-token">Create an element for the token</a> for which the
       element <var title="">node</var> was created, replace the entry
       for <var title="">node</var> in the <a href="parsing.html#list-of-active-formatting-elements">list of active
       formatting elements</a> with an entry for the new element,
       replace the entry for <var title="">node</var> in the
       <a href="parsing.html#stack-of-open-elements">stack of open elements</a> with an entry for the new
       element, and let <var title="">node</var> be the new
       element.</li>

       <li>Insert <var title="">last node</var> into <var title="">node</var>, first removing it from its previous
       parent node if any.</li>

       <li>Let <var title="">last node</var> be <var title="">node</var>.</li>

       <li>Return to step 1 of this inner set of steps.</li>

      </ol></li>

     <li>

      <p>If the <var title="">common ancestor</var> node is a
      <code><a href="tabular-data.html#the-table-element">table</a></code>, <code><a href="tabular-data.html#the-tbody-element">tbody</a></code>, <code><a href="tabular-data.html#the-tfoot-element">tfoot</a></code>,
      <code><a href="tabular-data.html#the-thead-element">thead</a></code>, or <code><a href="tabular-data.html#the-tr-element">tr</a></code> element, then,
      <a href="#foster-parent">foster parent</a> whatever <var title="">last
      node</var> ended up being in the previous step, first removing
      it from its previous parent node if any.</p>

      <p>Otherwise, append whatever <var title="">last node</var>
      ended up being in the previous step to the <var title="">common
      ancestor</var> node, first removing it from its previous parent
      node if any.</p>

     </li>

     <li><p><a href="#create-an-element-for-the-token">Create an element for the token</a> for which the
     <var title="">formatting element</var> was created.</li>

     <li><p>Take all of the child nodes of the <var title="">furthest
     block</var> and append them to the element created in the last
     step.</li>

     <li><p>Append that new element to the <var title="">furthest
     block</var>.</li>

     <li><p>Remove the <var title="">formatting element</var> from the
     <a href="parsing.html#list-of-active-formatting-elements">list of active formatting elements</a>, and insert the
     new element into the <a href="parsing.html#list-of-active-formatting-elements">list of active formatting
     elements</a> at the position of the aforementioned
     bookmark.</li>

     <li><p>Remove the <var title="">formatting element</var> from the
     <a href="parsing.html#stack-of-open-elements">stack of open elements</a>, and insert the new element
     into the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> immediately below
     the position of the <var title="">furthest block</var> in that
     stack.</li>

     <li><p>Jump back to step 1 in this series of steps.</li>

    </ol><p class="note">Because of the way this algorithm causes elements
    to change parents, it has been dubbed the "adoption agency
    algorithm" (in contrast with other possible algorithms for dealing
    with misnested content, which included the "incest algorithm", the
    "secret affair algorithm", and the "Heisenberg algorithm").</p>

   </dd>

   <dt>A start tag whose tag name is "button"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
    an element in scope">has a <code>button</code> element in
    scope</a>, then this is a <a href="parsing.html#parse-error">parse error</a>;
    act as if an end tag with the tag name "button" had been seen,
    then reprocess the token.</p>

    <p>Otherwise:</p>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Insert a marker at the end of the <a href="parsing.html#list-of-active-formatting-elements">list of active
    formatting elements</a>.</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

   </dd>

   <dt>A start tag token whose tag name is one of: "applet",
   "marquee", "object"</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Insert a marker at the end of the <a href="parsing.html#list-of-active-formatting-elements">list of active
    formatting elements</a>.</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

   </dd>

   <dt>An end tag token whose tag name is one of: "applet", "button",
   "marquee", "object"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-scope" title="has an element in scope">have an element in scope</a>
    with the same tag name as that of the token, then this is a
    <a href="parsing.html#parse-error">parse error</a>; ignore the token.</p>

    <p>Otherwise, run these steps:</p>

    <ol><li><p><a href="#generate-implied-end-tags">Generate implied end tags</a>.</li>

     <li><p>If the <a href="parsing.html#current-node">current node</a> is not an element with
     the same tag name as that of the token, then this is a
     <a href="parsing.html#parse-error">parse error</a>.</li>

     <li><p>Pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>
     until an element with the same tag name as the token has been
     popped from the stack.</li>

     <li><a href="parsing.html#clear-the-list-of-active-formatting-elements-up-to-the-last-marker">Clear the list of active formatting elements up to the
     last marker</a>.</li>

    </ol></dd>

   <dt>A start tag whose tag name is "table"</dt>
   <dd>

    <p>If the <code>Document</code> is <em>not</em> set to
    <a href="dom.html#quirks-mode">quirks mode</a>, and the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a> <a href="parsing.html#has-an-element-in-scope" title="has an element in scope">has a
    <code>p</code> element in scope</a>, then act as if an end tag
    with the tag name "p" had been seen.</p> <!-- i hate myself (this
    quirk was basically caused by acid2; if i'd realised we could
    change the specs when i wrote acid2, we could have avoided having
    any parsing-mode quirks) -Hixie -->

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-intable" title="insertion mode: in table">in table</a>".</p>

   </dd>

   <dt>A start tag whose tag name is one of: "area", "basefont",
   "bgsound", "br", "embed", "img", "input", "keygen", "wbr"</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Immediately
    pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p><a href="#acknowledge-self-closing-flag" title="acknowledge self-closing flag">Acknowledge the
    token's <i>self-closing flag</i></a>, if it is set.</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p> <!--
    shouldn't really do it for <area>, <basefont>, and <bgsound> -->

   </dd>

   <dt>A start tag whose tag name is one of: "param", "source"</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Immediately
    pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p><a href="#acknowledge-self-closing-flag" title="acknowledge self-closing flag">Acknowledge the
    token's <i>self-closing flag</i></a>, if it is set.</p>

   </dd>

   <dt>A start tag whose tag name is "hr"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
    an element in scope">has a <code>p</code> element in
    scope</a>, then act as if an end tag with the tag name
    "p" had been seen.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Immediately
    pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p><a href="#acknowledge-self-closing-flag" title="acknowledge self-closing flag">Acknowledge the
    token's <i>self-closing flag</i></a>, if it is set.</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

   </dd>

   <dt>A start tag whose tag name is "image"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Change the token's tag name
    to "img" and reprocess it. (Don't ask.)</p> <!-- As of
    2005-12, studies showed that around 0.2% of pages used the
    <image> element. -->
   </dd>

   <dt id="isindex">A start tag whose tag name is "isindex"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>If the <a href="parsing.html#form-element-pointer"><code title="">form</code> element
    pointer</a> is not null, then ignore the token.</p>

    <p>Otherwise:</p>

    <p><a href="#acknowledge-self-closing-flag" title="acknowledge self-closing flag">Acknowledge the
    token's <i>self-closing flag</i></a>, if it is set.</p> <!--
    purely to reduce the number of errors (we don't care if they
    included the /, they're not supposed to be including the tag at
    all! -->

    <p>Act as if a start tag token with the tag name "form" had been seen.</p>

    <p>If the token has an attribute called "action", set the
    <code title="attr-form-action">action</code> attribute on the
    resulting <code><a href="forms.html#the-form-element">form</a></code> element to the value of the
    "action" attribute of the token.</p>

    <p>Act as if a start tag token with the tag name "hr" had been
    seen.</p>

    <p>Act as if a start tag token with the tag name "label" had been
    seen.</p>

    <p>Act as if a stream of character tokens had been seen (see below
    for what they should say).</p>

    <p>Act as if a start tag token with the tag name "input" had been
    seen, with all the attributes from the "isindex" token except
    "name", "action", and "prompt". Set the <code title="attr-fe-name"><a href="association-of-controls-and-forms.html#attr-fe-name">name</a></code> attribute of the resulting
    <code><a href="the-input-element.html#the-input-element">input</a></code> element to the value "<code title="">isindex</code>".</p>

    <p>Act as if a stream of character tokens had been seen (see
    below for what they should say).</p>

    <p>Act as if an end tag token with the tag name "label" had been
    seen.</p>

    <p>Act as if a start tag token with the tag name "hr" had been
    seen.</p>

    <p>Act as if an end tag token with the tag name "form" had been
    seen.</p>

    <p>If the token has an attribute with the name "prompt", then the
    first stream of characters must be the same string as given in
    that attribute, and the second stream of characters must be
    empty. Otherwise, the two streams of character tokens together
    should, together with the <code><a href="the-input-element.html#the-input-element">input</a></code> element, express the
    equivalent of "This is a searchable index. Insert your search
    keywords here: (input field)" in the user's preferred
    language.</p>

   </dd>

   <dt>A start tag whose tag name is "textarea"</dt>
   <dd>

    <ol><li><p><a href="#insert-an-html-element">Insert an HTML element</a> for the
     token.</li>

     <li><p>If the next token is a U+000A LINE FEED (LF) character
     token, then ignore that token and move on to the next
     one. (Newlines at the start of <code><a href="the-button-element.html#the-textarea-element">textarea</a></code> elements are
     ignored as an authoring convenience.)</li>

     <li><p>Switch the tokenizer to the the <a href="#rcdata-state">RCDATA
     state</a>.</li>

     <li><p>Let the <a href="parsing.html#original-insertion-mode">original insertion mode</a> be the
     current <a href="parsing.html#insertion-mode">insertion mode</a>.</p>

     <li><p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not
     ok".</li>

     <li><p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-incdata" title="insertion mode: text">text</a>".</li>

    </ol></dd>

   <dt>A start tag whose tag name is "xmp"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has
    an element in scope">has a <code>p</code> element in
    scope</a>, then act as if an end tag with the tag name
    "p" had been seen.</p>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

    <p>Follow the <a href="#generic-raw-text-element-parsing-algorithm">generic raw text element parsing algorithm</a>.</p>

   </dd>

   <dt>A start tag whose tag name is "iframe"</dt>
   <dd>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

    <p>Follow the <a href="#generic-raw-text-element-parsing-algorithm">generic raw text element parsing algorithm</a>.</p>

   </dd>

   <dt>A start tag whose tag name is "noembed"</dt>
   <dt>A start tag whose tag name is "noscript", if the <a href="parsing.html#scripting-flag">scripting flag</a> is enabled</dt>
   <dd>

    <p>Follow the <a href="#generic-raw-text-element-parsing-algorithm">generic raw text element parsing algorithm</a>.</p>

   </dd>

   <dt>A start tag whose tag name is "select"</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Set the <a href="parsing.html#frameset-ok-flag">frameset-ok flag</a> to "not ok".</p>

    <p>If the <a href="parsing.html#insertion-mode">insertion mode</a> is one of <a href="#parsing-main-intable" title="insertion mode: in table">in table</a>", "<a href="#parsing-main-incaption" title="insertion mode: in caption">in caption</a>", "<a href="#parsing-main-incolgroup" title="insertion mode: in column group">in column group</a>",
    "<a href="#parsing-main-intbody" title="insertion mode: in table body">in table
    body</a>", "<a href="#parsing-main-intr" title="insertion mode: in row">in
    row</a>", or "<a href="#parsing-main-intd" title="insertion mode: in cell">in
    cell</a>", then switch the <a href="parsing.html#insertion-mode">insertion mode</a> to
    "<a href="#parsing-main-inselectintable" title="insertion mode: in select in table">in select in
    table</a>". Otherwise, switch the <a href="parsing.html#insertion-mode">insertion mode</a>
    to "<a href="#parsing-main-inselect" title="insertion mode: in select">in select</a>".</p>

   </dd>

   <dt>A start tag whose tag name is one of: "optgroup", "option"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has an
    element in scope">has an <code>option</code> element in
    scope</a>, then act as if an end tag with the tag name "option"
    had been seen.</p>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

   </dd>

   <dt>A start tag whose tag name is one of: "rp", "rt"</dt>
   <dd>

    <!-- the parsing rules for ruby really don't match IE much at all,
         but in practice the markup used is very simple and so strict
         compatibility with IE isn't required. For example, as defined
         here we get very, very different behaviour than IE for
         pathological cases like:

           <ruby><ol><li><p>a<rt>b
           <ruby>a<rt>b<p>c

         But in practice most ruby markup falls into these cases:

           <ruby>a<rt>b</ruby>
           <ruby>a<rp>b<rt>c<rp>d</ruby>
           <ruby>a<rt>b</rt></ruby>
           <ruby>a<rp>b</rp><rt>c</rt><rp>d</rp></ruby>

    -->

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-scope" title="has an
    element in scope">has a <code>ruby</code> element in scope</a>,
    then <a href="#generate-implied-end-tags">generate implied end tags</a>. If the <a href="parsing.html#current-node">current
    node</a> is not then a <code><a href="text-level-semantics.html#the-ruby-element">ruby</a></code> element, this is a
    <a href="parsing.html#parse-error">parse error</a>; pop all the nodes from the <a href="parsing.html#current-node">current
    node</a> up to the node immediately before the bottommost
    <code><a href="text-level-semantics.html#the-ruby-element">ruby</a></code> element on the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

   </dd>

   <dt>An end tag whose tag name is "br"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Act as if a start tag token with
    the tag name "br" had been seen. Ignore the end tag token.</p>
   </dd>

   <dt>A start tag whose tag name is "math"</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#adjust-mathml-attributes">Adjust MathML attributes</a> for the token. (This
    fixes the case of MathML attributes that are not all
    lowercase.)</p>

    <p><a href="#adjust-foreign-attributes">Adjust foreign attributes</a> for the token. (This
    fixes the use of namespaced attributes, in particular XLink.)</p>

    <p><a href="#insert-a-foreign-element">Insert a foreign element</a> for the token, in the
    <a href="the-end.html#mathml-namespace">MathML namespace</a>.</p>

    <!-- If we ever change the frameset-ok flag to an insertion mode,
    the following change would be implied, except we'd have to do it
    even in the face of a self-closed tag:
    <p>Set the <span>frameset-ok flag</span> to "not ok".</p>
    -->

    <p>If the token has its <i>self-closing flag</i> set, pop the
    <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a> and <a href="#acknowledge-self-closing-flag" title="acknowledge self-closing
    flag">acknowledge the token's <i>self-closing flag</i></a>.</p>

    <p>Otherwise, if the <a href="parsing.html#insertion-mode">insertion mode</a> is not already
    "<a href="#parsing-main-inforeign" title="insertion mode: in foreign content">in foreign
    content</a>", let the <a href="parsing.html#secondary-insertion-mode">secondary insertion mode</a> be
    the current <a href="parsing.html#insertion-mode">insertion mode</a>, and then switch the
    <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-inforeign" title="insertion mode: in
    foreign content">in foreign content</a>".</p>

   </dd>

   <dt>A start tag whose tag name is "svg"</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#adjust-svg-attributes">Adjust SVG attributes</a> for the token. (This fixes
    the case of SVG attributes that are not all lowercase.)</p>

    <p><a href="#adjust-foreign-attributes">Adjust foreign attributes</a> for the token. (This
    fixes the use of namespaced attributes, in particular XLink in
    SVG.)</p>

    <p><a href="#insert-a-foreign-element">Insert a foreign element</a> for the token, in the
    <a href="the-end.html#svg-namespace">SVG namespace</a>.</p>

    <!-- If we ever change the frameset-ok flag to an insertion mode,
    the following change would be implied, except we'd have to do it
    even in the face of a self-closed tag:
    <p>Set the <span>frameset-ok flag</span> to "not ok".</p>
    -->

    <p>If the token has its <i>self-closing flag</i> set, pop the
    <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a> and <a href="#acknowledge-self-closing-flag" title="acknowledge self-closing
    flag">acknowledge the token's <i>self-closing flag</i></a>.</p>

    <p>Otherwise, if the <a href="parsing.html#insertion-mode">insertion mode</a> is not already
    "<a href="#parsing-main-inforeign" title="insertion mode: in foreign content">in foreign
    content</a>", let the <a href="parsing.html#secondary-insertion-mode">secondary insertion mode</a> be
    the current <a href="parsing.html#insertion-mode">insertion mode</a>, and then switch the
    <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-inforeign" title="insertion mode: in
    foreign content">in foreign content</a>".</p>

   </dd>

   <dt>A start <!--or end--> tag whose tag name is one of: "caption",
   "col", "colgroup", "frame", "head", "tbody", "td", "tfoot", "th",
   "thead", "tr"</dt>
   <!--<dt>An end tag whose tag name is one of: "area", "base",
   "basefont", "bgsound", "command", "embed", "hr", "iframe", "image",
   "img", "input", "isindex", "keygen", "link", "meta", "noembed",
   "noframes", "param", "script", "select", "source", "style",
   "table", "textarea", "title", "wbr"</dt>-->
   <!--<dt>An end tag whose tag name is "noscript", if the
   <span>scripting flag</span> is enabled</dt>-->
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
    <!-- end tags are commented out because since they can never end
    up on the stack anyway, the default end tag clause will
    automatically handle them. we don't want to have text in the spec
    that is just an optimisation, as that detracts from the spec
    itself -->
   </dd>

   <dt>Any other start tag</dt>
   <dd>

    <p><a href="parsing.html#reconstruct-the-active-formatting-elements">Reconstruct the active formatting elements</a>, if
    any.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p class="note">This element will be a <a href="parsing.html#phrasing">phrasing</a>
    element.</p>

   </dd>

   <dt>Any other end tag</dt>
   <dd>

    <p>Run the following steps:</p>

    <ol><li><p>Initialize <var title="">node</var> to be the <a href="parsing.html#current-node">current
     node</a> (the bottommost node of the stack).</li>

     <li><p>If <var title="">node</var> has the same tag name as
     the end tag token, then:</p>

      <ol><li><p><a href="#generate-implied-end-tags">Generate implied end tags</a>.</li>

       <li><p>If the tag name of the end tag token does not match
       the tag name of the <a href="parsing.html#current-node">current node</a>, this is a
       <a href="parsing.html#parse-error">parse error</a>.</li>

       <li><p>Pop all the nodes from the <a href="parsing.html#current-node">current node</a> up
       to <var title="">node</var>, including <var title="">node</var>, then stop these steps.</li>

      </ol></li>

     <li><p>Otherwise, if <var title="">node</var> is in neither the
     <a href="parsing.html#formatting">formatting</a> category nor the <a href="parsing.html#phrasing">phrasing</a>
     category, then this is a <a href="parsing.html#parse-error">parse error</a>; ignore the
     token, and abort these steps.</li>

     <li><p>Set <var title="">node</var> to the previous entry in the
     <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</li>

     <li><p>Return to step 2.</li>

    </ol></dd>

  </dl><h5 id="parsing-main-incdata"><span class="secno">9.2.5.11 </span>The "<dfn title="insertion mode: text">text</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-incdata" title="insertion
  mode: text">text</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token</dt>
   <dd>

    <p><a href="#insert-a-character" title="insert a character">Insert the token's
    character</a> into the <a href="parsing.html#current-node">current node</a>.</p>

   </dd>

   <dt>An end-of-file token</dt>
   <dd>

    <!-- can't be the fragment case -->
    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>If the <a href="parsing.html#current-node">current node</a> is a <code><a href="scripting-1.html#script">script</a></code>
    element, mark the <code><a href="scripting-1.html#script">script</a></code> element as <a href="scripting-1.html#already-started">"already
    started"</a>.</p>

    <p>Pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to the <a href="parsing.html#original-insertion-mode">original
    insertion mode</a> and reprocess the current token.</p>

   </dd>

   <dt>An end tag whose tag name is "script"</dt>
   <dd>

    <p>Let <var title="">script</var> be the <a href="parsing.html#current-node">current node</a>
    (which will be a <code><a href="scripting-1.html#script">script</a></code> element).</p>

    <p>Pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to the <a href="parsing.html#original-insertion-mode">original
    insertion mode</a>.</p>

    <p>Let the <var title="">old insertion point</var> have the
    same value as the current <a href="parsing.html#insertion-point">insertion point</a>. Let
    the <a href="parsing.html#insertion-point">insertion point</a> be just before the <a href="parsing.html#next-input-character">next
    input character</a>.</p>

    <p>Increment the parser's <a href="parsing.html#script-nesting-level">script nesting level</a> by
    one.</p>

    <p><a href="scripting-1.html#running-a-script" title="running a script">Run</a> the <var title="">script</var>. This might cause some script to execute,
    which might cause <a href="apis-in-html-documents.html#dom-document-write" title="dom-document-write">new characters
    to be inserted into the tokenizer</a>, and might cause the
    tokenizer to output more tokens, resulting in a <a href="parsing.html#nestedParsing">reentrant invocation of the parser</a>.</p>

    <p>Decrement the parser's <a href="parsing.html#script-nesting-level">script nesting level</a> by
    one. If the parser's <a href="parsing.html#script-nesting-level">script nesting level</a> is zero,
    then set the <a href="parsing.html#parser-pause-flag">parser pause flag</a> to false.</p>

    <p>Let the <a href="parsing.html#insertion-point">insertion point</a> have the value of the <var title="">old insertion point</var>. (In other words, restore the
    <a href="parsing.html#insertion-point">insertion point</a> to its previous value. This value
    might be the "undefined" value.)</p>

    <p id="scriptTagParserResumes">At this stage, if there is a
    <a href="scripting-1.html#pending-parsing-blocking-script">pending parsing-blocking script</a>, then:</p>

    <dl class="switch"><dt>If the <a href="parsing.html#script-nesting-level">script nesting level</a> is not zero:</dt>

     <dd>

      <p>Set the <a href="parsing.html#parser-pause-flag">parser pause flag</a> to true, and abort the
      processing of any nested invocations of the tokenizer, yielding
      control back to the caller. (Tokenization will resume when the
      caller returns to the "outer" tree construction stage.)</p>

      <p class="note">The tree construction stage of this particular
      parser is <a href="parsing.html#nestedParsing">being called reentrantly</a>,
      say from a call to <code title="dom-document-write"><a href="apis-in-html-documents.html#dom-document-write">document.write()</a></code>.</p>

     </dd>


     <dt>Otherwise:</dt>

     <dd>

      <p>Follow these steps:</p>

      <ol><li><p>Let <var title="">the script</var> be the <a href="scripting-1.html#pending-parsing-blocking-script">pending
       parsing-blocking script</a>. There is no longer a <a href="scripting-1.html#pending-parsing-blocking-script">pending
       parsing-blocking script</a>.</li>

       <li><p>Block the <a href="#tokenization" title="tokenization">tokenizer</a>
       for this instance of the <a href="parsing.html#html-parser">HTML parser</a>, such that
       the <a href="origin-0.html#event-loop">event loop</a> will not run <a href="origin-0.html#concept-task" title="concept-task">tasks</a> that invoke the <a href="#tokenization" title="tokenization">tokenizer</a>.</li>

       <li><p><a href="origin-0.html#spin-the-event-loop">Spin the event loop</a> until there is no <a href="semantics.html#a-style-sheet-blocking-scripts" title="a style sheet blocking scripts">style sheet blocking
       scripts</a> and <var title="">the script</var>'s
       <a href="scripting-1.html#ready-to-be-parser-executed">"ready to be parser-executed"</a> flag is set.</li>

       <li><p>Unblock the <a href="#tokenization" title="tokenization">tokenizer</a>
       for this instance of the <a href="parsing.html#html-parser">HTML parser</a>, such that
       <a href="origin-0.html#concept-task" title="concept-task">tasks</a> that invoke the <a href="#tokenization" title="tokenization">tokenizer</a> can again be
       run.</li>

       <li><p>Let the <a href="parsing.html#insertion-point">insertion point</a> be just before the
       <a href="parsing.html#next-input-character">next input character</a>.</li>

       <li><p>Increment the parser's <a href="parsing.html#script-nesting-level">script nesting level</a>
       by one (it should be zero before this step, so this sets it to
       one).</li>

       <li><p><a href="scripting-1.html#executing-a-script-block" title="executing a script block">Execute</a>
       <var title="">the script</var>.</li>

       <li><p>Decrement the parser's <a href="parsing.html#script-nesting-level">script nesting level</a>
       by one. If the parser's <a href="parsing.html#script-nesting-level">script nesting level</a> is
       zero (which it always should be at this point), then set the
       <a href="parsing.html#parser-pause-flag">parser pause flag</a> to false.</p>

       <li><p>Let the <a href="parsing.html#insertion-point">insertion point</a> be undefined
       again.</li>

       <li><p>If there is once again a <a href="scripting-1.html#pending-parsing-blocking-script">pending parsing-blocking
       script</a>, then repeat these steps from step 1.</li>

      </ol></dd>

    </dl></dd>

   <dt>Any other end tag</dt>
   <dd>

    <p>Pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to the <a href="parsing.html#original-insertion-mode">original
    insertion mode</a>.</p>

   </dd>

  </dl><h5 id="parsing-main-intable"><span class="secno">9.2.5.12 </span>The "<dfn title="insertion mode: in table">in table</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-intable" title="insertion
  mode: in table">in table</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token</dt>
   <dd>

     <p>Let the <dfn id="pending-table-character-tokens"><var>pending table character tokens</var></dfn>
     be an empty list of tokens.</p>

     <p>Let the <a href="parsing.html#original-insertion-mode">original insertion mode</a> be the current
     <a href="parsing.html#insertion-mode">insertion mode</a>.</p>

     <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-intabletext" title="insertion mode: in table text">in table text</a>" and
     reprocess the token.</p>

   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "caption"</dt>
   <dd>

    <p><a href="#clear-the-stack-back-to-a-table-context">Clear the stack back to a table context</a>. (See
    below.)</p>

    <p>Insert a marker at the end of the <a href="parsing.html#list-of-active-formatting-elements">list of active
    formatting elements</a>.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token, then
    switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-incaption" title="insertion mode: in caption">in caption</a>".</p>

   </dd>

   <dt>A start tag whose tag name is "colgroup"</dt>
   <dd>

    <p><a href="#clear-the-stack-back-to-a-table-context">Clear the stack back to a table context</a>. (See
    below.)</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token, then
    switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-incolgroup" title="insertion mode: in column group">in column
    group</a>".</p>

   </dd>

   <dt>A start tag whose tag name is "col"</dt>
   <dd>
    <p>Act as if a start tag token with the tag name "colgroup"
    had been seen, then reprocess the current token.</p>
   </dd>

   <dt>A start tag whose tag name is one of: "tbody", "tfoot", "thead"</dt>
   <dd>

    <p><a href="#clear-the-stack-back-to-a-table-context">Clear the stack back to a table context</a>. (See
    below.)</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token, then
    switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-intbody" title="insertion mode: in table body">in table
    body</a>".</p>

   </dd>

   <dt>A start tag whose tag name is one of: "td", "th", "tr"</dt>
   <dd>
    <p>Act as if a start tag token with the tag name "tbody" had
    been seen, then reprocess the current token.</p>
   </dd>

   <dt>A start tag whose tag name is "table"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>. Act as if an end tag token with
    the tag name "table" had been seen, then, if that token wasn't
    ignored, reprocess the current token.</p>

    <p class="note">The fake end tag token here can only be
    ignored in the <a href="the-end.html#fragment-case">fragment case</a>.</p>

   </dd>

   <dt>An end tag whose tag name is "table"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have an element in table
    scope</a> with the same tag name as the token, this is a
    <a href="parsing.html#parse-error">parse error</a>. Ignore the token. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise:</p>

    <p>Pop elements from this stack until a <code><a href="tabular-data.html#the-table-element">table</a></code>
    element has been popped from the stack.</p>

    <p><a href="parsing.html#reset-the-insertion-mode-appropriately">Reset the insertion mode appropriately</a>.</p>

   </dd>

   <dt>An end tag whose tag name is one of: "body", "caption",
   "col", "colgroup", "html", "tbody", "td", "tfoot", "th",
   "thead", "tr"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is one of: "style", "script"</dt>
   <dd>

    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>

   </dd>

   <dt>A start tag whose tag name is "input"</dt>
   <dd>

    <p>If the token does not have an attribute with the name "type",
    or if it does, but that attribute's value is not an <a href="infrastructure.html#ascii-case-insensitive">ASCII
    case-insensitive</a> match for the string "<code title="">hidden</code>", then: act as described in the "anything
    else" entry below.</p>

    <p>Otherwise:</p>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Pop that <code><a href="the-input-element.html#the-input-element">input</a></code> element off the <a href="parsing.html#stack-of-open-elements">stack of
    open elements</a>.</p>

   </dd>

   <dt>A start tag whose tag name is "form"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

    <p>Pop that <code><a href="forms.html#the-form-element">form</a></code> element off the <a href="parsing.html#stack-of-open-elements">stack of
    open elements</a>.</p>

   </dd>

   <dt>An end-of-file token</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is not the root
    <code><a href="semantics.html#the-html-element-0">html</a></code> element, then this is a <a href="parsing.html#parse-error">parse
    error</a>.</p>

    <p class="note">It can only be the <a href="parsing.html#current-node">current node</a> in
    the <a href="the-end.html#fragment-case">fragment case</a>.</p>

    <p><a href="the-end.html#stop-parsing">Stop parsing</a>.</p>

   </dd>

   <dt>Anything else</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>. Process the token <a href="parsing.html#using-the-rules-for">using the
    rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in
    body</a>" <a href="parsing.html#insertion-mode">insertion mode</a>, except that if the
    <a href="parsing.html#current-node">current node</a> is a <code><a href="tabular-data.html#the-table-element">table</a></code>,
    <code><a href="tabular-data.html#the-tbody-element">tbody</a></code>, <code><a href="tabular-data.html#the-tfoot-element">tfoot</a></code>, <code><a href="tabular-data.html#the-thead-element">thead</a></code>, or
    <code><a href="tabular-data.html#the-tr-element">tr</a></code> element, then, whenever a node would be inserted
    into the <a href="parsing.html#current-node">current node</a>, it must instead be <a href="#foster-parent" title="foster parent">foster parented</a>.</p>

   </dd>

  </dl><p>When the steps above require the UA to <dfn id="clear-the-stack-back-to-a-table-context">clear the stack
  back to a table context</dfn>, it means that the UA must, while
  the <a href="parsing.html#current-node">current node</a> is not a <code><a href="tabular-data.html#the-table-element">table</a></code>
  element or an <code><a href="semantics.html#the-html-element-0">html</a></code> element, pop elements from the
  <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</p>

  <p class="note">The <a href="parsing.html#current-node">current node</a> being an
  <code><a href="semantics.html#the-html-element-0">html</a></code> element after this process is a <a href="the-end.html#fragment-case">fragment
  case</a>.</p>



  <h5 id="parsing-main-intabletext"><span class="secno">9.2.5.13 </span>The "<dfn title="insertion mode: in table text">in table text</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-intabletext" title="insertion
  mode: in table text">in table text</a>", tokens must be handled
  as follows:</p>

  <dl class="switch"><dt>A character token</dt>
   <dd>

    <p>Append the character token to the <var><a href="#pending-table-character-tokens">pending table character
    tokens</a></var> list.</p>

   </dd>


   <dt>Anything else</dt>
   <dd>

    <p>If any of the tokens in the <var><a href="#pending-table-character-tokens">pending table character
    tokens</a></var> list are character tokens that are not one of U+0009
    CHARACTER TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED
    (FF), <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE, then
    reprocess those character tokens using the rules given in the
    "anything else" entry in the <a href="#parsing-main-intable" title="insertion mode: in
    table">in table</a>" insertion mode.</p>

    <p>Otherwise, <a href="#insert-a-character" title="insert a character">insert the
    characters</a> given by the <var><a href="#pending-table-character-tokens">pending table character
    tokens</a></var> list into the <a href="parsing.html#current-node">current node</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to the <a href="parsing.html#original-insertion-mode">original
    insertion mode</a> and reprocess the token.</p>

   </dd>

  </dl><h5 id="parsing-main-incaption"><span class="secno">9.2.5.14 </span>The "<dfn title="insertion mode: in caption">in caption</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-incaption" title="insertion
  mode: in caption">in caption</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>An end tag whose tag name is "caption"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have an element in table
    scope</a> with the same tag name as the token, this is a
    <a href="parsing.html#parse-error">parse error</a>. Ignore the token. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise:</p>

    <p><a href="#generate-implied-end-tags">Generate implied end tags</a>.</p>

    <p>Now, if the <a href="parsing.html#current-node">current node</a> is not a
    <code><a href="tabular-data.html#the-caption-element">caption</a></code> element, then this is a <a href="parsing.html#parse-error">parse
    error</a>.</p>

    <p>Pop elements from this stack until a <code><a href="tabular-data.html#the-caption-element">caption</a></code>
    element has been popped from the stack.</p>

    <p><a href="parsing.html#clear-the-list-of-active-formatting-elements-up-to-the-last-marker">Clear the list of active formatting elements up to
    the last marker</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-intable" title="insertion mode: in table">in table</a>".</p>

   </dd>

   <dt>A start tag whose tag name is one of: "caption", "col",
   "colgroup", "tbody", "td", "tfoot", "th", "thead", "tr"</dt>
   <dt>An end tag whose tag name is "table"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>. Act as if an end tag with the tag
    name "caption" had been seen, then, if that token wasn't
    ignored, reprocess the current token.</p>

    <p class="note">The fake end tag token here can only be
    ignored in the <a href="the-end.html#fragment-case">fragment case</a>.</p>

   </dd>

   <dt>An end tag whose tag name is one of: "body", "col",
   "colgroup", "html", "tbody", "td", "tfoot", "th", "thead",
   "tr"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

  </dl><h5 id="parsing-main-incolgroup"><span class="secno">9.2.5.15 </span>The "<dfn title="insertion mode: in column group">in column group</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-incolgroup" title="insertion
  mode: in column group">in column group</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p><a href="#insert-a-character" title="insert a character">Insert the character</a> into
    the <a href="parsing.html#current-node">current node</a>.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "col"</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token. Immediately
    pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p><a href="#acknowledge-self-closing-flag" title="acknowledge self-closing flag">Acknowledge the
    token's <i>self-closing flag</i></a>, if it is set.</p>

   </dd>

   <dt>An end tag whose tag name is "colgroup"</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is the root
    <code><a href="semantics.html#the-html-element-0">html</a></code> element, then this is a <a href="parsing.html#parse-error">parse
    error</a>; ignore the token. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise, pop the <a href="parsing.html#current-node">current node</a> (which will be
    a <code><a href="tabular-data.html#the-colgroup-element">colgroup</a></code> element) from the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>. Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to
    "<a href="#parsing-main-intable" title="insertion mode: in table">in table</a>".</p>

   </dd>

   <dt>An end tag whose tag name is "col"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>An end-of-file token</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is the root <code><a href="semantics.html#the-html-element-0">html</a></code>
    element, then <a href="the-end.html#stop-parsing">stop parsing</a>. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise, act as described in the "anything else" entry
    below.</p>

   </dd>

   <dt>Anything else</dt>
   <dd>

    <p>Act as if an end tag with the tag name "colgroup" had been
    seen, and then, if that token wasn't ignored, reprocess the
    current token.</p>

    <p class="note">The fake end tag token here can only be
    ignored in the <a href="the-end.html#fragment-case">fragment case</a>.</p>

   </dd>

  </dl><h5 id="parsing-main-intbody"><span class="secno">9.2.5.16 </span>The "<dfn title="insertion mode: in table body">in table body</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-intbody" title="insertion
  mode: in table body">in table body</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A start tag whose tag name is "tr"</dt>
   <dd>

    <p><a href="#clear-the-stack-back-to-a-table-body-context">Clear the stack back to a table body
    context</a>. (See below.)</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token, then switch
    the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-intr" title="insertion mode:
    in row">in row</a>".</p>

   </dd>

   <dt>A start tag whose tag name is one of: "th", "td"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Act as if a start tag with
    the tag name "tr" had been seen, then reprocess the current
    token.</p>
   </dd>

   <dt>An end tag whose tag name is one of: "tbody", "tfoot",
   "thead"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have an element in table
    scope</a> with the same tag name as the token, this is a
    <a href="parsing.html#parse-error">parse error</a>. Ignore the token.</p>

    <p>Otherwise:</p>

    <p><a href="#clear-the-stack-back-to-a-table-body-context">Clear the stack back to a table body
    context</a>. (See below.)</p>

    <p>Pop the <a href="parsing.html#current-node">current node</a> from the <a href="parsing.html#stack-of-open-elements">stack of
    open elements</a>. Switch the <a href="parsing.html#insertion-mode">insertion mode</a>
    to "<a href="#parsing-main-intable" title="insertion mode: in table">in table</a>".</p>

   </dd>

   <dt>A start tag whose tag name is one of: "caption", "col",
   "colgroup", "tbody", "tfoot", "thead"</dt>
   <dt>An end tag whose tag name is "table"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have a
    <code>tbody</code>, <code>thead</code>, or <code>tfoot</code>
    element in table scope</a>, this is a <a href="parsing.html#parse-error">parse
    error</a>. Ignore the token. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise:</p>

    <p><a href="#clear-the-stack-back-to-a-table-body-context">Clear the stack back to a table body
    context</a>. (See below.)</p>

    <p>Act as if an end tag with the same tag name as the
    <a href="parsing.html#current-node">current node</a> ("tbody", "tfoot", or "thead") had
    been seen, then reprocess the current token.</p>

   </dd>

   <dt>An end tag whose tag name is one of: "body", "caption",
   "col", "colgroup", "html", "td", "th", "tr"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-intable" title="insertion mode: in table">in table</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

  </dl><p>When the steps above require the UA to <dfn id="clear-the-stack-back-to-a-table-body-context">clear the stack
  back to a table body context</dfn>, it means that the UA must,
  while the <a href="parsing.html#current-node">current node</a> is not a <code><a href="tabular-data.html#the-tbody-element">tbody</a></code>,
  <code><a href="tabular-data.html#the-tfoot-element">tfoot</a></code>, <code><a href="tabular-data.html#the-thead-element">thead</a></code>, or <code><a href="semantics.html#the-html-element-0">html</a></code>
  element, pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open
  elements</a>.</p>

  <p class="note">The <a href="parsing.html#current-node">current node</a> being an
  <code><a href="semantics.html#the-html-element-0">html</a></code> element after this process is a <a href="the-end.html#fragment-case">fragment
  case</a>.</p>


  <h5 id="parsing-main-intr"><span class="secno">9.2.5.17 </span>The "<dfn title="insertion mode: in row">in row</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-intr" title="insertion
  mode: in row">in row</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A start tag whose tag name is one of: "th", "td"</dt>
   <dd>

    <p><a href="#clear-the-stack-back-to-a-table-row-context">Clear the stack back to a table row
    context</a>. (See below.)</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token, then switch
    the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-intd" title="insertion mode:
    in cell">in cell</a>".</p>

    <p>Insert a marker at the end of the <a href="parsing.html#list-of-active-formatting-elements">list of active
    formatting elements</a>.</p>

   </dd>

   <dt>An end tag whose tag name is "tr"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have an element in table
    scope</a> with the same tag name as the token, this is a
    <a href="parsing.html#parse-error">parse error</a>. Ignore the token. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise:</p>

    <p><a href="#clear-the-stack-back-to-a-table-row-context">Clear the stack back to a table row
    context</a>. (See below.)</p>

    <p>Pop the <a href="parsing.html#current-node">current node</a> (which will be a
    <code><a href="tabular-data.html#the-tr-element">tr</a></code> element) from the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>. Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to
    "<a href="#parsing-main-intbody" title="insertion mode: in table body">in table
    body</a>".</p>

   </dd>

   <dt>A start tag whose tag name is one of: "caption", "col",
   "colgroup", "tbody", "tfoot", "thead", "tr"</dt>
   <dt>An end tag whose tag name is "table"</dt>
   <dd>

    <p>Act as if an end tag with the tag name "tr" had been seen,
    then, if that token wasn't ignored, reprocess the current
    token.</p>

    <p class="note">The fake end tag token here can only be
    ignored in the <a href="the-end.html#fragment-case">fragment case</a>.</p>

   </dd>

   <dt>An end tag whose tag name is one of: "tbody", "tfoot",
   "thead"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have an element in table
    scope</a> with the same tag name as the token, this is a
    <a href="parsing.html#parse-error">parse error</a>. Ignore the token.</p>

    <p>Otherwise, act as if an end tag with the tag name "tr" had
    been seen, then reprocess the current token.</p>

   </dd>

   <dt>An end tag whose tag name is one of: "body", "caption",
   "col", "colgroup", "html", "td", "th"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-intable" title="insertion mode: in table">in table</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

  </dl><p>When the steps above require the UA to <dfn id="clear-the-stack-back-to-a-table-row-context">clear the stack
  back to a table row context</dfn>, it means that the UA must,
  while the <a href="parsing.html#current-node">current node</a> is not a <code><a href="tabular-data.html#the-tr-element">tr</a></code>
  element or an <code><a href="semantics.html#the-html-element-0">html</a></code> element, pop elements from the
  <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</p>

  <p class="note">The <a href="parsing.html#current-node">current node</a> being an
  <code><a href="semantics.html#the-html-element-0">html</a></code> element after this process is a <a href="the-end.html#fragment-case">fragment
  case</a>.</p>


  <h5 id="parsing-main-intd"><span class="secno">9.2.5.18 </span>The "<dfn title="insertion mode: in cell">in cell</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-intd" title="insertion
  mode: in cell">in cell</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>An end tag whose tag name is one of: "td", "th"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have an element in table
    scope</a> with the same tag name as that of the token, then
    this is a <a href="parsing.html#parse-error">parse error</a> and the token must be
    ignored.</p>

    <p>Otherwise:</p>

    <p><a href="#generate-implied-end-tags">Generate implied end tags</a>.</p>

    <p>Now, if the <a href="parsing.html#current-node">current node</a> is not an element
    with the same tag name as the token, then this is a
    <a href="parsing.html#parse-error">parse error</a>.</p>

    <p>Pop elements from this stack until an element with the same
    tag name as the token has been popped from the stack.</p>

    <p><a href="parsing.html#clear-the-list-of-active-formatting-elements-up-to-the-last-marker">Clear the list of active formatting elements up to
    the last marker</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-intr" title="insertion mode: in row">in row</a>". (The
    <a href="parsing.html#current-node">current node</a> will be a <code><a href="tabular-data.html#the-tr-element">tr</a></code> element at
    this point.)</p>

   </dd>

   <dt>A start tag whose tag name is one of: "caption", "col",
   "colgroup", "tbody", "td", "tfoot", "th", "thead", "tr"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does
    <em>not</em> <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have
    a <code>td</code> or <code>th</code> element in table
    scope</a>, then this is a <a href="parsing.html#parse-error">parse error</a>; ignore
    the token. (<a href="the-end.html#fragment-case">fragment case</a>)</p>

    <p>Otherwise, <a href="#close-the-cell">close the cell</a> (see below) and
    reprocess the current token.</p>

   </dd>

   <dt>An end tag whose tag name is one of: "body", "caption",
   "col", "colgroup", "html"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>An end tag whose tag name is one of: "table", "tbody",
   "tfoot", "thead", "tr"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have an element in table
    scope</a> with the same tag name as that of the token
    (which can only happen for "tbody", "tfoot" and "thead", or,
    in the <a href="the-end.html#fragment-case">fragment case</a>), then this is a <a href="parsing.html#parse-error">parse
    error</a> and the token must be ignored.</p>

    <p>Otherwise, <a href="#close-the-cell">close the cell</a> (see below) and
    reprocess the current token.</p>

   </dd>

   <dt>Anything else</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

  </dl><p>Where the steps above say to <dfn id="close-the-cell">close the cell</dfn>, they
  mean to run the following algorithm:</p>

  <ol><li><p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">has a <code>td</code>
   element in table scope</a>, then act as if an end tag token
   with the tag name "td" had been seen.</li>

   <li><p>Otherwise, the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> will
   <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have a
   <code>th</code> element in table scope</a>; act as if an end
   tag token with the tag name "th" had been seen.</li>

  </ol><p class="note">The <a href="parsing.html#stack-of-open-elements">stack of open elements</a> cannot
  have both a <code><a href="tabular-data.html#the-td-element">td</a></code> and a <code><a href="tabular-data.html#the-th-element">th</a></code> element <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">in table scope</a> at
  the same time, nor can it have neither when the <a href="parsing.html#insertion-mode">insertion
  mode</a> is "<a href="#parsing-main-intd" title="insertion mode: in cell">in
  cell</a>".</p>


  <h5 id="parsing-main-inselect"><span class="secno">9.2.5.19 </span>The "<dfn title="insertion mode: in select">in select</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-inselect" title="insertion
  mode: in select">in select</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token</dt>
   <dd>
    <p><a href="#insert-a-character" title="insert a character">Insert the token's
    character</a> into the <a href="parsing.html#current-node">current node</a>.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "option"</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is an <code><a href="the-button-element.html#the-option-element">option</a></code>
    element, act as if an end tag with the tag name "option" had
    been seen.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

   </dd>

   <dt>A start tag whose tag name is "optgroup"</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is an <code><a href="the-button-element.html#the-option-element">option</a></code>
    element, act as if an end tag with the tag name "option" had
    been seen.</p>

    <p>If the <a href="parsing.html#current-node">current node</a> is an
    <code><a href="the-button-element.html#the-optgroup-element">optgroup</a></code> element, act as if an end tag with the
    tag name "optgroup" had been seen.</p>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>

   </dd>

   <dt>An end tag whose tag name is "optgroup"</dt>
   <dd>

    <p>First, if the <a href="parsing.html#current-node">current node</a> is an
    <code><a href="the-button-element.html#the-option-element">option</a></code> element, and the node immediately before
    it in the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> is an
    <code><a href="the-button-element.html#the-optgroup-element">optgroup</a></code> element, then act as if an end tag with
    the tag name "option" had been seen.</p>

    <p>If the <a href="parsing.html#current-node">current node</a> is an
    <code><a href="the-button-element.html#the-optgroup-element">optgroup</a></code> element, then pop that node from the
    <a href="parsing.html#stack-of-open-elements">stack of open elements</a>. Otherwise, this is a
    <a href="parsing.html#parse-error">parse error</a>; ignore the token.</p>

   </dd>

   <dt>An end tag whose tag name is "option"</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is an <code><a href="the-button-element.html#the-option-element">option</a></code>
    element, then pop that node from the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>. Otherwise, this is a <a href="parsing.html#parse-error">parse
    error</a>; ignore the token.</p>

   </dd>

   <dt>An end tag whose tag name is "select"</dt>
   <dd>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have an element in table
    scope</a> with the same tag name as the token, this is a
    <a href="parsing.html#parse-error">parse error</a>. Ignore the token. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise:</p>

    <p>Pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open elements</a>
    until a <code><a href="the-button-element.html#the-select-element">select</a></code> element has been popped from the
    stack.</p>

    <p><a href="parsing.html#reset-the-insertion-mode-appropriately">Reset the insertion mode appropriately</a>.</p>

   </dd>

   <dt>A start tag whose tag name is "select"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>. Act as if the token had been
    an end tag with the tag name "select" instead.</p>

   </dd>

   <dt>A start tag whose tag name is one of: "input", "keygen", "textarea"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> does not <a href="parsing.html#has-an-element-in-table-scope" title="has an element in table scope">have a <code>select</code>
    element in table scope</a>, ignore the token. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise, act as if an end tag with the tag name "select" had
    been seen, and reprocess the token.</p>

   </dd>

   <dt>A start tag token whose tag name is "script"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end-of-file token</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is not the root
    <code><a href="semantics.html#the-html-element-0">html</a></code> element, then this is a <a href="parsing.html#parse-error">parse
    error</a>.</p>

    <p class="note">It can only be the <a href="parsing.html#current-node">current node</a> in
    the <a href="the-end.html#fragment-case">fragment case</a>.</p>

    <p><a href="the-end.html#stop-parsing">Stop parsing</a>.</p>

   </dd>

   <dt>Anything else</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

  </dl><h5 id="parsing-main-inselectintable"><span class="secno">9.2.5.20 </span>The "<dfn title="insertion mode: in select in table">in select in table</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-inselectintable" title="insertion
  mode: in select in table">in select in table</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A start tag whose tag name is one of: "caption", "table",
   "tbody", "tfoot", "thead", "tr", "td", "th"</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Act as if an end tag with the tag
    name "select" had been seen, and reprocess the token.</p>
   </dd>

   <dt>An end tag whose tag name is one of: "caption", "table",
   "tbody", "tfoot", "thead", "tr", "td", "th"</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>If the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> <a href="parsing.html#has-an-element-in-table-scope">has an
    element in table scope</a> with the same tag name as that
    of the token, then act as if an end tag with the tag name
    "select" had been seen, and reprocess the token. Otherwise,
    ignore the token.</p>

   </dd>

   <dt>Anything else</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inselect" title="insertion mode: in select">in select</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

  </dl><h5 id="parsing-main-inforeign"><span class="secno">9.2.5.21 </span>The "<dfn title="insertion mode: in foreign content">in foreign content</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-inforeign" title="insertion
  mode: in foreign content">in foreign content</a>", tokens must be
  handled as follows:</p>

  <dl class="switch"><dt>A character token</dt>
   <dd>

    <p><a href="#insert-a-character" title="insert a character">Insert the token's
    character</a> into the <a href="parsing.html#current-node">current node</a>.</p>

    <p>If the token is not one of U+0009 CHARACTER TABULATION, U+000A
    LINE FEED (LF), U+000C FORM FEED (FF), <!--U+000D CARRIAGE RETURN
    (CR),--> or U+0020 SPACE, then set the <a href="parsing.html#frameset-ok-flag">frameset-ok
    flag</a> to "not ok".</p>

   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>An end tag whose tag name is "script", if the <a href="parsing.html#current-node">current node</a> is a <code title="">script</code> element in the <a href="the-end.html#svg-namespace">SVG namespace</a>.</dt>
   <dd>

    <p>Pop the <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a>.</p>

    <p>Let the <var title="">old insertion point</var> have the
    same value as the current <a href="parsing.html#insertion-point">insertion point</a>. Let
    the <a href="parsing.html#insertion-point">insertion point</a> be just before the <a href="parsing.html#next-input-character">next
    input character</a>.</p>

    <p>Increment the parser's <a href="parsing.html#script-nesting-level">script nesting level</a> by
    one. Set the <a href="parsing.html#parser-pause-flag">parser pause flag</a> to true.</p>

    <p><a href="http://www.w3.org/TR/SVGMobile12/script.html#ScriptContentProcessing">Process
    the <code title="">script</code> element</a> according to the SVG
    rules, if the user agent supports SVG. <a href="references.html#refsSVG">[SVG]</a></p>

    <p class="note">Even if this causes <a href="apis-in-html-documents.html#dom-document-write" title="dom-document-write">new characters to be inserted into the
    tokenizer</a>, the parser will not be executed reentrantly,
    since the <a href="parsing.html#parser-pause-flag">parser pause flag</a> is true.</p>

    <p>Decrement the parser's <a href="parsing.html#script-nesting-level">script nesting level</a> by
    one. If the parser's <a href="parsing.html#script-nesting-level">script nesting level</a> is zero,
    then set the <a href="parsing.html#parser-pause-flag">parser pause flag</a> to false.</p>

    <p>Let the <a href="parsing.html#insertion-point">insertion point</a> have the value of the <var title="">old insertion point</var>. (In other words, restore the
    <a href="parsing.html#insertion-point">insertion point</a> to its previous value. This value
    might be the "undefined" value.)</p>

   </dd>

   <dt>A start tag whose tag name is neither "mglyph" nor "malignmark", if the <a href="parsing.html#current-node">current node</a> is an <code title="">mi</code> element in the <a href="the-end.html#mathml-namespace">MathML namespace</a>.</dt>
   <dt>A start tag whose tag name is neither "mglyph" nor "malignmark", if the <a href="parsing.html#current-node">current node</a> is an <code title="">mo</code> element in the <a href="the-end.html#mathml-namespace">MathML namespace</a>.</dt>
   <dt>A start tag whose tag name is neither "mglyph" nor "malignmark", if the <a href="parsing.html#current-node">current node</a> is an <code title="">mn</code> element in the <a href="the-end.html#mathml-namespace">MathML namespace</a>.</dt>
   <dt>A start tag whose tag name is neither "mglyph" nor "malignmark", if the <a href="parsing.html#current-node">current node</a> is an <code title="">ms</code> element in the <a href="the-end.html#mathml-namespace">MathML namespace</a>.</dt>
   <dt>A start tag whose tag name is neither "mglyph" nor "malignmark", if the <a href="parsing.html#current-node">current node</a> is an <code title="">mtext</code> element in the <a href="the-end.html#mathml-namespace">MathML namespace</a>.</dt>
   <dt>A start tag whose tag name is "svg", if the <a href="parsing.html#current-node">current node</a> is an <code title="">annotation-xml</code> element in the <a href="the-end.html#mathml-namespace">MathML namespace</a>.</dt>
   <dt>A start tag, if the <a href="parsing.html#current-node">current node</a> is a <code title="">foreignObject</code> element in the <a href="the-end.html#svg-namespace">SVG namespace</a>.</dt>
   <dt>A start tag, if the <a href="parsing.html#current-node">current node</a> is a <code title="">desc</code> element in the <a href="the-end.html#svg-namespace">SVG namespace</a>.</dt>
   <dt>A start tag, if the <a href="parsing.html#current-node">current node</a> is a <code title="">title</code> element in the <a href="the-end.html#svg-namespace">SVG namespace</a>.</dt>
   <dt>A start tag, if the <a href="parsing.html#current-node">current node</a> is an element in the <a href="the-end.html#html-namespace-0">HTML namespace</a>.</dt>
   <dt>An end tag</dt>
   <dd>

    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the
    <a href="parsing.html#secondary-insertion-mode">secondary insertion mode</a>.</p>

    <p>If, after doing so, the <a href="parsing.html#insertion-mode">insertion mode</a> is still
    "<a href="#parsing-main-inforeign" title="insertion mode: in foreign content">in foreign
    content</a>", but there is no element <a href="parsing.html#has-an-element-in-scope" title="has an
    element in scope">in scope</a> that has a namespace other than
    the <a href="the-end.html#html-namespace-0">HTML namespace</a>, switch the <a href="parsing.html#insertion-mode">insertion
    mode</a> to the <a href="parsing.html#secondary-insertion-mode">secondary insertion mode</a>.</p>

   </dd>

   <dt>A start tag whose tag name is one of: <!--"a",--> "b", "big",
   "blockquote", "body"<!--by inspection-->, "br", "center", "code",
   "dd", "div", "dl", "dt"<!-- so that dd and dt can be handled
   uniformly throughout the parser -->, "em", "embed", "h1", "h2",
   "h3", "h4"<!--for completeness-->, "h5", "h6"<!--for
   completeness-->, "head"<!--by inspection-->, "hr", "i", "img",
   "li", "listing"<!-- so that pre and listing can be handled
   uniformly throughout the parser -->, "menu", "meta", "nobr",
   "ol"<!-- so that dl, ul, and ol can be handled uniformly throughout
   the parser -->, "p", "pre", "ruby", "s", <!--"script",--> "small",
   "span", "strong", "strike"<!-- so that s and strike can be handled
   uniformly throughout the parser -->, <!--"style",--> "sub", "sup",
   "table"<!--by inspection-->, "tt", "u", "ul", "var"</dt> <!-- this
   list was determined empirically by studying over 6,000,000,000
   pages that were specifically not XML pages -->
   <dt>A start tag whose tag name is "font", if the token has any
   attributes named "color", "face", or "size"</dt> <!-- the
   attributes here are required so that SVG <font> will go through as
   SVG but legacy <font>s won't -->
   <dt>An end-of-file token</dt> <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>.</p>

    <p>Pop elements from the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> until
    the <a href="parsing.html#current-node">current node</a> is in the <a href="the-end.html#html-namespace-0">HTML
    namespace</a>.</p>

    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to the <a href="parsing.html#secondary-insertion-mode">secondary
    insertion mode</a>, and reprocess the token.</p>

   </dd>

   <dt>Any other start tag</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is an element in the
    <a href="the-end.html#mathml-namespace">MathML namespace</a>, <a href="#adjust-mathml-attributes">adjust MathML
    attributes</a> for the token. (This fixes the case of MathML
    attributes that are not all lowercase.)</p>

    <p>If the <a href="parsing.html#current-node">current node</a> is an element in the <a href="the-end.html#svg-namespace">SVG
    namespace</a>, and the token's tag name is one of the ones in
    the first column of the following table, change the tag name to
    the name given in the corresponding cell in the second
    column. (This fixes the case of SVG elements that are not all
    lowercase.)</p>

    <table><thead><tr><th> Tag name <th> Element name
     <tbody><tr><td> <code title="">altglyph</code> <td> <code title="">altGlyph</code>
      <tr><td> <code title="">altglyphdef</code> <td> <code title="">altGlyphDef</code>
      <tr><td> <code title="">altglyphitem</code> <td> <code title="">altGlyphItem</code>
      <tr><td> <code title="">animatecolor</code> <td> <code title="">animateColor</code>
      <tr><td> <code title="">animatemotion</code> <td> <code title="">animateMotion</code>
      <tr><td> <code title="">animatetransform</code> <td> <code title="">animateTransform</code>
      <tr><td> <code title="">clippath</code> <td> <code title="">clipPath</code>
      <tr><td> <code title="">feblend</code> <td> <code title="">feBlend</code>
      <tr><td> <code title="">fecolormatrix</code> <td> <code title="">feColorMatrix</code>
      <tr><td> <code title="">fecomponenttransfer</code> <td> <code title="">feComponentTransfer</code>
      <tr><td> <code title="">fecomposite</code> <td> <code title="">feComposite</code>
      <tr><td> <code title="">feconvolvematrix</code> <td> <code title="">feConvolveMatrix</code>
      <tr><td> <code title="">fediffuselighting</code> <td> <code title="">feDiffuseLighting</code>
      <tr><td> <code title="">fedisplacementmap</code> <td> <code title="">feDisplacementMap</code>
      <tr><td> <code title="">fedistantlight</code> <td> <code title="">feDistantLight</code>
      <tr><td> <code title="">feflood</code> <td> <code title="">feFlood</code>
      <tr><td> <code title="">fefunca</code> <td> <code title="">feFuncA</code>
      <tr><td> <code title="">fefuncb</code> <td> <code title="">feFuncB</code>
      <tr><td> <code title="">fefuncg</code> <td> <code title="">feFuncG</code>
      <tr><td> <code title="">fefuncr</code> <td> <code title="">feFuncR</code>
      <tr><td> <code title="">fegaussianblur</code> <td> <code title="">feGaussianBlur</code>
      <tr><td> <code title="">feimage</code> <td> <code title="">feImage</code>
      <tr><td> <code title="">femerge</code> <td> <code title="">feMerge</code>
      <tr><td> <code title="">femergenode</code> <td> <code title="">feMergeNode</code>
      <tr><td> <code title="">femorphology</code> <td> <code title="">feMorphology</code>
      <tr><td> <code title="">feoffset</code> <td> <code title="">feOffset</code>
      <tr><td> <code title="">fepointlight</code> <td> <code title="">fePointLight</code>
      <tr><td> <code title="">fespecularlighting</code> <td> <code title="">feSpecularLighting</code>
      <tr><td> <code title="">fespotlight</code> <td> <code title="">feSpotLight</code>
      <tr><td> <code title="">fetile</code> <td> <code title="">feTile</code>
      <tr><td> <code title="">feturbulence</code> <td> <code title="">feTurbulence</code>
      <tr><td> <code title="">foreignobject</code> <td> <code title="">foreignObject</code>
      <tr><td> <code title="">glyphref</code> <td> <code title="">glyphRef</code>
      <tr><td> <code title="">lineargradient</code> <td> <code title="">linearGradient</code>
      <tr><td> <code title="">radialgradient</code> <td> <code title="">radialGradient</code>
      <!--<tr> <td> <code title="">solidcolor</code> <td> <code title="">solidColor</code> (SVG 1.2)-->
      <tr><td> <code title="">textpath</code> <td> <code title="">textPath</code>
    </table><p>If the <a href="parsing.html#current-node">current node</a> is an element in the <a href="the-end.html#svg-namespace">SVG
    namespace</a>, <a href="#adjust-svg-attributes">adjust SVG attributes</a> for the
    token. (This fixes the case of SVG attributes that are not all
    lowercase.)</p>

    <p><a href="#adjust-foreign-attributes">Adjust foreign attributes</a> for the token. (This
    fixes the use of namespaced attributes, in particular XLink in
    SVG.)</p>

    <p><a href="#insert-a-foreign-element">Insert a foreign element</a> for the token, in the
    same namespace as the <a href="parsing.html#current-node">current node</a>.</p>

    <p>If the token has its <i>self-closing flag</i> set, pop the
    <a href="parsing.html#current-node">current node</a> off the <a href="parsing.html#stack-of-open-elements">stack of open
    elements</a> and <a href="#acknowledge-self-closing-flag" title="acknowledge self-closing
    flag">acknowledge the token's <i>self-closing flag</i></a>.</p>

   </dd>

  </dl><h5 id="parsing-main-afterbody"><span class="secno">9.2.5.22 </span>The "<dfn title="insertion mode: after body">after body</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-afterbody" title="insertion
  mode: after body">after body</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the first element in
    the <a href="parsing.html#stack-of-open-elements">stack of open elements</a> (the <code><a href="semantics.html#the-html-element-0">html</a></code>
    element), with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end tag whose tag name is "html"</dt>
   <dd>

    <p>If the parser was originally created as part of the <a href="the-end.html#html-fragment-parsing-algorithm">HTML
    fragment parsing algorithm</a>, this is a <a href="parsing.html#parse-error">parse
    error</a>; ignore the token. (<a href="the-end.html#fragment-case">fragment case</a>)</p>

    <p>Otherwise, switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#the-after-after-body-insertion-mode" title="insertion mode: after after body">after after
    body</a>".</p>

   </dd>

   <dt>An end-of-file token</dt>
   <dd>
    <p><a href="the-end.html#stop-parsing">Stop parsing</a>.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>

    <p><a href="parsing.html#parse-error">Parse error</a>. Switch the <a href="parsing.html#insertion-mode">insertion
    mode</a> to "<a href="#parsing-main-inbody" title="insertion mode: in body">in
    body</a>" and reprocess the token.</p>

   </dd>

  </dl><h5 id="parsing-main-inframeset"><span class="secno">9.2.5.23 </span>The "<dfn title="insertion mode: in frameset">in frameset</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-inframeset" title="insertion
  mode: in frameset">in frameset</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p><a href="#insert-a-character" title="insert a character">Insert the character</a> into
    the <a href="parsing.html#current-node">current node</a>.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "frameset"</dt>
   <dd>
    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.</p>
   </dd>

   <dt>An end tag whose tag name is "frameset"</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is the root
    <code><a href="semantics.html#the-html-element-0">html</a></code> element, then this is a <a href="parsing.html#parse-error">parse
    error</a>; ignore the token. (<a href="the-end.html#fragment-case">fragment
    case</a>)</p>

    <p>Otherwise, pop the <a href="parsing.html#current-node">current node</a> from the
    <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</p>

    <p>If the parser was <em>not</em> originally created as part
    of the <a href="the-end.html#html-fragment-parsing-algorithm">HTML fragment parsing algorithm</a>
    (<a href="the-end.html#fragment-case">fragment case</a>), and the <a href="parsing.html#current-node">current
    node</a> is no longer a <code><a href="obsolete.html#frameset">frameset</a></code> element, then
    switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#parsing-main-afterframeset" title="insertion mode: after frameset">after
    frameset</a>".</p>

   </dd>

   <dt>A start tag whose tag name is "frame"</dt>
   <dd>

    <p><a href="#insert-an-html-element">Insert an HTML element</a> for the token.
    Immediately pop the <a href="parsing.html#current-node">current node</a> off the
    <a href="parsing.html#stack-of-open-elements">stack of open elements</a>.</p>

    <p><a href="#acknowledge-self-closing-flag" title="acknowledge self-closing flag">Acknowledge the
    token's <i>self-closing flag</i></a>, if it is set.</p>

   </dd>

   <dt>A start tag whose tag name is "noframes"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end-of-file token</dt>
   <dd>

    <p>If the <a href="parsing.html#current-node">current node</a> is not the root
    <code><a href="semantics.html#the-html-element-0">html</a></code> element, then this is a <a href="parsing.html#parse-error">parse
    error</a>.</p>

    <p class="note">It can only be the <a href="parsing.html#current-node">current node</a> in
    the <a href="the-end.html#fragment-case">fragment case</a>.</p>

    <p><a href="the-end.html#stop-parsing">Stop parsing</a>.</p>

   </dd>

   <dt>Anything else</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

  </dl><h5 id="parsing-main-afterframeset"><span class="secno">9.2.5.24 </span>The "<dfn title="insertion mode: after frameset">after frameset</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#parsing-main-afterframeset" title="insertion
  mode: after frameset">after frameset</a>", tokens must be handled as follows:</p>

  <!-- due to rules in the "in frameset" mode, this can't be entered in the fragment case -->
  <dl class="switch"><dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dd>
    <p><a href="#insert-a-character" title="insert a character">Insert the character</a> into
    the <a href="parsing.html#current-node">current node</a>.</p>
   </dd>

   <dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <a href="parsing.html#current-node">current
    node</a> with the <code title="">data</code> attribute set to
    the data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end tag whose tag name is "html"</dt>
   <dd>
    <p>Switch the <a href="parsing.html#insertion-mode">insertion mode</a> to "<a href="#the-after-after-frameset-insertion-mode" title="insertion mode: after after frameset">after after
    frameset</a>".</p>
   </dd>

   <dt>A start tag whose tag name is "noframes"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end-of-file token</dt>
   <dd>
    <p><a href="the-end.html#stop-parsing">Stop parsing</a>.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

  </dl><h5 id="the-after-after-body-insertion-mode"><span class="secno">9.2.5.25 </span>The "<dfn title="insertion mode: after after body">after after body</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#the-after-after-body-insertion-mode" title="insertion
  mode: after after body">after after body</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <code>Document</code>
    object with the <code title="">data</code> attribute set to the
    data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end-of-file token</dt>
   <dd>
    <p><a href="the-end.html#stop-parsing">Stop parsing</a>.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Switch the <a href="parsing.html#insertion-mode">insertion mode</a>
    to "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" and
    reprocess the token.</p>
   </dd>

  </dl><h5 id="the-after-after-frameset-insertion-mode"><span class="secno">9.2.5.26 </span>The "<dfn title="insertion mode: after after frameset">after after frameset</dfn>" insertion mode</h5>

  <p>When the <a href="parsing.html#insertion-mode">insertion mode</a> is "<a href="#the-after-after-frameset-insertion-mode" title="insertion
  mode: after after frameset">after after frameset</a>", tokens must be handled as follows:</p>

  <dl class="switch"><dt>A comment token</dt>
   <dd>
    <p>Append a <code>Comment</code> node to the <code>Document</code>
    object with the <code title="">data</code> attribute set to the
    data given in the comment token.</p>
   </dd>

   <dt>A DOCTYPE token</dt>
   <dt>A character token that is one of U+0009 CHARACTER
   TABULATION, U+000A LINE FEED (LF), U+000C FORM FEED (FF),
   <!--U+000D CARRIAGE RETURN (CR),--> or U+0020 SPACE</dt>
   <dt>A start tag whose tag name is "html"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inbody" title="insertion mode: in body">in body</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>An end-of-file token</dt>
   <dd>
    <p><a href="the-end.html#stop-parsing">Stop parsing</a>.</p>
   </dd>

   <dt>A start tag whose tag name is "noframes"</dt>
   <dd>
    <p>Process the token <a href="parsing.html#using-the-rules-for">using the rules for</a> the "<a href="#parsing-main-inhead" title="insertion mode: in head">in head</a>" <a href="parsing.html#insertion-mode">insertion
    mode</a>.</p>
   </dd>

   <dt>Anything else</dt>
   <dd>
    <p><a href="parsing.html#parse-error">Parse error</a>. Ignore the token.</p>
   </dd>

  </dl></div>


  
