<!DOCTYPE HTML>


<html lang="en-GB-hixie">
 <head>
  <title>HTML 5</title>
  <link href="/style/specification" type="text/css" rel="stylesheet">
  <link href="/images/icon" rel="icon">

  <style type="text/css">
   h4 + .element { margin-top: -2.5em; padding-top: 2em; }
   h4 + p + .element { margin-top: -5em; padding-top: 4em; }
   .element { background: #EEFFEE; color: black; margin: 0 0 1em -1em; padding: 0 1em 0.25em 0.75em; border-left: solid #99FF99 0.25em; -padding: 0; /* that last decl is for IE6. Try removing it, it's hilarious! */ }
   .proposal { border: blue solid; padding: 1em; }
   table.matrix, table.matrix td { border: none; text-align: right; }
   table.matrix { margin-left: 2em; }
  </style>

 <link href="section-scripting0.html#nav-bar" rel="prev" title="3.17. Scripting"><link href="index.html#contents" rel="index" title="Table of contents"><link href="section-the-command.html#nav-bar" rel="next" title="3.18.3. The command element"></head><body class="cfc">
  <style scoped>
   * { color: gray ! important; background: none ! important; border-color: silver ! important; }
   img, object, iframe { filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); -webkit-filter: grayscale(100%); }
   .obsolete { border: double thick red ! important; background: yellow ! important; margin: 4em auto 0 auto; max-width: 50em; width: 70%; text-align: center; position: fixed;  z-index: 10000; top: 0; left: 0; right: 0; }
   .obsolete a { color: blue ! important; }
   .obsolete p { font: 900 2em sans-serif; color: red ! important; margin: 1em 1.5em ! important; }
  </style>
  <div class=obsolete>
   <p>This is a snapshot of an early working draft and has therefore
   been superseded by the <a href="http://whatwg.org/html">HTML
   standard</a>.</p>
   <p>This document will not be further updated.</p>
  </div>
<div class="head">
   <p><a href="http://www.whatwg.org/" class="logo" rel="home"><img src="/images/logo" alt="WHATWG"></a></p>

   <h1 id="html-5">HTML 5</h1>

   <h2 id="working" class="no-num no-toc">Call For Comments — 27 October 2007</h2></div><nav id="nav-bar"><a href="section-scripting0.html#nav-bar">&lt; 3.17. Scripting</a> – <a href="index.html#contents">Table of contents</a> – <a href="section-the-command.html#nav-bar">3.18.3. The command element &gt;</a></nav><h3 id="interactive-elements"><span class="secno">3.18. </span>Interactive
   elements</h3>

  <h4 id="the-details"><span class="secno">3.18.1. </span>The <dfn id="details"><code>details</code></dfn> element</h4>

  <p><a href="section-documents0.html#interactive1" title="interactive elements">Interactive</a>, <a href="section-documents0.html#block-level0" title="block-level elements">block-level element</a>.

  </p><dl class="element">
   <dt>Contexts in which this element may be used:

   </dt><dd>Where <a href="section-documents0.html#block-level0">block-level elements</a> are expected.

   </dd><dt>Content model:

   </dt><dd>One <code><a href="section-miscellaneous.html#legend">legend</a></code> element followed by
    either one or more <a href="section-documents0.html#block-level0">block-level elements</a> or <a href="section-documents0.html#inline-level0">inline-level content</a> (but not both).

   </dd><dt>Element-specific attributes:

   </dt><dd><code title="attr-details-open"><a href="#open0">open</a></code>

   </dd><dt>DOM interface:

   </dt><dd>
    <pre class="idl">interface <dfn id="htmldetailselement">HTMLDetailsElement</dfn> : <a href="section-elements.html#htmlelement">HTMLElement</a> {
  attribute boolean <a href="#open1" title="dom-details-open">open</a>;
};</pre>
  </dd></dl>

  <p>The <code><a href="#details">details</a></code> element represents
   additional information or controls which the user can obtain on demand.

  </p><p>The first element child of a <code><a href="#details">details</a></code>
   element, if it is a <code><a href="section-miscellaneous.html#legend">legend</a></code> element,
   represents the summary of the details.

  </p><p>If the first element is not a <code><a href="section-miscellaneous.html#legend">legend</a></code>
   element, the UA should provide its own legend (e.g. &quot;Details&quot;).

  </p><p>The <dfn id="open0" title="attr-details-open"><code>open</code></dfn>
   content attribute is a <a href="section-common1.html#boolean0">boolean attribute</a>. If
   present, it indicates that the details should be shown to the user. If the
   attribute is absent, the details should not be shown.

  </p><p>If the attribute is removed, then the details should be hidden. If the
   attribute is added, the details should be shown.

  </p><p>The user should be able to request that the details be shown or hidden.

  </p><p>The <dfn id="open1" title="dom-details-open"><code>open</code></dfn>
   attribute must <a href="section-elements.html#reflect">reflect</a> the <code title="attr-details-open"><a href="#open0">open</a></code> content
   attribute.</p>
  <!--
http://mail.gnome.org/archives/usability/2006-June/msg00015.html
http://developer.apple.com/documentation/UserExperience/Conceptual/OSXHIGuidelines/XHIGControls/chapter_18_section_7.html
https://www.google.com/base/settings
-->

  <p class="big-issue">Rendering will be described in the Rendering section in
   due course. Basically CSS :open and :closed match the element, it's a
   block-level element by default, and when it matches :closed it renders as
   if it had an XBL binding attached to it whose template was just
   <code>&lt;template&gt;▶&lt;content
   includes=&quot;legend:first-child&quot;&gt;Details&lt;/content&gt;&lt;/template&gt;</code>,
   and when it's :open it acts as if it had an XBL binding attached to it
   whose template was just <code>&lt;template&gt;▼&lt;content
   includes=&quot;legend:first-child&quot;&gt;Details&lt;/content&gt;&lt;content/&gt;&lt;/template&gt;</code>
   or some such.

  </p><p class="big-issue">Clicking the legend would make it open/close (and would
   change the content attribute). Question: Do we want the content attribute
   to reflect the actual state like this? I think we do, the DOM not
   reflecting state has been a pain in the neck before. But is it
   semantically ok?

  </p><h4 id="datagrid"><span class="secno">3.18.2. </span>The <dfn id="datagrid0"><code>datagrid</code></dfn> element</h4>

  <p><a href="section-documents0.html#interactive1" title="interactive elements">Interactive</a>, <a href="section-documents0.html#block-level0" title="block-level elements">block-level element</a>.

  </p><dl class="element">
   <dt>Contexts in which this element may be used:

   </dt><dd>Where <a href="section-documents0.html#block-level0">block-level elements</a> are expected,
    if there are no ancestor <a href="section-documents0.html#interactive1">interactive
    elements</a>.

   </dd><dt>Content model:

   </dt><dd>Either: Nothing.

   </dd><dd>Or: One or more <a href="section-documents0.html#block-level0">block-level elements</a>, the
    first of which is not a <code><a href="section-tabular.html#table">table</a></code> element.

   </dd><dd>Or: A single <code><a href="section-tabular.html#table">table</a></code> element.

   </dd><dd>Or: A single <code>select</code> element.

   </dd><dd>Or: A single <code>datalist</code> element.

   </dd><dt>Element-specific attributes:

   </dt><dd><code title="attr-datagrid-multiple"><a href="#multiple0">multiple</a></code>

   </dd><dd><code title="attr-datagrid-disabled"><a href="#disabled3">disabled</a></code>

   </dd><dt>DOM interface:

   </dt><dd>
    <pre class="idl">interface <dfn id="htmldatagridelement">HTMLDataGridElement</dfn> : <a href="section-elements.html#htmlelement">HTMLElement</a> {
           attribute <a href="#datagriddataprovider">DataGridDataProvider</a> <a href="#data2" title="dom-datagrid-data">data</a>;
  readonly attribute <a href="#datagridselection">DataGridSelection</a> <a href="#selection0" title="dom-datagrid-selection">selection</a>;
           attribute boolean <a href="#multiple" title="dom-datagrid-multiple">multiple</a>;
           attribute boolean <a href="#disabled2" title="dom-datagrid-disabled">disabled</a>;
  void <a href="#updateeverything" title="dom-datagrid-updateEverything">updateEverything</a>();
  void <a href="#updaterowschanged" title="dom-datagrid-updateRowsChanged">updateRowsChanged</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long count);
  void <a href="#updaterowsinserted" title="dom-datagrid-updateRowsInserted">updateRowsInserted</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long count);
  void <a href="#updaterowsremoved" title="dom-datagrid-updateRowsRemoved">updateRowsRemoved</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long count);
  void <a href="#updaterowchanged" title="dom-datagrid-updateRowChanged">updateRowChanged</a>(in <a href="#rowspecification">RowSpecification</a> row);
  void <a href="#updatecolumnchanged" title="dom-datagrid-updateColumnChanged">updateColumnChanged</a>(in unsigned long column);
  void <a href="#updatecellchanged" title="dom-datagrid-updateCellChanged">updateCellChanged</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long column);
};</pre>
  </dd></dl>

  <p class="big-issue">One possible thing to be added is a way to detect when a
   row/selection has been deleted, activated, etc, by the user (delete key,
   enter key, etc).</p>
  <!-- XXXPA -->

  <p class="big-issue">This element is defined as interactive, which means it
   can't contain other interactive elements, despite the fact that we expect
   it to work with other interactive elements e.g. checkboxes and input
   fields. It should be called something like a Leaf Interactive Element or
   something, which counts for ancestors looking in and not descendants
   looking out.

  </p><p>The <code><a href="#datagrid0">datagrid</a></code> element represents an
   interactive representation of tree, list, or tabular data.

  </p><p>The data being presented can come either from the content, as elements
   given as children of the <code><a href="#datagrid0">datagrid</a></code>
   element, or from a scripted data provider given by the <code title="dom-datagrid-data"><a href="#data2">data</a></code> DOM attribute.

  </p><p>The <code title="attr-datagrid-multiple"><a href="#multiple0">multiple</a></code> and <code title="attr-datagrid-disabled"><a href="#disabled3">disabled</a></code>
   attributes are <a href="section-common1.html#boolean0" title="boolean attribute">boolean
   attributes</a>. Their effects are described in the processing model
   sections below.

  </p><p>The <dfn id="multiple" title="dom-datagrid-multiple"><code>multiple</code></dfn> and <dfn id="disabled2" title="dom-datagrid-disabled"><code>disabled</code></dfn> DOM
   attributes must <a href="section-elements.html#reflect">reflect</a> the <code title="attr-datagrid-multiple"><a href="#multiple0">multiple</a></code> and
   <code title="attr-datagrid-disabled"><a href="#disabled3">disabled</a></code> content attributes respectively.

  </p><h5 id="the-datagrid"><span class="secno">3.18.2.1. </span>The <code><a href="#datagrid0">datagrid</a></code> data model</h5>

  <p><em>This section is non-normative.</em>

  </p><p>In the <code><a href="#datagrid0">datagrid</a></code> data model, data
   is structured as a set of rows representing a tree, each row being split
   into a number of columns. The columns are always present in the data
   model, although individual columns may be hidden in the presentation.

  </p><p>Each row can have child rows. Child rows may be hidden or shown, by
   closing or opening (respectively) the parent row.

  </p><p>Rows are referred to by the path along the tree that one would take to
   reach the row, using zero-based indices. Thus, the first row of a list is
   row &quot;0&quot;, the second row is row &quot;1&quot;; the first child row of the first row
   is row &quot;0,0&quot;, the second child row of the first row is row &quot;0,1&quot;; the
   fourth child of the seventh child of the third child of the tenth row is
   &quot;9,2,6,3&quot;, etc.

  </p><p>The columns can have captions. Those captions are not considered a row
   in their own right, they are obtained separately.

  </p><p>Selection of data in a <code><a href="#datagrid0">datagrid</a></code>
   operates at the row level. If the <code title="attr-datagrid-multiple"><a href="#multiple0">multiple</a></code> attribute is present, multiple rows
   can be selected at once, otherwise the user can only select one row at a
   time.

  </p><p>The <code><a href="#datagrid0">datagrid</a></code> element can be
   disabled entirely by setting the <code title="attr-datagrid-disabled"><a href="#disabled3">disabled</a></code> attribute.</p>
  <!--XXXDND
  <p class="big-issue">selection draggable [normative definitions are
  in the interactive part below]</p>
-->

  <p>Columns, rows, and cells can each have specific flags, known as classes,
   applied to them by the data provider. These classes <a href="#datagridClassSummary">affect the functionality</a> of the <code><a href="#datagrid0">datagrid</a></code> element, and are also <a href="section-rendering.html#datagridPseudos">passed to the style system</a>. They are similar
   in concept to the <code title="attr-class"><a href="section-global.html#class">class</a></code>
   attribute, except that they are not specified on elements but are given by
   scripted data providers.</p>
  <!-- XXX check xrefs -->

  <h5 id="how-rows"><span class="secno">3.18.2.2. </span>How rows are identified</h5>

  <p>The chains of numbers that give a row's path, or identifier, are
   represented by objects that implement the <a href="#rowspecification">RowSpecification</a> interface.

  </p><pre class="idl">interface <dfn id="rowspecification">RowSpecification</dfn> {
  // binding-specific interface
};</pre>

  <p>In ECMAScript, two classes of objects are said to implement this
   interface: Numbers representing non-negative integers, and homogeneous
   arrays of Numbers representing non-negative integers. Thus,
   <code>[1,0,9]</code> is a <a href="#rowspecification">RowSpecification</a>, as is <code>1</code> on its
   own. However, <code>[1,0.2,9]</code> is not a <a href="#rowspecification">RowSpecification</a> object, since its second
   value is not an integer.

  </p><p>User agents must always represent <code><a href="#rowspecification">RowSpecification</a></code>s in ECMAScript by
   using arrays, even if the path only has one number.

  </p><p>The root of the tree is represented by the empty path; in ECMAScript,
   this is the empty array (<code>[]</code>). Only the <code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount()</a></code> and <code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">GetChildAtPosition()</a></code> methods ever
   get called with the empty path.

  </p><h5 id="the-data"><span class="secno">3.18.2.3. </span>The data provider
   interface</h5>

  <p><em>The conformance criteria in this section apply to any implementation
   of the <code><a href="#datagriddataprovider">DataGridDataProvider</a></code>, including
   (and most commonly) the content author's implementation(s).</em>

  </p><pre class="idl">// To be implemented by Web authors as a JS object
interface <dfn id="datagriddataprovider">DataGridDataProvider</dfn> {
  void <a href="#initialize" title="dom-provider-initialize">initialize</a>(in HTMLDataGridElement datagrid);
  unsigned long <a href="#getrowcount" title="dom-provider-getRowCount">getRowCount</a>(in <a href="#rowspecification">RowSpecification</a> row);
  unsigned long <a href="#getchildatposition" title="dom-provider-getChildAtPosition">getChildAtPosition</a>(in <a href="#rowspecification">RowSpecification</a> parentRow, in unsigned long position);
  unsigned long <a href="#getcolumncount" title="dom-provider-getColumnCount">getColumnCount</a>();
  DOMString <a href="#getcaptiontext" title="dom-provider-getCaptionText">getCaptionText</a>(in unsigned long column);
  void <a href="#getcaptionclasses" title="dom-provider-getCaptionClasses">getCaptionClasses</a>(in unsigned long column, in DOMTokenList classes);
  DOMString <a href="#getrowimage" title="dom-provider-getRowImage">getRowImage</a>(in <a href="#rowspecification">RowSpecification</a> row);
  <a href="section-the-command.html#htmlmenuelement">HTMLMenuElement</a> <a href="#getrowmenu" title="dom-provider-getRowMenu">getRowMenu</a>(in <a href="#rowspecification">RowSpecification</a> row);
  void <a href="#getrowclasses" title="dom-provider-getRowClasses">getRowClasses</a>(in <a href="#rowspecification">RowSpecification</a> row, in DOMTokenList classes);
  DOMString <a href="#getcelldata" title="dom-provider-getCellData">getCellData</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long column);
  void <a href="#getcellclasses" title="dom-provider-getCellClasses">getCellClasses</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long column, in DOMTokenList classes);
<!--XXXDND
  boolean <span title="dom-provider-canDrop">canDrop</span>(in <span>RowSpecification</span> row, in <span>RowSpecification</span> position, data);
  boolean <span title="dom-provider-dropped">dropped</span>(in <span>RowSpecification</span> row, in <span>RowSpecification</span> position, data);
-->  void <a href="#togglecolumnsortstate" title="dom-provider-toggleColumnSortState">toggleColumnSortState</a>(in unsigned long column);
  void <a href="#setcellcheckedstate" title="dom-provider-setCellCheckedState">setCellCheckedState</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long column, in long state);
  void <a href="#cyclecell" title="dom-provider-cycleCell">cycleCell</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long column);
  void <a href="#editcell" title="dom-provider-editCell">editCell</a>(in <a href="#rowspecification">RowSpecification</a> row, in unsigned long column, in DOMString data);
<!--XXXPA
  void <span title="dom-provider-performAction">performAction</span>(in DOMString action); // required if .performAction() is ever invoked on the datagrid
  void <span title="dom-provider-performActionOnRow">performActionOnRow</span>(in <span>RowSpecification</span> row, in DOMString action); // required if getRowClasses ever includes 'deletable' or if <span title="dom-provider-.performActionOnRow">.performActionOnRow</span>() is ever invoked on the datagrid
  void <span title="dom-provider-performActionOnCell">performActionOnCell</span>(in <span>RowSpecification</span> row, in unsigned long column, in DOMString action); // required if .performActionOnCell() is ever invoked on the datagrid
-->};</pre>
  <!-- based on http://lxr.mozilla.org/seamonkey/source/layout/xul/base/src/tree/public/nsITreeView.idl -->

  <p>The <code><a href="#datagriddataprovider">DataGridDataProvider</a></code> interface
   represents the interface that objects must implement to be used as custom
   data views for <code><a href="#datagrid0">datagrid</a></code> elements.

  </p><p>Not all the methods are required. The minimum number of methods that
   must be implemented in a useful view is two: the <code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount()</a></code> and <code title="dom-provider-getCellData"><a href="#getcelldata">getCellData()</a></code> methods.

  </p><p>Once the object is written, it must be hooked up to the <code><a href="#datagrid0">datagrid</a></code> using the <dfn id="data2" title="dom-datagrid-data"><code>data</code></dfn> DOM attribute.

  </p><p>The following methods may be usefully implemented:

  </p><dl>
   <dt><dfn id="initialize" title="dom-provider-initialize"><code>initialize(<var title="">datagrid</var>)</code></dfn>

   </dt><dd>Called by the <code><a href="#datagrid0">datagrid</a></code> element
    (the one given by the <var title="">datagrid</var> argument) after it has
    first populated itself. This would typically be used to set the initial
    selection of the <code><a href="#datagrid0">datagrid</a></code> element
    when it is first loaded. The data provider could also use this method
    call to register a <code title="event-select"><a href="#select">select</a></code> event handler on the <code><a href="#datagrid0">datagrid</a></code> in order to monitor selection
    changes.

   </dd><dt><dfn id="getrowcount" title="dom-provider-getRowCount"><code>getRowCount(<var title="">row</var>)</code></dfn>

   </dt><dd>Must return the number of rows that are children of the specified <var title="">row</var>, including rows that are off-screen. If <var title="">row</var> is empty, then the number of rows at the top level
    must be returned. If the value that this method would return for a given
    <var title="">row</var> changes, the relevant update methods on the
    <code><a href="#datagrid0">datagrid</a></code> must be called first.
    Otherwise, this method must always return the same number. For a list (as
    opposed to a tree), this method must return 0 whenever it is called with
    a <var title="">row</var> identifier that is not empty.

   </dd><dt><dfn id="getchildatposition" title="dom-provider-getChildAtPosition"><code>getChildAtPosition(<var title="">parentRow</var>, <var title="">position</var>)</code></dfn>

   </dt><dd>Must return the index of the row that is a child of <var title="">parentRow</var> and that is to be positioned as the <var title="">position</var>th row under <var title="">parentRow</var> when
    rendering the children of <var title="">parentRow</var>. If <var title="">parentRow</var> is empty, then <var title="">position</var>
    refers to the <var title="">position</var>th row at the top level of the
    data grid. May be omitted if the rows are always to be sorted in the
    natural order. (The natural order is the one where the method always
    returns <var title="">position</var>.) For a given <var title="">parentRow</var>, this method must never return the same value
    for different values of <var title="">position</var>. The returned value
    <var title="">x</var> must be in the range 0 ≤ <var title="">x</var> &lt; <var title="">n</var>, where <var title="">n</var> is the value returned by <code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount(<var title="">parentRow</var>)</a></code>.

   </dd><dt><dfn id="getcolumncount" title="dom-provider-getColumnCount"><code>getColumnCount()</code></dfn>

   </dt><dd>Must return the number of columns currently in the data model
    (including columns that might be hidden). May be omitted if there is only
    one column. If the value that this method would return changes, the
    <code><a href="#datagrid0">datagrid</a></code>'s <code title="dom-datagrid-updateEverything"><a href="#updateeverything">updateEverything()</a></code> method must be
    called.

   </dd><dt><dfn id="getcaptiontext" title="dom-provider-getCaptionText"><code>getCaptionText(<var title="">column</var>)</code></dfn>

   </dt><dd>Must return the caption, or label, for column <var title="">column</var>. May be omitted if the columns have no captions. If
    the value that this method would return changes, the <code><a href="#datagrid0">datagrid</a></code>'s <code title="dom-datagrid-updateColumnChanged"><a href="#updatecolumnchanged">updateColumnChanged()</a></code> method must
    be called with the appropriate column index.

   </dd><dt><dfn id="getcaptionclasses" title="dom-provider-getCaptionClasses"><code>getCaptionClasses(<var title="">column</var>, <var title="">classes</var>)</code></dfn>

   </dt><dd>Must add the classes that apply to column <var title="">column</var>
    to the <var title="">classes</var> object. May be omitted if the columns
    have no special classes. If the classes that this method would add
    changes, the <code><a href="#datagrid0">datagrid</a></code>'s <code title="dom-datagrid-updateColumnChanged"><a href="#updatecolumnchanged">updateColumnChanged()</a></code> method must
    be called with the appropriate column index. Some classes have <a href="#datagridClassSummary">predefined meanings</a>.

   </dd><dt><dfn id="getrowimage" title="dom-provider-getRowImage"><code>getRowImage(<var title="">row</var>)</code></dfn>

   </dt><dd>Must return a URI to an image that represents row <var title="">row</var>, or the empty string if there is no applicable image.
    May be omitted if no rows have associated images. If the value that this
    method would return changes, the <code><a href="#datagrid0">datagrid</a></code>'s update methods must be called to
    update the row in question.

   </dd><dt><dfn id="getrowmenu" title="dom-provider-getRowMenu"><code>getRowMenu(<var title="">row</var>)</code></dfn>

   </dt><dd>Must return an <code><a href="section-the-command.html#htmlmenuelement">HTMLMenuElement</a></code> object that is to be
    used as a context menu for row <var title="">row</var>, or null if there
    is no particular context menu. May be omitted if none of the rows have a
    special context menu. As this method is called immediately before showing
    the menu in question, no precautions need to be taken if the return value
    of this method changes.

   </dd><dt><dfn id="getrowclasses" title="dom-provider-getRowClasses"><code>getRowClasses(<var title="">row</var>, <var title="">classes</var>)</code></dfn>

   </dt><dd>Must add the classes that apply to row <var title="">row</var> to the
    <var title="">classes</var> object. May be omitted if the rows have no
    special classes. If the classes that this method would add changes, the
    <code><a href="#datagrid0">datagrid</a></code>'s update methods must be
    called to update the row in question. Some classes have <a href="#datagridClassSummary">predefined meanings</a>.

   </dd><dt><dfn id="getcelldata" title="dom-provider-getCellData"><code>getCellData(<var title="">row</var>,
    <var title="">column</var>)</code></dfn>

   </dt><dd>Must return the value of the cell on row <var title="">row</var> in
    column <var title="">column</var>. For text cells, this must be the text
    to show for that cell. For <a href="#progress1" title="datagrid-cell-class-progress">progress bar cells</a>, this must be
    either a floating point number in the range 0.0 to 1.0 (converted to a
    string representation<!-- XXX this isn't
   technically enough to define what the author must be doing here,
   but let's let that slide until someone notices -->),
    indicating the fraction of the progress bar to show as full (1.0 meaning
    complete), or the empty string, indicating an indeterminate progress bar.
    If the value that this method would return changes, the <code><a href="#datagrid0">datagrid</a></code>'s update methods must be called to
    update the rows that changed. If only one cell changed, the <code title="dom-datagrid-updateCellChanged"><a href="#updatecellchanged">updateCellChanged()</a></code> method may be
    used.

   </dd><dt><dfn id="getcellclasses" title="dom-provider-getCellClasses"><code>getCellClasses(<var title="">row</var>, <var title="">column</var>, <var title="">classes</var>)</code></dfn>

   </dt><dd>Must add the classes that apply to the cell on row <var title="">row</var> in column <var title="">column</var> to the <var title="">classes</var> object. May be omitted if the cells have no
    special classes. If the classes that this method would add changes, the
    <code><a href="#datagrid0">datagrid</a></code>'s update methods must be
    called to update the rows or cells in question. Some classes have <a href="#datagridClassSummary">predefined meanings</a>.

   </dd><dt><dfn id="togglecolumnsortstate" title="dom-provider-toggleColumnSortState"><code>toggleColumnSortState(<var title="">column</var>)</code></dfn>

   </dt><dd>Called by the <code><a href="#datagrid0">datagrid</a></code> when the
    user tries to sort the data using a particular column <var title="">column</var>. The data provider must update its state so that
    the <code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">GetChildAtPosition()</a></code> method returns
    the new order, and the classes of the columns returned by <code title="dom-provider-getCaptionClasses"><a href="#getcaptionclasses">getCaptionClasses()</a></code> represent the
    new sort status. There is no need to tell the <code><a href="#datagrid0">datagrid</a></code> that it the data has changed, as
    the <code><a href="#datagrid0">datagrid</a></code> automatically assumes
    that the entire data model will need updating.

   </dd><dt><dfn id="setcellcheckedstate" title="dom-provider-setCellCheckedState"><code>setCellCheckedState(<var title="">row</var>, <var title="">column</var>, <var title="">state</var>)</code></dfn>

   </dt><dd>Called by the <code><a href="#datagrid0">datagrid</a></code> when the
    user changes the state of a checkbox cell on row <var title="">row</var>,
    column <var title="">column</var>. The checkbox should be toggled to the
    state given by <var title="">state</var>, which is a positive integer (1)
    if the checkbox is to be checked, zero (0) if it is to be unchecked, and
    a negative number (-1) if it is to be set to the indeterminate state.
    There is no need to tell the <code><a href="#datagrid0">datagrid</a></code> that the cell has changed, as the
    <code><a href="#datagrid0">datagrid</a></code> automatically assumes that
    the given cell will need updating.

   </dd><dt><dfn id="cyclecell" title="dom-provider-cycleCell"><code>cycleCell(<var title="">row</var>, <var title="">column</var>)</code></dfn>

   </dt><dd>Called by the <code><a href="#datagrid0">datagrid</a></code> when the
    user changes the state of a cyclable cell on row <var title="">row</var>,
    column <var title="">column</var>. The data provider should change the
    state of the cell to the new state, as appropriate. There is no need to
    tell the <code><a href="#datagrid0">datagrid</a></code> that the cell has
    changed, as the <code><a href="#datagrid0">datagrid</a></code>
    automatically assumes that the given cell will need updating.

   </dd><dt><dfn id="editcell" title="dom-provider-editCell"><code>editCell(<var title="">row</var>, <var title="">column</var>, <var title="">data</var>)</code></dfn>

   </dt><dd>Called by the <code><a href="#datagrid0">datagrid</a></code> when the
    user edits the cell on row <var title="">row</var>, column <var title="">column</var>. The new value of the cell is given by <var title="">data</var>. The data provider should update the cell
    accordingly. There is no need to tell the <code><a href="#datagrid0">datagrid</a></code> that the cell has changed, as the
    <code><a href="#datagrid0">datagrid</a></code> automatically assumes that
    the given cell will need updating.</dd>
   <!--XXXPA
  void performAction(in DOMString action); // required if .performAction() is ever invoked on the datagrid
  void performActionOnRow(in <span>RowSpecification</span> row, in DOMString action); // required if getRowClasses ever includes 'deletable' or if .performActionOnRow() is ever invoked on the datagrid
  void performActionOnCell(in <span>RowSpecification</span> row, in unsigned long column, in DOMString action); // required if .performActionOnCell() is ever invoked on the datagrid
-->
  </dl>

  <p>The following classes (for rows, columns, and cells) may be usefully
   used in conjunction with this interface:

  </p><table id="datagridClassSummary">
   <tbody>
    <tr>
     <th>Class name

     </th><th>Applies to

     </th><th>Description

    </th></tr><tr>
     <td><!--checked--><dfn id="checked" title="datagrid-cell-class-checked"><code>checked</code></dfn>

     </td><td>Cells

     </td><td>The cell has a checkbox and it is checked. (The <code title="datagrid-cell-class-cyclable"><a href="#cyclable">cyclable</a></code> and <code title="datagrid-cell-class-progress"><a href="#progress1">progress</a></code> classes override this, though.)

    </td></tr><tr>
     <td><!--cyclable--><dfn id="cyclable" title="datagrid-cell-class-cyclable"><code>cyclable</code></dfn>

     </td><td>Cells

     </td><td>The cell can be cycled through multiple values. (The <code title="datagrid-cell-class-progress"><a href="#progress1">progress</a></code> class overrides this, though.)

    </td></tr><tr>
     <td><!--editable--><dfn id="editable" title="datagrid-cell-class-editable"><code>editable</code></dfn>

     </td><td>Cells

     </td><td>The cell can be edited. (The <code title="datagrid-cell-class-cyclable"><a href="#cyclable">cyclable</a></code>, <code title="datagrid-cell-class-progress"><a href="#progress1">progress</a></code>, <code title="datagrid-cell-class-checked"><a href="#checked">checked</a></code>, <code title="datagrid-cell-class-checked"><a href="#checked">unchecked</a></code> and <code title="datagrid-cell-class-checked"><a href="#checked">indeterminate</a></code> classes override this,
      though.)

    </td></tr><tr>
     <td><!--header--><dfn id="header0" title="datagrid-row-class-header"><code>header</code></dfn>

     </td><td>Rows

     </td><td>The row is a heading, not a data row.

    </td></tr><tr>
     <td><!--indeterminate--><dfn id="indeterminate" title="datagrid-cell-class-indeterminate"><code>indeterminate</code></dfn>

     </td><td>Cells

     </td><td>The cell has a checkbox, and it can be set to an indeterminate
      state. If neither the <code title="datagrid-cell-class-checked"><a href="#checked">checked</a></code> nor <code title="datagrid-cell-class-checked"><a href="#checked">unchecked</a></code> classes are present, then the
      checkbox is in that state, too. (The <code title="datagrid-cell-class-cyclable"><a href="#cyclable">cyclable</a></code> and <code title="datagrid-cell-class-progress"><a href="#progress1">progress</a></code> classes override this, though.)

    </td></tr><tr>
     <td><!--initially-hidden--><dfn id="initially-hidden" title="datagrid-column-class-initially-hidden"><code>initially-hidden</code></dfn>

     </td><td>Columns

     </td><td>The column will not be shown when the <code><a href="#datagrid0">datagrid</a></code> is initially rendered. If this
      class is not present on the column when the <code><a href="#datagrid0">datagrid</a></code> is initially rendered, the column
      will be visible if space allows.

    </td></tr><tr>
     <td><!--initially-closed--><dfn id="initially-closed" title="datagrid-row-class-initially-closed"><code>initially-closed</code></dfn>

     </td><td>Rows

     </td><td>The row will be closed when the <code><a href="#datagrid0">datagrid</a></code> is initially rendered. If neither
      this class nor the <code title="datagrid-row-class-initially-open"><a href="#initially-open">initially-open</a></code> class is present on
      the row when the <code><a href="#datagrid0">datagrid</a></code> is
      initially rendered, the initial state will depend on platform
      conventions.

    </td></tr><tr>
     <td><!--initially-open--><dfn id="initially-open" title="datagrid-row-class-initially-open"><code>initially-open</code></dfn>

     </td><td>Rows

     </td><td>The row will be opened when the <code><a href="#datagrid0">datagrid</a></code> is initially rendered. If neither
      this class nor the <code title="datagrid-row-class-initially-closed"><a href="#initially-closed">initially-closed</a></code> class is present
      on the row when the <code><a href="#datagrid0">datagrid</a></code> is
      initially rendered, the initial state will depend on platform
      conventions.

    </td></tr><tr>
     <td><!--progress--><dfn id="progress1" title="datagrid-cell-class-progress"><code>progress</code></dfn>

     </td><td>Cells

     </td><td>The cell is a progress bar.

    </td></tr><tr>
     <td><!--reversed--><dfn id="reversed" title="datagrid-column-class-reversed"><code>reversed</code></dfn>

     </td><td>Columns

     </td><td>If the cell is sorted, the sort direction is descending, instead of
      ascending.

    </td></tr><tr>
     <td><!--selectable-separator--><dfn id="selectable-separator" title="datagrid-row-class-selectable-separator"><code>selectable-separator</code></dfn>

     </td><td>Rows

     </td><td>The row is a normal, selectable, data row, except that instead of
      having data, it only has a separator. (The <code title="datagrid-row-class-header"><a href="#header0">header</a></code>
      and <code title="datagrid-row-class-separator"><a href="#separator">separator</a></code> classes override this, though.)

    </td></tr><tr>
     <td><!--separator--><dfn id="separator" title="datagrid-row-class-separator"><code>separator</code></dfn>

     </td><td>Rows

     </td><td>The row is a separator row, not a data row. (The <code title="datagrid-row-class-header"><a href="#header0">header</a></code>
      class overrides this, though.)

    </td></tr><tr>
     <td><!--sortable--><dfn id="sortable" title="datagrid-column-class-sortable"><code>sortable</code></dfn>

     </td><td>Columns

     </td><td>The data can be sorted by this column.

    </td></tr><tr>
     <td><!--sorted--><dfn id="sorted" title="datagrid-column-class-sorted"><code>sorted</code></dfn>

     </td><td>Columns

     </td><td>The data is sorted by this column. Unless the <code title="datagrid-column-class-reversed"><a href="#reversed">reversed</a></code> class is also present, the sort
      direction is ascending.

    </td></tr><tr>
     <td><!--unchecked--><dfn id="unchecked" title="datagrid-cell-class-unchecked"><code>unchecked</code></dfn>

     </td><td>Cells

     </td><td>The cell has a checkbox and, unless the <code title="datagrid-cell-class-checked"><a href="#checked">checked</a></code>
      class is present as well, it is unchecked. (The <code title="datagrid-cell-class-cyclable"><a href="#cyclable">cyclable</a></code> and <code title="datagrid-cell-class-progress"><a href="#progress1">progress</a></code> classes override this, though.)
    </td></tr>
    <!--XXXPA
   <tr>
    <td><!- -deletable- -><dfn title="datagrid-row-class-deletable"><code>deletable</code></dfn></td>
    <td>Rows</td>
    <td></td>
   </tr>
-->
  </tbody></table>

  <h5 id="the-default"><span class="secno">3.18.2.4. </span>The default data
   provider</h5>

  <p>The user agent must supply a default data provider for the case where
   the <code><a href="#datagrid0">datagrid</a></code>'s <code title="dom-datagrid-data"><a href="#data2">data</a></code> attribute is
   null. It must act as described in this section.

  </p><p>The behaviour of the default data provider depends on the nature of the
   first element child of the <code><a href="#datagrid0">datagrid</a></code>.

  </p><dl class="switch">
   <dt>While the first element child is a <code><a href="section-tabular.html#table">table</a></code> element

   </dt><dd>
    <p><strong><code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount(<var title="">row</var>)</a></code></strong>: The number of rows returned by
     the default data provider for the root of the tree (when <var title="">row</var> is empty) must be the total number of <code><a href="section-tabular.html#tr">tr</a></code> elements that are children of <code><a href="section-tabular.html#tbody">tbody</a></code> elements that are children of the
     <code><a href="section-tabular.html#table">table</a></code>, if there are any such child
     <code><a href="section-tabular.html#tbody">tbody</a></code> elements. If there are no such
     <code><a href="section-tabular.html#tbody">tbody</a></code> elements then the number of rows
     returned for the root must be the number of <code><a href="section-tabular.html#tr">tr</a></code> elements that are children of the <code><a href="section-tabular.html#table">table</a></code>.</p>

    <p>When <var title="">row</var> is not empty, the number of rows returned
     must be zero.</p>

    <p class="note">The <code><a href="section-tabular.html#table">table</a></code>-based default
     data provider cannot represent a tree.</p>

    <p class="note">Rows in <code><a href="section-tabular.html#thead0">thead</a></code> elements
     do not contribute to the number of rows returned, although they do
     affect the columns and column captions. Rows in <code><a href="section-tabular.html#tfoot0">tfoot</a></code> elements are <a href="section-terminology.html#ignored" title="ignore">ignored</a> completely by this algorithm.</p>

    <p id="defaultDataProviderTableMapper"><strong><code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">getChildAtPosition(<var title="">row</var>,
     <var title="">i</var>)</a></code></strong>: The default data provider
     must return the mapping appropriate to the <a href="#defaultDataProviderTableSort">current sort order</a>.</p>

    <p><strong><code title="dom-provider-getColumnCount"><a href="#getcolumncount">getColumnCount()</a></code></strong>: The number
     of columns returned must be the number of <code><a href="section-tabular.html#td">td</a></code> element children in the first <code><a href="section-tabular.html#tr">tr</a></code> element child of the first <code><a href="section-tabular.html#tbody">tbody</a></code> element child of the <code><a href="section-tabular.html#table">table</a></code>, if there are any such <code><a href="section-tabular.html#tbody">tbody</a></code> elements. If there are no such <code><a href="section-tabular.html#tbody">tbody</a></code> elements, then it must be the number of
     <code><a href="section-tabular.html#td">td</a></code> element children in the first <code><a href="section-tabular.html#tr">tr</a></code> element child of the <code><a href="section-tabular.html#table">table</a></code>, if any, or otherwise 1. If the number
     that would be returned by these rules is 0, then 1 must be returned
     instead.</p>

    <p><strong><code title="dom-provider-getCaptionText"><a href="#getcaptiontext">getCaptionText(<var title="">i</var>)</a></code></strong>: If the <code><a href="section-tabular.html#table">table</a></code> has no <code><a href="section-tabular.html#thead0">thead</a></code> element child, or if its first <code><a href="section-tabular.html#thead0">thead</a></code> element child has no <code><a href="section-tabular.html#tr">tr</a></code> element child, the default data provider must
     return the empty string for all captions. Otherwise, the value of the
     <code><a href="section-conformance.html#textcontent">textContent</a></code> attribute of the
     <var title="">i</var>th <code><a href="section-tabular.html#th">th</a></code> element child
     of the first <code><a href="section-tabular.html#tr">tr</a></code> element child of the
     first <code><a href="section-tabular.html#thead0">thead</a></code> element child of the
     <code><a href="section-tabular.html#table">table</a></code> element must be returned. If
     there is no such <code><a href="section-tabular.html#th">th</a></code> element, the empty
     string must be returned.</p>

    <p><strong><code title="dom-provider-getCaptionClasses"><a href="#getcaptionclasses">getCaptionClasses(<var title="">i</var>, <var title="">classes</var>)</a></code></strong>: If the <code><a href="section-tabular.html#table">table</a></code> has no <code><a href="section-tabular.html#thead0">thead</a></code> element child, or if its first <code><a href="section-tabular.html#thead0">thead</a></code> element child has no <code><a href="section-tabular.html#tr">tr</a></code> element child, the default data provider must
     not add any classes for any of the captions. Otherwise, each class in
     the <code title="attr-class"><a href="section-global.html#class">class</a></code> attribute
     of the <var title="">i</var>th <code><a href="section-tabular.html#th">th</a></code> element
     child of the first <code><a href="section-tabular.html#tr">tr</a></code> element child of
     the first <code><a href="section-tabular.html#thead0">thead</a></code> element child of the
     <code><a href="section-tabular.html#table">table</a></code> element must be added to the
     <var title="">classes</var>. If there is no such <code><a href="section-tabular.html#th">th</a></code> element, no classes must be added. The user
     agent must then:</p>

    <ol>
     <li>Remove the <code title="datagrid-column-class-sorted"><a href="#sorted">sorted</a></code> and <code title="datagrid-column-class-reversed"><a href="#reversed">reversed</a></code> classes.

     </li><li>If the <code><a href="section-tabular.html#table">table</a></code> element has a <code title="attr-class"><a href="section-global.html#class">class</a></code> attribute that
      includes the <code title="">sortable</code> class, add the <code title="datagrid-column-class-sortable"><a href="#sortable">sortable</a></code> class.

     </li><li>If the column is the one currently being used to sort the data, add
      the <code title="datagrid-column-class-sorted"><a href="#sorted">sorted</a></code> class.

     </li><li>If the column is the one currently being used to sort the data, and
      it is sorted in descending order, add the <code title="datagrid-column-class-reversed"><a href="#reversed">reversed</a></code> class as well.
    </li></ol>

    <p>The various row- and cell- related methods operate relative to a
     particular element, the element of the row or cell specified by their
     arguments.</p>

    <p><strong>For rows</strong>: Since the default data provider for a
     <code><a href="section-tabular.html#table">table</a></code> always returns 0 as the number
     of children for any row other than the root, the path to the row passed
     to these methods will always consist of a single number. In the prose
     below, this number is referred to as <var title="">i</var>.</p>

    <p>If the <code><a href="section-tabular.html#table">table</a></code> has <code><a href="section-tabular.html#tbody">tbody</a></code> element children, the element for the
     <var title="">i</var>th row is the <var title="">i</var>th <code><a href="section-tabular.html#tr">tr</a></code> element that is a child of a <code><a href="section-tabular.html#tbody">tbody</a></code> element that is a child of the <code><a href="section-tabular.html#table">table</a></code> element. If the <code><a href="section-tabular.html#table">table</a></code> does not have <code><a href="section-tabular.html#tbody">tbody</a></code> element children, then the element for
     the <var title="">i</var>th real row is the <var title="">i</var>th
     <code><a href="section-tabular.html#tr">tr</a></code> element that is a child of the
     <code><a href="section-tabular.html#table">table</a></code> element.</p>

    <p><strong>For cells</strong>: Given a row and its element, the row's
     <var title="">i</var>th cell's element is the <var title="">i</var>th
     <code><a href="section-tabular.html#td">td</a></code> element child of the row element.</p>

    <p class="note">The <code>colspan</code> and <code>rowspan</code>
     attributes are <a href="section-terminology.html#ignored" title="ignore">ignored</a> by this
     algorithm.</p>

    <p><strong><code title="dom-provider-getRowImage"><a href="#getrowimage">getRowImage(<var title="">i</var>)</a></code></strong>: If the row's first cell's element
     has an <code><a href="section-embedded.html#img">img</a></code> element child, then the URI
     of the row's image is the URI of the first <code><a href="section-embedded.html#img">img</a></code> element child of the row's first cell's
     element. Otherwise, the URI of the row's image is the empty string.</p>
    <!-- XXX well. that sentence could
    have gone better, that's for sure. -->
    
    <p><strong><code title="dom-provider-getRowMenu"><a href="#getrowmenu">getRowMenu(<var title="">i</var>)</a></code></strong>: If the row's first cell's element
     has a <code><a href="section-the-command.html#menu">menu</a></code> element child, then the
     row's menu is the first <code><a href="section-the-command.html#menu">menu</a></code> element
     child of the row's first cell's element. Otherwise, the row has no menu.</p>

    <p><strong><code title="dom-provider-getRowClasses"><a href="#getrowclasses">getRowClasses(<var title="">i</var>, <var title="">classes</var>)</a></code></strong>: The default data provider
     must never add a class to the row's classes.</p>

    <p id="defaultDataProviderTableSort"><strong><code title="dom-provider-toggleColumnSortState"><a href="#togglecolumnsortstate">toggleColumnSortState(<var title="">i</var>)</a></code></strong>: If the data is already being
     sorted on the given column, then the user agent must change the current
     sort mapping to be the inverse of the current sort mapping; if the sort
     order was ascending before, it is now descending, otherwise it is now
     ascending. Otherwise, if the current sort column is another column, or
     the data model is currently not sorted, the user agent must create a new
     mapping, which maps rows in the data model to rows in the DOM so that
     the rows in the data model are sorted by the specified column, in
     ascending order. (Which sort comparison operator to use is left up to
     the UA to decide.)</p>

    <p>When the sort mapping is changed, the values returned by the <code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">getChildAtPosition()</a></code> method for
     the default data provider <a href="#defaultDataProviderTableMapper">will
     change appropriately</a>.</p>

    <p><strong><code title="dom-provider-getCellData"><a href="#getcelldata">getCellData(<var title="">i</var>, <var title="">j</var>)</a></code>, <code title="dom-provider-getCellClasses"><a href="#getcellclasses">getCellClasses(<var title="">i</var>, <var title="">j</var>, <var title="">classes</var>)</a></code>, <code title="dom-provider-setCellCheckedState"><a href="#setcellcheckedstate">getCellCheckedState(<var title="">i</var>,
     <var title="">j</var>, <var title="">state</var>)</a></code>, <code title="dom-provider-cycleCell"><a href="#cyclecell">cycleCell(<var title="">i</var>, <var title="">j</var>)</a></code>, and <code title="dom-provider-editCell"><a href="#editcell">editCell(<var title="">i</var>, <var title="">j</var>, <var title="">data</var>)</a></code></strong>: See <a href="#commonDefaultDataGridMethodDefinitions">the common definitions
     below</a>.</p>

    <p>The data provider must call the <code><a href="#datagrid0">datagrid</a></code>'s update methods appropriately
     whenever the descendants of the <code><a href="#datagrid0">datagrid</a></code> mutate. For example, if a <code><a href="section-tabular.html#tr">tr</a></code> is removed, then the <code title="dom-datagrid-updateRowsRemoved"><a href="#updaterowsremoved">updateRowsRemoved()</a></code> methods would
     probably need to be invoked, and any change to a cell or its descendants
     must cause the cell to be updated. If the <code><a href="section-tabular.html#table">table</a></code> element stops being the first child of
     the <code><a href="#datagrid0">datagrid</a></code>, then the data
     provider must call the <code title="dom-datagrid-updateEverything"><a href="#updateeverything">updateEverything()</a></code> method on the
     <code><a href="#datagrid0">datagrid</a></code>. Any change to a cell
     that is in the column that the data provider is currently using as its
     sort column must also cause the sort to be reperformed, with a call to
     <code title="dom-datagrid-updateEverything"><a href="#updateeverything">updateEverything()</a></code> if the change did
     affect the sort order.</p>

   </dd><dt>While the first element child is a <code>select</code> or
    <code>datalist</code> element

   </dt><dd>
    <p>The default data provider must return 1 for the column count, the
     empty string for the column's caption, and must not add any classes to
     the column's classes.</p>

    <p>For the rows, assume the existence of a node filter view of the
     descendants of the first element child of the <code><a href="#datagrid0">datagrid</a></code> element (the <code>select</code>
     or <code>datalist</code> element), that skips all nodes other than
     <code>optgroup</code> and <code>option</code> elements, as well as any
     descendents of any <code>option</code> elements.</p>

    <p>Given a path <var title="">row</var>, the corresponding element is the
     one obtained by drilling into the view, taking the child given by the
     path each time.</p>

    <div class="example">
     <p>Given the following XML markup:</p>

     <pre>&lt;datagrid&gt;
 &lt;select&gt;
  &lt;!-- the options and optgroups have had their labels and values removed
       to make the underlying structure clearer --&gt;
  &lt;optgroup&gt;
   &lt;option/&gt;
   &lt;option/&gt;
  &lt;/optgroup&gt;
  &lt;optgroup&gt;
   &lt;option/&gt;
   &lt;optgroup id=&quot;a&quot;&gt;
    &lt;option/&gt;
    &lt;option/&gt;
    &lt;bogus/&gt;
    &lt;option id=&quot;b&quot;/&gt;
   &lt;/optgroup&gt;
   &lt;option/&gt;
  &lt;/optgroup&gt;
 &lt;/select&gt;
&lt;/datagrid&gt;</pre>

     <p>The path &quot;1,1,2&quot; would select the element with ID &quot;b&quot;. In the
      filtered view, the text nodes, comment nodes, and bogus elements are
      ignored; so for instance, the element with ID &quot;a&quot; (path &quot;1,1&quot;) has only
      3 child nodes in the view.</p>
    </div>

    <p><code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount(<var title="">row</var>)</a></code> must
     drill through the view to find the element corresponding to the method's
     argument, and return the number of child nodes in the filtered view that
     the corresponding element has. (If the <var title="">row</var> is empty,
     the corresponding element is the <code>select</code> element at the root
     of the filtered view.)</p>

    <p><code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">getChildAtPosition(<var title="">row</var>,
     <var title="">position</var>)</a></code> must return <var title="">position</var>. (The <code>select</code>/<code>datalist</code>
     default data provider does not support sorting the data grid.)</p>

    <p><code title="dom-provider-getRowImage"><a href="#getrowimage">getRowImage(<var title="">i</var>)</a></code> must
     return the empty string, <code title="dom-provider-getRowMenu"><a href="#getrowmenu">getRowMenu(<var title="">i</var>)</a></code> must
     return null.</p>

    <p><code title="dom-provider-getRowClasses"><a href="#getrowclasses">getRowClasses(<var title="">row</var>, <var title="">classes</var>)</a></code> must add the classes from the
     following list to <var title="">classes</var> when their condition is
     met:</p>

    <ul>
     <li>If the <var title="">row</var>'s corresponding element is an
      <code>optgroup</code> element: <code title="datagrid-row-class-header"><a href="#header0">header</a></code>

     </li><li>If the <var title="">row</var>'s corresponding element contains
      other elements that are also in the view, and the element's <code title="attr-class"><a href="section-global.html#class">class</a></code> attribute contains
      the <code title="">closed</code> class: <code title="datagrid-row-class-initially-closed"><a href="#initially-closed">initially-closed</a></code>

     </li><li>If the <var title="">row</var>'s corresponding element contains
      other elements that are also in the view, and the element's <code title="attr-class"><a href="section-global.html#class">class</a></code> attribute contains
      the <code title="">open</code> class: <code title="datagrid-row-class-initially-open"><a href="#initially-open">initially-open</a></code>
    </li></ul>

    <p>The <code title="dom-provider-getCellData"><a href="#getcelldata">getCellData(<var title="">row</var>, <var title="">cell</var>)</a></code> method must return the value of the
     <code title="attr-optgroup-label">label</code> attribute if the <var title="">row</var>'s corresponding element is an <code>optgroup</code>
     element, otherwise, if the <var title="">row</var>'s corresponding
     element is an <code>option</code>element, its <code title="attr-option-label">label</code> attribute if it has one, otherwise
     the value of its <code><a href="section-conformance.html#textcontent">textContent</a></code> DOM
     attribute.</p>

    <p>The <code title="dom-provider-getCellClasses"><a href="#getcellclasses">getCellClasses(<var title="">row</var>, <var title="">cell</var>, <var title="">classes</var>)</a></code> method must
     add no classes.</p>

    <p class="big-issue"><!-- select-provider-selection
    XXX-->autoselect
     some rows when initialised, reflect the selection in the select, reflect
     the multiple attribute somehow.</p>

    <p>The data provider must call the <code><a href="#datagrid0">datagrid</a></code>'s update methods appropriately
     whenever the descendants of the <code><a href="#datagrid0">datagrid</a></code> mutate.</p>

   </dd><dt>While the first element child is another element

   </dt><dd>
    <p>The default data provider must return 1 for the column count, the
     empty string for the column's caption, and must not add any classes to
     the column's classes.</p>

    <p>For the rows, assume the existence of a node filter view of the
     descendants of the <code><a href="#datagrid0">datagrid</a></code> that
     skips all nodes other than <code><a href="section-lists0.html#li">li</a></code>, <code><a href="section-sections.html#h1">h1</a></code>-<code><a href="section-sections.html#h6">h6</a></code>, and <code><a href="section-prose.html#hr">hr</a></code> elements, and skips any descendants of <code><a href="section-the-command.html#menu">menu</a></code> elements.</p>

    <p>Given this view, each element in the view represents a row in the data
     model. The element corresponding to a path <var title="">row</var> is
     the one obtained by drilling into the view, taking the child given by
     the path each time. The element of the row of a particular method call
     is the element given by drilling into the view along the path given by
     the method's arguments.</p>

    <p><code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount(<var title="">row</var>)</a></code> must
     return the number of child elements in this view for the given row, or
     the number of elements at the root of the view if the <var title="">row</var> is empty.</p>

    <div class="example">
     <p>In the following example, the elements are identified by the paths
      given by their child text nodes:</p>

     <pre>&lt;datagrid&gt;
 &lt;ol&gt;
  &lt;li&gt; row 0 &lt;/li&gt;
  &lt;li&gt; row 1
   &lt;ol&gt;
    &lt;li&gt; row 1,0 &lt;/li&gt;
   &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt; row 2 &lt;/li&gt;
 &lt;/ol&gt;
&lt;/datagrid&gt;</pre>

     <p>In this example, only the <code><a href="section-lists0.html#li">li</a></code> elements
      actually appear in the data grid; the <code><a href="section-lists0.html#ol">ol</a></code>
      element does not affect the data grid's processing model.</p>
    </div>

    <p><code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">getChildAtPosition(<var title="">row</var>,
     <var title="">position</var>)</a></code> must return <var title="">position</var>. (The generic default data provider does not
     support sorting the data grid.)</p>

    <p><code title="dom-provider-getRowImage"><a href="#getrowimage">getRowImage(<var title="">i</var>)</a></code> must
     return the URI of the image given by the first <code><a href="section-embedded.html#img">img</a></code> element descendant (in the real DOM) of the
     row's element, that is not also a descendant of another element in the
     filtered view that is a descendant of the row's element.</p>

    <div class="example">
     <p>In the following example, the row with path &quot;1,0&quot; returns
      &quot;http://example.com/a&quot; as its image URI, and the other rows (including
      the row with path &quot;1&quot;) return the empty string:</p>

     <pre>&lt;datagrid&gt;
 &lt;ol&gt;
  &lt;li&gt; row 0 &lt;/li&gt;
  &lt;li&gt; row 1
   &lt;ol&gt;
    &lt;li&gt; row 1,0 &lt;img src=&quot;http://example.com/a&quot; alt=&quot;&quot;&gt; &lt;/li&gt;
   &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt; row 2 &lt;/li&gt;
 &lt;/ol&gt;
&lt;/datagrid&gt;</pre>
    </div>

    <p><code title="dom-provider-getRowMenu"><a href="#getrowmenu">getRowMenu(<var title="">i</var>)</a></code> must
     return the first <code><a href="section-the-command.html#menu">menu</a></code> element
     descendant (in the real DOM) of the row's element, that is not also a
     descendant of another element in the filtered view that is a decsendant
     of the row's element. (This is analogous to the image case above.)</p>

    <p><code title="dom-provider-getRowClasses"><a href="#getrowclasses">getRowClasses(<var title="">i</var>, <var title="">classes</var>)</a></code> must add the classes from the
     following list to <var title="">classes</var> when their condition is
     met:</p>

    <ul>
     <li>If the row's element contains other elements that are also in the
      view, and the element's <code title="attr-class"><a href="section-global.html#class">class</a></code> attribute contains the <code title="">closed</code> class: <code title="datagrid-row-class-initially-closed"><a href="#initially-closed">initially-closed</a></code>

     </li><li>If the row's element contains other elements that are also in the
      view, and the element's <code title="attr-class"><a href="section-global.html#class">class</a></code> attribute contains the <code title="">open</code> class: <code title="datagrid-row-class-initially-open"><a href="#initially-open">initially-open</a></code>

     </li><li>If the row's element is an <code><a href="section-sections.html#h1">h1</a></code>-<code><a href="section-sections.html#h6">h6</a></code> element:
      <code title="datagrid-row-class-header"><a href="#header0">header</a></code>

     </li><li>If the row's element is an <code><a href="section-prose.html#hr">hr</a></code>
      element: <code title="datagrid-row-class-separator"><a href="#separator">separator</a></code></li>
     <!--
     XXX no way to get selectable-separator -->
    </ul>

    <p>The <code title="dom-provider-getCellData"><a href="#getcelldata">getCellData(<var title="">i</var>, <var title="">j</var>)</a></code>, <code title="dom-provider-getCellClasses"><a href="#getcellclasses">getCellClasses(<var title="">i</var>, <var title="">j</var>, <var title="">classes</var>)</a></code>, <code title="dom-provider-setCellCheckedState"><a href="#setcellcheckedstate">getCellCheckedState(<var title="">i</var>,
     <var title="">j</var>, <var title="">state</var>)</a></code>, <code title="dom-provider-cycleCell"><a href="#cyclecell">cycleCell(<var title="">i</var>, <var title="">j</var>)</a></code>, and <code title="dom-provider-editCell"><a href="#editcell">editCell(<var title="">i</var>, <var title="">j</var>, <var title="">data</var>)</a></code> methods must act as described in <a href="#commonDefaultDataGridMethodDefinitions">the common definitions
     below</a>, treating the row's element as being the cell's element.</p>

    <p id="generic-provider-selection" class="big-issue">selection handling?</p>

    <p>The data provider must call the <code><a href="#datagrid0">datagrid</a></code>'s update methods appropriately
     whenever the descendants of the <code><a href="#datagrid0">datagrid</a></code> mutate.</p>

   </dd><dt>Otherwise, while there is no element child

   </dt><dd>
    <p>The data provider must return 0 for the number of rows, 1 for the
     number of columns, the empty string for the first column's caption, and
     must add no classes when asked for that column's classes. If the
     <code><a href="#datagrid0">datagrid</a></code>'s child list changes such
     that there is a first element child, then the data provider must call
     the <code title="dom-datagrid-updateEverything"><a href="#updateeverything">updateEverything()</a></code> method on the
     <code><a href="#datagrid0">datagrid</a></code>.</p>
  </dd></dl>

  <h6 id="commonDefaultDataGridMethodDefinitions"><span class="secno">3.18.2.4.1.
   </span>Common default data provider method definitions for cells</h6>

  <p>These definitions are used for the cell-specific methods of the default
   data providers (other than in the
   <code>select</code>/<code>datalist</code> case). How they behave is based
   on the contents of an element that represents the cell given by their
   first two arguments. Which element that is is defined in the previous
   section.

  </p><dl>
   <dt>Cyclable cells

   </dt><dd>
    <p>If the first element child of a cell's element is a
     <code>select</code> element that has a no <code title="attr-select-multiple">multiple</code> attribute and has at least
     one <code>option</code> element descendent, then the cell acts as a
     cyclable cell.</p>

    <p>The &quot;current&quot; <code>option</code> element is the selected
     <code>option</code> element, or the first <code>option</code> element if
     none is selected.</p>

    <p>The <code title="dom-provider-getCellData"><a href="#getcelldata">getCellData()</a></code> method must return the
     <code><a href="section-conformance.html#textcontent">textContent</a></code> of the current
     <code>option</code> element (the <code title="attr-option-label">label</code> attribute is <a href="section-terminology.html#ignored" title="ignore">ignored</a> in this context as the <code>optgroup</code>s
     are not displayed).</p>

    <p>The <code title="dom-provider-getCellClasses"><a href="#getcellclasses">getCellClasses()</a></code> method must add the
     <code title="datagrid-cell-class-cyclable"><a href="#cyclable">cyclable</a></code> class and then all the classes of
     the current <code>option</code> element.</p>

    <p>The <code title="dom-provider-cycleCell"><a href="#cyclecell">cycleCell()</a></code> method must change the
     selection of the <code>select</code> element such that the next
     <code>option</code> element after the current <code>option</code>
     element is the only one that is selected (in <a href="section-terminology.html#tree-order">tree
     order</a>). If the current <code>option</code> element is the last
     <code>option</code> element descendent of the <code>select</code>, then
     the first <code>option</code> element descendent must be selected
     instead.</p>

    <p>The <code title="dom-provider-setCellCheckedState"><a href="#setcellcheckedstate">setCellCheckedState()</a></code> and <code title="dom-provider-editCell"><a href="#editcell">editCell()</a></code>
     methods must do nothing.</p>

   </dd><dt>Progress bar cells

   </dt><dd>
    <p>If the first element child of a cell's element is a <code><a href="section-phrase.html#progress">progress</a></code> element, then the cell acts as a
     progress bar cell.</p>

    <p>The <code title="dom-provider-getCellData"><a href="#getcelldata">getCellData()</a></code> method must return the
     value returned by the <code><a href="section-phrase.html#progress">progress</a></code>
     element's <code title="dom-progress-position"><a href="section-phrase.html#position">position</a></code> DOM attribute.</p>

    <p>The <code title="dom-provider-getCellClasses"><a href="#getcellclasses">getCellClasses()</a></code> method must add the
     <code title="datagrid-cell-class-progress"><a href="#progress1">progress</a></code> class.</p>

    <p>The <code title="dom-provider-setCellCheckedState"><a href="#setcellcheckedstate">setCellCheckedState()</a></code>, <code title="dom-provider-cycleCell"><a href="#cyclecell">cycleCell()</a></code>, and <code title="dom-provider-editCell"><a href="#editcell">editCell()</a></code>
     methods must do nothing.</p>

   </dd><dt>Checkbox cells

   </dt><dd>
    <p>If the first element child of a cell's element is an
     <code>input</code> element that has a <code title="attr-input-type">type</code> attribute with the value <code title="">checkbox</code>, then the cell acts as a check box cell.</p>

    <p>The <code title="dom-provider-getCellData"><a href="#getcelldata">getCellData()</a></code> method must return the
     <code><a href="section-conformance.html#textcontent">textContent</a></code> of the cell element.</p>

    <p>The <code title="dom-provider-getCellClasses"><a href="#getcellclasses">getCellClasses()</a></code> method must add the
     <code title="datagrid-cell-class-checked"><a href="#checked">checked</a></code> class if the <code>input</code>
     element is <span title="dom-input-checked">checked</span>, and the <code title="datagrid-cell-class-unchecked"><a href="#unchecked">unchecked</a></code> class otherwise.</p>

    <p>The <code title="dom-provider-setCellCheckedState"><a href="#setcellcheckedstate">setCellCheckedState()</a></code> method must
     set the <code>input</code> element's checkbox <span title="dom-input-checked">state</span> to checked if the method's third
     argument is 1, and to unchecked otherwise.</p>

    <p>The <code title="dom-provider-cycleCell"><a href="#cyclecell">cycleCell()</a></code> and <code title="dom-provider-editCell"><a href="#editcell">editCell()</a></code>
     methods must do nothing.</p>

   </dd><dt>Editable cells

   </dt><dd>
    <p>If the first element child of a cell's element is an
     <code>input</code> element that has a <code title="attr-input-type">type</code> attribute with the value <code title="">text</code> or that has no <code title="attr-input-type">type</code> attribute at all, then the cell acts
     as an editable cell.</p>

    <p>The <code title="dom-provider-getCellData"><a href="#getcelldata">getCellData()</a></code> method must return the
     <code title="dom-input-value">value</code> of the <code>input</code>
     element.</p>

    <p>The <code title="dom-provider-getCellClasses"><a href="#getcellclasses">getCellClasses()</a></code> method must add the
     <code title="datagrid-cell-class-editable"><a href="#editable">editable</a></code> class.</p>

    <p>The <code title="dom-provider-editCell"><a href="#editcell">editCell()</a></code> method must set the
     <code>input</code> element's <code title="dom-input-value">value</code>
     DOM attribute to the value of the third argument to the method.</p>

    <p>The <code title="dom-provider-setCellCheckedState"><a href="#setcellcheckedstate">setCellCheckedState()</a></code> and <code title="dom-provider-cycleCell"><a href="#cyclecell">cycleCell()</a></code>
     methods must do nothing.</p>
  </dd></dl>
  <!-- XXX Calculated cells, like in spreadsheets? -->

  <h5 id="populating"><span class="secno">3.18.2.5. </span>Populating the
   <code><a href="#datagrid0">datagrid</a></code> element</h5>

  <p>A <code><a href="#datagrid0">datagrid</a></code> must be disabled until
   its end tag has been parsed (in the case of a <code><a href="#datagrid0">datagrid</a></code> element in the original document
   markup) or until it has been inserted into the document (in the case of a
   dynamically created element). After that point, the element must fire a
   single <code title="event-load"><a href="section-video.html#load0">load</a></code> event at
   itself, which doesn't bubble and cannot be canceled.

  </p><p class="big-issue">The end-tag parsing thing should be moved to the parsing
   section.

  </p><p>The <code><a href="#datagrid0">datagrid</a></code> must then populate
   itself using the data provided by the data provider assigned to the <code title="dom-datagrid-data"><a href="#data2">data</a></code> DOM attribute.
   After the view is populated (using the methods described below), the
   <code><a href="#datagrid0">datagrid</a></code> must invoke the <code title="dom-provider-initialize"><a href="#initialize">initialize()</a></code> method on the data provider
   specified by the <code title="dom-datagrid-data"><a href="#data2">data</a></code> attribute, passing itself (the <code><a href="#htmldatagridelement">HTMLDataGridElement</a></code> object) as the
   only argument.

  </p><p>When the <code title="dom-datagrid-data"><a href="#data2">data</a></code>
   attribute is null, the <code><a href="#datagrid0">datagrid</a></code> must
   use the default data provider described in the previous section.

  </p><p>To obtain data from the data provider, the element must invoke methods
   on the data provider object in the following ways:

  </p><dl>
   <dt>To determine the total number of columns

   </dt><dd>Invoke the <code title="dom-provider-getColumnCount"><a href="#getcolumncount">getColumnCount()</a></code> method with no
    arguments. The return value is the number of columns. If the return value
    is zero or negative, not an integer, or simply not a numeric type, or if
    the method is not defined, then 1 must be used instead.

   </dd><dt>To get the captions to use for the columns

   </dt><dd>Invoke the <code title="dom-provider-getCaptionText"><a href="#getcaptiontext">getCaptionText()</a></code> method with the index
    of the column in question. The index <var title="">i</var> must be in the
    range 0 ≤ <var title="">i</var> &lt; <var title="">N</var>, where <var title="">N</var> is the total number of columns. The return value is the
    string to use when referring to that column. If the method returns null
    or the empty string, the column has no caption. If the method is not
    defined, then none of the columns have any captions.

   </dd><dt>To establish what classes apply to a column

   </dt><dd>Invoke the <code title="dom-provider-getCaptionClasses"><a href="#getcaptionclasses">getCaptionClasses()</a></code> method with the
    index of the column in question, and an object implementing the <code><a href="section-common0.html#domtokenlist0">DOMTokenList</a></code> interface, associated with
    an anonymous empty string. The index <var title="">i</var> must be in the
    range 0 ≤ <var title="">i</var> &lt; <var title="">N</var>, where <var title="">N</var> is the total number of columns. The tokens contained in
    the string underlying <code><a href="section-common0.html#domtokenlist0">DOMTokenList</a></code> object when the method
    returns represent the classes that apply to the given column. If the
    method is not defined, no classes apply to the column.

   </dd><dt>To establish whether a column should be initially included in the
    visible columns

   </dt><dd>Check whether the <code title="datagrid-column-class-initially-hidden"><a href="#initially-hidden">initially-hidden</a></code> class applies to the
    column. If it does, then the column should not be initially included; if
    it does not, then the column should be initially included.

   </dd><dt id="columnType2">To establish whether the data can be sorted relative to
    a particular column

   </dt><dd>Check whether the <code title="datagrid-column-class-sortable"><a href="#sortable">sortable</a></code> class applies to the column. If it
    does, then the user should be able to ask the UA to display the data
    sorted by that column; if it does not, then the user agent must not allow
    the user to ask for the data to be sorted by that column.

   </dd><dt>To establish if a column is a sorted column

   </dt><dd>If the user agent can handle multiple columns being marked as sorted
    simultaneously: Check whether the <code title="datagrid-column-class-sorted"><a href="#sorted">sorted</a></code>
    class applies to the column. If it does, then that column is the sorted
    column, otherwise it is not.

   </dd><dd>If the user agent can only handle one column being marked as sorted at
    a time: Check each column in turn, starting with the first one, to see
    whether the <code title="datagrid-column-class-sorted"><a href="#sorted">sorted</a></code> class applies to that column. The first
    column that has that class, if any, is the sorted column. If none of the
    columns have that class, there is no sorted column.

   </dd><dt>To establish the sort direction of a sorted column

   </dt><dd>Check whether the <code title="datagrid-column-class-reversed"><a href="#reversed">reversed</a></code> class applies to the column. If it
    does, then the sort direction is descending (down; first rows have the
    highest values), otherwise it is ascending (up; first rows have the
    lowest values).

   </dd><dt>To determine the total number of rows

   </dt><dd>Determine the number of rows for the root of the data grid, and
    determine the number of child rows for each open row. The total number of
    rows is the sum of all these numbers.

   </dd><dt>To determine the number of rows for the root of the data grid

   </dt><dd>Invoke the <code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount()</a></code> method with a <code><a href="#rowspecification">RowSpecification</a></code> object representing
    the empty path as its only argument. The return value is the number of
    rows at the top level of the data grid. If the return value of the method
    is negative, not an integer, or simply not a numeric type, or if the
    method is not defined, then zero must be used instead.

   </dd><dt>To determine the number of child rows for a row

   </dt><dd>Invoke the <code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount()</a></code> method with a <code><a href="#rowspecification">RowSpecification</a></code> object representing
    the path to the row in question. The return value is the number of child
    rows for the given row. If the return value of the method is negative,
    not an integer, or simply not a numeric type, or if the method is not
    defined, then zero must be used instead.

   </dd><dt>To determine what order to render rows in

   </dt><dd>
    <p>Invoke the <code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">getChildAtPosition()</a></code> method with a
     <code><a href="#rowspecification">RowSpecification</a></code> object
     representing the path to the parent of the rows that are being rendered
     as the first argument, and the position that is being rendered as the
     second argument. The return value is the index of the row to render in
     that position.</p>

    <div class="example">
     <p>If the rows are:</p>

     <ol>
      <li> Row &quot;0&quot;
       <ol>
        <li> Row &quot;0,0&quot;

        </li><li> Row &quot;0,1&quot;
       </li></ol>

      </li><li> Row &quot;1&quot;
       <ol>
        <li> Row &quot;1,0&quot;

        </li><li> Row &quot;1,1&quot;
       </li></ol>
     </li></ol>

     <p>...and the <code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">getChildAtPosition()</a></code> method is
      implemented as follows:</p>

     <pre>function getChildAtPosition(parent, child) {
  // always return the reverse order
  return getRowCount(parent)-child-1;
}</pre>

     <p>...then the rendering would actually be:</p>

     <ol>
      <li> Row &quot;1&quot;
       <ol>
        <li> Row &quot;1,1&quot;

        </li><li> Row &quot;1,0&quot;
       </li></ol>

      </li><li> Row &quot;0&quot;
       <ol>
        <li> Row &quot;0,1&quot;

        </li><li> Row &quot;0,0&quot;
       </li></ol>
     </li></ol>
    </div>

    <p>If the return value of the method is negative, larger than the number
     of rows that the <code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount()</a></code> method reported for that
     parent, not an integer, or simply not a numeric type, then the entire
     data grid should be disabled. Similarly, if the method returns the same
     value for two or more different values for the second argument (with the
     same first argument, and assuming that the data grid hasn't had relevant
     update methods invoked in the meantime), then the data grid should be
     disabled. Instead of disabling the data grid, the user agent may act as
     if the <code title="dom-provider-getChildAtPosition"><a href="#getchildatposition">getChildAtPosition()</a></code> method was
     not defined on the data provider (thus disabling sorting for that data
     grid, but still letting the user interact with the data). If the method
     is not defined, then the return value must be assumed to be the same as
     the second argument (an indentity transform; the data is rendered in its
     natural order).</p>

   </dd><dt>To establish what classes apply to a row

   </dt><dd>Invoke the <code title="dom-provider-getRowClasses"><a href="#getrowclasses">getRowClasses()</a></code> method with a <code><a href="#rowspecification">RowSpecification</a></code> object representing
    the row in question, and a <code><a href="section-common0.html#domtokenlist0">DOMTokenList</a></code> associated with an empty
    string. The tokens contained in the <code><a href="section-common0.html#domtokenlist0">DOMTokenList</a></code> object's underlying string
    when the method returns represent the classes that apply to the row in
    question. If the method is not defined, no classes apply to the row.

   </dd><dt>To establish whether a row is a data row or a special row

   </dt><dd>Examine the classes that apply to the row. If the <code title="datagrid-row-class-header"><a href="#header0">header</a></code>
    class applies to the row, then it is not a data row, it is a subheading.
    The data from the first cell of the row is the text of the subheading,
    the rest of the cells must be ignored. Otherwise, if the <code title="datagrid-row-class-separator"><a href="#separator">separator</a></code> class applies to the row, then in
    the place of the row, a separator should be shown. Otherwise, if the
    <code title="datagrid-row-class-selectable-separator"><a href="#selectable-separator">selectable-separator</a></code> class
    applies to the row, then the row should be a data row, but represented as
    a separator. (The difference between a <code title="datagrid-row-class-separator"><a href="#separator">separator</a></code> and a <code title="datagrid-row-class-selectable-separator"><a href="#selectable-separator">selectable-separator</a></code> is that the
    former is not an item that can be actually selected, whereas the second
    can be selected and thus has a context menu that applies to it, and so
    forth.) For both kinds of separator rows, the data of the rows' cells
    must all be ignored. If none of those three classes apply then the row is
    a simple data row.

   </dd><dt id="rowType1">To establish whether a row is openable

   </dt><dd>Determine the number of child rows for that row. If there are one or
    more child rows, then the row is openable.

   </dd><dt>To establish whether a row should be initially open or closed

   </dt><dd>If <a href="#rowType1">the row is openable</a>, examine the classes
    that apply to the row. If the <code title="datagrid-row-class-initially-open"><a href="#initially-open">initially-open</a></code> class applies to the
    row, then it should be initially open. Otherwise, if the <code title="datagrid-row-class-initially-closed"><a href="#initially-closed">initially-closed</a></code> class applies to the
    row, then it must be initially closed. Otherwise, if neither class
    applies to the row, or if the row is not openable, then the initial state
    of the row is entirely up to the UA.</dd>
   <!-- XXXPA
   <dt>To establish whether a row is deletable</dt>

   <dd>Check whether the <code
   title="datagrid-row-class-deletable">deletable</code> class applies
   to the row. If it does, the row is deletable, and interactive user
   agents should provide a way for the user to request that the row be
   deleted. (See the <code
   title="dom-provider-performActionOnRow">performActionOnRow()</code>
   method for more details.) Otherwise, the user agent should not
   provide the user with a method for requesting that the row be
   deleted.</dd>
-->

   <dt>To obtain a URI to an image representing a row

   </dt><dd>Invoke the <code title="dom-provider-getRowImage"><a href="#getrowimage">getRowImage()</a></code> method with a <code><a href="#rowspecification">RowSpecification</a></code> object representing
    the row in question. The return value is a string representing a URI (or
    IRI) to an image. Relative URIs must be interpreted relative to the
    <code><a href="#datagrid0">datagrid</a></code>'s base URI. If the method
    returns the empty string, null, or if the method is not defined, then the
    row has no associated image.

   </dd><dt>To obtain a context menu appropriate for a particular row

   </dt><dd>Invoke the <code title="dom-provider-getRowMenu"><a href="#getrowmenu">getRowMenu()</a></code> method with a <code><a href="#rowspecification">RowSpecification</a></code> object representing
    the row in question. The return value is a reference to an object
    implementing the <code><a href="section-the-command.html#htmlmenuelement">HTMLMenuElement</a></code> interface, i.e. a
    <code><a href="section-the-command.html#menu">menu</a></code> element DOM node. (This element
    must then be interpreted as described in the section on context menus to
    obtain the actual context menu to use.<!-- XXXX update once menu section
   works; with xrefs -->)
    If the method returns something that is not an <code><a href="section-the-command.html#htmlmenuelement">HTMLMenuElement</a></code>, or if the method is
    not defined, then the row has no associated context menu. User agents may
    provide their own default context menu, and may add items to the
    author-provided context menu. For example, such a menu could allow the
    user to change the presentation of the <code><a href="#datagrid0">datagrid</a></code> element.

   </dd><dt>To establish the value of a particular cell

   </dt><dd>Invoke the <code title="dom-provider-getCellData"><a href="#getcelldata">getCellData()</a></code> method with the first
    argument being a <code><a href="#rowspecification">RowSpecification</a></code> object representing
    the row of the cell in question and the second argument being the index
    of the cell's column. The second argument must be a non-negative integer
    less than the total number of columns. The return value is the value of
    the cell. If the return value is null or the empty string, or if the
    method is not defined, then the cell has no data. (For progress bar
    cells, the cell's value must be further interpreted, as described below.)

   </dd><dt>To establish what classes apply to a cell

   </dt><dd>Invoke the <code title="dom-provider-getCellClasses"><a href="#getcellclasses">getCellClasses()</a></code> method with the first
    argument being a <code><a href="#rowspecification">RowSpecification</a></code> object representing
    the row of the cell in question, the second argument being the index of
    the cell's column, and the third being an object implementing the
    <code><a href="section-common0.html#domtokenlist0">DOMTokenList</a></code> interface,
    associated with an empty string. The second argument must be a
    non-negative integer less than the total number of columns. The tokens
    contained in the <code><a href="section-common0.html#domtokenlist0">DOMTokenList</a></code>
    object's underlying string when the method returns represent the classes
    that apply to that cell. If the method is not defined, no classes apply
    to the cell.

   </dd><dt id="cellType1">To establish how the type of a cell

   </dt><dd>Examine the classes that apply to the cell. If the <code title="datagrid-cell-class-progress"><a href="#progress1">progress</a></code> class applies to the cell, it is a
    progress bar. Otherwise, if the <code title="datagrid-cell-class-cyclable"><a href="#cyclable">cyclable</a></code> class applies to the cell, it is a
    cycling cell whose value can be cycled between multiple states.
    Otherwise, none of these classes apply, and the cell is a simple text
    cell.

   </dd><dt>To establish the value of a progress bar cell

   </dt><dd>If the value <var title="">x</var> of the cell is a string that can be
    <a href="section-common1.html#rules1" title="rules for parsing floating point number
    values">converted to a floating-point number</a> in the range
    0.0 ≤ <var title="">x</var> ≤ 1.0, then the
    progress bar has that value (0.0 means no progress, 1.0 means complete).
    Otherwise, the progress bar is an indeterminate progress bar.

   </dd><dt id="cellType2">To establish how a simple text cell should be presented

   </dt><dd>Check whether one of the <code title="datagrid-cell-class-checked"><a href="#checked">checked</a></code>, <code title="datagrid-cell-class-unchecked"><a href="#unchecked">unchecked</a></code>, or <code title="datagrid-cell-class-indeterminate"><a href="#indeterminate">indeterminate</a></code> classes applies to the
    cell. If any of these are present, then the cell has a checkbox,
    otherwise none are present and the cell does not have a checkbox. If the
    cell has no checkbox, check whether the <code title="datagrid-cell-class-editable"><a href="#editable">editable</a></code> class applies to the cell. If it
    does, then the cell value is editable, otherwise the cell value is
    static.

   </dd><dt>To establish the state of a cell's checkbox, if it has one

   </dt><dd>Check whether the <code title="datagrid-cell-class-checked"><a href="#checked">checked</a></code> class applies to the cell. If it does,
    the cell is checked. Otherwise, check whether the <code title="datagrid-cell-class-unchecked"><a href="#unchecked">unchecked</a></code> class applies to the cell. If it
    does, the cell is unchecked. Otherwise, the <code title="datagrid-cell-class-indeterminate"><a href="#indeterminate">indeterminate</a></code> class appplies to the cell
    and the cell's checkbox is in an indeterminate state. When the <code title="datagrid-cell-class-indeterminate"><a href="#indeterminate">indeterminate</a></code> class appplies to the
    cell, the checkbox is a tristate checkbox, and the user can set it to the
    indeterminate state. Otherwise, only the <code title="datagrid-cell-class-checked"><a href="#checked">checked</a></code>
    and/or <code title="datagrid-cell-class-unchecked"><a href="#unchecked">unchecked</a></code> classes apply to the cell, and the
    cell can only be toggled betwen those two states.
  </dd></dl>

  <p>If the data provider ever raises an exception while the <code><a href="#datagrid0">datagrid</a></code> is invoking one of its methods, the
   <code><a href="#datagrid0">datagrid</a></code> must act, for the purposes
   of that particular method call, as if the relevant method had not been
   defined.

  </p><p>A <code><a href="#rowspecification">RowSpecification</a></code> object
   <var title="">p</var> with <var title="">n</var> path components passed to
   a method of the data provider must fulfill the constraint
   <span>0 ≤ <var title="">p<sub title=""><var title="">i</var></sub></var> &lt; <var title="">m</var>-1</span>
   for all integer values of <var title="">i</var> in the range
   <span>0 ≤ <var title="">i</var> &lt; <var title="">n</var>-1</span>, where <var title="">m</var> is the value that
   was last returned by the <code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount()</a></code> method when it was passed the
   <code><a href="#rowspecification">RowSpecification</a></code> object <var title="">q</var> with <span><var title="">i</var>-1</span> items, where
   <span><var title="">p<sub title=""><var title="">i</var></sub></var> = <var title="">q<sub title=""><var title="">i</var></sub></var></span> for all integer values of <var title="">i</var> in the range <span>0 ≤ <var title="">i</var> &lt; <var title="">n</var>-1</span>, with any
   changes implied by the update methods taken into account.

  </p><p id="inconsistentDataProvider">The data model is considered stable: user
   agents may assume that subsequent calls to the data provider methods will
   return the same data, until one of the update methods is called on the
   <code><a href="#datagrid0">datagrid</a></code> element. If a user agent is
   returned inconsistent data, for example if the number of rows returned by
   <code title="dom-provider-getRowCount"><a href="#getrowcount">getRowCount()</a></code> varies in ways that do not
   match the calls made to the update methods, the user agent may disable the
   <code><a href="#datagrid0">datagrid</a></code>. User agents that do not
   disable the <code><a href="#datagrid0">datagrid</a></code> in inconsistent
   cases must honour the most recently returned values.

  </p><p>User agents may cache returned values so that the data provider is never
   asked for data that could contradict earlier data. User agents must not
   cache the return value of the <code title="dom-provider-getRowMenu"><a href="#getrowmenu">getRowMenu</a></code> method.

  </p><p>The exact algorithm used to populate the data grid is not defined here,
   since it will differ based on the presentation used. However, the
   behaviour of user agents must be consistent with the descriptions above.
   For example, it would be non-conformant for a user agent to make cells
   have both a checkbox and be editable, as the descriptions above state that
   cells that have a checkbox cannot be edited.</p>
  <!-- XXX speaking of which, do we actually want that
  limitation? -->

  <h5 id="updating"><span class="secno">3.18.2.6. </span>Updating the <code><a href="#datagrid0">datagrid</a></code></h5>

  <p>Whenever the <code title="dom-datagrid-data"><a href="#data2">data</a></code> attribute is set to a new value, the
   <code><a href="#datagrid0">datagrid</a></code> must clear the current
   selection, remove all the displayed rows, and plan to repopulate itself
   using the information from the new data provider at the earliest
   opportunity.

  </p><p>There are a number of update methods that can be invoked on the <code><a href="#datagrid0">datagrid</a></code> element to cause it to refresh
   itself in slightly less drastic ways:

  </p><p>When the <dfn id="updateeverything" title="dom-datagrid-updateEverything"><code>updateEverything()</code></dfn>
   method is called, the user agent must repopulate the entire <code><a href="#datagrid0">datagrid</a></code>. If the number of rows decreased,
   the selection must be updated appropriately. If the number of rows
   increased, the new rows should be left unselected.

  </p><p>When the <dfn id="updaterowschanged" title="dom-datagrid-updateRowsChanged"><code>updateRowsChanged(<var title="">row</var>, <var title="">count</var>)</code></dfn> method is
   called, the user agent must refresh the rendering of the rows starting
   from the row specified by <var title="">row</var>, and including the <var title="">count</var> next siblings of the row (or as many next siblings as
   it has, if that is less than <var title="">count</var>), including all
   descendant rows.

  </p><p>When the <dfn id="updaterowsinserted" title="dom-datagrid-updateRowsInserted"><code>updateRowsInserted(<var title="">row</var>, <var title="">count</var>)</code></dfn> method is
   called, the user agent must assume that <var title="">count</var> new rows
   have been inserted, such that the first new row is indentified by <var title="">row</var>. The user agent must update its rendering and the
   selection accordingly. The new rows should not be selected.

  </p><p>When the <dfn id="updaterowsremoved" title="dom-datagrid-updateRowsRemoved"><code>updateRowsRemoved(<var title="">row</var>, <var title="">count</var>)</code></dfn> method is
   called, the user agent must assume that <var title="">count</var> rows
   have been removed starting from the row that used to be identifier by <var title="">row</var>. The user agent must update its rendering and the
   selection accordingly.

  </p><p>The <dfn id="updaterowchanged" title="dom-datagrid-updateRowChanged"><code>updateRowChanged(<var title="">row</var>)</code></dfn> method must be exactly equivalent to
   calling <code title="dom-datagrid-updateRowsChanged"><a href="#updaterowschanged">updateRowsChanged(<var title="">row</var>,
   1)</a></code>.

  </p><p>When the <dfn id="updatecolumnchanged" title="dom-datagrid-updateColumnChanged"><code>updateColumnChanged(<var title="">column</var>)</code></dfn> method is called, the user agent must
   refresh the rendering of the specified column <var title="">column</var>,
   for all rows.

  </p><p>When the <dfn id="updatecellchanged" title="dom-datagrid-updateCellChanged"><code>updateCellChanged(<var title="">row</var>, <var title="">column</var>)</code></dfn> method is
   called, the user agent must refresh the rendering of the cell on row <var title="">row</var>, in column <var title="">column</var>.

  </p><p>Any effects the update methods have on the <code><a href="#datagrid0">datagrid</a></code>'s selection is not considered a
   change to the selection, and must therefore not fire the <code title="event-select"><a href="#select">select</a></code> event.

  </p><p>These update methods should only be called by the data provider, or code
   acting on behalf of the data provider. In particular, calling the <code title="dom-datagrid-updateRowsInserted"><a href="#updaterowsinserted">updateRowsInserted()</a></code> and <code title="dom-datagrid-updateRowsRemoved"><a href="#updaterowsremoved">updateRowsRemoved()</a></code> methods without
   actually inserting or removing rows from the data provider is <a href="#inconsistentDataProvider">likely to result in inconsistent
   renderings</a>, and the user agent is likely to disable the data grid.

  </p><h5 id="requirements"><span class="secno">3.18.2.7. </span>Requirements for
   interactive user agents</h5>

  <p><em>This section only applies to interactive user agents.</em>

  </p><p>If the <code><a href="#datagrid0">datagrid</a></code> element has a <dfn id="disabled3" title="attr-datagrid-disabled"><code>disabled</code></dfn>
   attribute, then the user agent must disable the <code><a href="#datagrid0">datagrid</a></code>, preventing the user from
   interacting with it. The <code><a href="#datagrid0">datagrid</a></code>
   element should still continue to update itself when the data provider
   signals changes to the data, though. Obviously, conformance requirements
   stating that <code><a href="#datagrid0">datagrid</a></code> elements must
   react to users in particular ways do not apply when one is disabled.

  </p><p>If <a href="#rowType1">a row is openable</a>, then the user should be
   able to toggle its open/closed state. When a row's open/closed state
   changes, the user agent must update the rendering to match the new state.

  </p><p>If a cell is a cell whose value <a href="#cellType1">can be cycled
   between multiple states</a>, then the user must be able to activate the
   cell to cycle its value. When the user activates this &quot;cycling&quot; behaviour
   of a cell, then the <code><a href="#datagrid0">datagrid</a></code> must
   invoke the data provider's <code title="dom-provider-cycleCell"><a href="#cyclecell">cycleCell()</a></code> method, with a <code><a href="#rowspecification">RowSpecification</a></code> object representing
   the cell's row as the first argument and the cell's column index as the
   second. The <code><a href="#datagrid0">datagrid</a></code> must act as if
   the <code><a href="#datagrid0">datagrid</a></code>'s <code title="dom-datagrid-updateCellChanged"><a href="#updatecellchanged">updateCellChanged()</a></code> method had been
   invoked with those same arguments immediately before the provider's method
   was invoked.

  </p><p>When a cell <a href="#cellType2">has a checkbox</a>, the user must be
   able to set the checkbox's state. When the user changes the state of a
   checkbox in such a cell, the <code><a href="#datagrid0">datagrid</a></code> must invoke the data provider's
   <code title="dom-provider-setCellCheckedState"><a href="#setcellcheckedstate">setCellCheckedState()</a></code> method, with
   a <code><a href="#rowspecification">RowSpecification</a></code> object
   representing the cell's row as the first argument, the cell's column index
   as the second, and the checkbox's new state as the third. The state should
   be represented by the number 1 if the new state is checked, 0 if the new
   state is unchecked, and -1 if the new state is indeterminate (which must
   only be possible if the cell has the <code title="datagrid-cell-class-indeterminate"><a href="#indeterminate">indeterminate</a></code> class set). The <code><a href="#datagrid0">datagrid</a></code> must act as if the <code><a href="#datagrid0">datagrid</a></code>'s <code title="dom-datagrid-updateCellChanged"><a href="#updatecellchanged">updateCellChanged()</a></code> method had been
   invoked, specifying the same cell, immediately before the provider's
   method was invoked.

  </p><p>If a cell <a href="#cellType2">is editable</a>, the user must be able to
   edit the data for that cell, and doing so must cause the user agent to
   invoke the <code title="dom-provider-editCell"><a href="#editcell">editCell()</a></code> method of the data provider with
   three arguments: a <code><a href="#rowspecification">RowSpecification</a></code> object representing
   the cell's row, the cell's column's index, and the new text entered by the
   user. The user agent must act as if the <code title="dom-datagrid-updateCellChanged"><a href="#updatecellchanged">updateCellChanged()</a></code> method had been
   invoked, with the same row and column specified, immediately before the
   provider's method was invoked.</p>
  <!-- XXXPA <p class="big-issue">define actions (performAction(), etc)</p> -->

  <h5 id="the-selection"><span class="secno">3.18.2.8. </span>The selection</h5>

  <p><em>This section only applies to interactive user agents. For other user
   agents, the <code title="dom-datagrid-selection"><a href="#selection0">selection</a></code> attribute must return null.</em>

  </p><pre class="idl">interface <dfn id="datagridselection">DataGridSelection</dfn> {
  readonly attribute unsigned long <span title="dom-DataGridSelection-count">length</span>;
  <a href="#rowspecification">RowSpecification</a> <span title="dom-DataGridSelection-">item</span>(in unsigned long index);
  boolean <a href="#isselected" title="dom-DataGridSelection-isSelected">isSelected</a>(in <a href="#rowspecification">RowSpecification</a> row);
  void <a href="#setselected" title="dom-DataGridSelection-setSelected">setSelected</a>(in <a href="#rowspecification">RowSpecification</a> row, in boolean selected);
<!--  void <span title="dom-DataGridSelection-addRange">addRange</span>(in <span>RowSpecification</span> first, in <span>RowSpecification</span> last);
  void <span title="dom-DataGridSelection-removeRange">removeRange</span>(in <span>RowSpecification</span> first, in <span>RowSpecification</span> last);
XXX selection ranges -->
  void <a href="#selectall" title="dom-DataGridSelection-selectAll">selectAll</a>();
  void <a href="#invert" title="dom-DataGridSelection-invert">invert</a>();
  void <a href="#clear" title="dom-DataGridSelection-clear">clear</a>();
};</pre>

  <p>Each <code><a href="#datagrid0">datagrid</a></code> element must keep
   track of which rows are currently selected. Initially no rows are
   selected, but this can be changed via the methods described in this
   section. <!--XXX
  select-provider-selection The default data provider, for instance,
  changes which rows are selected when it is first initialised.-->

  </p><p>The selection of a <code><a href="#datagrid0">datagrid</a></code> is
   represented by its <dfn id="selection0" title="dom-datagrid-selection"><code>selection</code></dfn> DOM attribute,
   which must be a <code><a href="#datagridselection">DataGridSelection</a></code> object.

  </p><p><code><a href="#datagridselection">DataGridSelection</a></code> objects
   represent the rows in the selection. In the selection the rows must be
   ordered in the natural order of the data provider (and not, e.g., the
   rendered order). Rows that are not rendered because one of their ancestors
   is closed must share the same selection state as their nearest rendered
   ancestor. Such rows are not considered part of the selection for the
   purposes of iterating over the selection.

  </p><p class="note">This selection API doesn't allow for hidden rows to be
   selected because it is trivial to create a data provider that has infinite
   depth, which would then require the selection to be infinite if every row,
   including every hidden row, was selected.

  </p><p>The <dfn id="length4" title="dom-DataGridSelection-length"><code>length</code></dfn> attribute
   must return the number of rows currently present in the selection. The
   <dfn id="itemindex3" title="dom-DataGridSelection-item"><code>item(<var title="">index</var>)</code></dfn> method must return the <var title="">index</var>th row in the selection. If the argument is out of
   range (less than zero or greater than the number of selected rows minus
   one), then it must raise an <code>INDEX_SIZE_ERR</code> exception. <a href="#refsDOM3CORE">[DOM3CORE]</a>

  </p><p>The <dfn id="isselected" title="dom-DataGridSelection-isSelected"><code>isSelected()</code></dfn>
   method must return the selected state of the row specified by its
   argument. If the specified row exists and is selected, it must return
   true, otherwise it must return false.

  </p><p>The <dfn id="setselected" title="dom-DataGridSelection-setSelected"><code>setSelected()</code></dfn>
   method takes two arguments, <var title="">row</var> and <var title="">selected</var>. When invoked, it must set the selection state of
   row <var title="">row</var> to selected if <var title="">selected</var> is
   true, and unselected if it is false. If <var title="">row</var> is not a
   row in the data grid, the method must raise an <code>INDEX_SIZE_ERR</code>
   exception. If the specified row is not rendered because one of its
   ancestors is closed, the method must do nothing.

  </p><p>The <dfn id="selectall" title="dom-DataGridSelection-selectAll"><code>selectAll()</code></dfn>
   method must mark all the rows in the data grid as selected. After a call
   to <code title="dom-DataGridSelection-selectAll"><a href="#selectall">selectAll()</a></code>, the <code title="dom-DataGridSelection-length"><a href="#length4">length</a></code>
   attribute will return the number of rows in the data grid, not counting
   children of closed rows.

  </p><p>The <dfn id="invert" title="dom-DataGridSelection-invert"><code>invert()</code></dfn> method must
   cause all the rows in the selection that were marked as selected to now be
   marked as not selected, and vice versa.

  </p><p>The <dfn id="clear" title="dom-DataGridSelection-clear"><code>clear()</code></dfn> method must
   mark all the rows in the data grid to be marked as not selected. After a
   call to <code title="dom-DataGridSelection-clear"><a href="#clear">clear()</a></code>, the <code title="dom-DataGridSelection-length"><a href="#length4">length</a></code>
   attribute will return zero.

  </p><p>If the <code><a href="#datagrid0">datagrid</a></code> element has a <dfn id="multiple0" title="attr-datagrid-multiple"><code>multiple</code></dfn>
   attribute, then the user must be able to select any number of rows (zero
   or more). If the attribute is not present, then the user must only be able
   to select a single row at a time, and selecting another one must unselect
   all the other rows.

  </p><p class="note">This only applies to the user. Scripts can select multiple
   rows even when the <code title="attr-datagrid-multiple"><a href="#multiple0">multiple</a></code> attribute is absent.

  </p><p>Whenever the selection of a <code><a href="#datagrid0">datagrid</a></code> changes, whether due to the user
   interacting with the element, or as a result of calls to methods of the
   <code title="dom-datagrid-selection"><a href="#selection0">selection</a></code> object, a <dfn id="select" title="event-select"><code>select</code></dfn><!-- XXX check if we
  really should be DFNing this here. It's a DOM3 Core event. What's
  our story going to be regarding events and defining them? -->
   event that bubbles but is not cancelable must be fired on the <code><a href="#datagrid0">datagrid</a></code> element. If changes are made to the
   selection via calls to the object's methods during the execution of a
   script<!-- XXX should xref to a better explanation -->, then the <code title="event-select"><a href="#select">select</a></code> events must be
   coalesced into one, which must then be fired<!--XXX xref again--> when the
   script execution has completed<!-- XXX xref -->.

  </p><p class="note">The <code><a href="#datagridselection">DataGridSelection</a></code> interface has no
   relation to the <code><a href="section-selection.html#selection1">Selection</a></code>
   interface.

  </p><h5 id="columns"><span class="secno">3.18.2.9. </span>Columns and captions</h5>

  <p><em>This section only applies to interactive user agents.</em>

  </p><p>Each <code><a href="#datagrid0">datagrid</a></code> element must keep
   track of which columns are currently being rendered. User agents should
   initially show all the columns except those with the <code title="datagrid-column-class-initially-hidden"><a href="#initially-hidden">initially-hidden</a></code> class, but may allow
   users to hide or show columns. User agents should initially display the
   columns in the order given by the data provider, but may allow this order
   to be changed by the user.

  </p><p>If columns are not being used, as might be the case if the data grid is
   being presented in an icon view, or if an overview of data is being read
   in an aural context, then the text of the first column of each row should
   be used to represent the row.

  </p><p>If none of the columns have any captions (i.e. if the data provider does
   not provide a <code title="dom-provider-getCaptionText"><a href="#getcaptiontext">getCaptionText()</a></code> method), then user
   agents may avoid showing the column headers at all. This may prevent the
   user from performing actions on the columns (such as reordering them,
   changing the sort column, and so on).

  </p><p class="note">Whatever the order used for rendering, and irrespective of
   what columns are being shown or hidden, the &quot;first column&quot; as referred to
   in this specification is always the column with index zero, and the &quot;last
   column&quot; is always the column with the index one less than the value
   returned by the <code title="dom-provider-getcolumnCount"><a href="#getcolumncount">getColumnCount()</a></code> method of the data
   provider.

  </p><p>If <a href="#columnType2">a column is sortable</a>, then the user must
   be able to invoke it to sort the data. When the user does so, then the
   <code><a href="#datagrid0">datagrid</a></code> must invoke the data
   provider's <code title="dom-provider-toggleColumnSortState"><a href="#togglecolumnsortstate">toggleColumnSortState()</a></code> method,
   with the column's index as the only argument. The <code><a href="#datagrid0">datagrid</a></code> must <em>then</em> act as if the
   <code><a href="#datagrid0">datagrid</a></code>'s <code title="dom-datagrid-updateEverything"><a href="#updateeverything">updateEverything()</a></code> method had been
   invoked.</p>
  <!--XXXDND
  <h5>Drag and drop in <code>datagrid</code>s</h5>

  <p><em>This section only applies to interactive user agents.</p>

  <p class="big-issue">define drag and drop in datagrids; selectiondraggable, etc.</p>
-->

  <script src="http://status.whatwg.org/annotate-web-apps.js" type="text/javascript"></script></body></html>
