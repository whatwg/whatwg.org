<!DOCTYPE HTML>


<html lang="en-GB-hixie">
 <head>
  <title>HTML 5</title>
  <link href="/style/specification" type="text/css" rel="stylesheet">
  <link href="/images/icon" rel="icon">

  <style type="text/css">
   h4 + .element { margin-top: -2.5em; padding-top: 2em; }
   h4 + p + .element { margin-top: -5em; padding-top: 4em; }
   .element { background: #EEFFEE; color: black; margin: 0 0 1em -1em; padding: 0 1em 0.25em 0.75em; border-left: solid #99FF99 0.25em; -padding: 0; /* that last decl is for IE6. Try removing it, it's hilarious! */ }
   .proposal { border: blue solid; padding: 1em; }
   table.matrix, table.matrix td { border: none; text-align: right; }
   table.matrix { margin-left: 2em; }
  </style>

 <link href="section-contenteditable.html#nav-bar" rel="prev" title="5.2. The contenteditable attribute"><link href="index.html#contents" rel="index" title="Table of contents"><link href="section-undo.html#nav-bar" rel="next" title="5.4. Undo
   history"></head><body class="cfc">
  <style scoped>
   * { color: gray ! important; background: none ! important; border-color: silver ! important; }
   img, object, iframe { filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); -webkit-filter: grayscale(100%); }
   .obsolete { border: double thick red ! important; background: yellow ! important; margin: 4em auto 0 auto; max-width: 50em; width: 70%; text-align: center; position: fixed;  z-index: 10000; top: 0; left: 0; right: 0; }
   .obsolete a { color: blue ! important; }
   .obsolete p { font: 900 2em sans-serif; color: red ! important; margin: 1em 1.5em ! important; }
  </style>
  <div class=obsolete>
   <p>This is a snapshot of an early working draft and has therefore
   been superseded by the <a href="http://whatwg.org/html">HTML
   standard</a>.</p>
   <p>This document will not be further updated.</p>
  </div>
<div class="head">
   <p><a href="http://www.whatwg.org/" class="logo" rel="home"><img src="/images/logo" alt="WHATWG"></a></p>

   <h1 id="html-5">HTML 5</h1>

   <h2 id="working" class="no-num no-toc">Call For Comments — 27 October 2007</h2></div><nav id="nav-bar"><a href="section-contenteditable.html#nav-bar">&lt; 5.2. The contenteditable attribute</a> – <a href="index.html#contents">Table of contents</a> – <a href="section-undo.html#nav-bar">5.4. Undo
   history &gt;</a></nav><h3 id="dnd"><span class="secno">5.3. </span><dfn id="drag-and">Drag and
   drop</dfn></h3>
  <!--XXX

http://msdn.microsoft.com/workshop/author/datatransfer/overview.asp
http://msdn.microsoft.com/workshop/author/dhtml/reference/objects/clipboarddata.asp

> To implement this with simple interface I've proposed, events should be
> handled either by existing elements (like list items that compare their size
> and position of dragged element to decide whether element should be dropped
> before or after) or handled by container that would probably need to calculate
> positions of it's children and create new element to show drop target. Smooth
> Mac-like drag'n'drop can be implemented by animating drop target's
> padding/margin. So that's quite a bit of code that's going to be reinvented
> each time someone implements reordering.

<hyatt> :droptarget
<hyatt> or something
<hyatt> we don't support a pseudo-class for the drop target but that's a great idea
<Hixie_> yeah, thinking about that too
<Hixie_> :drop-target, :drop-target(above), :drop-target(below) and having ondragover be able to say "not on me, but next to me maybe"

http://msdn.microsoft.com/workshop/author/dhtml/reference/events/ondragstart.asp
http://msdn.microsoft.com/workshop/author/dhtml/reference/events/ondrag.asp
http://msdn.microsoft.com/workshop/author/dhtml/reference/events/ondragend.asp
http://msdn.microsoft.com/workshop/author/dhtml/reference/objects/obj_datatransfer.asp
http://developer.apple.com/documentation/AppleApplications/Conceptual/SafariJSProgTopics/Tasks/DragAndDrop.html
-->

  <p>This section defines an event-based drag-and-drop mechanism.

  </p><p>This specification does not define exactly what a <em>drag-and-drop
   operation</em> actually is.

  </p><p>On a visual medium with a pointing device, a drag operation could be the
   default action of a <code title="event-mousedown">mousedown</code> event
   that is followed by a series of <code title="event-mousemove">mousemove</code> events, and the drop could be
   triggered by the mouse being released.

  </p><p>On media without a pointing device, the user would probably have to
   explicitly indicate his intention to perform a drag-and-drop operation,
   stating what he wishes to drag and what he wishes to drop, respectively.

  </p><p>However it is implemented, drag-and-drop operations must have a starting
   point (e.g. where the mouse was clicked, or the start of <a href="section-selection.html#a-selection">the selection</a> or element that was selected for the
   drag), may have any number of intermediate steps (elements that the mouse
   moves over during a drag, or elements that the user picks as possible drop
   points as he cycles through possibilities), and must either have an end
   point (the element above which the mouse button was released, or the
   element that was finally selected), or be canceled. The end point must be
   the last element selected as a possible drop point before the drop occurs
   (so if the operation is not canceled, there must be at least one element
   in the middle step).

  </p><h4 id="the-dragevent"><span class="secno">5.3.1. </span>The <code><a href="#dragevent">DragEvent</a></code> and <code><a href="#datatransfer0">DataTransfer</a></code> interfaces</h4>

  <p>The drag-and-drop processing model involves several events. They all use
   the <code><a href="#dragevent">DragEvent</a></code> interface.

  </p><pre class="idl">interface <dfn id="dragevent">DragEvent</dfn> : UIEvent {
  readonly attribute <a href="#datatransfer0">DataTransfer</a> <a href="#datatransfer" title="dom-DragEvent-dataTransfer">dataTransfer</a>;
  void <a href="#initdragevent" title="dom-DragEvent-initDragEvent">initDragEvent</a>(in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in AbstractView viewArg, in long detailArg, in <a href="#datatransfer0">DataTransfer</a> dataTransferArg);
  void <a href="#initdrageventns" title="dom-DragEvent-initDragEventNS">initDragEventNS</a>(in DOMString namespaceURIArg, in DOMString typeArg, in boolean canBubbleArg, in boolean cancelableArg, in AbstractView viewArg, in long detailArg, in <a href="#datatransfer0">DataTransfer</a> dataTransferArg);
};</pre>

  <p class="issue">We should have modifier key information in here too
   (shift/ctrl, etc), like with mouse events and like with the context menu
   event.

  </p><p>The <dfn id="initdragevent" title="dom-DragEvent-initDragEvent"><code>initDragEvent()</code></dfn> and
   <dfn id="initdrageventns" title="dom-DragEvent-initDragEventNS"><code>initDragEventNS()</code></dfn>
   methods must initialise the event in a manner analogous to the
   similarly-named methods in the DOM3 Events interfaces. <a href="#refsDOM3EVENTS">[DOM3EVENTS]</a>

  </p><p>The <dfn id="datatransfer" title="dom-DragEvent-dataTransfer"><code>dataTransfer</code></dfn> attribute
   of the <code><a href="#dragevent">DragEvent</a></code> interface
   represents the context information for the event.

  </p><p>When a <code><a href="#dragevent">DragEvent</a></code> object is
   created, a new <code><a href="#datatransfer0">DataTransfer</a></code>
   object must be created and assigned to the <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> context information field of
   the event object.

  </p><pre class="idl">interface <dfn id="datatransfer0">DataTransfer</dfn> {
           attribute DOMString <a href="#dropeffect" title="dom-DataTransfer-dropEffect">dropEffect</a>;
           attribute DOMString <a href="#effectallowed" title="dom-DataTransfer-effectAllowed">effectAllowed</a>;
  void <a href="#cleardata" title="dom-DataTransfer-clearData">clearData</a>(in DOMString format);
  void <a href="#setdata" title="dom-DataTransfer-setData">setData</a>(in DOMString format, in DOMString data);
  DOMString <a href="#getdata" title="dom-DataTransfer-getData">getData</a>(in DOMString format);
  void <a href="#setdragimage" title="dom-DataTransfer-setDragImage">setDragImage</a>(in Element image, in long x, in long y);
  void <a href="#addelement" title="dom-DataTransfer-addElement">addElement</a>(in Element element);
};
</pre>

  <p><code><a href="#datatransfer0">DataTransfer</a></code> objects can
   conceptually contain various kinds of data.

  </p><p>When a <code><a href="#dragevent">DragEvent</a></code> event object is
   initialised, the <code><a href="#datatransfer0">DataTransfer</a></code>
   object created for the event's <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> member must be initialised as
   follows:

  </p><ul>
   <li>The <code><a href="#datatransfer0">DataTransfer</a></code> object must
    initially contain no data, no elements, and have no associated image.

   </li><li>The <code><a href="#datatransfer0">DataTransfer</a></code> object's
    <code title="dom-DataTransfer-effectAllowed"><a href="#effectallowed">effectAllowed</a></code> attribute must be set to
    &quot;<code title="">uninitialized</code>&quot;.

   </li><li>The <code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code> attribute must be set to &quot;<code title="">none</code>&quot;.
  </li></ul>

  <p>The <dfn id="dropeffect" title="dom-DataTransfer-dropEffect"><code>dropEffect</code></dfn> attribute
   controls the drag-and-drop feedback that the user is given during a
   drag-and-drop operation.

  </p><p>The attribute must ignore any attempts to set it to a value other than
   <code title="">none</code>, <code title="">copy</code>, <code title="">link</code>, and <code title="">move</code>. On getting, the
   attribute must return the last of those four values that it was set to.

  </p><p>The <dfn id="effectallowed" title="dom-DataTransfer-effectAllowed"><code>effectAllowed</code></dfn>
   attribute is used in the drag-and-drop processing model to initialise the
   <code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code> attribute during the <code title="event-dragenter"><a href="#dragenter">dragenter</a></code> and <code title="event-dragover"><a href="#dragover">dragover</a></code> events.

  </p><p>The attribute must ignore any attempts to set it to a value other than
   <code title="">none</code>, <code title="">copy</code>, <code title="">copyLink</code>, <code title="">copyMove</code>, <code title="">link</code>, <code title="">linkMove</code>, <code title="">move</code>, <code title="">all</code>, and <code title="">uninitialized</code>. On getting, the attribute must return the
   last of those values that it was set to.

  </p><p><code><a href="#datatransfer0">DataTransfer</a></code> objects can hold
   pieces of data, each associated with a unique format. Formats are
   generally given by MIME types, with some values special-cased for legacy
   reasons.

  </p><p>The <dfn id="cleardata" title="dom-DataTransfer-clearData"><code>clearData(<var title="">format</var>)</code></dfn> method must clear the <code><a href="#datatransfer0">DataTransfer</a></code> object of any data
   associated with the given <var title="">format</var>. If <var title="">format</var> is the value &quot;<code title="">Text</code>&quot;, then it
   must be treated as &quot;<code title="">text/plain</code>&quot;. If the <var title="">format</var> is &quot;<code title="">URL</code>&quot;, then it must be
   treated as &quot;<code title="">text/uri-list</code>&quot;.

  </p><p>The <dfn id="setdata" title="dom-DataTransfer-setData"><code>setData(<var title="">format</var>, <var title="">data</var>)</code></dfn> method must
   add <var title="">data</var> to the data stored in the <code><a href="#datatransfer0">DataTransfer</a></code> object, labelled as being of
   the type <var title="">format</var>. This must replace any previous data
   that had been set for that format. If <var title="">format</var> is the
   value &quot;<code title="">Text</code>&quot;, then it must be treated as &quot;<code title="">text/plain</code>&quot;. If the <var title="">format</var> is &quot;<code title="">URL</code>&quot;, then it must be treated as &quot;<code title="">text/uri-list</code>&quot;.

  </p><p>The <dfn id="getdata" title="dom-DataTransfer-getData"><code>getData(<var title="">format</var>)</code></dfn> method must return the data that is
   associated with the type <var title="">format</var>, if any, and must
   return the empty string otherwise. If <var title="">format</var> is the
   value &quot;<code title="">Text</code>&quot;, then it must be treated as &quot;<code title="">text/plain</code>&quot;. If the <var title="">format</var> is &quot;<code title="">URL</code>&quot;, then the data associated with the &quot;<code title="">text/uri-list</code>&quot; format must be parsed as appropriate for
   <code title="">text/uri-list</code> data, and the first URI from the list
   must be returned. If there is no data with that format, or if there is but
   it has no URIs, then the method must return the empty string. <a href="#refsRFC2483">[RFC2483]</a>

  </p><p>The <dfn id="setdragimage" title="dom-DataTransfer-setDragImage"><code>setDragImage(<var title="">element</var>, <var title="">x</var>, <var title="">y</var>)</code></dfn> method sets which element to use <a href="#base-dnd-feedback">to generate the drag feedback</a>. The <var title="">element</var> argument can be any <code>Element</code>; if it is
   an <code><a href="section-embedded.html#img">img</a></code> element, then the user agent should
   use the element's image (at its intrinsic size) to generate the feedback,
   otherwise the user agent should base the feedback on the given element
   (but the exact mechanism for doing so is not specified).

  </p><p>The <dfn id="addelement" title="dom-DataTransfer-addElement"><code>addElement(<var title="">element</var>)</code></dfn> method is an alternative way of
   specifying how the user agent is to <a href="#base-dnd-feedback">render
   the drag feedback</a>. It adds an element to the <code><a href="#datatransfer0">DataTransfer</a></code> object.

  </p><h4 id="events1"><span class="secno">5.3.2. </span>Events fired during a
   drag-and-drop action</h4>

  <p>The following events are involved in the drag-and-drop model. Whenever
   the processing model described below causes one of these events to be
   fired, the event fired must use the <code><a href="#dragevent">DragEvent</a></code> interface defined above, must have
   the bubbling and cancelable behaviours given in the table below, and must
   have the context information set up as described after the table, with the
   <code title="dom-UIEvent-view">view</code> attribute set to the view with
   which the user interacted to trigger the drag-and-drop event, and the
   <code title="dom-UIEvent-detail">detail</code> attribute set to zero.

  </p><table>
   <thead>
    <tr>
     <th> Event Name

     </th><th> Target

     </th><th> Bubbles?

     </th><th> Cancelable?

     </th><th> <code title="dom-DataTransfer-addElement"><a href="#addelement">dataTransfer</a></code>

     </th><th> <code title="dom-DataTransfer-effectAllowed"><a href="#effectallowed">effectAllowed</a></code>

     </th><th> <code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code>

     </th><th> Default Action

   </th></tr></thead><tbody>
    <tr>
     <td><dfn id="dragstart" title="event-dragstart"><code>dragstart</code></dfn>

     </td><td><a href="#source0">Source node</a>

     </td><td>✓ Bubbles

     </td><td>✓ Cancelable

     </td><td>Contains <a href="#source0">source node</a> unless a selection is
      being dragged, in which case it is empty

     </td><td><code title="">uninitialized</code>

     </td><td><code title="">none</code>

     </td><td>Initiate the drag-and-drop operation

    </td></tr><tr>
     <td><dfn id="drag" title="event-drag"><code>drag</code></dfn>

     </td><td><a href="#source0">Source node</a>

     </td><td>✓ Bubbles

     </td><td>✓ Cancelable

     </td><td>Empty

     </td><td><a href="#effectAllowed-initialisation">Same as last event</a>

     </td><td><code title="">none</code>

     </td><td>Continue the drag-and-drop operation

    </td></tr><tr>
     <td><dfn id="dragenter" title="event-dragenter"><code>dragenter</code></dfn>

     </td><td><a href="#immediate">Immediate user selection</a> or <a href="section-dom-tree.html#the-body0">the body element</a>

     </td><td>✓ Bubbles

     </td><td>✓ Cancelable

     </td><td>Empty

     </td><td><a href="#effectAllowed-initialisation">Same as last event</a>

     </td><td><a href="#dropEffect-initialisation">Based on
      <code>effectAllowed</code> value</a>

     </td><td>Reject <a href="#immediate">immediate user selection</a> as
      potential <a href="#current1" title="current target element">target
      element</a>

    </td></tr><tr>
     <td><dfn id="dragleave" title="event-dragleave"><code>dragleave</code></dfn>

     </td><td><a href="#current1" title="current target element">Previous target
      element</a>

     </td><td>✓ Bubbles

     </td><td>—

     </td><td>Empty

     </td><td><a href="#effectAllowed-initialisation">Same as last event</a>

     </td><td><code title="">none</code>

     </td><td>None

    </td></tr><tr>
     <td><dfn id="dragover" title="event-dragover"><code>dragover</code></dfn>

     </td><td><a href="#current1">Current target element</a>

     </td><td>✓ Bubbles

     </td><td>✓ Cancelable

     </td><td>Empty

     </td><td><a href="#effectAllowed-initialisation">Same as last event</a>

     </td><td><a href="#dropEffect-initialisation">Based on
      <code>effectAllowed</code> value</a>

     </td><td>Reset the <a href="#current2">current drag operation</a> to &quot;none&quot;

    </td></tr><tr>
     <td><dfn id="drop" title="event-drop"><code>drop</code></dfn>

     </td><td><a href="#current1">Current target element</a>

     </td><td>✓ Bubbles

     </td><td>✓ Cancelable

     </td><td><code>getData()</code> returns data set in <code title="dom-dragstart">dragstart</code> event

     </td><td><a href="#effectAllowed-initialisation">Same as last event</a>

     </td><td><a href="#current2">Current drag operation</a>

     </td><td>Varies

    </td></tr><tr>
     <td><dfn id="dragend" title="event-dragend"><code>dragend</code></dfn>

     </td><td><a href="#source0">Source node</a>

     </td><td>✓ Bubbles

     </td><td>—

     </td><td>Empty

     </td><td><a href="#effectAllowed-initialisation">Same as last event</a>

     </td><td><a href="#current2">Current drag operation</a>

     </td><td>Varies
  </td></tr></tbody></table>

  <p>The <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> object's contents are empty
   except for <code title="event-dragstart"><a href="#dragstart">dragstart</a></code> events and <code title="event-drop"><a href="#drop">drop</a></code> events, for which the
   contents are set as described in the processing model, below.

  </p><p id="effectAllowed-initialisation">The <code title="dom-DataTransfer-effectAllowed"><a href="#effectallowed">effectAllowed</a></code> attribute must be set to
   &quot;<code title="">uninitialized</code>&quot; for <code title="event-dragstart"><a href="#dragstart">dragstart</a></code> events, and to whatever value the
   field had after the last drag-and-drop event was fired for all other
   events (only counting events fired by the user agent for the purposes of
   the drag-and-drop model described below).

  </p><p id="dropEffect-initialisation">The <code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code> attribute must be set to &quot;<code title="">none</code>&quot; for <code title="event-dragstart"><a href="#dragstart">dragstart</a></code>, <code title="event-drag"><a href="#drag">drag</a></code>, and <code title="event-dragleave"><a href="#dragleave">dragleave</a></code> events (except when stated
   otherwise in the algorithms given in the sections below), to the value
   corresponding to the <a href="#current2">current drag operation</a> for
   <code title="event-drop"><a href="#drop">drop</a></code> and <code title="event-dragend"><a href="#dragend">dragend</a></code> events, and to a
   value based on the <code title="dom-DataTransfer-effectAllowed"><a href="#effectallowed">effectAllowed</a></code> attribute's value and to
   the drag-and-drop source, as given by the following table, for the
   remaining events (<code title="event-dragenter"><a href="#dragenter">dragenter</a></code> and <code title="event-dragover"><a href="#dragover">dragover</a></code>):

  </p><table>
   <thead>
    <tr>
     <th><code title="dom-DataTransfer-effectAllowed"><a href="#effectallowed">effectAllowed</a></code>

     </th><th><code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code>

   </th></tr></thead><tbody>
    <tr>
     <td><code title="">none</code>

     </td><td><code title="">none</code>

    </td></tr><tr>
     <td><code title="">copy</code>, <code title="">copyLink</code>, <code title="">copyMove</code>, <code title="">all</code>

     </td><td><code title="">copy</code>

    </td></tr><tr>
     <td><code title="">link</code>, <code title="">linkMove</code>

     </td><td><code title="">link</code>

    </td></tr><tr>
     <td><code title="">move</code>

     </td><td><code title="">move</code>

    </td></tr><tr>
     <td><code title="">uninitialized</code> when what is being dragged is a
      selection from a text field

     </td><td><code title="">move</code>

    </td></tr><tr>
     <td><code title="">uninitialized</code> when what is being dragged is a
      selection

     </td><td><code title="">copy</code>

    </td></tr><tr>
     <td><code title="">uninitialized</code> when what is being dragged is an
      <code><a href="section-phrase.html#a">a</a></code> element with an <code>href</code>
      attribute

     </td><td><code title="">link</code>

    </td></tr><tr>
     <td>Any other case

     </td><td><code title="">copy</code>
  </td></tr></tbody></table>

  <h4 id="drag-and-drop"><span class="secno">5.3.3. </span>Drag-and-drop
   processing model</h4>

  <p>When the user attempts to begin a drag operation, the user agent must
   first determine what is being dragged. If the drag operation was invoked
   on a selection, then it is the selection that is being dragged. Otherwise,
   it is the first element, going up the ancestor chain, starting at the node
   that the user tried to drag, that has the DOM attribute <code title="dom-draggable"><a href="#draggable0">draggable</a></code> set to
   true. If there is no such element, then nothing is being dragged, the
   drag-and-drop operation is never started, and the user agent must not
   continue with this algorithm.

  </p><p class="note"><code><a href="section-embedded.html#img">img</a></code> elements and <code><a href="section-phrase.html#a">a</a></code> elements with an <code title="attr-hyperlink-href"><a href="section-links.html#href6">href</a></code> attribute have their <code title="dom-draggable"><a href="#draggable0">draggable</a></code> attribute
   set to true by default.

  </p><p>If the user agent determines that something can be dragged, a <code title="event-dragstart"><a href="#dragstart">dragstart</a></code> event must
   then be fired.

  </p><p>If it is a selection that is being dragged, then this event must be
   fired on the node that the user started the drag on (typically the text
   node that the user originally clicked). If the user did not specify a
   particular node, for example if the user just told the user agent to begin
   a drag of &quot;the selection&quot;, then the event must be fired on the deepest
   node that is a common ancestor of all parts of the selection.

  </p><p class="big-issue">We should look into how browsers do other types (e.g.
   Firefox apparently also adds text/html for internal drag and drop of a
   selection).

  </p><p>If it is not a selection that is being dragged, then the event must be
   fired on the element that is being dragged.

  </p><p>The node on which the event is fired is the <dfn id="source0">source
   node</dfn>. Multiple events are fired on this node during the course of
   the drag-and-drop operation.

  </p><p>If it is a selection that is being dragged, the <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> member of the event must be
   created with no nodes. Otherwise, it must be created containing just the
   <a href="#source0">source node</a>. Script can use the <code title="dom-DataTransfer-addElement"><a href="#addelement">addElement()</a></code> method to add further elements
   to the list of what is being dragged.

  </p><p>If it is a selection that is being dragged, the <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> member of the event must have
   the text of the selection added to it as the data associated with the
   <code title="">text/plain</code> format. Otherwise, if it is an <code><a href="section-embedded.html#img">img</a></code> element being dragged, then the value of the
   element's <code title="dom-img-src"><a href="section-embedded.html#src0">src</a></code> DOM
   attribute must be added, associated with the <code title="">text/uri-list</code> format. Otherwise, if it is an <code><a href="section-phrase.html#a">a</a></code> element being dragged, then the value of the
   element's <code title="dom-a-href"><a href="section-phrase.html#href3">href</a></code> DOM
   attribute must be added, associated with the <code title="">text/uri-list</code> format. Otherwise, no data is added to the
   object by the user agent.

  </p><p>If the event is canceled, then the drag-and-drop operation must not
   occur; the user agent must not continue with this algorithm.

  </p><p>If it is not canceled, then the drag-and-drop operation must be
   initiated.

  </p><p class="note">Since events with no event handlers registered are, almost by
   definition, never canceled, drag-and-drop is always available to the user
   if the author does not specifically prevent it.

  </p><p id="base-dnd-feedback">The drag-and-drop feedback must be generated from
   the first of the following sources that is available:

  </p><ol>
   <li>The element specified in the last call to the <code title="dom-DataTransfer-setDragImage"><a href="#setdragimage">setDragImage()</a></code> method of the <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> object of the <code title="event-dragstart"><a href="#dragstart">dragstart</a></code> event, if
    the method was called. In visual media, if this is used, the <var title="">x</var> and <var title="">y</var> arguments that were passed to
    that method should be used as hints for where to put the cursor relative
    to the resulting image. The values are expressed as distances in CSS
    pixels from the left side and from the top side of the image
    respectively. <a href="#refsCSS21">[CSS21]</a></li>
   <!--
   CSS3 UNITS would be better -->

   <li>The elements that were added to the <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> object, both before the
    event was fired, and during the handling of the event using the <code title="dom-DataTransfer-addElement"><a href="#addelement">addElement()</a></code> method, if any such elements
    were indeed added.

   </li><li>The selection that the user is dragging.
  </li></ol>
  <!-- XXX xref also link to the section that explains how to
  render drag-and-drop, :drag, :drop, etc. Safari has a pseudo-class
  that it uses to render an element off-screen to use as the drag
  feedback. -->

  <p>The user agent must take a note of <a href="#setdata" title="dom-DataTransfer-setData">the data that was placed</a> in the <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> object. This data will be
   made available again when the <code title="event-drop"><a href="#drop">drop</a></code> event is fired.

  </p><p>From this point until the end of the drag-and-drop operation, device
   input events (e.g. mouse and keyboard events) must be suppressed. In
   addition, the user agent must track all DOM changes made during the
   drag-and-drop operation, and add them to its <a href="section-undo.html#undo">undo
   history</a> as one atomic operation once the drag-and-drop operation has
   ended.

  </p><p>During the drag operation, the element directly indicated by the user as
   the drop target is called the <dfn id="immediate">immediate user
   selection</dfn>. (Only elements can be selected by the user; other nodes
   must not be made available as drop targets.) However, the <a href="#immediate">immediate user selection</a> is not necessarily the <dfn id="current1">current target element</dfn>, which is the element currently
   selected for the drop part of the drag-and-drop operation. The <a href="#immediate">immediate user selection</a> changes as the user selects
   different elements (either by pointing at them with a pointing device, or
   by selecting them in some other way). The <a href="#current1">current
   target element</a> changes when the <a href="#immediate">immediate user
   selection</a> changes, based on the results of event handlers in the
   document, as described below.

  </p><p>Both the <a href="#current1">current target element</a> and the <a href="#immediate">immediate user selection</a> can be null, which means no
   target element is selected. They can also both be elements in other
   (DOM-based) documents, or other (non-Web) programs altogether. (For
   example, a user could drag text to a word-processor.) The <a href="#current1">current target element</a> is initially null.

  </p><p>In addition, there is also a <dfn id="current2">current drag
   operation</dfn>, which can take on the values &quot;none&quot;, &quot;copy&quot;, &quot;link&quot;, and
   &quot;move&quot;. Initially it has the value &quot;none&quot;. It is updated by the user agent
   as described in the steps below.

  </p><p>User agents must, every 350ms (±200ms), perform the following steps
   in sequence. (If the user agent is still performing the previous iteration
   of the sequence when the next iteration becomes due, the user agent must
   not execute the overdue iteration, effectively &quot;skipping missed frames&quot; of
   the drag-and-drop operation.)

  </p><ol>
   <li>
    <p>First, the user agent must fire a <code title="event-drag"><a href="#drag">drag</a></code> event at the <a href="#source0">source
     node</a>. If this event is canceled, the user agent must set the <a href="#current2">current drag operation</a> to none (no drag operation).</p>

   </li><li>
    <p>Next, if the <code title="event-drag"><a href="#drag">drag</a></code>
     event was not canceled and the user has not ended the drag-and-drop
     operation, the user agent must check the state of the drag-and-drop
     operation, as follows:</p>

    <ol>
     <li>
      <p>First, if the user is indicating a different <a href="#immediate">immediate user selection</a> than during the last
       iteration (or if this is the first iteration), and if this <a href="#immediate">immediate user selection</a> is not the same as the
       <a href="#current1">current target element</a>, then the <a href="#current1">current target element</a> must be updated, as
       follows:</p>

      <ol>
       <li>
        <p>If the new <a href="#immediate">immediate user selection</a> is
         null, or is in a non-DOM document or application, then set the <a href="#current1">current target element</a> to the same value.</p>

       </li><li>
        <p>Otherwise, the user agent must fire a <code title="event-dragenter"><a href="#dragenter">dragenter</a></code>
         event at the <a href="#immediate">immediate user selection</a>.</p>

       </li><li>
        <p>If the event is canceled, then the <a href="#current1">current
         target element</a> must be set to the <a href="#immediate">immediate
         user selection</a>.</p>

       </li><li>
        <p>Otherwise, if the <a href="#current1">current target element</a>
         is not <a href="section-dom-tree.html#the-body0">the body element</a>, the user agent
         must fire a <code title="event-dragenter"><a href="#dragenter">dragenter</a></code> event at <a href="section-dom-tree.html#the-body0">the body element</a>, and the <a href="#current1">current target element</a> must be set to <a href="section-dom-tree.html#the-body0">the body element</a>, regardless of whether that
         event was canceled or not. (If <a href="section-dom-tree.html#the-body0">the body
         element</a> is null, then the <a href="#current1">current target
         element</a> would be set to null too in this case, it wouldn't be
         set to the <code>Document</code> object.)</p>
      </li></ol>

     </li><li>
      <p>If the previous step caused the <a href="#current1">current target
       element</a> to change, and if the previous target element was not null
       or a part of a non-DOM document, the user agent must fire a <code title="event-dragleave"><a href="#dragleave">dragleave</a></code> event
       at the previous target element.</p>

     </li><li>
      <p>If the <a href="#current1">current target element</a> is a DOM
       element, the user agent must fire a <code title="event-dragover"><a href="#dragover">dragover</a></code> event at this <a href="#current1">current target element</a>.</p>

      <p>If the <code title="event-dragover"><a href="#dragover">dragover</a></code> event is canceled, the <a href="#current2">current drag operation</a> must be reset to &quot;none&quot;.</p>

      <p>Otherwise, the <a href="#current2">current drag operation</a> must
       be set based on the values the <code title="dom-DataTransfer-effectAllowed"><a href="#effectallowed">effectAllowed</a></code> and <code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code> attributes of the <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> object had after the
       event was handled, as per the following table:</p>

      <table>
       <thead>
        <tr>
         <th><code title="dom-DataTransfer-effectAllowed"><a href="#effectallowed">effectAllowed</a></code>

         </th><th><code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code>

         </th><th>Drag operation

       </th></tr></thead><tbody>
        <tr>
         <td><code title="">uninitialized</code>, <code title="">copy</code>,
          <code title="">copyLink</code>, <code title="">copyMove</code>, or
          <code title="">all</code>

         </td><td><code title="">copy</code>

         </td><td>&quot;copy&quot;

        </td></tr><tr>
         <td><code title="">uninitialized</code>, <code title="">link</code>,
          <code title="">copyLink</code>, <code title="">linkMove</code>, or
          <code title="">all</code>

         </td><td><code title="">link</code>

         </td><td>&quot;link&quot;

        </td></tr><tr>
         <td><code title="">uninitialized</code>, <code title="">move</code>,
          <code title="">copyMove</code>, <code title="">linkMove</code>, or
          <code title="">all</code>

         </td><td><code title="">move</code>

         </td><td>&quot;move&quot;

        </td></tr><tr>
         <td colspan="2">Any other case

         </td><td>&quot;none&quot;
      </td></tr></tbody></table>

      <p>Then, regardless of whether the <code title="event-dragover"><a href="#dragover">dragover</a></code> event was canceled or not, the
       drag feedback (e.g. the mouse cursor) must be updated to match the <a href="#current2">current drag operation</a>, as follows:</p>

      <table>
       <thead>
        <tr>
         <th>Drag operation

         </th><th>Feedback

       </th></tr></thead><tbody>
        <tr>
         <td>&quot;copy&quot;

         </td><td>Data will be copied if dropped here.

        </td></tr><tr>
         <td>&quot;link&quot;

         </td><td>Data will be linked if dropped here.

        </td></tr><tr>
         <td>&quot;move&quot;

         </td><td>Data will be moved if dropped here.

        </td></tr><tr>
         <td>&quot;none&quot;

         </td><td>No operation allowed, dropping here will cancel the
          drag-and-drop operation.
      </td></tr></tbody></table>

     </li><li>
      <p>Otherwise, if the <a href="#current1">current target element</a> is
       not a DOM element, the user agent must use platform-specific
       mechanisms to determine what drag operation is being performed (none,
       copy, link, or move). This sets the <em><a href="#current2">current
       drag operation</a></em>.</p>
    </li></ol>

   </li><li>
    <p>Otherwise, if the user ended the drag-and-drop operation (e.g. by
     releasing the mouse button in a mouse-driven drag-and-drop interface),
     or if the <code title="event-drag"><a href="#drag">drag</a></code> event
     was canceled, then this will be the last iteration. The user agent must
     execute the following steps, then stop looping.</p>

    <ol>
     <li>
      <p>If the <a href="#current2">current drag operation</a> is none (no
       drag operation), or, if the user ended the drag-and-drop operation by
       canceling it (e.g. by hitting the <kbd>Escape</kbd> key), or if the <a href="#current1">current target element</a> is null, then the drag
       operation failed. If the <a href="#current1">current target
       element</a> is a DOM element, the user agent must fire a <code title="event-dragleave"><a href="#dragleave">dragleave</a></code> event
       at it; otherwise, if it is not null, it must use platform-specific
       conventions for drag cancellation.</p>

     </li><li>
      <p>Otherwise, the drag operation was as success. If the <a href="#current1">current target element</a> is a DOM element, the user
       agent must fire a <code title="event-drop"><a href="#drop">drop</a></code> event at it; otherwise, it must use
       platform-specific conventions for indicating a drop.</p>

      <p>When the target is a DOM element, the <code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code> attribute of the event's
       <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> object must be given the
       value representing the <a href="#current2">current drag operation</a>
       (<code title="">copy</code>, <code title="">link</code>, or <code title="">move</code>), and the object must be set up so that the <code title="dom-DataTransfer-getData"><a href="#getdata">getData()</a></code>
       method will return the data that was added during the <code title="event-dragstart"><a href="#dragstart">dragstart</a></code> event.</p>

      <p>If the event is canceled, the <a href="#current2">current drag
       operation</a> must be set to the value of the <code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code> attribute of the event's
       <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> object as it stood after
       the event was handled.</p>

      <p>Otherwise, the event is not canceled, and the user agent must
       perform the event's default action, which depends on the exact target
       as follows:</p>

      <dl class="switch">
       <dt>If the <a href="#current1">current target element</a> is a text
        field (e.g. <code>textarea</code>, or an <code>input</code> element
        with <code title="">type=&quot;text&quot;</code><!--XXX xref-->)

       </dt><dd>The user agent must insert the data associated with the
        <code>text/plain</code> format, if any, into the text field in a
        manner consistent with platform-specific conventions (e.g. inserting
        it at the current mouse cursor position, or inserting it at the end
        of the field).

       </dd><dt>Otherwise

       </dt><dd>Reset the <a href="#current2">current drag operation</a> to
        &quot;none&quot;.
      </dd></dl>

     </li><li>
      <p>Finally, the user agent must fire a <code title="event-dragend"><a href="#dragend">dragend</a></code> event at the <a href="#source0">source node</a>, with the <code title="dom-DataTransfer-dropEffect"><a href="#dropeffect">dropEffect</a></code> attribute of the event's
       <code title="dom-DragEvent-dataTransfer"><a href="#datatransfer">dataTransfer</a></code> object being set to the
       value corresponding to the <a href="#current2">current drag
       operation</a>.</p>

      <p class="note">The <a href="#current2">current drag operation</a> can
       change during the processing of the <code title="event-drop"><a href="#drop">drop</a></code> event, if one was fired.</p>

      <p>The event is not cancelable. After the event has been handled, the
       user agent must act as follows:</p>

      <dl class="switch">
       <dt>If the <a href="#current1">current target element</a> is a text
        field (e.g. <code>textarea</code>, or an <code>input</code> element
        with <code title="">type=&quot;text&quot;</code><!--XXX xref-->), and a <code title="event-drop"><a href="#drop">drop</a></code> event was fired in
        the previous step, and the <a href="#current2">current drag
        operation</a> is &quot;move&quot;, and the source of the drag-and-drop
        operation is a selection in the DOM

       </dt><dd>The user agent should delete the range representing the dragged
        selection from the DOM.

       </dd><dt>If the <a href="#current1">current target element</a> is a text
        field (e.g. <code>textarea</code>, or an <code>input</code> element
        with <code title="">type=&quot;text&quot;</code><!--XXX xref-->), and a <code title="event-drop"><a href="#drop">drop</a></code> event was fired in
        the previous step, and the <a href="#current2">current drag
        operation</a> is &quot;move&quot;, and the source of the drag-and-drop
        operation is a selection in a text field

       </dt><dd>The user agent should delete the dragged selection from the
        relevant text field.

       </dd><dt>Otherwise

       </dt><dd>The event has no default action.
      </dd></dl>
    </li></ol>
  </li></ol>

  <h5 id="when-the"><span class="secno">5.3.3.1. </span>When the drag-and-drop
   operation starts or ends in another document</h5>

  <p>The model described above is independent of which <code>Document</code>
   object the nodes involved are from; the events must be fired as described
   above and the rest of the processing model must be followed as described
   above, irrespective of how many documents are involved in the operation.</p>
  <!-- should we mention that you shouldn't include the view from the
  source in the events to the target, or is that obvious enough from
  the requirements in the event section above? -->

  <h5 id="when-the0"><span class="secno">5.3.3.2. </span>When the drag-and-drop
   operation starts or ends in another application</h5>

  <p>If the drag is initiated in another application, the <a href="#source0">source node</a> is not a DOM node, and the user agent must
   use platform-specific conventions instead when the requirements above
   involve the source node. User agents in this situation must act as if the
   dragged data had been added to the <code><a href="#datatransfer0">DataTransfer</a></code> object when the drag
   started, even though no <code title="event-dragstart"><a href="#dragstart">dragstart</a></code> event was actually fired; user
   agents must similarly use platform-specific conventions when deciding on
   what drag feedback to use.

  </p><p>If a drag is started in a document but ends in another application, then
   the user agent must instead replace the parts of the processing model
   relating to handling the <em>target</em> according to platform-specific
   conventions.

  </p><p>In any case, scripts running in the context of the document must not be
   able to distinguish the case of a drag-and-drop operation being started or
   ended in another application from the case of a drag-and-drop operation
   being started or ended in another document from another domain.

  </p><h4 id="the-draggable"><span class="secno">5.3.4. </span>The <dfn id="draggable" title="attr-draggable"><code>draggable</code></dfn> attribute</h4>

  <p>All elements may have the <code title="attr-draggable"><a href="#draggable">draggable</a></code> content attribute set. The <code title="attr-draggable"><a href="#draggable">draggable</a></code> attribute
   is an <a href="section-common1.html#enumerated">enumerated attribute</a>. It has three states.
   The first state is <em>true</em> and it has the keyword <code title="">true</code>. The second state is <em>false</em> and it has the
   keyword <code title="">false</code>. The third state is <em>auto</em>; it
   has no keywords but it is the <em>missing value default</em>.

  </p><p>The <dfn id="draggable0" title="dom-draggable"><code>draggable</code></dfn>
   DOM attribute, whose value depends on the content attribute's in the way
   described below, controls whether or not the element is draggable.
   Generally, only text selections are draggable, but elements whose <code title="dom-draggable"><a href="#draggable0">draggable</a></code> DOM
   attribute is true become draggable as well.

  </p><p>If an element's <code title="attr-draggable"><a href="#draggable">draggable</a></code> content attribute has the state
   <em>true</em>, the <code title="dom-draggable"><a href="#draggable0">draggable</a></code> DOM attribute must return true.

  </p><p>Otherwise, if the element's <code title="attr-draggable"><a href="#draggable">draggable</a></code> content attribute has the state
   <em>false</em>, the <code title="dom-draggable"><a href="#draggable0">draggable</a></code> DOM attribute must return false.

  </p><p>Otherwise, the element's <code title="attr-draggable"><a href="#draggable">draggable</a></code> content attribute has the state
   <em>auto</em>. If the element is an <code><a href="section-embedded.html#img">img</a></code>
   element, or, if the element is an <code><a href="section-phrase.html#a">a</a></code> element
   with an <code title="attr-hyperlink-href"><a href="section-links.html#href6">href</a></code>
   content attribute, the <code title="dom-draggable"><a href="#draggable0">draggable</a></code> DOM attribute must return true.

  </p><p>Otherwise, the <code title="dom-draggable"><a href="#draggable0">draggable</a></code> DOM must return false.

  </p><p>If the <code title="dom-draggable"><a href="#draggable0">draggable</a></code> DOM attribute is set to the value
   false, the <code title="attr-draggable"><a href="#draggable">draggable</a></code> content attribute must be set to
   the literal value <code title="">false</code>. If the <code title="dom-draggable"><a href="#draggable0">draggable</a></code> DOM
   attribute is set to the value true, the <code title="attr-draggable"><a href="#draggable">draggable</a></code> content attribute must be set to
   the literal value <code title="">true</code>.

  </p><h4 id="copy-and"><span class="secno">5.3.5. </span>Copy and paste</h4>

  <p>Copy-and-paste is a form of drag-and-drop: the &quot;copy&quot; part is equivalent
   to dragging content to another application (the &quot;clipboard&quot;), and the
   &quot;paste&quot; part is equivalent to dragging content <em>from</em> another
   application.

  </p><p>Select-and-paste (a model used by mouse operations in the X Window
   System) is equivalent to a drag-and-drop operation where the source is the
   selection.

  </p><h5 id="copy-to"><span class="secno">5.3.5.1. </span>Copy to clipboard</h5>

  <p>When the user invokes a copy operation, the user agent must act as if
   the user had invoked a drag on the current selection. If the drag-and-drop
   operation initiates, then the user agent must act as if the user had
   indicated (as the <a href="#immediate">immediate user selection</a>) a
   hypothetical application representing the clipbroad. Then, the user agent
   must act as if the user had ended the drag-and-drop operation without
   canceling it. If the drag-and-drop operation didn't get canceled, the user
   agent should then follow the relevant platform-specific conventions for
   copy operations (e.g. updating the clipboard).

  </p><h5 id="cut-to"><span class="secno">5.3.5.2. </span>Cut to clipboard</h5>

  <p>When the user invokes a cut operation, the user agent must act as if the
   user had invoked a copy operation (see the previous section), followed, if
   the copy was completed successfully, by <a href="section-contenteditable.html#contenteditable-delete">a selection delete operation</a>.

  </p><h5 id="paste"><span class="secno">5.3.5.3. </span>Paste from clipboard</h5>

  <p>When the user invokes a clipboard paste operation, the user agent must
   act as if the user had invoked a drag on a hypothetical application
   representing the clipboard, setting the data associated with the drag as
   the text from the keyboard (either as <code title="">text/plain</code> or
   <code>text/uri-list</code>). If the contents of the clipboard cannot be
   represented as text or URIs, then the paste operation must not have any
   effect.

  </p><p>Then, the user agent must act as if the user had indicated (as the <a href="#immediate">immediate user selection</a>) the element with the
   keyboard focus, and then ended the drag-and-drop operation without
   canceling it.

  </p><h5 id="paste0"><span class="secno">5.3.5.4. </span>Paste from selection</h5>

  <p>When the user invokes a selection paste operation, the user agent must
   act as if the user had invoked a drag on the current selection, then
   indicated (as the <a href="#immediate">immediate user selection</a>) the
   element with the keyboard focus, and then ended the drag-and-drop
   operation without canceling it.

  </p><p>If the contents of the selection cannot be represented as text or URIs,
   then the paste operation must not have any effect.

  </p><h4 id="security7"><span class="secno">5.3.6. </span>Security risks in the
   drag-and-drop model</h4>

  <p>User agents must not make the data added to the <code><a href="#datatransfer0">DataTransfer</a></code> object during the <code title="event-dragstart"><a href="#dragstart">dragstart</a></code> event
   available to scripts until the <code title="event-drop"><a href="#drop">drop</a></code> event, because otherwise, if a user were to
   drag sensitive information from one document to a second document,
   crossing a hostile third document in the process, the hostile document
   could intercept the data.

  </p><p>For the same reason, user agents must only consider a drop to be
   successful if the user specifically ended the drag operation — if
   any scripts end the drag operation, it must be considered unsuccessful
   (canceled) and the <code title="event-drop"><a href="#drop">drop</a></code>
   event must not be fired.

  </p><p>User agents should take care to not start drag-and-drop operations in
   response to script actions. For example, in a mouse-and-window
   environment, if a script moves a window while the user has his mouse
   button depressed, the UA would not consider that to start a drag. This is
   important because otherwise UAs could cause data to be dragged from
   sensitive sources and dropped into hostile documents without the user's
   consent.

  </p><script src="http://status.whatwg.org/annotate-web-apps.js" type="text/javascript"></script></body></html>
