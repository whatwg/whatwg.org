<!DOCTYPE HTML>


<html lang="en-GB-hixie">
 <head>
  <title>HTML 5</title>
  <link href="/style/specification" type="text/css" rel="stylesheet">
  <link href="/images/icon" rel="icon">

  <style type="text/css">
   h4 + .element { margin-top: -2.5em; padding-top: 2em; }
   h4 + p + .element { margin-top: -5em; padding-top: 4em; }
   .element { background: #EEFFEE; color: black; margin: 0 0 1em -1em; padding: 0 1em 0.25em 0.75em; border-left: solid #99FF99 0.25em; -padding: 0; /* that last decl is for IE6. Try removing it, it's hilarious! */ }
   .proposal { border: blue solid; padding: 1em; }
   table.matrix, table.matrix td { border: none; text-align: right; }
   table.matrix { margin-left: 2em; }
  </style>

 <link href="section-parsing.html#nav-bar" rel="prev" title="8.2. Parsing HTML documents"><link href="index.html#contents" rel="index" title="Table of contents"><link href="section-tree-construction.html#nav-bar" rel="next" title="8.2.4. Tree construction"></head><body class="cfc">
  <style scoped>
   * { color: gray ! important; background: none ! important; border-color: silver ! important; }
   img, object, iframe { filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); -webkit-filter: grayscale(100%); }
   .obsolete { border: double thick red ! important; background: yellow ! important; margin: 4em auto 0 auto; max-width: 50em; width: 70%; text-align: center; position: fixed;  z-index: 10000; top: 0; left: 0; right: 0; }
   .obsolete a { color: blue ! important; }
   .obsolete p { font: 900 2em sans-serif; color: red ! important; margin: 1em 1.5em ! important; }
  </style>
  <div class=obsolete>
   <p>This is a snapshot of an early working draft and has therefore
   been superseded by the <a href="http://whatwg.org/html">HTML
   standard</a>.</p>
   <p>This document will not be further updated.</p>
  </div>
<div class="head">
   <p><a href="http://www.whatwg.org/" class="logo" rel="home"><img src="/images/logo" alt="WHATWG"></a></p>

   <h1 id="html-5">HTML 5</h1>

   <h2 id="working" class="no-num no-toc">Call For Comments — 27 October 2007</h2></div><nav id="nav-bar"><a href="section-parsing.html#nav-bar">&lt; 8.2. Parsing HTML documents</a> – <a href="index.html#contents">Table of contents</a> – <a href="section-tree-construction.html#nav-bar">8.2.4. Tree construction &gt;</a></nav><h4 id="tokenisation"><span class="secno">8.2.3. </span><dfn id="tokenisation0">Tokenisation</dfn></h4>

  <p>Implementations must act as if they used the following state machine to
   tokenise HTML. The state machine must start in the <a href="#data-state">data state</a>. Most states consume a single character,
   which may have various side-effects, and either switches the state machine
   to a new state to <em>reconsume</em> the same character, or switches it to
   a new state (to consume the next character), or repeats the same state (to
   consume the next character). Some states have more complicated behaviour
   and can consume several characters before switching to another state.

  </p><p>The exact behaviour of certain states depends on a <dfn id="content2">content model flag</dfn> that is set after certain tokens are
   emitted. The flag has several states: <em title="">PCDATA</em>, <em title="">RCDATA</em>, <em title="">CDATA</em>, and <em title="">PLAINTEXT</em>. Initially it must be in the PCDATA state. In the
   RCDATA and CDATA states, a further <dfn id="escape">escape flag</dfn> is
   used to control the behaviour of the tokeniser. It is either true or
   false, and initially must be set to the false state.

  </p><p>The output of the tokenisation step is a series of zero or more of the
   following tokens: DOCTYPE, start tag, end tag, comment, character,
   end-of-file. DOCTYPE tokens have a name, a public identifier, a system
   identifier, and a correctness flag. When a DOCTYPE token is created, its
   name, public identifier, and system identifier must be marked as missing,
   and the correctness flag must be set to <i>correct</i> (its other state is
   <i>incorrect</i>). Start and end tag tokens have a tag name and a list of
   attributes, each of which has a name and a value. Comment and character
   tokens have data.

  </p><p>When a token is emitted, it must immediately be handled by the <a href="section-tree-construction.html#tree-construction0">tree construction</a> stage. The tree
   construction stage can affect the state of the <a href="#content2">content
   model flag</a>, and can insert additional characters into the stream. (For
   example, the <code><a href="section-scripting0.html#script0">script</a></code> element can result
   in scripts executing and using the <a href="section-dynamic.html#dynamic2">dynamic markup
   insertion</a> APIs to insert characters into the stream being tokenised.)

  </p><p>When an end tag token is emitted, the <a href="#content2">content model
   flag</a> must be switched to the PCDATA state.

  </p><p>When an end tag token is emitted with attributes, that is a <a href="section-parsing.html#parse0">parse error</a>.

  </p><p>A <dfn id="permitted">permitted slash</dfn> is a U+002F SOLIDUS character
   that is immediately followed by a U+003E GREATER-THAN SIGN, if, and only
   if, the current token being processed is a start tag token whose tag name
   is one of the following: <code><a href="section-document.html#base">base</a></code>, <code><a href="section-document.html#link">link</a></code>, <code><a href="section-document.html#meta0">meta</a></code>,
   <code><a href="section-prose.html#hr">hr</a></code>, <code><a href="section-prose.html#br">br</a></code>,
   <code><a href="section-embedded.html#img">img</a></code>, <code><a href="section-embedded.html#embed">embed</a></code>, <code><a href="section-embedded.html#param">param</a></code>,
   <code><a href="section-the-canvas.html#area">area</a></code>, <code><a href="section-tabular.html#col">col</a></code>, <code>input</code><!-- XXX add:
  , <code>command</code>, <code>event-source</code> --></p>
  <!-- XXX
  keep this synchronised with the list of "void elements" -->

  <p>Before each step of the tokeniser, the user agent may check to see if
   either one of the scripts in the <a href="section-scripting0.html#list-of1">list of scripts that
   will execute as soon as possible</a> or the first script in the <a href="section-scripting0.html#list-of0">list of scripts that will execute asynchronously</a>, has
   <span>completed loading</span><!-- XXX xref -->. If one has, then it must
   be <a href="section-scripting0.html#executing0" title="executing a script block">executed</a> and
   removed from its list.

  </p><p>The tokeniser state machine is as follows:

  </p><dl>
   <dt><dfn id="data-state">Data state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0026 AMPERSAND (&amp;)

     </dt><dd>When the <a href="#content2">content model flag</a> is set to one of
      the PCDATA or RCDATA states: switch to the <a href="#entity">entity
      data state</a>.

     </dd><dd>Otherwise: treat it as per the &quot;anything else&quot; entry below.

     </dd><dt>U+002D HYPHEN-MINUS (-)

     </dt><dd>
      <p>If the <a href="#content2">content model flag</a> is set to either
       the RCDATA state or the CDATA state, and the <a href="#escape">escape
       flag</a> is false, and there are at least three characters before this
       one in the input stream, and the last four characters in the input
       stream, including this one, are U+003C LESS-THAN SIGN, U+0021
       EXCLAMATION MARK, U+002D HYPHEN-MINUS, and U+002D HYPHEN-MINUS
       (&quot;&lt;!--&quot;), then set the <a href="#escape">escape flag</a> to true.</p>

      <p>In any case, emit the input character as a character token. Stay in
       the <a href="#data-state">data state</a>.</p>

     </dd><dt>U+003C LESS-THAN SIGN (&lt;)

     </dt><dd>When the <a href="#content2">content model flag</a> is set to the
      PCDATA state: switch to the <a href="#tag-open">tag open state</a>.

     </dd><dd>When the <a href="#content2">content model flag</a> is set to either
      the RCDATA state or the CDATA state and the <a href="#escape">escape
      flag</a> is false: switch to the <a href="#tag-open">tag open
      state</a>.

     </dd><dd>Otherwise: treat it as per the &quot;anything else&quot; entry below.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>
      <p>If the <a href="#content2">content model flag</a> is set to either
       the RCDATA state or the CDATA state, and the <a href="#escape">escape
       flag</a> is true, and the last three characters in the input stream
       including this one are U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS,
       U+003E GREATER-THAN SIGN (&quot;--&gt;&quot;), set the <a href="#escape">escape
       flag</a> to false.</p>
      <!-- no need to check
      that there are enough characters, since you can only run into
      this if the flag is true in the first place, which requires four
      characters. -->
      
      <p>In any case, emit the input character as a character token. Stay in
       the <a href="#data-state">data state</a>.</p>

     </dd><dt>EOF

     </dt><dd>Emit an end-of-file token.

     </dd><dt>Anything else

     </dt><dd>Emit the input character as a character token. Stay in the <a href="#data-state">data state</a>.
    </dd></dl>

   </dd><dt><dfn id="entity">Entity data state</dfn>

   </dt><dd>
    <p><em>(This cannot happen if the <a href="#content2">content model
     flag</a> is set to the CDATA state.)</em></p>

    <p>Attempt to <a href="#consume">consume an entity</a>.</p>

    <p>If nothing is returned, emit a U+0026 AMPERSAND character token.</p>

    <p>Otherwise, emit the character token that was returned.</p>

    <p>Finally, switch to the <a href="#data-state">data state</a>.</p>

   </dd><dt><dfn id="tag-open">Tag open state</dfn>

   </dt><dd>
    <p>The behaviour of this state depends on the <a href="#content2">content
     model flag</a>.</p>

    <dl>
     <dt>If the <a href="#content2">content model flag</a> is set to the
      RCDATA or CDATA states

     </dt><dd>
      <p>Consume the <a href="section-parsing.html#next-input">next input character</a>. If it is
       a U+002F SOLIDUS (/) character, switch to the <a href="#close1">close
       tag open state</a>. Otherwise, emit a U+003C LESS-THAN SIGN character
       token and reconsume the current input character in the <a href="#data-state">data state</a>.</p>

     </dd><dt>If the <a href="#content2">content model flag</a> is set to the
      PCDATA state

     </dt><dd>
      <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

      <dl class="switch">
       <dt>U+0021 EXCLAMATION MARK (!)

       </dt><dd>Switch to the <a href="#markup">markup declaration open state</a>.

       </dd><dt>U+002F SOLIDUS (/)

       </dt><dd>Switch to the <a href="#close1">close tag open state</a>.

       </dd><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL
        LETTER Z

       </dt><dd>Create a new start tag token, set its tag name to the lowercase
        version of the input character (add 0x0020 to the character's code
        point), then switch to the <a href="#tag-name0">tag name state</a>.
        (Don't emit the token yet; further details will be filled in before
        it is emitted.)

       </dd><dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z

       </dt><dd>Create a new start tag token, set its tag name to the input
        character, then switch to the <a href="#tag-name0">tag name
        state</a>. (Don't emit the token yet; further details will be filled
        in before it is emitted.)

       </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

       </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit a U+003C LESS-THAN SIGN
        character token and a U+003E GREATER-THAN SIGN character token.
        Switch to the <a href="#data-state">data state</a>.

       </dd><dt>U+003F QUESTION MARK (?)

       </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Switch to the <a href="#bogus">bogus comment state</a>.

       </dd><dt>Anything else

       </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit a U+003C LESS-THAN SIGN
        character token and reconsume the current input character in the <a href="#data-state">data state</a>.
      </dd></dl>
    </dd></dl>

   </dd><dt><dfn id="close1">Close tag open state</dfn>

   </dt><dd>
    <p>If the <a href="#content2">content model flag</a> is set to the RCDATA
     or CDATA states but no start tag token has ever been emitted by this
     instance of the tokeniser (<a href="section-parsing2.html#fragment">fragment case</a>), or,
     if the <a href="#content2">content model flag</a> is set to the RCDATA
     or CDATA states and the next few characters do not match the tag name of
     the last start tag token emitted (case insensitively), or if they do but
     they are not immediately followed by one of the following characters:</p>

    <ul class="brief">
     <li>U+0009 CHARACTER TABULATION

     </li><li>U+000A LINE FEED (LF)

     </li><li>U+000B LINE TABULATION

     </li><li>U+000C FORM FEED (FF)</li>
     <!--<li>U+000D CARRIAGE RETURN (CR)</li>-->

     <li>U+0020 SPACE

     </li><li>U+003E GREATER-THAN SIGN (&gt;)

     </li><li>U+002F SOLIDUS (/)

     </li><li>EOF
    </li></ul>

    <p>...then emit a U+003C LESS-THAN SIGN character token, a U+002F SOLIDUS
     character token, and switch to the <a href="#data-state">data state</a>
     to process the <a href="section-parsing.html#next-input">next input character</a>.</p>

    <p>Otherwise, if the <a href="#content2">content model flag</a> is set to
     the PCDATA state, or if the next few characters <em>do</em> match that
     tag name, consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER
      Z

     </dt><dd>Create a new end tag token, set its tag name to the lowercase
      version of the input character (add 0x0020 to the character's code
      point), then switch to the <a href="#tag-name0">tag name state</a>.
      (Don't emit the token yet; further details will be filled in before it
      is emitted.)

     </dd><dt>U+0061 LATIN SMALL LETTER A through to U+007A LATIN SMALL LETTER Z

     </dt><dd>Create a new end tag token, set its tag name to the input character,
      then switch to the <a href="#tag-name0">tag name state</a>. (Don't emit
      the token yet; further details will be filled in before it is emitted.)

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Switch to the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit a U+003C LESS-THAN SIGN
      character token and a U+002F SOLIDUS character token. Reconsume the EOF
      character in the <a href="#data-state">data state</a>.

     </dd><dt>Anything else

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Switch to the <a href="#bogus">bogus comment state</a>.
    </dd></dl>

   </dd><dt><dfn id="tag-name0">Tag name state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Switch to the <a href="#before">before attribute name state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current tag token. Switch to the <a href="#data-state">data
      state</a>.

     </dd><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER
      Z

     </dt><dd>Append the lowercase version of the current input character (add
      0x0020 to the character's code point) to the current tag token's tag
      name. Stay in the <a href="#tag-name0">tag name state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the current tag token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>U+002F SOLIDUS (/)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a> unless this is a <a href="#permitted">permitted slash</a>. Switch to the <a href="#before">before attribute name state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current tag token's tag
      name. Stay in the <a href="#tag-name0">tag name state</a>.
    </dd></dl>

   </dd><dt><dfn id="before">Before attribute name state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#before">before attribute name state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current tag token. Switch to the <a href="#data-state">data
      state</a>.

     </dd><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER
      Z

     </dt><dd>Start a new attribute in the current tag token. Set that attribute's
      name to the lowercase version of the current input character (add
      0x0020 to the character's code point), and its value to the empty
      string. Switch to the <a href="#attribute1">attribute name state</a>.

     </dd><dt>U+002F SOLIDUS (/)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a> unless this is a <a href="#permitted">permitted slash</a>. Stay in the <a href="#before">before attribute name state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the current tag token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Start a new attribute in the current tag token. Set that attribute's
      name to the current input character, and its value to the empty string.
      Switch to the <a href="#attribute1">attribute name state</a>.
    </dd></dl>

   </dd><dt><dfn id="attribute1">Attribute name state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Switch to the <a href="#after">after attribute name state</a>.

     </dd><dt>U+003D EQUALS SIGN (=)

     </dt><dd>Switch to the <a href="#before0">before attribute value state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current tag token. Switch to the <a href="#data-state">data
      state</a>.

     </dd><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER
      Z

     </dt><dd>Append the lowercase version of the current input character (add
      0x0020 to the character's code point) to the current attribute's name.
      Stay in the <a href="#attribute1">attribute name state</a>.

     </dd><dt>U+002F SOLIDUS (/)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a> unless this is a <a href="#permitted">permitted slash</a>. Switch to the <a href="#before">before attribute name state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the current tag token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current attribute's name.
      Stay in the <a href="#attribute1">attribute name state</a>.
    </dd></dl>

    <p>When the user agent leaves the attribute name state (and before
     emitting the tag token, if appropriate), the complete attribute's name
     must be compared to the other attributes on the same token; if there is
     already an attribute on the token with the exact same name, then this is
     a <a href="section-parsing.html#parse0">parse error</a> and the new attribute must be
     dropped, along with the value that gets associated with it (if any).</p>

   </dd><dt><dfn id="after">After attribute name state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#after">after attribute name state</a>.

     </dd><dt>U+003D EQUALS SIGN (=)

     </dt><dd>Switch to the <a href="#before0">before attribute value state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current tag token. Switch to the <a href="#data-state">data
      state</a>.

     </dd><dt>U+0041 LATIN CAPITAL LETTER A through to U+005A LATIN CAPITAL LETTER
      Z

     </dt><dd>Start a new attribute in the current tag token. Set that attribute's
      name to the lowercase version of the current input character (add
      0x0020 to the character's code point), and its value to the empty
      string. Switch to the <a href="#attribute1">attribute name state</a>.

     </dd><dt>U+002F SOLIDUS (/)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a> unless this is a <a href="#permitted">permitted slash</a>. Switch to the <a href="#before">before attribute name state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the current tag token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Start a new attribute in the current tag token. Set that attribute's
      name to the current input character, and its value to the empty string.
      Switch to the <a href="#attribute1">attribute name state</a>.
    </dd></dl>

   </dd><dt><dfn id="before0">Before attribute value state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#before0">before attribute value state</a>.

     </dd><dt>U+0022 QUOTATION MARK (&quot;)

     </dt><dd>Switch to the <a href="#attribute2">attribute value (double-quoted)
      state</a>.

     </dd><dt>U+0026 AMPERSAND (&amp;)

     </dt><dd>Switch to the <a href="#attribute4">attribute value (unquoted)
      state</a> and reconsume this input character.

     </dd><dt>U+0027 APOSTROPHE (')

     </dt><dd>Switch to the <a href="#attribute3">attribute value (single-quoted)
      state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current tag token. Switch to the <a href="#data-state">data
      state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the current tag token.
      Reconsume the character in the <a href="#data-state">data state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current attribute's value.
      Switch to the <a href="#attribute4">attribute value (unquoted)
      state</a>.
    </dd></dl>

   </dd><dt><dfn id="attribute2">Attribute value (double-quoted) state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0022 QUOTATION MARK (&quot;)

     </dt><dd>Switch to the <a href="#before">before attribute name state</a>.

     </dd><dt>U+0026 AMPERSAND (&amp;)

     </dt><dd>Switch to the <a href="#entity0">entity in attribute value
      state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the current tag token.
      Reconsume the character in the <a href="#data-state">data state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current attribute's value.
      Stay in the <a href="#attribute2">attribute value (double-quoted)
      state</a>.
    </dd></dl>

   </dd><dt><dfn id="attribute3">Attribute value (single-quoted) state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0027 APOSTROPHE (')

     </dt><dd>Switch to the <a href="#before">before attribute name state</a>.

     </dd><dt>U+0026 AMPERSAND (&amp;)

     </dt><dd>Switch to the <a href="#entity0">entity in attribute value
      state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the current tag token.
      Reconsume the character in the <a href="#data-state">data state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current attribute's value.
      Stay in the <a href="#attribute3">attribute value (single-quoted)
      state</a>.
    </dd></dl>

   </dd><dt><dfn id="attribute4">Attribute value (unquoted) state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Switch to the <a href="#before">before attribute name state</a>.

     </dd><dt>U+0026 AMPERSAND (&amp;)

     </dt><dd>Switch to the <a href="#entity0">entity in attribute value
      state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current tag token. Switch to the <a href="#data-state">data
      state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the current tag token.
      Reconsume the character in the <a href="#data-state">data state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current attribute's value.
      Stay in the <a href="#attribute4">attribute value (unquoted) state</a>.
    </dd></dl>

   </dd><dt><dfn id="entity0">Entity in attribute value state</dfn>

   </dt><dd>
    <p>Attempt to <a href="#consume">consume an entity</a>.</p>

    <p>If nothing is returned, append a U+0026 AMPERSAND character to the
     current attribute's value.</p>

    <p>Otherwise, append the returned character token to the current
     attribute's value.</p>

    <p>Finally, switch back to the attribute value state that you were in
     when were switched into this state.</p>

   </dd><dt><dfn id="bogus">Bogus comment state</dfn>

   </dt><dd>
    <p><em>(This can only happen if the <a href="#content2">content model
     flag</a> is set to the PCDATA state.)</em></p>

    <p>Consume every character up to the first U+003E GREATER-THAN SIGN
     character (&gt;) or the end of the file (EOF), whichever comes first.
     Emit a comment token whose data is the concatenation of all the
     characters starting from and including the character that caused the
     state machine to switch into the bogus comment state, up to and
     including the last consumed character before the U+003E character, if
     any, or up to the end of the file otherwise. (If the comment was started
     by the end of the file (EOF), the token is empty.)</p>

    <p>Switch to the <a href="#data-state">data state</a>.</p>

    <p>If the end of the file was reached, reconsume the EOF character.</p>

   </dd><dt><dfn id="markup">Markup declaration open state</dfn>

   </dt><dd>
    <p><em>(This can only happen if the <a href="#content2">content model
     flag</a> is set to the PCDATA state.)</em></p>

    <p>If the next two characters are both U+002D HYPHEN-MINUS (-)
     characters, consume those two characters, create a comment token whose
     data is the empty string, and switch to the <a href="#comment0">comment
     start state</a>.</p>

    <p>Otherwise if the next seven characters are a
     <span>case-insensitive</span><!-- XXX xref, ascii only --> match for the
     word &quot;DOCTYPE&quot;, then consume those characters and switch to the <a href="#doctype0">DOCTYPE state</a>.</p>

    <p>Otherwise, is is a <a href="section-parsing.html#parse0">parse error</a>. Switch to the <a href="#bogus">bogus comment state</a>. The next character that is
     consumed, if any, is the first character that will be in the comment.</p>

   </dd><dt><dfn id="comment0">Comment start state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+002D HYPHEN-MINUS (-)

     </dt><dd>Switch to the <a href="#comment1">comment start dash state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the comment token. Switch to
      the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the comment token. Reconsume
      the EOF character in the <a href="#data-state">data state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the input character to the comment token's data. Switch to
      the <a href="#comment">comment state</a>.
    </dd></dl>

   </dd><dt><dfn id="comment1">Comment start dash state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+002D HYPHEN-MINUS (-)

     </dt><dd>Switch to the <a href="#comment3">comment end state</a>

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the comment token. Switch to
      the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the comment token. Reconsume
      the EOF character in the <a href="#data-state">data state</a>.

     </dd><dt>Anything else

     </dt><dd>Append a U+002D HYPHEN-MINUS (-) character and the input character
      to the comment token's data. Switch to the <a href="#comment">comment
      state</a>.
    </dd></dl>

   </dd><dt><dfn id="comment">Comment state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+002D HYPHEN-MINUS (-)

     </dt><dd>Switch to the <a href="#comment2">comment end dash state</a>

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the comment token. Reconsume
      the EOF character in the <a href="#data-state">data state</a>.</dd>
     <!-- For
     security reasons: otherwise, hostile user could put a <script> in
     a comment e.g. in a blog comment and then DOS the server so that
     the end tag isn't read, and then the commented <script> tag would
     be treated as live code -->

     <dt>Anything else

     </dt><dd>Append the input character to the comment token's data. Stay in the
      <a href="#comment">comment state</a>.
    </dd></dl>

   </dd><dt><dfn id="comment2">Comment end dash state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+002D HYPHEN-MINUS (-)

     </dt><dd>Switch to the <a href="#comment3">comment end state</a>

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the comment token. Reconsume
      the EOF character in the <a href="#data-state">data state</a>.</dd>
     <!-- For
     security reasons: otherwise, hostile user could put a <script> in
     a comment e.g. in a blog comment and then DOS the server so that
     the end tag isn't read, and then the commented <script> tag would
     be treated as live code -->

     <dt>Anything else

     </dt><dd>Append a U+002D HYPHEN-MINUS (-) character and the input character
      to the comment token's data. Switch to the <a href="#comment">comment
      state</a>.
    </dd></dl>

   </dd><dt><dfn id="comment3">Comment end state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the comment token. Switch to the <a href="#data-state">data
      state</a>.

     </dd><dt>U+002D HYPHEN-MINUS (-)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Append a U+002D HYPHEN-MINUS (-)
      character to the comment token's data. Stay in the <a href="#comment3">comment end state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Emit the comment token. Reconsume
      the EOF character in the <a href="#data-state">data state</a>.</dd>
     <!-- For
     security reasons: otherwise, hostile user could put a <script> in
     a comment e.g. in a blog comment and then DOS the server so that
     the end tag isn't read, and then the commented <script> tag would
     be treated as live code -->

     <dt>Anything else

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Append two U+002D HYPHEN-MINUS
      (-) characters and the input character to the comment token's data.
      Switch to the <a href="#comment">comment state</a>.
    </dd></dl>

   </dd><dt><dfn id="doctype0">DOCTYPE state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Switch to the <a href="#before1">before DOCTYPE name state</a>.

     </dd><dt>Anything else

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Reconsume the current character
      in the <a href="#before1">before DOCTYPE name state</a>.
    </dd></dl>

   </dd><dt><dfn id="before1">Before DOCTYPE name state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#before1">before DOCTYPE name state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Create a new DOCTYPE token. Set
      its correctness flag to <i>incorrect</i>. Emit the token. Switch to the
      <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Create a new DOCTYPE token. Set
      its correctness flag to <i>incorrect</i>. Emit the token. Reconsume the
      EOF character in the <a href="#data-state">data state</a>.

     </dd><dt>Anything else

     </dt><dd>Create a new DOCTYPE token. Set the token's name name to the current
      input character. Switch to the <a href="#doctype1">DOCTYPE name
      state</a>.
    </dd></dl>

   </dd><dt><dfn id="doctype1">DOCTYPE name state</dfn>

   </dt><dd>
    <p>First, consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Switch to the <a href="#after0">after DOCTYPE name state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current DOCTYPE token's
      name. Stay in the <a href="#doctype1">DOCTYPE name state</a>.
    </dd></dl>

   </dd><dt><dfn id="after0">After DOCTYPE name state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#after0">after DOCTYPE name state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>
      <p>If the next six characters are a
       <span>case-insensitive</span><!-- XXX xref, ascii only --> match for
       the word &quot;PUBLIC&quot;, then consume those characters and switch to the <a href="#before2">before DOCTYPE public identifier state</a>.</p>

      <p>Otherwise, if the next six characters are a
       <span>case-insensitive</span><!-- XXX xref, ascii only --> match for
       the word &quot;SYSTEM&quot;, then consume those characters and switch to the <a href="#before3">before DOCTYPE system identifier state</a>.</p>

      <p>Otherwise, this is the <a href="section-parsing.html#parse0">parse error</a>. Switch to
       the <a href="#bogus0">bogus DOCTYPE state</a>.</p>
    </dd></dl>

   </dd><dt><dfn id="before2">Before DOCTYPE public identifier state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#before2">before DOCTYPE public identifier
      state</a>.

     </dd><dt>U+0022 QUOTATION MARK (&quot;)

     </dt><dd>Set the DOCTYPE token's public identifier to the empty string, then
      switch to the <a href="#doctype2">DOCTYPE public identifier
      (double-quoted) state</a>.

     </dd><dt>U+0027 APOSTROPHE (')

     </dt><dd>Set the DOCTYPE token's public identifier to the empty string, then
      switch to the <a href="#doctype3">DOCTYPE public identifier
      (single-quoted) state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token. Switch
      to the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Switch to the <a href="#bogus0">bogus DOCTYPE state</a>.
    </dd></dl>

   </dd><dt><dfn id="doctype2">DOCTYPE public identifier (double-quoted) state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0022 QUOTATION MARK (&quot;)

     </dt><dd>Switch to the <a href="#after1">after DOCTYPE public identifier
      state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current DOCTYPE token's
      public identifier. Stay in the <a href="#doctype2">DOCTYPE public
      identifier (double-quoted) state</a>.
    </dd></dl>

   </dd><dt><dfn id="doctype3">DOCTYPE public identifier (single-quoted) state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0027 APOSTROPHE (')

     </dt><dd>Switch to the <a href="#after1">after DOCTYPE public identifier
      state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current DOCTYPE token's
      public identifier. Stay in the <a href="#doctype3">DOCTYPE public
      identifier (single-quoted) state</a>.
    </dd></dl>

   </dd><dt><dfn id="after1">After DOCTYPE public identifier state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#after1">after DOCTYPE public identifier
      state</a>.

     </dd><dt>U+0022 QUOTATION MARK (&quot;)

     </dt><dd>Set the DOCTYPE token's system identifier to the empty string, then
      switch to the <a href="#doctype4">DOCTYPE system identifier
      (double-quoted) state</a>.

     </dd><dt>U+0027 APOSTROPHE (')

     </dt><dd>Set the DOCTYPE token's system identifier to the empty string, then
      switch to the <a href="#doctype5">DOCTYPE system identifier
      (single-quoted) state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Switch to the <a href="#bogus0">bogus DOCTYPE state</a>.
    </dd></dl>

   </dd><dt><dfn id="before3">Before DOCTYPE system identifier state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#before3">before DOCTYPE system identifier
      state</a>.

     </dd><dt>U+0022 QUOTATION MARK (&quot;)

     </dt><dd>Set the DOCTYPE token's system identifier to the empty string, then
      switch to the <a href="#doctype4">DOCTYPE system identifier
      (double-quoted) state</a>.

     </dd><dt>U+0027 APOSTROPHE (')

     </dt><dd>Set the DOCTYPE token's system identifier to the empty string, then
      switch to the <a href="#doctype5">DOCTYPE system identifier
      (single-quoted) state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token. Switch
      to the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Switch to the <a href="#bogus0">bogus DOCTYPE state</a>.
    </dd></dl>

   </dd><dt><dfn id="doctype4">DOCTYPE system identifier (double-quoted) state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0022 QUOTATION MARK (&quot;)

     </dt><dd>Switch to the <a href="#after2">after DOCTYPE system identifier
      state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current DOCTYPE token's
      system identifier. Stay in the <a href="#doctype4">DOCTYPE system
      identifier (double-quoted) state</a>.
    </dd></dl>

   </dd><dt><dfn id="doctype5">DOCTYPE system identifier (single-quoted) state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0027 APOSTROPHE (')

     </dt><dd>Switch to the <a href="#after2">after DOCTYPE system identifier
      state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Append the current input character to the current DOCTYPE token's
      system identifier. Stay in the <a href="#doctype5">DOCTYPE system
      identifier (single-quoted) state</a>.
    </dd></dl>

   </dd><dt><dfn id="after2">After DOCTYPE system identifier state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+0009 CHARACTER TABULATION

     </dt><dt>U+000A LINE FEED (LF)

     </dt><dt>U+000B LINE TABULATION

     </dt><dt>U+000C FORM FEED (FF)</dt>
     <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

     <dt>U+0020 SPACE

     </dt><dd>Stay in the <a href="#after2">after DOCTYPE system identifier
      state</a>.

     </dd><dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Emit the current DOCTYPE token. Switch to the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Switch to the <a href="#bogus0">bogus DOCTYPE state</a>.
    </dd></dl>

   </dd><dt><dfn id="bogus0">Bogus DOCTYPE state</dfn>

   </dt><dd>
    <p>Consume the <a href="section-parsing.html#next-input">next input character</a>:</p>

    <dl class="switch">
     <dt>U+003E GREATER-THAN SIGN (&gt;)

     </dt><dd>Set the DOCTYPE token's correctness flag to <i>incorrect</i>. Emit
      that DOCTYPE token. Switch to the <a href="#data-state">data state</a>.

     </dd><dt>EOF

     </dt><dd><a href="section-parsing.html#parse0">Parse error</a>. Set the DOCTYPE token's
      correctness flag to <i>incorrect</i>. Emit that DOCTYPE token.
      Reconsume the EOF character in the <a href="#data-state">data
      state</a>.

     </dd><dt>Anything else

     </dt><dd>Stay in the <a href="#bogus0">bogus DOCTYPE state</a>.
    </dd></dl>
  </dd></dl>

  <h5 id="tokenising"><span class="secno">8.2.3.1. </span>Tokenising entities</h5>

  <p>This section defines how to <dfn id="consume">consume an entity</dfn>.
   This definition is used when parsing entities <a href="#entity" title="entity data state">in text</a> and <a href="#entity0" title="entity
   in attribute value state">in attributes</a>.

  </p><p>The behaviour depends on the identity of the next character (the one
   immediately after the U+0026 AMPERSAND character):

  </p><dl class="switch">
   <dt>U+0009 CHARACTER TABULATION

   </dt><dt>U+000A LINE FEED (LF)

   </dt><dt>U+000B LINE TABULATION

   </dt><dt>U+000C FORM FEED (FF)</dt>
   <!--<dt>U+000D CARRIAGE RETURN (CR)</dt>-->

   <dt>U+0020 SPACE

   </dt><dt>U+003C LESS-THAN SIGN

   </dt><dt>U+0026 AMPERSAND

   </dt><dt>EOF

   </dt><dd>Not an entity. No characters are consumed, and nothing is returned.
    (This is not an error, either.)

   </dd><dt>U+0023 NUMBER SIGN (#)

   </dt><dd>
    <p>Consume the U+0023 NUMBER SIGN.</p>

    <p>The behaviour further depends on the character after the U+0023 NUMBER
     SIGN:</p>

    <dl class="switch">
     <dt>U+0078 LATIN SMALL LETTER X

     </dt><dt>U+0058 LATIN CAPITAL LETTER X

     </dt><dd>
      <p>Consume the X.</p>

      <p>Follow the steps below, but using the range of characters U+0030
       DIGIT ZERO through to U+0039 DIGIT NINE, U+0061 LATIN SMALL LETTER A
       through to U+0066 LATIN SMALL LETTER F, and U+0041 LATIN CAPITAL
       LETTER A, through to U+0046 LATIN CAPITAL LETTER F (in other words,
       0-9, A-F, a-f).</p>

      <p>When it comes to interpreting the number, interpret it as a
       hexadecimal number.</p>

     </dd><dt>Anything else

     </dt><dd>
      <p>Follow the steps below, but using the range of characters U+0030
       DIGIT ZERO through to U+0039 DIGIT NINE (i.e. just 0-9).</p>

      <p>When it comes to interpreting the number, interpret it as a decimal
       number.</p>
    </dd></dl>

    <p>Consume as many characters as match the range of characters given
     above.</p>

    <p>If no characters match the range, then don't consume any characters
     (and unconsume the U+0023 NUMBER SIGN character and, if appropriate, the
     X character). This is a <a href="section-parsing.html#parse0">parse error</a>; nothing is
     returned.</p>

    <p>Otherwise, if the next character is a U+003B SEMICOLON, consume that
     too. If it isn't, there is a <a href="section-parsing.html#parse0">parse error</a>.</p>

    <p>If one or more characters match the range, then take them all and
     interpret the string of characters as a number (either hexadecimal or
     decimal as appropriate).</p>

    <p>If that number is one of the numbers in the first column of the
     following table, then this is a <a href="section-parsing.html#parse0">parse error</a>. Find
     the row with that number in the first column, and return a character
     token for the Unicode character given in the second column of that row.</p>

    <table>
     <thead>
      <tr>
       <th>Number

       </th><th colspan="2">Unicode character

     </th></tr></thead><tbody>
      <tr>
       <td>0x0D

       </td><td>U+000A

       </td><td>LINE FEED (LF)

      </td></tr><tr>
       <td>0x80

       </td><td>U+20AC

       </td><td>EURO SIGN ('€')

      </td></tr><tr>
       <td>0x81

       </td><td>U+FFFD

       </td><td>REPLACEMENT CHARACTER

      </td></tr><tr>
       <td>0x82

       </td><td>U+201A

       </td><td>SINGLE LOW-9 QUOTATION MARK ('‚')

      </td></tr><tr>
       <td>0x83

       </td><td>U+0192

       </td><td>LATIN SMALL LETTER F WITH HOOK ('ƒ')

      </td></tr><tr>
       <td>0x84

       </td><td>U+201E

       </td><td>DOUBLE LOW-9 QUOTATION MARK ('„')

      </td></tr><tr>
       <td>0x85

       </td><td>U+2026

       </td><td>HORIZONTAL ELLIPSIS ('…')

      </td></tr><tr>
       <td>0x86

       </td><td>U+2020

       </td><td>DAGGER ('†')

      </td></tr><tr>
       <td>0x87

       </td><td>U+2021

       </td><td>DOUBLE DAGGER ('‡')

      </td></tr><tr>
       <td>0x88

       </td><td>U+02C6

       </td><td>MODIFIER LETTER CIRCUMFLEX ACCENT ('ˆ')

      </td></tr><tr>
       <td>0x89

       </td><td>U+2030

       </td><td>PER MILLE SIGN ('‰')

      </td></tr><tr>
       <td>0x8A

       </td><td>U+0160

       </td><td>LATIN CAPITAL LETTER S WITH CARON ('Š')

      </td></tr><tr>
       <td>0x8B

       </td><td>U+2039

       </td><td>SINGLE LEFT-POINTING ANGLE QUOTATION MARK ('‹')

      </td></tr><tr>
       <td>0x8C

       </td><td>U+0152

       </td><td>LATIN CAPITAL LIGATURE OE ('Œ')

      </td></tr><tr>
       <td>0x8D

       </td><td>U+FFFD

       </td><td>REPLACEMENT CHARACTER

      </td></tr><tr>
       <td>0x8E

       </td><td>U+017D

       </td><td>LATIN CAPITAL LETTER Z WITH CARON ('Ž')

      </td></tr><tr>
       <td>0x8F

       </td><td>U+FFFD

       </td><td>REPLACEMENT CHARACTER

      </td></tr><tr>
       <td>0x90

       </td><td>U+FFFD

       </td><td>REPLACEMENT CHARACTER

      </td></tr><tr>
       <td>0x91

       </td><td>U+2018

       </td><td>LEFT SINGLE QUOTATION MARK ('‘')

      </td></tr><tr>
       <td>0x92

       </td><td>U+2019

       </td><td>RIGHT SINGLE QUOTATION MARK ('’')

      </td></tr><tr>
       <td>0x93

       </td><td>U+201C

       </td><td>LEFT DOUBLE QUOTATION MARK ('“')

      </td></tr><tr>
       <td>0x94

       </td><td>U+201D

       </td><td>RIGHT DOUBLE QUOTATION MARK ('”')

      </td></tr><tr>
       <td>0x95

       </td><td>U+2022

       </td><td>BULLET ('•')

      </td></tr><tr>
       <td>0x96

       </td><td>U+2013

       </td><td>EN DASH ('–')

      </td></tr><tr>
       <td>0x97

       </td><td>U+2014

       </td><td>EM DASH ('—')

      </td></tr><tr>
       <td>0x98

       </td><td>U+02DC

       </td><td>SMALL TILDE ('˜')

      </td></tr><tr>
       <td>0x99

       </td><td>U+2122

       </td><td>TRADE MARK SIGN ('™')

      </td></tr><tr>
       <td>0x9A

       </td><td>U+0161

       </td><td>LATIN SMALL LETTER S WITH CARON ('š')

      </td></tr><tr>
       <td>0x9B

       </td><td>U+203A

       </td><td>SINGLE RIGHT-POINTING ANGLE QUOTATION MARK ('›')

      </td></tr><tr>
       <td>0x9C

       </td><td>U+0153

       </td><td>LATIN SMALL LIGATURE OE ('œ')

      </td></tr><tr>
       <td>0x9D

       </td><td>U+FFFD

       </td><td>REPLACEMENT CHARACTER

      </td></tr><tr>
       <td>0x9E

       </td><td>U+017E

       </td><td>LATIN SMALL LETTER Z WITH CARON ('ž')

      </td></tr><tr>
       <td>0x9F

       </td><td>U+0178

       </td><td>LATIN CAPITAL LETTER Y WITH DIAERESIS ('Ÿ')
    </td></tr></tbody></table>

    <p>Otherwise, if the number is zero, if the number is higher than
     0x10FFFF, or if it's one of the surrogate characters (characters in the
     range 0xD800 to 0xDFFF), then this is a <a href="section-parsing.html#parse0">parse
     error</a>; return a character token for the U+FFFD REPLACEMENT CHARACTER
     character instead.</p>

    <p>Otherwise, return a character token for the Unicode character whose
     code point is that number.</p>

   </dd><dt>Anything else

   </dt><dd>
    <p>Consume the maximum number of characters possible, with the consumed
     characters case-sensitively matching one of the identifiers in the first
     column of the <a href="section-entities.html#entities0">entities</a> table.</p>

    <p>If no match can be made, then this is a <a href="section-parsing.html#parse0">parse
     error</a>. No characters are consumed, and nothing is returned.</p>

    <p>If the last character matched is not a U+003B SEMICOLON (<code title="">;</code>), there is a <a href="section-parsing.html#parse0">parse error</a>.</p>

    <p>If the entity is being consumed <a href="#entity0" title="entity in
     attribute value state">as part of an attribute</a>, and the last
     character matched is not a U+003B SEMICOLON (<code title="">;</code>),
     and the next character is in the range U+0030 DIGIT ZERO to U+0039 DIGIT
     NINE, U+0041 LATIN CAPITAL LETTER A to U+005A LATIN CAPITAL LETTER Z, or
     U+0061 LATIN SMALL LETTER A to U+007A LATIN SMALL LETTER Z, then, for
     historical reasons, all the characters that were matched after the
     U+0026 AMPERSAND (&amp;) must be unconsumed, and nothing is returned.</p>

    <p>Otherwise, return a character token for the character corresponding to
     the entity name (as given by the second column of the <a href="section-entities.html#entities0">entities</a> table).</p>

    <div class="example">
     <p>If the markup contains <code title="">I'm &amp;notit; I tell
      you</code>, the entity is parsed as &quot;not&quot;, as in, <code title="">I'm
      ¬it; I tell you</code>. But if the markup was <code title="">I'm
      &amp;notin; I tell you</code>, the entity would be parsed as &quot;notin;&quot;,
      resulting in <code title="">I'm ∉ I tell you</code>.</p>
    </div>
  </dd></dl>

  <script src="http://status.whatwg.org/annotate-web-apps.js" type="text/javascript"></script></body></html>
